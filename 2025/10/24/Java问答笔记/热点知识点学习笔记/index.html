
<!DOCTYPE html><html lang="zh-CN">

<head>
  <meta charset="utf-8">
  <meta name="hexo-theme" content="https://github.com/xaoxuu/hexo-theme-stellar/tree/1.30.0" theme-name="Stellar" theme-version="1.30.0">
  
  <meta name="generator" content="Hexo 7.0.0">
  <meta http-equiv='x-dns-prefetch-control' content='on' />
  
  <meta name="renderer" content="webkit">
  <meta name="force-rendering" content="webkit">
  <meta http-equiv="X-UA-Compatible" content="IE=Edge,chrome=1">
  <meta name="HandheldFriendly" content="True" >
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  <meta name="theme-color" media="(prefers-color-scheme: dark)" content="#000">
  <meta name="theme-color" content="#f9fafb">
  
  <title>ðŸ”¥çƒ­ç‚¹çŸ¥è¯†ç‚¹å­¦ä¹ ç¬”è®°-ç‚¼é‡‘ä¸¹ç†”é«˜é¢‘è€ƒç‚¹,å¸ƒå¤©ç½‘æ“’æŠ€æœ¯çƒ­ç‚¹ - Jakic's Blog</title>

  
    <meta name="description" content="å¹¶å‘ç¼–ç¨‹ä¸ºé£Žç«è½®ï¼Œåˆ†å¸ƒå¼æ˜¯ä¹¾å¤åœˆâ€”â€”æ–½ä¸»å¯è¦å‚æ‚Ÿè¿™ã€Œé¢è¯•çœŸç»ã€ä¸‰åƒå¤§é“ï¼Ÿ">
<meta property="og:type" content="article">
<meta property="og:title" content="ðŸ”¥çƒ­ç‚¹çŸ¥è¯†ç‚¹å­¦ä¹ ç¬”è®°-ç‚¼é‡‘ä¸¹ç†”é«˜é¢‘è€ƒç‚¹,å¸ƒå¤©ç½‘æ“’æŠ€æœ¯çƒ­ç‚¹">
<meta property="og:url" content="https://jakicdong.github.io/2025/10/24/Java%E9%97%AE%E7%AD%94%E7%AC%94%E8%AE%B0/%E7%83%AD%E7%82%B9%E7%9F%A5%E8%AF%86%E7%82%B9%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/index.html">
<meta property="og:site_name" content="Jakic&#39;s Blog">
<meta property="og:description" content="å¹¶å‘ç¼–ç¨‹ä¸ºé£Žç«è½®ï¼Œåˆ†å¸ƒå¼æ˜¯ä¹¾å¤åœˆâ€”â€”æ–½ä¸»å¯è¦å‚æ‚Ÿè¿™ã€Œé¢è¯•çœŸç»ã€ä¸‰åƒå¤§é“ï¼Ÿ">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/JakicDong/blog-assets@main/images/20250722101015.png">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/JakicDong/blog-assets@main/images/20250722101058.png">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/JakicDong/blog-assets@main/images/20250723102452.png">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/JakicDong/blog-assets@main/images/20250723111427.png">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/JakicDong/blog-assets@main/images/20250730111419.png">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/JakicDong/blog-assets@main/images/20250731094624.png">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/JakicDong/blog-assets@main/images/20250731095217.png">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/JakicDong/blog-assets@main/images/NIO.png">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/JakicDong/blog-assets@main/images/20250731095841.png">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/JakicDong/blog-assets@main/images/20250731103546.png">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/JakicDong/blog-assets@main/images/java%E9%9B%86%E5%90%88%E4%B8%BB%E8%A6%81%E5%85%B3%E7%B3%BB.png">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/JakicDong/blog-assets@main/images/20250801105907.png">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/JakicDong/blog-assets@main/images/20250801112309.png">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/JakicDong/blog-assets@main/images/20250801112729.png">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/JakicDong/blog-assets@main/images/20250801112820.png">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/JakicDong/blog-assets@main/images/20250801112835.png">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/JakicDong/blog-assets@main/images/20250801112927.png">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/JakicDong/blog-assets@main/images/20250804110446.png">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/JakicDong/blog-assets@main/images/20250804110550.png">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/JakicDong/blog-assets@main/images/20250804110642.png">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/JakicDong/blog-assets@main/images/20250804110656.png">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/JakicDong/blog-assets@main/images/20250804110718.png">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/JakicDong/blog-assets@main/images/20250804110809.png">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/JakicDong/blog-assets@main/images/20250804112738.png">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/JakicDong/blog-assets@main/images/20250805111458.png">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/JakicDong/blog-assets@main/images/20250807102317.png">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/JakicDong/blog-assets@main/images/20250807102413.png">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/JakicDong/blog-assets@main/images/20250807102739.png">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/JakicDong/blog-assets@main/images/20250807102747.png">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/JakicDong/blog-assets@main/images/20250807102803.png">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/JakicDong/blog-assets@main/images/20250807103405.png">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/JakicDong/blog-assets@main/images/20250807103452.png">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/JakicDong/blog-assets@main/images/20250807103509.png">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/JakicDong/blog-assets@main/images/20250807103648.png">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/JakicDong/blog-assets@main/images/20250807103717.png">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/JakicDong/blog-assets@main/images/20250807103755.png">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/JakicDong/blog-assets@main/images/20250808104808.png">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/JakicDong/blog-assets@main/images/20250808105242.png">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/JakicDong/blog-assets@main/images/20250808110938.png">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/JakicDong/blog-assets@main/images/20250808111222.png">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/JakicDong/blog-assets@main/images/20250808141237.png">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/JakicDong/blog-assets@main/images/20250808142112.png">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/JakicDong/blog-assets@main/images/20250809102015.png">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/JakicDong/blog-assets@main/images/20250809104257.png">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/JakicDong/blog-assets@main/images/20250809104355.png">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/JakicDong/blog-assets@main/images/20250809104457.png">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/JakicDong/blog-assets@main/images/20250820212712.png">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/JakicDong/blog-assets@main/images/20250928191717.png">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/JakicDong/blog-assets@main/images/20250928193013.png">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/JakicDong/blog-assets@main/images/20250930165350.png">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/JakicDong/blog-assets@main/images/20250930165403.png">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/JakicDong/blog-assets@main/images/20251027082309.png">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/JakicDong/blog-assets@main/images/20250930165420.png">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/JakicDong/blog-assets@main/images/20251003165249.png">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/JakicDong/blog-assets@main/images/20251003170914.png">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/JakicDong/blog-assets@main/images/20251003171039.png">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/JakicDong/blog-assets@main/images/20251003171336.png">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/JakicDong/blog-assets@main/images/20251004132340.png">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/JakicDong/blog-assets@main/images/20251004132756.png">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/JakicDong/blog-assets@main/images/20251004145546.png">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/JakicDong/blog-assets@main/images/20251004152020.png">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/JakicDong/blog-assets@main/images/20251004152103.png">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/JakicDong/blog-assets@main/images/20251009111617.png">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/JakicDong/blog-assets@main/images/20251009112449.png">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/JakicDong/blog-assets@main/images/20251009141857.png">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/JakicDong/blog-assets@main/images/20251009142009.png">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/JakicDong/blog-assets@main/images/20251009142022.png">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/JakicDong/blog-assets@main/images/20251009143540.png">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/JakicDong/blog-assets@main/images/20251009143612.png">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/JakicDong/blog-assets@main/images/20251009151428.png">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/JakicDong/blog-assets@main/images/20251027092407.png">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/JakicDong/blog-assets@main/images/20251009155017.png">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/JakicDong/blog-assets@main/images/20251009160404.png">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/JakicDong/blog-assets@main/images/20251009160530.png">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/JakicDong/blog-assets@main/images/20251027093600.png">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/JakicDong/blog-assets@main/images/20251009160610.png">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/JakicDong/blog-assets@main/images/20251009160653.png">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/JakicDong/blog-assets@main/images/20251009170605.png">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/JakicDong/blog-assets@main/images/20251009170646.png">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/JakicDong/blog-assets@main/images/20251009170656.png">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/JakicDong/blog-assets@main/images/20251010104933.png">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/JakicDong/blog-assets@main/images/20251010105023.png">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/JakicDong/blog-assets@main/images/20251010105058.png">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/JakicDong/blog-assets@main/images/20251010105204.png">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/JakicDong/blog-assets@main/images/20251010105242.png">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/JakicDong/blog-assets@main/images/20251010105550.png">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/JakicDong/blog-assets@main/images/20251010105607.png">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/JakicDong/blog-assets@main/images/20251010105625.png">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/JakicDong/blog-assets@main/images/20251027103144.png">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/JakicDong/blog-assets@main/images/20251027104143.png">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/JakicDong/blog-assets@main/images/20251010110039.png">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/JakicDong/blog-assets@main/images/20251010110236.png">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/JakicDong/blog-assets@main/images/20251010110317.png">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/JakicDong/blog-assets@main/images/20251010110343.png">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/JakicDong/blog-assets@main/images/20251010110423.png">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/JakicDong/blog-assets@main/images/20251010110434.png">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/JakicDong/blog-assets@main/images/20251010110511.png">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/JakicDong/blog-assets@main/images/20251010110646.png">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/JakicDong/blog-assets@main/images/20251010111648.png">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/JakicDong/blog-assets@main/images/20251010111742.png">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/JakicDong/blog-assets@main/images/20251010111815.png">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/JakicDong/blog-assets@main/images/20251010111849.png">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/JakicDong/blog-assets@main/images/20251010150406.png">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/JakicDong/blog-assets@main/images/20251010150604.png">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/JakicDong/blog-assets@main/images/20251010150844.png">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/JakicDong/blog-assets@main/images/20251010150900.png">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/JakicDong/blog-assets@main/images/20251010151152.png">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/JakicDong/blog-assets@main/images/20251010151210.png">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/JakicDong/blog-assets@main/images/20251010151832.png">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/JakicDong/blog-assets@main/images/20251010151924.png">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/JakicDong/blog-assets@main/images/20251010153321.png">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/JakicDong/blog-assets@main/images/20251010153455.png">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/JakicDong/blog-assets@main/images/20251010162108.png">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/JakicDong/blog-assets@main/images/20251010162712.png">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/JakicDong/blog-assets@main/images/20251010162802.png">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/JakicDong/blog-assets@main/images/20251010162812.png">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/JakicDong/blog-assets@main/images/20251010162907.png">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/JakicDong/blog-assets@main/images/20251011095331.png">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/JakicDong/blog-assets@main/images/20251011095524.png">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/JakicDong/blog-assets@main/images/20251011095558.png">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/JakicDong/blog-assets@main/images/20251011102820.png">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/JakicDong/blog-assets@main/images/20251011102844.png">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/JakicDong/blog-assets@main/images/20251011102906.png">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/JakicDong/blog-assets@main/images/20251011103059.png">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/JakicDong/blog-assets@main/images/20251011103352.png">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/JakicDong/blog-assets@main/images/20251011103544.png">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/JakicDong/blog-assets@main/images/20251011104114.png">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/JakicDong/blog-assets@main/images/20251011104156.png">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/JakicDong/blog-assets@main/images/20251011104247.png">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/JakicDong/blog-assets@main/images/20251011104304.png">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/JakicDong/blog-assets@main/images/20251011104352.png">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/JakicDong/blog-assets@main/images/20251011104424.png">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/JakicDong/blog-assets@main/images/20251011105011.png">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/JakicDong/blog-assets@main/images/20251011105137.png">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/JakicDong/blog-assets@main/images/20251011105431.png">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/JakicDong/blog-assets@main/images/20251011105556.png">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/JakicDong/blog-assets@main/images/20251011111643.png">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/JakicDong/blog-assets@main/images/20251011111737.png">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/JakicDong/blog-assets@main/images/20250612103550.png">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/JakicDong/blog-assets@main/images/20250612112408.png">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/JakicDong/blog-assets@main/images/20250612112435.png">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/JakicDong/blog-assets@main/images/20250613161219.png">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/JakicDong/blog-assets@main/images/20250613161254.png">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/JakicDong/blog-assets@main/images/20250613161338.png">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/JakicDong/blog-assets@main/images/20250613161415.png">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/JakicDong/blog-assets@main/images/20250613162534.png">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/JakicDong/blog-assets@main/images/20250613163109.png">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/JakicDong/blog-assets@main/images/20250616093841.png">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/JakicDong/blog-assets@main/images/20250616093925.png">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/JakicDong/blog-assets@main/images/20250616094148.png">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/JakicDong/blog-assets@main/images/20250616101033.png">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/JakicDong/blog-assets@main/images/20250616110133.png">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/JakicDong/blog-assets@main/images/20250616112123.png">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/JakicDong/blog-assets@main/images/20250616113040.png">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/JakicDong/blog-assets@main/images/20250616113305.png">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/JakicDong/blog-assets@main/images/20250616113328.png">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/JakicDong/blog-assets@main/images/20250616113533.png">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/JakicDong/blog-assets@main/images/20250616151955.png">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/JakicDong/blog-assets@main/images/20250616154016.png">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/JakicDong/blog-assets@main/images/20250616154915.png">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/JakicDong/blog-assets@main/images/20250616154950.png">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/JakicDong/blog-assets@main/images/20250616155054.png">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/JakicDong/blog-assets@main/images/20250616160916.png">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/JakicDong/blog-assets@main/images/20250616162021.png">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/JakicDong/blog-assets@main/images/20250616162445.png">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/JakicDong/blog-assets@main/images/20250616162937.png">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/JakicDong/blog-assets@main/images/20250616163140.png">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/JakicDong/blog-assets@main/images/20250616163309.png">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/JakicDong/blog-assets@main/images/20250617154612.png">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/JakicDong/blog-assets@main/images/20250618110546.png">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/JakicDong/blog-assets@main/images/20250618110821.png">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/JakicDong/blog-assets@main/images/20250618111513.png">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/JakicDong/blog-assets@main/images/20250618140806.png">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/JakicDong/blog-assets@main/images/20250618142719.png">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/JakicDong/blog-assets@main/images/20250618142740.png">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/JakicDong/blog-assets@main/images/20250618143231.png">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/JakicDong/blog-assets@main/images/20250618143445.png">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/JakicDong/blog-assets@main/images/20250618151308.png">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/JakicDong/blog-assets@main/images/20250618152056.png">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/JakicDong/blog-assets@main/images/20250619095220.png">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/JakicDong/blog-assets@main/images/20250619095335.png">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/JakicDong/blog-assets@main/images/20250619095617.png">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/JakicDong/blog-assets@main/images/20250619095723.png">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/JakicDong/blog-assets@main/images/20250619100616.png">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/JakicDong/blog-assets@main/images/20250619101635.png">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/JakicDong/blog-assets@main/images/20250619101736.png">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/JakicDong/blog-assets@main/images/20250619105445.png">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/JakicDong/blog-assets@main/images/20250619105921.png">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/JakicDong/blog-assets@main/images/%E7%B4%A2%E5%BC%95%E5%8A%A0%E5%BF%AB%E6%9F%A5%E8%AF%A2%E5%8E%9F%E7%90%86.png">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/JakicDong/blog-assets@main/images/MYSQL%E7%B4%A2%E5%BC%95%E7%BB%93%E6%9E%84.png">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/JakicDong/blog-assets@main/images/%E7%B4%A2%E5%BC%95%E7%B1%BB%E5%9E%8B.png">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/JakicDong/blog-assets@main/images/%E4%B8%BB%E9%94%AE%E7%B4%A2%E5%BC%95.png">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/JakicDong/blog-assets@main/images/20250620110109.png">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/JakicDong/blog-assets@main/images/B+%E6%A0%91.png">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/JakicDong/blog-assets@main/images/B+%E6%A0%912.png">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/JakicDong/blog-assets@main/images/B%E6%A0%91.png">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/JakicDong/blog-assets@main/images/b%E6%A0%912.png">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/JakicDong/blog-assets@main/images/20250621105348.png">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/JakicDong/blog-assets@main/images/20250621105458.png">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/JakicDong/blog-assets@main/images/20250621105550.png">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/JakicDong/blog-assets@main/images/20250621105601.png">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/JakicDong/blog-assets@main/images/20250621105641.png">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/JakicDong/blog-assets@main/images/20250623101840.png">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/JakicDong/blog-assets@main/images/3%E5%B1%82B+%E6%A0%91.png">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/JakicDong/blog-assets@main/images/20250623103448.png">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/JakicDong/blog-assets@main/images/20250623104021.png">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/JakicDong/blog-assets@main/images/20250623104724.png">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/JakicDong/blog-assets@main/images/20250623104917.png">
<meta property="og:image" content="https://cdn.tobebetterjavaer.com/stutymore/mysql-Sorting_quicksort_anim.gif">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/JakicDong/blog-assets@main/images/20250623111022.png">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/JakicDong/blog-assets@main/images/20250623111225.png">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/JakicDong/blog-assets@main/images/20250623111452.png">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/JakicDong/blog-assets@main/images/20250623112230.png">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/JakicDong/blog-assets@main/images/MRR.png">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/JakicDong/blog-assets@main/images/20250623113200.png">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/JakicDong/blog-assets@main/images/20250623113223.png">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/JakicDong/blog-assets@main/images/20250623113305.png">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/JakicDong/blog-assets@main/images/20250623113322.png">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/JakicDong/blog-assets@main/images/20250623113335.png">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/JakicDong/blog-assets@main/images/%E8%81%94%E5%90%88%E7%B4%A2%E5%BC%95.png">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/JakicDong/blog-assets@main/images/20250624093822.png">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/JakicDong/blog-assets@main/images/20250624094019.png">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/JakicDong/blog-assets@main/images/20250624094156.png">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/JakicDong/blog-assets@main/images/20250624094631.png">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/JakicDong/blog-assets@main/images/20250624094835.png">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/JakicDong/blog-assets@main/images/20250624100243.png">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/JakicDong/blog-assets@main/images/20250624100956.png">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/JakicDong/blog-assets@main/images/20250624101013.png">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/JakicDong/blog-assets@main/images/20250624101041.png">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/JakicDong/blog-assets@main/images/20250624101415.png">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/JakicDong/blog-assets@main/images/20250624101535.png">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/JakicDong/blog-assets@main/images/20250624101624.png">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/JakicDong/blog-assets@main/images/20250624101721.png">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/JakicDong/blog-assets@main/images/20250624101751.png">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/JakicDong/blog-assets@main/images/20250624101837.png">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/JakicDong/blog-assets@main/images/20250624102101.png">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/JakicDong/blog-assets@main/images/20250624102301.png">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/JakicDong/blog-assets@main/images/20250624102354.png">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/JakicDong/blog-assets@main/images/20250624102426.png">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/JakicDong/blog-assets@main/images/20250624102507.png">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/JakicDong/blog-assets@main/images/20250624102546.png">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/JakicDong/blog-assets@main/images/20250625092449.png">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/JakicDong/blog-assets@main/images/20250625093141.png">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/JakicDong/blog-assets@main/images/20250625095630.png">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/JakicDong/blog-assets@main/images/20250625103938.png">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/JakicDong/blog-assets@main/images/20250625104220.png">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/JakicDong/blog-assets@main/images/20250625105204.png">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/JakicDong/blog-assets@main/images/20250625105253.png">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/JakicDong/blog-assets@main/images/20250625110538.png">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/JakicDong/blog-assets@main/images/20250625112428.png">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/JakicDong/blog-assets@main/images/20251011152502.png">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/JakicDong/blog-assets@main/images/20251011152533.png">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/JakicDong/blog-assets@main/images/20251011152635.png">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/JakicDong/blog-assets@main/images/20251011152707.png">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/JakicDong/blog-assets@main/images/20251011152751.png">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/JakicDong/blog-assets@main/images/20251011155649.png">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/JakicDong/blog-assets@main/images/20251011160550.png">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/JakicDong/blog-assets@main/images/20251011162301.png">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/JakicDong/blog-assets@main/images/20251011162620.png">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/JakicDong/blog-assets@main/images/20251011165009.png">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/JakicDong/blog-assets@main/images/20251027183826.png">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/JakicDong/blog-assets@main/images/20251011165026.png">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/JakicDong/blog-assets@main/images/20251011170430.png">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/JakicDong/blog-assets@main/images/20251012183903.png">
<meta property="og:image" content="https://cdn.tobebetterjavaer.com/stutymore/mysql-20250415152542.png">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/JakicDong/blog-assets@main/images/20251012193756.png">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/JakicDong/blog-assets@main/images/20251012193828.png">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/JakicDong/blog-assets@main/images/20251012193847.png">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/JakicDong/blog-assets@main/images/20251012193913.png">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/JakicDong/blog-assets@main/images/20251012194100.png">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/JakicDong/blog-assets@main/images/20251012194118.png">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/JakicDong/blog-assets@main/images/20251012194134.png">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/JakicDong/blog-assets@main/images/20251012194152.png">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/JakicDong/blog-assets@main/images/20251012194203.png">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/JakicDong/blog-assets@main/images/20251012194215.png">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/JakicDong/blog-assets@main/images/20251012194240.png">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/JakicDong/blog-assets@main/images/20251012194259.png">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/JakicDong/blog-assets@main/images/20251012194321.png">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/JakicDong/blog-assets@main/images/20251012194333.png">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/JakicDong/blog-assets@main/images/20251012194342.png">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/JakicDong/blog-assets@main/images/20251012194355.png">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/JakicDong/blog-assets@main/images/20251012194406.png">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/JakicDong/blog-assets@main/images/20251012194414.png">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/JakicDong/blog-assets@main/images/20251012194427.png">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/JakicDong/blog-assets@main/images/20251012194443.png">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/JakicDong/blog-assets@main/images/20251012194516.png">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/JakicDong/blog-assets@main/images/20251012194526.png">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/JakicDong/blog-assets@main/images/20251012194544.png">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/JakicDong/blog-assets@main/images/20251012195251.png">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/JakicDong/blog-assets@main/images/20251012195301.png">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/JakicDong/blog-assets@main/images/20251012195335.png">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/JakicDong/blog-assets@main/images/20251012195346.png">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/JakicDong/blog-assets@main/images/20250725112831.png">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/JakicDong/blog-assets@main/images/20250725112927.png">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/JakicDong/blog-assets@main/images/20250811101352.png">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/JakicDong/blog-assets@main/images/20250811102451.png">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/JakicDong/blog-assets@main/images/20250811102931.png">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/JakicDong/blog-assets@main/images/20250811103014.png">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/JakicDong/blog-assets@main/images/20250811103028.png">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/JakicDong/blog-assets@main/images/20250811103046.png">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/JakicDong/blog-assets@main/images/20250811103101.png">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/JakicDong/blog-assets@main/images/20250811103115.png">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/JakicDong/blog-assets@main/images/20250811103129.png">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/JakicDong/blog-assets@main/images/20250811103146.png">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/JakicDong/blog-assets@main/images/20250811103203.png">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/JakicDong/blog-assets@main/images/20250811103219.png">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/JakicDong/blog-assets@main/images/20250912205152.png">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/JakicDong/blog-assets@main/images/20250912205641.png">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/JakicDong/blog-assets@main/images/20250912205919.png">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/JakicDong/blog-assets@main/images/20250912210551.png">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/JakicDong/blog-assets@main/images/20250912210654.png">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/JakicDong/blog-assets@main/images/20250912211024.png">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/JakicDong/blog-assets@main/images/20250912211154.png">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/JakicDong/blog-assets@main/images/20250912211332.png">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/JakicDong/blog-assets@main/images/20250928161918.png">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/JakicDong/blog-assets@main/images/20250928162003.png">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/JakicDong/blog-assets@main/images/20250928162408.png">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/JakicDong/blog-assets@main/images/20250928163257.png">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/JakicDong/blog-assets@main/images/20250928163337.png">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/JakicDong/blog-assets@main/images/20250928163355.png">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/JakicDong/blog-assets@main/images/20250928163542.png">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/JakicDong/blog-assets@main/images/20250928163946.png">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/JakicDong/blog-assets@main/images/20250928164026.png">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/JakicDong/blog-assets@main/images/20250928164208.png">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/JakicDong/blog-assets@main/images/20250928165143.png">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/JakicDong/blog-assets@main/images/20250928165506.png">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/JakicDong/blog-assets@main/images/20251016095627.png">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/JakicDong/blog-assets@main/images/20251016095640.png">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/JakicDong/blog-assets@main/images/20250928170958.png">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/JakicDong/blog-assets@main/images/20250928171009.png">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/JakicDong/blog-assets@main/images/20251022093956.png">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/JakicDong/blog-assets@main/images/20251022094156.png">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/JakicDong/blog-assets@main/images/20251022094922.png">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/JakicDong/blog-assets@main/images/20251022095153.png">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/JakicDong/blog-assets@main/images/20251028151204.png">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/JakicDong/blog-assets@main/images/20251022100013.png">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/JakicDong/blog-assets@main/images/20251022101036.png">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/JakicDong/blog-assets@main/images/20251022105702.png">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/JakicDong/blog-assets@main/images/20251022105811.png">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/JakicDong/blog-assets@main/images/20251022110143.png">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/JakicDong/blog-assets@main/images/20251022110356.png">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/JakicDong/blog-assets@main/images/20251022110609.png">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/JakicDong/blog-assets@main/images/20251022110559.png">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/JakicDong/blog-assets@main/images/20251022110834.png">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/JakicDong/blog-assets@main/images/20251022110950.png">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/JakicDong/blog-assets@main/images/20251022111101.png">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/JakicDong/blog-assets@main/images/20251022111121.png">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/JakicDong/blog-assets@main/images/20251022111140.png">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/JakicDong/blog-assets@main/images/20251022111245.png">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/JakicDong/blog-assets@main/images/20251023112833.png">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/JakicDong/blog-assets@main/images/20251023160847.png">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/JakicDong/blog-assets@main/images/20251023160907.png">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/JakicDong/blog-assets@main/images/20251023160922.png">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/JakicDong/blog-assets@main/images/20251023160930.png">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/JakicDong/blog-assets@main/images/20251023160946.png">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/JakicDong/blog-assets@main/images/20251023161016.png">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/JakicDong/blog-assets@main/images/20251023161037.png">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/JakicDong/blog-assets@main/images/20251023161053.png">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/JakicDong/blog-assets@main/images/20251023161146.png">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/JakicDong/blog-assets@main/images/20251023161307.png">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/JakicDong/blog-assets@main/images/20251023161344.png">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/JakicDong/blog-assets@main/images/20251023162344.png">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/JakicDong/blog-assets@main/images/20251023162513.png">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/JakicDong/blog-assets@main/images/20251023162536.png">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/JakicDong/blog-assets@main/images/20251023162648.png">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/JakicDong/blog-assets@main/images/20251023162726.png">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/JakicDong/blog-assets@main/images/20251023162805.png">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/JakicDong/blog-assets@main/images/20251023164922.png">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/JakicDong/blog-assets@main/images/20251023164947.png">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/JakicDong/blog-assets@main/images/20251023165020.png">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/JakicDong/blog-assets@main/images/20251023165052.png">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/JakicDong/blog-assets@main/images/20251023165136.png">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/JakicDong/blog-assets@main/images/20251023165213.png">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/JakicDong/blog-assets@main/images/20251023165228.png">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/JakicDong/blog-assets@main/images/20251023165726.png">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/JakicDong/blog-assets@main/images/20251023165813.png">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/JakicDong/blog-assets@main/images/20251023165854.png">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/JakicDong/blog-assets@main/images/20251023165930.png">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/JakicDong/blog-assets@main/images/20251023170000.png">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/JakicDong/blog-assets@main/images/20251023170235.png">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/JakicDong/blog-assets@main/images/20251023170247.png">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/JakicDong/blog-assets@main/images/20251023170359.png">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/JakicDong/blog-assets@main/images/20251023170416.png">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/JakicDong/blog-assets@main/images/20251023170521.png">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/JakicDong/blog-assets@main/images/20251023170535.png">
<meta property="og:image" content="https://cdn.tobebetterjavaer.com/stutymore/redis-20250607100252.png">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/JakicDong/blog-assets@main/images/20251024094421.png">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/JakicDong/blog-assets@main/images/20251024094451.png">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/JakicDong/blog-assets@main/images/20251024094551.png">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/JakicDong/blog-assets@main/images/20251024095121.png">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/JakicDong/blog-assets@main/images/20251024095130.png">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/JakicDong/blog-assets@main/images/20251024095312.png">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/JakicDong/blog-assets@main/images/20251024100031.png">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/JakicDong/blog-assets@main/images/20251024100154.png">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/JakicDong/blog-assets@main/images/20251024100219.png">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/JakicDong/blog-assets@main/images/20251022155254.png">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/JakicDong/blog-assets@main/images/20251022155349.png">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/JakicDong/blog-assets@main/images/20251022155821.png">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/JakicDong/blog-assets@main/images/20251022155845.png">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/JakicDong/blog-assets@main/images/20251022160045.png">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/JakicDong/blog-assets@main/images/20251022160058.png">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/JakicDong/blog-assets@main/images/20251022164805.png">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/JakicDong/blog-assets@main/images/20251022164814.png">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/JakicDong/blog-assets@main/images/20251022164823.png">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/JakicDong/blog-assets@main/images/20251022164834.png">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/JakicDong/blog-assets@main/images/20251022164849.png">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/JakicDong/blog-assets@main/images/20251022164904.png">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/JakicDong/blog-assets@main/images/20251022165402.png">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/JakicDong/blog-assets@main/images/20251022165409.png">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/JakicDong/blog-assets@main/images/20251022165417.png">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/JakicDong/blog-assets@main/images/20251022165426.png">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/JakicDong/blog-assets@main/images/20251022165435.png">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/JakicDong/blog-assets@main/images/20251022165456.png">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/JakicDong/blog-assets@main/images/20251022165524.png">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/JakicDong/blog-assets@main/images/20251022165715.png">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/JakicDong/blog-assets@main/images/20251022165731.png">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/JakicDong/blog-assets@main/images/20251022165745.png">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/JakicDong/blog-assets@main/images/20251022165756.png">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/JakicDong/blog-assets@main/images/20251022165805.png">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/JakicDong/blog-assets@main/images/20251024162351.png">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/JakicDong/blog-assets@main/images/20251024162423.png">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/JakicDong/blog-assets@main/images/20251024163612.png">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/JakicDong/blog-assets@main/images/20251024163711.png">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/JakicDong/blog-assets@main/images/20251024163740.png">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/JakicDong/blog-assets@main/images/20251024163839.png">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/JakicDong/blog-assets@main/images/20251024164017.png">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/JakicDong/blog-assets@main/images/20251024164058.png">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/JakicDong/blog-assets@main/images/20251024164130.png">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/JakicDong/blog-assets@main/images/20251024164150.png">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/JakicDong/blog-assets@main/images/20251024164321.png">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/JakicDong/blog-assets@main/images/20251024164332.png">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/JakicDong/blog-assets@main/images/20251024164346.png">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/JakicDong/blog-assets@main/images/20251024164358.png">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/JakicDong/blog-assets@main/images/20251024164722.png">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/JakicDong/blog-assets@main/images/20251024164917.png">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/JakicDong/blog-assets@main/images/20251024165053.png">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/JakicDong/blog-assets@main/images/20251024165224.png">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/JakicDong/blog-assets@main/images/20251024165235.png">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/JakicDong/blog-assets@main/images/20251024165247.png">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/JakicDong/blog-assets@main/images/20251024165344.png">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/JakicDong/blog-assets@main/images/20251024184234.png">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/JakicDong/blog-assets@main/images/20251024184604.png">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/JakicDong/blog-assets@main/images/20251024184803.png">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/JakicDong/blog-assets@main/images/20251024185126.png">
<meta property="og:image" content="https://cdn.tobebetterjavaer.com/stutymore/spring-20250714171739.png">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/JakicDong/blog-assets@main/images/20251024185306.png">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/JakicDong/blog-assets@main/images/20251024185314.png">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/JakicDong/blog-assets@main/images/20251024185323.png">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/JakicDong/blog-assets@main/images/20251024185332.png">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/JakicDong/blog-assets@main/images/20251024185702.png">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/JakicDong/blog-assets@main/images/20251024190129.png">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/JakicDong/blog-assets@main/images/20251024190137.png">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/JakicDong/blog-assets@main/images/20251024190147.png">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/JakicDong/blog-assets@main/images/20251024190156.png">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/JakicDong/blog-assets@main/images/20251024190207.png">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/JakicDong/blog-assets@main/images/20251024190258.png">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/JakicDong/blog-assets@main/images/20251024190310.png">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/JakicDong/blog-assets@main/images/20251024190348.png">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/JakicDong/blog-assets@main/images/20251024190356.png">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/JakicDong/blog-assets@main/images/20251024190407.png">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/JakicDong/blog-assets@main/images/20251024190421.png">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/JakicDong/blog-assets@main/images/20251025143412.png">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/JakicDong/blog-assets@main/images/20251025143839.png">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/JakicDong/blog-assets@main/images/20250715112359.png">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/JakicDong/blog-assets@main/images/20251025144223.png">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/JakicDong/blog-assets@main/images/20250716110915.png">
<meta property="article:published_time" content="2025-10-23T16:00:00.000Z">
<meta property="article:modified_time" content="2025-10-28T10:45:45.426Z">
<meta property="article:author" content="JakicDong">
<meta property="article:tag" content="Java">
<meta property="article:tag" content="åŸºç¡€">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://cdn.jsdelivr.net/gh/JakicDong/blog-assets@main/images/20250722101015.png">
  
  
  
  <meta name="keywords" content="Java,åŸºç¡€">

  <!-- feed -->
  

  <link rel="stylesheet" href="/css/main.css?v=1.30.0">


  
    <link rel="shortcut icon" href="https://cdn.jsdelivr.net/gh/JakicDong/blog-assets@main/images/logo.png">
  

  

  
<!-- hexo injector head_end start --><script src="./func.js"></script><!-- hexo injector head_end end --></head>
<link rel="stylesheet" href="/css/check-in.css"><body><div class="sitebg"><div class="siteblur"></div></div>

<div class="l_body content tech" id="start" layout="post" ><aside class="l_left"><div class="leftbar-container">


<header class="header"><div class="logo-wrap"><a class="avatar" href="/about/"><div class="bg" style="opacity:0;background-image:url(https://gcore.jsdelivr.net/gh/cdn-x/placeholder@1.0.12/avatar/round/rainbow64@3x.webp);"></div><img no-lazy class="avatar" src="https://avatars.githubusercontent.com/u/130200522?v=4" onerror="javascript:this.classList.add('error');this.src='https://gcore.jsdelivr.net/gh/cdn-x/placeholder@1.0.12/image/2659360.svg';"></a><a class="title" href="/"><div class="main" ff="title">Jakic's Blog</div><div class="sub normal cap">å­¦ä¹ ç”Ÿæ´»è®°å½•</div><div class="sub hover cap" style="opacity:0"> è¸ä¸Šå–ç»è·¯,æ¯”æŠµè¾¾çµå±±æ›´é‡è¦</div></a></div></header>

<div class="nav-area">
<div class="search-wrapper" id="search-wrapper"><form class="search-form"><a class="search-button" onclick="document.getElementById(&quot;search-input&quot;).focus();"><svg t="1705074644177" viewBox="0 0 1025 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="1560" width="200" height="200"><path d="M1008.839137 935.96571L792.364903 719.491476a56.783488 56.783488 0 0 0-80.152866 0 358.53545 358.53545 0 1 1 100.857314-335.166073 362.840335 362.840335 0 0 1-3.689902 170.145468 51.248635 51.248635 0 1 0 99.217358 26.444296 462.057693 462.057693 0 1 0-158.255785 242.303546l185.930047 185.725053a51.248635 51.248635 0 0 0 72.568068 0 51.248635 51.248635 0 0 0 0-72.978056z" p-id="1561"></path><path d="M616.479587 615.969233a50.428657 50.428657 0 0 0-61.498362-5.534852 174.655348 174.655348 0 0 1-177.525271 3.484907 49.403684 49.403684 0 0 0-58.833433 6.76482l-3.074918 2.869923a49.403684 49.403684 0 0 0 8.609771 78.10292 277.767601 277.767601 0 0 0 286.992355-5.739847 49.403684 49.403684 0 0 0 8.404776-76.667958z" p-id="1562"></path></svg></a><input type="text" class="search-input" id="search-input" placeholder="ç«™å†…æœç´¢"></form><div id="search-result"></div><div class="search-no-result">æ²¡æœ‰æ‰¾åˆ°å†…å®¹ï¼</div></div>


<nav class="menu dis-select"><a class="nav-item active" title="åšå®¢é¦–é¡µ" href="/" style="color:#1BCDFC"><svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" viewBox="0 0 24 24"><path fill="currentColor" fill-rule="evenodd" d="M5.879 2.879C5 3.757 5 5.172 5 8v8c0 2.828 0 4.243.879 5.121C6.757 22 8.172 22 11 22h2c2.828 0 4.243 0 5.121-.879C19 20.243 19 18.828 19 16V8c0-2.828 0-4.243-.879-5.121C17.243 2 15.828 2 13 2h-2c-2.828 0-4.243 0-5.121.879M8.25 17a.75.75 0 0 1 .75-.75h3a.75.75 0 0 1 0 1.5H9a.75.75 0 0 1-.75-.75M9 12.25a.75.75 0 0 0 0 1.5h6a.75.75 0 0 0 0-1.5zM8.25 9A.75.75 0 0 1 9 8.25h6a.75.75 0 0 1 0 1.5H9A.75.75 0 0 1 8.25 9" clip-rule="evenodd"/><path fill="currentColor" d="M5.235 4.058C5 4.941 5 6.177 5 8v8c0 1.823 0 3.058.235 3.942L5 19.924c-.975-.096-1.631-.313-2.121-.803C2 18.243 2 16.828 2 14v-4c0-2.829 0-4.243.879-5.121c.49-.49 1.146-.707 2.121-.803zm13.53 15.884C19 19.058 19 17.822 19 16V8c0-1.823 0-3.059-.235-3.942l.235.018c.975.096 1.631.313 2.121.803C22 5.757 22 7.17 22 9.999v4c0 2.83 0 4.243-.879 5.122c-.49.49-1.146.707-2.121.803z" opacity=".5"/></svg></a><a class="nav-item" title="æ‰“å¡å¢™" href="/check-in" style="color:#1976D2"><svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" viewBox="0 0 24 24"><path fill="currentColor" fill-rule="evenodd" d="M14.25 4.48v3.057c0 .111 0 .27.02.406a.936.936 0 0 0 .445.683a.96.96 0 0 0 .783.072c.13-.04.272-.108.378-.159L17 8.005l1.124.534c.106.05.248.119.378.16a.958.958 0 0 0 .783-.073a.936.936 0 0 0 .444-.683c.021-.136.021-.295.021-.406V3.031c.113-.005.224-.01.332-.013C21.154 2.98 22 3.86 22 4.933v11.21c0 1.112-.906 2.01-2.015 2.08c-.97.06-2.108.179-2.985.41c-1.082.286-1.99 1.068-3.373 1.436c-.626.167-1.324.257-1.627.323V5.174c.32-.079 1.382-.203 1.674-.371c.184-.107.377-.216.576-.323m5.478 8.338a.75.75 0 0 1-.546.91l-4 1a.75.75 0 0 1-.364-1.456l4-1a.75.75 0 0 1 .91.546" clip-rule="evenodd"/><path fill="currentColor" d="M18.25 3.151c-.62.073-1.23.18-1.75.336a8.2 8.2 0 0 0-.75.27v3.182l.75-.356l.008-.005a1.13 1.13 0 0 1 .492-.13c.047 0 .094.004.138.01c.175.029.315.1.354.12l.009.005l.749.356V3.647z"/><path fill="currentColor" d="M12 5.214c-.334-.064-1.057-.161-1.718-.339C8.938 4.515 8.05 3.765 7 3.487c-.887-.234-2.041-.352-3.018-.412C2.886 3.007 2 3.9 2 4.998v11.146c0 1.11.906 2.01 2.015 2.079c.97.06 2.108.179 2.985.41c.486.129 1.216.431 1.873.726c1.005.451 2.052.797 3.127 1.034z" opacity=".5"/><path fill="currentColor" d="M4.273 12.818a.75.75 0 0 1 .91-.545l4 1a.75.75 0 1 1-.365 1.455l-4-1a.75.75 0 0 1-.545-.91m.909-4.545a.75.75 0 1 0-.364 1.455l4 1a.75.75 0 0 0 .364-1.455z"/></svg></a><a class="nav-item" title="github" target="_blank" rel="noopener" href="https://github.com/JakicDong/" style="color:#1BCDFC"><svg height="32" aria-hidden="true" viewBox="0 0 24 24" version="1.1" width="32" data-view-component="true" class="octicon octicon-mark-github v-align-middle"> <path fill="#cccccc" d="M12 1C5.923 1 1 5.923 1 12c0 4.867 3.149 8.979 7.521 10.436.55.096.756-.233.756-.522 0-.262-.013-1.128-.013-2.049-2.764.509-3.479-.674-3.699-1.292-.124-.317-.66-1.293-1.127-1.554-.385-.207-.936-.715-.014-.729.866-.014 1.485.797 1.691 1.128.99 1.663 2.571 1.196 3.204.907.096-.715.385-1.196.701-1.471-2.448-.275-5.005-1.224-5.005-5.432 0-1.196.426-2.186 1.128-2.956-.111-.275-.496-1.402.11-2.915 0 0 .921-.288 3.024 1.128a10.193 10.193 0 0 1 2.75-.371c.936 0 1.871.123 2.75.371 2.104-1.43 3.025-1.128 3.025-1.128.605 1.513.221 2.64.111 2.915.701.77 1.127 1.747 1.127 2.956 0 4.222-2.571 5.157-5.019 5.432.399.344.743 1.004.743 2.035 0 1.471-.014 2.654-.014 3.025 0 .289.206.632.756.522C19.851 20.979 23 16.854 23 12c0-6.077-4.922-11-11-11Z"></path> </svg></a><a class="nav-item" title="åŠ›æ‰£" target="_blank" rel="noopener" href="https://leetcode.cn/u/dong7/" style="color:#3DC550"><svg width="59" height="22" viewBox="0 0 59 22" fill="none" xmlns="http://www.w3.org/2000/svg" class="h-full w-auto max-w-none"> <path fill-rule="evenodd" clip-rule="evenodd" d="M27.8226 17.4752C28.3202 16.1443 28.7218 14.5458 28.9859 12.6607C29.1277 11.6491 29.2845 10.1658 29.4568 8.20813H35.2561C35.2637 8.20813 35.2713 8.20828 35.2789 8.20857C35.6071 8.22119 35.8628 8.49743 35.8502 8.82558L35.4996 17.9427C35.4873 18.262 35.2249 18.5144 34.9054 18.5144H33.2974C32.8595 18.5144 32.5046 18.8694 32.5046 19.3072C32.5046 19.7451 32.8595 20.1 33.2974 20.1H35.4776C36.3533 20.1 37.0631 19.3901 37.0631 18.5144L37.4595 8.20813C37.4595 7.33244 36.7497 6.62254 35.874 6.62254H29.5913C29.671 5.65054 29.7537 4.58575 29.8394 3.42794C29.8718 2.99129 29.544 2.61109 29.1074 2.57874C28.6707 2.54639 28.2905 2.87414 28.2582 3.3108C28.1689 4.51669 28.0829 5.62069 28.0004 6.62254H25.3695C24.9316 6.62254 24.5767 6.97749 24.5767 7.41534C24.5767 7.85318 24.9316 8.20813 25.3695 8.20813H27.8651C27.7 10.07 27.5501 11.4816 27.4157 12.4407C27.1674 14.2124 26.7941 15.6986 26.3374 16.9199C26.0981 17.5599 25.8527 18.0822 25.6163 18.4944C25.5366 18.6333 25.4649 18.7474 25.4029 18.8378C25.3703 18.8853 25.3512 18.9109 25.3475 18.9155C25.0722 19.256 25.1252 19.7552 25.4657 20.0305C25.8062 20.3057 26.3054 20.2528 26.5806 19.9123C26.6737 19.7971 26.8159 19.5898 26.9917 19.2833C27.271 18.7963 27.5531 18.1959 27.8226 17.4752ZM48.5586 17.3184V7.72969H55.6831C56.3474 7.72969 56.883 8.26047 56.883 8.9117V16.4576C56.883 17.1088 56.3474 17.6396 55.6831 17.6396H53.3916C52.7274 17.6396 52.1918 17.1088 52.1918 16.4576V10.1081C52.1918 9.67022 51.8369 9.31528 51.399 9.31528C50.9612 9.31528 50.6062 9.67022 50.6062 10.1081V16.4576C50.6062 17.9877 51.8548 19.2252 53.3916 19.2252H55.6831C57.2199 19.2252 58.4686 17.9877 58.4686 16.4576V8.9117C58.4686 7.38157 57.2199 6.14411 55.6831 6.14411H48.5586V3.76573C48.5586 3.32788 48.2037 2.97294 47.7658 2.97294C47.328 2.97294 46.9731 3.32788 46.9731 3.76573V6.14411H44.1983C43.7604 6.14411 43.4055 6.49905 43.4055 6.9369C43.4055 7.37475 43.7604 7.72969 44.1983 7.72969H46.9731V12.465L44.3002 13.5341C43.8937 13.6968 43.696 14.1581 43.8586 14.5647C44.0212 14.9712 44.4826 15.1689 44.8891 15.0063L46.9731 14.1727V17.3184C46.9731 18.3666 46.0906 19.2252 44.9911 19.2252C44.5532 19.2252 44.1983 19.5801 44.1983 20.018C44.1983 20.4558 44.5532 20.8108 44.9911 20.8108C46.9567 20.8108 48.5586 19.2522 48.5586 17.3184Z" fill="white"></path> <path d="M13.3797 16.4636C13.874 15.9701 14.674 15.9714 15.1667 16.4665C15.6593 16.9616 15.6581 17.7631 15.1638 18.2566L12.9691 20.4481C10.9443 22.4699 7.64261 22.4992 5.58369 20.5162C5.57179 20.5048 4.655 19.6058 1.63058 16.6402C-0.381491 14.6673 -0.581941 11.5104 1.31147 9.4831L4.84172 5.7031C6.7209 3.69085 10.1849 3.47093 12.3335 5.20847L15.5398 7.80152C16.0828 8.24065 16.1676 9.03757 15.7292 9.58151C15.2909 10.1254 14.4953 10.2104 13.9523 9.77127L10.746 7.17824C9.62238 6.26954 7.65677 6.39434 6.68718 7.43259L3.15688 11.2126C2.23512 12.1996 2.33607 13.7895 3.39833 14.8311C5.61922 17.0088 7.33084 18.6871 7.33282 18.689C8.40324 19.72 10.134 19.7046 11.185 18.6551L13.3797 16.4636Z" fill="#FFA116"></path> <path fill-rule="evenodd" clip-rule="evenodd" d="M8.04824 14.2706C7.35039 14.2706 6.78467 13.7039 6.78467 13.0048C6.78467 12.3057 7.35039 11.739 8.04824 11.739H17.3671C18.0649 11.739 18.6306 12.3057 18.6306 13.0048C18.6306 13.7039 18.0649 14.2706 17.3671 14.2706H8.04824Z" fill="#B3B3B3"></path> <path fill-rule="evenodd" clip-rule="evenodd" d="M9.79343 0.401024C10.2702 -0.109469 11.0698 -0.136141 11.5794 0.34145C12.089 0.819042 12.1156 1.62004 11.6389 2.13054L3.15692 11.2126C2.23513 12.1995 2.33608 13.7894 3.39827 14.831L7.31536 18.6721C7.81405 19.1611 7.82258 19.9625 7.33442 20.4621C6.84626 20.9616 6.04626 20.9702 5.54757 20.4812L1.63046 16.6401C-0.381492 14.6671 -0.581942 11.5102 1.31155 9.48305L9.79343 0.401024Z" fill="white"></path> </svg></a><a class="nav-item" title="çŸ¥è¯†æ˜Ÿçƒ" target="_blank" rel="noopener" href="https://wx.zsxq.com/" style="color:#3DC550"><svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" viewBox="0 0 24 24"><path fill="currentColor" d="M20 12a8 8 0 1 1-16 0a8 8 0 0 1 16 0" opacity=".5"/><path fill="currentColor" d="M17.712 5.453c1.047-.193 2.006-.259 2.797-.152c.77.103 1.536.393 1.956 1.064c.446.714.312 1.542-.012 2.258c-.33.728-.918 1.499-1.672 2.268c-1.516 1.547-3.836 3.226-6.597 4.697c-2.763 1.472-5.495 2.484-7.694 2.92c-1.095.217-2.098.299-2.923.201c-.8-.095-1.6-.383-2.032-1.075c-.47-.752-.296-1.63.07-2.379c.375-.768 1.032-1.586 1.872-2.403L4 12.416c0 .219.083.71.168 1.146c.045.23.09.444.123.596c-.652.666-1.098 1.263-1.339 1.756c-.277.567-.208.825-.145.925c.072.116.305.305.937.38c.609.073 1.44.018 2.455-.183c2.02-.4 4.613-1.351 7.28-2.772c2.667-1.42 4.85-3.015 6.23-4.423c.694-.707 1.15-1.334 1.377-1.836c.233-.515.167-.75.107-.844c-.07-.112-.289-.294-.883-.374c-.542-.072-1.272-.041-2.163.112L16.87 5.656c.338-.101.658-.17.842-.203"/></svg></a><a class="nav-item" title="è”ç³»æˆ‘" href="https://jakicdong.github.io/2025/06/01/contact_author/" style="color:#F44336"><svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" viewBox="0 0 24 24"><path fill="currentColor" d="m13.629 20.472l-.542.916c-.483.816-1.69.816-2.174 0l-.542-.916c-.42-.71-.63-1.066-.968-1.262c-.338-.197-.763-.204-1.613-.219c-1.256-.021-2.043-.098-2.703-.372a5 5 0 0 1-2.706-2.706C2 14.995 2 13.83 2 11.5v-1c0-3.273 0-4.91.737-6.112a5 5 0 0 1 1.65-1.651C5.59 2 7.228 2 10.5 2h3c3.273 0 4.91 0 6.113.737a5 5 0 0 1 1.65 1.65C22 5.59 22 7.228 22 10.5v1c0 2.33 0 3.495-.38 4.413a5 5 0 0 1-2.707 2.706c-.66.274-1.447.35-2.703.372c-.85.015-1.275.022-1.613.219c-.338.196-.548.551-.968 1.262" opacity=".5"/><path fill="currentColor" d="M10.99 14.308c-1.327-.978-3.49-2.84-3.49-4.593c0-2.677 2.475-3.677 4.5-1.609c2.025-2.068 4.5-1.068 4.5 1.609c0 1.752-2.163 3.615-3.49 4.593c-.454.335-.681.502-1.01.502c-.329 0-.556-.167-1.01-.502"/></svg></a></nav>
</div>
<div class="sidebar-check-in">
    <div id="sidebar-check-in-calendar"></div>
</div>
<div class="widgets">
<widget class="widget-wrapper slide-up post-list"><div class="widget-header dis-select"><span class="name">ä¸“æ ï¼šå­¦ä¹ åšå®¢</span></div><div class="widget-body"><a class="item" href="/2026/01/12/%E6%9D%82%E9%A1%B9%E7%AC%94%E8%AE%B0/COZE%E5%88%9D%E4%BD%93%E9%AA%8C/"><span class="title">COZEåˆä½“éªŒ</span></a><a class="item" href="/2025/12/01/Go%E5%9F%BA%E7%A1%80/Go%E5%9F%BA%E7%A1%80%E7%AC%94%E8%AE%B0/"><span class="title">GoåŸºç¡€ç¬”è®°</span></a><a class="item" href="/2025/11/13/%E9%A1%B9%E7%9B%AE%E7%AC%94%E8%AE%B0/LLM%E5%A6%82%E4%BD%95%E6%80%9D%E7%BB%B4%E5%8F%8A%E7%93%B6%E9%A2%88%E4%BD%95%E5%9C%A8/"><span class="title">LLMå¦‚ä½•è¿›è¡Œæ€ç»´?LLMçš„ç“¶é¢ˆä½•åœ¨?</span></a><a class="item" href="/2025/10/25/Java%E9%97%AE%E7%AD%94%E7%AC%94%E8%AE%B0/Elasticsearch%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/"><span class="title">Elasticsearchå­¦ä¹ ç¬”è®°-å¼€å€’æŽ’ç´¢å¼•é€šå¤©åœ°,å¸ƒåˆ†è¯å™¨ç‚¼æ–‡å­—ä¸¹</span></a><a class="item active" href="/2025/10/24/Java%E9%97%AE%E7%AD%94%E7%AC%94%E8%AE%B0/%E7%83%AD%E7%82%B9%E7%9F%A5%E8%AF%86%E7%82%B9%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/"><span class="title">ðŸ”¥çƒ­ç‚¹çŸ¥è¯†ç‚¹å­¦ä¹ ç¬”è®°-ç‚¼é‡‘ä¸¹ç†”é«˜é¢‘è€ƒç‚¹,å¸ƒå¤©ç½‘æ“’æŠ€æœ¯çƒ­ç‚¹</span><svg class="active-icon" xmlns="http://www.w3.org/2000/svg" width="32" height="32" viewBox="0 0 24 24"><path fill="currentColor" d="M21 11.098v4.993c0 3.096 0 4.645-.734 5.321c-.35.323-.792.526-1.263.58c-.987.113-2.14-.907-4.445-2.946c-1.02-.901-1.529-1.352-2.118-1.47a2.225 2.225 0 0 0-.88 0c-.59.118-1.099.569-2.118 1.47c-2.305 2.039-3.458 3.059-4.445 2.945a2.238 2.238 0 0 1-1.263-.579C3 20.736 3 19.188 3 16.091v-4.994C3 6.81 3 4.666 4.318 3.333C5.636 2 7.758 2 12 2c4.243 0 6.364 0 7.682 1.332C21 4.665 21 6.81 21 11.098" opacity=".5"/><path fill="currentColor" d="M9 5.25a.75.75 0 0 0 0 1.5h6a.75.75 0 0 0 0-1.5z"/></svg></a><a class="item" href="/2025/10/23/Java%E9%97%AE%E7%AD%94%E7%AC%94%E8%AE%B0/Java%E5%9C%BA%E6%99%AF%E8%AE%BE%E8%AE%A1%E9%A2%98%E7%9B%AE%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/"><span class="title">åœºæ™¯è®¾è®¡å­¦ä¹ ç¬”è®°-é—¯æž¶æž„å¤©å®«æ¼”è¯¸æ³•,é™éœ€æ±‚å¿ƒé­”å®šç¦…å¿ƒ</span></a><a class="item" href="/2025/10/22/Java%E9%97%AE%E7%AD%94%E7%AC%94%E8%AE%B0/Spring%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0(%E7%AC%AC%E4%BA%8C%E7%89%88)/"><span class="title">Springå­¦ä¹ ç¬”è®°(ç¬¬äºŒç‰ˆ)-ç‚¼é‡‘ä¸¹ç‚‰é“¸Beanå±± å¸ƒæ³¨è§£é˜µæŽ§è½®å›žç›˜</span></a><a class="item" href="/2025/10/18/%E9%A1%B9%E7%9B%AE%E7%AC%94%E8%AE%B0/MYDB%E9%A1%B9%E7%9B%AE%E7%AC%94%E8%AE%B0/"><span class="title">MYDBé¡¹ç›®ç¬”è®°</span></a><a class="item" href="/2025/10/17/%E9%A1%B9%E7%9B%AE%E7%AC%94%E8%AE%B0/RAG%E7%9F%A5%E8%AF%86%E5%BA%93%E9%A1%B9%E7%9B%AE%E7%AC%94%E8%AE%B0/"><span class="title">RAGçŸ¥è¯†åº“é¡¹ç›®ç¬”è®°</span></a><a class="item" href="/2025/10/13/%E7%AE%97%E6%B3%95%E7%AC%94%E8%AE%B0/SQL%E5%88%B7%E9%A2%98%E7%AC%94%E8%AE%B0/"><span class="title">SQLåˆ·é¢˜ç¬”è®°-æ‰§SQLå’’æ‰«ä¹¾å¤è¡¨,ç¥­è”åˆå½±æ“’æ•°æ®å¦–</span></a><a class="item" href="/2025/10/10/Java%E9%97%AE%E7%AD%94%E7%AC%94%E8%AE%B0/JVM%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/"><span class="title">JVMå­¦ä¹ ç¬”è®°-çª¥å†…å­˜æ´žå¤©è§‚çŽ„æœº,è°ƒGCè½®å›žæŽŒç”Ÿæ­»</span></a><a class="item" href="/2025/09/29/Java%E9%97%AE%E7%AD%94%E7%AC%94%E8%AE%B0/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/"><span class="title">è®¾è®¡æ¨¡å¼å­¦ä¹ ç¬”è®°-å¸ƒå¤©ç½¡é˜µé™éœ€æ±‚å¦–,æ¼”å˜åŒ–æœ¯ç ´ä»£ç åŠ«</span></a><a class="item" href="/2025/09/29/Java%E9%97%AE%E7%AD%94%E7%AC%94%E8%AE%B0/%E5%BE%AE%E6%9C%8D%E5%8A%A1%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/"><span class="title">å¾®æœåŠ¡å­¦ä¹ ç¬”è®°-åŒ–æ•´ä¸ºé›¶æ•£ä½œæ˜Ÿ,èšæ²™æˆå¡”æž¶äº‘å°</span></a><a class="item" href="/2025/09/29/Java%E9%97%AE%E7%AD%94%E7%AC%94%E8%AE%B0/%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/"><span class="title">æ“ä½œç³»ç»Ÿå­¦ä¹ ç¬”è®°-æŽŒè½®å›žå†…æ ¸å®šçº²å¸¸,æ¸¡è¿›ç¨‹å†…å­˜åŒ–é˜´é˜³</span></a><a class="item" href="/2025/09/29/Java%E9%97%AE%E7%AD%94%E7%AC%94%E8%AE%B0/%E5%88%86%E5%B8%83%E5%BC%8F%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/"><span class="title">åˆ†å¸ƒå¼å­¦ä¹ ç¬”è®°-æž¶å¤©ç½‘å¸ƒåˆ†å¸ƒå¼,ç‚¼é‡‘ä¸¹æ¸¡ä¸€è‡´åŠ«</span></a><a class="item" href="/2025/09/29/Java%E9%97%AE%E7%AD%94%E7%AC%94%E8%AE%B0/RocketMQ%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/"><span class="title">RocketMQå­¦ä¹ ç¬”è®°-æž¶æ¶ˆæ¯æ¡¥é€šä¸‰ç•Œè·¯ æ–½æŒä¹…å’’å®šä¹¾å¤è½®</span></a><a class="item" href="/2025/09/29/Java%E9%97%AE%E7%AD%94%E7%AC%94%E8%AE%B0/MyBatis%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/"><span class="title">MyBatiså­¦ä¹ ç¬”è®°-æž¶æ˜ å°„æ¡¥é€šäººç¥žå¢ƒ å†™SQLå’’è°ƒæ•°æ®å…µ</span></a><a class="item" href="/2025/09/29/Java%E9%97%AE%E7%AD%94%E7%AC%94%E8%AE%B0/Linux%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/"><span class="title">Linuxå­¦ä¹ ç¬”è®°-è¸ç»ˆç«¯ç™»çµéœ„æ®¿,æ‰§ç¬¦å’’é©­ä¼—ç”Ÿå™¨</span></a><a class="item" href="/2025/09/24/Java%E9%97%AE%E7%AD%94%E7%AC%94%E8%AE%B0/%E7%AE%80%E5%8E%86%E5%AF%B9%E5%BA%94%E7%9A%84%E4%B8%80%E4%BA%9B%E7%9F%A5%E8%AF%86%E7%82%B9/"><span class="title">ç®€åŽ†å¯¹åº”çŸ¥è¯†ç‚¹</span></a><a class="item" href="/2025/09/09/%E9%A1%B9%E7%9B%AE%E7%AC%94%E8%AE%B0/Elasticsearch(ES)%E4%B8%8B%E8%BD%BD%E4%BD%BF%E7%94%A8%E6%8C%87%E5%8D%97/"><span class="title">Elasticsearch(ES)ä¸‹è½½ä½¿ç”¨æŒ‡å—</span></a><a class="item" href="/2025/08/30/%E6%9D%82%E9%A1%B9%E7%AC%94%E8%AE%B0/git%E7%A7%98%E9%92%A5%E8%BF%87%E6%9C%9F%E5%A4%84%E7%90%86/"><span class="title">Rediså­¦ä¹ ç¬”è®°</span></a><a class="item" href="/2025/08/08/Java%E9%97%AE%E7%AD%94%E7%AC%94%E8%AE%B0/Java%E5%B9%B6%E5%8F%91%E7%BC%96%E7%A8%8B%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/"><span class="title">Javaå¹¶å‘ç¼–ç¨‹å­¦ä¹ ç¬”è®°-å¸ƒå¤©ç½—ç½‘é”çº¿ç¨‹å¦–,è®¾å…«å¦é˜µä¼ç«žæ€é­”</span></a><a class="item" href="/2025/08/06/3DGS/SSH%E8%BF%9C%E7%A8%8B%E8%B0%83%E7%94%A8%E5%BC%80%E5%8F%91%E7%8E%AF%E5%A2%83/"><span class="title">SSHè¿œç¨‹è°ƒç”¨å¼€å‘çŽ¯å¢ƒ</span></a><a class="item" href="/2025/08/05/3DGS/Ubuntu20%E4%BD%BF%E7%94%A8%E5%A4%9A%E4%B8%AA%E7%89%88%E6%9C%ACCUDA/"><span class="title">Ubuntu20ä½¿ç”¨å¤šä¸ªç‰ˆæœ¬CUDA</span></a><a class="item" href="/2025/08/04/%E9%A1%B9%E7%9B%AE%E7%AC%94%E8%AE%B0/Thymeleaf%E6%A8%A1%E7%89%88%E5%BC%95%E6%93%8E/"><span class="title">Thymeleafæ¨¡ç‰ˆå¼•æ“Ž</span></a><a class="item" href="/2025/08/01/Java%E9%97%AE%E7%AD%94%E7%AC%94%E8%AE%B0/Java%E9%9B%86%E5%90%88%E6%A1%86%E6%9E%B6%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/"><span class="title">Javaé›†åˆæ¡†æž¶å­¦ä¹ ç¬”è®°-å¼€ä¹¾å¤è¢‹çº³ç™¾å· å¸ƒçŽ²ç‘å±€å®šå±±æ²³</span></a><a class="item" href="/2025/07/30/%E9%A1%B9%E7%9B%AE%E7%AC%94%E8%AE%B0/Natapp/"><span class="title">Natappå†…ç½‘ç©¿é€ä½¿ç”¨</span></a><a class="item" href="/2025/07/25/%E9%A1%B9%E7%9B%AE%E7%AC%94%E8%AE%B0/%E5%BE%AE%E4%BF%A1%E6%89%AB%E7%A0%81%E7%99%BB%E5%BD%95/"><span class="title">å¾®ä¿¡æ‰«ç ç™»å½•</span></a><a class="item" href="/2025/07/25/%E7%AE%97%E6%B3%95%E7%AC%94%E8%AE%B0/%E7%81%B5%E8%8C%B6%E5%B1%B1%E7%AE%97%E6%B3%95%E5%9F%BA%E7%A1%80%E7%AC%94%E8%AE%B0/"><span class="title">çµèŒ¶å±±ç®—æ³•åŸºç¡€ç¬”è®°</span></a><a class="item" href="/2025/07/22/Java%E9%97%AE%E7%AD%94%E7%AC%94%E8%AE%B0/Redis%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/"><span class="title">Rediså­¦ä¹ ç¬”è®°-ç‡ƒå†…å­˜çœŸç«ç…§å¹½å†¥ å¸ƒé›†ç¾¤é˜µé€šä¹éœ„</span></a><a class="item" href="/2025/07/22/Java%E9%97%AE%E7%AD%94%E7%AC%94%E8%AE%B0/JavaSE%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/"><span class="title">JavaSEå­¦ä¹ ç¬”è®°-ç­‘åŸºç¯‡å¼€ä¿®è¡Œè·¯,ç‚¼æ°”å±‚ç ´è¯­æ³•éšœ</span></a><a class="item" href="/2025/07/14/%E6%9D%82%E9%A1%B9%E7%AC%94%E8%AE%B0/%E7%A8%8B%E5%BA%8F%E5%91%98%E5%85%BB%E7%94%9F%E6%8C%87%E5%8D%97/"><span class="title">ç¨‹åºå‘˜å…»ç”ŸæŒ‡å—-è°ƒé˜´é˜³æˆ’ä¹…ååŠ« é€šç»è„‰æˆ˜ä»£ç å¦–</span></a><a class="item" href="/2025/07/14/Java%E9%97%AE%E7%AD%94%E7%AC%94%E8%AE%B0/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/"><span class="title">è®¡ç®—æœºç½‘ç»œå­¦ä¹ ç¬”è®°-å¸ƒåè®®æ ˆé€šä¸‰ç•Œ,æž¶è·¯ç”±æ¡¥æ¸¡ä¸‡ç»´</span></a><a class="item" href="/2025/07/12/3DGS/%E4%BD%BF%E7%94%A8Postshot%E8%AE%AD%E7%BB%833DGS%E6%B5%81%E7%A8%8B/"><span class="title">ä½¿ç”¨Postshotè®­ç»ƒ3DGSæ¨¡åž‹æµç¨‹</span></a><a class="item" href="/2025/07/09/%E5%9F%BA%E7%A1%80%E7%AC%94%E8%AE%B0/%E8%B7%A8%E5%9F%9F%E6%94%AF%E6%8C%81%E7%AC%94%E8%AE%B0/"><span class="title">è·¨åŸŸæ”¯æŒç¬”è®°</span></a><a class="item" href="/2025/07/09/%E5%9F%BA%E7%A1%80%E7%AC%94%E8%AE%B0/MybatisPlus%E7%AC%94%E8%AE%B0/"><span class="title">MybatisPlusç¬”è®°</span></a><a class="item" href="/2025/06/25/%E9%A1%B9%E7%9B%AE%E7%AC%94%E8%AE%B0/TecHub%E9%A1%B9%E7%9B%AE%E7%AC%94%E8%AE%B0/"><span class="title">TecHubé¡¹ç›®ç¬”è®°</span></a><a class="item" href="/2025/06/24/%E9%A1%B9%E7%9B%AE%E7%AC%94%E8%AE%B0/%E6%8A%80%E6%9C%AF%E6%B4%BE%E7%8E%AF%E5%A2%83%E9%97%AE%E9%A2%98/"><span class="title">æŠ€æœ¯æ´¾é¡¹ç›®çŽ¯å¢ƒé—®é¢˜</span></a><a class="item" href="/2025/06/24/%E6%B8%B8%E6%88%8F%E5%BC%80%E5%8F%91/Unity%E5%BC%80%E5%8F%91%E7%AC%94%E8%AE%B0/"><span class="title">Unityæ¸¸æˆå¼€å‘ç¬”è®°</span></a><a class="item" href="/2025/06/21/%E7%AE%97%E6%B3%95%E7%AC%94%E8%AE%B0/%E4%B8%80%E6%AC%A1%E6%80%A7%E6%90%9E%E6%87%82B%E6%A0%91/"><span class="title">ä¸€æ¬¡æ€§æžæ‡‚Bæ ‘</span></a><a class="item" href="/2025/06/12/Java%E9%97%AE%E7%AD%94%E7%AC%94%E8%AE%B0/Spring%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/"><span class="title">Springå­¦ä¹ ç¬”è®°-å¼€IOCç“¶çº³ç™¾å·æ°´ ç»‡AOPç½‘è¦†ä¸‰ç•Œå°˜</span></a><a class="item" href="/2025/06/11/%E6%9D%82%E9%A1%B9%E7%AC%94%E8%AE%B0/nvm%E6%9B%B4%E6%94%B9node%E7%89%88%E6%9C%AC/"><span class="title">nvmæ›´æ”¹nodeç‰ˆæœ¬</span></a><a class="item" href="/2025/06/11/3DGS/3DGS%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/"><span class="title">3DGSå­¦ä¹ ç¬”è®°-æ’’ç¥žç»ç‚¹å¸ƒæ˜Ÿäº‘é˜µ ç‚¼è¾å°„åœºå¡‘é€ åŒ–èº«</span></a><a class="item" href="/2025/06/11/3DGS/3DGS-Ubuntu%E7%8E%AF%E5%A2%83/"><span class="title">3DGS-UbuntuçŽ¯å¢ƒ.md</span></a><a class="item" href="/2025/06/10/Java%E9%97%AE%E7%AD%94%E7%AC%94%E8%AE%B0/Mysql%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/"><span class="title">Mysqlå­¦ä¹ ç¬”è®°-å¸ƒB+æ ‘é˜µé”è‹é¾™ å†™SQLçœŸè¨€å¬å¤©å…µ</span></a><a class="item" href="/2025/06/10/%E5%9F%BA%E7%A1%80%E7%AC%94%E8%AE%B0/Java%E9%9B%86%E5%90%88%E6%A1%86%E6%9E%B6%E7%AC%94%E8%AE%B0/"><span class="title">Javaé›†åˆæ¡†æž¶ç¬”è®°</span></a><a class="item" href="/2025/06/09/%E5%9F%BA%E7%A1%80%E7%AC%94%E8%AE%B0/JVM%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/"><span class="title">JVMå­¦ä¹ ç¬”è®°</span></a><a class="item" href="/2025/06/07/%E5%9F%BA%E7%A1%80%E7%AC%94%E8%AE%B0/Java%E5%B9%B6%E5%8F%91%E7%AF%87/"><span class="title">Javaå¹¶å‘ç¯‡</span></a><a class="item" href="/2025/06/06/%E6%9D%82%E9%A1%B9%E7%AC%94%E8%AE%B0/%E5%B8%B8%E7%94%A8%E7%BB%84%E5%90%88%E9%94%AE%E8%AE%B0%E5%BD%95/"><span class="title">å¸¸ç”¨ç»„åˆé”®è®°å½•-ç»“å°è¯€è…¾æŒªä¸‰ç•Œ,å¼¹æŒ‡é—´å‘¼é£Žå”¤é›¨</span></a><a class="item" href="/2025/06/06/%E5%9F%BA%E7%A1%80%E7%AC%94%E8%AE%B0/java30%E5%A4%A9%E7%AC%94%E8%AE%B0/"><span class="title">java30å¤©å­¦ä¹ ç¬”è®°</span></a><a class="item" href="/2025/06/05/%E6%9D%82%E9%A1%B9%E7%AC%94%E8%AE%B0/hello-world/"><span class="title">Hello World</span></a><a class="item" href="/2025/06/04/%E9%A1%B9%E7%9B%AE%E7%AC%94%E8%AE%B0/%E6%8A%80%E6%9C%AF%E6%B4%BE%E9%A1%B9%E7%9B%AE%E7%AC%94%E8%AE%B0/"><span class="title">æŠ€æœ¯æ´¾é¡¹ç›®ç¬”è®°</span></a><a class="item" href="/2025/06/02/%E6%9D%82%E9%A1%B9%E7%AC%94%E8%AE%B0/%E4%B8%AA%E4%BA%BA%E5%8D%9A%E5%AE%A2%E6%90%AD%E5%BB%BA%E6%8C%87%E5%8D%97/"><span class="title">ä¸ªäººåšå®¢æ­å»ºæŒ‡å—-æž¶ç¥¥äº‘è‡ªå»ºè©æå¢ƒ,ç‚¹æ…§ç¯ç‹¬ç…§åšå®¢å¤©</span></a><a class="item" href="/2025/06/01/%E9%A1%B9%E7%9B%AE%E7%AC%94%E8%AE%B0/RabbitMQ%E9%A1%B9%E7%9B%AE%E4%BD%BF%E7%94%A8/"><span class="title">RabbitMQé¡¹ç›®ä½¿ç”¨</span></a><a class="item" href="/2025/06/01/%E7%AE%97%E6%B3%95%E7%AC%94%E8%AE%B0/%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84%E7%AE%97%E6%B3%95%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/"><span class="title">æ•°æ®ç»“æž„ç®—æ³•å­¦ä¹ ç¬”è®°-å¸ƒå¤©ç½¡é˜µä¼ç®—æ³•å¦– ç‚¼é‡‘çŸ³ç ´æ•°æ®ç»“æž„</span></a><a class="item" href="/2025/06/01/contact_author/"><span class="title">contact_author</span></a></div></widget>

<widget class="widget-wrapper slide-up post-list"><div class="widget-header dis-select"><span class="name">æœ€è¿‘æ›´æ–°</span></div><div class="widget-body fs14"><a class="item title" href="/2025/01/19/%E5%AD%A6%E4%B9%A0%E6%97%A5%E8%AE%B026%E5%B9%B41%E6%9C%88/2026.1.4%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/"><span class="title">2025.1.19å­¦ä¹ æ—¥è®°</span></a><a class="item title" href="/2025/10/17/%E9%A1%B9%E7%9B%AE%E7%AC%94%E8%AE%B0/RAG%E7%9F%A5%E8%AF%86%E5%BA%93%E9%A1%B9%E7%9B%AE%E7%AC%94%E8%AE%B0/"><span class="title">RAGçŸ¥è¯†åº“é¡¹ç›®ç¬”è®°</span></a><a class="item title" href="/2026/01/12/%E6%9D%82%E9%A1%B9%E7%AC%94%E8%AE%B0/COZE%E5%88%9D%E4%BD%93%E9%AA%8C/"><span class="title">COZEåˆä½“éªŒ</span></a><a class="item title" href="/2025/12/01/Go%E5%9F%BA%E7%A1%80/Go%E5%9F%BA%E7%A1%80%E7%AC%94%E8%AE%B0/"><span class="title">GoåŸºç¡€ç¬”è®°</span></a><a class="item title" href="/2025/12/16/%E5%AD%A6%E4%B9%A0%E6%97%A5%E8%AE%B025%E5%B9%B412%E6%9C%88/2025.12.22%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/"><span class="title">2025.12.22å­¦ä¹ æ—¥è®°</span></a><a class="item title" href="/2025/12/16/%E5%AD%A6%E4%B9%A0%E6%97%A5%E8%AE%B025%E5%B9%B412%E6%9C%88/2025.12.16%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/"><span class="title">2025.12.16å­¦ä¹ æ—¥è®°</span></a><a class="item title" href="/2025/12/09/%E5%AD%A6%E4%B9%A0%E6%97%A5%E8%AE%B025%E5%B9%B412%E6%9C%88/2025.12.10%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/"><span class="title">2025.12.9å­¦ä¹ æ—¥è®°</span></a><a class="item title" href="/2025/12/09/%E5%AD%A6%E4%B9%A0%E6%97%A5%E8%AE%B025%E5%B9%B412%E6%9C%88/2025.12.9%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/"><span class="title">2025.12.9å­¦ä¹ æ—¥è®°</span></a><a class="item title" href="/2025/06/06/%E6%9D%82%E9%A1%B9%E7%AC%94%E8%AE%B0/%E5%B8%B8%E7%94%A8%E7%BB%84%E5%90%88%E9%94%AE%E8%AE%B0%E5%BD%95/"><span class="title">å¸¸ç”¨ç»„åˆé”®è®°å½•-ç»“å°è¯€è…¾æŒªä¸‰ç•Œ,å¼¹æŒ‡é—´å‘¼é£Žå”¤é›¨</span></a><a class="item title" href="/2025/11/19/%E5%AD%A6%E4%B9%A0%E6%97%A5%E8%AE%B025%E5%B9%B411%E6%9C%88/2025.11.19%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/"><span class="title">2025.11.19å­¦ä¹ æ—¥è®°</span></a></div></widget>
</div>

</div></aside><div class="l_main" id="main">





<div class="article banner top">
  <div class="content">
    <div class="top bread-nav footnote"><div class="left"><div class="flex-row" id="breadcrumb"><a class="cap breadcrumb" href="/">ä¸»é¡µ</a>
<span class="sep"></span><a class="cap breadcrumb" id="menu" href="/topic">ä¸“æ </a><span class="sep"></span><a class="cap breadcrumb" id="proj" href="/2026/01/12/%E6%9D%82%E9%A1%B9%E7%AC%94%E8%AE%B0/COZE%E5%88%9D%E4%BD%93%E9%AA%8C/">å­¦ä¹ åšå®¢</a></div>
<div class="flex-row" id="post-meta"><span class="text created">å‘å¸ƒäºŽï¼š<time datetime="2025-10-23T16:00:00.000Z">2025-10-24</time></span><span class="sep updated"></span><span class="text updated">æ›´æ–°äºŽï¼š<time datetime="2025-10-28T10:45:45.426Z">2025-10-28</time></span></div></div></div>
    
    <div class="bottom only-title">
      
      <div class="text-area">
        <h1 class="text title"><span>ðŸ”¥çƒ­ç‚¹çŸ¥è¯†ç‚¹å­¦ä¹ ç¬”è®°-ç‚¼é‡‘ä¸¹ç†”é«˜é¢‘è€ƒç‚¹,å¸ƒå¤©ç½‘æ“’æŠ€æœ¯çƒ­ç‚¹</span></h1>
        
      </div>
    </div>
    
  </div>
  </div><article class="md-text content slide-up"><h2 id="JavaSE"><a href="#JavaSE" class="headerlink" title="JavaSE"></a>JavaSE</h2><h3 id="1-ðŸŒŸä»€ä¹ˆæ˜¯-Javaï¼Ÿ"><a href="#1-ðŸŒŸä»€ä¹ˆæ˜¯-Javaï¼Ÿ" class="headerlink" title="1.ðŸŒŸä»€ä¹ˆæ˜¯ Javaï¼Ÿ"></a>1.ðŸŒŸä»€ä¹ˆæ˜¯ Javaï¼Ÿ</h3><p>Java æ˜¯ä¸€é—¨é¢å‘å¯¹è±¡çš„ç¼–ç¨‹è¯­è¨€ï¼Œç”± Sun å…¬å¸çš„è©¹å§†æ–¯Â·é«˜æ–¯æž—å›¢é˜ŸäºŽ 1995 å¹´æŽ¨å‡ºã€‚å¸æ”¶äº† C++ è¯­è¨€ä¸­å¤§é‡çš„ä¼˜ç‚¹ï¼Œä½†åˆæŠ›å¼ƒäº† C++ ä¸­å®¹æ˜“å‡ºé”™çš„åœ°æ–¹ï¼Œå¦‚åžƒåœ¾å›žæ”¶ã€æŒ‡é’ˆã€‚</p>
<p>åŒæ—¶ï¼ŒJava åˆæ˜¯ä¸€é—¨å¹³å°æ— å…³çš„ç¼–ç¨‹è¯­è¨€ï¼Œå³ä¸€æ¬¡ç¼–è¯‘ï¼Œå¤„å¤„è¿è¡Œã€‚</p>
<p>åªéœ€è¦åœ¨å¯¹åº”çš„å¹³å°ä¸Šå®‰è£… JDKï¼Œå°±å¯ä»¥å®žçŽ°è·¨å¹³å°ï¼Œåœ¨ Windowsã€macOSã€Linux æ“ä½œç³»ç»Ÿä¸Šè¿è¡Œã€‚</p>
<h4 id="Java-è¯­è¨€å’Œ-C-è¯­è¨€æœ‰å“ªäº›åŒºåˆ«ï¼Ÿ"><a href="#Java-è¯­è¨€å’Œ-C-è¯­è¨€æœ‰å“ªäº›åŒºåˆ«ï¼Ÿ" class="headerlink" title="Java è¯­è¨€å’Œ C è¯­è¨€æœ‰å“ªäº›åŒºåˆ«ï¼Ÿ"></a>Java è¯­è¨€å’Œ C è¯­è¨€æœ‰å“ªäº›åŒºåˆ«ï¼Ÿ</h4><p>Java æ˜¯ä¸€ç§<strong>è·¨å¹³å°çš„ç¼–ç¨‹è¯­è¨€</strong>ï¼Œé€šè¿‡åœ¨ä¸åŒæ“ä½œç³»ç»Ÿä¸Šå®‰è£…å¯¹åº”ç‰ˆæœ¬çš„ JVM ä»¥å®žçŽ°â€œä¸€æ¬¡ç¼–è¯‘ï¼Œå¤„å¤„è¿è¡Œâ€çš„ç›®çš„ã€‚è€Œ C è¯­è¨€éœ€è¦åœ¨ä¸åŒçš„æ“ä½œç³»ç»Ÿä¸Šé‡æ–°ç¼–è¯‘ã€‚</p>
<p>Java å®žçŽ°äº†<strong>å†…å­˜çš„è‡ªåŠ¨ç®¡ç†</strong>ï¼Œè€Œ C è¯­è¨€éœ€è¦ä½¿ç”¨ malloc å’Œ free æ¥æ‰‹åŠ¨ç®¡ç†å†…å­˜ã€‚</p>
<h3 id="7-ðŸŒŸJava-æœ‰å“ªäº›æ•°æ®ç±»åž‹ï¼Ÿ"><a href="#7-ðŸŒŸJava-æœ‰å“ªäº›æ•°æ®ç±»åž‹ï¼Ÿ" class="headerlink" title="7.ðŸŒŸJava æœ‰å“ªäº›æ•°æ®ç±»åž‹ï¼Ÿ"></a>7.ðŸŒŸJava æœ‰å“ªäº›æ•°æ®ç±»åž‹ï¼Ÿ</h3><p>Java çš„æ•°æ®ç±»åž‹å¯ä»¥åˆ†ä¸ºä¸¤ç§ï¼š<code>åŸºæœ¬æ•°æ®ç±»åž‹</code>å’Œ<code>å¼•ç”¨æ•°æ®ç±»åž‹</code>ã€‚</p>
<p><img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="https://cdn.jsdelivr.net/gh/JakicDong/blog-assets@main/images/20250722101015.png" alt="20250722101015"></p>
<p>åŸºæœ¬æ•°æ®ç±»åž‹æœ‰ï¼š<br>â‘ ã€æ•°å€¼åž‹</p>
<ul>
<li>æ•´æ•°ç±»åž‹ï¼ˆbyteã€shortã€intã€longï¼‰</li>
<li>æµ®ç‚¹ç±»åž‹ï¼ˆfloatã€doubleï¼‰</li>
</ul>
<p>â‘¡ã€å­—ç¬¦åž‹ï¼ˆcharï¼‰<br>â‘¢ã€å¸ƒå°”åž‹ï¼ˆbooleanï¼‰<br>å®ƒä»¬çš„é»˜è®¤å€¼å’Œå ç”¨å¤§å°å¦‚ä¸‹æ‰€ç¤ºï¼š</p>
<p><img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="https://cdn.jsdelivr.net/gh/JakicDong/blog-assets@main/images/20250722101058.png" alt="20250722101058"></p>
<p>å¼•ç”¨æ•°æ®ç±»åž‹æœ‰ï¼š</p>
<ul>
<li><a target="_blank" rel="noopener" href="https://javabetter.cn/oo/object-class.html">ç±»</a>ï¼ˆclassï¼‰</li>
<li><a target="_blank" rel="noopener" href="https://javabetter.cn/oo/interface.html">æŽ¥å£</a>ï¼ˆinterfaceï¼‰</li>
<li><a target="_blank" rel="noopener" href="https://javabetter.cn/array/array.html">æ•°ç»„</a>ï¼ˆ<code>[]</code>ï¼‰</li>
</ul>
<h4 id="boolean-ç±»åž‹å®žé™…å ç”¨å‡ ä¸ªå­—èŠ‚ï¼Ÿ"><a href="#boolean-ç±»åž‹å®žé™…å ç”¨å‡ ä¸ªå­—èŠ‚ï¼Ÿ" class="headerlink" title="boolean ç±»åž‹å®žé™…å ç”¨å‡ ä¸ªå­—èŠ‚ï¼Ÿ"></a>boolean ç±»åž‹å®žé™…å ç”¨å‡ ä¸ªå­—èŠ‚ï¼Ÿ</h4><p>æŽ¨èé˜…è¯»ï¼š<a target="_blank" rel="noopener" href="https://javabetter.cn/basic-grammar/basic-data-type.html">Java è¿›é˜¶ä¹‹è·¯ï¼šåŸºæœ¬æ•°æ®ç±»åž‹ç¯‡</a></p>
<p>è¿™è¦ä¾æ®å…·ä½“çš„ JVM å®žçŽ°ç»†èŠ‚ã€‚Java è™šæ‹Ÿæœºè§„èŒƒä¸­ï¼Œå¹¶æ²¡æœ‰æ˜Žç¡®è§„å®š boolean ç±»åž‹çš„å¤§å°ï¼Œåªè§„å®šäº† boolean ç±»åž‹çš„å–å€¼ true æˆ– falseã€‚</p>
<blockquote>
<p>boolean: The boolean data type has only two possible values: true and false. Use this data type for simple flags that track true&#x2F;false conditions. This data type represents one bit of information, but its â€œsizeâ€ isnâ€™t something thatâ€™s precisely defined.</p>
</blockquote>
<p>æˆ‘æœ¬æœºçš„ 64 ä½ JDK ä¸­ï¼Œé€šè¿‡ JOL å·¥å…·æŸ¥çœ‹å•ç‹¬çš„ boolean ç±»åž‹ï¼Œä»¥åŠ boolean æ•°ç»„ï¼Œæ‰€å ç”¨çš„ç©ºé—´éƒ½æ˜¯ 1 ä¸ªå­—èŠ‚ã€‚</p>
<h4 id="ç»™Integeræœ€å¤§å€¼-1ï¼Œæ˜¯ä»€ä¹ˆç»“æžœï¼Ÿ"><a href="#ç»™Integeræœ€å¤§å€¼-1ï¼Œæ˜¯ä»€ä¹ˆç»“æžœï¼Ÿ" class="headerlink" title="ç»™Integeræœ€å¤§å€¼+1ï¼Œæ˜¯ä»€ä¹ˆç»“æžœï¼Ÿ"></a>ç»™Integeræœ€å¤§å€¼+1ï¼Œæ˜¯ä»€ä¹ˆç»“æžœï¼Ÿ</h4><p>å½“ç»™ <code>Integer.MAX_VALUE</code> åŠ  1 æ—¶ï¼Œä¼šå‘ç”Ÿæº¢å‡ºï¼Œå˜æˆ <code>Integer.MIN_VALUE</code>ã€‚</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">int</span> <span class="variable">maxValue</span> <span class="operator">=</span> Integer.MAX_VALUE;</span><br><span class="line">System.out.println(<span class="string">&quot;Integer.MAX_VALUE = &quot;</span> + maxValue); <span class="comment">// Integer.MAX_VALUE = 2147483647</span></span><br><span class="line">System.out.println(<span class="string">&quot;Integer.MAX_VALUE + 1 = &quot;</span> + (maxValue + <span class="number">1</span>)); <span class="comment">// Integer.MAX_VALUE + 1 = -2147483648</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// ç”¨äºŒè¿›åˆ¶æ¥è¡¨ç¤ºæœ€å¤§å€¼å’Œæœ€å°å€¼</span></span><br><span class="line">System.out.println(<span class="string">&quot;Integer.MAX_VALUE in binary: &quot;</span> + Integer.toBinaryString(maxValue)); <span class="comment">// Integer.MAX_VALUE in binary: 1111111111111111111111111111111</span></span><br><span class="line">System.out.println(<span class="string">&quot;Integer.MIN_VALUE in binary: &quot;</span> + Integer.toBinaryString(Integer.MIN_VALUE)); <span class="comment">// Integer.MIN_VALUE in binary: 10000000000000000000000000000000</span></span><br></pre></td></tr></table></figure>
<p>è¿™æ˜¯å› ä¸º Java çš„æ•´æ•°ç±»åž‹é‡‡ç”¨çš„æ˜¯<code>äºŒè¿›åˆ¶è¡¥ç è¡¨ç¤ºæ³•</code>ï¼Œ<strong>æº¢å‡ºæ—¶å€¼ä¼šå˜æˆæœ€å°å€¼</strong>ã€‚</p>
<ul>
<li><code>Integer.MAX_VALUE </code>çš„äºŒè¿›åˆ¶è¡¨ç¤ºæ˜¯ <code>01111111 11111111 11111111 11111111</code>ï¼ˆ32 ä½ï¼‰ã€‚</li>
<li>åŠ  1 åŽç»“æžœå˜æˆ <code>10000000 00000000 00000000 00000000</code>ï¼Œå³ -2147483648ï¼ˆInteger.MIN_VALUEï¼‰ã€‚</li>
</ul>
<h3 id="18-ðŸŒŸé¢å‘å¯¹è±¡ç¼–ç¨‹æœ‰å“ªäº›ç‰¹æ€§ï¼Ÿ"><a href="#18-ðŸŒŸé¢å‘å¯¹è±¡ç¼–ç¨‹æœ‰å“ªäº›ç‰¹æ€§ï¼Ÿ" class="headerlink" title="18.ðŸŒŸé¢å‘å¯¹è±¡ç¼–ç¨‹æœ‰å“ªäº›ç‰¹æ€§ï¼Ÿ"></a>18.ðŸŒŸé¢å‘å¯¹è±¡ç¼–ç¨‹æœ‰å“ªäº›ç‰¹æ€§ï¼Ÿ</h3><p>æŽ¨èé˜…è¯»ï¼šæ·±å…¥ç†è§£ Java ä¸‰å¤§ç‰¹æ€§</p>
<p>é¢å‘å¯¹è±¡ç¼–ç¨‹æœ‰ä¸‰å¤§ç‰¹æ€§ï¼šå°è£…ã€ç»§æ‰¿ã€å¤šæ€ã€‚</p>
<p><img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="https://cdn.jsdelivr.net/gh/JakicDong/blog-assets@main/images/20250723102452.png" alt="20250723102452"></p>
<h4 id="å°è£…æ˜¯ä»€ä¹ˆï¼Ÿ"><a href="#å°è£…æ˜¯ä»€ä¹ˆï¼Ÿ" class="headerlink" title="å°è£…æ˜¯ä»€ä¹ˆï¼Ÿ"></a>å°è£…æ˜¯ä»€ä¹ˆï¼Ÿ</h4><p>å°è£…æ˜¯æŒ‡å°†æ•°æ®ï¼ˆå±žæ€§ï¼Œæˆ–è€…å«å­—æ®µï¼‰å’Œæ“ä½œæ•°æ®çš„æ–¹æ³•ï¼ˆè¡Œä¸ºï¼‰æ†ç»‘åœ¨ä¸€èµ·ï¼Œå½¢æˆä¸€ä¸ªç‹¬ç«‹çš„å¯¹è±¡ï¼ˆç±»çš„å®žä¾‹ï¼‰ã€‚</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Nvshen</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> String name;</span><br><span class="line">    <span class="keyword">private</span> <span class="type">int</span> age;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setName</span><span class="params">(String name)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.name = name;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">getName</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> name;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setAge</span><span class="params">(<span class="type">int</span> age)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.age = age;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>å¯ä»¥çœ‹å¾—å‡ºï¼Œå¥³ç¥žç±»å¯¹å¤–æ²¡æœ‰æä¾› <code>age</code> çš„ <code>getter</code> æ–¹æ³•ï¼Œå› ä¸ºå¥³ç¥žçš„å¹´é¾„è¦ä¿å¯†ã€‚</p>
<p>æ‰€ä»¥ï¼Œå°è£…æ˜¯æŠŠä¸€ä¸ªå¯¹è±¡çš„å±žæ€§ç§æœ‰åŒ–ï¼ŒåŒæ—¶æä¾›ä¸€äº›å¯ä»¥è¢«å¤–ç•Œè®¿é—®çš„æ–¹æ³•ã€‚</p>
<h4 id="ç»§æ‰¿æ˜¯ä»€ä¹ˆï¼Ÿ"><a href="#ç»§æ‰¿æ˜¯ä»€ä¹ˆï¼Ÿ" class="headerlink" title="ç»§æ‰¿æ˜¯ä»€ä¹ˆï¼Ÿ"></a>ç»§æ‰¿æ˜¯ä»€ä¹ˆï¼Ÿ</h4><p>ç»§æ‰¿å…è®¸ä¸€ä¸ªç±»ï¼ˆå­ç±»ï¼‰ç»§æ‰¿çŽ°æœ‰ç±»ï¼ˆçˆ¶ç±»æˆ–è€…åŸºç±»ï¼‰çš„å±žæ€§å’Œæ–¹æ³•ã€‚ä»¥æé«˜ä»£ç çš„å¤ç”¨æ€§ï¼Œ<strong>å»ºç«‹ç±»ä¹‹é—´çš„å±‚æ¬¡å…³ç³»</strong>ã€‚</p>
<p>åŒæ—¶ï¼Œå­ç±»è¿˜å¯ä»¥<strong>é‡å†™æˆ–è€…æ‰©å±•</strong>ä»Žçˆ¶ç±»ç»§æ‰¿æ¥çš„å±žæ€§å’Œæ–¹æ³•ï¼Œä»Žè€Œå®žçŽ°å¤šæ€ã€‚</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Person</span> &#123;</span><br><span class="line">    <span class="keyword">protected</span> String name;</span><br><span class="line">    <span class="keyword">protected</span> <span class="type">int</span> age;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">eat</span><span class="params">()</span> &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;åƒé¥­&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Student</span> <span class="keyword">extends</span> <span class="title class_">Person</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> String school;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">study</span><span class="params">()</span> &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;å­¦ä¹ &quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>Student ç±»ç»§æ‰¿äº† Person ç±»çš„å±žæ€§ï¼ˆnameã€ageï¼‰å’Œæ–¹æ³•ï¼ˆeatï¼‰ï¼ŒåŒæ—¶è¿˜æœ‰è‡ªå·±çš„å±žæ€§ï¼ˆschoolï¼‰å’Œæ–¹æ³•ï¼ˆstudyï¼‰ã€‚</p>
<h4 id="ä»€ä¹ˆæ˜¯å¤šæ€ï¼Ÿ"><a href="#ä»€ä¹ˆæ˜¯å¤šæ€ï¼Ÿ" class="headerlink" title="ä»€ä¹ˆæ˜¯å¤šæ€ï¼Ÿ"></a>ä»€ä¹ˆæ˜¯å¤šæ€ï¼Ÿ</h4><p>å¤šæ€å…è®¸ä¸åŒç±»çš„å¯¹è±¡<strong>å¯¹åŒä¸€æ¶ˆæ¯åšå‡ºå“åº”ï¼Œä½†è¡¨çŽ°å‡ºä¸åŒçš„è¡Œä¸º</strong>ï¼ˆå³<strong>æ–¹æ³•çš„å¤šæ ·æ€§</strong>ï¼‰ã€‚</p>
<p>å¤šæ€å…¶å®žæ˜¯ä¸€ç§èƒ½åŠ›â€”â€”åŒä¸€ä¸ªè¡Œä¸ºå…·æœ‰ä¸åŒçš„è¡¨çŽ°å½¢å¼ï¼›æ¢å¥è¯è¯´å°±æ˜¯ï¼Œæ‰§è¡Œä¸€æ®µä»£ç ï¼ŒJava åœ¨è¿è¡Œæ—¶èƒ½æ ¹æ®å¯¹è±¡ç±»åž‹çš„ä¸åŒäº§ç”Ÿä¸åŒçš„ç»“æžœã€‚</p>
<p>å¤šæ€çš„å‰ç½®æ¡ä»¶æœ‰ä¸‰ä¸ªï¼š</p>
<ul>
<li>å­ç±»<strong>ç»§æ‰¿</strong>çˆ¶ç±»</li>
<li>å­ç±»<strong>é‡å†™</strong>çˆ¶ç±»çš„æ–¹æ³•</li>
<li><strong>çˆ¶ç±»å¼•ç”¨æŒ‡å‘å­ç±»</strong>çš„å¯¹è±¡</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="comment">//å­ç±»ç»§æ‰¿çˆ¶ç±»</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Wangxiaoer</span> <span class="keyword">extends</span> <span class="title class_">Wanger</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">write</span><span class="params">()</span> &#123; <span class="comment">// å­ç±»é‡å†™çˆ¶ç±»æ–¹æ³•</span></span><br><span class="line">        System.out.println(<span class="string">&quot;è®°ä½ä»‡æ¨ï¼Œè¡¨æ˜Žæˆ‘ä»¬è¦å¥‹å‘å›¾å¼ºçš„å¿ƒæ™º&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        <span class="comment">// çˆ¶ç±»å¼•ç”¨æŒ‡å‘å­ç±»å¯¹è±¡</span></span><br><span class="line">        <span class="type">Wanger</span> <span class="variable">wanger</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Wangxiaoer</span>();</span><br><span class="line">        wanger.write();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Wanger</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">write</span><span class="params">()</span> &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;çŽ‹äºŒæ˜¯æ²™é›•&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="ä¸ºä»€ä¹ˆJavaé‡Œé¢è¦å¤šç»„åˆå°‘ç»§æ‰¿ï¼Ÿ"><a href="#ä¸ºä»€ä¹ˆJavaé‡Œé¢è¦å¤šç»„åˆå°‘ç»§æ‰¿ï¼Ÿ" class="headerlink" title="ä¸ºä»€ä¹ˆJavaé‡Œé¢è¦å¤šç»„åˆå°‘ç»§æ‰¿ï¼Ÿ"></a>ä¸ºä»€ä¹ˆJavaé‡Œé¢è¦å¤šç»„åˆå°‘ç»§æ‰¿ï¼Ÿ</h4><p><strong>ç»§æ‰¿é€‚åˆæè¿°â€œis-aâ€çš„å…³ç³»</strong>ï¼Œä½†ç»§æ‰¿å®¹æ˜“å¯¼è‡´ç±»ä¹‹é—´çš„å¼ºè€¦åˆï¼Œä¸€æ—¦çˆ¶ç±»å‘ç”Ÿæ”¹å˜ï¼Œå­ç±»ä¹Ÿè¦éšä¹‹æ”¹å˜ï¼Œè¿èƒŒäº†å¼€é—­åŽŸåˆ™ï¼ˆå°½é‡ä¸ä¿®æ”¹çŽ°æœ‰ä»£ç ï¼Œè€Œæ˜¯æ·»åŠ æ–°çš„ä»£ç æ¥å®žçŽ°ï¼‰ã€‚</p>
<p><strong>ç»„åˆé€‚åˆæè¿°â€œhas-aâ€æˆ–â€œcan-doâ€çš„å…³ç³»</strong>ï¼Œé€šè¿‡åœ¨ç±»ä¸­ç»„åˆå…¶ä»–ç±»ï¼Œèƒ½å¤Ÿæ›´çµæ´»åœ°æ‰©å±•åŠŸèƒ½ã€‚ç»„åˆé¿å…äº†å¤æ‚çš„ç±»ç»§æ‰¿ä½“ç³»ï¼ŒåŒæ—¶éµå¾ªäº†<strong>å¼€é—­åŽŸåˆ™å’Œæ¾è€¦åˆçš„è®¾è®¡åŽŸåˆ™ã€‚</strong></p>
<p>ä¸¾ä¸ªä¾‹å­ï¼Œå‡è®¾æˆ‘ä»¬é‡‡ç”¨ç»§æ‰¿ï¼Œæ¯ç§å½¢çŠ¶å’Œæ ·å¼çš„ç»„åˆéƒ½ä¼š<strong>å¯¼è‡´ç±»çš„æ€¥å‰§å¢žåŠ </strong>ï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// åŸºç±»</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Shape</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">draw</span><span class="params">()</span> &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;Drawing a shape&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// åœ†å½¢</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Circle</span> <span class="keyword">extends</span> <span class="title class_">Shape</span> &#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">draw</span><span class="params">()</span> &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;Drawing a circle&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// å¸¦çº¢è‰²çš„åœ†å½¢</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">RedCircle</span> <span class="keyword">extends</span> <span class="title class_">Circle</span> &#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">draw</span><span class="params">()</span> &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;Drawing a red circle&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// å¸¦ç»¿è‰²çš„åœ†å½¢</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">GreenCircle</span> <span class="keyword">extends</span> <span class="title class_">Circle</span> &#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">draw</span><span class="params">()</span> &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;Drawing a green circle&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// ç±»ä¼¼çš„ï¼Œå¯¹äºŽçŸ©å½¢ä¹Ÿè¦åˆ›å»ºå¤šä¸ªç±»</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Rectangle</span> <span class="keyword">extends</span> <span class="title class_">Shape</span> &#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">draw</span><span class="params">()</span> &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;Drawing a rectangle&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">RedRectangle</span> <span class="keyword">extends</span> <span class="title class_">Rectangle</span> &#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">draw</span><span class="params">()</span> &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;Drawing a red rectangle&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>ç»„åˆæ¨¡å¼</strong>æ›´åŠ çµæ´»ï¼Œå¯ä»¥å°†å½¢çŠ¶å’Œé¢œè‰²åˆ†å¼€ï¼Œæ¾è€¦åˆã€‚</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// å½¢çŠ¶æŽ¥å£</span></span><br><span class="line"><span class="keyword">interface</span> <span class="title class_">Shape</span> &#123;</span><br><span class="line">    <span class="keyword">void</span> <span class="title function_">draw</span><span class="params">()</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// é¢œè‰²æŽ¥å£</span></span><br><span class="line"><span class="keyword">interface</span> <span class="title class_">Color</span> &#123;</span><br><span class="line">    <span class="keyword">void</span> <span class="title function_">applyColor</span><span class="params">()</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>å½¢çŠ¶å¹²å½¢çŠ¶çš„äº‹æƒ…ã€‚</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// åœ†å½¢çš„å®žçŽ°</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Circle</span> <span class="keyword">implements</span> <span class="title class_">Shape</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> Color color;  <span class="comment">// é€šè¿‡ç»„åˆçš„æ–¹å¼æŒæœ‰é¢œè‰²å¯¹è±¡</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">Circle</span><span class="params">(Color color)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.color = color;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">draw</span><span class="params">()</span> &#123;</span><br><span class="line">        System.out.print(<span class="string">&quot;Drawing a circle with &quot;</span>);</span><br><span class="line">        color.applyColor();  <span class="comment">// è°ƒç”¨é¢œè‰²çš„é€»è¾‘</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// çŸ©å½¢çš„å®žçŽ°</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Rectangle</span> <span class="keyword">implements</span> <span class="title class_">Shape</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> Color color;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">Rectangle</span><span class="params">(Color color)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.color = color;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">draw</span><span class="params">()</span> &#123;</span><br><span class="line">        System.out.print(<span class="string">&quot;Drawing a rectangle with &quot;</span>);</span><br><span class="line">        color.applyColor();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>é¢œè‰²å¹²é¢œè‰²çš„äº‹æƒ…ã€‚</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// çº¢è‰²çš„å®žçŽ°</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">RedColor</span> <span class="keyword">implements</span> <span class="title class_">Color</span> &#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">applyColor</span><span class="params">()</span> &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;red color&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// ç»¿è‰²çš„å®žçŽ°</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">GreenColor</span> <span class="keyword">implements</span> <span class="title class_">Color</span> &#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">applyColor</span><span class="params">()</span> &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;green color&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>


<h3 id="23-ðŸŒŸæŠ½è±¡ç±»å’ŒæŽ¥å£æœ‰ä»€ä¹ˆåŒºåˆ«ï¼Ÿ"><a href="#23-ðŸŒŸæŠ½è±¡ç±»å’ŒæŽ¥å£æœ‰ä»€ä¹ˆåŒºåˆ«ï¼Ÿ" class="headerlink" title="23.ðŸŒŸæŠ½è±¡ç±»å’ŒæŽ¥å£æœ‰ä»€ä¹ˆåŒºåˆ«ï¼Ÿ"></a>23.ðŸŒŸæŠ½è±¡ç±»å’ŒæŽ¥å£æœ‰ä»€ä¹ˆåŒºåˆ«ï¼Ÿ</h3><p><strong>ä¸€ä¸ªç±»åªèƒ½ç»§æ‰¿ä¸€ä¸ªæŠ½è±¡ç±»</strong>ï¼›<strong>ä½†ä¸€ä¸ªç±»å¯ä»¥å®žçŽ°å¤šä¸ªæŽ¥å£</strong>ã€‚æ‰€ä»¥æˆ‘ä»¬åœ¨æ–°å»ºçº¿ç¨‹ç±»çš„æ—¶å€™ä¸€èˆ¬æŽ¨èä½¿ç”¨å®žçŽ° <code>Runnable</code> æŽ¥å£çš„æ–¹å¼ï¼Œè¿™æ ·çº¿ç¨‹ç±»è¿˜å¯ä»¥ç»§æ‰¿å…¶ä»–ç±»ï¼Œè€Œä¸å•å•æ˜¯ <code>Thread</code> ç±»ã€‚</p>
<p><strong>æŠ½è±¡ç±»</strong>ç¬¦åˆ <code>is-a</code> çš„å…³ç³»ï¼Œè€Œ<strong>æŽ¥å£</strong>æ›´åƒæ˜¯ <code>has-a</code> çš„å…³ç³»ï¼Œæ¯”å¦‚è¯´ä¸€ä¸ªç±»å¯ä»¥åºåˆ—åŒ–çš„æ—¶å€™ï¼Œå®ƒåªéœ€è¦å®žçŽ° <code>Serializable</code> æŽ¥å£å°±å¯ä»¥äº†ï¼Œä¸éœ€è¦åŽ»ç»§æ‰¿ä¸€ä¸ªåºåˆ—åŒ–ç±»ã€‚</p>
<p>æŠ½è±¡ç±»æ›´å¤šåœ°æ˜¯ç”¨æ¥ä¸ºå¤šä¸ªç›¸å…³çš„ç±»<strong>æä¾›ä¸€ä¸ªå…±åŒçš„åŸºç¡€æ¡†æž¶</strong>ï¼ŒåŒ…æ‹¬çŠ¶æ€çš„åˆå§‹åŒ–ï¼Œè€ŒæŽ¥å£åˆ™æ˜¯<strong>å®šä¹‰ä¸€å¥—è¡Œä¸ºæ ‡å‡†</strong>ï¼Œè®©ä¸åŒçš„ç±»å¯ä»¥å®žçŽ°åŒä¸€æŽ¥å£ï¼Œæä¾›è¡Œä¸ºçš„å¤šæ ·åŒ–å®žçŽ°ã€‚</p>
<h4 id="æŠ½è±¡ç±»å¯ä»¥å®šä¹‰æž„é€ æ–¹æ³•å—ï¼Ÿ"><a href="#æŠ½è±¡ç±»å¯ä»¥å®šä¹‰æž„é€ æ–¹æ³•å—ï¼Ÿ" class="headerlink" title="æŠ½è±¡ç±»å¯ä»¥å®šä¹‰æž„é€ æ–¹æ³•å—ï¼Ÿ"></a>æŠ½è±¡ç±»å¯ä»¥å®šä¹‰æž„é€ æ–¹æ³•å—ï¼Ÿ</h4><p>å¯ä»¥ï¼ŒæŠ½è±¡ç±»å¯ä»¥æœ‰æž„é€ æ–¹æ³•ã€‚</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">abstract</span> <span class="keyword">class</span> <span class="title class_">Animal</span> &#123;</span><br><span class="line">    <span class="keyword">protected</span> String name;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">Animal</span><span class="params">(String name)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.name = name;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">abstract</span> <span class="keyword">void</span> <span class="title function_">makeSound</span><span class="params">()</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Dog</span> <span class="keyword">extends</span> <span class="title class_">Animal</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="type">int</span> age;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">Dog</span><span class="params">(String name, <span class="type">int</span> age)</span> &#123;</span><br><span class="line">        <span class="built_in">super</span>(name);  <span class="comment">// è°ƒç”¨æŠ½è±¡ç±»çš„æž„é€ å‡½æ•°</span></span><br><span class="line">        <span class="built_in">this</span>.age = age;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">makeSound</span><span class="params">()</span> &#123;</span><br><span class="line">        System.out.println(name + <span class="string">&quot; says: Bark&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="æŽ¥å£å¯ä»¥å®šä¹‰æž„é€ æ–¹æ³•å—ï¼Ÿ"><a href="#æŽ¥å£å¯ä»¥å®šä¹‰æž„é€ æ–¹æ³•å—ï¼Ÿ" class="headerlink" title="æŽ¥å£å¯ä»¥å®šä¹‰æž„é€ æ–¹æ³•å—ï¼Ÿ"></a>æŽ¥å£å¯ä»¥å®šä¹‰æž„é€ æ–¹æ³•å—ï¼Ÿ</h4><p>ä¸èƒ½ï¼ŒæŽ¥å£ä¸»è¦ç”¨äºŽå®šä¹‰ä¸€ç»„æ–¹æ³•è§„èŒƒï¼Œ<strong>æ²¡æœ‰å…·ä½“çš„å®žçŽ°ç»†èŠ‚</strong>ã€‚</p>
<p><img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="https://cdn.jsdelivr.net/gh/JakicDong/blog-assets@main/images/20250723111427.png" alt="20250723111427"></p>
<h4 id="Javaæ”¯æŒå¤šç»§æ‰¿å—ï¼Ÿ"><a href="#Javaæ”¯æŒå¤šç»§æ‰¿å—ï¼Ÿ" class="headerlink" title="Javaæ”¯æŒå¤šç»§æ‰¿å—ï¼Ÿ"></a>Javaæ”¯æŒå¤šç»§æ‰¿å—ï¼Ÿ</h4><p>Java ä¸æ”¯æŒå¤šç»§æ‰¿ï¼Œä¸€ä¸ªç±»åªèƒ½ç»§æ‰¿ä¸€ä¸ªç±»ï¼Œå¤šç»§æ‰¿ä¼šå¼•å‘è±å½¢ç»§æ‰¿é—®é¢˜ã€‚</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">A</span> &#123;</span><br><span class="line">    <span class="keyword">void</span> <span class="title function_">show</span><span class="params">()</span> &#123; System.out.println(<span class="string">&quot;A&quot;</span>); &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">B</span> <span class="keyword">extends</span> <span class="title class_">A</span> &#123;</span><br><span class="line">     <span class="keyword">void</span> <span class="title function_">show</span><span class="params">()</span> &#123; System.out.println(<span class="string">&quot;B&quot;</span>); &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">C</span> <span class="keyword">extends</span> <span class="title class_">A</span> &#123;</span><br><span class="line">    <span class="keyword">void</span> <span class="title function_">show</span><span class="params">()</span> &#123; System.out.println(<span class="string">&quot;C&quot;</span>); &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// å¦‚æžœ Java æ”¯æŒå¤šç»§æ‰¿</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">D</span> <span class="keyword">extends</span> <span class="title class_">B</span>, C &#123;</span><br><span class="line">    <span class="comment">// è°ƒç”¨ show() æ–¹æ³•æ—¶ï¼ŒD åº”è¯¥è°ƒç”¨ B çš„ show() è¿˜æ˜¯ C çš„ show()ï¼Ÿ</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="æŽ¥å£å¯ä»¥å¤šç»§æ‰¿å—ï¼Ÿ"><a href="#æŽ¥å£å¯ä»¥å¤šç»§æ‰¿å—ï¼Ÿ" class="headerlink" title="æŽ¥å£å¯ä»¥å¤šç»§æ‰¿å—ï¼Ÿ"></a>æŽ¥å£å¯ä»¥å¤šç»§æ‰¿å—ï¼Ÿ</h4><p><strong>æŽ¥å£å¯ä»¥å¤šç»§æ‰¿ï¼Œä¸€ä¸ªæŽ¥å£å¯ä»¥ç»§æ‰¿å¤šä¸ªæŽ¥å£ï¼Œä½¿ç”¨é€—å·åˆ†éš”</strong>ã€‚</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">interface</span> <span class="title class_">InterfaceA</span> &#123;</span><br><span class="line">    <span class="keyword">void</span> <span class="title function_">methodA</span><span class="params">()</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">interface</span> <span class="title class_">InterfaceB</span> &#123;</span><br><span class="line">    <span class="keyword">void</span> <span class="title function_">methodB</span><span class="params">()</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">interface</span> <span class="title class_">InterfaceC</span> <span class="keyword">extends</span> <span class="title class_">InterfaceA</span>, InterfaceB &#123;</span><br><span class="line">    <span class="keyword">void</span> <span class="title function_">methodC</span><span class="params">()</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">MyClass</span> <span class="keyword">implements</span> <span class="title class_">InterfaceC</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">methodA</span><span class="params">()</span> &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;Method A&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">methodB</span><span class="params">()</span> &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;Method B&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">methodC</span><span class="params">()</span> &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;Method C&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        <span class="type">MyClass</span> <span class="variable">myClass</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">MyClass</span>();</span><br><span class="line">        myClass.methodA();</span><br><span class="line">        myClass.methodB();</span><br><span class="line">        myClass.methodC();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>åœ¨ä¸Šé¢çš„ä¾‹å­ä¸­ï¼ŒInterfaceA å’Œ InterfaceB æ˜¯ä¸¤ä¸ªç‹¬ç«‹çš„æŽ¥å£ã€‚</p>
<p>InterfaceC ç»§æ‰¿äº† InterfaceA å’Œ InterfaceBï¼Œå¹¶ä¸”å®šä¹‰äº†è‡ªå·±çš„æ–¹æ³• methodCã€‚</p>
<p>MyClass å®žçŽ°äº† InterfaceCï¼Œå› æ­¤éœ€è¦å®žçŽ° InterfaceA å’Œ InterfaceB ä¸­çš„æ–¹æ³• methodA å’Œ methodBï¼Œä»¥åŠ InterfaceC ä¸­çš„æ–¹æ³• methodCã€‚</p>
<h4 id="ç»§æ‰¿å’ŒæŠ½è±¡çš„åŒºåˆ«ï¼Ÿ"><a href="#ç»§æ‰¿å’ŒæŠ½è±¡çš„åŒºåˆ«ï¼Ÿ" class="headerlink" title="ç»§æ‰¿å’ŒæŠ½è±¡çš„åŒºåˆ«ï¼Ÿ"></a>ç»§æ‰¿å’ŒæŠ½è±¡çš„åŒºåˆ«ï¼Ÿ</h4><p>ç»§æ‰¿æ˜¯ä¸€ç§å…è®¸å­ç±»ç»§æ‰¿çˆ¶ç±»å±žæ€§å’Œæ–¹æ³•çš„æœºåˆ¶ã€‚é€šè¿‡ç»§æ‰¿ï¼Œ<strong>å­ç±»å¯ä»¥é‡ç”¨çˆ¶ç±»çš„ä»£ç </strong>ã€‚</p>
<p>æŠ½è±¡æ˜¯ä¸€ç§éšè—å¤æ‚æ€§å’Œåªæ˜¾ç¤ºå¿…è¦éƒ¨åˆ†çš„æŠ€æœ¯ã€‚åœ¨é¢å‘å¯¹è±¡ç¼–ç¨‹ä¸­ï¼ŒæŠ½è±¡å¯ä»¥é€šè¿‡æŠ½è±¡ç±»å’ŒæŽ¥å£å®žçŽ°ã€‚</p>
<h4 id="æŠ½è±¡ç±»å’Œæ™®é€šç±»çš„åŒºåˆ«ï¼Ÿ"><a href="#æŠ½è±¡ç±»å’Œæ™®é€šç±»çš„åŒºåˆ«ï¼Ÿ" class="headerlink" title="æŠ½è±¡ç±»å’Œæ™®é€šç±»çš„åŒºåˆ«ï¼Ÿ"></a>æŠ½è±¡ç±»å’Œæ™®é€šç±»çš„åŒºåˆ«ï¼Ÿ</h4><p>æŠ½è±¡ç±»ä½¿ç”¨ <code>abstract</code> å…³é”®å­—å®šä¹‰ï¼Œä¸èƒ½è¢«å®žä¾‹åŒ–ï¼Œåªèƒ½ä½œä¸ºå…¶ä»–ç±»çš„çˆ¶ç±»ã€‚æ™®é€šç±»æ²¡æœ‰ abstract å…³é”®å­—ï¼Œå¯ä»¥ç›´æŽ¥å®žä¾‹åŒ–ã€‚</p>
<p>æŠ½è±¡ç±»å¯ä»¥åŒ…å«æŠ½è±¡æ–¹æ³•å’ŒéžæŠ½è±¡æ–¹æ³•ã€‚æŠ½è±¡æ–¹æ³•æ²¡æœ‰æ–¹æ³•ä½“ï¼Œå¿…é¡»ç”±å­ç±»å®žçŽ°ã€‚æ™®é€šç±»åªèƒ½åŒ…å«éžæŠ½è±¡æ–¹æ³•ã€‚</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">abstract</span> <span class="keyword">class</span> <span class="title class_">Animal</span> &#123;</span><br><span class="line">    <span class="comment">// æŠ½è±¡æ–¹æ³•</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">abstract</span> <span class="keyword">void</span> <span class="title function_">makeSound</span><span class="params">()</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// éžæŠ½è±¡æ–¹æ³•</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">eat</span><span class="params">()</span> &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;This animal is eating.&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Dog</span> <span class="keyword">extends</span> <span class="title class_">Animal</span> &#123;</span><br><span class="line">    <span class="comment">// å®žçŽ°æŠ½è±¡æ–¹æ³•</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">makeSound</span><span class="params">()</span> &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;Woof&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Test</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        <span class="type">Dog</span> <span class="variable">dog</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Dog</span>();</span><br><span class="line">        dog.makeSound(); <span class="comment">// è¾“å‡º &quot;Woof&quot;</span></span><br><span class="line">        dog.eat(); <span class="comment">// è¾“å‡º &quot;This animal is eating.&quot;</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>æŠ½è±¡ç±»ä½¿ç”¨ <code>abstract</code> å…³é”®å­—å®šä¹‰ï¼Œä¸èƒ½è¢«å®žä¾‹åŒ–ï¼Œåªèƒ½ä½œä¸ºå…¶ä»–ç±»çš„çˆ¶ç±»ã€‚æ™®é€šç±»æ²¡æœ‰ abstract å…³é”®å­—ï¼Œå¯ä»¥ç›´æŽ¥å®žä¾‹åŒ–ã€‚</p>
<p><strong>æŠ½è±¡ç±»</strong>å¯ä»¥åŒ…å«<strong>æŠ½è±¡æ–¹æ³•å’ŒéžæŠ½è±¡æ–¹æ³•</strong>ã€‚æŠ½è±¡æ–¹æ³•æ²¡æœ‰æ–¹æ³•ä½“ï¼Œå¿…é¡»ç”±å­ç±»å®žçŽ°ã€‚æ™®é€šç±»åªèƒ½åŒ…å«éžæŠ½è±¡æ–¹æ³•ã€‚</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">abstract</span> <span class="keyword">class</span> <span class="title class_">Animal</span> &#123;</span><br><span class="line">    <span class="comment">// æŠ½è±¡æ–¹æ³•</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">abstract</span> <span class="keyword">void</span> <span class="title function_">makeSound</span><span class="params">()</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// éžæŠ½è±¡æ–¹æ³•</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">eat</span><span class="params">()</span> &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;This animal is eating.&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Dog</span> <span class="keyword">extends</span> <span class="title class_">Animal</span> &#123;</span><br><span class="line">    <span class="comment">// å®žçŽ°æŠ½è±¡æ–¹æ³•</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">makeSound</span><span class="params">()</span> &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;Woof&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Test</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        <span class="type">Dog</span> <span class="variable">dog</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Dog</span>();</span><br><span class="line">        dog.makeSound(); <span class="comment">// è¾“å‡º &quot;Woof&quot;</span></span><br><span class="line">        dog.eat(); <span class="comment">// è¾“å‡º &quot;This animal is eating.&quot;</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h3 id="29-ðŸŒŸä¸ºä»€ä¹ˆé‡å†™-equals-æ—¶å¿…é¡»é‡å†™-hashCode-â½…æ³•ï¼Ÿ"><a href="#29-ðŸŒŸä¸ºä»€ä¹ˆé‡å†™-equals-æ—¶å¿…é¡»é‡å†™-hashCode-â½…æ³•ï¼Ÿ" class="headerlink" title="29.ðŸŒŸä¸ºä»€ä¹ˆé‡å†™ equals æ—¶å¿…é¡»é‡å†™ hashCode â½…æ³•ï¼Ÿ"></a>29.ðŸŒŸä¸ºä»€ä¹ˆé‡å†™ equals æ—¶å¿…é¡»é‡å†™ hashCode â½…æ³•ï¼Ÿ</h3><p>å› ä¸ºåŸºäºŽå“ˆå¸Œçš„é›†åˆç±»ï¼ˆå¦‚ HashMapï¼‰éœ€è¦åŸºäºŽè¿™ä¸€ç‚¹æ¥æ­£ç¡®å­˜å‚¨å’ŒæŸ¥æ‰¾å¯¹è±¡ã€‚</p>
<p>å…·ä½“åœ°è¯´ï¼ŒHashMap é€šè¿‡å¯¹è±¡çš„å“ˆå¸Œç å°†å…¶å­˜å‚¨åœ¨ä¸åŒçš„â€œæ¡¶â€ä¸­ï¼Œå½“æŸ¥æ‰¾å¯¹è±¡æ—¶ï¼Œå®ƒéœ€è¦ä½¿ç”¨ key çš„å“ˆå¸Œç æ¥ç¡®å®šå¯¹è±¡åœ¨å“ªä¸ªæ¡¶ä¸­ï¼Œç„¶åŽå†é€šè¿‡Â <code>equals()</code>Â æ–¹æ³•æ‰¾åˆ°å¯¹åº”çš„å¯¹è±¡ã€‚</p>
<p>å¦‚æžœé‡å†™äº†Â <code>equals()</code>æ–¹æ³•è€Œæ²¡æœ‰é‡å†™Â <code>hashCode()</code>æ–¹æ³•ï¼Œé‚£ä¹ˆè¢«è®¤ä¸ºç›¸ç­‰çš„å¯¹è±¡å¯èƒ½ä¼šæœ‰ä¸åŒçš„å“ˆå¸Œç ï¼Œä»Žè€Œå¯¼è‡´æ— æ³•åœ¨ HashMap ä¸­æ­£ç¡®å¤„ç†è¿™äº›å¯¹è±¡ã€‚</p>
<h4 id="ä»€ä¹ˆæ˜¯-hashCode-æ–¹æ³•ï¼Ÿ"><a href="#ä»€ä¹ˆæ˜¯-hashCode-æ–¹æ³•ï¼Ÿ" class="headerlink" title="ä»€ä¹ˆæ˜¯ hashCode æ–¹æ³•ï¼Ÿ"></a>ä»€ä¹ˆæ˜¯ hashCode æ–¹æ³•ï¼Ÿ</h4><p><code>hashCode()</code>Â æ–¹æ³•çš„ä½œâ½¤æ˜¯èŽ·å–å“ˆå¸Œç ï¼Œå®ƒä¼šè¿”å›žâ¼€ä¸ª int æ•´æ•°ï¼Œå®šä¹‰åœ¨Â <a target="_blank" rel="noopener" href="https://javabetter.cn/oo/object-class.html">Object ç±»</a>ä¸­ï¼Œ æ˜¯ä¸€ä¸ªæœ¬åœ°â½…æ³•ã€‚</p>
<p> <code>public native int hashCode();</code></p>
<h4 id="ä¸ºä»€ä¹ˆè¦æœ‰-hashCode-æ–¹æ³•ï¼Ÿ"><a href="#ä¸ºä»€ä¹ˆè¦æœ‰-hashCode-æ–¹æ³•ï¼Ÿ" class="headerlink" title="ä¸ºä»€ä¹ˆè¦æœ‰ hashCode æ–¹æ³•ï¼Ÿ"></a>ä¸ºä»€ä¹ˆè¦æœ‰ hashCode æ–¹æ³•ï¼Ÿ</h4><p><code>hashCode</code> æ–¹æ³•ä¸»è¦ç”¨æ¥èŽ·å–å¯¹è±¡çš„å“ˆå¸Œç ï¼Œå“ˆå¸Œç æ˜¯ç”±å¯¹è±¡çš„å†…å­˜åœ°å€æˆ–è€…å¯¹è±¡çš„å±žæ€§è®¡ç®—å‡ºæ¥çš„ï¼Œå®ƒæ˜¯â¼€ä¸ª int ç±»åž‹çš„æ•´æ•°ï¼Œé€šå¸¸æ˜¯ä¸ä¼šé‡å¤çš„ï¼Œå› æ­¤å¯ä»¥ç”¨æ¥ä½œä¸ºé”®å€¼å¯¹çš„å»ºï¼Œä»¥æé«˜æŸ¥è¯¢æ•ˆçŽ‡ã€‚</p>
<p>ä¾‹å¦‚Â <a target="_blank" rel="noopener" href="https://javabetter.cn/collection/hashmap.html#_01%E3%80%81hash%E6%96%B9%E6%B3%95%E7%9A%84%E5%8E%9F%E7%90%86">HashMap</a>Â ä¸­çš„ key å°±æ˜¯é€šè¿‡ <code>hashCode</code> æ¥å®žçŽ°çš„ï¼Œé€šè¿‡è°ƒç”¨ <code>hashCode</code> æ–¹æ³•èŽ·å–é”®çš„å“ˆå¸Œç ï¼Œå¹¶å°†å…¶ä¸Žå³ç§» 16 ä½çš„å“ˆå¸Œç è¿›è¡Œå¼‚æˆ–è¿ç®—ã€‚</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">static</span> <span class="keyword">final</span> <span class="type">int</span> <span class="title function_">hash</span><span class="params">(Object key)</span> &#123;</span><br><span class="line"> <span class="type">int</span> h;</span><br><span class="line"> <span class="keyword">return</span> (key == <span class="literal">null</span>) ? <span class="number">0</span> : (h = key.hashCode()) ^ (h &gt;&gt;&gt; <span class="number">16</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="ä¸ºä»€ä¹ˆä¸¤ä¸ªå¯¹è±¡æœ‰ç›¸åŒçš„-hashcode-å€¼ï¼Œå®ƒä»¬ä¹Ÿä¸â¼€å®šç›¸ç­‰ï¼Ÿ"><a href="#ä¸ºä»€ä¹ˆä¸¤ä¸ªå¯¹è±¡æœ‰ç›¸åŒçš„-hashcode-å€¼ï¼Œå®ƒä»¬ä¹Ÿä¸â¼€å®šç›¸ç­‰ï¼Ÿ" class="headerlink" title="ä¸ºä»€ä¹ˆä¸¤ä¸ªå¯¹è±¡æœ‰ç›¸åŒçš„ hashcode å€¼ï¼Œå®ƒä»¬ä¹Ÿä¸â¼€å®šç›¸ç­‰ï¼Ÿ"></a>ä¸ºä»€ä¹ˆä¸¤ä¸ªå¯¹è±¡æœ‰ç›¸åŒçš„ hashcode å€¼ï¼Œå®ƒä»¬ä¹Ÿä¸â¼€å®šç›¸ç­‰ï¼Ÿ</h4><p>è¿™ä¸»è¦æ˜¯ç”±äºŽå“ˆå¸Œç ï¼ˆhashCodeï¼‰çš„æœ¬è´¨å’Œç›®çš„æ‰€å†³å®šçš„ã€‚</p>
<p>å“ˆå¸Œç æ˜¯é€šè¿‡<code>å“ˆå¸Œå‡½æ•°</code>å°†å¯¹è±¡ä¸­æ˜ å°„æˆä¸€ä¸ªæ•´æ•°å€¼ï¼Œå…¶ä¸»è¦ç›®çš„æ˜¯åœ¨å“ˆå¸Œè¡¨ä¸­å¿«é€Ÿå®šä½å¯¹è±¡çš„å­˜å‚¨ä½ç½®ã€‚</p>
<p>ç”±äºŽå“ˆå¸Œå‡½æ•°å°†ä¸€ä¸ª<code>è¾ƒå¤§çš„è¾“å…¥åŸŸ</code>æ˜ å°„åˆ°ä¸€ä¸ª<code>è¾ƒå°çš„è¾“å‡ºåŸŸ</code>ï¼Œä¸åŒçš„è¾“å…¥å€¼ï¼ˆå³ä¸åŒçš„å¯¹è±¡ï¼‰å¯èƒ½ä¼šäº§ç”Ÿç›¸åŒçš„è¾“å‡ºå€¼ï¼ˆå³ç›¸åŒçš„å“ˆå¸Œç ï¼‰ã€‚</p>
<p>è¿™ç§æƒ…å†µè¢«ç§°ä¸º<strong>å“ˆå¸Œå†²çª</strong>ã€‚å½“ä¸¤ä¸ªä¸ç›¸ç­‰çš„å¯¹è±¡å‘ç”Ÿå“ˆå¸Œå†²çªæ—¶ï¼Œå®ƒä»¬ä¼šæœ‰ç›¸åŒçš„ <code>hashCode</code>ã€‚</p>
<p>ä¸ºäº†è§£å†³å“ˆå¸Œå†²çªçš„é—®é¢˜ï¼Œå“ˆå¸Œè¡¨åœ¨å¤„ç†é”®æ—¶ï¼Œä¸ä»…ä¼šæ¯”è¾ƒé”®å¯¹è±¡çš„å“ˆå¸Œç ï¼Œè¿˜ä¼šä½¿ç”¨ <code>equals</code> æ–¹æ³•æ¥æ£€æŸ¥é”®å¯¹è±¡æ˜¯å¦çœŸæ­£ç›¸ç­‰ã€‚å¦‚æžœä¸¤ä¸ªå¯¹è±¡çš„å“ˆå¸Œç ç›¸åŒï¼Œä½†é€šè¿‡ equals æ–¹æ³•æ¯”è¾ƒç»“æžœä¸º falseï¼Œé‚£ä¹ˆè¿™ä¸¤ä¸ªå¯¹è±¡å°±ä¸è¢«è§†ä¸ºç›¸ç­‰ã€‚</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> (p.hash == hash &amp;&amp;</span><br><span class="line"> ((k = p.key) == key || (key != <span class="literal">null</span> &amp;&amp; key.equals(k))))</span><br><span class="line"> e = p;</span><br></pre></td></tr></table></figure>

<h4 id="hashCode-å’Œ-equals-æ–¹æ³•çš„å…³ç³»ï¼Ÿ"><a href="#hashCode-å’Œ-equals-æ–¹æ³•çš„å…³ç³»ï¼Ÿ" class="headerlink" title="hashCode å’Œ equals æ–¹æ³•çš„å…³ç³»ï¼Ÿ"></a><a target="_blank" rel="noopener" href="https://javabetter.cn/sidebar/sanfene/javase.html#hashcode-%E5%92%8C-equals-%E6%96%B9%E6%B3%95%E7%9A%84%E5%85%B3%E7%B3%BB">hashCode å’Œ equals æ–¹æ³•çš„å…³ç³»ï¼Ÿ</a></h4><p>å¦‚æžœä¸¤ä¸ªå¯¹è±¡é€šè¿‡ <code>equals</code> ç›¸ç­‰ï¼Œå®ƒä»¬çš„ <code>hashCode</code> å¿…é¡»ç›¸ç­‰ã€‚å¦åˆ™ä¼šå¯¼è‡´å“ˆå¸Œè¡¨ç±»æ•°æ®ç»“æž„ï¼ˆå¦‚ HashMapã€HashSetï¼‰çš„è¡Œä¸ºå¼‚å¸¸ã€‚</p>
<p>åœ¨å“ˆå¸Œè¡¨ä¸­ï¼Œå¦‚æžœ <code>equals</code> ç›¸ç­‰ä½† <code>hashCode</code> ä¸ç›¸ç­‰ï¼Œå“ˆå¸Œè¡¨å¯èƒ½æ— æ³•æ­£ç¡®å¤„ç†è¿™äº›å¯¹è±¡ï¼Œå¯¼è‡´é‡å¤å…ƒç´ æˆ–é”®å€¼å†²çªç­‰é—®é¢˜ã€‚</p>
<h3 id="34-ðŸŒŸString-å’Œ-StringBuilderã€StringBuffer-çš„åŒºåˆ«ï¼Ÿ"><a href="#34-ðŸŒŸString-å’Œ-StringBuilderã€StringBuffer-çš„åŒºåˆ«ï¼Ÿ" class="headerlink" title="34.ðŸŒŸString å’Œ StringBuilderã€StringBuffer çš„åŒºåˆ«ï¼Ÿ"></a>34.ðŸŒŸString å’Œ StringBuilderã€StringBuffer çš„åŒºåˆ«ï¼Ÿ</h3><p>æŽ¨èé˜…è¯»ï¼š<a target="_blank" rel="noopener" href="https://javabetter.cn/string/builder-buffer.html">StringBuffer å’Œ StringBuilder ä¸¤å…„å¼Ÿ</a></p>
<p><code>String</code>ã€<code>StringBuilder</code>å’Œ<code>StringBuffer</code>åœ¨ Java ä¸­éƒ½æ˜¯ç”¨äºŽå¤„ç†å­—ç¬¦ä¸²çš„ï¼Œå®ƒä»¬ä¹‹é—´çš„åŒºåˆ«æ˜¯ï¼ŒString æ˜¯<code>ä¸å¯å˜çš„</code>ï¼Œå¹³å¸¸å¼€å‘ç”¨å¾—æœ€å¤šï¼Œå½“é‡åˆ°å¤§é‡å­—ç¬¦ä¸²è¿žæŽ¥æ—¶ï¼Œå°±ç”¨ StringBuilderï¼Œå®ƒä¸ä¼šç”Ÿæˆå¾ˆå¤šæ–°çš„å¯¹è±¡ï¼Œ<code>StringBuffer</code> å’Œ StringBuilder ç±»ä¼¼ï¼Œä½†æ¯ä¸ªæ–¹æ³•ä¸Šéƒ½åŠ äº† <code>synchronized</code> å…³é”®å­—ï¼Œæ‰€ä»¥æ˜¯çº¿ç¨‹å®‰å…¨çš„ã€‚</p>
<h4 id="è¯·è¯´è¯´-String-çš„ç‰¹ç‚¹"><a href="#è¯·è¯´è¯´-String-çš„ç‰¹ç‚¹" class="headerlink" title="è¯·è¯´è¯´ String çš„ç‰¹ç‚¹"></a>è¯·è¯´è¯´ String çš„ç‰¹ç‚¹</h4><ul>
<li><code>String</code>ç±»çš„å¯¹è±¡æ˜¯<a target="_blank" rel="noopener" href="https://javabetter.cn/string/immutable.html">ä¸å¯å˜çš„</a>ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œä¸€æ—¦ä¸€ä¸ª<code>String</code>å¯¹è±¡è¢«åˆ›å»ºï¼Œå®ƒæ‰€åŒ…å«çš„å­—ç¬¦ä¸²å†…å®¹æ˜¯ä¸å¯æ”¹å˜çš„ã€‚</li>
<li>æ¯æ¬¡å¯¹<code>String</code>å¯¹è±¡è¿›è¡Œä¿®æ”¹æ“ä½œï¼ˆå¦‚æ‹¼æŽ¥ã€æ›¿æ¢ç­‰ï¼‰å®žé™…ä¸Šéƒ½ä¼šç”Ÿæˆä¸€ä¸ªæ–°çš„<code>String</code>å¯¹è±¡ï¼Œè€Œä¸æ˜¯ä¿®æ”¹åŽŸæœ‰å¯¹è±¡ã€‚è¿™å¯èƒ½ä¼šå¯¼è‡´å†…å­˜å’Œæ€§èƒ½å¼€é”€ï¼Œå°¤å…¶æ˜¯åœ¨å¤§é‡å­—ç¬¦ä¸²æ“ä½œçš„æƒ…å†µä¸‹ã€‚</li>
</ul>
<h4 id="è¯·è¯´è¯´-StringBuilder-çš„ç‰¹ç‚¹"><a href="#è¯·è¯´è¯´-StringBuilder-çš„ç‰¹ç‚¹" class="headerlink" title="è¯·è¯´è¯´ StringBuilder çš„ç‰¹ç‚¹"></a>è¯·è¯´è¯´ StringBuilder çš„ç‰¹ç‚¹</h4><ul>
<li><code>StringBuilder</code>æä¾›äº†ä¸€ç³»åˆ—çš„æ–¹æ³•æ¥è¿›è¡Œå­—ç¬¦ä¸²çš„å¢žåˆ æ”¹æŸ¥æ“ä½œï¼Œè¿™äº›æ“ä½œéƒ½æ˜¯ç›´æŽ¥åœ¨åŽŸæœ‰å­—ç¬¦ä¸²å¯¹è±¡çš„åº•å±‚æ•°ç»„ä¸Šè¿›è¡Œçš„ï¼Œè€Œ<strong>ä¸æ˜¯ç”Ÿæˆæ–°çš„ String å¯¹è±¡</strong>ã€‚</li>
<li><code>StringBuilder</code>ä¸æ˜¯çº¿ç¨‹å®‰å…¨çš„ã€‚è¿™æ„å‘³ç€åœ¨æ²¡æœ‰å¤–éƒ¨åŒæ­¥çš„æƒ…å†µä¸‹ï¼Œå®ƒä¸é€‚ç”¨äºŽå¤šçº¿ç¨‹çŽ¯å¢ƒã€‚</li>
<li>ç›¸æ¯”äºŽ<code>String</code>ï¼Œåœ¨è¿›è¡Œé¢‘ç¹çš„å­—ç¬¦ä¸²ä¿®æ”¹æ“ä½œæ—¶ï¼Œ<code>StringBuilder</code>èƒ½æä¾›æ›´å¥½çš„æ€§èƒ½ã€‚ Java ä¸­çš„å­—ç¬¦ä¸²è¿ž<code>+</code>æ“ä½œå…¶å®žå°±æ˜¯é€šè¿‡<code>StringBuilder</code>å®žçŽ°çš„ã€‚</li>
</ul>
<h4 id="è¯·è¯´è¯´-StringBuffer-çš„ç‰¹ç‚¹"><a href="#è¯·è¯´è¯´-StringBuffer-çš„ç‰¹ç‚¹" class="headerlink" title="è¯·è¯´è¯´ StringBuffer çš„ç‰¹ç‚¹"></a>è¯·è¯´è¯´ StringBuffer çš„ç‰¹ç‚¹</h4><p><code>StringBuffer</code>å’Œ<code>StringBuilder</code>ç±»ä¼¼ï¼Œä½†<code>StringBuffer</code>æ˜¯çº¿ç¨‹å®‰å…¨çš„ï¼Œæ–¹æ³•å‰é¢éƒ½åŠ äº†<code>synchronized</code>å…³é”®å­—ã€‚</p>
<h4 id="è¯·æ€»ç»“ä¸€ä¸‹ä½¿ç”¨åœºæ™¯"><a href="#è¯·æ€»ç»“ä¸€ä¸‹ä½¿ç”¨åœºæ™¯" class="headerlink" title="è¯·æ€»ç»“ä¸€ä¸‹ä½¿ç”¨åœºæ™¯"></a>è¯·æ€»ç»“ä¸€ä¸‹ä½¿ç”¨åœºæ™¯</h4><ul>
<li><strong>String</strong>ï¼šé€‚ç”¨äºŽå­—ç¬¦ä¸²å†…å®¹<strong>ä¸ä¼šæ”¹å˜</strong>çš„åœºæ™¯ï¼Œæ¯”å¦‚è¯´ä½œä¸º HashMap çš„ keyã€‚</li>
<li><strong>StringBuilder</strong>ï¼šé€‚ç”¨äºŽ<strong>å•çº¿ç¨‹çŽ¯å¢ƒä¸‹</strong>éœ€è¦é¢‘ç¹ä¿®æ”¹å­—ç¬¦ä¸²å†…å®¹çš„åœºæ™¯ï¼Œæ¯”å¦‚åœ¨å¾ªçŽ¯ä¸­æ‹¼æŽ¥æˆ–ä¿®æ”¹å­—ç¬¦ä¸²ï¼Œæ˜¯ String çš„å®Œç¾Žæ›¿ä»£å“ã€‚</li>
<li><strong>StringBuffer</strong>ï¼šçŽ°åœ¨å·²ç»ä¸æ€Žä¹ˆç”¨äº†ï¼Œå› ä¸ºä¸€èˆ¬ä¸ä¼šåœ¨å¤šçº¿ç¨‹åœºæ™¯ä¸‹åŽ»é¢‘ç¹çš„ä¿®æ”¹å­—ç¬¦ä¸²å†…å®¹ã€‚</li>
</ul>
<h3 id="41-ðŸŒŸJava-ä¸­å¼‚å¸¸å¤„ç†ä½“ç³»"><a href="#41-ðŸŒŸJava-ä¸­å¼‚å¸¸å¤„ç†ä½“ç³»" class="headerlink" title="41.ðŸŒŸJava ä¸­å¼‚å¸¸å¤„ç†ä½“ç³»?"></a>41.ðŸŒŸJava ä¸­å¼‚å¸¸å¤„ç†ä½“ç³»?</h3><p>æŽ¨èé˜…è¯»ï¼š<a target="_blank" rel="noopener" href="https://javabetter.cn/exception/gailan.html">ä¸€æ–‡å½»åº•æžæ‡‚ Java å¼‚å¸¸å¤„ç†</a></p>
<p>Java ä¸­çš„å¼‚å¸¸å¤„ç†æœºåˆ¶ç”¨äºŽå¤„ç†ç¨‹åºè¿è¡Œè¿‡ç¨‹ä¸­å¯èƒ½å‘ç”Ÿçš„å„ç§å¼‚å¸¸æƒ…å†µï¼Œé€šå¸¸é€šè¿‡ try-catch-finally è¯­å¥å’Œ throw å…³é”®å­—æ¥å®žçŽ°ã€‚</p>
<p><img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="https://cdn.jsdelivr.net/gh/JakicDong/blog-assets@main/images/20250730111419.png" alt="20250730111419"></p>
<p><code>Throwable</code>Â æ˜¯ Java è¯­è¨€ä¸­æ‰€æœ‰é”™è¯¯å’Œå¼‚å¸¸çš„åŸºç±»ã€‚å®ƒæœ‰ä¸¤ä¸ªä¸»è¦çš„å­ç±»ï¼š<code>Error</code> å’Œ <code>Exception</code>ï¼Œè¿™ä¸¤ä¸ªç±»åˆ†åˆ«ä»£è¡¨äº† Java å¼‚å¸¸å¤„ç†ä½“ç³»ä¸­çš„ä¸¤ä¸ªåˆ†æ”¯ã€‚</p>
<p>Error ç±»ä»£è¡¨é‚£äº›<strong>ä¸¥é‡çš„é”™è¯¯</strong>ï¼Œè¿™ç±»é”™è¯¯é€šå¸¸æ˜¯ç¨‹åºæ— æ³•å¤„ç†çš„ã€‚æ¯”å¦‚ï¼Œ<code>OutOfMemoryError</code> è¡¨ç¤ºå†…å­˜ä¸è¶³ï¼Œ<code>StackOverflowError</code> è¡¨ç¤ºæ ˆæº¢å‡ºã€‚è¿™äº›é”™è¯¯é€šå¸¸ä¸Ž JVM çš„è¿è¡ŒçŠ¶æ€æœ‰å…³ï¼Œä¸€æ—¦å‘ç”Ÿï¼Œ<strong>åº”ç”¨ç¨‹åºé€šå¸¸æ— æ³•æ¢å¤</strong>ã€‚</p>
<p><code>Exception</code> ç±»ä»£è¡¨<strong>ç¨‹åºå¯ä»¥å¤„ç†çš„å¼‚å¸¸</strong>ã€‚å®ƒåˆ†ä¸ºä¸¤å¤§ç±»ï¼šç¼–è¯‘æ—¶å¼‚å¸¸ï¼ˆChecked Exceptionï¼‰å’Œè¿è¡Œæ—¶å¼‚å¸¸ï¼ˆRuntime Exceptionï¼‰ã€‚</p>
<p>â‘ ã€ç¼–è¯‘æ—¶å¼‚å¸¸ï¼ˆChecked Exceptionï¼‰ï¼šè¿™ç±»å¼‚å¸¸åœ¨<strong>ç¼–è¯‘æ—¶å¿…é¡»è¢«æ˜¾å¼å¤„ç†</strong>ï¼ˆæ•èŽ·æˆ–å£°æ˜ŽæŠ›å‡ºï¼‰ã€‚</p>
<p>å¦‚æžœæ–¹æ³•å¯èƒ½æŠ›å‡ºæŸç§ç¼–è¯‘æ—¶å¼‚å¸¸ï¼Œä½†æ²¡æœ‰æ•èŽ·å®ƒï¼ˆtry-catchï¼‰æˆ–æ²¡æœ‰åœ¨æ–¹æ³•å£°æ˜Žä¸­ç”¨ throws å­å¥å£°æ˜Žå®ƒï¼Œé‚£ä¹ˆç¼–è¯‘å°†ä¸ä¼šé€šè¿‡ã€‚ä¾‹å¦‚ï¼šIOExceptionã€SQLException ç­‰ã€‚</p>
<p>â‘¡ã€è¿è¡Œæ—¶å¼‚å¸¸ï¼ˆRuntime Exceptionï¼‰ï¼šè¿™ç±»å¼‚å¸¸åœ¨è¿è¡Œæ—¶æŠ›å‡ºï¼Œå®ƒä»¬éƒ½æ˜¯ <code>RuntimeException</code> çš„å­ç±»ã€‚å¯¹äºŽè¿è¡Œæ—¶å¼‚å¸¸ï¼ŒJava ç¼–è¯‘å™¨ä¸è¦æ±‚å¿…é¡»å¤„ç†å®ƒä»¬ï¼ˆå³ä¸éœ€è¦æ•èŽ·ä¹Ÿä¸éœ€è¦å£°æ˜ŽæŠ›å‡ºï¼‰ã€‚</p>
<p>è¿è¡Œæ—¶å¼‚å¸¸é€šå¸¸æ˜¯ç”±<strong>ç¨‹åºé€»è¾‘é”™è¯¯</strong>å¯¼è‡´çš„ï¼Œå¦‚<code>NullPointerException</code>ã€<code>IndexOutOfBoundsException</code> ç­‰ã€‚</p>
<h3 id="46-ðŸŒŸBIOã€NIOã€AIO-ä¹‹é—´çš„åŒºåˆ«ï¼Ÿ"><a href="#46-ðŸŒŸBIOã€NIOã€AIO-ä¹‹é—´çš„åŒºåˆ«ï¼Ÿ" class="headerlink" title="46.ðŸŒŸBIOã€NIOã€AIO ä¹‹é—´çš„åŒºåˆ«ï¼Ÿ"></a>46.ðŸŒŸBIOã€NIOã€AIO ä¹‹é—´çš„åŒºåˆ«ï¼Ÿ</h3><p>æŽ¨èé˜…è¯»ï¼š<a target="_blank" rel="noopener" href="https://javabetter.cn/nio/nio-better-io.html">Java NIO æ¯”ä¼ ç»Ÿ IO å¼ºåœ¨å“ªé‡Œï¼Ÿ</a></p>
<p>Java å¸¸è§çš„ IO æ¨¡åž‹æœ‰ä¸‰ç§ï¼šBIOã€NIO å’Œ AIOã€‚</p>
<p><img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="https://cdn.jsdelivr.net/gh/JakicDong/blog-assets@main/images/20250731094624.png" alt="20250731094624"></p>
<p>BIOï¼šé‡‡ç”¨é˜»å¡žå¼ I&#x2F;O æ¨¡åž‹ï¼Œçº¿ç¨‹åœ¨æ‰§è¡Œ I&#x2F;O æ“ä½œæ—¶è¢«é˜»å¡žï¼Œæ— æ³•å¤„ç†å…¶ä»–ä»»åŠ¡ï¼Œé€‚ç”¨äºŽè¿žæŽ¥æ•°è¾ƒå°‘çš„åœºæ™¯ã€‚</p>
<p>NIOï¼šé‡‡ç”¨<code>éžé˜»å¡ž I/O æ¨¡åž‹</code>ï¼Œçº¿ç¨‹åœ¨ç­‰å¾… I&#x2F;O æ—¶å¯æ‰§è¡Œå…¶ä»–ä»»åŠ¡ï¼Œé€šè¿‡ <code>Selector</code> ç›‘æŽ§å¤šä¸ª <code>Channel</code> ä¸Šçš„äº‹ä»¶ï¼Œé€‚ç”¨äºŽè¿žæŽ¥æ•°å¤šä½†è¿žæŽ¥æ—¶é—´çŸ­çš„åœºæ™¯ã€‚</p>
<p>AIOï¼šä½¿ç”¨<code>å¼‚æ­¥ I/O æ¨¡åž‹</code>ï¼Œçº¿ç¨‹å‘èµ· I&#x2F;O è¯·æ±‚åŽç«‹å³è¿”å›žï¼Œå½“ I&#x2F;O æ“ä½œå®Œæˆæ—¶é€šè¿‡å›žè°ƒå‡½æ•°é€šçŸ¥çº¿ç¨‹ï¼Œé€‚ç”¨äºŽè¿žæŽ¥æ•°å¤šä¸”è¿žæŽ¥æ—¶é—´é•¿çš„åœºæ™¯ã€‚</p>
<h4 id="ç®€å•è¯´ä¸€ä¸‹-BIOï¼Ÿ"><a href="#ç®€å•è¯´ä¸€ä¸‹-BIOï¼Ÿ" class="headerlink" title="ç®€å•è¯´ä¸€ä¸‹ BIOï¼Ÿ"></a>ç®€å•è¯´ä¸€ä¸‹ BIOï¼Ÿ</h4><p>BIOï¼Œä¹Ÿå°±æ˜¯ä¼ ç»Ÿçš„ IOï¼ŒåŸºäºŽå­—èŠ‚æµæˆ–å­—ç¬¦æµï¼ˆå¦‚ FileInputStreamã€BufferedReader ç­‰ï¼‰è¿›è¡Œæ–‡ä»¶è¯»å†™ï¼ŒåŸºäºŽ <code>Socket</code> å’Œ <code>ServerSocket</code> è¿›è¡Œç½‘ç»œé€šä¿¡ã€‚</p>
<p>å¯¹äºŽæ¯ä¸ªè¿žæŽ¥ï¼Œéƒ½éœ€è¦åˆ›å»ºä¸€ä¸ªç‹¬ç«‹çš„çº¿ç¨‹æ¥å¤„ç†è¯»å†™æ“ä½œã€‚</p>
<p><img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="https://cdn.jsdelivr.net/gh/JakicDong/blog-assets@main/images/20250731095217.png" alt="20250731095217"></p>
<h4 id="ç®€å•è¯´ä¸‹-NIOï¼Ÿ"><a href="#ç®€å•è¯´ä¸‹-NIOï¼Ÿ" class="headerlink" title="ç®€å•è¯´ä¸‹ NIOï¼Ÿ"></a>ç®€å•è¯´ä¸‹ NIOï¼Ÿ</h4><p>NIOï¼ŒJDK 1.4 æ—¶å¼•å…¥ï¼Œæ”¾åœ¨ java.nio åŒ…ä¸‹ï¼Œæä¾›äº† Channelã€Bufferã€Selector ç­‰æ–°çš„æŠ½è±¡ï¼ŒåŸºäºŽ RandomAccessFileã€FileChannelã€ByteBuffer è¿›è¡Œæ–‡ä»¶è¯»å†™ï¼ŒåŸºäºŽ <code>SocketChannel</code> å’Œ <code>ServerSocketChannel</code> è¿›è¡Œç½‘ç»œé€šä¿¡ã€‚</p>
<p>å®žé™…ä¸Šï¼Œâ€œæ—§â€çš„ I&#x2F;O åŒ…å·²ç»ä½¿ç”¨ NIO é‡æ–°å®žçŽ°è¿‡ï¼Œæ‰€ä»¥åœ¨è¿›è¡Œæ–‡ä»¶è¯»å†™æ—¶ï¼ŒNIO å¹¶æ— æ³•ä½“çŽ°å‡ºæ¯” BIO æ›´å¯é çš„æ€§èƒ½ã€‚</p>
<p>NIO çš„é­…åŠ›ä¸»è¦ä½“çŽ°åœ¨<code>ç½‘ç»œç¼–ç¨‹</code>ä¸­ï¼ŒæœåŠ¡å™¨å¯ä»¥ç”¨ä¸€ä¸ªçº¿ç¨‹å¤„ç†å¤šä¸ªå®¢æˆ·ç«¯è¿žæŽ¥ï¼Œé€šè¿‡ Selector ç›‘å¬å¤šä¸ª Channel æ¥å®žçŽ°å¤šè·¯å¤ç”¨ï¼Œæžå¤§åœ°æé«˜äº†ç½‘ç»œç¼–ç¨‹çš„æ€§èƒ½ã€‚</p>
<p><img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="https://cdn.jsdelivr.net/gh/JakicDong/blog-assets@main/images/NIO.png" alt="NIO"></p>
<p>ç¼“å†²åŒº Buffer ä¹Ÿèƒ½æžå¤§æå‡ä¸€æ¬¡ IO æ“ä½œçš„æ•ˆçŽ‡ã€‚</p>
<p><img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="https://cdn.jsdelivr.net/gh/JakicDong/blog-assets@main/images/20250731095841.png" alt="20250731095841"></p>
<h4 id="ç®€å•è¯´ä¸‹-AIOï¼Ÿ"><a href="#ç®€å•è¯´ä¸‹-AIOï¼Ÿ" class="headerlink" title="ç®€å•è¯´ä¸‹ AIOï¼Ÿ"></a>ç®€å•è¯´ä¸‹ AIOï¼Ÿ</h4><p>AIO æ˜¯ Java 7 å¼•å…¥çš„ï¼Œæ”¾åœ¨ <code>java.nio.channels</code> åŒ…ä¸‹ï¼Œæä¾›äº† AsynchronousFileChannelã€AsynchronousSocketChannel ç­‰å¼‚æ­¥ Channelã€‚</p>
<p>å®ƒå¼•å…¥äº†å¼‚æ­¥é€šé“çš„æ¦‚å¿µï¼Œä½¿å¾— I&#x2F;O æ“ä½œå¯ä»¥å¼‚æ­¥è¿›è¡Œã€‚è¿™æ„å‘³ç€çº¿ç¨‹å‘èµ·ä¸€ä¸ªè¯»å†™æ“ä½œåŽä¸å¿…ç­‰å¾…å…¶å®Œæˆï¼Œå¯ä»¥ç«‹å³è¿›è¡Œå…¶ä»–ä»»åŠ¡ï¼Œå¹¶ä¸”å½“è¯»å†™æ“ä½œçœŸæ­£å®Œæˆæ—¶ï¼Œçº¿ç¨‹ä¼šè¢«å¼‚æ­¥åœ°é€šçŸ¥ã€‚</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">AsynchronousFileChannel</span> <span class="variable">fileChannel</span> <span class="operator">=</span> AsynchronousFileChannel.open(Paths.get(<span class="string">&quot;test.txt&quot;</span>), StandardOpenOption.READ);</span><br><span class="line"><span class="type">ByteBuffer</span> <span class="variable">buffer</span> <span class="operator">=</span> ByteBuffer.allocate(<span class="number">1024</span>);</span><br><span class="line">Future&lt;Integer&gt; result = fileChannel.read(buffer, <span class="number">0</span>);</span><br><span class="line"><span class="keyword">while</span> (!result.isDone()) &#123;</span><br><span class="line">    <span class="comment">// do something</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>


<h3 id="52-ðŸŒŸä»€ä¹ˆæ˜¯åå°„ï¼Ÿåº”ç”¨ï¼ŸåŽŸç†ï¼Ÿ"><a href="#52-ðŸŒŸä»€ä¹ˆæ˜¯åå°„ï¼Ÿåº”ç”¨ï¼ŸåŽŸç†ï¼Ÿ" class="headerlink" title="52.ðŸŒŸä»€ä¹ˆæ˜¯åå°„ï¼Ÿåº”ç”¨ï¼ŸåŽŸç†ï¼Ÿ"></a>52.ðŸŒŸä»€ä¹ˆæ˜¯åå°„ï¼Ÿåº”ç”¨ï¼ŸåŽŸç†ï¼Ÿ</h3><p>åå°„å…è®¸ Java åœ¨è¿è¡Œæ—¶æ£€æŸ¥å’Œæ“ä½œç±»çš„æ–¹æ³•å’Œå­—æ®µã€‚é€šè¿‡åå°„ï¼Œå¯ä»¥åŠ¨æ€åœ°èŽ·å–ç±»çš„å­—æ®µã€æ–¹æ³•ã€æž„é€ æ–¹æ³•ç­‰ä¿¡æ¯ï¼Œå¹¶åœ¨è¿è¡Œæ—¶è°ƒç”¨æ–¹æ³•æˆ–è®¿é—®å­—æ®µã€‚</p>
<p>æ¯”å¦‚åˆ›å»ºä¸€ä¸ªå¯¹è±¡æ˜¯é€šè¿‡ new å…³é”®å­—æ¥å®žçŽ°çš„ï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">Person</span> <span class="variable">person</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Person</span>();</span><br></pre></td></tr></table></figure>
<p>Person ç±»çš„ä¿¡æ¯åœ¨ç¼–è¯‘æ—¶å°±ç¡®å®šäº†ï¼Œé‚£å‡å¦‚åœ¨ç¼–è¯‘æœŸæ— æ³•ç¡®å®šç±»çš„ä¿¡æ¯ï¼Œä½†åˆæƒ³åœ¨è¿è¡Œæ—¶èŽ·å–ç±»çš„ä¿¡æ¯ã€åˆ›å»ºç±»çš„å®žä¾‹ã€è°ƒç”¨ç±»çš„æ–¹æ³•ï¼Œè¿™æ—¶å€™å°±è¦ç”¨åˆ°åå°„ã€‚</p>
<p>åå°„åŠŸèƒ½ä¸»è¦é€šè¿‡ <code>java.lang.Class</code> ç±»åŠ <code>java.lang.reflect</code> åŒ…ä¸­çš„ç±»å¦‚ Method, Field, Constructor ç­‰æ¥å®žçŽ°ã€‚</p>
<p><img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="https://cdn.jsdelivr.net/gh/JakicDong/blog-assets@main/images/20250731103546.png" alt="20250731103546"></p>
<p>æ¯”å¦‚è¯´æˆ‘ä»¬å¯ä»¥è£…æ¥åŠ¨æ€åŠ è½½ç±»å¹¶åˆ›å»ºå¯¹è±¡ï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">String</span> <span class="variable">className</span> <span class="operator">=</span> <span class="string">&quot;java.util.Date&quot;</span>;</span><br><span class="line">Class&lt;?&gt; cls = Class.forName(className);</span><br><span class="line"><span class="type">Object</span> <span class="variable">obj</span> <span class="operator">=</span> cls.newInstance();</span><br><span class="line">System.out.println(obj.getClass().getName());</span><br></pre></td></tr></table></figure>
<p>æ¯”å¦‚è¯´æˆ‘ä»¬å¯ä»¥è¿™æ ·æ¥è®¿é—®å­—æ®µå’Œæ–¹æ³•ï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="comment">// åŠ è½½å¹¶å®žä¾‹åŒ–ç±»</span></span><br><span class="line">Class&lt;?&gt; cls = Class.forName(<span class="string">&quot;java.util.Date&quot;</span>);</span><br><span class="line"><span class="type">Object</span> <span class="variable">obj</span> <span class="operator">=</span> cls.newInstance();</span><br><span class="line"></span><br><span class="line"><span class="comment">// èŽ·å–å¹¶è°ƒç”¨æ–¹æ³•</span></span><br><span class="line"><span class="type">Method</span> <span class="variable">method</span> <span class="operator">=</span> cls.getMethod(<span class="string">&quot;getTime&quot;</span>);</span><br><span class="line"><span class="type">Object</span> <span class="variable">result</span> <span class="operator">=</span> method.invoke(obj);</span><br><span class="line">System.out.println(<span class="string">&quot;Time: &quot;</span> + result);</span><br><span class="line"></span><br><span class="line"><span class="comment">// è®¿é—®å­—æ®µ</span></span><br><span class="line"><span class="type">Field</span> <span class="variable">field</span> <span class="operator">=</span> cls.getDeclaredField(<span class="string">&quot;fastTime&quot;</span>);</span><br><span class="line">field.setAccessible(<span class="literal">true</span>); <span class="comment">// å¯¹äºŽç§æœ‰å­—æ®µéœ€è¦è¿™æ ·åš</span></span><br><span class="line">System.out.println(<span class="string">&quot;fastTime: &quot;</span> + field.getLong(obj));</span><br></pre></td></tr></table></figure>
<h4 id="åå°„æœ‰å“ªäº›åº”ç”¨åœºæ™¯ï¼Ÿ"><a href="#åå°„æœ‰å“ªäº›åº”ç”¨åœºæ™¯ï¼Ÿ" class="headerlink" title="åå°„æœ‰å“ªäº›åº”ç”¨åœºæ™¯ï¼Ÿ"></a>åå°„æœ‰å“ªäº›åº”ç”¨åœºæ™¯ï¼Ÿ</h4><p>â‘ ã€Spring æ¡†æž¶å°±å¤§é‡ä½¿ç”¨äº†åå°„æ¥åŠ¨æ€åŠ è½½å’Œç®¡ç† Beanã€‚</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">Class&lt;?&gt; clazz = Class.forName(<span class="string">&quot;com.example.MyClass&quot;</span>);</span><br><span class="line"><span class="type">Object</span> <span class="variable">instance</span> <span class="operator">=</span> clazz.newInstance();</span><br></pre></td></tr></table></figure>
<p>â‘¡ã€Java çš„åŠ¨æ€ä»£ç†ï¼ˆDynamic Proxyï¼‰æœºåˆ¶å°±ä½¿ç”¨äº†åå°„æ¥åˆ›å»ºä»£ç†ç±»ã€‚ä»£ç†ç±»å¯ä»¥åœ¨è¿è¡Œæ—¶åŠ¨æ€å¤„ç†æ–¹æ³•è°ƒç”¨ï¼Œè¿™åœ¨å®žçŽ° AOP å’Œæ‹¦æˆªå™¨æ—¶éžå¸¸æœ‰ç”¨ã€‚</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//åˆ›å»ºä¸€ä¸ªå¤„ç†å™¨å®žä¾‹,è´Ÿè´£å®žé™…æ–¹æ³•çš„è°ƒç”¨é€»è¾‘</span></span><br><span class="line"><span class="type">InvocationHandler</span> <span class="variable">handler</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">MyInvocationHandler</span>();</span><br><span class="line"><span class="type">MyInterface</span> <span class="variable">proxyInstance</span> <span class="operator">=</span> (MyInterface) Proxy.newProxyInstance(</span><br><span class="line">    MyInterface.class.getClassLoader(),</span><br><span class="line">    <span class="keyword">new</span> <span class="title class_">Class</span>&lt;?&gt;[] &#123; MyInterface.class &#125;,</span><br><span class="line">    handler</span><br><span class="line">);</span><br></pre></td></tr></table></figure>
<p>â‘¢ã€JUnit å’Œ TestNG ç­‰æµ‹è¯•æ¡†æž¶ä½¿ç”¨åå°„æœºåˆ¶æ¥å‘çŽ°å’Œæ‰§è¡Œæµ‹è¯•æ–¹æ³•ã€‚åå°„å…è®¸æ¡†æž¶æ‰«æç±»ï¼ŒæŸ¥æ‰¾å¸¦æœ‰ç‰¹å®šæ³¨è§£ï¼ˆå¦‚ @Testï¼‰çš„æ–¹æ³•ï¼Œå¹¶åœ¨è¿è¡Œæ—¶è°ƒç”¨å®ƒä»¬ã€‚</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">Method</span> <span class="variable">testMethod</span> <span class="operator">=</span> testClass.getMethod(<span class="string">&quot;testSomething&quot;</span>);</span><br><span class="line">testMethod.invoke(testInstance);</span><br></pre></td></tr></table></figure>
<h4 id="åå°„çš„åŽŸç†æ˜¯ä»€ä¹ˆï¼Ÿ"><a href="#åå°„çš„åŽŸç†æ˜¯ä»€ä¹ˆï¼Ÿ" class="headerlink" title="åå°„çš„åŽŸç†æ˜¯ä»€ä¹ˆï¼Ÿ"></a>åå°„çš„åŽŸç†æ˜¯ä»€ä¹ˆï¼Ÿ</h4><p>Java ç¨‹åºçš„æ‰§è¡Œåˆ†ä¸º<code>ç¼–è¯‘</code>å’Œ<code>è¿è¡Œ</code>ä¸¤æ­¥ï¼Œç¼–è¯‘ä¹‹åŽä¼šç”Ÿæˆå­—èŠ‚ç (.class)æ–‡ä»¶ï¼ŒJVM è¿›è¡Œç±»åŠ è½½çš„æ—¶å€™ï¼Œä¼šåŠ è½½å­—èŠ‚ç æ–‡ä»¶ï¼Œå°†ç±»åž‹ç›¸å…³çš„æ‰€æœ‰ä¿¡æ¯åŠ è½½è¿›æ–¹æ³•åŒºï¼Œåå°„å°±æ˜¯åŽ»èŽ·å–è¿™äº›ä¿¡æ¯ï¼Œç„¶åŽè¿›è¡Œå„ç§æ“ä½œã€‚</p>
<h2 id="Javaé›†åˆæ¡†æž¶"><a href="#Javaé›†åˆæ¡†æž¶" class="headerlink" title="Javaé›†åˆæ¡†æž¶"></a>Javaé›†åˆæ¡†æž¶</h2><h3 id="1-ðŸŒŸè¯´è¯´æœ‰å“ªäº›å¸¸è§çš„é›†åˆæ¡†æž¶ï¼Ÿ"><a href="#1-ðŸŒŸè¯´è¯´æœ‰å“ªäº›å¸¸è§çš„é›†åˆæ¡†æž¶ï¼Ÿ" class="headerlink" title="1.ðŸŒŸè¯´è¯´æœ‰å“ªäº›å¸¸è§çš„é›†åˆæ¡†æž¶ï¼Ÿ"></a>1.ðŸŒŸè¯´è¯´æœ‰å“ªäº›å¸¸è§çš„é›†åˆæ¡†æž¶ï¼Ÿ</h3><ul>
<li>æŽ¨èé˜…è¯»ï¼š<a target="_blank" rel="noopener" href="https://javabetter.cn/collection/gailan.html">äºŒå“¥çš„ Java è¿›é˜¶ä¹‹è·¯ï¼šJava é›†åˆæ¡†æž¶</a></li>
<li>æŽ¨èé˜…è¯»ï¼š<a target="_blank" rel="noopener" href="https://javabetter.cn/thread/BlockingQueue.html">é˜»å¡žé˜Ÿåˆ— BlockingQueue</a>ã€‚</li>
</ul>
<p><img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="https://cdn.jsdelivr.net/gh/JakicDong/blog-assets@main/images/java%E9%9B%86%E5%90%88%E4%B8%BB%E8%A6%81%E5%85%B3%E7%B3%BB.png" alt="javaé›†åˆä¸»è¦å…³ç³»"></p>
<p>é›†åˆæ¡†æž¶å¯ä»¥åˆ†ä¸ºä¸¤æ¡å¤§çš„æ”¯çº¿ï¼š</p>
<p>â‘ ã€ç¬¬ä¸€æ¡æ”¯çº¿ <code>Collection</code>ï¼Œä¸»è¦ç”± Listã€Setã€Queue ç»„æˆï¼š</p>
<ul>
<li>List ä»£è¡¨æœ‰åºã€å¯é‡å¤çš„é›†åˆï¼Œå…¸åž‹ä»£è¡¨å°±æ˜¯å°è£…äº†åŠ¨æ€æ•°ç»„çš„Â <a target="_blank" rel="noopener" href="https://javabetter.cn/collection/arraylist.html">ArrayList</a>Â å’Œå°è£…äº†é“¾è¡¨çš„Â <a target="_blank" rel="noopener" href="https://javabetter.cn/collection/linkedlist.html">LinkedList</a>ï¼›</li>
<li>Set ä»£è¡¨æ— åºã€ä¸å¯é‡å¤çš„é›†åˆï¼Œå…¸åž‹ä»£è¡¨å°±æ˜¯ HashSet å’Œ TreeSetï¼›</li>
<li>Queue ä»£è¡¨é˜Ÿåˆ—ï¼Œå…¸åž‹ä»£è¡¨å°±æ˜¯åŒç«¯é˜Ÿåˆ—Â <a target="_blank" rel="noopener" href="https://javabetter.cn/collection/arraydeque.html">ArrayDeque</a>ï¼Œä»¥åŠä¼˜å…ˆçº§é˜Ÿåˆ—Â <a target="_blank" rel="noopener" href="https://javabetter.cn/collection/PriorityQueue.html">PriorityQueue</a>ã€‚</li>
</ul>
<p>â‘¡ã€ç¬¬äºŒæ¡æ”¯çº¿ <code>Map</code>ï¼Œä»£è¡¨é”®å€¼å¯¹çš„é›†åˆï¼Œå…¸åž‹ä»£è¡¨å°±æ˜¯Â <a target="_blank" rel="noopener" href="https://javabetter.cn/collection/hashmap.html">HashMap</a>ã€‚</p>
<p>å¦å¤–ä¸€ä¸ªå›žç­”ç‰ˆæœ¬ï¼š</p>
<p>â‘ ã€<code>Collection</code> æŽ¥å£ï¼šæœ€åŸºæœ¬çš„é›†åˆæ¡†æž¶è¡¨ç¤ºæ–¹å¼ï¼Œæä¾›äº†æ·»åŠ ã€åˆ é™¤ã€æ¸…ç©ºç­‰åŸºæœ¬æ“ä½œï¼Œå®ƒä¸»è¦æœ‰ä¸‰ä¸ªå­æŽ¥å£ï¼š</p>
<ul>
<li><code>List</code>ï¼šä¸€ä¸ªæœ‰åºçš„é›†åˆï¼Œå¯ä»¥åŒ…å«é‡å¤çš„å…ƒç´ ã€‚å®žçŽ°ç±»åŒ…æ‹¬ ArrayListã€LinkedList ç­‰ã€‚</li>
<li><code>Set</code>ï¼šä¸€ä¸ªä¸åŒ…å«é‡å¤å…ƒç´ çš„é›†åˆã€‚å®žçŽ°ç±»åŒ…æ‹¬ HashSetã€LinkedHashSetã€TreeSet ç­‰ã€‚</li>
<li><code>Queue</code>ï¼šä¸€ä¸ªç”¨äºŽä¿æŒå…ƒç´ é˜Ÿåˆ—çš„é›†åˆã€‚å®žçŽ°ç±»åŒ…æ‹¬ PriorityQueueã€ArrayDeque ç­‰ã€‚</li>
</ul>
<p>â‘¡ã€<code>Map</code>Â æŽ¥å£ï¼šè¡¨ç¤ºé”®å€¼å¯¹çš„é›†åˆï¼Œä¸€ä¸ªé”®æ˜ å°„åˆ°ä¸€ä¸ªå€¼ã€‚é”®ä¸èƒ½é‡å¤ï¼Œæ¯ä¸ªé”®åªèƒ½å¯¹åº”ä¸€ä¸ªå€¼ã€‚Map æŽ¥å£çš„å®žçŽ°ç±»åŒ…æ‹¬ HashMapã€LinkedHashMapã€TreeMap ç­‰ã€‚</p>
<h4 id="é›†åˆæ¡†æž¶æœ‰å“ªå‡ ä¸ªå¸¸ç”¨å·¥å…·ç±»ï¼Ÿ"><a href="#é›†åˆæ¡†æž¶æœ‰å“ªå‡ ä¸ªå¸¸ç”¨å·¥å…·ç±»ï¼Ÿ" class="headerlink" title="é›†åˆæ¡†æž¶æœ‰å“ªå‡ ä¸ªå¸¸ç”¨å·¥å…·ç±»ï¼Ÿ"></a>é›†åˆæ¡†æž¶æœ‰å“ªå‡ ä¸ªå¸¸ç”¨å·¥å…·ç±»ï¼Ÿ</h4><p>é›†åˆæ¡†æž¶ä½äºŽ <code>java.util</code> åŒ…ä¸‹ï¼Œæä¾›äº†ä¸¤ä¸ªå¸¸ç”¨çš„å·¥å…·ç±»ï¼š</p>
<ul>
<li><a target="_blank" rel="noopener" href="https://javabetter.cn/common-tool/collections.html">Collections</a>ï¼šæä¾›äº†ä¸€äº›å¯¹é›†åˆè¿›è¡ŒæŽ’åºã€äºŒåˆ†æŸ¥æ‰¾ã€åŒæ­¥çš„é™æ€æ–¹æ³•ã€‚</li>
<li><a target="_blank" rel="noopener" href="https://javabetter.cn/common-tool/arrays.html">Arrays</a>ï¼šæä¾›äº†ä¸€äº›å¯¹æ•°ç»„è¿›è¡ŒæŽ’åºã€æ‰“å°ã€å’Œ List è¿›è¡Œè½¬æ¢çš„é™æ€æ–¹æ³•ã€‚</li>
</ul>
<h4 id="ç®€å•ä»‹ç»ä¸€ä¸‹é˜Ÿåˆ—"><a href="#ç®€å•ä»‹ç»ä¸€ä¸‹é˜Ÿåˆ—" class="headerlink" title="ç®€å•ä»‹ç»ä¸€ä¸‹é˜Ÿåˆ—"></a>ç®€å•ä»‹ç»ä¸€ä¸‹é˜Ÿåˆ—</h4><p>Java ä¸­çš„é˜Ÿåˆ—ä¸»è¦é€šè¿‡ <code>Queue</code> æŽ¥å£å’Œå¹¶å‘åŒ…ä¸‹çš„ <code>BlockingQueue</code> ä¸¤ä¸ªæŽ¥å£æ¥å®žçŽ°ã€‚</p>
<p>ä¼˜å…ˆçº§é˜Ÿåˆ— <code>PriorityQueue</code> å®žçŽ°äº† <code>Queue</code> æŽ¥å£ï¼Œæ˜¯ä¸€ä¸ªæ— ç•Œé˜Ÿåˆ—ï¼Œå®ƒçš„å…ƒç´ æŒ‰ç…§è‡ªç„¶é¡ºåºæŽ’åºæˆ–è€… <code>Comparator</code> æ¯”è¾ƒå™¨è¿›è¡ŒæŽ’åºã€‚</p>
<p><img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="https://cdn.jsdelivr.net/gh/JakicDong/blog-assets@main/images/20250801105907.png" alt="20250801105907"></p>
<p>åŒç«¯é˜Ÿåˆ— <code>ArrayDeque</code> ä¹Ÿå®žçŽ°äº† <code>Queue</code> æŽ¥å£ï¼Œæ˜¯ä¸€ä¸ªåŸºäºŽæ•°ç»„çš„ï¼Œå¯ä»¥åœ¨ä¸¤ç«¯æ’å…¥å’Œåˆ é™¤å…ƒç´ çš„é˜Ÿåˆ—ã€‚</p>
<p><img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="https://cdn.jsdelivr.net/gh/JakicDong/blog-assets@main/images/20250801112309.png" alt="20250801112309"></p>
<p>LinkedList å®žçŽ°äº† Queue æŽ¥å£çš„å­ç±» Dequeï¼Œæ‰€ä»¥ä¹Ÿå¯ä»¥å½“åšåŒç«¯é˜Ÿåˆ—æ¥ä½¿ç”¨ã€‚</p>
<p><img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="https://cdn.jsdelivr.net/gh/JakicDong/blog-assets@main/images/20250801112729.png" alt="20250801112729"></p>
<h4 id="ç”¨è¿‡å“ªäº›é›†åˆç±»ï¼Œå®ƒä»¬çš„ä¼˜åŠ£ï¼Ÿ"><a href="#ç”¨è¿‡å“ªäº›é›†åˆç±»ï¼Œå®ƒä»¬çš„ä¼˜åŠ£ï¼Ÿ" class="headerlink" title="ç”¨è¿‡å“ªäº›é›†åˆç±»ï¼Œå®ƒä»¬çš„ä¼˜åŠ£ï¼Ÿ"></a>ç”¨è¿‡å“ªäº›é›†åˆç±»ï¼Œå®ƒä»¬çš„ä¼˜åŠ£ï¼Ÿ</h4><p>æˆ‘å¸¸ç”¨çš„é›†åˆç±»æœ‰ ArrayListã€LinkedListã€HashMapã€LinkedHashMapã€‚</p>
<ol>
<li><p>ArrayList å¯ä»¥çœ‹ä½œæ˜¯ä¸€ä¸ª<strong>åŠ¨æ€æ•°ç»„</strong>ï¼Œå¯ä»¥åœ¨éœ€è¦æ—¶åŠ¨æ€æ‰©å®¹æ•°ç»„çš„å®¹é‡ï¼Œåªä¸è¿‡éœ€è¦å¤åˆ¶å…ƒç´ åˆ°æ–°çš„æ•°ç»„ã€‚ä¼˜ç‚¹æ˜¯è®¿é—®é€Ÿåº¦å¿«ï¼Œå¯ä»¥é€šè¿‡ç´¢å¼•ç›´æŽ¥æŸ¥æ‰¾åˆ°å…ƒç´ ã€‚ç¼ºç‚¹æ˜¯æ’å…¥å’Œåˆ é™¤å…ƒç´ å¯èƒ½éœ€è¦ç§»åŠ¨æˆ–è€…å¤åˆ¶å…ƒç´ ã€‚</p>
</li>
<li><p>LinkedList æ˜¯ä¸€ä¸ª<strong>åŒå‘é“¾è¡¨</strong>ï¼Œé€‚åˆé¢‘ç¹çš„æ’å…¥å’Œåˆ é™¤æ“ä½œã€‚ä¼˜ç‚¹æ˜¯æ’å…¥å’Œåˆ é™¤å…ƒç´ çš„æ—¶å€™åªéœ€è¦æ”¹å˜èŠ‚ç‚¹çš„å‰åŽæŒ‡é’ˆï¼Œç¼ºç‚¹æ˜¯è®¿é—®å…ƒç´ æ—¶éœ€è¦éåŽ†é“¾è¡¨ã€‚</p>
</li>
<li><p>HashMap æ˜¯ä¸€ä¸ªåŸºäºŽå“ˆå¸Œè¡¨çš„é”®å€¼å¯¹é›†åˆã€‚ä¼˜ç‚¹æ˜¯å¯ä»¥æ ¹æ®é”®çš„å“ˆå¸Œå€¼å¿«é€ŸæŸ¥æ‰¾åˆ°å€¼ï¼Œä½†æœ‰å¯èƒ½ä¼šå‘ç”Ÿå“ˆå¸Œå†²çªï¼Œå¹¶ä¸”ä¸ä¿ç•™é”®å€¼å¯¹çš„æ’å…¥é¡ºåºã€‚</p>
</li>
<li><p>LinkedHashMap åœ¨ HashMap çš„åŸºç¡€ä¸Šå¢žåŠ äº†ä¸€ä¸ªåŒå‘é“¾è¡¨æ¥ä¿æŒé”®å€¼å¯¹çš„æ’å…¥é¡ºåºã€‚</p>
</li>
</ol>
<h4 id="é˜Ÿåˆ—å’Œæ ˆçš„åŒºåˆ«äº†è§£å—ï¼Ÿ"><a href="#é˜Ÿåˆ—å’Œæ ˆçš„åŒºåˆ«äº†è§£å—ï¼Ÿ" class="headerlink" title="é˜Ÿåˆ—å’Œæ ˆçš„åŒºåˆ«äº†è§£å—ï¼Ÿ"></a>é˜Ÿåˆ—å’Œæ ˆçš„åŒºåˆ«äº†è§£å—ï¼Ÿ</h4><p>é˜Ÿåˆ—æ˜¯ä¸€ç§å…ˆè¿›å…ˆå‡ºï¼ˆFIFO, First-In-First-Outï¼‰çš„æ•°æ®ç»“æž„ï¼Œç¬¬ä¸€ä¸ªåŠ å…¥é˜Ÿåˆ—çš„å…ƒç´ ä¼šæˆä¸ºç¬¬ä¸€ä¸ªè¢«ç§»é™¤çš„å…ƒç´ ã€‚</p>
<p><img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="https://cdn.jsdelivr.net/gh/JakicDong/blog-assets@main/images/20250801112820.png" alt="20250801112820"></p>
<p>æ ˆæ˜¯ä¸€ç§åŽè¿›å…ˆå‡ºï¼ˆLIFO, Last-In-First-Outï¼‰çš„æ•°æ®ç»“æž„ï¼Œæœ€åŽä¸€ä¸ªåŠ å…¥æ ˆçš„å…ƒç´ ä¼šæˆä¸ºç¬¬ä¸€ä¸ªè¢«ç§»é™¤çš„å…ƒç´ ã€‚</p>
<p><img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="https://cdn.jsdelivr.net/gh/JakicDong/blog-assets@main/images/20250801112835.png" alt="20250801112835"></p>
<h4 id="å“ªäº›æ˜¯çº¿ç¨‹å®‰å…¨çš„å®¹å™¨ï¼Ÿ"><a href="#å“ªäº›æ˜¯çº¿ç¨‹å®‰å…¨çš„å®¹å™¨ï¼Ÿ" class="headerlink" title="å“ªäº›æ˜¯çº¿ç¨‹å®‰å…¨çš„å®¹å™¨ï¼Ÿ"></a>å“ªäº›æ˜¯çº¿ç¨‹å®‰å…¨çš„å®¹å™¨ï¼Ÿ</h4><p>åƒ Vectorã€Hashtableã€ConcurrentHashMapã€CopyOnWriteArrayListã€ConcurrentLinkedQueueã€ArrayBlockingQueueã€LinkedBlockingQueue éƒ½æ˜¯çº¿ç¨‹å®‰å…¨çš„ã€‚</p>
<h4 id="Collection-ç»§æ‰¿äº†å“ªäº›æŽ¥å£ï¼Ÿ"><a href="#Collection-ç»§æ‰¿äº†å“ªäº›æŽ¥å£ï¼Ÿ" class="headerlink" title="Collection ç»§æ‰¿äº†å“ªäº›æŽ¥å£ï¼Ÿ"></a>Collection ç»§æ‰¿äº†å“ªäº›æŽ¥å£ï¼Ÿ</h4><p>Collection ç»§æ‰¿äº† <code>Iterable</code> æŽ¥å£ï¼Œè¿™æ„å‘³ç€æ‰€æœ‰å®žçŽ° <code>Collection</code> æŽ¥å£çš„ç±»éƒ½å¿…é¡»å®žçŽ°Â <code>iterator()</code>Â æ–¹æ³•ï¼Œä¹‹åŽå°±å¯ä»¥ä½¿ç”¨å¢žå¼ºåž‹ for å¾ªçŽ¯éåŽ†é›†åˆä¸­çš„å…ƒç´ äº†ã€‚</p>
<p><img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="https://cdn.jsdelivr.net/gh/JakicDong/blog-assets@main/images/20250801112927.png" alt="20250801112927"></p>
<p><a target="_blank" rel="noopener" href="https://javabetter.cn/sidebar/sanfene/collection.html#list">List æŽ¨èé˜…è¯»æ–‡ç« </a></p>
<h3 id="2-ðŸŒŸArrayList-å’Œ-LinkedList-æœ‰ä»€ä¹ˆåŒºåˆ«ï¼Ÿ"><a href="#2-ðŸŒŸArrayList-å’Œ-LinkedList-æœ‰ä»€ä¹ˆåŒºåˆ«ï¼Ÿ" class="headerlink" title="2.ðŸŒŸArrayList å’Œ LinkedList æœ‰ä»€ä¹ˆåŒºåˆ«ï¼Ÿ"></a>2.ðŸŒŸArrayList å’Œ LinkedList æœ‰ä»€ä¹ˆåŒºåˆ«ï¼Ÿ</h3><p>æŽ¨èé˜…è¯»ï¼š<a target="_blank" rel="noopener" href="https://javabetter.cn/collection/list-war-2.html">äºŒå“¥çš„ Java è¿›é˜¶ä¹‹è·¯ï¼šArrayList å’Œ LinkedList</a></p>
<p>ArrayList æ˜¯åŸºäºŽ<strong>æ•°ç»„</strong>å®žçŽ°çš„ï¼ŒLinkedList æ˜¯åŸºäºŽ<strong>é“¾è¡¨</strong>å®žçŽ°çš„ã€‚</p>
<h4 id="ArrayList-å’Œ-LinkedList-çš„ç”¨é€”æœ‰ä»€ä¹ˆä¸åŒï¼Ÿ"><a href="#ArrayList-å’Œ-LinkedList-çš„ç”¨é€”æœ‰ä»€ä¹ˆä¸åŒï¼Ÿ" class="headerlink" title="ArrayList å’Œ LinkedList çš„ç”¨é€”æœ‰ä»€ä¹ˆä¸åŒï¼Ÿ"></a>ArrayList å’Œ LinkedList çš„ç”¨é€”æœ‰ä»€ä¹ˆä¸åŒï¼Ÿ</h4><p>å¤šæ•°æƒ…å†µä¸‹ï¼ŒArrayList æ›´åˆ©äºŽ<code>æŸ¥æ‰¾</code>ï¼ŒLinkedList æ›´åˆ©äºŽ<code>å¢žåˆ </code>ã€‚</p>
<p>â‘ ã€ç”±äºŽ ArrayList æ˜¯åŸºäºŽæ•°ç»„å®žçŽ°çš„ï¼Œæ‰€ä»¥ <code>get(int index)</code> å¯ä»¥ç›´æŽ¥é€šè¿‡æ•°ç»„ä¸‹æ ‡èŽ·å–ï¼Œæ—¶é—´å¤æ‚åº¦æ˜¯ O(1)ï¼›LinkedList æ˜¯åŸºäºŽé“¾è¡¨å®žçŽ°çš„ï¼Œ<code>get(int index)</code> éœ€è¦éåŽ†é“¾è¡¨ï¼Œæ—¶é—´å¤æ‚åº¦æ˜¯ O(n)ã€‚</p>
<p>å½“ç„¶ï¼Œ<code>get(E element)</code> è¿™ç§æŸ¥æ‰¾ï¼Œä¸¤ç§é›†åˆéƒ½éœ€è¦éåŽ†é€šè¿‡ equals æ¯”è¾ƒèŽ·å–å…ƒç´ ï¼Œæ‰€ä»¥æ—¶é—´å¤æ‚åº¦éƒ½æ˜¯ O(n)ã€‚</p>
<p>â‘¡ã€ArrayList å¦‚æžœå¢žåˆ çš„æ˜¯æ•°ç»„çš„å°¾éƒ¨ï¼Œæ—¶é—´å¤æ‚åº¦æ˜¯ O(1)ï¼›å¦‚æžœ add çš„æ—¶å€™æ¶‰åŠåˆ°æ‰©å®¹ï¼Œæ—¶é—´å¤æ‚åº¦ä¼šä¸Šå‡åˆ° O(n)ã€‚</p>
<p>ä½†å¦‚æžœæ’å…¥çš„æ˜¯ä¸­é—´çš„ä½ç½®ï¼Œå°±éœ€è¦æŠŠæ’å…¥ä½ç½®åŽçš„å…ƒç´ å‘å‰æˆ–è€…å‘åŽç§»åŠ¨ï¼Œç”šè‡³è¿˜æœ‰å¯èƒ½è§¦å‘æ‰©å®¹ï¼Œæ•ˆçŽ‡å°±ä¼šä½Žå¾ˆå¤šï¼Œå˜æˆ O(n)ã€‚</p>
<p><img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="https://cdn.jsdelivr.net/gh/JakicDong/blog-assets@main/images/20250804110446.png" alt="20250804110446"></p>
<p><code>LinkedList</code> å› ä¸ºæ˜¯é“¾è¡¨ç»“æž„ï¼Œæ’å…¥å’Œåˆ é™¤åªéœ€è¦æ”¹å˜å‰ç½®èŠ‚ç‚¹ã€åŽç½®èŠ‚ç‚¹å’Œæ’å…¥èŠ‚ç‚¹çš„å¼•ç”¨ï¼Œå› æ­¤ä¸éœ€è¦ç§»åŠ¨å…ƒç´ ã€‚</p>
<p>å¦‚æžœæ˜¯åœ¨é“¾è¡¨çš„å¤´éƒ¨æ’å…¥æˆ–è€…åˆ é™¤ï¼Œæ—¶é—´å¤æ‚åº¦æ˜¯ O(1)ï¼›å¦‚æžœæ˜¯åœ¨é“¾è¡¨çš„ä¸­é—´æ’å…¥æˆ–è€…åˆ é™¤ï¼Œæ—¶é—´å¤æ‚åº¦æ˜¯ O(n)ï¼Œå› ä¸ºéœ€è¦éåŽ†é“¾è¡¨æ‰¾åˆ°æ’å…¥ä½ç½®ï¼›å¦‚æžœæ˜¯åœ¨é“¾è¡¨çš„å°¾éƒ¨æ’å…¥æˆ–è€…åˆ é™¤ï¼Œæ—¶é—´å¤æ‚åº¦æ˜¯ O(1)ã€‚</p>
<p><img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="https://cdn.jsdelivr.net/gh/JakicDong/blog-assets@main/images/20250804110550.png" alt="20250804110550"></p>
<h4 id="ArrayList-å’Œ-LinkedList-æ˜¯å¦æ”¯æŒéšæœºè®¿é—®ï¼Ÿ"><a href="#ArrayList-å’Œ-LinkedList-æ˜¯å¦æ”¯æŒéšæœºè®¿é—®ï¼Ÿ" class="headerlink" title="ArrayList å’Œ LinkedList æ˜¯å¦æ”¯æŒéšæœºè®¿é—®ï¼Ÿ"></a>ArrayList å’Œ LinkedList æ˜¯å¦æ”¯æŒéšæœºè®¿é—®ï¼Ÿ</h4><p>â‘ ã€ArrayList æ˜¯åŸºäºŽæ•°ç»„çš„ï¼Œä¹Ÿå®žçŽ°äº† <code>RandomAccess</code> æŽ¥å£ï¼Œæ‰€ä»¥å®ƒæ”¯æŒéšæœºè®¿é—®ï¼Œå¯ä»¥é€šè¿‡ä¸‹æ ‡ç›´æŽ¥èŽ·å–å…ƒç´ ã€‚</p>
<p><img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="https://cdn.jsdelivr.net/gh/JakicDong/blog-assets@main/images/20250804110642.png" alt="20250804110642"></p>
<p>â‘¡ã€LinkedList æ˜¯åŸºäºŽé“¾è¡¨çš„ï¼Œæ‰€ä»¥å®ƒæ²¡æ³•æ ¹æ®ä¸‹æ ‡ç›´æŽ¥èŽ·å–å…ƒç´ ï¼Œä¸æ”¯æŒéšæœºè®¿é—®ã€‚</p>
<p><img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="https://cdn.jsdelivr.net/gh/JakicDong/blog-assets@main/images/20250804110656.png" alt="20250804110656"></p>
<h4 id="ArrayList-å’Œ-LinkedList-å†…å­˜å ç”¨æœ‰ä½•ä¸åŒï¼Ÿ"><a href="#ArrayList-å’Œ-LinkedList-å†…å­˜å ç”¨æœ‰ä½•ä¸åŒï¼Ÿ" class="headerlink" title="ArrayList å’Œ LinkedList å†…å­˜å ç”¨æœ‰ä½•ä¸åŒï¼Ÿ"></a>ArrayList å’Œ LinkedList å†…å­˜å ç”¨æœ‰ä½•ä¸åŒï¼Ÿ</h4><p>ArrayList æ˜¯åŸºäºŽæ•°ç»„çš„ï¼Œæ˜¯ä¸€å—è¿žç»­çš„å†…å­˜ç©ºé—´ï¼Œæ‰€ä»¥å®ƒçš„å†…å­˜å ç”¨æ˜¯æ¯”è¾ƒç´§å‡‘çš„ï¼›ä½†å¦‚æžœæ¶‰åŠåˆ°æ‰©å®¹ï¼Œå°±ä¼šé‡æ–°åˆ†é…å†…å­˜ï¼Œç©ºé—´æ˜¯åŽŸæ¥çš„ 1.5 å€ã€‚</p>
<p><img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="https://cdn.jsdelivr.net/gh/JakicDong/blog-assets@main/images/20250804110718.png" alt="20250804110718"></p>
<p>LinkedList æ˜¯åŸºäºŽé“¾è¡¨çš„ï¼Œæ¯ä¸ªèŠ‚ç‚¹éƒ½æœ‰ä¸€ä¸ªæŒ‡å‘ä¸‹ä¸€ä¸ªèŠ‚ç‚¹å’Œä¸Šä¸€ä¸ªèŠ‚ç‚¹çš„å¼•ç”¨ï¼ŒäºŽæ˜¯æ¯ä¸ªèŠ‚ç‚¹å ç”¨çš„å†…å­˜ç©ºé—´æ¯” ArrayList ç¨å¾®å¤§ä¸€ç‚¹ã€‚</p>
<h4 id="ArrayList-å’Œ-LinkedList-çš„ä½¿ç”¨åœºæ™¯æœ‰ä»€ä¹ˆä¸åŒï¼Ÿ"><a href="#ArrayList-å’Œ-LinkedList-çš„ä½¿ç”¨åœºæ™¯æœ‰ä»€ä¹ˆä¸åŒï¼Ÿ" class="headerlink" title="ArrayList å’Œ LinkedList çš„ä½¿ç”¨åœºæ™¯æœ‰ä»€ä¹ˆä¸åŒï¼Ÿ"></a>ArrayList å’Œ LinkedList çš„ä½¿ç”¨åœºæ™¯æœ‰ä»€ä¹ˆä¸åŒï¼Ÿ</h4><p>ArrayList é€‚ç”¨äºŽï¼š</p>
<ul>
<li>éšæœºè®¿é—®é¢‘ç¹ï¼šéœ€è¦é¢‘ç¹é€šè¿‡ç´¢å¼•è®¿é—®å…ƒç´ çš„åœºæ™¯ã€‚</li>
<li>è¯»å–æ“ä½œè¿œå¤šäºŽå†™å…¥æ“ä½œï¼šå¦‚å­˜å‚¨ä¸ç»å¸¸æ”¹å˜çš„åˆ—è¡¨ã€‚</li>
<li>æœ«å°¾æ·»åŠ å…ƒç´ ï¼šéœ€è¦é¢‘ç¹åœ¨åˆ—è¡¨æœ«å°¾æ·»åŠ å…ƒç´ çš„åœºæ™¯ã€‚</li>
</ul>
<p>LinkedList é€‚ç”¨äºŽï¼š</p>
<ul>
<li>é¢‘ç¹æ’å…¥å’Œåˆ é™¤ï¼šåœ¨åˆ—è¡¨ä¸­é—´é¢‘ç¹æ’å…¥å’Œåˆ é™¤å…ƒç´ çš„åœºæ™¯ã€‚</li>
<li>ä¸éœ€è¦å¿«é€Ÿéšæœºè®¿é—®ï¼šé¡ºåºè®¿é—®å¤šäºŽéšæœºè®¿é—®çš„åœºæ™¯ã€‚</li>
<li>é˜Ÿåˆ—å’Œæ ˆï¼šç”±äºŽå…¶åŒå‘é“¾è¡¨çš„ç‰¹æ€§ï¼ŒLinkedList å¯ä»¥å®žçŽ°é˜Ÿåˆ—ï¼ˆFIFOï¼‰å’Œæ ˆï¼ˆLIFOï¼‰ã€‚</li>
</ul>
<h4 id="é“¾è¡¨å’Œæ•°ç»„æœ‰ä»€ä¹ˆåŒºåˆ«ï¼Ÿ"><a href="#é“¾è¡¨å’Œæ•°ç»„æœ‰ä»€ä¹ˆåŒºåˆ«ï¼Ÿ" class="headerlink" title="é“¾è¡¨å’Œæ•°ç»„æœ‰ä»€ä¹ˆåŒºåˆ«ï¼Ÿ"></a>é“¾è¡¨å’Œæ•°ç»„æœ‰ä»€ä¹ˆåŒºåˆ«ï¼Ÿ</h4><ul>
<li>æ•°ç»„åœ¨å†…å­˜ä¸­å ç”¨çš„æ˜¯ä¸€å—è¿žç»­çš„å­˜å‚¨ç©ºé—´ï¼Œå› æ­¤æˆ‘ä»¬å¯ä»¥é€šè¿‡æ•°ç»„ä¸‹æ ‡å¿«é€Ÿè®¿é—®ä»»æ„å…ƒç´ ã€‚æ•°ç»„åœ¨åˆ›å»ºæ—¶å¿…é¡»æŒ‡å®šå¤§å°ï¼Œä¸€æ—¦åˆ†é…å†…å­˜ï¼Œæ•°ç»„çš„å¤§å°å°±å›ºå®šäº†ã€‚</li>
<li>é“¾è¡¨çš„å…ƒç´ å­˜å‚¨åœ¨äºŽå†…å­˜ä¸­çš„ä»»æ„ä½ç½®ï¼Œæ¯ä¸ªèŠ‚ç‚¹é€šè¿‡æŒ‡é’ˆæŒ‡å‘ä¸‹ä¸€ä¸ªèŠ‚ç‚¹ã€‚</li>
</ul>
<p><img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="https://cdn.jsdelivr.net/gh/JakicDong/blog-assets@main/images/20250804110809.png" alt="20250804110809"></p>
<h3 id="8-ðŸŒŸèƒ½è¯´ä¸€ä¸‹-HashMap-çš„åº•å±‚æ•°æ®ç»“æž„å—ï¼Ÿ"><a href="#8-ðŸŒŸèƒ½è¯´ä¸€ä¸‹-HashMap-çš„åº•å±‚æ•°æ®ç»“æž„å—ï¼Ÿ" class="headerlink" title="8.ðŸŒŸèƒ½è¯´ä¸€ä¸‹ HashMap çš„åº•å±‚æ•°æ®ç»“æž„å—ï¼Ÿ"></a>8.ðŸŒŸèƒ½è¯´ä¸€ä¸‹ HashMap çš„åº•å±‚æ•°æ®ç»“æž„å—ï¼Ÿ</h3><p>æŽ¨èé˜…è¯»ï¼š<a target="_blank" rel="noopener" href="https://javabetter.cn/collection/hashmap.html">äºŒå“¥çš„ Java è¿›é˜¶ä¹‹è·¯ï¼šè¯¦è§£ HashMap</a></p>
<p>JDK 8 ä¸­ HashMap çš„æ•°æ®ç»“æž„æ˜¯<code>æ•°ç»„</code>+<code>é“¾è¡¨</code>+<code>çº¢é»‘æ ‘</code>ã€‚</p>
<p><img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="https://cdn.jsdelivr.net/gh/JakicDong/blog-assets@main/images/20250804112738.png" alt="20250804112738"></p>
<p>æ•°ç»„ç”¨æ¥å­˜å‚¨é”®å€¼å¯¹ï¼Œæ¯ä¸ªé”®å€¼å¯¹å¯ä»¥é€šè¿‡ç´¢å¼•ç›´æŽ¥æ‹¿åˆ°ï¼Œç´¢å¼•æ˜¯é€šè¿‡å¯¹é”®çš„å“ˆå¸Œå€¼è¿›è¡Œè¿›ä¸€æ­¥çš„ <code>hash()</code> å¤„ç†å¾—åˆ°çš„ã€‚</p>
<p>å½“å¤šä¸ªé”®ç»è¿‡å“ˆå¸Œå¤„ç†åŽå¾—åˆ°ç›¸åŒçš„ç´¢å¼•æ—¶ï¼Œéœ€è¦é€šè¿‡é“¾è¡¨æ¥è§£å†³å“ˆå¸Œå†²çªâ€”â€”å°†å…·æœ‰ç›¸åŒç´¢å¼•çš„é”®å€¼å¯¹é€šè¿‡é“¾è¡¨å­˜å‚¨èµ·æ¥ã€‚</p>
<p>ä¸è¿‡ï¼Œ<code>é“¾è¡¨</code>è¿‡é•¿æ—¶ï¼ŒæŸ¥è¯¢æ•ˆçŽ‡ä¼šæ¯”è¾ƒä½Žï¼ŒäºŽæ˜¯å½“<code>é“¾è¡¨</code>çš„é•¿åº¦è¶…è¿‡ 8 æ—¶ï¼ˆä¸”æ•°ç»„çš„é•¿åº¦å¤§äºŽ 64ï¼‰ï¼Œ<code>é“¾è¡¨</code>å°±ä¼šè½¬æ¢ä¸º<code>çº¢é»‘æ ‘</code>ã€‚çº¢é»‘æ ‘çš„æŸ¥è¯¢æ•ˆçŽ‡æ˜¯<code> O(logn)</code>ï¼Œæ¯”é“¾è¡¨çš„ <code>O(n)</code> è¦å¿«ã€‚</p>
<p><code>hash()</code> æ–¹æ³•çš„ç›®æ ‡æ˜¯å°½é‡å‡å°‘å“ˆå¸Œå†²çªï¼Œä¿è¯å…ƒç´ èƒ½å¤Ÿå‡åŒ€åœ°åˆ†å¸ƒåœ¨æ•°ç»„çš„æ¯ä¸ªä½ç½®ä¸Šã€‚</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">static</span> <span class="keyword">final</span> <span class="type">int</span> <span class="title function_">hash</span><span class="params">(Object key)</span> &#123;</span><br><span class="line">    <span class="type">int</span> h;</span><br><span class="line">    <span class="keyword">return</span> (key == <span class="literal">null</span>) ? <span class="number">0</span> : (h = key.hashCode()) ^ (h &gt;&gt;&gt; <span class="number">16</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>å¦‚æžœé”®çš„å“ˆå¸Œå€¼å·²ç»åœ¨æ•°ç»„ä¸­å­˜åœ¨ï¼Œå…¶å¯¹åº”çš„å€¼å°†è¢«æ–°å€¼è¦†ç›–ã€‚</p>
<p>HashMap çš„åˆå§‹å®¹é‡æ˜¯ 16ï¼Œéšç€å…ƒç´ çš„ä¸æ–­æ·»åŠ ï¼ŒHashMap å°±éœ€è¦è¿›è¡Œæ‰©å®¹ï¼Œé˜ˆå€¼æ˜¯<code>capacity * loadFactor</code>ï¼Œcapacity ä¸ºå®¹é‡ï¼ŒloadFactor ä¸ºè´Ÿè½½å› å­ï¼Œé»˜è®¤ä¸º 0.75ã€‚</p>
<p>æ‰©å®¹åŽçš„æ•°ç»„å¤§å°æ˜¯åŽŸæ¥çš„ 2 å€ï¼Œç„¶åŽæŠŠåŽŸæ¥çš„å…ƒç´ é‡æ–°è®¡ç®—å“ˆå¸Œå€¼ï¼Œæ”¾åˆ°æ–°çš„æ•°ç»„ä¸­ã€‚</p>
<h3 id="11-ðŸŒŸHashMap-çš„-put-æµç¨‹çŸ¥é“å—ï¼Ÿ"><a href="#11-ðŸŒŸHashMap-çš„-put-æµç¨‹çŸ¥é“å—ï¼Ÿ" class="headerlink" title="11.ðŸŒŸHashMap çš„ put æµç¨‹çŸ¥é“å—ï¼Ÿ"></a>11.ðŸŒŸHashMap çš„ put æµç¨‹çŸ¥é“å—ï¼Ÿ</h3><p>å“ˆå¸Œå¯»å€ â†’ å¤„ç†å“ˆå¸Œå†²çªï¼ˆé“¾è¡¨è¿˜æ˜¯çº¢é»‘æ ‘ï¼‰â†’ åˆ¤æ–­æ˜¯å¦éœ€è¦æ‰©å®¹ â†’ æ’å…¥&#x2F;è¦†ç›–èŠ‚ç‚¹ã€‚</p>
<p><img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="https://cdn.jsdelivr.net/gh/JakicDong/blog-assets@main/images/20250805111458.png" alt="20250805111458"></p>
<p>è¯¦ç»†ç‰ˆï¼š</p>
<p>ç¬¬ä¸€æ­¥ï¼Œé€šè¿‡ <code>hash</code> æ–¹æ³•è¿›ä¸€æ­¥æ‰°åŠ¨å“ˆå¸Œå€¼ï¼Œä»¥å‡å°‘å“ˆå¸Œå†²çªã€‚</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">static</span> <span class="keyword">final</span> <span class="type">int</span> <span class="title function_">hash</span><span class="params">(Object key)</span> &#123;</span><br><span class="line">    <span class="type">int</span> h;</span><br><span class="line">    <span class="keyword">return</span> (key == <span class="literal">null</span>) ? <span class="number">0</span> : (h = key.hashCode()) ^ (h &gt;&gt;&gt; <span class="number">16</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>ç¬¬äºŒæ­¥ï¼Œè¿›è¡Œç¬¬ä¸€æ¬¡çš„æ•°ç»„æ‰©å®¹ï¼›å¹¶ä½¿ç”¨å“ˆå¸Œå€¼å’Œæ•°ç»„é•¿åº¦è¿›è¡Œå–æ¨¡è¿ç®—ï¼Œç¡®å®šç´¢å¼•ä½ç½®ã€‚</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> ((tab = table) == <span class="literal">null</span> || (n = tab.length) == <span class="number">0</span>)</span><br><span class="line">    n = (tab = resize()).length;</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> ((p = tab[i = (n - <span class="number">1</span>) &amp; hash]) == <span class="literal">null</span>)</span><br><span class="line">    tab[i] = newNode(hash, key, value, <span class="literal">null</span>);</span><br></pre></td></tr></table></figure>
<p>å¦‚æžœå½“å‰ä½ç½®ä¸ºç©ºï¼Œç›´æŽ¥å°†é”®å€¼å¯¹æ’å…¥è¯¥ä½ç½®ï¼›<br>å¦åˆ™åˆ¤æ–­å½“å‰ä½ç½®çš„ç¬¬ä¸€ä¸ªèŠ‚ç‚¹æ˜¯å¦ä¸Žæ–°èŠ‚ç‚¹çš„ key ç›¸åŒï¼Œå¦‚æžœç›¸åŒç›´æŽ¥è¦†ç›– valueï¼Œå¦‚æžœä¸åŒï¼Œè¯´æ˜Žå‘ç”Ÿå“ˆå¸Œå†²çªã€‚</p>
<p>å¦‚æžœæ˜¯é“¾è¡¨ï¼Œå°†æ–°èŠ‚ç‚¹æ·»åŠ åˆ°é“¾è¡¨çš„å°¾éƒ¨ï¼›å¦‚æžœ<strong>é“¾è¡¨é•¿åº¦å¤§äºŽç­‰äºŽ 8</strong>ï¼Œåˆ™å°†é“¾è¡¨è½¬æ¢ä¸ºçº¢é»‘æ ‘ã€‚</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="keyword">public</span> V <span class="title function_">put</span><span class="params">(K key, V value)</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> putVal(hash(key), key, value, <span class="literal">false</span>, <span class="literal">true</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">final</span> V <span class="title function_">putVal</span><span class="params">(<span class="type">int</span> hash, K key, V value, <span class="type">boolean</span> onlyIfAbsent, <span class="type">boolean</span> evict)</span> &#123;</span><br><span class="line">    Node&lt;K,V&gt;[] tab; Node&lt;K,V&gt; p; <span class="type">int</span> n, i;</span><br><span class="line">    <span class="comment">// å¦‚æžœ table ä¸ºç©ºï¼Œå…ˆè¿›è¡Œåˆå§‹åŒ–</span></span><br><span class="line">    <span class="keyword">if</span> ((tab = table) == <span class="literal">null</span> || (n = tab.length) == <span class="number">0</span>)</span><br><span class="line">        n = (tab = resize()).length;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// è®¡ç®—ç´¢å¼•ä½ç½®ï¼Œå¹¶æ‰¾åˆ°å¯¹åº”çš„æ¡¶</span></span><br><span class="line">    <span class="keyword">if</span> ((p = tab[i = (n - <span class="number">1</span>) &amp; hash]) == <span class="literal">null</span>)</span><br><span class="line">        tab[i] = newNode(hash, key, value, <span class="literal">null</span>); <span class="comment">// å¦‚æžœæ¡¶ä¸ºç©ºï¼Œç›´æŽ¥æ’å…¥</span></span><br><span class="line">    <span class="keyword">else</span> &#123;</span><br><span class="line">        Node&lt;K,V&gt; e; K k;</span><br><span class="line">        <span class="comment">// æ£€æŸ¥ç¬¬ä¸€ä¸ªèŠ‚ç‚¹æ˜¯å¦åŒ¹é…</span></span><br><span class="line">        <span class="keyword">if</span> (p.hash == hash &amp;&amp; ((k = p.key) == key || (key != <span class="literal">null</span> &amp;&amp; key.equals(k))))</span><br><span class="line">            e = p; <span class="comment">// è¦†ç›–</span></span><br><span class="line">        <span class="comment">// å¦‚æžœæ˜¯æ ‘èŠ‚ç‚¹ï¼Œæ”¾å…¥æ ‘ä¸­</span></span><br><span class="line">        <span class="keyword">else</span> <span class="keyword">if</span> (p <span class="keyword">instanceof</span> TreeNode)</span><br><span class="line">            e = ((TreeNode&lt;K,V&gt;)p).putTreeVal(<span class="built_in">this</span>, tab, hash, key, value);</span><br><span class="line">        <span class="comment">// å¦‚æžœæ˜¯é“¾è¡¨ï¼ŒéåŽ†æ’å…¥åˆ°å°¾éƒ¨</span></span><br><span class="line">        <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">binCount</span> <span class="operator">=</span> <span class="number">0</span>; ; ++binCount) &#123;</span><br><span class="line">                <span class="keyword">if</span> ((e = p.next) == <span class="literal">null</span>) &#123;</span><br><span class="line">                    p.next = newNode(hash, key, value, <span class="literal">null</span>);</span><br><span class="line">                    <span class="comment">// å¦‚æžœé“¾è¡¨é•¿åº¦è¾¾åˆ°é˜ˆå€¼ï¼Œè½¬æ¢ä¸ºçº¢é»‘æ ‘</span></span><br><span class="line">                    <span class="keyword">if</span> (binCount &gt;= TREEIFY_THRESHOLD - <span class="number">1</span>)</span><br><span class="line">                        treeifyBin(tab, hash);</span><br><span class="line">                    <span class="keyword">break</span>;</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="keyword">if</span> (e.hash == hash &amp;&amp; ((k = e.key) == key || (key != <span class="literal">null</span> &amp;&amp; key.equals(k))))</span><br><span class="line">                    <span class="keyword">break</span>; <span class="comment">// è¦†ç›–</span></span><br><span class="line">                p = e;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span> (e != <span class="literal">null</span>) &#123; <span class="comment">// å¦‚æžœæ‰¾åˆ°åŒ¹é…çš„ keyï¼Œåˆ™è¦†ç›–æ—§å€¼</span></span><br><span class="line">            <span class="type">V</span> <span class="variable">oldValue</span> <span class="operator">=</span> e.value;</span><br><span class="line">            <span class="keyword">if</span> (!onlyIfAbsent || oldValue == <span class="literal">null</span>)</span><br><span class="line">                e.value = value;</span><br><span class="line">            afterNodeAccess(e);</span><br><span class="line">            <span class="keyword">return</span> oldValue;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    ++modCount; <span class="comment">// ä¿®æ”¹è®¡æ•°å™¨</span></span><br><span class="line">    <span class="keyword">if</span> (++size &gt; threshold)</span><br><span class="line">        resize(); <span class="comment">// æ£€æŸ¥æ˜¯å¦éœ€è¦æ‰©å®¹</span></span><br><span class="line">    afterNodeInsertion(evict);</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">null</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>æ¯æ¬¡æ’å…¥æ–°å…ƒç´ åŽï¼Œæ£€æŸ¥æ˜¯å¦éœ€è¦æ‰©å®¹ï¼Œå¦‚æžœå½“å‰å…ƒç´ ä¸ªæ•°å¤§äºŽé˜ˆå€¼ï¼ˆ<code>capacity * loadFactor</code>ï¼‰ï¼Œåˆ™è¿›è¡Œæ‰©å®¹ï¼Œæ‰©å®¹åŽçš„æ•°ç»„å¤§å°æ˜¯åŽŸæ¥çš„ 2 å€ï¼›å¹¶ä¸”é‡æ–°è®¡ç®—æ¯ä¸ªèŠ‚ç‚¹çš„ç´¢å¼•ï¼Œè¿›è¡Œæ•°æ®é‡æ–°åˆ†å¸ƒã€‚</p>
<h4 id="åªé‡å†™å…ƒç´ çš„-equals-æ–¹æ³•æ²¡é‡å†™-hashCodeï¼Œput-çš„æ—¶å€™ä¼šå‘ç”Ÿä»€ä¹ˆ"><a href="#åªé‡å†™å…ƒç´ çš„-equals-æ–¹æ³•æ²¡é‡å†™-hashCodeï¼Œput-çš„æ—¶å€™ä¼šå‘ç”Ÿä»€ä¹ˆ" class="headerlink" title="åªé‡å†™å…ƒç´ çš„ equals æ–¹æ³•æ²¡é‡å†™ hashCodeï¼Œput çš„æ—¶å€™ä¼šå‘ç”Ÿä»€ä¹ˆ?"></a>åªé‡å†™å…ƒç´ çš„ equals æ–¹æ³•æ²¡é‡å†™ hashCodeï¼Œput çš„æ—¶å€™ä¼šå‘ç”Ÿä»€ä¹ˆ?</h4><p>å¦‚æžœåªé‡å†™ <code>equals</code> æ–¹æ³•ï¼Œæ²¡æœ‰é‡å†™ <code>hashCode</code> æ–¹æ³•ï¼Œé‚£ä¹ˆä¼šå¯¼è‡´ <code>equals</code> ç›¸ç­‰çš„ä¸¤ä¸ªå¯¹è±¡ï¼Œ<code>hashCode</code> ä¸ç›¸ç­‰ï¼Œè¿™æ ·çš„è¯ï¼Œä¸¤ä¸ªå¯¹è±¡ä¼šè¢« <code>put</code> åˆ°æ•°ç»„ä¸­ä¸åŒçš„ä½ç½®ï¼Œå¯¼è‡´ <code>get</code> çš„æ—¶å€™ï¼Œæ— æ³•èŽ·å–åˆ°æ­£ç¡®çš„å€¼ã€‚</p>
<h3 id="21-ðŸŒŸHashMapçš„æ‰©å®¹æœºåˆ¶äº†è§£å—ï¼Ÿ"><a href="#21-ðŸŒŸHashMapçš„æ‰©å®¹æœºåˆ¶äº†è§£å—ï¼Ÿ" class="headerlink" title="21.ðŸŒŸHashMapçš„æ‰©å®¹æœºåˆ¶äº†è§£å—ï¼Ÿ"></a>21.ðŸŒŸHashMapçš„æ‰©å®¹æœºåˆ¶äº†è§£å—ï¼Ÿ</h3><p>æ‰©å®¹æ—¶ï¼ŒHashMap ä¼šåˆ›å»ºä¸€ä¸ªæ–°çš„æ•°ç»„ï¼Œå…¶å®¹é‡æ˜¯åŽŸæ¥çš„<strong>ä¸¤å€</strong>ã€‚ç„¶åŽéåŽ†æ—§å“ˆå¸Œè¡¨ä¸­çš„å…ƒç´ ï¼Œå°†å…¶é‡æ–°åˆ†é…åˆ°æ–°çš„å“ˆå¸Œè¡¨ä¸­ã€‚</p>
<p>å¦‚æžœå½“å‰æ¡¶ä¸­åªæœ‰ä¸€ä¸ªå…ƒç´ ï¼Œé‚£ä¹ˆç›´æŽ¥é€šè¿‡é”®çš„å“ˆå¸Œå€¼ä¸Žæ•°ç»„å¤§å°å–æ¨¡é”å®šæ–°çš„ç´¢å¼•ä½ç½®ï¼š<code>e.hash &amp; (newCap - 1)</code>ã€‚</p>
<p>å¦‚æžœå½“å‰æ¡¶æ˜¯çº¢é»‘æ ‘ï¼Œé‚£ä¹ˆä¼šè°ƒç”¨ <code>split()</code> æ–¹æ³•åˆ†è£‚æ ‘èŠ‚ç‚¹ï¼Œä»¥ä¿è¯æ ‘çš„å¹³è¡¡ã€‚</p>
<p>å¦‚æžœå½“å‰æ¡¶æ˜¯é“¾è¡¨ï¼Œä¼šé€šè¿‡æ—§é”®çš„å“ˆå¸Œå€¼ä¸Žæ—§çš„æ•°ç»„å¤§å°å–æ¨¡ <code>(e.hash &amp; oldCap) == 0</code> æ¥ä½œä¸ºåˆ¤æ–­æ¡ä»¶ï¼Œå¦‚æžœæ¡ä»¶ä¸ºçœŸï¼Œå…ƒç´ ä¿ç•™åœ¨åŽŸç´¢å¼•çš„ä½ç½®ï¼›å¦åˆ™å…ƒç´ ç§»åŠ¨åˆ°åŽŸç´¢å¼• + æ—§æ•°ç»„å¤§å°çš„ä½ç½®ã€‚</p>
<h4 id="JDK-7-æ‰©å®¹çš„æ—¶å€™æœ‰ä»€ä¹ˆé—®é¢˜ï¼Ÿ"><a href="#JDK-7-æ‰©å®¹çš„æ—¶å€™æœ‰ä»€ä¹ˆé—®é¢˜ï¼Ÿ" class="headerlink" title="JDK 7 æ‰©å®¹çš„æ—¶å€™æœ‰ä»€ä¹ˆé—®é¢˜ï¼Ÿ"></a>JDK 7 æ‰©å®¹çš„æ—¶å€™æœ‰ä»€ä¹ˆé—®é¢˜ï¼Ÿ</h4><p>JDK 7 åœ¨æ‰©å®¹çš„æ—¶å€™ä½¿ç”¨å¤´æ’æ³•æ¥é‡æ–°æ’å…¥é“¾è¡¨èŠ‚ç‚¹ï¼Œè¿™æ ·ä¼šå¯¼è‡´é“¾è¡¨æ— æ³•ä¿æŒåŽŸæœ‰çš„é¡ºåºã€‚</p>
<p>è¯¦ç»†è§£é‡Šä¸€ä¸‹ã€‚</p>
<p>JDK 7 æ˜¯é€šè¿‡å“ˆå¸Œå€¼ä¸Žæ•°ç»„å¤§å°-1 è¿›è¡Œä¸Žè¿ç®—ç¡®å®šå…ƒç´ ä¸‹æ ‡çš„ã€‚</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">static</span> <span class="type">int</span> <span class="title function_">indexFor</span><span class="params">(<span class="type">int</span> h, <span class="type">int</span> length)</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> h &amp; (length-<span class="number">1</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>æˆ‘ä»¬æ¥å‡è®¾ï¼š</p>
<ul>
<li>æ•°ç»„ table çš„é•¿åº¦ä¸º 2</li>
<li>é”®çš„å“ˆå¸Œå€¼ä¸º 3ã€7ã€5</li>
</ul>
<p>å–æ¨¡è¿ç®—åŽï¼Œé”®å‘ç”Ÿäº†å“ˆå¸Œå†²çªï¼Œå®ƒä»¬éƒ½éœ€è¦æ”¾åˆ° table[1] çš„æ¡¶ä¸Šã€‚é‚£ä¹ˆæ‰©å®¹å‰å°±æ˜¯è¿™ä¸ªæ ·å­ï¼š</p>
<p><img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="https://cdn.jsdelivr.net/gh/JakicDong/blog-assets@main/images/20250807102317.png" alt="20250807102317"></p>
<p>å‡è®¾è´Ÿè½½å› å­ <code>loadFactor</code> ä¸º 1ï¼Œä¹Ÿå°±æ˜¯å½“å…ƒç´ çš„ä¸ªæ•°å¤§äºŽ table çš„é•¿åº¦æ—¶è¿›è¡Œæ‰©å®¹ã€‚</p>
<p>æ‰©å®¹åŽçš„æ•°ç»„å®¹é‡ä¸º 4ã€‚</p>
<ul>
<li>key 3 å–æ¨¡ï¼ˆ3%4ï¼‰åŽæ˜¯ 3ï¼Œæ”¾åœ¨ <code>table[3]</code> ä¸Šã€‚</li>
<li>key 7 å–æ¨¡ï¼ˆ7%4ï¼‰åŽæ˜¯ 3ï¼Œæ”¾åœ¨ <code>table[3]</code> ä¸Šçš„é“¾è¡¨å¤´éƒ¨ã€‚</li>
<li>key 5 å–æ¨¡ï¼ˆ5%4ï¼‰åŽæ˜¯ 1ï¼Œæ”¾åœ¨ <code>table[1]</code> ä¸Šã€‚</li>
</ul>
<p><img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="https://cdn.jsdelivr.net/gh/JakicDong/blog-assets@main/images/20250807102413.png" alt="20250807102413"></p>
<p>å¯ä»¥çœ‹åˆ°ï¼Œç”±äºŽ JDK é‡‡ç”¨çš„æ˜¯å¤´æ’æ³•ï¼Œ7 è·‘åˆ° 3 çš„å‰é¢äº†ï¼ŒåŽŸæ¥çš„é¡ºåºæ˜¯ 3ã€7ã€5ï¼Œ7 åœ¨ 3 çš„åŽé¢ã€‚</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">for</span> (Entry&lt;K,V&gt; e : oldTable) &#123;</span><br><span class="line">    <span class="keyword">while</span> (<span class="literal">null</span> != e) &#123;</span><br><span class="line">        Entry&lt;K,V&gt; next = e.next;</span><br><span class="line">        <span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> indexFor(e.hash, newCapacity);</span><br><span class="line">        e.next = newTable[i];</span><br><span class="line">        newTable[i] = e;</span><br><span class="line">        e = next;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>æœ€å¥½çš„æƒ…å†µå°±æ˜¯ï¼Œæ‰©å®¹åŽçš„ 7 è¿˜åœ¨ 3 çš„åŽé¢ï¼Œä¿æŒåŽŸæ¥çš„é¡ºåºã€‚</p>
<h4 id="JDK-8-æ˜¯æ€Žä¹ˆè§£å†³è¿™ä¸ªé—®é¢˜çš„ï¼Ÿ"><a href="#JDK-8-æ˜¯æ€Žä¹ˆè§£å†³è¿™ä¸ªé—®é¢˜çš„ï¼Ÿ" class="headerlink" title="JDK 8 æ˜¯æ€Žä¹ˆè§£å†³è¿™ä¸ªé—®é¢˜çš„ï¼Ÿ"></a>JDK 8 æ˜¯æ€Žä¹ˆè§£å†³è¿™ä¸ªé—®é¢˜çš„ï¼Ÿ</h4><p>JDK 8 æ”¹ç”¨äº†å°¾æ’æ³•ï¼Œå¹¶ä¸”å½“ <code>(e.hash &amp; oldCap) == 0</code> æ—¶ï¼Œå…ƒç´ ä¿ç•™åœ¨åŽŸç´¢å¼•çš„ä½ç½®ï¼›å¦åˆ™å…ƒç´ ç§»åŠ¨åˆ°<code>åŽŸç´¢å¼• + æ—§æ•°ç»„å¤§å°</code>çš„ä½ç½®ã€‚</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">Node&lt;K,V&gt; loHead = <span class="literal">null</span>, loTail = <span class="literal">null</span>;</span><br><span class="line">Node&lt;K,V&gt; hiHead = <span class="literal">null</span>, hiTail = <span class="literal">null</span>;</span><br><span class="line">Node&lt;K,V&gt; next;</span><br><span class="line"><span class="keyword">do</span> &#123;</span><br><span class="line">    next = e.next;</span><br><span class="line">    <span class="keyword">if</span> ((e.hash &amp; oldCap) == <span class="number">0</span>) &#123;</span><br><span class="line">        <span class="keyword">if</span> (loTail == <span class="literal">null</span>)</span><br><span class="line">            loHead = e;</span><br><span class="line">        <span class="keyword">else</span></span><br><span class="line">            loTail.next = e;</span><br><span class="line">        loTail = e;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> (hiTail == <span class="literal">null</span>)</span><br><span class="line">            hiHead = e;</span><br><span class="line">        <span class="keyword">else</span></span><br><span class="line">            hiTail.next = e;</span><br><span class="line">        hiTail = e;</span><br><span class="line">    &#125;</span><br><span class="line">&#125; <span class="keyword">while</span> ((e = next) != <span class="literal">null</span>);</span><br><span class="line"><span class="keyword">if</span> (loHead != <span class="literal">null</span>)</span><br><span class="line">    newTab[j] = loHead;</span><br><span class="line"><span class="keyword">if</span> (hiHead != <span class="literal">null</span>)</span><br><span class="line">    newTab[j + oldCap] = hiHead;</span><br></pre></td></tr></table></figure>
<p>ç”±äºŽæ‰©å®¹æ—¶ï¼Œæ•°ç»„é•¿åº¦ä¼šç¿»å€ï¼Œä¾‹å¦‚ï¼š16 â†’ 32ï¼Œ å› æ­¤ï¼Œæ–°æ•°ç»„çš„ç´¢å¼•èŒƒå›´æ˜¯åŽŸç´¢å¼•èŒƒå›´çš„ä¸¤å€ã€‚</p>
<p>åŽŸç´¢å¼• <code>index = (n - 1) &amp; hash</code>ï¼Œæ‰©å®¹åŽçš„æ–°ç´¢å¼•å°±æ˜¯ <code>index = (2n - 1) &amp; hash</code>ã€‚</p>
<p>ä¹Ÿå°±æ˜¯è¯´ï¼Œå¦‚æžœ <code>(e.hash &amp; oldCap) == 0</code>ï¼Œå…ƒç´ åœ¨æ–°æ•°ç»„ä¸­çš„ä½ç½®ä¸Žæ—§ä½ç½®ç›¸åŒï¼›å¦åˆ™ï¼Œå…ƒç´ åœ¨æ–°æ•°ç»„ä¸­çš„ä½ç½®æ˜¯æ—§ä½ç½® + æ—§æ•°ç»„å¤§å°ã€‚</p>
<p><img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="https://cdn.jsdelivr.net/gh/JakicDong/blog-assets@main/images/20250807102739.png" alt="20250807102739"></p>
<p><img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="https://cdn.jsdelivr.net/gh/JakicDong/blog-assets@main/images/20250807102747.png" alt="20250807102747"></p>
<p>è¿™æ ·å¯ä»¥é¿å…é‡æ–°è®¡ç®—æ‰€æœ‰å…ƒç´ çš„å“ˆå¸Œå€¼ï¼Œ<strong>åªéœ€æ£€æŸ¥é«˜ä½çš„æŸä¸€ä½</strong>ï¼Œå°±å¯ä»¥å¿«é€Ÿç¡®å®šæ–°ä½ç½®ã€‚</p>
<p><img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="https://cdn.jsdelivr.net/gh/JakicDong/blog-assets@main/images/20250807102803.png" alt="20250807102803"></p>
<h4 id="æ‰©å®¹çš„æ—¶å€™æ¯ä¸ªèŠ‚ç‚¹éƒ½è¦è¿›è¡Œä½è¿ç®—å—ï¼Ÿ"><a href="#æ‰©å®¹çš„æ—¶å€™æ¯ä¸ªèŠ‚ç‚¹éƒ½è¦è¿›è¡Œä½è¿ç®—å—ï¼Ÿ" class="headerlink" title="æ‰©å®¹çš„æ—¶å€™æ¯ä¸ªèŠ‚ç‚¹éƒ½è¦è¿›è¡Œä½è¿ç®—å—ï¼Ÿ"></a>æ‰©å®¹çš„æ—¶å€™æ¯ä¸ªèŠ‚ç‚¹éƒ½è¦è¿›è¡Œä½è¿ç®—å—ï¼Ÿ</h4><p>ä¸éœ€è¦ã€‚HashMap ä¼šé€šè¿‡ <code>(e.hash &amp; oldCap)</code> æ¥åˆ¤æ–­èŠ‚ç‚¹æ˜¯å¦éœ€è¦ç§»åŠ¨ï¼Œ0 çš„è¯ä¿ç•™åŽŸç´¢å¼•ï¼›1 æ‰éœ€è¦ç§»åŠ¨åˆ°æ–°ç´¢å¼•ï¼ˆåŽŸç´¢å¼• + oldCapï¼‰ã€‚</p>
<p>è¿™æ ·å°±é¿å…äº† <code>hashCode</code> çš„é‡æ–°è®¡ç®—ï¼Œå¤§å¤§æå‡äº†æ‰©å®¹çš„æ€§èƒ½ã€‚</p>
<p>æ‰€ä»¥ï¼Œå“ªæ€•æœ‰å‡ åä¸‡æ¡æ•°æ®ï¼Œå¯èƒ½åªæœ‰ä¸€åŠçš„æ•°æ®æ‰éœ€è¦ç§»åŠ¨åˆ°æ–°ä½ç½®ã€‚å¦å¤–ï¼Œä½è¿ç®—çš„è®¡ç®—é€Ÿåº¦éžå¸¸å¿«ï¼Œå› æ­¤ï¼Œå°½ç®¡æ‰©å®¹æ“ä½œæ¶‰åŠåˆ°éåŽ†æ•´ä¸ªå“ˆå¸Œè¡¨å¹¶å¯¹æ¯ä¸ªèŠ‚ç‚¹è¿›è¡Œåˆ¤æ–­ï¼Œä½†è¿™éƒ¨åˆ†æ“ä½œçš„è®¡ç®—æˆæœ¬æ˜¯ç›¸å¯¹è¾ƒä½Žçš„ã€‚</p>
<h3 id="24-ðŸŒŸHashMap-æ˜¯çº¿ç¨‹å®‰å…¨çš„å—ï¼Ÿ"><a href="#24-ðŸŒŸHashMap-æ˜¯çº¿ç¨‹å®‰å…¨çš„å—ï¼Ÿ" class="headerlink" title="24.ðŸŒŸHashMap æ˜¯çº¿ç¨‹å®‰å…¨çš„å—ï¼Ÿ"></a>24.ðŸŒŸHashMap æ˜¯çº¿ç¨‹å®‰å…¨çš„å—ï¼Ÿ</h3><p>æŽ¨èé˜…è¯»ï¼š<a target="_blank" rel="noopener" href="https://javabetter.cn/collection/hashmap.html#_04%E3%80%81%E7%BA%BF%E7%A8%8B%E4%B8%8D%E5%AE%89%E5%85%A8">HashMap è¯¦è§£</a></p>
<p>HashMap ä¸æ˜¯çº¿ç¨‹å®‰å…¨çš„ï¼Œä¸»è¦æœ‰ä»¥ä¸‹å‡ ä¸ªé—®é¢˜ï¼š</p>
<p>â‘ ã€å¤šçº¿ç¨‹ä¸‹æ‰©å®¹ä¼šæ­»å¾ªçŽ¯ã€‚JDK7 ä¸­çš„ HashMap ä½¿ç”¨çš„æ˜¯å¤´æ’æ³•æ¥å¤„ç†é“¾è¡¨ï¼Œåœ¨å¤šçº¿ç¨‹çŽ¯å¢ƒä¸‹æ‰©å®¹ä¼šå‡ºçŽ°çŽ¯å½¢é“¾è¡¨ï¼Œé€ æˆæ­»å¾ªçŽ¯ã€‚</p>
<p><img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="https://cdn.jsdelivr.net/gh/JakicDong/blog-assets@main/images/20250807103405.png" alt="20250807103405"></p>
<p>ä¸è¿‡ï¼ŒJDK 8 æ—¶é€šè¿‡å°¾æ’æ³•ä¿®å¤äº†è¿™ä¸ªé—®é¢˜ï¼Œæ‰©å®¹æ—¶ä¼šä¿æŒé“¾è¡¨åŽŸæ¥çš„é¡ºåºã€‚</p>
<p>â‘¡ã€å¤šçº¿ç¨‹åœ¨è¿›è¡Œ put å…ƒç´ çš„æ—¶å€™ï¼Œå¯èƒ½ä¼šå¯¼è‡´å…ƒç´ ä¸¢å¤±ã€‚å› ä¸ºè®¡ç®—å‡ºæ¥çš„ä½ç½®å¯èƒ½ä¼šè¢«å…¶ä»–çº¿ç¨‹è¦†ç›–æŽ‰ï¼Œæ¯”å¦‚è¯´ä¸€ä¸ªåŽ¿åŸŽ put 3 çš„æ—¶å€™ï¼Œå¦å¤–ä¸€ä¸ªçº¿ç¨‹ put äº† 7ï¼Œå°±æŠŠ 3 ç»™å¼„ä¸¢äº†ã€‚</p>
<p><img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="https://cdn.jsdelivr.net/gh/JakicDong/blog-assets@main/images/20250807103452.png" alt="20250807103452"></p>
<p>â‘¢ã€put å’Œ get å¹¶å‘æ—¶ï¼Œå¯èƒ½å¯¼è‡´ get ä¸º nullã€‚çº¿ç¨‹ 1 æ‰§è¡Œ put æ—¶ï¼Œå› ä¸ºå…ƒç´ ä¸ªæ•°è¶…å‡ºé˜ˆå€¼è€Œæ‰©å®¹ï¼Œçº¿ç¨‹ 2 æ­¤æ—¶æ‰§è¡Œ getï¼Œå°±æœ‰å¯èƒ½å‡ºçŽ°è¿™ä¸ªé—®é¢˜ã€‚</p>
<p><img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="https://cdn.jsdelivr.net/gh/JakicDong/blog-assets@main/images/20250807103509.png" alt="20250807103509"></p>
<p>å› ä¸ºçº¿ç¨‹ 1 æ‰§è¡Œå®Œ table &#x3D; newTab ä¹‹åŽï¼Œçº¿ç¨‹ 2 ä¸­çš„ table å·²ç»å‘ç”Ÿäº†æ”¹å˜ï¼Œæ¯”å¦‚è¯´ç´¢å¼• 3 çš„é”®å€¼å¯¹ç§»åŠ¨åˆ°äº†ç´¢å¼• 7 çš„ä½ç½®ï¼Œæ­¤æ—¶çº¿ç¨‹ 2 åŽ» get ç´¢å¼• 3 çš„å…ƒç´ å°± get ä¸åˆ°äº†ã€‚</p>
<h3 id="25-ðŸŒŸæ€Žä¹ˆè§£å†³-HashMap-çº¿ç¨‹ä¸å®‰å…¨çš„é—®é¢˜å‘¢ï¼Ÿ"><a href="#25-ðŸŒŸæ€Žä¹ˆè§£å†³-HashMap-çº¿ç¨‹ä¸å®‰å…¨çš„é—®é¢˜å‘¢ï¼Ÿ" class="headerlink" title="25.ðŸŒŸæ€Žä¹ˆè§£å†³ HashMap çº¿ç¨‹ä¸å®‰å…¨çš„é—®é¢˜å‘¢ï¼Ÿ"></a>25.ðŸŒŸæ€Žä¹ˆè§£å†³ HashMap çº¿ç¨‹ä¸å®‰å…¨çš„é—®é¢˜å‘¢ï¼Ÿ</h3><p>åœ¨æ—©æœŸçš„ JDK ç‰ˆæœ¬ä¸­ï¼Œå¯ä»¥ç”¨ <code>Hashtable</code> æ¥ä¿è¯çº¿ç¨‹å®‰å…¨ã€‚<code>Hashtable</code> åœ¨æ–¹æ³•ä¸ŠåŠ äº†Â <a target="_blank" rel="noopener" href="https://javabetter.cn/thread/synchronized-1.html">synchronized å…³é”®å­—</a>ã€‚</p>
<p><img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="https://cdn.jsdelivr.net/gh/JakicDong/blog-assets@main/images/20250807103648.png" alt="20250807103648"></p>
<p>å¦å¤–ï¼Œå¯ä»¥é€šè¿‡ <code>Collections.synchronizedMap</code> æ–¹æ³•è¿”å›žä¸€ä¸ªçº¿ç¨‹å®‰å…¨çš„ Mapï¼Œå†…éƒ¨æ˜¯é€šè¿‡ <code>synchronized</code> å¯¹è±¡é”æ¥ä¿è¯çº¿ç¨‹å®‰å…¨çš„ï¼Œæ¯”åœ¨æ–¹æ³•ä¸Šç›´æŽ¥åŠ  <code>synchronized</code> å…³é”®å­—æ›´è½»é‡çº§ã€‚</p>
<p><img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="https://cdn.jsdelivr.net/gh/JakicDong/blog-assets@main/images/20250807103717.png" alt="20250807103717"></p>
<p>æ›´ä¼˜é›…çš„è§£å†³æ–¹æ¡ˆæ˜¯ä½¿ç”¨å¹¶å‘å·¥å…·åŒ…ä¸‹çš„Â <a target="_blank" rel="noopener" href="https://javabetter.cn/thread/ConcurrentHashMap.html">ConcurrentHashMap</a>ï¼Œä½¿ç”¨äº†<a target="_blank" rel="noopener" href="https://javabetter.cn/thread/cas.html">CAS</a>+Â <a target="_blank" rel="noopener" href="https://javabetter.cn/thread/synchronized-1.html">synchronized å…³é”®å­—</a>æ¥ä¿è¯çº¿ç¨‹å®‰å…¨ã€‚<br>(åˆ†æ®µé”+CAS)<br><img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="https://cdn.jsdelivr.net/gh/JakicDong/blog-assets@main/images/20250807103755.png" alt="20250807103755"></p>
<h2 id="Javaå¹¶å‘ç¼–ç¨‹"><a href="#Javaå¹¶å‘ç¼–ç¨‹" class="headerlink" title="Javaå¹¶å‘ç¼–ç¨‹"></a>Javaå¹¶å‘ç¼–ç¨‹</h2><h3 id="2-ðŸŒŸè¯´è¯´è¿›ç¨‹å’Œçº¿ç¨‹çš„åŒºåˆ«ï¼Ÿ"><a href="#2-ðŸŒŸè¯´è¯´è¿›ç¨‹å’Œçº¿ç¨‹çš„åŒºåˆ«ï¼Ÿ" class="headerlink" title="2.ðŸŒŸè¯´è¯´è¿›ç¨‹å’Œçº¿ç¨‹çš„åŒºåˆ«ï¼Ÿ"></a>2.ðŸŒŸè¯´è¯´è¿›ç¨‹å’Œçº¿ç¨‹çš„åŒºåˆ«ï¼Ÿ</h3><p>æŽ¨èé˜…è¯»:<a target="_blank" rel="noopener" href="https://javabetter.cn/thread/why-need-thread.html">è¿›ç¨‹ä¸Žçº¿ç¨‹çš„åŒºåˆ«æ˜¯ä»€ä¹ˆï¼Ÿ</a></p>
<p><code>è¿›ç¨‹</code>è¯´ç®€å•ç‚¹å°±æ˜¯æˆ‘ä»¬åœ¨ç”µè„‘ä¸Šå¯åŠ¨çš„ä¸€ä¸ªä¸ªåº”ç”¨ã€‚å®ƒæ˜¯æ“ä½œç³»ç»Ÿåˆ†é…èµ„æºçš„æœ€å°å•ä½ã€‚</p>
<p><code>çº¿ç¨‹</code>æ˜¯è¿›ç¨‹ä¸­çš„ç‹¬ç«‹æ‰§è¡Œå•å…ƒã€‚å¤šä¸ªçº¿ç¨‹å¯ä»¥å…±äº«åŒä¸€ä¸ªè¿›ç¨‹çš„èµ„æºï¼Œå¦‚å†…å­˜ï¼›æ¯ä¸ªçº¿ç¨‹éƒ½æœ‰è‡ªå·±ç‹¬ç«‹çš„æ ˆå’Œå¯„å­˜å™¨ã€‚</p>
<p><img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="https://cdn.jsdelivr.net/gh/JakicDong/blog-assets@main/images/20250808104808.png" alt="20250808104808"></p>
<h4 id="å¦‚ä½•ç†è§£åç¨‹ï¼Ÿ"><a href="#å¦‚ä½•ç†è§£åç¨‹ï¼Ÿ" class="headerlink" title="å¦‚ä½•ç†è§£åç¨‹ï¼Ÿ"></a>å¦‚ä½•ç†è§£åç¨‹ï¼Ÿ</h4><p><code>åç¨‹</code>è¢«è§†ä¸ºæ¯”çº¿ç¨‹æ›´è½»é‡çº§çš„å¹¶å‘å•å…ƒï¼Œå¯ä»¥åœ¨å•çº¿ç¨‹ä¸­å®žçŽ°å¹¶å‘æ‰§è¡Œï¼Œç”±æˆ‘ä»¬å¼€å‘è€…æ˜¾å¼è°ƒåº¦ã€‚</p>
<p><code>åç¨‹</code>æ˜¯åœ¨ç”¨æˆ·æ€è¿›è¡Œè°ƒåº¦çš„ï¼Œé¿å…äº†çº¿ç¨‹åˆ‡æ¢æ—¶çš„å†…æ ¸æ€å¼€é”€ã€‚</p>
<p><code>Java</code> è‡ªèº«æ˜¯ä¸æ”¯æŒæºç¨‹çš„ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨ <code>Quasar</code>ã€<code>Kotlin</code> ç­‰æ¡†æž¶æ¥å®žçŽ°åç¨‹ã€‚</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">fun <span class="title function_">main</span><span class="params">()</span> = runBlocking &#123;</span><br><span class="line">    launch &#123;</span><br><span class="line">        delay(<span class="number">1000L</span>)</span><br><span class="line">        println(<span class="string">&quot;World!&quot;</span>)</span><br><span class="line">    &#125;</span><br><span class="line">    println(<span class="string">&quot;Hello,&quot;</span>)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="çº¿ç¨‹é—´æ˜¯å¦‚ä½•è¿›è¡Œé€šä¿¡çš„ï¼Ÿ"><a href="#çº¿ç¨‹é—´æ˜¯å¦‚ä½•è¿›è¡Œé€šä¿¡çš„ï¼Ÿ" class="headerlink" title="çº¿ç¨‹é—´æ˜¯å¦‚ä½•è¿›è¡Œé€šä¿¡çš„ï¼Ÿ"></a>çº¿ç¨‹é—´æ˜¯å¦‚ä½•è¿›è¡Œé€šä¿¡çš„ï¼Ÿ</h4><p>åŽŸåˆ™ä¸Šå¯ä»¥é€šè¿‡<strong>æ¶ˆæ¯ä¼ é€’</strong>å’Œ<strong>å…±äº«å†…å­˜</strong>ä¸¤ç§æ–¹æ³•æ¥å®žçŽ°ã€‚<code>Java</code> é‡‡ç”¨çš„æ˜¯å…±äº«å†…å­˜çš„å¹¶å‘æ¨¡åž‹ã€‚</p>
<p>è¿™ä¸ªæ¨¡åž‹è¢«ç§°ä¸º <code>Java</code> å†…å­˜æ¨¡åž‹ï¼Œç®€å†™ä¸º <code>JMM</code>ï¼Œå®ƒå†³å®šäº†ä¸€ä¸ªçº¿ç¨‹å¯¹å…±äº«å˜é‡çš„å†™å…¥ï¼Œä½•æ—¶å¯¹å¦å¤–ä¸€ä¸ªçº¿ç¨‹å¯è§ã€‚å½“ç„¶äº†ï¼Œæœ¬åœ°å†…å­˜æ˜¯ <code>JMM</code> çš„ä¸€ä¸ªæŠ½è±¡æ¦‚å¿µï¼Œå¹¶ä¸çœŸå®žå­˜åœ¨ã€‚</p>
<p>ç”¨ä¸€å¥è¯æ¥æ¦‚æ‹¬å°±æ˜¯ï¼š<strong>å…±äº«å˜é‡</strong>å­˜å‚¨åœ¨ä¸»å†…å­˜ä¸­ï¼Œæ¯ä¸ªçº¿ç¨‹çš„ç§æœ‰æœ¬åœ°å†…å­˜ï¼Œå­˜å‚¨çš„æ˜¯è¿™ä¸ª<strong>å…±äº«å˜é‡çš„å‰¯æœ¬</strong>ã€‚</p>
<p><img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="https://cdn.jsdelivr.net/gh/JakicDong/blog-assets@main/images/20250808105242.png" alt="20250808105242"></p>
<p>çº¿ç¨‹ A ä¸Žçº¿ç¨‹ B ä¹‹é—´å¦‚è¦é€šä¿¡ï¼Œéœ€è¦è¦ç»åŽ† 2 ä¸ªæ­¥éª¤ï¼š</p>
<ol>
<li>çº¿ç¨‹ A æŠŠæœ¬åœ°å†…å­˜ A ä¸­çš„å…±äº«å˜é‡å‰¯æœ¬åˆ·æ–°åˆ°ä¸»å†…å­˜ä¸­ã€‚</li>
<li>çº¿ç¨‹ B åˆ°ä¸»å†…å­˜ä¸­è¯»å–çº¿ç¨‹ A åˆ·æ–°è¿‡çš„å…±äº«å˜é‡ï¼Œå†åŒæ­¥åˆ°è‡ªå·±çš„å…±äº«å˜é‡å‰¯æœ¬ä¸­ã€‚</li>
</ol>
<p><img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="https://cdn.jsdelivr.net/gh/JakicDong/blog-assets@main/images/20250808110938.png" alt="20250808110938"></p>
<h3 id="3-ðŸŒŸè¯´è¯´çº¿ç¨‹æœ‰å‡ ç§åˆ›å»ºæ–¹å¼ï¼Ÿ"><a href="#3-ðŸŒŸè¯´è¯´çº¿ç¨‹æœ‰å‡ ç§åˆ›å»ºæ–¹å¼ï¼Ÿ" class="headerlink" title="3.ðŸŒŸè¯´è¯´çº¿ç¨‹æœ‰å‡ ç§åˆ›å»ºæ–¹å¼ï¼Ÿ"></a>3.ðŸŒŸè¯´è¯´çº¿ç¨‹æœ‰å‡ ç§åˆ›å»ºæ–¹å¼ï¼Ÿ</h3><p>æŽ¨èé˜…è¯»ï¼š<a target="_blank" rel="noopener" href="https://javabetter.cn/thread/wangzhe-thread.html">å®¤å‹æ‰“äº†ä¸€æŠŠçŽ‹è€…å°±å­¦ä¼šäº† Java å¤šçº¿ç¨‹</a></p>
<p>æœ‰ä¸‰ç§ï¼Œåˆ†åˆ«æ˜¯ç»§æ‰¿ <code>Thread</code> ç±»ã€å®žçŽ° <code>Runnable</code> æŽ¥å£ã€å®žçŽ° <code>Callable</code> æŽ¥å£ã€‚</p>
<p><img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="https://cdn.jsdelivr.net/gh/JakicDong/blog-assets@main/images/20250808111222.png" alt="20250808111222"></p>
<p>ç¬¬ä¸€ç§éœ€è¦é‡å†™çˆ¶ç±» <code>Thread</code> çš„ <code>run()</code> æ–¹æ³•ï¼Œå¹¶ä¸”è°ƒç”¨ <code>start()</code> æ–¹æ³•å¯åŠ¨çº¿ç¨‹ã€‚</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">ThreadTask</span> <span class="keyword">extends</span> <span class="title class_">Thread</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">run</span><span class="params">()</span> &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;çœ‹å®ŒäºŒå“¥çš„ Java è¿›é˜¶ä¹‹è·¯ï¼Œä¸Šå²¸äº†!&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        <span class="type">ThreadTask</span> <span class="variable">task</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ThreadTask</span>();</span><br><span class="line">        task.start();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>è¿™ç§æ–¹æ³•çš„ç¼ºç‚¹æ˜¯ï¼Œå¦‚æžœ <code>ThreadTask</code> å·²ç»ç»§æ‰¿äº†å¦å¤–ä¸€ä¸ªç±»ï¼Œå°±ä¸èƒ½å†ç»§æ‰¿ <code>Thread</code> ç±»äº†ï¼Œå› ä¸º <code>Java</code> ä¸æ”¯æŒå¤šé‡ç»§æ‰¿ã€‚</p>
<p>ç¬¬äºŒç§éœ€è¦é‡å†™ <code>Runnable</code> æŽ¥å£çš„ <code>run()</code> æ–¹æ³•ï¼Œå¹¶å°†å®žçŽ°ç±»çš„å¯¹è±¡ä½œä¸ºå‚æ•°ä¼ é€’ç»™ <code>Thread</code> å¯¹è±¡çš„æž„é€ æ–¹æ³•ï¼Œæœ€åŽè°ƒç”¨ <code>start()</code> æ–¹æ³•å¯åŠ¨çº¿ç¨‹ã€‚</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">RunnableTask</span> <span class="keyword">implements</span> <span class="title class_">Runnable</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">run</span><span class="params">()</span> &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;çœ‹å®ŒäºŒå“¥çš„ Java è¿›é˜¶ä¹‹è·¯ï¼Œä¸Šå²¸äº†!&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        <span class="type">RunnableTask</span> <span class="variable">task</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">RunnableTask</span>();</span><br><span class="line">        <span class="type">Thread</span> <span class="variable">thread</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Thread</span>(task);</span><br><span class="line">        thread.start();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>è¿™ç§æ–¹æ³•çš„ä¼˜ç‚¹æ˜¯å¯ä»¥é¿å… <code>Java</code> çš„å•ç»§æ‰¿é™åˆ¶ï¼Œå¹¶ä¸”æ›´ç¬¦åˆé¢å‘å¯¹è±¡çš„ç¼–ç¨‹æ€æƒ³ï¼Œå› ä¸º <code>Runnable</code> æŽ¥å£å°†ä»»åŠ¡ä»£ç å’Œçº¿ç¨‹æŽ§åˆ¶çš„ä»£ç è§£è€¦äº†ã€‚</p>
<p>ç¬¬ä¸‰ç§éœ€è¦é‡å†™ <code>Callable</code> æŽ¥å£çš„ <code>call()</code> æ–¹æ³•ï¼Œç„¶åŽåˆ›å»º <code>FutureTask</code> å¯¹è±¡ï¼Œå‚æ•°ä¸º <code>Callable</code> å®žçŽ°ç±»çš„å¯¹è±¡ï¼›ç´§æŽ¥ç€åˆ›å»º <code>Thread</code> å¯¹è±¡ï¼Œå‚æ•°ä¸º <code>FutureTask</code> å¯¹è±¡ï¼Œæœ€åŽè°ƒç”¨ <code>start()</code> æ–¹æ³•å¯åŠ¨çº¿ç¨‹ã€‚</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">CallableTask</span> <span class="keyword">implements</span> <span class="title class_">Callable</span>&lt;String&gt; &#123;</span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">call</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;çœ‹å®ŒäºŒå“¥çš„ Java è¿›é˜¶ä¹‹è·¯ï¼Œä¸Šå²¸äº†!&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> ExecutionException, InterruptedException &#123;</span><br><span class="line">        <span class="type">CallableTask</span> <span class="variable">task</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">CallableTask</span>();</span><br><span class="line">        FutureTask&lt;String&gt; futureTask = <span class="keyword">new</span> <span class="title class_">FutureTask</span>&lt;&gt;(task);</span><br><span class="line">        <span class="type">Thread</span> <span class="variable">thread</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Thread</span>(futureTask);</span><br><span class="line">        thread.start();</span><br><span class="line">        System.out.println(futureTask.get());</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>è¿™ç§æ–¹æ³•çš„ä¼˜ç‚¹æ˜¯å¯ä»¥èŽ·å–çº¿ç¨‹çš„æ‰§è¡Œç»“æžœã€‚</p>
<h4 id="ä¸€ä¸ª-8G-å†…å­˜çš„ç³»ç»Ÿæœ€å¤šèƒ½åˆ›å»ºå¤šå°‘ä¸ªçº¿ç¨‹"><a href="#ä¸€ä¸ª-8G-å†…å­˜çš„ç³»ç»Ÿæœ€å¤šèƒ½åˆ›å»ºå¤šå°‘ä¸ªçº¿ç¨‹" class="headerlink" title="ä¸€ä¸ª 8G å†…å­˜çš„ç³»ç»Ÿæœ€å¤šèƒ½åˆ›å»ºå¤šå°‘ä¸ªçº¿ç¨‹?"></a>ä¸€ä¸ª 8G å†…å­˜çš„ç³»ç»Ÿæœ€å¤šèƒ½åˆ›å»ºå¤šå°‘ä¸ªçº¿ç¨‹?</h4><p>æŽ¨èé˜…è¯»ï¼š<a target="_blank" rel="noopener" href="https://javabetter.cn/jvm/neicun-jiegou.html">æ·±å…¥ç†è§£ JVM çš„è¿è¡Œæ—¶æ•°æ®åŒº</a></p>
<p>ç†è®ºä¸Šå¤§çº¦ <code>8000</code> ä¸ªã€‚</p>
<p>åˆ›å»ºçº¿ç¨‹çš„æ—¶å€™ï¼Œè‡³å°‘éœ€è¦åˆ†é…ä¸€ä¸ªè™šæ‹Ÿæœºæ ˆï¼Œåœ¨ 64 ä½æ“ä½œç³»ç»Ÿä¸­ï¼Œé»˜è®¤å¤§å°ä¸º <code>1M</code>ï¼Œå› æ­¤ä¸€ä¸ªçº¿ç¨‹å¤§çº¦éœ€è¦ <code>1M</code> çš„å†…å­˜ã€‚</p>
<p>ä½† <code>JVM</code>ã€æ“ä½œç³»ç»Ÿæœ¬èº«çš„è¿è¡Œå°±è¦å ä¸€å®šçš„å†…å­˜ç©ºé—´ï¼Œæ‰€ä»¥å®žé™…ä¸Šå¯ä»¥åˆ›å»ºçš„çº¿ç¨‹æ•°è¿œæ¯” <code>8000</code> å°‘ã€‚</p>
<p>è¯¦ç»†è§£é‡Šä¸€ä¸‹ã€‚</p>
<p>å¯ä»¥é€šè¿‡Â <code>java -XX:+PrintFlagsFinal -version | grep ThreadStackSize</code>Â å‘½ä»¤æŸ¥çœ‹ JVM æ ˆçš„é»˜è®¤å¤§å°ã€‚</p>
<p><img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="https://cdn.jsdelivr.net/gh/JakicDong/blog-assets@main/images/20250808141237.png" alt="20250808141237"></p>
<p>å…¶ä¸­ <code>ThreadStackSize</code> çš„å•ä½æ˜¯ <code>KB</code>ï¼Œä¹Ÿå°±æ˜¯è¯´é»˜è®¤çš„ <code>JVM</code> æ ˆå¤§å°æ˜¯ <code>1024 KB</code>ï¼Œä¹Ÿå°±æ˜¯ <code>1M</code>ã€‚</p>
<h4 id="å¯åŠ¨ä¸€ä¸ª-Java-ç¨‹åºï¼Œä½ èƒ½è¯´è¯´é‡Œé¢æœ‰å“ªäº›çº¿ç¨‹å—ï¼Ÿ"><a href="#å¯åŠ¨ä¸€ä¸ª-Java-ç¨‹åºï¼Œä½ èƒ½è¯´è¯´é‡Œé¢æœ‰å“ªäº›çº¿ç¨‹å—ï¼Ÿ" class="headerlink" title="å¯åŠ¨ä¸€ä¸ª Java ç¨‹åºï¼Œä½ èƒ½è¯´è¯´é‡Œé¢æœ‰å“ªäº›çº¿ç¨‹å—ï¼Ÿ"></a>å¯åŠ¨ä¸€ä¸ª Java ç¨‹åºï¼Œä½ èƒ½è¯´è¯´é‡Œé¢æœ‰å“ªäº›çº¿ç¨‹å—ï¼Ÿ</h4><p>é¦–å…ˆæ˜¯ <code>main</code> çº¿ç¨‹ï¼Œè¿™æ˜¯ç¨‹åºæ‰§è¡Œçš„å…¥å£ã€‚</p>
<p>ç„¶åŽæ˜¯<code>åžƒåœ¾å›žæ”¶çº¿ç¨‹</code>ï¼Œå®ƒæ˜¯ä¸€ä¸ªåŽå°çº¿ç¨‹ï¼Œè´Ÿè´£å›žæ”¶ä¸å†ä½¿ç”¨çš„å¯¹è±¡ã€‚</p>
<p>è¿˜æœ‰<code>ç¼–è¯‘å™¨çº¿ç¨‹</code>ï¼Œæ¯”å¦‚ <code>JIT</code>ï¼Œè´Ÿè´£æŠŠä¸€éƒ¨åˆ†çƒ­ç‚¹ä»£ç ç¼–è¯‘åŽæ”¾åˆ° <code>codeCache</code> ä¸­ã€‚</p>
<p><img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="https://cdn.jsdelivr.net/gh/JakicDong/blog-assets@main/images/20250808142112.png" alt="20250808142112"></p>
<p>å¯ä»¥é€šè¿‡ä¸‹é¢çš„ä»£ç è¿›è¡Œæ£€æµ‹ï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">ThreadLister</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        <span class="comment">// èŽ·å–æ‰€æœ‰çº¿ç¨‹çš„å †æ ˆè·Ÿè¸ª</span></span><br><span class="line">        Map&lt;Thread, StackTraceElement[]&gt; threads = Thread.getAllStackTraces();</span><br><span class="line">        <span class="keyword">for</span> (Thread thread : threads.keySet()) &#123;</span><br><span class="line">            System.out.println(<span class="string">&quot;Thread: &quot;</span> + thread.getName() + <span class="string">&quot; (ID=&quot;</span> + thread.getId() + <span class="string">&quot;)&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>ç»“æžœå¦‚ä¸‹æ‰€ç¤ºï¼š</p>
<figure class="highlight txt"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">Thread: Monitor Ctrl-Break (ID=5)</span><br><span class="line">Thread: Reference Handler (ID=2)</span><br><span class="line">Thread: main (ID=1)</span><br><span class="line">Thread: Signal Dispatcher (ID=4)</span><br><span class="line">Thread: Finalizer (ID=3)</span><br></pre></td></tr></table></figure>

<p>ç®€å•è§£é‡Šä¸‹ï¼š</p>
<ul>
<li><code>Thread: main (ID=1)</code> - ä¸»çº¿ç¨‹ï¼ŒJava ç¨‹åºå¯åŠ¨æ—¶ç”± JVM åˆ›å»ºã€‚</li>
<li><code>Thread: Reference Handler (ID=2)</code> - è¿™ä¸ªçº¿ç¨‹æ˜¯ç”¨æ¥å¤„ç†å¼•ç”¨å¯¹è±¡çš„ï¼Œå¦‚è½¯å¼•ç”¨ã€å¼±å¼•ç”¨å’Œè™šå¼•ç”¨ã€‚è´Ÿè´£æ¸…ç†è¢« JVM å›žæ”¶çš„å¯¹è±¡ã€‚</li>
<li><code>Thread: Finalizer (ID=3)</code> - ç»ˆç»“å™¨çº¿ç¨‹ï¼Œè´Ÿè´£è°ƒç”¨å¯¹è±¡çš„ finalize æ–¹æ³•ã€‚å¯¹è±¡åœ¨åžƒåœ¾å›žæ”¶å™¨æ ‡è®°ä¸ºå¯å›žæ”¶ä¹‹å‰ï¼Œç”±è¯¥çº¿ç¨‹æ‰§è¡Œå…¶ finalize æ–¹æ³•ï¼Œç”¨äºŽæ‰§è¡Œç‰¹å®šçš„èµ„æºé‡Šæ”¾æ“ä½œã€‚</li>
<li><code>Thread: Signal Dispatcher (ID=4)</code> - ä¿¡å·è°ƒåº¦çº¿ç¨‹ï¼Œå¤„ç†æ¥è‡ªæ“ä½œç³»ç»Ÿçš„ä¿¡å·ï¼Œå°†å®ƒä»¬è½¬å‘ç»™ JVM è¿›è¡Œè¿›ä¸€æ­¥å¤„ç†ï¼Œä¾‹å¦‚å“åº”ä¸­æ–­ã€åœæ­¢ç­‰ä¿¡å·ã€‚</li>
<li><code>Thread: Monitor Ctrl-Break (ID=5)</code> - ç›‘è§†å™¨çº¿ç¨‹ï¼Œé€šå¸¸ç”±ä¸€äº›ç‰¹å®šçš„ IDE åˆ›å»ºï¼Œç”¨äºŽåœ¨å¼€å‘è¿‡ç¨‹ä¸­ç›‘æŽ§å’Œç®¡ç†ç¨‹åºæ‰§è¡Œæˆ–è€…å¤„ç†ä¸­æ–­ã€‚</li>
</ul>
<h3 id="4-ðŸŒŸè°ƒç”¨-start-æ–¹æ³•æ—¶ä¼šæ‰§è¡Œ-run-æ–¹æ³•ï¼Œé‚£æ€Žä¹ˆä¸ç›´æŽ¥è°ƒç”¨-runæ–¹æ³•ï¼Ÿ"><a href="#4-ðŸŒŸè°ƒç”¨-start-æ–¹æ³•æ—¶ä¼šæ‰§è¡Œ-run-æ–¹æ³•ï¼Œé‚£æ€Žä¹ˆä¸ç›´æŽ¥è°ƒç”¨-runæ–¹æ³•ï¼Ÿ" class="headerlink" title="4.ðŸŒŸè°ƒç”¨ start æ–¹æ³•æ—¶ä¼šæ‰§è¡Œ run æ–¹æ³•ï¼Œé‚£æ€Žä¹ˆä¸ç›´æŽ¥è°ƒç”¨ runæ–¹æ³•ï¼Ÿ"></a>4.ðŸŒŸè°ƒç”¨ start æ–¹æ³•æ—¶ä¼šæ‰§è¡Œ run æ–¹æ³•ï¼Œé‚£æ€Žä¹ˆä¸ç›´æŽ¥è°ƒç”¨ runæ–¹æ³•ï¼Ÿ</h3><p>è°ƒç”¨ <code>start()</code> ä¼šåˆ›å»ºä¸€ä¸ªæ–°çš„çº¿ç¨‹ï¼Œå¹¶å¼‚æ­¥æ‰§è¡Œ <code>run()</code> æ–¹æ³•ä¸­çš„ä»£ç ã€‚</p>
<p>ç›´æŽ¥è°ƒç”¨ <code>run()</code> æ–¹æ³•åªæ˜¯ä¸€ä¸ªæ™®é€šçš„åŒæ­¥æ–¹æ³•è°ƒç”¨ï¼Œæ‰€æœ‰ä»£ç éƒ½åœ¨å½“å‰çº¿ç¨‹ä¸­æ‰§è¡Œï¼Œ<strong>ä¸ä¼šåˆ›å»ºæ–°çº¿ç¨‹</strong>ã€‚æ²¡æœ‰æ–°çš„çº¿ç¨‹åˆ›å»ºï¼Œä¹Ÿå°±è¾¾ä¸åˆ°å¤šçº¿ç¨‹å¹¶å‘çš„ç›®çš„ã€‚</p>
<p>é€šè¿‡æ•²ä»£ç ä½“éªŒä¸€ä¸‹ã€‚</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">MyThread</span> <span class="keyword">extends</span> <span class="title class_">Thread</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">run</span><span class="params">()</span> &#123;</span><br><span class="line">        System.out.println(Thread.currentThread().getName());</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        <span class="type">MyThread</span> <span class="variable">t1</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">MyThread</span>();</span><br><span class="line">        t1.start(); <span class="comment">// æ­£ç¡®çš„æ–¹å¼ï¼Œåˆ›å»ºä¸€ä¸ªæ–°çº¿ç¨‹ï¼Œå¹¶åœ¨æ–°çº¿ç¨‹ä¸­æ‰§è¡Œ run()</span></span><br><span class="line">        t1.run(); <span class="comment">// ä»…åœ¨ä¸»çº¿ç¨‹ä¸­æ‰§è¡Œ run()ï¼Œæ²¡æœ‰åˆ›å»ºæ–°çº¿ç¨‹</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>æ¥çœ‹è¾“å‡ºç»“æžœï¼š</p>
<figure class="highlight txt"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">main</span><br><span class="line">Thread-0</span><br></pre></td></tr></table></figure>

<p>ä¹Ÿå°±æ˜¯è¯´ï¼Œè°ƒç”¨ <code>start()</code> æ–¹æ³•ä¼šé€šçŸ¥ <code>JVM</code>ï¼ŒåŽ»è°ƒç”¨åº•å±‚çš„çº¿ç¨‹è°ƒåº¦æœºåˆ¶æ¥å¯åŠ¨æ–°çº¿ç¨‹ã€‚</p>
<p><img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="https://cdn.jsdelivr.net/gh/JakicDong/blog-assets@main/images/20250809102015.png" alt="20250809102015"></p>
<p>è°ƒç”¨ <code>start()</code> åŽï¼Œçº¿ç¨‹è¿›å…¥å°±ç»ªçŠ¶æ€ï¼Œç­‰å¾…æ“ä½œç³»ç»Ÿè°ƒåº¦ï¼›ä¸€æ—¦è°ƒåº¦æ‰§è¡Œï¼Œçº¿ç¨‹ä¼šæ‰§è¡Œå…¶ <code>run()</code> æ–¹æ³•ä¸­çš„ä»£ç ã€‚</p>
<h3 id="6-ðŸŒŸçº¿ç¨‹æœ‰å‡ ç§çŠ¶æ€ï¼Ÿ"><a href="#6-ðŸŒŸçº¿ç¨‹æœ‰å‡ ç§çŠ¶æ€ï¼Ÿ" class="headerlink" title="6.ðŸŒŸçº¿ç¨‹æœ‰å‡ ç§çŠ¶æ€ï¼Ÿ"></a>6.ðŸŒŸçº¿ç¨‹æœ‰å‡ ç§çŠ¶æ€ï¼Ÿ</h3><p>6 ç§ã€‚</p>
<ul>
<li><code>new</code> ä»£è¡¨çº¿ç¨‹è¢«åˆ›å»ºä½†æœªå¯åŠ¨ï¼›</li>
<li><code>runnable</code> ä»£è¡¨çº¿ç¨‹å¤„äºŽå°±ç»ªæˆ–æ­£åœ¨è¿è¡ŒçŠ¶æ€ï¼Œç”±æ“ä½œç³»ç»Ÿè°ƒåº¦ï¼›</li>
<li><code>blocked</code> ä»£è¡¨çº¿ç¨‹è¢«é˜»å¡žï¼Œç­‰å¾…èŽ·å–é”ï¼›</li>
<li><code>waiting</code> ä»£è¡¨çº¿ç¨‹ç­‰å¾…å…¶ä»–çº¿ç¨‹çš„é€šçŸ¥æˆ–ä¸­æ–­ï¼›</li>
<li><code>timed_waiting</code> ä»£è¡¨çº¿ç¨‹ä¼šç­‰å¾…ä¸€æ®µæ—¶é—´ï¼Œè¶…æ—¶åŽè‡ªåŠ¨æ¢å¤ï¼›</li>
<li><code>terminated</code> ä»£è¡¨çº¿ç¨‹æ‰§è¡Œå®Œæ¯•ï¼Œç”Ÿå‘½å‘¨æœŸç»“æŸã€‚</li>
</ul>
<p><img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="https://cdn.jsdelivr.net/gh/JakicDong/blog-assets@main/images/20250809104257.png" alt="20250809104257"></p>
<p>ä¹Ÿå°±æ˜¯è¯´ï¼Œçº¿ç¨‹çš„ç”Ÿå‘½å‘¨æœŸå¯ä»¥åˆ†ä¸ºäº”ä¸ªä¸»è¦é˜¶æ®µï¼šæ–°å»ºã€å°±ç»ªã€è¿è¡Œã€é˜»å¡žå’Œç»ˆæ­¢ã€‚çº¿ç¨‹åœ¨è¿è¡Œè¿‡ç¨‹ä¸­ä¼šæ ¹æ®çŠ¶æ€çš„å˜åŒ–åœ¨è¿™äº›é˜¶æ®µä¹‹é—´åˆ‡æ¢ã€‚</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">ThreadStateExample</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> InterruptedException &#123;</span><br><span class="line">        <span class="type">Thread</span> <span class="variable">thread</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Thread</span>(() -&gt; &#123;</span><br><span class="line">            <span class="keyword">try</span> &#123;</span><br><span class="line">                Thread.sleep(<span class="number">2000</span>); <span class="comment">// TIMED_WAITING</span></span><br><span class="line">                <span class="keyword">synchronized</span> (ThreadStateExample.class) &#123;</span><br><span class="line">                    ThreadStateExample.class.wait(); <span class="comment">// WAITING</span></span><br><span class="line">                &#125;</span><br><span class="line">            &#125; <span class="keyword">catch</span> (InterruptedException e) &#123;</span><br><span class="line">                Thread.currentThread().interrupt();</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;);</span><br><span class="line"></span><br><span class="line">        System.out.println(<span class="string">&quot;State after creation: &quot;</span> + thread.getState()); <span class="comment">// NEW</span></span><br><span class="line"></span><br><span class="line">        thread.start();</span><br><span class="line">        System.out.println(<span class="string">&quot;State after start: &quot;</span> + thread.getState()); <span class="comment">// RUNNABLE</span></span><br><span class="line"></span><br><span class="line">        Thread.sleep(<span class="number">500</span>);</span><br><span class="line">        System.out.println(<span class="string">&quot;State while sleeping: &quot;</span> + thread.getState()); <span class="comment">// TIMED_WAITING</span></span><br><span class="line"></span><br><span class="line">        <span class="keyword">synchronized</span> (ThreadStateExample.class) &#123;</span><br><span class="line">            ThreadStateExample.class.notify(); <span class="comment">// å”¤é†’çº¿ç¨‹</span></span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        thread.join();</span><br><span class="line">        System.out.println(<span class="string">&quot;State after termination: &quot;</span> + thread.getState()); <span class="comment">// TERMINATED</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>ç”¨ä¸€ä¸ªè¡¨æ ¼æ¥åšä¸ªæ€»ç»“ï¼š</p>
<p><img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="https://cdn.jsdelivr.net/gh/JakicDong/blog-assets@main/images/20250809104355.png" alt="20250809104355"></p>
<h4 id="å¦‚ä½•å¼ºåˆ¶ç»ˆæ­¢çº¿ç¨‹ï¼Ÿ"><a href="#å¦‚ä½•å¼ºåˆ¶ç»ˆæ­¢çº¿ç¨‹ï¼Ÿ" class="headerlink" title="å¦‚ä½•å¼ºåˆ¶ç»ˆæ­¢çº¿ç¨‹ï¼Ÿ"></a>å¦‚ä½•å¼ºåˆ¶ç»ˆæ­¢çº¿ç¨‹ï¼Ÿ</h4><p>ç¬¬ä¸€æ­¥ï¼Œè°ƒç”¨çº¿ç¨‹çš„ <code>interrupt()</code> æ–¹æ³•ï¼Œè¯·æ±‚ç»ˆæ­¢çº¿ç¨‹ã€‚</p>
<p>ç¬¬äºŒæ­¥ï¼Œåœ¨çº¿ç¨‹çš„ <code>run()</code> æ–¹æ³•ä¸­æ£€æŸ¥ä¸­æ–­çŠ¶æ€ï¼Œå¦‚æžœçº¿ç¨‹è¢«ä¸­æ–­ï¼Œå°±é€€å‡ºçº¿ç¨‹ã€‚</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">MyTask</span> <span class="keyword">implements</span> <span class="title class_">Runnable</span> &#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">run</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">while</span> (!Thread.currentThread().isInterrupted()) &#123;</span><br><span class="line">            <span class="keyword">try</span> &#123;</span><br><span class="line">                System.out.println(<span class="string">&quot;Running...&quot;</span>);</span><br><span class="line">                Thread.sleep(<span class="number">1000</span>); <span class="comment">// æ¨¡æ‹Ÿå·¥ä½œ</span></span><br><span class="line">            &#125; <span class="keyword">catch</span> (InterruptedException e) &#123;</span><br><span class="line">                <span class="comment">// æ•èŽ·ä¸­æ–­å¼‚å¸¸åŽï¼Œé‡ç½®ä¸­æ–­çŠ¶æ€</span></span><br><span class="line">                Thread.currentThread().interrupt();</span><br><span class="line">                System.out.println(<span class="string">&quot;Thread interrupted, exiting...&quot;</span>);</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Main</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> InterruptedException &#123;</span><br><span class="line">        <span class="type">Thread</span> <span class="variable">thread</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Thread</span>(<span class="keyword">new</span> <span class="title class_">MyTask</span>());</span><br><span class="line">        thread.start();</span><br><span class="line">        Thread.sleep(<span class="number">3000</span>); <span class="comment">// ä¸»çº¿ç¨‹ç­‰å¾…3ç§’</span></span><br><span class="line">        thread.interrupt(); <span class="comment">// è¯·æ±‚ç»ˆæ­¢çº¿ç¨‹</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>ä¸­æ–­ç»“æžœï¼š  </p>
<p><img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="https://cdn.jsdelivr.net/gh/JakicDong/blog-assets@main/images/20250809104457.png" alt="20250809104457"></p>
<h3 id="10-ðŸŒŸè¯·è¯´è¯´-sleep-å’Œ-wait-çš„åŒºåˆ«ï¼Ÿï¼ˆè¡¥å……ï¼‰"><a href="#10-ðŸŒŸè¯·è¯´è¯´-sleep-å’Œ-wait-çš„åŒºåˆ«ï¼Ÿï¼ˆè¡¥å……ï¼‰" class="headerlink" title="10.ðŸŒŸè¯·è¯´è¯´ sleep å’Œ wait çš„åŒºåˆ«ï¼Ÿï¼ˆè¡¥å……ï¼‰"></a>10.ðŸŒŸè¯·è¯´è¯´ sleep å’Œ wait çš„åŒºåˆ«ï¼Ÿï¼ˆè¡¥å……ï¼‰</h3><p><code>sleep</code> ä¼šè®©å½“å‰çº¿ç¨‹ä¼‘çœ ï¼Œä¸éœ€è¦èŽ·å–å¯¹è±¡é”ï¼Œå±žäºŽ Thread ç±»çš„æ–¹æ³•ï¼›<br><code>wait</code> ä¼šè®©èŽ·å¾—å¯¹è±¡é”çš„çº¿ç¨‹ç­‰å¾…ï¼Œè¦æå‰èŽ·å¾—å¯¹è±¡é”ï¼Œå±žäºŽ Object ç±»çš„æ–¹æ³•ã€‚</p>
<p>â‘ ã€æ‰€å±žç±»ä¸åŒ</p>
<ul>
<li><code>sleep()</code>Â æ–¹æ³•ä¸“å±žäºŽÂ <code>Thread</code>Â ç±»ã€‚</li>
<li><code>wait()</code>Â æ–¹æ³•ä¸“å±žäºŽÂ <code>Object</code>Â ç±»ã€‚</li>
</ul>
<p>â‘¡ã€é”è¡Œä¸ºä¸åŒ</p>
<p>å¦‚æžœä¸€ä¸ªçº¿ç¨‹åœ¨æŒæœ‰æŸä¸ªå¯¹è±¡é”æ—¶è°ƒç”¨äº† <code>sleep</code> æ–¹æ³•ï¼Œå®ƒåœ¨ç¡çœ æœŸé—´ä»ç„¶ä¼šæŒæœ‰è¿™ä¸ªé”ã€‚</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">SleepDoesNotReleaseLock</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">Object</span> <span class="variable">lock</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Object</span>();</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> InterruptedException &#123;</span><br><span class="line">        <span class="type">Thread</span> <span class="variable">sleepingThread</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Thread</span>(() -&gt; &#123;</span><br><span class="line">            <span class="keyword">synchronized</span> (lock) &#123;</span><br><span class="line">                System.out.println(<span class="string">&quot;Thread 1 ä¼šç»§ç»­æŒæœ‰é”ï¼Œå¹¶ä¸”è¿›å…¥ç¡çœ çŠ¶æ€&quot;</span>);</span><br><span class="line">                <span class="keyword">try</span> &#123;</span><br><span class="line">                    Thread.sleep(<span class="number">5000</span>);</span><br><span class="line">                &#125; <span class="keyword">catch</span> (InterruptedException e) &#123;</span><br><span class="line">                    e.printStackTrace();</span><br><span class="line">                &#125;</span><br><span class="line">                System.out.println(<span class="string">&quot;Thread 1 é†’æ¥äº†ï¼Œå¹¶ä¸”é‡Šæ”¾äº†é”&quot;</span>);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;);</span><br><span class="line"></span><br><span class="line">        <span class="type">Thread</span> <span class="variable">waitingThread</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Thread</span>(() -&gt; &#123;</span><br><span class="line">            <span class="keyword">synchronized</span> (lock) &#123;</span><br><span class="line">                System.out.println(<span class="string">&quot;Thread 2 è¿›å…¥åŒæ­¥ä»£ç å—&quot;</span>);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;);</span><br><span class="line"></span><br><span class="line">        sleepingThread.start();</span><br><span class="line">        Thread.sleep(<span class="number">1000</span>);</span><br><span class="line">        waitingThread.start();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>


<p>è¾“å‡ºç»“æžœï¼š</p>
<figure class="highlight txt"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">Thread 1 ä¼šç»§ç»­æŒæœ‰é”ï¼Œå¹¶ä¸”è¿›å…¥ç¡çœ çŠ¶æ€</span><br><span class="line">Thread 1 é†’æ¥äº†ï¼Œå¹¶ä¸”é‡Šæ”¾äº†é”</span><br><span class="line">Thread 2 è¿›å…¥åŒæ­¥ä»£ç å—</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>ä»Žè¾“å‡ºä¸­æˆ‘ä»¬å¯ä»¥çœ‹åˆ°ï¼Œ<code>waitingThread</code> å¿…é¡»ç­‰å¾… <code>sleepingThread</code> å®Œæˆç¡çœ åŽæ‰èƒ½è¿›å…¥åŒæ­¥ä»£ç å—ã€‚</p>
<p>è€Œå½“çº¿ç¨‹æ‰§è¡Œ <code>wait</code> æ–¹æ³•æ—¶ï¼Œå®ƒä¼šé‡Šæ”¾æŒæœ‰çš„å¯¹è±¡é”ï¼Œå› æ­¤å…¶ä»–çº¿ç¨‹ä¹Ÿæœ‰æœºä¼šèŽ·å–è¯¥å¯¹è±¡çš„é”ã€‚</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">WaitReleasesLock</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">Object</span> <span class="variable">lock</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Object</span>();</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> InterruptedException &#123;</span><br><span class="line">        <span class="type">Thread</span> <span class="variable">waitingThread</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Thread</span>(() -&gt; &#123;</span><br><span class="line">            <span class="keyword">synchronized</span> (lock) &#123;</span><br><span class="line">                <span class="keyword">try</span> &#123;</span><br><span class="line">                    System.out.println(<span class="string">&quot;Thread 1 æŒæœ‰é”ï¼Œå‡†å¤‡ç­‰å¾… 5 ç§’&quot;</span>);</span><br><span class="line">                    lock.wait(<span class="number">5000</span>);</span><br><span class="line">                    System.out.println(<span class="string">&quot;Thread 1 é†’æ¥äº†ï¼Œå¹¶ä¸”é€€å‡ºåŒæ­¥ä»£ç å—&quot;</span>);</span><br><span class="line">                &#125; <span class="keyword">catch</span> (InterruptedException e) &#123;</span><br><span class="line">                    e.printStackTrace();</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;);</span><br><span class="line"></span><br><span class="line">        <span class="type">Thread</span> <span class="variable">notifyingThread</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Thread</span>(() -&gt; &#123;</span><br><span class="line">            <span class="keyword">synchronized</span> (lock) &#123;</span><br><span class="line">                System.out.println(<span class="string">&quot;Thread 2 å°è¯•å”¤é†’ç­‰å¾…ä¸­çš„çº¿ç¨‹&quot;</span>);</span><br><span class="line">                lock.notify();</span><br><span class="line">                System.out.println(<span class="string">&quot;Thread 2 æ‰§è¡Œå®Œäº† notify&quot;</span>);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;);</span><br><span class="line"></span><br><span class="line">        waitingThread.start();</span><br><span class="line">        Thread.sleep(<span class="number">1000</span>);</span><br><span class="line">        notifyingThread.start();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>è¾“å‡ºç»“æžœï¼š</p>
<figure class="highlight txt"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">Thread 1 æŒæœ‰é”ï¼Œå‡†å¤‡ç­‰å¾… 5 ç§’</span><br><span class="line">Thread 2 å°è¯•å”¤é†’ç­‰å¾…ä¸­çš„çº¿ç¨‹</span><br><span class="line">Thread 2 æ‰§è¡Œå®Œäº† notify</span><br><span class="line">Thread 1 é†’æ¥äº†ï¼Œå¹¶ä¸”é€€å‡ºåŒæ­¥ä»£ç å—</span><br></pre></td></tr></table></figure>

<p>è¿™è¡¨æ˜Ž waitingThread åœ¨è°ƒç”¨ wait åŽç¡®å®žé‡Šæ”¾äº†é”ã€‚</p>
<p>â‘¢ã€ä½¿ç”¨æ¡ä»¶ä¸åŒ</p>
<p><code>sleep()</code> æ–¹æ³•å¯ä»¥åœ¨ä»»ä½•åœ°æ–¹è¢«è°ƒç”¨ã€‚<br><code>wait()</code> æ–¹æ³•å¿…é¡»åœ¨åŒæ­¥ä»£ç å—æˆ–åŒæ­¥æ–¹æ³•ä¸­è¢«è°ƒç”¨ï¼Œè¿™æ˜¯å› ä¸ºè°ƒç”¨ <code>wait()</code> æ–¹æ³•çš„å‰ææ˜¯å½“å‰çº¿ç¨‹å¿…é¡»æŒæœ‰å¯¹è±¡çš„é”ã€‚å¦åˆ™ä¼šæŠ›å‡º <code>IllegalMonitorStateException</code> å¼‚å¸¸ã€‚</p>
<p><img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="https://cdn.jsdelivr.net/gh/JakicDong/blog-assets@main/images/20250820212712.png" alt="20250820212712"></p>
<p>â‘£ã€å”¤é†’æ–¹å¼ä¸åŒ</p>
<p>è°ƒç”¨ <code>sleep</code> æ–¹æ³•åŽï¼Œçº¿ç¨‹ä¼šè¿›å…¥ <code>TIMED_WAITING</code> çŠ¶æ€ï¼Œå³åœ¨æŒ‡å®šçš„æ—¶é—´å†…æš‚åœæ‰§è¡Œã€‚å½“æŒ‡å®šçš„æ—¶é—´ç»“æŸåŽï¼Œçº¿ç¨‹ä¼šè‡ªåŠ¨æ¢å¤åˆ° <code>RUNNABLE</code> çŠ¶æ€ï¼Œç­‰å¾… CPU è°ƒåº¦å†æ¬¡æ‰§è¡Œã€‚</p>
<p>è°ƒç”¨ <code>wait</code> æ–¹æ³•åŽï¼Œçº¿ç¨‹ä¼šè¿›å…¥ <code>WAITING</code> çŠ¶æ€ï¼Œç›´åˆ°æœ‰å…¶ä»–çº¿ç¨‹åœ¨åŒä¸€å¯¹è±¡ä¸Šè°ƒç”¨ <code>notify</code> æˆ– <code>notifyAll</code> æ–¹æ³•ï¼Œçº¿ç¨‹æ‰ä¼šä»Ž <code>WAITING</code> çŠ¶æ€è½¬å˜ä¸º <code>RUNNABLE</code> çŠ¶æ€ï¼Œå‡†å¤‡å†æ¬¡èŽ·å¾— CPU çš„æ‰§è¡Œæƒã€‚</p>
<p>æˆ‘ä»¬æ¥é€šè¿‡ä»£ç å†æ„Ÿå—ä¸€ä¸‹ <code>sleep</code> å’Œ <code>wait</code> åœ¨ç”¨æ³•ä¸Šçš„åŒºåˆ«ï¼Œå…ˆçœ‹ <code>sleep</code> çš„ç”¨æ³•ï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">SleepExample</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        <span class="type">Thread</span> <span class="variable">thread</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Thread</span>(() -&gt; &#123;</span><br><span class="line">            System.out.println(<span class="string">&quot;çº¿ç¨‹å‡†å¤‡ä¼‘çœ  2 ç§’&quot;</span>);</span><br><span class="line">            <span class="keyword">try</span> &#123;</span><br><span class="line">                Thread.sleep(<span class="number">2000</span>); <span class="comment">// çº¿ç¨‹å°†ç¡çœ 2ç§’</span></span><br><span class="line">            &#125; <span class="keyword">catch</span> (InterruptedException e) &#123;</span><br><span class="line">                e.printStackTrace();</span><br><span class="line">            &#125;</span><br><span class="line">            System.out.println(<span class="string">&quot;çº¿ç¨‹é†’æ¥äº†&quot;</span>);</span><br><span class="line">        &#125;);</span><br><span class="line"></span><br><span class="line">        thread.start();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>å†æ¥çœ‹ wait() çš„ç”¨æ³•ï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">WaitExample</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        <span class="keyword">final</span> <span class="type">Object</span> <span class="variable">lock</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Object</span>();</span><br><span class="line"></span><br><span class="line">        <span class="type">Thread</span> <span class="variable">thread</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Thread</span>(() -&gt; &#123;</span><br><span class="line">            <span class="keyword">synchronized</span> (lock) &#123;</span><br><span class="line">                <span class="keyword">try</span> &#123;</span><br><span class="line">                    System.out.println(<span class="string">&quot;çº¿ç¨‹å‡†å¤‡ç­‰å¾… 2 ç§’&quot;</span>);</span><br><span class="line">                    lock.wait(<span class="number">2000</span>); <span class="comment">// çº¿ç¨‹ä¼šç­‰å¾…2ç§’ï¼Œæˆ–è€…ç›´åˆ°å…¶ä»–çº¿ç¨‹è°ƒç”¨ lock.notify()/notifyAll()</span></span><br><span class="line">                    System.out.println(<span class="string">&quot;çº¿ç¨‹ç»“æŸç­‰å¾…&quot;</span>);</span><br><span class="line">                &#125; <span class="keyword">catch</span> (InterruptedException e) &#123;</span><br><span class="line">                    e.printStackTrace();</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;);</span><br><span class="line"></span><br><span class="line">        thread.start();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>


<h3 id="11-ðŸŒŸæ€Žä¹ˆä¿è¯çº¿ç¨‹å®‰å…¨ï¼Ÿï¼ˆè¡¥å……ï¼‰"><a href="#11-ðŸŒŸæ€Žä¹ˆä¿è¯çº¿ç¨‹å®‰å…¨ï¼Ÿï¼ˆè¡¥å……ï¼‰" class="headerlink" title="11.ðŸŒŸæ€Žä¹ˆä¿è¯çº¿ç¨‹å®‰å…¨ï¼Ÿï¼ˆè¡¥å……ï¼‰"></a>11.ðŸŒŸæ€Žä¹ˆä¿è¯çº¿ç¨‹å®‰å…¨ï¼Ÿï¼ˆè¡¥å……ï¼‰</h3><p>çº¿ç¨‹å®‰å…¨æ˜¯æŒ‡åœ¨å¹¶å‘çŽ¯å¢ƒä¸‹ï¼Œå¤šä¸ªçº¿ç¨‹è®¿é—®å…±äº«èµ„æºæ—¶ï¼Œç¨‹åºèƒ½å¤Ÿæ­£ç¡®åœ°æ‰§è¡Œï¼Œè€Œä¸ä¼šå‡ºçŽ°æ•°æ®ä¸ä¸€è‡´çš„é—®é¢˜ã€‚</p>
<p>ä¸ºäº†ä¿è¯çº¿ç¨‹å®‰å…¨ï¼Œå¯ä»¥ä½¿ç”¨ <a target="_blank" rel="noopener" href="https://javabetter.cn/thread/synchronized-1.html">synchronized å…³é”®å­—</a>å¯¹æ–¹æ³•åŠ é”ï¼Œå¯¹ä»£ç å—åŠ é”ã€‚çº¿ç¨‹åœ¨æ‰§è¡ŒåŒæ­¥æ–¹æ³•ã€åŒæ­¥ä»£ç å—æ—¶ï¼Œä¼šèŽ·å–ç±»é”æˆ–è€…å¯¹è±¡é”ï¼Œå…¶ä»–çº¿ç¨‹å°±ä¼šé˜»å¡žå¹¶ç­‰å¾…é”ã€‚</p>
<p>å¦‚æžœéœ€è¦æ›´ç»†ç²’åº¦çš„é”ï¼Œå¯ä»¥ä½¿ç”¨ <a target="_blank" rel="noopener" href="https://javabetter.cn/thread/reentrantLock.html">ReentrantLock å¹¶å‘é‡å…¥é”</a>ç­‰ã€‚</p>
<p>å¦‚æžœéœ€è¦ä¿è¯å˜é‡çš„å†…å­˜å¯è§æ€§ï¼Œå¯ä»¥ä½¿ç”¨ <a target="_blank" rel="noopener" href="https://javabetter.cn/thread/volatile.html">volatile å…³é”®å­—</a>ã€‚</p>
<p>å¯¹äºŽç®€å•çš„åŽŸå­å˜é‡æ“ä½œï¼Œè¿˜å¯ä»¥ä½¿ç”¨ <a target="_blank" rel="noopener" href="https://javabetter.cn/thread/atomic.html">Atomic åŽŸå­ç±»</a>ã€‚</p>
<p>å¯¹äºŽçº¿ç¨‹ç‹¬ç«‹çš„æ•°æ®ï¼Œå¯ä»¥ä½¿ç”¨ <a target="_blank" rel="noopener" href="https://javabetter.cn/thread/ThreadLocal.html">ThreadLocal</a> æ¥ä¸ºæ¯ä¸ªçº¿ç¨‹æä¾›ä¸“å±žçš„å˜é‡å‰¯æœ¬ã€‚</p>
<p>å¯¹äºŽéœ€è¦å¹¶å‘å®¹å™¨çš„åœ°æ–¹ï¼Œå¯ä»¥ä½¿ç”¨ <a target="_blank" rel="noopener" href="https://javabetter.cn/thread/ConcurrentHashMap.html">ConcurrentHashMap</a>ã€<a target="_blank" rel="noopener" href="https://javabetter.cn/thread/CopyOnWriteArrayList.html">CopyOnWriteArrayList</a> ç­‰ã€‚</p>
<h4 id="æœ‰ä¸ªintçš„å˜é‡ä¸º0ï¼Œåä¸ªçº¿ç¨‹è½®æµå¯¹å…¶è¿›è¡Œ-æ“ä½œï¼ˆå¾ªçŽ¯10000æ¬¡ï¼‰ï¼Œç»“æžœå¤§äºŽ10-ä¸‡è¿˜æ˜¯å°äºŽç­‰äºŽ10ä¸‡ï¼Œä¸ºä»€ä¹ˆï¼Ÿ"><a href="#æœ‰ä¸ªintçš„å˜é‡ä¸º0ï¼Œåä¸ªçº¿ç¨‹è½®æµå¯¹å…¶è¿›è¡Œ-æ“ä½œï¼ˆå¾ªçŽ¯10000æ¬¡ï¼‰ï¼Œç»“æžœå¤§äºŽ10-ä¸‡è¿˜æ˜¯å°äºŽç­‰äºŽ10ä¸‡ï¼Œä¸ºä»€ä¹ˆï¼Ÿ" class="headerlink" title="æœ‰ä¸ªintçš„å˜é‡ä¸º0ï¼Œåä¸ªçº¿ç¨‹è½®æµå¯¹å…¶è¿›è¡Œ++æ“ä½œï¼ˆå¾ªçŽ¯10000æ¬¡ï¼‰ï¼Œç»“æžœå¤§äºŽ10 ä¸‡è¿˜æ˜¯å°äºŽç­‰äºŽ10ä¸‡ï¼Œä¸ºä»€ä¹ˆï¼Ÿ"></a>æœ‰ä¸ªintçš„å˜é‡ä¸º0ï¼Œåä¸ªçº¿ç¨‹è½®æµå¯¹å…¶è¿›è¡Œ++æ“ä½œï¼ˆå¾ªçŽ¯10000æ¬¡ï¼‰ï¼Œç»“æžœå¤§äºŽ10 ä¸‡è¿˜æ˜¯å°äºŽç­‰äºŽ10ä¸‡ï¼Œä¸ºä»€ä¹ˆï¼Ÿ</h4><p>åœ¨è¿™ä¸ªåœºæ™¯ä¸­ï¼Œæœ€ç»ˆçš„ç»“æžœä¼šå°äºŽ 100000ï¼ŒåŽŸå› æ˜¯å¤šçº¿ç¨‹çŽ¯å¢ƒä¸‹ï¼Œ++ æ“ä½œå¹¶ä¸æ˜¯ä¸€ä¸ªåŽŸå­æ“ä½œï¼Œè€Œæ˜¯åˆ†ä¸ºè¯»å–ã€åŠ  1ã€å†™å›žä¸‰ä¸ªæ­¥éª¤ã€‚</p>
<ol>
<li>è¯»å–å˜é‡çš„å€¼ã€‚</li>
<li>å°†è¯»å–åˆ°çš„å€¼åŠ  1ã€‚</li>
<li>å°†ç»“æžœå†™å›žå˜é‡ã€‚</li>
</ol>
<p>è¿™æ ·çš„è¯ï¼Œå°±ä¼šæœ‰å¤šä¸ªçº¿ç¨‹è¯»å–åˆ°ç›¸åŒçš„å€¼ï¼Œç„¶åŽå¯¹è¿™ä¸ªå€¼è¿›è¡ŒåŠ  1 æ“ä½œï¼Œæœ€ç»ˆå¯¼è‡´ç»“æžœå°äºŽ 100000ã€‚</p>
<p>è¯¦ç»†è§£é‡Šä¸‹ã€‚</p>
<p>å¤šä¸ªçº¿ç¨‹åœ¨å¹¶å‘æ‰§è¡Œ ++ æ“ä½œæ—¶ï¼Œå¯èƒ½å‡ºçŽ°ä»¥ä¸‹ç«žæ€æ¡ä»¶ï¼š</p>
<ul>
<li>çº¿ç¨‹ 1 è¯»å–å˜é‡å€¼ä¸º 0ã€‚</li>
<li>çº¿ç¨‹ 2 ä¹Ÿè¯»å–å˜é‡å€¼ä¸º 0ã€‚</li>
<li>çº¿ç¨‹ 1 è¿›è¡ŒåŠ æ³•è¿ç®—å¹¶å°†ç»“æžœ 1 å†™å›žå˜é‡ã€‚</li>
<li>çº¿ç¨‹ 2 è¿›è¡ŒåŠ æ³•è¿ç®—å¹¶å°†ç»“æžœ 1 å†™å›žå˜é‡ï¼Œè¦†ç›–äº†çº¿ç¨‹ 1 çš„ç»“æžœã€‚</li>
</ul>
<p>å¯ä»¥é€šè¿‡ synchronized å…³é”®å­—ä¸º ++ æ“ä½œåŠ é”ã€‚</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Main</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="type">int</span> <span class="variable">count</span> <span class="operator">=</span> <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> InterruptedException &#123;</span><br><span class="line">        <span class="type">Runnable</span> <span class="variable">task</span> <span class="operator">=</span> () -&gt; &#123;</span><br><span class="line">            <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; <span class="number">10000</span>; i++) &#123;</span><br><span class="line">                <span class="keyword">synchronized</span> (Main.class) &#123;</span><br><span class="line">                    count++;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;;</span><br><span class="line"></span><br><span class="line">        List&lt;Thread&gt; threads = <span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;&gt;();</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; <span class="number">10</span>; i++) &#123;</span><br><span class="line">            <span class="type">Thread</span> <span class="variable">thread</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Thread</span>(task);</span><br><span class="line">            threads.add(thread);</span><br><span class="line">            thread.start();</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">for</span> (Thread thread : threads) &#123;</span><br><span class="line">            thread.join();</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        System.out.println(<span class="string">&quot;Final count: &quot;</span> + count);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>æˆ–è€…ä½¿ç”¨ AtomicInteger çš„ <code>incrementAndGet()</code> æ–¹æ³•æ¥æ›¿ä»£ ++ æ“ä½œï¼Œä¿è¯å˜é‡çš„åŽŸå­æ€§ã€‚</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Main</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="type">AtomicInteger</span> <span class="variable">count</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">AtomicInteger</span>(<span class="number">0</span>);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> InterruptedException &#123;</span><br><span class="line">        <span class="type">Runnable</span> <span class="variable">task</span> <span class="operator">=</span> () -&gt; &#123;</span><br><span class="line">            <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; <span class="number">10000</span>; i++) &#123;</span><br><span class="line">                count.incrementAndGet();</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;;</span><br><span class="line"></span><br><span class="line">        List&lt;Thread&gt; threads = <span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;&gt;();</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; <span class="number">10</span>; i++) &#123;</span><br><span class="line">            <span class="type">Thread</span> <span class="variable">thread</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Thread</span>(task);</span><br><span class="line">            threads.add(thread);</span><br><span class="line">            thread.start();</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">for</span> (Thread thread : threads) &#123;</span><br><span class="line">            thread.join();</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        System.out.println(<span class="string">&quot;Final count: &quot;</span> + count.get());</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="åœºæ™¯-æœ‰ä¸€ä¸ª-key-å¯¹åº”çš„-value-æ˜¯ä¸€ä¸ªjson-ç»“æž„ï¼Œjson-å½“ä¸­æœ‰å¥½å‡ ä¸ªå­ä»»åŠ¡ï¼Œè¿™äº›å­ä»»åŠ¡å¦‚æžœå¯¹-key-è¿›è¡Œä¿®æ”¹çš„è¯ï¼Œä¼šä¸ä¼šå­˜åœ¨çº¿ç¨‹å®‰å…¨çš„é—®é¢˜ï¼Ÿ"><a href="#åœºæ™¯-æœ‰ä¸€ä¸ª-key-å¯¹åº”çš„-value-æ˜¯ä¸€ä¸ªjson-ç»“æž„ï¼Œjson-å½“ä¸­æœ‰å¥½å‡ ä¸ªå­ä»»åŠ¡ï¼Œè¿™äº›å­ä»»åŠ¡å¦‚æžœå¯¹-key-è¿›è¡Œä¿®æ”¹çš„è¯ï¼Œä¼šä¸ä¼šå­˜åœ¨çº¿ç¨‹å®‰å…¨çš„é—®é¢˜ï¼Ÿ" class="headerlink" title="åœºæ™¯:æœ‰ä¸€ä¸ª key å¯¹åº”çš„ value æ˜¯ä¸€ä¸ªjson ç»“æž„ï¼Œjson å½“ä¸­æœ‰å¥½å‡ ä¸ªå­ä»»åŠ¡ï¼Œè¿™äº›å­ä»»åŠ¡å¦‚æžœå¯¹ key è¿›è¡Œä¿®æ”¹çš„è¯ï¼Œä¼šä¸ä¼šå­˜åœ¨çº¿ç¨‹å®‰å…¨çš„é—®é¢˜ï¼Ÿ"></a>åœºæ™¯:æœ‰ä¸€ä¸ª key å¯¹åº”çš„ value æ˜¯ä¸€ä¸ªjson ç»“æž„ï¼Œjson å½“ä¸­æœ‰å¥½å‡ ä¸ªå­ä»»åŠ¡ï¼Œè¿™äº›å­ä»»åŠ¡å¦‚æžœå¯¹ key è¿›è¡Œä¿®æ”¹çš„è¯ï¼Œä¼šä¸ä¼šå­˜åœ¨çº¿ç¨‹å®‰å…¨çš„é—®é¢˜ï¼Ÿ</h4><p>ä¼šã€‚</p>
<p>åœ¨å•èŠ‚ç‚¹çŽ¯å¢ƒä¸­ï¼Œå¯ä»¥ä½¿ç”¨ synchronized å…³é”®å­—æˆ– ReentrantLock æ¥ä¿è¯å¯¹ key çš„ä¿®æ”¹æ“ä½œæ˜¯åŽŸå­çš„ã€‚</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">KeyManager</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> <span class="type">ReentrantLock</span> <span class="variable">lock</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ReentrantLock</span>();</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="type">String</span> <span class="variable">key</span> <span class="operator">=</span> <span class="string">&quot;&#123;\&quot;tasks\&quot;: [\&quot;task1\&quot;, \&quot;task2\&quot;]&#125;&quot;</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">readKey</span><span class="params">()</span> &#123;</span><br><span class="line">        lock.lock();</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="keyword">return</span> key;</span><br><span class="line">        &#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">            lock.unlock();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">updateKey</span><span class="params">(String newKey)</span> &#123;</span><br><span class="line">        lock.lock();</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="built_in">this</span>.key = newKey;</span><br><span class="line">        &#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">            lock.unlock();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>åœ¨å¤šèŠ‚ç‚¹çŽ¯å¢ƒä¸­ï¼Œå¯ä»¥ä½¿ç”¨åˆ†å¸ƒå¼é” Redisson æ¥ä¿è¯å¯¹ key çš„ä¿®æ”¹æ“ä½œæ˜¯åŽŸå­çš„ã€‚</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">DistributedKeyManager</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> RedissonClient redisson;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">DistributedKeyManager</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="type">Config</span> <span class="variable">config</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Config</span>();</span><br><span class="line">        config.useSingleServer().setAddress(<span class="string">&quot;redis://127.0.0.1:6379&quot;</span>);</span><br><span class="line">        <span class="built_in">this</span>.redisson = Redisson.create(config);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">updateKey</span><span class="params">(String key, String newValue)</span> &#123;</span><br><span class="line">        <span class="type">RLock</span> <span class="variable">lock</span> <span class="operator">=</span> redisson.getLock(key);</span><br><span class="line">        lock.lock();</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="comment">// æ¨¡æ‹Ÿè¯»å–å’Œæ›´æ–°æ“ä½œ</span></span><br><span class="line">            <span class="type">String</span> <span class="variable">currentValue</span> <span class="operator">=</span> readFromDatabase(key); <span class="comment">// å‡è®¾è¯»å– JSON æ•°æ®</span></span><br><span class="line">            <span class="type">String</span> <span class="variable">updatedValue</span> <span class="operator">=</span> modifyJson(currentValue, newValue); <span class="comment">// ä¿®æ”¹ JSON</span></span><br><span class="line">            writeToDatabase(key, updatedValue); <span class="comment">// å†™å›žæ•°æ®åº“</span></span><br><span class="line">        &#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">            lock.unlock();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> String <span class="title function_">readFromDatabase</span><span class="params">(String key)</span> &#123;</span><br><span class="line">        <span class="comment">// æ¨¡æ‹Ÿä»Žæ•°æ®åº“è¯»å–</span></span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;&#123;\&quot;tasks\&quot;: [\&quot;task1\&quot;, \&quot;task2\&quot;]&#125;&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> String <span class="title function_">modifyJson</span><span class="params">(String json, String newValue)</span> &#123;</span><br><span class="line">        <span class="comment">// ä½¿ç”¨ JSON åº“è§£æžå¹¶ä¿®æ”¹</span></span><br><span class="line">        <span class="keyword">return</span> json.replace(<span class="string">&quot;task1&quot;</span>, newValue);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">void</span> <span class="title function_">writeToDatabase</span><span class="params">(String key, String value)</span> &#123;</span><br><span class="line">        <span class="comment">// æ¨¡æ‹Ÿå†™å›žæ•°æ®åº“</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="è¯´ä¸€ä¸ªçº¿ç¨‹å®‰å…¨çš„ä½¿ç”¨åœºæ™¯ï¼Ÿ"><a href="#è¯´ä¸€ä¸ªçº¿ç¨‹å®‰å…¨çš„ä½¿ç”¨åœºæ™¯ï¼Ÿ" class="headerlink" title="è¯´ä¸€ä¸ªçº¿ç¨‹å®‰å…¨çš„ä½¿ç”¨åœºæ™¯ï¼Ÿ"></a>è¯´ä¸€ä¸ªçº¿ç¨‹å®‰å…¨çš„ä½¿ç”¨åœºæ™¯ï¼Ÿ</h4><p>å•ä¾‹æ¨¡å¼ã€‚åœ¨å¤šçº¿ç¨‹çŽ¯å¢ƒä¸‹ï¼Œå¦‚æžœå¤šä¸ªçº¿ç¨‹åŒæ—¶å°è¯•åˆ›å»ºå®žä¾‹ï¼Œå•ä¾‹ç±»å¿…é¡»ç¡®ä¿åªåˆ›å»ºä¸€ä¸ªå®žä¾‹ï¼Œå¹¶æä¾›ä¸€ä¸ªå…¨å±€è®¿é—®ç‚¹ã€‚</p>
<p>é¥¿æ±‰å¼æ˜¯ä¸€ç§æ¯”è¾ƒç›´æŽ¥çš„å®žçŽ°æ–¹å¼ï¼Œå®ƒé€šè¿‡åœ¨ç±»åŠ è½½æ—¶å°±ç«‹å³åˆå§‹åŒ–å•ä¾‹å¯¹è±¡æ¥ä¿è¯çº¿ç¨‹å®‰å…¨ã€‚</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Singleton</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">Singleton</span> <span class="variable">instance</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Singleton</span>();</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="title function_">Singleton</span><span class="params">()</span> &#123;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> Singleton <span class="title function_">getInstance</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> instance;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>æ‡’æ±‰å¼å•ä¾‹åˆ™åœ¨ç¬¬ä¸€æ¬¡ä½¿ç”¨æ—¶åˆå§‹åŒ–å•ä¾‹å¯¹è±¡ï¼Œè¿™ç§æ–¹å¼éœ€è¦ä½¿ç”¨åŒé‡æ£€æŸ¥é”å®šæ¥ç¡®ä¿çº¿ç¨‹å®‰å…¨ï¼Œvolatile å…³é”®å­—ç”¨æ¥ä¿è¯å¯è§æ€§ï¼Œsyncronized å…³é”®å­—ç”¨æ¥ä¿è¯åŒæ­¥ã€‚</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">LazySingleton</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">volatile</span> LazySingleton instance;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="title function_">LazySingleton</span><span class="params">()</span> &#123;&#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> LazySingleton <span class="title function_">getInstance</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> (instance == <span class="literal">null</span>) &#123; <span class="comment">// ç¬¬ä¸€æ¬¡æ£€æŸ¥</span></span><br><span class="line">            <span class="keyword">synchronized</span> (LazySingleton.class) &#123;</span><br><span class="line">                <span class="keyword">if</span> (instance == <span class="literal">null</span>) &#123; <span class="comment">// ç¬¬äºŒæ¬¡æ£€æŸ¥</span></span><br><span class="line">                    instance = <span class="keyword">new</span> <span class="title class_">LazySingleton</span>();</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> instance;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="èƒ½è¯´ä¸€ä¸‹-Hashtable-çš„åº•å±‚æ•°æ®ç»“æž„å—ï¼Ÿ"><a href="#èƒ½è¯´ä¸€ä¸‹-Hashtable-çš„åº•å±‚æ•°æ®ç»“æž„å—ï¼Ÿ" class="headerlink" title="èƒ½è¯´ä¸€ä¸‹ Hashtable çš„åº•å±‚æ•°æ®ç»“æž„å—ï¼Ÿ"></a>èƒ½è¯´ä¸€ä¸‹ Hashtable çš„åº•å±‚æ•°æ®ç»“æž„å—ï¼Ÿ</h4><p>ä¸Ž HashMap ç±»ä¼¼ï¼ŒHashtable çš„åº•å±‚æ•°æ®ç»“æž„ä¹Ÿæ˜¯ä¸€ä¸ªæ•°ç»„åŠ ä¸Šé“¾è¡¨çš„æ–¹å¼ï¼Œç„¶åŽé€šè¿‡ synchronized åŠ é”æ¥ä¿è¯çº¿ç¨‹å®‰å…¨ã€‚</p>
<p><img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="https://cdn.jsdelivr.net/gh/JakicDong/blog-assets@main/images/20250928191717.png" alt="20250928191717"><br>äºŒå“¥çš„Java è¿›é˜¶ä¹‹è·¯ï¼šHashtableæºç </p>
<p>æŽ¨èé˜…è¯»ï¼š<a target="_blank" rel="noopener" href="https://www.bilibili.com/video/BV1N741127FH/">ThreadLocal å…¨é¢è§£æž</a></p>
<h3 id="12-ðŸŒŸThreadLocal-æ˜¯ä»€ä¹ˆï¼Ÿ"><a href="#12-ðŸŒŸThreadLocal-æ˜¯ä»€ä¹ˆï¼Ÿ" class="headerlink" title="12.ðŸŒŸThreadLocal æ˜¯ä»€ä¹ˆï¼Ÿ"></a>12.ðŸŒŸThreadLocal æ˜¯ä»€ä¹ˆï¼Ÿ</h3><p><a target="_blank" rel="noopener" href="https://javabetter.cn/thread/ThreadLocal.html">ThreadLocal</a> æ˜¯ä¸€ç§ç”¨äºŽå®žçŽ°çº¿ç¨‹å±€éƒ¨å˜é‡çš„å·¥å…·ç±»ã€‚å®ƒå…è®¸æ¯ä¸ªçº¿ç¨‹éƒ½æ‹¥æœ‰è‡ªå·±çš„ç‹¬ç«‹å‰¯æœ¬ï¼Œä»Žè€Œå®žçŽ°çº¿ç¨‹éš”ç¦»ã€‚</p>
<p><img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="https://cdn.jsdelivr.net/gh/JakicDong/blog-assets@main/images/20250928193013.png" alt="20250928193013"><br>ä¸‰åˆ†æ¶é¢æ¸£é€†è¢­ï¼šThreadLocalçº¿ç¨‹å‰¯æœ¬</p>
<p>ä½¿ç”¨ ThreadLocal é€šå¸¸åˆ†ä¸ºå››æ­¥ï¼š</p>
<p>â‘ ã€åˆ›å»º ThreadLocal</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//åˆ›å»ºä¸€ä¸ªThreadLocalå˜é‡</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> ThreadLocal&lt;String&gt; localVariable = <span class="keyword">new</span> <span class="title class_">ThreadLocal</span>&lt;&gt;();</span><br></pre></td></tr></table></figure>

<p>â‘¡ã€è®¾ç½® ThreadLocal çš„å€¼</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//è®¾ç½®ThreadLocalå˜é‡çš„å€¼</span></span><br><span class="line">localVariable.set(<span class="string">&quot;æ²‰é»˜çŽ‹äºŒæ˜¯æ²™é›•&quot;</span>);</span><br></pre></td></tr></table></figure>

<p>â‘¢ã€èŽ·å– ThreadLocal çš„å€¼</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//èŽ·å–ThreadLocalå˜é‡çš„å€¼</span></span><br><span class="line"><span class="type">String</span> <span class="variable">value</span> <span class="operator">=</span> localVariable.get();</span><br></pre></td></tr></table></figure>

<p>â‘£ã€åˆ é™¤ ThreadLocal çš„å€¼</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//åˆ é™¤ThreadLocalå˜é‡çš„å€¼</span></span><br><span class="line">localVariable.remove();</span><br></pre></td></tr></table></figure>

<p>åœ¨ Web åº”ç”¨ä¸­ï¼Œå¯ä»¥ä½¿ç”¨ ThreadLocal å­˜å‚¨ç”¨æˆ·ä¼šè¯ä¿¡æ¯ï¼Œè¿™æ ·æ¯ä¸ªçº¿ç¨‹åœ¨å¤„ç†ç”¨æˆ·è¯·æ±‚æ—¶éƒ½èƒ½æ–¹ä¾¿åœ°è®¿é—®å½“å‰ç”¨æˆ·çš„ä¼šè¯ä¿¡æ¯ã€‚</p>
<p>åœ¨æ•°æ®åº“æ“ä½œä¸­ï¼Œå¯ä»¥ä½¿ç”¨ ThreadLocal å­˜å‚¨æ•°æ®åº“è¿žæŽ¥å¯¹è±¡ï¼Œæ¯ä¸ªçº¿ç¨‹æœ‰è‡ªå·±ç‹¬ç«‹çš„æ•°æ®åº“è¿žæŽ¥ï¼Œä»Žè€Œé¿å…äº†å¤šçº¿ç¨‹ç«žäº‰åŒä¸€æ•°æ®åº“è¿žæŽ¥çš„é—®é¢˜ã€‚</p>
<p>åœ¨æ ¼å¼åŒ–æ“ä½œä¸­ï¼Œä¾‹å¦‚æ—¥æœŸæ ¼å¼åŒ–ï¼Œå¯ä»¥ä½¿ç”¨ ThreadLocal å­˜å‚¨ SimpleDateFormat å®žä¾‹ï¼Œé¿å…å¤šçº¿ç¨‹å…±äº«åŒä¸€å®žä¾‹å¯¼è‡´çš„çº¿ç¨‹å®‰å…¨é—®é¢˜ã€‚</p>
<h4 id="ThreadLocal-æœ‰å“ªäº›ä¼˜ç‚¹ï¼Ÿ"><a href="#ThreadLocal-æœ‰å“ªäº›ä¼˜ç‚¹ï¼Ÿ" class="headerlink" title="ThreadLocal æœ‰å“ªäº›ä¼˜ç‚¹ï¼Ÿ"></a>ThreadLocal æœ‰å“ªäº›ä¼˜ç‚¹ï¼Ÿ</h4><p>æ¯ä¸ªçº¿ç¨‹è®¿é—®çš„å˜é‡å‰¯æœ¬éƒ½æ˜¯ç‹¬ç«‹çš„ï¼Œé¿å…äº†å…±äº«å˜é‡å¼•èµ·çš„çº¿ç¨‹å®‰å…¨é—®é¢˜ã€‚ç”±äºŽ ThreadLocal å®žçŽ°äº†å˜é‡çš„çº¿ç¨‹ç‹¬å ï¼Œä½¿å¾—å˜é‡ä¸éœ€è¦åŒæ­¥å¤„ç†ï¼Œå› æ­¤èƒ½å¤Ÿé¿å…èµ„æºç«žäº‰ã€‚</p>
<p>ThreadLocal å¯ç”¨äºŽè·¨æ–¹æ³•ã€è·¨ç±»æ—¶ä¼ é€’ä¸Šä¸‹æ–‡æ•°æ®ï¼Œä¸éœ€è¦åœ¨æ–¹æ³•é—´ä¼ é€’å‚æ•°ã€‚</p>
<h3 id="14-ðŸŒŸThreadLocal-æ€Žä¹ˆå®žçŽ°çš„å‘¢ï¼Ÿ"><a href="#14-ðŸŒŸThreadLocal-æ€Žä¹ˆå®žçŽ°çš„å‘¢ï¼Ÿ" class="headerlink" title="14.ðŸŒŸThreadLocal æ€Žä¹ˆå®žçŽ°çš„å‘¢ï¼Ÿ"></a>14.ðŸŒŸThreadLocal æ€Žä¹ˆå®žçŽ°çš„å‘¢ï¼Ÿ</h3><p>å½“æˆ‘ä»¬åˆ›å»ºä¸€ä¸ª ThreadLocal å¯¹è±¡å¹¶è°ƒç”¨ set æ–¹æ³•æ—¶ï¼Œå…¶å®žæ˜¯åœ¨å½“å‰çº¿ç¨‹ä¸­åˆå§‹åŒ–äº†ä¸€ä¸ª ThreadLocalMapã€‚</p>
<p><img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="https://cdn.jsdelivr.net/gh/JakicDong/blog-assets@main/images/20250930165350.png" alt="20250930165350"><br>äºŒå“¥çš„ Java è¿›é˜¶ä¹‹è·¯ï¼šThreadLocalMap</p>
<p>ThreadLocalMap æ˜¯ ThreadLocal çš„ä¸€ä¸ªé™æ€å†…éƒ¨ç±»ï¼Œå®ƒå†…éƒ¨ç»´æŠ¤äº†ä¸€ä¸ª Entry æ•°ç»„ï¼Œkey æ˜¯ ThreadLocal å¯¹è±¡ï¼Œvalue æ˜¯çº¿ç¨‹çš„å±€éƒ¨å˜é‡ï¼Œè¿™æ ·å°±ç›¸å½“äºŽä¸ºæ¯ä¸ªçº¿ç¨‹ç»´æŠ¤äº†ä¸€ä¸ªå˜é‡å‰¯æœ¬ã€‚</p>
<p><img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="https://cdn.jsdelivr.net/gh/JakicDong/blog-assets@main/images/20250930165403.png" alt="20250930165403"><br>ä¸‰åˆ†æ¶é¢æ¸£é€†è¢­ï¼šThreadLocaç»“æž„å›¾</p>
<p>Entry ç»§æ‰¿äº† WeakReferenceï¼Œå®ƒé™å®šäº† key æ˜¯ä¸€ä¸ªå¼±å¼•ç”¨ï¼Œå¼±å¼•ç”¨çš„å¥½å¤„æ˜¯å½“å†…å­˜ä¸è¶³æ—¶ï¼ŒJVM ä¼šå›žæ”¶ ThreadLocal å¯¹è±¡ï¼Œå¹¶ä¸”å°†å…¶å¯¹åº”çš„ Entry.value è®¾ç½®ä¸º nullï¼Œè¿™æ ·å¯ä»¥åœ¨å¾ˆå¤§ç¨‹åº¦ä¸Šé¿å…å†…å­˜æ³„æ¼ã€‚</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">static</span> <span class="keyword">class</span> <span class="title class_">Entry</span> <span class="keyword">extends</span> <span class="title class_">WeakReference</span>&lt;ThreadLocal&lt;?&gt;&gt; &#123;</span><br><span class="line">    <span class="comment">/** The value associated with this ThreadLocal. */</span></span><br><span class="line">    Object value;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//èŠ‚ç‚¹ç±»</span></span><br><span class="line">    Entry(ThreadLocal&lt;?&gt; k, Object v) &#123;</span><br><span class="line">        <span class="comment">//keyèµ‹å€¼</span></span><br><span class="line">        <span class="built_in">super</span>(k);</span><br><span class="line">        <span class="comment">//valueèµ‹å€¼</span></span><br><span class="line">        value = v;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>æ€»ç»“ä¸€ä¸‹ï¼š</p>
<p>ThreadLocal çš„å®žçŽ°åŽŸç†æ˜¯ï¼Œæ¯ä¸ªçº¿ç¨‹ç»´æŠ¤ä¸€ä¸ª Mapï¼Œkey ä¸º ThreadLocal å¯¹è±¡ï¼Œvalue ä¸ºæƒ³è¦å®žçŽ°çº¿ç¨‹éš”ç¦»çš„å¯¹è±¡ã€‚</p>
<p>1ã€é€šè¿‡ ThreadLocal çš„ set æ–¹æ³•å°†å¯¹è±¡å­˜å…¥ Map ä¸­ã€‚</p>
<p>2ã€é€šè¿‡ ThreadLocal çš„ get æ–¹æ³•ä»Ž Map ä¸­å–å‡ºå¯¹è±¡ã€‚</p>
<p>3ã€Map çš„å¤§å°ç”± ThreadLocal å¯¹è±¡çš„å¤šå°‘å†³å®šã€‚</p>
<p><img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="https://cdn.jsdelivr.net/gh/JakicDong/blog-assets@main/images/20251027082309.png" alt="20251027082309"><br>ThreadLocal çš„ç»“æž„</p>
<h4 id="ä»€ä¹ˆæ˜¯å¼±å¼•ç”¨ï¼Œä»€ä¹ˆæ˜¯å¼ºå¼•ç”¨ï¼Ÿ"><a href="#ä»€ä¹ˆæ˜¯å¼±å¼•ç”¨ï¼Œä»€ä¹ˆæ˜¯å¼ºå¼•ç”¨ï¼Ÿ" class="headerlink" title="ä»€ä¹ˆæ˜¯å¼±å¼•ç”¨ï¼Œä»€ä¹ˆæ˜¯å¼ºå¼•ç”¨ï¼Ÿ"></a>ä»€ä¹ˆæ˜¯å¼±å¼•ç”¨ï¼Œä»€ä¹ˆæ˜¯å¼ºå¼•ç”¨ï¼Ÿ</h4><p>æˆ‘å…ˆè¯´ä¸€ä¸‹å¼ºå¼•ç”¨ï¼Œæ¯”å¦‚ <code>User user = new User(&quot;æ²‰é»˜çŽ‹äºŒ&quot;)</code> ä¸­ï¼Œuser å°±æ˜¯ä¸€ä¸ªå¼ºå¼•ç”¨ï¼Œ<code>new User(&quot;æ²‰é»˜çŽ‹äºŒ&quot;)</code> å°±æ˜¯å¼ºå¼•ç”¨å¯¹è±¡ã€‚</p>
<p>å½“ user è¢«ç½®ä¸º null æ—¶ï¼ˆ<code>user = null</code>ï¼‰ï¼Œ<code>new User(&quot;æ²‰é»˜çŽ‹äºŒ&quot;)</code> å¯¹è±¡å°±ä¼šè¢«åžƒåœ¾å›žæ”¶ï¼›å¦åˆ™å³ä¾¿æ˜¯å†…å­˜ç©ºé—´ä¸è¶³ï¼ŒJVM ä¹Ÿä¸ä¼šå›žæ”¶ <code>new User(&quot;æ²‰é»˜çŽ‹äºŒ&quot;)</code> è¿™ä¸ªå¼ºå¼•ç”¨å¯¹è±¡ï¼Œå®æ„¿æŠ›å‡º OutOfMemoryErrorã€‚</p>
<p>å¼±å¼•ç”¨ï¼Œæ¯”å¦‚è¯´åœ¨ä½¿ç”¨ ThreadLocal ä¸­ï¼ŒEntry çš„ key å°±æ˜¯ä¸€ä¸ªå¼±å¼•ç”¨å¯¹è±¡ã€‚</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">ThreadLocal&lt;User&gt; userThreadLocal = <span class="keyword">new</span> <span class="title class_">ThreadLocal</span>&lt;&gt;();</span><br><span class="line">userThreadLocal.set(<span class="keyword">new</span> <span class="title class_">User</span>(<span class="string">&quot;æ²‰é»˜çŽ‹äºŒ&quot;</span>));</span><br></pre></td></tr></table></figure>

<p>userThreadLocal æ˜¯ä¸€ä¸ªå¼ºå¼•ç”¨ï¼Œ<code>new ThreadLocal&lt;&gt;()</code> æ˜¯ä¸€ä¸ªå¼ºå¼•ç”¨å¯¹è±¡ï¼›</p>
<p><code>new User(&quot;æ²‰é»˜çŽ‹äºŒ&quot;)</code> æ˜¯ä¸€ä¸ªå¼ºå¼•ç”¨å¯¹è±¡ã€‚</p>
<p>è°ƒç”¨ set æ–¹æ³•åŽï¼Œä¼šå°† <code>key = new ThreadLocal&lt;&gt;()</code> æ”¾å…¥ ThreadLocalMap ä¸­ï¼Œæ­¤æ—¶çš„ key æ˜¯ä¸€ä¸ªå¼±å¼•ç”¨å¯¹è±¡ã€‚å½“ JVM è¿›è¡Œåžƒåœ¾å›žæ”¶æ—¶ï¼Œå¦‚æžœå‘çŽ°äº†å¼±å¼•ç”¨å¯¹è±¡ï¼Œå°±ä¼šå°†å…¶å›žæ”¶ã€‚</p>
<p><img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="https://cdn.jsdelivr.net/gh/JakicDong/blog-assets@main/images/20250930165420.png" alt="20250930165420"><br>ä¸‰åˆ†æ¶é¢æ¸£é€†è¢­ï¼šThreadLocalå†…å­˜åˆ†é…</p>
<p>å…¶å…³ç³»é“¾å°±æ˜¯ï¼š</p>
<ul>
<li>ThreadLocal å¼ºå¼•ç”¨ -&gt; ThreadLocal å¯¹è±¡ã€‚</li>
<li>Thread å¼ºå¼•ç”¨ -&gt; ThreadLocalMapã€‚</li>
<li><code>ThreadLocalMap[i]</code> å¼ºå¼•ç”¨äº† -&gt; Entryã€‚</li>
<li>Entry.key å¼±å¼•ç”¨ -&gt; ThreadLocal å¯¹è±¡ã€‚</li>
<li>Entry.value å¼ºå¼•ç”¨ -&gt; çº¿ç¨‹çš„å±€éƒ¨å˜é‡å¯¹è±¡ã€‚</li>
</ul>
<h3 id="15-ðŸŒŸThreadLocal-å†…å­˜æ³„éœ²æ˜¯æ€Žä¹ˆå›žäº‹ï¼Ÿ"><a href="#15-ðŸŒŸThreadLocal-å†…å­˜æ³„éœ²æ˜¯æ€Žä¹ˆå›žäº‹ï¼Ÿ" class="headerlink" title="15.ðŸŒŸThreadLocal å†…å­˜æ³„éœ²æ˜¯æ€Žä¹ˆå›žäº‹ï¼Ÿ"></a>15.ðŸŒŸThreadLocal å†…å­˜æ³„éœ²æ˜¯æ€Žä¹ˆå›žäº‹ï¼Ÿ</h3><p>ThreadLocalMap çš„ Key æ˜¯ å¼±å¼•ç”¨ï¼Œä½† Value æ˜¯å¼ºå¼•ç”¨ã€‚</p>
<p>å¦‚æžœä¸€ä¸ªçº¿ç¨‹ä¸€ç›´åœ¨è¿è¡Œï¼Œå¹¶ä¸” value ä¸€ç›´æŒ‡å‘æŸä¸ªå¼ºå¼•ç”¨å¯¹è±¡ï¼Œé‚£ä¹ˆè¿™ä¸ªå¯¹è±¡å°±ä¸ä¼šè¢«å›žæ”¶ï¼Œä»Žè€Œå¯¼è‡´å†…å­˜æ³„æ¼ã€‚</p>
<p><img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="https://cdn.jsdelivr.net/gh/JakicDong/blog-assets@main/images/20251003165249.png" alt="20251003165249"><br>äºŒå“¥çš„ Java è¿›é˜¶ä¹‹è·¯ï¼šThreadLocalMap å†…å­˜æº¢å‡º</p>
<h4 id="é‚£æ€Žä¹ˆè§£å†³å†…å­˜æ³„æ¼é—®é¢˜å‘¢ï¼Ÿ"><a href="#é‚£æ€Žä¹ˆè§£å†³å†…å­˜æ³„æ¼é—®é¢˜å‘¢ï¼Ÿ" class="headerlink" title="é‚£æ€Žä¹ˆè§£å†³å†…å­˜æ³„æ¼é—®é¢˜å‘¢ï¼Ÿ"></a>é‚£æ€Žä¹ˆè§£å†³å†…å­˜æ³„æ¼é—®é¢˜å‘¢ï¼Ÿ</h4><p>å¾ˆç®€å•ï¼Œä½¿ç”¨å®Œ ThreadLocal åŽï¼ŒåŠæ—¶è°ƒç”¨ <code>remove()</code> æ–¹æ³•é‡Šæ”¾å†…å­˜ç©ºé—´ã€‚</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">try</span> &#123;</span><br><span class="line">    threadLocal.set(value);</span><br><span class="line">    <span class="comment">// æ‰§è¡Œä¸šåŠ¡æ“ä½œ</span></span><br><span class="line">&#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">    threadLocal.remove(); <span class="comment">// ç¡®ä¿èƒ½å¤Ÿæ‰§è¡Œæ¸…ç†</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><code>remove()</code> ä¼šè°ƒç”¨ ThreadLocalMap çš„ remove æ–¹æ³•éåŽ†å“ˆå¸Œè¡¨ï¼Œæ‰¾åˆ° key ç­‰äºŽå½“å‰ ThreadLocal çš„ Entryï¼Œæ‰¾åˆ°åŽä¼šè°ƒç”¨ Entry çš„ clear æ–¹æ³•ï¼Œå°† Entry çš„ value è®¾ç½®ä¸º nullã€‚</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title function_">remove</span><span class="params">(ThreadLocal&lt;?&gt; key)</span> &#123;</span><br><span class="line">    Entry[] tab = table;</span><br><span class="line">    <span class="type">int</span> <span class="variable">len</span> <span class="operator">=</span> tab.length;</span><br><span class="line">    <span class="comment">// è®¡ç®— key çš„ hash å€¼</span></span><br><span class="line">    <span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> key.threadLocalHashCode &amp; (len-<span class="number">1</span>);</span><br><span class="line">    <span class="comment">// éåŽ†æ•°ç»„ï¼Œæ‰¾åˆ° key ä¸º null çš„ Entry</span></span><br><span class="line">    <span class="keyword">for</span> (<span class="type">Entry</span> <span class="variable">e</span> <span class="operator">=</span> tab[i];</span><br><span class="line">            e != <span class="literal">null</span>;</span><br><span class="line">            e = tab[i = nextIndex(i, len)]) &#123;</span><br><span class="line">        <span class="keyword">if</span> (e.get() == key) &#123;</span><br><span class="line">            <span class="comment">// å°†è¯¥ Entry çš„ key ç½®ä¸º nullï¼ˆå³ Entry å¤±æ•ˆï¼‰</span></span><br><span class="line">            e.clear();</span><br><span class="line">            <span class="comment">// æ¸…ç†è¿‡æœŸçš„ entry</span></span><br><span class="line">            expungeStaleEntry(i);</span><br><span class="line">            <span class="keyword">return</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">clear</span><span class="params">()</span> &#123;</span><br><span class="line">    <span class="built_in">this</span>.referent = <span class="literal">null</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>ç„¶åŽæ‰§è¡Œ <code>expungeStaleEntry()</code> æ–¹æ³•ï¼Œæ¸…é™¤ key ä¸º null çš„ Entryã€‚</p>
<p><img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="https://cdn.jsdelivr.net/gh/JakicDong/blog-assets@main/images/20251003170914.png" alt="20251003170914"><br>äºŒå“¥çš„Javaè¿›é˜¶ä¹‹è·¯ï¼šexpungeStaleEntry</p>
<h4 id="é‚£ä¸ºä»€ä¹ˆ-key-è¦è®¾è®¡æˆå¼±å¼•ç”¨ï¼Ÿ"><a href="#é‚£ä¸ºä»€ä¹ˆ-key-è¦è®¾è®¡æˆå¼±å¼•ç”¨ï¼Ÿ" class="headerlink" title="é‚£ä¸ºä»€ä¹ˆ key è¦è®¾è®¡æˆå¼±å¼•ç”¨ï¼Ÿ"></a>é‚£ä¸ºä»€ä¹ˆ key è¦è®¾è®¡æˆå¼±å¼•ç”¨ï¼Ÿ</h4><p>å¼±å¼•ç”¨çš„å¥½å¤„æ˜¯ï¼Œå½“å†…å­˜ä¸è¶³çš„æ—¶å€™ï¼ŒJVM èƒ½å¤ŸåŠæ—¶å›žæ”¶æŽ‰å¼±å¼•ç”¨çš„å¯¹è±¡ã€‚</p>
<p>æ¯”å¦‚è¯´ï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">WeakReference</span> <span class="variable">key</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">WeakReference</span>(<span class="keyword">new</span> <span class="title class_">ThreadLocal</span>());</span><br></pre></td></tr></table></figure>

<p>key æ˜¯å¼±å¼•ç”¨ï¼Œ<code>new WeakReference(new ThreadLocal())</code> æ˜¯å¼±å¼•ç”¨å¯¹è±¡ï¼Œå½“ JVM è¿›è¡Œåžƒåœ¾å›žæ”¶æ—¶ï¼Œåªè¦å‘çŽ°äº†å¼±å¼•ç”¨å¯¹è±¡ï¼Œå°±ä¼šå°†å…¶å›žæ”¶ã€‚</p>
<p>ä¸€æ—¦ key è¢«å›žæ”¶ï¼ŒThreadLocalMap åœ¨è¿›è¡Œ setã€get çš„æ—¶å€™å°±ä¼šå¯¹ key ä¸º null çš„ Entry è¿›è¡Œæ¸…ç†ã€‚</p>
<p><img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="https://cdn.jsdelivr.net/gh/JakicDong/blog-assets@main/images/20251003171039.png" alt="20251003171039"><br>äºŒå“¥çš„ Java è¿›é˜¶ä¹‹è·¯ï¼šæ¸…ç† entry</p>
<p>æ€»ç»“ä¸€ä¸‹ï¼Œåœ¨ ThreadLocal è¢«åžƒåœ¾æ”¶é›†åŽï¼Œä¸‹ä¸€æ¬¡è®¿é—® ThreadLocalMap æ—¶ï¼ŒJava ä¼šè‡ªåŠ¨æ¸…ç†é‚£äº›é”®ä¸º null çš„ entryï¼Œè¿™ä¸ªè¿‡ç¨‹ä¼šåœ¨æ‰§è¡Œ <code>get()</code>ã€<code>set()</code>ã€<code>remove()</code>æ—¶è§¦å‘ã€‚</p>
<p><img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="https://cdn.jsdelivr.net/gh/JakicDong/blog-assets@main/images/20251003171336.png" alt="20251003171336"><br>äºŒå“¥çš„ Java è¿›é˜¶ä¹‹è·¯ï¼šreplaceStaleEntryæ–¹æ³•</p>
<h4 id="ä½ äº†è§£å“ªäº›-ThreadLocal-çš„æ”¹è¿›æ–¹æ¡ˆï¼Ÿ"><a href="#ä½ äº†è§£å“ªäº›-ThreadLocal-çš„æ”¹è¿›æ–¹æ¡ˆï¼Ÿ" class="headerlink" title="ä½ äº†è§£å“ªäº› ThreadLocal çš„æ”¹è¿›æ–¹æ¡ˆï¼Ÿ"></a>ä½ äº†è§£å“ªäº› ThreadLocal çš„æ”¹è¿›æ–¹æ¡ˆï¼Ÿ</h4><p>åœ¨ JDK 20 Early-Access Build 28 ç‰ˆæœ¬ä¸­ï¼Œå‡ºçŽ°äº† ThreadLocal çš„æ”¹è¿›æ–¹æ¡ˆï¼Œå³ <code>ScopedValue</code>ã€‚</p>
<p>è¿˜æœ‰ Netty ä¸­çš„ FastThreadLocalï¼Œå®ƒæ˜¯ Netty å¯¹ ThreadLocal çš„ä¼˜åŒ–ï¼Œå†…éƒ¨ç»´æŠ¤äº†ä¸€ä¸ªç´¢å¼•å¸¸é‡ indexï¼Œæ¯æ¬¡åˆ›å»º FastThreadLocal ä¸­éƒ½ä¼šè‡ªåŠ¨+1ï¼Œç”¨æ¥å–ä»£ hash å†²çªå¸¦æ¥çš„æŸè€—ï¼Œç”¨ç©ºé—´æ¢æ—¶é—´ã€‚</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">private</span> <span class="keyword">final</span> <span class="type">int</span> index;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="title function_">FastThreadLocal</span><span class="params">()</span> &#123;</span><br><span class="line">    index = InternalThreadLocalMap.nextVariableIndex();</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="type">int</span> <span class="title function_">nextVariableIndex</span><span class="params">()</span> &#123;</span><br><span class="line">    <span class="type">int</span> <span class="variable">index</span> <span class="operator">=</span> nextIndex.getAndIncrement();</span><br><span class="line">    <span class="keyword">if</span> (index &lt; <span class="number">0</span>) &#123;</span><br><span class="line">        nextIndex.decrementAndGet();</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> index;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>ä»¥åŠé˜¿é‡Œçš„ TransmittableThreadLocalï¼Œä¸ä»…å®žçŽ°äº†å­çº¿ç¨‹å¯ä»¥ç»§æ‰¿çˆ¶çº¿ç¨‹ ThreadLocal çš„åŠŸèƒ½ï¼Œå¹¶ä¸”è¿˜å¯ä»¥è·¨çº¿ç¨‹æ± ä¼ é€’å€¼ã€‚</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">TransmittableThreadLocal&lt;String&gt; context = <span class="keyword">new</span> <span class="title class_">TransmittableThreadLocal</span>&lt;&gt;();</span><br><span class="line"></span><br><span class="line"><span class="comment">// åœ¨çˆ¶çº¿ç¨‹ä¸­è®¾ç½®</span></span><br><span class="line">context.set(<span class="string">&quot;value-set-in-parent&quot;</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// åœ¨å­çº¿ç¨‹ä¸­å¯ä»¥è¯»å–ï¼Œå€¼æ˜¯&quot;value-set-in-parent&quot;</span></span><br><span class="line"><span class="type">String</span> <span class="variable">value</span> <span class="operator">=</span> context.get();</span><br></pre></td></tr></table></figure>



<h3 id="20-ðŸŒŸè¯´ä¸€ä¸‹ä½ å¯¹-Java-å†…å­˜æ¨¡åž‹çš„ç†è§£ï¼Ÿ"><a href="#20-ðŸŒŸè¯´ä¸€ä¸‹ä½ å¯¹-Java-å†…å­˜æ¨¡åž‹çš„ç†è§£ï¼Ÿ" class="headerlink" title="20.ðŸŒŸè¯´ä¸€ä¸‹ä½ å¯¹ Java å†…å­˜æ¨¡åž‹çš„ç†è§£ï¼Ÿ"></a>20.ðŸŒŸè¯´ä¸€ä¸‹ä½ å¯¹ Java å†…å­˜æ¨¡åž‹çš„ç†è§£ï¼Ÿ</h3><p>æŽ¨èé˜…è¯»ï¼š<a target="_blank" rel="noopener" href="https://javabetter.cn/thread/jmm.html">è¯´è¯´ Java çš„å†…å­˜æ¨¡åž‹</a></p>
<p>Java å†…å­˜æ¨¡åž‹æ˜¯ Java è™šæ‹Ÿæœºè§„èŒƒä¸­å®šä¹‰çš„ä¸€ä¸ªæŠ½è±¡æ¨¡åž‹ï¼Œç”¨æ¥æè¿°å¤šçº¿ç¨‹çŽ¯å¢ƒä¸­å…±äº«å˜é‡çš„å†…å­˜å¯è§æ€§ã€‚</p>
<p><img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="https://cdn.jsdelivr.net/gh/JakicDong/blog-assets@main/images/20251004132340.png" alt="20251004132340"><br>æ·±å…¥æµ…å‡º Java å¤šçº¿ç¨‹ï¼šJavaå†…å­˜æ¨¡åž‹</p>
<p>å…±äº«å˜é‡å­˜å‚¨åœ¨<code>ä¸»å†…å­˜</code>ä¸­ï¼Œæ¯ä¸ªçº¿ç¨‹éƒ½æœ‰ä¸€ä¸ªç§æœ‰çš„<code>æœ¬åœ°å†…å­˜</code>ï¼Œå­˜å‚¨äº†å…±äº«å˜é‡çš„å‰¯æœ¬ã€‚</p>
<ul>
<li>å½“ä¸€ä¸ªçº¿ç¨‹æ›´æ”¹äº†æœ¬åœ°å†…å­˜ä¸­å…±äº«å˜é‡çš„å‰¯æœ¬ï¼Œå®ƒéœ€è¦ JVM åˆ·æ–°åˆ°ä¸»å†…å­˜ä¸­ï¼Œä»¥ç¡®ä¿å…¶ä»–çº¿ç¨‹å¯ä»¥çœ‹åˆ°è¿™äº›æ›´æ”¹ã€‚</li>
<li>å½“ä¸€ä¸ªçº¿ç¨‹éœ€è¦è¯»å–å…±äº«å˜é‡æ—¶ï¼Œå®ƒä¸€ç‰ˆä¼šä»Žæœ¬åœ°å†…å­˜ä¸­è¯»å–ã€‚å¦‚æžœæœ¬åœ°å†…å­˜ä¸­çš„å‰¯æœ¬æ˜¯è¿‡æ—¶çš„ï¼ŒJVM ä¼šå°†ä¸»å†…å­˜ä¸­çš„å…±äº«å˜é‡æœ€æ–°å€¼åˆ·æ–°åˆ°æœ¬åœ°å†…å­˜ä¸­ã€‚</li>
</ul>
<p><img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="https://cdn.jsdelivr.net/gh/JakicDong/blog-assets@main/images/20251004132756.png" alt="20251004132756"><br>ä¸‰åˆ†æ¶é¢æ¸£é€†è¢­ï¼šå®žé™…çº¿ç¨‹å·¥ä½œæ¨¡åž‹</p>
<h4 id="ä¸ºä»€ä¹ˆçº¿ç¨‹è¦ç”¨è‡ªå·±çš„å†…å­˜ï¼Ÿ"><a href="#ä¸ºä»€ä¹ˆçº¿ç¨‹è¦ç”¨è‡ªå·±çš„å†…å­˜ï¼Ÿ" class="headerlink" title="ä¸ºä»€ä¹ˆçº¿ç¨‹è¦ç”¨è‡ªå·±çš„å†…å­˜ï¼Ÿ"></a>ä¸ºä»€ä¹ˆçº¿ç¨‹è¦ç”¨è‡ªå·±çš„å†…å­˜ï¼Ÿ</h4><p>çº¿ç¨‹ä»Žä¸»å†…å­˜æ‹·è´å˜é‡åˆ°å·¥ä½œå†…å­˜ï¼Œå¯ä»¥å‡å°‘ CPU è®¿é—® RAM çš„å¼€é”€ã€‚</p>
<p>æ¯ä¸ªçº¿ç¨‹éƒ½æœ‰è‡ªå·±çš„å˜é‡å‰¯æœ¬ï¼Œå¯ä»¥é¿å…å¤šä¸ªçº¿ç¨‹åŒæ—¶ä¿®æ”¹å…±äº«å˜é‡å¯¼è‡´çš„æ•°æ®å†²çªã€‚</p>
<h3 id="25-ðŸŒŸvolatile-äº†è§£å—ï¼Ÿ"><a href="#25-ðŸŒŸvolatile-äº†è§£å—ï¼Ÿ" class="headerlink" title="25.ðŸŒŸvolatile äº†è§£å—ï¼Ÿ"></a>25.ðŸŒŸvolatile äº†è§£å—ï¼Ÿ</h3><p>æŽ¨èé˜…è¯»ï¼š<a target="_blank" rel="noopener" href="https://javabetter.cn/thread/volatile.html">volatile å…³é”®å­—è§£æž</a></p>
<p>äº†è§£ã€‚</p>
<p>ç¬¬ä¸€ï¼Œä¿è¯å¯è§æ€§ï¼Œçº¿ç¨‹ä¿®æ”¹ volatile å˜é‡åŽï¼Œå…¶ä»–çº¿ç¨‹èƒ½å¤Ÿç«‹å³çœ‹åˆ°æœ€æ–°å€¼ï¼›ç¬¬äºŒï¼Œé˜²æ­¢æŒ‡ä»¤é‡æŽ’ï¼Œvolatile å˜é‡çš„å†™å…¥ä¸ä¼šè¢«é‡æŽ’åºåˆ°å®ƒä¹‹å‰çš„ä»£ç ã€‚</p>
<h4 id="volatile-æ€Žä¹ˆä¿è¯å¯è§æ€§çš„ï¼Ÿ"><a href="#volatile-æ€Žä¹ˆä¿è¯å¯è§æ€§çš„ï¼Ÿ" class="headerlink" title="volatile æ€Žä¹ˆä¿è¯å¯è§æ€§çš„ï¼Ÿ"></a>volatile æ€Žä¹ˆä¿è¯å¯è§æ€§çš„ï¼Ÿ</h4><p>å½“çº¿ç¨‹å¯¹ volatile å˜é‡è¿›è¡Œå†™æ“ä½œæ—¶ï¼ŒJVM ä¼šåœ¨è¿™ä¸ªå˜é‡å†™å…¥ä¹‹åŽæ’å…¥ä¸€ä¸ªå†™å±éšœæŒ‡ä»¤ï¼Œè¿™ä¸ªæŒ‡ä»¤ä¼šå¼ºåˆ¶å°†æœ¬åœ°å†…å­˜ä¸­çš„å˜é‡å€¼åˆ·æ–°åˆ°ä¸»å†…å­˜ä¸­ã€‚</p>
<p><img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="https://cdn.jsdelivr.net/gh/JakicDong/blog-assets@main/images/20251004145546.png" alt="20251004145546"><br>ä¸‰åˆ†æ¶é¢æ¸£é€†è¢­ï¼švolatileå†™æ’å…¥å†…å­˜å±éšœåŽç”Ÿæˆçš„æŒ‡ä»¤åºåˆ—ç¤ºæ„å›¾</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">StoreStore;   <span class="comment">// ä¿è¯å†™å…¥ä¹‹å‰çš„æ“ä½œä¸ä¼šé‡æŽ’</span></span><br><span class="line">volatile_write(); <span class="comment">// å†™å…¥ volatile å˜é‡</span></span><br><span class="line">StoreLoad;    <span class="comment">// ä¿è¯å†™å…¥åŽï¼Œå…¶ä»–çº¿ç¨‹ç«‹å³å¯è§</span></span><br></pre></td></tr></table></figure>

<p>åœ¨ x86 æž¶æž„ä¸‹ï¼Œé€šå¸¸ä¼šä½¿ç”¨ <code>lock</code> æŒ‡ä»¤æ¥å®žçŽ°å†™å±éšœï¼Œä¾‹å¦‚ï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">mov [a], <span class="number">2</span>          ; å°†å€¼ <span class="number">2</span> å†™å…¥å†…å­˜åœ°å€ a</span><br><span class="line">lock add [a], <span class="number">0</span>     ; lock æŒ‡ä»¤å……å½“å†™å±éšœï¼Œç¡®ä¿å†…å­˜å¯è§æ€§</span><br></pre></td></tr></table></figure>

<p>å½“çº¿ç¨‹å¯¹ volatile å˜é‡è¿›è¡Œè¯»æ“ä½œæ—¶ï¼ŒJVM ä¼šæ’å…¥ä¸€ä¸ªè¯»å±éšœæŒ‡ä»¤ï¼Œè¿™ä¸ªæŒ‡ä»¤ä¼šå¼ºåˆ¶è®©æœ¬åœ°å†…å­˜ä¸­çš„å˜é‡å€¼å¤±æ•ˆï¼Œä»Žè€Œé‡æ–°ä»Žä¸»å†…å­˜ä¸­è¯»å–æœ€æ–°çš„å€¼ã€‚</p>
<p><img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="https://cdn.jsdelivr.net/gh/JakicDong/blog-assets@main/images/20251004152020.png" alt="20251004152020"><br>ä¸‰åˆ†æ¶é¢æ¸£é€†è¢­ï¼švolatileå†™æ’å…¥å†…å­˜å±éšœåŽç”Ÿæˆçš„æŒ‡ä»¤åºåˆ—ç¤ºæ„å›¾</p>
<p>æˆ‘ä»¬æ¥å£°æ˜Žä¸€ä¸ª volatile å˜é‡ xï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">volatile</span> <span class="type">int</span> <span class="variable">x</span> <span class="operator">=</span> <span class="number">0</span></span><br></pre></td></tr></table></figure>

<p>çº¿ç¨‹ A å¯¹ x å†™å…¥åŽä¼šå°†å…¶æœ€æ–°çš„å€¼åˆ·æ–°åˆ°ä¸»å†…å­˜ä¸­ï¼Œçº¿ç¨‹ B è¯»å– x æ—¶ç”±äºŽæœ¬åœ°å†…å­˜ä¸­çš„ x å¤±æ•ˆäº†ï¼Œå°±ä¼šä»Žä¸»å†…å­˜ä¸­è¯»å–æœ€æ–°çš„å€¼ã€‚</p>
<p><img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="https://cdn.jsdelivr.net/gh/JakicDong/blog-assets@main/images/20251004152103.png" alt="20251004152103"><br>ä¸‰åˆ†æ¶é¢æ¸£é€†è¢­ï¼švolatileå†…å­˜å¯è§æ€§</p>
<h4 id="volatile-æ€Žä¹ˆä¿è¯æœ‰åºæ€§çš„ï¼Ÿ"><a href="#volatile-æ€Žä¹ˆä¿è¯æœ‰åºæ€§çš„ï¼Ÿ" class="headerlink" title="volatile æ€Žä¹ˆä¿è¯æœ‰åºæ€§çš„ï¼Ÿ"></a>volatile æ€Žä¹ˆä¿è¯æœ‰åºæ€§çš„ï¼Ÿ</h4><p>JVM ä¼šåœ¨ volatile å˜é‡çš„è¯»å†™å‰åŽæ’å…¥ â€œå†…å­˜å±éšœâ€ï¼Œä»¥çº¦æŸ CPU å’Œç¼–è¯‘å™¨çš„ä¼˜åŒ–è¡Œä¸ºï¼š</p>
<ul>
<li>StoreStore å±éšœå¯ä»¥ç¦æ­¢<code>volatile å†™</code>æ“ä½œä¸Ž<code>æ™®é€šå†™</code>æ“ä½œçš„é‡æŽ’</li>
<li>StoreLoad å±éšœä¼šç¦æ­¢<code>volatile å†™</code>ä¸Ž<code>volatile è¯»</code>é‡æŽ’</li>
<li>LoadLoad å±éšœä¼šç¦æ­¢<code>volatile è¯»</code>ä¸ŽåŽç»­<code>æ™®é€šè¯»</code>æ“ä½œé‡æŽ’</li>
<li>LoadStore å±éšœä¼šç¦æ­¢<code>volatile è¯»</code>ä¸ŽåŽç»­<code>æ™®é€šå†™</code>æ“ä½œé‡æŽ’</li>
</ul>
<h4 id="volatile-å’Œ-synchronized-çš„åŒºåˆ«ï¼Ÿ"><a href="#volatile-å’Œ-synchronized-çš„åŒºåˆ«ï¼Ÿ" class="headerlink" title="volatile å’Œ synchronized çš„åŒºåˆ«ï¼Ÿ"></a>volatile å’Œ synchronized çš„åŒºåˆ«ï¼Ÿ</h4><p>volatile å…³é”®å­—ç”¨äºŽä¿®é¥°å˜é‡ï¼Œç¡®ä¿è¯¥å˜é‡çš„æ›´æ–°æ“ä½œå¯¹æ‰€æœ‰çº¿ç¨‹æ˜¯å¯è§çš„ï¼Œå³ä¸€æ—¦æŸä¸ªçº¿ç¨‹ä¿®æ”¹äº† volatile å˜é‡ï¼Œå…¶ä»–çº¿ç¨‹ä¼šç«‹å³çœ‹åˆ°æœ€æ–°çš„å€¼ã€‚</p>
<p>synchronized å…³é”®å­—ç”¨äºŽä¿®é¥°æ–¹æ³•æˆ–ä»£ç å—ï¼Œç¡®ä¿åŒä¸€æ—¶åˆ»åªæœ‰ä¸€ä¸ªçº¿ç¨‹èƒ½å¤Ÿæ‰§è¡Œè¯¥æ–¹æ³•æˆ–ä»£ç å—ï¼Œä»Žè€Œå®žçŽ°äº’æ–¥è®¿é—®ã€‚</p>
<h4 id="volatile-åŠ åœ¨åŸºæœ¬ç±»åž‹å’Œå¯¹è±¡ä¸Šçš„åŒºåˆ«ï¼Ÿ"><a href="#volatile-åŠ åœ¨åŸºæœ¬ç±»åž‹å’Œå¯¹è±¡ä¸Šçš„åŒºåˆ«ï¼Ÿ" class="headerlink" title="volatile åŠ åœ¨åŸºæœ¬ç±»åž‹å’Œå¯¹è±¡ä¸Šçš„åŒºåˆ«ï¼Ÿ"></a>volatile åŠ åœ¨åŸºæœ¬ç±»åž‹å’Œå¯¹è±¡ä¸Šçš„åŒºåˆ«ï¼Ÿ</h4><p>å½“ <code>volatile</code> ç”¨äºŽåŸºæœ¬æ•°æ®ç±»åž‹æ—¶ï¼Œèƒ½ç¡®ä¿è¯¥å˜é‡çš„è¯»å†™æ“ä½œæ˜¯ç›´æŽ¥ä»Žä¸»å†…å­˜ä¸­è¯»å–æˆ–å†™å…¥çš„ã€‚</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">private</span> <span class="keyword">volatile</span> <span class="type">int</span> <span class="variable">count</span> <span class="operator">=</span> <span class="number">0</span>;</span><br></pre></td></tr></table></figure>

<p>å½“ <code>volatile</code> ç”¨äºŽå¼•ç”¨ç±»åž‹æ—¶ï¼Œèƒ½ç¡®ä¿å¼•ç”¨æœ¬èº«çš„å¯è§æ€§ï¼Œå³ç¡®ä¿å¼•ç”¨æŒ‡å‘çš„å¯¹è±¡åœ°å€æ˜¯æœ€æ–°çš„ã€‚</p>
<p>ä½†æ˜¯ï¼Œ<code>volatile</code> å¹¶ä¸èƒ½ä¿è¯å¼•ç”¨å¯¹è±¡å†…éƒ¨çŠ¶æ€çš„çº¿ç¨‹å®‰å…¨ã€‚</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">private</span> <span class="keyword">volatile</span> <span class="type">SomeObject</span> <span class="variable">obj</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">SomeObject</span>();</span><br></pre></td></tr></table></figure>

<p>è™½ç„¶ <code>volatile</code> ç¡®ä¿äº† <code>obj</code> å¼•ç”¨çš„å¯è§æ€§ï¼Œä½†å¯¹ <code>obj</code> å¼•ç”¨çš„ <code>new SomeObject()</code> å¯¹è±¡å¹¶ä¸å— <code>volatile</code> ä¿æŠ¤ã€‚</p>
<p>å¦‚æžœéœ€è¦ä¿è¯å¼•ç”¨å¯¹è±¡å†…éƒ¨çŠ¶æ€çš„çº¿ç¨‹å®‰å…¨ï¼Œéœ€è¦ä½¿ç”¨ <code>synchronized</code> æˆ– <code>ReentrantLock</code> ç­‰é”æœºåˆ¶ã€‚</p>
<h3 id="29-ðŸŒŸsynchronized-é”å‡çº§äº†è§£å—ï¼Ÿ"><a href="#29-ðŸŒŸsynchronized-é”å‡çº§äº†è§£å—ï¼Ÿ" class="headerlink" title="29.ðŸŒŸsynchronized é”å‡çº§äº†è§£å—ï¼Ÿ"></a>29.ðŸŒŸsynchronized é”å‡çº§äº†è§£å—ï¼Ÿ</h3><p>æŽ¨èé˜…è¯»ï¼š<a target="_blank" rel="noopener" href="https://javabetter.cn/thread/synchronized.html">åå‘é”ã€è½»é‡çº§é”ã€é‡é‡çº§é”åˆ°åº•æ˜¯ä»€ä¹ˆï¼Ÿ</a></p>
<p>JDK 1.6 çš„æ—¶å€™ï¼Œä¸ºäº†æå‡ synchronized çš„æ€§èƒ½ï¼Œå¼•å…¥äº†é”å‡çº§æœºåˆ¶ï¼Œä»Žä½Žå¼€é”€çš„é”é€æ­¥å‡çº§åˆ°é«˜å¼€é”€çš„é”ï¼Œä»¥æœ€å¤§ç¨‹åº¦å‡å°‘é”çš„ç«žäº‰ã€‚</p>
<p><img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="https://cdn.jsdelivr.net/gh/JakicDong/blog-assets@main/images/20251009111617.png" alt="20251009111617"><br>ä¸‰åˆ†æ¶é¢æ¸£é€†è¢­ï¼šMark Wordå˜åŒ–</p>
<p>æ²¡æœ‰çº¿ç¨‹ç«žäº‰æ—¶ï¼Œå°±ä½¿ç”¨ä½Žå¼€é”€çš„â€œåå‘é”â€ï¼Œæ­¤æ—¶æ²¡æœ‰é¢å¤–çš„ CAS æ“ä½œï¼›è½»åº¦ç«žäº‰æ—¶ï¼Œä½¿ç”¨â€œè½»é‡çº§é”â€ï¼Œé‡‡ç”¨ CAS è‡ªæ—‹ï¼Œé¿å…çº¿ç¨‹é˜»å¡žï¼›åªæœ‰åœ¨é‡åº¦ç«žäº‰æ—¶ï¼Œæ‰ä½¿ç”¨â€œé‡é‡çº§é”â€ï¼Œç”± Monitor æœºåˆ¶å®žçŽ°ï¼Œéœ€è¦çº¿ç¨‹é˜»å¡žã€‚</p>
<h4 id="äº†è§£-synchronized-å››ç§é”çŠ¶æ€å—ï¼Ÿ"><a href="#äº†è§£-synchronized-å››ç§é”çŠ¶æ€å—ï¼Ÿ" class="headerlink" title="äº†è§£ synchronized å››ç§é”çŠ¶æ€å—ï¼Ÿ"></a>äº†è§£ synchronized å››ç§é”çŠ¶æ€å—ï¼Ÿ</h4><p>äº†è§£ã€‚</p>
<p>â‘ ã€æ— é”çŠ¶æ€ï¼Œå¯¹è±¡æœªè¢«é”å®šï¼ŒMark Word å­˜å‚¨å¯¹è±¡çš„å“ˆå¸Œç ç­‰ä¿¡æ¯ã€‚</p>
<p>â‘¡ã€åå‘é”ï¼Œå½“çº¿ç¨‹ç¬¬ä¸€æ¬¡èŽ·å–é”æ—¶ï¼Œä¼šè¿›å…¥åå‘æ¨¡å¼ã€‚Mark Word ä¼šè®°å½•çº¿ç¨‹ IDï¼ŒåŽç»­åŒä¸€çº¿ç¨‹å†æ¬¡èŽ·å–é”æ—¶ï¼Œå¯ä»¥ç›´æŽ¥è¿›å…¥ synchronized åŠ é”çš„ä»£ç ï¼Œæ— éœ€é¢å¤–åŠ é”ã€‚</p>
<p><img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="https://cdn.jsdelivr.net/gh/JakicDong/blog-assets@main/images/20251009112449.png" alt="20251009112449"><br>åšå®¢å›­boluo1230ï¼šåå‘é”</p>
<p>â‘¢ã€è½»é‡çº§é”ï¼Œå½“å¤šä¸ªçº¿ç¨‹åœ¨ä¸åŒæ—¶æ®µèŽ·å–åŒä¸€æŠŠé”ï¼Œå³ä¸å­˜åœ¨é”ç«žäº‰çš„æƒ…å†µæ—¶ï¼ŒJVM ä¼šé‡‡ç”¨è½»é‡çº§é”æ¥é¿å…çº¿ç¨‹é˜»å¡žã€‚</p>
<p>æœªæŒæœ‰é”çš„çº¿ç¨‹é€šè¿‡<a target="_blank" rel="noopener" href="https://javabetter.cn/thread/cas.html">CAS è‡ªæ—‹</a>ç­‰å¾…é”é‡Šæ”¾ã€‚</p>
<p><img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="https://cdn.jsdelivr.net/gh/JakicDong/blog-assets@main/images/20251009141857.png" alt="20251009141857"><br>TodoCoderï¼šè‡ªæ—‹å’Œé˜»å¡žçš„åŒºåˆ«</p>
<p>å½“çº¿ç¨‹è¿›å…¥ synchronized åŠ é”çš„ä»£ç æ—¶ï¼Œå¦‚æžœå¯¹è±¡çš„é”çŠ¶æ€ä¸ºåå‘é”ï¼Œä¹Ÿå°±æ˜¯é”ç±»åž‹ä¸ºâ€œ01â€ï¼Œåå‘é”æ ‡è®°ä¸ºâ€œ0â€çš„çŠ¶æ€ã€‚</p>
<p><img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="https://cdn.jsdelivr.net/gh/JakicDong/blog-assets@main/images/20251009142009.png" alt="20251009142009"><br>åšå®¢å›­wade&amp;luffyï¼šMark Word</p>
<p>ç„¶åŽé‡‡ç”¨ CAS è‡ªæ—‹çš„æ–¹å¼ï¼Œå°è¯•å°†å¯¹è±¡å¤´ä¸­çš„ Mark Word æ›¿æ¢ä¸ºæŒ‡å‘ Lock Record çš„æŒ‡é’ˆï¼Œå¹¶å°† Lock Record ä¸­çš„ owner æŒ‡é’ˆæŒ‡å‘å¯¹è±¡çš„ Mark Wordã€‚</p>
<p><img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="https://cdn.jsdelivr.net/gh/JakicDong/blog-assets@main/images/20251009142022.png" alt="20251009142022"><br>åšå®¢å›­boluo1230ï¼šè½»é‡çº§é”</p>
<p>å¦‚æžœè¿™ä¸ªæ›¿æ¢åŠ¨ä½œæˆåŠŸäº†ï¼Œçº¿ç¨‹å°±æ‹¥æœ‰äº†è¯¥å¯¹è±¡çš„é”ï¼Œå¯¹è±¡å¤´ Mark Word çš„é”æ ‡å¿—ä½ä¼šæ›´æ–°ä¸ºâ€œ00â€ï¼Œè¡¨ç¤ºå¯¹è±¡å¤„äºŽè½»é‡çº§é”çŠ¶æ€ã€‚</p>
<p>â‘£ã€é‡é‡çº§é”ï¼Œå¦‚æžœè‡ªæ—‹è¶…è¿‡ä¸€å®šçš„æ¬¡æ•°ï¼Œæˆ–è€…ä¸€ä¸ªçº¿ç¨‹æŒæœ‰é”ï¼Œä¸€ä¸ªè‡ªæ—‹ï¼Œåˆæœ‰ç¬¬ä¸‰ä¸ªçº¿ç¨‹è¿›å…¥ synchronized åŠ é”çš„ä»£ç æ—¶ï¼Œè½»é‡çº§é”å°±ä¼šå‡çº§ä¸ºé‡é‡çº§é”ã€‚</p>
<p>æ­¤æ—¶ï¼Œå¯¹è±¡å¤´çš„é”ç±»åž‹ä¼šæ›´æ–°ä¸ºâ€œ10â€ï¼ŒMark Word ä¼šå­˜å‚¨æŒ‡å‘ Monitor å¯¹è±¡çš„æŒ‡é’ˆï¼Œå…¶ä»–ç­‰å¾…é”çš„çº¿ç¨‹éƒ½ä¼šè¿›å…¥é˜»å¡žçŠ¶æ€ã€‚</p>
<h4 id="synchronized-åšäº†å“ªäº›ä¼˜åŒ–ï¼Ÿ"><a href="#synchronized-åšäº†å“ªäº›ä¼˜åŒ–ï¼Ÿ" class="headerlink" title="synchronized åšäº†å“ªäº›ä¼˜åŒ–ï¼Ÿ"></a>synchronized åšäº†å“ªäº›ä¼˜åŒ–ï¼Ÿ</h4><p>åœ¨ JDK 1.6 ä¹‹å‰ï¼Œsynchronized æ˜¯ç›´æŽ¥è°ƒç”¨ ObjectMonitor çš„ enter å’Œ exit æŒ‡ä»¤å®žçŽ°çš„ï¼Œè¿™ç§é”ä¹Ÿè¢«ç§°ä¸º<strong>é‡é‡çº§é”</strong>ï¼Œæ€§èƒ½è¾ƒå·®ã€‚</p>
<p>éšç€ JDK ç‰ˆæœ¬çš„æ›´æ–°ï¼Œsynchronized çš„æ€§èƒ½å¾—åˆ°äº†æžå¤§çš„ä¼˜åŒ–ï¼š</p>
<p><strong>â‘ ã€åå‘é”</strong>ï¼šåŒä¸€ä¸ªçº¿ç¨‹å¯ä»¥å¤šæ¬¡èŽ·å–åŒä¸€æŠŠé”ï¼Œæ— éœ€é‡å¤åŠ é”ã€‚</p>
<p><strong>â‘¡ã€è½»é‡çº§é”</strong>ï¼šå½“æ²¡æœ‰çº¿ç¨‹ç«žäº‰æ—¶ï¼Œé€šè¿‡ CAS è‡ªæ—‹ç­‰å¾…é”ï¼Œé¿å…ç›´æŽ¥è¿›å…¥é˜»å¡žã€‚</p>
<p><strong>â‘¢ã€é”æ¶ˆé™¤</strong>ï¼š<a target="_blank" rel="noopener" href="https://javabetter.cn/jvm/jit.html">JIT</a> å¯ä»¥åœ¨è¿è¡Œæ—¶è¿›è¡Œä»£ç åˆ†æžï¼Œå¦‚æžœå‘çŽ°æŸäº›é”æ“ä½œä¸å¯èƒ½è¢«å¤šä¸ªçº¿ç¨‹åŒæ—¶è®¿é—®ï¼Œå°±ä¼šå¯¹è¿™äº›é”è¿›è¡Œæ¶ˆé™¤ï¼Œä»Žè€Œå‡å°‘ä¸Šé”å¼€é”€ã€‚</p>
<h4 id="è¯·è¯¦ç»†è¯´è¯´é”å‡çº§çš„è¿‡ç¨‹ï¼Ÿ"><a href="#è¯·è¯¦ç»†è¯´è¯´é”å‡çº§çš„è¿‡ç¨‹ï¼Ÿ" class="headerlink" title="è¯·è¯¦ç»†è¯´è¯´é”å‡çº§çš„è¿‡ç¨‹ï¼Ÿ"></a>è¯·è¯¦ç»†è¯´è¯´é”å‡çº§çš„è¿‡ç¨‹ï¼Ÿ</h4><p>æ‡µé€¼çŠ¶æ€ä¸‹çš„å›žç­”ï¼šé”å‡çº§ä¼šä»Žæ— é”å‡çº§ä¸ºåå‘é”ï¼Œå†å‡çº§ä¸ºè½»é‡çº§é”ï¼Œæœ€åŽå‡çº§ä¸ºé‡é‡çº§é”ã€‚</p>
<p><img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="https://cdn.jsdelivr.net/gh/JakicDong/blog-assets@main/images/20251009143540.png" alt="20251009143540"><br>ä¸‰åˆ†æ¶é¢æ¸£é€†è¢­ï¼šé”å‡çº§ç®€ç•¥è¿‡ç¨‹</p>
<p>çŸ¥é“ä¸€ç‚¹ï¼Œä½†ä¸æ·±å…¥çš„å›žç­”ï¼š</p>
<p><img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="https://cdn.jsdelivr.net/gh/JakicDong/blog-assets@main/images/20251009143612.png" alt="20251009143612"><br>ä¸‰åˆ†æ¶é¢æ¸£é€†è¢­ï¼šsynchronized é”å‡çº§è¿‡ç¨‹</p>
<p>â‘ ã€åå‘é”ï¼šå½“ä¸€ä¸ªçº¿ç¨‹ç¬¬ä¸€æ¬¡èŽ·å–é”æ—¶ï¼ŒJVM ä¼šåœ¨å¯¹è±¡å¤´çš„ Mark Word è®°å½•è¿™ä¸ªçº¿ç¨‹ IDï¼Œä¸‹æ¬¡è¿›å…¥ synchronized æ—¶ï¼Œå¦‚æžœè¿˜æ˜¯åŒä¸€ä¸ªçº¿ç¨‹ï¼Œå¯ä»¥ç›´æŽ¥æ‰§è¡Œï¼Œæ— éœ€é¢å¤–åŠ é”ã€‚</p>
<p>â‘¡ã€è½»é‡çº§é”ï¼šå½“å¤šä¸ªçº¿ç¨‹å°è¯•èŽ·å–é”ä½†ä¸æ˜¯åŒä¸€ä¸ªæ—¶æ®µï¼Œåå‘é”ä¼šå‡çº§ä¸ºè½»é‡çº§é”ï¼Œç­‰å¾…é”çš„çº¿ç¨‹é€šè¿‡ CAS è‡ªæ—‹é¿å…è¿›å…¥é˜»å¡žçŠ¶æ€ã€‚</p>
<p>â‘¢ã€é‡é‡çº§é”ï¼šå¦‚æžœè‡ªæ—‹å¤±è´¥ï¼Œé”ä¼šå‡çº§ä¸ºé‡é‡çº§é”ï¼Œç­‰å¾…é”çš„çº¿ç¨‹ä¼šè¿›å…¥é˜»å¡žçŠ¶æ€ï¼Œç­‰å¾…ç›‘è§†å™¨ Monitor è¿›è¡Œè°ƒåº¦ã€‚</p>
<p>è¯¦ç»†è§£é‡Šä¸€ä¸‹ï¼š</p>
<p><strong>â‘ ã€ä»Žæ— é”åˆ°åå‘é”ï¼š</strong></p>
<p>å½“ä¸€ä¸ªçº¿ç¨‹é¦–æ¬¡è®¿é—®åŒæ­¥ä»£ç æ—¶ï¼Œå¦‚æžœæ­¤å¯¹è±¡å¤„äºŽæ— é”çŠ¶æ€ä¸”åå‘é”æœªè¢«ç¦ç”¨ï¼ŒJVM ä¼šå°†è¯¥å¯¹è±¡å¤´çš„é”æ ‡è®°æ”¹ä¸ºåå‘é”çŠ¶æ€ï¼Œå¹¶è®°å½•å½“å‰çº¿ç¨‹ IDã€‚æ­¤æ—¶ï¼Œå¯¹è±¡å¤´ä¸­çš„ Mark Word ä¸­å­˜å‚¨äº†æŒæœ‰åå‘é”çš„çº¿ç¨‹ IDã€‚</p>
<p>å¦‚æžœå¦ä¸€ä¸ªçº¿ç¨‹å°è¯•èŽ·å–è¿™ä¸ªå·²è¢«åå‘çš„é”ï¼ŒJVM ä¼šæ£€æŸ¥å½“å‰æŒæœ‰åå‘é”çš„çº¿ç¨‹æ˜¯å¦æ´»è·ƒã€‚å¦‚æžœæŒæœ‰åå‘é”çš„çº¿ç¨‹ä¸æ´»è·ƒï¼Œå¯ä»¥å°†é”åå‘ç»™æ–°çš„çº¿ç¨‹ï¼›å¦åˆ™æ’¤é”€åå‘é”ï¼Œå‡çº§ä¸ºè½»é‡çº§é”ã€‚</p>
<p><strong>â‘¡ã€åå‘é”çš„è½»é‡çº§é”ï¼š</strong></p>
<p>è¿›è¡Œåå‘é”æ’¤é”€æ—¶ï¼Œä¼šéåŽ†å †æ ˆçš„æ‰€æœ‰é”è®°å½•ï¼Œæš‚åœæ‹¥æœ‰åå‘é”çš„çº¿ç¨‹ï¼Œå¹¶æ£€æŸ¥é”å¯¹è±¡ã€‚å¦‚æžœè¿™ä¸ªè¿‡ç¨‹ä¸­å‘çŽ°æœ‰å…¶ä»–çº¿ç¨‹è¯•å›¾èŽ·å–è¿™ä¸ªé”ï¼ŒJVM ä¼šæ’¤é”€åå‘é”ï¼Œå¹¶å°†é”å‡çº§ä¸ºè½»é‡çº§é”ã€‚</p>
<p>å½“æœ‰ä¸¤ä¸ªæˆ–ä»¥ä¸Šçº¿ç¨‹ç«žäº‰åŒä¸€ä¸ªåå‘é”æ—¶ï¼Œåå‘é”æ¨¡å¼ä¸å†æœ‰æ•ˆï¼Œæ­¤æ—¶åå‘é”ä¼šè¢«æ’¤é”€ï¼Œå¯¹è±¡çš„é”çŠ¶æ€ä¼šå‡çº§ä¸ºè½»é‡çº§é”ã€‚</p>
<p><strong>â‘¢ã€è½»é‡çº§é”åˆ°é‡é‡çº§é”ï¼š</strong></p>
<p>è½»é‡çº§é”é€šè¿‡è‡ªæ—‹æ¥ç­‰å¾…é”é‡Šæ”¾ã€‚å¦‚æžœè‡ªæ—‹è¶…è¿‡é¢„å®šæ¬¡æ•°ï¼ˆè‡ªæ—‹æ¬¡æ•°æ˜¯å¯è°ƒçš„ï¼Œå¹¶ä¸”æ˜¯è‡ªé€‚åº”çš„ï¼Œå¤±è´¥æ¬¡æ•°å¤šè‡ªæ—‹æ¬¡æ•°å°±å°‘ï¼‰ï¼Œè¡¨æ˜Žé”ç«žäº‰æ¿€çƒˆã€‚</p>
<p>å½“è‡ªæ—‹å¤šæ¬¡å¤±è´¥ï¼Œæˆ–è€…æœ‰çº¿ç¨‹åœ¨ç­‰å¾…é˜Ÿåˆ—ä¸­ç­‰å¾…ç›¸åŒçš„è½»é‡çº§é”æ—¶ï¼Œè½»é‡çº§é”ä¼šå‡çº§ä¸ºé‡é‡çº§é”ã€‚åœ¨è¿™ç§æƒ…å†µä¸‹ï¼ŒJVM ä¼šåœ¨æ“ä½œç³»ç»Ÿå±‚é¢åˆ›å»ºä¸€ä¸ªäº’æ–¥é”â€”â€”Mutexï¼Œæ‰€æœ‰è¿›ä¸€æ­¥å°è¯•èŽ·å–è¯¥é”çš„çº¿ç¨‹å°†ä¼šè¢«é˜»å¡žï¼Œç›´åˆ°é”è¢«é‡Šæ”¾ã€‚</p>
<h3 id="30-ðŸŒŸsynchronized-å’Œ-ReentrantLock-çš„åŒºåˆ«äº†è§£å—ï¼Ÿ"><a href="#30-ðŸŒŸsynchronized-å’Œ-ReentrantLock-çš„åŒºåˆ«äº†è§£å—ï¼Ÿ" class="headerlink" title="30.ðŸŒŸsynchronized å’Œ ReentrantLock çš„åŒºåˆ«äº†è§£å—ï¼Ÿ"></a>30.ðŸŒŸsynchronized å’Œ ReentrantLock çš„åŒºåˆ«äº†è§£å—ï¼Ÿ</h3><p>ä¸¤å¥è¯å›žç­”ï¼š<a target="_blank" rel="noopener" href="https://javabetter.cn/thread/synchronized-1.html">synchronized</a> ç”± JVM å†…éƒ¨çš„ Monitor æœºåˆ¶å®žçŽ°ï¼Œ<a target="_blank" rel="noopener" href="https://javabetter.cn/thread/reentrantLock.html">ReentrantLock</a>åŸºäºŽ AQS å®žçŽ°ã€‚</p>
<p>synchronized å¯ä»¥è‡ªåŠ¨åŠ é”å’Œè§£é”ï¼ŒReentrantLock éœ€è¦æ‰‹åŠ¨ <code>lock()</code> å’Œ <code>unlock()</code>ã€‚</p>
<p><img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="https://cdn.jsdelivr.net/gh/JakicDong/blog-assets@main/images/20251009151428.png" alt="20251009151428"><br>ä¸‰åˆ†æ¶é¢æ¸£é€†è¢­ï¼šsynchronizedå’ŒReentrantLockçš„åŒºåˆ«</p>
<p>å¦‚æžœé¢è¯•å®˜è¿˜æƒ³çŸ¥é“æ›´å¤šï¼Œå¯ä»¥ç»§ç»­å›žç­”ï¼š</p>
<p>â‘ ã€ReentrantLock å¯ä»¥å®žçŽ°å¤šè·¯é€‰æ‹©é€šçŸ¥ï¼Œç»‘å®šå¤šä¸ª <a target="_blank" rel="noopener" href="https://javabetter.cn/thread/condition.html">Condition</a>ï¼Œè€Œ synchronized åªèƒ½é€šè¿‡ wait å’Œ notify å”¤é†’ï¼Œå±žäºŽå•è·¯é€šçŸ¥ï¼›</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">ReentrantLock</span> <span class="variable">lock</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ReentrantLock</span>();</span><br><span class="line"><span class="type">Condition</span> <span class="variable">condition</span> <span class="operator">=</span> lock.newCondition();</span><br></pre></td></tr></table></figure>

<p>â‘¡ã€synchronized å¯ä»¥åœ¨æ–¹æ³•å’Œä»£ç å—ä¸ŠåŠ é”ï¼ŒReentrantLock åªèƒ½åœ¨ä»£ç å—ä¸ŠåŠ é”ï¼Œä½†å¯ä»¥æŒ‡å®šæ˜¯å…¬å¹³é”è¿˜æ˜¯éžå…¬å¹³é”ã€‚</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// synchronized ä¿®é¥°æ–¹æ³•</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">synchronized</span> <span class="keyword">void</span> <span class="title function_">method</span><span class="params">()</span> &#123;</span><br><span class="line">    <span class="comment">// ä¸šåŠ¡ä»£ç </span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// synchronized ä¿®é¥°ä»£ç å—</span></span><br><span class="line"><span class="keyword">synchronized</span> (<span class="built_in">this</span>) &#123;</span><br><span class="line">    <span class="comment">// ä¸šåŠ¡ä»£ç </span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// ReentrantLock åŠ é”</span></span><br><span class="line"><span class="type">ReentrantLock</span> <span class="variable">lock</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ReentrantLock</span>();</span><br><span class="line">lock.lock();</span><br><span class="line"><span class="keyword">try</span> &#123;</span><br><span class="line">    <span class="comment">// ä¸šåŠ¡ä»£ç </span></span><br><span class="line">&#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">    lock.unlock();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>â‘¢ã€ReentrantLock æä¾›äº†ä¸€ç§èƒ½å¤Ÿä¸­æ–­ç­‰å¾…é”çš„çº¿ç¨‹æœºåˆ¶ï¼Œé€šè¿‡ <code>lock.lockInterruptibly()</code> æ¥å®žçŽ°ã€‚</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">ReentrantLock</span> <span class="variable">lock</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ReentrantLock</span>();</span><br><span class="line"><span class="keyword">try</span> &#123;</span><br><span class="line">    lock.lockInterruptibly();</span><br><span class="line">&#125; <span class="keyword">catch</span> (InterruptedException e) &#123;</span><br><span class="line">    <span class="comment">// å¤„ç†ä¸­æ–­å¼‚å¸¸</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="å¹¶å‘é‡å¤§çš„æƒ…å†µä¸‹ï¼Œä½¿ç”¨-synchronized-è¿˜æ˜¯-ReentrantLockï¼Ÿ"><a href="#å¹¶å‘é‡å¤§çš„æƒ…å†µä¸‹ï¼Œä½¿ç”¨-synchronized-è¿˜æ˜¯-ReentrantLockï¼Ÿ" class="headerlink" title="å¹¶å‘é‡å¤§çš„æƒ…å†µä¸‹ï¼Œä½¿ç”¨ synchronized è¿˜æ˜¯ ReentrantLockï¼Ÿ"></a>å¹¶å‘é‡å¤§çš„æƒ…å†µä¸‹ï¼Œä½¿ç”¨ synchronized è¿˜æ˜¯ ReentrantLockï¼Ÿ</h4><p>æˆ‘æ›´å€¾å‘äºŽ ReentrantLockï¼Œå› ä¸ºï¼š</p>
<ul>
<li>ReentrantLock æä¾›äº†è¶…æ—¶å’Œå…¬å¹³é”ç­‰ç‰¹æ€§ï¼Œå¯ä»¥åº”å¯¹æ›´å¤æ‚çš„å¹¶å‘åœºæ™¯ã€‚</li>
<li>ReentrantLock å…è®¸æ›´ç»†ç²’åº¦çš„é”æŽ§åˆ¶ï¼Œèƒ½æœ‰æ•ˆå‡å°‘é”ç«žäº‰ã€‚</li>
<li>ReentrantLock æ”¯æŒæ¡ä»¶å˜é‡ Conditionï¼Œå¯ä»¥å®žçŽ°æ¯” synchronized æ›´å‹å¥½çš„çº¿ç¨‹é—´é€šä¿¡æœºåˆ¶ã€‚</li>
</ul>
<h4 id="Lock-äº†è§£å—ï¼Ÿ"><a href="#Lock-äº†è§£å—ï¼Ÿ" class="headerlink" title="Lock äº†è§£å—ï¼Ÿ"></a>Lock äº†è§£å—ï¼Ÿ</h4><p>Lock æ˜¯ JUC ä¸­çš„ä¸€ä¸ªæŽ¥å£ï¼Œæœ€å¸¸ç”¨çš„å®žçŽ°ç±»åŒ…æ‹¬å¯é‡å…¥é” ReentrantLockã€è¯»å†™é” ReentrantReadWriteLock ç­‰ã€‚</p>
<h4 id="ReentrantLock-çš„-lock-æ–¹æ³•å®žçŽ°é€»è¾‘äº†è§£å—ï¼Ÿ"><a href="#ReentrantLock-çš„-lock-æ–¹æ³•å®žçŽ°é€»è¾‘äº†è§£å—ï¼Ÿ" class="headerlink" title="ReentrantLock çš„ lock() æ–¹æ³•å®žçŽ°é€»è¾‘äº†è§£å—ï¼Ÿ"></a>ReentrantLock çš„ lock() æ–¹æ³•å®žçŽ°é€»è¾‘äº†è§£å—ï¼Ÿ</h4><p>lock æ–¹æ³•çš„å…·ä½“å®žçŽ°ç”± ReentrantLock å†…éƒ¨çš„ Sync ç±»æ¥å®žçŽ°ï¼Œæ¶‰åŠåˆ°çº¿ç¨‹çš„è‡ªæ—‹ã€é˜»å¡žé˜Ÿåˆ—ã€CASã€AQS ç­‰ã€‚</p>
<p><img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="https://cdn.jsdelivr.net/gh/JakicDong/blog-assets@main/images/20251027092407.png" alt="20251027092407"><br>äºŒå“¥çš„Java è¿›é˜¶ä¹‹è·¯ï¼šLock.lock() æ–¹æ³•æºç </p>
<p>lock æ–¹æ³•ä¼šé¦–å…ˆå°è¯•é€šè¿‡ CAS æ¥èŽ·å–é”ã€‚å¦‚æžœå½“å‰é”æ²¡æœ‰è¢«æŒæœ‰ï¼Œä¼šå°†é”çŠ¶æ€è®¾ç½®ä¸º 1ï¼Œè¡¨ç¤ºé”å·²è¢«å ç”¨ã€‚å¦åˆ™ï¼Œä¼šå°†å½“å‰çº¿ç¨‹åŠ å…¥åˆ° AQS çš„ç­‰å¾…é˜Ÿåˆ—ä¸­ã€‚</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">final</span> <span class="keyword">void</span> <span class="title function_">lock</span><span class="params">()</span> &#123;</span><br><span class="line">    <span class="keyword">if</span> (compareAndSetState(<span class="number">0</span>, <span class="number">1</span>))  <span class="comment">// å°è¯•ç›´æŽ¥èŽ·å–é”</span></span><br><span class="line">        setExclusiveOwnerThread(Thread.currentThread());</span><br><span class="line">    <span class="keyword">else</span></span><br><span class="line">        acquire(<span class="number">1</span>);  <span class="comment">// å¦‚æžœèŽ·å–å¤±è´¥ï¼Œè¿›å…¥AQSé˜Ÿåˆ—ç­‰å¾…</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h3 id="32-ðŸŒŸè¯´è¯´-ReentrantLock-çš„å®žçŽ°åŽŸç†ï¼Ÿ"><a href="#32-ðŸŒŸè¯´è¯´-ReentrantLock-çš„å®žçŽ°åŽŸç†ï¼Ÿ" class="headerlink" title="32.ðŸŒŸè¯´è¯´ ReentrantLock çš„å®žçŽ°åŽŸç†ï¼Ÿ"></a>32.ðŸŒŸè¯´è¯´ ReentrantLock çš„å®žçŽ°åŽŸç†ï¼Ÿ</h3><p><a target="_blank" rel="noopener" href="https://javabetter.cn/thread/reentrantLock.html">ReentrantLock</a> æ˜¯åŸºäºŽ AQS å®žçŽ°çš„ å¯é‡å…¥æŽ’ä»–é”ï¼Œä½¿ç”¨ CAS å°è¯•èŽ·å–é”ï¼Œå¤±è´¥çš„è¯ï¼Œä¼šè¿›å…¥ CLH é˜»å¡žé˜Ÿåˆ—ï¼Œæ”¯æŒå…¬å¹³é”ã€éžå…¬å¹³é”ï¼Œå¯ä»¥ä¸­æ–­ã€è¶…æ—¶ç­‰å¾…ã€‚</p>
<p><img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="https://cdn.jsdelivr.net/gh/JakicDong/blog-assets@main/images/20251009155017.png" alt="20251009155017"><br>ä¸‰åˆ†æ¶é¢æ¸£é€†è¢­ï¼šReentrantLock éžå…¬å¹³é”åŠ é”æµç¨‹ç®€å›¾</p>
<p>å†…éƒ¨é€šè¿‡ä¸€ä¸ªè®¡æ•°å™¨ state æ¥è·Ÿè¸ªé”çš„çŠ¶æ€å’ŒæŒæœ‰æ¬¡æ•°ã€‚å½“çº¿ç¨‹è°ƒç”¨ <code>lock()</code> æ–¹æ³•èŽ·å–é”æ—¶ï¼ŒReentrantLock ä¼šæ£€æŸ¥ state çš„å€¼ï¼Œå¦‚æžœä¸º 0ï¼Œé€šè¿‡ CAS ä¿®æ”¹ä¸º 1ï¼Œè¡¨ç¤ºæˆåŠŸåŠ é”ã€‚å¦åˆ™æ ¹æ®å½“å‰çº¿ç¨‹çš„å…¬å¹³æ€§ç­–ç•¥ï¼ŒåŠ å…¥åˆ°ç­‰å¾…é˜Ÿåˆ—ä¸­ã€‚</p>
<p>çº¿ç¨‹é¦–æ¬¡èŽ·å–é”æ—¶ï¼Œstate å€¼è®¾ä¸º 1ï¼›å¦‚æžœåŒä¸€ä¸ªçº¿ç¨‹å†æ¬¡èŽ·å–é”æ—¶ï¼Œstate åŠ  1ï¼›æ¯é‡Šæ”¾ä¸€æ¬¡é”ï¼Œstate å‡ 1ã€‚</p>
<p>å½“çº¿ç¨‹è°ƒç”¨ <code>unlock()</code> æ–¹æ³•æ—¶ï¼ŒReentrantLock ä¼šå°†æŒæœ‰é”çš„ state å‡ 1ï¼Œå¦‚æžœ <code>state = 0</code>ï¼Œåˆ™é‡Šæ”¾é”ï¼Œå¹¶å”¤é†’ç­‰å¾…é˜Ÿåˆ—ä¸­çš„çº¿ç¨‹æ¥ç«žäº‰é”ã€‚</p>
<p>ä½¿ç”¨æ–¹å¼éžå¸¸ç®€å•ï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">CounterWithLock</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="type">int</span> <span class="variable">count</span> <span class="operator">=</span> <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> <span class="type">Lock</span> <span class="variable">lock</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ReentrantLock</span>();</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">increment</span><span class="params">()</span> &#123;</span><br><span class="line">        lock.lock();  <span class="comment">// èŽ·å–é”</span></span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            count++;</span><br><span class="line">        &#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">            lock.unlock();  <span class="comment">// é‡Šæ”¾é”</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="type">int</span> <span class="title function_">getCount</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> count;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><code>new ReentrantLock()</code> é»˜è®¤åˆ›å»ºçš„æ˜¯éžå…¬å¹³é” NonfairSyncã€‚åœ¨éžå…¬å¹³é”æ¨¡å¼ä¸‹ï¼Œé”å¯èƒ½ä¼šæŽˆäºˆåˆšåˆšè¯·æ±‚å®ƒçš„çº¿ç¨‹ï¼Œè€Œä¸è€ƒè™‘ç­‰å¾…æ—¶é—´ã€‚å½“åˆ‡æ¢åˆ°å…¬å¹³é”æ¨¡å¼ä¸‹ï¼Œé”ä¼šæŽˆäºˆç­‰å¾…æ—¶é—´æœ€é•¿çš„çº¿ç¨‹ã€‚</p>
<h3 id="34-ðŸŒŸCAS-äº†è§£å¤šå°‘ï¼Ÿ"><a href="#34-ðŸŒŸCAS-äº†è§£å¤šå°‘ï¼Ÿ" class="headerlink" title="34.ðŸŒŸCAS äº†è§£å¤šå°‘ï¼Ÿ"></a>34.ðŸŒŸCAS äº†è§£å¤šå°‘ï¼Ÿ</h3><p>æŽ¨èé˜…è¯»ï¼š<a target="_blank" rel="noopener" href="https://javabetter.cn/thread/cas.html">ä¸€æ–‡å½»åº•æžæ¸…æ¥š Java å®žçŽ° CAS çš„åŽŸç†</a></p>
<p>CAS æ˜¯ä¸€ç§ä¹è§‚é”ï¼Œç”¨äºŽæ¯”è¾ƒä¸€ä¸ªå˜é‡çš„å½“å‰å€¼æ˜¯å¦ç­‰äºŽé¢„æœŸå€¼ï¼Œå¦‚æžœç›¸ç­‰ï¼Œåˆ™æ›´æ–°å€¼ï¼Œå¦åˆ™é‡è¯•ã€‚</p>
<p><img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="https://cdn.jsdelivr.net/gh/JakicDong/blog-assets@main/images/20251009160404.png" alt="20251009160404"><br>CAS åŽŸå­æ€§ï¼šåšå®¢å›­çš„ç´«è–‡å“¥å“¥</p>
<p>åœ¨ CAS ä¸­ï¼Œæœ‰ä¸‰ä¸ªå€¼ï¼š</p>
<ul>
<li>Vï¼šè¦æ›´æ–°çš„å˜é‡(var)</li>
<li>Eï¼šé¢„æœŸå€¼(expected)</li>
<li>Nï¼šæ–°å€¼(new)</li>
</ul>
<p>å…ˆåˆ¤æ–­ V æ˜¯å¦ç­‰äºŽ Eï¼Œå¦‚æžœç­‰äºŽï¼Œå°† V çš„å€¼è®¾ç½®ä¸º Nï¼›å¦‚æžœä¸ç­‰ï¼Œè¯´æ˜Žå·²ç»æœ‰å…¶å®ƒçº¿ç¨‹æ›´æ–°äº† Vï¼Œå½“å‰çº¿ç¨‹å°±æ”¾å¼ƒæ›´æ–°ã€‚</p>
<p>è¿™ä¸ªæ¯”è¾ƒå’Œæ›¿æ¢çš„æ“ä½œéœ€è¦æ˜¯åŽŸå­çš„ï¼Œä¸å¯ä¸­æ–­çš„ã€‚Java ä¸­çš„ CAS æ˜¯ç”± Unsafe ç±»å®žçŽ°çš„ã€‚</p>
<p>AtomicInteger ç±»çš„ compareAndSet å°±æ˜¯ä¸€ä¸ª CAS æ–¹æ³•ï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">AtomicInteger</span> <span class="variable">atomicInteger</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">AtomicInteger</span>(<span class="number">0</span>);</span><br><span class="line"><span class="type">int</span> <span class="variable">expect</span> <span class="operator">=</span> <span class="number">0</span>;</span><br><span class="line"><span class="type">int</span> <span class="variable">update</span> <span class="operator">=</span> <span class="number">1</span>;</span><br><span class="line">atomicInteger.compareAndSet(expect, update);</span><br></pre></td></tr></table></figure>

<p>å®ƒè°ƒç”¨çš„æ˜¯ Unsafe çš„ compareAndSwapIntã€‚</p>
<p><img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="https://cdn.jsdelivr.net/gh/JakicDong/blog-assets@main/images/20251009160530.png" alt="20251009160530"><br>äºŒå“¥çš„ Java è¿›é˜¶ä¹‹è·¯ï¼šcompareAndSwapInt</p>
<h4 id="æ€Žä¹ˆä¿è¯-CAS-çš„åŽŸå­æ€§ï¼Ÿ"><a href="#æ€Žä¹ˆä¿è¯-CAS-çš„åŽŸå­æ€§ï¼Ÿ" class="headerlink" title="æ€Žä¹ˆä¿è¯ CAS çš„åŽŸå­æ€§ï¼Ÿ"></a><a href="#%E6%80%8E%E4%B9%88%E4%BF%9D%E8%AF%81-cas-%E7%9A%84%E5%8E%9F%E5%AD%90%E6%80%A7">æ€Žä¹ˆä¿è¯ CAS çš„åŽŸå­æ€§ï¼Ÿ</a></h4><p>CPU ä¼šå‘å‡ºä¸€ä¸ª LOCK æŒ‡ä»¤è¿›è¡Œæ€»çº¿é”å®šï¼Œé˜»æ­¢å…¶ä»–å¤„ç†å™¨å¯¹å†…å­˜åœ°å€è¿›è¡Œæ“ä½œï¼Œç›´åˆ°å½“å‰æŒ‡ä»¤æ‰§è¡Œå®Œæˆã€‚</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">lock cmpxchg [esi], eax  ; æ¯”è¾ƒ esi åœ°å€ä¸­çš„å€¼ä¸Ž eaxï¼Œå¦‚æžœç›¸ç­‰åˆ™æ›¿æ¢</span><br></pre></td></tr></table></figure>

<p><img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="https://cdn.jsdelivr.net/gh/JakicDong/blog-assets@main/images/20251027093600.png" alt="20251027093600"><br>æ€»çº¿é”å®šï¼šåšå®¢å›­çš„ç´«è–‡å“¥å“¥</p>
<h3 id="35-ðŸŒŸCAS-æœ‰ä»€ä¹ˆé—®é¢˜ï¼Ÿ"><a href="#35-ðŸŒŸCAS-æœ‰ä»€ä¹ˆé—®é¢˜ï¼Ÿ" class="headerlink" title="35.ðŸŒŸCAS æœ‰ä»€ä¹ˆé—®é¢˜ï¼Ÿ"></a>35.ðŸŒŸCAS æœ‰ä»€ä¹ˆé—®é¢˜ï¼Ÿ</h3><p>CAS å­˜åœ¨ä¸‰ä¸ªç»å…¸é—®é¢˜ï¼ŒABA é—®é¢˜ã€è‡ªæ—‹å¼€é”€å¤§ã€åªèƒ½æ“ä½œä¸€ä¸ªå˜é‡ç­‰ã€‚</p>
<p><img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="https://cdn.jsdelivr.net/gh/JakicDong/blog-assets@main/images/20251009160610.png" alt="20251009160610"><br>ä¸‰åˆ†æ¶é¢æ¸£é€†è¢­ï¼šCASä¸‰å¤§é—®é¢˜</p>
<h4 id="ä»€ä¹ˆæ˜¯-ABA-é—®é¢˜ï¼Ÿ"><a href="#ä»€ä¹ˆæ˜¯-ABA-é—®é¢˜ï¼Ÿ" class="headerlink" title="ä»€ä¹ˆæ˜¯ ABA é—®é¢˜ï¼Ÿ"></a>ä»€ä¹ˆæ˜¯ ABA é—®é¢˜ï¼Ÿ</h4><p>ABA é—®é¢˜æŒ‡çš„æ˜¯ï¼Œä¸€ä¸ªå€¼åŽŸæ¥æ˜¯ Aï¼ŒåŽæ¥è¢«æ”¹ä¸º Bï¼Œå†åŽæ¥åˆè¢«æ”¹å›ž Aï¼Œè¿™æ—¶ CAS ä¼šè¯¯è®¤ä¸ºè¿™ä¸ªå€¼æ²¡æœ‰å‘ç”Ÿå˜åŒ–ã€‚</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">çº¿ç¨‹ <span class="number">1</span>ï¼šCAS(A â†’ B)ï¼Œä¿®æ”¹å˜é‡ A â†’ B</span><br><span class="line">çº¿ç¨‹ <span class="number">2</span>ï¼šCAS(B â†’ A)ï¼Œå˜é‡åˆå˜å›ž A</span><br><span class="line">çº¿ç¨‹ <span class="number">3</span>ï¼šCAS(A â†’ C)ï¼ŒCAS æˆåŠŸï¼Œä½†å®žé™…æ•°æ®å·²è¢«ä¿®æ”¹è¿‡ï¼</span><br></pre></td></tr></table></figure>

<p>å¯ä»¥ä½¿ç”¨ç‰ˆæœ¬å·&#x2F;æ—¶é—´æˆ³çš„æ–¹å¼æ¥è§£å†³ ABA é—®é¢˜ã€‚</p>
<p>æ¯”å¦‚è¯´ï¼Œæ¯æ¬¡å˜é‡æ›´æ–°æ—¶ï¼Œä¸ä»…æ›´æ–°å˜é‡çš„å€¼ï¼Œè¿˜æ›´æ–°ä¸€ä¸ªç‰ˆæœ¬å·ã€‚CAS æ“ä½œæ—¶ï¼Œä¸ä»…æ¯”è¾ƒå˜é‡çš„å€¼ï¼Œè¿˜æ¯”è¾ƒç‰ˆæœ¬å·ã€‚</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">OptimisticLockExample</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="type">int</span> version;</span><br><span class="line">    <span class="keyword">private</span> <span class="type">int</span> value;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">synchronized</span> <span class="type">boolean</span> <span class="title function_">updateValue</span><span class="params">(<span class="type">int</span> newValue, <span class="type">int</span> currentVersion)</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> (<span class="built_in">this</span>.version == currentVersion) &#123;</span><br><span class="line">            <span class="built_in">this</span>.value = newValue;</span><br><span class="line">            <span class="built_in">this</span>.version++;</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>Java çš„ AtomicStampedReference å°±å¢žåŠ äº†ç‰ˆæœ¬å·ï¼Œå®ƒä¼šåŒæ—¶æ£€æŸ¥å¼•ç”¨å€¼å’Œ stamp æ˜¯å¦éƒ½ç›¸ç­‰ã€‚</p>
<p><img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="https://cdn.jsdelivr.net/gh/JakicDong/blog-assets@main/images/20251009160653.png" alt="20251009160653"><br>äºŒå“¥çš„ Java è¿›é˜¶ä¹‹è·¯ï¼šAtomicStampedReference</p>
<p>ä½¿ç”¨ç¤ºä¾‹ï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">ABAFix</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> AtomicStampedReference&lt;String&gt; ref = <span class="keyword">new</span> <span class="title class_">AtomicStampedReference</span>&lt;&gt;(<span class="string">&quot;100&quot;</span>, <span class="number">1</span>);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        <span class="keyword">new</span> <span class="title class_">Thread</span>(() -&gt; &#123;</span><br><span class="line">            <span class="type">int</span> <span class="variable">stamp</span> <span class="operator">=</span> ref.getStamp();</span><br><span class="line">            ref.compareAndSet(<span class="string">&quot;100&quot;</span>, <span class="string">&quot;200&quot;</span>, stamp, stamp + <span class="number">1</span>);</span><br><span class="line">            ref.compareAndSet(<span class="string">&quot;200&quot;</span>, <span class="string">&quot;100&quot;</span>, ref.getStamp(), ref.getStamp() + <span class="number">1</span>);</span><br><span class="line">        &#125;).start();</span><br><span class="line"></span><br><span class="line">        <span class="keyword">new</span> <span class="title class_">Thread</span>(() -&gt; &#123;</span><br><span class="line">            <span class="keyword">try</span> &#123; Thread.sleep(<span class="number">100</span>); &#125; <span class="keyword">catch</span> (InterruptedException e) &#123;&#125;</span><br><span class="line">            <span class="type">int</span> <span class="variable">stamp</span> <span class="operator">=</span> ref.getStamp();</span><br><span class="line">            System.out.println(<span class="string">&quot;CAS ç»“æžœï¼š&quot;</span> + ref.compareAndSet(<span class="string">&quot;100&quot;</span>, <span class="string">&quot;300&quot;</span>, stamp, stamp + <span class="number">1</span>));</span><br><span class="line">        &#125;).start();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="è‡ªæ—‹å¼€é”€å¤§æ€Žä¹ˆè§£å†³ï¼Ÿ"><a href="#è‡ªæ—‹å¼€é”€å¤§æ€Žä¹ˆè§£å†³ï¼Ÿ" class="headerlink" title="è‡ªæ—‹å¼€é”€å¤§æ€Žä¹ˆè§£å†³ï¼Ÿ"></a>è‡ªæ—‹å¼€é”€å¤§æ€Žä¹ˆè§£å†³ï¼Ÿ</h4><p>CAS å¤±è´¥æ—¶ä¼šä¸æ–­è‡ªæ—‹é‡è¯•ï¼Œå¦‚æžœä¸€ç›´ä¸æˆåŠŸï¼Œä¼šç»™ CPU å¸¦æ¥éžå¸¸å¤§çš„æ‰§è¡Œå¼€é”€ã€‚</p>
<p>å¯ä»¥åŠ ä¸€ä¸ªè‡ªæ—‹æ¬¡æ•°çš„é™åˆ¶ï¼Œè¶…è¿‡ä¸€å®šæ¬¡æ•°ï¼Œå°±åˆ‡æ¢åˆ° synchronized æŒ‚èµ·çº¿ç¨‹ã€‚</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">int</span> <span class="variable">MAX_RETRIES</span> <span class="operator">=</span> <span class="number">10</span>;</span><br><span class="line"><span class="type">int</span> <span class="variable">retries</span> <span class="operator">=</span> <span class="number">0</span>;</span><br><span class="line"><span class="keyword">while</span> (!atomicInt.compareAndSet(expect, update)) &#123;</span><br><span class="line">    retries++;</span><br><span class="line">    <span class="keyword">if</span> (retries &gt; MAX_RETRIES) &#123;</span><br><span class="line">        <span class="keyword">synchronized</span> (<span class="built_in">this</span>) &#123; <span class="comment">// è¶…è¿‡æ¬¡æ•°ï¼Œä½¿ç”¨ synchronized å¤„ç†</span></span><br><span class="line">            <span class="keyword">if</span> (atomicInt.get() == expect) &#123;</span><br><span class="line">                atomicInt.set(update);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">break</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="æ¶‰åŠåˆ°å¤šä¸ªå˜é‡åŒæ—¶æ›´æ–°æ€Žä¹ˆåŠžï¼Ÿ"><a href="#æ¶‰åŠåˆ°å¤šä¸ªå˜é‡åŒæ—¶æ›´æ–°æ€Žä¹ˆåŠžï¼Ÿ" class="headerlink" title="æ¶‰åŠåˆ°å¤šä¸ªå˜é‡åŒæ—¶æ›´æ–°æ€Žä¹ˆåŠžï¼Ÿ"></a>æ¶‰åŠåˆ°å¤šä¸ªå˜é‡åŒæ—¶æ›´æ–°æ€Žä¹ˆåŠžï¼Ÿ</h4><p>å¯ä»¥å°†å¤šä¸ªå˜é‡å°è£…ä¸ºä¸€ä¸ªå¯¹è±¡ï¼Œä½¿ç”¨ AtomicReference è¿›è¡Œ CAS æ›´æ–°ã€‚</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Account</span> &#123;</span><br><span class="line">    <span class="keyword">static</span> <span class="keyword">class</span> <span class="title class_">Balance</span> &#123;</span><br><span class="line">        <span class="keyword">final</span> <span class="type">int</span> money;</span><br><span class="line">        <span class="keyword">final</span> <span class="type">int</span> points;</span><br><span class="line"></span><br><span class="line">        Balance(<span class="type">int</span> money, <span class="type">int</span> points) &#123;</span><br><span class="line">            <span class="built_in">this</span>.money = money;</span><br><span class="line">            <span class="built_in">this</span>.points = points;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> AtomicReference&lt;Balance&gt; balance = <span class="keyword">new</span> <span class="title class_">AtomicReference</span>&lt;&gt;(<span class="keyword">new</span> <span class="title class_">Balance</span>(<span class="number">100</span>, <span class="number">10</span>));</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">update</span><span class="params">(<span class="type">int</span> newMoney, <span class="type">int</span> newPoints)</span> &#123;</span><br><span class="line">        Balance oldBalance, newBalance;</span><br><span class="line">        <span class="keyword">do</span> &#123;</span><br><span class="line">            oldBalance = balance.get();</span><br><span class="line">            newBalance = <span class="keyword">new</span> <span class="title class_">Balance</span>(newMoney, newPoints);</span><br><span class="line">        &#125; <span class="keyword">while</span> (!balance.compareAndSet(oldBalance, newBalance));</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h3 id="40-ðŸŒŸæ­»é”é—®é¢˜æ€Žä¹ˆæŽ’æŸ¥å‘¢ï¼Ÿ"><a href="#40-ðŸŒŸæ­»é”é—®é¢˜æ€Žä¹ˆæŽ’æŸ¥å‘¢ï¼Ÿ" class="headerlink" title="40.ðŸŒŸæ­»é”é—®é¢˜æ€Žä¹ˆæŽ’æŸ¥å‘¢ï¼Ÿ"></a>40.ðŸŒŸæ­»é”é—®é¢˜æ€Žä¹ˆæŽ’æŸ¥å‘¢ï¼Ÿ</h3><p>é¦–å…ˆä»Žç³»ç»Ÿçº§åˆ«ä¸ŠæŽ’æŸ¥ï¼Œæ¯”å¦‚è¯´åœ¨ Linux ç”Ÿäº§çŽ¯å¢ƒä¸­ï¼Œå¯ä»¥å…ˆä½¿ç”¨ <code>top</code> <code>ps</code> ç­‰å‘½ä»¤æŸ¥çœ‹è¿›ç¨‹çŠ¶æ€ï¼Œçœ‹çœ‹æ˜¯å¦æœ‰è¿›ç¨‹å ç”¨äº†è¿‡å¤šçš„èµ„æºã€‚</p>
<p>æŽ¥ç€ï¼Œä½¿ç”¨ JDK è‡ªå¸¦çš„ä¸€äº›æ€§èƒ½ç›‘æŽ§å·¥å…·è¿›è¡ŒæŽ’æŸ¥ï¼Œæ¯”å¦‚è¯´ ä½¿ç”¨ <code>jps -l</code> æŸ¥çœ‹å½“å‰è¿›ç¨‹ï¼Œç„¶åŽä½¿ç”¨ <code>jstack è¿›ç¨‹å·</code> æŸ¥çœ‹å½“å‰è¿›ç¨‹çš„çº¿ç¨‹å †æ ˆä¿¡æ¯ï¼Œçœ‹çœ‹æ˜¯å¦æœ‰çº¿ç¨‹åœ¨ç­‰å¾…é”èµ„æºã€‚</p>
<p>ä¹Ÿå¯ä»¥ä½¿ç”¨ä¸€äº›å¯è§†åŒ–çš„æ€§èƒ½ç›‘æŽ§å·¥å…·ï¼Œæ¯”å¦‚è¯´ JConsoleã€VisualVM ç­‰ï¼ŒæŸ¥çœ‹çº¿ç¨‹çš„è¿è¡ŒçŠ¶æ€ã€é”çš„ç«žäº‰æƒ…å†µç­‰ã€‚</p>
<p><img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="https://cdn.jsdelivr.net/gh/JakicDong/blog-assets@main/images/20251009170605.png" alt="20251009170605"><br>ä¸‰åˆ†æ¶é¢æ¸£é€†è¢­ï¼šçº¿ç¨‹æ­»é”æ£€æµ‹</p>
<p>æˆ‘ä»¬æ¥é€šè¿‡å®žé™…ä»£ç è¯´æ˜Žä¸€ä¸‹ï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">DeadLockDemo</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">Object</span> <span class="variable">lock1</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Object</span>();</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">Object</span> <span class="variable">lock2</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Object</span>();</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        <span class="keyword">new</span> <span class="title class_">Thread</span>(() -&gt; &#123;</span><br><span class="line">            <span class="keyword">synchronized</span> (lock1) &#123;</span><br><span class="line">                System.out.println(<span class="string">&quot;çº¿ç¨‹1èŽ·å–åˆ°äº†é”1&quot;</span>);</span><br><span class="line">                <span class="keyword">try</span> &#123;</span><br><span class="line">                    Thread.sleep(<span class="number">1000</span>);</span><br><span class="line">                &#125; <span class="keyword">catch</span> (InterruptedException e) &#123;</span><br><span class="line">                    e.printStackTrace();</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="keyword">synchronized</span> (lock2) &#123;</span><br><span class="line">                    System.out.println(<span class="string">&quot;çº¿ç¨‹1èŽ·å–åˆ°äº†é”2&quot;</span>);</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;).start();</span><br><span class="line"></span><br><span class="line">        <span class="keyword">new</span> <span class="title class_">Thread</span>(() -&gt; &#123;</span><br><span class="line">            <span class="keyword">synchronized</span> (lock2) &#123;</span><br><span class="line">                System.out.println(<span class="string">&quot;çº¿ç¨‹2èŽ·å–åˆ°äº†é”2&quot;</span>);</span><br><span class="line">                <span class="keyword">try</span> &#123;</span><br><span class="line">                    Thread.sleep(<span class="number">1000</span>);</span><br><span class="line">                &#125; <span class="keyword">catch</span> (InterruptedException e) &#123;</span><br><span class="line">                    e.printStackTrace();</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="keyword">synchronized</span> (lock1) &#123;</span><br><span class="line">                    System.out.println(<span class="string">&quot;çº¿ç¨‹2èŽ·å–åˆ°äº†é”1&quot;</span>);</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;).start();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>åˆ›å»ºä¸¤ä¸ªçº¿ç¨‹ï¼Œæ¯ä¸ªçº¿ç¨‹éƒ½è¯•å›¾æŒ‰ç…§ä¸åŒçš„é¡ºåºèŽ·å–ä¸¤ä¸ª<a target="_blank" rel="noopener" href="https://javabetter.cn/thread/thread-bring-some-problem.html#%E6%B4%BB%E8%B7%83%E6%80%A7%E9%97%AE%E9%A2%98">é”ï¼ˆlock1 å’Œ lock2ï¼‰</a>ã€‚</p>
<p>é”çš„èŽ·å–é¡ºåºä¸ä¸€è‡´å¾ˆå®¹æ˜“å¯¼è‡´æ­»é”ã€‚è¿è¡Œè¿™æ®µä»£ç ï¼Œä¼šå‘çŽ°ä¸¤ä¸ªçº¿ç¨‹éƒ½æ— æ³•ç»§ç»­æ‰§è¡Œï¼Œè¿›å…¥äº†æ­»é”çŠ¶æ€ã€‚</p>
<p><img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="https://cdn.jsdelivr.net/gh/JakicDong/blog-assets@main/images/20251009170646.png" alt="20251009170646"><br>äºŒå“¥çš„ Java è¿›é˜¶ä¹‹è·¯ï¼šæ­»é”å‘ç”Ÿäº†</p>
<p>è¿è¡Œ <code>jstack pid</code> å‘½ä»¤ï¼Œå¯ä»¥çœ‹åˆ°æ­»é”çš„çº¿ç¨‹ä¿¡æ¯ã€‚</p>
<p><img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="https://cdn.jsdelivr.net/gh/JakicDong/blog-assets@main/images/20251009170656.png" alt="20251009170656"><br>jstack pid æŸ¥çœ‹æ­»é”ä¿¡æ¯</p>
<p>ç¼–ç æ—¶ï¼Œå°½é‡ä½¿ç”¨ <code>tryLock()</code> ä»£æ›¿ <code>lock()</code>ï¼Œ<code>tryLock()</code> å¯ä»¥è®¾ç½®è¶…æ—¶æ—¶é—´ï¼Œé¿å…çº¿ç¨‹ä¸€ç›´ç­‰å¾…ã€‚</p>
<p>åŒæ—¶ï¼Œå°½é‡é¿å…ä¸€ä¸ªçº¿ç¨‹åŒæ—¶èŽ·å–å¤šä¸ªé”ï¼Œå¦‚æžœéœ€è¦å¤šä¸ªé”ï¼Œå¯ä»¥æŒ‰ç…§å›ºå®šçš„é¡ºåºèŽ·å–ã€‚</p>
<p>æŽ¨èé˜…è¯»ï¼š</p>
<ul>
<li><a target="_blank" rel="noopener" href="https://javabetter.cn/jvm/console-tools.html">JVM æ€§èƒ½ç›‘æŽ§å·¥å…·ä¹‹å‘½ä»¤è¡Œç¯‡</a></li>
<li><a target="_blank" rel="noopener" href="https://javabetter.cn/jvm/view-tools.html">JVM æ€§èƒ½ç›‘æŽ§å·¥å…·ä¹‹å¯è§†åŒ–ç¯‡</a></li>
<li><a target="_blank" rel="noopener" href="https://javabetter.cn/jvm/arthas.html">é˜¿é‡Œå¼€æºçš„ Java è¯Šæ–­ç¥žå™¨ Arthas</a></li>
</ul>
<h3 id="42-ðŸŒŸèŠèŠæ‚²è§‚é”å’Œä¹è§‚é”ï¼Ÿï¼ˆè¡¥å……ï¼‰"><a href="#42-ðŸŒŸèŠèŠæ‚²è§‚é”å’Œä¹è§‚é”ï¼Ÿï¼ˆè¡¥å……ï¼‰" class="headerlink" title="42.ðŸŒŸèŠèŠæ‚²è§‚é”å’Œä¹è§‚é”ï¼Ÿï¼ˆè¡¥å……ï¼‰"></a>42.ðŸŒŸèŠèŠæ‚²è§‚é”å’Œä¹è§‚é”ï¼Ÿï¼ˆè¡¥å……ï¼‰</h3><p>å¥½çš„ã€‚</p>
<p>æ‚²è§‚é”è®¤ä¸ºæ¯æ¬¡è®¿é—®å…±äº«èµ„æºæ—¶éƒ½ä¼šå‘ç”Ÿå†²çªï¼Œæ‰€åœ¨åœ¨æ“ä½œå‰ä¸€å®šè¦å…ˆåŠ é”ï¼Œé˜²æ­¢å…¶ä»–çº¿ç¨‹ä¿®æ”¹æ•°æ®ã€‚</p>
<p>ä¹è§‚é”è®¤ä¸ºå†²çªä¸ä¼šæ€»æ˜¯å‘ç”Ÿï¼Œæ‰€ä»¥åœ¨æ“ä½œå‰ä¸åŠ é”ï¼Œè€Œæ˜¯åœ¨æ›´æ–°æ•°æ®æ—¶æ£€æŸ¥æ˜¯å¦æœ‰å…¶ä»–çº¿ç¨‹ä¿®æ”¹äº†æ•°æ®ã€‚å¦‚æžœå‘çŽ°æ•°æ®è¢«ä¿®æ”¹äº†ï¼Œå°±ä¼šé‡è¯•ã€‚</p>
<h4 id="ä¹è§‚é”å‘çŽ°æœ‰çº¿ç¨‹è¿‡æ¥ä¿®æ”¹æ•°æ®ï¼Œæ€Žä¹ˆåŠžï¼Ÿ"><a href="#ä¹è§‚é”å‘çŽ°æœ‰çº¿ç¨‹è¿‡æ¥ä¿®æ”¹æ•°æ®ï¼Œæ€Žä¹ˆåŠžï¼Ÿ" class="headerlink" title="ä¹è§‚é”å‘çŽ°æœ‰çº¿ç¨‹è¿‡æ¥ä¿®æ”¹æ•°æ®ï¼Œæ€Žä¹ˆåŠžï¼Ÿ"></a>ä¹è§‚é”å‘çŽ°æœ‰çº¿ç¨‹è¿‡æ¥ä¿®æ”¹æ•°æ®ï¼Œæ€Žä¹ˆåŠžï¼Ÿ</h4><p>å¯ä»¥é‡æ–°è¯»å–æ•°æ®ï¼Œç„¶åŽå†å°è¯•æ›´æ–°ï¼Œç›´åˆ°æˆåŠŸä¸ºæ­¢æˆ–è¾¾åˆ°æœ€å¤§é‡è¯•æ¬¡æ•°ã€‚</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">è¯»å–æ•°æ® -&gt; å°è¯•æ›´æ–° -&gt; æˆåŠŸï¼ˆè¿”å›žæˆåŠŸï¼‰</span><br><span class="line">               |</span><br><span class="line">               -&gt; å¤±è´¥ -&gt; é‡è¯• -&gt; è¾¾åˆ°æœ€å¤§æ¬¡æ•° -&gt; è¿”å›žå¤±è´¥</span><br></pre></td></tr></table></figure>

<p>å†™ä¸ªä»£ç æ¼”ç¤ºä¸€ä¸‹ï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">CasRetryExample</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="type">AtomicInteger</span> <span class="variable">counter</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">AtomicInteger</span>(<span class="number">0</span>);</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">int</span> <span class="variable">MAX_RETRIES</span> <span class="operator">=</span> <span class="number">5</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        <span class="type">boolean</span> <span class="variable">success</span> <span class="operator">=</span> <span class="literal">false</span>;</span><br><span class="line">        <span class="type">int</span> <span class="variable">retries</span> <span class="operator">=</span> <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">while</span> (retries &lt; MAX_RETRIES) &#123;</span><br><span class="line">            <span class="type">int</span> <span class="variable">currentValue</span> <span class="operator">=</span> counter.get();</span><br><span class="line">            <span class="type">boolean</span> <span class="variable">updated</span> <span class="operator">=</span> counter.compareAndSet(currentValue, currentValue + <span class="number">1</span>);</span><br><span class="line">            </span><br><span class="line">            <span class="keyword">if</span> (updated) &#123;</span><br><span class="line">                System.out.println(<span class="string">&quot;æ›´æ–°æˆåŠŸï¼Œå½“å‰å€¼: &quot;</span> + counter.get());</span><br><span class="line">                success = <span class="literal">true</span>;</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                retries++;</span><br><span class="line">                System.out.println(<span class="string">&quot;æ›´æ–°å¤±è´¥ï¼Œè¿›è¡Œç¬¬ &quot;</span> + retries + <span class="string">&quot; æ¬¡é‡è¯•&quot;</span>);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> (!success) &#123;</span><br><span class="line">            System.out.println(<span class="string">&quot;è¾¾åˆ°æœ€å¤§é‡è¯•æ¬¡æ•°ï¼Œæ“ä½œå¤±è´¥&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>


<h3 id="48-ðŸŒŸèƒ½è¯´ä¸€ä¸‹-ConcurrentHashMap-çš„å®žçŽ°å—ï¼Ÿï¼ˆè¡¥å……ï¼‰"><a href="#48-ðŸŒŸèƒ½è¯´ä¸€ä¸‹-ConcurrentHashMap-çš„å®žçŽ°å—ï¼Ÿï¼ˆè¡¥å……ï¼‰" class="headerlink" title="48.ðŸŒŸèƒ½è¯´ä¸€ä¸‹ ConcurrentHashMap çš„å®žçŽ°å—ï¼Ÿï¼ˆè¡¥å……ï¼‰"></a>48.ðŸŒŸèƒ½è¯´ä¸€ä¸‹ ConcurrentHashMap çš„å®žçŽ°å—ï¼Ÿï¼ˆè¡¥å……ï¼‰</h3><p>å¥½çš„ã€‚<a target="_blank" rel="noopener" href="https://javabetter.cn/thread/ConcurrentHashMap.html">ConcurrentHashMap</a> æ˜¯ HashMap çš„çº¿ç¨‹å®‰å…¨ç‰ˆæœ¬ã€‚</p>
<p>JDK 7 é‡‡ç”¨çš„æ˜¯åˆ†æ®µé”ï¼Œæ•´ä¸ª Map ä¼šè¢«åˆ†ä¸ºè‹¥å¹²æ®µï¼Œæ¯ä¸ªæ®µéƒ½å¯ä»¥ç‹¬ç«‹åŠ é”ã€‚ä¸åŒçš„çº¿ç¨‹å¯ä»¥åŒæ—¶æ“ä½œä¸åŒçš„æ®µï¼Œä»Žè€Œå®žçŽ°å¹¶å‘ã€‚</p>
<p><img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="https://cdn.jsdelivr.net/gh/JakicDong/blog-assets@main/images/20251010104933.png" alt="20251010104933"><br>åˆå¿µåˆæ‹ï¼šJDK 7 ConcurrentHashMap</p>
<p>JDK 8 ä½¿ç”¨äº†ä¸€ç§æ›´åŠ ç»†ç²’åº¦çš„é”â€”â€”æ¡¶é”ï¼Œå†é…åˆ CAS + synchronized ä»£ç å—æŽ§åˆ¶å¹¶å‘å†™å…¥ï¼Œä»¥æœ€å¤§ç¨‹åº¦å‡å°‘é”çš„ç«žäº‰ã€‚</p>
<p><img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="https://cdn.jsdelivr.net/gh/JakicDong/blog-assets@main/images/20251010105023.png" alt="20251010105023"><br>åˆå¿µåˆæ‹ï¼šJDK 8 ConcurrentHashMap</p>
<p>å¯¹äºŽè¯»æ“ä½œï¼ŒConcurrentHashMap ä½¿ç”¨äº† volatile å˜é‡æ¥ä¿è¯å†…å­˜å¯è§æ€§ã€‚</p>
<p>å¯¹äºŽå†™æ“ä½œï¼ŒConcurrentHashMap ä¼˜å…ˆä½¿ç”¨ CAS å°è¯•æ’å…¥ï¼Œå¦‚æžœæˆåŠŸå°±ç›´æŽ¥è¿”å›žï¼›å¦åˆ™ä½¿ç”¨ synchronized ä»£ç å—è¿›è¡ŒåŠ é”å¤„ç†ã€‚</p>
<h4 id="è¯´ä¸€ä¸‹-JDK-7-ä¸­-ConcurrentHashMap-çš„å®žçŽ°åŽŸç†ï¼Ÿ"><a href="#è¯´ä¸€ä¸‹-JDK-7-ä¸­-ConcurrentHashMap-çš„å®žçŽ°åŽŸç†ï¼Ÿ" class="headerlink" title="è¯´ä¸€ä¸‹ JDK 7 ä¸­ ConcurrentHashMap çš„å®žçŽ°åŽŸç†ï¼Ÿ"></a>è¯´ä¸€ä¸‹ JDK 7 ä¸­ ConcurrentHashMap çš„å®žçŽ°åŽŸç†ï¼Ÿ</h4><p>å¥½çš„ã€‚</p>
<p>JDK 7 çš„ ConcurrentHashMap é‡‡ç”¨çš„æ˜¯åˆ†æ®µé”ï¼Œæ•´ä¸ª Map ä¼šè¢«åˆ†ä¸ºè‹¥å¹²æ®µï¼Œæ¯ä¸ªæ®µéƒ½å¯ä»¥ç‹¬ç«‹åŠ é”ï¼Œæ¯ä¸ªæ®µç±»ä¼¼ä¸€ä¸ª Hashtableã€‚</p>
<p><img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="https://cdn.jsdelivr.net/gh/JakicDong/blog-assets@main/images/20251010105058.png" alt="20251010105058"><br>ä¸‰åˆ†æ¶é¢æ¸£é€†è¢­ï¼šConcurrentHashMapç¤ºæ„å›¾</p>
<p>æ¯ä¸ªæ®µç»´æŠ¤ä¸€ä¸ªé”®å€¼å¯¹æ•°ç»„ <code>HashEntry&lt;K, V&gt;[] table</code>ï¼ŒHashEntry æ˜¯ä¸€ä¸ªå•é¡¹é“¾è¡¨ã€‚</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">class</span> <span class="title class_">HashEntry</span>&lt;K,V&gt; &#123;</span><br><span class="line">    <span class="keyword">final</span> <span class="type">int</span> hash;</span><br><span class="line">    <span class="keyword">final</span> K key;</span><br><span class="line">    <span class="keyword">volatile</span> V value;</span><br><span class="line">    <span class="keyword">final</span> HashEntry&lt;K,V&gt; next;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>æ®µç»§æ‰¿äº† ReentrantLockï¼Œæ‰€ä»¥æ¯ä¸ªæ®µéƒ½æ˜¯ä¸€ä¸ªå¯é‡å…¥é”ï¼Œä¸åŒçš„çº¿ç¨‹å¯ä»¥åŒæ—¶æ“ä½œä¸åŒçš„æ®µï¼Œä»Žè€Œå®žçŽ°å¹¶å‘ã€‚</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">class</span> <span class="title class_">Segment</span>&lt;K,V&gt; <span class="keyword">extends</span> <span class="title class_">ReentrantLock</span> &#123;</span><br><span class="line">    <span class="keyword">transient</span> <span class="keyword">volatile</span> HashEntry&lt;K,V&gt;[] table;</span><br><span class="line">    <span class="keyword">transient</span> <span class="type">int</span> count;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="è¯´ä¸€ä¸‹-JDK-7-ä¸­-ConcurrentHashMap-çš„-put-æµç¨‹ï¼Ÿ"><a href="#è¯´ä¸€ä¸‹-JDK-7-ä¸­-ConcurrentHashMap-çš„-put-æµç¨‹ï¼Ÿ" class="headerlink" title="è¯´ä¸€ä¸‹ JDK 7 ä¸­ ConcurrentHashMap çš„ put æµç¨‹ï¼Ÿ"></a>è¯´ä¸€ä¸‹ JDK 7 ä¸­ ConcurrentHashMap çš„ put æµç¨‹ï¼Ÿ</h4><p>put æµç¨‹å’Œ HashMap éžå¸¸ç±»ä¼¼ï¼Œåªä¸è¿‡æ˜¯å…ˆå®šä½åˆ°å…·ä½“çš„æ®µï¼Œå†é€šè¿‡ ReentrantLock åŽ»æ“ä½œè€Œå·²ã€‚ä¸€å…±å¯ä»¥åˆ†ä¸º 4 ä¸ªæ­¥éª¤ï¼š</p>
<p>ç¬¬ä¸€æ­¥ï¼Œè®¡ç®— key çš„ hashï¼Œå®šä½åˆ°æ®µï¼Œæ®µå¦‚æžœæ˜¯ç©ºå°±å…ˆåˆå§‹åŒ–ï¼›</p>
<p>ç¬¬äºŒæ­¥ï¼Œä½¿ç”¨ ReentrantLock è¿›è¡ŒåŠ é”ï¼Œå¦‚æžœåŠ é”å¤±è´¥å°±è‡ªæ—‹ï¼Œè‡ªæ—‹è¶…è¿‡æ¬¡æ•°å°±é˜»å¡žï¼Œä¿è¯ä¸€å®šèƒ½èŽ·å–åˆ°é”ï¼›</p>
<p>ç¬¬ä¸‰æ­¥ï¼ŒéåŽ†æ®µä¸­çš„é”®å€¼å¯¹ HashEntryï¼Œkey ç›¸åŒç›´æŽ¥æ›¿æ¢ï¼Œkey ä¸å­˜åœ¨å°±æ’å…¥ã€‚</p>
<p>ç¬¬å››æ­¥ï¼Œé‡Šæ”¾é”ã€‚</p>
<p><img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="https://cdn.jsdelivr.net/gh/JakicDong/blog-assets@main/images/20251010105204.png" alt="20251010105204"><br>ä¸‰åˆ†æ¶é¢æ¸£é€†è¢­ï¼šJDK7 put æµç¨‹</p>
<h4 id="è¯´ä¸€ä¸‹-JDK-7-ä¸­-ConcurrentHashMap-çš„-get-æµç¨‹ï¼Ÿ"><a href="#è¯´ä¸€ä¸‹-JDK-7-ä¸­-ConcurrentHashMap-çš„-get-æµç¨‹ï¼Ÿ" class="headerlink" title="è¯´ä¸€ä¸‹ JDK 7 ä¸­ ConcurrentHashMap çš„ get æµç¨‹ï¼Ÿ"></a>è¯´ä¸€ä¸‹ JDK 7 ä¸­ ConcurrentHashMap çš„ get æµç¨‹ï¼Ÿ</h4><p>get å°±æ›´ç®€å•äº†ï¼Œå…ˆè®¡ç®— key çš„ hash æ‰¾åˆ°æ®µï¼Œå†éåŽ†æ®µä¸­çš„é”®å€¼å¯¹ï¼Œæ‰¾åˆ°å°±ç›´æŽ¥è¿”å›ž valueã€‚</p>
<p>get ä¸ç”¨åŠ é”ï¼Œå› ä¸ºæ˜¯ value æ˜¯ <a target="_blank" rel="noopener" href="https://javabetter.cn/thread/volatile.html">volatile</a> çš„ï¼Œæ‰€ä»¥çº¿ç¨‹è¯»å– value æ—¶ä¸ä¼šå‡ºçŽ°å¯è§æ€§é—®é¢˜ã€‚</p>
<h4 id="è¯´ä¸€ä¸‹-JDK-8-ä¸­-ConcurrentHashMap-çš„å®žçŽ°åŽŸç†ï¼Ÿ"><a href="#è¯´ä¸€ä¸‹-JDK-8-ä¸­-ConcurrentHashMap-çš„å®žçŽ°åŽŸç†ï¼Ÿ" class="headerlink" title="è¯´ä¸€ä¸‹ JDK 8 ä¸­ ConcurrentHashMap çš„å®žçŽ°åŽŸç†ï¼Ÿ"></a>è¯´ä¸€ä¸‹ JDK 8 ä¸­ ConcurrentHashMap çš„å®žçŽ°åŽŸç†ï¼Ÿ</h4><p>å¥½çš„ã€‚</p>
<p>JDK 8 ä¸­çš„ ConcurrentHashMap å–æ¶ˆäº†åˆ†æ®µé”ï¼Œé‡‡ç”¨ CAS + synchronized æ¥å®žçŽ°æ›´ç»†ç²’åº¦çš„æ¡¶é”ï¼Œå¹¶ä¸”ä½¿ç”¨çº¢é»‘æ ‘æ¥ä¼˜åŒ–é“¾è¡¨ä»¥æé«˜å“ˆå¸Œå†²çªæ—¶çš„æŸ¥è¯¢æ•ˆçŽ‡ï¼Œæ€§èƒ½æ¯” JDK 7 æœ‰äº†å¾ˆå¤§çš„æå‡ã€‚</p>
<h4 id="è¯´ä¸€ä¸‹-JDK-8-ä¸­-ConcurrentHashMap-çš„-put-æµç¨‹ï¼Ÿ"><a href="#è¯´ä¸€ä¸‹-JDK-8-ä¸­-ConcurrentHashMap-çš„-put-æµç¨‹ï¼Ÿ" class="headerlink" title="è¯´ä¸€ä¸‹ JDK 8 ä¸­ ConcurrentHashMap çš„ put æµç¨‹ï¼Ÿ"></a>è¯´ä¸€ä¸‹ JDK 8 ä¸­ ConcurrentHashMap çš„ put æµç¨‹ï¼Ÿ</h4><p><img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="https://cdn.jsdelivr.net/gh/JakicDong/blog-assets@main/images/20251010105242.png" alt="20251010105242"><br>ä¸‰åˆ†æ¶é¢æ¸£é€†è¢­ï¼šJava 8 put æµç¨‹</p>
<p>ç¬¬ä¸€æ­¥ï¼Œè®¡ç®— key çš„ hashï¼Œä»¥ç¡®å®šæ¡¶åœ¨æ•°ç»„ä¸­çš„ä½ç½®ã€‚å¦‚æžœæ•°ç»„ä¸ºç©ºï¼Œé‡‡ç”¨ CAS çš„æ–¹å¼åˆå§‹åŒ–ï¼Œä»¥ç¡®ä¿åªæœ‰ä¸€ä¸ªçº¿ç¨‹åœ¨åˆå§‹åŒ–æ•°ç»„ã€‚</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// è®¡ç®— hash</span></span><br><span class="line"><span class="type">int</span> <span class="variable">hash</span> <span class="operator">=</span> spread(key.hashCode());</span><br><span class="line"></span><br><span class="line"><span class="comment">// åˆå§‹åŒ–æ•°ç»„</span></span><br><span class="line"><span class="keyword">if</span> (tab == <span class="literal">null</span> || (n = tab.length) == <span class="number">0</span>)</span><br><span class="line">    tab = initTable();</span><br><span class="line"></span><br><span class="line"><span class="comment">// è®¡ç®—æ¡¶çš„ä½ç½®</span></span><br><span class="line"><span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> (n - <span class="number">1</span>) &amp; hash;</span><br></pre></td></tr></table></figure>

<p>ç¬¬äºŒæ­¥ï¼Œå¦‚æžœæ¡¶ä¸ºç©ºï¼Œç›´æŽ¥ CAS æ’å…¥èŠ‚ç‚¹ã€‚å¦‚æžœ CAS æ“ä½œå¤±è´¥ï¼Œä¼šé€€åŒ–ä¸º synchronized ä»£ç å—æ¥æ’å…¥èŠ‚ç‚¹ã€‚</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// CAS æ’å…¥èŠ‚ç‚¹</span></span><br><span class="line"><span class="keyword">if</span> (tabAt(tab, i) == <span class="literal">null</span>) &#123;</span><br><span class="line">    <span class="keyword">if</span> (casTabAt(tab, i, <span class="literal">null</span>, <span class="keyword">new</span> <span class="title class_">Node</span>&lt;K,V&gt;(hash, key, value, <span class="literal">null</span>)))</span><br><span class="line">        <span class="keyword">break</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// å¦åˆ™ï¼Œä½¿ç”¨ synchronized ä»£ç å—æ’å…¥èŠ‚ç‚¹</span></span><br><span class="line"><span class="keyword">else</span> &#123;</span><br><span class="line">    <span class="keyword">synchronized</span> (f) &#123;  <span class="comment">// **åªé”å½“å‰æ¡¶**</span></span><br><span class="line">        <span class="keyword">if</span> (tabAt(tab, i) == f) &#123; <span class="comment">// ç¡®ä¿æœªè¢«å…¶ä»–çº¿ç¨‹ä¿®æ”¹</span></span><br><span class="line">            <span class="keyword">if</span> (f.hash &gt;= <span class="number">0</span>) &#123; <span class="comment">// é“¾è¡¨å¤„ç†</span></span><br><span class="line">                <span class="keyword">for</span> (Node&lt;K,V&gt; e = f;;) &#123;</span><br><span class="line">                    K ek;</span><br><span class="line">                    <span class="keyword">if</span> (e.hash == hash &amp;&amp; ((ek = e.key) == key || (key != <span class="literal">null</span> &amp;&amp; key.equals(ek)))) &#123;</span><br><span class="line">                        e.val = value;</span><br><span class="line">                        <span class="keyword">break</span>;</span><br><span class="line">                    &#125;</span><br><span class="line">                    e = e.next;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125; <span class="keyword">else</span> <span class="keyword">if</span> (f <span class="keyword">instanceof</span> TreeBin) &#123; <span class="comment">// **çº¢é»‘æ ‘å¤„ç†**</span></span><br><span class="line">                ((TreeBin&lt;K,V&gt;) f).putTreeVal(hash, key, value);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>æ’å…¥çš„è¿‡ç¨‹ä¸­ä¼šåˆ¤æ–­æ¡¶çš„å“ˆå¸Œæ˜¯å¦å°äºŽ 0ï¼ˆ<code>f.hash &gt;= 0</code>ï¼‰ï¼Œå°äºŽ 0 è¯´æ˜Žæ˜¯çº¢é»‘æ ‘ï¼Œå¤§äºŽç­‰äºŽ 0 è¯´æ˜Žæ˜¯é“¾è¡¨ã€‚</p>
<p>è¿™é‡Œè¡¥å……ä¸€ç‚¹ï¼šåœ¨ ConcurrentHashMap çš„å®žçŽ°ä¸­ï¼Œçº¢é»‘æ ‘èŠ‚ç‚¹ TreeBin çš„ hash å€¼å›ºå®šä¸º -2ã€‚</p>
<p><img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="https://cdn.jsdelivr.net/gh/JakicDong/blog-assets@main/images/20251010105550.png" alt="20251010105550"><br>äºŒå“¥çš„ Java è¿›é˜¶ä¹‹è·¯ï¼šTreeBin çš„å“ˆå¸Œå€¼å›ºå®šä¸º -2</p>
<p>ç¬¬ä¸‰æ­¥ï¼Œå¦‚æžœé“¾è¡¨é•¿åº¦è¶…è¿‡ 8ï¼Œè½¬æ¢ä¸ºçº¢é»‘æ ‘ã€‚</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> (binCount &gt;= TREEIFY_THRESHOLD)</span><br><span class="line">    treeifyBin(tab, i);</span><br></pre></td></tr></table></figure>

<p>ç¬¬å››æ­¥ï¼Œåœ¨æ’å…¥æ–°èŠ‚ç‚¹åŽï¼Œä¼šè°ƒç”¨ <code>addCount()</code> æ–¹æ³•æ£€æŸ¥æ˜¯å¦éœ€è¦æ‰©å®¹ã€‚</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">addCount(<span class="number">1L</span>, binCount);</span><br></pre></td></tr></table></figure>

<h4 id="è¯´ä¸€ä¸‹-JDK-8-ä¸­-ConcurrentHashMap-çš„-get-æµç¨‹ï¼Ÿ"><a href="#è¯´ä¸€ä¸‹-JDK-8-ä¸­-ConcurrentHashMap-çš„-get-æµç¨‹ï¼Ÿ" class="headerlink" title="è¯´ä¸€ä¸‹ JDK 8 ä¸­ ConcurrentHashMap çš„ get æµç¨‹ï¼Ÿ"></a>è¯´ä¸€ä¸‹ JDK 8 ä¸­ ConcurrentHashMap çš„ get æµç¨‹ï¼Ÿ</h4><p>get ä¹Ÿæ˜¯é€šè¿‡ key çš„ hash è¿›è¡Œå®šä½ï¼Œå¦‚æžœè¯¥ä½ç½®èŠ‚ç‚¹çš„å“ˆå¸ŒåŒ¹é…ä¸”é”®ç›¸ç­‰ï¼Œåˆ™ç›´æŽ¥è¿”å›žå€¼ã€‚</p>
<p><img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="https://cdn.jsdelivr.net/gh/JakicDong/blog-assets@main/images/20251010105607.png" alt="20251010105607"><br>äºŒå“¥çš„ Java è¿›é˜¶ä¹‹è·¯ï¼šHashMap å’Œ ConcurrentHashMap çš„ get æ–¹æ³•</p>
<p>å¦‚æžœèŠ‚ç‚¹çš„å“ˆå¸Œä¸ºè´Ÿæ•°ï¼Œè¯´æ˜Žæ˜¯ä¸ªç‰¹æ®ŠèŠ‚ç‚¹ï¼Œæ¯”å¦‚è¯´å¦‚æ ‘èŠ‚ç‚¹æˆ–è€…æ­£åœ¨è¿ç§»çš„èŠ‚ç‚¹ï¼Œå°±è°ƒç”¨<code>find</code>æ–¹æ³•æŸ¥æ‰¾ã€‚</p>
<p><img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="https://cdn.jsdelivr.net/gh/JakicDong/blog-assets@main/images/20251010105625.png" alt="20251010105625"><br>äºŒå“¥çš„ Java è¿›é˜¶ä¹‹è·¯ï¼šForwardingNodeå’ŒTreeNodeçš„ find æ–¹æ³•</p>
<p>å¦åˆ™éåŽ†é“¾è¡¨æŸ¥æ‰¾åŒ¹é…çš„é”®ã€‚å¦‚æžœéƒ½æ²¡æ‰¾åˆ°ï¼Œè¿”å›ž nullã€‚</p>
<h4 id="è¯´ä¸€ä¸‹-HashMap-å’Œ-ConcurrentHashMap-çš„åŒºåˆ«ï¼Ÿ"><a href="#è¯´ä¸€ä¸‹-HashMap-å’Œ-ConcurrentHashMap-çš„åŒºåˆ«ï¼Ÿ" class="headerlink" title="è¯´ä¸€ä¸‹ HashMap å’Œ ConcurrentHashMap çš„åŒºåˆ«ï¼Ÿ"></a>è¯´ä¸€ä¸‹ HashMap å’Œ ConcurrentHashMap çš„åŒºåˆ«ï¼Ÿ</h4><p>HashMap æ˜¯éžçº¿ç¨‹å®‰å…¨çš„ï¼Œå¤šçº¿ç¨‹çŽ¯å¢ƒä¸‹åº”è¯¥ä½¿ç”¨ ConcurrentHashMapã€‚</p>
<h4 id="ä½ é¡¹ç›®ä¸­æ€Žä¹ˆä½¿ç”¨-ConcurrentHashMap-çš„ï¼Ÿ"><a href="#ä½ é¡¹ç›®ä¸­æ€Žä¹ˆä½¿ç”¨-ConcurrentHashMap-çš„ï¼Ÿ" class="headerlink" title="ä½ é¡¹ç›®ä¸­æ€Žä¹ˆä½¿ç”¨ ConcurrentHashMap çš„ï¼Ÿ"></a>ä½ é¡¹ç›®ä¸­æ€Žä¹ˆä½¿ç”¨ ConcurrentHashMap çš„ï¼Ÿ</h4><p>åœ¨<a target="_blank" rel="noopener" href="https://javabetter.cn/zhishixingqiu/paicoding.html">æŠ€æœ¯æ´¾å®žæˆ˜é¡¹ç›®</a>ä¸­ï¼Œå¾ˆå¤šåœ°æ–¹éƒ½ç”¨åˆ°äº† ConcurrentHashMapï¼Œæ¯”å¦‚è¯´åœ¨å¼‚æ­¥å·¥å…·ç±» AsyncUtil ä¸­ï¼Œå°±ä½¿ç”¨äº† ConcurrentHashMap æ¥å­˜å‚¨ä»»åŠ¡çš„åç§°å’Œå®ƒä»¬çš„è¿è¡Œæ—¶é—´ï¼Œä»¥ä¾¿è§‚å¯Ÿå’Œåˆ†æžä»»åŠ¡çš„æ‰§è¡Œæƒ…å†µã€‚</p>
<p><img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="https://cdn.jsdelivr.net/gh/JakicDong/blog-assets@main/images/20251027103144.png" alt="20251027103144"><br>äºŒå“¥çš„ Java è¿›é˜¶ä¹‹è·¯ï¼šæŠ€æœ¯æ´¾çš„æºç å°è£… ConcurrentHashMap</p>
<h4 id="è¯´ä¸€ä¸‹-ConcurrentHashMap-å¯¹-HashMap-çš„æ”¹è¿›ï¼Ÿ"><a href="#è¯´ä¸€ä¸‹-ConcurrentHashMap-å¯¹-HashMap-çš„æ”¹è¿›ï¼Ÿ" class="headerlink" title="è¯´ä¸€ä¸‹ ConcurrentHashMap å¯¹ HashMap çš„æ”¹è¿›ï¼Ÿ"></a>è¯´ä¸€ä¸‹ ConcurrentHashMap å¯¹ HashMap çš„æ”¹è¿›ï¼Ÿ</h4><p>é¦–å…ˆæ˜¯ hash çš„è®¡ç®—æ–¹æ³•ä¸Šï¼ŒConcurrentHashMap çš„ spread æ–¹æ³•æŽ¥æ”¶ä¸€ä¸ªå·²ç»è®¡ç®—å¥½çš„ hashCodeï¼Œç„¶åŽå°†è¿™ä¸ªå“ˆå¸Œç çš„é«˜ 16 ä½ä¸Žè‡ªèº«è¿›è¡Œå¼‚æˆ–è¿ç®—ã€‚</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">static</span> <span class="keyword">final</span> <span class="type">int</span> <span class="title function_">spread</span><span class="params">(<span class="type">int</span> h)</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> (h ^ (h &gt;&gt;&gt; <span class="number">16</span>)) &amp; HASH_BITS;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>æ¯” HashMap çš„ hash è®¡ç®—å¤šäº†ä¸€ä¸ª <code>&amp; HASH_BITS</code> çš„æ“ä½œã€‚è¿™é‡Œçš„ HASH_BITS æ˜¯ä¸€ä¸ªå¸¸æ•°ï¼Œå€¼ä¸º 0x7fffffffï¼Œå®ƒç¡®ä¿ç»“æžœæ˜¯ä¸€ä¸ªéžè´Ÿæ•´æ•°ã€‚</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">static</span> <span class="keyword">final</span> <span class="type">int</span> <span class="title function_">hash</span><span class="params">(Object key)</span> &#123;</span><br><span class="line">    <span class="type">int</span> h;</span><br><span class="line">    <span class="keyword">return</span> (key == <span class="literal">null</span>) ? <span class="number">0</span> : (h = key.hashCode()) ^ (h &gt;&gt;&gt; <span class="number">16</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>å¦å¤–ï¼ŒConcurrentHashMap å¯¹èŠ‚ç‚¹ Node åšäº†è¿›ä¸€æ­¥çš„å°è£…ï¼Œæ¯”å¦‚è¯´ç”¨ Forwarding Node æ¥è¡¨ç¤ºæ­£åœ¨è¿›è¡Œæ‰©å®¹çš„èŠ‚ç‚¹ã€‚</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">class</span> <span class="title class_">ForwardingNode</span>&lt;K,V&gt; <span class="keyword">extends</span> <span class="title class_">Node</span>&lt;K,V&gt; &#123;</span><br><span class="line">    <span class="keyword">final</span> Node&lt;K,V&gt;[] nextTable;</span><br><span class="line">    ForwardingNode(Node&lt;K,V&gt;[] tab) &#123;</span><br><span class="line">        <span class="built_in">super</span>(MOVED, <span class="literal">null</span>, <span class="literal">null</span>, <span class="literal">null</span>);</span><br><span class="line">        <span class="built_in">this</span>.nextTable = tab;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>æœ€åŽå°±æ˜¯ put æ–¹æ³•ï¼Œé€šè¿‡ CAS + synchronized ä»£ç å—æ¥è¿›è¡Œå¹¶å‘å†™å…¥ã€‚</p>
<p><img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="https://cdn.jsdelivr.net/gh/JakicDong/blog-assets@main/images/20251027104143.png" alt="20251027104143"><br>äºŒå“¥çš„ Java è¿›é˜¶ä¹‹è·¯ï¼šConcurrentHashMap çš„æºç </p>
<h4 id="ä¸ºä»€ä¹ˆ-ConcurrentHashMap-åœ¨-JDK-1-7-ä¸­è¦ç”¨-ReentrantLockï¼Œè€Œåœ¨-JDK-1-8-è¦ç”¨-synchronized"><a href="#ä¸ºä»€ä¹ˆ-ConcurrentHashMap-åœ¨-JDK-1-7-ä¸­è¦ç”¨-ReentrantLockï¼Œè€Œåœ¨-JDK-1-8-è¦ç”¨-synchronized" class="headerlink" title="ä¸ºä»€ä¹ˆ ConcurrentHashMap åœ¨ JDK 1.7 ä¸­è¦ç”¨ ReentrantLockï¼Œè€Œåœ¨ JDK 1.8 è¦ç”¨ synchronized"></a>ä¸ºä»€ä¹ˆ ConcurrentHashMap åœ¨ JDK 1.7 ä¸­è¦ç”¨ ReentrantLockï¼Œè€Œåœ¨ JDK 1.8 è¦ç”¨ synchronized</h4><p>JDK 1.7 ä¸­çš„ ConcurrentHashMap ä½¿ç”¨äº†åˆ†æ®µé”æœºåˆ¶ï¼Œæ¯ä¸ª Segment éƒ½ç»§æ‰¿äº† ReentrantLockï¼Œè¿™æ ·å¯ä»¥ä¿è¯æ¯ä¸ª Segment éƒ½å¯ä»¥ç‹¬ç«‹åœ°åŠ é”ã€‚</p>
<p>è€Œåœ¨ JDK 1.8 ä¸­ï¼ŒConcurrentHashMap å–æ¶ˆäº† Segment åˆ†æ®µé”ï¼Œé‡‡ç”¨äº†æ›´åŠ ç²¾ç»†åŒ–çš„é”â€”â€”æ¡¶é”ï¼Œä»¥åŠ CAS æ— é”ç®—æ³•ï¼Œæ¯ä¸ªæ¡¶éƒ½å¯ä»¥ç‹¬ç«‹åœ°åŠ é”ï¼Œåªæœ‰åœ¨ CAS å¤±è´¥æ—¶æ‰ä¼šä½¿ç”¨ synchronized ä»£ç å—åŠ é”ï¼Œè¿™æ ·å¯ä»¥å‡å°‘é”çš„ç«žäº‰ï¼Œæé«˜å¹¶å‘æ€§èƒ½ã€‚</p>
<h3 id="53-ðŸŒŸä»€ä¹ˆæ˜¯çº¿ç¨‹æ± ï¼Ÿ"><a href="#53-ðŸŒŸä»€ä¹ˆæ˜¯çº¿ç¨‹æ± ï¼Ÿ" class="headerlink" title="53.ðŸŒŸä»€ä¹ˆæ˜¯çº¿ç¨‹æ± ï¼Ÿ"></a>53.ðŸŒŸä»€ä¹ˆæ˜¯çº¿ç¨‹æ± ï¼Ÿ</h3><p>çº¿ç¨‹æ± æ˜¯ç”¨æ¥ç®¡ç†å’Œå¤ç”¨çº¿ç¨‹çš„å·¥å…·ï¼Œå®ƒå¯ä»¥å‡å°‘çº¿ç¨‹çš„åˆ›å»ºå’Œé”€æ¯å¼€é”€ã€‚</p>
<p><img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="https://cdn.jsdelivr.net/gh/JakicDong/blog-assets@main/images/20251010110039.png" alt="20251010110039"><br>ä¸‰åˆ†æ¶é¢æ¸£é€†è¢­ï¼šç®¡ç†çº¿ç¨‹çš„æ± å­</p>
<p>åœ¨ Java ä¸­ï¼ŒThreadPoolExecutor æ˜¯çº¿ç¨‹æ± çš„æ ¸å¿ƒå®žçŽ°ï¼Œå®ƒé€šè¿‡æ ¸å¿ƒçº¿ç¨‹æ•°ã€æœ€å¤§çº¿ç¨‹æ•°ã€ä»»åŠ¡é˜Ÿåˆ—å’Œæ‹’ç»ç­–ç•¥æ¥æŽ§åˆ¶çº¿ç¨‹çš„åˆ›å»ºå’Œæ‰§è¡Œã€‚</p>
<p>ä¸¾ä¸ªä¾‹å­ï¼šå°±åƒä½ å¼€äº†ä¸€å®¶é¤åŽ…ï¼Œçº¿ç¨‹æ± å°±ç›¸å½“äºŽå›ºå®šæ•°é‡çš„æœåŠ¡å‘˜ï¼Œé¡¾å®¢ï¼ˆä»»åŠ¡ï¼‰æ¥äº†å°±å®‰æŽ’ç©ºé—²çš„æœåŠ¡å‘˜ï¼ˆçº¿ç¨‹ï¼‰å¤„ç†ï¼Œé¿å…äº†é¢‘ç¹æ‹›äººå’Œè§£é›‡çš„æˆæœ¬ã€‚</p>
<h3 id="55-ðŸŒŸè¯´ä¸€ä¸‹çº¿ç¨‹æ± çš„å·¥ä½œæµç¨‹ï¼Ÿ"><a href="#55-ðŸŒŸè¯´ä¸€ä¸‹çº¿ç¨‹æ± çš„å·¥ä½œæµç¨‹ï¼Ÿ" class="headerlink" title="55.ðŸŒŸè¯´ä¸€ä¸‹çº¿ç¨‹æ± çš„å·¥ä½œæµç¨‹ï¼Ÿ"></a>55.ðŸŒŸè¯´ä¸€ä¸‹çº¿ç¨‹æ± çš„å·¥ä½œæµç¨‹ï¼Ÿ</h3><p>å¯ä»¥ç®€å•æ€»ç»“ä¸ºï¼š</p>
<p>ä»»åŠ¡æäº¤ â†’ æ ¸å¿ƒçº¿ç¨‹æ‰§è¡Œ â†’ ä»»åŠ¡é˜Ÿåˆ—ç¼“å­˜ â†’ éžæ ¸å¿ƒçº¿ç¨‹æ‰§è¡Œ â†’ æ‹’ç»ç­–ç•¥å¤„ç†ã€‚</p>
<p>ç¬¬ä¸€æ­¥ï¼Œçº¿ç¨‹æ± é€šè¿‡ <code>submit()</code> æäº¤ä»»åŠ¡ã€‚</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">ExecutorService</span> <span class="variable">threadPool</span> <span class="operator">=</span> Executors.newFixedThreadPool(<span class="number">5</span>);</span><br><span class="line">threadPool.submit(() -&gt; &#123;</span><br><span class="line">    System.out.println(Thread.currentThread().getName() + <span class="string">&quot;\t&quot;</span> + <span class="string">&quot;åŠžç†ä¸šåŠ¡&quot;</span>);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<p>ç¬¬äºŒæ­¥ï¼Œçº¿ç¨‹æ± ä¼šå…ˆåˆ›å»ºæ ¸å¿ƒçº¿ç¨‹æ¥æ‰§è¡Œä»»åŠ¡ã€‚</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> (workerCountOf(c) &lt; corePoolSize) &#123;</span><br><span class="line">    <span class="keyword">if</span> (addWorker(command, <span class="literal">true</span>)) &#123;</span><br><span class="line">        <span class="keyword">return</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>ç¬¬ä¸‰æ­¥ï¼Œå¦‚æžœæ ¸å¿ƒçº¿ç¨‹éƒ½åœ¨å¿™ï¼Œä»»åŠ¡ä¼šè¢«æ”¾å…¥ä»»åŠ¡é˜Ÿåˆ—ä¸­ã€‚</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">workQueue.offer(task);</span><br></pre></td></tr></table></figure>

<p>ç¬¬å››æ­¥ï¼Œå¦‚æžœä»»åŠ¡é˜Ÿåˆ—å·²æ»¡ï¼Œä¸”å½“å‰çº¿ç¨‹æ•°é‡å°äºŽæœ€å¤§çº¿ç¨‹æ•°ï¼Œçº¿ç¨‹æ± ä¼šåˆ›å»ºæ–°çš„çº¿ç¨‹æ¥å¤„ç†ä»»åŠ¡ã€‚</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> (!addWorker(command, <span class="literal">false</span>))</span><br></pre></td></tr></table></figure>

<p>ç¬¬äº”æ­¥ï¼Œå¦‚æžœçº¿ç¨‹æ± ä¸­çš„çº¿ç¨‹æ•°é‡å·²ç»è¾¾åˆ°æœ€å¤§çº¿ç¨‹æ•°ï¼Œä¸”ä»»åŠ¡é˜Ÿåˆ—å·²æ»¡ï¼Œçº¿ç¨‹æ± ä¼šæ‰§è¡Œæ‹’ç»ç­–ç•¥ã€‚</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">handler.rejectedExecution(command, <span class="built_in">this</span>);</span><br></pre></td></tr></table></figure>

<p>å¦å¤–ä¸€ç‰ˆå›žç­”ã€‚</p>
<p>ç¬¬ä¸€æ­¥ï¼Œåˆ›å»ºçº¿ç¨‹æ± ã€‚</p>
<p>ç¬¬äºŒæ­¥ï¼Œè°ƒç”¨çº¿ç¨‹æ± çš„ <code>execute()</code>æ–¹æ³•ï¼Œå‡†å¤‡æ‰§è¡Œä»»åŠ¡ã€‚</p>
<ul>
<li>å¦‚æžœæ­£åœ¨è¿è¡Œçš„çº¿ç¨‹æ•°é‡å°äºŽ corePoolSizeï¼Œé‚£ä¹ˆçº¿ç¨‹æ± ä¼šåˆ›å»ºä¸€ä¸ªæ–°çš„çº¿ç¨‹æ¥æ‰§è¡Œè¿™ä¸ªä»»åŠ¡ï¼›</li>
<li>å¦‚æžœæ­£åœ¨è¿è¡Œçš„çº¿ç¨‹æ•°é‡å¤§äºŽæˆ–ç­‰äºŽ corePoolSizeï¼Œé‚£ä¹ˆçº¿ç¨‹æ± ä¼šå°†è¿™ä¸ªä»»åŠ¡æ”¾å…¥ç­‰å¾…é˜Ÿåˆ—ï¼›</li>
<li>å¦‚æžœç­‰å¾…é˜Ÿåˆ—æ»¡äº†ï¼Œè€Œä¸”æ­£åœ¨è¿è¡Œçš„çº¿ç¨‹æ•°é‡å°äºŽ maximumPoolSizeï¼Œé‚£ä¹ˆçº¿ç¨‹æ± ä¼šåˆ›å»ºæ–°çš„çº¿ç¨‹æ¥æ‰§è¡Œè¿™ä¸ªä»»åŠ¡ï¼›</li>
<li>å¦‚æžœç­‰å¾…é˜Ÿåˆ—æ»¡äº†ï¼Œè€Œä¸”æ­£åœ¨è¿è¡Œçš„çº¿ç¨‹æ•°é‡å¤§äºŽæˆ–ç­‰äºŽ maximumPoolSizeï¼Œé‚£ä¹ˆçº¿ç¨‹æ± ä¼šæ‰§è¡Œæ‹’ç»ç­–ç•¥ã€‚</li>
</ul>
<p><img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="https://cdn.jsdelivr.net/gh/JakicDong/blog-assets@main/images/20251010110236.png" alt="20251010110236"><br>ä¸‰åˆ†æ¶é¢æ¸£é€†è¢­ï¼šçº¿ç¨‹æ± æ‰§è¡Œæµç¨‹</p>
<p>ç¬¬ä¸‰æ­¥ï¼Œçº¿ç¨‹æ‰§è¡Œå®Œæ¯•åŽï¼Œçº¿ç¨‹å¹¶ä¸ä¼šç«‹å³é”€æ¯ï¼Œè€Œæ˜¯ç»§ç»­ä¿æŒåœ¨æ± ä¸­ç­‰å¾…ä¸‹ä¸€ä¸ªä»»åŠ¡ã€‚</p>
<p>ç¬¬å››æ­¥ï¼Œå½“çº¿ç¨‹ç©ºé—²æ—¶é—´è¶…å‡ºæŒ‡å®šæ—¶é—´ï¼Œä¸”å½“å‰çº¿ç¨‹æ•°é‡å¤§äºŽæ ¸å¿ƒçº¿ç¨‹æ•°æ—¶ï¼Œçº¿ç¨‹ä¼šè¢«å›žæ”¶ã€‚</p>
<h4 id="èƒ½ç”¨ä¸€ä¸ªç”Ÿæ´»ä¸­çš„ä¾‹å­è¯´æ˜Žä¸‹å—ï¼Ÿ"><a href="#èƒ½ç”¨ä¸€ä¸ªç”Ÿæ´»ä¸­çš„ä¾‹å­è¯´æ˜Žä¸‹å—ï¼Ÿ" class="headerlink" title="èƒ½ç”¨ä¸€ä¸ªç”Ÿæ´»ä¸­çš„ä¾‹å­è¯´æ˜Žä¸‹å—ï¼Ÿ"></a>èƒ½ç”¨ä¸€ä¸ªç”Ÿæ´»ä¸­çš„ä¾‹å­è¯´æ˜Žä¸‹å—ï¼Ÿ</h4><p>å¯ä»¥ã€‚æœ‰ä¸ªåå«â€œä½ ä¸€å®šæš´å¯Œâ€çš„é“¶è¡Œï¼Œè¯¥é“¶è¡Œæœ‰ 6 ä¸ªçª—å£ï¼ŒçŽ°åœ¨å¼€æ”¾äº† 3 ä¸ªçª—å£ï¼Œåç€ 3 ä¸ªå°å§å§åœ¨åŠžç†ä¸šåŠ¡ã€‚</p>
<p>é“ä»”å°äºŒåŽ»åŠžç†ä¸šåŠ¡ï¼Œä¼šé‡åˆ°ä»€ä¹ˆæƒ…å†µå‘¢ï¼Ÿ</p>
<p>ç¬¬ä¸€æƒ…å†µï¼Œå°äºŒå‘çŽ°æœ‰ä¸ªç©ºé—²çš„å°å§å§ï¼Œæ­£åœ¨ç¿˜é¦–ä»¥ç›¼ï¼ŒäºŽæ˜¯å°äºŒå°±å¿«é©¬åŠ éž­è·‘è¿‡åŽ»åŠžç†äº†ã€‚</p>
<p><img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="https://cdn.jsdelivr.net/gh/JakicDong/blog-assets@main/images/20251010110317.png" alt="20251010110317"><br>ä¸‰åˆ†æ¶é¢æ¸£é€†è¢­ï¼šç›´æŽ¥åŠžç†</p>
<p>ç¬¬äºŒç§æƒ…å†µï¼Œå°å§å§ä»¬éƒ½åœ¨å¿™ï¼ŒæŽ¥å¾…å‘˜å°ç¾Žæ‹›å‘¼å°äºŒåŽ»æŽ’é˜ŸåŒºåŒºå–å·æŽ’é˜Ÿï¼Œè®©å°äºŒç¨å®‰å‹¿èºã€‚</p>
<p><img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="https://cdn.jsdelivr.net/gh/JakicDong/blog-assets@main/images/20251010110343.png" alt="20251010110343"><br>ä¸‰åˆ†æ¶é¢æ¸£é€†è¢­ï¼šæŽ’é˜Ÿç­‰å¾…</p>
<p>ç¬¬ä¸‰ç§æƒ…å†µï¼Œä¸ä»…å°å§å§ä»¬éƒ½åœ¨å¿™ï¼ŒæŽ’é˜ŸåŒºä¹Ÿæ»¡äº†ï¼Œå°äºŒç€æ€¥ç”¨é’±ï¼ŒäºŽæ˜¯è„¾æ°”å°±ä¸Šæ¥äº†ï¼Œå’ŒæŽ¥å¾…å‘˜å°ç¾Žå¯¹çº¿äº†èµ·æ¥ï¼Œè¦æ±‚å¼€æ”¾å¦å¤– 3 ä¸ªç©ºé—²çš„çª—å£ã€‚</p>
<p>å°ç¾Žè¿«äºŽå°äºŒçš„åŽ‹åŠ›ï¼Œå¼€æ”¾äº†å¦å¤– 3 ä¸ªçª—å£ï¼ŒæŽ’é˜ŸåŒºçš„äººç«‹é©¬å°±å†²äº†è¿‡åŽ»ã€‚</p>
<p><img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="https://cdn.jsdelivr.net/gh/JakicDong/blog-assets@main/images/20251010110423.png" alt="20251010110423"><br>ä¸‰åˆ†æ¶é¢æ¸£é€†è¢­ï¼šæŽ’é˜ŸåŒºæ»¡</p>
<p>ç¬¬å››ç§æƒ…å†µï¼Œ6 ä¸ªçª—å£çš„å°å§å§éƒ½åœ¨å¿™ï¼ŒæŽ’é˜ŸåŒºä¹Ÿæ»¡äº†ã€‚ã€‚ã€‚</p>
<p><img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="https://cdn.jsdelivr.net/gh/JakicDong/blog-assets@main/images/20251010110434.png" alt="20251010110434"><br>ä¸‰åˆ†æ¶é¢æ¸£é€†è¢­ï¼šç­‰å¾…åŒºï¼ŒæŽ’é˜ŸåŒºéƒ½æ»¡</p>
<p>æŽ¥å¾…å‘˜å°ç¾Žç»™äº†å°äºŒ 4 ä¸ªé€‰é¡¹ï¼š</p>
<ol>
<li>å¯¹ä¸èµ·ï¼Œæˆ‘ä»¬æš´å¯Œé“¶è¡Œç³»ç»Ÿç˜«ç—ªäº†ã€‚</li>
<li>æ²¡çœ‹å¿™ç€å‘¢ï¼Œè°å«ä½ æ¥åŠžçš„ä½ æ‰¾è°åŽ»ï¼</li>
<li>é“ä»”ï¼Œçœ‹ä½ æ¯”è¾ƒæ€¥ï¼ŒåŽ»é˜Ÿé‡Œå·å·åŠ ä¸ªå¡žã€‚</li>
<li>ä¸å¥½æ„æ€ï¼Œä»Šå¤©æ²¡åŠžæ³•ï¼Œä½ æ”¹å¤©å†æ¥å§ã€‚</li>
</ol>
<p>è¿™ä¸ªæµç¨‹å’Œçº¿ç¨‹æ± ä¸èƒ½è¯´ä¸€æ¨¡ä¸€æ ·ï¼Œç®€ç›´å°±æ˜¯ä¸€æ¨¡ä¸€æ ·ï¼š</p>
<ol>
<li>corePoolSize å¯¹åº”è¥ä¸šçª—å£æ•° 3</li>
<li>maximumPoolSize å¯¹åº”æœ€å¤§çª—å£æ•° 6</li>
<li>workQueue å¯¹åº”æŽ’é˜ŸåŒº</li>
<li>handler å¯¹åº”æŽ¥å¾…å‘˜å°ç¾Ž</li>
</ol>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">ThreadPoolDemo</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        <span class="comment">// åˆ›å»ºä¸€ä¸ªçº¿ç¨‹æ± </span></span><br><span class="line">        <span class="type">ExecutorService</span> <span class="variable">threadPool</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ThreadPoolExecutor</span>(</span><br><span class="line">                <span class="number">3</span>, <span class="comment">// æ ¸å¿ƒçº¿ç¨‹æ•°</span></span><br><span class="line">                <span class="number">6</span>, <span class="comment">// æœ€å¤§çº¿ç¨‹æ•°</span></span><br><span class="line">                <span class="number">0</span>, <span class="comment">// çº¿ç¨‹ç©ºé—²æ—¶é—´</span></span><br><span class="line">                TimeUnit.SECONDS, <span class="comment">// æ—¶é—´å•ä½</span></span><br><span class="line">                <span class="keyword">new</span> <span class="title class_">LinkedBlockingQueue</span>&lt;&gt;(<span class="number">10</span>), <span class="comment">// ç­‰å¾…é˜Ÿåˆ—</span></span><br><span class="line">                Executors.defaultThreadFactory(), <span class="comment">// çº¿ç¨‹å·¥åŽ‚</span></span><br><span class="line">                <span class="keyword">new</span> <span class="title class_">ThreadPoolExecutor</span>.AbortPolicy() <span class="comment">// æ‹’ç»ç­–ç•¥</span></span><br><span class="line">        );</span><br><span class="line">        <span class="comment">// æ¨¡æ‹Ÿ 10 ä¸ªé¡¾å®¢æ¥é“¶è¡ŒåŠžç†ä¸šåŠ¡</span></span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">1</span>; i &lt;= <span class="number">10</span>; i++) &#123;</span><br><span class="line">                <span class="keyword">final</span> <span class="type">int</span> <span class="variable">tempInt</span> <span class="operator">=</span> i;</span><br><span class="line">                threadPool.execute(() -&gt; &#123;</span><br><span class="line">                    System.out.println(Thread.currentThread().getName() + <span class="string">&quot;\t&quot;</span> + <span class="string">&quot;åŠžç†ä¸šåŠ¡&quot;</span> + tempInt);</span><br><span class="line">                &#125;);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">            threadPool.shutdown();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="56-ðŸŒŸçº¿ç¨‹æ± çš„ä¸»è¦å‚æ•°æœ‰å“ªäº›ï¼Ÿ"><a href="#56-ðŸŒŸçº¿ç¨‹æ± çš„ä¸»è¦å‚æ•°æœ‰å“ªäº›ï¼Ÿ" class="headerlink" title="56.ðŸŒŸçº¿ç¨‹æ± çš„ä¸»è¦å‚æ•°æœ‰å“ªäº›ï¼Ÿ"></a>56.ðŸŒŸçº¿ç¨‹æ± çš„ä¸»è¦å‚æ•°æœ‰å“ªäº›ï¼Ÿ</h3><p>çº¿ç¨‹æ± æœ‰ 7 ä¸ªå‚æ•°ï¼Œéœ€è¦é‡ç‚¹å…³æ³¨çš„æœ‰æ ¸å¿ƒçº¿ç¨‹æ•°ã€æœ€å¤§çº¿ç¨‹æ•°ã€ç­‰å¾…é˜Ÿåˆ—ã€æ‹’ç»ç­–ç•¥ã€‚</p>
<p><img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="https://cdn.jsdelivr.net/gh/JakicDong/blog-assets@main/images/20251010110511.png" alt="20251010110511"><br>ä¸‰åˆ†æ¶é¢æ¸£é€†è¢­ï¼šçº¿ç¨‹æ± å‚æ•°</p>
<p><strong>â‘ ã€corePoolSize</strong>ï¼šæ ¸å¿ƒçº¿ç¨‹æ•°ï¼Œé•¿æœŸå­˜æ´»ï¼Œæ‰§è¡Œä»»åŠ¡çš„ä¸»åŠ›ã€‚</p>
<p><strong>â‘¡ã€maximumPoolSize</strong>ï¼šçº¿ç¨‹æ± å…è®¸çš„æœ€å¤§çº¿ç¨‹æ•°ã€‚</p>
<p><strong>â‘¢ã€workQueue</strong>ï¼šä»»åŠ¡é˜Ÿåˆ—ï¼Œå­˜å‚¨ç­‰å¾…æ‰§è¡Œçš„ä»»åŠ¡ã€‚</p>
<p><strong>â‘£ã€handler</strong>ï¼šæ‹’ç»ç­–ç•¥ï¼Œä»»åŠ¡è¶…è½½æ—¶çš„å¤„ç†æ–¹å¼ã€‚ä¹Ÿå°±æ˜¯çº¿ç¨‹æ•°è¾¾åˆ° maximumPoolSizï¼Œä»»åŠ¡é˜Ÿåˆ—ä¹Ÿæ»¡äº†çš„æ—¶å€™ï¼Œå°±ä¼šè§¦å‘æ‹’ç»ç­–ç•¥ã€‚</p>
<p><strong>â‘¤ã€threadFactory</strong>ï¼šçº¿ç¨‹å·¥åŽ‚ï¼Œç”¨äºŽåˆ›å»ºçº¿ç¨‹ï¼Œå¯è‡ªå®šä¹‰çº¿ç¨‹åã€‚</p>
<p><strong>â‘¥ã€keepAliveTime</strong>ï¼šéžæ ¸å¿ƒçº¿ç¨‹çš„å­˜æ´»æ—¶é—´ï¼Œç©ºé—²æ—¶é—´è¶…è¿‡è¯¥å€¼å°±é”€æ¯ã€‚</p>
<p><strong>â‘¦ã€unit</strong>ï¼škeepAliveTime å‚æ•°çš„æ—¶é—´å•ä½ï¼š</p>
<ul>
<li>TimeUnit.DAYS; å¤©</li>
<li>TimeUnit.HOURS; å°æ—¶</li>
<li>TimeUnit.MINUTES; åˆ†é’Ÿ</li>
<li>TimeUnit.SECONDS; ç§’</li>
<li>TimeUnit.MILLISECONDS; æ¯«ç§’</li>
<li>TimeUnit.MICROSECONDS; å¾®ç§’</li>
<li>TimeUnit.NANOSECONDS; çº³ç§’</li>
</ul>
<h4 id="èƒ½ç®€å•è¯´ä¸€ä¸‹å‚æ•°ä¹‹é—´çš„å…³ç³»å—ï¼Ÿ"><a href="#èƒ½ç®€å•è¯´ä¸€ä¸‹å‚æ•°ä¹‹é—´çš„å…³ç³»å—ï¼Ÿ" class="headerlink" title="èƒ½ç®€å•è¯´ä¸€ä¸‹å‚æ•°ä¹‹é—´çš„å…³ç³»å—ï¼Ÿ"></a>èƒ½ç®€å•è¯´ä¸€ä¸‹å‚æ•°ä¹‹é—´çš„å…³ç³»å—ï¼Ÿ</h4><p>ä¸€å¥è¯ï¼šä»»åŠ¡ä¼˜å…ˆä½¿ç”¨æ ¸å¿ƒçº¿ç¨‹æ‰§è¡Œï¼Œæ»¡äº†è¿›å…¥ç­‰å¾…é˜Ÿåˆ—ï¼Œé˜Ÿåˆ—æ»¡äº†å¯ç”¨éžæ ¸å¿ƒçº¿ç¨‹å¤‡ç”¨ï¼Œçº¿ç¨‹æ± è¾¾åˆ°æœ€å¤§çº¿ç¨‹æ•°é‡åŽè§¦å‘æ‹’ç»ç­–ç•¥ï¼Œéžæ ¸å¿ƒçº¿ç¨‹çš„ç©ºé—²æ—¶é—´è¶…è¿‡å­˜æ´»æ—¶é—´å°±è¢«å›žæ”¶ã€‚</p>
<h4 id="æ ¸å¿ƒçº¿ç¨‹æ•°ä¸å¤Ÿä¼šæ€Žä¹ˆè¿›è¡Œå¤„ç†ï¼Ÿ"><a href="#æ ¸å¿ƒçº¿ç¨‹æ•°ä¸å¤Ÿä¼šæ€Žä¹ˆè¿›è¡Œå¤„ç†ï¼Ÿ" class="headerlink" title="æ ¸å¿ƒçº¿ç¨‹æ•°ä¸å¤Ÿä¼šæ€Žä¹ˆè¿›è¡Œå¤„ç†ï¼Ÿ"></a>æ ¸å¿ƒçº¿ç¨‹æ•°ä¸å¤Ÿä¼šæ€Žä¹ˆè¿›è¡Œå¤„ç†ï¼Ÿ</h4><p>å½“æäº¤çš„ä»»åŠ¡æ•°è¶…è¿‡äº† corePoolSizeï¼Œä½†æ˜¯å°äºŽ maximumPoolSize æ—¶ï¼Œçº¿ç¨‹æ± ä¼šåˆ›å»ºæ–°çš„çº¿ç¨‹æ¥å¤„ç†ä»»åŠ¡ã€‚</p>
<p>å½“æäº¤çš„ä»»åŠ¡æ•°è¶…è¿‡äº† maximumPoolSize æ—¶ï¼Œçº¿ç¨‹æ± ä¼šæ ¹æ®æ‹’ç»ç­–ç•¥æ¥å¤„ç†ä»»åŠ¡ã€‚</p>
<h4 id="ä¸¾ä¸ªä¾‹å­è¯´ä¸€ä¸‹è¿™äº›å‚æ•°çš„å˜åŒ–ï¼Ÿ"><a href="#ä¸¾ä¸ªä¾‹å­è¯´ä¸€ä¸‹è¿™äº›å‚æ•°çš„å˜åŒ–ï¼Ÿ" class="headerlink" title="ä¸¾ä¸ªä¾‹å­è¯´ä¸€ä¸‹è¿™äº›å‚æ•°çš„å˜åŒ–ï¼Ÿ"></a>ä¸¾ä¸ªä¾‹å­è¯´ä¸€ä¸‹è¿™äº›å‚æ•°çš„å˜åŒ–ï¼Ÿ</h4><p>å‡è®¾ä¸€ä¸ªåœºæ™¯ï¼Œçº¿ç¨‹æ± çš„é…ç½®å¦‚ä¸‹ï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">corePoolSize = <span class="number">5</span></span><br><span class="line">maximumPoolSize = <span class="number">10</span></span><br><span class="line">keepAliveTime = <span class="number">60</span>ç§’</span><br><span class="line">workQueue = LinkedBlockingQueueï¼ˆå®¹é‡ä¸º<span class="number">100</span>ï¼‰</span><br><span class="line">handler = ThreadPoolExecutor.AbortPolicy()</span><br></pre></td></tr></table></figure>

<p><strong>åœºæ™¯ä¸€</strong>ï¼šå½“ç³»ç»Ÿå¯åŠ¨åŽï¼Œæœ‰ 10 ä¸ªä»»åŠ¡æäº¤åˆ°çº¿ç¨‹æ± ã€‚</p>
<ul>
<li>å‰ 5 ä¸ªä»»åŠ¡ä¼šç«‹å³æ‰§è¡Œï¼Œå› ä¸ºæ ¸å¿ƒçº¿ç¨‹æ•°è¶³å¤Ÿå®¹çº³å®ƒä»¬ã€‚</li>
<li>éšåŽçš„ 5 ä¸ªä»»åŠ¡ä¼šè¢«æ”¾å…¥ç­‰å¾…é˜Ÿåˆ—ã€‚</li>
</ul>
<p><strong>åœºæ™¯äºŒ</strong>ï¼šå¦‚æžœæ­¤æ—¶å†æœ‰ 100 ä¸ªä»»åŠ¡æäº¤åˆ°çº¿ç¨‹æ± ã€‚</p>
<ul>
<li>å·¥ä½œé˜Ÿåˆ—å·²æ»¡ï¼Œçº¿ç¨‹æ± ä¼šåˆ›å»ºé¢å¤–çš„çº¿ç¨‹æ¥æ‰§è¡Œè¿™äº›ä»»åŠ¡ï¼Œç›´åˆ°çº¿ç¨‹æ€»æ•°è¾¾åˆ° 10ã€‚</li>
<li>å¦‚æžœä»»åŠ¡ç»§ç»­å¢žåŠ ï¼Œè¶…è¿‡äº†å·¥ä½œé˜Ÿåˆ—+æœ€å¤§çº¿ç¨‹æ•°çš„é™åˆ¶ï¼Œæ–°æ¥çš„ä»»åŠ¡ä¼šè¢« AbortPolicy æ‹’ç»ï¼ŒæŠ›å‡º RejectedExecutionException å¼‚å¸¸ã€‚</li>
</ul>
<p><strong>åœºæ™¯ä¸‰</strong>ï¼šå¦‚æžœä»»åŠ¡çªç„¶å‡å°‘ï¼š</p>
<p>æ ¸å¿ƒçº¿ç¨‹ä¼šä¸€ç›´è¿è¡Œï¼Œè€Œè¶…å‡ºæ ¸å¿ƒçº¿ç¨‹æ•°çš„çº¿ç¨‹ï¼Œä¼šåœ¨ 60 ç§’åŽå›žæ”¶ã€‚</p>
<h3 id="57-ðŸŒŸçº¿ç¨‹æ± çš„æ‹’ç»ç­–ç•¥æœ‰å“ªäº›ï¼Ÿ"><a href="#57-ðŸŒŸçº¿ç¨‹æ± çš„æ‹’ç»ç­–ç•¥æœ‰å“ªäº›ï¼Ÿ" class="headerlink" title="57.ðŸŒŸçº¿ç¨‹æ± çš„æ‹’ç»ç­–ç•¥æœ‰å“ªäº›ï¼Ÿ"></a>57.ðŸŒŸçº¿ç¨‹æ± çš„æ‹’ç»ç­–ç•¥æœ‰å“ªäº›ï¼Ÿ</h3><p>æœ‰å››ç§ï¼š</p>
<ul>
<li>AbortPolicyï¼šé»˜è®¤çš„æ‹’ç»ç­–ç•¥ï¼Œä¼šæŠ› RejectedExecutionException å¼‚å¸¸ã€‚</li>
<li>CallerRunsPolicyï¼šè®©æäº¤ä»»åŠ¡çš„çº¿ç¨‹è‡ªå·±æ¥æ‰§è¡Œè¿™ä¸ªä»»åŠ¡ï¼Œä¹Ÿå°±æ˜¯è°ƒç”¨ execute æ–¹æ³•çš„çº¿ç¨‹ã€‚</li>
<li>DiscardOldestPolicyï¼šç­‰å¾…é˜Ÿåˆ—ä¼šä¸¢å¼ƒé˜Ÿåˆ—ä¸­æœ€è€çš„ä¸€ä¸ªä»»åŠ¡ï¼Œä¹Ÿå°±æ˜¯é˜Ÿåˆ—ä¸­ç­‰å¾…æœ€ä¹…çš„ä»»åŠ¡ï¼Œç„¶åŽå°è¯•é‡æ–°æäº¤è¢«æ‹’ç»çš„ä»»åŠ¡ã€‚</li>
<li>DiscardPolicyï¼šä¸¢å¼ƒè¢«æ‹’ç»çš„ä»»åŠ¡ï¼Œä¸åšä»»ä½•å¤„ç†ä¹Ÿä¸æŠ›å‡ºå¼‚å¸¸ã€‚</li>
</ul>
<p><img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="https://cdn.jsdelivr.net/gh/JakicDong/blog-assets@main/images/20251010110646.png" alt="20251010110646"><br>ä¸‰åˆ†æ¶é¢æ¸£é€†è¢­ï¼šå››ç§ç­–ç•¥</p>
<p>åˆ†åˆ«å¯¹åº”ç€å°äºŒåŽ»é“¶è¡ŒåŠžç†ä¸šåŠ¡è¢«ç»ç†â€œè–„çº±â€çš„å››ä¸ªåœºæ™¯ï¼šâ€œæˆ‘ä»¬ç³»ç»Ÿç˜«ç—ªäº†â€ã€â€œè°å«ä½ æ¥åŠžçš„ä½ æ‰¾è°åŽ»â€ã€â€œçœ‹ä½ æ¯”è¾ƒæ€¥ï¼ŒåŽ»é˜Ÿé‡ŒåŠ ä¸ªå¡žâ€ã€â€œä»Šå¤©æ²¡åŠžæ³•ï¼Œä¸è¡Œä½ çœ‹æ”¹ä¸€å¤©â€ã€‚</p>
<p>å½“çº¿ç¨‹æ± æ— æ³•æŽ¥å—æ–°çš„ä»»åŠ¡æ—¶ï¼Œä¹Ÿå°±æ˜¯çº¿ç¨‹æ•°è¾¾åˆ° maximumPoolSizeï¼Œä»»åŠ¡é˜Ÿåˆ—ä¹Ÿæ»¡äº†çš„æ—¶å€™ï¼Œå°±ä¼šè§¦å‘æ‹’ç»ç­–ç•¥ã€‚</p>
<p>å¦‚æžœé»˜è®¤ç­–ç•¥ä¸èƒ½æ»¡è¶³éœ€æ±‚ï¼Œå¯ä»¥é€šè¿‡å®žçŽ° RejectedExecutionHandler æŽ¥å£æ¥å®šä¹‰è‡ªå·±çš„æ·˜æ±°ç­–ç•¥ã€‚ä¾‹å¦‚ï¼šè®°å½•è¢«æ‹’ç»ä»»åŠ¡çš„æ—¥å¿—ã€‚</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">CustomRejectedHandler</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        <span class="comment">// è‡ªå®šä¹‰æ‹’ç»ç­–ç•¥</span></span><br><span class="line">        <span class="type">RejectedExecutionHandler</span> <span class="variable">rejectedHandler</span> <span class="operator">=</span> (r, executor) -&gt; &#123;</span><br><span class="line">            System.out.println(<span class="string">&quot;Task &quot;</span> + r.toString() + <span class="string">&quot; rejected. Queue size: &quot;</span> </span><br><span class="line">                               + executor.getQueue().size());</span><br><span class="line">        &#125;;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// è‡ªå®šä¹‰çº¿ç¨‹æ± </span></span><br><span class="line">        <span class="type">ThreadPoolExecutor</span> <span class="variable">executor</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ThreadPoolExecutor</span>(</span><br><span class="line">            <span class="number">2</span>,                      <span class="comment">// æ ¸å¿ƒçº¿ç¨‹æ•°</span></span><br><span class="line">            <span class="number">4</span>,                      <span class="comment">// æœ€å¤§çº¿ç¨‹æ•°</span></span><br><span class="line">            <span class="number">10</span>,                     <span class="comment">// ç©ºé—²çº¿ç¨‹å­˜æ´»æ—¶é—´</span></span><br><span class="line">            TimeUnit.SECONDS,</span><br><span class="line">            <span class="keyword">new</span> <span class="title class_">ArrayBlockingQueue</span>&lt;&gt;(<span class="number">2</span>),  <span class="comment">// é˜»å¡žé˜Ÿåˆ—å®¹é‡</span></span><br><span class="line">            Executors.defaultThreadFactory(),</span><br><span class="line">            rejectedHandler          <span class="comment">// è‡ªå®šä¹‰æ‹’ç»ç­–ç•¥</span></span><br><span class="line">        );</span><br><span class="line"></span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; <span class="number">10</span>; i++) &#123;</span><br><span class="line">            <span class="keyword">final</span> <span class="type">int</span> <span class="variable">taskNumber</span> <span class="operator">=</span> i;</span><br><span class="line">            executor.execute(() -&gt; &#123;</span><br><span class="line">                System.out.println(<span class="string">&quot;Executing task &quot;</span> + taskNumber);</span><br><span class="line">                <span class="keyword">try</span> &#123;</span><br><span class="line">                    Thread.sleep(<span class="number">1000</span>); <span class="comment">// æ¨¡æ‹Ÿä»»åŠ¡è€—æ—¶</span></span><br><span class="line">                &#125; <span class="keyword">catch</span> (InterruptedException e) &#123;</span><br><span class="line">                    e.printStackTrace();</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        executor.shutdown();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>


<h3 id="67-ðŸŒŸçº¿ç¨‹æ± è°ƒä¼˜äº†è§£å—ï¼Ÿï¼ˆè¡¥å……ï¼‰"><a href="#67-ðŸŒŸçº¿ç¨‹æ± è°ƒä¼˜äº†è§£å—ï¼Ÿï¼ˆè¡¥å……ï¼‰" class="headerlink" title="67.ðŸŒŸçº¿ç¨‹æ± è°ƒä¼˜äº†è§£å—ï¼Ÿï¼ˆè¡¥å……ï¼‰"></a>67.ðŸŒŸçº¿ç¨‹æ± è°ƒä¼˜äº†è§£å—ï¼Ÿï¼ˆè¡¥å……ï¼‰</h3><p><img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="https://cdn.jsdelivr.net/gh/JakicDong/blog-assets@main/images/20251010111648.png" alt="20251010111648"><br>ä¸‰åˆ†æ¶é¢æ¸£é€†è¢­ï¼šçº¿ç¨‹æ± è°ƒä¼˜</p>
<p>é¦–å…ˆæˆ‘ä¼šæ ¹æ®ä»»åŠ¡ç±»åž‹è®¾ç½®æ ¸å¿ƒçº¿ç¨‹æ•°å‚æ•°ï¼Œæ¯”å¦‚ IO å¯†é›†åž‹ä»»åŠ¡ä¼šè®¾ç½®ä¸º CPU æ ¸å¿ƒæ•°*2 çš„ç»éªŒå€¼ã€‚</p>
<p>å…¶æ¬¡æˆ‘ä¼šç»“åˆçº¿ç¨‹æ± åŠ¨æ€è°ƒæ•´çš„èƒ½åŠ›ï¼Œåœ¨æµé‡æ³¢åŠ¨æ—¶é€šè¿‡ setCorePoolSize å¹³æ»‘æ‰©å®¹ï¼Œæˆ–è€…ç›´æŽ¥ä½¿ç”¨ DynamicTp å®žçŽ°çº¿ç¨‹æ± å‚æ•°çš„è‡ªåŠ¨åŒ–è°ƒæ•´ã€‚</p>
<p>æœ€åŽï¼Œæˆ‘ä¼šé€šè¿‡å†…ç½®çš„ç›‘æŽ§æŒ‡æ ‡å»ºç«‹å®¹é‡é¢„è­¦æœºåˆ¶ã€‚æ¯”å¦‚é€šè¿‡ JMX ç›‘æŽ§çº¿ç¨‹æ± çš„è¿è¡ŒçŠ¶æ€ï¼Œè®¾ç½®é˜ˆå€¼ï¼Œå½“çº¿ç¨‹æ± çš„ä»»åŠ¡é˜Ÿåˆ—é•¿åº¦è¶…è¿‡é˜ˆå€¼æ—¶ï¼Œè§¦å‘å‘Šè­¦ã€‚</p>
<h3 id="69-ðŸŒŸä½ èƒ½è®¾è®¡å®žçŽ°ä¸€ä¸ªçº¿ç¨‹æ± å—ï¼Ÿ"><a href="#69-ðŸŒŸä½ èƒ½è®¾è®¡å®žçŽ°ä¸€ä¸ªçº¿ç¨‹æ± å—ï¼Ÿ" class="headerlink" title="69.ðŸŒŸä½ èƒ½è®¾è®¡å®žçŽ°ä¸€ä¸ªçº¿ç¨‹æ± å—ï¼Ÿ"></a>69.ðŸŒŸä½ èƒ½è®¾è®¡å®žçŽ°ä¸€ä¸ªçº¿ç¨‹æ± å—ï¼Ÿ</h3><p>æŽ¨èé˜…è¯»ï¼š<a target="_blank" rel="noopener" href="https://mp.weixin.qq.com/s/Exy7pRGND9TCjRd9TZK4jg">ä¸‰åˆ†æ¶çº¿ç¨‹æ± åŽŸç†</a></p>
<p>çº¿ç¨‹æ± çš„ä¸»è¦ç›®çš„æ˜¯ä¸ºäº†é¿å…é¢‘ç¹åœ°åˆ›å»ºå’Œé”€æ¯çº¿ç¨‹ã€‚</p>
<p><img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="https://cdn.jsdelivr.net/gh/JakicDong/blog-assets@main/images/20251010111742.png" alt="20251010111742"><br>ä¸‰åˆ†æ¶é¢æ¸£é€†è¢­ï¼šçº¿ç¨‹æ± ä¸»è¦å®žçŽ°æµç¨‹</p>
<p>æˆ‘ä¼šæŠŠçº¿ç¨‹æ± çœ‹ä½œä¸€ä¸ªå·¥åŽ‚ï¼Œé‡Œé¢æœ‰ä¸€ç¾¤â€œå·¥äººâ€ï¼Œä¹Ÿå°±æ˜¯çº¿ç¨‹äº†ï¼Œä¸“é—¨ç”¨æ¥åšä»»åŠ¡ã€‚</p>
<p>å½“ä»»åŠ¡æ¥äº†ï¼Œéœ€è¦å…ˆåˆ¤æ–­æœ‰æ²¡æœ‰ç©ºé—²çš„å·¥äººï¼Œå¦‚æžœæœ‰å°±æŠŠä»»åŠ¡äº¤ç»™ä»–ä»¬ï¼›å¦‚æžœæ²¡æœ‰ï¼Œå°±æŠŠä»»åŠ¡æš‚å­˜åˆ°ä¸€ä¸ªä»»åŠ¡é˜Ÿåˆ—é‡Œï¼Œç­‰å·¥äººå¿™å®Œäº†å†åŽ»å¤„ç†ã€‚</p>
<p>å¦‚æžœé˜Ÿåˆ—æ»¡äº†ï¼Œè¿˜æ²¡æœ‰ç©ºé—²çš„å·¥äººï¼Œå°±è¦è€ƒè™‘æ‰©å®¹ï¼Œè®©é¢„å¤‡çš„å·¥äººè¿‡æ¥å¹²æ´»ï¼Œä½†ä¸èƒ½è¶…è¿‡é¢„å®šçš„æœ€å¤§å€¼ï¼Œé˜²æ­¢å·¥åŽ‚è¢«æŒ¤çˆ†ã€‚</p>
<p>å¦‚æžœè¿žæ‰©å®¹ä¹Ÿæ²¡æ³•è§£å†³ï¼Œå°±éœ€è¦ä¸€ä¸ªæ‹’ç»ç­–ç•¥ï¼Œå¯èƒ½ç›´æŽ¥æ‹’ç»ä»»åŠ¡æˆ–è€…æŠ¥ä¸ªé”™ã€‚</p>
<p>æ ¸å¿ƒçº¿ç¨‹æ± ç±»ï¼ˆå¯å‚è€ƒï¼‰ï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">CustomThreadPoolExecutor</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> <span class="type">int</span> corePoolSize;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> <span class="type">int</span> maximumPoolSize;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> <span class="type">long</span> keepAliveTime;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> TimeUnit unit;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> BlockingQueue&lt;Runnable&gt; workQueue;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> RejectedExecutionHandler handler;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">volatile</span> <span class="type">boolean</span> <span class="variable">isShutdown</span> <span class="operator">=</span> <span class="literal">false</span>;</span><br><span class="line">    <span class="keyword">private</span> <span class="type">int</span> <span class="variable">currentPoolSize</span> <span class="operator">=</span> <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// æž„é€ æ–¹æ³•</span></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">CustomThreadPoolExecutor</span><span class="params">(<span class="type">int</span> corePoolSize, <span class="type">int</span> maximumPoolSize, <span class="type">long</span> keepAliveTime, TimeUnit unit,</span></span><br><span class="line"><span class="params">                                    BlockingQueue&lt;Runnable&gt; workQueue, RejectedExecutionHandler handler)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.corePoolSize = corePoolSize;</span><br><span class="line">        <span class="built_in">this</span>.maximumPoolSize = maximumPoolSize;</span><br><span class="line">        <span class="built_in">this</span>.keepAliveTime = keepAliveTime;</span><br><span class="line">        <span class="built_in">this</span>.unit = unit;</span><br><span class="line">        <span class="built_in">this</span>.workQueue = workQueue;</span><br><span class="line">        <span class="built_in">this</span>.handler = handler;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// æäº¤ä»»åŠ¡</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">execute</span><span class="params">(Runnable task)</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> (isShutdown) &#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">IllegalStateException</span>(<span class="string">&quot;ThreadPool is shutdown&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">synchronized</span> (<span class="built_in">this</span>) &#123;</span><br><span class="line">            <span class="comment">// å¦‚æžœå½“å‰çº¿ç¨‹æ•°å°äºŽæ ¸å¿ƒçº¿ç¨‹æ•°ï¼Œç›´æŽ¥åˆ›å»ºæ–°çº¿ç¨‹</span></span><br><span class="line">            <span class="keyword">if</span> (currentPoolSize &lt; corePoolSize) &#123;</span><br><span class="line">                <span class="keyword">new</span> <span class="title class_">Worker</span>(task).start();</span><br><span class="line">                currentPoolSize++;</span><br><span class="line">                <span class="keyword">return</span>;</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            <span class="comment">// å°è¯•å°†ä»»åŠ¡æ·»åŠ åˆ°é˜Ÿåˆ—ä¸­</span></span><br><span class="line">            <span class="keyword">if</span> (!workQueue.offer(task)) &#123;</span><br><span class="line">                <span class="keyword">if</span> (currentPoolSize &lt; maximumPoolSize) &#123;</span><br><span class="line">                    <span class="keyword">new</span> <span class="title class_">Worker</span>(task).start();</span><br><span class="line">                    currentPoolSize++;</span><br><span class="line">                &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                    <span class="comment">// è°ƒç”¨æ‹’ç»ç­–ç•¥</span></span><br><span class="line">                    handler.rejectedExecution(task, <span class="literal">null</span>);</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// å…³é—­çº¿ç¨‹æ± </span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">shutdown</span><span class="params">()</span> &#123;</span><br><span class="line">        isShutdown = <span class="literal">true</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// å·¥ä½œçº¿ç¨‹</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">class</span> <span class="title class_">Worker</span> <span class="keyword">extends</span> <span class="title class_">Thread</span> &#123;</span><br><span class="line">        <span class="keyword">private</span> Runnable task;</span><br><span class="line"></span><br><span class="line">        Worker(Runnable task) &#123;</span><br><span class="line">            <span class="built_in">this</span>.task = task;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="meta">@Override</span></span><br><span class="line">        <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">run</span><span class="params">()</span> &#123;</span><br><span class="line">            <span class="keyword">while</span> (task != <span class="literal">null</span> || (task = getTask()) != <span class="literal">null</span>) &#123;</span><br><span class="line">                <span class="keyword">try</span> &#123;</span><br><span class="line">                    task.run();</span><br><span class="line">                &#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">                    task = <span class="literal">null</span>;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// ä»Žé˜Ÿåˆ—ä¸­èŽ·å–ä»»åŠ¡</span></span><br><span class="line">        <span class="keyword">private</span> Runnable <span class="title function_">getTask</span><span class="params">()</span> &#123;</span><br><span class="line">            <span class="keyword">try</span> &#123;</span><br><span class="line">                <span class="keyword">return</span> workQueue.poll(keepAliveTime, unit);</span><br><span class="line">            &#125; <span class="keyword">catch</span> (InterruptedException e) &#123;</span><br><span class="line">                <span class="keyword">return</span> <span class="literal">null</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>æ‹’ç»ç­–ç•¥ï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * æ‹’ç»ç­–ç•¥</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">CustomRejectedExecutionHandler</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// AbortPolicy æŠ›å‡ºå¼‚å¸¸</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">class</span> <span class="title class_">AbortPolicy</span> <span class="keyword">implements</span> <span class="title class_">RejectedExecutionHandler</span> &#123;</span><br><span class="line">        <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">rejectedExecution</span><span class="params">(Runnable r, ThreadPoolExecutor e)</span> &#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">RuntimeException</span>(<span class="string">&quot;Task &quot;</span> + r.toString() + <span class="string">&quot; rejected from &quot;</span> + e.toString());</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// DiscardPolicy ä»€ä¹ˆéƒ½ä¸åš</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">class</span> <span class="title class_">DiscardPolicy</span> <span class="keyword">implements</span> <span class="title class_">RejectedExecutionHandler</span> &#123;</span><br><span class="line">        <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">rejectedExecution</span><span class="params">(Runnable r, ThreadPoolExecutor e)</span> &#123;</span><br><span class="line">            <span class="comment">// Do nothing</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// DiscardOldestPolicy ä¸¢å¼ƒé˜Ÿåˆ—ä¸­æœ€æ—§çš„ä»»åŠ¡</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">class</span> <span class="title class_">CallerRunsPolicy</span> <span class="keyword">implements</span> <span class="title class_">RejectedExecutionHandler</span> &#123;</span><br><span class="line">        <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">rejectedExecution</span><span class="params">(Runnable r, ThreadPoolExecutor e)</span> &#123;</span><br><span class="line">            <span class="keyword">if</span> (!e.isShutdown()) &#123;</span><br><span class="line">                r.run();</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>ä½¿ç”¨ç¤ºä¾‹ï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">ThreadPoolTest</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        <span class="comment">// åˆ›å»ºçº¿ç¨‹æ± </span></span><br><span class="line">        <span class="type">CustomThreadPoolExecutor</span> <span class="variable">executor</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">CustomThreadPoolExecutor</span>(</span><br><span class="line">                <span class="number">2</span>, <span class="number">4</span>, <span class="number">10</span>, TimeUnit.SECONDS,</span><br><span class="line">                <span class="keyword">new</span> <span class="title class_">LinkedBlockingQueue</span>&lt;&gt;(<span class="number">2</span>),</span><br><span class="line">                <span class="keyword">new</span> <span class="title class_">CustomRejectedExecutionHandler</span>.AbortPolicy());</span><br><span class="line"></span><br><span class="line">        <span class="comment">// æäº¤ä»»åŠ¡</span></span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; <span class="number">10</span>; i++) &#123;</span><br><span class="line">            <span class="keyword">final</span> <span class="type">int</span> <span class="variable">index</span> <span class="operator">=</span> i;</span><br><span class="line">            executor.execute(() -&gt; &#123;</span><br><span class="line">                System.out.println(<span class="string">&quot;Task &quot;</span> + index + <span class="string">&quot; is running&quot;</span>);</span><br><span class="line">                <span class="keyword">try</span> &#123;</span><br><span class="line">                    Thread.sleep(<span class="number">2000</span>);</span><br><span class="line">                &#125; <span class="keyword">catch</span> (InterruptedException e) &#123;</span><br><span class="line">                    e.printStackTrace();</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// å…³é—­çº¿ç¨‹æ± </span></span><br><span class="line">        executor.shutdown();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>æ‰§è¡Œç»“æžœï¼š</p>
<p><img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="https://cdn.jsdelivr.net/gh/JakicDong/blog-assets@main/images/20251010111815.png" alt="20251010111815"><br>äºŒå“¥çš„ Java è¿›é˜¶ä¹‹è·¯ï¼šè‡ªå®šä¹‰çº¿ç¨‹æ± </p>
<h4 id="æ‰‹å†™ä¸€ä¸ªæ•°æ®åº“è¿žæŽ¥æ± ï¼Œå¯ä»¥å—ï¼Ÿ"><a href="#æ‰‹å†™ä¸€ä¸ªæ•°æ®åº“è¿žæŽ¥æ± ï¼Œå¯ä»¥å—ï¼Ÿ" class="headerlink" title="æ‰‹å†™ä¸€ä¸ªæ•°æ®åº“è¿žæŽ¥æ± ï¼Œå¯ä»¥å—ï¼Ÿ"></a>æ‰‹å†™ä¸€ä¸ªæ•°æ®åº“è¿žæŽ¥æ± ï¼Œå¯ä»¥å—ï¼Ÿ</h4><p>å¯ä»¥çš„ï¼Œæˆ‘çš„æ€è·¯æ˜¯è¿™æ ·çš„ï¼šæ•°æ®åº“è¿žæŽ¥æ± ä¸»è¦æ˜¯ä¸ºäº†é¿å…æ¯æ¬¡æ“ä½œæ•°æ®åº“æ—¶éƒ½åŽ»åˆ›å»ºè¿žæŽ¥ï¼Œå› ä¸ºé‚£æ ·å¾ˆæµªè´¹èµ„æºã€‚æ‰€ä»¥æˆ‘æ‰“ç®—åœ¨åˆå§‹åŒ–æ—¶é¢„å…ˆåˆ›å»ºå¥½å›ºå®šæ•°é‡çš„è¿žæŽ¥ï¼Œç„¶åŽæŠŠå®ƒä»¬æ”¾åˆ°ä¸€ä¸ªçº¿ç¨‹å®‰å…¨çš„å®¹å™¨é‡Œï¼ŒåŽç»­æœ‰è¯·æ±‚çš„æ—¶å€™å°±ä»Žé˜Ÿåˆ—é‡Œæ‹¿ï¼Œä½¿ç”¨å®ŒåŽå†å½’è¿˜åˆ°é˜Ÿåˆ—ä¸­ã€‚</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">SimpleConnectionPool</span> &#123;</span><br><span class="line">    <span class="comment">// é…ç½®</span></span><br><span class="line">    <span class="keyword">private</span> String jdbcUrl;</span><br><span class="line">    <span class="keyword">private</span> String username;</span><br><span class="line">    <span class="keyword">private</span> String password;</span><br><span class="line">    <span class="keyword">private</span> <span class="type">int</span> maxConnections;</span><br><span class="line">    <span class="keyword">private</span> BlockingQueue&lt;Connection&gt; connectionPool;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// æž„é€ æ–¹æ³•</span></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">SimpleConnectionPool</span><span class="params">(String jdbcUrl, String username, String password, <span class="type">int</span> maxConnections)</span> <span class="keyword">throws</span> SQLException &#123;</span><br><span class="line">        <span class="built_in">this</span>.jdbcUrl = jdbcUrl;</span><br><span class="line">        <span class="built_in">this</span>.username = username;</span><br><span class="line">        <span class="built_in">this</span>.password = password;</span><br><span class="line">        <span class="built_in">this</span>.maxConnections = maxConnections;</span><br><span class="line">        <span class="built_in">this</span>.connectionPool = <span class="keyword">new</span> <span class="title class_">LinkedBlockingQueue</span>&lt;&gt;(maxConnections);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// åˆå§‹åŒ–è¿žæŽ¥æ± </span></span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; maxConnections; i++) &#123;</span><br><span class="line">            connectionPool.add(createNewConnection());</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// åˆ›å»ºæ–°è¿žæŽ¥</span></span><br><span class="line">    <span class="keyword">private</span> Connection <span class="title function_">createNewConnection</span><span class="params">()</span> <span class="keyword">throws</span> SQLException &#123;</span><br><span class="line">        <span class="keyword">return</span> DriverManager.getConnection(jdbcUrl, username, password);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// èŽ·å–è¿žæŽ¥</span></span><br><span class="line">    <span class="keyword">public</span> Connection <span class="title function_">getConnection</span><span class="params">(<span class="type">long</span> timeout, TimeUnit unit)</span> <span class="keyword">throws</span> InterruptedException, SQLException &#123;</span><br><span class="line">        <span class="type">Connection</span> <span class="variable">connection</span> <span class="operator">=</span> connectionPool.poll(timeout, unit); <span class="comment">// ç­‰å¾…æŒ‡å®šæ—¶é—´èŽ·å–è¿žæŽ¥</span></span><br><span class="line">        <span class="keyword">if</span> (connection == <span class="literal">null</span>) &#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">SQLException</span>(<span class="string">&quot;Timeout: Unable to acquire a connection.&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> connection;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// å½’è¿˜è¿žæŽ¥</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">releaseConnection</span><span class="params">(Connection connection)</span> <span class="keyword">throws</span> SQLException &#123;</span><br><span class="line">        <span class="keyword">if</span> (connection != <span class="literal">null</span>) &#123;</span><br><span class="line">            <span class="keyword">if</span> (connection.isClosed()) &#123;</span><br><span class="line">                <span class="comment">// å¦‚æžœè¿žæŽ¥å·²å…³é—­ï¼Œåˆ›å»ºä¸€ä¸ªæ–°è¿žæŽ¥è¡¥å……åˆ°æ± ä¸­</span></span><br><span class="line">                connectionPool.add(createNewConnection());</span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                <span class="comment">// å°†è¿žæŽ¥å½’è¿˜åˆ°æ± ä¸­</span></span><br><span class="line">                connectionPool.offer(connection);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// å…³é—­æ‰€æœ‰è¿žæŽ¥</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">closeAllConnections</span><span class="params">()</span> <span class="keyword">throws</span> SQLException &#123;</span><br><span class="line">        <span class="keyword">for</span> (Connection connection : connectionPool) &#123;</span><br><span class="line">            <span class="keyword">if</span> (!connection.isClosed()) &#123;</span><br><span class="line">                connection.close();</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// æµ‹è¯•ç”¨ä¾‹</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="type">SimpleConnectionPool</span> <span class="variable">pool</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">SimpleConnectionPool</span>(</span><br><span class="line">                <span class="string">&quot;jdbc:mysql://localhost:3306/pai_coding&quot;</span>, <span class="string">&quot;root&quot;</span>, <span class="string">&quot;&quot;</span>, <span class="number">5</span></span><br><span class="line">            );</span><br><span class="line"></span><br><span class="line">            <span class="comment">// èŽ·å–è¿žæŽ¥</span></span><br><span class="line">            <span class="type">Connection</span> <span class="variable">conn</span> <span class="operator">=</span> pool.getConnection(<span class="number">5</span>, TimeUnit.SECONDS);</span><br><span class="line"></span><br><span class="line">            <span class="comment">// ä½¿ç”¨è¿žæŽ¥ï¼ˆç¤ºä¾‹æŸ¥è¯¢ï¼‰</span></span><br><span class="line">            System.out.println(<span class="string">&quot;Connection acquired: &quot;</span> + conn);</span><br><span class="line">            Thread.sleep(<span class="number">2000</span>); <span class="comment">// æ¨¡æ‹ŸæŸ¥è¯¢</span></span><br><span class="line"></span><br><span class="line">            <span class="comment">// å½’è¿˜è¿žæŽ¥</span></span><br><span class="line">            pool.releaseConnection(conn);</span><br><span class="line">            System.out.println(<span class="string">&quot;Connection returned.&quot;</span>);</span><br><span class="line"></span><br><span class="line">            <span class="comment">// å…³é—­æ‰€æœ‰è¿žæŽ¥</span></span><br><span class="line">            pool.closeAllConnections();</span><br><span class="line">        &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>è¿è¡Œç»“æžœï¼š</p>
<p><img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="https://cdn.jsdelivr.net/gh/JakicDong/blog-assets@main/images/20251010111849.png" alt="20251010111849"><br>äºŒå“¥çš„Java è¿›é˜¶ä¹‹è·¯ï¼šæ•°æ®åº“è¿žæŽ¥æ± </p>
<h2 id="JVM"><a href="#JVM" class="headerlink" title="JVM"></a>JVM</h2><h3 id="3-ðŸŒŸèƒ½è¯´ä¸€ä¸‹-JVM-çš„å†…å­˜åŒºåŸŸå—ï¼Ÿ"><a href="#3-ðŸŒŸèƒ½è¯´ä¸€ä¸‹-JVM-çš„å†…å­˜åŒºåŸŸå—ï¼Ÿ" class="headerlink" title="3.ðŸŒŸèƒ½è¯´ä¸€ä¸‹ JVM çš„å†…å­˜åŒºåŸŸå—ï¼Ÿ"></a>3.ðŸŒŸèƒ½è¯´ä¸€ä¸‹ JVM çš„å†…å­˜åŒºåŸŸå—ï¼Ÿ</h3><p>æŽ¨èé˜…è¯»ï¼š<a target="_blank" rel="noopener" href="https://javabetter.cn/jvm/neicun-jiegou.html">æ·±å…¥ç†è§£ JVM çš„è¿è¡Œæ—¶æ•°æ®åŒº</a></p>
<p>æŒ‰ç…§ Java è™šæ‹Ÿæœºè§„èŒƒï¼ŒJVM çš„å†…å­˜åŒºåŸŸå¯ä»¥ç»†åˆ†ä¸º<code>ç¨‹åºè®¡æ•°å™¨</code>ã€<code>è™šæ‹Ÿæœºæ ˆ</code>ã€<code>æœ¬åœ°æ–¹æ³•æ ˆ</code>ã€<code>å †</code>å’Œ<code>æ–¹æ³•åŒº</code>ã€‚</p>
<p><img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="https://cdn.jsdelivr.net/gh/JakicDong/blog-assets@main/images/20251010150406.png" alt="20251010150406"><br>ä¸‰åˆ†æ¶é¢æ¸£é€†è¢­ï¼šJavaè™šæ‹Ÿæœºè¿è¡Œæ—¶æ•°æ®åŒº</p>
<p>å…¶ä¸­<code>æ–¹æ³•åŒº</code>å’Œ<code>å †</code>æ˜¯çº¿ç¨‹å…±äº«çš„ï¼Œ<code>è™šæ‹Ÿæœºæ ˆ</code>ã€<code>æœ¬åœ°æ–¹æ³•æ ˆ</code>å’Œ<code>ç¨‹åºè®¡æ•°å™¨</code>æ˜¯çº¿ç¨‹ç§æœ‰çš„ã€‚</p>
<h4 id="ä»‹ç»ä¸€ä¸‹ç¨‹åºè®¡æ•°å™¨ï¼Ÿ"><a href="#ä»‹ç»ä¸€ä¸‹ç¨‹åºè®¡æ•°å™¨ï¼Ÿ" class="headerlink" title="ä»‹ç»ä¸€ä¸‹ç¨‹åºè®¡æ•°å™¨ï¼Ÿ"></a>ä»‹ç»ä¸€ä¸‹ç¨‹åºè®¡æ•°å™¨ï¼Ÿ</h4><p>ç¨‹åºè®¡æ•°å™¨ä¹Ÿè¢«ç§°ä¸º PC å¯„å­˜å™¨ï¼Œæ˜¯ä¸€å—è¾ƒå°çš„å†…å­˜ç©ºé—´ã€‚å®ƒå¯ä»¥çœ‹ä½œæ˜¯å½“å‰çº¿ç¨‹æ‰€æ‰§è¡Œçš„å­—èŠ‚ç è¡Œå·æŒ‡ç¤ºå™¨ã€‚</p>
<h4 id="ä»‹ç»ä¸€ä¸‹-Java-è™šæ‹Ÿæœºæ ˆï¼Ÿ"><a href="#ä»‹ç»ä¸€ä¸‹-Java-è™šæ‹Ÿæœºæ ˆï¼Ÿ" class="headerlink" title="ä»‹ç»ä¸€ä¸‹ Java è™šæ‹Ÿæœºæ ˆï¼Ÿ"></a>ä»‹ç»ä¸€ä¸‹ Java è™šæ‹Ÿæœºæ ˆï¼Ÿ</h4><p>Java è™šæ‹Ÿæœºæ ˆçš„ç”Ÿå‘½å‘¨æœŸä¸Žçº¿ç¨‹ç›¸åŒã€‚</p>
<p>å½“çº¿ç¨‹æ‰§è¡Œä¸€ä¸ªæ–¹æ³•æ—¶ï¼Œä¼šåˆ›å»ºä¸€ä¸ªå¯¹åº”çš„<a target="_blank" rel="noopener" href="https://javabetter.cn/jvm/stack-frame.html">æ ˆå¸§</a>ï¼Œç”¨äºŽå­˜å‚¨å±€éƒ¨å˜é‡è¡¨ã€æ“ä½œæ•°æ ˆã€åŠ¨æ€é“¾æŽ¥ã€æ–¹æ³•å‡ºå£ç­‰ä¿¡æ¯ï¼Œç„¶åŽæ ˆå¸§ä¼šè¢«åŽ‹å…¥è™šæ‹Ÿæœºæ ˆä¸­ã€‚å½“æ–¹æ³•æ‰§è¡Œå®Œæ¯•åŽï¼Œæ ˆå¸§ä¼šä»Žè™šæ‹Ÿæœºæ ˆä¸­ç§»é™¤ã€‚</p>
<p><img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="https://cdn.jsdelivr.net/gh/JakicDong/blog-assets@main/images/20251010150604.png" alt="20251010150604"><br>ä¸‰åˆ†æ¶é¢æ¸£é€†è¢­ï¼šJavaè™šæ‹Ÿæœºæ ˆ</p>
<h4 id="ä¸€ä¸ªä»€ä¹ˆéƒ½æ²¡æœ‰çš„ç©ºæ–¹æ³•ï¼Œç©ºçš„å‚æ•°éƒ½æ²¡æœ‰ï¼Œé‚£å±€éƒ¨å˜é‡è¡¨é‡Œæœ‰æ²¡æœ‰å˜é‡ï¼Ÿ"><a href="#ä¸€ä¸ªä»€ä¹ˆéƒ½æ²¡æœ‰çš„ç©ºæ–¹æ³•ï¼Œç©ºçš„å‚æ•°éƒ½æ²¡æœ‰ï¼Œé‚£å±€éƒ¨å˜é‡è¡¨é‡Œæœ‰æ²¡æœ‰å˜é‡ï¼Ÿ" class="headerlink" title="ä¸€ä¸ªä»€ä¹ˆéƒ½æ²¡æœ‰çš„ç©ºæ–¹æ³•ï¼Œç©ºçš„å‚æ•°éƒ½æ²¡æœ‰ï¼Œé‚£å±€éƒ¨å˜é‡è¡¨é‡Œæœ‰æ²¡æœ‰å˜é‡ï¼Ÿ"></a>ä¸€ä¸ªä»€ä¹ˆéƒ½æ²¡æœ‰çš„ç©ºæ–¹æ³•ï¼Œç©ºçš„å‚æ•°éƒ½æ²¡æœ‰ï¼Œé‚£å±€éƒ¨å˜é‡è¡¨é‡Œæœ‰æ²¡æœ‰å˜é‡ï¼Ÿ</h4><p>å¯¹äºŽ<a target="_blank" rel="noopener" href="https://javabetter.cn/oo/static.html">é™æ€æ–¹æ³•</a>ï¼Œç”±äºŽä¸éœ€è¦è®¿é—®å®žä¾‹å¯¹è±¡ thisï¼Œå› æ­¤åœ¨å±€éƒ¨å˜é‡è¡¨ä¸­ä¸ä¼šæœ‰ä»»ä½•å˜é‡ã€‚</p>
<p>å¯¹äºŽéžé™æ€æ–¹æ³•ï¼Œå³ä½¿æ˜¯ä¸€ä¸ªå®Œå…¨ç©ºçš„æ–¹æ³•ï¼Œå±€éƒ¨å˜é‡è¡¨ä¸­ä¹Ÿä¼šæœ‰ä¸€ä¸ªç”¨äºŽå­˜å‚¨ this å¼•ç”¨çš„å˜é‡ã€‚this å¼•ç”¨æŒ‡å‘å½“å‰å®žä¾‹å¯¹è±¡ï¼Œåœ¨æ–¹æ³•è°ƒç”¨æ—¶è¢«éšå¼ä¼ å…¥ã€‚</p>
<p>è¯¦ç»†è§£é‡Šä¸€ä¸‹ï¼š</p>
<p>æ¯”å¦‚è¯´æœ‰è¿™æ ·ä¸€æ®µä»£ç ï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">VarDemo1</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">emptyMethod</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="comment">// ä»€ä¹ˆéƒ½æ²¡æœ‰</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">staticEmptyMethod</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="comment">// ä»€ä¹ˆéƒ½æ²¡æœ‰</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>ç”¨ <code>javap -v VarDemo1</code> å‘½ä»¤æŸ¥çœ‹ç¼–è¯‘åŽçš„å­—èŠ‚ç ï¼Œå°±å¯ä»¥åœ¨ emptyMethod ä¸­çœ‹åˆ°è¿™æ ·çš„å†…å®¹ï¼š</p>
<p><img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="https://cdn.jsdelivr.net/gh/JakicDong/blog-assets@main/images/20251010150844.png" alt="20251010150844"><br>äºŒå“¥çš„ Java è¿›é˜¶ä¹‹è·¯ï¼šjavap emptyMethod</p>
<p>è¿™é‡Œçš„ <code>locals=1</code> è¡¨ç¤ºå±€éƒ¨å˜é‡è¡¨æœ‰ä¸€ä¸ªå˜é‡ï¼Œå³ thisï¼ŒSlot 0 ä½ç½®å­˜å‚¨äº† this å¼•ç”¨ã€‚</p>
<p>è€Œåœ¨é™æ€æ–¹æ³• staticEmptyMethod ä¸­ï¼Œä½ ä¼šçœ‹åˆ°è¿™æ ·çš„å†…å®¹ï¼š</p>
<p><img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="https://cdn.jsdelivr.net/gh/JakicDong/blog-assets@main/images/20251010150900.png" alt="20251010150900"><br>äºŒå“¥çš„ Java è¿›é˜¶ä¹‹è·¯ï¼šjavap staticEmptyMethod</p>
<p>è¿™é‡Œçš„ locals&#x3D;0 è¡¨ç¤ºå±€éƒ¨å˜é‡è¡¨ä¸ºç©ºï¼Œå› ä¸ºé™æ€æ–¹æ³•å±žäºŽç±»çº§åˆ«æ–¹æ³•ï¼Œä¸éœ€è¦ this å¼•ç”¨ï¼Œä¹Ÿå°±æ²¡æœ‰å±€éƒ¨å˜é‡ã€‚</p>
<h4 id="ä»‹ç»ä¸€ä¸‹æœ¬åœ°æ–¹æ³•æ ˆï¼Ÿ"><a href="#ä»‹ç»ä¸€ä¸‹æœ¬åœ°æ–¹æ³•æ ˆï¼Ÿ" class="headerlink" title="ä»‹ç»ä¸€ä¸‹æœ¬åœ°æ–¹æ³•æ ˆï¼Ÿ"></a>ä»‹ç»ä¸€ä¸‹æœ¬åœ°æ–¹æ³•æ ˆï¼Ÿ</h4><p>æœ¬åœ°æ–¹æ³•æ ˆä¸Žè™šæ‹Ÿæœºæ ˆç›¸ä¼¼ï¼ŒåŒºåˆ«åœ¨äºŽè™šæ‹Ÿæœºæ ˆæ˜¯ä¸º JVM æ‰§è¡Œ Java ç¼–å†™çš„æ–¹æ³•æœåŠ¡çš„ï¼Œè€Œæœ¬åœ°æ–¹æ³•æ ˆæ˜¯ä¸º Java è°ƒç”¨<a target="_blank" rel="noopener" href="https://javabetter.cn/oo/native-method.html">æœ¬åœ° native æ–¹æ³•</a>æœåŠ¡çš„ï¼Œé€šå¸¸ç”± C&#x2F;C++ ç¼–å†™ã€‚</p>
<p>åœ¨æœ¬åœ°æ–¹æ³•æ ˆä¸­ï¼Œä¸»è¦å­˜æ”¾äº† native æ–¹æ³•çš„å±€éƒ¨å˜é‡ã€åŠ¨æ€é“¾æŽ¥å’Œæ–¹æ³•å‡ºå£ç­‰ä¿¡æ¯ã€‚å½“ä¸€ä¸ª Java ç¨‹åºè°ƒç”¨ä¸€ä¸ª native æ–¹æ³•æ—¶ï¼ŒJVM ä¼šåˆ‡æ¢åˆ°æœ¬åœ°æ–¹æ³•æ ˆæ¥æ‰§è¡Œè¿™ä¸ªæ–¹æ³•ã€‚</p>
<h4 id="ä»‹ç»ä¸€ä¸‹æœ¬åœ°æ–¹æ³•æ ˆçš„è¿è¡Œåœºæ™¯ï¼Ÿ"><a href="#ä»‹ç»ä¸€ä¸‹æœ¬åœ°æ–¹æ³•æ ˆçš„è¿è¡Œåœºæ™¯ï¼Ÿ" class="headerlink" title="ä»‹ç»ä¸€ä¸‹æœ¬åœ°æ–¹æ³•æ ˆçš„è¿è¡Œåœºæ™¯ï¼Ÿ"></a>ä»‹ç»ä¸€ä¸‹æœ¬åœ°æ–¹æ³•æ ˆçš„è¿è¡Œåœºæ™¯ï¼Ÿ</h4><p>å½“ Java åº”ç”¨éœ€è¦ä¸Žæ“ä½œç³»ç»Ÿåº•å±‚æˆ–ç¡¬ä»¶äº¤äº’æ—¶ï¼Œé€šå¸¸ä¼šç”¨åˆ°æœ¬åœ°æ–¹æ³•æ ˆã€‚</p>
<p>æ¯”å¦‚è°ƒç”¨æ“ä½œç³»ç»Ÿçš„ç‰¹å®šåŠŸèƒ½ï¼Œå¦‚å†…å­˜ç®¡ç†ã€æ–‡ä»¶æ“ä½œã€ç³»ç»Ÿæ—¶é—´ã€ç³»ç»Ÿè°ƒç”¨ç­‰ã€‚</p>
<p>è¯¦ç»†è¯´æ˜Žä¸€ä¸‹ï¼š</p>
<p>æ¯”å¦‚è¯´èŽ·å–ç³»ç»Ÿæ—¶é—´çš„ <code>System.currentTimeMillis()</code> æ–¹æ³•å°±æ˜¯è°ƒç”¨æœ¬åœ°æ–¹æ³•ï¼Œæ¥èŽ·å–æ“ä½œç³»ç»Ÿå½“å‰æ—¶é—´çš„ã€‚</p>
<p><img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="https://cdn.jsdelivr.net/gh/JakicDong/blog-assets@main/images/20251010151152.png" alt="20251010151152"><br>äºŒå“¥çš„Java è¿›é˜¶ä¹‹è·¯ï¼šcurrentTimeMillisæ–¹æ³•æºç </p>
<p>å†æ¯”å¦‚ JVM è‡ªèº«çš„ä¸€äº›åº•å±‚åŠŸèƒ½ä¹Ÿéœ€è¦é€šè¿‡æœ¬åœ°æ–¹æ³•æ¥å®žçŽ°ã€‚åƒ Object ç±»ä¸­çš„ <code>hashCode()</code> æ–¹æ³•ã€<code>clone()</code> æ–¹æ³•ç­‰ã€‚</p>
<p><img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="https://cdn.jsdelivr.net/gh/JakicDong/blog-assets@main/images/20251010151210.png" alt="20251010151210"><br>äºŒå“¥çš„Java è¿›é˜¶ä¹‹è·¯ï¼šhashCodeæ–¹æ³•æºç </p>
<h4 id="native-æ–¹æ³•è§£é‡Šä¸€ä¸‹ï¼Ÿ"><a href="#native-æ–¹æ³•è§£é‡Šä¸€ä¸‹ï¼Ÿ" class="headerlink" title="native æ–¹æ³•è§£é‡Šä¸€ä¸‹ï¼Ÿ"></a>native æ–¹æ³•è§£é‡Šä¸€ä¸‹ï¼Ÿ</h4><p>æŽ¨èé˜…è¯»ï¼š<a target="_blank" rel="noopener" href="https://javabetter.cn/oo/native-method.html">æ‰‹æŠŠæ‰‹æ•™ä½ ç”¨ Cè¯­è¨€å®žçŽ° Java native æœ¬åœ°æ–¹æ³•</a></p>
<p>native æ–¹æ³•æ˜¯åœ¨ Java ä¸­é€šè¿‡ <a target="_blank" rel="noopener" href="https://javabetter.cn/basic-extra-meal/48-keywords.html">native å…³é”®å­—</a>å£°æ˜Žçš„ï¼Œç”¨äºŽè°ƒç”¨éž Java è¯­è¨€ï¼Œå¦‚ C&#x2F;C++ ç¼–å†™çš„ä»£ç ã€‚Java å¯ä»¥é€šè¿‡ JNIï¼Œä¹Ÿå°±æ˜¯ Java Native Interface ä¸Žåº•å±‚ç³»ç»Ÿã€ç¡¬ä»¶è®¾å¤‡ã€æˆ–è€…æœ¬åœ°åº“è¿›è¡Œäº¤äº’ã€‚</p>
<h4 id="ä»‹ç»ä¸€ä¸‹-Java-å †ï¼Ÿ"><a href="#ä»‹ç»ä¸€ä¸‹-Java-å †ï¼Ÿ" class="headerlink" title="ä»‹ç»ä¸€ä¸‹ Java å †ï¼Ÿ"></a>ä»‹ç»ä¸€ä¸‹ Java å †ï¼Ÿ</h4><p>å †æ˜¯ JVM ä¸­æœ€å¤§çš„ä¸€å—å†…å­˜åŒºåŸŸï¼Œè¢«æ‰€æœ‰çº¿ç¨‹å…±äº«ï¼Œåœ¨ JVM å¯åŠ¨æ—¶åˆ›å»ºï¼Œä¸»è¦ç”¨æ¥å­˜å‚¨ new å‡ºæ¥çš„å¯¹è±¡ã€‚</p>
<p><img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="https://cdn.jsdelivr.net/gh/JakicDong/blog-assets@main/images/20251010151832.png" alt="20251010151832"><br>äºŒå“¥çš„ Java è¿›é˜¶ä¹‹è·¯ï¼šå †</p>
<p>Java ä¸­â€œå‡ ä¹Žâ€æ‰€æœ‰çš„å¯¹è±¡éƒ½ä¼šåœ¨å †ä¸­åˆ†é…ï¼Œå †ä¹Ÿæ˜¯<a target="_blank" rel="noopener" href="https://javabetter.cn/jvm/gc-collector.html">åžƒåœ¾æ”¶é›†å™¨</a>ç®¡ç†çš„ç›®æ ‡åŒºåŸŸã€‚</p>
<p>ä»Žå†…å­˜å›žæ”¶çš„è§’åº¦æ¥çœ‹ï¼Œç”±äºŽåžƒåœ¾æ”¶é›†å™¨å¤§éƒ¨åˆ†éƒ½æ˜¯åŸºäºŽåˆ†ä»£æ”¶é›†ç†è®ºè®¾è®¡çš„ï¼Œæ‰€ä»¥å †åˆè¢«ç»†åˆ†ä¸º<code>æ–°ç”Ÿä»£</code>ã€<code>è€å¹´ä»£</code>ã€<code>Edenç©ºé—´</code>ã€<code>From Survivorç©ºé—´</code>ã€<code>To Survivorç©ºé—´</code>ç­‰ã€‚</p>
<p><img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="https://cdn.jsdelivr.net/gh/JakicDong/blog-assets@main/images/20251010151924.png" alt="20251010151924"><br>ä¸‰åˆ†æ¶é¢æ¸£é€†è¢­ï¼šJava å †å†…å­˜ç»“æž„</p>
<p>éšç€ <a target="_blank" rel="noopener" href="https://javabetter.cn/jvm/jit.html">JIT ç¼–è¯‘å™¨</a>çš„å‘å±•å’Œé€ƒé€¸æŠ€æœ¯çš„é€æ¸æˆç†Ÿï¼Œâ€œæ‰€æœ‰çš„å¯¹è±¡éƒ½ä¼šåˆ†é…åˆ°å †ä¸Šâ€å°±ä¸å†é‚£ä¹ˆç»å¯¹äº†ã€‚</p>
<p>ä»Ž JDK 7 å¼€å§‹ï¼ŒJVM é»˜è®¤å¼€å¯äº†é€ƒé€¸åˆ†æžï¼Œæ„å‘³ç€å¦‚æžœæŸäº›æ–¹æ³•ä¸­çš„å¯¹è±¡å¼•ç”¨æ²¡æœ‰è¢«è¿”å›žæˆ–è€…æ²¡æœ‰åœ¨æ–¹æ³•ä½“å¤–ä½¿ç”¨ï¼Œä¹Ÿå°±æ˜¯æœªé€ƒé€¸å‡ºåŽ»ï¼Œé‚£ä¹ˆå¯¹è±¡å¯ä»¥ç›´æŽ¥åœ¨æ ˆä¸Šåˆ†é…å†…å­˜ã€‚</p>
<h4 id="å †å’Œæ ˆçš„åŒºåˆ«æ˜¯ä»€ä¹ˆï¼Ÿ"><a href="#å †å’Œæ ˆçš„åŒºåˆ«æ˜¯ä»€ä¹ˆï¼Ÿ" class="headerlink" title="å †å’Œæ ˆçš„åŒºåˆ«æ˜¯ä»€ä¹ˆï¼Ÿ"></a>å †å’Œæ ˆçš„åŒºåˆ«æ˜¯ä»€ä¹ˆï¼Ÿ</h4><p>å †å±žäºŽçº¿ç¨‹å…±äº«çš„å†…å­˜åŒºåŸŸï¼Œå‡ ä¹Žæ‰€æœ‰ new å‡ºæ¥çš„å¯¹è±¡éƒ½ä¼šå †ä¸Šåˆ†é…ï¼Œç”Ÿå‘½å‘¨æœŸä¸ç”±å•ä¸ªæ–¹æ³•è°ƒç”¨æ‰€å†³å®šï¼Œå¯ä»¥åœ¨æ–¹æ³•è°ƒç”¨ç»“æŸåŽç»§ç»­å­˜åœ¨ï¼Œç›´åˆ°ä¸å†è¢«ä»»ä½•å˜é‡å¼•ç”¨ï¼Œæœ€åŽè¢«åžƒåœ¾æ”¶é›†å™¨å›žæ”¶ã€‚</p>
<p>æ ˆå±žäºŽçº¿ç¨‹ç§æœ‰çš„å†…å­˜åŒºåŸŸï¼Œä¸»è¦å­˜å‚¨å±€éƒ¨å˜é‡ã€æ–¹æ³•å‚æ•°ã€å¯¹è±¡å¼•ç”¨ç­‰ï¼Œé€šå¸¸éšç€æ–¹æ³•è°ƒç”¨çš„ç»“æŸè€Œè‡ªåŠ¨é‡Šæ”¾ï¼Œä¸éœ€è¦åžƒåœ¾æ”¶é›†å™¨å¤„ç†ã€‚</p>
<h4 id="ä»‹ç»ä¸€ä¸‹æ–¹æ³•åŒºï¼Ÿ"><a href="#ä»‹ç»ä¸€ä¸‹æ–¹æ³•åŒºï¼Ÿ" class="headerlink" title="ä»‹ç»ä¸€ä¸‹æ–¹æ³•åŒºï¼Ÿ"></a>ä»‹ç»ä¸€ä¸‹æ–¹æ³•åŒºï¼Ÿ</h4><p>æ–¹æ³•åŒºå¹¶ä¸çœŸå®žå­˜åœ¨ï¼Œå±žäºŽ Java è™šæ‹Ÿæœºè§„èŒƒä¸­çš„ä¸€ä¸ªé€»è¾‘æ¦‚å¿µï¼Œç”¨äºŽå­˜å‚¨å·²è¢« JVM åŠ è½½çš„ç±»ä¿¡æ¯ã€å¸¸é‡ã€é™æ€å˜é‡ã€å³æ—¶ç¼–è¯‘å™¨ç¼–è¯‘åŽçš„ä»£ç ç¼“å­˜ç­‰ã€‚</p>
<p>åœ¨ HotSpot è™šæ‹Ÿæœºä¸­ï¼Œæ–¹æ³•åŒºçš„å®žçŽ°ç§°ä¸ºæ°¸ä¹…ä»£ PermGenï¼Œä½†åœ¨ Java 8 åŠä¹‹åŽçš„ç‰ˆæœ¬ä¸­ï¼Œå·²ç»è¢«å…ƒç©ºé—´ Metaspace æ‰€æ›¿ä»£ã€‚</p>
<h4 id="å˜é‡å­˜åœ¨å †æ ˆçš„ä»€ä¹ˆä½ç½®ï¼Ÿ"><a href="#å˜é‡å­˜åœ¨å †æ ˆçš„ä»€ä¹ˆä½ç½®ï¼Ÿ" class="headerlink" title="å˜é‡å­˜åœ¨å †æ ˆçš„ä»€ä¹ˆä½ç½®ï¼Ÿ"></a>å˜é‡å­˜åœ¨å †æ ˆçš„ä»€ä¹ˆä½ç½®ï¼Ÿ</h4><p>å¯¹äºŽå±€éƒ¨å˜é‡ï¼Œå®ƒå­˜å‚¨åœ¨å½“å‰æ–¹æ³•æ ˆå¸§ä¸­çš„å±€éƒ¨å˜é‡è¡¨ä¸­ã€‚å½“æ–¹æ³•æ‰§è¡Œå®Œæ¯•ï¼Œæ ˆå¸§è¢«å›žæ”¶ï¼Œå±€éƒ¨å˜é‡ä¹Ÿä¼šè¢«é‡Šæ”¾ã€‚</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">method</span><span class="params">()</span> &#123;</span><br><span class="line">    <span class="type">int</span> <span class="variable">localVar</span> <span class="operator">=</span> <span class="number">100</span>;  <span class="comment">// å±€éƒ¨å˜é‡ï¼Œå­˜å‚¨åœ¨æ ˆå¸§ä¸­çš„å±€éƒ¨å˜é‡è¡¨é‡Œ</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>å¯¹äºŽé™æ€å˜é‡æ¥è¯´ï¼Œå®ƒå­˜å‚¨åœ¨ Java è™šæ‹Ÿæœºè§„èŒƒä¸­çš„æ–¹æ³•åŒºä¸­ï¼Œåœ¨ Java 7 ä¸­æ˜¯æ°¸ä¹…ä»£ï¼Œåœ¨ Java8 åŠä»¥åŽ æ˜¯å…ƒç©ºé—´ã€‚</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">StaticVarDemo</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="type">int</span> <span class="variable">staticVar</span> <span class="operator">=</span> <span class="number">100</span>;  <span class="comment">// é™æ€å˜é‡ï¼Œå­˜å‚¨åœ¨æ–¹æ³•åŒºä¸­</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>


<h3 id="6-ðŸŒŸå¯¹è±¡åˆ›å»ºçš„è¿‡ç¨‹äº†è§£å—ï¼Ÿ"><a href="#6-ðŸŒŸå¯¹è±¡åˆ›å»ºçš„è¿‡ç¨‹äº†è§£å—ï¼Ÿ" class="headerlink" title="6.ðŸŒŸå¯¹è±¡åˆ›å»ºçš„è¿‡ç¨‹äº†è§£å—ï¼Ÿ"></a>6.ðŸŒŸå¯¹è±¡åˆ›å»ºçš„è¿‡ç¨‹äº†è§£å—ï¼Ÿ</h3><p>å½“æˆ‘ä»¬ä½¿ç”¨ new å…³é”®å­—åˆ›å»ºä¸€ä¸ªå¯¹è±¡æ—¶ï¼ŒJVM é¦–å…ˆä¼šæ£€æŸ¥ new æŒ‡ä»¤çš„å‚æ•°æ˜¯å¦èƒ½åœ¨å¸¸é‡æ± ä¸­å®šä½åˆ°ç±»çš„ç¬¦å·å¼•ç”¨ï¼Œç„¶åŽæ£€æŸ¥è¿™ä¸ªç¬¦å·å¼•ç”¨ä»£è¡¨çš„ç±»æ˜¯å¦å·²è¢«åŠ è½½ã€è§£æžå’Œåˆå§‹åŒ–ã€‚å¦‚æžœæ²¡æœ‰ï¼Œå°±å…ˆæ‰§è¡Œç±»åŠ è½½ã€‚</p>
<p><img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="https://cdn.jsdelivr.net/gh/JakicDong/blog-assets@main/images/20251010153321.png" alt="20251010153321"><br>äºŒå“¥çš„ Java è¿›é˜¶ä¹‹è·¯ï¼šå¯¹è±¡çš„åˆ›å»ºè¿‡ç¨‹</p>
<p>å¦‚æžœå·²ç»åŠ è½½ï¼ŒJVM ä¼šä¸ºå¯¹è±¡åˆ†é…å†…å­˜å®Œæˆåˆå§‹åŒ–ï¼Œæ¯”å¦‚æ•°å€¼ç±»åž‹çš„æˆå‘˜å˜é‡åˆå§‹å€¼æ˜¯ 0ï¼Œå¸ƒå°”ç±»åž‹æ˜¯ falseï¼Œå¯¹è±¡ç±»åž‹æ˜¯ nullã€‚</p>
<p>æŽ¥ä¸‹æ¥ä¼šè®¾ç½®å¯¹è±¡å¤´ï¼Œé‡Œé¢åŒ…å«äº†å¯¹è±¡æ˜¯å“ªä¸ªç±»çš„å®žä¾‹ã€å¯¹è±¡çš„å“ˆå¸Œç ã€å¯¹è±¡çš„ GC åˆ†ä»£å¹´é¾„ç­‰ä¿¡æ¯ã€‚</p>
<p>æœ€åŽï¼ŒJVM ä¼šæ‰§è¡Œæž„é€ æ–¹æ³• <code>&lt;init&gt;</code> å®Œæˆèµ‹å€¼æ“ä½œï¼Œå°†æˆå‘˜å˜é‡èµ‹å€¼ä¸ºé¢„æœŸçš„å€¼ï¼Œæ¯”å¦‚ <code>int age = 18</code>ï¼Œè¿™æ ·ä¸€ä¸ªå¯¹è±¡å°±åˆ›å»ºå®Œæˆäº†ã€‚</p>
<h4 id="å¯¹è±¡çš„é”€æ¯è¿‡ç¨‹äº†è§£å—ï¼Ÿ"><a href="#å¯¹è±¡çš„é”€æ¯è¿‡ç¨‹äº†è§£å—ï¼Ÿ" class="headerlink" title="å¯¹è±¡çš„é”€æ¯è¿‡ç¨‹äº†è§£å—ï¼Ÿ"></a>å¯¹è±¡çš„é”€æ¯è¿‡ç¨‹äº†è§£å—ï¼Ÿ</h4><p>å½“å¯¹è±¡ä¸å†è¢«ä»»ä½•å¼•ç”¨æŒ‡å‘æ—¶ï¼Œå°±ä¼šå˜æˆåžƒåœ¾ã€‚åžƒåœ¾æ”¶é›†å™¨ä¼šé€šè¿‡å¯è¾¾æ€§åˆ†æžç®—æ³•åˆ¤æ–­å¯¹è±¡æ˜¯å¦å­˜æ´»ï¼Œå¦‚æžœå¯¹è±¡ä¸å¯è¾¾ï¼Œå°±ä¼šè¢«å›žæ”¶ã€‚</p>
<p>åžƒåœ¾æ”¶é›†å™¨é€šè¿‡æ ‡è®°æ¸…é™¤ã€æ ‡è®°å¤åˆ¶ã€æ ‡è®°æ•´ç†ç­‰ç®—æ³•æ¥å›žæ”¶å†…å­˜ï¼Œå°†å¯¹è±¡å ç”¨çš„å†…å­˜ç©ºé—´é‡Šæ”¾å‡ºæ¥ã€‚</p>
<p>å¯ä»¥é€šè¿‡ <code>java -XX:+PrintCommandLineFlags -version</code> å’Œ <code>java -XX:+PrintGCDetails -version</code> å‘½ä»¤æŸ¥çœ‹ JVM çš„ GC æ”¶é›†å™¨ã€‚</p>
<p><img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="https://cdn.jsdelivr.net/gh/JakicDong/blog-assets@main/images/20251010153455.png" alt="20251010153455"><br>äºŒå“¥çš„ Java è¿›é˜¶ä¹‹è·¯ï¼šJVM ä½¿ç”¨çš„åžƒåœ¾æ”¶é›†å™¨</p>
<p>å¯ä»¥çœ‹åˆ°ï¼Œæˆ‘æœ¬æœºå®‰è£…çš„ JDK 8 é»˜è®¤ä½¿ç”¨çš„æ˜¯ <code>Parallel Scavenge + Parallel Old</code>ã€‚</p>
<p>ä¸åŒå‚æ•°ä»£è¡¨å¯¹åº”çš„åžƒåœ¾æ”¶é›†å™¨è¡¨å•ï¼š</p>
<table>
<thead>
<tr>
<th>æ–°ç”Ÿä»£</th>
<th>è€å¹´ä»£</th>
<th>JVMå‚æ•°</th>
</tr>
</thead>
<tbody><tr>
<td>Serial</td>
<td>Serial</td>
<td>-XX:+UseSerialGC</td>
</tr>
<tr>
<td>Parallel Scavenge</td>
<td>Serial</td>
<td>-XX:+UseParallelGC -XX:-UseParallelOldGC</td>
</tr>
<tr>
<td>Parallel Scavenge</td>
<td>Parallel Old</td>
<td>-XX:+UseParallelGC -XX:+UseParallelOldGC</td>
</tr>
<tr>
<td>Parallel New</td>
<td>CMS</td>
<td>-XX:+UseParNewGC -XX:+UseConcMarkSweepGC</td>
</tr>
<tr>
<td>G1</td>
<td></td>
<td>-XX:+UseG1GC</td>
</tr>
</tbody></table>
<h3 id="14-ðŸŒŸå¯¹è±¡ä»€ä¹ˆæ—¶å€™ä¼šè¿›å…¥è€å¹´ä»£ï¼Ÿ"><a href="#14-ðŸŒŸå¯¹è±¡ä»€ä¹ˆæ—¶å€™ä¼šè¿›å…¥è€å¹´ä»£ï¼Ÿ" class="headerlink" title="14.ðŸŒŸå¯¹è±¡ä»€ä¹ˆæ—¶å€™ä¼šè¿›å…¥è€å¹´ä»£ï¼Ÿ"></a>14.ðŸŒŸå¯¹è±¡ä»€ä¹ˆæ—¶å€™ä¼šè¿›å…¥è€å¹´ä»£ï¼Ÿ</h3><p>å¯¹è±¡é€šå¸¸ä¼šåœ¨å¹´è½»ä»£ä¸­åˆ†é…ï¼Œéšç€æ—¶é—´çš„æŽ¨ç§»å’Œåžƒåœ¾æ”¶é›†çš„è¿›ç¨‹ï¼ŒæŸäº›æ»¡è¶³æ¡ä»¶çš„å¯¹è±¡ä¼šè¿›å…¥åˆ°è€å¹´ä»£ä¸­ï¼Œå¦‚é•¿æœŸå­˜æ´»çš„å¯¹è±¡ã€‚</p>
<p><img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="https://cdn.jsdelivr.net/gh/JakicDong/blog-assets@main/images/20251010162108.png" alt="20251010162108"><br>äºŒå“¥çš„ Java è¿›é˜¶ä¹‹è·¯ï¼šå¯¹è±¡è¿›å…¥è€å¹´ä»£</p>
<h4 id="é•¿æœŸå­˜æ´»çš„å¯¹è±¡å¦‚ä½•åˆ¤æ–­ï¼Ÿ"><a href="#é•¿æœŸå­˜æ´»çš„å¯¹è±¡å¦‚ä½•åˆ¤æ–­ï¼Ÿ" class="headerlink" title="é•¿æœŸå­˜æ´»çš„å¯¹è±¡å¦‚ä½•åˆ¤æ–­ï¼Ÿ"></a>é•¿æœŸå­˜æ´»çš„å¯¹è±¡å¦‚ä½•åˆ¤æ–­ï¼Ÿ</h4><p>JVM ä¼šä¸ºå¯¹è±¡ç»´æŠ¤ä¸€ä¸ªâ€œå¹´é¾„â€è®¡æ•°å™¨ï¼Œè®°å½•å¯¹è±¡åœ¨æ–°ç”Ÿä»£ä¸­ç»åŽ† Minor GC çš„æ¬¡æ•°ã€‚æ¯æ¬¡ GC æœªè¢«å›žæ”¶çš„å¯¹è±¡ï¼Œå…¶å¹´é¾„ä¼šåŠ  1ã€‚</p>
<p>å½“è¶…è¿‡ä¸€ä¸ªç‰¹å®šé˜ˆå€¼ï¼Œé»˜è®¤å€¼æ˜¯ 15ï¼Œå°±ä¼šè¢«è®¤ä¸ºè€å¯¹è±¡äº†ï¼Œéœ€è¦é‡ç‚¹å…³ç…§ã€‚è¿™ä¸ªå¹´é¾„é˜ˆå€¼å¯ä»¥é€šè¿‡ JVM å‚æ•°<code>-XX:MaxTenuringThreshold</code>æ¥è®¾ç½®ã€‚</p>
<p>å¯ä»¥é€šè¿‡ <code>jinfo -flag MaxTenuringThreshold $(jps | grep -i nacos | awk &#39;&#123;print $1&#125;&#39;)</code> æ¥æŸ¥çœ‹å½“å‰ JVM çš„å¹´é¾„é˜ˆå€¼ã€‚</p>
<p><img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="https://cdn.jsdelivr.net/gh/JakicDong/blog-assets@main/images/20251010162712.png" alt="20251010162712"><br>äºŒå“¥çš„ Java è¿›é˜¶ä¹‹è·¯ï¼šå¹´é¾„é˜ˆå€¼</p>
<ol>
<li>å¦‚æžœåº”ç”¨ä¸­çš„å¯¹è±¡å­˜æ´»æ—¶é—´è¾ƒçŸ­ï¼Œå¯ä»¥é€‚å½“è°ƒå¤§è¿™ä¸ªå€¼ï¼Œè®©å¯¹è±¡åœ¨æ–°ç”Ÿä»£å¤šå¾…ä¸€ä¼šå„¿</li>
<li>å¦‚æžœå¯¹è±¡å­˜æ´»æ—¶é—´è¾ƒé•¿ï¼Œå¯ä»¥é€‚å½“è°ƒå°è¿™ä¸ªå€¼ï¼Œè®©å¯¹è±¡æ›´å¿«è¿›å…¥è€å¹´ä»£ï¼Œå‡å°‘åœ¨æ–°ç”Ÿä»£çš„å¤åˆ¶æ¬¡æ•°</li>
</ol>
<h4 id="å¤§å¯¹è±¡å¦‚ä½•åˆ¤æ–­ï¼Ÿ"><a href="#å¤§å¯¹è±¡å¦‚ä½•åˆ¤æ–­ï¼Ÿ" class="headerlink" title="å¤§å¯¹è±¡å¦‚ä½•åˆ¤æ–­ï¼Ÿ"></a>å¤§å¯¹è±¡å¦‚ä½•åˆ¤æ–­ï¼Ÿ</h4><p>å¤§å¯¹è±¡æ˜¯æŒ‡å ç”¨å†…å­˜è¾ƒå¤§çš„å¯¹è±¡ï¼Œå¦‚å¤§æ•°ç»„ã€é•¿å­—ç¬¦ä¸²ç­‰ã€‚</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">int</span>[] array = <span class="keyword">new</span> <span class="title class_">int</span>[<span class="number">1000000</span>];</span><br><span class="line"><span class="type">String</span> <span class="variable">str</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">String</span>(<span class="keyword">new</span> <span class="title class_">char</span>[<span class="number">1000000</span>]);</span><br></pre></td></tr></table></figure>

<p>å…¶å¤§å°ç”± JVM å‚æ•° <code>-XX:PretenureSizeThreshold</code> æŽ§åˆ¶ï¼Œä½†åœ¨ JDK 8 ä¸­ï¼Œé»˜è®¤å€¼ä¸º 0ï¼Œä¹Ÿå°±æ˜¯è¯´é»˜è®¤æƒ…å†µä¸‹ï¼Œå¯¹è±¡ä»…æ ¹æ® GC å­˜æ´»çš„æ¬¡æ•°æ¥åˆ¤æ–­æ˜¯å¦è¿›å…¥è€å¹´ä»£ã€‚</p>
<p><img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="https://cdn.jsdelivr.net/gh/JakicDong/blog-assets@main/images/20251010162802.png" alt="20251010162802"><br>äºŒå“¥çš„ Java è¿›é˜¶ä¹‹è·¯ï¼šPretenureSizeThreshold</p>
<p>G1 åžƒåœ¾æ”¶é›†å™¨ä¸­ï¼Œå¤§å¯¹è±¡ä¼šç›´æŽ¥åˆ†é…åˆ° HUMONGOUS åŒºåŸŸã€‚å½“å¯¹è±¡å¤§å°è¶…è¿‡ä¸€ä¸ª Region å®¹é‡çš„ 50% æ—¶ï¼Œä¼šè¢«è®¤ä¸ºæ˜¯å¤§å¯¹è±¡ã€‚</p>
<p><img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="https://cdn.jsdelivr.net/gh/JakicDong/blog-assets@main/images/20251010162812.png" alt="20251010162812"><br>æœ‰æ¢¦æƒ³çš„è‚¥å®…ï¼šG1</p>
<p>Region çš„å¤§å°å¯ä»¥é€šè¿‡ JVM å‚æ•° <code>-XX:G1HeapRegionSize</code> æ¥è®¾ç½®ï¼Œé»˜è®¤æƒ…å†µä¸‹ä»Ž 1MB åˆ° 32MB ä¸ç­‰ï¼Œä¼šæ ¹æ®å †å†…å­˜å¤§å°åŠ¨æ€è°ƒæ•´ã€‚</p>
<p>å¯ä»¥é€šè¿‡ <code>java -XX:+UseG1GC -XX:+PrintGCDetails -version</code> æŸ¥çœ‹ G1 åžƒåœ¾æ”¶é›†å™¨çš„ç›¸å…³ä¿¡æ¯ã€‚</p>
<p><img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="https://cdn.jsdelivr.net/gh/JakicDong/blog-assets@main/images/20251010162907.png" alt="20251010162907"><br>äºŒå“¥çš„ Java è¿›é˜¶ä¹‹è·¯ï¼šUseG1GC</p>
<p>ä»Žç»“æžœä¸Šæ¥çœ‹ï¼Œæˆ‘æœ¬æœºä¸Š G1 çš„å †å¤§å°ä¸º 2GBï¼ŒRegion çš„å¤§å°ä¸º 4MBã€‚</p>
<h4 id="åŠ¨æ€å¹´é¾„åˆ¤å®šäº†è§£å—ï¼Ÿ"><a href="#åŠ¨æ€å¹´é¾„åˆ¤å®šäº†è§£å—ï¼Ÿ" class="headerlink" title="åŠ¨æ€å¹´é¾„åˆ¤å®šäº†è§£å—ï¼Ÿ"></a>åŠ¨æ€å¹´é¾„åˆ¤å®šäº†è§£å—ï¼Ÿ</h4><p>å¦‚æžœ Survivor åŒºä¸­æ‰€æœ‰å¯¹è±¡çš„æ€»å¤§å°è¶…è¿‡äº†ä¸€å®šæ¯”ä¾‹ï¼Œé€šå¸¸æ˜¯ Survivor åŒºçš„ä¸€åŠï¼Œé‚£ä¹ˆå¹´é¾„è¾ƒå°çš„å¯¹è±¡ä¹Ÿå¯èƒ½ä¼šè¢«æå‰æ™‹å‡åˆ°è€å¹´ä»£ã€‚</p>
<p>è¿™æ˜¯å› ä¸ºå¦‚æžœå¹´é¾„è¾ƒå°çš„å¯¹è±¡åœ¨ Survivor åŒºä¸­å ç”¨äº†è¾ƒå¤§çš„ç©ºé—´ï¼Œä¼šå¯¼è‡´ Survivor åŒºä¸­çš„å¯¹è±¡å¤åˆ¶æ¬¡æ•°å¢žå¤šï¼Œå½±å“åžƒåœ¾å›žæ”¶çš„æ•ˆçŽ‡ã€‚</p>
<h3 id="23-ðŸŒŸè®²è®²-JVM-çš„åžƒåœ¾å›žæ”¶æœºåˆ¶ï¼ˆè¡¥å……ï¼‰"><a href="#23-ðŸŒŸè®²è®²-JVM-çš„åžƒåœ¾å›žæ”¶æœºåˆ¶ï¼ˆè¡¥å……ï¼‰" class="headerlink" title="23.ðŸŒŸè®²è®² JVM çš„åžƒåœ¾å›žæ”¶æœºåˆ¶ï¼ˆè¡¥å……ï¼‰"></a>23.ðŸŒŸè®²è®² JVM çš„åžƒåœ¾å›žæ”¶æœºåˆ¶ï¼ˆè¡¥å……ï¼‰</h3><blockquote>
<p>æœ¬é¢˜æ˜¯å¢žè¡¥çš„å†…å®¹ å‚ç…§ï¼š<a target="_blank" rel="noopener" href="https://javabetter.cn/jvm/gc.html">æ·±å…¥ç†è§£ JVM çš„åžƒåœ¾å›žæ”¶æœºåˆ¶</a></p>
</blockquote>
<p>åžƒåœ¾å›žæ”¶å°±æ˜¯å¯¹å†…å­˜å †ä¸­å·²ç»æ­»äº¡çš„æˆ–è€…é•¿æ—¶é—´æ²¡æœ‰ä½¿ç”¨çš„å¯¹è±¡è¿›è¡Œæ¸…é™¤æˆ–å›žæ”¶ã€‚</p>
<p>JVM åœ¨åš GC ä¹‹å‰ï¼Œä¼šå…ˆæžæ¸…æ¥šä»€ä¹ˆæ˜¯åžƒåœ¾ï¼Œä»€ä¹ˆä¸æ˜¯åžƒåœ¾ï¼Œé€šå¸¸ä¼šé€šè¿‡å¯è¾¾æ€§åˆ†æžç®—æ³•æ¥åˆ¤æ–­å¯¹è±¡æ˜¯å¦å­˜æ´»ã€‚</p>
<p><img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="https://cdn.jsdelivr.net/gh/JakicDong/blog-assets@main/images/20251011095331.png" alt="20251011095331"><br>äºŒå“¥çš„ Java è¿›é˜¶ä¹‹è·¯ï¼šå¯è¾¾æ€§åˆ†æž</p>
<p>åœ¨ç¡®å®šäº†å“ªäº›åžƒåœ¾å¯ä»¥è¢«å›žæ”¶åŽï¼Œåžƒåœ¾æ”¶é›†å™¨ï¼ˆå¦‚ CMSã€G1ã€ZGCï¼‰è¦åšçš„äº‹æƒ…å°±æ˜¯è¿›è¡Œåžƒåœ¾å›žæ”¶ï¼Œå¯ä»¥é‡‡ç”¨æ ‡è®°æ¸…é™¤ç®—æ³•ã€å¤åˆ¶ç®—æ³•ã€æ ‡è®°æ•´ç†ç®—æ³•ã€åˆ†ä»£æ”¶é›†ç®—æ³•ç­‰ã€‚</p>
<p><a target="_blank" rel="noopener" href="https://javabetter.cn/zhishixingqiu/paicoding.html">æŠ€æœ¯æ´¾</a>é¡¹ç›®ä½¿ç”¨çš„ JDK 8ï¼Œé‡‡ç”¨çš„æ˜¯ CMS åžƒåœ¾æ”¶é›†å™¨ã€‚</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">java -XX:+UseConcMarkSweepGC \</span><br><span class="line">     -XX:+UseParNewGC \</span><br><span class="line">     -XX:CMSInitiatingOccupancyFraction=<span class="number">75</span> \</span><br><span class="line">     -XX:+UseCMSInitiatingOccupancyOnly \</span><br><span class="line">     -jar your-application.jar</span><br></pre></td></tr></table></figure>

<h4 id="åžƒåœ¾å›žæ”¶çš„è¿‡ç¨‹æ˜¯ä»€ä¹ˆï¼Ÿ"><a href="#åžƒåœ¾å›žæ”¶çš„è¿‡ç¨‹æ˜¯ä»€ä¹ˆï¼Ÿ" class="headerlink" title="åžƒåœ¾å›žæ”¶çš„è¿‡ç¨‹æ˜¯ä»€ä¹ˆï¼Ÿ"></a>åžƒåœ¾å›žæ”¶çš„è¿‡ç¨‹æ˜¯ä»€ä¹ˆï¼Ÿ</h4><p>Java çš„åžƒåœ¾å›žæ”¶è¿‡ç¨‹ä¸»è¦åˆ†ä¸ºæ ‡è®°å­˜æ´»å¯¹è±¡ã€æ¸…é™¤æ— ç”¨å¯¹è±¡ã€ä»¥åŠå†…å­˜åŽ‹ç¼©&#x2F;æ•´ç†ä¸‰ä¸ªé˜¶æ®µã€‚ä¸åŒçš„åžƒåœ¾å›žæ”¶å™¨åœ¨æ‰§è¡Œè¿™äº›æ­¥éª¤æ—¶ä¼šé‡‡ç”¨ä¸åŒçš„ç­–ç•¥å’Œç®—æ³•ã€‚</p>
<h3 id="24-ðŸŒŸå¦‚ä½•åˆ¤æ–­å¯¹è±¡ä»ç„¶å­˜æ´»ï¼Ÿ"><a href="#24-ðŸŒŸå¦‚ä½•åˆ¤æ–­å¯¹è±¡ä»ç„¶å­˜æ´»ï¼Ÿ" class="headerlink" title="24.ðŸŒŸå¦‚ä½•åˆ¤æ–­å¯¹è±¡ä»ç„¶å­˜æ´»ï¼Ÿ"></a>24.ðŸŒŸå¦‚ä½•åˆ¤æ–­å¯¹è±¡ä»ç„¶å­˜æ´»ï¼Ÿ</h3><p>Java é€šè¿‡å¯è¾¾æ€§åˆ†æžç®—æ³•æ¥åˆ¤æ–­ä¸€ä¸ªå¯¹è±¡æ˜¯å¦è¿˜å­˜æ´»ã€‚</p>
<p>é€šè¿‡ä¸€ç»„åä¸º â€œGC Rootsâ€ çš„æ ¹å¯¹è±¡ï¼Œè¿›è¡Œé€’å½’æ‰«æï¼Œæ— æ³•ä»Žæ ¹å¯¹è±¡åˆ°è¾¾çš„å¯¹è±¡å°±æ˜¯â€œåžƒåœ¾â€ï¼Œå¯ä»¥è¢«å›žæ”¶ã€‚</p>
<p><img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="https://cdn.jsdelivr.net/gh/JakicDong/blog-assets@main/images/20251011095524.png" alt="20251011095524"><br>ä¸‰åˆ†æ¶é¢æ¸£é€†è¢­ï¼šGC Root</p>
<p>è¿™ä¹Ÿæ˜¯ G1ã€CMS ç­‰ä¸»æµåžƒåœ¾æ”¶é›†å™¨ä½¿ç”¨çš„ä¸»è¦ç®—æ³•ã€‚</p>
<h4 id="ä»€ä¹ˆæ˜¯å¼•ç”¨è®¡æ•°æ³•ï¼Ÿ"><a href="#ä»€ä¹ˆæ˜¯å¼•ç”¨è®¡æ•°æ³•ï¼Ÿ" class="headerlink" title="ä»€ä¹ˆæ˜¯å¼•ç”¨è®¡æ•°æ³•ï¼Ÿ"></a>ä»€ä¹ˆæ˜¯å¼•ç”¨è®¡æ•°æ³•ï¼Ÿ</h4><p>æ¯ä¸ªå¯¹è±¡æœ‰ä¸€ä¸ªå¼•ç”¨è®¡æ•°å™¨ï¼Œè®°å½•å¼•ç”¨å®ƒçš„æ¬¡æ•°ã€‚å½“è®¡æ•°å™¨ä¸ºé›¶æ—¶ï¼Œå¯¹è±¡å¯ä»¥è¢«å›žæ”¶ã€‚</p>
<p><img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="https://cdn.jsdelivr.net/gh/JakicDong/blog-assets@main/images/20251011095558.png" alt="20251011095558"><br>ä¸‰åˆ†æ¶é¢æ¸£é€†è¢­ï¼šå¼•ç”¨è®¡æ•°æ³•</p>
<p>å¼•ç”¨è®¡æ•°æ³•æ— æ³•è§£å†³å¾ªçŽ¯å¼•ç”¨çš„é—®é¢˜ã€‚ä¾‹å¦‚ï¼Œä¸¤ä¸ªå¯¹è±¡äº’ç›¸å¼•ç”¨ï¼Œä½†ä¸å†è¢«å…¶ä»–å¯¹è±¡å¼•ç”¨ï¼Œå®ƒä»¬çš„å¼•ç”¨è®¡æ•°éƒ½ä¸ä¸ºé›¶ï¼Œå› æ­¤ä¸ä¼šè¢«å›žæ”¶ã€‚</p>
<h4 id="åšå¯è¾¾æ€§åˆ†æžçš„æ—¶å€™ï¼Œåº”è¯¥æœ‰å“ªäº›å‰ç½®æ€§çš„æ“ä½œï¼Ÿ"><a href="#åšå¯è¾¾æ€§åˆ†æžçš„æ—¶å€™ï¼Œåº”è¯¥æœ‰å“ªäº›å‰ç½®æ€§çš„æ“ä½œï¼Ÿ" class="headerlink" title="åšå¯è¾¾æ€§åˆ†æžçš„æ—¶å€™ï¼Œåº”è¯¥æœ‰å“ªäº›å‰ç½®æ€§çš„æ“ä½œï¼Ÿ"></a>åšå¯è¾¾æ€§åˆ†æžçš„æ—¶å€™ï¼Œåº”è¯¥æœ‰å“ªäº›å‰ç½®æ€§çš„æ“ä½œï¼Ÿ</h4><p>åœ¨è¿›è¡Œåžƒåœ¾å›žæ”¶ä¹‹å‰ï¼ŒJVM ä¼šæš‚åœæ‰€æœ‰æ­£åœ¨æ‰§è¡Œçš„åº”ç”¨çº¿ç¨‹ã€‚</p>
<p>è¿™æ˜¯å› ä¸ºå¯è¾¾æ€§åˆ†æžè¿‡ç¨‹å¿…é¡»ç¡®ä¿åœ¨æ‰§è¡Œåˆ†æžæ—¶ï¼Œå†…å­˜ä¸­çš„å¯¹è±¡å…³ç³»ä¸ä¼šè¢«åº”ç”¨çº¿ç¨‹ä¿®æ”¹ã€‚å¦‚æžœä¸æš‚åœåº”ç”¨çº¿ç¨‹ï¼Œå¯èƒ½ä¼šå‡ºçŽ°å¯¹è±¡å¼•ç”¨çš„æ”¹å˜ï¼Œå¯¼è‡´åžƒåœ¾å›žæ”¶è¿‡ç¨‹ä¸­åˆ¤æ–­å¯¹è±¡æ˜¯å¦å¯è¾¾çš„ç»“æžœä¸ä¸€è‡´ï¼Œä»Žè€Œå¼•å‘ä¸¥é‡çš„å†…å­˜é”™è¯¯æˆ–æ•°æ®ä¸¢å¤±ã€‚</p>
<h3 id="27-ðŸŒŸåžƒåœ¾æ”¶é›†ç®—æ³•äº†è§£å—ï¼Ÿ"><a href="#27-ðŸŒŸåžƒåœ¾æ”¶é›†ç®—æ³•äº†è§£å—ï¼Ÿ" class="headerlink" title="27.ðŸŒŸåžƒåœ¾æ”¶é›†ç®—æ³•äº†è§£å—ï¼Ÿ"></a>27.ðŸŒŸåžƒåœ¾æ”¶é›†ç®—æ³•äº†è§£å—ï¼Ÿ</h3><p>åžƒåœ¾æ”¶é›†ç®—æ³•ä¸»è¦æœ‰ä¸‰ç§ï¼Œåˆ†åˆ«æ˜¯æ ‡è®°-æ¸…é™¤ç®—æ³•ã€æ ‡è®°-å¤åˆ¶ç®—æ³•å’Œæ ‡è®°-æ•´ç†ç®—æ³•ã€‚</p>
<h4 id="è¯´è¯´æ ‡è®°-æ¸…é™¤ç®—æ³•ï¼Ÿ"><a href="#è¯´è¯´æ ‡è®°-æ¸…é™¤ç®—æ³•ï¼Ÿ" class="headerlink" title="è¯´è¯´æ ‡è®°-æ¸…é™¤ç®—æ³•ï¼Ÿ"></a>è¯´è¯´æ ‡è®°-æ¸…é™¤ç®—æ³•ï¼Ÿ</h4><p><code>æ ‡è®°-æ¸…é™¤</code>ç®—æ³•åˆ†ä¸ºä¸¤ä¸ªé˜¶æ®µï¼š</p>
<ul>
<li><strong>æ ‡è®°</strong>ï¼šæ ‡è®°æ‰€æœ‰éœ€è¦å›žæ”¶çš„å¯¹è±¡</li>
<li><strong>æ¸…é™¤</strong>ï¼šå›žæ”¶æ‰€æœ‰è¢«æ ‡è®°çš„å¯¹è±¡</li>
</ul>
<p><img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="https://cdn.jsdelivr.net/gh/JakicDong/blog-assets@main/images/20251011102820.png" alt="20251011102820"><br>ä¸‰åˆ†æ¶é¢æ¸£é€†è¢­ï¼šæ ‡è®°-æ¸…é™¤ç®—æ³•</p>
<p>ä¼˜ç‚¹æ˜¯å®žçŽ°ç®€å•ï¼Œç¼ºç‚¹æ˜¯å›žæ”¶è¿‡ç¨‹ä¸­ä¼šäº§ç”Ÿå†…å­˜ç¢Žç‰‡ã€‚</p>
<h4 id="è¯´è¯´æ ‡è®°-å¤åˆ¶ç®—æ³•ï¼Ÿ"><a href="#è¯´è¯´æ ‡è®°-å¤åˆ¶ç®—æ³•ï¼Ÿ" class="headerlink" title="è¯´è¯´æ ‡è®°-å¤åˆ¶ç®—æ³•ï¼Ÿ"></a>è¯´è¯´æ ‡è®°-å¤åˆ¶ç®—æ³•ï¼Ÿ</h4><p><code>æ ‡è®°-å¤åˆ¶</code>ç®—æ³•å¯ä»¥è§£å†³æ ‡è®°-æ¸…é™¤ç®—æ³•çš„å†…å­˜ç¢Žç‰‡é—®é¢˜ï¼Œå› ä¸ºå®ƒå°†å†…å­˜ç©ºé—´åˆ’åˆ†ä¸ºä¸¤å—ï¼Œæ¯æ¬¡åªä½¿ç”¨å…¶ä¸­ä¸€å—ã€‚å½“è¿™ä¸€å—çš„å†…å­˜ç”¨å®Œäº†ï¼Œå°±å°†è¿˜å­˜æ´»ç€çš„å¯¹è±¡å¤åˆ¶åˆ°å¦å¤–ä¸€å—ä¸Šé¢ï¼Œç„¶åŽæ¸…ç†æŽ‰è¿™ä¸€å—ã€‚</p>
<p><img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="https://cdn.jsdelivr.net/gh/JakicDong/blog-assets@main/images/20251011102844.png" alt="20251011102844"><br>ä¸‰åˆ†æ¶é¢æ¸£é€†è¢­ï¼šæ ‡è®°-å¤åˆ¶ç®—æ³•</p>
<p>ç¼ºç‚¹æ˜¯æµªè´¹äº†ä¸€åŠçš„å†…å­˜ç©ºé—´ã€‚</p>
<h4 id="è¯´è¯´æ ‡è®°-æ•´ç†ç®—æ³•ï¼Ÿ"><a href="#è¯´è¯´æ ‡è®°-æ•´ç†ç®—æ³•ï¼Ÿ" class="headerlink" title="è¯´è¯´æ ‡è®°-æ•´ç†ç®—æ³•ï¼Ÿ"></a>è¯´è¯´æ ‡è®°-æ•´ç†ç®—æ³•ï¼Ÿ</h4><p><code>æ ‡è®°-æ•´ç†</code>ç®—æ³•æ˜¯æ ‡è®°-æ¸…é™¤å¤åˆ¶ç®—æ³•çš„å‡çº§ç‰ˆï¼Œå®ƒä¸å†åˆ’åˆ†å†…å­˜ç©ºé—´ï¼Œè€Œæ˜¯å°†å­˜æ´»çš„å¯¹è±¡å‘å†…å­˜çš„ä¸€ç«¯ç§»åŠ¨ï¼Œç„¶åŽæ¸…ç†è¾¹ç•Œä»¥å¤–çš„å†…å­˜ã€‚</p>
<p><img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="https://cdn.jsdelivr.net/gh/JakicDong/blog-assets@main/images/20251011102906.png" alt="20251011102906"><br>æ ‡è®°-æ•´ç†ç®—æ³•</p>
<p>ç¼ºç‚¹æ˜¯ç§»åŠ¨å¯¹è±¡çš„æˆæœ¬æ¯”è¾ƒé«˜ã€‚</p>
<h4 id="è¯´è¯´åˆ†ä»£æ”¶é›†ç®—æ³•ï¼Ÿ"><a href="#è¯´è¯´åˆ†ä»£æ”¶é›†ç®—æ³•ï¼Ÿ" class="headerlink" title="è¯´è¯´åˆ†ä»£æ”¶é›†ç®—æ³•ï¼Ÿ"></a>è¯´è¯´åˆ†ä»£æ”¶é›†ç®—æ³•ï¼Ÿ</h4><p><code>åˆ†ä»£æ”¶é›†</code>ç®—æ³•æ˜¯ç›®å‰ä¸»æµçš„åžƒåœ¾æ”¶é›†ç®—æ³•ï¼Œå®ƒæ ¹æ®å¯¹è±¡å­˜æ´»å‘¨æœŸçš„ä¸åŒå°†å†…å­˜åˆ’åˆ†ä¸ºå‡ å—ï¼Œä¸€èˆ¬åˆ†ä¸ºæ–°ç”Ÿä»£å’Œè€å¹´ä»£ã€‚</p>
<p><img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="https://cdn.jsdelivr.net/gh/JakicDong/blog-assets@main/images/20251011103059.png" alt="20251011103059"><br>äºŒå“¥çš„ Java è¿›é˜¶ä¹‹è·¯ï¼šJava å †åˆ’åˆ†</p>
<p>æ–°ç”Ÿä»£ç”¨å¤åˆ¶ç®—æ³•ï¼Œå› ä¸ºå¤§éƒ¨åˆ†å¯¹è±¡ç”Ÿå‘½å‘¨æœŸçŸ­ã€‚è€å¹´ä»£ç”¨æ ‡è®°-æ•´ç†ç®—æ³•ï¼Œå› ä¸ºå¯¹è±¡å­˜æ´»çŽ‡è¾ƒé«˜ã€‚</p>
<h4 id="ä¸ºä»€ä¹ˆè¦ç”¨åˆ†ä»£æ”¶é›†å‘¢ï¼Ÿ"><a href="#ä¸ºä»€ä¹ˆè¦ç”¨åˆ†ä»£æ”¶é›†å‘¢ï¼Ÿ" class="headerlink" title="ä¸ºä»€ä¹ˆè¦ç”¨åˆ†ä»£æ”¶é›†å‘¢ï¼Ÿ"></a>ä¸ºä»€ä¹ˆè¦ç”¨åˆ†ä»£æ”¶é›†å‘¢ï¼Ÿ</h4><p>åˆ†ä»£æ”¶é›†ç®—æ³•çš„æ ¸å¿ƒæ€æƒ³æ˜¯æ ¹æ®å¯¹è±¡çš„ç”Ÿå‘½å‘¨æœŸä¼˜åŒ–åžƒåœ¾å›žæ”¶ã€‚</p>
<p>æ–°ç”Ÿä»£çš„å¯¹è±¡ç”Ÿå‘½å‘¨æœŸçŸ­ï¼Œä½¿ç”¨å¤åˆ¶ç®—æ³•å¯ä»¥å¿«é€Ÿå›žæ”¶ã€‚è€å¹´ä»£çš„å¯¹è±¡ç”Ÿå‘½å‘¨æœŸé•¿ï¼Œä½¿ç”¨æ ‡è®°-æ•´ç†ç®—æ³•å¯ä»¥å‡å°‘ç§»åŠ¨å¯¹è±¡çš„æˆæœ¬ã€‚</p>
<h4 id="æ ‡è®°å¤åˆ¶çš„æ ‡è®°è¿‡ç¨‹å’Œå¤åˆ¶è¿‡ç¨‹ä¼šä¸ä¼šåœé¡¿ï¼Ÿ"><a href="#æ ‡è®°å¤åˆ¶çš„æ ‡è®°è¿‡ç¨‹å’Œå¤åˆ¶è¿‡ç¨‹ä¼šä¸ä¼šåœé¡¿ï¼Ÿ" class="headerlink" title="æ ‡è®°å¤åˆ¶çš„æ ‡è®°è¿‡ç¨‹å’Œå¤åˆ¶è¿‡ç¨‹ä¼šä¸ä¼šåœé¡¿ï¼Ÿ"></a>æ ‡è®°å¤åˆ¶çš„æ ‡è®°è¿‡ç¨‹å’Œå¤åˆ¶è¿‡ç¨‹ä¼šä¸ä¼šåœé¡¿ï¼Ÿ</h4><p>åœ¨æ ‡è®°-å¤åˆ¶ç®—æ³• ä¸­ï¼Œæ ‡è®°é˜¶æ®µå’Œå¤åˆ¶é˜¶æ®µéƒ½ä¼šè§¦å‘STWã€‚</p>
<ul>
<li>æ ‡è®°é˜¶æ®µåœé¡¿æ˜¯ä¸ºäº†ä¿è¯å¯¹è±¡çš„å¼•ç”¨å…³ç³»ä¸è¢«ä¿®æ”¹ã€‚</li>
<li>å¤åˆ¶é˜¶æ®µåœé¡¿æ˜¯é˜²æ­¢å¯¹è±¡åœ¨å¤åˆ¶è¿‡ç¨‹ä¸­è¢«ä¿®æ”¹ã€‚</li>
</ul>
<h3 id="31-ðŸŒŸçŸ¥é“å“ªäº›åžƒåœ¾æ”¶é›†å™¨ï¼Ÿ"><a href="#31-ðŸŒŸçŸ¥é“å“ªäº›åžƒåœ¾æ”¶é›†å™¨ï¼Ÿ" class="headerlink" title="31.ðŸŒŸçŸ¥é“å“ªäº›åžƒåœ¾æ”¶é›†å™¨ï¼Ÿ"></a>31.ðŸŒŸçŸ¥é“å“ªäº›åžƒåœ¾æ”¶é›†å™¨ï¼Ÿ</h3><p>æŽ¨èé˜…è¯»ï¼š<a target="_blank" rel="noopener" href="https://javabetter.cn/jvm/gc-collector.html">æ·±å…¥ç†è§£ JVM çš„åžƒåœ¾æ”¶é›†å™¨ï¼šCMSã€G1ã€ZGC</a></p>
<p>JVM çš„åžƒåœ¾æ”¶é›†å™¨ä¸»è¦åˆ†ä¸ºä¸¤å¤§ç±»ï¼šåˆ†ä»£æ”¶é›†å™¨å’Œåˆ†åŒºæ”¶é›†å™¨ï¼Œåˆ†ä»£æ”¶é›†å™¨çš„ä»£è¡¨æ˜¯ CMSï¼Œåˆ†åŒºæ”¶é›†å™¨çš„ä»£è¡¨æ˜¯ G1 å’Œ ZGCã€‚</p>
<p><img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="https://cdn.jsdelivr.net/gh/JakicDong/blog-assets@main/images/20251011103352.png" alt="20251011103352"><br>ä¸‰åˆ†æ¶é¢æ¸£é€†è¢­ï¼šHotSpotè™šæ‹Ÿæœºåžƒåœ¾æ”¶é›†å™¨</p>
<p>CMS æ˜¯ç¬¬ä¸€ä¸ªå…³æ³¨ GC åœé¡¿æ—¶é—´çš„åžƒåœ¾æ”¶é›†å™¨ï¼ŒJDK 1.5 æ—¶å¼•å…¥ï¼ŒJDK9 è¢«æ ‡è®°å¼ƒç”¨ï¼ŒJDK14 è¢«ç§»é™¤ã€‚</p>
<p>G1 åœ¨ JDK 1.7 æ—¶å¼•å…¥ï¼Œåœ¨ JDK 9 æ—¶å–ä»£ CMS æˆä¸ºäº†é»˜è®¤çš„åžƒåœ¾æ”¶é›†å™¨ã€‚</p>
<p>ZGC æ˜¯ JDK11 æŽ¨å‡ºçš„ä¸€æ¬¾ä½Žå»¶è¿Ÿåžƒåœ¾æ”¶é›†å™¨ï¼Œé€‚ç”¨äºŽå¤§å†…å­˜ä½Žå»¶è¿ŸæœåŠ¡çš„å†…å­˜ç®¡ç†å’Œå›žæ”¶ï¼Œåœ¨ 128G çš„å¤§å †ä¸‹ï¼Œæœ€å¤§åœé¡¿æ—¶é—´æ‰ 1.68 msï¼Œæ€§èƒ½è¿œèƒœäºŽ G1 å’Œ CMSã€‚</p>
<h4 id="è¯´è¯´-Serial-æ”¶é›†å™¨ï¼Ÿ"><a href="#è¯´è¯´-Serial-æ”¶é›†å™¨ï¼Ÿ" class="headerlink" title="è¯´è¯´ Serial æ”¶é›†å™¨ï¼Ÿ"></a>è¯´è¯´ Serial æ”¶é›†å™¨ï¼Ÿ</h4><p>Serial æ”¶é›†å™¨æ˜¯æœ€åŸºç¡€ã€åŽ†å²æœ€æ‚ ä¹…çš„æ”¶é›†å™¨ã€‚</p>
<p>å¦‚åŒå®ƒçš„åå­—ï¼ˆä¸²è¡Œï¼‰ï¼Œå®ƒæ˜¯ä¸€ä¸ªå•çº¿ç¨‹å·¥ä½œçš„æ”¶é›†å™¨ï¼Œä½¿ç”¨ä¸€ä¸ªå¤„ç†å™¨æˆ–ä¸€æ¡æ”¶é›†çº¿ç¨‹åŽ»å®Œæˆåžƒåœ¾æ”¶é›†å·¥ä½œã€‚å¹¶ä¸”è¿›è¡Œåžƒåœ¾æ”¶é›†æ—¶ï¼Œå¿…é¡»æš‚åœå…¶ä»–æ‰€æœ‰å·¥ä½œçº¿ç¨‹ï¼Œç›´åˆ°åžƒåœ¾æ”¶é›†ç»“æŸâ€”â€”è¿™å°±æ˜¯æ‰€è°“çš„â€œStop The Worldâ€ã€‚</p>
<p>Serial&#x2F;Serial Old æ”¶é›†å™¨çš„è¿è¡Œè¿‡ç¨‹å¦‚å›¾ï¼š</p>
<p><img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="https://cdn.jsdelivr.net/gh/JakicDong/blog-assets@main/images/20251011103544.png" alt="20251011103544"><br>ä¸‰åˆ†æ¶é¢æ¸£é€†è¢­ï¼šSerial&#x2F;Serial Oldæ”¶é›†å™¨è¿è¡Œç¤ºæ„å›¾</p>
<h4 id="è¯´è¯´-ParNew-æ”¶é›†å™¨ï¼Ÿ"><a href="#è¯´è¯´-ParNew-æ”¶é›†å™¨ï¼Ÿ" class="headerlink" title="è¯´è¯´ ParNew æ”¶é›†å™¨ï¼Ÿ"></a>è¯´è¯´ ParNew æ”¶é›†å™¨ï¼Ÿ</h4><p>ParNew æ”¶é›†å™¨å®žè´¨ä¸Šæ˜¯ Serial æ”¶é›†å™¨çš„å¤šçº¿ç¨‹å¹¶è¡Œç‰ˆæœ¬ï¼Œä½¿ç”¨å¤šæ¡çº¿ç¨‹è¿›è¡Œåžƒåœ¾æ”¶é›†ã€‚</p>
<p>ParNew&#x2F;Serial Old æ”¶é›†å™¨è¿è¡Œç¤ºæ„å›¾å¦‚ä¸‹ï¼š</p>
<p><img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="https://cdn.jsdelivr.net/gh/JakicDong/blog-assets@main/images/20251011104114.png" alt="20251011104114"><br>ä¸‰åˆ†æ¶é¢æ¸£é€†è¢­ï¼šParNew&#x2F;Serial Oldæ”¶é›†å™¨è¿è¡Œç¤ºæ„å›¾</p>
<h4 id="è¯´è¯´-Parallel-Scavenge-æ”¶é›†å™¨ï¼Ÿ"><a href="#è¯´è¯´-Parallel-Scavenge-æ”¶é›†å™¨ï¼Ÿ" class="headerlink" title="è¯´è¯´ Parallel Scavenge æ”¶é›†å™¨ï¼Ÿ"></a>è¯´è¯´ Parallel Scavenge æ”¶é›†å™¨ï¼Ÿ</h4><p>Parallel Scavenge æ”¶é›†å™¨æ˜¯ä¸€æ¬¾æ–°ç”Ÿä»£æ”¶é›†å™¨ï¼ŒåŸºäºŽæ ‡è®°-å¤åˆ¶ç®—æ³•å®žçŽ°ï¼Œä¹Ÿèƒ½å¤Ÿå¹¶è¡Œæ”¶é›†ã€‚å’Œ ParNew æœ‰äº›ç±»ä¼¼ï¼Œä½† Parallel Scavenge ä¸»è¦å…³æ³¨çš„æ˜¯åžƒåœ¾æ”¶é›†çš„åžåé‡â€”â€”æ‰€è°“åžåé‡ï¼Œå°±æ˜¯ CPU ç”¨äºŽè¿è¡Œç”¨æˆ·ä»£ç çš„æ—¶é—´å’Œæ€»æ¶ˆè€—æ—¶é—´çš„æ¯”å€¼ï¼Œæ¯”å€¼è¶Šå¤§ï¼Œè¯´æ˜Žåžƒåœ¾æ”¶é›†çš„å æ¯”è¶Šå°ã€‚</p>
<p><img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="https://cdn.jsdelivr.net/gh/JakicDong/blog-assets@main/images/20251011104156.png" alt="20251011104156"><br>ä¸‰åˆ†æ¶é¢æ¸£é€†è¢­ï¼šåžåé‡</p>
<p>æ ¹æ®å¯¹è±¡å­˜æ´»å‘¨æœŸçš„ä¸åŒä¼šå°†å†…å­˜åˆ’åˆ†ä¸ºå‡ å—ï¼Œä¸€èˆ¬æ˜¯æŠŠ Java å †åˆ†ä¸ºæ–°ç”Ÿä»£å’Œè€å¹´ä»£ï¼Œè¿™æ ·å°±å¯ä»¥æ ¹æ®å„ä¸ªå¹´ä»£çš„ç‰¹ç‚¹é‡‡ç”¨æœ€é€‚å½“çš„æ”¶é›†ç®—æ³•ã€‚</p>
<h4 id="è¯´è¯´-Serial-Old-æ”¶é›†å™¨ï¼Ÿ"><a href="#è¯´è¯´-Serial-Old-æ”¶é›†å™¨ï¼Ÿ" class="headerlink" title="è¯´è¯´ Serial Old æ”¶é›†å™¨ï¼Ÿ"></a>è¯´è¯´ Serial Old æ”¶é›†å™¨ï¼Ÿ</h4><p>Serial Old æ˜¯ Serial æ”¶é›†å™¨çš„è€å¹´ä»£ç‰ˆæœ¬ï¼Œå®ƒåŒæ ·æ˜¯ä¸€ä¸ªå•çº¿ç¨‹æ”¶é›†å™¨ï¼Œä½¿ç”¨æ ‡è®°-æ•´ç†ç®—æ³•ã€‚</p>
<h4 id="è¯´è¯´-Parallel-Old-æ”¶é›†å™¨ï¼Ÿ"><a href="#è¯´è¯´-Parallel-Old-æ”¶é›†å™¨ï¼Ÿ" class="headerlink" title="è¯´è¯´ Parallel Old æ”¶é›†å™¨ï¼Ÿ"></a>è¯´è¯´ Parallel Old æ”¶é›†å™¨ï¼Ÿ</h4><p>Parallel Old æ˜¯ Parallel Scavenge æ”¶é›†å™¨çš„è€å¹´ä»£ç‰ˆæœ¬ï¼ŒåŸºäºŽæ ‡è®°-æ•´ç†ç®—æ³•å®žçŽ°ï¼Œä½¿ç”¨å¤šæ¡ GC çº¿ç¨‹åœ¨ STW æœŸé—´åŒæ—¶è¿›è¡Œåžƒåœ¾å›žæ”¶ã€‚</p>
<p><img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="https://cdn.jsdelivr.net/gh/JakicDong/blog-assets@main/images/20251011104247.png" alt="20251011104247"><br>ä¸‰åˆ†æ¶é¢æ¸£é€†è¢­ï¼šParallel Oldæ”¶é›†å™¨</p>
<h4 id="è¯´è¯´-CMS-æ”¶é›†å™¨ï¼Ÿ"><a href="#è¯´è¯´-CMS-æ”¶é›†å™¨ï¼Ÿ" class="headerlink" title="è¯´è¯´ CMS æ”¶é›†å™¨ï¼Ÿ"></a>è¯´è¯´ CMS æ”¶é›†å™¨ï¼Ÿ</h4><p>CMS åœ¨ JDK 1.5 æ—¶å¼•å…¥ï¼ŒJDK 9 æ—¶è¢«æ ‡è®°å¼ƒç”¨ï¼ŒJDK 14 æ—¶è¢«ç§»é™¤ã€‚</p>
<p>CMS æ˜¯ä¸€ç§ä½Žå»¶è¿Ÿçš„åžƒåœ¾æ”¶é›†å™¨ï¼Œé‡‡ç”¨æ ‡è®°-æ¸…é™¤ç®—æ³•ï¼Œåˆ†ä¸ºåˆå§‹æ ‡è®°ã€å¹¶å‘æ ‡è®°ã€é‡æ–°æ ‡è®°å’Œå¹¶å‘æ¸…é™¤å››ä¸ªé˜¶æ®µï¼Œä¼˜ç‚¹æ˜¯åžƒåœ¾å›žæ”¶çº¿ç¨‹å’Œåº”ç”¨çº¿ç¨‹åŒæ—¶è¿è¡Œï¼Œåœé¡¿æ—¶é—´çŸ­ï¼Œé€‚åˆå»¶è¿Ÿæ•æ„Ÿçš„åº”ç”¨ï¼Œä½†å®¹æ˜“äº§ç”Ÿå†…å­˜ç¢Žç‰‡ï¼Œå¯èƒ½è§¦å‘ Full GCã€‚</p>
<p><img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="https://cdn.jsdelivr.net/gh/JakicDong/blog-assets@main/images/20251011104304.png" alt="20251011104304"><br>å°æ½˜ï¼šCMS</p>
<h4 id="è¯´è¯´-G1-æ”¶é›†å™¨ï¼Ÿ"><a href="#è¯´è¯´-G1-æ”¶é›†å™¨ï¼Ÿ" class="headerlink" title="è¯´è¯´ G1 æ”¶é›†å™¨ï¼Ÿ"></a>è¯´è¯´ G1 æ”¶é›†å™¨ï¼Ÿ</h4><p>G1 åœ¨ JDK 1.7 æ—¶å¼•å…¥ï¼Œåœ¨ JDK 9 æ—¶å–ä»£ CMS æˆä¸ºé»˜è®¤çš„åžƒåœ¾æ”¶é›†å™¨ã€‚</p>
<p>G1 æ˜¯ä¸€ç§é¢å‘å¤§å†…å­˜ã€é«˜åžååœºæ™¯çš„åžƒåœ¾æ”¶é›†å™¨ï¼Œå®ƒå°†å †åˆ’åˆ†ä¸ºå¤šä¸ªå°çš„ Regionï¼Œé€šè¿‡æ ‡è®°-æ•´ç†ç®—æ³•ï¼Œé¿å…äº†å†…å­˜ç¢Žç‰‡é—®é¢˜ã€‚ä¼˜ç‚¹æ˜¯åœé¡¿æ—¶é—´å¯æŽ§ï¼Œé€‚åˆå¤§å †åœºæ™¯ï¼Œä½†è°ƒä¼˜è¾ƒå¤æ‚ã€‚</p>
<p><img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="https://cdn.jsdelivr.net/gh/JakicDong/blog-assets@main/images/20251011104352.png" alt="20251011104352"><br>æœ‰æ¢¦æƒ³çš„è‚¥å®…ï¼šG1</p>
<h4 id="è¯´è¯´-ZGC-æ”¶é›†å™¨ï¼Ÿ"><a href="#è¯´è¯´-ZGC-æ”¶é›†å™¨ï¼Ÿ" class="headerlink" title="è¯´è¯´ ZGC æ”¶é›†å™¨ï¼Ÿ"></a>è¯´è¯´ ZGC æ”¶é›†å™¨ï¼Ÿ</h4><p>ZGC æ˜¯ JDK 11 æ—¶å¼•å…¥çš„ä¸€æ¬¾ä½Žå»¶è¿Ÿçš„åžƒåœ¾æ”¶é›†å™¨ï¼Œæœ€å¤§ç‰¹ç‚¹æ˜¯å°†åžƒåœ¾æ”¶é›†çš„åœé¡¿æ—¶é—´æŽ§åˆ¶åœ¨ 10ms ä»¥å†…ï¼Œå³ä½¿åœ¨ TB çº§åˆ«çš„å †å†…å­˜ä¸‹ä¹Ÿèƒ½ä¿æŒè¾ƒä½Žçš„åœé¡¿æ—¶é—´ã€‚</p>
<p>å®ƒé€šè¿‡å¹¶å‘æ ‡è®°å’Œé‡å®šä½æ¥é¿å…å¤§éƒ¨åˆ† Stop-The-World åœé¡¿ï¼Œä¸»è¦ä¾èµ–æŒ‡é’ˆæŸ“è‰²æ¥ç®¡ç†å¯¹è±¡çŠ¶æ€ã€‚</p>
<p><img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="https://cdn.jsdelivr.net/gh/JakicDong/blog-assets@main/images/20251011104424.png" alt="20251011104424"><br>å¾—ç‰©æŠ€æœ¯ï¼šæŒ‡é’ˆæŸ“è‰²</p>
<ul>
<li><strong>æ ‡è®°å¯¹è±¡çš„å¯è¾¾æ€§</strong>ï¼šé€šè¿‡åœ¨æŒ‡é’ˆä¸Šå¢žåŠ æ ‡è®°ä½ï¼Œä¸éœ€è¦é¢å¤–çš„æ ‡è®°ä½å³å¯åˆ¤æ–­å¯¹è±¡çš„å­˜æ´»çŠ¶æ€ã€‚</li>
<li><strong>é‡å®šä½çŠ¶æ€</strong>ï¼šåœ¨å¯¹è±¡è¢«ç§»åŠ¨æ—¶ï¼Œå¯ä»¥é€šè¿‡æŒ‡é’ˆæŸ“è‰²æ¥æ›´æ–°å¯¹è±¡çš„å¼•ç”¨ï¼Œè€Œä¸éœ€è¦ç­‰å¾…å…¨å±€åŒæ­¥ã€‚</li>
</ul>
<p>é€‚ç”¨äºŽéœ€è¦è¶…ä½Žå»¶è¿Ÿçš„åœºæ™¯ï¼Œæ¯”å¦‚é‡‘èžäº¤æ˜“ç³»ç»Ÿã€ç”µå•†å¹³å°ã€‚</p>
<h4 id="åžƒåœ¾å›žæ”¶å™¨çš„ä½œç”¨æ˜¯ä»€ä¹ˆï¼Ÿ"><a href="#åžƒåœ¾å›žæ”¶å™¨çš„ä½œç”¨æ˜¯ä»€ä¹ˆï¼Ÿ" class="headerlink" title="åžƒåœ¾å›žæ”¶å™¨çš„ä½œç”¨æ˜¯ä»€ä¹ˆï¼Ÿ"></a>åžƒåœ¾å›žæ”¶å™¨çš„ä½œç”¨æ˜¯ä»€ä¹ˆï¼Ÿ</h4><p>åžƒåœ¾å›žæ”¶å™¨çš„æ ¸å¿ƒä½œç”¨æ˜¯è‡ªåŠ¨ç®¡ç† Java åº”ç”¨ç¨‹åºçš„è¿è¡Œæ—¶å†…å­˜ã€‚å®ƒè´Ÿè´£è¯†åˆ«å“ªäº›å†…å­˜æ˜¯ä¸å†è¢«åº”ç”¨ç¨‹åºä½¿ç”¨çš„ï¼Œå¹¶é‡Šæ”¾è¿™äº›å†…å­˜ä»¥ä¾¿é‡æ–°ä½¿ç”¨ã€‚</p>
<p>è¿™ä¸€è¿‡ç¨‹å‡å°‘äº†ç¨‹åºå‘˜æ‰‹åŠ¨ç®¡ç†å†…å­˜çš„è´Ÿæ‹…ï¼Œé™ä½Žäº†å†…å­˜æ³„æ¼å’Œæº¢å‡ºé”™è¯¯çš„é£Žé™©ã€‚</p>
<h3 id="32-ðŸŒŸèƒ½è¯¦ç»†è¯´ä¸€ä¸‹-CMS-çš„åžƒåœ¾æ”¶é›†è¿‡ç¨‹å—ï¼Ÿ"><a href="#32-ðŸŒŸèƒ½è¯¦ç»†è¯´ä¸€ä¸‹-CMS-çš„åžƒåœ¾æ”¶é›†è¿‡ç¨‹å—ï¼Ÿ" class="headerlink" title="32.ðŸŒŸèƒ½è¯¦ç»†è¯´ä¸€ä¸‹ CMS çš„åžƒåœ¾æ”¶é›†è¿‡ç¨‹å—ï¼Ÿ"></a>32.ðŸŒŸèƒ½è¯¦ç»†è¯´ä¸€ä¸‹ CMS çš„åžƒåœ¾æ”¶é›†è¿‡ç¨‹å—ï¼Ÿ</h3><p><img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="https://cdn.jsdelivr.net/gh/JakicDong/blog-assets@main/images/20251011105011.png" alt="20251011105011"><br>ä¸‰åˆ†æ¶é¢æ¸£é€†è¢­ï¼šConcurrent Mark Sweepæ”¶é›†å™¨è¿è¡Œç¤ºæ„å›¾</p>
<p>CMS ä½¿ç”¨<strong>æ ‡è®°-æ¸…é™¤</strong>ç®—æ³•è¿›è¡Œåžƒåœ¾æ”¶é›†ï¼Œåˆ† 4 å¤§æ­¥ï¼š</p>
<ul>
<li><strong>åˆå§‹æ ‡è®°</strong>ï¼šæ ‡è®°æ‰€æœ‰ä»Ž GC Roots ç›´æŽ¥å¯è¾¾çš„å¯¹è±¡ï¼Œè¿™ä¸ªé˜¶æ®µéœ€è¦ STWï¼Œä½†é€Ÿåº¦å¾ˆå¿«ã€‚</li>
<li><strong>å¹¶å‘æ ‡è®°</strong>ï¼šä»Žåˆå§‹æ ‡è®°çš„å¯¹è±¡å‡ºå‘ï¼ŒéåŽ†æ‰€æœ‰å¯¹è±¡ï¼Œæ ‡è®°æ‰€æœ‰å¯è¾¾çš„å¯¹è±¡ã€‚è¿™ä¸ªé˜¶æ®µæ˜¯å¹¶å‘è¿›è¡Œçš„ã€‚</li>
<li><strong>é‡æ–°æ ‡è®°</strong>ï¼šå®Œæˆå‰©ä½™çš„æ ‡è®°å·¥ä½œï¼ŒåŒ…æ‹¬å¤„ç†å¹¶å‘é˜¶æ®µé—ç•™ä¸‹æ¥çš„å°‘é‡å˜åŠ¨ï¼Œè¿™ä¸ªé˜¶æ®µé€šå¸¸éœ€è¦çŸ­æš‚çš„ STW åœé¡¿ã€‚</li>
<li><strong>å¹¶å‘æ¸…é™¤</strong>ï¼šæ¸…é™¤æœªè¢«æ ‡è®°çš„å¯¹è±¡ï¼Œå›žæ”¶å®ƒä»¬å ç”¨çš„å†…å­˜ç©ºé—´ã€‚</li>
</ul>
<h4 id="ä½ æåˆ°äº†remarkï¼Œé‚£å®ƒremarkå…·ä½“æ˜¯æ€Žä¹ˆæ‰§è¡Œçš„ï¼Ÿä¸‰è‰²æ ‡è®°æ³•ï¼Ÿ"><a href="#ä½ æåˆ°äº†remarkï¼Œé‚£å®ƒremarkå…·ä½“æ˜¯æ€Žä¹ˆæ‰§è¡Œçš„ï¼Ÿä¸‰è‰²æ ‡è®°æ³•ï¼Ÿ" class="headerlink" title="ä½ æåˆ°äº†remarkï¼Œé‚£å®ƒremarkå…·ä½“æ˜¯æ€Žä¹ˆæ‰§è¡Œçš„ï¼Ÿä¸‰è‰²æ ‡è®°æ³•ï¼Ÿ"></a>ä½ æåˆ°äº†remarkï¼Œé‚£å®ƒremarkå…·ä½“æ˜¯æ€Žä¹ˆæ‰§è¡Œçš„ï¼Ÿä¸‰è‰²æ ‡è®°æ³•ï¼Ÿ</h4><p>æ˜¯çš„ï¼Œremark é˜¶æ®µé€šå¸¸ä¼šç»“åˆä¸‰è‰²æ ‡è®°æ³•æ¥æ‰§è¡Œï¼Œç¡®ä¿åœ¨å¹¶å‘æ ‡è®°æœŸé—´æ‰€æœ‰å­˜æ´»å¯¹è±¡éƒ½è¢«æ­£ç¡®æ ‡è®°ã€‚ç›®çš„æ˜¯ä¿®æ­£å¹¶å‘æ ‡è®°é˜¶æ®µä¸­å¯èƒ½é—æ¼çš„å¯¹è±¡å¼•ç”¨å˜åŒ–ã€‚</p>
<p>åœ¨ remark é˜¶æ®µï¼Œåžƒåœ¾æ”¶é›†å™¨ä¼šåœæ­¢åº”ç”¨çº¿ç¨‹ï¼Œä»¥ç¡®ä¿åœ¨è¿™ä¸ªé˜¶æ®µä¸ä¼šæœ‰å¼•ç”¨å…³ç³»çš„è¿›ä¸€æ­¥å˜åŒ–ã€‚è¿™ç§æš‚åœé€šå¸¸å¾ˆçŸ­æš‚ã€‚remark é˜¶æ®µä¸»è¦åŒ…æ‹¬ä»¥ä¸‹æ“ä½œï¼š</p>
<ol>
<li>å¤„ç†å†™å±éšœè®°å½•çš„å¼•ç”¨å˜åŒ–ï¼šåœ¨å¹¶å‘æ ‡è®°é˜¶æ®µï¼Œåº”ç”¨ç¨‹åºå¯èƒ½ä¼šæ›´æ–°å¯¹è±¡çš„å¼•ç”¨ï¼ˆæ¯”å¦‚ä¸€ä¸ªé»‘è‰²å¯¹è±¡æ–°å¢žäº†å¯¹ä¸€ä¸ªç™½è‰²å¯¹è±¡çš„å¼•ç”¨ï¼‰ï¼Œè¿™äº›å˜åŒ–é€šè¿‡å†™å±éšœè®°å½•ä¸‹æ¥ã€‚åœ¨ remark é˜¶æ®µï¼ŒGC ä¼šå¤„ç†è¿™äº›è®°å½•ï¼Œç¡®ä¿æ‰€æœ‰å¯è¾¾å¯¹è±¡éƒ½æ­£ç¡®åœ°æ ‡è®°ä¸ºç°è‰²æˆ–é»‘è‰²ã€‚</li>
<li>æ‰«æç°è‰²å¯¹è±¡ï¼šå†æ¬¡éåŽ†ç°è‰²å¯¹è±¡ï¼Œå¤„ç†å®ƒä»¬çš„æ‰€æœ‰å¼•ç”¨ï¼Œç¡®ä¿å¼•ç”¨çš„å¯¹è±¡æ­£ç¡®æ ‡è®°ä¸ºç°è‰²æˆ–é»‘è‰²ã€‚</li>
<li>æ¸…ç†ï¼šç¡®ä¿æ‰€æœ‰å¼•ç”¨å…³ç³»æ­£ç¡®å¤„ç†åŽï¼Œç°è‰²å¯¹è±¡æ ‡è®°ä¸ºé»‘è‰²ï¼Œç™½è‰²å¯¹è±¡ä¿æŒä¸å˜ã€‚è¿™ä¸€æ­¥å®ŒæˆåŽï¼Œæ‰€æœ‰å­˜æ´»å¯¹è±¡éƒ½åº”å½“æ˜¯é»‘è‰²çš„ã€‚</li>
</ol>
<h4 id="ä»€ä¹ˆæ˜¯ä¸‰è‰²æ ‡è®°æ³•ï¼Ÿ"><a href="#ä»€ä¹ˆæ˜¯ä¸‰è‰²æ ‡è®°æ³•ï¼Ÿ" class="headerlink" title="ä»€ä¹ˆæ˜¯ä¸‰è‰²æ ‡è®°æ³•ï¼Ÿ"></a>ä»€ä¹ˆæ˜¯ä¸‰è‰²æ ‡è®°æ³•ï¼Ÿ</h4><p><img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="https://cdn.jsdelivr.net/gh/JakicDong/blog-assets@main/images/20251011105137.png" alt="20251011105137"><br>Javaå…¨æ ˆæž¶æž„å¸ˆï¼šä¸‰è‰²æ ‡è®°æ³•</p>
<p>ä¸‰è‰²æ ‡è®°æ³•ç”¨äºŽæ ‡è®°å¯¹è±¡çš„å­˜æ´»çŠ¶æ€ï¼Œå®ƒå°†å¯¹è±¡åˆ†ä¸ºä¸‰ç±»ï¼š</p>
<ol>
<li>ç™½è‰²ï¼ˆWhiteï¼‰ï¼šå°šæœªè®¿é—®çš„å¯¹è±¡ã€‚åžƒåœ¾å›žæ”¶ç»“æŸåŽï¼Œä»ç„¶ä¸ºç™½è‰²çš„å¯¹è±¡ä¼šè¢«è®¤ä¸ºæ˜¯ä¸å¯è¾¾çš„å¯¹è±¡ï¼Œå¯ä»¥å›žæ”¶ã€‚</li>
<li>ç°è‰²ï¼ˆGrayï¼‰ï¼šå·²ç»è®¿é—®åˆ°ä½†æœªæ ‡è®°å®Œå…¶å¼•ç”¨çš„å¯¹è±¡ã€‚ç°è‰²å¯¹è±¡æ˜¯éœ€è¦è¿›ä¸€æ­¥å¤„ç†çš„ã€‚</li>
<li>é»‘è‰²ï¼ˆBlackï¼‰ï¼šå·²ç»è®¿é—®åˆ°å¹¶ä¸”å…¶æ‰€æœ‰å¼•ç”¨å¯¹è±¡éƒ½å·²ç»æ ‡è®°è¿‡ã€‚é»‘è‰²å¯¹è±¡æ˜¯å®Œå…¨å¤„ç†è¿‡çš„ï¼Œä¸éœ€è¦å†å¤„ç†ã€‚</li>
</ol>
<p>ä¸‰è‰²æ ‡è®°æ³•çš„å·¥ä½œæµç¨‹ï¼š</p>
<p>â‘ ã€åˆå§‹æ ‡è®°ï¼ˆInitial Markingï¼‰ï¼šä»Ž GC Roots å¼€å§‹ï¼Œæ ‡è®°æ‰€æœ‰ç›´æŽ¥å¯è¾¾çš„å¯¹è±¡ä¸ºç°è‰²ã€‚</p>
<p>â‘¡ã€å¹¶å‘æ ‡è®°ï¼ˆConcurrent Markingï¼‰ï¼šåœ¨æ­¤é˜¶æ®µï¼Œæ ‡è®°æ‰€æœ‰ç°è‰²å¯¹è±¡å¼•ç”¨çš„å¯¹è±¡ä¸ºç°è‰²ï¼Œç„¶åŽå°†ç°è‰²å¯¹è±¡è‡ªèº«æ ‡è®°ä¸ºé»‘è‰²ã€‚è¿™ä¸ªè¿‡ç¨‹æ˜¯å¹¶å‘çš„ï¼Œå’Œåº”ç”¨çº¿ç¨‹åŒæ—¶è¿›è¡Œã€‚</p>
<p>æ­¤é˜¶æ®µçš„ä¸€ä¸ªé—®é¢˜æ˜¯ï¼Œåº”ç”¨çº¿ç¨‹å¯èƒ½åœ¨å¹¶å‘æ ‡è®°æœŸé—´ä¿®æ”¹å¯¹è±¡çš„å¼•ç”¨å…³ç³»ï¼Œå¯¼è‡´ä¸€äº›å¯¹è±¡çš„æ ‡è®°çŠ¶æ€ä¸å‡†ç¡®ã€‚</p>
<p>â‘¢ã€é‡æ–°æ ‡è®°ï¼ˆRemarkingï¼‰ï¼šé‡æ–°æ ‡è®°é˜¶æ®µçš„ç›®æ ‡æ˜¯å¤„ç†å¹¶å‘æ ‡è®°é˜¶æ®µé—æ¼çš„å¼•ç”¨å˜åŒ–ã€‚ä¸ºäº†ç¡®ä¿æ‰€æœ‰å­˜æ´»å¯¹è±¡éƒ½è¢«æ­£ç¡®æ ‡è®°ï¼Œremark éœ€è¦åœ¨ STW æš‚åœæœŸé—´æ‰§è¡Œã€‚</p>
<p>â‘£ã€ä½¿ç”¨å†™å±éšœï¼ˆWrite Barrierï¼‰æ¥æ•æ‰å¹¶å‘æ ‡è®°é˜¶æ®µåº”ç”¨çº¿ç¨‹å¯¹å¯¹è±¡å¼•ç”¨çš„æ›´æ–°ã€‚é€šè¿‡éåŽ†è¿™äº›æ›´æ–°çš„å¼•ç”¨æ¥ä¿®æ­£æ ‡è®°çŠ¶æ€ï¼Œç¡®ä¿é—æ¼çš„å¯¹è±¡ä¸ä¼šè¢«é”™è¯¯åœ°å›žæ”¶ã€‚</p>
<p>æŽ¨èé˜…è¯»ï¼š<a target="_blank" rel="noopener" href="https://blog.csdn.net/xiaodaoge_it/article/details/121890145">å°é“å“¥çš„ä¸‰è‰²æ ‡è®°</a></p>
<h3 id="33-ðŸŒŸG1-åžƒåœ¾æ”¶é›†å™¨äº†è§£å—ï¼Ÿ"><a href="#33-ðŸŒŸG1-åžƒåœ¾æ”¶é›†å™¨äº†è§£å—ï¼Ÿ" class="headerlink" title="33.ðŸŒŸG1 åžƒåœ¾æ”¶é›†å™¨äº†è§£å—ï¼Ÿ"></a>33.ðŸŒŸG1 åžƒåœ¾æ”¶é›†å™¨äº†è§£å—ï¼Ÿ</h3><p>G1 åœ¨ JDK 1.7 æ—¶å¼•å…¥ï¼Œåœ¨ JDK 9 æ—¶å–ä»£ CMS æˆä¸ºé»˜è®¤çš„åžƒåœ¾æ”¶é›†å™¨ã€‚</p>
<p><img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="https://cdn.jsdelivr.net/gh/JakicDong/blog-assets@main/images/20251011105431.png" alt="20251011105431"><br>æœ‰æ¢¦æƒ³çš„è‚¥å®…ï¼šG1 æ”¶é›†å™¨</p>
<p>G1 æŠŠ Java å †åˆ’åˆ†ä¸ºå¤šä¸ªå¤§å°ç›¸ç­‰çš„ç‹¬ç«‹åŒºåŸŸRegionï¼Œæ¯ä¸ªåŒºåŸŸéƒ½å¯ä»¥æ‰®æ¼”æ–°ç”Ÿä»£æˆ–è€å¹´ä»£çš„è§’è‰²ã€‚</p>
<p>åŒæ—¶ï¼ŒG1 è¿˜æœ‰ä¸€ä¸ªä¸“é—¨ä¸ºå¤§å¯¹è±¡è®¾è®¡çš„ Regionï¼Œå« Humongous åŒºã€‚</p>
<blockquote>
<p>å¤§å¯¹è±¡çš„åˆ¤å®šè§„åˆ™æ˜¯ï¼Œå¦‚æžœä¸€ä¸ªå¤§å¯¹è±¡è¶…è¿‡äº†ä¸€ä¸ª Region å¤§å°çš„ 50%ï¼Œæ¯”å¦‚æ¯ä¸ª Region æ˜¯ 2Mï¼Œåªè¦ä¸€ä¸ªå¯¹è±¡è¶…è¿‡äº† 1Mï¼Œå°±ä¼šè¢«æ”¾å…¥ Humongous ä¸­ã€‚</p>
</blockquote>
<p>è¿™ç§åŒºåŸŸåŒ–ç®¡ç†ä½¿å¾— G1 å¯ä»¥æ›´çµæ´»åœ°è¿›è¡Œåžƒåœ¾æ”¶é›†ï¼Œåªå›žæ”¶éƒ¨åˆ†åŒºåŸŸè€Œä¸æ˜¯æ•´ä¸ªæ–°ç”Ÿä»£æˆ–è€å¹´ä»£ã€‚</p>
<p>G1 æ”¶é›†å™¨çš„è¿è¡Œè¿‡ç¨‹å¤§è‡´å¯åˆ’åˆ†ä¸ºè¿™å‡ ä¸ªæ­¥éª¤ï¼š</p>
<p>â‘ ã€<strong>å¹¶å‘æ ‡è®°</strong>ï¼ŒG1 é€šè¿‡å¹¶å‘æ ‡è®°çš„æ–¹å¼æ‰¾å‡ºå †ä¸­çš„åžƒåœ¾å¯¹è±¡ã€‚å¹¶å‘æ ‡è®°é˜¶æ®µä¸Žåº”ç”¨çº¿ç¨‹åŒæ—¶æ‰§è¡Œï¼Œä¸ä¼šå¯¼è‡´åº”ç”¨çº¿ç¨‹æš‚åœã€‚</p>
<p>â‘¡ã€<strong>æ··åˆæ”¶é›†</strong>ï¼Œåœ¨å¹¶å‘æ ‡è®°å®ŒæˆåŽï¼ŒG1 ä¼šè®¡ç®—å‡ºå“ªäº›åŒºåŸŸçš„å›žæ”¶ä»·å€¼æœ€é«˜ï¼ˆä¹Ÿå°±æ˜¯åŒ…å«æœ€å¤šåžƒåœ¾çš„åŒºåŸŸï¼‰ï¼Œç„¶åŽä¼˜å…ˆå›žæ”¶è¿™äº›åŒºåŸŸã€‚è¿™ç§å›žæ”¶æ–¹å¼åŒ…æ‹¬äº†éƒ¨åˆ†æ–°ç”Ÿä»£åŒºåŸŸå’Œè€å¹´ä»£åŒºåŸŸã€‚</p>
<p>é€‰æ‹©å›žæ”¶æˆæœ¬ä½Žè€Œæ”¶ç›Šé«˜çš„åŒºåŸŸè¿›è¡Œå›žæ”¶ï¼Œå¯ä»¥æé«˜å›žæ”¶æ•ˆçŽ‡å’Œå‡å°‘åœé¡¿æ—¶é—´ã€‚</p>
<p>â‘¢ã€<strong>å¯é¢„æµ‹çš„åœé¡¿</strong>ï¼ŒG1 åœ¨åžƒåœ¾å›žæ”¶æœŸé—´ä»ç„¶éœ€è¦ã€ŒStop the Worldã€ã€‚ä¸è¿‡ï¼ŒG1 åœ¨åœé¡¿æ—¶é—´ä¸Šæ·»åŠ äº†é¢„æµ‹æœºåˆ¶ï¼Œç”¨æˆ·å¯ä»¥ JVM å¯åŠ¨æ—¶æŒ‡å®šæœŸæœ›åœé¡¿æ—¶é—´ï¼ŒG1 ä¼šå°½å¯èƒ½åœ°åœ¨è¿™ä¸ªæ—¶é—´å†…å®Œæˆåžƒåœ¾å›žæ”¶ã€‚</p>
<p><img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="https://cdn.jsdelivr.net/gh/JakicDong/blog-assets@main/images/20251011105556.png" alt="20251011105556"><br>ä¸‰åˆ†æ¶é¢æ¸£é€†è¢­ï¼šG1æ”¶é›†å™¨è¿è¡Œç¤ºæ„å›¾</p>
<h3 id="45-ðŸŒŸäº†è§£ç±»çš„åŠ è½½æœºåˆ¶å—ï¼Ÿï¼ˆè¡¥å……ï¼‰"><a href="#45-ðŸŒŸäº†è§£ç±»çš„åŠ è½½æœºåˆ¶å—ï¼Ÿï¼ˆè¡¥å……ï¼‰" class="headerlink" title="45.ðŸŒŸäº†è§£ç±»çš„åŠ è½½æœºåˆ¶å—ï¼Ÿï¼ˆè¡¥å……ï¼‰"></a>45.ðŸŒŸäº†è§£ç±»çš„åŠ è½½æœºåˆ¶å—ï¼Ÿï¼ˆè¡¥å……ï¼‰</h3><p>äº†è§£ã€‚</p>
<p>JVM çš„æ“ä½œå¯¹è±¡æ˜¯ Class æ–‡ä»¶ï¼ŒJVM æŠŠ Class æ–‡ä»¶ä¸­æè¿°ç±»çš„æ•°æ®ç»“æž„åŠ è½½åˆ°å†…å­˜ä¸­ï¼Œå¹¶å¯¹æ•°æ®è¿›è¡Œæ ¡éªŒã€è§£æžå’Œåˆå§‹åŒ–ï¼Œæœ€ç»ˆè½¬åŒ–æˆå¯ä»¥è¢« JVM ç›´æŽ¥ä½¿ç”¨çš„ç±»åž‹ï¼Œè¿™ä¸ªè¿‡ç¨‹è¢«ç§°ä¸ºç±»åŠ è½½æœºåˆ¶ã€‚</p>
<p>å…¶ä¸­æœ€é‡è¦çš„ä¸‰ä¸ªæ¦‚å¿µå°±æ˜¯ï¼šç±»åŠ è½½å™¨ã€ç±»åŠ è½½è¿‡ç¨‹å’ŒåŒäº²å§”æ´¾æ¨¡åž‹ã€‚</p>
<ul>
<li><strong>ç±»åŠ è½½å™¨</strong>ï¼šè´Ÿè´£åŠ è½½ç±»æ–‡ä»¶ï¼Œå°†ç±»æ–‡ä»¶åŠ è½½åˆ°å†…å­˜ä¸­ï¼Œç”Ÿæˆ Class å¯¹è±¡ã€‚</li>
<li><strong>ç±»åŠ è½½è¿‡ç¨‹</strong>ï¼šåŒ…æ‹¬åŠ è½½ã€éªŒè¯ã€å‡†å¤‡ã€è§£æžå’Œåˆå§‹åŒ–ç­‰æ­¥éª¤ã€‚</li>
<li><strong>åŒäº²å§”æ´¾æ¨¡åž‹</strong>ï¼šå½“ä¸€ä¸ªç±»åŠ è½½å™¨æŽ¥æ”¶åˆ°ç±»åŠ è½½è¯·æ±‚æ—¶ï¼Œå®ƒä¼šæŠŠè¯·æ±‚å§”æ´¾ç»™çˆ¶â€”â€”ç±»åŠ è½½å™¨åŽ»å®Œæˆï¼Œä¾æ¬¡é€’å½’ï¼Œç›´åˆ°æœ€é¡¶å±‚çš„ç±»åŠ è½½å™¨ï¼Œå¦‚æžœçˆ¶â€”â€”ç±»åŠ è½½å™¨æ— æ³•å®ŒæˆåŠ è½½è¯·æ±‚ï¼Œå­ç±»åŠ è½½å™¨æ‰ä¼šå°è¯•è‡ªå·±åŽ»åŠ è½½ã€‚</li>
</ul>
<h3 id="48-ðŸŒŸç±»è£…è½½çš„è¿‡ç¨‹çŸ¥é“å—ï¼Ÿ"><a href="#48-ðŸŒŸç±»è£…è½½çš„è¿‡ç¨‹çŸ¥é“å—ï¼Ÿ" class="headerlink" title="48.ðŸŒŸç±»è£…è½½çš„è¿‡ç¨‹çŸ¥é“å—ï¼Ÿ"></a>48.ðŸŒŸç±»è£…è½½çš„è¿‡ç¨‹çŸ¥é“å—ï¼Ÿ</h3><blockquote>
<p>æŽ¨èé˜…è¯»ï¼š<a target="_blank" rel="noopener" href="https://javabetter.cn/jvm/class-load.html">ä¸€æ–‡å½»åº•æžæ‡‚ Java ç±»åŠ è½½æœºåˆ¶</a></p>
</blockquote>
<p>çŸ¥é“ã€‚</p>
<p>ç±»è£…è½½è¿‡ç¨‹åŒ…æ‹¬ä¸‰ä¸ªé˜¶æ®µï¼šè½½å…¥ã€é“¾æŽ¥å’Œåˆå§‹åŒ–ã€‚</p>
<p>â‘ ã€è½½å…¥ï¼šå°†ç±»çš„äºŒè¿›åˆ¶å­—èŠ‚ç åŠ è½½åˆ°å†…å­˜ä¸­ã€‚</p>
<p>â‘¡ã€é“¾æŽ¥å¯ä»¥ç»†åˆ†ä¸ºä¸‰ä¸ªå°çš„é˜¶æ®µï¼š</p>
<ul>
<li>éªŒè¯ï¼šæ£€æŸ¥ç±»æ–‡ä»¶æ ¼å¼æ˜¯å¦ç¬¦åˆ JVM è§„èŒƒ</li>
<li>å‡†å¤‡ï¼šä¸ºç±»çš„é™æ€å˜é‡åˆ†é…å†…å­˜å¹¶è®¾ç½®é»˜è®¤å€¼ã€‚</li>
<li>è§£æžï¼šå°†ç¬¦å·å¼•ç”¨æ›¿æ¢ä¸ºç›´æŽ¥å¼•ç”¨ã€‚</li>
</ul>
<p>â‘¢ã€åˆå§‹åŒ–ï¼šæ‰§è¡Œé™æ€ä»£ç å—å’Œé™æ€å˜é‡åˆå§‹åŒ–ã€‚</p>
<p>åœ¨å‡†å¤‡é˜¶æ®µï¼Œé™æ€å˜é‡å·²ç»è¢«èµ‹è¿‡é»˜è®¤åˆå§‹å€¼äº†ï¼Œåœ¨åˆå§‹åŒ–é˜¶æ®µï¼Œé™æ€å˜é‡å°†è¢«èµ‹å€¼ä¸ºä»£ç æœŸæœ›èµ‹çš„å€¼ã€‚æ¯”å¦‚è¯´ <code>static int a = 1;</code>ï¼Œåœ¨å‡†å¤‡é˜¶æ®µï¼Œ<code>a</code> çš„å€¼ä¸º 0ï¼Œåœ¨åˆå§‹åŒ–é˜¶æ®µï¼Œ<code>a</code> çš„å€¼ä¸º 1ã€‚</p>
<p>æ¢å¥è¯è¯´ï¼Œåˆå§‹åŒ–é˜¶æ®µæ˜¯åœ¨æ‰§è¡Œç±»çš„æž„é€ æ–¹æ³•ï¼Œä¹Ÿå°±æ˜¯ <a target="_blank" rel="noopener" href="https://javabetter.cn/jvm/bytecode.html">javap</a> ä¸­çœ‹åˆ°çš„ <code>&lt;clinit&gt;()</code>ã€‚</p>
<h4 id="è½½å…¥è¿‡ç¨‹-JVM-ä¼šåšä»€ä¹ˆï¼Ÿ"><a href="#è½½å…¥è¿‡ç¨‹-JVM-ä¼šåšä»€ä¹ˆï¼Ÿ" class="headerlink" title="è½½å…¥è¿‡ç¨‹ JVM ä¼šåšä»€ä¹ˆï¼Ÿ"></a>è½½å…¥è¿‡ç¨‹ JVM ä¼šåšä»€ä¹ˆï¼Ÿ</h4><p><img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="https://cdn.jsdelivr.net/gh/JakicDong/blog-assets@main/images/20251011111643.png" alt="20251011111643"><br>ä¸‰åˆ†æ¶é¢æ¸£é€†è¢­ï¼šè½½å…¥</p>
<ul>
<li>1ï¼‰é€šè¿‡ä¸€ä¸ªç±»çš„å…¨é™å®šåæ¥èŽ·å–å®šä¹‰æ­¤ç±»çš„äºŒè¿›åˆ¶å­—èŠ‚æµã€‚</li>
<li>2ï¼‰å°†è¿™ä¸ªå­—èŠ‚æµæ‰€ä»£è¡¨çš„é™æ€å­˜å‚¨ç»“æž„è½¬åŒ–ä¸ºæ–¹æ³•åŒºçš„è¿è¡Œæ—¶æ•°æ®ç»“æž„ã€‚</li>
<li>3ï¼‰åœ¨å†…å­˜ä¸­ç”Ÿæˆä¸€ä¸ªä»£è¡¨è¿™ä¸ªç±»çš„ <code>java.lang.Class</code> å¯¹è±¡ï¼Œä½œä¸ºè¿™ä¸ªç±»çš„è®¿é—®å…¥å£ã€‚</li>
</ul>
<h3 id="49-ðŸŒŸä»€ä¹ˆæ˜¯åŒäº²å§”æ´¾æ¨¡åž‹ï¼Ÿ"><a href="#49-ðŸŒŸä»€ä¹ˆæ˜¯åŒäº²å§”æ´¾æ¨¡åž‹ï¼Ÿ" class="headerlink" title="49.ðŸŒŸä»€ä¹ˆæ˜¯åŒäº²å§”æ´¾æ¨¡åž‹ï¼Ÿ"></a>49.ðŸŒŸä»€ä¹ˆæ˜¯åŒäº²å§”æ´¾æ¨¡åž‹ï¼Ÿ</h3><p>åŒäº²å§”æ´¾æ¨¡åž‹è¦æ±‚ç±»åŠ è½½å™¨åœ¨åŠ è½½ç±»æ—¶ï¼Œå…ˆå§”æ‰˜çˆ¶åŠ è½½å™¨å°è¯•åŠ è½½ï¼Œåªæœ‰çˆ¶åŠ è½½å™¨æ— æ³•åŠ è½½æ—¶ï¼Œå­åŠ è½½å™¨æ‰ä¼šåŠ è½½ã€‚</p>
<p><img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="https://cdn.jsdelivr.net/gh/JakicDong/blog-assets@main/images/20251011111737.png" alt="20251011111737"><br>ä¸‰åˆ†æ¶é¢æ¸£é€†è¢­ï¼šåŒäº²å§”æ´¾æ¨¡åž‹</p>
<p>è¿™ä¸ªè¿‡ç¨‹ä¼šä¸€ç›´å‘ä¸Šé€’å½’ï¼Œä¹Ÿå°±æ˜¯è¯´ï¼Œä»Žå­åŠ è½½å™¨åˆ°çˆ¶åŠ è½½å™¨ï¼Œå†åˆ°æ›´ä¸Šå±‚çš„åŠ è½½å™¨ï¼Œä¸€ç›´åˆ°æœ€é¡¶å±‚çš„å¯åŠ¨ç±»åŠ è½½å™¨ã€‚</p>
<p>å¯åŠ¨ç±»åŠ è½½å™¨ä¼šå°è¯•åŠ è½½è¿™ä¸ªç±»ã€‚å¦‚æžœå®ƒèƒ½å¤ŸåŠ è½½è¿™ä¸ªç±»ï¼Œå°±ç›´æŽ¥è¿”å›žï¼›å¦‚æžœå®ƒä¸èƒ½åŠ è½½è¿™ä¸ªç±»ï¼Œå°±ä¼šå°†åŠ è½½ä»»åŠ¡è¿”å›žç»™å§”æ‰˜å®ƒçš„å­åŠ è½½å™¨ã€‚</p>
<p>å­åŠ è½½å™¨å°è¯•åŠ è½½è¿™ä¸ªç±»ã€‚å¦‚æžœå­åŠ è½½å™¨ä¹Ÿæ— æ³•åŠ è½½è¿™ä¸ªç±»ï¼Œå®ƒå°±ä¼šç»§ç»­å‘ä¸‹ä¼ é€’è¿™ä¸ªåŠ è½½ä»»åŠ¡ï¼Œä¾æ­¤ç±»æŽ¨ã€‚</p>
<p>ç›´åˆ°æŸä¸ªåŠ è½½å™¨èƒ½å¤ŸåŠ è½½è¿™ä¸ªç±»ï¼Œæˆ–è€…æ‰€æœ‰åŠ è½½å™¨éƒ½æ— æ³•åŠ è½½è¿™ä¸ªç±»ï¼Œæœ€ç»ˆæŠ›å‡º ClassNotFoundExceptionã€‚</p>
<h2 id="MySQL"><a href="#MySQL" class="headerlink" title="MySQL"></a>MySQL</h2><h3 id="ðŸŒŸ0-ä»€ä¹ˆæ˜¯MYSQL"><a href="#ðŸŒŸ0-ä»€ä¹ˆæ˜¯MYSQL" class="headerlink" title="ðŸŒŸ0.ä»€ä¹ˆæ˜¯MYSQL"></a>ðŸŒŸ0.ä»€ä¹ˆæ˜¯MYSQL</h3><p>MySQL æ˜¯â¼€ä¸ªå¼€æºçš„å…³ç³»åž‹æ•°æ®åº“ï¼ŒçŽ°åœ¨â¾ªå±žäºŽ Oracle å…¬å¸ã€‚</p>
<h4 id="åˆ é™¤-åˆ›å»ºä¸€å¼ è¡¨"><a href="#åˆ é™¤-åˆ›å»ºä¸€å¼ è¡¨" class="headerlink" title="åˆ é™¤&#x2F;åˆ›å»ºä¸€å¼ è¡¨"></a>åˆ é™¤&#x2F;åˆ›å»ºä¸€å¼ è¡¨</h4><p><code>DROP TABLE</code> åˆ é™¤è¡¨<br><code>CREATE TABLE</code> åˆ›å»ºè¡¨<br>åˆ›å»ºè¡¨çš„æ—¶å€™ï¼Œå¯ä»¥é€šè¿‡ <code>PRIMARY KEY</code> è®¾å®šä¸»é”®ã€‚</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">CREATE TABLE</span> users (</span><br><span class="line">    id <span class="type">INT</span> AUTO_INCREMENT,</span><br><span class="line">    name <span class="type">VARCHAR</span>(<span class="number">100</span>) <span class="keyword">NOT NULL</span>,</span><br><span class="line">    email <span class="type">VARCHAR</span>(<span class="number">100</span>),</span><br><span class="line">    <span class="keyword">PRIMARY KEY</span> (id)</span><br><span class="line">);</span><br></pre></td></tr></table></figure>

<h4 id="å†™ä¸€ä¸ªå‡åº-é™åºçš„SQLè¯­å¥"><a href="#å†™ä¸€ä¸ªå‡åº-é™åºçš„SQLè¯­å¥" class="headerlink" title="å†™ä¸€ä¸ªå‡åº&#x2F;é™åºçš„SQLè¯­å¥"></a>å†™ä¸€ä¸ªå‡åº&#x2F;é™åºçš„SQLè¯­å¥</h4><p>å¯ä»¥ä½¿ç”¨<code>ORDER BY</code>å­—å¥å¯¹æŸ¥è¯¢ç»“æžœè¿›è¡ŒæŽ’åº.<br>é»˜è®¤æƒ…å†µä¸‹æ˜¯å‡åºæŽ’åº.å¦‚éœ€è¦é™åº,ä½¿ç”¨å…³é”®å­—<code>DESC</code><br>ä¾‹å­:</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> id, name, salary</span><br><span class="line"><span class="keyword">FROM</span> employees</span><br><span class="line"><span class="keyword">ORDER</span> <span class="keyword">BY</span> salary <span class="keyword">DESC</span>;</span><br></pre></td></tr></table></figure>

<p>å¦‚è‹¥å¯¹å¤šä¸ªå­—æ®µè¿›è¡ŒæŽ’åº:</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> id, name, salary</span><br><span class="line"><span class="keyword">FROM</span> employees</span><br><span class="line"><span class="keyword">ORDER</span> <span class="keyword">BY</span> salary <span class="keyword">DESC</span>, name <span class="keyword">ASC</span>;</span><br></pre></td></tr></table></figure>
<p>ä¼˜å…ˆçº§ä»Žå·¦åˆ°å³,ç›¸å½“äºŽå…ˆæŒ‰å·¥èµ„é™åº,å·¥èµ„ç›¸åŒå†æŒ‰ç…§å§“åå‡åº.</p>
<h4 id="MYSQLå‡ºçŽ°æ€§èƒ½å·®çš„åŽŸå› "><a href="#MYSQLå‡ºçŽ°æ€§èƒ½å·®çš„åŽŸå› " class="headerlink" title="MYSQLå‡ºçŽ°æ€§èƒ½å·®çš„åŽŸå› "></a>MYSQLå‡ºçŽ°æ€§èƒ½å·®çš„åŽŸå› </h4><p>å¯èƒ½æ˜¯ SQL æŸ¥è¯¢ä½¿â½¤äº†<strong>å…¨è¡¨æ‰«æ</strong>ï¼Œä¹Ÿå¯èƒ½æ˜¯<strong>æŸ¥è¯¢è¯­å¥è¿‡äºŽå¤æ‚</strong>ï¼Œå¦‚å¤šè¡¨<code>JOIN</code>æˆ–åµŒå¥—â¼¦æŸ¥è¯¢ã€‚<br>ä¹Ÿæœ‰å¯èƒ½æ˜¯å•è¡¨æ•°æ®é‡è¿‡â¼¤ã€‚</p>
<p>é€šå¸¸æƒ…å†µä¸‹,å¢žåŠ ç´¢å¼•å°±å¯ä»¥è§£å†³å¤§éƒ¨åˆ†çš„æ€§èƒ½é—®é¢˜.å¯¹äºŽçƒ­ç‚¹æ•°æ®,å¢žåŠ redisç¼“å­˜,å‡è½»å¯¹æ•°æ®åº“çš„åŽ‹åŠ›.</p>
<h3 id="9-ðŸŒŸå¦‚ä½•å­˜å‚¨emoji"><a href="#9-ðŸŒŸå¦‚ä½•å­˜å‚¨emoji" class="headerlink" title="9.ðŸŒŸå¦‚ä½•å­˜å‚¨emoji?"></a>9.ðŸŒŸå¦‚ä½•å­˜å‚¨emoji?</h3><p>å› ä¸º emojiæ˜¯ 4 ä¸ªå­—èŠ‚çš„ UTF-8 å­—ç¬¦ï¼Œâ½½ MySQL çš„ utf8 å­—ç¬¦é›†åªâ½€æŒæœ€å¤š 3 ä¸ªå­—èŠ‚çš„ UTF-8 å­—ç¬¦ï¼Œæ‰€ä»¥åœ¨ MySQL ä¸­å­˜å‚¨ emoji æ—¶ï¼Œéœ€è¦ä½¿â½¤ utf8mb4 å­—ç¬¦é›†ã€‚</p>
<p>MySQL 8.0 å·²ç»é»˜è®¤â½€æŒ utf8mb4 å­—ç¬¦é›†ï¼Œå¯ä»¥é€šè¿‡ <code>SHOW VARIABLES WHERE Variable_name LIKE &#39;character\_set\_%&#39; OR Variable_name LIKE &#39;collation%&#39;;</code> æŸ¥çœ‹ã€‚</p>
<h3 id="21-ðŸŒŸä¸€æ¡æŸ¥è¯¢è¯­å¥SELECTæ˜¯å¦‚ä½•æ‰§è¡Œçš„ï¼Ÿ"><a href="#21-ðŸŒŸä¸€æ¡æŸ¥è¯¢è¯­å¥SELECTæ˜¯å¦‚ä½•æ‰§è¡Œçš„ï¼Ÿ" class="headerlink" title="21.ðŸŒŸä¸€æ¡æŸ¥è¯¢è¯­å¥SELECTæ˜¯å¦‚ä½•æ‰§è¡Œçš„ï¼Ÿ"></a>21.ðŸŒŸä¸€æ¡æŸ¥è¯¢è¯­å¥SELECTæ˜¯å¦‚ä½•æ‰§è¡Œçš„ï¼Ÿ</h3><p>å½“æˆ‘ä»¬æ‰§è¡Œä¸€æ¡ SELECT è¯­å¥æ—¶ï¼ŒMySQL å¹¶ä¸ä¼šç›´æŽ¥åŽ»ç£ç›˜è¯»å–æ•°æ®ï¼Œè€Œæ˜¯ç»è¿‡ 6 ä¸ªæ­¥éª¤æ¥è§£æžã€ä¼˜åŒ–ã€æ‰§è¡Œï¼Œç„¶åŽå†è¿”å›žç»“æžœã€‚<br><img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="https://cdn.jsdelivr.net/gh/JakicDong/blog-assets@main/images/20250612103550.png" alt="20250612103550"><br>ç¬¬ä¸€æ­¥ï¼Œå®¢æˆ·ç«¯<strong>å‘é€ SQL æŸ¥è¯¢è¯­å¥åˆ° MySQL æœåŠ¡å™¨</strong>ã€‚</p>
<p>ç¬¬äºŒæ­¥ï¼ŒMySQL æœåŠ¡å™¨çš„<strong>è¿žæŽ¥å™¨å¼€å§‹å¤„ç†è¿™ä¸ªè¯·æ±‚</strong>ï¼Œè·Ÿå®¢æˆ·ç«¯å»ºç«‹è¿žæŽ¥ã€èŽ·å–æƒé™ã€ç®¡ç†è¿žæŽ¥ã€‚</p>
<p>ç¬¬ä¸‰æ­¥ï¼Œ<strong>è§£æžå™¨å¯¹ SQL è¯­å¥è¿›è¡Œè§£æž</strong>ï¼Œæ£€æŸ¥è¯­å¥æ˜¯å¦ç¬¦åˆ SQL è¯­æ³•è§„åˆ™ï¼Œç¡®ä¿æ•°æ®åº“ã€è¡¨å’Œåˆ—éƒ½æ˜¯å­˜åœ¨çš„ï¼Œå¹¶å¤„ç† SQL è¯­å¥ä¸­çš„åç§°è§£æžå’Œæƒé™éªŒè¯ã€‚</p>
<p>ç¬¬å››æ­¥ï¼Œ<strong>ä¼˜åŒ–å™¨è´Ÿè´£ç¡®å®š SQL è¯­å¥çš„æ‰§è¡Œè®¡åˆ’</strong>ï¼Œè¿™åŒ…æ‹¬é€‰æ‹©ä½¿ç”¨å“ªäº›ç´¢å¼•ï¼Œä»¥åŠå†³å®šè¡¨ä¹‹é—´çš„è¿žæŽ¥é¡ºåºç­‰ã€‚</p>
<p>ç¬¬äº”æ­¥ï¼Œ<strong>æ‰§è¡Œå™¨ä¼šè°ƒç”¨å­˜å‚¨å¼•æ“Žçš„ API</strong>æ¥è¿›è¡Œæ•°æ®çš„è¯»å†™ã€‚</p>
<p>ç¬¬å…­æ­¥ï¼Œ<strong>å­˜å‚¨å¼•æ“Žè´Ÿè´£æŸ¥è¯¢æ•°æ®ï¼Œå¹¶å°†æ‰§è¡Œç»“æžœè¿”å›žç»™å®¢æˆ·ç«¯</strong>ã€‚å®¢æˆ·ç«¯æŽ¥æ”¶åˆ°æŸ¥è¯¢ç»“æžœï¼Œå®Œæˆè¿™æ¬¡æŸ¥è¯¢è¯·æ±‚ã€‚</p>
<h3 id="24-ðŸŒŸMySQL-æœ‰å“ªäº›å¸¸è§å­˜å‚¨å¼•æ“Žï¼Ÿ"><a href="#24-ðŸŒŸMySQL-æœ‰å“ªäº›å¸¸è§å­˜å‚¨å¼•æ“Žï¼Ÿ" class="headerlink" title="24.ðŸŒŸMySQL æœ‰å“ªäº›å¸¸è§å­˜å‚¨å¼•æ“Žï¼Ÿ"></a>24.ðŸŒŸMySQL æœ‰å“ªäº›å¸¸è§å­˜å‚¨å¼•æ“Žï¼Ÿ</h3><p>MySQL æ”¯æŒå¤šç§å­˜å‚¨å¼•æ“Žï¼Œå¸¸è§çš„æœ‰ <code>MyISAM</code>ã€<code>InnoDB</code>ã€<code>MEMORY</code> ç­‰ã€‚<br>â€”è¿™éƒ¨åˆ†æ˜¯å¸®åŠ©ç†è§£ startï¼Œé¢è¯•ä¸­å¯ä¸èƒŒâ€”<br><img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="https://cdn.jsdelivr.net/gh/JakicDong/blog-assets@main/images/20250612112408.png" alt="20250612112408"><br>æˆ‘æ¥åšä¸€ä¸ªè¡¨æ ¼å¯¹æ¯”ï¼š<br><img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="https://cdn.jsdelivr.net/gh/JakicDong/blog-assets@main/images/20250612112435.png" alt="20250612112435"><br>â€”è¿™éƒ¨åˆ†æ˜¯å¸®åŠ©ç†è§£ endï¼Œé¢è¯•ä¸­å¯ä¸èƒŒâ€”<br>é™¤æ­¤ä¹‹å¤–ï¼Œæˆ‘è¿˜äº†è§£åˆ°ï¼š<br>â‘ ã€MySQL 5.5 ä¹‹å‰ï¼Œé»˜è®¤å­˜å‚¨å¼•æ“Žæ˜¯ <code>MyISAM</code>ï¼Œ5.5 ä¹‹åŽæ˜¯ <code>InnoDB</code>ã€‚<br>â‘¡ã€<code>InnoDB</code> æ”¯æŒçš„å“ˆå¸Œç´¢å¼•æ˜¯è‡ªé€‚åº”çš„ï¼Œä¸èƒ½äººä¸ºå¹²é¢„ã€‚<br>â‘¢ã€<code>InnoDB</code> ä»Ž MySQL 5.6 å¼€å§‹ï¼Œæ”¯æŒå…¨æ–‡ç´¢å¼•ã€‚<br>â‘£ã€<code>InnoDB</code> çš„æœ€å°è¡¨ç©ºé—´ç•¥å°äºŽ 10Mï¼Œæœ€å¤§è¡¨ç©ºé—´å–å†³äºŽé¡µé¢å¤§å°ã€‚<br>å¦‚ä½•åˆ‡æ¢ MySQL çš„æ•°æ®å¼•æ“Žï¼Ÿ<br>å¯ä»¥é€šè¿‡ <code>alter table</code> è¯­å¥æ¥åˆ‡æ¢ MySQL çš„æ•°æ®å¼•æ“Žã€‚<br><code>ALTER TABLE your_table_name ENGINE=InnoDB;</code><br>ä¸è¿‡ä¸å»ºè®®ï¼Œ<strong>åº”è¯¥æå‰è®¾è®¡å¥½åˆ°åº•ç”¨å“ªä¸€ç§å­˜å‚¨å¼•æ“Ž</strong>ã€‚</p>
<h3 id="28-ðŸŒŸMySQL-æ—¥å¿—æ–‡ä»¶æœ‰å“ªäº›ï¼Ÿ"><a href="#28-ðŸŒŸMySQL-æ—¥å¿—æ–‡ä»¶æœ‰å“ªäº›ï¼Ÿ" class="headerlink" title="28.ðŸŒŸMySQL æ—¥å¿—æ–‡ä»¶æœ‰å“ªäº›ï¼Ÿ"></a>28.ðŸŒŸMySQL æ—¥å¿—æ–‡ä»¶æœ‰å“ªäº›ï¼Ÿ</h3><p>æœ‰ 6 å¤§ç±»ï¼Œå…¶ä¸­<code>é”™è¯¯æ—¥å¿—</code>ç”¨äºŽ<strong>é—®é¢˜è¯Šæ–­</strong>ï¼Œ<code>æ…¢æŸ¥è¯¢æ—¥å¿—</code>ç”¨äºŽ <strong>SQL æ€§èƒ½åˆ†æž</strong>ï¼Œ<code>general log</code> ç”¨äºŽ<strong>è®°å½•æ‰€æœ‰çš„ SQL è¯­å¥</strong>ï¼Œ<code>binlog</code> ç”¨äºŽ<strong>ä¸»ä»Žå¤åˆ¶å’Œæ•°æ®æ¢å¤</strong>ï¼Œ<code>redo log</code> ç”¨äºŽ<strong>ä¿è¯äº‹åŠ¡æŒä¹…æ€§</strong>ï¼Œ<code>undo log</code> ç”¨äºŽ<strong>äº‹åŠ¡å›žæ»šå’Œ MVCC</strong>ã€‚</p>
<p>â€”-è¿™éƒ¨åˆ†æ˜¯å¸®åŠ©ç†è§£ startï¼Œé¢è¯•ä¸­å¯ä¸èƒŒâ€”-</p>
<p>â‘ ã€<code>é”™è¯¯æ—¥å¿—ï¼ˆError Logï¼‰</code>ï¼šè®°å½• MySQL æœåŠ¡å™¨<strong>å¯åŠ¨ã€è¿è¡Œæˆ–åœæ­¢</strong>æ—¶å‡ºçŽ°çš„é—®é¢˜ã€‚<br>â‘¡ã€<code>æ…¢æŸ¥è¯¢æ—¥å¿—ï¼ˆSlow Query Logï¼‰</code>ï¼šè®°å½•æ‰§è¡Œæ—¶é—´è¶…è¿‡ <code>long_query_time</code> å€¼çš„æ‰€æœ‰ SQL è¯­å¥ã€‚è¿™ä¸ªæ—¶é—´å€¼æ˜¯å¯é…ç½®çš„ï¼Œé»˜è®¤æƒ…å†µä¸‹ï¼Œæ…¢æŸ¥è¯¢æ—¥å¿—åŠŸèƒ½æ˜¯å…³é—­çš„ã€‚<br>â‘¢ã€<code>ä¸€èˆ¬æŸ¥è¯¢æ—¥å¿—ï¼ˆGeneral Query Logï¼‰</code>ï¼šè®°å½• MySQL æœåŠ¡å™¨çš„å¯åŠ¨å…³é—­ä¿¡æ¯ï¼Œå®¢æˆ·ç«¯çš„è¿žæŽ¥ä¿¡æ¯ï¼Œä»¥åŠæ›´æ–°ã€æŸ¥è¯¢çš„ SQL è¯­å¥ç­‰ã€‚<br>â‘£ã€<code>äºŒè¿›åˆ¶æ—¥å¿—ï¼ˆBinary Logï¼‰</code>ï¼šè®°å½•æ‰€æœ‰<strong>ä¿®æ”¹æ•°æ®åº“çŠ¶æ€çš„ SQL è¯­å¥</strong>ï¼Œä»¥åŠæ¯ä¸ªè¯­å¥çš„æ‰§è¡Œæ—¶é—´ï¼Œå¦‚ INSERTã€UPDATEã€DELETE ç­‰ï¼Œä½†ä¸åŒ…æ‹¬ SELECT å’Œ SHOW è¿™ç±»çš„æ“ä½œã€‚<br>â‘¤ã€<code>é‡åšæ—¥å¿—ï¼ˆRedo Logï¼‰</code>ï¼šè®°å½•å¯¹äºŽ InnoDB è¡¨çš„æ¯ä¸ªå†™æ“ä½œï¼Œä¸æ˜¯ SQL çº§åˆ«çš„ï¼Œè€Œæ˜¯ç‰©ç†çº§åˆ«çš„ï¼Œä¸»è¦ç”¨äºŽå´©æºƒæ¢å¤ã€‚<br>â‘¥ã€<code>å›žæ»šæ—¥å¿—ï¼ˆUndo Logï¼Œæˆ–è€…å«äº‹åŠ¡æ—¥å¿—ï¼‰</code>ï¼šè®°å½•æ•°æ®è¢«ä¿®æ”¹å‰çš„å€¼ï¼Œç”¨äºŽäº‹åŠ¡çš„å›žæ»šã€‚</p>
<p>â€”-è¿™éƒ¨åˆ†æ˜¯å¸®åŠ©ç†è§£ endï¼Œé¢è¯•ä¸­å¯ä¸èƒŒâ€”-</p>
<h4 id="è¯·é‡ç‚¹è¯´è¯´-binlogï¼Ÿ"><a href="#è¯·é‡ç‚¹è¯´è¯´-binlogï¼Ÿ" class="headerlink" title="è¯·é‡ç‚¹è¯´è¯´ binlogï¼Ÿ"></a>è¯·é‡ç‚¹è¯´è¯´ binlogï¼Ÿ</h4><p>binlog æ˜¯ä¸€ç§ç‰©ç†æ—¥å¿—ï¼Œ<strong>ä¼šåœ¨ç£ç›˜ä¸Šè®°å½•æ•°æ®åº“çš„æ‰€æœ‰ä¿®æ”¹æ“ä½œ</strong>ã€‚<br>å¦‚æžœè¯¯åˆ äº†æ•°æ®ï¼Œå°±å¯ä»¥ä½¿ç”¨ binlog è¿›è¡Œå›žé€€åˆ°è¯¯åˆ ä¹‹å‰çš„çŠ¶æ€ã€‚</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"># æ­¥éª¤<span class="number">1</span>ï¼šæ¢å¤å…¨é‡å¤‡ä»½</span><br><span class="line">mysql <span class="operator">-</span>u root <span class="operator">-</span>p <span class="operator">&lt;</span> full_backup.sql</span><br><span class="line"># æ­¥éª¤<span class="number">2</span>ï¼šåº”ç”¨Binlogåˆ°æŒ‡å®šæ—¶é—´ç‚¹</span><br><span class="line">mysqlbinlog <span class="comment">--start-datetime=&quot;2025-03-13 14:00:00&quot; --stop-datetime=&quot;2025-03-13 15:00:00&quot; binlog.000001 | mysql -u root -p</span></span><br></pre></td></tr></table></figure>
<p>å¦‚æžœè¦æ­å»ºä¸»ä»Žå¤åˆ¶ï¼Œå°±å¯ä»¥è®©ä»Žåº“å®šæ—¶è¯»å–ä¸»åº“çš„ binlogã€‚<br>MySQL æä¾›äº†ä¸‰ç§æ ¼å¼çš„ binlogï¼š<code>Statement</code>ã€<code>Row</code> å’Œ <code>Mixed</code>ï¼Œåˆ†åˆ«å¯¹åº” SQL è¯­å¥çº§åˆ«ã€è¡Œçº§åˆ«å’Œæ··åˆçº§åˆ«ï¼Œé»˜è®¤ä¸ºè¡Œçº§åˆ«ã€‚<br>ä»ŽåŽç¼€åä¸Šæ¥çœ‹ï¼Œbinlog æ–‡ä»¶åˆ†ä¸ºä¸¤ç±»ï¼šä»¥ <code>.index</code> ç»“å°¾çš„<strong>ç´¢å¼•æ–‡ä»¶</strong>ï¼Œä»¥ <code>.00000*</code> ç»“å°¾çš„<strong>äºŒè¿›åˆ¶æ—¥å¿—æ–‡ä»¶</strong>ã€‚<br><strong>binlog é»˜è®¤æ˜¯æ²¡æœ‰å¯ç”¨çš„ã€‚</strong></p>
<p>ç”Ÿäº§çŽ¯å¢ƒä¸­æ˜¯ä¸€å®šè¦å¯ç”¨çš„ï¼Œå¯ä»¥é€šè¿‡åœ¨ <code>my.cnf</code> æ–‡ä»¶ä¸­é…ç½® <code>log_bin</code> å‚æ•°ï¼Œä»¥å¯ç”¨ binlogã€‚</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">log_bin <span class="operator">=</span> mysql<span class="operator">-</span>bin #å¼€å¯binlog</span><br><span class="line">#mysql<span class="operator">-</span>bin.<span class="operator">*</span>æ—¥å¿—æ–‡ä»¶æœ€å¤§å­—èŠ‚ï¼ˆå•ä½ï¼šå­—èŠ‚ï¼‰</span><br><span class="line">#è®¾ç½®æœ€å¤§<span class="number">100</span>MB</span><br><span class="line">max_binlog_size<span class="operator">=</span><span class="number">104857600</span></span><br><span class="line"></span><br><span class="line">#è®¾ç½®äº†åªä¿ç•™<span class="number">7</span>å¤©BINLOGï¼ˆå•ä½ï¼šå¤©ï¼‰</span><br><span class="line">expire_logs_days <span class="operator">=</span> <span class="number">7</span></span><br><span class="line"></span><br><span class="line">#binlogæ—¥å¿—åªè®°å½•æŒ‡å®šåº“çš„æ›´æ–°</span><br><span class="line">#binlog<span class="operator">-</span>do<span class="operator">-</span>db<span class="operator">=</span>db_name</span><br><span class="line"></span><br><span class="line">#binlogæ—¥å¿—ä¸è®°å½•æŒ‡å®šåº“çš„æ›´æ–°</span><br><span class="line">#binlog<span class="operator">-</span>ignore<span class="operator">-</span>db<span class="operator">=</span>db_name</span><br><span class="line"></span><br><span class="line">#å†™ç¼“å†²å¤šå°‘æ¬¡ï¼Œåˆ·ä¸€æ¬¡ç£ç›˜ï¼Œé»˜è®¤<span class="number">0</span></span><br><span class="line">sync_binlog<span class="operator">=</span><span class="number">0</span></span><br></pre></td></tr></table></figure>
<h4 id="binlog-çš„é…ç½®å‚æ•°éƒ½äº†è§£å“ªäº›ï¼Ÿ"><a href="#binlog-çš„é…ç½®å‚æ•°éƒ½äº†è§£å“ªäº›ï¼Ÿ" class="headerlink" title="binlog çš„é…ç½®å‚æ•°éƒ½äº†è§£å“ªäº›ï¼Ÿ"></a>binlog çš„é…ç½®å‚æ•°éƒ½äº†è§£å“ªäº›ï¼Ÿ</h4><p><code>log_bin = mysql-bin </code>ç”¨äºŽ<strong>å¯ç”¨ binlog</strong>ï¼Œè¿™æ ·å°±å¯ä»¥åœ¨ MySQL çš„æ•°æ®ç›®å½•ä¸­æ‰¾åˆ° db-bin.000001ã€db-bin.000002 ç­‰æ—¥å¿—æ–‡ä»¶ã€‚<br><code>max_binlog_size=104857600</code> ç”¨äºŽè®¾ç½®<strong>æ¯ä¸ª binlog æ–‡ä»¶çš„å¤§å°</strong>ï¼Œä¸å»ºè®®è®¾ç½®å¤ªå¤§ï¼Œç½‘ç»œä¼ é€èµ·æ¥æ¯”è¾ƒéº»çƒ¦ã€‚<br>å½“ binlog æ–‡ä»¶è¾¾åˆ° <code>max_binlog_size</code> æ—¶ï¼ŒMySQL ä¼šå…³é—­å½“å‰æ–‡ä»¶å¹¶åˆ›å»ºä¸€ä¸ªæ–°çš„ binlog æ–‡ä»¶ã€‚<br><code>expire_logs_days = 7</code> ç”¨äºŽè®¾ç½® binlog æ–‡ä»¶çš„<strong>è‡ªåŠ¨è¿‡æœŸæ—¶é—´ä¸º 7 å¤©</strong>ã€‚è¿‡æœŸçš„ binlog æ–‡ä»¶ä¼šè¢«è‡ªåŠ¨åˆ é™¤ã€‚é˜²æ­¢é•¿æ—¶é—´ç´¯ç§¯çš„ binlog æ–‡ä»¶å ç”¨è¿‡å¤šå­˜å‚¨ç©ºé—´ï¼Œæ‰€ä»¥è¿™ä¸ªé…ç½®å¾ˆé‡è¦ã€‚<br><code>binlog-do-db=db_name</code>ï¼Œ<strong>æŒ‡å®šå“ªäº›æ•°æ®åº“è¡¨çš„æ›´æ–°åº”è¯¥è¢«è®°å½•</strong>ã€‚<br><code>binlog-ignore-db=db_name</code>ï¼ŒæŒ‡å®š<strong>å¿½ç•¥å“ªäº›æ•°æ®åº“è¡¨çš„æ›´æ–°</strong>ã€‚<br><code>sync_binlog=0</code>ï¼Œè®¾ç½®<strong>æ¯å¤šå°‘æ¬¡ binlog å†™æ“ä½œä¼šè§¦å‘ä¸€æ¬¡ç£ç›˜åŒæ­¥æ“ä½œ</strong>ã€‚é»˜è®¤å€¼ä¸º 0ï¼Œè¡¨ç¤º MySQL ä¸ä¼šä¸»åŠ¨è§¦å‘åŒæ­¥æ“ä½œï¼Œè€Œæ˜¯ä¾èµ–æ“ä½œç³»ç»Ÿçš„ç£ç›˜ç¼“å­˜ç­–ç•¥ã€‚<br>å³å½“æ‰§è¡Œå†™æ“ä½œæ—¶ï¼Œæ•°æ®ä¼šå…ˆå†™å…¥ç¼“å­˜ï¼Œå½“ç¼“å­˜åŒºæ»¡äº†å†ç”±æ“ä½œç³»ç»Ÿå°†æ•°æ®ä¸€æ¬¡æ€§åˆ·å…¥ç£ç›˜ã€‚<br>å¦‚æžœè®¾ç½®ä¸º 1ï¼Œè¡¨ç¤ºæ¯æ¬¡ binlog å†™æ“ä½œåŽéƒ½ä¼šåŒæ­¥åˆ°ç£ç›˜ï¼Œè™½ç„¶å¯ä»¥ä¿è¯æ•°æ®èƒ½å¤ŸåŠæ—¶å†™å…¥ç£ç›˜ï¼Œä½†ä¼šé™ä½Žæ€§èƒ½ã€‚<br>å¯ä»¥é€šè¿‡ <code>show variables like &#39;%log_bin%&#39;;</code> æŸ¥çœ‹ <code>binlog</code> æ˜¯å¦å¼€å¯ã€‚</p>
<h4 id="æœ‰äº†binlogä¸ºä»€ä¹ˆè¿˜è¦undolog-redologï¼Ÿ"><a href="#æœ‰äº†binlogä¸ºä»€ä¹ˆè¿˜è¦undolog-redologï¼Ÿ" class="headerlink" title="æœ‰äº†binlogä¸ºä»€ä¹ˆè¿˜è¦undolog redologï¼Ÿ"></a>æœ‰äº†binlogä¸ºä»€ä¹ˆè¿˜è¦undolog redologï¼Ÿ</h4><p><code>binlog</code> å±žäºŽ <code>Server</code> å±‚ï¼Œä¸Žå­˜å‚¨å¼•æ“Žæ— å…³ï¼Œ<strong>æ— æ³•ç›´æŽ¥æ“ä½œç‰©ç†æ•°æ®é¡µ</strong>ã€‚è€Œ <code>redo log</code> å’Œ <code>undo log</code> æ˜¯ <code>InnoDB</code> å­˜å‚¨å¼•æ“Žå®žçŽ° ACIDçš„åŸºçŸ³ã€‚<br>â€”â€”â€”â€”â€“psâ€”â€”â€”â€”-<br><strong>ACID:</strong></p>
<ul>
<li>**åŽŸå­æ€§(Atomicity)**ï¼š<br>äº‹åŠ¡æ˜¯ä¸€ä¸ªä¸å¯åˆ†å‰²çš„å·¥ä½œå•ä½ï¼Œäº‹åŠ¡ä¸­çš„æ“ä½œè¦ä¹ˆå…¨éƒ¨æˆåŠŸï¼Œè¦ä¹ˆå…¨éƒ¨å¤±è´¥å›žæ»š<br>é€šè¿‡undo logå®žçŽ°ï¼Œè®°å½•äº‹åŠ¡å¼€å§‹å‰çš„çŠ¶æ€ï¼Œç”¨äºŽå›žæ»š</li>
<li>**ä¸€è‡´æ€§(Consistency)**ï¼š<br>äº‹åŠ¡æ‰§è¡Œå‰åŽï¼Œæ•°æ®åº“ä»Žä¸€ä¸ªä¸€è‡´çŠ¶æ€è½¬å˜ä¸ºå¦ä¸€ä¸ªä¸€è‡´çŠ¶æ€<br>é€šè¿‡å…¶ä»–ä¸‰ä¸ªç‰¹æ€§(AID)å…±åŒä¿è¯</li>
<li>**éš”ç¦»æ€§(Isolation)**ï¼š<br>å¤šä¸ªå¹¶å‘äº‹åŠ¡æ‰§è¡Œæ—¶ï¼Œä¸€ä¸ªäº‹åŠ¡çš„æ‰§è¡Œä¸åº”å½±å“å…¶ä»–äº‹åŠ¡<br>é€šè¿‡é”æœºåˆ¶å’ŒMVCC(å¤šç‰ˆæœ¬å¹¶å‘æŽ§åˆ¶)å®žçŽ°</li>
<li>**æŒä¹…æ€§(Durability)**ï¼š<br>äº‹åŠ¡ä¸€æ—¦æäº¤ï¼Œå…¶ç»“æžœå°±æ˜¯æ°¸ä¹…æ€§çš„<br>é€šè¿‡redo logå®žçŽ°ï¼Œå³ä½¿ç³»ç»Ÿå´©æºƒä¹Ÿèƒ½æ¢å¤æ•°æ®</li>
</ul>
<p>â€”â€”â€”â€”â€“psâ€”â€”â€”â€”-</p>
<p><code>binlog</code> å…³æ³¨çš„æ˜¯<strong>é€»è¾‘å˜æ›´çš„å…¨å±€è®°å½•</strong>ï¼›<code>redo log</code> ç”¨äºŽ<strong>ç¡®ä¿ç‰©ç†å˜æ›´çš„æŒä¹…æ€§</strong>ï¼Œç¡®ä¿äº‹åŠ¡æœ€ç»ˆèƒ½å¤Ÿåˆ·ç›˜æˆåŠŸï¼›<code>undo log</code> æ˜¯<strong>é€»è¾‘é€†å‘æ“ä½œæ—¥å¿—</strong>ï¼Œè®°å½•çš„æ˜¯æ—§å€¼ï¼Œæ–¹ä¾¿æ¢å¤åˆ°äº‹åŠ¡å¼€å§‹å‰çš„çŠ¶æ€ã€‚</p>
<p><strong>å¦å¤–ä¸€ç§å›žç­”æ–¹å¼ã€‚</strong></p>
<p><code>binlog</code> ä¼šè®°å½•<strong>æ•´ä¸ª SQL æˆ–è¡Œå˜åŒ–</strong>ï¼›<code>redo log</code> æ˜¯ä¸ºäº†æ¢å¤<strong>å·²æäº¤ä½†æœªåˆ·ç›˜</strong>çš„æ•°æ®ï¼Œ<code>undo log</code> æ˜¯ä¸ºäº†<strong>æ’¤é”€æœªæäº¤çš„äº‹åŠ¡</strong>ã€‚</p>
<p>ä»¥ä¸€æ¬¡äº‹åŠ¡æ›´æ–°ä¸ºä¾‹ï¼š</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"># å¼€å¯äº‹åŠ¡</span><br><span class="line"><span class="keyword">BEGIN</span>;</span><br><span class="line"># æ›´æ–°æ•°æ®</span><br><span class="line"><span class="keyword">UPDATE</span> users <span class="keyword">SET</span> age <span class="operator">=</span> age <span class="operator">+</span> <span class="number">1</span> <span class="keyword">WHERE</span> id <span class="operator">=</span> <span class="number">1</span>;</span><br><span class="line"># æäº¤äº‹åŠ¡</span><br><span class="line"><span class="keyword">COMMIT</span>;</span><br></pre></td></tr></table></figure>
<p><strong>äº‹åŠ¡å¼€å§‹</strong>çš„æ—¶å€™ä¼šç”Ÿæˆ <code>undo log</code>ï¼Œè®°å½•æ›´æ–°å‰çš„æ•°æ®ï¼Œæ¯”å¦‚åŽŸå€¼æ˜¯ 18ï¼š</p>
<pre><code>undo log: id=1, age=18
</code></pre>
<p>ä¿®æ”¹æ•°æ®çš„æ—¶å€™ï¼Œä¼šå°†æ•°æ®å†™å…¥åˆ° <code>redo log</code>ã€‚</p>
<p>æ¯”å¦‚æ•°æ®é¡µ <code>page_id=123</code> ä¸Šï¼Œid&#x3D;1 çš„ç”¨æˆ·è¢«æ›´æ–°ä¸º age&#x3D;26ï¼š</p>
<pre><code>redo log (prepare):
page_id=123, offset=0x40, before=18, after=26
</code></pre>
<p>ç­‰äº‹åŠ¡æäº¤çš„æ—¶å€™ï¼Œ<code>redo log</code> åˆ·ç›˜ï¼Œ<code>binlog</code> åˆ·ç›˜ã€‚</p>
<p><code>binlog</code> å†™å®Œä¹‹åŽï¼Œ<code>redo log</code> çš„çŠ¶æ€ä¼šå˜ä¸º <code>commit</code>ï¼š</p>
<pre><code>redo log (commit):
page_id=123, offset=0x40, before=18, after=26
</code></pre>
<p>binlog å¦‚æžœæ˜¯ <code>Statement</code> æ ¼å¼ï¼Œä¼šè®°å½•ä¸€æ¡ SQL è¯­å¥ï¼š<br>    UPDATE users SET age &#x3D; age + 1 WHERE id &#x3D; 1;<br>binlog å¦‚æžœæ˜¯ <code>Row</code> æ ¼å¼ï¼Œä¼šè®°å½•ï¼š</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">è¡¨ï¼šusers</span><br><span class="line">before: id<span class="operator">=</span><span class="number">1</span>, age<span class="operator">=</span><span class="number">18</span></span><br><span class="line">after:  id<span class="operator">=</span><span class="number">1</span>, age<span class="operator">=</span><span class="number">26</span></span><br></pre></td></tr></table></figure>
<p>éšåŽï¼ŒåŽå°çº¿ç¨‹ä¼šå°† redo log ä¸­çš„å˜æ›´å¼‚æ­¥åˆ·æ–°åˆ°ç£ç›˜ã€‚</p>
<h4 id="è¯¦ç»†æŽ¢ç©¶ä¸€ä¸‹binlog-é•¿æ–‡è­¦å‘Šâš ï¸"><a href="#è¯¦ç»†æŽ¢ç©¶ä¸€ä¸‹binlog-é•¿æ–‡è­¦å‘Šâš ï¸" class="headerlink" title="è¯¦ç»†æŽ¢ç©¶ä¸€ä¸‹binlog(é•¿æ–‡è­¦å‘Šâš ï¸):"></a>è¯¦ç»†æŽ¢ç©¶ä¸€ä¸‹binlog(é•¿æ–‡è­¦å‘Šâš ï¸):</h4><p>MySQL çš„ Binlog æ—¥å¿—æ˜¯ä¸€ç§äºŒè¿›åˆ¶æ ¼å¼çš„æ—¥å¿—ï¼ŒBinlog è®°å½•æ‰€æœ‰çš„ DDL å’Œ DML è¯­å¥(é™¤äº†æ•°æ®æŸ¥è¯¢è¯­å¥SELECTã€SHOWç­‰)ï¼Œä»¥ Event çš„å½¢å¼è®°å½•ï¼ŒåŒæ—¶è®°å½•è¯­å¥æ‰§è¡Œæ—¶é—´ã€‚</p>
<h5 id="Binlog-çš„ä¸»è¦ä½œç”¨æœ‰ä¸¤ä¸ªï¼š"><a href="#Binlog-çš„ä¸»è¦ä½œç”¨æœ‰ä¸¤ä¸ªï¼š" class="headerlink" title="Binlog çš„ä¸»è¦ä½œç”¨æœ‰ä¸¤ä¸ªï¼š"></a>Binlog çš„ä¸»è¦ä½œç”¨æœ‰ä¸¤ä¸ªï¼š</h5><p><strong>1. æ•°æ®æ¢å¤:</strong><br>å› ä¸º Binlog è¯¦ç»†è®°å½•äº†æ‰€æœ‰ä¿®æ”¹æ•°æ®çš„ SQLï¼Œå½“æŸä¸€æ—¶åˆ»çš„æ•°æ®è¯¯æ“ä½œè€Œå¯¼è‡´å‡ºé—®é¢˜ï¼Œæˆ–è€…æ•°æ®åº“å®•æœºæ•°æ®ä¸¢å¤±ï¼Œé‚£ä¹ˆå¯ä»¥æ ¹æ® Binlog æ¥å›žæ”¾åŽ†å²æ•°æ®ã€‚<br><strong>2. ä¸»ä»Žå¤åˆ¶:</strong><br>æƒ³è¦åšå¤šæœºå¤‡ä»½çš„ä¸šåŠ¡ï¼Œå¯ä»¥åŽ»ç›‘å¬å½“å‰å†™åº“çš„ Binlog æ—¥å¿—ï¼ŒåŒæ­¥å†™åº“çš„æ‰€æœ‰æ›´æ”¹ã€‚</p>
<p><strong>Binlog åŒ…æ‹¬ä¸¤ç±»æ–‡ä»¶ï¼š</strong><br><code>äºŒè¿›åˆ¶æ—¥å¿—ç´¢å¼•æ–‡ä»¶(.index)</code>ï¼šè®°å½•æ‰€æœ‰çš„äºŒè¿›åˆ¶æ–‡ä»¶ã€‚<br><code>äºŒè¿›åˆ¶æ—¥å¿—æ–‡ä»¶(.00000*)</code>ï¼šè®°å½•æ‰€æœ‰ <code>DDL</code> å’Œ <code>DML</code> è¯­å¥äº‹ä»¶ã€‚</p>
<p>Binlog æ—¥å¿—åŠŸèƒ½<strong>é»˜è®¤æ˜¯å¼€å¯</strong>çš„ï¼Œçº¿ä¸Šæƒ…å†µä¸‹ Binlog æ—¥å¿—çš„å¢žé•¿é€Ÿåº¦æ˜¯å¾ˆå¿«çš„ï¼Œåœ¨ MySQL çš„é…ç½®æ–‡ä»¶ <code>my.cnf</code> ä¸­æä¾›ä¸€äº›å‚æ•°æ¥å¯¹ Binlog è¿›è¡Œè®¾ç½®ã€‚</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">#è®¾ç½®æ­¤å‚æ•°è¡¨ç¤ºå¯ç”¨binlogåŠŸèƒ½ï¼Œå¹¶åˆ¶å®šäºŒè¿›åˆ¶æ—¥å¿—çš„å­˜å‚¨ç›®å½•</span><br><span class="line">log<span class="operator">-</span>bin<span class="operator">=</span><span class="operator">/</span>home<span class="operator">/</span>mysql<span class="operator">/</span>binlog<span class="operator">/</span></span><br><span class="line"></span><br><span class="line">#mysql<span class="operator">-</span>bin.<span class="operator">*</span>æ—¥å¿—æ–‡ä»¶æœ€å¤§å­—èŠ‚ï¼ˆå•ä½ï¼šå­—èŠ‚ï¼‰</span><br><span class="line">#è®¾ç½®æœ€å¤§<span class="number">100</span>MB</span><br><span class="line">max_binlog_size<span class="operator">=</span><span class="number">104857600</span></span><br><span class="line"></span><br><span class="line">#è®¾ç½®äº†åªä¿ç•™<span class="number">7</span>å¤©BINLOGï¼ˆå•ä½ï¼šå¤©ï¼‰</span><br><span class="line">expire_logs_days <span class="operator">=</span> <span class="number">7</span></span><br><span class="line"></span><br><span class="line">#binlogæ—¥å¿—åªè®°å½•æŒ‡å®šåº“çš„æ›´æ–°</span><br><span class="line">#binlog<span class="operator">-</span>do<span class="operator">-</span>db<span class="operator">=</span>db_name</span><br><span class="line"></span><br><span class="line">#binlogæ—¥å¿—ä¸è®°å½•æŒ‡å®šåº“çš„æ›´æ–°</span><br><span class="line">#binlog<span class="operator">-</span>ignore<span class="operator">-</span>db<span class="operator">=</span>db_name</span><br><span class="line"></span><br><span class="line">#å†™ç¼“å†²å¤šå°‘æ¬¡ï¼Œåˆ·ä¸€æ¬¡ç£ç›˜ï¼Œé»˜è®¤<span class="number">0</span></span><br><span class="line">sync_binlog<span class="operator">=</span><span class="number">0</span></span><br></pre></td></tr></table></figure>
<p><strong>éœ€è¦æ³¨æ„çš„æ˜¯ï¼š</strong><br><code>max_binlog_size</code> ï¼šBinlog æœ€å¤§å’Œé»˜è®¤å€¼æ˜¯ 1Gï¼Œè¯¥è®¾ç½®å¹¶ä¸èƒ½ä¸¥æ ¼æŽ§åˆ¶ Binlog çš„å¤§å°ï¼Œå°¤å…¶æ˜¯ Binlog æ¯”è¾ƒé è¿‘æœ€å¤§å€¼è€Œåˆé‡åˆ°ä¸€ä¸ªæ¯”è¾ƒå¤§äº‹åŠ¡æ—¶ï¼Œä¸ºäº†ä¿è¯äº‹åŠ¡çš„å®Œæ•´æ€§ä¸å¯èƒ½åšåˆ‡æ¢æ—¥å¿—çš„åŠ¨ä½œï¼Œåªèƒ½å°†è¯¥äº‹åŠ¡çš„æ‰€æœ‰ SQL éƒ½è®°å½•è¿›å½“å‰æ—¥å¿—ç›´åˆ°äº‹åŠ¡ç»“æŸã€‚æ‰€ä»¥çœŸå®žæ–‡ä»¶æœ‰æ—¶å€™ä¼šå¤§äºŽ max_binlog_size è®¾å®šå€¼ã€‚<br><code>expire_logs_days</code> ï¼šBinlog è¿‡æœŸåˆ é™¤ä¸æ˜¯æœåŠ¡å®šæ—¶æ‰§è¡Œï¼Œæ˜¯éœ€è¦å€ŸåŠ©äº‹ä»¶è§¦å‘æ‰æ‰§è¡Œï¼Œäº‹ä»¶åŒ…æ‹¬ï¼š</p>
<ul>
<li>æœåŠ¡å™¨é‡å¯</li>
<li>æœåŠ¡å™¨è¢«æ›´æ–°</li>
<li>æ—¥å¿—è¾¾åˆ°äº†æœ€å¤§æ—¥å¿—é•¿åº¦ max_binlog_size</li>
<li>æ—¥å¿—è¢«åˆ·æ–°</li>
</ul>
<p>äºŒè¿›åˆ¶æ—¥å¿—ç”±é…ç½®æ–‡ä»¶çš„ <code>log-bin</code> é€‰é¡¹è´Ÿè´£å¯ç”¨ï¼ŒMySQL æœåŠ¡å™¨å°†åœ¨æ•°æ®æ ¹ç›®å½•åˆ›å»ºä¸¤ä¸ªæ–°æ–‡ä»¶mysql-bin.000001 å’Œ mysql-bin.indexï¼Œè‹¥é…ç½®é€‰é¡¹æ²¡æœ‰ç»™å‡ºæ–‡ä»¶åï¼ŒMySQL å°†ä½¿ç”¨ä¸»æœºåç§°å‘½åè¿™ä¸¤ä¸ªæ–‡ä»¶ï¼Œå…¶ä¸­ <code>.index</code> æ–‡ä»¶åŒ…å«ä¸€ä»½å…¨ä½“æ—¥å¿—æ–‡ä»¶çš„æ¸…å•ã€‚</p>
<p><code>sync_binlog</code>ï¼šè¿™ä¸ªå‚æ•°å†³å®šäº† Binlog æ—¥å¿—çš„æ›´æ–°é¢‘çŽ‡ã€‚é»˜è®¤ 0 ï¼Œè¡¨ç¤ºè¯¥æ“ä½œç”±æ“ä½œç³»ç»Ÿæ ¹æ®è‡ªèº«è´Ÿè½½è‡ªè¡Œå†³å®šå¤šä¹…å†™ä¸€æ¬¡ç£ç›˜ã€‚</p>
<p><code>sync_binlog = 1</code> è¡¨ç¤ºæ¯ä¸€æ¡äº‹åŠ¡æäº¤éƒ½ä¼šç«‹åˆ»å†™ç›˜ã€‚<code>sync_binlog=n</code> è¡¨ç¤º n ä¸ªäº‹åŠ¡æäº¤æ‰ä¼šå†™ç›˜ã€‚</p>
<p>æ ¹æ® MySQL æ–‡æ¡£ï¼Œå†™ Binlog çš„æ—¶æœºæ˜¯ï¼š<code>SQL transaction</code> æ‰§è¡Œå®Œï¼Œä½†ä»»ä½•ç›¸å…³çš„ Locks è¿˜<strong>æœªé‡Šæ”¾</strong>æˆ–<strong>äº‹åŠ¡è¿˜æœªæœ€ç»ˆ commit</strong> å‰ã€‚è¿™æ ·ä¿è¯äº† Binlog è®°å½•çš„æ“ä½œæ—¶åºä¸Žæ•°æ®åº“å®žé™…çš„æ•°æ®å˜æ›´é¡ºåºä¸€è‡´ã€‚</p>
<p><strong>æ£€æŸ¥ Binlog æ–‡ä»¶æ˜¯å¦å·²å¼€å¯ï¼š</strong></p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">mysql<span class="operator">&gt;</span> <span class="keyword">show</span> variables <span class="keyword">like</span> <span class="string">&#x27;%log_bin%&#x27;</span>;</span><br><span class="line"><span class="operator">+</span><span class="comment">---------------------------------+------------------------------------+</span></span><br><span class="line"><span class="operator">|</span> Variable_name                   <span class="operator">|</span> <span class="keyword">Value</span>                              <span class="operator">|</span></span><br><span class="line"><span class="operator">+</span><span class="comment">---------------------------------+------------------------------------+</span></span><br><span class="line"><span class="operator">|</span> log_bin                         <span class="operator">|</span> <span class="keyword">ON</span>                                 <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span> log_bin_basename                <span class="operator">|</span> <span class="operator">/</span>usr<span class="operator">/</span><span class="keyword">local</span><span class="operator">/</span>mysql<span class="operator">/</span>data<span class="operator">/</span>binlog       <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span> log_bin_index                   <span class="operator">|</span> <span class="operator">/</span>usr<span class="operator">/</span><span class="keyword">local</span><span class="operator">/</span>mysql<span class="operator">/</span>data<span class="operator">/</span>binlog.index <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span> log_bin_trust_function_creators <span class="operator">|</span> OFF                                <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span> log_bin_use_v1_row_events       <span class="operator">|</span> OFF                                <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span> sql_log_bin                     <span class="operator">|</span> <span class="keyword">ON</span>                                 <span class="operator">|</span></span><br><span class="line"><span class="operator">+</span><span class="comment">---------------------------------+------------------------------------+</span></span><br><span class="line"><span class="number">6</span> <span class="keyword">rows</span> <span class="keyword">in</span> <span class="keyword">set</span> (<span class="number">0.00</span> sec)</span><br></pre></td></tr></table></figure>
<p>MySQL ä¼šæŠŠç”¨æˆ·å¯¹æ‰€æœ‰æ•°æ®åº“çš„å†…å®¹å’Œç»“æž„çš„ä¿®æ”¹æƒ…å†µè®°å…¥ <code>mysql-bin.n</code> æ–‡ä»¶ï¼Œè€Œä¸ä¼šè®°å½• <code>SELECT</code> å’Œæ²¡æœ‰å®žé™…æ›´æ–°çš„ <code>UPDATE</code> è¯­å¥ã€‚</p>
<p>å¦‚æžœä½ ä¸çŸ¥é“çŽ°åœ¨æœ‰å“ªäº› Binlog æ–‡ä»¶ï¼Œå¯ä»¥ä½¿ç”¨å¦‚ä¸‹å‘½ä»¤ï¼š</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">show</span> <span class="type">binary</span> logs; #æŸ¥çœ‹binlogåˆ—è¡¨</span><br><span class="line"><span class="keyword">show</span> master status; #æŸ¥çœ‹æœ€æ–°çš„binlog</span><br><span class="line"></span><br><span class="line">mysql<span class="operator">&gt;</span> <span class="keyword">show</span> <span class="type">binary</span> logs;</span><br><span class="line"><span class="operator">+</span><span class="comment">------------------+-----------+-----------+</span></span><br><span class="line"><span class="operator">|</span> Log_name         <span class="operator">|</span> File_size <span class="operator">|</span> Encrypted <span class="operator">|</span></span><br><span class="line"><span class="operator">+</span><span class="comment">------------------+-----------+-----------+</span></span><br><span class="line"><span class="operator">|</span> mysql<span class="operator">-</span>bin<span class="number">.000001</span> <span class="operator">|</span>       <span class="number">179</span> <span class="operator">|</span> <span class="keyword">No</span>        <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span> mysql<span class="operator">-</span>bin<span class="number">.000002</span> <span class="operator">|</span>       <span class="number">156</span> <span class="operator">|</span> <span class="keyword">No</span>        <span class="operator">|</span></span><br><span class="line"><span class="operator">+</span><span class="comment">------------------+-----------+-----------+</span></span><br><span class="line"><span class="number">2</span> <span class="keyword">rows</span> <span class="keyword">in</span> <span class="keyword">set</span> (<span class="number">0.00</span> sec)</span><br></pre></td></tr></table></figure>
<p>Binlog æ–‡ä»¶æ˜¯äºŒè¿›åˆ¶æ–‡ä»¶ï¼Œå¼ºè¡Œæ‰“å¼€çœ‹åˆ°çš„å¿…ç„¶æ˜¯ä¹±ç ï¼ŒMySQL æä¾›äº†å‘½ä»¤è¡Œçš„æ–¹å¼æ¥å±•ç¤º Binlog æ—¥å¿—ï¼š</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mysqlbinlog mysql<span class="operator">-</span>bin<span class="number">.000002</span> <span class="operator">|</span> more</span><br></pre></td></tr></table></figure>
<p>mysqlbinlog å‘½ä»¤å³å¯æŸ¥çœ‹ã€‚<br>è™½ç„¶çœ‹èµ·æ¥å‡Œä¹±å…¶å®žä¹Ÿæœ‰è¿¹å¯å¾ªã€‚<code>Binlog</code> é€šè¿‡äº‹ä»¶çš„æ–¹å¼æ¥ç®¡ç†æ—¥å¿—ä¿¡æ¯ï¼Œå¯ä»¥é€šè¿‡ <code>show binlog events in</code> çš„è¯­æ³•æ¥æŸ¥çœ‹å½“å‰ <code>Binlog</code> æ–‡ä»¶å¯¹åº”çš„è¯¦ç»†äº‹ä»¶ä¿¡æ¯ã€‚</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">mysql<span class="operator">&gt;</span> <span class="keyword">show</span> binlog events <span class="keyword">in</span> <span class="string">&#x27;mysql-bin.000001&#x27;</span>;</span><br><span class="line"><span class="operator">+</span><span class="comment">------------------+-----+----------------+-----------+-------------+-----------------------------------+</span></span><br><span class="line"><span class="operator">|</span> Log_name         <span class="operator">|</span> Pos <span class="operator">|</span> Event_type     <span class="operator">|</span> Server_id <span class="operator">|</span> End_log_pos <span class="operator">|</span> Info                              <span class="operator">|</span></span><br><span class="line"><span class="operator">+</span><span class="comment">------------------+-----+----------------+-----------+-------------+-----------------------------------+</span></span><br><span class="line"><span class="operator">|</span> mysql<span class="operator">-</span>bin<span class="number">.000001</span> <span class="operator">|</span>   <span class="number">4</span> <span class="operator">|</span> Format_desc    <span class="operator">|</span>         <span class="number">1</span> <span class="operator">|</span>         <span class="number">125</span> <span class="operator">|</span> Server ver: <span class="number">8.0</span><span class="number">.21</span>, Binlog ver: <span class="number">4</span> <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span> mysql<span class="operator">-</span>bin<span class="number">.000001</span> <span class="operator">|</span> <span class="number">125</span> <span class="operator">|</span> Previous_gtids <span class="operator">|</span>         <span class="number">1</span> <span class="operator">|</span>         <span class="number">156</span> <span class="operator">|</span>                                   <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span> mysql<span class="operator">-</span>bin<span class="number">.000001</span> <span class="operator">|</span> <span class="number">156</span> <span class="operator">|</span> Stop           <span class="operator">|</span>         <span class="number">1</span> <span class="operator">|</span>         <span class="number">179</span> <span class="operator">|</span>                                   <span class="operator">|</span></span><br><span class="line"><span class="operator">+</span><span class="comment">------------------+-----+----------------+-----------+-------------+-----------------------------------+</span></span><br><span class="line"><span class="number">3</span> <span class="keyword">rows</span> <span class="keyword">in</span> <span class="keyword">set</span> (<span class="number">0.01</span> sec)</span><br></pre></td></tr></table></figure>
<p>è¿™æ˜¯ä¸€ä»½æ²¡æœ‰ä»»ä½•å†™å…¥æ•°æ®çš„ <code>Binlog</code> æ—¥å¿—æ–‡ä»¶ã€‚<br><code>Binlog</code> çš„ç‰ˆæœ¬æ˜¯V4ï¼Œå¯ä»¥çœ‹åˆ°æ—¥å¿—çš„ç»“æŸæ—¶é—´ä¸º Stopã€‚å‡ºçŽ° Stop event æœ‰ä¸¤ç§æƒ…å†µï¼š</p>
<ol>
<li>æ˜¯ master shut down çš„æ—¶å€™ä¼šåœ¨ <code>Binlog</code> æ–‡ä»¶ç»“å°¾å‡ºçŽ°</li>
<li>æ˜¯å¤‡æœºåœ¨å…³é—­çš„æ—¶å€™ä¼šå†™å…¥ <code>relay log</code> ç»“å°¾ï¼Œæˆ–è€…æ‰§è¡Œ <code>RESET SLAVE</code> å‘½ä»¤æ‰§è¡Œ</li>
</ol>
<p>æœ¬æ–‡å‡ºçŽ°çš„åŽŸå› æ˜¯æˆ‘æœ‰<strong>æ‰‹åŠ¨åœæ­¢è¿‡ MySQL æœåŠ¡</strong>ã€‚<br>ä¸€èˆ¬æ¥è¯´ä¸€ä»½æ­£å¸¸çš„ <code>Binlog</code> æ—¥å¿—æ–‡ä»¶ä¼šä»¥ Rotate event ç»“æŸã€‚å½“ <code>Binlog</code> æ–‡ä»¶è¶…è¿‡æŒ‡å®šå¤§å°ï¼ŒRotate event ä¼šå†™åœ¨æ–‡ä»¶æœ€åŽï¼ŒæŒ‡å‘ä¸‹ä¸€ä¸ª <code>Binlog</code> æ–‡ä»¶ã€‚<br>æˆ‘ä»¬æ¥çœ‹çœ‹æœ‰è¿‡æ•°æ®æ“ä½œçš„ <code>Binlog</code> æ—¥å¿—æ–‡ä»¶æ˜¯ä»€ä¹ˆæ ·å­çš„ã€‚</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">mysql<span class="operator">&gt;</span> <span class="keyword">show</span> binlog events <span class="keyword">in</span> <span class="string">&#x27;mysql-bin.000002&#x27;</span>;</span><br><span class="line"><span class="operator">+</span><span class="comment">------------------+-----+----------------+-----------+-------------+-----------------------------------+</span></span><br><span class="line"><span class="operator">|</span> Log_name         <span class="operator">|</span> Pos <span class="operator">|</span> Event_type     <span class="operator">|</span> Server_id <span class="operator">|</span> End_log_pos <span class="operator">|</span> Info                              <span class="operator">|</span></span><br><span class="line"><span class="operator">+</span><span class="comment">------------------+-----+----------------+-----------+-------------+-----------------------------------+</span></span><br><span class="line"><span class="operator">|</span> mysql<span class="operator">-</span>bin<span class="number">.000002</span> <span class="operator">|</span>   <span class="number">4</span> <span class="operator">|</span> Format_desc    <span class="operator">|</span>         <span class="number">1</span> <span class="operator">|</span>         <span class="number">125</span> <span class="operator">|</span> Server ver: <span class="number">8.0</span><span class="number">.21</span>, Binlog ver: <span class="number">4</span> <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span> mysql<span class="operator">-</span>bin<span class="number">.000002</span> <span class="operator">|</span> <span class="number">125</span> <span class="operator">|</span> Previous_gtids <span class="operator">|</span>         <span class="number">1</span> <span class="operator">|</span>         <span class="number">156</span> <span class="operator">|</span>                                   <span class="operator">|</span></span><br><span class="line"><span class="operator">+</span><span class="comment">------------------+-----+----------------+-----------+-------------+-----------------------------------+</span></span><br><span class="line"><span class="number">2</span> <span class="keyword">rows</span> <span class="keyword">in</span> <span class="keyword">set</span> (<span class="number">0.00</span> sec)</span><br></pre></td></tr></table></figure>
<p>ä¸Šé¢æ˜¯æ²¡æœ‰ä»»ä½•æ•°æ®æ“ä½œä¸”æ²¡æœ‰è¢«æˆªæ–­çš„ Binlogã€‚æŽ¥ä¸‹æ¥æˆ‘ä»¬æ’å…¥ä¸€æ¡æ•°æ®ï¼Œå†çœ‹çœ‹ Binlog äº‹ä»¶ã€‚</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">mysql<span class="operator">&gt;</span> <span class="keyword">show</span> binlog events <span class="keyword">in</span> <span class="string">&#x27;mysql-bin.000002&#x27;</span>;</span><br><span class="line"><span class="operator">+</span><span class="comment">------------------+-----+----------------+-----------+-------------+-------------------------------------------------------------------------+</span></span><br><span class="line"><span class="operator">|</span> Log_name         <span class="operator">|</span> Pos <span class="operator">|</span> Event_type     <span class="operator">|</span> Server_id <span class="operator">|</span> End_log_pos <span class="operator">|</span> Info                                                                    <span class="operator">|</span></span><br><span class="line"><span class="operator">+</span><span class="comment">------------------+-----+----------------+-----------+-------------+-------------------------------------------------------------------------+</span></span><br><span class="line"><span class="operator">|</span> mysql<span class="operator">-</span>bin<span class="number">.000002</span> <span class="operator">|</span>   <span class="number">4</span> <span class="operator">|</span> Format_desc    <span class="operator">|</span>         <span class="number">1</span> <span class="operator">|</span>         <span class="number">125</span> <span class="operator">|</span> Server ver: <span class="number">8.0</span><span class="number">.21</span>, Binlog ver: <span class="number">4</span>                                       <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span> mysql<span class="operator">-</span>bin<span class="number">.000002</span> <span class="operator">|</span> <span class="number">125</span> <span class="operator">|</span> Previous_gtids <span class="operator">|</span>         <span class="number">1</span> <span class="operator">|</span>         <span class="number">156</span> <span class="operator">|</span>                                                                         <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span> mysql<span class="operator">-</span>bin<span class="number">.000002</span> <span class="operator">|</span> <span class="number">156</span> <span class="operator">|</span> Anonymous_Gtid <span class="operator">|</span>         <span class="number">1</span> <span class="operator">|</span>         <span class="number">235</span> <span class="operator">|</span> <span class="keyword">SET</span> @<span class="variable">@SESSION</span>.GTID_NEXT<span class="operator">=</span> <span class="string">&#x27;ANONYMOUS&#x27;</span>                                    <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span> mysql<span class="operator">-</span>bin<span class="number">.000002</span> <span class="operator">|</span> <span class="number">235</span> <span class="operator">|</span> Query          <span class="operator">|</span>         <span class="number">1</span> <span class="operator">|</span>         <span class="number">323</span> <span class="operator">|</span> <span class="keyword">BEGIN</span>                                                                   <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span> mysql<span class="operator">-</span>bin<span class="number">.000002</span> <span class="operator">|</span> <span class="number">323</span> <span class="operator">|</span> Intvar         <span class="operator">|</span>         <span class="number">1</span> <span class="operator">|</span>         <span class="number">355</span> <span class="operator">|</span> INSERT_ID<span class="operator">=</span><span class="number">13</span>                                                            <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span> mysql<span class="operator">-</span>bin<span class="number">.000002</span> <span class="operator">|</span> <span class="number">355</span> <span class="operator">|</span> Query          <span class="operator">|</span>         <span class="number">1</span> <span class="operator">|</span>         <span class="number">494</span> <span class="operator">|</span> use `test_db`; <span class="keyword">INSERT INTO</span> `test_db`.`test_db`(`name`) <span class="keyword">VALUES</span> (<span class="string">&#x27;xdfdf&#x27;</span>) <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span> mysql<span class="operator">-</span>bin<span class="number">.000002</span> <span class="operator">|</span> <span class="number">494</span> <span class="operator">|</span> Xid            <span class="operator">|</span>         <span class="number">1</span> <span class="operator">|</span>         <span class="number">525</span> <span class="operator">|</span> <span class="keyword">COMMIT</span> <span class="comment">/* xid=192 */</span>                                                    <span class="operator">|</span></span><br><span class="line"><span class="operator">+</span><span class="comment">------------------+-----+----------------+-----------+-------------+-------------------------------------------------------------------------+</span></span><br><span class="line"><span class="number">7</span> <span class="keyword">rows</span> <span class="keyword">in</span> <span class="keyword">set</span> (<span class="number">0.00</span> sec)</span><br></pre></td></tr></table></figure>

<p>è¿™æ˜¯åŠ å…¥ä¸€æ¡æ•°æ®ä¹‹åŽçš„ <code>Binlog</code> äº‹ä»¶ã€‚</p>
<p><strong>æˆ‘ä»¬å¯¹ event æŸ¥è¯¢çš„æ•°æ®è¡Œå…³é”®å­—æ®µæ¥è§£é‡Šä¸€ä¸‹ï¼š</strong></p>
<ul>
<li><code>Pos</code>ï¼šå½“å‰äº‹ä»¶çš„å¼€å§‹ä½ç½®ï¼Œæ¯ä¸ªäº‹ä»¶éƒ½å ç”¨å›ºå®šçš„å­—èŠ‚å¤§å°ï¼Œç»“æŸä½ç½®(End_log_position)å‡åŽ»Posï¼Œå°±æ˜¯è¿™ä¸ªäº‹ä»¶å ç”¨çš„å­—èŠ‚æ•°ã€‚<br>ä¸Šé¢çš„æ—¥å¿—ä¸­æˆ‘ä»¬èƒ½çœ‹åˆ°ï¼Œç¬¬ä¸€ä¸ªäº‹ä»¶ä½ç½®å¹¶ä¸æ˜¯ä»Ž 0 å¼€å§‹ï¼Œè€Œæ˜¯ä»Ž 4ã€‚MySQL é€šè¿‡æ–‡ä»¶ä¸­çš„å‰ 4 ä¸ªå­—èŠ‚ï¼Œæ¥åˆ¤æ–­è¿™æ˜¯ä¸æ˜¯ä¸€ä¸ª Binlog æ–‡ä»¶ã€‚è¿™ç§æ–¹å¼å¾ˆå¸¸è§ï¼Œå¾ˆå¤šæ ¼å¼çš„æ–‡ä»¶ï¼Œå¦‚ pdfã€docã€jpgç­‰ï¼Œéƒ½ä¼šé€šå¸¸<strong>å‰å‡ ä¸ªç‰¹å®šå­—ç¬¦åˆ¤æ–­æ˜¯å¦æ˜¯åˆæ³•æ–‡ä»¶</strong>ã€‚</li>
<li><code>Event_type</code>ï¼šè¡¨ç¤ºäº‹ä»¶çš„ç±»åž‹</li>
<li><code>Server_id</code>ï¼šè¡¨ç¤ºäº§ç”Ÿè¿™ä¸ªäº‹ä»¶çš„ MySQL server_idï¼Œé€šè¿‡è®¾ç½® my.cnf ä¸­çš„ server-id é€‰é¡¹è¿›è¡Œé…ç½®</li>
<li><code>End_log_position</code>ï¼šä¸‹ä¸€ä¸ªäº‹ä»¶çš„å¼€å§‹ä½ç½®</li>
<li><code>Info</code>ï¼šåŒ…å«äº‹ä»¶çš„å…·ä½“ä¿¡æ¯</li>
</ul>
<h5 id="Binlog-æ—¥å¿—æ ¼å¼"><a href="#Binlog-æ—¥å¿—æ ¼å¼" class="headerlink" title="Binlog æ—¥å¿—æ ¼å¼:"></a>Binlog æ—¥å¿—æ ¼å¼:</h5><p>é’ˆå¯¹ä¸åŒçš„ä½¿ç”¨åœºæ™¯ï¼Œ<code>Binlog</code> ä¹Ÿæä¾›äº†å¯å®šåˆ¶åŒ–çš„æœåŠ¡ï¼Œæä¾›äº†<strong>ä¸‰ç§æ¨¡å¼</strong>æ¥æä¾›ä¸åŒè¯¦ç»†ç¨‹åº¦çš„æ—¥å¿—å†…å®¹ã€‚</p>
<ul>
<li><code>Statement</code> æ¨¡å¼ï¼šåŸºäºŽ <code>SQL</code> è¯­å¥çš„å¤åˆ¶(statement-based replication-SBR)</li>
<li><code>Row</code> æ¨¡å¼ï¼šåŸºäºŽè¡Œçš„å¤åˆ¶(row-based replication-RBR)</li>
<li><code>Mixed</code> æ¨¡å¼ï¼šæ··åˆæ¨¡å¼å¤åˆ¶(mixed-based replication-MBR)</li>
</ul>
<ol>
<li><p><strong>Statement æ¨¡å¼</strong><br><strong>ä¿å­˜æ¯ä¸€æ¡ä¿®æ”¹æ•°æ®çš„SQLã€‚</strong><br>è¯¥æ¨¡å¼åªä¿å­˜ä¸€æ¡æ™®é€šçš„SQLè¯­å¥ï¼Œä¸æ¶‰åŠåˆ°æ‰§è¡Œçš„ä¸Šä¸‹æ–‡ä¿¡æ¯ã€‚<br>å› ä¸ºæ¯å° MySQL æ•°æ®åº“çš„æœ¬åœ°çŽ¯å¢ƒå¯èƒ½ä¸ä¸€æ ·ï¼Œé‚£ä¹ˆå¯¹äºŽä¾èµ–åˆ°æœ¬åœ°çŽ¯å¢ƒçš„å‡½æ•°æˆ–è€…ä¸Šä¸‹æ–‡å¤„ç†çš„é€»è¾‘ SQL åŽ»å¤„ç†çš„æ—¶å€™å¯èƒ½åŒæ ·çš„è¯­å¥åœ¨ä¸åŒçš„æœºå™¨ä¸Šæ‰§è¡Œå‡ºæ¥çš„æ•ˆæžœä¸ä¸€è‡´ã€‚<br>æ¯”å¦‚åƒ sleep()å‡½æ•°ï¼Œlast_insert_id()å‡½æ•°ï¼Œç­‰ç­‰ï¼Œè¿™äº›éƒ½è·Ÿç‰¹å®šæ—¶é—´çš„æœ¬åœ°çŽ¯å¢ƒæœ‰å…³ã€‚</p>
</li>
<li><p><strong>Row æ¨¡å¼</strong><br>MySQL V5.1.5 ç‰ˆæœ¬å¼€å§‹æ”¯æŒRowæ¨¡å¼çš„ Binlogï¼Œå®ƒä¸Ž Statement æ¨¡å¼çš„åŒºåˆ«åœ¨äºŽå®ƒ<strong>ä¸ä¿å­˜å…·ä½“çš„ SQL è¯­å¥ï¼Œè€Œæ˜¯è®°å½•å…·ä½“è¢«ä¿®æ”¹çš„ä¿¡æ¯</strong>ã€‚<br>æ¯”å¦‚ä¸€æ¡ update è¯­å¥æ›´æ–°10æ¡æ•°æ®ï¼Œå¦‚æžœæ˜¯ Statement æ¨¡å¼é‚£å°±ä¿å­˜ä¸€æ¡ SQL å°±å¤Ÿï¼Œä½†æ˜¯ Row æ¨¡å¼ä¼šä¿å­˜æ¯ä¸€è¡Œåˆ†åˆ«æ›´æ–°äº†ä»€ä¹ˆï¼Œæœ‰10æ¡æ•°æ®ã€‚<br>Row æ¨¡å¼çš„ä¼˜ç¼ºç‚¹å°±å¾ˆæ˜Žæ˜¾äº†ã€‚ä¿å­˜æ¯ä¸€ä¸ªæ›´æ”¹çš„è¯¦ç»†ä¿¡æ¯å¿…ç„¶ä¼šå¸¦æ¥<strong>å­˜å‚¨ç©ºé—´çš„å¿«é€Ÿè†¨èƒ€</strong>ï¼Œæ¢æ¥çš„æ˜¯<strong>äº‹ä»¶æ“ä½œçš„è¯¦ç»†è®°å½•</strong>ã€‚æ‰€ä»¥è¦æ±‚è¶Šé«˜ä»£ä»·è¶Šé«˜ã€‚</p>
</li>
<li><p><strong>Mixed æ¨¡å¼</strong><br>Mixed æ¨¡å¼å³ä»¥ä¸Šä¸¤ç§æ¨¡å¼çš„ç»¼åˆä½“ã€‚æ—¢ç„¶ä¸Šé¢ä¸¤ç§æ¨¡å¼åˆ†åˆ«èµ°äº†æžç®€å’Œä¸€ä¸ä¸è‹Ÿçš„æžç«¯ï¼Œé‚£æ˜¯å¦å¯ä»¥åŒºåˆ†ä½¿ç”¨åœºæ™¯çš„æƒ…å†µä¸‹å°†è¿™ä¸¤ç§æ¨¡å¼ç»¼åˆèµ·æ¥å‘¢ï¼Ÿ<br>åœ¨ Mixed æ¨¡å¼ä¸­ï¼Œ<strong>ä¸€èˆ¬çš„æ›´æ–°è¯­å¥ä½¿ç”¨ Statement æ¨¡å¼æ¥ä¿å­˜ Binlog</strong>ï¼Œä½†æ˜¯é‡åˆ°ä¸€äº›å‡½æ•°æ“ä½œï¼Œ<strong>å¯èƒ½ä¼šå½±å“æ•°æ®å‡†ç¡®æ€§çš„æ“ä½œåˆ™ä½¿ç”¨ Row æ¨¡å¼æ¥ä¿å­˜</strong>ã€‚è¿™ç§æ–¹å¼éœ€è¦æ ¹æ®æ¯ä¸€æ¡å…·ä½“çš„ SQL è¯­å¥æ¥åŒºåˆ†é€‰æ‹©å“ªç§æ¨¡å¼ã€‚<br>MySQL ä»Ž V5.1.8 å¼€å§‹æä¾› Mixed æ¨¡å¼ï¼ŒV5.7.7 ä¹‹å‰çš„ç‰ˆæœ¬é»˜è®¤æ˜¯Statement æ¨¡å¼ï¼Œä¹‹åŽé»˜è®¤ä½¿ç”¨Rowæ¨¡å¼ï¼Œ <strong>ä½†æ˜¯åœ¨ 8.0 ä»¥ä¸Šç‰ˆæœ¬å·²ç»é»˜è®¤ä½¿ç”¨ Mixed æ¨¡å¼äº†</strong>ã€‚</p>
</li>
</ol>
<p>æŸ¥è¯¢å½“å‰ Binlog æ—¥å¿—ä½¿ç”¨æ ¼å¼ï¼š</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">mysql<span class="operator">&gt;</span> <span class="keyword">show</span> <span class="keyword">global</span> variables <span class="keyword">like</span> <span class="string">&#x27;%binlog_format%&#x27;</span>;</span><br><span class="line"><span class="operator">+</span><span class="comment">---------------------------------+---------+</span></span><br><span class="line"><span class="operator">|</span> Variable_name                   <span class="operator">|</span> <span class="keyword">Value</span>   <span class="operator">|</span></span><br><span class="line"><span class="operator">+</span><span class="comment">---------------------------------+---------+</span></span><br><span class="line"><span class="operator">|</span> binlog_format                   <span class="operator">|</span> MIXED   <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span> default_week_format             <span class="operator">|</span> <span class="number">0</span>       <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span> information_schema_stats_expiry <span class="operator">|</span> <span class="number">86400</span>   <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span> innodb_default_row_format       <span class="operator">|</span> <span class="keyword">dynamic</span> <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span> require_row_format              <span class="operator">|</span> OFF     <span class="operator">|</span></span><br><span class="line"><span class="operator">+</span><span class="comment">---------------------------------+---------+</span></span><br><span class="line"><span class="number">5</span> <span class="keyword">rows</span> <span class="keyword">in</span> <span class="keyword">set</span> (<span class="number">0.01</span> sec)</span><br></pre></td></tr></table></figure>

<h5 id="å¦‚ä½•é€šè¿‡-mysqlbinlog-å‘½ä»¤æ‰‹åŠ¨æ¢å¤æ•°æ®"><a href="#å¦‚ä½•é€šè¿‡-mysqlbinlog-å‘½ä»¤æ‰‹åŠ¨æ¢å¤æ•°æ®" class="headerlink" title="å¦‚ä½•é€šè¿‡ mysqlbinlog å‘½ä»¤æ‰‹åŠ¨æ¢å¤æ•°æ®"></a>å¦‚ä½•é€šè¿‡ mysqlbinlog å‘½ä»¤æ‰‹åŠ¨æ¢å¤æ•°æ®</h5><p>ä¸Šé¢è¯´è¿‡æ¯ä¸€æ¡ event éƒ½æœ‰ä½ç‚¹ä¿¡æ¯ï¼Œå¦‚æžœæˆ‘ä»¬å½“å‰çš„ MySQL åº“è¢«æ— æ“ä½œæˆ–è€…è¯¯åˆ é™¤äº†ï¼Œé‚£ä¹ˆè¯¥å¦‚ä½•é€šè¿‡ Binlog æ¥æ¢å¤åˆ°åˆ é™¤ä¹‹å‰çš„æ•°æ®çŠ¶æ€å‘¢ï¼Ÿ<br>é¦–å…ˆå‘çŽ°è¯¯æ“ä½œä¹‹åŽï¼Œ<strong>å…ˆåœæ­¢ MySQL æœåŠ¡ï¼Œé˜²æ­¢ç»§ç»­æ›´æ–°</strong>ã€‚<br>æŽ¥ç€é€šè¿‡ <code>mysqlbinlog</code>å‘½ä»¤å¯¹äºŒè¿›åˆ¶æ–‡ä»¶è¿›è¡Œåˆ†æžï¼ŒæŸ¥çœ‹è¯¯æ“ä½œä¹‹å‰çš„ä½ç‚¹ä¿¡æ¯åœ¨å“ªé‡Œã€‚<br>æŽ¥ä¸‹æ¥è‚¯å®šå°±æ˜¯æ¢å¤æ•°æ®ï¼Œå½“å‰æ•°æ®åº“çš„æ•°æ®å·²ç»æ˜¯é”™çš„ï¼Œé‚£ä¹ˆå°±ä»Žå¼€å§‹ä½ç½®åˆ°è¯¯æ“ä½œä¹‹å‰ä½ç‚¹çš„æ•°æ®è‚¯å®šçš„éƒ½æ˜¯æ­£ç¡®çš„ï¼›å¦‚æžœè¯¯æ“ä½œä¹‹åŽä¹Ÿæœ‰æ­£å¸¸çš„æ•°æ®è¿›æ¥ï¼Œè¿™ä¸€æ®µæ—¶é—´çš„ä½ç‚¹æ•°æ®ä¹Ÿè¦å¤‡ä»½ã€‚<br>æ¯”å¦‚è¯´ï¼š<br>è¯¯æ“ä½œçš„ä½ç‚¹å¼€å§‹å€¼ä¸º 501ï¼Œè¯¯æ“ä½œç»“æŸçš„ä½ç½®ä¸º705ï¼Œä¹‹åŽåˆ°800çš„ä½ç‚¹éƒ½æ˜¯æ­£ç¡®æ•°æ®ã€‚<br>é‚£ä¹ˆä»Ž 0 - 500 ï¼Œ706 - 800 éƒ½æ˜¯æœ‰æ•ˆæ•°æ®ï¼ŒæŽ¥ç€æˆ‘ä»¬å°±å¯ä»¥è¿›è¡Œæ•°æ®æ¢å¤äº†ã€‚<br><strong>å…ˆå°†æ•°æ®åº“å¤‡ä»½å¹¶æ¸…ç©ºã€‚</strong><br>æŽ¥ç€ä½¿ç”¨ <code>mysqlbinlog</code> æ¥æ¢å¤æ•°æ®ï¼š<br>0 - 500 çš„æ•°æ®ï¼š</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mysqlbinlog <span class="comment">--start-position=0  --stop-position=500  bin-log.000003 &gt; /root/back.sql;</span></span><br></pre></td></tr></table></figure>
<p>ä¸Šé¢å‘½ä»¤çš„ä½œç”¨å°±æ˜¯å°† 0 -500 ä½ç‚¹çš„æ•°æ®æ¢å¤åˆ°è‡ªå®šä¹‰çš„ SQL æ–‡ä»¶ä¸­ã€‚åŒç† 706 - 800 çš„æ•°æ®ä¹Ÿæ˜¯ä¸€æ ·æ“ä½œã€‚ä¹‹åŽæˆ‘ä»¬æ‰§è¡Œè¿™ä¸¤ä¸ª SQL æ–‡ä»¶å°±è¡Œäº†ã€‚</p>
<p><strong>Binlog äº‹ä»¶ç±»åž‹</strong><br>ä¸Šé¢æˆ‘ä»¬è¯´åˆ°äº† <code>Binlog</code> æ—¥å¿—ä¸­çš„äº‹ä»¶ï¼Œä¸åŒçš„æ“ä½œä¼šå¯¹åº”ç€ä¸åŒçš„äº‹ä»¶ç±»åž‹ï¼Œä¸”ä¸åŒçš„ <code>Binlog</code> æ—¥å¿—æ¨¡å¼åŒä¸€ä¸ªæ“ä½œçš„äº‹ä»¶ç±»åž‹ä¹Ÿä¸åŒï¼Œä¸‹é¢æˆ‘ä»¬ä¸€èµ·çœ‹çœ‹å¸¸è§çš„äº‹ä»¶ç±»åž‹ã€‚<br>é¦–å…ˆæˆ‘ä»¬çœ‹çœ‹æºç ä¸­çš„äº‹ä»¶ç±»åž‹å®šä¹‰ï¼š<br>æºç ä½ç½®ï¼š&#x2F;libbinlogevents&#x2F;include&#x2F;binlog_event.h</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">enum</span> <span class="title">Log_event_type</span></span></span><br><span class="line"><span class="class">&#123;</span></span><br><span class="line">  <span class="comment">/**</span></span><br><span class="line"><span class="comment">    Every time you update this enum (when you add a type), you have to</span></span><br><span class="line"><span class="comment">    fix Format_description_event::Format_description_event().</span></span><br><span class="line"><span class="comment">  */</span></span><br><span class="line">  UNKNOWN_EVENT= <span class="number">0</span>,</span><br><span class="line">  START_EVENT_V3= <span class="number">1</span>,</span><br><span class="line">  QUERY_EVENT= <span class="number">2</span>,</span><br><span class="line">  STOP_EVENT= <span class="number">3</span>,</span><br><span class="line">  ROTATE_EVENT= <span class="number">4</span>,</span><br><span class="line">  INTVAR_EVENT= <span class="number">5</span>,</span><br><span class="line">  LOAD_EVENT= <span class="number">6</span>,</span><br><span class="line">  SLAVE_EVENT= <span class="number">7</span>,</span><br><span class="line">  CREATE_FILE_EVENT= <span class="number">8</span>,</span><br><span class="line">  APPEND_BLOCK_EVENT= <span class="number">9</span>,</span><br><span class="line">  EXEC_LOAD_EVENT= <span class="number">10</span>,</span><br><span class="line">  DELETE_FILE_EVENT= <span class="number">11</span>,</span><br><span class="line">  <span class="comment">/**</span></span><br><span class="line"><span class="comment">    NEW_LOAD_EVENT is like LOAD_EVENT except that it has a longer</span></span><br><span class="line"><span class="comment">    sql_ex, allowing multibyte TERMINATED BY etc; both types share the</span></span><br><span class="line"><span class="comment">    same class (Load_event)</span></span><br><span class="line"><span class="comment">  */</span></span><br><span class="line">  NEW_LOAD_EVENT= <span class="number">12</span>,</span><br><span class="line">  RAND_EVENT= <span class="number">13</span>,</span><br><span class="line">  USER_VAR_EVENT= <span class="number">14</span>,</span><br><span class="line">  FORMAT_DESCRIPTION_EVENT= <span class="number">15</span>,</span><br><span class="line">  XID_EVENT= <span class="number">16</span>,</span><br><span class="line">  BEGIN_LOAD_QUERY_EVENT= <span class="number">17</span>,</span><br><span class="line">  EXECUTE_LOAD_QUERY_EVENT= <span class="number">18</span>,</span><br><span class="line"></span><br><span class="line">  TABLE_MAP_EVENT = <span class="number">19</span>,</span><br><span class="line"></span><br><span class="line">  <span class="comment">/**</span></span><br><span class="line"><span class="comment">    The PRE_GA event numbers were used for 5.1.0 to 5.1.15 and are</span></span><br><span class="line"><span class="comment">    therefore obsolete.</span></span><br><span class="line"><span class="comment">   */</span></span><br><span class="line">  PRE_GA_WRITE_ROWS_EVENT = <span class="number">20</span>,</span><br><span class="line">  PRE_GA_UPDATE_ROWS_EVENT = <span class="number">21</span>,</span><br><span class="line">  PRE_GA_DELETE_ROWS_EVENT = <span class="number">22</span>,</span><br><span class="line"></span><br><span class="line">  <span class="comment">/**</span></span><br><span class="line"><span class="comment">    The V1 event numbers are used from 5.1.16 until mysql-trunk-xx</span></span><br><span class="line"><span class="comment">  */</span></span><br><span class="line">  WRITE_ROWS_EVENT_V1 = <span class="number">23</span>,</span><br><span class="line">  UPDATE_ROWS_EVENT_V1 = <span class="number">24</span>,</span><br><span class="line">  DELETE_ROWS_EVENT_V1 = <span class="number">25</span>,</span><br><span class="line"></span><br><span class="line">  <span class="comment">/**</span></span><br><span class="line"><span class="comment">    Something out of the ordinary happened on the master</span></span><br><span class="line"><span class="comment">   */</span></span><br><span class="line">  INCIDENT_EVENT= <span class="number">26</span>,</span><br><span class="line"></span><br><span class="line">  <span class="comment">/**</span></span><br><span class="line"><span class="comment">    Heartbeat event to be send by master at its idle time</span></span><br><span class="line"><span class="comment">    to ensure master&#x27;s online status to slave</span></span><br><span class="line"><span class="comment">  */</span></span><br><span class="line">  HEARTBEAT_LOG_EVENT= <span class="number">27</span>,</span><br><span class="line"></span><br><span class="line">  <span class="comment">/**</span></span><br><span class="line"><span class="comment">    In some situations, it is necessary to send over ignorable</span></span><br><span class="line"><span class="comment">    data to the slave: data that a slave can handle in case there</span></span><br><span class="line"><span class="comment">    is code for handling it, but which can be ignored if it is not</span></span><br><span class="line"><span class="comment">    recognized.</span></span><br><span class="line"><span class="comment">  */</span></span><br><span class="line">  IGNORABLE_LOG_EVENT= <span class="number">28</span>,</span><br><span class="line">  ROWS_QUERY_LOG_EVENT= <span class="number">29</span>,</span><br><span class="line"></span><br><span class="line">  <span class="comment">/** Version 2 of the Row events */</span></span><br><span class="line">  WRITE_ROWS_EVENT = <span class="number">30</span>,</span><br><span class="line">  UPDATE_ROWS_EVENT = <span class="number">31</span>,</span><br><span class="line">  DELETE_ROWS_EVENT = <span class="number">32</span>,</span><br><span class="line"></span><br><span class="line">  GTID_LOG_EVENT= <span class="number">33</span>,</span><br><span class="line">  ANONYMOUS_GTID_LOG_EVENT= <span class="number">34</span>,</span><br><span class="line"></span><br><span class="line">  PREVIOUS_GTIDS_LOG_EVENT= <span class="number">35</span>,</span><br><span class="line"></span><br><span class="line">  TRANSACTION_CONTEXT_EVENT= <span class="number">36</span>,</span><br><span class="line"></span><br><span class="line">  VIEW_CHANGE_EVENT= <span class="number">37</span>,</span><br><span class="line"></span><br><span class="line">  <span class="comment">/* Prepared XA transaction terminal event similar to Xid */</span></span><br><span class="line">  XA_PREPARE_LOG_EVENT= <span class="number">38</span>,</span><br><span class="line">  <span class="comment">/**</span></span><br><span class="line"><span class="comment">    Add new events here - right above this comment!</span></span><br><span class="line"><span class="comment">    Existing events (except ENUM_END_EVENT) should never change their numbers</span></span><br><span class="line"><span class="comment">  */</span></span><br><span class="line">  ENUM_END_EVENT <span class="comment">/* end marker */</span></span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<p>è¿™ä¹ˆå¤šçš„äº‹ä»¶ç±»åž‹æˆ‘ä»¬å°±ä¸ä¸€ä¸€ä»‹ç»ï¼ŒæŒ‘å‡ºæ¥ä¸€äº›å¸¸ç”¨çš„æ¥çœ‹çœ‹ã€‚<br><code>FORMAT_DESCRIPTION_EVENT</code><br><code>FORMAT_DESCRIPTION_EVENT</code> æ˜¯ Binlog V4 ä¸­ä¸ºäº†å–ä»£ä¹‹å‰ç‰ˆæœ¬ä¸­çš„ START_EVENT_V3 äº‹ä»¶è€Œå¼•å…¥çš„ã€‚å®ƒæ˜¯ Binlog æ–‡ä»¶ä¸­çš„ç¬¬ä¸€ä¸ªäº‹ä»¶ï¼Œè€Œä¸”ï¼Œè¯¥äº‹ä»¶åªä¼šåœ¨ Binlog ä¸­å‡ºçŽ°ä¸€æ¬¡ã€‚MySQL æ ¹æ® <code>FORMAT_DESCRIPTION_EVENT</code> çš„å®šä¹‰æ¥è§£æžå…¶å®ƒäº‹ä»¶ã€‚<br>å®ƒé€šå¸¸æŒ‡å®šäº† MySQL çš„ç‰ˆæœ¬ï¼ŒBinlog çš„ç‰ˆæœ¬ï¼Œè¯¥ Binlog æ–‡ä»¶çš„åˆ›å»ºæ—¶é—´ã€‚</p>
<p><code>QUERY_EVENT</code></p>
<p><code>QUERY_EVENT</code> ç±»åž‹çš„äº‹ä»¶é€šå¸¸åœ¨ä»¥ä¸‹å‡ ç§æƒ…å†µä¸‹ä½¿ç”¨ï¼š</p>
<p>äº‹åŠ¡å¼€å§‹æ—¶ï¼Œæ‰§è¡Œçš„ BEGIN æ“ä½œ<br>STATEMENT æ ¼å¼ä¸­çš„ DML æ“ä½œ<br>ROW æ ¼å¼ä¸­çš„ DDL æ“ä½œ<br>æ¯”å¦‚ä¸Šæ–‡æˆ‘ä»¬æ’å…¥ä¸€æ¡æ•°æ®ä¹‹åŽçš„ Binlog æ—¥å¿—ï¼š</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">mysql<span class="operator">&gt;</span> <span class="keyword">show</span> binlog events <span class="keyword">in</span> <span class="string">&#x27;mysql-bin.000002&#x27;</span>;</span><br><span class="line"><span class="operator">+</span><span class="comment">------------------+-----+----------------+-----------+-------------+-------------------------------------------------------------------------+</span></span><br><span class="line"><span class="operator">|</span> Log_name         <span class="operator">|</span> Pos <span class="operator">|</span> Event_type     <span class="operator">|</span> Server_id <span class="operator">|</span> End_log_pos <span class="operator">|</span> Info                                                                    <span class="operator">|</span></span><br><span class="line"><span class="operator">+</span><span class="comment">------------------+-----+----------------+-----------+-------------+-------------------------------------------------------------------------+</span></span><br><span class="line"><span class="operator">|</span> mysql<span class="operator">-</span>bin<span class="number">.000002</span> <span class="operator">|</span>   <span class="number">4</span> <span class="operator">|</span> Format_desc    <span class="operator">|</span>         <span class="number">1</span> <span class="operator">|</span>         <span class="number">125</span> <span class="operator">|</span> Server ver: <span class="number">8.0</span><span class="number">.21</span>, Binlog ver: <span class="number">4</span>                                       <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span> mysql<span class="operator">-</span>bin<span class="number">.000002</span> <span class="operator">|</span> <span class="number">125</span> <span class="operator">|</span> Previous_gtids <span class="operator">|</span>         <span class="number">1</span> <span class="operator">|</span>         <span class="number">156</span> <span class="operator">|</span>                                                                         <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span> mysql<span class="operator">-</span>bin<span class="number">.000002</span> <span class="operator">|</span> <span class="number">156</span> <span class="operator">|</span> Anonymous_Gtid <span class="operator">|</span>         <span class="number">1</span> <span class="operator">|</span>         <span class="number">235</span> <span class="operator">|</span> <span class="keyword">SET</span> @<span class="variable">@SESSION</span>.GTID_NEXT<span class="operator">=</span> <span class="string">&#x27;ANONYMOUS&#x27;</span>                                    <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span> mysql<span class="operator">-</span>bin<span class="number">.000002</span> <span class="operator">|</span> <span class="number">235</span> <span class="operator">|</span> Query          <span class="operator">|</span>         <span class="number">1</span> <span class="operator">|</span>         <span class="number">323</span> <span class="operator">|</span> <span class="keyword">BEGIN</span>                                                                   <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span> mysql<span class="operator">-</span>bin<span class="number">.000002</span> <span class="operator">|</span> <span class="number">323</span> <span class="operator">|</span> Intvar         <span class="operator">|</span>         <span class="number">1</span> <span class="operator">|</span>         <span class="number">355</span> <span class="operator">|</span> INSERT_ID<span class="operator">=</span><span class="number">13</span>                                                            <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span> mysql<span class="operator">-</span>bin<span class="number">.000002</span> <span class="operator">|</span> <span class="number">355</span> <span class="operator">|</span> Query          <span class="operator">|</span>         <span class="number">1</span> <span class="operator">|</span>         <span class="number">494</span> <span class="operator">|</span> use `test_db`; <span class="keyword">INSERT INTO</span> `test_db`.`test_db`(`name`) <span class="keyword">VALUES</span> (<span class="string">&#x27;xdfdf&#x27;</span>) <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span> mysql<span class="operator">-</span>bin<span class="number">.000002</span> <span class="operator">|</span> <span class="number">494</span> <span class="operator">|</span> Xid            <span class="operator">|</span>         <span class="number">1</span> <span class="operator">|</span>         <span class="number">525</span> <span class="operator">|</span> <span class="keyword">COMMIT</span> <span class="comment">/* xid=192 */</span>                                                    <span class="operator">|</span></span><br><span class="line"><span class="operator">+</span><span class="comment">------------------+-----+----------------+-----------+-------------+-------------------------------------------------------------------------+</span></span><br><span class="line"><span class="number">7</span> <span class="keyword">rows</span> <span class="keyword">in</span> <span class="keyword">set</span> (<span class="number">0.00</span> sec)</span><br></pre></td></tr></table></figure>

<p><code>XID_EVENT</code><br>åœ¨äº‹åŠ¡æäº¤æ—¶ï¼Œä¸ç®¡æ˜¯ STATEMENT è¿˜ æ˜¯ROW æ ¼å¼çš„ Binlogï¼Œéƒ½ä¼šåœ¨æœ«å°¾æ·»åŠ ä¸€ä¸ª <code>XID_EVENT</code> äº‹ä»¶ä»£è¡¨<strong>äº‹åŠ¡çš„ç»“æŸ</strong>ã€‚è¯¥äº‹ä»¶è®°å½•äº†è¯¥äº‹åŠ¡çš„ IDï¼Œåœ¨ MySQL è¿›è¡Œå´©æºƒæ¢å¤æ—¶ï¼Œæ ¹æ®äº‹åŠ¡åœ¨ Binlog ä¸­çš„æäº¤æƒ…å†µæ¥å†³å®šæ˜¯å¦æäº¤å­˜å‚¨å¼•æ“Žä¸­çŠ¶æ€ä¸º prepared çš„äº‹åŠ¡ã€‚<br><code>ROWS_EVENT</code><br>å¯¹äºŽ ROW æ ¼å¼çš„ Binlogï¼Œæ‰€æœ‰çš„ DML è¯­å¥éƒ½æ˜¯è®°å½•åœ¨ <code>ROWS_EVENT</code> ä¸­ã€‚<br><code>ROWS_EVENT</code>åˆ†ä¸ºä¸‰ç§ï¼š<br><code>WRITE_ROWS_EVENT</code><br><code>UPDATE_ROWS_EVENT</code><br><code>DELETE_ROWS_EVENT</code><br>åˆ†åˆ«å¯¹åº” <code>insert</code>ï¼Œ<code>update</code> å’Œ <code>delete</code> æ“ä½œã€‚<br>å¯¹äºŽ <code>insert</code> æ“ä½œï¼Œ<code>WRITE_ROWS_EVENT</code> åŒ…å«äº†è¦æ’å…¥çš„æ•°æ®ã€‚<br>å¯¹äºŽ <code>update</code> æ“ä½œï¼Œ<code>UPDATE_ROWS_EVENT</code> ä¸ä»…åŒ…å«äº†ä¿®æ”¹åŽçš„æ•°æ®ï¼Œè¿˜åŒ…å«äº†ä¿®æ”¹å‰çš„å€¼ã€‚<br>å¯¹äºŽ <code>delete</code> æ“ä½œï¼Œä»…ä»…éœ€è¦æŒ‡å®šåˆ é™¤çš„ä¸»é”®ï¼ˆåœ¨æ²¡æœ‰ä¸»é”®çš„æƒ…å†µä¸‹ï¼Œä¼šç»™å®šæ‰€æœ‰åˆ—ï¼‰ã€‚</p>
<p>å¯¹æ¯” <code>QUERY_EVENT</code> äº‹ä»¶ï¼Œæ˜¯ä»¥æ–‡æœ¬å½¢å¼è®°å½• DML æ“ä½œçš„ã€‚è€Œå¯¹äºŽ <code>ROWS_EVENT</code> äº‹ä»¶ï¼Œ<strong>å¹¶ä¸æ˜¯æ–‡æœ¬å½¢å¼</strong>ï¼Œæ‰€ä»¥åœ¨é€šè¿‡ mysqlbinlog æŸ¥çœ‹åŸºäºŽ ROW æ ¼å¼çš„ Binlog æ—¶ï¼Œéœ€è¦æŒ‡å®š -vv â€“base64-output&#x3D;decode-rowsã€‚</p>
<p>æˆ‘ä»¬æ¥æµ‹è¯•ä¸€ä¸‹ï¼Œé¦–å…ˆå°†æ—¥å¿—æ ¼å¼æ”¹ä¸º Rowsï¼š</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">mysql<span class="operator">&gt;</span> <span class="keyword">set</span> binlog_format<span class="operator">=</span><span class="type">row</span>;</span><br><span class="line">Query OK, <span class="number">0</span> <span class="keyword">rows</span> affected (<span class="number">0.00</span> sec)</span><br><span class="line"></span><br><span class="line">mysql<span class="operator">&gt;</span></span><br><span class="line">mysql<span class="operator">&gt;</span> flush logs;</span><br><span class="line">Query OK, <span class="number">0</span> <span class="keyword">rows</span> affected (<span class="number">0.01</span> sec)</span><br></pre></td></tr></table></figure>
<p>ç„¶åŽåˆ·æ–°ä¸€ä¸‹æ—¥å¿—æ–‡ä»¶ï¼Œé‡æ–°å¼€å§‹ä¸€ä¸ª Binlog æ—¥å¿—ã€‚æˆ‘ä»¬æ’å…¥ä¸€æ¡æ•°æ®ä¹‹åŽçœ‹ä¸€ä¸‹æ—¥å¿—ï¼š</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">mysql<span class="operator">&gt;</span> <span class="keyword">show</span> binlog events <span class="keyword">in</span> <span class="string">&#x27;binlog.000008&#x27;</span>;</span><br><span class="line"><span class="operator">+</span><span class="comment">---------------+-----+----------------+-----------+-------------+--------------------------------------+</span></span><br><span class="line"><span class="operator">|</span> Log_name      <span class="operator">|</span> Pos <span class="operator">|</span> Event_type     <span class="operator">|</span> Server_id <span class="operator">|</span> End_log_pos <span class="operator">|</span> Info                                 <span class="operator">|</span></span><br><span class="line"><span class="operator">+</span><span class="comment">---------------+-----+----------------+-----------+-------------+--------------------------------------+</span></span><br><span class="line"><span class="operator">|</span> binlog<span class="number">.000008</span> <span class="operator">|</span>   <span class="number">4</span> <span class="operator">|</span> Format_desc    <span class="operator">|</span>         <span class="number">1</span> <span class="operator">|</span>         <span class="number">125</span> <span class="operator">|</span> Server ver: <span class="number">8.0</span><span class="number">.21</span>, Binlog ver: <span class="number">4</span>    <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span> binlog<span class="number">.000008</span> <span class="operator">|</span> <span class="number">125</span> <span class="operator">|</span> Previous_gtids <span class="operator">|</span>         <span class="number">1</span> <span class="operator">|</span>         <span class="number">156</span> <span class="operator">|</span>                                      <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span> binlog<span class="number">.000008</span> <span class="operator">|</span> <span class="number">156</span> <span class="operator">|</span> Anonymous_Gtid <span class="operator">|</span>         <span class="number">1</span> <span class="operator">|</span>         <span class="number">235</span> <span class="operator">|</span> <span class="keyword">SET</span> @<span class="variable">@SESSION</span>.GTID_NEXT<span class="operator">=</span> <span class="string">&#x27;ANONYMOUS&#x27;</span> <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span> binlog<span class="number">.000008</span> <span class="operator">|</span> <span class="number">235</span> <span class="operator">|</span> Query          <span class="operator">|</span>         <span class="number">1</span> <span class="operator">|</span>         <span class="number">313</span> <span class="operator">|</span> <span class="keyword">BEGIN</span>                                <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span> binlog<span class="number">.000008</span> <span class="operator">|</span> <span class="number">313</span> <span class="operator">|</span> Table_map      <span class="operator">|</span>         <span class="number">1</span> <span class="operator">|</span>         <span class="number">377</span> <span class="operator">|</span> table_id: <span class="number">85</span> (test_db.test_db)       <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span> binlog<span class="number">.000008</span> <span class="operator">|</span> <span class="number">377</span> <span class="operator">|</span> Write_rows     <span class="operator">|</span>         <span class="number">1</span> <span class="operator">|</span>         <span class="number">423</span> <span class="operator">|</span> table_id: <span class="number">85</span> flags: STMT_END_F       <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span> binlog<span class="number">.000008</span> <span class="operator">|</span> <span class="number">423</span> <span class="operator">|</span> Xid            <span class="operator">|</span>         <span class="number">1</span> <span class="operator">|</span>         <span class="number">454</span> <span class="operator">|</span> <span class="keyword">COMMIT</span> <span class="comment">/* xid=44 */</span>                  <span class="operator">|</span></span><br><span class="line"><span class="operator">+</span><span class="comment">---------------+-----+----------------+-----------+-------------+--------------------------------------+</span></span><br><span class="line"><span class="number">7</span> <span class="keyword">rows</span> <span class="keyword">in</span> <span class="keyword">set</span> (<span class="number">0.01</span> sec)</span><br></pre></td></tr></table></figure>



<h4 id="è¯´è¯´-redo-log-çš„å·¥ä½œæœºåˆ¶ï¼Ÿ"><a href="#è¯´è¯´-redo-log-çš„å·¥ä½œæœºåˆ¶ï¼Ÿ" class="headerlink" title="è¯´è¯´ redo log çš„å·¥ä½œæœºåˆ¶ï¼Ÿ"></a>è¯´è¯´ redo log çš„å·¥ä½œæœºåˆ¶ï¼Ÿ</h4><p>å½“<strong>äº‹åŠ¡å¯åŠ¨</strong>æ—¶ï¼ŒMySQL ä¼šä¸ºè¯¥äº‹åŠ¡åˆ†é…ä¸€ä¸ªå”¯ä¸€æ ‡è¯†ç¬¦ã€‚<br>åœ¨<strong>äº‹åŠ¡æ‰§è¡Œè¿‡ç¨‹ä¸­ï¼Œæ¯æ¬¡å¯¹æ•°æ®è¿›è¡Œä¿®æ”¹</strong>ï¼ŒMySQL éƒ½ä¼šç”Ÿæˆä¸€æ¡ <code>Redo Log</code>ï¼Œè®°å½•ä¿®æ”¹å‰åŽçš„æ•°æ®çŠ¶æ€ã€‚<br>è¿™äº› <code>Redo Log</code> é¦–å…ˆä¼šè¢«å†™å…¥å†…å­˜ä¸­çš„ <code>Redo Log Buffer</code>ã€‚<br><img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="https://cdn.jsdelivr.net/gh/JakicDong/blog-assets@main/images/20250613161219.png" alt="20250613161219"><br>å½“äº‹åŠ¡æäº¤æ—¶ï¼ŒMySQL å†å°† <code>Redo Log Buffer</code> ä¸­çš„è®°å½•åˆ·æ–°åˆ°ç£ç›˜ä¸Šçš„ <code>Redo Log</code> æ–‡ä»¶ä¸­ã€‚<br>åªæœ‰å½“<code> Redo Log</code> æˆåŠŸå†™å…¥ç£ç›˜ï¼Œäº‹åŠ¡æ‰ç®—çœŸæ­£æäº¤æˆåŠŸã€‚<br><img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="https://cdn.jsdelivr.net/gh/JakicDong/blog-assets@main/images/20250613161254.png" alt="20250613161254"><br>å½“ MySQL å´©æºƒé‡å¯æ—¶ï¼Œä¼šå…ˆæ£€æŸ¥ <code>Redo Log</code>ã€‚å¯¹äºŽå·²æäº¤çš„äº‹åŠ¡ï¼ŒMySQL ä¼šé‡æ”¾ <code>Redo Log</code> ä¸­çš„è®°å½•ã€‚<br><img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="https://cdn.jsdelivr.net/gh/JakicDong/blog-assets@main/images/20250613161338.png" alt="20250613161338"><br>å¯¹äºŽæœªæäº¤çš„äº‹åŠ¡ï¼ŒMySQL ä¼šé€šè¿‡ <code>Undo Log</code> å›žæ»šè¿™äº›ä¿®æ”¹ï¼Œç¡®ä¿æ•°æ®æ¢å¤åˆ°å´©æºƒå‰çš„ä¸€è‡´æ€§çŠ¶æ€ã€‚<br><code>Redo Log</code> æ˜¯å¾ªçŽ¯ä½¿ç”¨çš„ï¼Œå½“æ–‡ä»¶å†™æ»¡åŽä¼šè¦†ç›–æœ€æ—©çš„è®°å½•ã€‚<br>ä¸ºé¿å…è¦†ç›–æœªæŒä¹…åŒ–çš„è®°å½•ï¼ŒMySQL ä¼šå®šæœŸæ‰§è¡Œ <code>CheckPoint</code> æ“ä½œï¼Œå°†å†…å­˜ä¸­çš„æ•°æ®é¡µåˆ·æ–°åˆ°ç£ç›˜ï¼Œå¹¶è®°å½• <code>CheckPoint</code> ç‚¹ã€‚</p>
<p><img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="https://cdn.jsdelivr.net/gh/JakicDong/blog-assets@main/images/20250613161415.png" alt="20250613161415"></p>
<p>é‡å¯æ—¶ï¼ŒMySQL åªä¼šé‡æ”¾ CheckPoint ä¹‹åŽçš„ Redo Logï¼Œä»Žè€Œæé«˜æ¢å¤æ•ˆçŽ‡ã€‚</p>
<p><strong>çœæµç‰ˆ:</strong></p>
<ol>
<li>äº‹åŠ¡å¼€å§‹</li>
<li>è®°å½•undo logï¼ˆæ—§æ•°æ®ï¼‰</li>
<li>ä¿®æ”¹Buffer Poolä¸­çš„æ•°æ®</li>
<li>å†™å…¥redo logï¼ˆprepareçŠ¶æ€ï¼‰</li>
<li>å†™å…¥binlog</li>
<li>æäº¤äº‹åŠ¡ï¼ˆredo logæ ‡è®°ä¸ºcommitï¼‰</li>
<li>åŽå°å¼‚æ­¥åˆ·è„é¡µåˆ°ç£ç›˜</li>
</ol>
<h4 id="redo-log-æ–‡ä»¶çš„å¤§å°æ˜¯å›ºå®šçš„å—ï¼Ÿ"><a href="#redo-log-æ–‡ä»¶çš„å¤§å°æ˜¯å›ºå®šçš„å—ï¼Ÿ" class="headerlink" title="redo log æ–‡ä»¶çš„å¤§å°æ˜¯å›ºå®šçš„å—ï¼Ÿ"></a>redo log æ–‡ä»¶çš„å¤§å°æ˜¯å›ºå®šçš„å—ï¼Ÿ</h4><p><code>redo log</code> æ–‡ä»¶æ˜¯å›ºå®šå¤§å°çš„ï¼Œé€šå¸¸é…ç½®ä¸ºä¸€ç»„æ–‡ä»¶ï¼Œä½¿ç”¨<strong>çŽ¯å½¢æ–¹å¼</strong>å†™å…¥ï¼Œæ—§çš„æ—¥å¿—ä¼šåœ¨ç©ºé—´éœ€è¦æ—¶è¢«è¦†ç›–ã€‚</p>
<p><img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="https://cdn.jsdelivr.net/gh/JakicDong/blog-assets@main/images/20250613162534.png" alt="20250613162534"><br>å‘½åæ–¹å¼ä¸º ib_logfile0ã€iblogfile1ã€ã€ã€iblogfilenã€‚é»˜è®¤ 2 ä¸ªæ–‡ä»¶ï¼Œæ¯ä¸ªæ–‡ä»¶å¤§å°ä¸º 48MBã€‚<br>å¯ä»¥é€šè¿‡ <code>show variables like &#39;innodb_log_file_size&#39;;</code> æŸ¥çœ‹ redo log æ–‡ä»¶çš„å¤§å°ï¼›é€šè¿‡ <code>show variables like &#39;innodb_log_files_in_group&#39;;</code> æŸ¥çœ‹ redo log æ–‡ä»¶çš„æ•°é‡ã€‚</p>
<h4 id="è¯´ä¸€è¯´WAL"><a href="#è¯´ä¸€è¯´WAL" class="headerlink" title="è¯´ä¸€è¯´WAL?"></a>è¯´ä¸€è¯´WAL?</h4><pre><code>WALâ€”â€”Write-Ahead Loggingã€‚
</code></pre>
<p>é¢„å†™æ—¥å¿—æ˜¯ InnoDB <strong>å®žçŽ°äº‹åŠ¡æŒä¹…åŒ–çš„æ ¸å¿ƒæœºåˆ¶</strong>ï¼Œå®ƒçš„æ€æƒ³æ˜¯ï¼š<strong>å…ˆå†™æ—¥å¿—å†åˆ·ç£ç›˜</strong>ã€‚<br>å³åœ¨ä¿®æ”¹æ•°æ®é¡µä¹‹å‰ï¼Œå…ˆå°†ä¿®æ”¹è®°å½•å†™å…¥ <code>Redo Log</code>ã€‚<br>è¿™æ ·çš„è¯ï¼Œå³ä½¿æ•°æ®é¡µå°šæœªå†™å…¥ç£ç›˜ï¼Œç³»ç»Ÿå´©æºƒæ—¶ä¹Ÿèƒ½é€šè¿‡ Redo Log æ¢å¤æ•°æ®ã€‚<br><img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="https://cdn.jsdelivr.net/gh/JakicDong/blog-assets@main/images/20250613163109.png" alt="20250613163109"><br>â€”-è¿™éƒ¨åˆ†æ˜¯å¸®åŠ©ç†è§£ startï¼Œé¢è¯•ä¸­å¯ä¸èƒŒâ€”-<br><strong>è§£é‡Šä¸€ä¸‹ä¸ºä»€ä¹ˆéœ€è¦ WALï¼š</strong><br>æ•°æ®æœ€ç»ˆæ˜¯è¦å†™å…¥ç£ç›˜çš„ï¼Œ<strong>ä½†ç£ç›˜ IO å¾ˆæ…¢</strong>ï¼›<br>å¦‚æžœæ¯æ¬¡æ›´æ–°éƒ½ç«‹åˆ»æŠŠæ•°æ®é¡µåˆ·ç›˜ï¼Œæ€§èƒ½å¾ˆå·®ï¼›<br>å¦‚æžœè¿˜æ²¡å†™å…¥ç£ç›˜å°±å®•æœºï¼Œäº‹åŠ¡ä¼šä¸¢å¤±ã€‚<br>WAL çš„å¥½å¤„æ˜¯æ›´æ–°æ—¶ä¸ç›´æŽ¥å†™æ•°æ®é¡µï¼Œè€Œæ˜¯å…ˆå†™ä¸€ä»½å˜æ›´è®°å½•åˆ° redo logï¼ŒåŽå°å†æ…¢æ…¢æŠŠçœŸæ­£çš„æ•°æ®é¡µåˆ·ç›˜ï¼Œä¸€ä¸¾å¤šå¾—ã€‚<br>â€”-è¿™éƒ¨åˆ†æ˜¯å¸®åŠ©ç†è§£ endï¼Œé¢è¯•ä¸­å¯ä¸èƒŒâ€”-</p>
<h3 id="30-ðŸŒŸä¸ºä»€ä¹ˆè¦ä¸¤é˜¶æ®µæäº¤"><a href="#30-ðŸŒŸä¸ºä»€ä¹ˆè¦ä¸¤é˜¶æ®µæäº¤" class="headerlink" title="30.ðŸŒŸä¸ºä»€ä¹ˆè¦ä¸¤é˜¶æ®µæäº¤?"></a>30.ðŸŒŸä¸ºä»€ä¹ˆè¦ä¸¤é˜¶æ®µæäº¤?</h3><p>ä¸ºäº†ä¿è¯ redo log å’Œ binlog ä¸­çš„æ•°æ®ä¸€è‡´æ€§ï¼Œé˜²æ­¢ä¸»ä»Žå¤åˆ¶å’Œäº‹åŠ¡çŠ¶æ€ä¸ä¸€è‡´ã€‚</p>
<p><img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="https://cdn.jsdelivr.net/gh/JakicDong/blog-assets@main/images/20250616093841.png" alt="20250616093841"></p>
<h4 id="ä¸ºä»€ä¹ˆ-2PC-èƒ½ä¿è¯-redo-log-å’Œ-binlog-çš„å¼ºâ¼€è‡´æ€§ï¼Ÿ"><a href="#ä¸ºä»€ä¹ˆ-2PC-èƒ½ä¿è¯-redo-log-å’Œ-binlog-çš„å¼ºâ¼€è‡´æ€§ï¼Ÿ" class="headerlink" title="ä¸ºä»€ä¹ˆ 2PC èƒ½ä¿è¯ redo log å’Œ binlog çš„å¼ºâ¼€è‡´æ€§ï¼Ÿ"></a>ä¸ºä»€ä¹ˆ 2PC èƒ½ä¿è¯ redo log å’Œ binlog çš„å¼ºâ¼€è‡´æ€§ï¼Ÿ</h4><p>å‡å¦‚ MySQL åœ¨é¢„å†™ redo log ä¹‹åŽã€å†™å…¥ binlog ä¹‹å‰å´©æºƒã€‚é‚£ä¹ˆ MySQL é‡å¯åŽ InnoDB ä¼šå›žæ»šè¯¥äº‹åŠ¡ï¼Œå› ä¸º redo log ä¸æ˜¯æäº¤çŠ¶æ€ã€‚å¹¶ä¸”ç”±äºŽ binlog ä¸­æ²¡æœ‰å†™å…¥æ•°æ®ï¼Œæ‰€ä»¥ä»Žåº“ä¹Ÿä¸ä¼šæœ‰è¯¥äº‹åŠ¡çš„æ•°æ®ã€‚</p>
<p><img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="https://cdn.jsdelivr.net/gh/JakicDong/blog-assets@main/images/20250616093925.png" alt="20250616093925"></p>
<p>å‡å¦‚ MySQL åœ¨å†™å…¥ binlog ä¹‹åŽã€redo log æäº¤ä¹‹å‰å´©æºƒã€‚é‚£ä¹ˆ MySQL é‡å¯åŽ InnoDB ä¼šæäº¤è¯¥äº‹åŠ¡ï¼Œå› ä¸º redo log æ˜¯æäº¤çŠ¶æ€ã€‚å¹¶ä¸”ç”±äºŽ binlog ä¸­æœ‰å†™å…¥æ•°æ®ï¼Œæ‰€ä»¥ä»Žåº“ä¹Ÿä¼šåŒæ­¥åˆ°è¯¥äº‹åŠ¡çš„æ•°æ®ã€‚<br>ä¼ªä»£ç å¦‚ä¸‹:</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// äº‹åŠ¡å¼€å§‹</span></span><br><span class="line">begin;</span><br><span class="line"><span class="comment">// try</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="comment">// æ‰§è¡Œ SQL</span></span><br><span class="line">    execute SQL;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// å†™å…¥ redo log å¹¶æ ‡è®°ä¸º prepare</span></span><br><span class="line">    write redo log prepare xid;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// å†™å…¥ binlog</span></span><br><span class="line">    write binlog xid sql;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// æäº¤ redo log</span></span><br><span class="line">    commit redo log xid;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// catch</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="comment">// å›žæ»š redo log</span></span><br><span class="line">    innodb rollback redo log xid;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// äº‹åŠ¡ç»“æŸ</span></span><br><span class="line">end;</span><br></pre></td></tr></table></figure>

<h4 id="XID-äº†è§£å—ï¼Ÿ"><a href="#XID-äº†è§£å—ï¼Ÿ" class="headerlink" title="XID äº†è§£å—ï¼Ÿ"></a>XID äº†è§£å—ï¼Ÿ</h4><p>XID æ˜¯ binlog ä¸­ç”¨æ¥<strong>æ ‡è¯†äº‹åŠ¡æäº¤</strong>çš„å”¯ä¸€æ ‡è¯†ç¬¦ã€‚<br><img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="https://cdn.jsdelivr.net/gh/JakicDong/blog-assets@main/images/20250616094148.png" alt="20250616094148"></p>
<p>åœ¨äº‹åŠ¡æäº¤æ—¶ï¼Œä¼šå†™å…¥ä¸€ä¸ª <code>XID_EVENT</code> åˆ° <code>binlog</code>ï¼Œè¡¨ç¤ºè¿™ä¸ªäº‹åŠ¡çœŸæ­£å®Œæˆäº†ã€‚</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">  Log_name         | Pos  | Event_type     | Server_id | End_log_pos | Info      </span><br><span class="line">| mysql-bin<span class="number">.000003</span> | <span class="number">2005</span> | Gtid           |   <span class="number">1013307</span> |        <span class="number">2070</span> | SET @<span class="meta">@SESSION</span>.GTID_NEXT= <span class="string">&#x27;f971d5f1-d450-11ec-9e7b-5254000a56df:11&#x27;</span>                 |</span><br><span class="line">| mysql-bin<span class="number">.000003</span> | <span class="number">2070</span> | Query          |   <span class="number">1013307</span> |        <span class="number">2142</span> | BEGIN                                                                              |</span><br><span class="line">| mysql-bin<span class="number">.000003</span> | <span class="number">2142</span> | Table_map      |   <span class="number">1013307</span> |        <span class="number">2187</span> | table_id: <span class="number">109</span> (test.t1)                                                            |</span><br><span class="line">| mysql-bin<span class="number">.000003</span> | <span class="number">2187</span> | Write_rows     |   <span class="number">1013307</span> |        <span class="number">2227</span> | table_id: <span class="number">109</span> flags: STMT_END_F                                                    |</span><br><span class="line">| mysql-bin<span class="number">.000003</span> | <span class="number">2227</span> | Xid            |   <span class="number">1013307</span> |        <span class="number">2258</span> | COMMIT <span class="comment">/* xid=121 */</span></span><br></pre></td></tr></table></figure>
<p>å®ƒä¸ä»…ç”¨äºŽ<strong>ä¸»ä»Žå¤åˆ¶ä¸­äº‹åŠ¡å®Œæ•´æ€§çš„åˆ¤æ–­</strong>ï¼Œä¹Ÿåœ¨<strong>å´©æºƒæ¢å¤ä¸­å¯¹ redo log å’Œ binlog çš„ä¸€è‡´æ€§æ ¡éªŒ</strong>èµ·åˆ°å…³é”®ä½œç”¨ã€‚</p>
<p>XID å¯ä»¥å¸®åŠ© MySQL åˆ¤æ–­å“ªäº› redo log æ˜¯å·²æäº¤çš„ï¼Œå“ªäº›æ˜¯æœªæäº¤éœ€è¦å›žæ»šçš„ï¼Œæ˜¯ä¸¤é˜¶æ®µæäº¤æœºåˆ¶ä¸­éžå¸¸å…³é”®çš„ä¸€çŽ¯ã€‚</p>
<h3 id="31-ðŸŒŸredo-log-çš„å†™å…¥è¿‡ç¨‹äº†è§£å—ï¼Ÿ"><a href="#31-ðŸŒŸredo-log-çš„å†™å…¥è¿‡ç¨‹äº†è§£å—ï¼Ÿ" class="headerlink" title="31.ðŸŒŸredo log çš„å†™å…¥è¿‡ç¨‹äº†è§£å—ï¼Ÿ"></a>31.ðŸŒŸredo log çš„å†™å…¥è¿‡ç¨‹äº†è§£å—ï¼Ÿ</h3><p>InnoDB ä¼šå…ˆå°† Redo Log å†™å…¥å†…å­˜ä¸­çš„ Redo Log Bufferï¼Œä¹‹åŽå†ä»¥ä¸€å®šçš„é¢‘çŽ‡åˆ·å…¥åˆ°ç£ç›˜çš„ Redo Log File ä¸­ã€‚</p>
<p><img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="https://cdn.jsdelivr.net/gh/JakicDong/blog-assets@main/images/20250616101033.png" alt="20250616101033"></p>
<h4 id="å“ªäº›åœºæ™¯ä¼šè§¦å‘-redo-log-çš„åˆ·ç›˜åŠ¨ä½œï¼Ÿ"><a href="#å“ªäº›åœºæ™¯ä¼šè§¦å‘-redo-log-çš„åˆ·ç›˜åŠ¨ä½œï¼Ÿ" class="headerlink" title="å“ªäº›åœºæ™¯ä¼šè§¦å‘ redo log çš„åˆ·ç›˜åŠ¨ä½œï¼Ÿ"></a>å“ªäº›åœºæ™¯ä¼šè§¦å‘ redo log çš„åˆ·ç›˜åŠ¨ä½œï¼Ÿ</h4><p>æ¯”å¦‚è¯´ <strong>Redo Log Buffer çš„ç©ºé—´ä¸è¶³æ—¶</strong>ï¼Œ<strong>äº‹åŠ¡æäº¤æ—¶</strong>ï¼Œ<strong>è§¦å‘ Checkpoint æ—¶</strong>ï¼ŒåŽå°çº¿ç¨‹å®šæœŸåˆ·ç›˜æ—¶ã€‚<br>ä¸è¿‡ï¼ŒRedo Log Buffer åˆ·ç›˜åˆ° Redo Log File è¿˜ä¼šæ¶‰åŠåˆ°æ“ä½œç³»ç»Ÿçš„ç£ç›˜ç¼“å­˜ç­–ç•¥ï¼Œå¯èƒ½ä¸ä¼šç«‹å³åˆ·ç›˜ï¼Œè€Œæ˜¯ç­‰å¾…ä¸€å®šæ—¶é—´åŽæ‰åˆ·ç›˜ã€‚</p>
<p><img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="https://cdn.jsdelivr.net/gh/JakicDong/blog-assets@main/images/20250616110133.png" alt="20250616110133"></p>
<h4 id="innodb-flush-log-at-trx-commit-å‚æ•°ä½ äº†è§£å¤šå°‘ï¼Ÿ"><a href="#innodb-flush-log-at-trx-commit-å‚æ•°ä½ äº†è§£å¤šå°‘ï¼Ÿ" class="headerlink" title="innodb_flush_log_at_trx_commit å‚æ•°ä½ äº†è§£å¤šå°‘ï¼Ÿ"></a>innodb_flush_log_at_trx_commit å‚æ•°ä½ äº†è§£å¤šå°‘ï¼Ÿ</h4><p><code>innodb_flush_log_at_trx_commit</code> å‚æ•°æ˜¯ç”¨æ¥æŽ§åˆ¶äº‹åŠ¡æäº¤æ—¶ï¼ŒRedo Log çš„åˆ·ç›˜ç­–ç•¥ï¼Œä¸€å…±æœ‰ä¸‰ç§ã€‚</p>
<p>0 è¡¨ç¤º<strong>äº‹åŠ¡æäº¤æ—¶ä¸åˆ·ç›˜</strong>ï¼Œè€Œæ˜¯<strong>äº¤ç»™åŽå°çº¿ç¨‹æ¯éš” 1 ç§’æ‰§è¡Œä¸€æ¬¡</strong>ã€‚è¿™ç§æ–¹å¼æ€§èƒ½æœ€å¥½ï¼Œä½†æ˜¯åœ¨ MySQL å®•æœºæ—¶<strong>å¯èƒ½ä¼šä¸¢å¤±ä¸€ç§’å†…çš„äº‹åŠ¡</strong>ã€‚</p>
<p>1 è¡¨ç¤º<strong>äº‹åŠ¡æäº¤æ—¶ä¼šç«‹å³åˆ·ç›˜</strong>ï¼Œç¡®ä¿äº‹åŠ¡æäº¤åŽæ•°æ®å°±æŒä¹…åŒ–åˆ°ç£ç›˜ã€‚è¿™<strong>ç§æ–¹å¼æ˜¯æœ€å®‰å…¨çš„ï¼Œä¹Ÿæ˜¯ InnoDB çš„é»˜è®¤å€¼</strong>ã€‚</p>
<p><img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="https://cdn.jsdelivr.net/gh/JakicDong/blog-assets@main/images/20250616112123.png" alt="20250616112123"></p>
<p>2 è¡¨ç¤ºäº‹åŠ¡æäº¤æ—¶åªæŠŠ Redo Log Buffer å†™å…¥åˆ° Page Cacheï¼Œç”±æ“ä½œç³»ç»Ÿå†³å®šä»€ä¹ˆæ—¶å€™åˆ·ç›˜ã€‚<strong>æ“ä½œç³»ç»Ÿå®•æœºæ—¶ï¼Œå¯èƒ½ä¼šä¸¢å¤±ä¸€éƒ¨åˆ†æ•°æ®ã€‚</strong></p>
<h4 id="ä¸€ä¸ªæ²¡æœ‰æäº¤äº‹åŠ¡çš„-redo-logï¼Œä¼šä¸ä¼šåˆ·ç›˜ï¼Ÿ"><a href="#ä¸€ä¸ªæ²¡æœ‰æäº¤äº‹åŠ¡çš„-redo-logï¼Œä¼šä¸ä¼šåˆ·ç›˜ï¼Ÿ" class="headerlink" title="ä¸€ä¸ªæ²¡æœ‰æäº¤äº‹åŠ¡çš„ redo logï¼Œä¼šä¸ä¼šåˆ·ç›˜ï¼Ÿ"></a>ä¸€ä¸ªæ²¡æœ‰æäº¤äº‹åŠ¡çš„ redo logï¼Œä¼šä¸ä¼šåˆ·ç›˜ï¼Ÿ</h4><p>InnoDB æœ‰ä¸€ä¸ªåŽå°çº¿ç¨‹ï¼Œæ¯éš” 1 ç§’ä¼šæŠŠ<code>Redo Log Buffer</code>ä¸­çš„æ—¥å¿—å†™å…¥åˆ°æ–‡ä»¶ç³»ç»Ÿçš„ç¼“å­˜ä¸­ï¼Œç„¶åŽè°ƒç”¨åˆ·ç›˜æ“ä½œã€‚<br><img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="https://cdn.jsdelivr.net/gh/JakicDong/blog-assets@main/images/20250616113040.png" alt="20250616113040"></p>
<p>å› æ­¤ï¼Œä¸€ä¸ªæ²¡æœ‰æäº¤äº‹åŠ¡çš„ Redo Log ä¹Ÿå¯èƒ½ä¼šè¢«åˆ·æ–°åˆ°ç£ç›˜ä¸­ã€‚<br>å¦å¤–ï¼Œå¦‚æžœå½“ <code>Redo Log Buffer</code> å ç”¨çš„ç©ºé—´å³å°†è¾¾åˆ° <code>innodb_log_buffer_size</code> çš„ä¸€åŠæ—¶ï¼Œä¹Ÿä¼šè§¦å‘åˆ·ç›˜æ“ä½œã€‚</p>
<h4 id="Redo-Log-Buffer-æ˜¯é¡ºåºå†™è¿˜æ˜¯éšæœºå†™ï¼Ÿ"><a href="#Redo-Log-Buffer-æ˜¯é¡ºåºå†™è¿˜æ˜¯éšæœºå†™ï¼Ÿ" class="headerlink" title="Redo Log Buffer æ˜¯é¡ºåºå†™è¿˜æ˜¯éšæœºå†™ï¼Ÿ"></a>Redo Log Buffer æ˜¯é¡ºåºå†™è¿˜æ˜¯éšæœºå†™ï¼Ÿ</h4><p>MySQL åœ¨å¯åŠ¨åŽä¼šå‘æ“ä½œç³»ç»Ÿç”³è¯·ä¸€å—è¿žç»­çš„å†…å­˜ç©ºé—´ä½œä¸º Redo Log Bufferï¼Œå¹¶å°†å…¶åˆ†ä¸ºè‹¥å¹²ä¸ªè¿žç»­çš„ Redo Log Blockã€‚<br><img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="https://cdn.jsdelivr.net/gh/JakicDong/blog-assets@main/images/20250616113305.png" alt="20250616113305"><br>é‚£ä¸ºäº†æé«˜å†™å…¥æ•ˆçŽ‡ï¼ŒRedo Log Buffer é‡‡ç”¨äº†é¡ºåºå†™å…¥çš„æ–¹å¼ï¼Œä¼šå…ˆå¾€å‰é¢çš„ Redo Log Block ä¸­å†™å…¥ï¼Œå½“å†™æ»¡åŽå†å¾€åŽé¢çš„ Block ä¸­å†™å…¥ã€‚<br><img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="https://cdn.jsdelivr.net/gh/JakicDong/blog-assets@main/images/20250616113328.png" alt="20250616113328"><br>äºŽæ­¤åŒæ—¶ï¼ŒInnoDB è¿˜æä¾›äº†ä¸€ä¸ªå…¨å±€å˜é‡ <code>buf_free</code>ï¼Œæ¥æŽ§åˆ¶åŽç»­çš„ redo log è®°å½•åº”è¯¥å†™å…¥åˆ° block ä¸­çš„å“ªä¸ªä½ç½®ã€‚</p>
<h4 id="buf-next-to-write-äº†è§£å—ï¼Ÿ"><a href="#buf-next-to-write-äº†è§£å—ï¼Ÿ" class="headerlink" title="buf_next_to_write äº†è§£å—ï¼Ÿ"></a>buf_next_to_write äº†è§£å—ï¼Ÿ</h4><p><code>buf_next_to_write</code> æŒ‡å‘ Redo Log Buffer ä¸­ä¸‹ä¸€æ¬¡éœ€è¦å†™å…¥ç¡¬ç›˜çš„èµ·å§‹ä½ç½®ã€‚</p>
<p><img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="https://cdn.jsdelivr.net/gh/JakicDong/blog-assets@main/images/20250616113533.png" alt="20250616113533"><br>è€Œ buf_free æŒ‡å‘çš„æ˜¯ Redo Log Buffer ä¸­ç©ºé—²åŒºåŸŸçš„èµ·å§‹ä½ç½®ã€‚</p>
<h4 id="äº†è§£-MTR-å—ï¼Ÿ"><a href="#äº†è§£-MTR-å—ï¼Ÿ" class="headerlink" title="äº†è§£ MTR å—ï¼Ÿ"></a>äº†è§£ MTR å—ï¼Ÿ</h4><p><code>Mini Transaction </code>æ˜¯ InnoDB å†…éƒ¨ç”¨äºŽæ“ä½œæ•°æ®é¡µçš„åŽŸå­æ“ä½œå•å…ƒã€‚</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">mtr_t mtr;</span><br><span class="line">mtr_start(&amp;mtr);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 1. åŠ é”</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// å¯¹å¾…è®¿é—®çš„indexåŠ é”</span></span><br><span class="line">mtr_s_lock(rw_lock_t, mtr);</span><br><span class="line">mtr_x_lock(rw_lock_t, mtr);</span><br><span class="line"></span><br><span class="line"><span class="comment">// å¯¹å¾…è¯»å†™çš„pageåŠ é”</span></span><br><span class="line">mtr_memo_push(mtr, buf_block_t, MTR_MEMO_PAGE_S_FIX);</span><br><span class="line">mtr_memo_push(mtr, buf_block_t, MTR_MEMO_PAGE_X_FIX);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 2. è®¿é—®æˆ–ä¿®æ”¹page</span></span><br><span class="line">btr_cur_search_to_nth_level</span><br><span class="line">btr_cur_optimistic_insert</span><br><span class="line"></span><br><span class="line"><span class="comment">// 3. ä¸ºä¿®æ”¹æ“ä½œç”Ÿæˆredo</span></span><br><span class="line">mlog_open</span><br><span class="line">mlog_write_initial_log_record_fast</span><br><span class="line">mlog_close</span><br><span class="line"></span><br><span class="line"><span class="comment">// 4. æŒä¹…åŒ–redoï¼Œè§£é”</span></span><br><span class="line">mtr_commit(&amp;mtr);</span><br></pre></td></tr></table></figure>
<p>å¤šä¸ªäº‹åŠ¡çš„ Redo Log ä¼šä»¥ MTR ä¸ºå•ä½äº¤æ›¿å†™å…¥åˆ° Redo Log Buffer ä¸­ï¼Œå‡å¦‚äº‹åŠ¡ 1 å’Œäº‹åŠ¡ 2 å‡æœ‰ä¸¤ä¸ª MTRï¼Œä¸€æ—¦æŸä¸ª MTR ç»“æŸï¼Œå°±ä¼šå°†å…¶ç”Ÿæˆçš„è‹¥å¹²æ¡ Redo Log è®°å½•é¡ºåºå†™å…¥åˆ° Redo Log Buffer ä¸­ã€‚</p>
<p><img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="https://cdn.jsdelivr.net/gh/JakicDong/blog-assets@main/images/20250616151955.png" alt="20250616151955"></p>
<p>ä¹Ÿå°±æ˜¯è¯´ï¼Œä¸€ä¸ª MTR ä¼šåŒ…å«ä¸€ç»„ Redo Log è®°å½•ï¼Œæ˜¯ MySQL å´©æºƒåŽæ¢å¤äº‹åŠ¡çš„æœ€å°æ‰§è¡Œå•å…ƒã€‚</p>
<p><img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="https://cdn.jsdelivr.net/gh/JakicDong/blog-assets@main/images/20250616154016.png" alt="20250616154016"></p>
<h4 id="Redo-Log-Block-çš„ç»“æž„äº†è§£å—ï¼Ÿ"><a href="#Redo-Log-Block-çš„ç»“æž„äº†è§£å—ï¼Ÿ" class="headerlink" title="Redo Log Block çš„ç»“æž„äº†è§£å—ï¼Ÿ"></a>Redo Log Block çš„ç»“æž„äº†è§£å—ï¼Ÿ</h4><p><code>Redo Log Block</code> ç”±æ—¥å¿—å¤´ã€æ—¥å¿—ä½“å’Œæ—¥å¿—å°¾ç»„æˆï¼Œä¸€å…±å ç”¨ 512 ä¸ªå­—èŠ‚ï¼Œå…¶ä¸­æ—¥å¿—å¤´å ç”¨ 12 ä¸ªå­—èŠ‚ï¼Œæ—¥å¿—å°¾å ç”¨ 4 ä¸ªå­—èŠ‚ï¼Œå‰©ä½™çš„ 496 ä¸ªå­—èŠ‚ç”¨äºŽå­˜å‚¨æ—¥å¿—ä½“ã€‚<br><img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="https://cdn.jsdelivr.net/gh/JakicDong/blog-assets@main/images/20250616154915.png" alt="20250616154915"><br>æ—¥å¿—å¤´åŒ…å«äº†å½“å‰ Block çš„åºåˆ—å·ã€ç¬¬ä¸€æ¡æ—¥å¿—çš„åºåˆ—å·ã€ç±»åž‹ç­‰ä¿¡æ¯ã€‚<br><img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="https://cdn.jsdelivr.net/gh/JakicDong/blog-assets@main/images/20250616154950.png" alt="20250616154950"><br>æ—¥å¿—å°¾ä¸»è¦å­˜å‚¨çš„æ˜¯ LOG_BLOCK_CHECKSUMï¼Œä¹Ÿå°±æ˜¯ Block çš„æ ¡éªŒå’Œï¼Œä¸»è¦ç”¨äºŽåˆ¤æ–­ Block æ˜¯å¦å®Œæ•´ã€‚</p>
<h4 id="Redo-Log-Block-ä¸ºä»€ä¹ˆè®¾è®¡æˆ-512-å­—èŠ‚ï¼Ÿ"><a href="#Redo-Log-Block-ä¸ºä»€ä¹ˆè®¾è®¡æˆ-512-å­—èŠ‚ï¼Ÿ" class="headerlink" title="Redo Log Block ä¸ºä»€ä¹ˆè®¾è®¡æˆ 512 å­—èŠ‚ï¼Ÿ"></a>Redo Log Block ä¸ºä»€ä¹ˆè®¾è®¡æˆ 512 å­—èŠ‚ï¼Ÿ</h4><p>å› ä¸ºæœºæ¢°ç¡¬ç›˜çš„ç‰©ç†æ‰‡åŒºå¤§å°é€šå¸¸ä¸º 512 å­—èŠ‚ï¼Œ<code>Redo Log Block</code> ä¹Ÿè®¾è®¡ä¸ºåŒæ ·çš„å¤§å°ï¼Œå°±å¯ä»¥ç¡®ä¿æ¯æ¬¡å†™å…¥éƒ½æ˜¯æ•´æ•°ä¸ªæ‰‡åŒºï¼Œå‡å°‘å¯¹é½å¼€é”€ã€‚</p>
<p><img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="https://cdn.jsdelivr.net/gh/JakicDong/blog-assets@main/images/20250616155054.png" alt="20250616155054"></p>
<p>æ¯”å¦‚è¯´æ“ä½œç³»ç»Ÿçš„é¡µç¼“å­˜é»˜è®¤ä¸º 4KBï¼Œ8 ä¸ª Redo Log Block å°±å¯ä»¥ç»„åˆæˆä¸€ä¸ªé¡µç¼“å­˜å•å…ƒï¼Œä»Žè€Œæå‡ Redo Log Buffer çš„å†™å…¥æ•ˆçŽ‡ã€‚</p>
<h4 id="LSN-äº†è§£å—ï¼Ÿ"><a href="#LSN-äº†è§£å—ï¼Ÿ" class="headerlink" title="LSN äº†è§£å—ï¼Ÿ"></a>LSN äº†è§£å—ï¼Ÿ</h4><p>Log Sequence Number æ˜¯ä¸€ä¸ª 8 å­—èŠ‚çš„å•è°ƒé€’å¢žæ•´æ•°ï¼Œç”¨æ¥æ ‡è¯†äº‹åŠ¡å†™å…¥ redo log çš„å­—èŠ‚æ€»é‡ï¼Œå­˜åœ¨äºŽ redo logã€æ•°æ®é¡µå¤´éƒ¨å’Œ checkpoint ä¸­ã€‚</p>
<p><img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="https://cdn.jsdelivr.net/gh/JakicDong/blog-assets@main/images/20250616160916.png" alt="20250616160916"></p>
<p>â€”-è¿™éƒ¨åˆ†æ˜¯å¸®åŠ©ç†è§£ startï¼Œé¢è¯•ä¸­å¯ä¸èƒŒâ€”-<br>MySQL åœ¨ç¬¬ä¸€æ¬¡å¯åŠ¨æ—¶ï¼ŒLSN çš„åˆå§‹å€¼å¹¶ä¸ä¸º 0ï¼Œè€Œæ˜¯ 8704ï¼›å½“ MySQL å†æ¬¡å¯åŠ¨æ—¶ï¼Œä¼šç»§ç»­ä½¿ç”¨ä¸Šä¸€æ¬¡æœåŠ¡åœæ­¢æ—¶çš„ LSNã€‚</p>
<p>åœ¨è®¡ç®— LSN çš„å¢žé‡æ—¶ï¼Œ<strong>ä¸ä»…éœ€è¦è€ƒè™‘ log block body çš„å¤§å°ï¼Œè¿˜éœ€è¦è€ƒè™‘ log block header å’Œ log block tail ä¸­éƒ¨åˆ†å­—èŠ‚æ•°</strong>ã€‚</p>
<p>æ¯”å¦‚è¯´åœ¨ä¸Šå›¾ä¸­ï¼Œäº‹åŠ¡ 3 çš„ MTR æ€»é‡ä¸º 300 å­—èŠ‚ï¼Œé‚£ä¹ˆå†™å…¥åˆ° Redo Log Buffer ä¸­çš„ LSN ä¼šå¢žé•¿ä¸º 8704 + 300 + 12 &#x3D; 9016ã€‚</p>
<p>å‡å¦‚äº‹åŠ¡ 4 çš„ MTR æ€»é‡ä¸º 900 å­—èŠ‚ï¼Œé‚£ä¹ˆå†æ¬¡å†™å…¥åˆ° Redo Log Buffer ä¸­çš„ LSN ä¼šå¢žé•¿ä¸º 9016 + 900 + 12<em>2 + 4</em>2 &#x3D; 9948ã€‚</p>
<p>2 ä¸ª 12 å­—èŠ‚çš„ log block header + 2 ä¸ª 4 å­—èŠ‚çš„ log block tailã€‚</p>
<p>â€”-è¿™éƒ¨åˆ†æ˜¯å¸®åŠ©ç†è§£ endï¼Œé¢è¯•ä¸­å¯ä¸èƒŒâ€”-</p>
<p><strong>æ ¸å¿ƒä½œç”¨æœ‰ä¸‰ä¸ªï¼š</strong></p>
<p>ç¬¬ä¸€ï¼Œ<code>redo log</code> æŒ‰ç…§ LSN é€’å¢žé¡ºåºè®°å½•æ‰€æœ‰æ•°æ®çš„ä¿®æ”¹æ“ä½œã€‚LSN çš„é€’å¢žé‡ç­‰äºŽæ¯æ¬¡å†™å…¥æ—¥å¿—çš„å­—èŠ‚æ•°ã€‚</p>
<p>ç¬¬äºŒï¼ŒInnoDB çš„æ¯ä¸ªæ•°æ®é¡µå¤´éƒ¨ä¸­ï¼Œéƒ½ä¼šè®°å½•è¯¥é¡µæœ€åŽä¸€æ¬¡åˆ·æ–°åˆ°ç£ç›˜æ—¶çš„ LSNã€‚å¦‚æžœæ•°æ®é¡µçš„ LSN å°äºŽ redo log çš„ LSNï¼Œè¯´æ˜Žè¯¥é¡µéœ€è¦ä»Žæ—¥å¿—ä¸­æ¢å¤ï¼›å¦åˆ™è¯´æ˜Žè¯¥é¡µå·²æ›´æ–°ã€‚</p>
<p>ç¬¬ä¸‰ï¼Œcheckpoint é€šè¿‡ LSN è®°å½•å·²åˆ·æ–°åˆ°ç£ç›˜çš„æ•°æ®é¡µä½ç½®ï¼Œå‡å°‘æ¢å¤æ—¶éœ€è¦å¤„ç†çš„æ—¥å¿—ã€‚</p>
<p>â€”-è¿™éƒ¨åˆ†æ˜¯å¸®åŠ©ç†è§£ startï¼Œé¢è¯•ä¸­å¯ä¸èƒŒâ€”-<br><img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="https://cdn.jsdelivr.net/gh/JakicDong/blog-assets@main/images/20250616162021.png" alt="20250616162021"></p>
<p>å¯ä»¥é€šè¿‡ <code>show engine innodb status;</code> æŸ¥çœ‹å½“å‰çš„ LSN ä¿¡æ¯ã€‚</p>
<p><img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="https://cdn.jsdelivr.net/gh/JakicDong/blog-assets@main/images/20250616162445.png" alt="20250616162445"></p>
<ul>
<li>Log sequence numberï¼šå½“å‰ç³»ç»Ÿæœ€å¤§ LSNï¼ˆå·²ç”Ÿæˆçš„æ—¥å¿—æ€»é‡ï¼‰ã€‚</li>
<li>Log flushed up toï¼šå·²å†™å…¥ç£ç›˜çš„ redo log LSNã€‚</li>
<li>Pages flushed up toï¼šå·²åˆ·æ–°åˆ°æ•°æ®é¡µçš„ LSNã€‚</li>
<li>Last checkpoint atï¼šæœ€åŽä¸€æ¬¡æ£€æŸ¥ç‚¹çš„ LSNï¼Œè¡¨ç¤ºå·²æŒä¹…åŒ–çš„æ•°æ®çŠ¶æ€ã€‚</li>
</ul>
<p>â€”-è¿™éƒ¨åˆ†æ˜¯å¸®åŠ©ç†è§£ endï¼Œé¢è¯•ä¸­å¯ä¸èƒŒâ€”-</p>
<h4 id="Checkpoint-äº†è§£å¤šå°‘ï¼Ÿ"><a href="#Checkpoint-äº†è§£å¤šå°‘ï¼Ÿ" class="headerlink" title="Checkpoint äº†è§£å¤šå°‘ï¼Ÿ"></a>Checkpoint äº†è§£å¤šå°‘ï¼Ÿ</h4><p><code>Checkpoint </code>æ˜¯ InnoDB ä¸ºäº†ä¿è¯äº‹åŠ¡æŒä¹…æ€§å’Œå›žæ”¶ redo log ç©ºé—´çš„ä¸€ç§æœºåˆ¶ã€‚</p>
<p>å®ƒçš„ä½œç”¨æ˜¯åœ¨åˆé€‚çš„æ—¶æœºå°†éƒ¨åˆ†è„é¡µåˆ·å…¥ç£ç›˜ï¼Œæ¯”å¦‚è¯´ buffer pool çš„å®¹é‡ä¸è¶³æ—¶ã€‚å¹¶è®°å½•å½“å‰ <code>LSN</code> ä¸º <code>Checkpoint LSN</code>ï¼Œè¡¨ç¤ºè¿™ä¸ªä½ç½®ä¹‹å‰çš„ redo log file å·²ç»å®‰å…¨ï¼Œå¯ä»¥è¢«è¦†ç›–äº†ã€‚</p>
<p>MySQL å´©æºƒæ¢å¤æ—¶åªéœ€è¦ä»Ž Checkpoint ä¹‹åŽå¼€å§‹æ¢å¤ redo log å°±å¯ä»¥äº†ï¼Œè¿™æ ·å¯ä»¥æœ€å¤§ç¨‹åº¦å‡å°‘æ¢å¤æ‰€èŠ±è´¹çš„æ—¶é—´ã€‚</p>
<p>redo log file çš„å†™å…¥æ˜¯å¾ªçŽ¯çš„ï¼Œå…¶ä¸­æœ‰ä¸¤ä¸ªæ ‡è®°ä½ç½®éžå¸¸é‡è¦ï¼Œä¹Ÿå°±æ˜¯ Checkpoint å’Œ write posã€‚<br><img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="https://cdn.jsdelivr.net/gh/JakicDong/blog-assets@main/images/20250616162937.png" alt="20250616162937"></p>
<p>write pos æ˜¯ redo log å½“å‰å†™å…¥çš„ä½ç½®ï¼ŒCheckpoint æ˜¯å¯ä»¥è¢«è¦†ç›–çš„ä½ç½®ã€‚</p>
<p>å½“ write pos è¿½ä¸Š Checkpoint æ—¶ï¼Œè¡¨ç¤º redo log æ—¥å¿—å·²ç»å†™æ»¡ã€‚è¿™æ—¶å€™å°±è¦æš‚åœå†™å…¥å¹¶å¼ºåˆ¶åˆ·ç›˜ï¼Œé‡Šæ”¾å¯è¦†å†™çš„æ—¥å¿—ç©ºé—´ã€‚</p>
<p><img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="https://cdn.jsdelivr.net/gh/JakicDong/blog-assets@main/images/20250616163140.png" alt="20250616163140"></p>
<h4 id="å…³äºŽredo-log-çš„è°ƒä¼˜å‚æ•°äº†è§£å¤šå°‘ï¼Ÿ"><a href="#å…³äºŽredo-log-çš„è°ƒä¼˜å‚æ•°äº†è§£å¤šå°‘ï¼Ÿ" class="headerlink" title="å…³äºŽredo log çš„è°ƒä¼˜å‚æ•°äº†è§£å¤šå°‘ï¼Ÿ"></a>å…³äºŽredo log çš„è°ƒä¼˜å‚æ•°äº†è§£å¤šå°‘ï¼Ÿ</h4><p>å¦‚æžœæ˜¯<code>é«˜å¹¶å‘å†™å…¥</code>çš„ç”µå•†ç³»ç»Ÿï¼Œå¯ä»¥æœ€å¤§åŒ–å†™å…¥åžåé‡ï¼Œå®¹å¿ç§’çº§æ•°æ®ä¸¢å¤±çš„é£Žé™©ã€‚</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">innodb_flush_log_at_trx_commit = <span class="number">2</span></span><br><span class="line">sync_binlog = <span class="number">1000</span></span><br><span class="line">innodb_redo_log_capacity = 64<span class="type">G</span></span><br><span class="line"><span class="variable">innodb_io_capacity</span> <span class="operator">=</span> <span class="number">5000</span></span><br><span class="line">innodb_lru_scan_depth = <span class="number">512</span></span><br><span class="line">innodb_log_buffer_size = 256M</span><br></pre></td></tr></table></figure>
<p>å¦‚æžœæ˜¯é‡‘èžäº¤æ˜“ç³»ç»Ÿï¼Œéœ€è¦<code>ä¿è¯æ•°æ®é›¶ä¸¢å¤±</code>ï¼ŒæŽ¥å—è¾ƒä½Žçš„åžåé‡ã€‚</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">innodb_flush_log_at_trx_commit = <span class="number">1</span></span><br><span class="line">sync_binlog = <span class="number">1</span></span><br><span class="line">innodb_redo_log_capacity = 32<span class="type">G</span></span><br><span class="line"><span class="variable">innodb_io_capacity</span> <span class="operator">=</span> <span class="number">2000</span></span><br><span class="line">innodb_lru_scan_depth = <span class="number">1024</span></span><br></pre></td></tr></table></figure>
<p>æ ¸å¿ƒå‚æ•°ä¸€è§ˆè¡¨:<br><img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="https://cdn.jsdelivr.net/gh/JakicDong/blog-assets@main/images/20250616163309.png" alt="20250616163309"></p>
<h3 id="æ€»ç»“"><a href="#æ€»ç»“" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h3><ul>
<li>å¯¹æ•°æ®ä¸€è‡´æ€§è¦æ±‚é«˜çš„åœºæ™¯ï¼Œå¦‚é‡‘èžäº¤æ˜“ä½¿ç”¨innodb_flush_log_at_trx_commit&#x3D;1ï¼Œå¯¹å†™å…¥åžåé‡æ•æ„Ÿçš„åœºæ™¯ï¼Œå¦‚æ—¥å¿—é‡‡é›†å¯ä»¥ä½¿ç”¨ &#x3D;2 æˆ– &#x3D;0ï¼Œéœ€è¦ç»“åˆ sync_binlog å‚æ•°</li>
<li>sync_binlog å‚æ•°æŽ§åˆ¶ binlog çš„åˆ·ç›˜ç­–ç•¥ï¼Œå¯ä»¥è®¾ç½®ä¸º 0ã€1ã€Nï¼Œ0 è¡¨ç¤ºä¾èµ–ç³»ç»Ÿåˆ·ç›˜ï¼Œ1 è¡¨ç¤ºæ¯æ¬¡äº‹åŠ¡æäº¤éƒ½åˆ·ç›˜ï¼ˆæŽ¨èä¸Ž innodb_flush_log_at_trx_commit&#x3D;1 æ­é…ï¼‰ï¼ŒN&#x3D;1000 è¡¨ç¤ºç´¯è®¡ 1000 æ¬¡äº‹åŠ¡åŽåˆ·ç›˜</li>
<li>innodb_redo_log_capacity åŠ¨æ€è°ƒæ•´ Redo Log æ€»å®¹é‡ï¼Œå¯ä»¥æ ¹æ®ä¸šåŠ¡è´Ÿè½½æƒ…å†µè°ƒæ•´ï¼Œå»ºè®®è®¾ç½®ä¸º 1 å°æ—¶å†™å…¥é‡çš„å³°å€¼ï¼ˆå¦‚æ¯ç§’ 10MB å†™å…¥åˆ™è®¾ä¸º 36GBï¼‰</li>
<li>innodb_io_capacity å®šä¹‰ InnoDB åŽå°çº¿ç¨‹çš„æ¯ç§’ I&#x2F;O æ“ä½œä¸Šé™ï¼Œç›´æŽ¥å½±å“è„é¡µåˆ·æ–°é€ŸçŽ‡ï¼›æœºæ¢°ç¡¬ç›˜å»ºè®® 200-500ï¼ŒSSD å»ºè®® 1000-2000ï¼ŒNVMe SSD å¯è®¾ä¸º 5000+</li>
<li>innodb_lru_scan_depth æŽ§åˆ¶æ¯ä¸ªç¼“å†²æ± å®žä¾‹ä¸­ LRU åˆ—è¡¨çš„æ‰«ææ·±åº¦ï¼Œå†³å®šæ¯ç§’å¯åˆ·æ–°çš„è„é¡µæ•°é‡ï¼Œé»˜è®¤å€¼ 1024 é€‚ç”¨äºŽå¤šæ•°åœºæ™¯ï¼ŒI&#x2F;O å¯†é›†åž‹è´Ÿè½½å¯é€‚å½“é™ä½Žï¼ˆå¦‚ 512ï¼‰ï¼Œå‡å°‘ CPU å¼€é”€ã€‚</li>
</ul>
<h3 id="ðŸŒŸ32-ä»€ä¹ˆæ˜¯æ…¢-SQLï¼Ÿ"><a href="#ðŸŒŸ32-ä»€ä¹ˆæ˜¯æ…¢-SQLï¼Ÿ" class="headerlink" title="ðŸŒŸ32.ä»€ä¹ˆæ˜¯æ…¢ SQLï¼Ÿ"></a>ðŸŒŸ32.ä»€ä¹ˆæ˜¯æ…¢ SQLï¼Ÿ</h3><p>æ‹“å±•é˜…è¯»: <a target="_blank" rel="noopener" href="https://juejin.cn/post/7048974570228809741">https://juejin.cn/post/7048974570228809741</a><br>MySQL ä¸­æœ‰ä¸€ä¸ªå«<code>long_query_time</code>çš„å‚æ•°ï¼ŒåŽŸåˆ™ä¸Šæ‰§è¡Œæ—¶é—´è¶…è¿‡è¯¥å‚æ•°å€¼çš„ SQL å°±æ˜¯æ…¢ SQLï¼Œä¼šè¢«è®°å½•åˆ°<strong>æ…¢æŸ¥è¯¢æ—¥å¿—</strong>ä¸­ã€‚</p>
<p>â€”-è¿™éƒ¨åˆ†æ˜¯å¸®åŠ©ç†è§£ startï¼Œé¢è¯•ä¸­å¯ä¸èƒŒâ€”-</p>
<p>å¯é€šè¿‡ show variables like â€˜long_query_timeâ€™; æŸ¥çœ‹å½“å‰çš„ long_query_time çš„å‚æ•°å€¼ã€‚<br>â€”-è¿™éƒ¨åˆ†æ˜¯å¸®åŠ©ç†è§£ endï¼Œé¢è¯•ä¸­å¯ä¸èƒŒâ€”-</p>
<h4 id="SQL-çš„æ‰§è¡Œè¿‡ç¨‹äº†è§£å—ï¼Ÿ"><a href="#SQL-çš„æ‰§è¡Œè¿‡ç¨‹äº†è§£å—ï¼Ÿ" class="headerlink" title="SQL çš„æ‰§è¡Œè¿‡ç¨‹äº†è§£å—ï¼Ÿ"></a>SQL çš„æ‰§è¡Œè¿‡ç¨‹äº†è§£å—ï¼Ÿ</h4><p>SQL çš„æ‰§è¡Œè¿‡ç¨‹å¤§è‡´å¯ä»¥åˆ†ä¸ºå…­ä¸ªé˜¶æ®µï¼š<strong>è¿žæŽ¥ç®¡ç†</strong>ã€<strong>è¯­æ³•è§£æž</strong>ã€<strong>è¯­ä¹‰åˆ†æž</strong>ã€<strong>æŸ¥è¯¢ä¼˜åŒ–</strong>ã€<strong>æ‰§è¡Œå™¨è°ƒåº¦</strong>ã€<strong>å­˜å‚¨å¼•æ“Žè¯»å†™</strong>ç­‰ã€‚Server å±‚è´Ÿè´£ç†è§£å’Œè§„åˆ’ SQL æ€Žä¹ˆæ‰§è¡Œï¼Œå­˜å‚¨å¼•æ“Žå±‚è´Ÿè´£æ•°æ®çš„çœŸæ­£è¯»å†™ã€‚<br><img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="https://cdn.jsdelivr.net/gh/JakicDong/blog-assets@main/images/20250617154612.png" alt="20250617154612"></p>
<p>â€”-è¿™éƒ¨åˆ†æ˜¯å¸®åŠ©ç†è§£ startï¼Œé¢è¯•ä¸­å¯ä¸èƒŒâ€”-</p>
<p>æ¥è¯¦ç»†æ‹†è§£ä¸€ä¸‹ï¼š</p>
<ol>
<li>å®¢æˆ·ç«¯å‘é€ SQL è¯­å¥ç»™ MySQL æœåŠ¡å™¨ã€‚</li>
<li>å¦‚æžœæŸ¥è¯¢ç¼“å­˜æ‰“å¼€åˆ™ä¼šä¼˜å…ˆæŸ¥è¯¢ç¼“å­˜ï¼Œç¼“å­˜ä¸­æœ‰å¯¹åº”çš„ç»“æžœå°±ç›´æŽ¥è¿”å›žã€‚ä¸è¿‡ï¼ŒMySQL 8.0 å·²ç»ç§»é™¤äº†æŸ¥è¯¢ç¼“å­˜ã€‚è¿™éƒ¨åˆ†çš„åŠŸèƒ½æ­£åœ¨è¢« Redis ç­‰ç¼“å­˜ä¸­é—´ä»¶å–ä»£ã€‚</li>
<li>åˆ†æžå™¨å¯¹ SQL è¯­å¥è¿›è¡Œè¯­æ³•åˆ†æžï¼Œåˆ¤æ–­æ˜¯å¦æœ‰è¯­æ³•é”™è¯¯ã€‚</li>
<li>æžæ¸…æ¥š SQL è¯­å¥è¦å¹²å˜›åŽï¼ŒMySQL ä¼šé€šè¿‡ä¼˜åŒ–å™¨ç”Ÿæˆæ‰§è¡Œè®¡åˆ’ã€‚</li>
<li>æ‰§è¡Œå™¨è°ƒç”¨å­˜å‚¨å¼•æ“Žçš„æŽ¥å£ï¼Œæ‰§è¡Œ SQL è¯­å¥ã€‚</li>
</ol>
<p>SQL æ‰§è¡Œè¿‡ç¨‹ä¸­ï¼Œä¼˜åŒ–å™¨é€šè¿‡æˆæœ¬è®¡ç®—é¢„ä¼°å‡ºæ‰§è¡Œæ•ˆçŽ‡æœ€é«˜çš„æ–¹å¼ï¼ŒåŸºæœ¬çš„é¢„ä¼°ç»´åº¦ä¸ºï¼š</p>
<ul>
<li>IO æˆæœ¬ï¼šä»Žç£ç›˜è¯»å–æ•°æ®åˆ°å†…å­˜çš„å¼€é”€ã€‚</li>
<li>CPU æˆæœ¬ï¼šCPU å¤„ç†å†…å­˜ä¸­æ•°æ®çš„å¼€é”€ã€‚</li>
</ul>
<p>åŸºäºŽè¿™ä¸¤ä¸ªç»´åº¦ï¼Œå¯ä»¥å¾—å‡ºå½±å“ SQL æ‰§è¡Œæ•ˆçŽ‡çš„å› ç´ æœ‰ï¼š</p>
<p>â‘ ã€<strong>IO æˆæœ¬ï¼Œæ•°æ®é‡è¶Šå¤§ï¼ŒIO æˆæœ¬è¶Šé«˜</strong>ã€‚æ‰€ä»¥è¦å°½é‡æŸ¥è¯¢å¿…è¦çš„å­—æ®µï¼›å°½é‡åˆ†é¡µæŸ¥è¯¢ï¼›å°½é‡é€šè¿‡ç´¢å¼•åŠ å¿«æŸ¥è¯¢ã€‚</p>
<p>â‘¡ã€<strong>CPU æˆæœ¬</strong>ï¼Œå°½é‡é¿å…å¤æ‚çš„æŸ¥è¯¢æ¡ä»¶ï¼Œå¦‚æœ‰å¿…è¦ï¼Œè€ƒè™‘å¯¹å­æŸ¥è¯¢ç»“æžœè¿›è¡Œè¿‡æ»¤ã€‚</p>
<p>â€”-è¿™éƒ¨åˆ†æ˜¯å¸®åŠ©ç†è§£ endï¼Œé¢è¯•ä¸­å¯ä¸èƒŒâ€”-</p>
<h4 id="å¦‚ä½•ä¼˜åŒ–æ…¢SQL"><a href="#å¦‚ä½•ä¼˜åŒ–æ…¢SQL" class="headerlink" title="å¦‚ä½•ä¼˜åŒ–æ…¢SQL?"></a>å¦‚ä½•ä¼˜åŒ–æ…¢SQL?</h4><p>é¦–å…ˆï¼Œéœ€è¦æ‰¾åˆ°é‚£äº›æ¯”è¾ƒæ…¢çš„ SQLï¼Œå¯ä»¥é€šè¿‡å¯ç”¨æ…¢æŸ¥è¯¢æ—¥å¿—ï¼Œè®°å½•é‚£äº›è¶…è¿‡æŒ‡å®šæ‰§è¡Œæ—¶é—´çš„ SQL æŸ¥è¯¢ã€‚</p>
<p>ä¹Ÿå¯ä»¥ä½¿ç”¨ <code>show processlist;</code> å‘½ä»¤æŸ¥çœ‹å½“å‰æ­£åœ¨æ‰§è¡Œçš„ SQL è¯­å¥ï¼Œæ‰¾å‡ºæ‰§è¡Œæ—¶é—´è¾ƒé•¿çš„ SQLã€‚</p>
<p>æˆ–è€…åœ¨ä¸šåŠ¡åŸºå»ºä¸­åŠ å…¥å¯¹æ…¢ SQL çš„ç›‘æŽ§ï¼Œå¸¸è§çš„æ–¹æ¡ˆæœ‰å­—èŠ‚ç æ’æ¡©ã€è¿žæŽ¥æ± æ‰©å±•ã€ORM æ¡†æž¶æ‰©å±•ç­‰ã€‚</p>
<p>ç„¶åŽï¼Œä½¿ç”¨ EXPLAIN æŸ¥çœ‹æ…¢ SQL çš„æ‰§è¡Œè®¡åˆ’ï¼Œçœ‹çœ‹æœ‰æ²¡æœ‰ç”¨ç´¢å¼•ï¼Œå¤§éƒ¨åˆ†æƒ…å†µä¸‹ï¼Œæ…¢ SQL çš„åŽŸå› éƒ½æ˜¯å› ä¸ºæ²¡æœ‰ç”¨åˆ°ç´¢å¼•ã€‚</p>
<p><code>EXPLAIN SELECT * FROM your_table WHERE conditions;</code><br>æœ€åŽï¼Œæ ¹æ®åˆ†æžç»“æžœï¼Œé€šè¿‡<strong>æ·»åŠ ç´¢å¼•</strong>ã€<strong>ä¼˜åŒ–æŸ¥è¯¢æ¡ä»¶</strong>ã€<strong>å‡å°‘è¿”å›žå­—æ®µ</strong>ç­‰æ–¹å¼è¿›è¡Œä¼˜åŒ–ã€‚</p>
<h4 id="æ…¢sqlæ—¥å¿—æ€Žä¹ˆå¼€å¯ï¼Ÿ"><a href="#æ…¢sqlæ—¥å¿—æ€Žä¹ˆå¼€å¯ï¼Ÿ" class="headerlink" title="æ…¢sqlæ—¥å¿—æ€Žä¹ˆå¼€å¯ï¼Ÿ"></a>æ…¢sqlæ—¥å¿—æ€Žä¹ˆå¼€å¯ï¼Ÿ</h4><p>ç¼–è¾‘ MySQL çš„é…ç½®æ–‡ä»¶ <code>my.cnf</code>ï¼Œè®¾ç½® <code>slow_query_log</code> å‚æ•°ä¸º 1ã€‚</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">slow_query_log <span class="operator">=</span> <span class="number">1</span></span><br><span class="line">slow_query_log_file <span class="operator">=</span> <span class="operator">/</span>var<span class="operator">/</span>log<span class="operator">/</span>mysql<span class="operator">/</span>slow.log</span><br><span class="line">long_query_time <span class="operator">=</span> <span class="number">2</span>  # è®°å½•æ‰§è¡Œæ—¶é—´è¶…è¿‡<span class="number">2</span>ç§’çš„æŸ¥è¯¢</span><br></pre></td></tr></table></figure>
<p>ç„¶åŽé‡å¯ MySQL å°±å¥½äº†ã€‚</p>
<p>ä¹Ÿå¯ä»¥é€šè¿‡ set global å‘½ä»¤åŠ¨æ€è®¾ç½®ã€‚</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SET</span> <span class="keyword">GLOBAL</span> slow_query_log <span class="operator">=</span> <span class="string">&#x27;ON&#x27;</span>;</span><br><span class="line"><span class="keyword">SET</span> <span class="keyword">GLOBAL</span> slow_query_log_file <span class="operator">=</span> <span class="string">&#x27;/var/log/mysql/slow.log&#x27;</span>;</span><br><span class="line"><span class="keyword">SET</span> <span class="keyword">GLOBAL</span> long_query_time <span class="operator">=</span> <span class="number">2</span>;</span><br></pre></td></tr></table></figure>

<h3 id="ðŸŒŸ33-ä½ çŸ¥é“å“ªäº›æ–¹æ³•æ¥ä¼˜åŒ–-SQLï¼Ÿ"><a href="#ðŸŒŸ33-ä½ çŸ¥é“å“ªäº›æ–¹æ³•æ¥ä¼˜åŒ–-SQLï¼Ÿ" class="headerlink" title="ðŸŒŸ33.ä½ çŸ¥é“å“ªäº›æ–¹æ³•æ¥ä¼˜åŒ– SQLï¼Ÿ"></a>ðŸŒŸ33.ä½ çŸ¥é“å“ªäº›æ–¹æ³•æ¥ä¼˜åŒ– SQLï¼Ÿ</h3><p>SQL ä¼˜åŒ–çš„æ–¹æ³•éžå¸¸å¤šï¼Œä½†æœ¬è´¨ä¸Šå°±ä¸€å¥è¯ï¼š<strong>å°½å¯èƒ½å°‘åœ°æ‰«æã€å°½å¿«åœ°è¿”å›žç»“æžœã€‚</strong><br>æœ€å¸¸è§çš„åšæ³•å°±æ˜¯<strong>åŠ ç´¢å¼•</strong>ã€æ”¹å†™ SQL è®©å®ƒç”¨ä¸Šç´¢å¼•ï¼Œæ¯”å¦‚è¯´ä½¿ç”¨è¦†ç›–ç´¢å¼•ã€è®©è”åˆç´¢å¼•éµå®ˆæœ€å·¦å‰ç¼€åŽŸåˆ™ç­‰ã€‚</p>
<p><img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="https://cdn.jsdelivr.net/gh/JakicDong/blog-assets@main/images/20250618110546.png" alt="20250618110546"></p>
<h4 id="å¦‚ä½•åˆ©ç”¨è¦†ç›–ç´¢å¼•ï¼Ÿ"><a href="#å¦‚ä½•åˆ©ç”¨è¦†ç›–ç´¢å¼•ï¼Ÿ" class="headerlink" title="å¦‚ä½•åˆ©ç”¨è¦†ç›–ç´¢å¼•ï¼Ÿ"></a>å¦‚ä½•åˆ©ç”¨è¦†ç›–ç´¢å¼•ï¼Ÿ</h4><p>è¦†ç›–ç´¢å¼•çš„æ ¸å¿ƒæ˜¯â€œ<strong>æŸ¥è¯¢æ‰€éœ€çš„å­—æ®µéƒ½åœ¨åŒä¸€ä¸ªç´¢å¼•é‡Œ</strong>â€ï¼Œè¿™æ · MySQL å°±ä¸éœ€è¦å›žè¡¨ï¼Œç›´æŽ¥ä»Žç´¢å¼•ä¸­è¿”å›žç»“æžœã€‚<br><img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="https://cdn.jsdelivr.net/gh/JakicDong/blog-assets@main/images/20250618110821.png" alt="20250618110821"></p>
<p>å®žé™…ä½¿ç”¨ä¸­ï¼Œæˆ‘ä¼šä¼˜å…ˆè€ƒè™‘æŠŠ <code>WHERE</code> å’Œ <code>SELECT</code> æ¶‰åŠçš„å­—æ®µä¸€èµ·å»ºè”åˆç´¢å¼•ï¼Œå¹¶é€šè¿‡ <code>EXPLAIN</code> è§‚å¯Ÿç»“æžœæ˜¯å¦æœ‰ <code>Using index</code>ï¼Œç¡®è®¤å‘½ä¸­ç´¢å¼•ã€‚</p>
<p>â€”-è¿™éƒ¨åˆ†æ˜¯å¸®åŠ©ç†è§£ startï¼Œé¢è¯•ä¸­å¯ä¸èƒŒâ€”-</p>
<p>ä¸¾ä¸ªä¾‹å­ï¼ŒçŽ°åœ¨è¦ä»Ž <code>test</code> è¡¨ä¸­æŸ¥è¯¢ <code>city</code> ä¸ºä¸Šæµ·çš„ name å­—æ®µã€‚</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> name <span class="keyword">from</span> test <span class="keyword">where</span> city<span class="operator">=</span><span class="string">&#x27;ä¸Šæµ·&#x27;</span></span><br></pre></td></tr></table></figure>
<p>å¦‚æžœä»…åœ¨ city å­—æ®µä¸Šæ·»åŠ ç´¢å¼•ï¼Œé‚£ä¹ˆè¿™æ¡æŸ¥è¯¢è¯­å¥ä¼šå…ˆé€šè¿‡ç´¢å¼•æ‰¾åˆ° city ä¸ºä¸Šæµ·çš„è¡Œï¼Œç„¶åŽå†å›žè¡¨æŸ¥è¯¢ name å­—æ®µã€‚</p>
<p>ä¸ºäº†é¿å…å›žè¡¨æŸ¥è¯¢ï¼Œå¯ä»¥åœ¨ city å’Œ name å­—æ®µä¸Šå»ºç«‹è”åˆç´¢å¼•ï¼Œè¿™æ ·æŸ¥è¯¢ç»“æžœå°±å¯ä»¥ç›´æŽ¥ä»Žç´¢å¼•ä¸­èŽ·å–ã€‚</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">alter table</span> test <span class="keyword">add</span> index index1(city,name);</span><br></pre></td></tr></table></figure>
<p>ç›¸å½“äºŽåˆ©ç”¨ç©ºé—´æ¢æ—¶é—´,æŠŠæŸ¥è¯¢ç»“æžœéƒ½æ”¾åˆ°äº†ç´¢å¼•é‡Œ,ä¸éœ€è¦å›žè¡¨æŸ¥è¯¢ã€‚<br>â€”-è¿™éƒ¨åˆ†æ˜¯å¸®åŠ©ç†è§£ endï¼Œé¢è¯•ä¸­å¯ä¸èƒŒâ€”-</p>
<h4 id="å¦‚ä½•æ­£ç¡®ä½¿ç”¨è”åˆç´¢å¼•ï¼Ÿ"><a href="#å¦‚ä½•æ­£ç¡®ä½¿ç”¨è”åˆç´¢å¼•ï¼Ÿ" class="headerlink" title="å¦‚ä½•æ­£ç¡®ä½¿ç”¨è”åˆç´¢å¼•ï¼Ÿ"></a>å¦‚ä½•æ­£ç¡®ä½¿ç”¨è”åˆç´¢å¼•ï¼Ÿ</h4><p>ä½¿ç”¨è”åˆç´¢å¼•æœ€é‡è¦çš„ä¸€æ¡æ˜¯<strong>éµå®ˆæœ€å·¦å‰ç¼€åŽŸåˆ™ï¼Œä¹Ÿå°±æ˜¯æŸ¥è¯¢æ¡ä»¶éœ€è¦ä»Žç´¢å¼•çš„å·¦ä¾§å­—æ®µå¼€å§‹</strong>ã€‚</p>
<p>â€”-è¿™éƒ¨åˆ†æ˜¯å¸®åŠ©ç†è§£ startï¼Œé¢è¯•ä¸­å¯ä¸èƒŒâ€”-<br>æ¯”å¦‚è¯´æˆ‘ä»¬åˆ›å»ºäº†ä¸€ä¸ªä¸‰åˆ—çš„è”åˆç´¢å¼•ã€‚</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">CREATE</span> INDEX idx_name_age_sex <span class="keyword">ON</span> <span class="keyword">user</span>(name, age, sex);</span><br></pre></td></tr></table></figure>
<p>æˆ‘ä»¬æ¥çœ‹ä¸€ä¸‹ä»€ä¹ˆæ ·çš„æŸ¥è¯¢æ¡ä»¶å¯ä»¥ç”¨åˆ°è¿™ä¸ªç´¢å¼•ï¼š<br><img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="https://cdn.jsdelivr.net/gh/JakicDong/blog-assets@main/images/20250618111513.png" alt="20250618111513"><br>â€”-è¿™éƒ¨åˆ†æ˜¯å¸®åŠ©ç†è§£ endï¼Œé¢è¯•ä¸­å¯ä¸èƒŒâ€”-</p>
<h4 id="å¦‚ä½•è¿›è¡Œåˆ†é¡µä¼˜åŒ–ï¼Ÿ"><a href="#å¦‚ä½•è¿›è¡Œåˆ†é¡µä¼˜åŒ–ï¼Ÿ" class="headerlink" title="å¦‚ä½•è¿›è¡Œåˆ†é¡µä¼˜åŒ–ï¼Ÿ"></a>å¦‚ä½•è¿›è¡Œåˆ†é¡µä¼˜åŒ–ï¼Ÿ</h4><p>åˆ†é¡µä¼˜åŒ–çš„æ ¸å¿ƒæ˜¯<strong>é¿å…æ·±åº¦åç§»(Deep Offset)å¸¦æ¥çš„å…¨è¡¨æ‰«æ</strong>ï¼Œå¯ä»¥é€šè¿‡ä¸¤ç§æ–¹å¼æ¥ä¼˜åŒ–ï¼š<strong>å»¶è¿Ÿå…³è”å’Œæ·»åŠ ä¹¦ç­¾</strong>ã€‚</p>
<p><strong>å»¶è¿Ÿå…³è”</strong>é€‚ç”¨äºŽéœ€è¦<strong>ä»Žå¤šä¸ªè¡¨ä¸­èŽ·å–æ•°æ®ä¸”ä¸»è¡¨è¡Œæ•°è¾ƒå¤šçš„æƒ…å†µ</strong>ã€‚<br>å®ƒé¦–å…ˆä»Žç´¢å¼•è¡¨ä¸­æ£€ç´¢å‡ºéœ€è¦çš„è¡Œ IDï¼Œç„¶åŽå†æ ¹æ®è¿™äº› ID åŽ»å…³è”å…¶ä»–çš„è¡¨èŽ·å–è¯¦ç»†ä¿¡æ¯ã€‚</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> e.id, e.name, d.details</span><br><span class="line"><span class="keyword">FROM</span> employees e</span><br><span class="line"><span class="keyword">JOIN</span> department d <span class="keyword">ON</span> e.department_id <span class="operator">=</span> d.id</span><br><span class="line"><span class="keyword">ORDER</span> <span class="keyword">BY</span> e.id</span><br><span class="line">LIMIT <span class="number">1000</span>, <span class="number">20</span>;</span><br></pre></td></tr></table></figure>
<p>å»¶è¿Ÿå…³è”åŽï¼Œç¬¬ä¸€æ­¥åªæŸ¥ä¸»é”®ï¼Œé€Ÿåº¦å¿«ï¼Œç¬¬äºŒæ­¥åªå¤„ç† 20 æ¡æ•°æ®ï¼Œæ•ˆçŽ‡é«˜ã€‚</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> e.id, e.name, d.details</span><br><span class="line"><span class="keyword">FROM</span> (</span><br><span class="line">    <span class="keyword">SELECT</span> id</span><br><span class="line">    <span class="keyword">FROM</span> employees</span><br><span class="line">    <span class="keyword">ORDER</span> <span class="keyword">BY</span> id</span><br><span class="line">    LIMIT <span class="number">1000</span>, <span class="number">20</span></span><br><span class="line">) <span class="keyword">AS</span> sub</span><br><span class="line"><span class="keyword">JOIN</span> employees e <span class="keyword">ON</span> sub.id <span class="operator">=</span> e.id</span><br><span class="line"><span class="keyword">JOIN</span> department d <span class="keyword">ON</span> e.department_id <span class="operator">=</span> d.id;</span><br></pre></td></tr></table></figure>

<p><strong>æ·»åŠ ä¹¦ç­¾</strong>çš„æ–¹å¼æ˜¯é€šè¿‡<strong>è®°ä½ä¸Šä¸€æ¬¡æŸ¥è¯¢è¿”å›žçš„æœ€åŽä¸€è¡Œä¸»é”®å€¼</strong>ï¼Œç„¶åŽåœ¨ä¸‹ä¸€æ¬¡æŸ¥è¯¢çš„æ—¶å€™ä»Žè¿™ä¸ªå€¼å¼€å§‹ï¼Œä»Žè€Œè·³è¿‡åç§»é‡è®¡ç®—ï¼Œä»…æ‰«æç›®æ ‡æ•°æ®ï¼Œ<strong>é€‚åˆç¿»é¡µã€èµ„è®¯æµ</strong>ç­‰åœºæ™¯ã€‚</p>
<p>å‡è®¾éœ€è¦å¯¹ç”¨æˆ·è¡¨è¿›è¡Œåˆ†é¡µã€‚</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> id, name</span><br><span class="line"><span class="keyword">FROM</span> users</span><br><span class="line"><span class="keyword">ORDER</span> <span class="keyword">BY</span> id</span><br><span class="line">LIMIT <span class="number">1000</span>, <span class="number">20</span>;</span><br></pre></td></tr></table></figure>
<p>é€šè¿‡æ·»åŠ ä¹¦ç­¾æ¥ä¼˜åŒ–åŽï¼ŒæŸ¥è¯¢ä¸å†ä½¿ç”¨OFFSETï¼Œè€Œæ˜¯ä»Žä¸Šä¸€é¡µæœ€åŽä¸€ä¸ªç”¨æˆ·çš„ ID å¼€å§‹æŸ¥è¯¢ã€‚è¿™ç§æ–¹æ³•å¯ä»¥æœ‰æ•ˆé¿å…ä¸å¿…è¦çš„æ•°æ®æ‰«æï¼Œæé«˜äº†åˆ†é¡µæŸ¥è¯¢çš„æ•ˆçŽ‡ã€‚</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> id, name</span><br><span class="line"><span class="keyword">FROM</span> users</span><br><span class="line"><span class="keyword">WHERE</span> id <span class="operator">&gt;</span> last_max_id  <span class="comment">-- å‡è®¾last_max_idæ˜¯ä¸Šä¸€é¡µæœ€åŽä¸€è¡Œçš„ID</span></span><br><span class="line"><span class="keyword">ORDER</span> <span class="keyword">BY</span> id</span><br><span class="line">LIMIT <span class="number">20</span>;</span><br></pre></td></tr></table></figure>
<h4 id="ä¸ºä»€ä¹ˆåˆ†é¡µä¼šå˜æ…¢ï¼Ÿ"><a href="#ä¸ºä»€ä¹ˆåˆ†é¡µä¼šå˜æ…¢ï¼Ÿ" class="headerlink" title="ä¸ºä»€ä¹ˆåˆ†é¡µä¼šå˜æ…¢ï¼Ÿ"></a>ä¸ºä»€ä¹ˆåˆ†é¡µä¼šå˜æ…¢ï¼Ÿ</h4><p>åˆ†é¡µæŸ¥è¯¢çš„æ•ˆçŽ‡é—®é¢˜ä¸»è¦æ˜¯ç”±äºŽ <code>OFFSET</code> çš„å­˜åœ¨ï¼Œ<code>OFFSET</code> ä¼šå¯¼è‡´ MySQL <strong>å¿…é¡»æ‰«æå’Œè·³è¿‡ offset + limit æ¡æ•°æ®</strong>ï¼Œè¿™ä¸ªè¿‡ç¨‹æ˜¯éžå¸¸è€—æ—¶çš„ã€‚</p>
<p>æ¯”å¦‚è¯´ï¼Œæˆ‘ä»¬è¦æŸ¥è¯¢ç¬¬ 100000 æ¡æ•°æ®ï¼Œé‚£ä¹ˆ MySQL å°±å¿…é¡»æ‰«æ 100000 æ¡æ•°æ®ï¼Œç„¶åŽå†è¿”å›ž 10 æ¡æ•°æ®ã€‚</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> <span class="keyword">user</span> <span class="keyword">ORDER</span> <span class="keyword">BY</span> id LIMIT <span class="number">100000</span>, <span class="number">10</span>;</span><br></pre></td></tr></table></figure>
<p>æ•°æ®è¶Šå¤šã€åç§»è¶Šå¤§ï¼Œå°±è¶Šæ…¢ï¼</p>
<h4 id="JOIN-ä»£æ›¿å­æŸ¥è¯¢æœ‰ä»€ä¹ˆå¥½å¤„ï¼Ÿ"><a href="#JOIN-ä»£æ›¿å­æŸ¥è¯¢æœ‰ä»€ä¹ˆå¥½å¤„ï¼Ÿ" class="headerlink" title="JOIN ä»£æ›¿å­æŸ¥è¯¢æœ‰ä»€ä¹ˆå¥½å¤„ï¼Ÿ"></a>JOIN ä»£æ›¿å­æŸ¥è¯¢æœ‰ä»€ä¹ˆå¥½å¤„ï¼Ÿ</h4><p>ç¬¬ä¸€ï¼ŒJOIN çš„ ON æ¡ä»¶èƒ½<strong>æ›´ç›´æŽ¥åœ°è§¦å‘ç´¢å¼•</strong>ï¼Œè€Œ<strong>å­æŸ¥è¯¢å¯èƒ½å› åµŒå¥—å¯¼è‡´ç´¢å¼•å¤±æ•ˆ</strong>ã€‚<br>ç¬¬äºŒï¼ŒJOIN çš„<strong>ä¸€æ¬¡è¿žæŽ¥æ“ä½œæ›¿ä»£äº†å­æŸ¥è¯¢çš„å¤šæ¬¡é‡å¤æ‰§è¡Œ</strong>ï¼Œå°¤å…¶åœ¨å¤§æ•°æ®é‡çš„æƒ…å†µä¸‹æ€§èƒ½å·®å¼‚æ˜Žæ˜¾ã€‚</p>
<p>â€”-è¿™éƒ¨åˆ†æ˜¯å¸®åŠ©ç†è§£ startï¼Œé¢è¯•ä¸­å¯ä¸èƒŒâ€”-</p>
<p>æ¯”å¦‚è¯´æˆ‘ä»¬æœ‰ä¸¤ä¸ªè¡¨ orders å’Œ customersã€‚</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">CREATE TABLE</span> orders (</span><br><span class="line">    order_id <span class="type">INT</span> <span class="keyword">PRIMARY KEY</span>,</span><br><span class="line">    customer_id <span class="type">INT</span>,</span><br><span class="line">    amount <span class="type">DECIMAL</span>(<span class="number">10</span>,<span class="number">2</span>),</span><br><span class="line">    INDEX idx_customer_id (customer_id)  <span class="comment">-- customer_idå­—æ®µæœ‰ç´¢å¼•</span></span><br><span class="line">);</span><br><span class="line"><span class="keyword">CREATE TABLE</span> customers (</span><br><span class="line">    customer_id <span class="type">INT</span> <span class="keyword">PRIMARY KEY</span>,</span><br><span class="line">    name <span class="type">VARCHAR</span>(<span class="number">100</span>)</span><br><span class="line">);</span><br></pre></td></tr></table></figure>
<p>å­æŸ¥è¯¢çš„å†™æ³•ï¼š</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> o.order_id, o.amount, </span><br><span class="line">       (<span class="keyword">SELECT</span> c.name </span><br><span class="line">        <span class="keyword">FROM</span> customers c </span><br><span class="line">        <span class="keyword">WHERE</span> c.customer_id <span class="operator">=</span> o.customer_id) <span class="keyword">AS</span> customer_name</span><br><span class="line"><span class="keyword">FROM</span> orders o;</span><br></pre></td></tr></table></figure>
<p>JOIN çš„å†™æ³•ï¼š</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> o.order_id, o.amount, c.name <span class="keyword">AS</span> customer_name</span><br><span class="line"><span class="keyword">FROM</span> orders o</span><br><span class="line"><span class="keyword">JOIN</span> customers c <span class="keyword">ON</span> o.customer_id <span class="operator">=</span> c.customer_id;</span><br></pre></td></tr></table></figure>
<p><img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="https://cdn.jsdelivr.net/gh/JakicDong/blog-assets@main/images/20250618140806.png" alt="20250618140806"></p>
<p><strong>å¯¹äºŽå­æŸ¥è¯¢ï¼Œæ‰§è¡Œæµç¨‹æ˜¯è¿™æ ·çš„ï¼š</strong></p>
<ul>
<li>å¤–å±‚ orders è¡¨çš„æ¯ä¸€è¡Œéƒ½ä¼šè§¦å‘ä¸€æ¬¡å­æŸ¥è¯¢ã€‚</li>
<li>å¦‚æžœ orders è¡¨æœ‰ 1000 æ¡è®°å½•ï¼Œåˆ™å­æŸ¥è¯¢ä¼šæ‰§è¡Œ 1000 æ¬¡ã€‚</li>
<li>æ¯æ¬¡å­æŸ¥è¯¢éƒ½éœ€è¦å•ç‹¬æŸ¥è¯¢ customers è¡¨ï¼ˆå³ä½¿ customer_id ç›¸åŒï¼‰ã€‚</li>
</ul>
<p><strong>è€Œ JOIN çš„æ‰§è¡Œæµç¨‹æ˜¯è¿™æ ·çš„ï¼š</strong></p>
<ul>
<li>æ•°æ®åº“ä¼˜åŒ–å™¨ä¼šå°†ä¸¤å¼ è¡¨çš„è¿žæŽ¥æ“ä½œåˆå¹¶ä¸ºä¸€æ¬¡æ‰§è¡Œã€‚</li>
<li>é€šè¿‡ç´¢å¼•ï¼ˆå¦‚ orders.customer_id å’Œ customers.customer_idï¼‰å¿«é€Ÿå…³è”æ•°æ®ã€‚</li>
<li>ä»…æ‰§è¡Œä¸€æ¬¡å…³è”æ“ä½œï¼Œè€Œéžå¤šæ¬¡å­æŸ¥è¯¢ã€‚<br>æ¥çœ‹ä¸€ä¸‹å­æŸ¥è¯¢çš„æ‰§è¡Œè®¡åˆ’ï¼š<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">EXPLAIN <span class="keyword">SELECT</span> o.order_id, </span><br><span class="line">               (<span class="keyword">SELECT</span> c.name <span class="keyword">FROM</span> customers c <span class="keyword">WHERE</span> c.customer_id <span class="operator">=</span> o.customer_id) </span><br><span class="line">        <span class="keyword">FROM</span> orders o;</span><br></pre></td></tr></table></figure>
<img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="https://cdn.jsdelivr.net/gh/JakicDong/blog-assets@main/images/20250618142719.png" alt="20250618142719"><br>å­æŸ¥è¯¢ï¼ˆDEPENDENT SUBQUERYï¼‰ç±»åž‹è¡¨æ˜Žå…¶ä¾èµ–å¤–å±‚æŸ¥è¯¢çš„æ¯ä¸€è¡Œï¼Œå¯¼è‡´é‡å¤æ‰§è¡Œã€‚</li>
</ul>
<p>å†å¯¹æ¯”çœ‹ä¸€ä¸‹ JOIN çš„æ‰§è¡Œè®¡åˆ’ï¼š</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">EXPLAIN <span class="keyword">SELECT</span> o.order_id, </span><br><span class="line">               (<span class="keyword">SELECT</span> c.name <span class="keyword">FROM</span> customers c <span class="keyword">WHERE</span> c.customer_id <span class="operator">=</span> o.customer_id) </span><br><span class="line">        <span class="keyword">FROM</span> orders o;</span><br></pre></td></tr></table></figure>
<p><img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="https://cdn.jsdelivr.net/gh/JakicDong/blog-assets@main/images/20250618142740.png" alt="20250618142740"><br>JOIN é€šè¿‡ <code>eq_ref</code> ç±»åž‹ç›´æŽ¥åˆ©ç”¨ä¸»é”®ï¼ˆcustomers.customer_idï¼‰å¿«é€Ÿå…³è”ï¼Œå‡å°‘æ‰«ææ¬¡æ•°ã€‚</p>
<h4 id="JOINæ“ä½œä¸ºä»€ä¹ˆè¦å°è¡¨é©±åŠ¨å¤§è¡¨ï¼Ÿ"><a href="#JOINæ“ä½œä¸ºä»€ä¹ˆè¦å°è¡¨é©±åŠ¨å¤§è¡¨ï¼Ÿ" class="headerlink" title="JOINæ“ä½œä¸ºä»€ä¹ˆè¦å°è¡¨é©±åŠ¨å¤§è¡¨ï¼Ÿ"></a>JOINæ“ä½œä¸ºä»€ä¹ˆè¦å°è¡¨é©±åŠ¨å¤§è¡¨ï¼Ÿ</h4><ul>
<li><p>ç¬¬ä¸€ï¼Œå¦‚æžœå¤§è¡¨çš„ JOIN å­—æ®µæœ‰ç´¢å¼•ï¼Œé‚£ä¹ˆå°è¡¨çš„æ¯ä¸€è¡Œéƒ½å¯ä»¥é€šè¿‡ç´¢å¼•å¿«é€ŸåŒ¹é…å¤§è¡¨ã€‚<br><img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="https://cdn.jsdelivr.net/gh/JakicDong/blog-assets@main/images/20250618143231.png" alt="20250618143231"><br>æ—¶é—´å¤æ‚åº¦ä¸º**å°è¡¨è¡Œæ•° N ä¹˜ä»¥å¤§è¡¨ç´¢å¼•æŸ¥æ‰¾å¤æ‚åº¦ log(å¤§è¡¨è¡Œæ•° M)**ï¼Œæ€»å¤æ‚åº¦ä¸º <code>N*log(M)</code>ã€‚<br>æ˜¾ç„¶å°è¡¨åšé©±åŠ¨è¡¨æ¯”å¤§è¡¨åšé©±åŠ¨è¡¨çš„æ—¶é—´å¤æ‚åº¦ <code>M*log(N)</code> æ›´ä½Žã€‚</p>
</li>
<li><p>ç¬¬äºŒï¼Œå¦‚æžœå¤§è¡¨æ²¡æœ‰ç´¢å¼•ï¼Œéœ€è¦å°†å°è¡¨çš„æ•°æ®åŠ è½½åˆ°å†…å­˜ï¼Œå†å…¨è¡¨æ‰«æå¤§è¡¨è¿›è¡ŒåŒ¹é…ã€‚<br><img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="https://cdn.jsdelivr.net/gh/JakicDong/blog-assets@main/images/20250618143445.png" alt="20250618143445"><br>æ—¶é—´å¤æ‚åº¦ä¸ºå°è¡¨åˆ†æ®µæ•° K ä¹˜ä»¥å¤§è¡¨è¡Œæ•° Mï¼Œå…¶ä¸­ K &#x3D; å°è¡¨è¡Œæ•° N &#x2F; å†…å­˜å¤§å° join_buffer_sizeã€‚<br>æ˜¾ç„¶å°è¡¨åšé©±åŠ¨è¡¨çš„æ—¶å€™ K çš„å€¼æ›´å°ï¼Œå¤§è¡¨åšé©±åŠ¨è¡¨çš„æ—¶å€™éœ€è¦å¤šæ¬¡åˆ†æ®µã€‚</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- å°è¡¨é©±åŠ¨ï¼ˆé«˜æ•ˆï¼‰</span></span><br><span class="line"><span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> small_table s</span><br><span class="line"><span class="keyword">JOIN</span> large_table l <span class="keyword">ON</span> s.id <span class="operator">=</span> l.id;  <span class="comment">-- l.idæœ‰ç´¢å¼•</span></span><br><span class="line"></span><br><span class="line"><span class="comment">-- å¤§è¡¨é©±åŠ¨ï¼ˆä½Žæ•ˆï¼‰</span></span><br><span class="line"><span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> large_table l</span><br><span class="line"><span class="keyword">JOIN</span> small_table s <span class="keyword">ON</span> l.id <span class="operator">=</span> s.id;  <span class="comment">-- s.idæ— ç´¢å¼•</span></span><br></pre></td></tr></table></figure></li>
<li><p>å½“ä½¿ç”¨ left join æ—¶ï¼Œå·¦è¡¨æ˜¯é©±åŠ¨è¡¨ï¼Œå³è¡¨æ˜¯è¢«é©±åŠ¨è¡¨ã€‚</p>
</li>
<li><p>å½“ä½¿ç”¨ right join æ—¶ï¼Œåˆšå¥½ç›¸åã€‚</p>
</li>
<li><p>å½“ä½¿ç”¨ join æ—¶ï¼ŒMySQL ä¼šé€‰æ‹©æ•°æ®é‡æ¯”è¾ƒå°çš„è¡¨ä½œä¸ºé©±åŠ¨è¡¨ï¼Œå¤§è¡¨ä½œä¸ºè¢«é©±åŠ¨è¡¨ã€‚</p>
</li>
</ul>
<p>è¿™é‡Œçš„å°è¡¨æŒ‡å®žé™…å‚ä¸Ž JOIN çš„æ•°æ®é‡ï¼Œè€Œä¸æ˜¯è¡¨çš„æ€»è¡Œæ•°ã€‚å¤§è¡¨ç»è¿‡ where æ¡ä»¶è¿‡æ»¤åŽä¹Ÿå¯èƒ½æˆä¸ºé€»è¾‘å°è¡¨ã€‚<br>â€“ <strong>å®žé™…å‚ä¸ŽJOINçš„æ•°æ®é‡å†³å®šå°è¡¨</strong></p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> large_table l</span><br><span class="line"><span class="keyword">JOIN</span> small_table s <span class="keyword">ON</span> l.id <span class="operator">=</span> s.id</span><br><span class="line"><span class="keyword">WHERE</span> l.created_at <span class="operator">&gt;</span> <span class="string">&#x27;2025-01-01&#x27;</span>;  <span class="comment">-- lç»è¿‡è¿‡æ»¤åŽå¯èƒ½æˆä¸ºå°è¡¨</span></span><br></pre></td></tr></table></figure>
<p>ä¹Ÿå¯ä»¥å¼ºåˆ¶é€šè¿‡ <code>STRAIGHT_JOIN</code> æç¤º MySQL ä½¿ç”¨æŒ‡å®šçš„é©±åŠ¨è¡¨ã€‚</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">explain <span class="keyword">select</span> table_1.col1, table_2.col2, table_3.col2</span><br><span class="line"><span class="keyword">from</span> table_1</span><br><span class="line">straight_join table_2 <span class="keyword">on</span> table_1.col1<span class="operator">=</span>table_2.col1</span><br><span class="line">straight_join table_3 <span class="keyword">on</span> table_1.col1 <span class="operator">=</span> table_3.col1;</span><br><span class="line"></span><br><span class="line">explain <span class="keyword">select</span> straight_join table_1.col1, table_2.col2, table_3.col2</span><br><span class="line"><span class="keyword">from</span> table_1</span><br><span class="line"><span class="keyword">join</span> table_2 <span class="keyword">on</span> table_1.col1<span class="operator">=</span>table_2.col1</span><br><span class="line"><span class="keyword">join</span> table_3 <span class="keyword">on</span> table_1.col1 <span class="operator">=</span> table_3.col1;</span><br></pre></td></tr></table></figure>

<h4 id="ä¸ºä»€ä¹ˆè¦é¿å…ä½¿ç”¨-JOIN-å…³è”å¤ªå¤šçš„è¡¨ï¼Ÿ"><a href="#ä¸ºä»€ä¹ˆè¦é¿å…ä½¿ç”¨-JOIN-å…³è”å¤ªå¤šçš„è¡¨ï¼Ÿ" class="headerlink" title="ä¸ºä»€ä¹ˆè¦é¿å…ä½¿ç”¨ JOIN å…³è”å¤ªå¤šçš„è¡¨ï¼Ÿ"></a>ä¸ºä»€ä¹ˆè¦é¿å…ä½¿ç”¨ JOIN å…³è”å¤ªå¤šçš„è¡¨ï¼Ÿ</h4><p>ç¬¬ä¸€ï¼Œå¤šè¡¨ JOIN çš„æ‰§è¡Œè·¯å¾„ä¼šéšç€è¡¨çš„æ•°é‡<strong>å‘ˆçŽ°æŒ‡æ•°çº§å¢žé•¿</strong>ï¼Œä¼˜åŒ–å™¨éœ€è¦ä¼°ç®—æ‰€æœ‰è·¯å¾„çš„æˆæœ¬ï¼Œæœ‰å¯èƒ½ä¼šå¯¼è‡´å‡ºçŽ°å¤§è¡¨é©±åŠ¨å°è¡¨çš„æƒ…å†µã€‚</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> A</span><br><span class="line"><span class="keyword">JOIN</span> B <span class="keyword">ON</span> A.id <span class="operator">=</span> B.a_id</span><br><span class="line"><span class="keyword">JOIN</span> C <span class="keyword">ON</span> B.id <span class="operator">=</span> C.b_id</span><br><span class="line"><span class="keyword">JOIN</span> D <span class="keyword">ON</span> C.id <span class="operator">=</span> D.c_id</span><br><span class="line"><span class="keyword">JOIN</span> E <span class="keyword">ON</span> D.id <span class="operator">=</span> E.d_id;  <span class="comment">-- 5 ä¸ªè¡¨ï¼Œä¼˜åŒ–å™¨éœ€è¯„ä¼° 5! = 120 ç§é¡ºåº</span></span><br></pre></td></tr></table></figure>
<p>ç¬¬äºŒï¼Œå¤šè¡¨ JOIN éœ€è¦ç¼“å­˜ä¸­é—´ç»“æžœé›†ï¼Œå¯èƒ½è¶…å‡º join_buffer_sizeï¼Œè¿™ç§æƒ…å†µä¸‹å†…å­˜ä¸´æ—¶è¡¨å°±ä¼šè½¬ä¸ºç£ç›˜ä¸´æ—¶è¡¨ï¼Œæ€§èƒ½ä¹Ÿä¼šæ€¥å‰§ä¸‹é™ã€‚<br>ã€Šé˜¿é‡Œå·´å·´ Java å¼€å‘æ‰‹å†Œã€‹ä¸Šå°±è§„å®šï¼Œä¸è¦ä½¿ç”¨ join å…³è”å¤ªå¤šçš„è¡¨ï¼Œ<strong>æœ€å¤šä¸è¦è¶…è¿‡ 3 å¼ è¡¨</strong>ã€‚<br><img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="https://cdn.jsdelivr.net/gh/JakicDong/blog-assets@main/images/20250618151308.png" alt="20250618151308"></p>
<h4 id="å¦‚ä½•è¿›è¡ŒæŽ’åºä¼˜åŒ–ï¼Ÿ"><a href="#å¦‚ä½•è¿›è¡ŒæŽ’åºä¼˜åŒ–ï¼Ÿ" class="headerlink" title="å¦‚ä½•è¿›è¡ŒæŽ’åºä¼˜åŒ–ï¼Ÿ"></a>å¦‚ä½•è¿›è¡ŒæŽ’åºä¼˜åŒ–ï¼Ÿ</h4><p>ç¬¬â¼€ï¼Œ<strong>å¯¹ ORDER BY æ¶‰åŠçš„å­—æ®µåˆ›å»ºç´¢å¼•</strong>ï¼Œé¿å… filesortã€‚</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- ä¼˜åŒ–å‰ï¼ˆå¯èƒ½è§¦å‘ filesortï¼‰</span></span><br><span class="line"><span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> users <span class="keyword">ORDER</span> <span class="keyword">BY</span> age <span class="keyword">DESC</span>;</span><br><span class="line"><span class="comment">-- ä¼˜åŒ–åŽï¼ˆæ·»åŠ ç´¢å¼•ï¼‰</span></span><br><span class="line"><span class="keyword">ALTER TABLE</span> users <span class="keyword">ADD</span> INDEX idx_age (age);</span><br></pre></td></tr></table></figure>
<p>å¦‚æžœæ˜¯å¤šä¸ªå­—æ®µï¼Œè”åˆç´¢å¼•éœ€è¦ä¿è¯<strong>ORDER BY çš„åˆ—æ˜¯ç´¢å¼•çš„æœ€å·¦å‰ç¼€</strong>ã€‚</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- è”åˆç´¢å¼•éœ€ä¸Ž ORDER BY é¡ºåºâ¼€è‡´ï¼ˆage åœ¨å‰ï¼Œname åœ¨åŽï¼‰</span></span><br><span class="line"><span class="keyword">ALTER TABLE</span> users <span class="keyword">ADD</span> INDEX idx_age_name (age, name);</span><br><span class="line"><span class="comment">-- æœ‰æ•ˆåˆ©â½¤ç´¢å¼•çš„æŸ¥è¯¢</span></span><br><span class="line"><span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> users <span class="keyword">ORDER</span> <span class="keyword">BY</span> age, name;</span><br><span class="line"><span class="comment">-- â½†æ•ˆæ¡ˆä¾‹ï¼ˆç´¢å¼•å¤±æ•ˆï¼Œå›  name åœ¨ç´¢å¼•ä¸­æŽ’åœ¨ age ä¹‹åŽï¼‰</span></span><br><span class="line"><span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> users <span class="keyword">ORDER</span> <span class="keyword">BY</span> name, age;</span><br></pre></td></tr></table></figure>
<p>ç¬¬â¼†ï¼Œå¯ä»¥é€‚å½“è°ƒæ•´æŽ’åºå‚æ•°ï¼Œå¦‚å¢žâ¼¤ <code>sort_buffer_size</code>ã€<code>max_length_for_sort_data </code>ç­‰ï¼Œè®©æŽ’åºåœ¨å†…å­˜ä¸­å®Œæˆã€‚<br>â€”-è¿™éƒ¨åˆ†æ˜¯å¸®åŠ©ç†è§£ startï¼Œâ¾¯è¯•ä¸­å¯ä¸èƒŒâ€”-</p>
<p><img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="https://cdn.jsdelivr.net/gh/JakicDong/blog-assets@main/images/20250618152056.png" alt="20250618152056"></p>
<ul>
<li><code>sort_buffer_size</code>ï¼šç”¨äºŽæŽ§åˆ¶æŽ’åºç¼“å†²åŒºçš„å¤§å°ï¼Œé»˜è®¤ä¸º 256KBã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œå¦‚æžœæŽ’åºçš„æ•°æ®é‡å°äºŽ 256KBï¼ŒMySQL ä¼šåœ¨å†…å­˜ä¸­ç›´æŽ¥æŽ’åºï¼›å¦åˆ™å°±è¦åœ¨ç£ç›˜ä¸Šè¿›è¡Œ filesortã€‚</li>
<li><code>max_length_for_sort_data</code>ï¼šå•è¡Œæ•°æ®çš„æœ€å¤§é•¿åº¦ï¼Œä¼šå½±å“æŽ’åºç®—æ³•é€‰æ‹©ã€‚å¦‚æžœå•è¡Œæ•°æ®è¶…è¿‡è¯¥å€¼ï¼ŒMySQL ä¼šä½¿ç”¨åŒè·¯æŽ’åºï¼Œå¦åˆ™ä½¿ç”¨å•è·¯æŽ’åºã€‚</li>
<li><code>max_sort_length</code>ï¼šé™åˆ¶å­—ç¬¦ä¸²æŽ’åºæ—¶æ¯”è¾ƒçš„å‰ç¼€é•¿åº¦ã€‚å½“ MySQL ä¸å¾—ä¸å¯¹ textã€blob å­—æ®µè¿›è¡ŒæŽ’åºæ—¶ï¼Œä¼šæˆªå–å‰ <code>max_sort_length</code> ä¸ªå­—ç¬¦è¿›è¡Œæ¯”è¾ƒã€‚<br>â€”-è¿™éƒ¨åˆ†æ˜¯å¸®åŠ©ç†è§£ endï¼Œé¢è¯•ä¸­å¯ä¸èƒŒâ€”-<br>ç¬¬ä¸‰ï¼Œå¯ä»¥é€šè¿‡ where å’Œ limit é™åˆ¶å¾…æŽ’åºçš„æ•°æ®é‡ï¼Œå‡å°‘æŽ’åºçš„å¼€é”€ã€‚<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">-- ä¼˜åŒ–å‰</span><br><span class="line">SELECT * FROM users ORDER BY age LIMIT <span class="number">100</span>;</span><br><span class="line"></span><br><span class="line">-- ä¼˜åŒ–åŽï¼ˆå‡å°‘æ•°æ®ä¼ è¾“å’ŒæŽ’åºå¼€é”€ï¼‰</span><br><span class="line">SELECT id, name, age FROM users ORDER BY age LIMIT <span class="number">100</span>;</span><br><span class="line"></span><br><span class="line">-- æ·±åº¦åˆ†é¡µä¼˜åŒ–ï¼ˆé¿å… OFFSET æ‰«æå…¨è¡¨ï¼‰</span><br><span class="line">SELECT * FROM users ORDER BY age LIMIT <span class="number">10000</span>, <span class="number">20</span>;  -- ä½Žæ•ˆ</span><br><span class="line">SELECT * FROM users WHERE age &gt; last_age ORDER BY age LIMIT <span class="number">20</span>;  -- é«˜æ•ˆï¼ˆè®°å½•ä¸Šä¸€é¡µæœ€åŽä¸€æ¡çš„ age å€¼ï¼‰</span><br></pre></td></tr></table></figure></li>
</ul>
<h4 id="ä»€ä¹ˆæ˜¯-filesortï¼Ÿ"><a href="#ä»€ä¹ˆæ˜¯-filesortï¼Ÿ" class="headerlink" title="ä»€ä¹ˆæ˜¯ filesortï¼Ÿ"></a>ä»€ä¹ˆæ˜¯ filesortï¼Ÿ</h4><p><a target="_blank" rel="noopener" href="https://petrunia.net/2007/08/29/how-mysql-executes-order-by/">Mysqlå¦‚ä½•æ‰§è¡ŒORDER BY</a></p>
<p>å½“<strong>ä¸èƒ½ä½¿ç”¨ç´¢å¼•</strong>ç”ŸæˆæŽ’åºç»“æžœçš„æ—¶å€™ï¼ŒMySQL éœ€è¦è‡ªå·±è¿›è¡ŒæŽ’åºï¼Œ<strong>å¦‚æžœæ•°æ®é‡æ¯”è¾ƒå°ï¼Œä¼šåœ¨å†…å­˜ä¸­è¿›è¡Œ</strong>ï¼›å¦‚æžœæ•°æ®é‡æ¯”è¾ƒå¤§å°±éœ€è¦å†™ä¸´æ—¶æ–‡ä»¶åˆ°ç£ç›˜å†æŽ’åºï¼Œæˆ‘ä»¬å°†è¿™ä¸ªè¿‡ç¨‹ç§°ä¸º<strong>æ–‡ä»¶æŽ’åº</strong>ã€‚</p>
<p><img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="https://cdn.jsdelivr.net/gh/JakicDong/blog-assets@main/images/20250619095220.png" alt="20250619095220"></p>
<p>â€”-è¿™éƒ¨åˆ†æ˜¯å¸®åŠ©ç†è§£ startï¼Œé¢è¯•ä¸­å¯ä¸èƒŒâ€”-<br>è®©æˆ‘ä»¬æ¥éªŒè¯ä¸€ä¸‹ filesort çš„æƒ…å†µ<br><img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="https://cdn.jsdelivr.net/gh/JakicDong/blog-assets@main/images/20250619095335.png" alt="20250619095335"></p>
<p>èƒ½å¤Ÿçœ‹å¾—å‡ºæ¥ï¼Œå½“ order by id ä¹Ÿå°±æ˜¯ä¸»é”®çš„æ—¶å€™ï¼Œæ²¡æœ‰è§¦å‘ filesortï¼›å½“ order by age çš„æ—¶å€™ï¼Œç”±äºŽæ²¡æœ‰ç´¢å¼•ï¼Œå°±è§¦å‘äº† filesortã€‚<br>â€”-è¿™éƒ¨åˆ†æ˜¯å¸®åŠ©ç†è§£ endï¼Œé¢è¯•ä¸­å¯ä¸èƒŒâ€”-</p>
<h4 id="å…¨å­—æ®µæŽ’åºå’Œ-rowid-æŽ’åºäº†è§£å¤šå°‘ï¼Ÿ"><a href="#å…¨å­—æ®µæŽ’åºå’Œ-rowid-æŽ’åºäº†è§£å¤šå°‘ï¼Ÿ" class="headerlink" title="å…¨å­—æ®µæŽ’åºå’Œ rowid æŽ’åºäº†è§£å¤šå°‘ï¼Ÿ"></a>å…¨å­—æ®µæŽ’åºå’Œ rowid æŽ’åºäº†è§£å¤šå°‘ï¼Ÿ</h4><p>å½“æŽ’åºå­—æ®µ<strong>æ˜¯ç´¢å¼•å­—æ®µä¸”æ»¡è¶³æœ€å·¦å‰ç¼€åŽŸåˆ™æ—¶</strong>ï¼ŒMySQL å¯ä»¥<strong>ç›´æŽ¥åˆ©ç”¨ç´¢å¼•çš„æœ‰åºæ€§å®ŒæˆæŽ’åº</strong>ã€‚</p>
<p><img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="https://cdn.jsdelivr.net/gh/JakicDong/blog-assets@main/images/20250619095617.png" alt="20250619095617"></p>
<p>å½“æ— æ³•ä½¿ç”¨ç´¢å¼•æŽ’åºæ—¶ï¼ŒMySQL <strong>éœ€è¦åœ¨å†…å­˜æˆ–ç£ç›˜ä¸­è¿›è¡ŒæŽ’åºæ“ä½œ</strong>ï¼Œåˆ†ä¸º<strong>å…¨å­—æ®µæŽ’åº</strong>å’Œ <strong>rowid æŽ’åº</strong>ä¸¤ç§ç®—æ³•ã€‚</p>
<p><img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="https://cdn.jsdelivr.net/gh/JakicDong/blog-assets@main/images/20250619095723.png" alt="å…¨å­—æ®µæŽ’åº"><br>å…¨å­—æ®µæŽ’åºä¼š<strong>ä¸€æ¬¡æ€§å–å‡ºæ»¡è¶³æ¡ä»¶è¡Œçš„æ‰€æœ‰å­—æ®µ</strong>ï¼Œç„¶åŽåœ¨ sort buffer ä¸­è¿›è¡ŒæŽ’åºï¼ŒæŽ’åºåŽç›´æŽ¥è¿”å›žç»“æžœï¼Œæ— éœ€å›žè¡¨ã€‚</p>
<p>ä»¥ <code>SELECT * FROM user WHERE name = &quot;çŽ‹äºŒ&quot; ORDER BY age</code> ä¸ºä¾‹ï¼š</p>
<p>ä»Ž name ç´¢å¼•ä¸­æ‰¾åˆ°ç¬¬ä¸€ä¸ªæ»¡è¶³ name&#x3D;â€™å¼ ä¸‰â€™ çš„ä¸»é”® idï¼›<br>æ ¹æ®ä¸»é”® id å–å‡ºæ•´è¡Œæ‰€æœ‰çš„å­—æ®µï¼Œå­˜å…¥ sort bufferï¼›<br>é‡å¤ä¸Šè¿°è¿‡ç¨‹ç›´åˆ°å¤„ç†å®Œæ‰€æœ‰æ»¡è¶³æ¡ä»¶çš„è¡Œ<br>å¯¹ sort buffer ä¸­çš„æ•°æ®æŒ‰ age æŽ’åºï¼Œè¿”å›žç»“æžœã€‚</p>
<ul>
<li>ä¼˜ç‚¹æ˜¯<strong>ä»…éœ€è¦ä¸€æ¬¡ç£ç›˜ IO</strong></li>
<li>ç¼ºç‚¹æ˜¯<strong>å†…å­˜å ç”¨å¤§</strong>ï¼Œå¦‚æžœæ•°é‡è¶…è¿‡ sort buffer çš„è¯ï¼Œéœ€è¦åˆ†ç‰‡è¯»å–å¹¶å€ŸåŠ©ä¸´æ—¶æ–‡ä»¶åˆå¹¶æŽ’åºï¼ŒIO æ¬¡æ•°åè€Œä¼šå¢žåŠ ã€‚<br>ä¹Ÿæ— æ³•å¤„ç†åŒ…å« text å’Œ blob ç±»åž‹çš„å­—æ®µã€‚</li>
</ul>
<p><img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="https://cdn.jsdelivr.net/gh/JakicDong/blog-assets@main/images/20250619100616.png" alt="rowid æŽ’åº"></p>
<p>rowid æŽ’åºåˆ†ä¸ºä¸¤ä¸ªé˜¶æ®µï¼š</p>
<ul>
<li>ç¬¬ä¸€é˜¶æ®µï¼šæ ¹æ®æŸ¥è¯¢æ¡ä»¶å–å‡º<strong>æŽ’åºå­—æ®µå’Œä¸»é”® ID</strong>ï¼Œå­˜å…¥<code>sort buffer</code>è¿›è¡ŒæŽ’åºï¼›</li>
<li>ç¬¬äºŒé˜¶æ®µï¼šæ ¹æ®æŽ’åºåŽçš„ä¸»é”® ID å›žè¡¨<strong>å–å‡ºå…¶ä»–éœ€è¦çš„å­—æ®µ</strong>ã€‚</li>
</ul>
<p>åŒæ ·ä»¥ <code>SELECT * FROM user WHERE name = &quot;çŽ‹äºŒ&quot; ORDER BY age </code>ä¸ºä¾‹ï¼š</p>
<ul>
<li>ä»Ž name ç´¢å¼•ä¸­æ‰¾åˆ°ç¬¬ä¸€ä¸ªæ»¡è¶³ name&#x3D;â€™å¼ ä¸‰â€™ çš„ä¸»é”® idï¼›</li>
<li>æ ¹æ®ä¸»é”® id å–å‡ºæŽ’åºå­—æ®µ ageï¼Œè¿žåŒä¸»é”® id ä¸€èµ·å­˜å…¥ sort bufferï¼›</li>
<li>é‡å¤ä¸Šè¿°è¿‡ç¨‹ç›´åˆ°å¤„ç†å®Œæ‰€æœ‰æ»¡è¶³æ¡ä»¶çš„è¡Œ</li>
<li>å¯¹ sort buffer ä¸­çš„æ•°æ®æŒ‰ age æŽ’åºï¼›</li>
<li>éåŽ†æŽ’åºåŽçš„ä¸»é”® idï¼Œå›žè¡¨å–å‡ºå…¶ä»–æ‰€éœ€å­—æ®µï¼Œè¿”å›žç»“æžœã€‚</li>
</ul>
<p>ä¼˜ç‚¹æ˜¯<strong>å†…å­˜å ç”¨è¾ƒå°‘ï¼Œé€‚åˆå­—æ®µå¤šæˆ–è€…æ•°æ®é‡å¤§çš„åœºæ™¯</strong>ï¼Œç¼ºç‚¹æ˜¯<strong>éœ€è¦ä¸¤æ¬¡ç£ç›˜ IO</strong>ã€‚</p>
<p>MySQL ä¼šæ ¹æ®ç³»ç»Ÿå˜é‡ <code>max_length_for_sort_data</code> å’Œ<strong>æŸ¥è¯¢å­—æ®µçš„æ€»å¤§å°</strong>æ¥å†³å®šä½¿ç”¨å…¨å­—æ®µæŽ’åºè¿˜æ˜¯ rowid æŽ’åºã€‚</p>
<p>å¦‚æžœ<strong>æŸ¥è¯¢å­—æ®µæ€»é•¿åº¦ &lt;&#x3D; max_length_for_sort_data</strong>ï¼ŒMySQL ä¼šä½¿ç”¨å…¨å­—æ®µæŽ’åºï¼›å¦åˆ™ä¼šä½¿ç”¨ rowid æŽ’åºã€‚</p>
<h4 id="ä½ å¯¹-Sort-merge-passes-å‚æ•°äº†è§£å—ï¼Ÿ"><a href="#ä½ å¯¹-Sort-merge-passes-å‚æ•°äº†è§£å—ï¼Ÿ" class="headerlink" title="ä½ å¯¹ Sort_merge_passes å‚æ•°äº†è§£å—ï¼Ÿ"></a>ä½ å¯¹ Sort_merge_passes å‚æ•°äº†è§£å—ï¼Ÿ</h4><p><a target="_blank" rel="noopener" href="https://mp.weixin.qq.com/s/YBWbEahWp0uVN_n9jAFU0A">æ·±å…¥äº†è§£ MySQL Order By æ–‡ä»¶æŽ’åº</a><br><code>Sort_merge_passes</code> æ˜¯ä¸€ä¸ªçŠ¶æ€å˜é‡ï¼Œç”¨äºŽ<strong>ç»Ÿè®¡ MySQL åœ¨æ‰§è¡ŒæŽ’åºæ“ä½œæ—¶è¿›è¡Œå½’å¹¶æŽ’åºçš„æ¬¡æ•°</strong>ã€‚<br>å½“ MySQL éœ€è¦è¿›è¡ŒæŽ’åºä½†æŽ’åºæ•°æ®æ— æ³•å®Œå…¨æ”¾å…¥ <code>sort_buffer_size</code> å®šä¹‰çš„å†…å­˜ç¼“å†²åŒºæ—¶ï¼Œå°±ä¼šä½¿ç”¨ä¸´æ—¶æ–‡ä»¶è¿›è¡Œå¤–éƒ¨æŽ’åºï¼Œè¿™æ—¶å°±ä¼šäº§ç”Ÿ Sort_merge_passesã€‚</p>
<p>å¦‚æžœ <code>Sort_merge_passes</code> åœ¨çŸ­æ—¶é—´å†…å¿«é€Ÿæ¿€å¢žï¼Œè¯´æ˜ŽæŽ’åºæ“ä½œçš„æ•°æ®é‡è¾ƒå¤§ï¼Œ<strong>éœ€è¦è°ƒæ•´ sort_buffer_size æˆ–è€…ä¼˜åŒ–æŸ¥è¯¢è¯­å¥</strong>ã€‚<br><img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="https://cdn.jsdelivr.net/gh/JakicDong/blog-assets@main/images/20250619101635.png" alt="20250619101635"></p>
<p><strong>MySQL åœ¨æ‰§è¡ŒæŽ’åºæ“ä½œæ—¶ï¼Œä¼šç»åŽ†ä¸¤ä¸ªè¿‡ç¨‹ï¼š</strong></p>
<ul>
<li><strong>å†…å­˜æŽ’åºé˜¶æ®µ</strong>ï¼ŒMySQL é¦–å…ˆå°è¯•åœ¨ <code>sort buffer</code> ä¸­è¿›è¡ŒæŽ’åºã€‚å¦‚æžœæ•°æ®é‡å°äºŽ <code>sort_buffer_size</code> ç¼“å†²åŒºå¤§å°ï¼Œä¼šå®Œå…¨åœ¨å†…å­˜ä¸­å®Œæˆå¿«é€ŸæŽ’åºã€‚</li>
<li><strong>å¤–éƒ¨æŽ’åºé˜¶æ®µ</strong>ï¼Œå¦‚æžœæ•°æ®é‡è¶…è¿‡ <code>sort_buffer_size</code>ï¼ŒMySQL ä¼šå°†æ•°æ®åˆ†æˆå¤šä¸ªå—ï¼Œæ¯å—å•ç‹¬æŽ’åºåŽå†™å…¥ä¸´æ—¶æ–‡ä»¶ï¼Œç„¶åŽå¯¹è¿™äº›å·²æŽ’åºçš„å—è¿›è¡Œ<strong>å½’å¹¶æŽ’åº</strong>ã€‚æ¯æ¬¡å½’å¹¶æ“ä½œéƒ½ä¼šå¢žåŠ  Sort_merge_passes çš„è®¡æ•°ã€‚</li>
</ul>
<p><img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="https://cdn.jsdelivr.net/gh/JakicDong/blog-assets@main/images/20250619101736.png" alt="20250619101736"></p>
<h4 id="æ¡ä»¶ä¸‹æŽ¨ä½ äº†è§£å¤šå°‘ï¼Ÿ"><a href="#æ¡ä»¶ä¸‹æŽ¨ä½ äº†è§£å¤šå°‘ï¼Ÿ" class="headerlink" title="æ¡ä»¶ä¸‹æŽ¨ä½ äº†è§£å¤šå°‘ï¼Ÿ"></a>æ¡ä»¶ä¸‹æŽ¨ä½ äº†è§£å¤šå°‘ï¼Ÿ</h4><p>æ¡ä»¶ä¸‹æŽ¨çš„æ ¸å¿ƒæ€æƒ³æ˜¯<strong>å°†å¤–å±‚çš„è¿‡æ»¤æ¡ä»¶</strong>ï¼Œæ¯”å¦‚è¯´ whereã€join ç­‰ï¼Œ<strong>å°½å¯èƒ½åœ°ä¸‹æŽ¨åˆ°æŸ¥è¯¢è®¡åˆ’çš„æ›´åº•å±‚</strong>ï¼Œ<strong>æ¯”å¦‚è¯´å­æŸ¥è¯¢ã€è¿žæŽ¥æ“ä½œä¹‹å‰ï¼Œä»Žè€Œå‡å°‘ä¸­é—´ç»“æžœçš„æ•°æ®é‡</strong>ã€‚</p>
<p>æ¯”å¦‚è¯´åŽŸå§‹æŸ¥è¯¢æ˜¯ï¼š</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> (</span><br><span class="line">  <span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> orders <span class="keyword">WHERE</span> total <span class="operator">&gt;</span> <span class="number">100</span></span><br><span class="line">) <span class="keyword">AS</span> subquery</span><br><span class="line"><span class="keyword">WHERE</span> subquery.status <span class="operator">=</span> <span class="string">&#x27;shipped&#x27;</span>;</span><br></pre></td></tr></table></figure>
<p>å°±å¯ä»¥å°†æ¡ä»¶ä¸‹æŽ¨åˆ°å­æŸ¥è¯¢ï¼š</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> (</span><br><span class="line">  <span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> orders <span class="keyword">WHERE</span> total <span class="operator">&gt;</span> <span class="number">100</span> <span class="keyword">AND</span> status <span class="operator">=</span> <span class="string">&#x27;shipped&#x27;</span></span><br><span class="line">) <span class="keyword">AS</span> subquery;</span><br></pre></td></tr></table></figure>
<p>è¿™æ ·å°±å¯ä»¥å‡å°‘æŸ¥è¯¢è¿”å›žçš„æ•°æ®é‡ï¼Œé¿å…å¤–å±‚å†è¿‡æ»¤ã€‚</p>
<p>å†æ¯”å¦‚è¯´ union ä¸­çš„åŽŸå§‹æŸ¥è¯¢æ˜¯ï¼š</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">(<span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> t1) </span><br><span class="line"><span class="keyword">UNION</span> <span class="keyword">ALL</span> </span><br><span class="line">(<span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> t2)</span><br><span class="line"><span class="keyword">ORDER</span> <span class="keyword">BY</span> col LIMIT <span class="number">10</span>;</span><br></pre></td></tr></table></figure>
<p>å°±å¯ä»¥å°†æ¡ä»¶ä¸‹æŽ¨åˆ°æ¯ä¸ªå­æŸ¥è¯¢ï¼š</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">(<span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> t1 <span class="keyword">ORDER</span> <span class="keyword">BY</span> col LIMIT <span class="number">10</span>)</span><br><span class="line"><span class="keyword">UNION</span> <span class="keyword">ALL</span> </span><br><span class="line">(<span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> t2 <span class="keyword">ORDER</span> <span class="keyword">BY</span> col LIMIT <span class="number">10</span>);</span><br></pre></td></tr></table></figure>
<p>æ¯ä¸ªå­æŸ¥è¯¢ä»…è¿”å›žå‰ 10 æ¡æ•°æ®ï¼Œå‡å°‘ä¸´æ—¶è¡¨çš„æ•°æ®é‡ã€‚</p>
<p>å†æ¯”å¦‚è¯´è¿žæŽ¥æŸ¥è¯¢ join ä¸­çš„åŽŸå§‹æŸ¥è¯¢æ˜¯ï¼š</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> orders</span><br><span class="line"><span class="keyword">JOIN</span> customers <span class="keyword">ON</span> orders.customer_id <span class="operator">=</span> customers.id</span><br><span class="line"><span class="keyword">WHERE</span> customers.country <span class="operator">=</span> <span class="string">&#x27;china&#x27;</span>;</span><br></pre></td></tr></table></figure>
<p>å°±å¯ä»¥å°†æ¡ä»¶ä¸‹æŽ¨åˆ°è¡¨æ‰«æçš„æ—¶å€™ï¼š</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> orders</span><br><span class="line"><span class="keyword">JOIN</span> (</span><br><span class="line">  <span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> customers <span class="keyword">WHERE</span> country <span class="operator">=</span> <span class="string">&#x27;china&#x27;</span></span><br><span class="line">) <span class="keyword">AS</span> filtered_customers</span><br><span class="line"><span class="keyword">ON</span> orders.customer_id <span class="operator">=</span> filtered_customers.id;</span><br></pre></td></tr></table></figure>
<p>å…ˆè¿‡æ»¤ customers è¡¨ï¼Œå‡å°‘ join æ—¶çš„æ•°æ®é‡ã€‚</p>
<h4 id="ä¸ºä»€ä¹ˆè¦å°½é‡é¿å…ä½¿ç”¨-select-ï¼Ÿ"><a href="#ä¸ºä»€ä¹ˆè¦å°½é‡é¿å…ä½¿ç”¨-select-ï¼Ÿ" class="headerlink" title="ä¸ºä»€ä¹ˆè¦å°½é‡é¿å…ä½¿ç”¨ select *ï¼Ÿ"></a>ä¸ºä»€ä¹ˆè¦å°½é‡é¿å…ä½¿ç”¨ select *ï¼Ÿ</h4><p><code>SELECT * </code>ä¼šå¼ºåˆ¶ MySQL <strong>è¯»å–è¡¨ä¸­æ‰€æœ‰å­—æ®µçš„æ•°æ®</strong>ï¼ŒåŒ…æ‹¬åº”ç”¨ç¨‹åºå¯èƒ½å¹¶ä¸éœ€è¦çš„ï¼Œæ¯”å¦‚ textã€blob ç±»åž‹çš„<strong>å¤§å­—æ®µ</strong>ã€‚<br><strong>åŠ è½½å†—ä½™æ•°æ®ä¼šå ç”¨æ›´å¤šçš„ç¼“å­˜ç©ºé—´</strong>ï¼Œä»Žè€ŒæŒ¤å å…¶ä»–é‡è¦æ•°æ®çš„ç¼“å­˜èµ„æºï¼Œ<strong>é™ä½Žæ•´ä½“ç³»ç»Ÿçš„åžåé‡</strong>ã€‚<br>ä¹Ÿä¼š<strong>å¢žåŠ ç½‘ç»œä¼ è¾“çš„å¼€é”€</strong>ï¼Œå°¤å…¶æ˜¯åœ¨å¤§å­—æ®µçš„æƒ…å†µä¸‹ã€‚<br>æœ€é‡è¦çš„æ˜¯ï¼Œ<code>SELECT * </code><strong>å¯èƒ½ä¼šå¯¼è‡´è¦†ç›–ç´¢å¼•å¤±æ•ˆ</strong>ï¼Œæœ¬æ¥å¯ä»¥èµ°ç´¢å¼•çš„æŸ¥è¯¢æœ€åŽå˜æˆäº†å…¨è¡¨æ‰«æã€‚</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- ä½¿ç”¨è¦†ç›–ç´¢å¼•ï¼ˆå‡è®¾ç´¢å¼•ä¸º idx_countryï¼‰</span></span><br><span class="line"><span class="keyword">SELECT</span> id, country <span class="keyword">FROM</span> users <span class="keyword">WHERE</span> country <span class="operator">=</span> <span class="string">&#x27;china&#x27;</span>;  <span class="comment">-- å¯èƒ½ä»…æ‰«æç´¢å¼•</span></span><br><span class="line"><span class="comment">-- ä½¿ç”¨ SELECT *</span></span><br><span class="line"><span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> users <span class="keyword">WHERE</span> country <span class="operator">=</span> <span class="string">&#x27;china&#x27;</span>;            <span class="comment">-- éœ€å›žè¡¨è¯»å–æ‰€æœ‰åˆ—</span></span><br></pre></td></tr></table></figure>

<h4 id="ä½ è¿˜çŸ¥é“å“ªäº›-SQL-ä¼˜åŒ–æ–¹æ³•ï¼Ÿ"><a href="#ä½ è¿˜çŸ¥é“å“ªäº›-SQL-ä¼˜åŒ–æ–¹æ³•ï¼Ÿ" class="headerlink" title="ä½ è¿˜çŸ¥é“å“ªäº› SQL ä¼˜åŒ–æ–¹æ³•ï¼Ÿ"></a>ä½ è¿˜çŸ¥é“å“ªäº› SQL ä¼˜åŒ–æ–¹æ³•ï¼Ÿ</h4><p>â‘ ã€é¿å…ä½¿ç”¨ <code>!=</code> æˆ–è€… <code>&lt;&gt;</code> æ“ä½œç¬¦</p>
<p>!&#x3D; æˆ–è€… &lt;&gt; æ“ä½œç¬¦<strong>ä¼šå¯¼è‡´ MySQL æ— æ³•ä½¿ç”¨ç´¢å¼•</strong>ï¼Œä»Žè€Œ<strong>å¯¼è‡´å…¨è¡¨æ‰«æ</strong>ã€‚</p>
<p>å¯ä»¥æŠŠcolumn&lt;&gt;â€™aaaâ€™ï¼Œæ”¹æˆcolumn&gt;â€™aaaâ€™ or column&lt;â€™aaaâ€™ã€‚</p>
<p>â‘¡ã€ä½¿ç”¨å‰ç¼€ç´¢å¼•</p>
<p>æ¯”å¦‚ï¼Œé‚®ç®±çš„åŽç¼€ä¸€èˆ¬éƒ½æ˜¯å›ºå®šçš„@xxx.comï¼Œé‚£ä¹ˆç±»ä¼¼è¿™ç§<strong>åŽé¢å‡ ä½ä¸ºå›ºå®šå€¼çš„å­—æ®µå°±éžå¸¸é€‚åˆå®šä¹‰ä¸ºå‰ç¼€ç´¢å¼•</strong>ï¼š<br><code>alter table test add index index2(email(6));</code><br>éœ€è¦æ³¨æ„çš„æ˜¯ï¼ŒMySQL æ— æ³•åˆ©ç”¨å‰ç¼€ç´¢å¼•åš <code>order by</code> å’Œ <code>group by </code>æ“ä½œã€‚</p>
<p>â‘¢ã€é¿å…åœ¨åˆ—ä¸Šä½¿ç”¨å‡½æ•°</p>
<p>åœ¨ where å­å¥ä¸­<strong>ç›´æŽ¥å¯¹åˆ—ä½¿ç”¨å‡½æ•°ä¼šå¯¼è‡´ç´¢å¼•å¤±æ•ˆ</strong>ï¼Œå› ä¸º MySQL éœ€è¦å¯¹æ¯è¡Œçš„åˆ—åº”ç”¨å‡½æ•°åŽå†è¿›è¡Œæ¯”è¾ƒã€‚<br><code>select name from test where date_format(create_time,&#39;%Y-%m-%d&#39;)=&#39;2021-01-01&#39;;</code><br>å¯ä»¥æ”¹æˆï¼š</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> name <span class="keyword">from</span> test <span class="keyword">where</span> create_time<span class="operator">&gt;=</span><span class="string">&#x27;2021-01-01 00:00:00&#x27;</span> <span class="keyword">and</span> create_time<span class="operator">&lt;</span><span class="string">&#x27;2021-01-02 00:00:00&#x27;</span>;</span><br></pre></td></tr></table></figure>
<p>é€šè¿‡æ—¥æœŸçš„èŒƒå›´æŸ¥è¯¢ï¼Œè€Œä¸æ˜¯åœ¨åˆ—ä¸Šä½¿ç”¨å‡½æ•°ï¼Œå¯ä»¥åˆ©ç”¨ create_time ä¸Šçš„ç´¢å¼•ã€‚</p>
<h3 id="34-ðŸŒŸexplainå¹³å¸¸æœ‰ç”¨è¿‡å—ï¼Ÿ"><a href="#34-ðŸŒŸexplainå¹³å¸¸æœ‰ç”¨è¿‡å—ï¼Ÿ" class="headerlink" title="34.ðŸŒŸexplainå¹³å¸¸æœ‰ç”¨è¿‡å—ï¼Ÿ"></a>34.ðŸŒŸexplainå¹³å¸¸æœ‰ç”¨è¿‡å—ï¼Ÿ</h3><p>ç»å¸¸ç”¨ï¼Œexplain æ˜¯ MySQL æä¾›çš„ä¸€ä¸ªç”¨äºŽ<strong>æŸ¥çœ‹ SQL æ‰§è¡Œè®¡åˆ’çš„å·¥å…·</strong>ï¼Œå¯ä»¥å¸®åŠ©æˆ‘ä»¬<strong>åˆ†æžæŸ¥è¯¢è¯­å¥çš„æ€§èƒ½é—®é¢˜</strong>ã€‚</p>
<p>ä¸€å…±æœ‰ 10 æ¥ä¸ªè¾“å‡ºå‚æ•°ã€‚</p>
<p><img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="https://cdn.jsdelivr.net/gh/JakicDong/blog-assets@main/images/20250619105445.png" alt="20250619105445"></p>
<p>æ¯”å¦‚è¯´ type&#x3D;ALL,key&#x3D;NULL è¡¨ç¤º SQL æ­£åœ¨å…¨è¡¨æ‰«æï¼Œå¯ä»¥è€ƒè™‘ä¸º where å­—æ®µæ·»åŠ ç´¢å¼•è¿›è¡Œä¼˜åŒ–ï¼›<br>Extra&#x3D;Using filesort è¡¨ç¤º SQL æ­£åœ¨æ–‡ä»¶æŽ’åºï¼Œå¯ä»¥è€ƒè™‘ä¸º order by å­—æ®µæ·»åŠ ç´¢å¼•ã€‚</p>
<p>ä½¿ç”¨æ–¹å¼ä¹Ÿéžå¸¸ç®€å•ï¼Œç›´æŽ¥åœ¨ select å‰åŠ ä¸Š explain å…³é”®å­—å°±å¯ä»¥äº†ã€‚</p>
<p><code>explain select * from students where name=&#39;çŽ‹äºŒ&#39;;</code><br>æ›´é«˜çº§çš„ç”¨æ³•å¯ä»¥é…åˆ format&#x3D;json å‚æ•°ï¼Œå°† explain çš„è¾“å‡ºç»“æžœä»¥ JSON æ ¼å¼è¿”å›žã€‚<br><code>explain format=json select * from students where name=&#39;çŽ‹äºŒ&#39;;</code></p>
<h4 id="explain-è¾“å‡ºç»“æžœä¸­å¸¸è§çš„å­—æ®µå«ä¹‰ç†è§£å—ï¼Ÿ"><a href="#explain-è¾“å‡ºç»“æžœä¸­å¸¸è§çš„å­—æ®µå«ä¹‰ç†è§£å—ï¼Ÿ" class="headerlink" title="explain è¾“å‡ºç»“æžœä¸­å¸¸è§çš„å­—æ®µå«ä¹‰ç†è§£å—ï¼Ÿ"></a>explain è¾“å‡ºç»“æžœä¸­å¸¸è§çš„å­—æ®µå«ä¹‰ç†è§£å—ï¼Ÿ</h4><p>åœ¨ EXPLAIN è¾“å‡ºç»“æžœä¸­æˆ‘æœ€å…³æ³¨çš„å­—æ®µæ˜¯ <code>type</code>ã€<code>key</code>ã€<code>rows</code> å’Œ <code>Extra</code>ã€‚</p>
<p>æˆ‘ä¼šé€šè¿‡å®ƒä»¬åˆ¤æ–­ SQL <strong>æœ‰æ²¡æœ‰èµ°ç´¢å¼•</strong>ã€<strong>æ˜¯å¦å…¨è¡¨æ‰«æ</strong>ã€<strong>é¢„ä¼°æ‰«æè¡Œæ•°æ˜¯å¦å¤ªå¤§</strong>ï¼Œä»¥åŠæ˜¯å¦è§¦å‘äº† <strong>filesort æˆ–ä¸´æ—¶è¡¨</strong>ã€‚<br>ä¸€æ—¦å‘çŽ°é—®é¢˜ï¼Œæ¯”å¦‚ type&#x3D;ALL æˆ–è€… Extra&#x3D;Using filesortï¼Œæˆ‘ä¼šè€ƒè™‘å»ºç´¢å¼•ã€æ”¹å†™ SQL æˆ–æŽ§åˆ¶æŸ¥è¯¢ç»“æžœé›†æ¥åšä¼˜åŒ–ã€‚</p>
<p>â€”-è¿™éƒ¨åˆ†æ˜¯å¸®åŠ©ç†è§£ startï¼Œé¢è¯•ä¸­å¯ä¸èƒŒâ€”-<br>ä»¥ <code>EXPLAIN SELECT * FROM orders WHERE user_id = 100 </code>çš„è¾“å‡ºä¸ºä¾‹ï¼š</p>
<p><img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="https://cdn.jsdelivr.net/gh/JakicDong/blog-assets@main/images/20250619105921.png" alt="20250619105921"></p>
<p>éžè¡¨æ ¼ç‰ˆæœ¬ï¼š<br>â‘ ã€id åˆ—ï¼šæŸ¥è¯¢çš„æ‰§è¡Œé¡ºåºç¼–å·ã€‚id ç›¸åŒï¼šåŒä¸€æ‰§è¡Œå±‚çº§ï¼ŒæŒ‰ table åˆ—ä»Žä¸Šåˆ°ä¸‹é¡ºåºæ‰§è¡Œï¼ˆå¦‚å¤šè¡¨ JOINï¼‰ï¼›id é€’å¢žï¼šåµŒå¥—å­æŸ¥è¯¢ï¼Œæ•°å€¼è¶Šå¤§ä¼˜å…ˆçº§è¶Šé«˜ï¼Œè¶Šå…ˆæ‰§è¡Œã€‚</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">EXPLAIN <span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> t1 <span class="keyword">JOIN</span> (<span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> t2 <span class="keyword">WHERE</span> id <span class="operator">=</span> <span class="number">1</span>) <span class="keyword">AS</span> sub;</span><br></pre></td></tr></table></figure>
<p>t2 å­æŸ¥è¯¢çš„ id&#x3D;2ï¼Œä¼˜å…ˆæ‰§è¡Œã€‚</p>
<p>â‘¡ã€select_type åˆ—ï¼šæŸ¥è¯¢çš„ç±»åž‹ã€‚å¸¸è§çš„ç±»åž‹æœ‰ï¼š</p>
<ul>
<li>SIMPLEï¼šç®€å•æŸ¥è¯¢ï¼Œä¸åŒ…å«å­æŸ¥è¯¢æˆ–è€… UNIONã€‚</li>
<li>PRIMARYï¼šæŸ¥è¯¢ä¸­å¦‚æžœåŒ…å«å­æŸ¥è¯¢ï¼Œåˆ™æœ€å¤–å±‚æŸ¥è¯¢è¢«æ ‡è®°ä¸º PRIMARYã€‚éœ€è¦å…³æ³¨å­æŸ¥è¯¢æˆ–æ´¾ç”Ÿè¡¨æ€§èƒ½ã€‚</li>
<li>SUBQUERYï¼šå­æŸ¥è¯¢ï¼›éœ€è¦é¿å…å¤šå±‚åµŒå¥—ï¼Œå°½é‡æ”¹å†™ä¸º JOINã€‚</li>
<li>DERIVEDï¼šæ´¾ç”Ÿè¡¨ï¼ˆFROM å­å¥ä¸­çš„å­æŸ¥è¯¢ï¼‰ã€‚éœ€è¦å‡å°‘æ´¾ç”Ÿè¡¨æ•°æ®é‡ï¼Œæˆ–ç‰©åŒ–ä¸ºä¸´æ—¶è¡¨ã€‚</li>
</ul>
<p>â‘¢ã€table åˆ—ï¼šæŸ¥çš„å“ªä¸ªè¡¨ã€‚</p>
<ul>
<li>derivedNï¼šè¡¨ç¤ºæ´¾ç”Ÿè¡¨ï¼ˆN å¯¹åº” idï¼‰ã€‚</li>
<li>unionNM,Nï¼šè¡¨ç¤º UNION åˆå¹¶çš„ç»“æžœï¼ˆMã€N ä¸ºå‚ä¸Ž UNION çš„ idï¼‰ã€‚</li>
</ul>
<p>â‘£ã€type åˆ—ï¼šè¡¨ç¤º MySQL åœ¨è¡¨ä¸­æ‰¾åˆ°æ‰€éœ€è¡Œçš„æ–¹å¼ã€‚</p>
<ul>
<li>systemï¼Œè¡¨ä»…æœ‰ä¸€è¡Œï¼ˆç³»ç»Ÿè¡¨æˆ–è¡ç”Ÿè¡¨ï¼‰ï¼Œæ— éœ€ä¼˜åŒ–ã€‚</li>
<li>constï¼šé€šè¿‡ä¸»é”®æˆ–å”¯ä¸€ç´¢å¼•æ‰¾åˆ°ä¸€è¡Œï¼ˆå¦‚ WHERE id &#x3D; 1ï¼‰ã€‚ç†æƒ³æƒ…å†µã€‚</li>
<li>eq_refï¼šå¯¹ä¸»é”®&#x2F;å”¯ä¸€ç´¢å¼• JOIN åŒ¹é…ï¼ˆå¦‚ A JOIN B ON A.id &#x3D; B.idï¼‰ã€‚ç¡®ä¿ JOIN å­—æ®µæœ‰ç´¢å¼•ã€‚</li>
<li>refï¼šéžå”¯ä¸€ç´¢å¼•åŒ¹é…ï¼ˆå¦‚ WHERE name &#x3D; â€˜çŽ‹äºŒâ€™ï¼Œname æœ‰æ™®é€šç´¢å¼•ï¼‰ã€‚</li>
<li>rangeï¼šåªæ£€ç´¢ç»™å®šèŒƒå›´çš„è¡Œï¼Œä½¿ç”¨ç´¢å¼•æ¥æ£€ç´¢ã€‚åœ¨whereè¯­å¥ä¸­ä½¿ç”¨ bettweenâ€¦andã€&lt;ã€&gt;ã€&lt;&#x3D;ã€in ç­‰æ¡ä»¶æŸ¥è¯¢ type éƒ½æ˜¯ rangeã€‚</li>
<li>indexï¼šå…¨ç´¢å¼•æ‰«æï¼Œå¦‚æžœä¸éœ€è¦å›žè¡¨ï¼Œå¯æŽ¥å—ï¼›å¦åˆ™è€ƒè™‘è¦†ç›–ç´¢å¼•ã€‚</li>
<li>ALLï¼šå…¨è¡¨æ‰«æï¼Œæ•ˆçŽ‡æœ€ä½Žã€‚<br>â‘¤ã€possible_keys åˆ—ï¼šå¯èƒ½ä¼šç”¨åˆ°çš„ç´¢å¼•ï¼Œä½†å¹¶ä¸ä¸€å®šå®žé™…è¢«ä½¿ç”¨ã€‚</li>
</ul>
<p>â‘¥ã€key åˆ—ï¼šå®žé™…ä½¿ç”¨çš„ç´¢å¼•ã€‚å¦‚æžœä¸º NULLï¼Œåˆ™æ²¡æœ‰ä½¿ç”¨ç´¢å¼•ã€‚å¦‚æžœä¸º PRIMARYï¼Œåˆ™ä½¿ç”¨äº†ä¸»é”®ç´¢å¼•ã€‚</p>
<p>â‘¦ã€key_len åˆ—ï¼šä½¿ç”¨çš„ç´¢å¼•å­—èŠ‚æ•°ï¼Œåæ˜ ç´¢å¼•åˆ—çš„åˆ©ç”¨çŽ‡ã€‚ä½¿ç”¨è”åˆç´¢å¼• (a, b)ï¼Œkey_len æ˜¯ a å’Œ b çš„å­—èŠ‚æ€»å’Œï¼ˆä»…å½“æŸ¥è¯¢æ¡ä»¶ç”¨åˆ° a æˆ– a+b æ—¶æœ‰æ•ˆï¼‰ã€‚</p>
<p>â€“ è¡¨ç»“æž„ï¼šCREATE TABLE t (a INT, b VARCHAR(20), INDEX idx_a_b (a, b));<br>EXPLAIN SELECT * FROM t WHERE a &#x3D; 1 AND b &#x3D; â€˜testâ€™;<br>key_len &#x3D; 4ï¼ˆINTï¼‰ + 20*3ï¼ˆutf8ï¼‰ + 2 &#x3D; 66 å­—èŠ‚ã€‚</p>
<p>â‘§ã€ref åˆ—ï¼šä¸Žç´¢å¼•åˆ—æ¯”è¾ƒçš„å€¼æˆ–åˆ—ã€‚</p>
<ul>
<li>constï¼šå¸¸é‡ã€‚ä¾‹å¦‚ WHERE column &#x3D; â€˜valueâ€™ã€‚</li>
<li>funcï¼šå‡½æ•°ã€‚ä¾‹å¦‚ WHERE column &#x3D; func(column)ã€‚</li>
</ul>
<p>â‘¨ã€rows åˆ—ï¼šä¼˜åŒ–å™¨ä¼°ç®—çš„éœ€è¦æ‰«æçš„è¡Œæ•°ã€‚æ•°å€¼è¶Šå°è¶Šå¥½ï¼Œè‹¥ä¸Žå®žé™…å·®è·å¤§ï¼Œå¯èƒ½ç»Ÿè®¡ä¿¡æ¯è¿‡æœŸï¼ˆéœ€ ANALYZE TABLEï¼‰ã€‚ç»“åˆ filtered å­—æ®µå¯ä»¥è®¡ç®—æœ€ç»ˆè¿”å›žè¡Œæ•°ï¼ˆrows Ã— filteredï¼‰ã€‚</p>
<p>â‘©ã€Extra åˆ—ï¼šé™„åŠ ä¿¡æ¯ã€‚</p>
<ul>
<li>Using indexï¼šè¦†ç›–ç´¢å¼•ï¼Œæ— éœ€å›žè¡¨ã€‚</li>
<li>Using whereï¼šå­˜å‚¨å¼•æ“Žè¿”å›žç»“æžœåŽï¼ŒServer å±‚éœ€è¦å†æ¬¡è¿‡æ»¤ï¼ˆæ¡ä»¶æœªå®Œå…¨ä¸‹æŽ¨ï¼‰ã€‚</li>
<li>Using temporary ï¼šä½¿ç”¨ä¸´æ—¶è¡¨ï¼ˆå¸¸è§äºŽ GROUP BYã€DISTINCTï¼‰ã€‚</li>
<li>Using filesortï¼šæ–‡ä»¶æŽ’åºï¼ˆå¸¸è§äºŽ ORDER BYï¼‰ã€‚è€ƒè™‘ä¸º ORDER BY å­—æ®µæ·»åŠ ç´¢å¼•ã€‚</li>
<li>Select tables optimized awayï¼šä¼˜åŒ–å™¨å·²ä¼˜åŒ–ï¼ˆå¦‚ COUNT(*) é€šè¿‡ç´¢å¼•ç›´æŽ¥ç»Ÿè®¡ï¼‰ã€‚</li>
<li>Using join bufferï¼šä½¿ç”¨è¿žæŽ¥ç¼“å†²åŒºï¼ˆBlock Nested Loop æˆ– Hash Joinï¼‰ã€‚è€ƒè™‘å¢žå¤§ join_buffer_sizeã€‚</li>
</ul>
<p>â€”-è¿™éƒ¨åˆ†æ˜¯å¸®åŠ©ç†è§£ endï¼Œé¢è¯•ä¸­å¯ä¸èƒŒâ€”-</p>
<h4 id="typeçš„æ‰§è¡Œæ•ˆçŽ‡ç­‰çº§ï¼Œè¾¾åˆ°ä»€ä¹ˆçº§åˆ«æ¯”è¾ƒåˆé€‚ï¼Ÿ"><a href="#typeçš„æ‰§è¡Œæ•ˆçŽ‡ç­‰çº§ï¼Œè¾¾åˆ°ä»€ä¹ˆçº§åˆ«æ¯”è¾ƒåˆé€‚ï¼Ÿ" class="headerlink" title="typeçš„æ‰§è¡Œæ•ˆçŽ‡ç­‰çº§ï¼Œè¾¾åˆ°ä»€ä¹ˆçº§åˆ«æ¯”è¾ƒåˆé€‚ï¼Ÿ"></a>typeçš„æ‰§è¡Œæ•ˆçŽ‡ç­‰çº§ï¼Œè¾¾åˆ°ä»€ä¹ˆçº§åˆ«æ¯”è¾ƒåˆé€‚ï¼Ÿ</h4><p>ä»Žé«˜åˆ°ä½Žçš„æ•ˆçŽ‡æŽ’åºæ˜¯ <code>system</code>ã€<code>const</code>ã€<code>eq_ref</code>ã€<code>ref</code>ã€<code>range</code>ã€<code>index</code> å’Œ <code>ALL</code>ã€‚</p>
<p>ä¸€èˆ¬æƒ…å†µä¸‹ï¼Œå»ºè®® type å€¼è¾¾åˆ°<code> const</code>ã€<code>eq_ref</code> æˆ– <code>ref</code>ï¼Œå› ä¸ºè¿™äº›ç±»åž‹è¡¨æ˜ŽæŸ¥è¯¢ä½¿ç”¨äº†ç´¢å¼•ï¼Œæ•ˆçŽ‡è¾ƒé«˜ã€‚<br>å¦‚æžœæ˜¯èŒƒå›´æŸ¥è¯¢ï¼Œrange ç±»åž‹ä¹Ÿæ˜¯å¯ä»¥æŽ¥å—çš„ã€‚<br>ALL ç±»åž‹è¡¨ç¤ºå…¨è¡¨æ‰«æï¼Œæ€§èƒ½æœ€å·®ï¼Œå¾€å¾€ä¸å¯æŽ¥å—ï¼Œéœ€è¦ä¼˜åŒ–ã€‚</p>
<h3 id="35-ðŸŒŸç´¢å¼•ä¸ºä»€ä¹ˆèƒ½æé«˜MySQLæŸ¥è¯¢æ•ˆçŽ‡ï¼Ÿ"><a href="#35-ðŸŒŸç´¢å¼•ä¸ºä»€ä¹ˆèƒ½æé«˜MySQLæŸ¥è¯¢æ•ˆçŽ‡ï¼Ÿ" class="headerlink" title="35.ðŸŒŸç´¢å¼•ä¸ºä»€ä¹ˆèƒ½æé«˜MySQLæŸ¥è¯¢æ•ˆçŽ‡ï¼Ÿ"></a>35.ðŸŒŸç´¢å¼•ä¸ºä»€ä¹ˆèƒ½æé«˜MySQLæŸ¥è¯¢æ•ˆçŽ‡ï¼Ÿ</h3><p>ç´¢å¼•å°±åƒä¸€æœ¬ä¹¦çš„ç›®å½•ï¼Œèƒ½è®© MySQL å¿«é€Ÿå®šä½æ•°æ®ï¼Œé¿å…å…¨è¡¨æ‰«æã€‚</p>
<p><img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="https://cdn.jsdelivr.net/gh/JakicDong/blog-assets@main/images/%E7%B4%A2%E5%BC%95%E5%8A%A0%E5%BF%AB%E6%9F%A5%E8%AF%A2%E5%8E%9F%E7%90%86.png" alt="ç´¢å¼•åŠ å¿«æŸ¥è¯¢åŽŸç†"></p>
<p>å®ƒä¸€èˆ¬æ˜¯ <code>B+ æ ‘</code>ç»“æž„ï¼ŒæŸ¥æ‰¾æ•ˆçŽ‡æ˜¯ <code>O(log n)</code>ï¼Œæ¯”ä»Žå¤´åˆ°å°¾æ‰«ä¸€éæ•°æ®è¦å¿«å¾—å¤šã€‚</p>
<p><img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="https://cdn.jsdelivr.net/gh/JakicDong/blog-assets@main/images/MYSQL%E7%B4%A2%E5%BC%95%E7%BB%93%E6%9E%84.png" alt="MYSQLç´¢å¼•ç»“æž„"></p>
<p>é™¤äº†æŸ¥å¾—å¿«ï¼Œç´¢å¼•è¿˜èƒ½åŠ é€ŸæŽ’åºã€åˆ†ç»„ã€è¿žæŽ¥ç­‰æ“ä½œã€‚<br>å¯ä»¥é€šè¿‡ create index åˆ›å»ºç´¢å¼•ï¼Œæ¯”å¦‚ï¼š<br><code>create index idx_name on students(name);</code></p>
<h3 id="36-ðŸŒŸèƒ½ç®€å•è¯´ä¸€ä¸‹ç´¢å¼•çš„åˆ†ç±»å—ï¼Ÿ"><a href="#36-ðŸŒŸèƒ½ç®€å•è¯´ä¸€ä¸‹ç´¢å¼•çš„åˆ†ç±»å—ï¼Ÿ" class="headerlink" title="36.ðŸŒŸèƒ½ç®€å•è¯´ä¸€ä¸‹ç´¢å¼•çš„åˆ†ç±»å—ï¼Ÿ"></a>36.ðŸŒŸèƒ½ç®€å•è¯´ä¸€ä¸‹ç´¢å¼•çš„åˆ†ç±»å—ï¼Ÿ</h3><p>ä»Ž<strong>åŠŸèƒ½ä¸Šåˆ†ç±»</strong>çš„è¯ï¼Œæœ‰<code>ä¸»é”®ç´¢å¼•</code>ã€<code>å”¯ä¸€ç´¢å¼•</code>ã€<code>å…¨æ–‡ç´¢å¼•</code>ï¼›ä»Ž<strong>æ•°æ®ç»“æž„</strong>ä¸Šåˆ†ç±»çš„è¯ï¼Œæœ‰ <code>B+ æ ‘ç´¢å¼•</code>ã€<code>å“ˆå¸Œç´¢å¼•</code>ï¼›ä»Ž<strong>å­˜å‚¨å†…å®¹</strong>ä¸Šåˆ†ç±»çš„è¯ï¼Œæœ‰<code>èšç°‡ç´¢å¼•</code>ã€<code>éžèšç°‡ç´¢å¼•</code>ã€‚</p>
<p><img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="https://cdn.jsdelivr.net/gh/JakicDong/blog-assets@main/images/%E7%B4%A2%E5%BC%95%E7%B1%BB%E5%9E%8B.png" alt="ç´¢å¼•ç±»åž‹"></p>
<h4 id="ä½ å¯¹ä¸»é”®ç´¢å¼•äº†è§£å¤šå°‘ï¼Ÿ"><a href="#ä½ å¯¹ä¸»é”®ç´¢å¼•äº†è§£å¤šå°‘ï¼Ÿ" class="headerlink" title="ä½ å¯¹ä¸»é”®ç´¢å¼•äº†è§£å¤šå°‘ï¼Ÿ"></a>ä½ å¯¹ä¸»é”®ç´¢å¼•äº†è§£å¤šå°‘ï¼Ÿ</h4><p>ä¸»é”®ç´¢å¼•ç”¨äºŽå”¯ä¸€æ ‡è¯†è¡¨ä¸­çš„æ¯æ¡è®°å½•ï¼Œå…¶åˆ—å€¼<strong>å¿…é¡»å”¯ä¸€ä¸”éžç©º</strong>ã€‚åˆ›å»ºä¸»é”®æ—¶ï¼ŒMySQL ä¼š<strong>è‡ªåŠ¨ç”Ÿæˆå¯¹åº”çš„å”¯ä¸€ç´¢å¼•</strong>ã€‚</p>
<p><img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="https://cdn.jsdelivr.net/gh/JakicDong/blog-assets@main/images/%E4%B8%BB%E9%94%AE%E7%B4%A2%E5%BC%95.png" alt="ä¸»é”®ç´¢å¼•"></p>
<p>æ¯ä¸ªè¡¨åªèƒ½æœ‰ä¸€ä¸ª<strong>ä¸»é”®ç´¢å¼•</strong>ï¼Œä¸€èˆ¬æ˜¯è¡¨ä¸­çš„è‡ªå¢ž id å­—æ®µã€‚</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">CREATE TABLE</span> emp6 (emp_id <span class="type">INT</span> <span class="keyword">PRIMARY KEY</span>, name <span class="type">VARCHAR</span>(<span class="number">50</span>));  <span class="comment">-- å•åˆ—ä¸»é”®</span></span><br><span class="line"><span class="keyword">CREATE TABLE</span> CountryLanguage (</span><br><span class="line">    CountryCode <span class="type">CHAR</span>(<span class="number">3</span>),</span><br><span class="line">    <span class="keyword">Language</span> <span class="type">VARCHAR</span>(<span class="number">30</span>),</span><br><span class="line">    <span class="keyword">PRIMARY KEY</span> (CountryCode, <span class="keyword">Language</span>)  <span class="comment">-- å¤åˆä¸»é”®</span></span><br><span class="line">);</span><br></pre></td></tr></table></figure>
<p>â€”- è¿™éƒ¨åˆ†æ˜¯å¸®åŠ©ç†è§£ startï¼Œé¢è¯•ä¸­å¯ä¸èƒŒ â€”-</p>
<p>å¦‚æžœåˆ›å»ºè¡¨çš„æ—¶å€™<strong>æ²¡æœ‰æŒ‡å®šä¸»é”®</strong>ï¼ŒMySQL çš„ InnoDB å­˜å‚¨å¼•æ“Žä¼š<strong>ä¼˜å…ˆé€‰æ‹©ä¸€ä¸ªéžç©ºçš„å”¯ä¸€ç´¢å¼•ä½œä¸ºä¸»é”®</strong>ï¼›å¦‚æžœæ²¡æœ‰ç¬¦åˆæ¡ä»¶çš„ç´¢å¼•ï¼ŒMySQL ä¼š<strong>è‡ªåŠ¨ç”Ÿæˆä¸€ä¸ªéšè—çš„ _rowid åˆ—</strong>ä½œä¸ºä¸»é”®ã€‚</p>
<p>å¯ä»¥é€šè¿‡ <code>show index from table_name</code> æŸ¥çœ‹ç´¢å¼•ä¿¡æ¯ï¼š<br><img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="https://cdn.jsdelivr.net/gh/JakicDong/blog-assets@main/images/20250620110109.png" alt="20250620110109"></p>
<ul>
<li>Table å½“å‰<strong>ç´¢å¼•æ‰€å±žçš„è¡¨å</strong>ã€‚</li>
<li>Non_unique <strong>æ˜¯å¦å”¯ä¸€ç´¢å¼•</strong>ï¼Œ0 è¡¨ç¤ºå”¯ä¸€ç´¢å¼•ï¼ˆå¦‚ä¸»é”®ï¼‰ï¼Œ1 è¡¨ç¤ºéžå”¯ä¸€ã€‚</li>
<li>Key_name <strong>ä¸»é”®ç´¢å¼•é»˜è®¤å« PRIMARY</strong>ï¼›æ™®é€šç´¢å¼•ä¸ºè‡ªå®šä¹‰åã€‚</li>
<li>Seq_in_index ç´¢å¼•ä¸­çš„<strong>åˆ—é¡ºåº</strong>ï¼Œåœ¨è”åˆç´¢å¼•ä¸­è¿™ä¸ªå­—æ®µè¡¨ç¤ºç¬¬å‡ åˆ—ï¼ˆç¬¬ 1 ä¸ªï¼‰ã€‚</li>
<li>Column_name å½“å‰ç´¢å¼•ä¸­<strong>åŒ…å«çš„å­—æ®µå</strong>ã€‚</li>
<li>Collation A è¡¨ç¤ºå‡åºï¼ˆAscendï¼‰ï¼›D è¡¨ç¤ºé™åºã€‚</li>
<li>Cardinality ç´¢å¼•çš„åŸºæ•°ï¼Œå³ä¸é‡å¤çš„ç´¢å¼•å€¼çš„æ•°é‡ã€‚è¶Šé«˜è¯´æ˜ŽåŒºåˆ†åº¦è¶Šå¥½ï¼ˆå½±å“ä¼˜åŒ–å™¨æ˜¯å¦ç”¨æ­¤ç´¢å¼•ï¼‰ã€‚</li>
<li>Sub_part å‰ç¼€ç´¢å¼•çš„é•¿åº¦ã€‚</li>
<li>Packed æ˜¯å¦åŽ‹ç¼©å­˜å‚¨ç´¢å¼•ï¼›ä¸€èˆ¬ä¸ç”¨ï¼Œé»˜è®¤ä¸º NULLã€‚</li>
<li>Null å­—æ®µæ˜¯å¦å…è®¸ä¸º NULLï¼›ä¸»é”®å­—æ®µä¸å…è®¸ä¸º NULLã€‚</li>
<li>Index_type ç´¢å¼•åº•å±‚ç»“æž„ï¼ŒInnoDB é»˜è®¤æ˜¯ B+ æ ‘ï¼ˆBTREEï¼‰ã€‚</li>
<li>Comment ç´¢å¼•çš„æ³¨é‡Šã€‚</li>
<li>Visible æ˜¯å¦å¯è§ï¼›MySQL 8.0+ å¯éšè—ç´¢å¼•ã€‚<br>â€”- è¿™éƒ¨åˆ†æ˜¯å¸®åŠ©ç†è§£ endï¼Œé¢è¯•ä¸­å¯ä¸èƒŒ â€”-</li>
</ul>
<h4 id="å”¯ä¸€ç´¢å¼•å’Œä¸»é”®ç´¢å¼•æœ‰ä»€ä¹ˆåŒºåˆ«ï¼Ÿ"><a href="#å”¯ä¸€ç´¢å¼•å’Œä¸»é”®ç´¢å¼•æœ‰ä»€ä¹ˆåŒºåˆ«ï¼Ÿ" class="headerlink" title="å”¯ä¸€ç´¢å¼•å’Œä¸»é”®ç´¢å¼•æœ‰ä»€ä¹ˆåŒºåˆ«ï¼Ÿ"></a>å”¯ä¸€ç´¢å¼•å’Œä¸»é”®ç´¢å¼•æœ‰ä»€ä¹ˆåŒºåˆ«ï¼Ÿ</h4><p><code>ä¸»é”®ç´¢å¼•=å”¯ä¸€ç´¢å¼•+éžç©º</code>ã€‚æ¯ä¸ªè¡¨åªèƒ½æœ‰ä¸€ä¸ª<code>ä¸»é”®ç´¢å¼•</code>ï¼Œä½†å¯ä»¥æœ‰<code>å¤šä¸ªå”¯ä¸€ç´¢å¼•</code>ã€‚</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- åœ¨ email åˆ—ä¸Šæ·»åŠ å”¯ä¸€ç´¢å¼•</span></span><br><span class="line"><span class="keyword">CREATE TABLE</span> users (</span><br><span class="line">    id <span class="type">INT</span> AUTO_INCREMENT <span class="keyword">PRIMARY KEY</span>,</span><br><span class="line">    username <span class="type">VARCHAR</span>(<span class="number">50</span>) <span class="keyword">NOT NULL</span>,</span><br><span class="line">    email <span class="type">VARCHAR</span>(<span class="number">100</span>) <span class="keyword">NOT NULL</span>,</span><br><span class="line">    <span class="keyword">UNIQUE</span> KEY uk_email (email)  <span class="comment">-- å”¯ä¸€ç´¢å¼•</span></span><br><span class="line">);</span><br><span class="line"></span><br><span class="line"><span class="comment">-- å¤åˆå”¯ä¸€ç´¢å¼•ï¼ˆä¿è¯ user_id å’Œ role ç»„åˆå”¯ä¸€ï¼‰</span></span><br><span class="line"><span class="keyword">CREATE TABLE</span> user_roles (</span><br><span class="line">    user_id <span class="type">INT</span> <span class="keyword">NOT NULL</span>,</span><br><span class="line">    role <span class="type">VARCHAR</span>(<span class="number">20</span>) <span class="keyword">NOT NULL</span>,</span><br><span class="line">    <span class="keyword">UNIQUE</span> KEY uk_user_role (user_id, role)</span><br><span class="line">);</span><br></pre></td></tr></table></figure>
<p>ä¸»é”®ç´¢å¼•<strong>ä¸å…è®¸æ’å…¥ NULL å€¼</strong>ï¼Œå°è¯•æ’å…¥ NULL ä¼šæŠ¥é”™ï¼›å”¯ä¸€ç´¢å¼•<strong>å…è®¸æ’å…¥å¤šä¸ª NULL å€¼</strong>ã€‚</p>
<h4 id="unique-key-å’Œ-unique-index-æœ‰ä»€ä¹ˆåŒºåˆ«ï¼Ÿ"><a href="#unique-key-å’Œ-unique-index-æœ‰ä»€ä¹ˆåŒºåˆ«ï¼Ÿ" class="headerlink" title="unique key å’Œ unique index æœ‰ä»€ä¹ˆåŒºåˆ«ï¼Ÿ"></a>unique key å’Œ unique index æœ‰ä»€ä¹ˆåŒºåˆ«ï¼Ÿ</h4><p>åˆ›å»º<strong>å”¯ä¸€é”®</strong>æ—¶ï¼ŒMySQL ä¼š<strong>è‡ªåŠ¨ç”Ÿæˆä¸€ä¸ªåŒåçš„å”¯ä¸€ç´¢å¼•</strong>ï¼›åä¹‹ï¼Œåˆ›å»ºå”¯ä¸€ç´¢å¼•ä¹Ÿä¼š<strong>éšå¼æ·»åŠ å”¯ä¸€æ€§çº¦æŸ</strong>ã€‚</p>
<p>å¯é€šè¿‡ <code>UNIQUE KEY uk_name</code> å®šä¹‰æˆ–è€… <code>CONSTRAINT uk_name UNIQUE</code> å®šä¹‰å”¯ä¸€é”®ã€‚</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">CREATE TABLE</span> users (</span><br><span class="line">    id <span class="type">INT</span> <span class="keyword">PRIMARY KEY</span>,</span><br><span class="line">    email <span class="type">VARCHAR</span>(<span class="number">100</span>),</span><br><span class="line">    <span class="comment">-- æ˜¾å¼å‘½åå”¯ä¸€é”®</span></span><br><span class="line">    <span class="keyword">CONSTRAINT</span> uk_email <span class="keyword">UNIQUE</span> (email)</span><br><span class="line">);</span><br><span class="line"></span><br><span class="line"><span class="keyword">CREATE TABLE</span> users3 (</span><br><span class="line">     id <span class="type">INT</span> <span class="keyword">PRIMARY KEY</span>,</span><br><span class="line">    email <span class="type">VARCHAR</span>(<span class="number">100</span>),</span><br><span class="line">    <span class="keyword">UNIQUE</span> KEY uk_email (email)  <span class="comment">-- å”¯ä¸€ç´¢å¼•</span></span><br><span class="line">);</span><br></pre></td></tr></table></figure>
<p>å¯é€šè¿‡ CREATE UNIQUE INDEX åˆ›å»ºå”¯ä¸€ç´¢å¼•ã€‚</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">CREATE TABLE</span> users (</span><br><span class="line">    id <span class="type">INT</span> <span class="keyword">PRIMARY KEY</span>,</span><br><span class="line">    email <span class="type">VARCHAR</span>(<span class="number">100</span>)</span><br><span class="line">);</span><br><span class="line"></span><br><span class="line"><span class="comment">-- æ‰‹åŠ¨åˆ›å»ºå”¯ä¸€ç´¢å¼•</span></span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">UNIQUE</span> INDEX uk_email <span class="keyword">ON</span> users(email);</span><br></pre></td></tr></table></figure>
<p>é€šè¿‡ <code>SHOW CREATE TABLE table_name</code> æŸ¥çœ‹è¡¨ç»“æž„æ—¶ï¼Œç»“æžœéƒ½æ˜¯ä¸€æ ·çš„ã€‚</p>
<h4 id="æ™®é€šç´¢å¼•å’Œå”¯ä¸€ç´¢å¼•æœ‰ä»€ä¹ˆåŒºåˆ«ï¼Ÿ"><a href="#æ™®é€šç´¢å¼•å’Œå”¯ä¸€ç´¢å¼•æœ‰ä»€ä¹ˆåŒºåˆ«ï¼Ÿ" class="headerlink" title="æ™®é€šç´¢å¼•å’Œå”¯ä¸€ç´¢å¼•æœ‰ä»€ä¹ˆåŒºåˆ«ï¼Ÿ"></a>æ™®é€šç´¢å¼•å’Œå”¯ä¸€ç´¢å¼•æœ‰ä»€ä¹ˆåŒºåˆ«ï¼Ÿ</h4><p><strong>æ™®é€šç´¢å¼•ä»…ç”¨äºŽåŠ é€ŸæŸ¥è¯¢</strong>ï¼Œä¸é™åˆ¶å­—æ®µå€¼çš„å”¯ä¸€æ€§ï¼›<strong>é€‚ç”¨äºŽé«˜é¢‘å†™å…¥çš„å­—æ®µã€èŒƒå›´æŸ¥è¯¢çš„å­—æ®µ</strong>ã€‚</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- æ—¥å¿—æ—¶é—´æˆ³å…è®¸é‡å¤ï¼Œæ— éœ€å”¯ä¸€æ€§æ£€æŸ¥</span></span><br><span class="line"><span class="keyword">CREATE</span> INDEX idx_log_time <span class="keyword">ON</span> access_logs(access_time);</span><br><span class="line"></span><br><span class="line"><span class="comment">-- è®¢å•çŠ¶æ€å…è®¸é‡å¤ï¼Œä½†éœ€é¢‘ç¹æŒ‰çŠ¶æ€è¿‡æ»¤æ•°æ®</span></span><br><span class="line"><span class="keyword">CREATE</span> INDEX idx_order_status <span class="keyword">ON</span> orders(status);</span><br></pre></td></tr></table></figure>
<p><strong>å”¯ä¸€ç´¢å¼•</strong>å¼ºåˆ¶å­—æ®µå€¼çš„å”¯ä¸€æ€§ï¼Œ<strong>æ’å…¥æˆ–æ›´æ–°æ—¶ä¼šè§¦å‘å”¯ä¸€æ€§æ£€æŸ¥</strong>ï¼›é€‚<strong>ç”¨äºŽä¸šåŠ¡å”¯ä¸€æ€§çº¦æŸçš„å­—æ®µã€é˜²æ­¢æ•°æ®é‡å¤æ’å…¥çš„å­—æ®µ</strong>ã€‚</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- ç”¨æˆ·é‚®ç®±å¿…é¡»å”¯ä¸€</span></span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">UNIQUE</span> INDEX uk_email <span class="keyword">ON</span> users(email);</span><br><span class="line"><span class="comment">-- ç¡®ä¿åŒä¸€ç”¨æˆ·å¯¹åŒä¸€å•†å“åªèƒ½æœ‰ä¸€æ¡æœªæ”¯ä»˜è®¢å•</span></span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">UNIQUE</span> INDEX uk_user_product <span class="keyword">ON</span> orders(user_id, product_id) <span class="keyword">WHERE</span> status <span class="operator">=</span> <span class="string">&#x27;unpaid&#x27;</span>;</span><br></pre></td></tr></table></figure>


<h4 id="ä½ å¯¹å…¨æ–‡ç´¢å¼•äº†è§£å¤šå°‘ï¼Ÿ"><a href="#ä½ å¯¹å…¨æ–‡ç´¢å¼•äº†è§£å¤šå°‘ï¼Ÿ" class="headerlink" title="ä½ å¯¹å…¨æ–‡ç´¢å¼•äº†è§£å¤šå°‘ï¼Ÿ"></a>ä½ å¯¹å…¨æ–‡ç´¢å¼•äº†è§£å¤šå°‘ï¼Ÿ</h4><p>å…¨æ–‡ç´¢å¼•æ˜¯ MySQL ä¸€ç§<strong>ä¼˜åŒ–æ–‡æœ¬æ•°æ®æ£€ç´¢çš„ç‰¹æ®Šç±»åž‹ç´¢å¼•</strong>ï¼Œé€‚ç”¨äºŽ CHARã€VARCHAR å’Œ TEXT ç­‰å­—æ®µã€‚</p>
<p>MySQL 5.7 åŠä»¥ä¸Šç‰ˆæœ¬å†…ç½®äº† ngram è§£æžå™¨ï¼Œå¯å¤„ç†ä¸­æ–‡ã€æ—¥æ–‡å’ŒéŸ©æ–‡ç­‰åˆ†è¯ã€‚</p>
<p>å»ºè¡¨æ—¶é€šè¿‡ <code>FULLTEXT (title, body)</code> æ¥å®šä¹‰ã€‚é€šè¿‡ <code>MATCH(col1, col2) AGAINST(&#39;keyword&#39;)</code> è¿›è¡Œæ£€ç´¢ï¼Œé»˜è®¤æŒ‰ç…§é™åºè¿”å›žç»“æžœï¼Œæ”¯æŒå¸ƒå°”æ¨¡å¼æŸ¥è¯¢ã€‚</p>
<ul>
<li><code>+</code> è¡¨ç¤ºå¿…é¡»åŒ…å«ï¼›</li>
<li><code>-</code> è¡¨ç¤ºæŽ’é™¤ï¼›</li>
<li><code>*</code> è¡¨ç¤ºé€šé…ç¬¦ï¼›<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- å»ºè¡¨æ—¶åˆ›å»ºå…¨æ–‡ç´¢å¼•ï¼ˆæ”¯æŒä¸­æ–‡ï¼‰</span></span><br><span class="line"><span class="keyword">CREATE TABLE</span> articles (</span><br><span class="line">    id <span class="type">INT</span> UNSIGNED AUTO_INCREMENT <span class="keyword">PRIMARY KEY</span>,</span><br><span class="line">    title <span class="type">VARCHAR</span>(<span class="number">200</span>),</span><br><span class="line">    content TEXT,</span><br><span class="line">    FULLTEXT(title, content) <span class="keyword">WITH</span> PARSER ngram</span><br><span class="line">) ENGINE<span class="operator">=</span>InnoDB;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- ä½¿ç”¨å¸ƒå°”æ¨¡å¼æŸ¥è¯¢</span></span><br><span class="line"><span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> articles </span><br><span class="line"><span class="keyword">WHERE</span> <span class="keyword">MATCH</span>(title, content) AGAINST(<span class="string">&#x27;+MySQL -Oracle&#x27;</span> <span class="keyword">IN</span> <span class="type">BOOLEAN</span> MODE);</span><br></pre></td></tr></table></figure>
åº•å±‚ä½¿ç”¨å€’æŽ’ç´¢å¼•å°†å­—æ®µä¸­çš„æ–‡æœ¬å†…å®¹è¿›è¡Œåˆ†è¯ï¼Œç„¶åŽå»ºç«‹ä¸€ä¸ªå€’æŽ’è¡¨ã€‚æ€§èƒ½æ¯” LIKE â€˜%keyword%â€™ é«˜å¾ˆå¤šã€‚</li>
</ul>
<p>â€”- è¿™éƒ¨åˆ†æ˜¯å¸®åŠ©ç†è§£ startï¼Œé¢è¯•ä¸­å¯ä¸èƒŒ â€”-</p>
<p><strong>å€’æŽ’ç´¢å¼•</strong>é€šè¿‡ä¸€ä¸ªè¾…åŠ©è¡¨å­˜å‚¨å•è¯ä¸Žå•è¯è‡ªèº«åœ¨ä¸€ä¸ªæˆ–å¤šä¸ªæ–‡æ¡£ä¸­æ‰€åœ¨ä½ç½®ä¹‹é—´çš„æ˜ å°„ï¼Œé€šå¸¸é‡‡ç”¨å…³è”æ•°ç»„å®žçŽ°ã€‚</p>
<p>æœ‰ä¸¤ç§è¡¨çŽ°å½¢å¼ï¼šinverted file indexï¼ˆ{å•è¯ï¼Œå•è¯æ‰€åœ¨æ–‡æ¡£çš„ID}ï¼‰å’Œfull inverted indexï¼ˆ{å•è¯ï¼Œ(å•è¯æ‰€åœ¨æ–‡æ¡£çš„IDï¼Œåœ¨å…·ä½“æ–‡æ¡£ä¸­çš„ä½ç½®)}ï¼‰</p>
<p>æ¯”å¦‚æœ‰è¿™æ ·ä¸€ä¸ªæ–‡æ¡£ï¼š</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">DocumentId  Text  </span><br><span class="line"><span class="number">1</span>          Pease porridge hot, pease porridge cold  </span><br><span class="line"><span class="number">2</span>          Pease porridge <span class="keyword">in</span> the pot  </span><br><span class="line"><span class="number">3</span>          Nine days <span class="keyword">old</span>  </span><br><span class="line"><span class="number">4</span>          <span class="keyword">Some</span> <span class="keyword">like</span> it hot, <span class="keyword">some</span> <span class="keyword">like</span> it cold  </span><br><span class="line"><span class="number">5</span>          <span class="keyword">Some</span> <span class="keyword">like</span> it <span class="keyword">in</span> the pot  </span><br><span class="line"><span class="number">6</span>          Nine days <span class="keyword">old</span></span><br></pre></td></tr></table></figure>
<p><code>inverted file index</code> çš„å…³è”æ•°ç»„å­˜å‚¨å½¢å¼ä¸ºï¼š</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">days â†’ <span class="number">3</span>,<span class="number">6</span>  </span><br><span class="line"><span class="keyword">old</span> â†’ <span class="number">3</span>,<span class="number">6</span>  </span><br><span class="line">pease â†’ <span class="number">1</span>,<span class="number">2</span>  </span><br><span class="line">porridge â†’ <span class="number">1</span>,<span class="number">2</span>  </span><br><span class="line">...</span><br></pre></td></tr></table></figure>
<p><code>full inverted index</code> æ›´åŠ è¯¦ç»†ï¼š</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">days â†’ (<span class="number">3</span>:<span class="number">5</span>),(<span class="number">6</span>:<span class="number">5</span>)  </span><br><span class="line"><span class="keyword">old</span> â†’ (<span class="number">3</span>:<span class="number">11</span>),(<span class="number">6</span>:<span class="number">11</span>)  </span><br><span class="line">pease â†’ (<span class="number">1</span>:<span class="number">1</span>),(<span class="number">1</span>:<span class="number">7</span>),(<span class="number">2</span>:<span class="number">1</span>)  </span><br><span class="line">porridge â†’ (<span class="number">1</span>:<span class="number">7</span>),(<span class="number">2</span>:<span class="number">7</span>)  </span><br><span class="line">...</span><br></pre></td></tr></table></figure>
<p><code>full inverted index</code> ä¸ä»…å­˜å‚¨äº†æ–‡æ¡£ IDï¼Œè¿˜å­˜å‚¨äº†å•è¯åœ¨æ–‡æ¡£ä¸­çš„å…·ä½“ä½ç½®ã€‚</p>
<p>InnoDB é‡‡ç”¨çš„æ˜¯ <code>full inverted index</code> çš„æ–¹å¼å®žçŽ°å…¨æ–‡ç´¢å¼•ã€‚</p>
<p>å¦‚æžœéœ€è¦å¤„ç†ä¸­æ–‡åˆ†è¯çš„è¯ï¼Œä¸€å®šè¦è®°å¾—åŠ ä¸Š <code>WITH PARSER ngram</code>ï¼Œå¦åˆ™å¯èƒ½æŸ¥ä¸å‡ºæ¥æ•°æ®ã€‚</p>
<p>ä¸è¿‡ï¼Œå¯¹äºŽå¤æ‚çš„ä¸­æ–‡åœºæ™¯ï¼Œå»ºè®®ä½¿ç”¨ <code>Elasticsearch</code> ç­‰ä¸“ä¸šæœç´¢å¼•æ“Žæ›¿ä»£ï¼ŒæŠ€æœ¯æ´¾é¡¹ç›®ä¸­å°±ç”¨äº†è¿™ç§æ–¹æ¡ˆã€‚</p>
<p>â€”- è¿™éƒ¨åˆ†æ˜¯å¸®åŠ©ç†è§£ endï¼Œé¢è¯•ä¸­å¯ä¸èƒŒ â€”-</p>
<h3 id="37-ðŸŒŸåˆ›å»ºç´¢å¼•æœ‰å“ªäº›æ³¨æ„ç‚¹ï¼Ÿ"><a href="#37-ðŸŒŸåˆ›å»ºç´¢å¼•æœ‰å“ªäº›æ³¨æ„ç‚¹ï¼Ÿ" class="headerlink" title="37.ðŸŒŸåˆ›å»ºç´¢å¼•æœ‰å“ªäº›æ³¨æ„ç‚¹ï¼Ÿ"></a>37.ðŸŒŸåˆ›å»ºç´¢å¼•æœ‰å“ªäº›æ³¨æ„ç‚¹ï¼Ÿ</h3><p><strong>ç¬¬ä¸€ï¼Œé€‰æ‹©åˆé€‚çš„å­—æ®µ</strong></p>
<ul>
<li>æ¯”å¦‚è¯´é¢‘ç¹å‡ºçŽ°åœ¨ <code>WHERE</code>ã€<code>JOIN</code>ã€<code>ORDER BY</code>ã€<code>GROUP BY</code> ä¸­çš„å­—æ®µã€‚</li>
<li>ä¼˜å…ˆé€‰æ‹©åŒºåˆ†åº¦é«˜çš„å­—æ®µï¼Œæ¯”å¦‚ç”¨æˆ· IDã€æ‰‹æœºå·ç­‰å”¯ä¸€å€¼å¤šçš„ï¼Œè€Œä¸æ˜¯æ€§åˆ«ã€çŠ¶æ€ç­‰åŒºåˆ†åº¦æžä½Žçš„å­—æ®µï¼Œå¦‚æžœçœŸçš„éœ€è¦ï¼Œå¯ä»¥è€ƒè™‘è”åˆç´¢å¼•ã€‚</li>
</ul>
<p><strong>ç¬¬äºŒï¼Œè¦æŽ§åˆ¶ç´¢å¼•çš„æ•°é‡ï¼Œé¿å…è¿‡åº¦ç´¢å¼•</strong>ï¼Œæ¯ä¸ªç´¢å¼•éƒ½è¦å ç”¨å­˜å‚¨ç©ºé—´ï¼Œå•è¡¨çš„ç´¢å¼•æ•°é‡ä¸å»ºè®®è¶…è¿‡ 5 ä¸ªã€‚</p>
<p>è¦å®šæœŸé€šè¿‡ <code>SHOW INDEX FROM table_name</code> æŸ¥çœ‹ç´¢å¼•çš„ä½¿ç”¨æƒ…å†µï¼Œ<strong>åˆ é™¤ä¸å¿…è¦çš„ç´¢å¼•</strong>ã€‚æ¯”å¦‚è¯´å·²ç»æœ‰è”åˆç´¢å¼• (a, b)ï¼Œå•ç´¢å¼•ï¼ˆaï¼‰å°±æ˜¯å†—ä½™çš„ã€‚</p>
<p><strong>ç¬¬ä¸‰ï¼Œè”åˆç´¢å¼•çš„æ—¶å€™è¦éµå¾ªæœ€å·¦å‰ç¼€åŽŸåˆ™</strong>ï¼Œå³åœ¨æŸ¥è¯¢æ¡ä»¶ä¸­ä½¿ç”¨è”åˆç´¢å¼•çš„ç¬¬ä¸€ä¸ªå­—æ®µï¼Œæ‰èƒ½å……åˆ†åˆ©ç”¨ç´¢å¼•ã€‚</p>
<p>æ¯”å¦‚è¯´è”åˆç´¢å¼• (A, B, C) å¯æ”¯æŒ Aã€A+Bã€A+B+C çš„æŸ¥è¯¢ï¼Œä½†æ— æ³•æ”¯æŒ B æˆ– C çš„å•ç‹¬æŸ¥è¯¢ã€‚</p>
<p><strong>åŒºåˆ†åº¦é«˜çš„å­—æ®µæ”¾åœ¨å·¦ä¾§</strong>ï¼Œ<strong>ç­‰å€¼æŸ¥è¯¢çš„å­—æ®µä¼˜å…ˆäºŽèŒƒå›´æŸ¥è¯¢çš„å­—æ®µ</strong>ã€‚ä¾‹å¦‚ WHERE A&#x3D;1 AND B&gt;10 AND C&#x3D;2ï¼Œä¼˜å…ˆ (A, C, B)ã€‚</p>
<p>å¦‚æžœ<strong>è”åˆç´¢å¼•åŒ…å«æŸ¥è¯¢çš„æ‰€éœ€å­—æ®µï¼Œè¿˜å¯ä»¥é¿å…å›žè¡¨</strong>ï¼Œæé«˜æŸ¥è¯¢æ•ˆçŽ‡ã€‚</p>
<h3 id="38-ðŸŒŸç´¢å¼•å“ªäº›æƒ…å†µä¸‹ä¼šå¤±æ•ˆå‘¢ï¼Ÿ"><a href="#38-ðŸŒŸç´¢å¼•å“ªäº›æƒ…å†µä¸‹ä¼šå¤±æ•ˆå‘¢ï¼Ÿ" class="headerlink" title="38.ðŸŒŸç´¢å¼•å“ªäº›æƒ…å†µä¸‹ä¼šå¤±æ•ˆå‘¢ï¼Ÿ"></a>38.ðŸŒŸç´¢å¼•å“ªäº›æƒ…å†µä¸‹ä¼šå¤±æ•ˆå‘¢ï¼Ÿ</h3><p>ç®€ç‰ˆï¼š<strong>æ¯”å¦‚ç´¢å¼•åˆ—ä½¿ç”¨äº†å‡½æ•°</strong>ã€<strong>ä½¿ç”¨äº†é€šé…ç¬¦å¼€å¤´çš„æ¨¡ç³ŠæŸ¥è¯¢</strong>ã€<strong>è”åˆç´¢å¼•ä¸æ»¡è¶³æœ€å·¦å‰ç¼€åŽŸåˆ™</strong>ï¼Œæˆ–è€…<strong>ä½¿ç”¨ or çš„æ—¶å€™éƒ¨åˆ†å­—æ®µæ— ç´¢å¼•</strong>ç­‰ã€‚</p>
<p><strong>ç¬¬ä¸€ï¼Œå¯¹ç´¢å¼•åˆ—ä½¿ç”¨å‡½æ•°æˆ–è¡¨è¾¾å¼ä¼šå¯¼è‡´ç´¢å¼•å¤±æ•ˆã€‚</strong></p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- ç´¢å¼•å¤±æ•ˆ</span></span><br><span class="line"><span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> users <span class="keyword">WHERE</span> <span class="keyword">YEAR</span>(create_time) <span class="operator">=</span> <span class="number">2023</span>;</span><br><span class="line"><span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> products <span class="keyword">WHERE</span> price<span class="operator">*</span><span class="number">2</span> <span class="operator">&gt;</span> <span class="number">100</span>;</span><br><span class="line"><span class="comment">-- ä¼˜åŒ–æ–¹æ¡ˆï¼ˆä½¿ç”¨èŒƒå›´æŸ¥è¯¢ï¼‰</span></span><br><span class="line"><span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> users <span class="keyword">WHERE</span> create_time <span class="keyword">BETWEEN</span> <span class="string">&#x27;2023-01-01&#x27;</span> <span class="keyword">AND</span> <span class="string">&#x27;2023-12-31&#x27;</span>;</span><br><span class="line"><span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> products <span class="keyword">WHERE</span> price <span class="operator">&gt;</span> <span class="number">50</span>;</span><br></pre></td></tr></table></figure>

<p><strong>ç¬¬äºŒï¼ŒLIKE æ¨¡ç³ŠæŸ¥è¯¢ä»¥é€šé…ç¬¦å¼€å¤´ä¼šå¯¼è‡´ç´¢å¼•å¤±æ•ˆã€‚</strong></p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- ç´¢å¼•å¤±æ•ˆ</span></span><br><span class="line"><span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> articles <span class="keyword">WHERE</span> title <span class="keyword">LIKE</span> <span class="string">&#x27;%æ•°æ®åº“%&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- å¯ä»¥ä½¿ç”¨ç´¢å¼•ï¼ˆä½†èŒƒå›´æœ‰é™ï¼‰</span></span><br><span class="line"><span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> articles <span class="keyword">WHERE</span> title <span class="keyword">LIKE</span> <span class="string">&#x27;æ•°æ®åº“%&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- è§£å†³æ–¹æ¡ˆï¼šè€ƒè™‘å…¨æ–‡ç´¢å¼•æˆ–æœç´¢å¼•æ“Ž</span></span><br><span class="line"><span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> articles <span class="keyword">WHERE</span> <span class="keyword">MATCH</span>(title) AGAINST(<span class="string">&#x27;æ•°æ®åº“&#x27;</span>);</span><br></pre></td></tr></table></figure>
<p><strong>ç¬¬ä¸‰ï¼Œè”åˆç´¢å¼•è¿åäº†æœ€å·¦å‰ç¼€åŽŸåˆ™ï¼Œç´¢å¼•ä¼šå¤±æ•ˆã€‚</strong></p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- å‡è®¾æœ‰è”åˆç´¢å¼• (a, b, c)</span></span><br><span class="line"><span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> <span class="keyword">table</span> <span class="keyword">WHERE</span> b <span class="operator">=</span> <span class="number">2</span> <span class="keyword">AND</span> c <span class="operator">=</span> <span class="number">3</span>;  <span class="comment">-- ç´¢å¼•å¤±æ•ˆ</span></span><br><span class="line"><span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> <span class="keyword">table</span> <span class="keyword">WHERE</span> a <span class="operator">=</span> <span class="number">1</span> <span class="keyword">AND</span> c <span class="operator">=</span> <span class="number">3</span>;  <span class="comment">-- åªä½¿ç”¨aåˆ—ç´¢å¼•</span></span><br><span class="line"></span><br><span class="line"><span class="comment">-- æ­£ç¡®ä½¿ç”¨è”åˆç´¢å¼•</span></span><br><span class="line"><span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> <span class="keyword">table</span> <span class="keyword">WHERE</span> a <span class="operator">=</span> <span class="number">1</span> <span class="keyword">AND</span> b <span class="operator">=</span> <span class="number">2</span> <span class="keyword">AND</span> c <span class="operator">=</span> <span class="number">3</span>;</span><br></pre></td></tr></table></figure>

<p>è”åˆç´¢å¼•ï¼Œä½† <code>WHERE</code> ä¸æ»¡è¶³æœ€å·¦å‰ç¼€åŽŸåˆ™ï¼Œç´¢å¼•æ— æ³•èµ·æ•ˆã€‚ä¾‹å¦‚ï¼š<code>SELECT * FROM table WHERE column2 = 2</code>ï¼Œè”åˆç´¢å¼•ä¸º (column1, column2)ã€‚</p>
<p>â€”- è¿™éƒ¨åˆ†æ˜¯å¸®åŠ©ç†è§£ startï¼Œé¢è¯•ä¸­å¯ä¸èƒŒ â€”-</p>
<p><strong>ç¬¬å››ï¼Œä½¿ç”¨ OR è¿žæŽ¥éžç´¢å¼•åˆ—æ¡ä»¶ï¼Œä¼šå¯¼è‡´ç´¢å¼•å¤±æ•ˆã€‚</strong></p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- å‡è®¾nameæœ‰ç´¢å¼•ä½†ageæ²¡æœ‰</span></span><br><span class="line"><span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> users <span class="keyword">WHERE</span> name <span class="operator">=</span> <span class="string">&#x27;å¼ ä¸‰&#x27;</span> <span class="keyword">OR</span> age <span class="operator">=</span> <span class="number">25</span>;  <span class="comment">-- å…¨è¡¨æ‰«æ</span></span><br><span class="line"></span><br><span class="line"><span class="comment">-- ä¼˜åŒ–æ–¹æ¡ˆ1ï¼šä½¿ç”¨UNION ALL</span></span><br><span class="line"><span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> users <span class="keyword">WHERE</span> name <span class="operator">=</span> <span class="string">&#x27;å¼ ä¸‰&#x27;</span></span><br><span class="line"><span class="keyword">UNION</span> <span class="keyword">ALL</span></span><br><span class="line"><span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> users <span class="keyword">WHERE</span> age <span class="operator">=</span> <span class="number">25</span> <span class="keyword">AND</span> name <span class="operator">!=</span> <span class="string">&#x27;å¼ ä¸‰&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- ä¼˜åŒ–æ–¹æ¡ˆ2ï¼šè€ƒè™‘ä¸ºageæ·»åŠ ç´¢å¼•</span></span><br></pre></td></tr></table></figure>
<p><strong>ç¬¬äº”ï¼Œä½¿ç”¨ !&#x3D; æˆ– &lt;&gt; ä¸ç­‰å€¼æŸ¥è¯¢ä¼šå¯¼è‡´ç´¢å¼•å¤±æ•ˆã€‚</strong></p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> <span class="keyword">user</span> <span class="keyword">WHERE</span> status <span class="operator">!=</span> <span class="number">1</span>;  <span class="comment">-- è‹¥å¤§éƒ¨åˆ†è¡Œ `status=1`ï¼Œå¯èƒ½å…¨è¡¨æ‰«æ</span></span><br><span class="line"></span><br><span class="line"><span class="comment">-- ä¼˜åŒ–æ–¹æ¡ˆï¼šä½¿ç”¨èŒƒå›´æŸ¥è¯¢</span></span><br><span class="line"><span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> <span class="keyword">user</span> <span class="keyword">WHERE</span> status <span class="operator">&lt;</span> <span class="number">1</span> <span class="keyword">OR</span> status <span class="operator">&gt;</span> <span class="number">1</span>;</span><br></pre></td></tr></table></figure>
<p>â€”- è¿™éƒ¨åˆ†æ˜¯å¸®åŠ©ç†è§£ endï¼Œé¢è¯•ä¸­å¯ä¸èƒŒ â€”-</p>
<h4 id="ä»€ä¹ˆæƒ…å†µä¸‹æ¨¡ç³ŠæŸ¥è¯¢ä¸èµ°ç´¢å¼•ï¼Ÿ"><a href="#ä»€ä¹ˆæƒ…å†µä¸‹æ¨¡ç³ŠæŸ¥è¯¢ä¸èµ°ç´¢å¼•ï¼Ÿ" class="headerlink" title="ä»€ä¹ˆæƒ…å†µä¸‹æ¨¡ç³ŠæŸ¥è¯¢ä¸èµ°ç´¢å¼•ï¼Ÿ"></a>ä»€ä¹ˆæƒ…å†µä¸‹æ¨¡ç³ŠæŸ¥è¯¢ä¸èµ°ç´¢å¼•ï¼Ÿ</h4><p>æ¨¡ç³ŠæŸ¥è¯¢ä¸»è¦ä½¿ç”¨ LIKE è¯­å¥ï¼Œç»“åˆé€šé…ç¬¦æ¥å®žçŽ°ã€‚<br><code>%</code>ï¼ˆä»£è¡¨ä»»æ„å¤šä¸ªå­—ç¬¦ï¼‰å’Œ <code>_</code>ï¼ˆä»£è¡¨å•ä¸ªå­—ç¬¦ï¼‰</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> <span class="keyword">table</span> <span class="keyword">WHERE</span> <span class="keyword">column</span> <span class="keyword">LIKE</span> <span class="string">&#x27;%xxx%&#x27;</span>;</span><br></pre></td></tr></table></figure>
<p>è¿™ä¸ªæŸ¥è¯¢ä¼šè¿”å›žæ‰€æœ‰ column åˆ—ä¸­åŒ…å« xxx çš„è®°å½•ã€‚<br>ä½†æ˜¯ï¼Œå¦‚æžœæ¨¡ç³ŠæŸ¥è¯¢çš„é€šé…ç¬¦** % å‡ºçŽ°åœ¨æœç´¢å­—ç¬¦ä¸²çš„å¼€å§‹ä½ç½®<strong>ï¼Œå¦‚ LIKE â€˜%xxxâ€™ï¼ŒMySQL å°†æ— æ³•ä½¿ç”¨ç´¢å¼•ï¼Œå› ä¸ºæ•°æ®åº“</strong>å¿…é¡»æ‰«æå…¨è¡¨ä»¥åŒ¹é…ä»»æ„ä½ç½®çš„å­—ç¬¦ä¸²**ã€‚</p>
<h3 id="41-ðŸŒŸä¸ºä»€ä¹ˆ-InnoDB-è¦ä½¿ç”¨-B-æ ‘ä½œä¸ºç´¢å¼•ï¼Ÿ"><a href="#41-ðŸŒŸä¸ºä»€ä¹ˆ-InnoDB-è¦ä½¿ç”¨-B-æ ‘ä½œä¸ºç´¢å¼•ï¼Ÿ" class="headerlink" title="41.ðŸŒŸä¸ºä»€ä¹ˆ InnoDB è¦ä½¿ç”¨ B+æ ‘ä½œä¸ºç´¢å¼•ï¼Ÿ"></a>41.ðŸŒŸä¸ºä»€ä¹ˆ InnoDB è¦ä½¿ç”¨ B+æ ‘ä½œä¸ºç´¢å¼•ï¼Ÿ</h3><p>ä¸€å¥è¯æ€»ç»“ï¼š<br>å› ä¸º<code> B+ æ ‘</code>æ˜¯ä¸€ç§<strong>é«˜åº¦å¹³è¡¡çš„å¤šè·¯æŸ¥æ‰¾æ ‘</strong>ï¼Œèƒ½<strong>æœ‰æ•ˆé™ä½Žç£ç›˜çš„ IO æ¬¡æ•°</strong>ï¼Œå¹¶ä¸”<strong>æ”¯æŒæœ‰åºéåŽ†å’ŒèŒƒå›´æŸ¥è¯¢</strong>ã€‚</p>
<p><img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="https://cdn.jsdelivr.net/gh/JakicDong/blog-assets@main/images/B+%E6%A0%91.png" alt="B+æ ‘"></p>
<p><strong>æŸ¥è¯¢æ€§èƒ½éžå¸¸é«˜</strong>ï¼Œå…¶ç»“æž„ä¹Ÿé€‚åˆ MySQL æŒ‰ç…§é¡µä¸ºå•ä½åœ¨ç£ç›˜ä¸Šå­˜å‚¨ã€‚</p>
<p>åƒå…¶ä»–é€‰é¡¹ï¼Œæ¯”å¦‚è¯´<strong>å“ˆå¸Œè¡¨ä¸æ”¯æŒèŒƒå›´æŸ¥è¯¢</strong>ï¼Œ<strong>äºŒå‰æ ‘å±‚çº§å¤ªæ·±</strong>ï¼Œ<strong>B æ ‘åˆä¸æ–¹ä¾¿èŒƒå›´æ‰«æ</strong>ï¼Œæ‰€ä»¥æœ€ç»ˆé€‰æ‹©äº† B+ æ ‘ã€‚</p>
<p>å†æ¢ä¸€ç§å›žç­”ï¼š</p>
<p>ç›¸æ¯”å“ˆå¸Œè¡¨ï¼šB+ æ ‘<strong>æ”¯æŒèŒƒå›´æŸ¥è¯¢å’ŒæŽ’åº</strong><br>ç›¸æ¯”äºŒå‰æ ‘å’Œçº¢é»‘æ ‘ï¼šB+ æ ‘æ›´â€œçŸ®èƒ–â€ï¼Œ<strong>å±‚çº§æ›´å°‘ï¼Œç£ç›˜ IO æ¬¡æ•°æ›´å°‘</strong><br>ç›¸æ¯” B æ ‘ï¼šB+ æ ‘çš„<strong>éžå¶å­èŠ‚ç‚¹åªå­˜å‚¨é”®å€¼</strong>ï¼Œå¶å­èŠ‚ç‚¹å­˜å‚¨æ•°æ®å¹¶é€šè¿‡é“¾è¡¨è¿žæŽ¥ï¼Œ<strong>æ”¯æŒèŒƒå›´æŸ¥è¯¢</strong><br>å¦å¤–ä¸€ç§å›žç­”ç‰ˆæœ¬ï¼š</p>
<p>B+æ ‘æ˜¯ä¸€ç§<strong>è‡ªå¹³è¡¡çš„å¤šè·¯æŸ¥æ‰¾æ ‘</strong>ï¼Œå’Œ<strong>çº¢é»‘æ ‘ã€äºŒå‰å¹³è¡¡æ ‘</strong>ä¸åŒï¼ŒB+æ ‘çš„æ¯ä¸ªèŠ‚ç‚¹å¯ä»¥æœ‰ m ä¸ªå­èŠ‚ç‚¹ï¼Œè€Œçº¢é»‘æ ‘å’ŒäºŒå‰å¹³è¡¡æ ‘éƒ½åªæœ‰ 2 ä¸ªã€‚</p>
<p><img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="https://cdn.jsdelivr.net/gh/JakicDong/blog-assets@main/images/B+%E6%A0%912.png" alt="B+æ ‘2"><br>å¦å¤–ï¼Œå’Œ B æ ‘ä¸åŒï¼ŒB+æ ‘çš„<strong>éžå¶å­èŠ‚ç‚¹åªå­˜å‚¨é”®å€¼</strong>ï¼Œ<strong>ä¸å­˜å‚¨æ•°æ®</strong>ï¼Œè€Œå¶å­èŠ‚ç‚¹å­˜å‚¨äº†æ‰€æœ‰çš„æ•°æ®ï¼Œå¹¶ä¸”æž„æˆäº†ä¸€ä¸ª<strong>æœ‰åºé“¾è¡¨</strong>ã€‚</p>
<p>è¿™æ ·åšçš„å¥½å¤„æ˜¯ï¼Œéžå¶å­èŠ‚ç‚¹ä¸Šç”±äºŽæ²¡æœ‰å­˜å‚¨æ•°æ®ï¼Œå°±å¯ä»¥å­˜å‚¨æ›´å¤šçš„é”®å€¼å¯¹ï¼Œå†åŠ ä¸Šå¶å­èŠ‚ç‚¹æž„æˆäº†ä¸€ä¸ªæœ‰åºé“¾è¡¨ï¼ŒèŒƒå›´æŸ¥è¯¢æ—¶å°±å¯ä»¥ç›´æŽ¥é€šè¿‡å¶å­èŠ‚ç‚¹é—´çš„æŒ‡é’ˆé¡ºåºè®¿é—®æ•´ä¸ªæŸ¥è¯¢èŒƒå›´å†…çš„æ‰€æœ‰è®°å½•ï¼Œè€Œæ— éœ€å¯¹æ ‘è¿›è¡Œå¤šæ¬¡éåŽ†ã€‚æŸ¥è¯¢çš„æ•ˆçŽ‡æ¯” B æ ‘æ›´é«˜ã€‚</p>
<p>å…ˆè¯´è¯´ B æ ‘ã€‚<br>B æ ‘æ˜¯ä¸€ç§è‡ªå¹³è¡¡çš„å¤šè·¯æŸ¥æ‰¾æ ‘ï¼Œå’Œçº¢é»‘æ ‘ã€äºŒå‰å¹³è¡¡æ ‘ä¸åŒï¼ŒB æ ‘çš„æ¯ä¸ªèŠ‚ç‚¹å¯ä»¥æœ‰ m ä¸ªå­èŠ‚ç‚¹ï¼Œè€Œçº¢é»‘æ ‘å’ŒäºŒå‰å¹³è¡¡æ ‘éƒ½åªæœ‰ 2 ä¸ªã€‚<br>æ¢å¥è¯è¯´ï¼Œçº¢é»‘æ ‘ã€äºŒå‰å¹³è¡¡æ ‘æ˜¯ç»†é«˜ä¸ªï¼Œè€Œ B æ ‘æ˜¯çŸ®èƒ–å­ã€‚<br><img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="https://cdn.jsdelivr.net/gh/JakicDong/blog-assets@main/images/B%E6%A0%91.png" alt="Bæ ‘"></p>
<p>å†æ¥è¯´è¯´å†…å­˜å’Œç£ç›˜çš„ IO è¯»å†™ã€‚</p>
<p>ä¸ºäº†æé«˜è¯»å†™æ•ˆçŽ‡ï¼Œä»Žç£ç›˜å¾€å†…å­˜ä¸­è¯»æ•°æ®çš„æ—¶å€™ï¼Œä¸€æ¬¡ä¼šè¯»å–è‡³å°‘ä¸€é¡µçš„æ•°æ®ï¼Œå¦‚æžœä¸æ»¡ä¸€é¡µï¼Œä¼šå†å¤šè¯»ç‚¹ã€‚</p>
<p>æ¯”å¦‚è¯´æŸ¥è¯¢åªéœ€è¦è¯»å– 2KB çš„æ•°æ®ï¼Œä½† MySQL å®žé™…ä¸Šä¼šè¯»å– 4KB çš„æ•°æ®ï¼Œä»¥è£…æ»¡æ•´é¡µã€‚é¡µæ˜¯ MySQL è¿›è¡Œå†…å­˜å’Œç£ç›˜äº¤äº’çš„æœ€å°é€»è¾‘å•å…ƒã€‚</p>
<p>å†æ¯”å¦‚è¯´éœ€è¦è¯»å– 5KB çš„æ•°æ®ï¼Œå®žé™…ä¸Š MySQL ä¼šè¯»å– 8KB çš„æ•°æ®ï¼Œåˆšå¥½ä¸¤é¡µã€‚</p>
<p>å› ä¸ºè¯»çš„æ¬¡æ•°è¶Šå¤šï¼Œæ•ˆçŽ‡å°±è¶Šä½Žã€‚å°±å¥½æ¯”æˆ‘ä»¬åœ¨å·¥åœ°ä¸Šæ¬ç –ï¼Œä¸€æ¬¡æ¬ 10 å—ç –è‚¯å®šæ¯”ä¸€æ¬¡æ¬ 1 å—ç –çš„æ•ˆçŽ‡è¦é«˜ï¼Œåæ­£æˆ‘æ¯æ¬¡éƒ½æ¬ 10 å—ï¼ˆðŸ˜ï¼‰ã€‚</p>
<p>å¯¹äºŽçº¢é»‘æ ‘ã€äºŒå‰å¹³è¡¡æ ‘è¿™ç§ç»†é«˜ä¸ªæ¥è¯´ï¼Œæ¯æ¬¡æ¬çš„ç –å°‘ï¼Œå› ä¸ºåŠ›æ°”ä¸å¤Ÿå˜›ï¼Œé‚£æ¥å›žè·‘çš„æ¬¡æ•°å°±è¶Šå¤šã€‚</p>
<p>é€šå¸¸ B+ æ ‘é«˜åº¦ä¸º 3-4 å±‚å³å¯æ”¯æŒ TB çº§æ•°æ®ï¼Œè€Œæ¯æ¬¡æŸ¥è¯¢åªéœ€ 2-4 æ¬¡ç£ç›˜ I&#x2F;Oï¼Œè¿œä½ŽäºŽäºŒå‰æ ‘æˆ–çº¢é»‘æ ‘çš„ O(log2N) å¤æ‚åº¦</p>
<p>æ ‘è¶Šé«˜ï¼Œæ„å‘³ç€æŸ¥æ‰¾æ•°æ®æ—¶å°±éœ€è¦æ›´å¤šçš„ç£ç›˜ IOï¼Œå› ä¸ºæ¯ä¸€å±‚éƒ½å¯èƒ½éœ€è¦ä»Žç£ç›˜åŠ è½½æ–°çš„èŠ‚ç‚¹ã€‚</p>
<p>B æ ‘çš„èŠ‚ç‚¹é€šå¸¸ä¸Žé¡µçš„å¤§å°å¯¹é½ï¼Œè¿™æ ·æ¯æ¬¡ä»Žç£ç›˜åŠ è½½ä¸€ä¸ªèŠ‚ç‚¹æ—¶ï¼Œæ­£å¥½å°±æ˜¯ä¸€é¡µçš„å¤§å°ã€‚</p>
<p><img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="https://cdn.jsdelivr.net/gh/JakicDong/blog-assets@main/images/b%E6%A0%912.png" alt="bæ ‘2"></p>
<p>B æ ‘çš„ä¸€ä¸ªèŠ‚ç‚¹é€šå¸¸åŒ…æ‹¬ä¸‰ä¸ªéƒ¨åˆ†ï¼š</p>
<ul>
<li>é”®å€¼ï¼šå³è¡¨ä¸­çš„ä¸»é”®</li>
<li>æŒ‡é’ˆï¼šå­˜å‚¨å­èŠ‚ç‚¹çš„ä¿¡æ¯</li>
<li>æ•°æ®ï¼šé™¤ä¸»é”®å¤–çš„è¡Œæ•°æ®<br>æ­£æ‰€è°“â€œç¥¸å…®ç¦æ‰€å€šï¼Œç¦å…®ç¥¸æ‰€ä¼â€ï¼Œå› ä¸º B æ ‘çš„æ¯ä¸ªèŠ‚ç‚¹ä¸Šéƒ½å­˜å‚¨äº†æ•°æ®ï¼Œå°±å¯¼è‡´æ¯ä¸ªèŠ‚ç‚¹èƒ½å­˜å‚¨çš„é”®å€¼å’ŒæŒ‡é’ˆå˜å°‘äº†ï¼Œå› ä¸ºæ¯ä¸€ä¸ªèŠ‚ç‚¹çš„å¤§å°æ˜¯å›ºå®šçš„ï¼Œå¯¹å§ï¼Ÿ<br>äºŽæ˜¯ B+æ ‘å°±æ¥äº†ï¼ŒB+æ ‘çš„éžå¶å­èŠ‚ç‚¹åªå­˜å‚¨é”®å€¼ï¼Œä¸å­˜å‚¨æ•°æ®ï¼Œè€Œå¶å­èŠ‚ç‚¹ä¼šå­˜å‚¨æ‰€æœ‰çš„è¡Œæ•°æ®ï¼Œå¹¶ä¸”æž„æˆä¸€ä¸ªæœ‰åºé“¾è¡¨ã€‚</li>
</ul>
<p><img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="https://cdn.jsdelivr.net/gh/JakicDong/blog-assets@main/images/20250621105348.png" alt="20250621105348"></p>
<p>è¿™æ ·åšçš„å¥½å¤„æ˜¯ï¼Œéžå¶å­èŠ‚ç‚¹ç”±äºŽæ²¡æœ‰å­˜å‚¨æ•°æ®ï¼Œå°±å¯ä»¥å­˜å‚¨æ›´å¤šçš„é”®å€¼å¯¹ï¼Œæ ‘å°±å˜å¾—æ›´åŠ çŸ®èƒ–äº†ï¼ŒäºŽæ˜¯å°±æ›´æœ‰åŠ²äº†ï¼Œæ¯æ¬¡æ¬çš„ç –ä¹Ÿå°±æ›´å¤šäº†ï¼ˆðŸ˜‚ï¼‰ã€‚</p>
<p>ç›¸æ¯” B æ ‘ï¼ŒB+ æ ‘çš„éžå¶å­èŠ‚ç‚¹å¯å®¹çº³çš„é”®å€¼æ›´å¤šï¼Œä¸€ä¸ª 16KB çš„èŠ‚ç‚¹å¯å­˜å‚¨çº¦ 1200 ä¸ªé”®å€¼ï¼Œå¤§å¹…é™ä½Žæ ‘çš„é«˜åº¦ã€‚</p>
<p>ç”±æ­¤ä¸€æ¥ï¼ŒæŸ¥æ‰¾æ•°æ®è¿›è¡Œçš„ç£ç›˜ IO å°±æ›´å°‘äº†ï¼ŒæŸ¥è¯¢çš„æ•ˆçŽ‡ä¹Ÿå°±æ›´é«˜äº†ã€‚</p>
<p>å†åŠ ä¸Šå¶å­èŠ‚ç‚¹æž„æˆäº†ä¸€ä¸ªæœ‰åºé“¾è¡¨ï¼ŒèŒƒå›´æŸ¥è¯¢æ—¶å°±å¯ä»¥ç›´æŽ¥é€šè¿‡å¶å­èŠ‚ç‚¹é—´çš„æŒ‡é’ˆé¡ºåºè®¿é—®æ•´ä¸ªæŸ¥è¯¢èŒƒå›´å†…çš„æ‰€æœ‰è®°å½•ï¼Œè€Œæ— éœ€å¯¹æ ‘è¿›è¡Œå¤šæ¬¡éåŽ†ã€‚</p>
<p>B æ ‘å°±åšä¸åˆ°è¿™ä¸€ç‚¹ã€‚</p>
<p>â€”- è¿™éƒ¨åˆ†æ˜¯å¸®åŠ©ç†è§£ endï¼Œé¢è¯•ä¸­å¯ä¸èƒŒ â€”-</p>
<h4 id="B-æ ‘çš„å¶å­èŠ‚ç‚¹æ˜¯å•å‘é“¾è¡¨è¿˜æ˜¯åŒå‘é“¾è¡¨ï¼Ÿå¦‚æžœä»Žå¤§å€¼å‘å°å€¼æ£€ç´¢ï¼Œå¦‚ä½•æ“ä½œï¼Ÿ"><a href="#B-æ ‘çš„å¶å­èŠ‚ç‚¹æ˜¯å•å‘é“¾è¡¨è¿˜æ˜¯åŒå‘é“¾è¡¨ï¼Ÿå¦‚æžœä»Žå¤§å€¼å‘å°å€¼æ£€ç´¢ï¼Œå¦‚ä½•æ“ä½œï¼Ÿ" class="headerlink" title="B+æ ‘çš„å¶å­èŠ‚ç‚¹æ˜¯å•å‘é“¾è¡¨è¿˜æ˜¯åŒå‘é“¾è¡¨ï¼Ÿå¦‚æžœä»Žå¤§å€¼å‘å°å€¼æ£€ç´¢ï¼Œå¦‚ä½•æ“ä½œï¼Ÿ"></a>B+æ ‘çš„å¶å­èŠ‚ç‚¹æ˜¯å•å‘é“¾è¡¨è¿˜æ˜¯åŒå‘é“¾è¡¨ï¼Ÿå¦‚æžœä»Žå¤§å€¼å‘å°å€¼æ£€ç´¢ï¼Œå¦‚ä½•æ“ä½œï¼Ÿ</h4><p>B+æ ‘çš„å¶å­èŠ‚ç‚¹æ˜¯é€šè¿‡<strong>åŒå‘é“¾è¡¨</strong>è¿žæŽ¥çš„ï¼Œè¿™æ ·å¯ä»¥æ–¹ä¾¿èŒƒå›´æŸ¥è¯¢å’Œåå‘éåŽ†ã€‚</p>
<p>å½“æ‰§è¡ŒèŒƒå›´æŸ¥è¯¢æ—¶ï¼Œå¯ä»¥ä»ŽèŒƒå›´çš„å¼€å§‹ç‚¹æˆ–ç»“æŸç‚¹å¼€å§‹ï¼Œå‘å‰æˆ–å‘åŽéåŽ†ã€‚<br>åœ¨éœ€è¦å¯¹æ•°æ®è¿›è¡Œé€†åºå¤„ç†æ—¶ï¼ŒåŒå‘é“¾è¡¨éžå¸¸æœ‰ç”¨ã€‚<br>å¦‚æžœéœ€è¦åœ¨ B+æ ‘ä¸­ä»Žå¤§å€¼å‘å°å€¼è¿›è¡Œæ£€ç´¢ï¼Œå¯ä»¥å…ˆå®šä½åˆ°æœ€å³ä¾§èŠ‚ç‚¹ï¼Œæ‰¾åˆ°åŒ…å«æœ€å¤§å€¼çš„å¶å­èŠ‚ç‚¹ã€‚ä»Žæ ¹èŠ‚ç‚¹å¼€å§‹å‘å³éåŽ†æ ‘çš„æ–¹å¼å®žçŽ°ã€‚</p>
<p><img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="https://cdn.jsdelivr.net/gh/JakicDong/blog-assets@main/images/20250621105458.png" alt="20250621105458"></p>
<p>å®šä½åˆ°æœ€å³ä¾§çš„å¶å­èŠ‚ç‚¹åŽï¼Œå†åˆ©ç”¨å¶èŠ‚ç‚¹é—´çš„åŒå‘é“¾è¡¨å‘å·¦éåŽ†å°±å¥½äº†ã€‚</p>
<h4 id="ä¸ºä»€ä¹ˆ-MongoDB-çš„ç´¢å¼•ç”¨-Bæ ‘ï¼Œè€Œ-MySQL-ç”¨-B-æ ‘ï¼Ÿ"><a href="#ä¸ºä»€ä¹ˆ-MongoDB-çš„ç´¢å¼•ç”¨-Bæ ‘ï¼Œè€Œ-MySQL-ç”¨-B-æ ‘ï¼Ÿ" class="headerlink" title="ä¸ºä»€ä¹ˆ MongoDB çš„ç´¢å¼•ç”¨ Bæ ‘ï¼Œè€Œ MySQL ç”¨ B+ æ ‘ï¼Ÿ"></a>ä¸ºä»€ä¹ˆ MongoDB çš„ç´¢å¼•ç”¨ Bæ ‘ï¼Œè€Œ MySQL ç”¨ B+ æ ‘ï¼Ÿ</h4><p>MongoDB é€šå¸¸ä»¥ JSON æ ¼å¼å­˜å‚¨æ–‡æ¡£ï¼ŒæŸ¥è¯¢ä»¥å•é”®æŸ¥è¯¢ï¼ˆå¦‚ find({_id: 123})ï¼‰ä¸ºä¸»ã€‚B æ ‘çš„â€œèŠ‚ç‚¹æ—¢å­˜é”®åˆå­˜æ•°æ®â€çš„ç‰¹æ€§<strong>å…è®¸æŸ¥è¯¢åœ¨éžå¶å­èŠ‚ç‚¹æå‰ç»ˆæ­¢</strong>ï¼Œä»Žè€Œå‡å°‘ I&#x2F;O æ¬¡æ•°ã€‚<br><img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="https://cdn.jsdelivr.net/gh/JakicDong/blog-assets@main/images/20250621105550.png" alt="20250621105550"></p>
<p>MySQL çš„æŸ¥è¯¢é€šå¸¸æ¶‰åŠèŒƒå›´ï¼ˆWHERE id &gt; 100ï¼‰ã€æŽ’åºï¼ˆORDER BYï¼‰ã€è¿žæŽ¥ï¼ˆJOINï¼‰ç­‰æ“ä½œã€‚B+ æ ‘çš„å¶å­èŠ‚ç‚¹æ˜¯é“¾è¡¨ç»“æž„ï¼Œå¤©ç„¶æ”¯æŒé¡ºåºéåŽ†ï¼Œæ— éœ€å›žæº¯è‡³æ ¹èŠ‚ç‚¹æˆ–ä¸­åºéåŽ†ï¼Œæ•ˆçŽ‡è¿œé«˜äºŽ B æ ‘ã€‚<br><img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="https://cdn.jsdelivr.net/gh/JakicDong/blog-assets@main/images/20250621105601.png" alt="20250621105601"></p>
<p><img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="https://cdn.jsdelivr.net/gh/JakicDong/blog-assets@main/images/20250621105641.png" alt="20250621105641"></p>
<h3 id="42-ðŸŒŸä¸€æ£µB-æ ‘èƒ½å­˜å‚¨å¤šå°‘æ¡æ•°æ®å‘¢ï¼Ÿ"><a href="#42-ðŸŒŸä¸€æ£µB-æ ‘èƒ½å­˜å‚¨å¤šå°‘æ¡æ•°æ®å‘¢ï¼Ÿ" class="headerlink" title="42.ðŸŒŸä¸€æ£µB+æ ‘èƒ½å­˜å‚¨å¤šå°‘æ¡æ•°æ®å‘¢ï¼Ÿ"></a>42.ðŸŒŸä¸€æ£µB+æ ‘èƒ½å­˜å‚¨å¤šå°‘æ¡æ•°æ®å‘¢ï¼Ÿ</h3><p>ä¸€å¥è¯å›žå¤ï¼š<br>ä¸€æ£µ B+ æ ‘èƒ½å­˜å¤šå°‘æ•°æ®ï¼Œ<strong>å–å†³äºŽå®ƒçš„åˆ†æ”¯å› å­å’Œé«˜åº¦</strong>ã€‚åœ¨ InnoDB ä¸­ï¼Œé¡µçš„é»˜è®¤å¤§å°ä¸º 16KBï¼Œå½“ä¸»é”®ä¸º bigint æ—¶ï¼Œ3 å±‚ B+ æ ‘é€šå¸¸å¯ä»¥å­˜å‚¨çº¦ 2000 ä¸‡æ¡æ•°æ®ã€‚</p>
<p><img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="https://cdn.jsdelivr.net/gh/JakicDong/blog-assets@main/images/20250623101840.png" alt="20250623101840"></p>
<p>â€”- è¿™éƒ¨åˆ†æ˜¯å¸®åŠ©ç†è§£ startï¼Œé¢è¯•ä¸­å¯ä¸èƒŒ â€”-</p>
<p>å…ˆæ¥çœ‹ä¸€ä¸‹<strong>è®¡ç®—å…¬å¼</strong>ï¼š</p>
<p><code>æœ€å¤§è®°å½•æ•° = (åˆ†æ”¯å› å­)^(æ ‘é«˜åº¦-1) Ã— å¶å­èŠ‚ç‚¹å®¹é‡</code></p>
<p>å†æ¥çœ‹ä¸€ä¸‹å…³é”®å‚æ•°ï¼š<br>â‘ ã€é¡µå¤§å°ï¼Œé»˜è®¤ 16KB<br>â‘¡ã€ä¸»é”®å¤§å°ï¼Œå‡è®¾æ˜¯ bigint ç±»åž‹ï¼Œé‚£ä¹ˆå®ƒçš„å¤§å°å°±æ˜¯ 8 ä¸ªå­—èŠ‚ã€‚<br>â‘¢ã€é¡µæŒ‡é’ˆå¤§å°ï¼ŒInnoDB æºç ä¸­è®¾ç½®ä¸º 6 å­—èŠ‚ï¼Œ4 å­—èŠ‚é¡µå· + 2 å­—èŠ‚é¡µå†…åç§»ã€‚</p>
<p>æ‰€ä»¥éžå¶å­èŠ‚ç‚¹å¯ä»¥å­˜å‚¨ 16384&#x2F;14(é”®å€¼+æŒ‡é’ˆ)&#x3D;1170 ä¸ªè¿™æ ·çš„å•å…ƒã€‚</p>
<p>å½“å±‚é«˜ä¸º 2 æ—¶ï¼Œæ ¹èŠ‚ç‚¹å¯ä»¥å­˜å‚¨ 1170 ä¸ªæŒ‡é’ˆï¼ŒæŒ‡å‘ 1170 ä¸ªå¶å­èŠ‚ç‚¹ï¼Œæ‰€ä»¥æ€»æ•°æ®é‡ä¸º 1170Ã—16 &#x3D;18720 æ¡ã€‚</p>
<p>å½“å±‚é«˜ä¸º 3 æ—¶ï¼Œæ ¹èŠ‚ç‚¹æŒ‡å‘ 1170 ä¸ªéžå¶å­èŠ‚ç‚¹ï¼Œæ¯ä¸ªéžå¶å­èŠ‚ç‚¹å†æŒ‡å‘ 1170 ä¸ªå¶å­èŠ‚ç‚¹ï¼Œæ‰€ä»¥æ€»æ•°æ®é‡ä¸º 1170Ã—1170Ã—16â‰ˆ21,902,400 æ¡ï¼ˆçº¦2,190ä¸‡æ¡ï¼‰è®°å½•ã€‚</p>
<p>æŽ¨èé˜…è¯»ï¼š<a target="_blank" rel="noopener" href="https://juejin.cn/post/6904293886626103309">æ¸…å¹½ä¹‹åœ°ï¼šInnoDB ä¸€æ£µ B+æ ‘å¯ä»¥å­˜æ”¾å¤šå°‘è¡Œæ•°æ®ï¼Ÿ</a></p>
<p>â€”- è¿™éƒ¨åˆ†æ˜¯å¸®åŠ©ç†è§£ endï¼Œé¢è¯•ä¸­å¯ä¸èƒŒ â€”-</p>
<p>çŽ°åœ¨æœ‰ä¸€å¼ è¡¨ 2kw æ•°æ®ï¼Œæˆ‘è¿™ä¸ª b+æ ‘çš„é«˜åº¦æœ‰å‡ å±‚ï¼Ÿ<br>å¯¹äºŽ 2KW æ¡æ•°æ®æ¥è¯´ï¼ŒB+æ ‘çš„é«˜åº¦ä¸º 3 å±‚å°±å¤Ÿäº†ã€‚</p>
<p><img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="https://cdn.jsdelivr.net/gh/JakicDong/blog-assets@main/images/3%E5%B1%82B+%E6%A0%91.png" alt="3å±‚B+æ ‘"></p>
<h4 id="æ¯ä¸ªå¶å­èŠ‚ç‚¹èƒ½å­˜æ”¾å¤šå°‘æ¡æ•°æ®ï¼Ÿ"><a href="#æ¯ä¸ªå¶å­èŠ‚ç‚¹èƒ½å­˜æ”¾å¤šå°‘æ¡æ•°æ®ï¼Ÿ" class="headerlink" title="æ¯ä¸ªå¶å­èŠ‚ç‚¹èƒ½å­˜æ”¾å¤šå°‘æ¡æ•°æ®ï¼Ÿ"></a>æ¯ä¸ªå¶å­èŠ‚ç‚¹èƒ½å­˜æ”¾å¤šå°‘æ¡æ•°æ®ï¼Ÿ</h4><p>å¦‚æžœå•è¡Œæ•°æ®å¤§å°ä¸º 1KBï¼Œé‚£ä¹ˆæ¯é¡µå¯å­˜å‚¨çº¦ 16 è¡Œï¼ˆ16KB&#x2F;1KBï¼‰æ•°æ®ã€‚</p>
<p>â€”- è¿™éƒ¨åˆ†æ˜¯å¸®åŠ©ç†è§£ startï¼Œé¢è¯•ä¸­å¯ä¸èƒŒ â€”-</p>
<p>å‡è®¾æœ‰è¿™æ ·ä¸€ä¸ªè¡¨ç»“æž„ï¼š</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">CREATE TABLE</span> `<span class="keyword">user</span>` (</span><br><span class="line">  `id` <span class="type">BIGINT</span> <span class="keyword">PRIMARY KEY</span>,        <span class="comment">-- 8å­—èŠ‚</span></span><br><span class="line">  `name` <span class="type">VARCHAR</span>(<span class="number">255</span>) <span class="keyword">NOT NULL</span>,   <span class="comment">-- å®žé™…é•¿åº¦50å­—èŠ‚ï¼ˆUTF8MB4ï¼Œæ¯ä¸ªå­—ç¬¦æœ€å¤š4å­—èŠ‚ï¼‰</span></span><br><span class="line">  `age` TINYINT,                  <span class="comment">-- 1å­—èŠ‚</span></span><br><span class="line">  `email` <span class="type">VARCHAR</span>(<span class="number">255</span>)            <span class="comment">-- å®žé™…é•¿åº¦30å­—èŠ‚ï¼Œå¯ä¸ºNULL</span></span><br><span class="line">) ROW_FORMAT<span class="operator">=</span>COMPACT;</span><br></pre></td></tr></table></figure>
<p>é‚£ä¹ˆä¸€è¡Œæ•°æ®çš„å¤§å°ä¸ºï¼š8 + 50 + 1 + 30 &#x3D; 89 å­—èŠ‚ã€‚</p>
<p>è¡Œæ ¼å¼çš„å¼€é”€ä¸ºï¼šè¡Œå¤´ 5 å­—èŠ‚+æŒ‡é’ˆ 6 å­—èŠ‚+å¯å˜é•¿åº¦å­—æ®µå¼€é”€ 2 å­—èŠ‚ï¼ˆname å’Œ email å„å  1 å­—èŠ‚ï¼‰+ NULL ä½å›¾ 1 å­—èŠ‚ &#x3D; 14 å­—èŠ‚ã€‚</p>
<p>æ‰€ä»¥æ¯è¡Œæ•°æ®çš„å®žé™…å¤§å°ä¸ºï¼š89 + 14 &#x3D; 103 å­—èŠ‚ã€‚</p>
<p>æ¯é¡µå¤§å°é»˜è®¤ä¸º 16KBï¼Œé‚£ä¹ˆæ¯é¡µæœ€å¤šå¯ä»¥å­˜å‚¨ 16384 &#x2F; 103 â‰ˆ 158 è¡Œæ•°æ®ã€‚</p>
<p>â€”- è¿™éƒ¨åˆ†æ˜¯å¸®åŠ©ç†è§£ endï¼Œé¢è¯•ä¸­å¯ä¸èƒŒ â€”-</p>
<h3 id="44-ðŸŒŸä¸ºä»€ä¹ˆç”¨-B-æ ‘è€Œä¸ç”¨-B-æ ‘å‘¢ï¼Ÿ"><a href="#44-ðŸŒŸä¸ºä»€ä¹ˆç”¨-B-æ ‘è€Œä¸ç”¨-B-æ ‘å‘¢ï¼Ÿ" class="headerlink" title="44.ðŸŒŸä¸ºä»€ä¹ˆç”¨ B+ æ ‘è€Œä¸ç”¨ B æ ‘å‘¢ï¼Ÿ"></a>44.ðŸŒŸä¸ºä»€ä¹ˆç”¨ B+ æ ‘è€Œä¸ç”¨ B æ ‘å‘¢ï¼Ÿ</h3><p>B+ æ ‘ç›¸æ¯” B æ ‘æœ‰ 3 ä¸ªæ˜¾è‘—ä¼˜åŠ¿ï¼š</p>
<p>ç¬¬ä¸€ï¼ŒB æ ‘çš„æ¯ä¸ªèŠ‚ç‚¹æ—¢å­˜å‚¨é”®å€¼ï¼Œåˆå­˜å‚¨æ•°æ®å’ŒæŒ‡é’ˆï¼Œå¯¼è‡´<strong>å•èŠ‚ç‚¹å­˜å‚¨çš„é”®å€¼æ•°é‡è¾ƒå°‘</strong>ã€‚<br><img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="https://cdn.jsdelivr.net/gh/JakicDong/blog-assets@main/images/20250623103448.png" alt="20250623103448"></p>
<p>ä¸€ä¸ª 16KB çš„ InnoDB é¡µï¼Œå¦‚æžœæ•°æ®è¾ƒå¤§ï¼ŒB æ ‘çš„éžå¶å­èŠ‚ç‚¹åªèƒ½å®¹çº³å‡ åä¸ªé”®å€¼ï¼Œè€Œ B+ æ ‘çš„éžå¶å­èŠ‚ç‚¹å¯ä»¥å®¹çº³ä¸Šåƒä¸ªé”®å€¼ã€‚</p>
<p>ç¬¬äºŒï¼Œ<strong>B æ ‘çš„èŒƒå›´æŸ¥è¯¢éœ€è¦é€šè¿‡ä¸­åºéåŽ†é€å±‚å›žæº¯</strong>ï¼›è€Œ <strong>B+ æ ‘çš„å¶å­èŠ‚ç‚¹é€šè¿‡åŒå‘é“¾è¡¨é¡ºåºè¿žæŽ¥</strong>ï¼ŒèŒƒå›´æŸ¥è¯¢åªéœ€å®šä½èµ·å§‹ç‚¹åŽé¡ºåºéåŽ†é“¾è¡¨å³å¯ï¼Œæ²¡æœ‰å›žæº¯å¼€é”€ã€‚<br><img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="https://cdn.jsdelivr.net/gh/JakicDong/blog-assets@main/images/20250623104021.png" alt="20250623104021"></p>
<p>ç¬¬ä¸‰ï¼Œ<strong>B æ ‘çš„æ•°æ®å¯èƒ½å­˜å‚¨åœ¨ä»»æ„èŠ‚ç‚¹</strong>ï¼Œå‡å¦‚ç›®æ ‡æ•°æ®æ°å¥½ä½äºŽæ ¹èŠ‚ç‚¹æˆ–ä¸Šå±‚èŠ‚ç‚¹ï¼ŒæŸ¥è¯¢ä»…éœ€ 1-2 æ¬¡ I&#x2F;Oï¼›ä½†å¦‚æžœæ•°æ®ä½äºŽåº•å±‚èŠ‚ç‚¹ï¼Œåˆ™éœ€å¤šæ¬¡ I&#x2F;Oï¼Œå¯¼è‡´æŸ¥è¯¢æ—¶é—´æ³¢åŠ¨è¾ƒå¤§ã€‚</p>
<p>è€Œ <strong>B+ æ ‘çš„æ‰€æœ‰æ•°æ®éƒ½å­˜å‚¨åœ¨å¶å­èŠ‚ç‚¹</strong>ï¼ŒæŸ¥è¯¢è·¯å¾„çš„é•¿åº¦æ˜¯å›ºå®šçš„ï¼Œ**æ—¶é—´ç¨³å®šä¸º O(logN)**ï¼Œå¯¹ MySQL <strong>åœ¨é«˜å¹¶å‘åœºæ™¯ä¸‹çš„ç¨³å®šæ€§è‡³å…³é‡è¦</strong>ã€‚</p>
<h4 id="B-æ ‘çš„æ—¶é—´å¤æ‚åº¦æ˜¯å¤šå°‘ï¼Ÿ"><a href="#B-æ ‘çš„æ—¶é—´å¤æ‚åº¦æ˜¯å¤šå°‘ï¼Ÿ" class="headerlink" title="B+æ ‘çš„æ—¶é—´å¤æ‚åº¦æ˜¯å¤šå°‘ï¼Ÿ"></a>B+æ ‘çš„æ—¶é—´å¤æ‚åº¦æ˜¯å¤šå°‘ï¼Ÿ</h4><p><code>O(logN)</code>ã€‚</p>
<p><img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="https://cdn.jsdelivr.net/gh/JakicDong/blog-assets@main/images/20250623104724.png" alt="20250623104724"></p>
<h4 id="ä¸ºä»€ä¹ˆç”¨-B-æ ‘ä¸ç”¨è·³è¡¨å‘¢ï¼Ÿ"><a href="#ä¸ºä»€ä¹ˆç”¨-B-æ ‘ä¸ç”¨è·³è¡¨å‘¢ï¼Ÿ" class="headerlink" title="ä¸ºä»€ä¹ˆç”¨ B+æ ‘ä¸ç”¨è·³è¡¨å‘¢ï¼Ÿ"></a>ä¸ºä»€ä¹ˆç”¨ B+æ ‘ä¸ç”¨è·³è¡¨å‘¢ï¼Ÿ</h4><p>è·³è¡¨<strong>æœ¬è´¨ä¸Šè¿˜æ˜¯é“¾è¡¨ç»“æž„</strong>ï¼Œåªä¸è¿‡æŠŠæŸäº›èŠ‚ç‚¹æŠ½åˆ°ä¸Šå±‚åšäº†ç´¢å¼•ã€‚</p>
<p><img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="https://cdn.jsdelivr.net/gh/JakicDong/blog-assets@main/images/20250623104917.png" alt="20250623104917"></p>
<p>ä¸€æ¡æ•°æ®ä¸€ä¸ªèŠ‚ç‚¹ï¼Œå¦‚æžœéœ€è¦å­˜æ”¾ 2000 ä¸‡æ¡æ•°æ®ï¼Œä¸”æ¯æ¬¡æŸ¥è¯¢éƒ½è¦èƒ½è¾¾åˆ°äºŒåˆ†æŸ¥æ‰¾çš„æ•ˆæžœï¼Œé‚£ä¹ˆè·³è¡¨çš„é«˜åº¦å¤§çº¦ä¸º 24 å±‚ï¼ˆ2 çš„ 24 æ¬¡æ–¹ï¼‰ã€‚</p>
<p>åœ¨æœ€åçš„æƒ…å†µä¸‹ï¼Œè¿™ 24 å±‚æ•°æ®åˆ†æ•£åœ¨ä¸åŒçš„æ•°æ®é¡µï¼ŒæŸ¥æ‰¾ä¸€æ¬¡æ•°æ®å°±éœ€è¦ 24 æ¬¡ç£ç›˜ I&#x2F;Oã€‚</p>
<p>è€Œ 2000 ä¸‡æ¡æ•°æ®åœ¨ B+æ ‘ä¸­åªéœ€è¦ 3 å±‚å°±å¯ä»¥äº†ã€‚</p>
<h4 id="B-æ ‘çš„èŒƒå›´æŸ¥æ‰¾æ€Žä¹ˆåšçš„ï¼Ÿ"><a href="#B-æ ‘çš„èŒƒå›´æŸ¥æ‰¾æ€Žä¹ˆåšçš„ï¼Ÿ" class="headerlink" title="B+æ ‘çš„èŒƒå›´æŸ¥æ‰¾æ€Žä¹ˆåšçš„ï¼Ÿ"></a>B+æ ‘çš„èŒƒå›´æŸ¥æ‰¾æ€Žä¹ˆåšçš„ï¼Ÿ</h4><p>ä¸€å¥è¯å›žç­”ï¼š</p>
<p>å…ˆ<strong>é€šè¿‡ç´¢å¼•è·¯å¾„å®šä½åˆ°ç¬¬ä¸€ä¸ªæ»¡è¶³æ¡ä»¶çš„å¶å­èŠ‚ç‚¹</strong>ï¼Œç„¶åŽ<strong>é¡ºç€å¶å­èŠ‚ç‚¹ä¹‹é—´çš„é“¾è¡¨å‘å³&#x2F;å‘å·¦æ‰«æï¼Œç›´åˆ°è¶…è¿‡èŒƒå›´</strong>ã€‚</p>
<p>è¯¦ç»†ç‰ˆï¼š</p>
<p>B+ æ ‘ç´¢å¼•çš„èŒƒå›´æŸ¥æ‰¾ä¸»è¦<strong>ä¾èµ–å¶å­èŠ‚ç‚¹ä¹‹é—´çš„åŒå‘é“¾è¡¨æ¥å®Œæˆ</strong>ã€‚</p>
<p>ç¬¬ä¸€æ­¥ï¼Œä»Ž B+ æ ‘çš„æ ¹èŠ‚ç‚¹å¼€å§‹ï¼Œé€šè¿‡ç´¢å¼•é”®å€¼é€å±‚å‘ä¸‹ï¼Œ<strong>æ‰¾åˆ°ç¬¬ä¸€ä¸ªæ»¡è¶³æ¡ä»¶çš„å¶å­èŠ‚ç‚¹</strong>ã€‚</p>
<p>ç¬¬äºŒæ­¥ï¼Œ<strong>åˆ©ç”¨å¶å­èŠ‚ç‚¹ä¹‹é—´çš„åŒå‘é“¾è¡¨</strong>ï¼Œä»Žèµ·å§‹èŠ‚ç‚¹å¼€å§‹ï¼Œä¾æ¬¡å‘åŽéåŽ†æ¯ä¸ªèŠ‚ç‚¹ã€‚å½“ç´¢å¼•å€¼è¶…è¿‡æŸ¥è¯¢èŒƒå›´ï¼Œæˆ–è€…éåŽ†åˆ°é“¾è¡¨æœ«å°¾æ—¶ï¼Œç»ˆæ­¢æŸ¥è¯¢ã€‚</p>
<h4 id="äº†è§£å¿«æŽ’å—"><a href="#äº†è§£å¿«æŽ’å—" class="headerlink" title="äº†è§£å¿«æŽ’å—"></a>äº†è§£å¿«æŽ’å—</h4><p>å¿«é€ŸæŽ’åºä½¿ç”¨åˆ†æ²»æ³•å°†ä¸€ä¸ªåºåˆ—åˆ†ä¸ºè¾ƒå°å’Œè¾ƒå¤§çš„ 2 ä¸ªå­åºåˆ—ï¼Œç„¶åŽé€’å½’æŽ’åºä¸¤ä¸ªå­åºåˆ—ï¼Œç”±ä¸œå°¼Â·éœå°”åœ¨ 1960 å¹´æå‡ºã€‚</p>
<p><a target="_blank" rel="noopener" href="https://cdn.tobebetterjavaer.com/stutymore/mysql-Sorting_quicksort_anim.gif">æ¼”ç¤º</a><br><img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="https://cdn.tobebetterjavaer.com/stutymore/mysql-Sorting_quicksort_anim.gif" alt="å¿«æŽ’"><br>å…¶æ ¸å¿ƒæ€æƒ³æ˜¯ï¼š</p>
<ul>
<li><strong>é€‰æ‹©ä¸€ä¸ªåŸºå‡†å€¼ã€‚</strong></li>
<li>å°†æ•°ç»„åˆ†ä¸ºä¸¤éƒ¨åˆ†ï¼Œ<strong>å·¦è¾¹å°äºŽåŸºå‡†å€¼</strong>ï¼Œ<strong>å³è¾¹å¤§äºŽæˆ–ç­‰äºŽåŸºå‡†å€¼</strong>ã€‚</li>
<li>å¯¹å·¦å³ä¸¤éƒ¨åˆ†é€’å½’æŽ’åºï¼Œæœ€ç»ˆåˆå¹¶ã€‚<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">quickSort</span><span class="params">(<span class="type">int</span>[] arr, <span class="type">int</span> low, <span class="type">int</span> high)</span> &#123;</span><br><span class="line">    <span class="keyword">if</span> (low &lt; high) &#123;</span><br><span class="line">        <span class="type">int</span> <span class="variable">pivotIndex</span> <span class="operator">=</span> partition(arr, low, high);</span><br><span class="line">        quickSort(arr, low, pivotIndex - <span class="number">1</span>);</span><br><span class="line">        quickSort(arr, pivotIndex + <span class="number">1</span>, high);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">private</span> <span class="keyword">static</span> <span class="type">int</span> <span class="title function_">partition</span><span class="params">(<span class="type">int</span>[] arr, <span class="type">int</span> low, <span class="type">int</span> high)</span> &#123;</span><br><span class="line">    <span class="type">int</span> <span class="variable">pivot</span> <span class="operator">=</span> arr[high];</span><br><span class="line">    <span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> low - <span class="number">1</span>;</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">j</span> <span class="operator">=</span> low; j &lt; high; j++) &#123;</span><br><span class="line">        <span class="keyword">if</span> (arr[j] &lt;= pivot) &#123;</span><br><span class="line">            i++;</span><br><span class="line">            swap(arr, i, j);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    swap(arr, i + <span class="number">1</span>, high);</span><br><span class="line">    <span class="keyword">return</span> i + <span class="number">1</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">swap</span><span class="params">(<span class="type">int</span>[] arr, <span class="type">int</span> i, <span class="type">int</span> j)</span> &#123;</span><br><span class="line">    <span class="type">int</span> <span class="variable">temp</span> <span class="operator">=</span> arr[i];</span><br><span class="line">    arr[i] = arr[j];</span><br><span class="line">    arr[j] = temp;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
</ul>
<h3 id="46-ðŸŒŸèšæ—ç´¢å¼•å’Œéžèšæ—ç´¢å¼•æœ‰ä»€ä¹ˆåŒºåˆ«ï¼Ÿ"><a href="#46-ðŸŒŸèšæ—ç´¢å¼•å’Œéžèšæ—ç´¢å¼•æœ‰ä»€ä¹ˆåŒºåˆ«ï¼Ÿ" class="headerlink" title="46.ðŸŒŸèšæ—ç´¢å¼•å’Œéžèšæ—ç´¢å¼•æœ‰ä»€ä¹ˆåŒºåˆ«ï¼Ÿ"></a>46.ðŸŒŸèšæ—ç´¢å¼•å’Œéžèšæ—ç´¢å¼•æœ‰ä»€ä¹ˆåŒºåˆ«ï¼Ÿ</h3><p><strong>èšç°‡ç´¢å¼•çš„å¶å­èŠ‚ç‚¹å­˜å‚¨äº†å®Œæ•´çš„æ•°æ®è¡Œ</strong>ï¼Œæ•°æ®å’Œç´¢å¼•æ˜¯åœ¨ä¸€èµ·çš„ã€‚<strong>InnoDB çš„ä¸»é”®ç´¢å¼•å°±æ˜¯èšç°‡ç´¢å¼•</strong>ï¼Œå¶å­èŠ‚ç‚¹ä¸ä»…å­˜å‚¨äº†ä¸»é”®å€¼ï¼Œè¿˜å­˜å‚¨äº†å…¶ä»–åˆ—çš„å€¼ï¼Œå› æ­¤æŒ‰ç…§ä¸»é”®è¿›è¡ŒæŸ¥è¯¢çš„é€Ÿåº¦ä¼šéžå¸¸å¿«ã€‚<br><img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="https://cdn.jsdelivr.net/gh/JakicDong/blog-assets@main/images/20250623111022.png" alt="20250623111022"></p>
<p><strong>æ¯ä¸ªè¡¨åªèƒ½æœ‰ä¸€ä¸ªèšç°‡ç´¢å¼•</strong>ï¼Œé€šå¸¸ç”±ä¸»é”®å®šä¹‰ã€‚å¦‚æžœæ²¡æœ‰æ˜¾å¼æŒ‡å®šä¸»é”®ï¼Œ<strong>InnoDB ä¼šéšå¼åˆ›å»ºä¸€ä¸ªéšè—çš„ä¸»é”®ç´¢å¼• row_id</strong>ã€‚<br>éžèšç°‡ç´¢å¼•çš„å¶å­èŠ‚ç‚¹åªåŒ…å«äº†ä¸»é”®å€¼ï¼Œéœ€è¦é€šè¿‡å›žè¡¨æŒ‰ç…§ä¸»é”®åŽ»èšç°‡ç´¢å¼•æŸ¥æ‰¾å…¶ä»–åˆ—çš„å€¼ï¼Œ<strong>å”¯ä¸€ç´¢å¼•ã€æ™®é€šç´¢å¼•ç­‰éžä¸»é”®ç´¢å¼•éƒ½æ˜¯éžèšç°‡ç´¢å¼•</strong>ã€‚</p>
<p><img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="https://cdn.jsdelivr.net/gh/JakicDong/blog-assets@main/images/20250623111225.png" alt="20250623111225"></p>
<p>æ¯ä¸ªè¡¨éƒ½å¯ä»¥åˆ›å»º<strong>å¤šä¸ªéžèšç°‡ç´¢å¼•</strong>ï¼Œå¦‚æžœä¸æƒ³å›žè¡¨çš„è¯ï¼Œå¯ä»¥é€šè¿‡è¦†ç›–ç´¢å¼•æŠŠè¦æŸ¥è¯¢çš„å­—æ®µä¹Ÿæ”¾åˆ°ç´¢å¼•ä¸­ã€‚</p>
<p>â€”- è¿™éƒ¨åˆ†æ˜¯å¸®åŠ©å¤§å®¶ç†è§£ startï¼Œé¢è¯•ä¸­å¯ä¸èƒŒ â€”-</p>
<p>ä¸€å¼ è¡¨åªèƒ½æœ‰ä¸€ä¸ªèšç°‡ç´¢å¼•ã€‚</p>
<p>CREATE TABLE user (<br>  id INT PRIMARY KEY,<br>  name VARCHAR(100),<br>  age INT<br>);<br>ä¸»é”® id æ˜¯èšç°‡ç´¢å¼•ï¼ŒB+ æ ‘çš„å¶å­èŠ‚ç‚¹ç›´æŽ¥å­˜å‚¨äº† (id, name, age)ã€‚</p>
<p>ä¸€å¼ è¡¨å¯ä»¥æœ‰å¤šä¸ªéžèšç°‡ç´¢å¼•ã€‚</p>
<p>CREATE INDEX idx_name ON user(name);<br>CREATE INDEX idx_age ON user(age);<br>idx_name æ˜¯éžèšç°‡ç´¢å¼•ï¼Œå¶å­èŠ‚ç‚¹å­˜çš„æ˜¯ name -&gt; idï¼ŒæŸ¥æ•´è¡Œæ•°æ®è¦å›žè¡¨ã€‚</p>
<p>idx_age ä¹Ÿæ˜¯éžèšç°‡ç´¢å¼•ï¼Œå¶å­èŠ‚ç‚¹å­˜çš„æ˜¯ age -&gt; idï¼ŒæŸ¥æ•´è¡Œæ•°æ®ä¹Ÿè¦å›žè¡¨ã€‚</p>
<p>æƒ³è¦äº†è§£æ›´å¤šèšç°‡ç´¢å¼•å’Œéžèšç°‡ç´¢å¼•ï¼ŒæŽ¨èé˜…è¯»ï¼š<br><a target="_blank" rel="noopener" href="https://www.cnblogs.com/vipstone/p/16370305.html">https://www.cnblogs.com/vipstone/p/16370305.html</a><br><a target="_blank" rel="noopener" href="https://learnku.com/articles/50096">https://learnku.com/articles/50096</a><br><a target="_blank" rel="noopener" href="https://blog.csdn.net/m0_52226803/article/details/135494499">https://blog.csdn.net/m0_52226803/article/details/135494499</a><br><a target="_blank" rel="noopener" href="https://mp.weixin.qq.com/s/F0cEzIqecF4sWg7ZRmHKRQ">https://mp.weixin.qq.com/s/F0cEzIqecF4sWg7ZRmHKRQ</a><br>â€”- è¿™éƒ¨åˆ†æ˜¯å¸®åŠ©ç†è§£ endï¼Œé¢è¯•ä¸­å¯ä¸èƒŒ â€”-</p>
<h3 id="47-ðŸŒŸå›žè¡¨äº†è§£å—ï¼Ÿ"><a href="#47-ðŸŒŸå›žè¡¨äº†è§£å—ï¼Ÿ" class="headerlink" title="47.ðŸŒŸå›žè¡¨äº†è§£å—ï¼Ÿ"></a>47.ðŸŒŸå›žè¡¨äº†è§£å—ï¼Ÿ</h3><p>å½“ä½¿ç”¨<strong>éžèšç°‡ç´¢å¼•è¿›è¡ŒæŸ¥è¯¢</strong>æ—¶ï¼ŒMySQL éœ€è¦<strong>å…ˆé€šè¿‡éžèšç°‡ç´¢å¼•æ‰¾åˆ°ä¸»é”®å€¼</strong>ï¼Œç„¶åŽ<strong>å†æ ¹æ®ä¸»é”®å€¼å›žåˆ°èšç°‡ç´¢å¼•ä¸­æŸ¥æ‰¾å®Œæ•´æ•°æ®è¡Œ</strong>ï¼Œè¿™ä¸ªè¿‡ç¨‹ç§°ä¸º<strong>å›žè¡¨</strong>ã€‚</p>
<p><img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="https://cdn.jsdelivr.net/gh/JakicDong/blog-assets@main/images/20250623111452.png" alt="20250623111452"></p>
<p>å‡è®¾çŽ°åœ¨æœ‰ä¸€å¼ ç”¨æˆ·è¡¨ usersï¼š</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">CREATE TABLE</span> users (</span><br><span class="line">    id <span class="type">INT</span> <span class="keyword">PRIMARY KEY</span>,</span><br><span class="line">    name <span class="type">VARCHAR</span>(<span class="number">50</span>),</span><br><span class="line">    age <span class="type">INT</span>,</span><br><span class="line">    email <span class="type">VARCHAR</span>(<span class="number">50</span>),</span><br><span class="line">    INDEX (name)</span><br><span class="line">);</span><br></pre></td></tr></table></figure>
<p>æ‰§è¡ŒæŸ¥è¯¢ï¼š</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> users <span class="keyword">WHERE</span> name <span class="operator">=</span> <span class="string">&#x27;çŽ‹äºŒ&#x27;</span>;</span><br></pre></td></tr></table></figure>
<p><strong>æŸ¥è¯¢è¿‡ç¨‹å¦‚ä¸‹ï¼š</strong></p>
<ul>
<li>ç¬¬ä¸€æ­¥ï¼ŒMySQL ä½¿ç”¨ name åˆ—ä¸Šçš„éžèšç°‡ç´¢å¼•æŸ¥æ‰¾æ‰€æœ‰ name &#x3D; â€˜çŽ‹äºŒâ€™ çš„ä¸»é”® idã€‚</li>
<li>ç¬¬äºŒæ­¥ï¼Œä½¿ç”¨ä¸»é”® id åˆ°èšç°‡ç´¢å¼•ä¸­æŸ¥æ‰¾å®Œæ•´è®°å½•ã€‚</li>
</ul>
<h4 id="å›žè¡¨çš„ä»£ä»·æ˜¯ä»€ä¹ˆï¼Ÿ"><a href="#å›žè¡¨çš„ä»£ä»·æ˜¯ä»€ä¹ˆï¼Ÿ" class="headerlink" title="å›žè¡¨çš„ä»£ä»·æ˜¯ä»€ä¹ˆï¼Ÿ"></a>å›žè¡¨çš„ä»£ä»·æ˜¯ä»€ä¹ˆï¼Ÿ</h4><p>å›žè¡¨é€šå¸¸<strong>éœ€è¦è®¿é—®é¢å¤–çš„æ•°æ®é¡µ</strong>ï¼Œå¦‚æžœæ•°æ®ä¸åœ¨å†…å­˜ä¸­ï¼Œè¿˜éœ€è¦ä»Žç£ç›˜è¯»å–ï¼Œ<strong>å¢žåŠ  I&#x2F;O å¼€é”€</strong>ã€‚</p>
<p><img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="https://cdn.jsdelivr.net/gh/JakicDong/blog-assets@main/images/20250623112230.png" alt="20250623112230"></p>
<p>å¯é€šè¿‡è¦†ç›–ç´¢å¼•æˆ–è€…è”åˆç´¢å¼•æ¥é¿å…å›žè¡¨ã€‚</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- åŽŸè¡¨ç»“æž„</span></span><br><span class="line"><span class="keyword">CREATE TABLE</span> users (</span><br><span class="line">    id <span class="type">INT</span> <span class="keyword">PRIMARY KEY</span>,</span><br><span class="line">    name <span class="type">VARCHAR</span>(<span class="number">50</span>),</span><br><span class="line">    age <span class="type">INT</span>,</span><br><span class="line">    INDEX idx_name (name)</span><br><span class="line">);</span><br><span class="line"></span><br><span class="line"><span class="comment">-- éœ€è¦æŸ¥è¯¢nameå’Œage</span></span><br><span class="line"><span class="keyword">SELECT</span> name, age <span class="keyword">FROM</span> users <span class="keyword">WHERE</span> name <span class="operator">=</span> <span class="string">&#x27;å¼ ä¸‰&#x27;</span>;</span><br><span class="line"><span class="comment">-- è¿™ä¼šå›žè¡¨ï¼Œå› ä¸ºageä¸åœ¨idx_nameç´¢å¼•ä¸­</span></span><br><span class="line"></span><br><span class="line"><span class="comment">-- ä¼˜åŒ–æ–¹æ¡ˆ1ï¼šåˆ›å»ºåŒ…å«ageçš„è”åˆç´¢å¼•</span></span><br><span class="line"><span class="keyword">ALTER TABLE</span> users <span class="keyword">ADD</span> INDEX idx_name_age (name, age);</span><br><span class="line"><span class="comment">-- çŽ°åœ¨åŒæ ·çš„æŸ¥è¯¢ä¸éœ€è¦å›žè¡¨</span></span><br></pre></td></tr></table></figure>

<p><strong>ä»€ä¹ˆæƒ…å†µä¸‹ä¼šè§¦å‘å›žè¡¨ï¼Ÿ</strong></p>
<p>ç¬¬ä¸€ï¼Œå½“æŸ¥è¯¢å­—æ®µ<strong>ä¸åœ¨éžèšç°‡ç´¢å¼•ä¸­æ—¶</strong>ï¼Œå¿…é¡»å›žè¡¨åˆ°ä¸»é”®ç´¢å¼•èŽ·å–æ•°æ®ã€‚<br>ç¬¬äºŒï¼ŒæŸ¥è¯¢å­—æ®µåŒ…å«éžç´¢å¼•åˆ—ï¼ˆå¦‚ SELECT *ï¼‰ï¼Œå¿…ç„¶è§¦å‘å›žè¡¨ã€‚</p>
<p><strong>å›žè¡¨è®°å½•è¶Šå¤šå¥½å—ï¼Ÿ</strong><br><strong>å›žè¡¨è®°å½•è¶Šå¤šï¼Œé€šå¸¸ä»£è¡¨æ€§èƒ½è¶Šå·®</strong>ï¼Œå› ä¸ºæ¯æ¡è®°å½•éƒ½éœ€è¦é€šè¿‡ä¸»é”®å†æŸ¥è¯¢ä¸€æ¬¡å®Œæ•´æ•°æ®ã€‚è¿™ä¸ªè¿‡ç¨‹æ¶‰åŠå†…å­˜è®¿é—®æˆ–ç£ç›˜ IOï¼Œå°¤å…¶å½“ç¼“å­˜å‘½ä¸­çŽ‡ä¸é«˜æ—¶ï¼Œ<strong>å›žè¡¨ä¼šä¸¥é‡å½±å“æŸ¥è¯¢æ•ˆçŽ‡</strong>ã€‚</p>
<h4 id="äº†è§£-MRR-å—ï¼Ÿ"><a href="#äº†è§£-MRR-å—ï¼Ÿ" class="headerlink" title="äº†è§£ MRR å—ï¼Ÿ"></a>äº†è§£ MRR å—ï¼Ÿ</h4><p>MRR æ˜¯ InnoDB ä¸ºäº†è§£å†³å›žè¡¨å¸¦æ¥çš„å¤§é‡éšæœº IO é—®é¢˜è€Œå¼•å…¥çš„ä¸€ç§<strong>ä¼˜åŒ–ç­–ç•¥</strong>ã€‚</p>
<p><img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="https://cdn.jsdelivr.net/gh/JakicDong/blog-assets@main/images/MRR.png" alt="MRR"></p>
<p>å®ƒä¼šå…ˆæŠŠéžèšç°‡ç´¢å¼•æŸ¥åˆ°çš„ä¸»é”®å€¼<strong>åˆ—è¡¨è¿›è¡ŒæŽ’åº</strong>ï¼Œ<strong>å†æŒ‰é¡ºåºåŽ»ä¸»é”®ç´¢å¼•ä¸­æ‰¹é‡å›žè¡¨</strong>ï¼Œå°†éšæœº I&#x2F;O è½¬æ¢ä¸ºé¡ºåº I&#x2F;Oï¼Œä»¥å‡å°‘ç£ç›˜å¯»é“æ—¶é—´ã€‚</p>
<p>â€”- è¿™éƒ¨åˆ†æ˜¯å¸®åŠ©ç†è§£ startï¼Œé¢è¯•ä¸­å¯ä¸èƒŒ â€”-</p>
<p>å¯é€šè¿‡ <code>SHOW VARIABLES LIKE &#39;optimizer_switch&#39;;</code> æŸ¥çœ‹ MRR æ˜¯å¦å¯ç”¨ã€‚</p>
<p><img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="https://cdn.jsdelivr.net/gh/JakicDong/blog-assets@main/images/20250623113200.png" alt="20250623113200"></p>
<p>å…¶ä¸­ <code>mrr=on</code> è¡¨ç¤ºå¯ç”¨ MRRï¼Œ<code>mrr_cost_based=on</code> è¡¨ç¤ºåŸºäºŽæˆæœ¬å†³å®šä½¿ç”¨ MRRã€‚</p>
<p>å¦å¤–å¯ä»¥é€šè¿‡ <code>show variables like &#39;read_rnd_buffer_size&#39;;</code> æŸ¥çœ‹ MRR çš„ç¼“å†²åŒºå¤§å°ï¼Œé»˜è®¤æ˜¯ 256KBã€‚</p>
<p><img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="https://cdn.jsdelivr.net/gh/JakicDong/blog-assets@main/images/20250623113223.png" alt="20250623113223"><br>æˆ‘ä»¬æ¥åˆ›å»ºä¸€ä¸ªè¡¨ï¼Œæ’å…¥ä¸€äº›æ•°æ®ï¼Œç„¶åŽæ‰§è¡Œä¸€ä¸ªæŸ¥è¯¢æ¥æ¼”ç¤º MRR çš„æ•ˆæžœã€‚</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">CREATE</span> DATABASE IF <span class="keyword">NOT</span> <span class="keyword">EXISTS</span> mrr_test; </span><br><span class="line">USE mrr_test; </span><br><span class="line"><span class="keyword">CREATE TABLE</span> IF <span class="keyword">NOT</span> <span class="keyword">EXISTS</span> orders (id <span class="type">INT</span> AUTO_INCREMENT <span class="keyword">PRIMARY KEY</span>, user_id <span class="type">INT</span>, order_date <span class="type">DATE</span>, amount <span class="type">DECIMAL</span>(<span class="number">10</span>,<span class="number">2</span>), status <span class="type">VARCHAR</span>(<span class="number">20</span>), INDEX idx_user_date(user_id, order_date));</span><br><span class="line"></span><br><span class="line">DELIMITER <span class="operator">/</span><span class="operator">/</span></span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">PROCEDURE</span> generate_test_data()</span><br><span class="line"><span class="keyword">BEGIN</span></span><br><span class="line">    <span class="keyword">DECLARE</span> i <span class="type">INT</span> <span class="keyword">DEFAULT</span> <span class="number">1</span>;</span><br><span class="line">    WHILE i <span class="operator">&lt;=</span> <span class="number">100000</span> DO</span><br><span class="line">        <span class="keyword">INSERT INTO</span> orders (user_id, order_date, amount, status)</span><br><span class="line">        <span class="keyword">VALUES</span> (</span><br><span class="line">            <span class="built_in">FLOOR</span>(<span class="number">1</span> <span class="operator">+</span> RAND() <span class="operator">*</span> <span class="number">1000</span>),  <span class="comment">-- Random user_id between 1 and 1000</span></span><br><span class="line">            DATE_ADD(<span class="string">&#x27;2023-01-01&#x27;</span>, <span class="type">INTERVAL</span> <span class="built_in">FLOOR</span>(RAND() <span class="operator">*</span> <span class="number">365</span>) <span class="keyword">DAY</span>),  <span class="comment">-- Random date in 2023</span></span><br><span class="line">            ROUND(<span class="number">10</span> <span class="operator">+</span> RAND() <span class="operator">*</span> <span class="number">990</span>, <span class="number">2</span>),  <span class="comment">-- Random amount between 10 and 1000</span></span><br><span class="line">            ELT(<span class="number">1</span> <span class="operator">+</span> <span class="built_in">FLOOR</span>(RAND() <span class="operator">*</span> <span class="number">3</span>), <span class="string">&#x27;completed&#x27;</span>, <span class="string">&#x27;pending&#x27;</span>, <span class="string">&#x27;cancelled&#x27;</span>)  <span class="comment">-- Random status</span></span><br><span class="line">        );</span><br><span class="line">        <span class="keyword">SET</span> i <span class="operator">=</span> i <span class="operator">+</span> <span class="number">1</span>;</span><br><span class="line">    <span class="keyword">END</span> WHILE;</span><br><span class="line"><span class="keyword">END</span> <span class="operator">/</span><span class="operator">/</span></span><br><span class="line">DELIMITER ;</span><br><span class="line"></span><br><span class="line"><span class="keyword">CALL</span> generate_test_data();</span><br><span class="line"><span class="keyword">DROP</span> <span class="keyword">PROCEDURE</span> generate_test_data;&quot;</span><br></pre></td></tr></table></figure>
<p>æŸ¥çœ‹ MRR å¼€å¯å’Œå…³é—­æ—¶çš„æ€§èƒ½æ•°æ®ï¼š</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- ç¡®ä¿MRRå¼€å¯å¹¶è®¾ç½®è¶³å¤Ÿå¤§çš„ç¼“å†²åŒº</span></span><br><span class="line"><span class="keyword">SET</span> SESSION optimizer_switch<span class="operator">=</span><span class="string">&#x27;mrr=on,mrr_cost_based=off&#x27;</span>;</span><br><span class="line"><span class="keyword">SET</span> SESSION read_rnd_buffer_size <span class="operator">=</span> <span class="number">16</span><span class="operator">*</span><span class="number">1024</span><span class="operator">*</span><span class="number">1024</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- æ¸…ç†ç¼“å­˜å’ŒçŠ¶æ€</span></span><br><span class="line">FLUSH STATUS;</span><br><span class="line">FLUSH TABLES;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- å¼ºåˆ¶ä½¿ç”¨äºŒçº§ç´¢å¼•å¹¶å›žè¡¨æŸ¥è¯¢ï¼ˆé€šè¿‡é€‰æ‹©æœªè¢«ç´¢å¼•çš„åˆ—ï¼‰</span></span><br><span class="line"><span class="keyword">SELECT</span> <span class="string">&#x27;Raw data access pattern with MRR ON&#x27;</span> <span class="keyword">as</span> test_case;</span><br><span class="line"><span class="keyword">SELECT</span> <span class="comment">/*+ MRR(orders_mrr_test) */</span> id, shipping_address, customer_name</span><br><span class="line"><span class="keyword">FROM</span> orders_mrr_test FORCE INDEX(idx_user_date)</span><br><span class="line"><span class="keyword">WHERE</span> user_id <span class="keyword">IN</span> (<span class="number">100</span>,<span class="number">200</span>,<span class="number">300</span>,<span class="number">400</span>,<span class="number">500</span>,<span class="number">600</span>,<span class="number">700</span>,<span class="number">800</span>,<span class="number">900</span>,<span class="number">1000</span>)</span><br><span class="line"><span class="keyword">AND</span> order_date <span class="keyword">BETWEEN</span> <span class="string">&#x27;2023-03-01&#x27;</span> <span class="keyword">AND</span> <span class="string">&#x27;2023-04-01&#x27;</span></span><br><span class="line">LIMIT <span class="number">15</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- æ˜¾ç¤ºå¤„ç†å™¨çŠ¶æ€</span></span><br><span class="line"><span class="keyword">SHOW</span> STATUS <span class="keyword">LIKE</span> <span class="string">&#x27;Handler_%&#x27;</span>;</span><br><span class="line"><span class="keyword">SHOW</span> STATUS <span class="keyword">LIKE</span> <span class="string">&#x27;%mrr%&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- å¯¹æ¯”ï¼šå…³é—­MRR</span></span><br><span class="line"><span class="keyword">SET</span> SESSION optimizer_switch<span class="operator">=</span><span class="string">&#x27;mrr=off,mrr_cost_based=off&#x27;</span>;</span><br><span class="line">FLUSH STATUS;</span><br><span class="line">FLUSH TABLES;</span><br><span class="line"></span><br><span class="line"><span class="keyword">SELECT</span> <span class="string">&#x27;Raw data access pattern with MRR OFF&#x27;</span> <span class="keyword">as</span> test_case;</span><br><span class="line"><span class="keyword">SELECT</span> id, shipping_address, customer_name</span><br><span class="line"><span class="keyword">FROM</span> orders_mrr_test FORCE INDEX(idx_user_date)</span><br><span class="line"><span class="keyword">WHERE</span> user_id <span class="keyword">IN</span> (<span class="number">100</span>,<span class="number">200</span>,<span class="number">300</span>,<span class="number">400</span>,<span class="number">500</span>,<span class="number">600</span>,<span class="number">700</span>,<span class="number">800</span>,<span class="number">900</span>,<span class="number">1000</span>)</span><br><span class="line"><span class="keyword">AND</span> order_date <span class="keyword">BETWEEN</span> <span class="string">&#x27;2023-03-01&#x27;</span> <span class="keyword">AND</span> <span class="string">&#x27;2023-04-01&#x27;</span></span><br><span class="line">LIMIT <span class="number">15</span>;</span><br><span class="line"><span class="comment">-- æ˜¾ç¤ºå¤„ç†å™¨çŠ¶æ€</span></span><br><span class="line"><span class="keyword">SHOW</span> STATUS <span class="keyword">LIKE</span> <span class="string">&#x27;Handler_%&#x27;</span>;</span><br><span class="line"><span class="keyword">SHOW</span> STATUS <span class="keyword">LIKE</span> <span class="string">&#x27;%mrr%&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- æ˜¾ç¤ºè¯¦ç»†çš„æ‰§è¡Œè®¡åˆ’</span></span><br><span class="line">EXPLAIN FORMAT<span class="operator">=</span>TREE</span><br><span class="line"><span class="keyword">SELECT</span> <span class="comment">/*+ MRR(orders_mrr_test) */</span> id, shipping_address, customer_name</span><br><span class="line"><span class="keyword">FROM</span> orders_mrr_test FORCE INDEX(idx_user_date)</span><br><span class="line"><span class="keyword">WHERE</span> user_id <span class="keyword">IN</span> (<span class="number">100</span>,<span class="number">200</span>,<span class="number">300</span>,<span class="number">400</span>,<span class="number">500</span>,<span class="number">600</span>,<span class="number">700</span>,<span class="number">800</span>,<span class="number">900</span>,<span class="number">1000</span>)</span><br><span class="line"><span class="keyword">AND</span> order_date <span class="keyword">BETWEEN</span> <span class="string">&#x27;2023-03-01&#x27;</span> <span class="keyword">AND</span> <span class="string">&#x27;2023-04-01&#x27;</span>;&quot;</span><br></pre></td></tr></table></figure>
<p>å¯ä»¥çœ‹åˆ° MRR å¼€å¯æ—¶çš„ç»“æžœå¯¹æ¯”ï¼š<br><img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="https://cdn.jsdelivr.net/gh/JakicDong/blog-assets@main/images/20250623113305.png" alt="20250623113305"></p>
<p>Wrap ä¹Ÿç»™å‡ºäº†å¯¹åº”çš„ç»“æžœè¯´æ˜Žï¼š<br><img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="https://cdn.jsdelivr.net/gh/JakicDong/blog-assets@main/images/20250623113322.png" alt="20250623113322"><br>ä¹Ÿå¯ä»¥åœ¨ explain ä¸­ç¡®è®¤ MRR çš„ä½¿ç”¨æƒ…å†µã€‚<br><img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="https://cdn.jsdelivr.net/gh/JakicDong/blog-assets@main/images/20250623113335.png" alt="20250623113335"><br>â€”- è¿™éƒ¨åˆ†æ˜¯å¸®åŠ©ç†è§£ endï¼Œé¢è¯•ä¸­å¯ä¸èƒŒ â€”-</p>
<h3 id="48-ðŸŒŸè”åˆç´¢å¼•äº†è§£å—ï¼Ÿï¼ˆè¡¥å……ï¼‰"><a href="#48-ðŸŒŸè”åˆç´¢å¼•äº†è§£å—ï¼Ÿï¼ˆè¡¥å……ï¼‰" class="headerlink" title="48.ðŸŒŸè”åˆç´¢å¼•äº†è§£å—ï¼Ÿï¼ˆè¡¥å……ï¼‰"></a>48.ðŸŒŸè”åˆç´¢å¼•äº†è§£å—ï¼Ÿï¼ˆè¡¥å……ï¼‰</h3><p>è”åˆç´¢å¼•å°±æ˜¯æŠŠ<strong>å¤šä¸ªå­—æ®µæ”¾åœ¨ä¸€ä¸ªç´¢å¼•é‡Œ</strong>ï¼Œä½†å¿…é¡»éµå®ˆâ€œ<strong>æœ€å·¦å‰ç¼€</strong>â€åŽŸåˆ™ï¼Œåªæœ‰ä»Žç¬¬ä¸€ä¸ªå­—æ®µå¼€å§‹è¿žç»­ä½¿ç”¨ï¼Œç´¢å¼•æ‰ä¼šç”Ÿæ•ˆã€‚</p>
<p><img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="https://cdn.jsdelivr.net/gh/JakicDong/blog-assets@main/images/%E8%81%94%E5%90%88%E7%B4%A2%E5%BC%95.png" alt="è”åˆç´¢å¼•"></p>
<p>è”åˆç´¢å¼•ä¼š<strong>æŒ‰å­—æ®µé¡ºåºæž„å»ºB+æ ‘</strong>ã€‚ä¾‹å¦‚ï¼ˆage, nameï¼‰ç´¢å¼•ä¼šå…ˆæŒ‰ç…§ age æŽ’åºï¼Œage ç›¸åŒåˆ™æŒ‰ç…§ name æŽ’åºï¼Œè‹¥ä¸¤è€…éƒ½ç›¸åŒåˆ™æŒ‰ä¸»é”®æŽ’åºï¼Œç¡®ä¿å¶å­èŠ‚ç‚¹æ— é‡å¤ç´¢å¼•é¡¹ã€‚</p>
<p>åˆ›å»º(A,B,C)è”åˆç´¢å¼•ç›¸å½“äºŽåŒæ—¶åˆ›å»ºäº†(A)ã€(A,B)å’Œ(A,B,C)ä¸‰ä¸ªç´¢å¼•ã€‚</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- åˆ›å»ºè”åˆç´¢å¼•</span></span><br><span class="line"><span class="keyword">CREATE</span> INDEX idx_order_user_product <span class="keyword">ON</span> orders(user_id, product_id, create_time)</span><br><span class="line"></span><br><span class="line"><span class="comment">-- é«˜æ•ˆæŸ¥è¯¢</span></span><br><span class="line"><span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> orders </span><br><span class="line"><span class="keyword">WHERE</span> user_id<span class="operator">=</span><span class="number">1001</span> <span class="keyword">AND</span> product_id<span class="operator">=</span><span class="number">2002</span></span><br><span class="line"><span class="keyword">ORDER</span> <span class="keyword">BY</span> create_time <span class="keyword">DESC</span></span><br></pre></td></tr></table></figure>

<h4 id="è”åˆç´¢å¼•åº•å±‚çš„å­˜å‚¨ç»“æž„æ˜¯æ€Žæ ·çš„ï¼Ÿ"><a href="#è”åˆç´¢å¼•åº•å±‚çš„å­˜å‚¨ç»“æž„æ˜¯æ€Žæ ·çš„ï¼Ÿ" class="headerlink" title="è”åˆç´¢å¼•åº•å±‚çš„å­˜å‚¨ç»“æž„æ˜¯æ€Žæ ·çš„ï¼Ÿ"></a>è”åˆç´¢å¼•åº•å±‚çš„å­˜å‚¨ç»“æž„æ˜¯æ€Žæ ·çš„ï¼Ÿ</h4><p>è”åˆç´¢å¼•åœ¨åº•å±‚é‡‡ç”¨ B+ æ ‘ç»“æž„è¿›è¡Œå­˜å‚¨ï¼Œè¿™ä¸€ç‚¹ä¸Žå•åˆ—ç´¢å¼•ç›¸åŒã€‚</p>
<p><img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="https://cdn.jsdelivr.net/gh/JakicDong/blog-assets@main/images/20250624093822.png" alt="20250624093822"></p>
<p>ä¸Žå•åˆ—ç´¢å¼•ä¸åŒçš„æ˜¯ï¼Œè”åˆç´¢å¼•çš„æ¯ä¸ªèŠ‚ç‚¹ä¼šå­˜å‚¨æ‰€æœ‰ç´¢å¼•åˆ—çš„å€¼ï¼Œè€Œä¸ä»…ä»…æ˜¯ç¬¬ä¸€åˆ—çš„å€¼ã€‚ä¾‹å¦‚ï¼Œå¯¹äºŽè”åˆç´¢å¼•(a,b,c)ï¼Œ<strong>æ¯ä¸ªèŠ‚ç‚¹éƒ½åŒ…å« aã€bã€c ä¸‰åˆ—çš„å€¼</strong>ã€‚</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">éžå¶å­èŠ‚ç‚¹ç¤ºä¾‹ï¼š  </span><br><span class="line">[(a<span class="operator">=</span><span class="number">1</span>, b<span class="operator">=</span><span class="number">2</span>, c<span class="operator">=</span><span class="number">3</span>) â†’ å­èŠ‚ç‚¹<span class="number">1</span>, (a<span class="operator">=</span><span class="number">5</span>, b<span class="operator">=</span><span class="number">3</span>, c<span class="operator">=</span><span class="number">1</span>) â†’ å­èŠ‚ç‚¹<span class="number">2</span>]</span><br><span class="line"></span><br><span class="line">å¶å­èŠ‚ç‚¹ç¤ºä¾‹ï¼ˆInnoDBï¼‰ï¼š  </span><br><span class="line">(a<span class="operator">=</span><span class="number">1</span>, b<span class="operator">=</span><span class="number">2</span>, c<span class="operator">=</span><span class="number">3</span>) â†’ PK<span class="operator">=</span><span class="number">100</span> <span class="operator">|</span> (a<span class="operator">=</span><span class="number">1</span>, b<span class="operator">=</span><span class="number">2</span>, c<span class="operator">=</span><span class="number">4</span>) â†’ PK<span class="operator">=</span><span class="number">101</span>  </span><br><span class="line">ï¼ˆé€šè¿‡æŒ‡é’ˆè¿žæŽ¥å½¢æˆåŒå‘é“¾è¡¨ï¼‰</span><br></pre></td></tr></table></figure>

<h4 id="è”åˆç´¢å¼•çš„å¶å­èŠ‚ç‚¹å­˜çš„ä»€ä¹ˆå†…å®¹"><a href="#è”åˆç´¢å¼•çš„å¶å­èŠ‚ç‚¹å­˜çš„ä»€ä¹ˆå†…å®¹" class="headerlink" title="è”åˆç´¢å¼•çš„å¶å­èŠ‚ç‚¹å­˜çš„ä»€ä¹ˆå†…å®¹?"></a>è”åˆç´¢å¼•çš„å¶å­èŠ‚ç‚¹å­˜çš„ä»€ä¹ˆå†…å®¹?</h4><p>è”åˆç´¢å¼•å±žäºŽ<strong>éžèšç°‡ç´¢å¼•</strong>ï¼Œå¶å­èŠ‚ç‚¹å­˜å‚¨çš„æ˜¯è”åˆç´¢å¼•å„åˆ—çš„å€¼å’Œå¯¹åº”è¡Œçš„ä¸»é”®å€¼ï¼Œè€Œ<strong>ä¸æ˜¯å®Œæ•´çš„æ•°æ®è¡Œ</strong>ã€‚æŸ¥è¯¢éžç´¢å¼•å­—æ®µæ—¶ï¼Œéœ€è¦é€šè¿‡ä¸»é”®å€¼å›žè¡¨åˆ°èšç°‡ç´¢å¼•èŽ·å–å®Œæ•´æ•°æ®ã€‚</p>
<p><img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="https://cdn.jsdelivr.net/gh/JakicDong/blog-assets@main/images/20250624094019.png" alt="20250624094019"></p>
<p>ä¾‹å¦‚ç´¢å¼•<code>(a, b)</code>çš„å¶å­èŠ‚ç‚¹ä¼šå®Œæ•´å­˜å‚¨<code>(a, b)</code>çš„å€¼ï¼Œå¹¶æŒ‰å­—æ®µé¡ºåºæŽ’åºï¼ˆå¦‚ a ä¼˜å…ˆï¼Œa ç›¸åŒåˆ™æŒ‰ b æŽ’åºï¼‰ã€‚å¦‚æžœä¸»é”®æ˜¯ idï¼Œå¶å­èŠ‚ç‚¹ä¼šå­˜å‚¨ (a, b, id) çš„ç»„åˆã€‚</p>
<h4 id="49-ðŸŒŸè¦†ç›–ç´¢å¼•äº†è§£å—ï¼Ÿ"><a href="#49-ðŸŒŸè¦†ç›–ç´¢å¼•äº†è§£å—ï¼Ÿ" class="headerlink" title="49.ðŸŒŸè¦†ç›–ç´¢å¼•äº†è§£å—ï¼Ÿ"></a>49.ðŸŒŸè¦†ç›–ç´¢å¼•äº†è§£å—ï¼Ÿ</h4><p>è¦†ç›–ç´¢å¼•æŒ‡çš„æ˜¯ï¼š<strong>æŸ¥è¯¢æ‰€éœ€çš„å­—æ®µå…¨éƒ¨éƒ½åœ¨ç´¢å¼•ä¸­</strong>ï¼Œ<strong>ä¸éœ€è¦å›žè¡¨</strong>ï¼Œä»Žç´¢å¼•é¡µå°±èƒ½ç›´æŽ¥è¿”å›žç»“æžœã€‚</p>
<p><img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="https://cdn.jsdelivr.net/gh/JakicDong/blog-assets@main/images/20250624094156.png" alt="20250624094156"></p>
<p><code>empname</code> å’Œ <code>job</code> ä¸¤ä¸ªå­—æ®µæ˜¯ä¸€ä¸ªè”åˆç´¢å¼•ï¼Œè€ŒæŸ¥è¯¢ä¹Ÿæ°å¥½æ˜¯è¿™ä¸¤ä¸ªå­—æ®µï¼Œè¿™æ—¶å€™å•æ¬¡æŸ¥è¯¢å°±å¯ä»¥è¾¾åˆ°ç›®çš„ï¼Œä¸éœ€è¦å›žè¡¨ã€‚</p>
<p>å¯ä»¥<strong>å°†é«˜é¢‘æŸ¥è¯¢çš„å­—æ®µï¼ˆå¦‚ WHERE æ¡ä»¶å’Œ SELECT åˆ—ï¼‰ç»„åˆä¸ºè”åˆç´¢å¼•ï¼Œå®žçŽ°è¦†ç›–ç´¢å¼•</strong>ã€‚ ä¾‹å¦‚ï¼š</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">CREATE</span> INDEX idx_empname_job <span class="keyword">ON</span> employee(empname, job);</span><br></pre></td></tr></table></figure>
<p>è¿™æ ·æŸ¥è¯¢çš„æ—¶å€™å°±å¯ä»¥èµ°ç´¢å¼•ï¼š</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> empname, job <span class="keyword">FROM</span> employee <span class="keyword">WHERE</span> empname <span class="operator">=</span> <span class="string">&#x27;çŽ‹äºŒ&#x27;</span> <span class="keyword">AND</span> job <span class="operator">=</span> <span class="string">&#x27;ç¨‹åºå‘˜&#x27;</span>;</span><br></pre></td></tr></table></figure>
<p>æ™®é€šç´¢å¼•åªç”¨äºŽåŠ é€ŸæŸ¥è¯¢æ¡ä»¶çš„åŒ¹é…ï¼Œè€Œè¦†ç›–ç´¢å¼•è¿˜èƒ½ç›´æŽ¥æä¾›æŸ¥è¯¢ç»“æžœã€‚</p>
<p>ä¸€ä¸ªè¡¨ï¼ˆname, sex,age,idï¼‰ï¼Œselect age,id,name from tblname where name&#x3D;â€™paicodingâ€™;æ€Žä¹ˆå»ºç´¢å¼•<br>ç”±äºŽæŸ¥è¯¢æ¡ä»¶æœ‰ name å­—æ®µï¼Œæ‰€ä»¥æœ€å°‘åº”è¯¥ä¸º name å­—æ®µæ·»åŠ ä¸€ä¸ªç´¢å¼•ã€‚ã€</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">CREATE</span> INDEX idx_name <span class="keyword">ON</span> tblname(name);</span><br></pre></td></tr></table></figure>
<p>æŸ¥è¯¢ç»“æžœä¸­è¿˜éœ€è¦ ageã€id å­—æ®µï¼Œå¯ä»¥ä¸ºè¿™ä¸‰ä¸ªå­—æ®µåˆ›å»ºä¸€ä¸ªè”åˆç´¢å¼•ï¼Œåˆ©ç”¨è¦†ç›–ç´¢å¼•ï¼Œç›´æŽ¥ä»Žç´¢å¼•ä¸­èŽ·å–æ•°æ®ï¼Œå‡å°‘å›žè¡¨ã€‚</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">CREATE</span> INDEX idx_name_age_id <span class="keyword">ON</span> tblname (name, age, id);</span><br></pre></td></tr></table></figure>

<h3 id="50-ðŸŒŸä»€ä¹ˆæ˜¯æœ€å·¦å‰ç¼€åŽŸåˆ™ï¼Ÿ"><a href="#50-ðŸŒŸä»€ä¹ˆæ˜¯æœ€å·¦å‰ç¼€åŽŸåˆ™ï¼Ÿ" class="headerlink" title="50.ðŸŒŸä»€ä¹ˆæ˜¯æœ€å·¦å‰ç¼€åŽŸåˆ™ï¼Ÿ"></a>50.ðŸŒŸä»€ä¹ˆæ˜¯æœ€å·¦å‰ç¼€åŽŸåˆ™ï¼Ÿ</h3><p>æœ€å·¦å‰ç¼€åŽŸåˆ™æŒ‡çš„æ˜¯ï¼šMySQL ä½¿ç”¨è”åˆç´¢å¼•æ—¶ï¼Œå¿…é¡»ä»Žæœ€å·¦è¾¹çš„å­—æ®µå¼€å§‹åŒ¹é…ï¼Œæ‰èƒ½å‘½ä¸­ç´¢å¼•ã€‚</p>
<p>å‡è®¾æœ‰ä¸€ä¸ªè”åˆç´¢å¼• (A, B, C)ï¼Œå…¶ç”Ÿæ•ˆæ¡ä»¶å¦‚ä¸‹ï¼š<br><img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="https://cdn.jsdelivr.net/gh/JakicDong/blog-assets@main/images/20250624094631.png" alt="20250624094631"></p>
<p>å¦‚æžœæŽ’åºæˆ–åˆ†ç»„çš„åˆ—æ˜¯æœ€å·¦å‰ç¼€çš„ä¸€éƒ¨åˆ†ï¼Œç´¢å¼•è¿˜å¯ä»¥åŠ é€Ÿæ“ä½œã€‚</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- ç´¢å¼•(a,b)</span></span><br><span class="line"><span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> <span class="keyword">table</span> <span class="keyword">WHERE</span> a <span class="operator">=</span> <span class="number">1</span> <span class="keyword">ORDER</span> <span class="keyword">BY</span> b; <span class="comment">-- å¯ä»¥åˆ©ç”¨ç´¢å¼•æŽ’åº</span></span><br></pre></td></tr></table></figure>

<h4 id="èŒƒå›´æŸ¥è¯¢åŽçš„åˆ—è¿˜èƒ½ç”¨ç´¢å¼•å—ï¼Ÿ"><a href="#èŒƒå›´æŸ¥è¯¢åŽçš„åˆ—è¿˜èƒ½ç”¨ç´¢å¼•å—ï¼Ÿ" class="headerlink" title="èŒƒå›´æŸ¥è¯¢åŽçš„åˆ—è¿˜èƒ½ç”¨ç´¢å¼•å—ï¼Ÿ"></a>èŒƒå›´æŸ¥è¯¢åŽçš„åˆ—è¿˜èƒ½ç”¨ç´¢å¼•å—ï¼Ÿ</h4><p>èŒƒå›´æŸ¥è¯¢åªèƒ½åº”ç”¨äºŽ<strong>æœ€å·¦å‰ç¼€çš„æœ€åŽä¸€åˆ—</strong>ã€‚èŒƒå›´æŸ¥è¯¢ä¹‹åŽçš„åˆ—æ— æ³•ä½¿ç”¨ç´¢å¼•ã€‚</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- ç´¢å¼•(a,b,c)</span></span><br><span class="line"><span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> <span class="keyword">table</span> <span class="keyword">WHERE</span> a <span class="operator">=</span> <span class="number">1</span> <span class="keyword">AND</span> b <span class="operator">&gt;</span> <span class="number">2</span> <span class="keyword">AND</span> c <span class="operator">=</span> <span class="number">3</span>; </span><br><span class="line"><span class="comment">-- åªèƒ½ä½¿ç”¨aå’Œbï¼Œcæ— æ³•ä½¿ç”¨ç´¢å¼•</span></span><br></pre></td></tr></table></figure>
<h4 id="ä¸ºä»€ä¹ˆä¸ä»Žæœ€å·¦å¼€å§‹æŸ¥ï¼Œå°±æ— æ³•åŒ¹é…å‘¢ï¼Ÿ"><a href="#ä¸ºä»€ä¹ˆä¸ä»Žæœ€å·¦å¼€å§‹æŸ¥ï¼Œå°±æ— æ³•åŒ¹é…å‘¢ï¼Ÿ" class="headerlink" title="ä¸ºä»€ä¹ˆä¸ä»Žæœ€å·¦å¼€å§‹æŸ¥ï¼Œå°±æ— æ³•åŒ¹é…å‘¢ï¼Ÿ"></a>ä¸ºä»€ä¹ˆä¸ä»Žæœ€å·¦å¼€å§‹æŸ¥ï¼Œå°±æ— æ³•åŒ¹é…å‘¢ï¼Ÿ</h4><p>ä¸€å¥è¯å›žç­”ï¼š</p>
<p>å› ä¸º<strong>è”åˆç´¢å¼•åœ¨ B+ æ ‘ä¸­æ˜¯æŒ‰ç…§æœ€å·¦å­—æ®µä¼˜å…ˆæŽ’åºæž„å»ºçš„</strong>ï¼Œå¦‚æžœè·³è¿‡æœ€å·¦å­—æ®µï¼ŒMySQL æ— æ³•åˆ¤æ–­æŸ¥æ‰¾èŒƒå›´ä»Žå“ªé‡Œå¼€å§‹ï¼Œè‡ªç„¶ä¹Ÿå°±æ— æ³•ä½¿ç”¨ç´¢å¼•ã€‚</p>
<p><img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="https://cdn.jsdelivr.net/gh/JakicDong/blog-assets@main/images/20250624094835.png" alt="20250624094835"></p>
<p>æ¯”å¦‚æœ‰ä¸€ä¸ª user è¡¨ï¼Œæˆ‘ä»¬ç»™ name å’Œ age å»ºç«‹äº†ä¸€ä¸ªè”åˆç´¢å¼• (name, age)ã€‚</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">ALTER TABLE</span> <span class="keyword">user</span> <span class="keyword">add</span> INDEX comidx_name_phone (name,age);</span><br></pre></td></tr></table></figure>
<p>è”åˆç´¢å¼•åœ¨ B+ æ ‘ä¸­æŒ‰ç…§ä»Žå·¦åˆ°å³çš„é¡ºåºä¾æ¬¡å»ºç«‹æœç´¢æ ‘ï¼Œname åœ¨å·¦ï¼Œage åœ¨å³ã€‚</p>
<p>å½“æˆ‘ä»¬ä½¿ç”¨ where name&#x3D; â€˜çŽ‹äºŒâ€™ and age &#x3D; â€˜20â€™ åŽ»æŸ¥è¯¢çš„æ—¶å€™ï¼Œ B+ æ ‘ä¼šä¼˜å…ˆæ¯”è¾ƒ name æ¥ç¡®å®šä¸‹ä¸€æ­¥åº”è¯¥æœç´¢çš„æ–¹å‘ï¼Œå¾€å·¦è¿˜æ˜¯å¾€å³ã€‚</p>
<p>å¦‚æžœ name ç›¸åŒçš„æ—¶å€™å†æ¯”è¾ƒ ageã€‚</p>
<p>ä½†å¦‚æžœæŸ¥è¯¢æ¡ä»¶æ²¡æœ‰ nameï¼Œå°±ä¸çŸ¥é“åº”è¯¥æ€Žä¹ˆæŸ¥äº†ï¼Œå› ä¸º name æ˜¯ B+æ ‘ä¸­çš„å‰ç½®æ¡ä»¶ï¼Œæ²¡æœ‰ nameï¼Œç´¢å¼•å°±æ´¾ä¸ä¸Šç”¨åœºäº†ã€‚</p>
<h4 id="è”åˆç´¢å¼•-a-b-ï¼Œwhere-a-1-å’Œ-where-b-1ï¼Œæ•ˆæžœæ˜¯ä¸€æ ·çš„å—"><a href="#è”åˆç´¢å¼•-a-b-ï¼Œwhere-a-1-å’Œ-where-b-1ï¼Œæ•ˆæžœæ˜¯ä¸€æ ·çš„å—" class="headerlink" title="è”åˆç´¢å¼• (a, b)ï¼Œwhere a &#x3D; 1 å’Œ where b &#x3D; 1ï¼Œæ•ˆæžœæ˜¯ä¸€æ ·çš„å—"></a>è”åˆç´¢å¼• (a, b)ï¼Œwhere a &#x3D; 1 å’Œ where b &#x3D; 1ï¼Œæ•ˆæžœæ˜¯ä¸€æ ·çš„å—</h4><p>ä¸ä¸€æ ·ã€‚</p>
<p><code>WHERE a = 1</code>Â èƒ½å‘½ä¸­è”åˆç´¢å¼•ï¼Œå› ä¸º a æ˜¯è”åˆç´¢å¼•çš„ç¬¬ä¸€ä¸ªå­—æ®µï¼Œç¬¦åˆæœ€å·¦å‰ç¼€åŒ¹é…åŽŸåˆ™ã€‚è€ŒÂ <code>WHERE b = 1</code>Â æ— æ³•å‘½ä¸­è”åˆç´¢å¼•ï¼Œå› ä¸ºç¼ºå°‘ a çš„åŒ¹é…æ¡ä»¶ï¼ŒMySQL ä¼š<strong>å…¨è¡¨æ‰«æ</strong>ã€‚</p>
<p>â€”- è¿™éƒ¨åˆ†æ˜¯å¸®åŠ©ç†è§£ startï¼Œé¢è¯•ä¸­å¯ä¸èƒŒ â€”-</p>
<p>æˆ‘ä»¬æ¥éªŒè¯ä¸€ä¸‹ï¼Œå‡è®¾æœ‰ä¸€ä¸ª ab è¡¨ï¼Œå»ºç«‹äº†è”åˆç´¢å¼•Â <code>(a, b)</code>ï¼š</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">CREATE TABLE</span> ab (</span><br><span class="line"> a <span class="type">INT</span>,</span><br><span class="line"> b <span class="type">INT</span>,</span><br><span class="line"> INDEX ab_index (a, b)</span><br><span class="line">);</span><br></pre></td></tr></table></figure>
<p>æ’å…¥æ•°æ®ï¼š</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">INSERT INTO</span> ab (a, b) <span class="keyword">VALUES</span> (<span class="number">1</span>, <span class="number">2</span>), (<span class="number">1</span>, <span class="number">3</span>), (<span class="number">2</span>, <span class="number">1</span>), (<span class="number">3</span>, <span class="number">3</span>), (<span class="number">2</span>, <span class="number">2</span>);</span><br></pre></td></tr></table></figure>
<p>æ‰§è¡ŒæŸ¥è¯¢ï¼š<br><img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="https://cdn.jsdelivr.net/gh/JakicDong/blog-assets@main/images/20250624100243.png" alt="20250624100243"></p>
<p>é€šè¿‡ explain å¯ä»¥çœ‹åˆ°ï¼ŒWHERE a &#x3D; 1 ä½¿ç”¨äº†è”åˆç´¢å¼•ï¼Œè€Œ WHERE b &#x3D; 1 éœ€è¦å…¨è¡¨æ‰«æï¼Œä¾æ¬¡æ£€æŸ¥æ¯ä¸€è¡Œã€‚</p>
<p>â€”- è¿™éƒ¨åˆ†æ˜¯å¸®åŠ©ç†è§£ endï¼Œé¢è¯•ä¸­å¯ä¸èƒŒ â€”-</p>
<h4 id="å‡å¦‚æœ‰è”åˆç´¢å¼•-abcï¼Œä¸‹é¢çš„-sql-æ€Žä¹ˆèµ°çš„è”åˆç´¢å¼•ï¼Ÿ"><a href="#å‡å¦‚æœ‰è”åˆç´¢å¼•-abcï¼Œä¸‹é¢çš„-sql-æ€Žä¹ˆèµ°çš„è”åˆç´¢å¼•ï¼Ÿ" class="headerlink" title="å‡å¦‚æœ‰è”åˆç´¢å¼• abcï¼Œä¸‹é¢çš„ sql æ€Žä¹ˆèµ°çš„è”åˆç´¢å¼•ï¼Ÿ"></a>å‡å¦‚æœ‰è”åˆç´¢å¼• abcï¼Œä¸‹é¢çš„ sql æ€Žä¹ˆèµ°çš„è”åˆç´¢å¼•ï¼Ÿ</h4><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> t <span class="keyword">where</span> a <span class="operator">=</span> <span class="number">2</span> <span class="keyword">and</span> b <span class="operator">=</span> <span class="number">2</span>;</span><br><span class="line"><span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> t <span class="keyword">where</span> b <span class="operator">=</span> <span class="number">2</span> <span class="keyword">and</span> c <span class="operator">=</span> <span class="number">2</span>;</span><br><span class="line"><span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> t <span class="keyword">where</span> a <span class="operator">&gt;</span> <span class="number">2</span> <span class="keyword">and</span> b <span class="operator">=</span> <span class="number">2</span>;</span><br></pre></td></tr></table></figure>

<p>ç¬¬ä¸€æ¡ SQL è¯­å¥åŒ…å«æ¡ä»¶ a &#x3D; 2 å’Œ b &#x3D; 2ï¼Œåˆšå¥½ç¬¦åˆè”åˆç´¢å¼•çš„å‰ä¸¤åˆ—ã€‚<br><img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="https://cdn.jsdelivr.net/gh/JakicDong/blog-assets@main/images/20250624100956.png" alt="20250624100956"></p>
<p>ç¬¬äºŒæ¡ SQL è¯­å¥ç”±äºŽæœªä½¿ç”¨æœ€å·¦å‰ç¼€ä¸­çš„ aï¼Œä¼šè§¦å‘å…¨è¡¨æ‰«æã€‚<br><img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="https://cdn.jsdelivr.net/gh/JakicDong/blog-assets@main/images/20250624101013.png" alt="20250624101013"></p>
<p>ç¬¬ä¸‰æ¡ SQL è¯­å¥åœ¨èŒƒå›´æ¡ä»¶ a &gt; 2 ä¹‹åŽï¼Œç´¢å¼•åŽä¼šåœæ­¢åŒ¹é…ï¼Œb &#x3D; 2 çš„æ¡ä»¶éœ€è¦é¢å¤–è¿‡æ»¤ã€‚<br><img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="https://cdn.jsdelivr.net/gh/JakicDong/blog-assets@main/images/20250624101041.png" alt="20250624101041"></p>
<h4 id="A-B-C-è”åˆç´¢å¼•-select-from-tbn-where-a-and-b-in-and-c-ä¼šèµ°ç´¢å¼•å—ï¼Ÿ"><a href="#A-B-C-è”åˆç´¢å¼•-select-from-tbn-where-a-and-b-in-and-c-ä¼šèµ°ç´¢å¼•å—ï¼Ÿ" class="headerlink" title="(A,B,C) è”åˆç´¢å¼• select * from tbn where a&#x3D;? and b in (?,?) and c&gt;? ä¼šèµ°ç´¢å¼•å—ï¼Ÿ"></a>(A,B,C) è”åˆç´¢å¼• select * from tbn where a&#x3D;? and b in (?,?) and c&gt;? ä¼šèµ°ç´¢å¼•å—ï¼Ÿ</h4><p>è¿™ä¸ªæŸ¥è¯¢<strong>ä¼šå‘½ä¸­è”åˆç´¢å¼•</strong>ï¼Œå› ä¸º a æ˜¯ç­‰å€¼åŒ¹é…ï¼Œb æ˜¯ IN ç­‰å€¼å¤šåŒ¹é…ï¼Œc æ˜¯ b ä¹‹åŽçš„èŒƒå›´æ¡ä»¶ï¼Œç¬¦åˆæœ€å·¦å‰ç¼€åŽŸåˆ™ã€‚</p>
<p>å¯¹äºŽ a&#x3D;?ï¼šè¿™æ˜¯ä¸€ä¸ªç²¾ç¡®åŒ¹é…ï¼Œå¹¶ä¸”æ˜¯è”åˆç´¢å¼•çš„ç¬¬ä¸€ä¸ªå­—æ®µï¼Œæ‰€ä»¥ä¸€å®šä¼šå‘½ä¸­ç´¢å¼•ã€‚</p>
<p>å¯¹äºŽ b IN (?, ?)ï¼šç­‰ä»·äºŽ b&#x3D;? OR b&#x3D;?ï¼Œå±žäºŽå¤šå€¼åŒ¹é…ï¼Œå¹¶ä¸”æ˜¯è”åˆç´¢å¼•çš„ç¬¬äºŒä¸ªå­—æ®µï¼Œæ‰€ä»¥ä¹Ÿä¼šå‘½ä¸­ç´¢å¼•ã€‚</p>
<p>å¯¹äºŽ c&gt;?ï¼šè¿™æ˜¯ä¸€ä¸ªèŒƒå›´æ¡ä»¶ï¼Œå±žäºŽè”åˆç´¢å¼•çš„ç¬¬ä¸‰ä¸ªå­—æ®µï¼Œä¹Ÿä¼šå‘½ä¸­ç´¢å¼•ã€‚</p>
<p>â€”- è¿™éƒ¨åˆ†æ˜¯å¸®åŠ©ç†è§£ startï¼Œé¢è¯•ä¸­å¯ä¸èƒŒ â€”-</p>
<p>æ¥éªŒè¯ä¸€ä¸‹ã€‚</p>
<p>ç¬¬ä¸€æ­¥ï¼Œå»ºè¡¨ã€‚</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">CREATE TABLE</span> tbn (A <span class="type">INT</span>, B <span class="type">INT</span>, C <span class="type">INT</span>, D TEXT);</span><br></pre></td></tr></table></figure>
<p>ç¬¬äºŒæ­¥ï¼Œåˆ›å»ºç´¢å¼•ã€‚</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">CREATE</span> INDEX idx_abc <span class="keyword">ON</span> tbn (A, B, C);</span><br></pre></td></tr></table></figure>
<p>ç¬¬ä¸‰æ­¥ï¼Œæ’å…¥æ•°æ®ã€‚</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">INSERT INTO</span> tbn <span class="keyword">VALUES</span> (<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="string">&#x27;First&#x27;</span>);</span><br><span class="line"><span class="keyword">INSERT INTO</span> tbn <span class="keyword">VALUES</span> (<span class="number">1</span>, <span class="number">2</span>, <span class="number">4</span>, <span class="string">&#x27;Second&#x27;</span>);</span><br><span class="line"><span class="keyword">INSERT INTO</span> tbn <span class="keyword">VALUES</span> (<span class="number">1</span>, <span class="number">3</span>, <span class="number">5</span>, <span class="string">&#x27;Third&#x27;</span>);</span><br><span class="line"><span class="keyword">INSERT INTO</span> tbn <span class="keyword">VALUES</span> (<span class="number">2</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="string">&#x27;Fourth&#x27;</span>);</span><br><span class="line"><span class="keyword">INSERT INTO</span> tbn <span class="keyword">VALUES</span> (<span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>, <span class="string">&#x27;Fifth&#x27;</span>);</span><br></pre></td></tr></table></figure>
<p>ç¬¬å››æ­¥ï¼Œæ‰§è¡ŒæŸ¥è¯¢ã€‚</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">EXPLAIN <span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> tbn <span class="keyword">WHERE</span> A<span class="operator">=</span><span class="number">1</span> <span class="keyword">AND</span> B <span class="keyword">IN</span> (<span class="number">2</span>, <span class="number">3</span>) <span class="keyword">AND</span> C<span class="operator">&gt;</span><span class="number">3</span>\G</span><br></pre></td></tr></table></figure>
<p><img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="https://cdn.jsdelivr.net/gh/JakicDong/blog-assets@main/images/20250624101415.png" alt="20250624101415"><br>ä»Ž <code>EXPLAIN</code> è¾“å‡ºç»“æžœæ¥çœ‹ï¼Œæˆ‘ä»¬å¯ä»¥å¾—åˆ° MySQL æ˜¯å¦‚ä½•æ‰§è¡ŒæŸ¥è¯¢çš„ä¸€äº›å…³é”®ä¿¡æ¯ï¼š</p>
<ul>
<li>type: æŸ¥è¯¢ç±»åž‹ï¼Œè¿™é‡Œæ˜¯ rangeï¼Œè¡¨ç¤º MySQL ä½¿ç”¨äº†èŒƒå›´æŸ¥æ‰¾ï¼Œè¿™æ˜¯å› ä¸ºæŸ¥è¯¢æ¡ä»¶åŒ…å«äº† &gt; æ“ä½œç¬¦ã€‚</li>
<li>possible_keys: å¯èƒ½è¢«ç”¨æ¥æ‰§è¡ŒæŸ¥è¯¢çš„ç´¢å¼•ï¼Œè¿™é‡Œæ˜¯ idx_abcï¼Œè¡¨ç¤º MySQL è®¤ä¸º idx_abc ç´¢å¼•ä¼šç”¨äºŽæŸ¥è¯¢ä¼˜åŒ–ã€‚</li>
<li>key: å®žé™…ç”¨æ¥æ‰§è¡ŒæŸ¥è¯¢çš„ç´¢å¼•ï¼Œä¹Ÿæ˜¯ idx_abcï¼Œè¿™ç¡®å®šè¿™æ¡æŸ¥è¯¢å‘½ä¸­äº†è”åˆç´¢å¼•ã€‚</li>
<li>Extra: æä¾›äº†å…³äºŽæŸ¥è¯¢æ‰§è¡Œçš„é¢å¤–ä¿¡æ¯ã€‚Using index condition è¡¨ç¤º MySQL ä½¿ç”¨äº†ç´¢å¼•ä¸‹æŽ¨ï¼ˆIndex Condition Pushdownï¼ŒICPï¼‰ï¼Œè¿™æ˜¯ MySQL çš„ä¸€ä¸ªä¼˜åŒ–æ–¹å¼ï¼Œå®ƒå…è®¸åœ¨ç´¢å¼•å±‚é¢è¿‡æ»¤æ•°æ®ã€‚</li>
</ul>
<p>â€”- è¿™éƒ¨åˆ†æ˜¯å¸®åŠ©ç†è§£ endï¼Œé¢è¯•ä¸­å¯ä¸èƒŒ â€”-</p>
<h4 id="è”åˆç´¢å¼•çš„ä¸€ä¸ªåœºæ™¯é¢˜ï¼š-a-b-c-è”åˆç´¢å¼•ï¼Œ-b-c-æ˜¯å¦ä¼šèµ°ç´¢å¼•å—ï¼Ÿ"><a href="#è”åˆç´¢å¼•çš„ä¸€ä¸ªåœºæ™¯é¢˜ï¼š-a-b-c-è”åˆç´¢å¼•ï¼Œ-b-c-æ˜¯å¦ä¼šèµ°ç´¢å¼•å—ï¼Ÿ" class="headerlink" title="è”åˆç´¢å¼•çš„ä¸€ä¸ªåœºæ™¯é¢˜ï¼š(a,b,c)è”åˆç´¢å¼•ï¼Œ(b,c)æ˜¯å¦ä¼šèµ°ç´¢å¼•å—ï¼Ÿ"></a>è”åˆç´¢å¼•çš„ä¸€ä¸ªåœºæ™¯é¢˜ï¼š(a,b,c)è”åˆç´¢å¼•ï¼Œ(b,c)æ˜¯å¦ä¼šèµ°ç´¢å¼•å—ï¼Ÿ</h4><p>æ ¹æ®æœ€å·¦å‰ç¼€åŽŸåˆ™ï¼Œ(b,c) æŸ¥è¯¢ä¸ä¼šèµ°ç´¢å¼•ã€‚</p>
<p>å› ä¸ºè”åˆç´¢å¼• (a,b,c) ä¸­ï¼Œa æ˜¯æœ€å·¦è¾¹çš„åˆ—ï¼Œè”åˆç´¢å¼•åœ¨åˆ›å»ºç´¢å¼•æ ‘çš„æ—¶å€™éœ€è¦å…ˆæœ‰ aï¼Œç„¶åŽæ‰ä¼šæœ‰ b å’Œ cã€‚è€ŒæŸ¥è¯¢æ¡ä»¶ä¸­æ²¡æœ‰åŒ…å« aï¼Œæ‰€ä»¥ MySQL æ— æ³•åˆ©ç”¨è¿™ä¸ªç´¢å¼•ã€‚</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">EXPLAIN <span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> tbn <span class="keyword">WHERE</span> B<span class="operator">=</span><span class="number">1</span> <span class="keyword">AND</span> C<span class="operator">=</span><span class="number">1</span>\G</span><br></pre></td></tr></table></figure>
<p><img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="https://cdn.jsdelivr.net/gh/JakicDong/blog-assets@main/images/20250624101535.png" alt="20250624101535"></p>
<h4 id="å»ºç«‹è”åˆç´¢å¼•-a-b-c-ï¼Œwhere-c-5-æ˜¯å¦ä¼šç”¨åˆ°ç´¢å¼•ï¼Ÿä¸ºä»€ä¹ˆï¼Ÿ"><a href="#å»ºç«‹è”åˆç´¢å¼•-a-b-c-ï¼Œwhere-c-5-æ˜¯å¦ä¼šç”¨åˆ°ç´¢å¼•ï¼Ÿä¸ºä»€ä¹ˆï¼Ÿ" class="headerlink" title="å»ºç«‹è”åˆç´¢å¼•(a,b,c)ï¼Œwhere c &#x3D; 5 æ˜¯å¦ä¼šç”¨åˆ°ç´¢å¼•ï¼Ÿä¸ºä»€ä¹ˆï¼Ÿ"></a>å»ºç«‹è”åˆç´¢å¼•(a,b,c)ï¼Œwhere c &#x3D; 5 æ˜¯å¦ä¼šç”¨åˆ°ç´¢å¼•ï¼Ÿä¸ºä»€ä¹ˆï¼Ÿ</h4><p>ä¸ä¼šã€‚åªæœ‰ç´¢å¼•çš„ç¬¬ä¸‰åˆ— c è¢«ç”¨ä½œæŸ¥è¯¢æ¡ä»¶ï¼Œè€Œå‰ä¸¤åˆ— a å’Œ b éƒ½æ²¡æœ‰è¢«ä½¿ç”¨ã€‚è¿™<strong>ä¸ç¬¦åˆæœ€å·¦å‰ç¼€åŽŸåˆ™</strong>ã€‚</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">EXPLAIN <span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> tbn <span class="keyword">WHERE</span> C<span class="operator">=</span><span class="number">5</span>\G</span><br></pre></td></tr></table></figure>
<p><img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="https://cdn.jsdelivr.net/gh/JakicDong/blog-assets@main/images/20250624101624.png" alt="20250624101624"></p>
<h4 id="sqlä¸­ä½¿ç”¨likeï¼Œå¦‚æžœéµå¾ªæœ€å·¦å‰ç¼€åŒ¹é…ï¼ŒæŸ¥è¯¢æ˜¯ä¸æ˜¯ä¸€å®šä¼šç”¨åˆ°ç´¢å¼•ï¼Ÿ"><a href="#sqlä¸­ä½¿ç”¨likeï¼Œå¦‚æžœéµå¾ªæœ€å·¦å‰ç¼€åŒ¹é…ï¼ŒæŸ¥è¯¢æ˜¯ä¸æ˜¯ä¸€å®šä¼šç”¨åˆ°ç´¢å¼•ï¼Ÿ" class="headerlink" title="sqlä¸­ä½¿ç”¨likeï¼Œå¦‚æžœéµå¾ªæœ€å·¦å‰ç¼€åŒ¹é…ï¼ŒæŸ¥è¯¢æ˜¯ä¸æ˜¯ä¸€å®šä¼šç”¨åˆ°ç´¢å¼•ï¼Ÿ"></a>sqlä¸­ä½¿ç”¨likeï¼Œå¦‚æžœéµå¾ªæœ€å·¦å‰ç¼€åŒ¹é…ï¼ŒæŸ¥è¯¢æ˜¯ä¸æ˜¯ä¸€å®šä¼šç”¨åˆ°ç´¢å¼•ï¼Ÿ</h4><p>å¦‚æžœæŸ¥è¯¢æ¨¡å¼æ˜¯åŽç¼€é€šé…ç¬¦ <code>LIKE &#39;prefix%&#39;</code>ï¼Œä¸”è¯¥å­—æ®µæœ‰ç´¢å¼•ï¼Œä¼˜åŒ–å™¨é€šå¸¸ä¼šä½¿ç”¨ç´¢å¼•ã€‚å¦åˆ™å³ä¾¿æ˜¯éµå¾ªæœ€å·¦å‰ç¼€åŒ¹é…ï¼ŒLIKE å­—æ®µä¹Ÿæ— æ³•å‘½ä¸­ç´¢å¼•ã€‚</p>
<p>å¦‚ age &#x3D; 18 and name LIKE â€˜%xxxâ€™ï¼ŒMySQL ä¼šå…ˆä½¿ç”¨è”åˆç´¢å¼• age_name æ‰¾åˆ° age ç¬¦åˆæ¡ä»¶çš„æ‰€æœ‰è¡Œï¼Œç„¶åŽå†å…¨è¡¨æ‰«æè¿›è¡Œ name å­—æ®µçš„è¿‡æ»¤ã€‚</p>
<p><img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="https://cdn.jsdelivr.net/gh/JakicDong/blog-assets@main/images/20250624101721.png" alt="20250624101721"></p>
<p><code>type: ref</code> è¡¨ç¤ºä½¿ç”¨ç´¢å¼•æŸ¥æ‰¾åŒ¹é…æŸä¸ªå€¼çš„æ‰€æœ‰è¡Œã€‚</p>
<p><img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="https://cdn.jsdelivr.net/gh/JakicDong/blog-assets@main/images/20250624101751.png" alt="20250624101751"></p>
<p>å¦‚æžœæ˜¯åŽç¼€é€šé…ç¬¦ï¼Œå¦‚ <code>age = 18 and name LIKE &#39;xxx%&#39;</code>ï¼ŒMySQL ä¼šç›´æŽ¥ä½¿ç”¨è”åˆç´¢å¼• age_name æ‰¾åˆ°æ‰€æœ‰ç¬¦åˆæ¡ä»¶çš„è¡Œã€‚</p>
<p><img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="https://cdn.jsdelivr.net/gh/JakicDong/blog-assets@main/images/20250624101837.png" alt="20250624101837"></p>
<p><code>type ä¸º range</code>ï¼Œè¡¨ç¤º MySQL ä½¿ç”¨äº†<strong>ç´¢å¼•èŒƒå›´æ‰«æ</strong>ï¼Œfiltered ä¸º 100.00%ï¼Œè¡¨ç¤ºåœ¨æ‰«æçš„è¡Œä¸­ï¼Œæ‰€æœ‰çš„è¡Œéƒ½æ»¡è¶³ WHERE æ¡ä»¶ã€‚</p>
<h3 id="51-ðŸŒŸä»€ä¹ˆæ˜¯ç´¢å¼•ä¸‹æŽ¨ï¼Ÿ"><a href="#51-ðŸŒŸä»€ä¹ˆæ˜¯ç´¢å¼•ä¸‹æŽ¨ï¼Ÿ" class="headerlink" title="51.ðŸŒŸä»€ä¹ˆæ˜¯ç´¢å¼•ä¸‹æŽ¨ï¼Ÿ"></a>51.ðŸŒŸä»€ä¹ˆæ˜¯ç´¢å¼•ä¸‹æŽ¨ï¼Ÿ</h3><p>ç´¢å¼•ä¸‹æŽ¨æ˜¯æŒ‡ï¼šMySQL æŠŠ WHERE æ¡ä»¶å°½å¯èƒ½â€œä¸‹æŽ¨â€åˆ°ç´¢å¼•æ‰«æé˜¶æ®µï¼Œåœ¨å­˜å‚¨å¼•æ“Žå±‚æå‰è¿‡æ»¤æŽ‰ä¸ç¬¦åˆæ¡ä»¶çš„è®°å½•ã€‚</p>
<p><img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="https://cdn.jsdelivr.net/gh/JakicDong/blog-assets@main/images/20250624102101.png" alt="20250624102101"></p>
<p>å½“æŸ¥è¯¢æ¡ä»¶åŒ…å«ç´¢å¼•åˆ—ä½†æœªå®Œå…¨åŒ¹é…æ—¶ï¼ŒICP ä¼šåœ¨å­˜å‚¨å¼•æ“Žå±‚<strong>è¿‡æ»¤éžç´¢å¼•åˆ—æ¡ä»¶</strong>ï¼Œä»¥å‡å°‘å›žè¡¨æ¬¡æ•°ã€‚</p>
<p><strong>ä¼ ç»Ÿçš„æŸ¥è¯¢æµç¨‹</strong>æ˜¯ï¼Œå­˜å‚¨å¼•æ“Žé€šè¿‡<strong>è”åˆç´¢å¼•</strong>å®šä½åˆ°ç¬¦åˆæœ€å·¦å‰ç¼€æ¡ä»¶çš„ä¸»é”® IDï¼›å›žè¡¨è¯»å–å®Œæ•´æ•°æ®è¡Œå¹¶è¿”å›žç»™ Server å±‚ï¼›Server å±‚å¯¹æ‰€æœ‰è¿”å›žçš„è¡Œè¿›è¡Œ WHERE æ¡ä»¶è¿‡æ»¤ã€‚</p>
<p>æœ‰äº† ICP åŽï¼Œå­˜å‚¨å¼•æ“Žåœ¨ç´¢å¼•å±‚<strong>ç›´æŽ¥è¿‡æ»¤å¯ä¸‹æŽ¨çš„æ¡ä»¶</strong>ï¼Œä»…å¯¹ç¬¦åˆç´¢å¼•æ¡ä»¶çš„è®°å½•å›žè¡¨è¯»å–æ•°æ®ï¼Œå†è¿”å›žç»™ Server å±‚è¿›è¡Œå‰©ä½™æ¡ä»¶è¿‡æ»¤ã€‚</p>
<p>â€”- è¿™éƒ¨åˆ†æ˜¯å¸®åŠ©ç†è§£ startï¼Œé¢è¯•ä¸­å¯ä¸èƒŒ â€”-</p>
<p>ä¾‹å¦‚æœ‰ä¸€å¼  user è¡¨ï¼Œå»ºäº†ä¸€ä¸ªè”åˆç´¢å¼•ï¼ˆname, ageï¼‰ï¼ŒæŸ¥è¯¢è¯­å¥ï¼š<code>select * from user where name like &#39;å¼ %&#39; and age=10;</code>ï¼Œæ²¡æœ‰ç´¢å¼•ä¸‹æŽ¨ä¼˜åŒ–çš„æƒ…å†µä¸‹ï¼š</p>
<p>MySQL ä¼šä½¿ç”¨ç´¢å¼• name æ‰¾åˆ°æ‰€æœ‰Â <code>name like &#39;å¼ %&#39;</code>Â çš„ä¸»é”®ï¼Œæ ¹æ®è¿™äº›ä¸»é”®ï¼Œä¸€æ¡æ¡å›žè¡¨æŸ¥è¯¢æ•´è¡Œæ•°æ®ï¼Œå¹¶åœ¨ Server å±‚è¿‡æ»¤æŽ‰ä¸ç¬¦åˆÂ <code>age=10</code>Â çš„æ•°æ®è¡Œã€‚</p>
<p><img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="https://cdn.jsdelivr.net/gh/JakicDong/blog-assets@main/images/20250624102301.png" alt="20250624102301"></p>
<p>å¯ç”¨ ICP åŽï¼ŒInnoDB ä¼šé€šè¿‡è”åˆç´¢å¼•ç›´æŽ¥ç­›é€‰å‡ºç¬¦åˆæ¡ä»¶çš„ä¸»é”® IDï¼ˆ<code>name like &#39;å¼ %&#39; and age=10</code>ï¼‰ï¼Œç„¶åŽå†å›žè¡¨æŸ¥è¯¢æ•´è¡Œæ•°æ®ã€‚</p>
<p><img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="https://cdn.jsdelivr.net/gh/JakicDong/blog-assets@main/images/20250624102354.png" alt="20250624102354"></p>
<p>æ¢å¥è¯è¯´ï¼Œå‡è®¾ name like â€˜å¼ %â€™ æ‰¾åˆ° 10000 è¡Œæ•°æ®ï¼Œage&#x3D;10 åªæœ‰å…¶ä¸­ 10 è¡Œï¼Œæ²¡æœ‰ç´¢å¼•ä¸‹æŽ¨çš„æƒ…å†µä¸‹ï¼ŒMySQL ä¼šå›žè¡¨ 10000 æ¬¡ï¼Œè¯»å– 10000 è¡Œæ•°æ®ï¼Œç„¶åŽåœ¨ Server å±‚è¿‡æ»¤æŽ‰ 9990 è¡Œã€‚</p>
<p>è€Œæœ‰äº†ç´¢å¼•ä¸‹æŽ¨åŽï¼ŒMySQL åªä¼šå›žè¡¨ 10 æ¬¡ï¼Œè¯»å– 10 è¡Œæ•°æ®ã€‚</p>
<p>æˆ‘ä»¬æ¥éªŒè¯ä¸€ä¸‹ã€‚</p>
<p><img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="https://cdn.jsdelivr.net/gh/JakicDong/blog-assets@main/images/20250624102426.png" alt="20250624102426"></p>
<p>ä»Žç»“æžœä¸­æˆ‘ä»¬å¯ä»¥æ¸…æ¥šåœ°çœ‹åˆ° ICP çš„æ•ˆæžœã€‚ICP å¼€å¯æ—¶ï¼ŒExtra åˆ—æ˜¾ç¤ºâ€Using index conditionâ€ï¼Œè¡¨æ˜Žè¿‡æ»¤æ¡ä»¶è¢«ä¸‹æŽ¨åˆ°å­˜å‚¨å¼•æ“Žå±‚ã€‚</p>
<p>ICPå…³é—­æ—¶ï¼ŒExtra åˆ—ä»…æ˜¾ç¤ºâ€Using whereâ€ï¼Œè¡¨æ˜Žè¿‡æ»¤æ¡ä»¶åœ¨æœåŠ¡å™¨å±‚æ‰§è¡Œã€‚</p>
<p><img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="https://cdn.jsdelivr.net/gh/JakicDong/blog-assets@main/images/20250624102507.png" alt="20250624102507"></p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- å¼€å¯ICP</span></span><br><span class="line"><span class="keyword">SET</span> optimizer_switch<span class="operator">=</span><span class="string">&#x27;index_condition_pushdown=on&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- æ¸…ç†çŠ¶æ€</span></span><br><span class="line">FLUSH STATUS;</span><br><span class="line"></span><br><span class="line"><span class="keyword">SELECT</span> <span class="string">&#x27;Performance test with ICP ON&#x27;</span> <span class="keyword">as</span> test_case;</span><br><span class="line"><span class="comment">-- æ‰§è¡ŒæŸ¥è¯¢å¹¶åˆ†æžæ€§èƒ½</span></span><br><span class="line">EXPLAIN ANALYZE</span><br><span class="line"><span class="keyword">SELECT</span> <span class="comment">/*+ ICP_ON */</span> <span class="operator">*</span></span><br><span class="line"><span class="keyword">FROM</span> orders_mrr_test</span><br><span class="line"><span class="keyword">WHERE</span> user_id <span class="keyword">BETWEEN</span> <span class="number">100</span> <span class="keyword">AND</span> <span class="number">200</span></span><br><span class="line">  <span class="keyword">AND</span> order_date <span class="operator">&gt;=</span> <span class="string">&#x27;2023-01-01&#x27;</span></span><br><span class="line">  <span class="keyword">AND</span> order_date <span class="operator">&lt;</span> <span class="string">&#x27;2023-02-01&#x27;</span></span><br><span class="line">  <span class="keyword">AND</span> order_date <span class="keyword">NOT</span> <span class="keyword">LIKE</span> <span class="string">&#x27;2023-01-15%&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- æ˜¾ç¤ºå¤„ç†å™¨çŠ¶æ€</span></span><br><span class="line"><span class="keyword">SHOW</span> STATUS <span class="keyword">LIKE</span> <span class="string">&#x27;Handler_read%&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- å…³é—­ICP</span></span><br><span class="line"><span class="keyword">SET</span> optimizer_switch<span class="operator">=</span><span class="string">&#x27;index_condition_pushdown=off&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- æ¸…ç†çŠ¶æ€</span></span><br><span class="line">FLUSH STATUS;</span><br><span class="line"></span><br><span class="line"><span class="keyword">SELECT</span> <span class="string">&#x27;Performance test with ICP OFF&#x27;</span> <span class="keyword">as</span> test_case;</span><br><span class="line"><span class="comment">-- æ‰§è¡Œç›¸åŒçš„æŸ¥è¯¢</span></span><br><span class="line">EXPLAIN ANALYZE</span><br><span class="line"><span class="keyword">SELECT</span> <span class="operator">*</span></span><br><span class="line"><span class="keyword">FROM</span> orders_mrr_test</span><br><span class="line"><span class="keyword">WHERE</span> user_id <span class="keyword">BETWEEN</span> <span class="number">100</span> <span class="keyword">AND</span> <span class="number">200</span></span><br><span class="line">  <span class="keyword">AND</span> order_date <span class="operator">&gt;=</span> <span class="string">&#x27;2023-01-01&#x27;</span></span><br><span class="line">  <span class="keyword">AND</span> order_date <span class="operator">&lt;</span> <span class="string">&#x27;2023-02-01&#x27;</span></span><br><span class="line">  <span class="keyword">AND</span> order_date <span class="keyword">NOT</span> <span class="keyword">LIKE</span> <span class="string">&#x27;2023-01-15%&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- æ˜¾ç¤ºå¤„ç†å™¨çŠ¶æ€</span></span><br><span class="line"><span class="keyword">SHOW</span> STATUS <span class="keyword">LIKE</span> <span class="string">&#x27;Handler_read%&#x27;</span>;&quot;</span><br></pre></td></tr></table></figure>
<p>å®žé™…çš„æ€§èƒ½å·®è·ä¹Ÿå¾ˆå¤§ã€‚ICP å¼€å¯æ—¶ï¼Œå®žé™…æ‰«æè¡Œæ•°ï¼š1,649 è¡Œï¼Œæ‰§è¡Œæ—¶é—´ï¼šçº¦12.3 æ¯«ç§’ã€‚å…³é—­æ—¶ï¼Œå®žé™…æ‰«æè¡Œæ•°ï¼š19,959 è¡Œï¼Œæ‰§è¡Œæ—¶é—´ï¼šçº¦ 32.1 æ¯«ç§’ã€‚<br>Spring äº‹åŠ¡çš„æœ¬è´¨å…¶å®žå°±æ˜¯æ•°æ®åº“å¯¹äº‹åŠ¡çš„æ”¯æŒï¼Œæ²¡æœ‰æ•°æ®åº“çš„äº‹åŠ¡æ”¯æŒï¼ŒSpring æ˜¯æ— æ³•æä¾›äº‹åŠ¡åŠŸèƒ½çš„ã€‚Spring åªæä¾›ç»Ÿä¸€äº‹åŠ¡ç®¡ç†æŽ¥å£ï¼Œå…·ä½“å®žçŽ°éƒ½æ˜¯ç”±å„æ•°æ®åº“è‡ªå·±å®žçŽ°ï¼Œæ•°æ®åº“äº‹åŠ¡çš„æäº¤å’Œå›žæ»šæ˜¯é€šè¿‡æ•°æ®åº“è‡ªå·±çš„äº‹åŠ¡æœºåˆ¶å®žçŽ°ã€‚</p>
<p><img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="https://cdn.jsdelivr.net/gh/JakicDong/blog-assets@main/images/20250624102546.png" alt="20250624102546"></p>
<h3 id="53-ðŸŒŸMySQL-ä¸­æœ‰å“ªå‡ ç§é”ï¼Ÿ"><a href="#53-ðŸŒŸMySQL-ä¸­æœ‰å“ªå‡ ç§é”ï¼Ÿ" class="headerlink" title="53.ðŸŒŸMySQL ä¸­æœ‰å“ªå‡ ç§é”ï¼Ÿ"></a>53.ðŸŒŸMySQL ä¸­æœ‰å“ªå‡ ç§é”ï¼Ÿ</h3><p>MySQL ä¸­æœ‰å¤šç§ç±»åž‹çš„é”ï¼Œå¯ä»¥ä»Žä¸åŒç»´åº¦æ¥åˆ†ç±»ï¼ŒæŒ‰<strong>é”ç²’åº¦</strong>åˆ’åˆ†çš„è¯ï¼Œæœ‰è¡¨é”ã€è¡Œé”ã€‚</p>
<p>æŒ‰ç…§<strong>åŠ é”æœºåˆ¶</strong>åˆ’åˆ†çš„è¯ï¼Œæœ‰ä¹è§‚é”å’Œæ‚²è§‚é”ã€‚æŒ‰ç…§<strong>å…¼å®¹æ€§</strong>åˆ’åˆ†çš„è¯ï¼Œæœ‰å…±äº«é”å’ŒæŽ’ä»–é”ã€‚</p>
<p><img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="https://cdn.jsdelivr.net/gh/JakicDong/blog-assets@main/images/20250625092449.png" alt="20250625092449"></p>
<p>â€”- è¿™éƒ¨åˆ†æ˜¯å¸®åŠ©ç†è§£ startï¼Œé¢è¯•ä¸­å¯ä¸èƒŒ â€”-</p>
<p>è¡¨é”ï¼š<strong>é”å®šæ•´ä¸ªè¡¨</strong>ï¼Œèµ„æºå¼€é”€å°ï¼ŒåŠ é”å¿«ï¼Œä½†å¹¶å‘åº¦ä½Žï¼Œä¸ä¼šå‡ºçŽ°æ­»é”ï¼›<strong>é€‚åˆæŸ¥è¯¢ä¸ºä¸»ã€å°‘é‡æ›´æ–°</strong>çš„åœºæ™¯ï¼ˆå¦‚ MyISAM å¼•æ“Žï¼‰ã€‚</p>
<p><img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="https://cdn.jsdelivr.net/gh/JakicDong/blog-assets@main/images/20250625093141.png" alt="20250625093141"></p>
<p>å†ç»†åˆ†çš„è¯ï¼Œæœ‰<strong>è¡¨å…±äº«è¯»é”</strong>ï¼ˆSé”ï¼‰ï¼šå…è®¸å¤šä¸ªäº‹åŠ¡åŒæ—¶è¯»ï¼Œä½†é˜»å¡žå†™æ“ä½œï¼›<strong>è¡¨ç‹¬å å†™é”</strong>ï¼ˆXé”ï¼‰ï¼šç‹¬å è¡¨ï¼Œé˜»å¡žå…¶ä»–äº‹åŠ¡çš„è¯»å†™ã€‚</p>
<p><img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="https://cdn.jsdelivr.net/gh/JakicDong/blog-assets@main/images/20250625095630.png" alt="20250625095630"></p>
<p>è¡Œé”ï¼šé”å®šå•è¡Œæˆ–å¤šè¡Œï¼Œå¼€é”€å¤§ã€åŠ é”æ…¢ï¼Œå¯èƒ½å‡ºçŽ°æ­»é”ï¼Œä½†å¹¶å‘åº¦é«˜ï¼ˆInnoDB é»˜è®¤æ”¯æŒï¼‰ã€‚</p>
<p>å†ç»†åˆ†çš„è¯ï¼Œæœ‰<strong>è®°å½•é”</strong>ï¼ˆRecord Lockï¼‰ï¼šé”å®šç´¢å¼•ä¸­çš„å…·ä½“è®°å½•ï¼›<strong>é—´éš™é”</strong>ï¼ˆGap Lockï¼‰ï¼šé”å®šç´¢å¼•è®°å½•ä¹‹é—´çš„é—´éš™ï¼Œé˜²æ­¢å¹»è¯»ï¼›<strong>ä¸´é”®é”</strong>ï¼ˆNext-Key Lockï¼‰ï¼šç»“åˆè®°å½•é”å’Œé—´éš™é”ï¼Œé”å®šä¸€ä¸ªå·¦å¼€å³é—­çš„åŒºé—´ï¼ˆå¦‚Â <code>(5, 10]</code>ï¼‰ã€‚</p>
<p><strong>å…±äº«é”</strong>ï¼ˆSé”&#x2F;è¯»é”ï¼‰ï¼Œå…è®¸å¤šä¸ªäº‹åŠ¡åŒæ—¶è¯»å–æ•°æ®ï¼Œä½†é˜»å¡žå†™æ“ä½œã€‚è¯­æ³•ï¼š<code>SELECT ... LOCK IN SHARE MODE</code></p>
<p><strong>æŽ’ä»–é”</strong>ï¼ˆXé”&#x2F;å†™é”ï¼‰ï¼Œç‹¬å æ•°æ®ï¼Œé˜»å¡žå…¶ä»–äº‹åŠ¡çš„è¯»å†™ã€‚è¯­æ³•ï¼š<code>SELECT ... FOR UPDATE</code>ã€‚</p>
<p><strong>ä¹è§‚é”</strong>å‡è®¾å†²çªå°‘ï¼Œé€šè¿‡ç‰ˆæœ¬å·æˆ– CAS æœºåˆ¶æ£€æµ‹å†²çªï¼ˆå¦‚Â <code>UPDATE SET version=version+1 WHERE version=old_version</code>ï¼‰ã€‚</p>
<p><strong>æ‚²è§‚é”</strong>å‡è®¾å¹¶å‘å†²çªé¢‘ç¹ï¼Œå…ˆåŠ é”å†æ“ä½œ<code>SELECT FOR UPDATE</code>ã€‚<br>â€”- è¿™éƒ¨åˆ†æ˜¯å¸®åŠ©ç†è§£ endï¼Œé¢è¯•ä¸­å¯ä¸èƒŒ â€”-</p>
<h3 id="55-ðŸŒŸè¯´è¯´-MySQL-çš„è¡Œé”ï¼Ÿ"><a href="#55-ðŸŒŸè¯´è¯´-MySQL-çš„è¡Œé”ï¼Ÿ" class="headerlink" title="55.ðŸŒŸè¯´è¯´ MySQL çš„è¡Œé”ï¼Ÿ"></a>55.ðŸŒŸè¯´è¯´ MySQL çš„è¡Œé”ï¼Ÿ</h3><p>è¡Œé”æ˜¯ <code>InnoDB</code> å­˜å‚¨å¼•æ“Žä¸­<strong>æœ€ç»†ç²’åº¦çš„é”</strong>ï¼Œå®ƒ<strong>é”å®šè¡¨ä¸­çš„ä¸€è¡Œè®°å½•</strong>ï¼Œå…è®¸å…¶ä»–äº‹åŠ¡è®¿é—®è¡¨ä¸­çš„å…¶ä»–è¡Œã€‚</p>
<p>åº•å±‚æ˜¯é€šè¿‡<strong>ç»™ç´¢å¼•åŠ é”</strong>å®žçŽ°çš„ï¼Œè¿™å°±æ„å‘³ç€<strong>åªæœ‰é€šè¿‡ç´¢å¼•æ¡ä»¶æ£€ç´¢æ•°æ®æ—¶</strong>ï¼ŒInnoDB <strong>æ‰èƒ½ä½¿ç”¨è¡Œçº§é”</strong>ï¼Œå¦åˆ™ä¼šé€€åŒ–ä¸ºè¡¨é”ã€‚</p>
<p><img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="https://cdn.jsdelivr.net/gh/JakicDong/blog-assets@main/images/20250625103938.png" alt="20250625103938"></p>
<p>è¡Œé”åˆå¯ä»¥ç»†åˆ†ä¸º<strong>è®°å½•é”</strong>ã€<strong>é—´éš™é”</strong>å’Œ<strong>ä¸´é”®é”</strong>ä¸‰ç§å½¢å¼ã€‚é€šè¿‡ <code>SELECT ... FOR UPDATE</code> å¯ä»¥åŠ æŽ’ä»–é”ã€‚</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">START</span> TRANSACTION;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- åŠ æŽ’ä»–é”ï¼Œé”å®šæŸä¸€è¡Œ</span></span><br><span class="line"><span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> your_table <span class="keyword">WHERE</span> id <span class="operator">=</span> <span class="number">1</span> <span class="keyword">FOR</span> <span class="keyword">UPDATE</span>;</span><br><span class="line"><span class="comment">-- å¯¹è¯¥è¡Œè¿›è¡Œæ“ä½œ</span></span><br><span class="line"><span class="keyword">UPDATE</span> your_table <span class="keyword">SET</span> column1 <span class="operator">=</span> <span class="string">&#x27;new_value&#x27;</span> <span class="keyword">WHERE</span> id <span class="operator">=</span> <span class="number">1</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">COMMIT</span>;</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>é€šè¿‡ <code>SELECT ...LOCK IN SHARE MODE</code> å¯ä»¥åŠ å…±äº«é”ã€‚</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">START</span> TRANSACTION;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- åŠ å…±äº«é”ï¼Œé”å®šæŸä¸€è¡Œ</span></span><br><span class="line"><span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> your_table <span class="keyword">WHERE</span> id <span class="operator">=</span> <span class="number">1</span> LOCK <span class="keyword">IN</span> SHARE MODE;</span><br><span class="line"><span class="comment">-- åªèƒ½è¯»å–è¯¥è¡Œï¼Œä¸èƒ½ä¿®æ”¹</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">COMMIT</span>;</span><br></pre></td></tr></table></figure>
<h4 id="select-for-update-æœ‰ä»€ä¹ˆéœ€è¦æ³¨æ„çš„ï¼Ÿ"><a href="#select-for-update-æœ‰ä»€ä¹ˆéœ€è¦æ³¨æ„çš„ï¼Ÿ" class="headerlink" title="select for update æœ‰ä»€ä¹ˆéœ€è¦æ³¨æ„çš„ï¼Ÿ"></a>select for update æœ‰ä»€ä¹ˆéœ€è¦æ³¨æ„çš„ï¼Ÿ</h4><p>ç¬¬ä¸€ï¼Œå¿…é¡»<strong>åœ¨äº‹åŠ¡ä¸­ä½¿ç”¨</strong>ï¼Œå¦åˆ™é”ä¼šç«‹å³é‡Šæ”¾ã€‚</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">START</span> TRANSACTION;</span><br><span class="line"><span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> your_table <span class="keyword">WHERE</span> id <span class="operator">=</span> <span class="number">1</span> <span class="keyword">FOR</span> <span class="keyword">UPDATE</span>;</span><br><span class="line"><span class="comment">-- å¯¹è¯¥è¡Œè¿›è¡Œæ“ä½œ</span></span><br><span class="line"><span class="keyword">COMMIT</span>;</span><br></pre></td></tr></table></figure>
<p>ç¬¬äºŒï¼Œ<strong>ä½¿ç”¨æ—¶å¿…é¡»æ³¨æ„æ˜¯å¦å‘½ä¸­ç´¢å¼•</strong>ï¼Œå¦åˆ™å¯èƒ½é”å…¨è¡¨ã€‚</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- name æ²¡æœ‰ç´¢å¼•ï¼Œä¼šé€€åŒ–ä¸ºè¡¨é”</span></span><br><span class="line"><span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> <span class="keyword">user</span> <span class="keyword">WHERE</span> name <span class="operator">=</span> <span class="string">&#x27;çŽ‹äºŒ&#x27;</span> <span class="keyword">FOR</span> <span class="keyword">UPDATE</span>;</span><br></pre></td></tr></table></figure>
<p>â€”- è¿™éƒ¨åˆ†æ˜¯å¸®åŠ©ç†è§£ startï¼Œé¢è¯•ä¸­å¯ä¸èƒŒ â€”-</p>
<p>å‡è®¾æœ‰ä¸€å¼ åä¸º orders çš„è¡¨ï¼ŒåŒ…å«ä»¥ä¸‹æ•°æ®ï¼š</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">CREATE TABLE</span> orders (</span><br><span class="line">    id <span class="type">INT</span> <span class="keyword">PRIMARY KEY</span>,</span><br><span class="line">    order_no <span class="type">VARCHAR</span>(<span class="number">255</span>),</span><br><span class="line">    amount <span class="type">DECIMAL</span>(<span class="number">10</span>,<span class="number">2</span>),</span><br><span class="line">    status <span class="type">VARCHAR</span>(<span class="number">50</span>),</span><br><span class="line">    INDEX (order_no)  <span class="comment">-- order_no ä¸Šæœ‰ç´¢å¼•</span></span><br><span class="line">);</span><br></pre></td></tr></table></figure>
<p>è¡¨ä¸­çš„æ•°æ®æ˜¯è¿™æ ·çš„ï¼š</p>
<p><img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="https://cdn.jsdelivr.net/gh/JakicDong/blog-assets@main/images/20250625104220.png" alt="20250625104220"><br>å¦‚æžœæˆ‘ä»¬é€šè¿‡ä¸»é”®ç´¢å¼•æ‰§è¡Œ <code>SELECT FOR UPDATE</code>ï¼Œç¡®å®žåªä¼šé”å®šç‰¹å®šçš„è¡Œï¼š</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">START</span> TRANSACTION;</span><br><span class="line"><span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> orders <span class="keyword">WHERE</span> id <span class="operator">=</span> <span class="number">1</span> <span class="keyword">FOR</span> <span class="keyword">UPDATE</span>;</span><br><span class="line"><span class="comment">-- å¯¹ id=1 çš„è¡Œè¿›è¡Œæ“ä½œ</span></span><br><span class="line"><span class="keyword">COMMIT</span>;</span><br></pre></td></tr></table></figure>
<p>ç”±äºŽ id æ˜¯ä¸»é”®ï¼Œæ‰€ä»¥åªä¼šé”å®š id&#x3D;1 è¿™è¡Œï¼Œä¸ä¼šå½±å“å…¶ä»–è¡Œçš„æ“ä½œã€‚å…¶ä»–äº‹åŠ¡ä¾ç„¶å¯ä»¥å¯¹ id &#x3D; 2, 3, 4, 5 ç­‰è¡Œæ‰§è¡Œæ›´æ–°æ“ä½œï¼Œå› ä¸ºå®ƒä»¬æ²¡æœ‰è¢«é”å®šã€‚<br>å¦‚æžœä½¿ç”¨ order_no è¿™ä¸ªæ™®é€šç´¢å¼•æ‰§è¡Œ SELECT FOR UPDATEï¼Œä¹Ÿåªä¼šé”å®šç‰¹å®šçš„è¡Œï¼š</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">START</span> TRANSACTION;</span><br><span class="line"><span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> orders <span class="keyword">WHERE</span> order_no <span class="operator">=</span> <span class="string">&#x27;10001&#x27;</span> <span class="keyword">FOR</span> <span class="keyword">UPDATE</span>;</span><br><span class="line"><span class="comment">-- å¯¹ order_no=10001 çš„è¡Œè¿›è¡Œæ“ä½œ</span></span><br><span class="line"><span class="keyword">COMMIT</span>;</span><br></pre></td></tr></table></figure>
<p>å› ä¸º order_no æ˜¯å”¯ä¸€ç´¢å¼•ï¼Œæ‰€ä»¥åªä¼šé”å®š order_no&#x3D;10001 è¿™è¡Œï¼Œä¸ä¼šå½±å“å…¶ä»–è¡Œçš„æ“ä½œã€‚</p>
<p>ä½†å¦‚æžœ WHERE æ¡ä»¶æ˜¯ status&#x3D;â€™pendingâ€™ï¼Œè€Œ status ä¸Šæ²¡æœ‰ç´¢å¼•ï¼š</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">START</span> TRANSACTION;</span><br><span class="line"><span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> orders <span class="keyword">WHERE</span> status <span class="operator">=</span> <span class="string">&#x27;pending&#x27;</span> <span class="keyword">FOR</span> <span class="keyword">UPDATE</span>;</span><br><span class="line"><span class="comment">-- å¯¹ status=pending çš„è¡Œè¿›è¡Œæ“ä½œ</span></span><br><span class="line"><span class="keyword">COMMIT</span>;</span><br></pre></td></tr></table></figure>
<p>å°±ä¼šé€€åŒ–ä¸ºè¡¨é”ï¼Œå› ä¸ºåœ¨è¿™ç§æƒ…å†µä¸‹ï¼ŒMySQL éœ€è¦å…¨è¡¨æ‰«ææ£€æŸ¥æ¯ä¸€è¡Œçš„ statusã€‚</p>
<p>â€”- è¿™éƒ¨åˆ†æ˜¯å¸®åŠ©ç†è§£ endï¼Œé¢è¯•ä¸­å¯ä¸èƒŒ â€”-</p>
<h4 id="è¯´è¯´è®°å½•é”å§ï¼Ÿ"><a href="#è¯´è¯´è®°å½•é”å§ï¼Ÿ" class="headerlink" title="è¯´è¯´è®°å½•é”å§ï¼Ÿ"></a>è¯´è¯´è®°å½•é”å§ï¼Ÿ</h4><p><strong>è®°å½•é”</strong>æ˜¯è¡Œé”æœ€åŸºæœ¬çš„è¡¨çŽ°å½¢å¼ï¼Œå½“æˆ‘ä»¬<strong>ä½¿ç”¨å”¯ä¸€ç´¢å¼•æˆ–è€…ä¸»é”®ç´¢å¼•è¿›è¡Œç­‰å€¼æŸ¥è¯¢æ—¶</strong>ï¼ŒMySQL ä¼šä¸ºè¯¥è®°å½•<strong>è‡ªåŠ¨æ·»åŠ æŽ’ä»–é”</strong>ï¼Œ<strong>ç¦æ­¢å…¶ä»–äº‹åŠ¡è¯»å–æˆ–è€…ä¿®æ”¹é”å®šè®°å½•</strong>ã€‚</p>
<p><img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="https://cdn.jsdelivr.net/gh/JakicDong/blog-assets@main/images/20250625105204.png" alt="20250625105204"></p>
<p>ä¾‹å¦‚ï¼š</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> <span class="keyword">table</span> <span class="keyword">WHERE</span> id <span class="operator">=</span> <span class="number">1</span> <span class="keyword">FOR</span> <span class="keyword">UPDATE</span>;  <span class="comment">-- åŠ Xé”</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">UPDATE</span> <span class="keyword">table</span> <span class="keyword">SET</span> name <span class="operator">=</span> <span class="string">&#x27;çŽ‹äºŒ&#x27;</span> <span class="keyword">WHERE</span> id <span class="operator">=</span> <span class="number">1</span>; <span class="comment">-- éšå¼åŠ Xé”</span></span><br></pre></td></tr></table></figure>
<h4 id="é—´éš™é”äº†è§£å—ï¼Ÿ"><a href="#é—´éš™é”äº†è§£å—ï¼Ÿ" class="headerlink" title="é—´éš™é”äº†è§£å—ï¼Ÿ"></a>é—´éš™é”äº†è§£å—ï¼Ÿ</h4><p>é—´éš™é”ç”¨äºŽåœ¨<strong>èŒƒå›´æŸ¥è¯¢æ—¶é”å®šè®°å½•ä¹‹é—´çš„â€œé—´éš™â€</strong>ï¼Œ<strong>é˜²æ­¢å…¶ä»–äº‹åŠ¡åœ¨è¯¥èŒƒå›´å†…æ’å…¥æ–°è®°å½•</strong>ã€‚ä»…åœ¨å¯é‡å¤è¯»åŠä»¥ä¸Šçš„éš”ç¦»çº§åˆ«ä¸‹ç”Ÿæ•ˆï¼Œä¸»è¦ç”¨äºŽé˜²æ­¢å¹»è¯»ã€‚</p>
<p><img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="https://cdn.jsdelivr.net/gh/JakicDong/blog-assets@main/images/20250625105253.png" alt="20250625105253"></p>
<p>â€”- è¿™éƒ¨åˆ†æ˜¯å¸®åŠ©å¤§å®¶ç†è§£ startï¼Œé¢è¯•ä¸­å¯ä¸èƒŒ â€”-</p>
<p>ä¾‹å¦‚äº‹åŠ¡ A é”å®šäº†Â <code>(1000,2000)</code>Â åŒºé—´ï¼Œä¼šé˜»æ­¢äº‹åŠ¡ B åœ¨æ­¤åŒºé—´æ’å…¥æ–°è®°å½•ï¼š</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- äº‹åŠ¡A</span></span><br><span class="line"><span class="keyword">BEGIN</span>;</span><br><span class="line"><span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> orders <span class="keyword">WHERE</span> amount <span class="keyword">BETWEEN</span> <span class="number">1000</span> <span class="keyword">AND</span> <span class="number">2000</span> <span class="keyword">FOR</span> <span class="keyword">UPDATE</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- äº‹åŠ¡Bå°è¯•æ’å…¥ä¼šè¢«é˜»å¡ž</span></span><br><span class="line"><span class="keyword">INSERT INTO</span> orders <span class="keyword">VALUES</span>(<span class="keyword">null</span>,<span class="number">1500</span>,<span class="string">&#x27;pending&#x27;</span>);  <span class="comment">-- é˜»å¡ž&lt;/code&gt;</span></span><br></pre></td></tr></table></figure>
<p>å‡è®¾è¡¨ test_gaplock æœ‰ idã€ageã€name ä¸‰ä¸ªå­—æ®µï¼Œå…¶ä¸­ id æ˜¯ä¸»é”®ï¼Œage ä¸Šæœ‰ç´¢å¼•ï¼Œå¹¶æ’å…¥äº† 4 æ¡æ•°æ®ã€‚</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">CREATE TABLE</span> `test_gaplock` (</span><br><span class="line"> `id` <span class="type">int</span>(<span class="number">11</span>) <span class="keyword">NOT NULL</span>,</span><br><span class="line"> `age` <span class="type">int</span>(<span class="number">11</span>) <span class="keyword">DEFAULT</span> <span class="keyword">NULL</span>,</span><br><span class="line"> `name` <span class="type">varchar</span>(<span class="number">20</span>) <span class="keyword">DEFAULT</span> <span class="keyword">NULL</span>,</span><br><span class="line"> <span class="keyword">PRIMARY KEY</span> (`id`),</span><br><span class="line"> KEY `age` (`age`)</span><br><span class="line">) ENGINE<span class="operator">=</span>InnoDB;</span><br><span class="line"></span><br><span class="line"><span class="keyword">insert into</span> test_gaplock <span class="keyword">values</span>(<span class="number">1</span>,<span class="number">1</span>,<span class="string">&#x27;å¼ ä¸‰&#x27;</span>),(<span class="number">6</span>,<span class="number">6</span>,<span class="string">&#x27;å´è€äºŒ&#x27;</span>),(<span class="number">8</span>,<span class="number">8</span>,<span class="string">&#x27;èµµå››&#x27;</span>),(<span class="number">12</span>,<span class="number">12</span>,<span class="string">&#x27;ç†Šå¤§&#x27;</span>);</span><br></pre></td></tr></table></figure>
<p>é—´éš™é”ä¼šé”ä½ï¼š</p>
<ul>
<li><code>(âˆ’âˆž, 1)</code>ï¼šæœ€å°è®°å½•ä¹‹å‰çš„é—´éš™ã€‚</li>
<li><code>(1, 6)ã€(6, 8)ã€(8, 12)</code>ï¼šè®°å½•ä¹‹é—´çš„é—´éš™ã€‚</li>
<li><code>(12, +âˆž)</code>ï¼šæœ€å¤§è®°å½•ä¹‹åŽçš„é—´éš™ã€‚</li>
</ul>
<p><img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="https://cdn.jsdelivr.net/gh/JakicDong/blog-assets@main/images/20250625110538.png" alt="20250625110538"></p>
<p>å‡è®¾æœ‰ä¸¤ä¸ªäº‹åŠ¡ï¼ŒT1 æ‰§è¡Œä»¥ä¸‹è¯­å¥ï¼š</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">START</span> TRANSACTION;</span><br><span class="line"><span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> test_gaplock <span class="keyword">WHERE</span> age <span class="operator">&gt;</span> <span class="number">5</span> <span class="keyword">FOR</span> <span class="keyword">UPDATE</span>;</span><br></pre></td></tr></table></figure>

<p>T2 æ‰§è¡Œä»¥ä¸‹è¯­å¥ï¼š</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">START</span> TRANSACTION;</span><br><span class="line"><span class="keyword">INSERT INTO</span> test_gaplock <span class="keyword">VALUES</span> (<span class="number">7</span>, <span class="number">7</span>, <span class="string">&#x27;çŽ‹äº”&#x27;</span>);</span><br></pre></td></tr></table></figure>
<p>T1 ä¼šé”ä½ <code>(6, 8)</code> çš„é—´éš™ï¼Œé˜²æ­¢å…¶ä»–äº‹åŠ¡åœ¨è¿™ä¸ªèŒƒå›´å†…æ’å…¥æ–°è®°å½•ã€‚</p>
<p>T2 åœ¨æ’å…¥ <code>(7, 7, &#39;çŽ‹äº”&#39;)</code> æ—¶ï¼Œä¼šè¢«é˜»å¡žï¼Œå¯ä»¥åœ¨å¦å¤–ä¸€ä¸ªä¼šè¯ä¸­æ‰§è¡Œ <code>SHOW ENGINE INNODB STATUS</code> æŸ¥çœ‹åˆ°é—´éš™é”çš„ä¿¡æ¯ã€‚<br><img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="https://cdn.jsdelivr.net/gh/JakicDong/blog-assets@main/images/20250625112428.png" alt="20250625112428"></p>
<h4 id="æ‰§è¡Œä»€ä¹ˆå‘½ä»¤ä¼šåŠ ä¸Šé—´éš™é”ï¼Ÿ"><a href="#æ‰§è¡Œä»€ä¹ˆå‘½ä»¤ä¼šåŠ ä¸Šé—´éš™é”ï¼Ÿ" class="headerlink" title="æ‰§è¡Œä»€ä¹ˆå‘½ä»¤ä¼šåŠ ä¸Šé—´éš™é”ï¼Ÿ"></a>æ‰§è¡Œä»€ä¹ˆå‘½ä»¤ä¼šåŠ ä¸Šé—´éš™é”ï¼Ÿ</h4><p>åœ¨å¯é‡å¤è¯»éš”ç¦»çº§åˆ«ä¸‹ï¼Œæ‰§è¡Œ<code>FOR UPDATE / LOCK IN SHARE MODE</code>ç­‰åŠ é”è¯­å¥ï¼Œä¸”<strong>æŸ¥è¯¢æ¡ä»¶æ˜¯èŒƒå›´æŸ¥è¯¢</strong>æ—¶ï¼Œå°±ä¼šè‡ªåŠ¨åŠ ä¸Šé—´éš™é”ã€‚</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- SELECT ... FOR UPDATE + èŒƒå›´æŸ¥è¯¢</span></span><br><span class="line"><span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> <span class="keyword">user</span> <span class="keyword">WHERE</span> score <span class="operator">&gt;</span> <span class="number">100</span> <span class="keyword">FOR</span> <span class="keyword">UPDATE</span>;</span><br><span class="line"><span class="comment">-- SELECT ... LOCK IN SHARE MODE + èŒƒå›´æŸ¥è¯¢</span></span><br><span class="line"><span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> <span class="keyword">user</span> <span class="keyword">WHERE</span> id <span class="keyword">BETWEEN</span> <span class="number">10</span> <span class="keyword">AND</span> <span class="number">20</span> LOCK <span class="keyword">IN</span> SHARE MODE;</span><br><span class="line"><span class="comment">-- UPDATE/DELETE + èŒƒå›´æŸ¥è¯¢</span></span><br><span class="line"><span class="keyword">DELETE</span> <span class="keyword">FROM</span> <span class="keyword">user</span> <span class="keyword">WHERE</span> score <span class="operator">&lt;</span> <span class="number">50</span>;</span><br></pre></td></tr></table></figure>


<h3 id="58-ðŸŒŸMySQLçš„ä¹è§‚é”å’Œæ‚²è§‚é”äº†è§£å—ï¼Ÿ"><a href="#58-ðŸŒŸMySQLçš„ä¹è§‚é”å’Œæ‚²è§‚é”äº†è§£å—ï¼Ÿ" class="headerlink" title="58.ðŸŒŸMySQLçš„ä¹è§‚é”å’Œæ‚²è§‚é”äº†è§£å—ï¼Ÿ"></a>58.ðŸŒŸMySQLçš„ä¹è§‚é”å’Œæ‚²è§‚é”äº†è§£å—ï¼Ÿ</h3><p>æ‚²è§‚é”æ˜¯ä¸€ç§â€å…ˆä¸Šé”å†æ“ä½œâ€çš„ä¿å®ˆç­–ç•¥ï¼Œå®ƒå‡è®¾æ•°æ®è¢«å¤–ç•Œè®¿é—®æ—¶å¿…ç„¶ä¼šäº§ç”Ÿå†²çªï¼Œå› æ­¤åœ¨æ•°æ®å¤„ç†è¿‡ç¨‹ä¸­å…¨ç¨‹åŠ é”ï¼Œä¿è¯åŒä¸€æ—¶é—´åªæœ‰ä¸€ä¸ªçº¿ç¨‹å¯ä»¥è®¿é—®æ•°æ®ã€‚</p>
<p><img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="https://cdn.jsdelivr.net/gh/JakicDong/blog-assets@main/images/20251011152502.png" alt="20251011152502"><br>ç‰§å°å†œï¼šæ‚²è§‚é”</p>
<p>MySQL ä¸­çš„è¡Œé”å’Œè¡¨é”éƒ½æ˜¯æ‚²è§‚é”ã€‚</p>
<p><img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="https://cdn.jsdelivr.net/gh/JakicDong/blog-assets@main/images/20251011152533.png" alt="20251011152533"><br>ç‰§å°å†œï¼šæ‚²è§‚é”çš„å¤„ç†æ€è·¯</p>
<p>ä¹è§‚é”ä¼šå‡è®¾å¹¶å‘æ“ä½œä¸ä¼šæ€»å‘ç”Ÿå†²çªï¼Œå±žäºŽå°æ¦‚çŽ‡äº‹ä»¶ï¼Œå› æ­¤ä¸ä¼šåœ¨è¯»å–æ•°æ®æ—¶åŠ é”ï¼Œè€Œæ˜¯åœ¨æäº¤æ›´æ–°æ—¶æ‰æ£€æŸ¥æ•°æ®æ˜¯å¦è¢«å…¶ä»–äº‹åŠ¡ä¿®æ”¹è¿‡ã€‚</p>
<p><img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="https://cdn.jsdelivr.net/gh/JakicDong/blog-assets@main/images/20251011152635.png" alt="20251011152635"><br>ç‰§å°å†œï¼šä¹è§‚é”</p>
<p>ä¹è§‚é”å¹¶ä¸æ˜¯ MySQL å†…ç½®çš„é”æœºåˆ¶ï¼Œè€Œæ˜¯é€šè¿‡ç¨‹åºé€»è¾‘å®žçŽ°çš„ï¼Œå¸¸è§çš„å®žçŽ°æ–¹å¼æœ‰ç‰ˆæœ¬å·æœºåˆ¶å’Œæ—¶é—´æˆ³æœºåˆ¶ã€‚é€šè¿‡åœ¨è¡¨ä¸­å¢žåŠ  version å­—æ®µæˆ–è€… timestamp å­—æ®µæ¥å®žçŽ°ã€‚</p>
<p>-â€” è¿™éƒ¨åˆ†æ˜¯å¸®åŠ©å¤§å®¶ç†è§£ startï¼Œé¢è¯•ä¸­å¯ä¸èƒŒ â€”-</p>
<p>å½“äº‹åŠ¡ A å·²ç»ä¸Šé”åŽï¼Œäº‹åŠ¡ B ä¼šä¸€ç›´ç­‰å¾…äº‹åŠ¡ A é‡Šæ”¾é”ï¼›å¦‚æžœäº‹åŠ¡ A é•¿æ—¶é—´ä¸é‡Šæ”¾é”ï¼Œäº‹åŠ¡ B å°±ä¼šæŠ¥é”™ <code>Lock wait timeout exceeded; try restarting transaction</code>ã€‚</p>
<p><img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="https://cdn.jsdelivr.net/gh/JakicDong/blog-assets@main/images/20251011152707.png" alt="20251011152707"><br>ç‰§å°å†œï¼šçš„å®žçŽ°æ–¹å¼</p>
<p>äº‹åŠ¡ A å’Œäº‹åŠ¡ B åŒæ—¶è¯»å–åŒä¸€ä¸ªä¸»é”® ID çš„æ•°æ®ï¼Œç‰ˆæœ¬å·ä¸º 0ï¼›äº‹åŠ¡ A å°†ç‰ˆæœ¬å·ï¼ˆversion&#x3D;1ï¼‰ä½œä¸ºæ¡ä»¶è¿›è¡Œæ•°æ®æ›´æ–°ï¼ŒåŒæ—¶ç‰ˆæœ¬å· +1ï¼›äº‹åŠ¡ B ä¹Ÿå°† version&#x3D;1 ä½œä¸ºæ›´æ–°æ¡ä»¶ï¼Œå‘çŽ°ç‰ˆæœ¬å·ä¸åŒ¹é…ï¼Œæ›´æ–°å¤±è´¥ã€‚</p>
<p><img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="https://cdn.jsdelivr.net/gh/JakicDong/blog-assets@main/images/20251011152751.png" alt="20251011152751"><br>ç‰§å°å†œï¼šä¹è§‚é”çš„å®žçŽ°æ–¹å¼</p>
<p>-â€” è¿™éƒ¨åˆ†æ˜¯å¸®åŠ©å¤§å®¶ç†è§£ endï¼Œé¢è¯•ä¸­å¯ä¸èƒŒ â€”-</p>
<h4 id="å¦‚ä½•é€šè¿‡æ‚²è§‚é”å’Œä¹è§‚é”è§£å†³åº“å­˜è¶…å–é—®é¢˜ï¼Ÿ"><a href="#å¦‚ä½•é€šè¿‡æ‚²è§‚é”å’Œä¹è§‚é”è§£å†³åº“å­˜è¶…å–é—®é¢˜ï¼Ÿ" class="headerlink" title="å¦‚ä½•é€šè¿‡æ‚²è§‚é”å’Œä¹è§‚é”è§£å†³åº“å­˜è¶…å–é—®é¢˜ï¼Ÿ"></a>å¦‚ä½•é€šè¿‡æ‚²è§‚é”å’Œä¹è§‚é”è§£å†³åº“å­˜è¶…å–é—®é¢˜ï¼Ÿ</h4><p>æ‚²è§‚é”é€šè¿‡ <code>SELECT ... FOR UPDATE</code> åœ¨æŸ¥è¯¢æ—¶ç›´æŽ¥é”å®šè®°å½•ï¼Œç¡®ä¿å…¶ä»–äº‹åŠ¡å¿…é¡»ç­‰å¾…å½“å‰äº‹åŠ¡å®Œæˆæ‰èƒ½æ“ä½œè¯¥è¡Œæ•°æ®ã€‚</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">BEGIN</span>;</span><br><span class="line"><span class="comment">-- å¯¹id=1çš„å•†å“è®°å½•åŠ æŽ’ä»–é”</span></span><br><span class="line"><span class="keyword">SELECT</span> stock <span class="keyword">FROM</span> products <span class="keyword">WHERE</span> id<span class="operator">=</span><span class="number">1</span> <span class="keyword">FOR</span> <span class="keyword">UPDATE</span>;</span><br><span class="line"><span class="comment">-- ç”Ÿæˆè®¢å•</span></span><br><span class="line"><span class="keyword">INSERT INTO</span> orders (user_id, product_id) <span class="keyword">VALUES</span> (<span class="number">123</span>, <span class="number">1</span>);</span><br><span class="line"><span class="comment">-- æ‰£å‡åº“å­˜</span></span><br><span class="line"><span class="keyword">UPDATE</span> products <span class="keyword">SET</span> stock<span class="operator">=</span>stock<span class="number">-1</span> <span class="keyword">WHERE</span> id<span class="operator">=</span><span class="number">1</span>;</span><br><span class="line"><span class="keyword">COMMIT</span>;</span><br></pre></td></tr></table></figure>

<p>ä¹è§‚é”é€šè¿‡åœ¨è¡¨ä¸­å¢žåŠ  version å­—æ®µä½œä¸ºåˆ¤æ–­æ¡ä»¶ã€‚</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- æŸ¥è¯¢å•†å“ä¿¡æ¯ï¼ŒèŽ·å–ç‰ˆæœ¬å·</span></span><br><span class="line"><span class="keyword">SELECT</span> stock, version <span class="keyword">FROM</span> products <span class="keyword">WHERE</span> id<span class="operator">=</span><span class="number">1</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- æ›´æ–°åº“å­˜æ—¶æ£€æŸ¥ç‰ˆæœ¬å·</span></span><br><span class="line"><span class="keyword">UPDATE</span> products </span><br><span class="line"><span class="keyword">SET</span> stock<span class="operator">=</span>stock<span class="number">-1</span>, version<span class="operator">=</span>version<span class="operator">+</span><span class="number">1</span> </span><br><span class="line"><span class="keyword">WHERE</span> id<span class="operator">=</span><span class="number">1</span> <span class="keyword">AND</span> version<span class="operator">=</span>æ—§ç‰ˆæœ¬å·;</span><br></pre></td></tr></table></figure>

<p>-â€” è¿™éƒ¨åˆ†æ˜¯å¸®åŠ©å¤§å®¶ç†è§£ startï¼Œé¢è¯•ä¸­å¯ä¸èƒŒ â€”-</p>
<p>åº“å­˜è¶…å–æ˜¯ä¸€ä¸ªéžå¸¸ç»å…¸çš„é—®é¢˜ï¼š</p>
<ul>
<li>äº‹åŠ¡AæŸ¥è¯¢å•†å“åº“å­˜ï¼Œå¾—åˆ°åº“å­˜å€¼ä¸º1</li>
<li>äº‹åŠ¡Bä¹ŸæŸ¥è¯¢åŒä¸€å•†å“åº“å­˜ï¼ŒåŒæ ·å¾—åˆ°åº“å­˜å€¼ä¸º1</li>
<li>äº‹åŠ¡AåŸºäºŽæŸ¥è¯¢ç»“æžœæ‰§è¡Œåº“å­˜æ‰£å‡ï¼Œå°†åº“å­˜æ›´æ–°ä¸º0</li>
<li>äº‹åŠ¡Bä¹Ÿæ‰§è¡Œåº“å­˜æ‰£å‡ï¼Œå°†åº“å­˜æ›´æ–°ä¸º-1</li>
</ul>
<p>æ‚²è§‚é”çš„å…³é”®ç‚¹ï¼š</p>
<ul>
<li>å¿…é¡»åœ¨ä¸€ä¸ªäº‹åŠ¡ä¸­æ‰§è¡Œï¼›</li>
<li>é€šè¿‡ <code>SELECT ... FOR UPDATE</code> é”å®šè¡Œï¼Œç¡®ä¿å…¶ä»–äº‹åŠ¡å¿…é¡»ç­‰å¾…å½“å‰äº‹åŠ¡å®Œæˆæ‰èƒ½æ“ä½œè¯¥è¡Œæ•°æ®ï¼›</li>
<li>è®°å¾—ç»™æŸ¥è¯¢æ¡ä»¶åŠ ç´¢å¼•ï¼Œé¿å…å…¨è¡¨æ‰«æå¯¼è‡´é”å‡çº§ä¸ºè¡¨é”ã€‚</li>
</ul>
<p>ä¹è§‚é”çš„å…³é”®ç‚¹ï¼š</p>
<ul>
<li>åœ¨è¡¨ä¸­å¢žåŠ  version å­—æ®µï¼›</li>
<li>æŸ¥è¯¢æ—¶èŽ·å–å½“å‰ç‰ˆæœ¬å·ï¼›</li>
<li>æ›´æ–°æ—¶æ£€æŸ¥ç‰ˆæœ¬å·æ˜¯å¦å‘ç”Ÿäº†å˜åŒ–ã€‚</li>
</ul>
<p>Java ç¨‹åºçš„å®Œæ•´ä»£ç ç¤ºä¾‹ï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Service</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ProductService</span> &#123;</span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> ProductMapper productMapper;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@Transactional</span></span><br><span class="line">    <span class="keyword">public</span> <span class="type">boolean</span> <span class="title function_">purchaseWithOptimisticLock</span><span class="params">(Long productId, <span class="type">int</span> quantity)</span> &#123;</span><br><span class="line">        <span class="type">int</span> <span class="variable">retryCount</span> <span class="operator">=</span> <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">while</span>(retryCount &lt; <span class="number">3</span>) &#123; <span class="comment">// æœ€å¤§é‡è¯•æ¬¡æ•°</span></span><br><span class="line">            <span class="type">Product</span> <span class="variable">product</span> <span class="operator">=</span> productMapper.selectById(productId);</span><br><span class="line">            <span class="keyword">if</span>(product.getStock() &lt; quantity) &#123;</span><br><span class="line">                <span class="keyword">return</span> <span class="literal">false</span>; <span class="comment">// åº“å­˜ä¸è¶³</span></span><br><span class="line">            &#125;</span><br><span class="line">            </span><br><span class="line">            <span class="type">int</span> <span class="variable">updated</span> <span class="operator">=</span> productMapper.reduceStockWithVersion(</span><br><span class="line">                productId, quantity, product.getVersion());</span><br><span class="line">                </span><br><span class="line">            <span class="keyword">if</span>(updated &gt; <span class="number">0</span>) &#123;</span><br><span class="line">                <span class="keyword">return</span> <span class="literal">true</span>; <span class="comment">// æ›´æ–°æˆåŠŸ</span></span><br><span class="line">            &#125;</span><br><span class="line">            retryCount++;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">false</span>; <span class="comment">// æ›´æ–°å¤±è´¥</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>å¯¹åº”çš„ mapperï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Update(&quot;UPDATE products SET stock=stock-#&#123;quantity&#125;, version=version+1 &quot; +</span></span><br><span class="line"><span class="meta">        &quot;WHERE id=#&#123;productId&#125; AND version=#&#123;version&#125;&quot;)</span></span><br><span class="line"><span class="type">int</span> <span class="title function_">reduceStockWithVersion</span><span class="params">(<span class="meta">@Param(&quot;productId&quot;)</span> Long productId, </span></span><br><span class="line"><span class="params">                          <span class="meta">@Param(&quot;quantity&quot;)</span> <span class="type">int</span> quantity,</span></span><br><span class="line"><span class="params">                          <span class="meta">@Param(&quot;version&quot;)</span> <span class="type">int</span> version)</span>;</span><br></pre></td></tr></table></figure>

<p>æ—¶é—´æˆ³æœºåˆ¶å®žçŽ°çš„ä¹è§‚é”ï¼š</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">UPDATE</span> products <span class="keyword">SET</span> stock<span class="operator">=</span>stock<span class="number">-1</span>, update_time<span class="operator">=</span>NOW() </span><br><span class="line"><span class="keyword">WHERE</span> id<span class="operator">=</span><span class="number">1</span> <span class="keyword">AND</span> update_time<span class="operator">=</span>æ—§æ—¶é—´æˆ³;</span><br></pre></td></tr></table></figure>

<p>è¿™ä¸¤ç§æ–¹å¼éƒ½éœ€è¦ä¿è¯æ“ä½œçš„åŽŸå­æ€§ï¼Œéœ€è¦å°†å¤šä¸ª SQL æ”¾åœ¨åŒä¸€ä¸ªäº‹åŠ¡ä¸­æ‰§è¡Œã€‚</p>
<p>æŽ¨èé˜…è¯»ï¼š<a target="_blank" rel="noopener" href="https://www.cnblogs.com/mingyueyy/p/13049431.html">ç‰§å°å†œï¼šæ‚²è§‚é”å’Œä¹è§‚é”</a></p>
<p>-â€” è¿™éƒ¨åˆ†æ˜¯å¸®åŠ©å¤§å®¶ç†è§£ endï¼Œé¢è¯•ä¸­å¯ä¸èƒŒ â€”-</p>
<h3 id="60-ðŸŒŸMySQLäº‹åŠ¡çš„å››å¤§ç‰¹æ€§è¯´ä¸€ä¸‹ï¼Ÿ"><a href="#60-ðŸŒŸMySQLäº‹åŠ¡çš„å››å¤§ç‰¹æ€§è¯´ä¸€ä¸‹ï¼Ÿ" class="headerlink" title="60.ðŸŒŸMySQLäº‹åŠ¡çš„å››å¤§ç‰¹æ€§è¯´ä¸€ä¸‹ï¼Ÿ"></a>60.ðŸŒŸMySQLäº‹åŠ¡çš„å››å¤§ç‰¹æ€§è¯´ä¸€ä¸‹ï¼Ÿ</h3><p>äº‹åŠ¡æ˜¯ä¸€æ¡æˆ–å¤šæ¡ SQL è¯­å¥ç»„æˆçš„æ‰§è¡Œå•å…ƒã€‚å››ä¸ªç‰¹æ€§åˆ†åˆ«æ˜¯åŽŸå­æ€§ã€ä¸€è‡´æ€§ã€éš”ç¦»æ€§å’ŒæŒä¹…æ€§ã€‚åŽŸå­æ€§ä¿è¯äº‹åŠ¡ä¸­çš„æ“ä½œè¦ä¹ˆå…¨éƒ¨æ‰§è¡Œã€è¦ä¹ˆå…¨éƒ¨å¤±è´¥ï¼›ä¸€è‡´æ€§ä¿è¯æ•°æ®ä»Žäº‹åŠ¡å¼€å§‹å‰çš„ä¸€ä¸ªä¸€è‡´çŠ¶æ€è½¬ç§»åˆ°ç»“æŸåŽçš„å¦å¤–ä¸€ä¸ªä¸€è‡´çŠ¶æ€ï¼›éš”ç¦»æ€§ä¿è¯å¹¶å‘äº‹åŠ¡ä¹‹é—´äº’ä¸å¹²æ‰°ï¼›æŒä¹…æ€§ä¿è¯äº‹åŠ¡æäº¤åŽæ•°æ®ä¸ä¼šä¸¢å¤±ã€‚</p>
<p><img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="https://cdn.jsdelivr.net/gh/JakicDong/blog-assets@main/images/20251011155649.png" alt="20251011155649"><br>åŒ—é‡Žæ–°æ´¥ï¼šACID</p>
<h4 id="è¯¦ç»†è¯´ä¸€ä¸‹åŽŸå­æ€§ï¼Ÿ"><a href="#è¯¦ç»†è¯´ä¸€ä¸‹åŽŸå­æ€§ï¼Ÿ" class="headerlink" title="è¯¦ç»†è¯´ä¸€ä¸‹åŽŸå­æ€§ï¼Ÿ"></a>è¯¦ç»†è¯´ä¸€ä¸‹åŽŸå­æ€§ï¼Ÿ</h4><p>åŽŸå­æ€§æ„å‘³ç€äº‹åŠ¡ä¸­çš„æ‰€æœ‰æ“ä½œè¦ä¹ˆå…¨éƒ¨å®Œæˆï¼Œè¦ä¹ˆå…¨éƒ¨ä¸å®Œæˆï¼Œå®ƒæ˜¯ä¸å¯åˆ†å‰²çš„å•ä½ã€‚å¦‚æžœäº‹åŠ¡ä¸­çš„ä»»ä½•ä¸€ä¸ªæ“ä½œå¤±è´¥äº†ï¼Œæ•´ä¸ªäº‹åŠ¡éƒ½ä¼šå›žæ»šåˆ°äº‹åŠ¡å¼€å§‹ä¹‹å‰çš„çŠ¶æ€ï¼Œå¦‚åŒè¿™äº›æ“ä½œä»Žæœªè¢«æ‰§è¡Œè¿‡ä¸€æ ·ã€‚</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">START</span> TRANSACTION;</span><br><span class="line"><span class="keyword">UPDATE</span> accounts <span class="keyword">SET</span> balance <span class="operator">=</span> balance <span class="operator">-</span> <span class="number">100</span> <span class="keyword">WHERE</span> user_id <span class="operator">=</span> <span class="number">1</span>;</span><br><span class="line"><span class="keyword">UPDATE</span> accounts <span class="keyword">SET</span> balance <span class="operator">=</span> balance <span class="operator">+</span> <span class="number">100</span> <span class="keyword">WHERE</span> user_id <span class="operator">=</span> <span class="number">2</span>;</span><br><span class="line"><span class="comment">-- å¦‚æžœç¬¬äºŒæ¡è¯­å¥å¤±è´¥ï¼Œç¬¬ä¸€æ¡ä¹Ÿä¼šå›žæ»š</span></span><br><span class="line"><span class="keyword">COMMIT</span>;</span><br></pre></td></tr></table></figure>

<p>ç®€çŸ­å›žç­”ï¼šåŽŸå­æ€§è¦æ±‚äº‹åŠ¡çš„æ‰€æœ‰æ“ä½œè¦ä¹ˆå…¨éƒ¨æäº¤æˆåŠŸï¼Œè¦ä¹ˆå…¨éƒ¨å¤±è´¥å›žæ»šï¼Œå¯¹äºŽä¸€ä¸ªäº‹åŠ¡ä¸­çš„æ“ä½œä¸èƒ½åªæ‰§è¡Œå…¶ä¸­ä¸€éƒ¨åˆ†ã€‚</p>
<h4 id="è¯¦ç»†è¯´ä¸€ä¸‹ä¸€è‡´æ€§ï¼Ÿ"><a href="#è¯¦ç»†è¯´ä¸€ä¸‹ä¸€è‡´æ€§ï¼Ÿ" class="headerlink" title="è¯¦ç»†è¯´ä¸€ä¸‹ä¸€è‡´æ€§ï¼Ÿ"></a>è¯¦ç»†è¯´ä¸€ä¸‹ä¸€è‡´æ€§ï¼Ÿ</h4><p>ä¸€è‡´æ€§ç¡®ä¿äº‹åŠ¡ä»Žä¸€ä¸ªä¸€è‡´çš„çŠ¶æ€è½¬æ¢åˆ°å¦ä¸€ä¸ªä¸€è‡´çš„çŠ¶æ€ã€‚</p>
<p>æ¯”å¦‚åœ¨é“¶è¡Œè½¬è´¦äº‹åŠ¡ä¸­ï¼Œæ— è®ºå‘ç”Ÿä»€ä¹ˆï¼Œè½¬è´¦å‰åŽä¸¤ä¸ªè´¦æˆ·çš„æ€»é‡‘é¢åº”ä¿æŒä¸å˜ã€‚å‡å¦‚ A è´¦æˆ·ï¼ˆ100 å—ï¼‰ç»™ B è´¦æˆ·ï¼ˆ10 å—ï¼‰è½¬äº† 10 å—é’±ï¼Œä¸ç®¡æˆåŠŸä¸Žå¦ï¼ŒA å’Œ B çš„æ€»é‡‘é¢éƒ½æ˜¯ 110 å—ã€‚</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- å‡è®¾ A è´¦æˆ·ä½™é¢ä¸º 100ï¼ŒB è´¦æˆ·ä½™é¢ä¸º 10</span></span><br><span class="line"></span><br><span class="line"><span class="comment">-- è½¬è´¦å‰çŠ¶æ€</span></span><br><span class="line"><span class="keyword">SELECT</span> balance <span class="keyword">FROM</span> accounts <span class="keyword">WHERE</span> user_id <span class="operator">=</span> <span class="string">&#x27;A&#x27;</span>; <span class="comment">-- 100</span></span><br><span class="line"><span class="keyword">SELECT</span> balance <span class="keyword">FROM</span> accounts <span class="keyword">WHERE</span> user_id <span class="operator">=</span> <span class="string">&#x27;B&#x27;</span>; <span class="comment">-- 10</span></span><br><span class="line"></span><br><span class="line"><span class="comment">-- è½¬è´¦æ“ä½œ</span></span><br><span class="line"><span class="keyword">START</span> TRANSACTION;</span><br><span class="line"><span class="keyword">UPDATE</span> accounts <span class="keyword">SET</span> balance <span class="operator">=</span> balance <span class="operator">-</span> <span class="number">10</span> <span class="keyword">WHERE</span> user_id <span class="operator">=</span> <span class="string">&#x27;A&#x27;</span>;</span><br><span class="line"><span class="keyword">UPDATE</span> accounts <span class="keyword">SET</span> balance <span class="operator">=</span> balance <span class="operator">+</span> <span class="number">10</span> <span class="keyword">WHERE</span> user_id <span class="operator">=</span> <span class="string">&#x27;B&#x27;</span>;</span><br><span class="line"><span class="keyword">COMMIT</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- è½¬è´¦åŽçŠ¶æ€</span></span><br><span class="line"><span class="keyword">SELECT</span> balance <span class="keyword">FROM</span> accounts <span class="keyword">WHERE</span> user_id <span class="operator">=</span> <span class="string">&#x27;A&#x27;</span>; <span class="comment">-- 90</span></span><br><span class="line"><span class="keyword">SELECT</span> balance <span class="keyword">FROM</span> accounts <span class="keyword">WHERE</span> user_id <span class="operator">=</span> <span class="string">&#x27;B&#x27;</span>; <span class="comment">-- 20`</span></span><br><span class="line"><span class="comment">-- æ€»é‡‘é¢ä»ç„¶æ˜¯ 110</span></span><br></pre></td></tr></table></figure>

<p>ç®€çŸ­å›žç­”ï¼šä¸€è‡´æ€§ç¡®ä¿æ•°æ®çš„çŠ¶æ€ä»Žä¸€ä¸ªä¸€è‡´çŠ¶æ€è½¬å˜ä¸ºå¦ä¸€ä¸ªä¸€è‡´çŠ¶æ€ã€‚ä¸€è‡´æ€§ä¸Žä¸šåŠ¡è§„åˆ™æœ‰å…³ï¼Œæ¯”å¦‚é“¶è¡Œè½¬è´¦ï¼Œä¸è®ºäº‹åŠ¡æˆåŠŸè¿˜æ˜¯å¤±è´¥ï¼Œè½¬è´¦åŒæ–¹çš„æ€»é‡‘é¢åº”è¯¥æ˜¯ä¸å˜çš„ã€‚</p>
<h4 id="è¯¦ç»†è¯´ä¸€ä¸‹éš”ç¦»æ€§ï¼Ÿ"><a href="#è¯¦ç»†è¯´ä¸€ä¸‹éš”ç¦»æ€§ï¼Ÿ" class="headerlink" title="è¯¦ç»†è¯´ä¸€ä¸‹éš”ç¦»æ€§ï¼Ÿ"></a>è¯¦ç»†è¯´ä¸€ä¸‹éš”ç¦»æ€§ï¼Ÿ</h4><p>éš”ç¦»æ€§æ„å‘³ç€å¹¶å‘æ‰§è¡Œçš„äº‹åŠ¡æ˜¯å½¼æ­¤éš”ç¦»çš„ï¼Œä¸€ä¸ªäº‹åŠ¡çš„æ‰§è¡Œä¸ä¼šè¢«å…¶ä»–äº‹åŠ¡å¹²æ‰°ã€‚äº‹åŠ¡ä¹‹é—´æ˜¯äº•æ°´ä¸çŠ¯æ²³æ°´çš„ã€‚</p>
<p>éš”ç¦»æ€§ä¸»è¦æ˜¯ä¸ºäº†è§£å†³äº‹åŠ¡å¹¶å‘æ‰§è¡Œæ—¶å¯èƒ½å‡ºçŽ°çš„è„è¯»ã€ä¸å¯é‡å¤è¯»ã€å¹»è¯»ç­‰é—®é¢˜ã€‚</p>
<p>-â€” è¿™éƒ¨åˆ†æ˜¯å¸®åŠ©å¤§å®¶ç†è§£ startï¼Œé¢è¯•ä¸­å¯ä¸èƒŒ â€”-</p>
<p>æ¯”å¦‚è¯´åœ¨è¯»æœªæäº¤çš„éš”ç¦»çº§åˆ«ä¸‹ï¼Œä¼šå‡ºçŽ°è„è¯»çŽ°è±¡ï¼šä¸€ä¸ªäº‹åŠ¡C è¯»å–äº†äº‹åŠ¡B å°šæœªæäº¤çš„ä¿®æ”¹æ•°æ®ã€‚å¦‚æžœäº‹åŠ¡B æœ€ç»ˆå›žæ»šï¼Œäº‹åŠ¡C è¯»å–çš„æ•°æ®å°±æ˜¯æ— æ•ˆçš„â€œè„æ•°æ®â€ã€‚</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- ä¼šè¯ A</span></span><br><span class="line"><span class="comment">-- åˆ›å»ºæ¨¡æ‹Ÿå¹¶å‘çš„æµ‹è¯•è¡¨</span></span><br><span class="line"><span class="keyword">DROP</span> <span class="keyword">TABLE</span> IF <span class="keyword">EXISTS</span> accounts;</span><br><span class="line"><span class="keyword">CREATE TABLE</span> accounts (</span><br><span class="line">    id <span class="type">INT</span> <span class="keyword">PRIMARY KEY</span> AUTO_INCREMENT,</span><br><span class="line">    name <span class="type">VARCHAR</span>(<span class="number">50</span>),</span><br><span class="line">    balance <span class="type">DECIMAL</span>(<span class="number">10</span>,<span class="number">2</span>)</span><br><span class="line">);</span><br><span class="line"></span><br><span class="line"><span class="comment">-- æ’å…¥æµ‹è¯•æ•°æ®</span></span><br><span class="line"><span class="keyword">INSERT INTO</span> accounts (name, balance) <span class="keyword">VALUES</span></span><br><span class="line">(<span class="string">&#x27;çŽ‹äºŒ&#x27;</span>, <span class="number">1000.00</span>),</span><br><span class="line">(<span class="string">&#x27;å¼ ä¸‰&#x27;</span>, <span class="number">2000.00</span>),</span><br><span class="line">(<span class="string">&#x27;æŽå››&#x27;</span>, <span class="number">3000.00</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">-- ä¼šè¯B ä¸­ï¼Œè®¾ç½®éš”ç¦»çº§åˆ«ä¸ºè¯»æœªæäº¤</span></span><br><span class="line"><span class="keyword">SET</span> SESSION TRANSACTION ISOLATION LEVEL READ UNCOMMITTED;</span><br><span class="line"><span class="keyword">START</span> TRANSACTION;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- åœ¨ä¼šè¯ B ä¸­æ›´æ–°æ•°æ®ä½†ä¸æäº¤</span></span><br><span class="line"><span class="keyword">UPDATE</span> accounts <span class="keyword">SET</span> balance <span class="operator">=</span> balance <span class="operator">-</span> <span class="number">500</span> <span class="keyword">WHERE</span> name<span class="operator">=</span><span class="string">&#x27;çŽ‹äºŒ&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- ä¼šè¯C æ˜¯è¯»ä¸ºæäº¤çº§åˆ«ï¼Œè¯»å–æ•°æ®ï¼Œå¾—åˆ° 500</span></span><br><span class="line"><span class="keyword">SET</span> SESSION TRANSACTION ISOLATION LEVEL READ UNCOMMITTED;</span><br><span class="line"><span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> accounts <span class="keyword">WHERE</span> name<span class="operator">=</span><span class="string">&#x27;çŽ‹äºŒ&#x27;</span>;</span><br><span class="line"><span class="comment">-- ç»§ç»­åˆ«çš„æ“ä½œï¼ŒåŸºäºŽ 500</span></span><br><span class="line"></span><br><span class="line"><span class="comment">-- ä¼šè¯ B çš„äº‹åŠ¡å›žæ»šï¼Œå¯¼è‡´ä¼šè¯ A è¯»åˆ°çš„æ•°æ®å…¶å®žæ˜¯è„æ•°æ®</span></span><br><span class="line"><span class="keyword">ROLLBACK</span>;</span><br></pre></td></tr></table></figure>

<p><img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="https://cdn.jsdelivr.net/gh/JakicDong/blog-assets@main/images/20251011160550.png" alt="20251011160550"><br>äºŒå“¥çš„ Java è¿›é˜¶ä¹‹è·¯ï¼šè¯»æœªæäº¤ä¸‹å‡ºçŽ°è„è¯»</p>
<p>é€šè¿‡å‡çº§éš”ç¦»çº§åˆ«ä¸ºè¯»å·²æäº¤å¯ä»¥è§£å†³è„è¯»çš„é—®é¢˜ã€‚</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- ä¼šè¯ B ä¿®æ”¹ä¸ºè¯»å·²æäº¤</span></span><br><span class="line"><span class="keyword">SET</span> SESSION TRANSACTION ISOLATION LEVEL READ COMMITTED;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- æ‰§è¡Œç¬¬ä¸€æ¬¡æŸ¥è¯¢ 1000</span></span><br><span class="line"><span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> accounts <span class="keyword">WHERE</span> name<span class="operator">=</span><span class="string">&#x27;çŽ‹äºŒ&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- ä¼šè¯ C ä¸­ï¼Œè®¾ç½®éš”ç¦»çº§åˆ«ä¸ºè¯»å·²æäº¤</span></span><br><span class="line"><span class="keyword">SET</span> SESSION TRANSACTION ISOLATION LEVEL READ COMMITTED;</span><br><span class="line"><span class="comment">-- åœ¨ä¼šè¯ C ä¸­æ›´æ–°æ•°æ®ä½†ä¸æäº¤</span></span><br><span class="line"><span class="keyword">START</span> TRANSACTION;</span><br><span class="line"><span class="keyword">UPDATE</span> accounts <span class="keyword">SET</span> balance <span class="operator">=</span> balance <span class="operator">+</span> <span class="number">200</span> <span class="keyword">WHERE</span> name<span class="operator">=</span><span class="string">&#x27;çŽ‹äºŒ&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- ä¼šè¯ B ä¸­å†æ¬¡è¯»å–æ•°æ®ï¼Œç»“æžœä»ç„¶ä¸º 1000</span></span><br><span class="line"><span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> accounts <span class="keyword">WHERE</span> name<span class="operator">=</span><span class="string">&#x27;çŽ‹äºŒ&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- ä¼šè¯ C ä¸­å›žæ»šäº‹åŠ¡</span></span><br><span class="line"><span class="keyword">ROLLBACK</span>;</span><br><span class="line"><span class="comment">-- ä¼šè¯ B ä¸­å†æ¬¡è¯»å–æ•°æ®ï¼Œç»“æžœä»ç„¶ä¸º 1000</span></span><br><span class="line"><span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> accounts <span class="keyword">WHERE</span> name<span class="operator">=</span><span class="string">&#x27;çŽ‹äºŒ&#x27;</span>;</span><br></pre></td></tr></table></figure>

<p><img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="https://cdn.jsdelivr.net/gh/JakicDong/blog-assets@main/images/20251011162301.png" alt="20251011162301"><br>äºŒå“¥çš„ Java è¿›é˜¶ä¹‹è·¯ï¼šè¯»å·²æäº¤å¯ä»¥è§£å†³è„è¯»é—®é¢˜</p>
<p>ä½†ä¼šå‡ºçŽ°ä¸å¯é‡å¤è¯»çš„é—®é¢˜ï¼šäº‹åŠ¡B ç¬¬ä¸€æ¬¡è¯»å–æŸè¡Œæ•°æ®å€¼ä¸ºXï¼ŒæœŸé—´äº‹åŠ¡Cä¿®æ”¹è¯¥æ•°æ®ä¸ºYå¹¶æäº¤ï¼Œäº‹åŠ¡B å†æ¬¡è¯»å–æ—¶å‘çŽ°å€¼å˜ä¸ºYï¼Œå¯¼è‡´ä¸¤æ¬¡è¯»å–ç»“æžœä¸ä¸€è‡´ã€‚</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- ä¼šè¯ B ä¿®æ”¹ä¸ºè¯»å·²æäº¤</span></span><br><span class="line"><span class="keyword">SET</span> SESSION TRANSACTION ISOLATION LEVEL READ COMMITTED;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- æ‰§è¡Œç¬¬ä¸€æ¬¡æŸ¥è¯¢ 1000</span></span><br><span class="line"><span class="keyword">START</span> TRANSACTION;</span><br><span class="line"><span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> accounts <span class="keyword">WHERE</span> name<span class="operator">=</span><span class="string">&#x27;çŽ‹äºŒ&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- ä¼šè¯ C ä¸­ï¼Œè®¾ç½®éš”ç¦»çº§åˆ«ä¸ºè¯»å·²æäº¤</span></span><br><span class="line"><span class="keyword">SET</span> SESSION TRANSACTION ISOLATION LEVEL READ COMMITTED;</span><br><span class="line"><span class="comment">-- åœ¨ä¼šè¯ C ä¸­æ›´æ–°æ•°æ®å¹¶æäº¤</span></span><br><span class="line"><span class="keyword">START</span> TRANSACTION;</span><br><span class="line"><span class="keyword">UPDATE</span> accounts <span class="keyword">SET</span> balance <span class="operator">=</span> balance <span class="operator">+</span> <span class="number">200</span> <span class="keyword">WHERE</span> name<span class="operator">=</span><span class="string">&#x27;çŽ‹äºŒ&#x27;</span>;</span><br><span class="line"><span class="comment">-- ä¼šè¯ C æäº¤äº‹åŠ¡</span></span><br><span class="line"><span class="keyword">COMMIT</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- ä¼šè¯ B ä¸­å†æ¬¡è¯»å–æ•°æ®ï¼Œç»“æžœä»ç„¶ä¸º 1200</span></span><br><span class="line"><span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> accounts <span class="keyword">WHERE</span> name<span class="operator">=</span><span class="string">&#x27;çŽ‹äºŒ&#x27;</span>;</span><br></pre></td></tr></table></figure>

<p><img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="https://cdn.jsdelivr.net/gh/JakicDong/blog-assets@main/images/20251011162620.png" alt="20251011162620"><br>äºŒå“¥çš„ Java è¿›é˜¶ä¹‹è·¯ï¼šè¯»å·²æäº¤ä¼šå‡ºçŽ°ä¸å¯é‡å¤è¯»çš„é—®é¢˜</p>
<p>å¯ä»¥é€šè¿‡å‡çº§éš”ç¦»çº§åˆ«ä¸ºå¯é‡å¤è¯»æ¥è§£å†³ä¸å¯é‡å¤è¯»çš„é—®é¢˜ã€‚</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- ä¼šè¯ B ä¿®æ”¹ä¸ºå¯é‡å¤è¯»</span></span><br><span class="line"><span class="keyword">SET</span> SESSION TRANSACTION ISOLATION LEVEL REPEATABLE READ;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- å¼€å§‹äº‹åŠ¡å¹¶æ‰§è¡Œç¬¬ä¸€æ¬¡æŸ¥è¯¢ 1000</span></span><br><span class="line"><span class="keyword">START</span> TRANSACTION;</span><br><span class="line"><span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> accounts <span class="keyword">WHERE</span> name<span class="operator">=</span><span class="string">&#x27;çŽ‹äºŒ&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- ä¼šè¯ C ä¸­ï¼Œè®¾ç½®éš”ç¦»çº§åˆ«ä¸ºå¯é‡å¤è¯»</span></span><br><span class="line"><span class="keyword">SET</span> SESSION TRANSACTION ISOLATION LEVEL REPEATABLE READ;</span><br><span class="line"><span class="comment">-- åœ¨ä¼šè¯ C ä¸­æ›´æ–°æ•°æ®å¹¶æäº¤</span></span><br><span class="line"><span class="keyword">START</span> TRANSACTION;</span><br><span class="line"><span class="keyword">UPDATE</span> accounts <span class="keyword">SET</span> balance <span class="operator">=</span> balance <span class="operator">+</span> <span class="number">200</span> <span class="keyword">WHERE</span> name<span class="operator">=</span><span class="string">&#x27;çŽ‹äºŒ&#x27;</span>;</span><br><span class="line"><span class="comment">-- ä¼šè¯ C æäº¤äº‹åŠ¡</span></span><br><span class="line"><span class="keyword">COMMIT</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- ä¼šè¯ B ä¸­å†æ¬¡è¯»å–æ•°æ®ï¼Œç»“æžœä»ç„¶ä¸º 1000</span></span><br><span class="line"><span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> accounts <span class="keyword">WHERE</span> name<span class="operator">=</span><span class="string">&#x27;çŽ‹äºŒ&#x27;</span>;</span><br></pre></td></tr></table></figure>

<p><img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="https://cdn.jsdelivr.net/gh/JakicDong/blog-assets@main/images/20251011165009.png" alt="20251011165009"><br>äºŒå“¥çš„ Java è¿›é˜¶ä¹‹è·¯ï¼šå¯é‡å¤è¯»çº§åˆ«è§£å†³ä¸å¯é‡å¤è¯»çš„é—®é¢˜</p>
<p>ä½†å¯é‡å¤è¯»çº§åˆ«ä¸‹ä»ç„¶ä¼šå‡ºçŽ°å¹»è¯»çš„é—®é¢˜ï¼šäº‹åŠ¡B ç¬¬ä¸€æ¬¡æŸ¥è¯¢èŽ·å¾— 2æ¡æ•°æ®ï¼Œäº‹åŠ¡C æ–°å¢ž 1æ¡æ•°æ®å¹¶æäº¤åŽï¼Œäº‹åŠ¡B å†æ¬¡æŸ¥è¯¢æ—¶ä»ç„¶ä¸º 2 æ¡æ•°æ®ï¼Œä½†å¯ä»¥æ›´æ–°æ–°å¢žçš„æ•°æ®ï¼Œå†æ¬¡æŸ¥è¯¢æ—¶å°±å‘çŽ°æœ‰ 3 æ¡æ•°æ®äº†ã€‚</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- ä¼šè¯ B ä¿®æ”¹ä¸ºå¯é‡å¤è¯»</span></span><br><span class="line"><span class="keyword">SET</span> SESSION TRANSACTION ISOLATION LEVEL REPEATABLE READ;</span><br><span class="line"><span class="comment">-- æ‰§è¡Œç¬¬ä¸€æ¬¡æŸ¥è¯¢ï¼ŒæŸ¥åˆ° 2 æ¡è®°å½•</span></span><br><span class="line"><span class="keyword">START</span> TRANSACTION;</span><br><span class="line"><span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> accounts <span class="keyword">WHERE</span> balance <span class="operator">&gt;</span> <span class="number">1000</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- ä¼šè¯ C ä¸­ï¼Œè®¾ç½®éš”ç¦»çº§åˆ«ä¸ºå¯é‡å¤è¯»</span></span><br><span class="line"><span class="keyword">SET</span> SESSION TRANSACTION ISOLATION LEVEL REPEATABLE READ;</span><br><span class="line"><span class="comment">-- åœ¨ä¼šè¯ C ä¸­æ–°å¢žæ•°æ®å¹¶æäº¤</span></span><br><span class="line"><span class="keyword">START</span> TRANSACTION;</span><br><span class="line"><span class="keyword">INSERT INTO</span> accounts (name, balance) <span class="keyword">VALUES</span> (<span class="string">&#x27;çŽ‹äº”&#x27;</span>, <span class="number">4000</span>);</span><br><span class="line"><span class="comment">-- ä¼šè¯ C æäº¤äº‹åŠ¡</span></span><br><span class="line"><span class="keyword">COMMIT</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- ä¼šè¯ B ä¸­å†æ¬¡è¯»å–æ•°æ®ï¼Œç»“æžœä»ç„¶ä¸º 2 æ¡</span></span><br><span class="line"><span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> accounts <span class="keyword">WHERE</span> balance <span class="operator">&gt;</span> <span class="number">1000</span>;</span><br><span class="line"><span class="comment">-- ä¼šè¯ B ä¸­å°è¯•æ›´æ–°çŽ‹äº”çš„ä½™é¢ä¸º 5000ï¼Œç«Ÿç„¶æˆåŠŸäº†</span></span><br><span class="line"><span class="keyword">UPDATE</span> accounts <span class="keyword">SET</span> balance <span class="operator">=</span> <span class="number">5000</span> <span class="keyword">WHERE</span> name<span class="operator">=</span><span class="string">&#x27;çŽ‹äº”&#x27;</span>;</span><br><span class="line"><span class="comment">-- ä¼šè¯ B ä¸­å†æ¬¡è¯»å–æ•°æ®ï¼Œå‘çŽ° 3 æ¡è®°å½•</span></span><br><span class="line"><span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> accounts <span class="keyword">WHERE</span> balance <span class="operator">&gt;</span> <span class="number">1000</span>;</span><br></pre></td></tr></table></figure>

<p><img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="https://cdn.jsdelivr.net/gh/JakicDong/blog-assets@main/images/20251027183826.png" alt="20251027183826"><br>äºŒå“¥çš„ Java è¿›é˜¶ä¹‹è·¯ï¼šå¯é‡å¤è¯»çº§åˆ«ä¸‹å¯èƒ½å‡ºçŽ°å¹»è¯»</p>
<p>å¯ä»¥é€šè¿‡å‡çº§éš”ç¦»çº§åˆ«ä¸ºä¸²è¡ŒåŒ–æ¥è§£å†³å¹»è¯»çš„é—®é¢˜ã€‚</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- ä¼šè¯ B ä¿®æ”¹ä¸ºå¯ä¸²è¡ŒåŒ–</span></span><br><span class="line"><span class="keyword">SET</span> SESSION TRANSACTION ISOLATION LEVEL SERIALIZABLE;</span><br><span class="line"><span class="comment">-- æ‰§è¡Œç¬¬ä¸€æ¬¡æŸ¥è¯¢ï¼ŒæŸ¥åˆ° 2 æ¡è®°å½•</span></span><br><span class="line"><span class="keyword">START</span> TRANSACTION;</span><br><span class="line"><span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> accounts <span class="keyword">WHERE</span> balance <span class="operator">&gt;</span> <span class="number">1000</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- ä¼šè¯ C ä¸­ï¼Œè®¾ç½®éš”ç¦»çº§åˆ«ä¸ºå¯ä¸²è¡ŒåŒ–</span></span><br><span class="line"><span class="keyword">SET</span> SESSION TRANSACTION ISOLATION LEVEL SERIALIZABLE;</span><br><span class="line"><span class="comment">-- åœ¨ä¼šè¯ C ä¸­æ–°å¢žæ•°æ®ï¼Œä¼šå¡ä½</span></span><br><span class="line"><span class="keyword">START</span> TRANSACTION;</span><br><span class="line"><span class="keyword">INSERT INTO</span> accounts (name, balance) <span class="keyword">VALUES</span> (<span class="string">&#x27;çŽ‹äº”&#x27;</span>, <span class="number">4000</span>);</span><br><span class="line"><span class="comment">-- åªæœ‰ç­‰ä¼šè¯ B æäº¤äº‹åŠ¡åŽä¼šè¯ C æ‰ä¼šç»§ç»­æ‰§è¡Œå¹¶æäº¤äº‹åŠ¡</span></span><br><span class="line"><span class="keyword">COMMIT</span>;</span><br></pre></td></tr></table></figure>

<p><img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="https://cdn.jsdelivr.net/gh/JakicDong/blog-assets@main/images/20251011165026.png" alt="20251011165026"><br>äºŒå“¥çš„ Java è¿›é˜¶ä¹‹è·¯ï¼šä¸²è¡ŒåŒ–éš”ç¦»çº§åˆ«ä¸‹ä¸ä¼šå‡ºçŽ°å¹»è¯»é—®é¢˜</p>
<table>
<thead>
<tr>
<th>éš”ç¦»çº§åˆ«</th>
<th>æ˜¯å¦ä¼šè„è¯»</th>
<th>æ˜¯å¦ä¼šä¸å¯é‡å¤è¯»</th>
<th>æ˜¯å¦ä¼šå¹»è¯»</th>
</tr>
</thead>
<tbody><tr>
<td>Read Uncommittedï¼ˆè¯»æœªæäº¤ï¼‰</td>
<td>âœ… å¯èƒ½</td>
<td>âœ… å¯èƒ½</td>
<td>âœ… å¯èƒ½</td>
</tr>
<tr>
<td>Read Committedï¼ˆè¯»å·²æäº¤ï¼‰</td>
<td>âŒ ä¸ä¼š</td>
<td>âœ… å¯èƒ½</td>
<td>âœ… å¯èƒ½</td>
</tr>
<tr>
<td>Repeatable Readï¼ˆå¯é‡å¤è¯»ï¼‰</td>
<td>âŒ ä¸ä¼š</td>
<td>âŒ ä¸ä¼š</td>
<td>âœ… å¯èƒ½ï¼ˆä½† InnoDB å·²è§£å†³ï¼‰</td>
</tr>
<tr>
<td>Serializableï¼ˆå¯ä¸²è¡ŒåŒ–ï¼‰</td>
<td>âŒ ä¸ä¼š</td>
<td>âŒ ä¸ä¼š</td>
<td>âŒ ä¸ä¼š</td>
</tr>
</tbody></table>
<p>-â€” è¿™éƒ¨åˆ†æ˜¯å¸®åŠ©å¤§å®¶ç†è§£ endï¼Œé¢è¯•ä¸­å¯ä¸èƒŒ â€”-</p>
<p>ç®€çŸ­å›žç­”ï¼šå¤šä¸ªå¹¶å‘äº‹åŠ¡ä¹‹é—´éœ€è¦ç›¸äº’éš”ç¦»ï¼Œå³ä¸€ä¸ªäº‹åŠ¡çš„æ‰§è¡Œä¸èƒ½è¢«å…¶ä»–äº‹åŠ¡å¹²æ‰°ã€‚</p>
<h4 id="è¯¦ç»†è¯´ä¸€ä¸‹æŒä¹…æ€§ï¼Ÿ"><a href="#è¯¦ç»†è¯´ä¸€ä¸‹æŒä¹…æ€§ï¼Ÿ" class="headerlink" title="è¯¦ç»†è¯´ä¸€ä¸‹æŒä¹…æ€§ï¼Ÿ"></a>è¯¦ç»†è¯´ä¸€ä¸‹æŒä¹…æ€§ï¼Ÿ</h4><p>æŒä¹…æ€§ç¡®ä¿äº‹åŠ¡ä¸€æ—¦æäº¤ï¼Œå®ƒå¯¹æ•°æ®æ‰€åšçš„æ›´æ”¹å°±æ˜¯æ°¸ä¹…æ€§çš„ï¼Œå³ä½¿ç³»ç»Ÿå‘ç”Ÿå´©æºƒï¼Œæ•°æ®ä¹Ÿèƒ½æ¢å¤åˆ°æœ€è¿‘ä¸€æ¬¡æäº¤çš„çŠ¶æ€ã€‚</p>
<p>MySQL çš„æŒä¹…æ€§æ˜¯é€šè¿‡ InnoDB å¼•æ“Žçš„ redo log å®žçŽ°çš„ã€‚åœ¨äº‹åŠ¡æäº¤æ—¶ï¼ŒInnoDB ä¼šå…ˆå°†ä¿®æ”¹æ“ä½œå†™å…¥ redo logï¼Œå¹¶åˆ·ç›˜æŒä¹…åŒ–ã€‚å´©æºƒåŽï¼ŒInnoDB ä¼šé€šè¿‡ redo log æ¢å¤æ•°æ®ï¼Œä»Žè€Œä¿è¯äº‹åŠ¡æäº¤æˆåŠŸçš„æ•°æ®ä¸ä¼šä¸¢å¤±ã€‚</p>
<p><img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="https://cdn.jsdelivr.net/gh/JakicDong/blog-assets@main/images/20251011170430.png" alt="20251011170430"><br>Mayank Sharmaï¼šå¯æŒä¹…åŒ–</p>
<p>ç®€çŸ­å›žç­”ï¼šä¸€æ—¦äº‹åŠ¡æäº¤ï¼Œåˆ™å…¶æ‰€åšçš„ä¿®æ”¹å°†æ°¸ä¹…ä¿å­˜åˆ° MySQL ä¸­ã€‚å³ä½¿å‘ç”Ÿç³»ç»Ÿå´©æºƒï¼Œä¿®æ”¹çš„æ•°æ®ä¹Ÿä¸ä¼šä¸¢å¤±ã€‚</p>
<h3 id="62-ðŸŒŸäº‹åŠ¡çš„éš”ç¦»çº§åˆ«æœ‰å“ªäº›ï¼Ÿ"><a href="#62-ðŸŒŸäº‹åŠ¡çš„éš”ç¦»çº§åˆ«æœ‰å“ªäº›ï¼Ÿ" class="headerlink" title="62.ðŸŒŸäº‹åŠ¡çš„éš”ç¦»çº§åˆ«æœ‰å“ªäº›ï¼Ÿ"></a>62.ðŸŒŸäº‹åŠ¡çš„éš”ç¦»çº§åˆ«æœ‰å“ªäº›ï¼Ÿ</h3><p>éš”ç¦»çº§åˆ«å®šä¹‰äº†ä¸€ä¸ªäº‹åŠ¡å¯èƒ½å—å…¶ä»–äº‹åŠ¡å½±å“çš„ç¨‹åº¦ï¼ŒMySQL æ”¯æŒå››ç§éš”ç¦»çº§åˆ«ï¼Œåˆ†åˆ«æ˜¯ï¼šè¯»æœªæäº¤ã€è¯»å·²æäº¤ã€å¯é‡å¤è¯»å’Œä¸²è¡ŒåŒ–ã€‚</p>
<p><img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="https://cdn.jsdelivr.net/gh/JakicDong/blog-assets@main/images/20251012183903.png" alt="20251012183903"><br>draven.coï¼šäº‹åŠ¡çš„å››ä¸ªéš”ç¦»çº§åˆ«</p>
<p>è¯»æœªæäº¤ä¼šå‡ºçŽ°è„è¯»ï¼Œè¯»å·²æäº¤ä¼šå‡ºçŽ°ä¸å¯é‡å¤è¯»ï¼Œå¯é‡å¤è¯»æ˜¯ InnoDB é»˜è®¤çš„éš”ç¦»çº§åˆ«ï¼Œå¯ä»¥é¿å…è„è¯»å’Œä¸å¯é‡å¤è¯»ï¼Œä½†ä¼šå‡ºçŽ°å¹»è¯»ã€‚ä¸è¿‡é€šè¿‡ MVCC å’Œä¸´é”®é”ï¼Œèƒ½å¤Ÿé˜²æ­¢å¤§å¤šæ•°å¹¶å‘é—®é¢˜ã€‚</p>
<p>ä¸²è¡ŒåŒ–æœ€å®‰å…¨ï¼Œä½†æ€§èƒ½è¾ƒå·®ï¼Œé€šå¸¸ä¸æŽ¨èä½¿ç”¨ã€‚</p>
<h4 id="è¯¦ç»†è¯´è¯´è¯»æœªæäº¤ï¼Ÿ"><a href="#è¯¦ç»†è¯´è¯´è¯»æœªæäº¤ï¼Ÿ" class="headerlink" title="è¯¦ç»†è¯´è¯´è¯»æœªæäº¤ï¼Ÿ"></a>è¯¦ç»†è¯´è¯´è¯»æœªæäº¤ï¼Ÿ</h4><p>äº‹åŠ¡å¯ä»¥è¯»å–å…¶ä»–æœªæäº¤äº‹åŠ¡ä¿®æ”¹çš„æ•°æ®ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œå¦‚æžœæœªæäº¤çš„äº‹åŠ¡ä¸€æ—¦å›žæ»šï¼Œè¯»å–åˆ°çš„æ•°æ®å°±ä¼šå˜æˆäº†â€œè„æ•°æ®â€ï¼Œé€šå¸¸ä¸ä¼šä½¿ç”¨ã€‚</p>
<p><img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="https://cdn.tobebetterjavaer.com/stutymore/mysql-20250415152542.png" alt="æ˜“å°˜åŸƒï¼šè¯»æœªæäº¤"></p>
<p>æ˜“å°˜åŸƒï¼šè¯»æœªæäº¤</p>
<h4 id="ä»€ä¹ˆæ˜¯è¯»å·²æäº¤ï¼Ÿ"><a href="#ä»€ä¹ˆæ˜¯è¯»å·²æäº¤ï¼Ÿ" class="headerlink" title="ä»€ä¹ˆæ˜¯è¯»å·²æäº¤ï¼Ÿ"></a>ä»€ä¹ˆæ˜¯è¯»å·²æäº¤ï¼Ÿ</h4><p>è¯»å·²æäº¤é¿å…äº†è„è¯»ï¼Œä½†å¯èƒ½ä¼šå‡ºçŽ°ä¸å¯é‡å¤è¯»ï¼Œå³åŒä¸€äº‹åŠ¡å†…å¤šæ¬¡è¯»å–åŒä¸€æ•°æ®ç»“æžœä¼šä¸åŒï¼Œå› ä¸ºå…¶ä»–äº‹åŠ¡æäº¤çš„ä¿®æ”¹ï¼Œå¯¹å½“å‰äº‹åŠ¡æ˜¯å¯è§çš„ã€‚</p>
<p><img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="https://cdn.jsdelivr.net/gh/JakicDong/blog-assets@main/images/20251012193756.png" alt="20251012193756"><br>æ˜“å°˜åŸƒï¼šè¯»å·²æäº¤</p>
<p>æ˜¯ Oracleã€SQL Server ç­‰æ•°æ®åº“çš„é»˜è®¤éš”ç¦»çº§åˆ«ã€‚</p>
<h4 id="ä»€ä¹ˆæ˜¯å¯é‡å¤è¯»ï¼Ÿ"><a href="#ä»€ä¹ˆæ˜¯å¯é‡å¤è¯»ï¼Ÿ" class="headerlink" title="ä»€ä¹ˆæ˜¯å¯é‡å¤è¯»ï¼Ÿ"></a>ä»€ä¹ˆæ˜¯å¯é‡å¤è¯»ï¼Ÿ</h4><p>å¯é‡å¤è¯»èƒ½ç¡®ä¿åŒä¸€äº‹åŠ¡å†…å¤šæ¬¡è¯»å–ç›¸åŒæ•°æ®çš„ç»“æžœä¸€è‡´ï¼Œå³ä½¿å…¶ä»–äº‹åŠ¡å·²æäº¤ä¿®æ”¹ã€‚</p>
<p><img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="https://cdn.jsdelivr.net/gh/JakicDong/blog-assets@main/images/20251012193828.png" alt="20251012193828"><br>æ˜“å°˜åŸƒï¼šå¯é‡å¤è¯»</p>
<p>æ˜¯ MySQL é»˜è®¤çš„éš”ç¦»çº§åˆ«ï¼Œé¿å…äº†â€œè„è¯»â€å’Œâ€œä¸å¯é‡å¤è¯»â€ï¼Œé€šè¿‡ MVCC å’Œä¸´é”®é”ä¹Ÿèƒ½åœ¨ä¸€å®šç¨‹åº¦ä¸Šé¿å…å¹»è¯»ã€‚</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- Session A:</span></span><br><span class="line"><span class="keyword">START</span> TRANSACTION;</span><br><span class="line"><span class="keyword">SELECT</span> balance <span class="keyword">FROM</span> accounts <span class="keyword">WHERE</span> id<span class="operator">=</span><span class="number">1</span>; <span class="comment">--è¿”å›ž500</span></span><br><span class="line"></span><br><span class="line"><span class="comment">-- Session B:</span></span><br><span class="line"><span class="keyword">UPDATE</span> accounts <span class="keyword">SET</span> balance <span class="operator">=</span> balance <span class="operator">+</span><span class="number">100</span> <span class="keyword">WHERE</span> id<span class="operator">=</span><span class="number">1</span>;</span><br><span class="line"><span class="keyword">COMMIT</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- Session Aå†æ¬¡æŸ¥è¯¢:</span></span><br><span class="line"><span class="keyword">SELECT</span> balance <span class="keyword">FROM</span> accounts <span class="keyword">WHERE</span> id<span class="operator">=</span><span class="number">1</span>; <span class="comment">--ä»è¿”å›ž500(å¯é‡å¤è¯»)</span></span><br><span class="line"></span><br><span class="line"><span class="comment">-- Session Aæ›´æ–°åŽæŸ¥è¯¢:</span></span><br><span class="line"><span class="keyword">UPDATE</span> accounts <span class="keyword">SET</span> balance <span class="operator">=</span> balance <span class="operator">+</span><span class="number">50</span> <span class="keyword">WHERE</span> id<span class="operator">=</span><span class="number">1</span>; <span class="comment">--åŸºäºŽæœ€æ–°å€¼550æ›´æ–°ä¸º600 </span></span><br><span class="line"><span class="keyword">SELECT</span> balance <span class="keyword">FROM</span> accounts <span class="keyword">WHERE</span> id<span class="operator">=</span><span class="number">1</span>; <span class="comment">--è¿”å›ž600</span></span><br></pre></td></tr></table></figure>

<h4 id="ä»€ä¹ˆæ˜¯ä¸²è¡ŒåŒ–ï¼Ÿ"><a href="#ä»€ä¹ˆæ˜¯ä¸²è¡ŒåŒ–ï¼Ÿ" class="headerlink" title="ä»€ä¹ˆæ˜¯ä¸²è¡ŒåŒ–ï¼Ÿ"></a>ä»€ä¹ˆæ˜¯ä¸²è¡ŒåŒ–ï¼Ÿ</h4><p>ä¸²è¡ŒåŒ–æ˜¯æœ€é«˜çš„éš”ç¦»çº§åˆ«ï¼Œé€šè¿‡å¼ºåˆ¶äº‹åŠ¡ä¸²è¡Œæ‰§è¡Œæ¥è§£å†³â€œå¹»è¯»â€é—®é¢˜ã€‚</p>
<p><img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="https://cdn.jsdelivr.net/gh/JakicDong/blog-assets@main/images/20251012193847.png" alt="20251012193847"><br>æ˜“å°˜åŸƒï¼šä¸²è¡ŒåŒ–</p>
<p>ä½†ä¼šå¯¼è‡´å¤§é‡çš„é”ç«žäº‰é—®é¢˜ï¼Œå®žé™…åº”ç”¨ä¸­å¾ˆå°‘ç”¨ã€‚</p>
<h4 id="A-äº‹åŠ¡æœªæäº¤ï¼ŒB-äº‹åŠ¡ä¸ŠæŸ¥è¯¢åˆ°çš„æ˜¯æ—§å€¼è¿˜æ˜¯æ–°å€¼ï¼Ÿ"><a href="#A-äº‹åŠ¡æœªæäº¤ï¼ŒB-äº‹åŠ¡ä¸ŠæŸ¥è¯¢åˆ°çš„æ˜¯æ—§å€¼è¿˜æ˜¯æ–°å€¼ï¼Ÿ" class="headerlink" title="A äº‹åŠ¡æœªæäº¤ï¼ŒB äº‹åŠ¡ä¸ŠæŸ¥è¯¢åˆ°çš„æ˜¯æ—§å€¼è¿˜æ˜¯æ–°å€¼ï¼Ÿ"></a>A äº‹åŠ¡æœªæäº¤ï¼ŒB äº‹åŠ¡ä¸ŠæŸ¥è¯¢åˆ°çš„æ˜¯æ—§å€¼è¿˜æ˜¯æ–°å€¼ï¼Ÿ</h4><p>å¦‚æžœ B æ˜¯æ™®é€šçš„ SELECTï¼Œä¹Ÿå°±æ˜¯å¿«ç…§è¯»ï¼Œå®ƒè¯»çš„æ˜¯æ—§å€¼ï¼Œå³äº‹åŠ¡ A ä¿®æ”¹å‰çš„å¿«ç…§ï¼Œå¹¶ä¸”ä¸ä¼šé˜»å¡žï¼›å¦‚æžœ B æ˜¯å½“å‰è¯»ï¼Œæ¯”å¦‚ <code>SELECT â€¦ FOR UPDATE</code>ï¼Œå®ƒä¼šè¢«é˜»å¡žç›´åˆ°äº‹åŠ¡ A æäº¤æˆ–å›žæ»šã€‚</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- ä¼šè¯ A ä¸­ï¼Œæ›´æ–°çŽ‹äºŒçš„ä½™é¢</span></span><br><span class="line"><span class="keyword">START</span> TRANSACTION;</span><br><span class="line"><span class="keyword">UPDATE</span> accounts <span class="keyword">SET</span> balance <span class="operator">=</span> <span class="number">8000</span> <span class="keyword">WHERE</span> name <span class="operator">=</span> <span class="string">&#x27;çŽ‹äºŒ&#x27;</span>;</span><br><span class="line"><span class="comment">-- æ­¤æ—¶å¹¶æ²¡æœ‰ COMMIT</span></span><br><span class="line"></span><br><span class="line"><span class="comment">-- ä¼šè¯ B ä¸­æŸ¥è¯¢çŽ‹äºŒçš„ä½™é¢</span></span><br><span class="line"><span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> accounts <span class="keyword">WHERE</span> name <span class="operator">=</span> <span class="string">&#x27;çŽ‹äºŒ&#x27;</span>;</span><br><span class="line"><span class="comment">-- ä¼šè¯ B ä¼šè¯»å–åˆ° æ—§å€¼ 1000</span></span><br><span class="line"></span><br><span class="line"><span class="comment">-- ä¼šè¯ C ä¸­ä½¿ç”¨å½“å‰è¯»æŸ¥è¯¢çŽ‹äºŒçš„ä½™é¢</span></span><br><span class="line"><span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> accounts <span class="keyword">WHERE</span> name <span class="operator">=</span> <span class="string">&#x27;çŽ‹äºŒ&#x27;</span> <span class="keyword">FOR</span> <span class="keyword">UPDATE</span>;</span><br><span class="line"><span class="comment">-- ä¼šè¯ C ä¼šè¢«é˜»å¡žï¼Œç›´åˆ°ä¼šè¯ A æäº¤æˆ–å›žæ»š</span></span><br></pre></td></tr></table></figure>

<p><img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="https://cdn.jsdelivr.net/gh/JakicDong/blog-assets@main/images/20251012193913.png" alt="20251012193913"><br>äºŒå“¥çš„ Java è¿›é˜¶ä¹‹è·¯ï¼šå¿«ç…§è¯»å’Œå½“å‰è¯»çš„å·®åˆ«</p>
<h4 id="æ€Žä¹ˆæ›´æ”¹äº‹åŠ¡çš„éš”ç¦»çº§åˆ«ï¼Ÿ"><a href="#æ€Žä¹ˆæ›´æ”¹äº‹åŠ¡çš„éš”ç¦»çº§åˆ«ï¼Ÿ" class="headerlink" title="æ€Žä¹ˆæ›´æ”¹äº‹åŠ¡çš„éš”ç¦»çº§åˆ«ï¼Ÿ"></a>æ€Žä¹ˆæ›´æ”¹äº‹åŠ¡çš„éš”ç¦»çº§åˆ«ï¼Ÿ</h4><p>MySQL æ”¯æŒé€šè¿‡ SET è¯­å¥ä¿®æ”¹äº‹åŠ¡éš”ç¦»çº§åˆ«ï¼ŒåŒ…æ‹¬å…¨å±€çº§åˆ«ã€å½“å‰ä¼šè¯ï¼Œä½†ä¸€èˆ¬ä¸å»ºè®®åœ¨ç”Ÿäº§çŽ¯å¢ƒä¸­éšæ„ä¿®æ”¹éš”ç¦»çº§åˆ«ã€‚</p>
<p>æµ‹è¯•çŽ¯å¢ƒä¸‹å¯ä»¥ä½¿ç”¨ <code>SET SESSION TRANSACTION ISOLATION LEVEL REPEATABLE READ;</code> å¯ä»¥ä¿®æ”¹å½“å‰ä¼šè¯çš„éš”ç¦»çº§åˆ«ã€‚</p>
<p>ä½¿ç”¨ <code>SET GLOBAL TRANSACTION ISOLATION LEVEL READ COMMITTED;</code> å¯ä»¥ä¿®æ”¹å…¨å±€éš”ç¦»çº§åˆ«ï¼Œå½±å“æ–°çš„è¿žæŽ¥ï¼Œä½†ä¸ä¼šæ”¹å˜çŽ°æœ‰ä¼šè¯ã€‚</p>
<h3 id="64-ðŸŒŸè¯·è¯¦ç»†è¯´è¯´å¹»è¯»å‘¢ï¼Ÿ"><a href="#64-ðŸŒŸè¯·è¯¦ç»†è¯´è¯´å¹»è¯»å‘¢ï¼Ÿ" class="headerlink" title="64.ðŸŒŸè¯·è¯¦ç»†è¯´è¯´å¹»è¯»å‘¢ï¼Ÿ"></a>64.ðŸŒŸè¯·è¯¦ç»†è¯´è¯´å¹»è¯»å‘¢ï¼Ÿ</h3><p>å¹»è¯»æ˜¯æŒ‡åœ¨åŒä¸€ä¸ªäº‹åŠ¡ä¸­ï¼Œå¤šæ¬¡æ‰§è¡Œç›¸åŒçš„èŒƒå›´æŸ¥è¯¢ï¼Œç»“æžœå´ä¸åŒã€‚è¿™ç§çŽ°è±¡é€šå¸¸å‘ç”Ÿåœ¨å…¶ä»–äº‹åŠ¡åœ¨ä¸¤æ¬¡æŸ¥è¯¢ä¹‹é—´æ’å…¥æˆ–åˆ é™¤äº†ç¬¦åˆå½“å‰æŸ¥è¯¢æ¡ä»¶çš„æ•°æ®ã€‚</p>
<p><img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="https://cdn.jsdelivr.net/gh/JakicDong/blog-assets@main/images/20251012194100.png" alt="20251012194100"><br>Jennyï¼šPhantom read</p>
<p>-â€” è¿™éƒ¨åˆ†æ˜¯å¸®åŠ©å¤§å®¶ç†è§£ startï¼Œé¢è¯•ä¸­å¯ä»¥ä¸èƒŒ â€”-</p>
<p>æ¯”å¦‚è¯´äº‹åŠ¡ A åœ¨ç¬¬ä¸€æ¬¡æŸ¥è¯¢æŸä¸ªæ¡ä»¶èŒƒå›´çš„æ•°æ®è¡ŒåŽï¼Œäº‹åŠ¡ B æ’å…¥äº†ä¸€æ¡æ–°æ•°æ®ä¸”ç¬¦åˆæ¡ä»¶èŒƒå›´ï¼Œäº‹åŠ¡ A å†æ¬¡æŸ¥è¯¢æ—¶ï¼Œå‘çŽ°å¤šäº†ä¸€æ¡æ•°æ®ã€‚</p>
<p>æˆ‘ä»¬æ¥éªŒè¯ä¸€ä¸‹ï¼Œå…ˆåˆ›å»ºæµ‹è¯•è¡¨ï¼Œæ’å…¥æµ‹è¯•æ•°æ®ã€‚</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">CREATE TABLE</span> `user_info` (</span><br><span class="line">  `id` <span class="type">BIGINT</span>(<span class="number">20</span>) UNSIGNED <span class="keyword">NOT NULL</span> AUTO_INCREMENT COMMENT <span class="string">&#x27;ä¸»é”®id&#x27;</span>,</span><br><span class="line">  `name` <span class="type">VARCHAR</span>(<span class="number">32</span>) <span class="keyword">NOT NULL</span> <span class="keyword">DEFAULT</span> <span class="string">&#x27;&#x27;</span> COMMENT <span class="string">&#x27;å§“å&#x27;</span>,</span><br><span class="line">  `gender` <span class="type">VARCHAR</span>(<span class="number">32</span>) <span class="keyword">NOT NULL</span> <span class="keyword">DEFAULT</span> <span class="string">&#x27;&#x27;</span> COMMENT <span class="string">&#x27;æ€§åˆ«&#x27;</span>,</span><br><span class="line">  `email` <span class="type">VARCHAR</span>(<span class="number">32</span>) <span class="keyword">NOT NULL</span> <span class="keyword">DEFAULT</span> <span class="string">&#x27;&#x27;</span> COMMENT <span class="string">&#x27;é‚®ç®±&#x27;</span>,</span><br><span class="line">  <span class="keyword">PRIMARY KEY</span> (`id`)</span><br><span class="line">) ENGINE<span class="operator">=</span>INNODB <span class="keyword">DEFAULT</span> CHARSET<span class="operator">=</span>utf8mb4 COMMENT<span class="operator">=</span><span class="string">&#x27;ç”¨æˆ·ä¿¡æ¯è¡¨&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- æ’å…¥æµ‹è¯•æ•°æ®</span></span><br><span class="line"><span class="keyword">INSERT INTO</span> `user_info` (`id`, `name`, `gender`, `email`) <span class="keyword">VALUES</span> </span><br><span class="line">  (<span class="number">1</span>, <span class="string">&#x27;Curry&#x27;</span>, <span class="string">&#x27;ç”·&#x27;</span>, <span class="string">&#x27;curry@163.com&#x27;</span>),</span><br><span class="line">  (<span class="number">2</span>, <span class="string">&#x27;Wade&#x27;</span>, <span class="string">&#x27;ç”·&#x27;</span>, <span class="string">&#x27;wade@163.com&#x27;</span>),</span><br><span class="line">  (<span class="number">3</span>, <span class="string">&#x27;James&#x27;</span>, <span class="string">&#x27;ç”·&#x27;</span>, <span class="string">&#x27;james@163.com&#x27;</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">COMMIT</span>;</span><br></pre></td></tr></table></figure>

<p>ç„¶åŽæˆ‘ä»¬åœ¨äº‹åŠ¡ A ä¸­æ‰§è¡ŒæŸ¥è¯¢ <code>SELECT * FROM user_info WHERE id &gt; 1;</code>ï¼Œåœ¨äº‹åŠ¡ B ä¸­æ’å…¥æ•°æ® <code>INSERT INTO user_info (name, gender, email) VALUES (&#39;wanger&#39;, &#39;å¥³&#39;, &#39;wanger@163.com&#39;);</code>ï¼Œå†åœ¨äº‹åŠ¡ A ä¸­ä¿®æ”¹åˆšåˆšæ’å…¥çš„æ•°æ® <code>update user_info set gender=&#39;ç”·&#39; where id = 4;</code>ï¼Œæœ€åŽåœ¨äº‹åŠ¡ A ä¸­å†æ¬¡æŸ¥è¯¢ <code>SELECT * FROM user_info WHERE id &gt; 1;</code>ã€‚</p>
<p><img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="https://cdn.jsdelivr.net/gh/JakicDong/blog-assets@main/images/20251012194118.png" alt="20251012194118"><br>äºŒå“¥çš„ Java è¿›é˜¶ä¹‹è·¯ï¼šå¯ä»¥å‘çŽ°äº§ç”Ÿå¹»è¯»äº†</p>
<p>-â€” è¿™éƒ¨åˆ†æ˜¯å¸®åŠ©å¤§å®¶ç†è§£ endï¼Œé¢è¯•ä¸­å¯ä»¥ä¸èƒŒ â€”-</p>
<h4 id="å¦‚ä½•é¿å…å¹»è¯»ï¼Ÿ"><a href="#å¦‚ä½•é¿å…å¹»è¯»ï¼Ÿ" class="headerlink" title="å¦‚ä½•é¿å…å¹»è¯»ï¼Ÿ"></a>å¦‚ä½•é¿å…å¹»è¯»ï¼Ÿ</h4><p>MySQL åœ¨å¯é‡å¤è¯»éš”ç¦»çº§åˆ«ä¸‹ï¼Œé€šè¿‡ MVCC å’Œä¸´é”®é”å¯ä»¥åœ¨ä¸€å®šç¨‹åº¦ä¸Šé¿å…å¹»è¯»ã€‚</p>
<p>æ¯”å¦‚è¯´åœ¨æŸ¥è¯¢æ—¶æ˜¾ç¤ºåŠ é”ï¼Œåˆ©ç”¨ä¸´é”®é”é”å®šæŸ¥è¯¢èŒƒå›´ï¼Œé˜²æ­¢å…¶ä»–äº‹åŠ¡æ’å…¥æ–°çš„æ•°æ®ã€‚</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">START TRANSACTION;</span><br><span class="line">SELECT * FROM user_info WHERE id &gt; 1 FOR UPDATE; -- åŠ ä¸´é”®é”</span><br><span class="line">COMMIT;</span><br></pre></td></tr></table></figure>

<p>å…¶ä»–äº‹åŠ¡åœ¨æ’å…¥æ•°æ®æ—¶ï¼Œä¼šè¢«é˜»å¡žï¼Œç›´åˆ°å½“å‰äº‹åŠ¡æäº¤æˆ–å›žæ»šã€‚</p>
<p><img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="https://cdn.jsdelivr.net/gh/JakicDong/blog-assets@main/images/20251012194134.png" alt="20251012194134"><br>äºŒå“¥çš„ Java è¿›é˜¶ä¹‹è·¯ï¼šä¸´é”®é”èƒ½é˜²æ­¢å¹»è¯»</p>
<p>-â€” è¿™éƒ¨åˆ†æ˜¯å¸®åŠ©å¤§å®¶ç†è§£ startï¼Œé¢è¯•ä¸­å¯ä»¥ä¸èƒŒ â€”-</p>
<p>è§£é‡Šä¸€ä¸‹ã€‚</p>
<p>å¦‚æžœæŸ¥è¯¢è¯­å¥ä¸­åŒ…å«æ˜¾å¼åŠ é”ï¼ˆå¦‚ <code>FOR UPDATE</code>ï¼‰ï¼ŒInnoDB ä¼šä½¿ç”¨å½“å‰è¯»ï¼Œç›´æŽ¥è¯»å–æœ€æ–°çš„æ•°æ®ï¼Œå¹¶åŠ é”ã€‚</p>
<p>åœ¨èŒƒå›´æŸ¥è¯¢æ—¶ï¼ŒInnoDB ä¸ä»…ä¼šå¯¹ç¬¦åˆæ¡ä»¶çš„è®°å½•åŠ è¡Œé”ï¼Œè¿˜ä¼šå¯¹ç›¸é‚»çš„ç´¢å¼•é—´éš™åŠ é—´éš™é”ï¼Œä»Žè€Œå½¢æˆä¸´é”®é”ã€‚</p>
<p><img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="https://cdn.jsdelivr.net/gh/JakicDong/blog-assets@main/images/20251012194152.png" alt="20251012194152"><br>è½¬è½¬æŠ€æœ¯ï¼šä¸´é”®é”</p>
<p>ä¸´é”®é”å¯ä»¥é˜²æ­¢å…¶ä»–äº‹åŠ¡åœ¨é—´éš™ä¸­æ’å…¥æ–°æ•°æ®ï¼Œä»Žè€Œé¿å…å¹»è¯»ã€‚</p>
<p>-â€” è¿™éƒ¨åˆ†æ˜¯å¸®åŠ©å¤§å®¶ç†è§£ endï¼Œé¢è¯•ä¸­å¯ä»¥ä¸èƒŒ â€”-</p>
<p>æ¯”å¦‚è¯´åœ¨æ‰§è¡ŒæŸ¥è¯¢çš„äº‹åŠ¡ä¸­ï¼Œä¸è¦å°è¯•åŽ»æ›´æ–°å…¶ä»–äº‹åŠ¡æ’å…¥&#x2F;åˆ é™¤çš„æ•°æ®ï¼Œåˆ©ç”¨å¿«ç…§è¯»æ¥é¿å…å¹»è¯»ã€‚</p>
<p><img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="https://cdn.jsdelivr.net/gh/JakicDong/blog-assets@main/images/20251012194203.png" alt="20251012194203"><br>äºŒå“¥çš„ Java è¿›é˜¶ä¹‹è·¯ï¼šåªç”¨å¿«ç…§è¯»</p>
<p>-â€” è¿™éƒ¨åˆ†æ˜¯å¸®åŠ©å¤§å®¶ç†è§£ startï¼Œé¢è¯•ä¸­å¯ä»¥ä¸èƒŒ â€”-</p>
<p>ä½¿ç”¨ SELECT æŸ¥è¯¢æ—¶ï¼Œå¦‚æžœæ²¡æœ‰æ˜¾å¼åŠ é”ï¼ŒInnoDB ä¼šä½¿ç”¨ MVCC æä¾›ä¸€è‡´æ€§è§†å›¾ã€‚</p>
<p>æ¯ä¸ªäº‹åŠ¡åœ¨å¯åŠ¨æ—¶éƒ½ä¼šç”Ÿæˆä¸€ä¸ª Read Viewï¼Œç”¨æ¥ç¡®å®šå“ªäº›æ•°æ®å¯¹å½“å‰äº‹åŠ¡å¯è§ã€‚</p>
<p><img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="https://cdn.jsdelivr.net/gh/JakicDong/blog-assets@main/images/20251012194215.png" alt="20251012194215"><br>Keep It Simpleï¼šRead View</p>
<p>å…¶ä»–äº‹åŠ¡åœ¨å½“å‰äº‹åŠ¡å¯åŠ¨åŽæ’å…¥çš„æ–°æ•°æ®ä¸ä¼šè¢«å½“å‰äº‹åŠ¡çœ‹åˆ°ï¼Œå› æ­¤ä¸ä¼šå‡ºçŽ°å¹»è¯»ã€‚</p>
<p>-â€” è¿™éƒ¨åˆ†æ˜¯å¸®åŠ©å¤§å®¶ç†è§£ endï¼Œé¢è¯•ä¸­å¯ä»¥ä¸èƒŒ â€”-</p>
<h4 id="ä»€ä¹ˆæ˜¯å½“å‰è¯»å‘¢ï¼Ÿ"><a href="#ä»€ä¹ˆæ˜¯å½“å‰è¯»å‘¢ï¼Ÿ" class="headerlink" title="ä»€ä¹ˆæ˜¯å½“å‰è¯»å‘¢ï¼Ÿ"></a>ä»€ä¹ˆæ˜¯å½“å‰è¯»å‘¢ï¼Ÿ</h4><p>å½“å‰è¯»æ˜¯æŒ‡è¯»å–è®°å½•çš„æœ€æ–°å·²æäº¤ç‰ˆæœ¬ï¼Œå¹¶ä¸”åœ¨è¯»å–æ—¶å¯¹è®°å½•åŠ é”ï¼Œç¡®ä¿å…¶ä»–å¹¶å‘äº‹åŠ¡ä¸èƒ½ä¿®æ”¹å½“å‰è®°å½•ã€‚</p>
<p>æ¯”å¦‚ <code>SELECT ... LOCK IN SHARE MODE</code>ã€<code>SELECT ... FOR UPDATE</code>ï¼Œä»¥åŠ UPDATEã€DELETEï¼Œéƒ½å±žäºŽå½“å‰è¯»ã€‚</p>
<h4 id="ä¸ºä»€ä¹ˆ-UPDATE-å’Œ-DELETE-ä¹Ÿå±žäºŽå½“å‰è¯»ï¼Ÿ"><a href="#ä¸ºä»€ä¹ˆ-UPDATE-å’Œ-DELETE-ä¹Ÿå±žäºŽå½“å‰è¯»ï¼Ÿ" class="headerlink" title="ä¸ºä»€ä¹ˆ UPDATE å’Œ DELETE ä¹Ÿå±žäºŽå½“å‰è¯»ï¼Ÿ"></a>ä¸ºä»€ä¹ˆ UPDATE å’Œ DELETE ä¹Ÿå±žäºŽå½“å‰è¯»ï¼Ÿ</h4><p>å› ä¸ºæ›´æ–°ã€åˆ é™¤è¿™äº›æ“ä½œï¼Œæœ¬è´¨ä¸Šä¸ä»…æ˜¯å†™æ“ä½œï¼Œè¿˜éœ€è¦åœ¨å†™ä¹‹å‰è¯»å–æ•°æ®ï¼Œç„¶åŽæ‰èƒ½ä¿®æ”¹æˆ–åˆ é™¤ã€‚ä¸ºäº†ä¿è¯ä¿®æ”¹çš„æ˜¯æœ€æ–°çš„æ•°æ®ï¼Œå¹¶é˜²æ­¢å¹¶å‘å†²çªï¼ŒInnoDB å¿…é¡»è¯»å–æœ€æ–°ç‰ˆæœ¬çš„æ•°æ®å¹¶åŠ é”ï¼Œå› æ­¤ UPDATE å’Œ DELETE ä¹Ÿå±žäºŽå½“å‰è¯»ã€‚</p>
<p><img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="https://cdn.jsdelivr.net/gh/JakicDong/blog-assets@main/images/20251012194240.png" alt="20251012194240"><br>æºªæ°´é™å¹½ï¼šå½“å‰è¯»</p>
<table>
<thead>
<tr>
<th>SQLè¯­å¥</th>
<th>æ˜¯å¦å½“å‰è¯»</th>
<th>æ˜¯å¦åŠ é”</th>
</tr>
</thead>
<tbody><tr>
<td><code>SELECT * FROM user WHERE id=1</code></td>
<td>âŒ å¦</td>
<td>âŒ å¦</td>
</tr>
<tr>
<td><code>SELECT * FROM user WHERE id=1</code> FOR UPDATE</td>
<td>âœ… æ˜¯</td>
<td>âœ… åŠ æŽ’ä»–é”</td>
</tr>
<tr>
<td><code>SELECT * FROM user WHERE id=1 LOCK IN SHARE MODE</code></td>
<td>âœ… æ˜¯</td>
<td>âœ… åŠ å…±äº«é”</td>
</tr>
<tr>
<td><code>UPDATE user SET ... WHERE id=1</code></td>
<td>âœ… æ˜¯</td>
<td>âœ… åŠ æŽ’ä»–é”</td>
</tr>
<tr>
<td><code>DELETE FROM user WHERE id=1</code></td>
<td>âœ… æ˜¯</td>
<td>âœ… åŠ æŽ’ä»–é”</td>
</tr>
</tbody></table>
<h4 id="ä»€ä¹ˆæ˜¯å¿«ç…§è¯»å‘¢ï¼Ÿ"><a href="#ä»€ä¹ˆæ˜¯å¿«ç…§è¯»å‘¢ï¼Ÿ" class="headerlink" title="ä»€ä¹ˆæ˜¯å¿«ç…§è¯»å‘¢ï¼Ÿ"></a>ä»€ä¹ˆæ˜¯å¿«ç…§è¯»å‘¢ï¼Ÿ</h4><p>å¿«ç…§è¯»æ˜¯ InnoDB é€šè¿‡ MVCC å®žçŽ°çš„ä¸€ç§éžé˜»å¡žè¯»æ–¹å¼ã€‚å½“äº‹åŠ¡æ‰§è¡Œ SELECT æŸ¥è¯¢æ—¶ï¼ŒInnoDB å¹¶ä¸ä¼šç›´æŽ¥è¯»å½“å‰æœ€æ–°çš„æ•°æ®ï¼Œè€Œæ˜¯æ ¹æ®äº‹åŠ¡å¼€å§‹æ—¶ç”Ÿæˆçš„ Read View åŽ»åˆ¤æ–­æ¯æ¡è®°å½•çš„å¯è§æ€§ï¼Œä»Žè€Œè¯»å–ç¬¦åˆæ¡ä»¶çš„åŽ†å²ç‰ˆæœ¬ã€‚</p>
<p><img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="https://cdn.jsdelivr.net/gh/JakicDong/blog-assets@main/images/20251012194259.png" alt="20251012194259"><br>çˆ±åƒé±¼é¥¼çš„çŒ«ï¼šå¿«ç…§è¯»</p>
<table>
<thead>
<tr>
<th>SQL</th>
<th>æ˜¯å¦å¿«ç…§è¯»ï¼Ÿ</th>
<th>è¯´æ˜Ž</th>
</tr>
</thead>
<tbody><tr>
<td><code>SELECT * FROM t WHERE id=1</code></td>
<td>âœ… æ˜¯</td>
<td>å¿«ç…§è¯»</td>
</tr>
<tr>
<td><code>SELECT * FROM t WHERE id=1 FOR UPDATE</code></td>
<td>âŒ å¦</td>
<td>å½“å‰è¯»ï¼Œè¯»å–æœ€æ–°ç‰ˆæœ¬å¹¶åŠ é”</td>
</tr>
<tr>
<td><code>UPDATE / DELETE</code></td>
<td>âŒ å¦</td>
<td>å½“å‰è¯»ï¼Œå¿…é¡»è¯»å–å½“å‰ç‰ˆæœ¬å¹¶åŠ é”</td>
</tr>
<tr>
<td><code>INSERT</code></td>
<td>âŒ å¦</td>
<td>å†™æ“ä½œï¼Œä¸å­˜åœ¨åŽ†å²ç‰ˆæœ¬</td>
</tr>
</tbody></table>
<h3 id="65-ðŸŒŸMVCC-äº†è§£å—ï¼Ÿ"><a href="#65-ðŸŒŸMVCC-äº†è§£å—ï¼Ÿ" class="headerlink" title="65.ðŸŒŸMVCC äº†è§£å—ï¼Ÿ"></a>65.ðŸŒŸMVCC äº†è§£å—ï¼Ÿ</h3><p>MVCC æŒ‡çš„æ˜¯å¤šç‰ˆæœ¬å¹¶å‘æŽ§åˆ¶ï¼Œæ¯æ¬¡ä¿®æ”¹æ•°æ®æ—¶ï¼Œéƒ½ä¼šç”Ÿæˆä¸€ä¸ªæ–°çš„ç‰ˆæœ¬ï¼Œè€Œä¸æ˜¯ç›´æŽ¥åœ¨åŽŸæœ‰æ•°æ®ä¸Šè¿›è¡Œä¿®æ”¹ã€‚å¹¶ä¸”æ¯ä¸ªäº‹åŠ¡åªèƒ½çœ‹åˆ°åœ¨å®ƒå¼€å§‹ä¹‹å‰å·²ç»æäº¤çš„æ•°æ®ç‰ˆæœ¬ã€‚</p>
<p><img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="https://cdn.jsdelivr.net/gh/JakicDong/blog-assets@main/images/20251012194321.png" alt="20251012194321"><br>å¤©ç‘•ï¼šundo log ç‰ˆæœ¬é“¾å’Œ ReadView</p>
<p>è¿™æ ·çš„è¯ï¼Œè¯»æ“ä½œå°±ä¸ä¼šé˜»å¡žå†™æ“ä½œï¼Œå†™æ“ä½œä¹Ÿä¸ä¼šé˜»å¡žè¯»æ“ä½œï¼Œä»Žè€Œé¿å…åŠ é”å¸¦æ¥çš„æ€§èƒ½æŸè€—ã€‚</p>
<p>å…¶åº•å±‚å®žçŽ°ä¸»è¦ä¾èµ–äºŽ Undo Log å’Œ Read Viewã€‚</p>
<p>æ¯æ¬¡ä¿®æ”¹æ•°æ®å‰ï¼Œå…ˆå°†è®°å½•æ‹·è´åˆ°Undo Logï¼Œå¹¶ä¸”æ¯æ¡è®°å½•ä¼šåŒ…å«ä¸‰ä¸ªéšè—åˆ—ï¼ŒDB_TRX_ID ç”¨æ¥è®°å½•ä¿®æ”¹è¯¥è¡Œçš„äº‹åŠ¡ IDï¼ŒDB_ROLL_PTR ç”¨æ¥æŒ‡å‘ Undo Log ä¸­çš„å‰ä¸€ä¸ªç‰ˆæœ¬ï¼ŒDB_ROW_ID ç”¨æ¥å”¯ä¸€æ ‡è¯†è¯¥è¡Œæ•°æ®ï¼ˆä»…æ— ä¸»é”®æ—¶ç”Ÿæˆï¼‰ã€‚</p>
<p><img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="https://cdn.jsdelivr.net/gh/JakicDong/blog-assets@main/images/20251012194333.png" alt="20251012194333"><br>guozhchunï¼šé¢å¤–çš„å­˜å‚¨ä¿¡æ¯</p>
<p>æ¯æ¬¡è¯»å–æ•°æ®æ—¶ï¼Œéƒ½ä¼šç”Ÿæˆä¸€ä¸ª ReadViewï¼Œå…¶ä¸­è®°å½•äº†å½“å‰æ´»è·ƒäº‹åŠ¡çš„ ID é›†åˆã€æœ€å°äº‹åŠ¡ IDã€æœ€å¤§äº‹åŠ¡ ID ç­‰ä¿¡æ¯ï¼Œé€šè¿‡ä¸Ž DB_TRX_ID è¿›è¡Œå¯¹æ¯”ï¼Œåˆ¤æ–­å½“å‰äº‹åŠ¡æ˜¯å¦å¯ä»¥çœ‹åˆ°è¯¥æ•°æ®ç‰ˆæœ¬ã€‚</p>
<p><img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="https://cdn.jsdelivr.net/gh/JakicDong/blog-assets@main/images/20251012194342.png" alt="20251012194342"><br>luozhiyunï¼šReadView</p>
<h4 id="è¯·è¯¦ç»†è¯´è¯´ä»€ä¹ˆæ˜¯ç‰ˆæœ¬é“¾ï¼Ÿ"><a href="#è¯·è¯¦ç»†è¯´è¯´ä»€ä¹ˆæ˜¯ç‰ˆæœ¬é“¾ï¼Ÿ" class="headerlink" title="è¯·è¯¦ç»†è¯´è¯´ä»€ä¹ˆæ˜¯ç‰ˆæœ¬é“¾ï¼Ÿ"></a>è¯·è¯¦ç»†è¯´è¯´ä»€ä¹ˆæ˜¯ç‰ˆæœ¬é“¾ï¼Ÿ</h4><p>ç‰ˆæœ¬é“¾æ˜¯æŒ‡ InnoDB ä¸­åŒä¸€æ¡è®°å½•çš„å¤šä¸ªåŽ†å²ç‰ˆæœ¬ï¼Œé€šè¿‡ DB_ROLL_PTR å­—æ®µå°†å®ƒä»¬åƒé“¾è¡¨ä¸€æ ·ä¸²èµ·æ¥ï¼Œç”¨æ¥æ”¯æŒ MVCC çš„å¿«ç…§è¯»ã€‚</p>
<p><img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="https://cdn.jsdelivr.net/gh/JakicDong/blog-assets@main/images/20251012194355.png" alt="20251012194355"><br>äºŒå“¥çš„ Java è¿›é˜¶ä¹‹è·¯ï¼šç‰ˆæœ¬é“¾</p>
<p>å‡è®¾æœ‰ä¸€å¼ <code>hero</code>è¡¨ï¼Œè¡¨ä¸­æœ‰è¿™æ ·ä¸€è¡Œè®°å½•ï¼Œname ä¸ºå¼ ä¸‰ï¼Œcity ä¸ºå¸éƒ½ï¼Œæ’å…¥è¿™è¡Œè®°å½•çš„äº‹åŠ¡ id æ˜¯ 80ã€‚</p>
<p>æ­¤æ—¶ï¼Œ<code>DB_TRX_ID</code>çš„å€¼å°±æ˜¯ 80ï¼Œ<code>DB_ROLL_PTR</code>çš„å€¼å°±æ˜¯æŒ‡å‘è¿™æ¡ insert undo æ—¥å¿—çš„æŒ‡é’ˆã€‚</p>
<p><img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="https://cdn.jsdelivr.net/gh/JakicDong/blog-assets@main/images/20251012194406.png" alt="20251012194406"><br>ä¸‰åˆ†æ¶é¢æ¸£é€†è¢­ï¼šDB_ROLL_PTR</p>
<p>æŽ¥ä¸‹æ¥ï¼Œå¦‚æžœæœ‰ä¸¤ä¸ª<code>DB_TRX_ID</code>åˆ†åˆ«ä¸º<code>100</code>ã€<code>200</code>çš„äº‹åŠ¡å¯¹è¿™æ¡è®°å½•è¿›è¡Œäº†<code>update</code>æ“ä½œï¼Œé‚£ä¹ˆè¿™æ¡è®°å½•çš„ç‰ˆæœ¬é“¾å°±ä¼šå˜æˆä¸‹é¢è¿™æ ·ï¼š</p>
<p><img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="https://cdn.jsdelivr.net/gh/JakicDong/blog-assets@main/images/20251012194414.png" alt="20251012194414"><br>ä¸‰åˆ†æ¶é¢æ¸£é€†è¢­ï¼šupdate æ“ä½œ</p>
<p>ä¹Ÿå°±æ˜¯è¯´ï¼Œå½“æ›´æ–°ä¸€è¡Œæ•°æ®æ—¶ï¼ŒInnoDB ä¸ä¼šç›´æŽ¥è¦†ç›–åŽŸæœ‰æ•°æ®ï¼Œè€Œæ˜¯åˆ›å»ºä¸€ä¸ªæ–°çš„æ•°æ®ç‰ˆæœ¬ï¼Œå¹¶æ›´æ–° DB_TRX_ID å’Œ DB_ROLL_PTRï¼Œä½¿å®ƒä»¬æŒ‡å‘å‰ä¸€ä¸ªç‰ˆæœ¬å’Œç›¸å…³çš„ undo æ—¥å¿—ã€‚</p>
<p>è¿™æ ·ï¼Œè€ç‰ˆæœ¬çš„æ•°æ®å°±ä¸ä¼šä¸¢å¤±ï¼Œå¯ä»¥é€šè¿‡ç‰ˆæœ¬é“¾æ‰¾åˆ°ã€‚</p>
<p>ç”±äºŽ undo æ—¥å¿—ä¼šè®°å½•æ¯ä¸€æ¬¡çš„ updateï¼Œå¹¶ä¸”æ–°æ’å…¥çš„è¡Œæ•°æ®ä¼šè®°å½•ä¸Šä¸€æ¡ undo æ—¥å¿—çš„æŒ‡é’ˆï¼Œæ‰€ä»¥å¯ä»¥é€šè¿‡ DB_ROLL_PTR è¿™ä¸ªæŒ‡é’ˆæ‰¾åˆ°ä¸Šä¸€æ¡è®°å½•ï¼Œè¿™æ ·å°±å½¢æˆäº†ä¸€ä¸ªç‰ˆæœ¬é“¾ã€‚</p>
<p><img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="https://cdn.jsdelivr.net/gh/JakicDong/blog-assets@main/images/20251012194427.png" alt="20251012194427"><br>ä¸‰åˆ†æ¶é¢æ¸£é€†è¢­ï¼šç‰ˆæœ¬é“¾</p>
<h4 id="è¯·è¯¦ç»†è¯´è¯´ä»€ä¹ˆæ˜¯ReadViewï¼Ÿ"><a href="#è¯·è¯¦ç»†è¯´è¯´ä»€ä¹ˆæ˜¯ReadViewï¼Ÿ" class="headerlink" title="è¯·è¯¦ç»†è¯´è¯´ä»€ä¹ˆæ˜¯ReadViewï¼Ÿ"></a>è¯·è¯¦ç»†è¯´è¯´ä»€ä¹ˆæ˜¯ReadViewï¼Ÿ</h4><p>ReadView æ˜¯ InnoDB ä¸ºæ¯ä¸ªäº‹åŠ¡åˆ›å»ºçš„ä¸€ä»½â€œå¯è§æ€§è§†å›¾â€ï¼Œç”¨äºŽåˆ¤æ–­åœ¨æ‰§è¡Œå¿«ç…§è¯»æ—¶ï¼Œå“ªäº›æ•°æ®ç‰ˆæœ¬æ˜¯å½“å‰è¿™ä¸ªäº‹åŠ¡å¯ä»¥çœ‹åˆ°çš„ï¼Œå“ªäº›ä¸èƒ½çœ‹åˆ°ã€‚</p>
<p><img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="https://cdn.jsdelivr.net/gh/JakicDong/blog-assets@main/images/20251012194443.png" alt="20251012194443"><br>äºŒå“¥çš„ Java è¿›é˜¶ä¹‹è·¯ï¼šReadView</p>
<p>å½“äº‹åŠ¡å¼€å§‹æ‰§è¡Œæ—¶ï¼ŒInnoDB ä¼šä¸ºè¯¥äº‹åŠ¡åˆ›å»ºä¸€ä¸ª ReadViewï¼Œè¿™ä¸ª ReadView ä¼šè®°å½• 4 ä¸ªé‡è¦çš„ä¿¡æ¯ï¼š</p>
<ul>
<li>creator_trx_idï¼šåˆ›å»ºè¯¥ ReadView çš„äº‹åŠ¡ IDã€‚</li>
<li>m_idsï¼šæ‰€æœ‰æ´»è·ƒäº‹åŠ¡çš„ ID åˆ—è¡¨ï¼Œæ´»è·ƒäº‹åŠ¡æ˜¯æŒ‡é‚£äº›å·²ç»å¼€å§‹ä½†å°šæœªæäº¤çš„äº‹åŠ¡ã€‚</li>
<li>min_trx_idï¼šæ‰€æœ‰æ´»è·ƒäº‹åŠ¡ä¸­æœ€å°çš„äº‹åŠ¡ IDã€‚å®ƒæ˜¯ m_ids æ•°ç»„ä¸­æœ€å°çš„äº‹åŠ¡ IDã€‚</li>
<li>max_trx_id ï¼šäº‹åŠ¡ ID çš„æœ€å¤§å€¼åŠ ä¸€ã€‚æ¢å¥è¯è¯´ï¼Œå®ƒæ˜¯ä¸‹ä¸€ä¸ªå°†è¦ç”Ÿæˆçš„äº‹åŠ¡ IDã€‚</li>
</ul>
<h4 id="ReadView-æ˜¯å¦‚ä½•åˆ¤æ–­è®°å½•çš„æŸä¸ªç‰ˆæœ¬æ˜¯å¦å¯è§çš„ï¼Ÿ"><a href="#ReadView-æ˜¯å¦‚ä½•åˆ¤æ–­è®°å½•çš„æŸä¸ªç‰ˆæœ¬æ˜¯å¦å¯è§çš„ï¼Ÿ" class="headerlink" title="ReadView æ˜¯å¦‚ä½•åˆ¤æ–­è®°å½•çš„æŸä¸ªç‰ˆæœ¬æ˜¯å¦å¯è§çš„ï¼Ÿ"></a>ReadView æ˜¯å¦‚ä½•åˆ¤æ–­è®°å½•çš„æŸä¸ªç‰ˆæœ¬æ˜¯å¦å¯è§çš„ï¼Ÿ</h4><p>ä¼šé€šè¿‡ä¸‰ä¸ªæ­¥éª¤æ¥åˆ¤æ–­ï¼š</p>
<p><img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="https://cdn.jsdelivr.net/gh/JakicDong/blog-assets@main/images/20251012194516.png" alt="20251012194516"><br>äºŒå“¥çš„ Java è¿›é˜¶ä¹‹è·¯ï¼šReadViewåˆ¤æ–­è§„åˆ™</p>
<p>â‘ ã€å¦‚æžœæŸä¸ªæ•°æ®ç‰ˆæœ¬çš„ DB_TRX_ID å°äºŽ min_trx_idï¼Œåˆ™è¯¥æ•°æ®ç‰ˆæœ¬åœ¨ç”Ÿæˆ ReadView ä¹‹å‰å°±å·²ç»æäº¤ï¼Œå› æ­¤å¯¹å½“å‰äº‹åŠ¡æ˜¯å¯è§çš„ã€‚</p>
<p>â‘¡ã€å¦‚æžœ DB_TRX_ID å¤§äºŽ max_trx_idï¼Œåˆ™è¡¨ç¤ºåˆ›å»ºè¯¥æ•°æ®ç‰ˆæœ¬çš„äº‹åŠ¡åœ¨ç”Ÿæˆ ReadView ä¹‹åŽå¼€å§‹ï¼Œå› æ­¤å¯¹å½“å‰äº‹åŠ¡ä¸å¯è§ã€‚</p>
<p>â‘¢ã€å¦‚æžœ DB_TRX_ID åœ¨ min_trx_id å’Œ max_trx_id ä¹‹é—´ï¼Œéœ€è¦åˆ¤æ–­ DB_TRX_ID æ˜¯å¦åœ¨ m_ids åˆ—è¡¨ä¸­ï¼š</p>
<ul>
<li>ä¸åœ¨ï¼Œè¡¨ç¤ºåˆ›å»ºè¯¥æ•°æ®ç‰ˆæœ¬çš„äº‹åŠ¡åœ¨ç”Ÿæˆ ReadView ä¹‹åŽå·²ç»æäº¤ï¼Œå› æ­¤å¯¹å½“å‰äº‹åŠ¡ä¹Ÿæ˜¯å¯è§çš„ã€‚</li>
<li>åœ¨ï¼Œè¡¨ç¤ºäº‹åŠ¡ä»ç„¶æ´»è·ƒï¼Œæˆ–è€…åœ¨å½“å‰äº‹åŠ¡ç”Ÿæˆ ReadView ä¹‹åŽæ‰å¼€å§‹ï¼Œå› æ­¤æ˜¯ä¸å¯è§çš„ã€‚</li>
</ul>
<p><img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="https://cdn.jsdelivr.net/gh/JakicDong/blog-assets@main/images/20251012194526.png" alt="20251012194526"><br>å°è®¸ codeï¼šå¯è§æ€§åŒ¹é…è§„åˆ™</p>
<p>ä¸¾ä¸ªå®žé™…çš„ä¾‹å­ã€‚</p>
<p>è¯»äº‹åŠ¡å¼€å¯äº†ä¸€ä¸ª ReadViewï¼Œè¿™ä¸ª ReadView é‡Œé¢è®°å½•äº†å½“å‰æ´»è·ƒäº‹åŠ¡çš„ ID åˆ—è¡¨ï¼ˆ444ã€555ã€665ï¼‰ï¼Œä»¥åŠæœ€å°äº‹åŠ¡ IDï¼ˆ444ï¼‰å’Œæœ€å¤§äº‹åŠ¡ IDï¼ˆ666ï¼‰ã€‚å½“ç„¶è¿˜æœ‰è‡ªå·±çš„äº‹åŠ¡ ID 520ï¼Œä¹Ÿå°±æ˜¯ creator_trx_idã€‚</p>
<p>å®ƒè¦è¯»çš„è¿™è¡Œæ•°æ®çš„å†™äº‹åŠ¡ ID æ˜¯ xï¼Œä¹Ÿå°±æ˜¯ DB_TRX_IDã€‚</p>
<ul>
<li>å¦‚æžœ x &#x3D; 110ï¼Œæ˜¾ç„¶åœ¨ ReadView ç”Ÿæˆä¹‹å‰å°±æäº¤äº†ï¼Œæ‰€ä»¥è¿™è¡Œæ•°æ®æ˜¯å¯è§çš„ã€‚</li>
<li>å¦‚æžœ x &#x3D; 667ï¼Œæ˜¾ç„¶æ˜¯æœªçŸ¥ä¸–ç•Œï¼Œæ‰€ä»¥è¿™è¡Œæ•°æ®å¯¹è¯»æ“ä½œæ˜¯ä¸å¯è§çš„ã€‚</li>
<li>å¦‚æžœ x &#x3D; 519ï¼Œè™½ç„¶ 519 å¤§äºŽ 444 å°äºŽ 666ï¼Œä½†æ˜¯ 519 ä¸åœ¨æ´»è·ƒäº‹åŠ¡åˆ—è¡¨é‡Œï¼Œæ‰€ä»¥è¿™è¡Œæ•°æ®æ˜¯å¯è§çš„ã€‚å› ä¸º 519 æ˜¯åœ¨ 520 ç”Ÿæˆ ReadView ä¹‹å‰å°±æäº¤äº†ã€‚</li>
<li>å¦‚æžœ x &#x3D; 555ï¼Œè™½ç„¶ 555 å¤§äºŽ 444 å°äºŽ 666ï¼Œä½†æ˜¯ 555 åœ¨æ´»è·ƒäº‹åŠ¡åˆ—è¡¨é‡Œï¼Œæ‰€ä»¥è¿™è¡Œæ•°æ®æ˜¯ä¸å¯è§çš„ã€‚å› ä¸º 555 ä¸ç¡®å®šæœ‰æ²¡æœ‰æäº¤ã€‚</li>
</ul>
<h4 id="å¯é‡å¤è¯»å’Œè¯»å·²æäº¤åœ¨-ReadView-ä¸Šçš„åŒºåˆ«æ˜¯ä»€ä¹ˆï¼Ÿ"><a href="#å¯é‡å¤è¯»å’Œè¯»å·²æäº¤åœ¨-ReadView-ä¸Šçš„åŒºåˆ«æ˜¯ä»€ä¹ˆï¼Ÿ" class="headerlink" title="å¯é‡å¤è¯»å’Œè¯»å·²æäº¤åœ¨ ReadView ä¸Šçš„åŒºåˆ«æ˜¯ä»€ä¹ˆï¼Ÿ"></a>å¯é‡å¤è¯»å’Œè¯»å·²æäº¤åœ¨ ReadView ä¸Šçš„åŒºåˆ«æ˜¯ä»€ä¹ˆï¼Ÿ</h4><p>å¯é‡å¤è¯»ï¼šåœ¨ç¬¬ä¸€æ¬¡è¯»å–æ•°æ®æ—¶ç”Ÿæˆä¸€ä¸ª ReadViewï¼Œè¿™ä¸ª ReadView ä¼šä¸€ç›´ä¿æŒåˆ°äº‹åŠ¡ç»“æŸï¼Œè¿™æ ·å¯ä»¥ä¿è¯åœ¨äº‹åŠ¡ä¸­å¤šæ¬¡è¯»å–åŒä¸€è¡Œæ•°æ®æ—¶ï¼Œè¯»å–åˆ°çš„æ•°æ®æ˜¯ä¸€è‡´çš„ã€‚</p>
<p><img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="https://cdn.jsdelivr.net/gh/JakicDong/blog-assets@main/images/20251012194544.png" alt="20251012194544"><br>ç¨‹åºå‘˜xï¼šreadview åœ¨å¯é‡å¤è¯»å’Œè¯»å·²æäº¤ä¸‹çš„ä¸åŒ</p>
<p>è¯»å·²æäº¤ï¼šæ¯æ¬¡è¯»å–æ•°æ®å‰éƒ½ç”Ÿæˆä¸€ä¸ª ReadViewï¼Œè¿™æ ·å°±èƒ½ä¿è¯æ¯æ¬¡è¯»å–çš„æ•°æ®éƒ½æ˜¯æœ€æ–°çš„ã€‚</p>
<p>æŽ¨èé˜…è¯»ï¼š<a target="_blank" rel="noopener" href="http://xiaoyuge.work/mysql-innodb-mvcc/index.html">æžæ‡‚Mysqlä¹‹InnoDB MVCC</a></p>
<h4 id="å¦‚æžœä¸¤ä¸ª-AB-äº‹åŠ¡å¹¶å‘ä¿®æ”¹ä¸€ä¸ªå˜é‡ï¼Œé‚£ä¹ˆ-A-è¯»åˆ°çš„å€¼æ˜¯ä»€ä¹ˆï¼Œæ€Žä¹ˆåˆ†æžã€‚"><a href="#å¦‚æžœä¸¤ä¸ª-AB-äº‹åŠ¡å¹¶å‘ä¿®æ”¹ä¸€ä¸ªå˜é‡ï¼Œé‚£ä¹ˆ-A-è¯»åˆ°çš„å€¼æ˜¯ä»€ä¹ˆï¼Œæ€Žä¹ˆåˆ†æžã€‚" class="headerlink" title="å¦‚æžœä¸¤ä¸ª AB äº‹åŠ¡å¹¶å‘ä¿®æ”¹ä¸€ä¸ªå˜é‡ï¼Œé‚£ä¹ˆ A è¯»åˆ°çš„å€¼æ˜¯ä»€ä¹ˆï¼Œæ€Žä¹ˆåˆ†æžã€‚"></a>å¦‚æžœä¸¤ä¸ª AB äº‹åŠ¡å¹¶å‘ä¿®æ”¹ä¸€ä¸ªå˜é‡ï¼Œé‚£ä¹ˆ A è¯»åˆ°çš„å€¼æ˜¯ä»€ä¹ˆï¼Œæ€Žä¹ˆåˆ†æžã€‚</h4><p>äº‹åŠ¡ A åœ¨è¯»å–æ—¶æ˜¯å¦èƒ½è¯»åˆ°äº‹åŠ¡ B çš„ä¿®æ”¹ï¼Œå–å†³äºŽ A æ˜¯å¿«ç…§è¯»è¿˜æ˜¯å½“å‰è¯»ã€‚å¦‚æžœæ˜¯å¿«ç…§è¯»ï¼ŒInnoDB ä¼šä½¿ç”¨ MVCC çš„ ReadView åˆ¤æ–­è®°å½•ç‰ˆæœ¬æ˜¯å¦å¯è§ï¼Œè‹¥äº‹åŠ¡ B å°šæœªæäº¤æˆ–åœ¨ A çš„è§†å›¾ä¸å¯è§ï¼Œåˆ™ A ä¼šè¯»åˆ°æ—§å€¼ï¼›å¦‚æžœæ˜¯å½“å‰è¯»ï¼Œåˆ™éœ€è¦åŠ é”ï¼Œè‹¥ B å·²æäº¤å¯ç›´æŽ¥è¯»å–ï¼Œå¦åˆ™ A ä¼šé˜»å¡žç›´åˆ° B ç»“æŸã€‚</p>
<h3 id="70-ðŸŒŸä½ ä»¬ä¸€èˆ¬æ˜¯æ€Žä¹ˆåˆ†åº“çš„å‘¢ï¼Ÿ"><a href="#70-ðŸŒŸä½ ä»¬ä¸€èˆ¬æ˜¯æ€Žä¹ˆåˆ†åº“çš„å‘¢ï¼Ÿ" class="headerlink" title="70.ðŸŒŸä½ ä»¬ä¸€èˆ¬æ˜¯æ€Žä¹ˆåˆ†åº“çš„å‘¢ï¼Ÿ"></a>70.ðŸŒŸä½ ä»¬ä¸€èˆ¬æ˜¯æ€Žä¹ˆåˆ†åº“çš„å‘¢ï¼Ÿ</h3><p>åˆ†åº“çš„ç­–ç•¥æœ‰ä¸¤ç§ï¼Œç¬¬ä¸€ç§æ˜¯åž‚ç›´åˆ†åº“ï¼šæŒ‰ç…§ä¸šåŠ¡æ¨¡å—å°†ä¸åŒçš„è¡¨æ‹†åˆ†åˆ°ä¸åŒçš„åº“ä¸­ï¼Œæ¯”å¦‚è¯´ç”¨æˆ·ã€ç™»å½•ã€æƒé™ç­‰è¡¨æ”¾åœ¨ç”¨æˆ·åº“ä¸­ï¼Œå•†å“ã€åˆ†ç±»ã€åº“å­˜æ”¾åœ¨å•†å“åº“ä¸­ï¼Œä¼˜æƒ åˆ¸ã€æ»¡å‡ã€ç§’æ€æ”¾åœ¨æ´»åŠ¨åº“ä¸­ã€‚</p>
<p><img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="https://cdn.jsdelivr.net/gh/JakicDong/blog-assets@main/images/20251012195251.png" alt="20251012195251"><br>ä¸‰åˆ†æ¶é¢æ¸£é€†è¢­ï¼šåž‚ç›´åˆ†åº“</p>
<p>ç¬¬äºŒç§æ˜¯æ°´å¹³åˆ†åº“ï¼šæŒ‰ç…§ä¸€å®šçš„ç­–ç•¥å°†ä¸€ä¸ªè¡¨ä¸­çš„æ•°æ®æ‹†åˆ†åˆ°å¤šä¸ªåº“ä¸­ï¼Œæ¯”å¦‚å“ˆå¸Œåˆ†ç‰‡å’ŒèŒƒå›´åˆ†ç‰‡ï¼Œå¯¹ç”¨æˆ· id è¿›è¡Œå–æ¨¡è¿ç®—æˆ–è€…èŒƒå›´åˆ’åˆ†ï¼Œå°†æ•°æ®åˆ†æ•£åˆ°ä¸åŒçš„åº“ä¸­ã€‚</p>
<p><img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="https://cdn.jsdelivr.net/gh/JakicDong/blog-assets@main/images/20251012195301.png" alt="20251012195301"><br>ä¸‰åˆ†æ¶é¢æ¸£é€†è¢­ï¼šæ°´å¹³åˆ†åº“</p>
<p>è´´ä¸€æ®µä½¿ç”¨ ShardingSphere çš„ inline ç®—æ³•å®šä¹‰åˆ†ç‰‡è§„åˆ™ï¼š</p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">rules:</span></span><br><span class="line"><span class="bullet">-</span> <span class="type">!SHARDING</span></span><br><span class="line">  <span class="attr">tables:</span></span><br><span class="line">    <span class="attr">order:</span></span><br><span class="line">      <span class="attr">actualDataNodes:</span> <span class="string">db_$&#123;0..3&#125;.order_$&#123;0..15&#125;</span></span><br><span class="line">      <span class="attr">databaseStrategy:</span></span><br><span class="line">        <span class="attr">standard:</span></span><br><span class="line">          <span class="attr">shardingColumn:</span> <span class="string">user_id</span></span><br><span class="line">          <span class="attr">shardingAlgorithmName:</span> <span class="string">db_hash_mod</span></span><br><span class="line">      <span class="attr">tableStrategy:</span></span><br><span class="line">        <span class="attr">standard:</span></span><br><span class="line">          <span class="attr">shardingColumn:</span> <span class="string">order_time</span></span><br><span class="line">          <span class="attr">shardingAlgorithmName:</span> <span class="string">table_interval_yearly</span></span><br><span class="line">  <span class="attr">shardingAlgorithms:</span></span><br><span class="line">    <span class="attr">db_hash_mod:</span></span><br><span class="line">      <span class="attr">type:</span> <span class="string">HASH_MOD</span></span><br><span class="line">      <span class="attr">props:</span></span><br><span class="line">        <span class="attr">sharding-count:</span> <span class="number">4</span></span><br><span class="line">    <span class="attr">table_interval_yearly:</span></span><br><span class="line">      <span class="attr">type:</span> <span class="string">INTERVAL</span></span><br><span class="line">      <span class="attr">props:</span></span><br><span class="line">        <span class="attr">datetime-pattern:</span> <span class="string">&#x27;yyyy-MM-dd HH:mm:ss&#x27;</span></span><br><span class="line">        <span class="attr">datetime-lower:</span> <span class="string">&#x27;2024-01-01 00:00:00&#x27;</span></span><br><span class="line">        <span class="attr">datetime-upper:</span> <span class="string">&#x27;2025-01-01 00:00:00&#x27;</span></span><br><span class="line">        <span class="attr">sharding-suffix-pattern:</span> <span class="string">&#x27;yyyy&#x27;</span></span><br><span class="line">        <span class="attr">datetime-interval-amount:</span> <span class="number">1</span></span><br><span class="line">        <span class="attr">datetime-interval-unit:</span> <span class="string">&#x27;Years&#x27;</span></span><br></pre></td></tr></table></figure>

<h3 id="71-ðŸŒŸé‚£ä½ ä»¬æ˜¯æ€Žä¹ˆåˆ†è¡¨çš„ï¼Ÿ"><a href="#71-ðŸŒŸé‚£ä½ ä»¬æ˜¯æ€Žä¹ˆåˆ†è¡¨çš„ï¼Ÿ" class="headerlink" title="71.ðŸŒŸé‚£ä½ ä»¬æ˜¯æ€Žä¹ˆåˆ†è¡¨çš„ï¼Ÿ"></a>71.ðŸŒŸé‚£ä½ ä»¬æ˜¯æ€Žä¹ˆåˆ†è¡¨çš„ï¼Ÿ</h3><p>å½“å•è¡¨è¶…è¿‡ 500 ä¸‡æ¡æ•°æ®ï¼Œå°±å¯ä»¥è€ƒè™‘æ°´å¹³åˆ†è¡¨äº†ã€‚æ¯”å¦‚è¯´æˆ‘ä»¬å¯ä»¥å°†æ–‡ç« è¡¨æ‹†åˆ†æˆå¤šä¸ªè¡¨ï¼Œå¦‚ article_0ã€article_9999ã€article_19999 ç­‰ã€‚</p>
<p><img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="https://cdn.jsdelivr.net/gh/JakicDong/blog-assets@main/images/20251012195335.png" alt="20251012195335"><br>ä¸‰åˆ†æ¶é¢æ¸£é€†è¢­ï¼šè¡¨æ‹†åˆ†</p>
<p>åœ¨<a target="_blank" rel="noopener" href="https://javabetter.cn/zhishixingqiu/paicoding.html">æŠ€æœ¯æ´¾å®žæˆ˜é¡¹ç›®</a>ä¸­ï¼Œæˆ‘ä»¬å°†æ–‡ç« çš„åŸºæœ¬ä¿¡æ¯å’Œå†…å®¹è¯¦æƒ…åšäº†åž‚ç›´åˆ†è¡¨å¤„ç†ï¼Œå› ä¸ºæ–‡ç« çš„å†…å®¹ä¼šå ç”¨æ¯”è¾ƒå¤§çš„ç©ºé—´ï¼Œåœ¨åªéœ€è¦æŸ¥çœ‹æ–‡ç« åŸºæœ¬ä¿¡æ¯æ—¶æŠŠæ–‡ç« è¯¦æƒ…ä¹Ÿå¸¦å‡ºæ¥çš„è¯ï¼Œå°±ä¼šå ç”¨æ›´å¤šçš„ç½‘ç»œ IO å’Œå†…å­˜å¯¼è‡´æŸ¥è¯¢å˜æ…¢ï¼›è€Œæ–‡ç« çš„åŸºæœ¬ä¿¡æ¯ï¼Œå¦‚æ ‡é¢˜ã€ä½œè€…ã€çŠ¶æ€ç­‰ä¿¡æ¯å ç”¨çš„ç©ºé—´è¾ƒå°ï¼Œå¾ˆé€‚åˆä¸éœ€è¦æŸ¥è¯¢æ–‡ç« è¯¦æƒ…çš„åœºæ™¯ã€‚</p>
<p><img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="https://cdn.jsdelivr.net/gh/JakicDong/blog-assets@main/images/20251012195346.png" alt="20251012195346"><br>äºŒå“¥çš„ Java è¿›é˜¶ä¹‹è·¯ï¼šæ–‡ç« å’Œè¯¦æƒ…åž‚ç›´åˆ†è¡¨</p>
<h2 id="Redis"><a href="#Redis" class="headerlink" title="Redis"></a>Redis</h2><h3 id="1-ðŸŒŸè¯´è¯´ä»€ä¹ˆæ˜¯-Redis"><a href="#1-ðŸŒŸè¯´è¯´ä»€ä¹ˆæ˜¯-Redis" class="headerlink" title="1.ðŸŒŸè¯´è¯´ä»€ä¹ˆæ˜¯ Redis?"></a>1.ðŸŒŸè¯´è¯´ä»€ä¹ˆæ˜¯ Redis?</h3><p><code>Redis</code> æ˜¯ä¸€ç§åŸºäºŽé”®å€¼å¯¹çš„ <code>NoSQL</code> æ•°æ®åº“ã€‚</p>
<p><img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="https://cdn.jsdelivr.net/gh/JakicDong/blog-assets@main/images/20250725112831.png" alt="20250725112831"></p>
<p>å®ƒä¸»è¦çš„ç‰¹ç‚¹æ˜¯æŠŠæ•°æ®æ”¾åœ¨<code>å†…å­˜</code>å½“ä¸­ï¼Œç›¸æ¯”ç›´æŽ¥è®¿é—®ç£ç›˜çš„å…³ç³»åž‹æ•°æ®åº“ï¼Œ<strong>è¯»å†™é€Ÿåº¦ä¼šå¿«å¾ˆå¤š</strong>ï¼ŒåŸºæœ¬ä¸Šèƒ½è¾¾åˆ°å¾®ç§’çº§çš„å“åº”ã€‚</p>
<p>æ‰€ä»¥åœ¨ä¸€äº›å¯¹<code>æ€§èƒ½è¦æ±‚å¾ˆé«˜</code>çš„åœºæ™¯ï¼Œæ¯”å¦‚<strong>ç¼“å­˜çƒ­ç‚¹æ•°æ®ã€é˜²æ­¢æŽ¥å£çˆ†åˆ·</strong>ï¼Œéƒ½ä¼šç”¨åˆ° Redisã€‚</p>
<p>ä¸ä»…å¦‚æ­¤ï¼ŒRedis è¿˜<code>æ”¯æŒæŒä¹…åŒ–</code>ï¼Œå¯ä»¥å°†å†…å­˜ä¸­çš„æ•°æ®å¼‚æ­¥è½ç›˜ï¼Œä»¥ä¾¿æœåŠ¡å®•æœºé‡å¯åŽèƒ½æ¢å¤æ•°æ®ã€‚</p>
<h4 id="Redis-å’Œ-MySQL-çš„åŒºåˆ«ï¼Ÿ"><a href="#Redis-å’Œ-MySQL-çš„åŒºåˆ«ï¼Ÿ" class="headerlink" title="Redis å’Œ MySQL çš„åŒºåˆ«ï¼Ÿ"></a>Redis å’Œ MySQL çš„åŒºåˆ«ï¼Ÿ</h4><p>Redis å±žäºŽ<strong>éžå…³ç³»åž‹æ•°æ®åº“</strong>ï¼Œæ•°æ®æ˜¯é€šè¿‡<code>é”®å€¼å¯¹</code>çš„å½¢å¼æ”¾åœ¨å†…å­˜å½“ä¸­çš„ï¼›MySQL å±žäºŽ<strong>å…³ç³»åž‹æ•°æ®åº“</strong>ï¼Œæ•°æ®ä»¥<code>è¡Œå’Œåˆ—çš„å½¢å¼</code>å­˜å‚¨åœ¨ç£ç›˜å½“ä¸­ã€‚</p>
<p><img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="https://cdn.jsdelivr.net/gh/JakicDong/blog-assets@main/images/20250725112927.png" alt="20250725112927"></p>
<p>å®žé™…å¼€å‘ä¸­ï¼Œä¼šå°† <code>MySQL</code> ä½œä¸ºä¸»å­˜å‚¨ï¼Œ<code>Redis</code> ä½œä¸ºç¼“å­˜ï¼Œé€šè¿‡å…ˆæŸ¥ <code>Redis</code>ï¼Œæœªå‘½ä¸­å†æŸ¥ <code>MySQL</code> å¹¶å†™å›ž<code>Redi</code>s çš„æ–¹å¼æ¥æé«˜ç³»ç»Ÿçš„æ•´ä½“æ€§èƒ½ã€‚</p>
<h4 id="TecHubé¡¹ç›®é‡Œå“ªé‡Œç”¨åˆ°äº†-Redisï¼Ÿ"><a href="#TecHubé¡¹ç›®é‡Œå“ªé‡Œç”¨åˆ°äº†-Redisï¼Ÿ" class="headerlink" title="TecHubé¡¹ç›®é‡Œå“ªé‡Œç”¨åˆ°äº† Redisï¼Ÿ"></a>TecHubé¡¹ç›®é‡Œå“ªé‡Œç”¨åˆ°äº† Redisï¼Ÿ</h4><p>åœ¨TecHubå®žæˆ˜é¡¹ç›®å½“ä¸­ï¼Œæœ‰å¾ˆå¤šåœ°æ–¹éƒ½ç”¨åˆ°äº† Redisï¼Œæ¯”å¦‚è¯´<code>ç”¨æˆ·æ´»è·ƒæŽ’è¡Œæ¦œ</code>ç”¨åˆ°äº† <code>zset</code>ï¼Œ<code>ä½œè€…ç™½åå•</code>ç”¨åˆ°äº† <code>set</code>ã€‚<br>è¿˜æœ‰ç”¨æˆ·ç™»å½•åŽçš„ <code>Session</code>ã€ç«™ç‚¹åœ°å›¾ <code>SiteMap</code>ï¼Œåˆ†åˆ«ç”¨åˆ°äº† Redis çš„å­—ç¬¦ä¸²å’Œå“ˆå¸Œè¡¨ä¸¤ç§æ•°æ®ç±»åž‹ã€‚<br>å…¶ä¸­æ¯”è¾ƒæœ‰æŒ‘æˆ˜æ€§çš„ä¸€ä¸ªåº”ç”¨æ˜¯ï¼Œé€šè¿‡ Lua è„šæœ¬å°è£… Redis çš„ setnex å‘½ä»¤æ¥å®žçŽ°<strong>åˆ†å¸ƒå¼é”</strong>ï¼Œä»¥ä¿è¯åœ¨é«˜å¹¶å‘åœºæ™¯ä¸‹ï¼Œçƒ­ç‚¹æ–‡ç« åœ¨çŸ­æ—¶é—´å†…çš„é«˜é¢‘è®¿é—®ä¸ä¼šå‡»ç©¿ MySQLã€‚</p>
<h4 id="éƒ¨ç½²è¿‡-Redis-å—ï¼Ÿ"><a href="#éƒ¨ç½²è¿‡-Redis-å—ï¼Ÿ" class="headerlink" title="éƒ¨ç½²è¿‡ Redis å—ï¼Ÿ"></a>éƒ¨ç½²è¿‡ Redis å—ï¼Ÿ</h4><p>ç¬¬ä¸€ç§å›žç­”ç‰ˆæœ¬ï¼š</p>
<p>æˆ‘åªåœ¨æœ¬åœ°éƒ¨ç½²è¿‡å•æœºç‰ˆï¼Œä¸‹è½½ Redis çš„å®‰è£…åŒ…ï¼Œè§£åŽ‹åŽè¿è¡ŒÂ <code>redis-server</code>Â å‘½ä»¤å³å¯ã€‚</p>
<p>ç¬¬äºŒç§å›žç­”ç‰ˆæœ¬ï¼š</p>
<p>æˆ‘æœ‰åœ¨ç”Ÿäº§çŽ¯å¢ƒä¸­éƒ¨ç½²å•æœºç‰ˆ Redisï¼Œä»Žå®˜ç½‘ä¸‹è½½æºç åŒ…è§£åŽ‹åŽæ‰§è¡ŒÂ <code>make &amp;&amp; make install</code>Â ç¼–è¯‘å®‰è£…ã€‚ç„¶åŽç¼–è¾‘Â <code>redis.conf</code>Â æ–‡ä»¶ï¼Œå¼€å¯è¿œç¨‹è®¿é—®ã€è®¾ç½®å¯†ç ã€é™åˆ¶å†…å­˜ã€è®¾ç½®å†…å­˜è¿‡æœŸæ·˜æ±°ç­–ç•¥ã€å¼€å¯ AOF æŒä¹…åŒ–ç­‰ï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">bind 0.0.0.0        # å…è®¸è¿œç¨‹è®¿é—®</span><br><span class="line">requirepass your_password  # è®¾ç½®å¯†ç </span><br><span class="line">maxmemory 4gb      # é™åˆ¶å†…å­˜ï¼Œé¿å… OOM</span><br><span class="line">maxmemory-policy allkeys-lru  # å†…å­˜æ·˜æ±°ç­–ç•¥</span><br><span class="line">appendonly yes     # å¼€å¯ AOF æŒä¹…åŒ–</span><br></pre></td></tr></table></figure>

<p>ç¬¬ä¸‰ç§å›žç­”ç‰ˆæœ¬ï¼š</p>
<p>æˆ‘æœ‰ä½¿ç”¨ Docker æ‹‰å– Redis é•œåƒåŽè¿›è¡Œå®¹å™¨åŒ–éƒ¨ç½²ã€‚</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker run -d --name redis -p 6379:6379 redis:7.0-alpine</span><br></pre></td></tr></table></figure>
<h4 id="Redis-çš„é«˜å¯ç”¨æ–¹æ¡ˆæœ‰éƒ¨ç½²è¿‡å—ï¼Ÿ"><a href="#Redis-çš„é«˜å¯ç”¨æ–¹æ¡ˆæœ‰éƒ¨ç½²è¿‡å—ï¼Ÿ" class="headerlink" title="Redis çš„é«˜å¯ç”¨æ–¹æ¡ˆæœ‰éƒ¨ç½²è¿‡å—ï¼Ÿ"></a>Redis çš„é«˜å¯ç”¨æ–¹æ¡ˆæœ‰éƒ¨ç½²è¿‡å—ï¼Ÿ</h4><p>æœ‰éƒ¨ç½²è¿‡<strong>å“¨å…µæœºåˆ¶</strong>ï¼Œè¿™æ˜¯ä¸€ä¸ªç›¸å¯¹æˆç†Ÿçš„<strong>é«˜å¯ç”¨è§£å†³æ–¹æ¡ˆ</strong>ï¼Œæˆ‘ä»¬ç”Ÿäº§çŽ¯å¢ƒéƒ¨ç½²çš„æ˜¯ä¸€ä¸»ä¸¤ä»Žçš„ Redis å®žä¾‹ï¼Œå†åŠ ä¸Šä¸‰ä¸ª <code>Sentinel</code> èŠ‚ç‚¹ç›‘æŽ§å®ƒä»¬ã€‚<code>Sentinel</code> çš„é…ç½®ç›¸å¯¹ç®€å•ï¼Œä¸»è¦è®¾ç½®äº†<strong>æ•…éšœè½¬ç§»çš„åˆ¤å®šæ¡ä»¶</strong>å’Œ<strong>è¶…æ—¶é˜ˆå€¼</strong>ã€‚</p>
<p>ä¸»èŠ‚ç‚¹é…ç½®ï¼š</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">port 6379</span><br><span class="line">appendonly yes&lt;/code&gt;</span><br></pre></td></tr></table></figure>
<p>ä»ŽèŠ‚ç‚¹é…ç½®ï¼š</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">replicaof 192.168.1.10 6379&lt;/code&gt;</span><br></pre></td></tr></table></figure>
<p>å“¨å…µèŠ‚ç‚¹é…ç½®ï¼š</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">sentinel monitor mymaster 192.168.1.10 6379 2</span><br><span class="line">sentinel down-after-milliseconds mymaster 5000</span><br><span class="line">sentinel failover-timeout mymaster 60000</span><br><span class="line">sentinel parallel-syncs mymaster 1</span><br></pre></td></tr></table></figure>

<p>å½“ä¸»èŠ‚ç‚¹å‘ç”Ÿæ•…éšœæ—¶ï¼Œ<code>Sentinel</code> èƒ½å¤Ÿè‡ªåŠ¨æ£€æµ‹å¹¶åå•†é€‰å‡ºæ–°çš„ä¸»èŠ‚ç‚¹ï¼Œè¿™ä¸ªè¿‡ç¨‹å¤§æ¦‚éœ€è¦ <code>10-15</code> ç§’ã€‚</p>
<p>å¦ä¸€ä¸ªå¤§åž‹é¡¹ç›®ä¸­ï¼Œæˆ‘ä»¬ä½¿ç”¨äº† <code>Redis Cluster</code> é›†ç¾¤æ–¹æ¡ˆã€‚è¯¥é¡¹ç›®æ•°æ®é‡å¤§ä¸”å¢žé•¿å¿«ï¼Œéœ€è¦æ°´å¹³æ‰©å±•èƒ½åŠ›ã€‚æˆ‘ä»¬éƒ¨ç½²äº† 6 ä¸ªä¸»èŠ‚ç‚¹ï¼Œæ¯ä¸ªä¸»èŠ‚ç‚¹é…å¤‡ä¸€ä¸ªä»ŽèŠ‚ç‚¹ï¼Œå½¢æˆäº†ä¸€ä¸ª 3ä¸»3ä»Ž çš„åˆå§‹é›†ç¾¤ã€‚<code>Redis Cluster</code> çš„è®¾ç½®æ¯”<code>Sentinel</code> å¤æ‚ä¸€äº›ï¼Œéœ€è¦æ­£ç¡®é…ç½®<strong>é›†ç¾¤èŠ‚ç‚¹é—´é€šä¿¡</strong>ã€<strong>åˆ†ç‰‡æ˜ å°„</strong>ç­‰ã€‚</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">redis-server redis-7000.conf</span><br><span class="line">redis-server redis-7001.conf</span><br><span class="line">...</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">ä½¿ç”¨ redis-cli åˆ›å»ºé›†ç¾¤</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">Redis ä¼šè‡ªåŠ¨å°† key å“ˆå¸Œåˆ° 16384 ä¸ªæ§½ä½</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">ä¸»èŠ‚ç‚¹å‡åˆ†æ§½ä½ï¼Œä»ŽèŠ‚ç‚¹è‡ªåŠ¨è·Ÿéš</span></span><br><span class="line">redis-cli --cluster create \</span><br><span class="line"> 127.0.0.1:7000 127.0.0.1:7001 127.0.0.1:7002 \</span><br><span class="line"> 127.0.0.1:7003 127.0.0.1:7004 127.0.0.1:7005 \</span><br><span class="line"> --cluster-replicas 1</span><br></pre></td></tr></table></figure>
<p><code>Redis Cluster</code> æœ€å¤§çš„ä¼˜åŠ¿æ˜¯<strong>æ•°æ®è‡ªåŠ¨åˆ†ç‰‡</strong>ï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡ç®€å•åœ°å¢žåŠ èŠ‚ç‚¹æ¥æ‰©å±•é›†ç¾¤å®¹é‡ã€‚æ­¤å¤–ï¼Œå®ƒçš„<strong>æ•…éšœè½¬ç§»ä¹Ÿå¾ˆå¿«</strong>ï¼Œé€šå¸¸åœ¨å‡ ç§’å†…å°±èƒ½å®Œæˆã€‚</p>
<p>å¯¹äºŽä¸€äº›è½»é‡çº§åº”ç”¨ï¼Œæˆ‘ä¹Ÿä½¿ç”¨è¿‡<code>ä¸»ä»Žå¤åˆ¶</code>åŠ <code>æ‰‹åŠ¨æ•…éšœè½¬ç§»</code>çš„æ–¹æ¡ˆã€‚<code>ä¸»èŠ‚ç‚¹è´Ÿè´£è¯»å†™æ“ä½œ</code>ï¼Œ<code>ä»ŽèŠ‚ç‚¹è´Ÿè´£è¯»æ“ä½œ</code>ã€‚æ‰‹åŠ¨æ•…éšœè½¬ç§»æ—¶ï¼Œæˆ‘ä»¬ä¼š<code>å…ˆå°†ä»ŽèŠ‚ç‚¹æå‡ä¸ºä¸»èŠ‚ç‚¹</code>ï¼Œç„¶åŽé‡æ–°é…ç½®å…¶ä»–ä»ŽèŠ‚ç‚¹ã€‚</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">1\. å–æ¶ˆä»ŽèŠ‚ç‚¹èº«ä»½</span></span><br><span class="line">redis-cli -h &lt;slave-ip&gt; slaveof no one</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">2\. å°†å…¶ä»–ä»ŽèŠ‚ç‚¹æŒ‡å‘æ–°çš„ä¸»èŠ‚ç‚¹</span></span><br><span class="line">redis-cli -h &lt;other-slave-ip&gt; slaveof &lt;new-master-ip&gt; &lt;port&gt;</span><br><span class="line"></span><br></pre></td></tr></table></figure>



<h3 id="3-ðŸŒŸRedisæœ‰å“ªäº›æ•°æ®ç±»åž‹ï¼Ÿ"><a href="#3-ðŸŒŸRedisæœ‰å“ªäº›æ•°æ®ç±»åž‹ï¼Ÿ" class="headerlink" title="3.ðŸŒŸRedisæœ‰å“ªäº›æ•°æ®ç±»åž‹ï¼Ÿ"></a>3.ðŸŒŸRedisæœ‰å“ªäº›æ•°æ®ç±»åž‹ï¼Ÿ</h3><p>Redis æ”¯æŒäº”ç§åŸºæœ¬æ•°æ®ç±»åž‹ï¼Œåˆ†åˆ«æ˜¯<code>å­—ç¬¦ä¸²</code>ã€<code>åˆ—è¡¨</code>ã€<code>å“ˆå¸Œ</code>ã€<code>é›†åˆ</code>å’Œ<code>æœ‰åºé›†åˆ</code>ã€‚</p>
<p><img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="https://cdn.jsdelivr.net/gh/JakicDong/blog-assets@main/images/20250811101352.png" alt="20250811101352"></p>
<p>è¿˜æœ‰ä¸‰ç§æ‰©å±•æ•°æ®ç±»åž‹ï¼Œåˆ†åˆ«æ˜¯ç”¨äºŽä½çº§æ“ä½œçš„ Bitmapã€ç”¨äºŽåŸºæ•°ä¼°ç®—çš„ HyperLogLogã€æ”¯æŒå­˜å‚¨å’ŒæŸ¥è¯¢åœ°ç†åæ ‡çš„ GEOã€‚</p>
<h4 id="è¯¦ç»†ä»‹ç»ä¸‹å­—ç¬¦ä¸²ï¼Ÿ"><a href="#è¯¦ç»†ä»‹ç»ä¸‹å­—ç¬¦ä¸²ï¼Ÿ" class="headerlink" title="è¯¦ç»†ä»‹ç»ä¸‹å­—ç¬¦ä¸²ï¼Ÿ"></a>è¯¦ç»†ä»‹ç»ä¸‹å­—ç¬¦ä¸²ï¼Ÿ</h4><p>å­—ç¬¦ä¸²æ˜¯æœ€åŸºæœ¬çš„æ•°æ®ç±»åž‹ï¼Œå¯ä»¥å­˜å‚¨æ–‡æœ¬ã€æ•°å­—æˆ–è€…äºŒè¿›åˆ¶æ•°æ®ï¼Œæœ€å¤§å®¹é‡æ˜¯ <code>512 MB</code>ã€‚</p>
<p><img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="https://cdn.jsdelivr.net/gh/JakicDong/blog-assets@main/images/20250811102451.png" alt="20250811102451"></p>
<p>é€‚åˆç¼“å­˜å•ä¸ªå¯¹è±¡ï¼Œæ¯”å¦‚éªŒè¯ç ã€tokenã€è®¡æ•°å™¨ç­‰ã€‚</p>
<h4 id="è¯¦ç»†ä»‹ç»ä¸‹åˆ—è¡¨ï¼Ÿ"><a href="#è¯¦ç»†ä»‹ç»ä¸‹åˆ—è¡¨ï¼Ÿ" class="headerlink" title="è¯¦ç»†ä»‹ç»ä¸‹åˆ—è¡¨ï¼Ÿ"></a>è¯¦ç»†ä»‹ç»ä¸‹åˆ—è¡¨ï¼Ÿ</h4><p>åˆ—è¡¨æ˜¯ä¸€ä¸ªæœ‰åºçš„å…ƒç´ é›†åˆï¼Œæ”¯æŒä»Žå¤´éƒ¨æˆ–å°¾éƒ¨æ’å…¥&#x2F;åˆ é™¤å…ƒç´ ï¼Œå¸¸ç”¨äºŽæ¶ˆæ¯é˜Ÿåˆ—æˆ–ä»»åŠ¡åˆ—è¡¨ã€‚</p>
<p><img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="https://cdn.jsdelivr.net/gh/JakicDong/blog-assets@main/images/20250811102931.png" alt="20250811102931"></p>
<h4 id="è¯¦ç»†ä»‹ç»ä¸‹å“ˆå¸Œï¼Ÿ"><a href="#è¯¦ç»†ä»‹ç»ä¸‹å“ˆå¸Œï¼Ÿ" class="headerlink" title="è¯¦ç»†ä»‹ç»ä¸‹å“ˆå¸Œï¼Ÿ"></a>è¯¦ç»†ä»‹ç»ä¸‹å“ˆå¸Œï¼Ÿ</h4><p>å“ˆå¸Œæ˜¯ä¸€ä¸ªé”®å€¼å¯¹é›†åˆï¼Œé€‚åˆå­˜å‚¨å¯¹è±¡ï¼Œå¦‚å•†å“ä¿¡æ¯ã€ç”¨æˆ·ä¿¡æ¯ç­‰ã€‚æ¯”å¦‚è¯´ <code>value = &#123;name: &#39;æ²‰é»˜çŽ‹äºŒ&#39;, age: 18&#125;</code>ã€‚</p>
<p><img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="https://cdn.jsdelivr.net/gh/JakicDong/blog-assets@main/images/20250811103014.png" alt="20250811103014"></p>
<h4 id="è¯¦ç»†ä»‹ç»ä¸‹é›†åˆï¼Ÿ"><a href="#è¯¦ç»†ä»‹ç»ä¸‹é›†åˆï¼Ÿ" class="headerlink" title="è¯¦ç»†ä»‹ç»ä¸‹é›†åˆï¼Ÿ"></a>è¯¦ç»†ä»‹ç»ä¸‹é›†åˆï¼Ÿ</h4><p>é›†åˆæ˜¯æ— åºä¸”ä¸é‡å¤çš„ï¼Œæ”¯æŒäº¤é›†ã€å¹¶é›†æ“ä½œï¼ŒæŸ¥è¯¢æ•ˆçŽ‡èƒ½è¾¾åˆ° O(1) çº§åˆ«ï¼Œä¸»è¦ç”¨äºŽåŽ»é‡ã€æ ‡ç­¾ã€å…±åŒå¥½å‹ç­‰åœºæ™¯ã€‚</p>
<p><img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="https://cdn.jsdelivr.net/gh/JakicDong/blog-assets@main/images/20250811103028.png" alt="20250811103028"></p>
<h4 id="è¯¦ç»†ä»‹ç»ä¸‹æœ‰åºé›†åˆï¼Ÿ"><a href="#è¯¦ç»†ä»‹ç»ä¸‹æœ‰åºé›†åˆï¼Ÿ" class="headerlink" title="è¯¦ç»†ä»‹ç»ä¸‹æœ‰åºé›†åˆï¼Ÿ"></a>è¯¦ç»†ä»‹ç»ä¸‹æœ‰åºé›†åˆï¼Ÿ</h4><p>æœ‰åºé›†åˆçš„å…ƒç´ æŒ‰åˆ†æ•°è¿›è¡ŒæŽ’åºï¼Œæ”¯æŒèŒƒå›´æŸ¥è¯¢ï¼Œé€‚ç”¨äºŽæŽ’è¡Œæ¦œæˆ–ä¼˜å…ˆçº§é˜Ÿåˆ—ã€‚</p>
<p><img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="https://cdn.jsdelivr.net/gh/JakicDong/blog-assets@main/images/20250811103046.png" alt="20250811103046"></p>
<h4 id="è¯¦ç»†ä»‹ç»ä¸‹Bitmapï¼Ÿ"><a href="#è¯¦ç»†ä»‹ç»ä¸‹Bitmapï¼Ÿ" class="headerlink" title="è¯¦ç»†ä»‹ç»ä¸‹Bitmapï¼Ÿ"></a>è¯¦ç»†ä»‹ç»ä¸‹Bitmapï¼Ÿ</h4><p>Bitmap å¯ä»¥æŠŠä¸€ç»„äºŒè¿›åˆ¶ä½ç´§å‡‘åœ°å­˜å‚¨åœ¨ä¸€å—è¿žç»­å†…å­˜ä¸­ï¼Œæ¯ä¸€ä½ä»£è¡¨ä¸€ä¸ªå¯¹è±¡çš„çŠ¶æ€ï¼Œæ¯”å¦‚æ˜¯å¦ç­¾åˆ°ã€æ˜¯å¦æ´»è·ƒç­‰ã€‚</p>
<p><img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="https://cdn.jsdelivr.net/gh/JakicDong/blog-assets@main/images/20250811103101.png" alt="20250811103101"></p>
<p>æ¯”å¦‚ç”¨æˆ· 0 çš„å·²ç­¾åˆ° 1ã€ç”¨æˆ· 1 æœªç­¾åˆ° 0ã€ç”¨æˆ· 2 å·²ç­¾åˆ°ï¼ŒRedis å°±ä¼šæŠŠè¿™äº›çŠ¶æ€æ”¾è¿›ä¸€ä¸ªè¿žç»­çš„äºŒè¿›åˆ¶ä¸² 101ï¼Œ1 äº¿ç”¨æˆ·ç­¾åˆ°ä»…éœ€ 100,000,000 &#x2F; 8 &#x2F; 1024 â‰ˆ 12MB çš„ç©ºé—´ï¼ŒçœŸçš„çœåˆ°ç¦»è°±ã€‚</p>
<h4 id="è¯¦ç»†ä»‹ç»ä¸‹HyperLogLogï¼Ÿ"><a href="#è¯¦ç»†ä»‹ç»ä¸‹HyperLogLogï¼Ÿ" class="headerlink" title="è¯¦ç»†ä»‹ç»ä¸‹HyperLogLogï¼Ÿ"></a>è¯¦ç»†ä»‹ç»ä¸‹HyperLogLogï¼Ÿ</h4><p>HyperLogLog æ˜¯ä¸€ç§ç”¨äºŽåŸºæ•°ç»Ÿè®¡çš„æ¦‚çŽ‡æ€§æ•°æ®ç»“æž„ï¼Œå¯ä»¥åœ¨ä»…æœ‰ 12KB çš„å†…å­˜ç©ºé—´ä¸‹ï¼Œç»Ÿè®¡æµ·é‡æ•°æ®é›†ä¸­ä¸é‡å¤å…ƒç´ çš„ä¸ªæ•°ï¼Œè¯¯å·®çŽ‡ä»… 0.81%ã€‚</p>
<p><img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="https://cdn.jsdelivr.net/gh/JakicDong/blog-assets@main/images/20250811103115.png" alt="20250811103115"></p>
<p>åº•å±‚åŸºäºŽ LogLog ç®—æ³•æ”¹è¿›ï¼Œå…ˆæŠŠæ¯ä¸ªå…ƒç´ å“ˆå¸Œæˆä¸€ä¸ªäºŒè¿›åˆ¶ä¸²ï¼Œç„¶åŽå–å‰ 14 ä½è¿›è¡Œåˆ†ç»„ï¼Œæ”¾åˆ° 16384 ä¸ªæ¡¶ä¸­ï¼Œè®°å½•æ¯ç»„æœ€å¤§çš„å‰å¯¼é›¶æ•°é‡ï¼Œæœ€åŽç”¨ä¸€ä¸ªè¿‘ä¼¼å…¬å¼æŽ¨ç®—å‡ºæ€»ä½“çš„åŸºæ•°ã€‚</p>
<p><img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="https://cdn.jsdelivr.net/gh/JakicDong/blog-assets@main/images/20250811103129.png" alt="20250811103129"></p>
<p><img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="https://cdn.jsdelivr.net/gh/JakicDong/blog-assets@main/images/20250811103146.png" alt="20250811103146"></p>
<p>å¯ä»¥å‘çŽ°ï¼Œå“ˆå¸Œå€¼è¶Šé•¿å‰å¯¼é›¶è¶Šå¤šï¼Œä¹Ÿå°±è¯´æ˜Žé›†åˆé‡Œçš„å…ƒç´ è¶Šå¤šã€‚</p>
<p>å¤§åž‹ç½‘ç«™ UV ç»Ÿè®¡ç³»ç»Ÿç¤ºä¾‹ï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">UVCounter</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> Jedis jedis;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">recordVisit</span><span class="params">(String date, String userId)</span> &#123;</span><br><span class="line">        <span class="type">String</span> <span class="variable">key</span> <span class="operator">=</span> <span class="string">&quot;uv:&quot;</span> + date;</span><br><span class="line">        jedis.pfadd(key, userId);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">public</span> <span class="type">long</span> <span class="title function_">getUV</span><span class="params">(String date)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> jedis.pfcount(<span class="string">&quot;uv:&quot;</span> + date);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">public</span> <span class="type">long</span> <span class="title function_">getUVBetween</span><span class="params">(String startDate, String endDate)</span> &#123;</span><br><span class="line">        List&lt;String&gt; keys = getDateKeys(startDate, endDate);</span><br><span class="line">        <span class="keyword">return</span> jedis.pfcount(keys.toArray(<span class="keyword">new</span> <span class="title class_">String</span>[<span class="number">0</span>]));</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="è¯¦ç»†ä»‹ç»ä¸‹GEOï¼Ÿ"><a href="#è¯¦ç»†ä»‹ç»ä¸‹GEOï¼Ÿ" class="headerlink" title="è¯¦ç»†ä»‹ç»ä¸‹GEOï¼Ÿ"></a>è¯¦ç»†ä»‹ç»ä¸‹GEOï¼Ÿ</h4><p>GEO ç”¨äºŽå­˜å‚¨å’ŒæŸ¥è¯¢åœ°ç†ä½ç½®ä¿¡æ¯ï¼Œå¯ä»¥ç”¨æ¥è®¡ç®—ä¸¤ç‚¹ä¹‹é—´çš„è·ç¦»ï¼ŒæŸ¥æ‰¾æŸä½ç½®åŠå¾„å†…çš„å…¶ä»–å…ƒç´ ã€‚</p>
<p>å¸¸è§çš„åº”ç”¨åœºæ™¯åŒ…æ‹¬ï¼šé™„è¿‘çš„äººæˆ–è€…å•†å®¶ã€è®¡ç®—å¤–å–å‘˜å’Œå•†å®¶çš„è·ç¦»ã€åˆ¤æ–­ç”¨æˆ·æ˜¯å¦è¿›å…¥æŸä¸ªåŒºåŸŸç­‰ã€‚</p>
<p>åº•å±‚åŸºäºŽ ZSet å®žçŽ°ï¼Œé€šè¿‡ Geohash ç®—æ³•æŠŠç»çº¬åº¦ç¼–ç æˆ scoreã€‚</p>
<p><img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="https://cdn.jsdelivr.net/gh/JakicDong/blog-assets@main/images/20250811103203.png" alt="20250811103203"></p>
<p>æ¯”å¦‚è¯´æŸ¥è¯¢é™„è¿‘çš„å•†å®¶æ—¶ï¼ŒRedis ä¼šæ ¹æ®ä¸­å¿ƒç‚¹ç»çº¬åº¦åæŽ¨å¯èƒ½çš„ Geohash èŒƒå›´ï¼Œ åœ¨ ZSet ä¸ŠåšèŒƒå›´æŸ¥è¯¢ï¼Œæ‹¿åˆ°å€™é€‰ç‚¹åŽï¼Œç”¨ Haversine å…¬å¼ç²¾ç¡®è®¡ç®—çƒé¢è·ç¦»ï¼Œç­›é€‰å‡ºæœ€ç»ˆç¬¦åˆè¦æ±‚çš„ä½ç½®ã€‚</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">NearbyShopService</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> Jedis jedis;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">String</span> <span class="variable">SHOP_KEY</span> <span class="operator">=</span> <span class="string">&quot;shops:geo&quot;</span>;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// æ·»åŠ å•†é“º</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">addShop</span><span class="params">(String shopId, <span class="type">double</span> longitude, <span class="type">double</span> latitude)</span> &#123;</span><br><span class="line">        jedis.geoadd(SHOP_KEY, longitude, latitude, shopId);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// æŸ¥è¯¢é™„è¿‘çš„å•†é“º</span></span><br><span class="line">    <span class="keyword">public</span> List&lt;GeoRadiusResponse&gt; <span class="title function_">getNearbyShops</span><span class="params">(</span></span><br><span class="line"><span class="params">            <span class="type">double</span> longitude, </span></span><br><span class="line"><span class="params">            <span class="type">double</span> latitude, </span></span><br><span class="line"><span class="params">            <span class="type">double</span> radiusKm)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> jedis.georadius(SHOP_KEY, </span><br><span class="line">                             longitude, </span><br><span class="line">                             latitude, </span><br><span class="line">                             radiusKm, </span><br><span class="line">                             GeoUnit.KM, </span><br><span class="line">                             GeoRadiusParam.geoRadiusParam()</span><br><span class="line">                                         .withCoord()</span><br><span class="line">                                         .withDist()</span><br><span class="line">                                         .sortAscending()</span><br><span class="line">                                         .count(<span class="number">20</span>));</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// è®¡ç®—ä¸¤ä¸ªå•†é“ºä¹‹é—´çš„è·ç¦»</span></span><br><span class="line">    <span class="keyword">public</span> <span class="type">double</span> <span class="title function_">getShopDistance</span><span class="params">(String shop1Id, String shop2Id)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> jedis.geodist(SHOP_KEY, </span><br><span class="line">                           shop1Id, </span><br><span class="line">                           shop2Id, </span><br><span class="line">                           GeoUnit.KILOMETERS);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="ä¸ºä»€ä¹ˆä½¿ç”¨-hash-ç±»åž‹è€Œä¸ä½¿ç”¨-string-ç±»åž‹åºåˆ—åŒ–å­˜å‚¨ï¼Ÿ"><a href="#ä¸ºä»€ä¹ˆä½¿ç”¨-hash-ç±»åž‹è€Œä¸ä½¿ç”¨-string-ç±»åž‹åºåˆ—åŒ–å­˜å‚¨ï¼Ÿ" class="headerlink" title="ä¸ºä»€ä¹ˆä½¿ç”¨ hash ç±»åž‹è€Œä¸ä½¿ç”¨ string ç±»åž‹åºåˆ—åŒ–å­˜å‚¨ï¼Ÿ"></a>ä¸ºä»€ä¹ˆä½¿ç”¨ hash ç±»åž‹è€Œä¸ä½¿ç”¨ string ç±»åž‹åºåˆ—åŒ–å­˜å‚¨ï¼Ÿ</h4><p>ä¸ºä»€ä¹ˆä½¿ç”¨ hash ç±»åž‹è€Œä¸ä½¿ç”¨ string ç±»åž‹åºåˆ—åŒ–å­˜å‚¨ï¼Ÿ<br>Hash å¯ä»¥åªè¯»å–æˆ–è€…ä¿®æ”¹æŸä¸€ä¸ªå­—æ®µï¼Œè€Œ String éœ€è¦ä¸€æ¬¡æ€§æŠŠæ•´ä¸ªå¯¹è±¡å–å‡ºæ¥ã€‚</p>
<p><img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="https://cdn.jsdelivr.net/gh/JakicDong/blog-assets@main/images/20250811103219.png" alt="20250811103219"></p>
<p>æ¯”å¦‚è¯´æœ‰ä¸€ä¸ªç”¨æˆ·å¯¹è±¡ user &#x3D; {name: â€˜æ²‰é»˜çŽ‹äºŒâ€™, age: 18}ï¼Œå¦‚æžœä½¿ç”¨ Hash å­˜å‚¨ï¼Œå¯ä»¥ç›´æŽ¥ä¿®æ”¹ age å­—æ®µï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">redis.hset(<span class="string">&quot;user:1&quot;</span>, <span class="string">&quot;age&quot;</span>, <span class="number">19</span>);</span><br></pre></td></tr></table></figure>
<p>å¦‚æžœä½¿ç”¨ String å­˜å‚¨ï¼Œéœ€è¦å…ˆå–å‡ºæ•´ä¸ªå¯¹è±¡ï¼Œä¿®æ”¹åŽå†å­˜å›žåŽ»ï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">String</span> <span class="variable">userJson</span> <span class="operator">=</span> redis.get(<span class="string">&quot;user:1&quot;</span>);</span><br><span class="line"><span class="type">User</span> <span class="variable">user</span> <span class="operator">=</span> JSON.parseObject(userJson, User.class);</span><br><span class="line">user.setAge(<span class="number">19</span>);</span><br><span class="line">redis.set(<span class="string">&quot;user:1&quot;</span>, JSON.toJSONString(user));</span><br></pre></td></tr></table></figure>

<h3 id="4-ðŸŒŸRedis-ä¸ºä»€ä¹ˆå¿«å‘¢ï¼Ÿ"><a href="#4-ðŸŒŸRedis-ä¸ºä»€ä¹ˆå¿«å‘¢ï¼Ÿ" class="headerlink" title="4.ðŸŒŸRedis ä¸ºä»€ä¹ˆå¿«å‘¢ï¼Ÿ"></a>4.ðŸŒŸRedis ä¸ºä»€ä¹ˆå¿«å‘¢ï¼Ÿ</h3><p>ç¬¬ä¸€ï¼ŒRedis çš„æ‰€æœ‰æ•°æ®éƒ½æ”¾åœ¨å†…å­˜ä¸­ï¼Œè€Œå†…å­˜çš„è¯»å†™é€Ÿåº¦æœ¬èº«å°±æ¯”ç£ç›˜å¿«å‡ ä¸ªæ•°é‡çº§ã€‚</p>
<p><img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="https://cdn.jsdelivr.net/gh/JakicDong/blog-assets@main/images/20250912205152.png" alt="20250912205152"></p>
<p>ç¬¬äºŒï¼ŒRedis é‡‡ç”¨äº†åŸºäºŽ IO å¤šè·¯å¤ç”¨æŠ€æœ¯çš„äº‹ä»¶é©±åŠ¨æ¨¡åž‹æ¥å¤„ç†å®¢æˆ·ç«¯è¯·æ±‚å’Œæ‰§è¡Œ <code>Redis</code> å‘½ä»¤ã€‚</p>
<p><img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="https://cdn.jsdelivr.net/gh/JakicDong/blog-assets@main/images/20250912205641.png" alt="20250912205641"></p>
<p>å…¶ä¸­çš„ IO å¤šè·¯å¤ç”¨æŠ€æœ¯å¯ä»¥åœ¨åªæœ‰ä¸€ä¸ªçº¿ç¨‹çš„æƒ…å†µä¸‹ï¼ŒåŒæ—¶ç›‘å¬æˆåƒä¸Šä¸‡ä¸ªå®¢æˆ·ç«¯è¿žæŽ¥ï¼Œè§£å†³ä¼ ç»Ÿ IO æ¨¡åž‹ä¸­æ¯ä¸ªè¿žæŽ¥éƒ½éœ€è¦ä¸€ä¸ªç‹¬ç«‹çº¿ç¨‹å¸¦æ¥çš„æ€§èƒ½å¼€é”€ã€‚</p>
<p><img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="https://cdn.jsdelivr.net/gh/JakicDong/blog-assets@main/images/20250912205919.png" alt="20250912205919"></p>
<p>Redis ä¼šæ ¹æ®æ“ä½œç³»ç»Ÿé€‰æ‹©æœ€ä¼˜çš„ IO å¤šè·¯å¤ç”¨æŠ€æœ¯ï¼Œæ¯”å¦‚ Linux ä¸‹ä½¿ç”¨ epollï¼ŒmacOS ä¸‹ä½¿ç”¨ kqueue ç­‰ã€‚</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// epoll çš„åˆ›å»ºå’Œä½¿ç”¨</span></span><br><span class="line"><span class="type">int</span> epfd = epoll_create(<span class="number">1024</span>); <span class="comment">// åˆ›å»º epoll å®žä¾‹</span></span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">epoll_event</span> <span class="title">ev</span>, <span class="title">events</span>[<span class="title">MAX_EVENTS</span>];</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// æ·»åŠ ç›‘å¬äº‹ä»¶</span></span><br><span class="line">ev.events = EPOLLIN;</span><br><span class="line">ev.data.fd = listen_sock;</span><br><span class="line">epoll_ctl(epfd, EPOLL_CTL_ADD, listen_sock, &amp;ev);</span><br><span class="line"></span><br><span class="line"><span class="comment">// ç­‰å¾…äº‹ä»¶å‘ç”Ÿ</span></span><br><span class="line"><span class="keyword">while</span> (<span class="number">1</span>) &#123;</span><br><span class="line">    <span class="type">int</span> nfds = epoll_wait(epfd, events, MAX_EVENTS, <span class="number">-1</span>);</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; nfds; i++) &#123;</span><br><span class="line">        <span class="comment">// å¤„ç†å°±ç»ªçš„æ–‡ä»¶æè¿°ç¬¦</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>åœ¨ Redis 6.0 ä¹‹å‰ï¼ŒåŒ…æ‹¬è¿žæŽ¥å»ºç«‹ã€è¯·æ±‚è¯»å–ã€å“åº”å‘é€ï¼Œä»¥åŠå‘½ä»¤æ‰§è¡Œéƒ½æ˜¯åœ¨ä¸»çº¿ç¨‹ä¸­é¡ºåºæ‰§è¡Œçš„ï¼Œè¿™æ ·å¯ä»¥é¿å…å¤šçº¿ç¨‹çŽ¯å¢ƒä¸‹çš„é”ç«žäº‰å’Œä¸Šä¸‹æ–‡åˆ‡æ¢ï¼Œå› ä¸º Redis çš„ç»å¤§éƒ¨åˆ†æ“ä½œéƒ½æ˜¯åœ¨å†…å­˜ä¸­è¿›è¡Œçš„ï¼Œæ€§èƒ½ç“¶é¢ˆä¸»è¦æ˜¯<strong>å†…å­˜æ“ä½œ</strong>å’Œ<strong>ç½‘ç»œé€šä¿¡</strong>ï¼Œè€Œä¸æ˜¯ CPUã€‚</p>
<p><img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="https://cdn.jsdelivr.net/gh/JakicDong/blog-assets@main/images/20250912210551.png" alt="20250912210551"></p>
<p>ä¸ºäº†è¿›ä¸€æ­¥è§£å†³ç½‘ç»œ IO çš„æ€§èƒ½ç“¶é¢ˆï¼ŒRedis 6.0 å¼•å…¥äº†å¤šçº¿ç¨‹æœºåˆ¶ï¼ŒæŠŠç½‘ç»œ IO å’Œå‘½ä»¤æ‰§è¡Œåˆ†å¼€ï¼Œç½‘ç»œ IO äº¤ç»™çº¿ç¨‹æ± æ¥å¤„ç†ï¼Œè€Œå‘½ä»¤æ‰§è¡Œä»ç„¶åœ¨ä¸»çº¿ç¨‹ä¸­è¿›è¡Œï¼Œè¿™æ ·å°±å¯ä»¥å……åˆ†åˆ©ç”¨å¤šæ ¸ CPU çš„æ€§èƒ½ã€‚</p>
<p><img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="https://cdn.jsdelivr.net/gh/JakicDong/blog-assets@main/images/20250912210654.png" alt="20250912210654"></p>
<p>ä¸»çº¿ç¨‹ä¸“æ³¨äºŽå‘½ä»¤æ‰§è¡Œï¼Œç½‘ç»œIO ç”±å…¶ä»–çº¿ç¨‹åˆ†æ‹…ï¼Œåœ¨å¤šæ ¸ CPU çŽ¯å¢ƒä¸‹ï¼ŒRedis çš„æ€§èƒ½å¯ä»¥å¾—åˆ°æ˜¾è‘—æå‡ã€‚</p>
<p>(æœ‰ç‚¹åƒå•ç‰‡æœºçš„ä¸­æ–­æœºåˆ¶,ä¿æŒä¸»çº¿ç¨‹ä¸“æ³¨æ ¸å¿ƒä»»åŠ¡ï¼Œè®©IOæ“ä½œåœ¨åŽå°å¼‚æ­¥å¤„ç†ï¼Œæ—¢ä¿è¯äº†æ€§èƒ½åˆä¿è¯äº†æ•°æ®ä¸€è‡´æ€§ã€‚)</p>
<p><img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="https://cdn.jsdelivr.net/gh/JakicDong/blog-assets@main/images/20250912211024.png" alt="20250912211024"></p>
<p>ç¬¬ä¸‰ï¼ŒRedis å¯¹åº•å±‚æ•°æ®ç»“æž„åšäº†æžè‡´çš„ä¼˜åŒ–ï¼Œæ¯”å¦‚è¯´ String çš„åº•å±‚æ•°æ®ç»“æž„åŠ¨æ€å­—ç¬¦ä¸²æ”¯æŒåŠ¨æ€æ‰©å®¹ã€é¢„åˆ†é…å†—ä½™ç©ºé—´ï¼Œèƒ½å¤Ÿå‡å°‘å†…å­˜ç¢Žç‰‡å’Œå†…å­˜åˆ†é…çš„å¼€é”€ã€‚</p>
<p><img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="https://cdn.jsdelivr.net/gh/JakicDong/blog-assets@main/images/20250912211154.png" alt="20250912211154"></p>
<p>æ€»ç»“:</p>
<p><img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="https://cdn.jsdelivr.net/gh/JakicDong/blog-assets@main/images/20250912211332.png" alt="20250912211332"></p>
<h3 id="10-ðŸŒŸRedisçš„æŒä¹…åŒ–æ–¹å¼æœ‰å“ªäº›ï¼Ÿ"><a href="#10-ðŸŒŸRedisçš„æŒä¹…åŒ–æ–¹å¼æœ‰å“ªäº›ï¼Ÿ" class="headerlink" title="10.ðŸŒŸRedisçš„æŒä¹…åŒ–æ–¹å¼æœ‰å“ªäº›ï¼Ÿ"></a>10.ðŸŒŸRedisçš„æŒä¹…åŒ–æ–¹å¼æœ‰å“ªäº›ï¼Ÿ</h3><p>ä¸»è¦æœ‰ä¸¤ç§ï¼ŒRDB å’Œ AOFã€‚RDB é€šè¿‡åˆ›å»ºæ—¶é—´ç‚¹å¿«ç…§æ¥å®žçŽ°æŒä¹…åŒ–ï¼ŒAOF é€šè¿‡è®°å½•æ¯ä¸ªå†™æ“ä½œå‘½ä»¤æ¥å®žçŽ°æŒä¹…åŒ–ã€‚</p>
<p><img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="https://cdn.jsdelivr.net/gh/JakicDong/blog-assets@main/images/20250928161918.png" alt="20250928161918"><br>ä¸‰åˆ†æ¶é¢æ¸£é€†è¢­ï¼šRedisæŒä¹…åŒ–çš„ä¸¤ç§æ–¹å¼</p>
<p>è¿™ä¸¤ç§æ–¹å¼å¯ä»¥å•ç‹¬ä½¿ç”¨ï¼Œä¹Ÿå¯ä»¥åŒæ—¶ä½¿ç”¨ã€‚è¿™æ ·å°±å¯ä»¥ä¿è¯ Redis æœåŠ¡å™¨åœ¨é‡å¯åŽä¸ä¸¢å¤±æ•°æ®ï¼Œé€šè¿‡ <code>RDB</code> å’Œ <code>AOF</code> æ–‡ä»¶æ¥æ¢å¤å†…å­˜ä¸­åŽŸæœ‰çš„æ•°æ®ã€‚</p>
<p><img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="https://cdn.jsdelivr.net/gh/JakicDong/blog-assets@main/images/20250928162003.png" alt="20250928162003"><br>Gauravï¼šRDB å’Œ AOF</p>
<h4 id="è¯¦ç»†è¯´ä¸€ä¸‹-RDBï¼Ÿ"><a href="#è¯¦ç»†è¯´ä¸€ä¸‹-RDBï¼Ÿ" class="headerlink" title="è¯¦ç»†è¯´ä¸€ä¸‹ RDBï¼Ÿ"></a>è¯¦ç»†è¯´ä¸€ä¸‹ RDBï¼Ÿ</h4><p>RDB æŒä¹…åŒ–æœºåˆ¶å¯ä»¥åœ¨æŒ‡å®šçš„æ—¶é—´é—´éš”å†…å°† Redis æŸä¸€æ—¶åˆ»çš„æ•°æ®ä¿å­˜åˆ°ç£ç›˜ä¸Šçš„ RDB æ–‡ä»¶ä¸­ï¼Œå½“ Redis é‡å¯æ—¶ï¼Œå¯ä»¥é€šè¿‡åŠ è½½è¿™ä¸ª RDB æ–‡ä»¶æ¥æ¢å¤æ•°æ®ã€‚</p>
<p><img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="https://cdn.jsdelivr.net/gh/JakicDong/blog-assets@main/images/20250928162408.png" alt="20250928162408"><br>Animesh Gaitondeï¼šRDB</p>
<p>RDB æŒä¹…åŒ–å¯ä»¥é€šè¿‡ <code>save</code> å’Œ <code>bgsave</code> å‘½ä»¤æ‰‹åŠ¨è§¦å‘ï¼Œä¹Ÿå¯ä»¥é€šè¿‡é…ç½®æ–‡ä»¶ä¸­çš„ <code>save</code> æŒ‡ä»¤è‡ªåŠ¨è§¦å‘ã€‚</p>
<p><img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="https://cdn.jsdelivr.net/gh/JakicDong/blog-assets@main/images/20250928163257.png" alt="20250928163257"><br>ä¸‰åˆ†æ¶é¢æ¸£é€†è¢­ï¼šsaveå’Œbgsave</p>
<p>save å‘½ä»¤ä¼šé˜»å¡ž Redis è¿›ç¨‹ï¼Œç›´åˆ° RDB æ–‡ä»¶åˆ›å»ºå®Œæˆã€‚<br><img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="https://cdn.jsdelivr.net/gh/JakicDong/blog-assets@main/images/20250928163337.png" alt="20250928163337"><br>äºŒå“¥çš„ Java è¿›é˜¶ä¹‹è·¯ï¼šæ‰‹åŠ¨æ‰§è¡Œ RDB</p>
<p>bgsave å‘½ä»¤ä¼šåœ¨åŽå° fork ä¸€ä¸ªå­è¿›ç¨‹æ¥æ‰§è¡Œ RDB æŒä¹…åŒ–æ“ä½œï¼Œä¸»è¿›ç¨‹ä¸ä¼šè¢«é˜»å¡žã€‚<br><img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="https://cdn.jsdelivr.net/gh/JakicDong/blog-assets@main/images/20250928163355.png" alt="20250928163355"><br>MräºŽï¼šRedis bgsave</p>
<h4 id="ä»€ä¹ˆæƒ…å†µä¸‹ä¼šè‡ªåŠ¨è§¦å‘-RDB-æŒä¹…åŒ–ï¼Ÿ"><a href="#ä»€ä¹ˆæƒ…å†µä¸‹ä¼šè‡ªåŠ¨è§¦å‘-RDB-æŒä¹…åŒ–ï¼Ÿ" class="headerlink" title="ä»€ä¹ˆæƒ…å†µä¸‹ä¼šè‡ªåŠ¨è§¦å‘ RDB æŒä¹…åŒ–ï¼Ÿ"></a>ä»€ä¹ˆæƒ…å†µä¸‹ä¼šè‡ªåŠ¨è§¦å‘ RDB æŒä¹…åŒ–ï¼Ÿ</h4><p>ç¬¬ä¸€ç§ï¼Œåœ¨ Redis é…ç½®æ–‡ä»¶ä¸­è®¾ç½® RDB æŒä¹…åŒ–å‚æ•° <code>save &lt;seconds&gt; &lt;changes&gt;</code>ï¼Œè¡¨ç¤ºåœ¨æŒ‡å®šæ—¶é—´é—´éš”å†…ï¼Œå¦‚æžœæœ‰æŒ‡å®šæ•°é‡çš„é”®å‘ç”Ÿå˜åŒ–ï¼Œå°±ä¼šè‡ªåŠ¨è§¦å‘ RDB æŒä¹…åŒ–ã€‚</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">save 900 1      # 900 ç§’ï¼ˆ15 åˆ†é’Ÿï¼‰å†…æœ‰ 1 ä¸ª key å‘ç”Ÿå˜åŒ–ï¼Œè§¦å‘å¿«ç…§</span><br><span class="line">save 300 10     # 300 ç§’ï¼ˆ5 åˆ†é’Ÿï¼‰å†…æœ‰ 10 ä¸ª key å‘ç”Ÿå˜åŒ–ï¼Œè§¦å‘å¿«ç…§</span><br><span class="line">save 60 10000   # 60 ç§’å†…æœ‰ 10000 ä¸ª key å‘ç”Ÿå˜åŒ–ï¼Œè§¦å‘å¿«ç…§</span><br></pre></td></tr></table></figure>

<p>ç¬¬äºŒç§ï¼Œä¸»ä»Žå¤åˆ¶æ—¶ï¼Œå½“ä»ŽèŠ‚ç‚¹ç¬¬ä¸€æ¬¡è¿žæŽ¥åˆ°ä¸»èŠ‚ç‚¹æ—¶ï¼Œä¸»èŠ‚ç‚¹ä¼šè‡ªåŠ¨æ‰§è¡Œ bgsave ç”Ÿæˆ RDB æ–‡ä»¶ï¼Œå¹¶å°†å…¶å‘é€ç»™ä»ŽèŠ‚ç‚¹ã€‚</p>
<p><img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="https://cdn.jsdelivr.net/gh/JakicDong/blog-assets@main/images/20250928163542.png" alt="20250928163542"><br>è¾¾æ‘©é™¢çš„BLOGï¼šRedis ä¸»ä»Žå¤åˆ¶æ—¶ RDB è‡ªåŠ¨ç”Ÿæˆ</p>
<p>ç¬¬ä¸‰ç§ï¼Œå¦‚æžœæ²¡æœ‰å¼€å¯ AOFï¼Œæ‰§è¡Œ shutdown å‘½ä»¤æ—¶ï¼ŒRedis ä¼šè‡ªåŠ¨ä¿å­˜ä¸€æ¬¡ RDB æ–‡ä»¶ï¼Œä»¥ç¡®ä¿æ•°æ®ä¸ä¼šä¸¢å¤±ã€‚</p>
<h4 id="è¯¦ç»†è¯´ä¸€ä¸‹-AOFï¼Ÿ"><a href="#è¯¦ç»†è¯´ä¸€ä¸‹-AOFï¼Ÿ" class="headerlink" title="è¯¦ç»†è¯´ä¸€ä¸‹ AOFï¼Ÿ"></a>è¯¦ç»†è¯´ä¸€ä¸‹ AOFï¼Ÿ</h4><p>AOF é€šè¿‡è®°å½•æ¯ä¸ªå†™æ“ä½œå‘½ä»¤ï¼Œå¹¶å°†å…¶è¿½åŠ åˆ° AOF æ–‡ä»¶æ¥å®žçŽ°æŒä¹…åŒ–ï¼ŒRedis æœåŠ¡å™¨å®•æœºåŽå¯ä»¥é€šè¿‡é‡æ–°æ‰§è¡Œè¿™äº›å‘½ä»¤æ¥æ¢å¤æ•°æ®ã€‚</p>
<p><img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="https://cdn.jsdelivr.net/gh/JakicDong/blog-assets@main/images/20250928163946.png" alt="20250928163946"><br>Animesh Gaitondeï¼šAOF</p>
<p>å½“ Redis æ‰§è¡Œå†™æ“ä½œæ—¶ï¼Œä¼šå°†å†™å‘½ä»¤è¿½åŠ åˆ° AOF ç¼“å†²åŒºï¼›Redis ä¼šæ ¹æ®åŒæ­¥ç­–ç•¥å°†ç¼“å†²åŒºçš„æ•°æ®å†™å…¥åˆ° AOF æ–‡ä»¶ã€‚</p>
<p><img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="https://cdn.jsdelivr.net/gh/JakicDong/blog-assets@main/images/20250928164026.png" alt="20250928164026"><br>ä¸‰åˆ†æ¶é¢æ¸£é€†è¢­ï¼šAOFå·¥ä½œæµç¨‹</p>
<p>å½“ AOF æ–‡ä»¶è¿‡å¤§æ—¶ï¼ŒRedis ä¼šè‡ªåŠ¨è¿›è¡Œ AOF é‡å†™ï¼Œå‰”é™¤å¤šä½™çš„å‘½ä»¤ï¼Œæ¯”å¦‚è¯´å¤šæ¬¡å¯¹åŒä¸€ä¸ª key çš„ set å’Œ delï¼Œç”Ÿæˆä¸€ä¸ªæ–°çš„ AOF æ–‡ä»¶ï¼›å½“ Redis é‡å¯æ—¶ï¼Œè¯»å– AOF æ–‡ä»¶ä¸­çš„å‘½ä»¤å¹¶é‡æ–°æ‰§è¡Œï¼Œä»¥æ¢å¤æ•°æ®ã€‚</p>
<h4 id="AOF-çš„åˆ·ç›˜ç­–ç•¥äº†è§£å—ï¼Ÿ"><a href="#AOF-çš„åˆ·ç›˜ç­–ç•¥äº†è§£å—ï¼Ÿ" class="headerlink" title="AOF çš„åˆ·ç›˜ç­–ç•¥äº†è§£å—ï¼Ÿ"></a>AOF çš„åˆ·ç›˜ç­–ç•¥äº†è§£å—ï¼Ÿ</h4><p>Redis å°† AOF ç¼“å†²åŒºçš„æ•°æ®å†™å…¥åˆ° AOF æ–‡ä»¶æ—¶ï¼Œæ¶‰åŠä¸¤ä¸ªç³»ç»Ÿè°ƒç”¨ï¼šwrite å°†æ•°æ®å†™å…¥åˆ°æ“ä½œç³»ç»Ÿçš„ç¼“å†²åŒºï¼Œfsync å°† OS ç¼“å†²åŒºçš„æ•°æ®åˆ·æ–°åˆ°ç£ç›˜ã€‚</p>
<p>è¿™é‡Œçš„åˆ·ç›˜æ¶‰åŠåˆ°ä¸‰ç§ç­–ç•¥ï¼šalwaysã€everysec å’Œ noã€‚</p>
<p><img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="https://cdn.jsdelivr.net/gh/JakicDong/blog-assets@main/images/20250928164208.png" alt="20250928164208"><br>bytebytegoï¼šRedis AOF çš„åˆ·ç›˜ç­–ç•¥</p>
<ul>
<li>alwaysï¼šæ¯æ¬¡å†™å‘½ä»¤æ‰§è¡Œå®Œï¼Œç«‹å³è°ƒç”¨ fsync åŒæ­¥åˆ°ç£ç›˜ï¼Œè¿™æ ·å¯ä»¥ä¿è¯æ•°æ®ä¸ä¸¢å¤±ï¼Œä½†æ€§èƒ½è¾ƒå·®ã€‚</li>
<li>everysecï¼šæ¯ç§’è°ƒç”¨ä¸€æ¬¡ fsyncï¼Œå°†å¤šæ¡å‘½ä»¤ä¸€æ¬¡æ€§åŒæ­¥åˆ°ç£ç›˜ï¼Œæ€§èƒ½è¾ƒå¥½ï¼Œæ•°æ®ä¸¢å¤±çš„æ—¶é—´çª—å£ä¸º 1 ç§’ã€‚</li>
<li>noï¼šä¸ä¸»åŠ¨è°ƒç”¨ fsyncï¼Œç”±æ“ä½œç³»ç»Ÿå†³å®šï¼Œæ€§èƒ½æœ€å¥½ï¼Œä½†æ•°æ®ä¸¢å¤±çš„æ—¶é—´çª—å£ä¸ç¡®å®šï¼Œä¾èµ–äºŽæ“ä½œç³»ç»Ÿçš„ç¼“å­˜ç­–ç•¥ï¼Œå¯èƒ½ä¼šä¸¢å¤±å¤§é‡æ•°æ®ã€‚</li>
</ul>
<p>å¯ä»¥é€šè¿‡é…ç½®æ–‡ä»¶ä¸­çš„ appendfsync å‚æ•°è¿›è¡Œè®¾ç½®ã€‚</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">appendfsync everysec  # æ¯ç§’ fsync ä¸€æ¬¡</span><br></pre></td></tr></table></figure>

<h4 id="è¯´è¯´AOFçš„é‡å†™æœºåˆ¶ï¼Ÿ"><a href="#è¯´è¯´AOFçš„é‡å†™æœºåˆ¶ï¼Ÿ" class="headerlink" title="è¯´è¯´AOFçš„é‡å†™æœºåˆ¶ï¼Ÿ"></a>è¯´è¯´AOFçš„é‡å†™æœºåˆ¶ï¼Ÿ</h4><p>ç”±äºŽ AOF æ–‡ä»¶ä¼šéšç€å†™æ“ä½œçš„å¢žåŠ è€Œä¸æ–­å¢žé•¿ï¼Œä¸ºäº†è§£å†³è¿™ä¸ªé—®é¢˜ï¼Œ Redis æä¾›äº†é‡å†™æœºåˆ¶æ¥å¯¹ AOF æ–‡ä»¶è¿›è¡ŒåŽ‹ç¼©å’Œä¼˜åŒ–ã€‚</p>
<p><img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="https://cdn.jsdelivr.net/gh/JakicDong/blog-assets@main/images/20250928165143.png" alt="20250928165143"><br>pdai.techï¼šAOF æ–‡ä»¶ç˜¦èº«</p>
<p>AOF é‡å†™å¯ä»¥é€šè¿‡ä¸¤ç§æ–¹å¼è§¦å‘ï¼Œç¬¬ä¸€ç§æ˜¯æ‰‹åŠ¨æ‰§è¡Œ <code>BGREWRITEAOF</code> å‘½ä»¤ï¼Œé€‚ç”¨äºŽéœ€è¦ç«‹å³å‡å°AOFæ–‡ä»¶å¤§å°çš„åœºæ™¯ã€‚</p>
<p>ç¬¬äºŒç§æ˜¯åœ¨ Redis é…ç½®æ–‡ä»¶ä¸­è®¾ç½®è‡ªåŠ¨é‡å†™å‚æ•°ï¼Œæ¯”å¦‚è¯´ <code>auto-aof-rewrite-percentage</code> å’Œ <code>auto-aof-rewrite-min-size</code>ï¼Œè¡¨ç¤ºå½“ AOF æ–‡ä»¶å¤§å°è¶…è¿‡æŒ‡å®šå€¼æ—¶ï¼Œè‡ªåŠ¨è§¦å‘é‡å†™ã€‚</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">auto-aof-rewrite-percentage 100  # é»˜è®¤å€¼100ï¼Œè¡¨ç¤ºå½“å‰AOFæ–‡ä»¶å¤§å°ç›¸æ¯”ä¸Šæ¬¡é‡å†™åŽå¤§å°å¢žé•¿äº†å¤šå°‘ç™¾åˆ†æ¯”æ—¶è§¦å‘é‡å†™</span><br><span class="line">auto-aof-rewrite-min-size 64mb  # é»˜è®¤å€¼64MBï¼Œè¡¨ç¤ºAOFæ–‡ä»¶è‡³å°‘è¦è¾¾åˆ°è¿™ä¸ªå¤§å°æ‰ä¼šè€ƒè™‘é‡å†™</span><br></pre></td></tr></table></figure>

<h4 id="AOF-é‡å†™çš„å…·ä½“è¿‡ç¨‹æ˜¯æ€Žæ ·çš„ï¼Ÿ"><a href="#AOF-é‡å†™çš„å…·ä½“è¿‡ç¨‹æ˜¯æ€Žæ ·çš„ï¼Ÿ" class="headerlink" title="AOF é‡å†™çš„å…·ä½“è¿‡ç¨‹æ˜¯æ€Žæ ·çš„ï¼Ÿ"></a>AOF é‡å†™çš„å…·ä½“è¿‡ç¨‹æ˜¯æ€Žæ ·çš„ï¼Ÿ</h4><p>Redis åœ¨æ”¶åˆ°é‡å†™æŒ‡ä»¤åŽï¼Œä¼šåˆ›å»ºä¸€ä¸ªå­è¿›ç¨‹ï¼Œå¹¶ fork ä¸€ä»½ä¸Žçˆ¶è¿›ç¨‹å®Œå…¨ç›¸åŒçš„æ•°æ®å‰¯æœ¬ï¼Œç„¶åŽéåŽ†å†…å­˜ä¸­çš„æ‰€æœ‰é”®å€¼å¯¹ï¼Œç”Ÿæˆé‡å»ºå®ƒä»¬æ‰€éœ€çš„æœ€å°‘å‘½ä»¤ã€‚</p>
<p><img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="https://cdn.jsdelivr.net/gh/JakicDong/blog-assets@main/images/20250928165506.png" alt="20250928165506"><br>äº‘çƒŸæˆé›¨ï¼šRedis çš„ AOF é‡å†™æœºåˆ¶</p>
<p>æ¯”å¦‚è¯´å¤šä¸ª RPUSH å‘½ä»¤å¯ä»¥åˆå¹¶ä¸ºä¸€ä¸ªå¸¦æœ‰å¤šä¸ªå‚æ•°çš„ RPUSHï¼›</p>
<p>æ¯”å¦‚è¯´ä¸€ä¸ªé”®è¢«è®¾ç½®åŽåˆè¢«åˆ é™¤ï¼Œè¿™ä¸ªé”®çš„æ‰€æœ‰æ“ä½œéƒ½ä¸ä¼šè¢«å†™å…¥æ–° AOFã€‚</p>
<p>æ¯”å¦‚è¯´ä½¿ç”¨ <code>SADD key member1 member2 member3</code> ä»£æ›¿å¤šä¸ªå•ç‹¬çš„ <code>SADD key memberX</code>ã€‚</p>
<p>å­è¿›ç¨‹åœ¨æ‰§è¡Œ AOF é‡å†™çš„åŒæ—¶ï¼Œä¸»è¿›ç¨‹å¯ä»¥ç»§ç»­å¤„ç†æ¥è‡ªå®¢æˆ·ç«¯çš„å‘½ä»¤ã€‚</p>
<p>ä¸ºäº†ä¿è¯æ•°æ®ä¸€è‡´æ€§ï¼ŒRedis ä½¿ç”¨äº† AOF é‡å†™ç¼“å†²åŒºæœºåˆ¶ï¼Œä¸»è¿›ç¨‹åœ¨æ‰§è¡Œå†™æ“ä½œæ—¶ï¼Œä¼šå°†å‘½ä»¤åŒæ—¶å†™å…¥æ—§çš„ AOF æ–‡ä»¶å’Œé‡å†™ç¼“å†²åŒºã€‚</p>
<p>ç­‰å­è¿›ç¨‹å®Œæˆé‡å†™åŽï¼Œä¼šå‘ä¸»è¿›ç¨‹å‘é€ä¸€ä¸ªä¿¡å·ï¼Œä¸»è¿›ç¨‹æ”¶åˆ°åŽå°†é‡å†™ç¼“å†²åŒºä¸­çš„å‘½ä»¤è¿½åŠ åˆ°æ–°çš„ AOF æ–‡ä»¶ä¸­ï¼Œç„¶åŽè°ƒç”¨æ“ä½œç³»ç»Ÿçš„ renameï¼Œå°†æ—§çš„ AOF æ–‡ä»¶æ›¿æ¢ä¸ºæ–°çš„ AOF æ–‡ä»¶ã€‚</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">ä¸»è¿›ç¨‹ï¼ˆforkï¼‰  </span><br><span class="line">   â”‚  </span><br><span class="line">   â”œâ”€â†’ å­è¿›ç¨‹ï¼ˆç”Ÿæˆæ–°çš„ AOF æ–‡ä»¶ï¼‰  </span><br><span class="line">   â”‚       â”‚  </span><br><span class="line">   â”‚       â”œâ”€â†’ å†…å­˜å¿«ç…§  </span><br><span class="line">   â”‚       â”œâ”€â†’ å†™å…¥ä¸´æ—¶ AOF æ–‡ä»¶  </span><br><span class="line">   â”‚       â”œâ”€â†’ é€šçŸ¥ä¸»è¿›ç¨‹å®Œæˆ  </span><br><span class="line">   â”‚  </span><br><span class="line">   â”œâ”€â†’ ä¸»è¿›ç¨‹ï¼ˆè¿½åŠ ç¼“å†²åŒºåˆ°æ–° AOF æ–‡ä»¶ï¼‰  </span><br><span class="line">   â”œâ”€â†’ æ›¿æ¢æ—§ AOF æ–‡ä»¶  </span><br><span class="line">   â”œâ”€â†’ é‡å†™å®Œæˆ</span><br></pre></td></tr></table></figure>

<p>AOF é‡å†™æœŸé—´ï¼ŒRedis æœåŠ¡å™¨ä¼šå¤„äºŽç‰¹æ®ŠçŠ¶æ€ï¼š</p>
<ul>
<li>aof_child_pid ä¸ä¸º 0ï¼Œè¡¨ç¤ºæœ‰å­è¿›ç¨‹åœ¨æ‰§è¡Œ AOF é‡å†™</li>
<li>aof_rewrite_buf_blocks é“¾è¡¨ä¸ä¸ºç©ºï¼Œå­˜å‚¨ AOF é‡å†™ç¼“å†²åŒºå†…å®¹</li>
</ul>
<p>å¦‚æžœåœ¨é…ç½®æ–‡ä»¶ä¸­è®¾ç½® no-appendfsync-on-rewrite ä¸º yesï¼Œé‚£ä¹ˆé‡å†™æœŸé—´å¯èƒ½ä¼šæš‚åœ AOF æ–‡ä»¶çš„ fsync æ“ä½œã€‚</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">appendonly yes                # å¼€å¯AOF</span><br><span class="line">appendfilename &quot;appendonly.aof&quot;  # AOFæ–‡ä»¶å</span><br><span class="line">appendfsync everysec          # å†™å…¥ç£ç›˜ç­–ç•¥</span><br><span class="line">no-appendfsync-on-rewrite no  # é‡å†™æœŸé—´æ˜¯å¦ä¸´æ—¶å…³é—­fsync</span><br><span class="line">auto-aof-rewrite-percentage 100   # AOFæ–‡ä»¶å¢žé•¿åˆ°åŽŸæ¥å¤šå°‘ç™¾åˆ†æ¯”æ—¶è§¦å‘é‡å†™</span><br><span class="line">auto-aof-rewrite-min-size 64mb    # AOFæ–‡ä»¶æœ€å°å¤šå¤§æ—¶æ‰å…è®¸é‡å†™</span><br></pre></td></tr></table></figure>

<h4 id="AOF-æ–‡ä»¶å­˜å‚¨çš„æ˜¯ä»€ä¹ˆç±»åž‹çš„æ•°æ®ï¼Ÿ"><a href="#AOF-æ–‡ä»¶å­˜å‚¨çš„æ˜¯ä»€ä¹ˆç±»åž‹çš„æ•°æ®ï¼Ÿ" class="headerlink" title="AOF æ–‡ä»¶å­˜å‚¨çš„æ˜¯ä»€ä¹ˆç±»åž‹çš„æ•°æ®ï¼Ÿ"></a>AOF æ–‡ä»¶å­˜å‚¨çš„æ˜¯ä»€ä¹ˆç±»åž‹çš„æ•°æ®ï¼Ÿ</h4><p>AOF æ–‡ä»¶å­˜å‚¨çš„æ˜¯ Redis æœåŠ¡å™¨æŽ¥æ”¶åˆ°çš„å†™å‘½ä»¤æ•°æ®ï¼Œä»¥ Redis åè®®æ ¼å¼ä¿å­˜ã€‚</p>
<p>è¿™ç§æ ¼å¼çš„ç‰¹ç‚¹æ˜¯ï¼Œæ¯ä¸ªå‘½ä»¤ä»¥*å¼€å¤´ï¼ŒåŽè·Ÿå‚æ•°çš„æ•°é‡ï¼Œæ¯ä¸ªå‚æ•°å‰ç”¨<code>$</code>ç¬¦å·ï¼ŒåŽè·Ÿå‚æ•°å­—èŠ‚é•¿åº¦ï¼Œç„¶åŽæ˜¯å‚æ•°çš„å®žé™…å†…å®¹ã€‚</p>
<p><img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="https://cdn.jsdelivr.net/gh/JakicDong/blog-assets@main/images/20251016095627.png" alt="20251016095627"><br>äºŒå“¥çš„Java è¿›é˜¶ä¹‹è·¯ï¼šAOFæ–‡ä»¶å†…å®¹æ ¼å¼</p>
<h4 id="AOFé‡å†™æœŸé—´å‘½ä»¤å¯èƒ½ä¼šå†™å…¥ä¸¤æ¬¡ï¼Œä¼šé€ æˆä»€ä¹ˆå½±å“ï¼Ÿ"><a href="#AOFé‡å†™æœŸé—´å‘½ä»¤å¯èƒ½ä¼šå†™å…¥ä¸¤æ¬¡ï¼Œä¼šé€ æˆä»€ä¹ˆå½±å“ï¼Ÿ" class="headerlink" title="AOFé‡å†™æœŸé—´å‘½ä»¤å¯èƒ½ä¼šå†™å…¥ä¸¤æ¬¡ï¼Œä¼šé€ æˆä»€ä¹ˆå½±å“ï¼Ÿ"></a>AOFé‡å†™æœŸé—´å‘½ä»¤å¯èƒ½ä¼šå†™å…¥ä¸¤æ¬¡ï¼Œä¼šé€ æˆä»€ä¹ˆå½±å“ï¼Ÿ</h4><p>AOF é‡å†™æœŸé—´å‘½ä»¤ä¼šåŒæ—¶å†™å…¥çŽ°æœ‰AOFæ–‡ä»¶å’Œé‡å†™ç¼“å†²åŒºï¼Œè¿™ç§æœºåˆ¶æ˜¯æœ‰æ„è®¾è®¡çš„ï¼Œå¹¶ä¸ä¼šå¯¼è‡´æ•°æ®é‡å¤æˆ–ä¸ä¸€è‡´é—®é¢˜ã€‚</p>
<p><img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="https://cdn.jsdelivr.net/gh/JakicDong/blog-assets@main/images/20251016095640.png" alt="20251016095640"><br>UStarGaoï¼šAOF åŒå†™æœºåˆ¶</p>
<p>å› ä¸ºæ–°æ—§æ–‡ä»¶æ˜¯åˆ†ç¦»çš„ï¼ŒçŽ°æœ‰å‘½ä»¤å†™å…¥å½“å‰ AOF æ–‡ä»¶ï¼Œé‡å†™ç¼“å†²åŒºçš„å‘½ä»¤æœ€ç»ˆå†™å…¥æ–°çš„ AOF æ–‡ä»¶ï¼Œå®ŒæˆåŽï¼Œæ–°æ–‡ä»¶é€šè¿‡åŽŸå­æ€§çš„ rename æ“ä½œæ›¿æ¢æ—§æ–‡ä»¶ã€‚ä¸¤ä¸ªæ–‡ä»¶æ˜¯å®Œå…¨åˆ†ç¦»çš„ï¼Œä¸ä¼šå¯¼è‡´åŒä¸€ä¸ª AOF æ–‡ä»¶ä¸­å‡ºçŽ°é‡å¤å‘½ä»¤ã€‚</p>
<h3 id="14-ðŸŒŸRedis-4-0-çš„æ··åˆæŒä¹…åŒ–äº†è§£å—ï¼Ÿ"><a href="#14-ðŸŒŸRedis-4-0-çš„æ··åˆæŒä¹…åŒ–äº†è§£å—ï¼Ÿ" class="headerlink" title="14.ðŸŒŸRedis 4.0 çš„æ··åˆæŒä¹…åŒ–äº†è§£å—ï¼Ÿ"></a>14.ðŸŒŸRedis 4.0 çš„æ··åˆæŒä¹…åŒ–äº†è§£å—ï¼Ÿ</h3><p>æ˜¯çš„ã€‚</p>
<p>æ··åˆæŒä¹…åŒ–ç»“åˆäº† RDB å’Œ AOF ä¸¤ç§æ–¹å¼çš„ä¼˜ç‚¹ï¼Œè§£å†³äº†å®ƒä»¬å„è‡ªçš„ä¸è¶³ã€‚åœ¨ Redis 4.0 ä¹‹å‰ï¼Œæˆ‘ä»¬è¦ä¹ˆé¢ä¸´ RDB å¯èƒ½ä¸¢å¤±æ•°æ®çš„é£Žé™©ï¼Œè¦ä¹ˆæ‰¿å— AOF æ¢å¤æ…¢çš„é—®é¢˜ï¼Œå¾ˆéš¾ä¸¤å…¨å…¶ç¾Žã€‚</p>
<p><img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="https://cdn.jsdelivr.net/gh/JakicDong/blog-assets@main/images/20250928170958.png" alt="20250928170958"><br>Animesh Gaitondeï¼šaof-use-rdb-preamble</p>
<p>æ··åˆæŒä¹…åŒ–çš„å·¥ä½œåŽŸç†éžå¸¸å·§å¦™ï¼šåœ¨ AOF é‡å†™æœŸé—´ï¼Œå…ˆä»¥ RDB æ ¼å¼å°†å†…å­˜ä¸­çš„æ•°æ®å¿«ç…§ä¿å­˜åˆ° AOF æ–‡ä»¶çš„å¼€å¤´ï¼Œå†å°†é‡å†™æœŸé—´çš„å‘½ä»¤ä»¥ AOF æ ¼å¼è¿½åŠ åˆ°æ–‡ä»¶æœ«å°¾ã€‚</p>
<p><img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="https://cdn.jsdelivr.net/gh/JakicDong/blog-assets@main/images/20250928171009.png" alt="20250928171009"><br>ä¸‰åˆ†æ¶é¢æ¸£é€†è¢­ï¼šæ··åˆæŒä¹…åŒ–</p>
<p>è¿™æ ·ï¼Œå½“éœ€è¦æ¢å¤æ•°æ®æ—¶ï¼ŒRedis å…ˆåŠ è½½ RDB æ ¼å¼çš„æ•°æ®æ¥å¿«é€Ÿæ¢å¤å¤§éƒ¨åˆ†çš„æ•°æ®ï¼Œç„¶åŽé€šè¿‡é‡æ”¾å‘½ä»¤æ¢å¤æœ€è¿‘çš„æ•°æ®ï¼Œè¿™æ ·å°±èƒ½åœ¨ä¿è¯æ•°æ®å®Œæ•´æ€§çš„åŒæ—¶ï¼Œæå‡æ¢å¤é€Ÿåº¦ã€‚</p>
<h4 id="å¦‚ä½•è®¾ç½®æŒä¹…åŒ–æ¨¡å¼ï¼Ÿ"><a href="#å¦‚ä½•è®¾ç½®æŒä¹…åŒ–æ¨¡å¼ï¼Ÿ" class="headerlink" title="å¦‚ä½•è®¾ç½®æŒä¹…åŒ–æ¨¡å¼ï¼Ÿ"></a>å¦‚ä½•è®¾ç½®æŒä¹…åŒ–æ¨¡å¼ï¼Ÿ</h4><p>å¯ç”¨æ··åˆæŒä¹…åŒ–çš„æ–¹å¼éžå¸¸ç®€å•ï¼Œåªéœ€è¦åœ¨é…ç½®æ–‡ä»¶ä¸­è®¾ç½® <code>aof-use-rdb-preamble yes</code> å°±å¯ä»¥äº†ã€‚</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">aof-use-rdb-preamble yes</span><br></pre></td></tr></table></figure>

<h4 id="ä½ åœ¨å¼€å‘ä¸­æ˜¯æ€Žä¹ˆé…ç½®-RDB-å’Œ-AOF-çš„ï¼Ÿ"><a href="#ä½ åœ¨å¼€å‘ä¸­æ˜¯æ€Žä¹ˆé…ç½®-RDB-å’Œ-AOF-çš„ï¼Ÿ" class="headerlink" title="ä½ åœ¨å¼€å‘ä¸­æ˜¯æ€Žä¹ˆé…ç½® RDB å’Œ AOF çš„ï¼Ÿ"></a>ä½ åœ¨å¼€å‘ä¸­æ˜¯æ€Žä¹ˆé…ç½® RDB å’Œ AOF çš„ï¼Ÿ</h4><p>å¯¹äºŽå¤§å¤šæ•°ç”Ÿäº§çŽ¯å¢ƒï¼Œæˆ‘å€¾å‘äºŽä½¿ç”¨æ··åˆæŒä¹…åŒ–æ–¹å¼ï¼Œç»“åˆ RDB å’Œ AOF çš„ä¼˜ç‚¹ã€‚</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"># å¯ç”¨AOF</span><br><span class="line">appendonly yes</span><br><span class="line"></span><br><span class="line"># ä½¿ç”¨æ··åˆæŒä¹…åŒ–</span><br><span class="line">aof-use-rdb-preamble yes</span><br><span class="line"></span><br><span class="line"># æ¯ç§’åŒæ­¥ä¸€æ¬¡AOFï¼Œå¹³è¡¡æ€§èƒ½å’Œå®‰å…¨æ€§</span><br><span class="line">appendfsync everysec</span><br><span class="line"></span><br><span class="line"># AOFé‡å†™è§¦å‘æ¡ä»¶ï¼šæ–‡ä»¶å¢žé•¿100%ä¸”è‡³å°‘è¾¾åˆ°64MB</span><br><span class="line">auto-aof-rewrite-percentage 100</span><br><span class="line">auto-aof-rewrite-min-size 64mb</span><br><span class="line"></span><br><span class="line"># RDBå¤‡ä»½ç­–ç•¥</span><br><span class="line">save 900 1    # 15åˆ†é’Ÿå†…æœ‰1ä¸ªä¿®æ”¹</span><br><span class="line">save 300 10   # 5åˆ†é’Ÿå†…æœ‰10ä¸ªä¿®æ”¹</span><br><span class="line">save 60 10000 # 1åˆ†é’Ÿå†…æœ‰10000ä¸ªä¿®æ”¹</span><br></pre></td></tr></table></figure>

<p>å¯¹äºŽå•çº¯çš„ç¼“å­˜åœºæ™¯ï¼Œæˆ–è€…æœ¬åœ°å¼€å‘ï¼Œæˆ‘ä¼šåªå¯ç”¨ RDBï¼Œå…³é—­ AOFï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"># ç¦ç”¨AOF</span><br><span class="line">appendonly no</span><br><span class="line"></span><br><span class="line"># è¾ƒå®½æ¾çš„RDBç­–ç•¥</span><br><span class="line">save 3600 1    # 1å°æ—¶å†…æœ‰1ä¸ªä¿®æ”¹</span><br><span class="line">save 300 100   # 5åˆ†é’Ÿå†…æœ‰100ä¸ªä¿®æ”¹</span><br></pre></td></tr></table></figure>

<p>è€Œå¯¹äºŽé‡‘èžç±»ç­‰é«˜ä¸€è‡´æ€§çš„ç³»ç»Ÿï¼Œæˆ‘é€šå¸¸ä¼šåœ¨å…³é”®æ—¶é—´çª—å£åŠ¨æ€å°† <code>appendfsync</code> è®¾ç½®ä¸º <code>always</code>ï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"># å¯ç”¨AOF</span><br><span class="line">appendonly yes</span><br><span class="line"></span><br><span class="line"># ä½¿ç”¨æ··åˆæŒä¹…åŒ–</span><br><span class="line">aof-use-rdb-preamble yes</span><br><span class="line"></span><br><span class="line"># æ¯ä¸ªå‘½ä»¤éƒ½åŒæ­¥ï¼ˆè°¨æ…Žä½¿ç”¨ï¼Œæ€§èƒ½å½±å“å¤§ï¼‰</span><br><span class="line"># é€šå¸¸æˆ‘ä¼šåœ¨å…³é”®æ—¶é—´çª—å£åŠ¨æ€ä¿®æ”¹ä¸ºalways</span><br><span class="line">appendfsync always</span><br><span class="line"></span><br><span class="line"># æ›´é¢‘ç¹çš„RDBå¿«ç…§</span><br><span class="line">save 300 1     # 5åˆ†é’Ÿå†…æœ‰1ä¸ªä¿®æ”¹</span><br><span class="line">save 60 100    # 1åˆ†é’Ÿå†…æœ‰100ä¸ªä¿®æ”¹</span><br></pre></td></tr></table></figure>

<p>å¦å¤–ï¼Œå¯¹äºŽé«˜å¹¶å‘åœºæ™¯ï¼Œåº”è¯¥è®¾ç½®<code>no-appendfsync-on-rewrite yes</code>ï¼Œé¿å… AOF é‡å†™å½±å“ä¸»è¿›ç¨‹æ€§èƒ½ï¼›å¯¹äºŽå¤§åž‹å®žä¾‹ï¼Œä¹Ÿåº”è¯¥è®¾ç½® <code>rdb-save-incremental-fsync yes</code> æ¥å‡å°‘å¤§åž‹ RDB ä¿å­˜å¯¹æ€§èƒ½çš„å½±å“ã€‚</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"># AOFé‡å†™æœŸé—´ä¸fsyncï¼ŒAOF é‡å†™æœŸé—´ï¼Œä¸»è¿›ç¨‹ä¸ä¼šå¯¹æ–°å†™å…¥çš„ AOF ç¼“å†²åŒºæ‰§è¡Œ fsync æ“ä½œï¼ˆå³ä¸å¼ºåˆ¶åˆ·ç›˜ï¼‰ï¼Œè€Œæ˜¯ç­‰é‡å†™ç»“æŸåŽå†ç»Ÿä¸€åˆ·ç›˜ã€‚</span><br><span class="line">no-appendfsync-on-rewrite yes</span><br><span class="line"># RDB å¿«ç…§ä¿å­˜æ—¶é‡‡ç”¨å¢žé‡ fsyncï¼Œå³æ¯å†™å…¥ä¸€å®šé‡çš„æ•°æ®å°±æ‰§è¡Œä¸€æ¬¡ fsyncï¼Œå°†æ•°æ®åˆ†æ‰¹åŒæ­¥åˆ°ç£ç›˜ã€‚</span><br><span class="line">rdb-save-incremental-fsync yes</span><br></pre></td></tr></table></figure>


<h3 id="29-ðŸŒŸä»€ä¹ˆæ˜¯ç¼“å­˜å‡»ç©¿ï¼Ÿ"><a href="#29-ðŸŒŸä»€ä¹ˆæ˜¯ç¼“å­˜å‡»ç©¿ï¼Ÿ" class="headerlink" title="29.ðŸŒŸä»€ä¹ˆæ˜¯ç¼“å­˜å‡»ç©¿ï¼Ÿ"></a>29.ðŸŒŸä»€ä¹ˆæ˜¯ç¼“å­˜å‡»ç©¿ï¼Ÿ</h3><p>ç¼“å­˜å‡»ç©¿æ˜¯æŒ‡æŸä¸ªçƒ­ç‚¹æ•°æ®ç¼“å­˜è¿‡æœŸæ—¶ï¼Œå¤§é‡è¯·æ±‚å°±ä¼šç©¿é€ç¼“å­˜ç›´æŽ¥è®¿é—®æ•°æ®åº“ï¼Œå¯¼è‡´æ•°æ®åº“çž¬é—´æ‰¿å—çš„åŽ‹åŠ›å·¨å¤§ã€‚</p>
<p><img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="https://cdn.jsdelivr.net/gh/JakicDong/blog-assets@main/images/20251022093956.png" alt="20251022093956"><br>fengkui.netï¼šç¼“å­˜å‡»ç©¿</p>
<p>è§£å†³ç¼“å­˜å‡»ç©¿æœ‰ä¸¤ç§å¸¸ç”¨çš„ç­–ç•¥ï¼š</p>
<p>ç¬¬ä¸€ç§æ˜¯åŠ äº’æ–¥é”ã€‚å½“ç¼“å­˜å¤±æ•ˆæ—¶ï¼Œç¬¬ä¸€ä¸ªè®¿é—®çš„çº¿ç¨‹å…ˆèŽ·å–é”å¹¶è´Ÿè´£é‡å»ºç¼“å­˜ï¼Œå…¶ä»–çº¿ç¨‹ç­‰å¾…æˆ–é‡è¯•ã€‚</p>
<p><img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="https://cdn.jsdelivr.net/gh/JakicDong/blog-assets@main/images/20251022094156.png" alt="20251022094156"><br>ä¸‰åˆ†æ¶é¢æ¸£é€†è¢­ï¼šåŠ é”æ›´æ–°</p>
<p>è¿™ç§ç­–ç•¥è™½ç„¶ä¼šå¯¼è‡´éƒ¨åˆ†è¯·æ±‚å»¶è¿Ÿï¼Œä½†å®žçŽ°èµ·æ¥ç›¸å¯¹ç®€å•ã€‚åœ¨<a target="_blank" rel="noopener" href="https://javabetter.cn/zhishixingqiu/paicoding.html">æŠ€æœ¯æ´¾å®žæˆ˜é¡¹ç›®</a>ä¸­ï¼Œæˆ‘ä»¬å°±ä½¿ç”¨äº† Redisson çš„åˆ†å¸ƒå¼é”æ¥ç¡®ä¿åªæœ‰ä¸€ä¸ªæœåŠ¡å®žä¾‹èƒ½æ›´æ–°ç¼“å­˜ã€‚</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">String</span> <span class="variable">cacheKey</span> <span class="operator">=</span> <span class="string">&quot;product::&quot;</span> + productId;</span><br><span class="line"><span class="type">RLock</span> <span class="variable">lock</span> <span class="operator">=</span> redissonClient.getLock(<span class="string">&quot;lock::&quot;</span> + productId);</span><br><span class="line"><span class="keyword">if</span> (lock.tryLock(<span class="number">10</span>, TimeUnit.SECONDS)) &#123;</span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">        <span class="type">String</span> <span class="variable">result</span> <span class="operator">=</span> cache.get(cacheKey);</span><br><span class="line">        <span class="keyword">if</span> (result == <span class="literal">null</span>) &#123;</span><br><span class="line">            result = database.queryProductById(productId);</span><br><span class="line">            cache.set(cacheKey, result, <span class="number">60</span> * <span class="number">1000</span>); <span class="comment">// è®¾ç½®ç¼“å­˜</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">        lock.unlock();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>ç¬¬äºŒç§æ˜¯æ°¸ä¸è¿‡æœŸç­–ç•¥ã€‚ç¼“å­˜é¡¹æœ¬èº«ä¸è®¾ç½®è¿‡æœŸæ—¶é—´ï¼Œä¹Ÿå°±æ˜¯æ°¸ä¸è¿‡æœŸï¼Œä½†åœ¨ç¼“å­˜å€¼ä¸­ç»´æŠ¤ä¸€ä¸ªé€»è¾‘è¿‡æœŸæ—¶é—´ã€‚å½“ç¼“å­˜é€»è¾‘ä¸Šè¿‡æœŸæ—¶ï¼Œè¿”å›žæ—§å€¼çš„åŒæ—¶ï¼Œå¼‚æ­¥å¯åŠ¨ä¸€ä¸ªçº¿ç¨‹åŽ»æ›´æ–°ç¼“å­˜ã€‚</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> String <span class="title function_">getData</span><span class="params">(String key)</span> &#123;</span><br><span class="line">    <span class="type">CacheItem</span> <span class="variable">item</span> <span class="operator">=</span> cache.get(key);</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">if</span> (item == <span class="literal">null</span>) &#123;</span><br><span class="line">        <span class="comment">// ç¼“å­˜ä¸å­˜åœ¨ï¼ŒåŒæ­¥åŠ è½½</span></span><br><span class="line">        <span class="type">String</span> <span class="variable">data</span> <span class="operator">=</span> db.query(key);</span><br><span class="line">        cache.set(key, <span class="keyword">new</span> <span class="title class_">CacheItem</span>(data, System.currentTimeMillis() + expireTime));</span><br><span class="line">        <span class="keyword">return</span> data;</span><br><span class="line">    &#125; <span class="keyword">else</span> <span class="keyword">if</span> (item.isLogicalExpired()) &#123;</span><br><span class="line">        <span class="comment">// é€»è¾‘è¿‡æœŸï¼Œå¼‚æ­¥åˆ·æ–°</span></span><br><span class="line">        asyncRefresh(key);</span><br><span class="line">        <span class="comment">// è¿”å›žæ—§æ•°æ®</span></span><br><span class="line">        <span class="keyword">return</span> item.getData();</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">return</span> item.getData();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// å¼‚æ­¥åˆ·æ–°ç¼“å­˜</span></span><br><span class="line"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title function_">asyncRefresh</span><span class="params">(<span class="keyword">final</span> String key)</span> &#123;</span><br><span class="line">    threadPool.execute(() -&gt; &#123;</span><br><span class="line">        <span class="comment">// é‡æ–°æŸ¥è¯¢æ•°æ®åº“</span></span><br><span class="line">        <span class="type">String</span> <span class="variable">newData</span> <span class="operator">=</span> db.query(key);</span><br><span class="line">        <span class="comment">// æ›´æ–°ç¼“å­˜</span></span><br><span class="line">        cache.set(key, <span class="keyword">new</span> <span class="title class_">CacheItem</span>(newData, System.currentTimeMillis() + expireTime));</span><br><span class="line">    &#125;);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>memoï¼š2025 å¹´ 5 æœˆ 18 æ—¥ä¿®æ”¹è‡³æ­¤ï¼Œä»Šå¤©ç»™<a target="_blank" rel="noopener" href="https://javabetter.cn/zhishixingqiu/">çƒå‹æ”¹ç®€åŽ†æ—¶</a>ï¼Œç¢°åˆ°ä¸€ä¸ªè¥¿åŒ—å·¥ä¸šå¤§å­¦çš„çƒå‹ï¼Œè¿™åˆæ˜¯ä¸€æ‰€ 985 é™¢æ ¡ï¼Œå¸Œæœ›è¿™ä¸ªç¤¾ç¾¤èƒ½æŠŠæ‰€æœ‰çš„ 985 é™¢æ ¡é›†é½ï¼Œä¹Ÿå¸Œæœ›åŽ»å¸®åŠ©åˆ°æ›´å¤šé™¢æ ¡çš„åŒå­¦ï¼Œå¸Œæœ›éƒ½èƒ½æ‹¿åˆ°ä¸€ä¸ªæ»¡æ„çš„ offerã€‚</p>
<h4 id="ä»€ä¹ˆæ˜¯ç¼“å­˜ç©¿é€ï¼Ÿ"><a href="#ä»€ä¹ˆæ˜¯ç¼“å­˜ç©¿é€ï¼Ÿ" class="headerlink" title="ä»€ä¹ˆæ˜¯ç¼“å­˜ç©¿é€ï¼Ÿ"></a>ä»€ä¹ˆæ˜¯ç¼“å­˜ç©¿é€ï¼Ÿ</h4><p>ç¼“å­˜ç©¿é€æ˜¯æŒ‡æŸ¥è¯¢çš„æ•°æ®åœ¨ç¼“å­˜ä¸­æ²¡æœ‰å‘½ä¸­ï¼Œå› ä¸ºæ•°æ®åŽ‹æ ¹ä¸å­˜åœ¨ï¼Œæ‰€ä»¥è¯·æ±‚ä¼šç›´æŽ¥è½åˆ°æ•°æ®åº“ä¸Šã€‚å¦‚æžœè¿™ç§æŸ¥è¯¢éžå¸¸é¢‘ç¹ï¼Œå°±ä¼šç»™æ•°æ®åº“é€ æˆå¾ˆå¤§çš„åŽ‹åŠ›ã€‚</p>
<p><img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="https://cdn.jsdelivr.net/gh/JakicDong/blog-assets@main/images/20251022094922.png" alt="20251022094922"><br>fengkui.netï¼šç¼“å­˜ç©¿é€</p>
<p>ç¼“å­˜å‡»ç©¿æ˜¯å› ä¸ºå•ä¸ªçƒ­ç‚¹æ•°æ®ç¼“å­˜å¤±æ•ˆå¯¼è‡´çš„ï¼Œè€Œç¼“å­˜ç©¿é€æ˜¯å› ä¸ºæŸ¥è¯¢çš„æ•°æ®ä¸å­˜åœ¨ï¼ŒåŽŸå› å¯èƒ½æ˜¯è‡ªèº«çš„ä¸šåŠ¡ä»£ç æœ‰é—®é¢˜ï¼Œæˆ–è€…æ˜¯æ¶æ„æ”»å‡»é€ æˆçš„ï¼Œæ¯”å¦‚çˆ¬è™«ã€‚</p>
<p>å¸¸ç”¨çš„è§£å†³æ–¹æ¡ˆæœ‰ä¸¤ç§ï¼šç¬¬ä¸€ç§æ˜¯å¸ƒéš†è¿‡æ»¤å™¨ï¼Œå®ƒæ˜¯ä¸€ç§ç©ºé—´æ•ˆçŽ‡å¾ˆé«˜çš„æ•°æ®ç»“æž„ï¼Œå¯ä»¥ç”¨æ¥åˆ¤æ–­ä¸€ä¸ªå…ƒç´ æ˜¯å¦åœ¨é›†åˆä¸­ã€‚</p>
<p>æˆ‘ä»¬å¯ä»¥å°†æ‰€æœ‰å¯èƒ½å­˜åœ¨çš„æ•°æ®å“ˆå¸Œåˆ°å¸ƒéš†è¿‡æ»¤å™¨ä¸­ï¼ŒæŸ¥è¯¢æ—¶å…ˆæ£€æŸ¥å¸ƒéš†è¿‡æ»¤å™¨ï¼Œå¦‚æžœå¸ƒéš†è¿‡æ»¤å™¨è®¤ä¸ºè¯¥æ•°æ®ä¸å­˜åœ¨ï¼Œå°±ç›´æŽ¥è¿”å›žç©ºï¼›å¦åˆ™å†åŽ»æŸ¥è¯¢ç¼“å­˜ï¼Œè¿™æ ·å°±å¯ä»¥é¿å…æ— æ•ˆçš„ç¼“å­˜æŸ¥è¯¢ã€‚</p>
<p><img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="https://cdn.jsdelivr.net/gh/JakicDong/blog-assets@main/images/20251022095153.png" alt="20251022095153"><br>é…’å‰‘ä»™ï¼šå¸ƒéš†è¿‡æ»¤å™¨è§£å†³ç¼“å­˜ç©¿é€</p>
<p>ä»£ç ç¤ºä¾‹ï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> String <span class="title function_">getData</span><span class="params">(String key)</span> &#123;</span><br><span class="line">    <span class="comment">// ç¼“å­˜ä¸­ä¸å­˜åœ¨è¯¥key</span></span><br><span class="line">    <span class="type">String</span> <span class="variable">cacheResult</span> <span class="operator">=</span> cache.get(key);</span><br><span class="line">    <span class="keyword">if</span> (cacheResult != <span class="literal">null</span>) &#123;</span><br><span class="line">        <span class="keyword">return</span> cacheResult;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// å¸ƒéš†è¿‡æ»¤å™¨åˆ¤æ–­keyæ˜¯å¦å¯èƒ½å­˜åœ¨</span></span><br><span class="line">    <span class="keyword">if</span> (!bloomFilter.mightContain(key)) &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">null</span>; <span class="comment">// ä¸€å®šä¸å­˜åœ¨ï¼Œç›´æŽ¥è¿”å›ž</span></span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// å¯èƒ½å­˜åœ¨ï¼ŒæŸ¥è¯¢æ•°æ®åº“</span></span><br><span class="line">    <span class="type">String</span> <span class="variable">dbResult</span> <span class="operator">=</span> db.query(key);</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// å°†ç»“æžœæ”¾å…¥ç¼“å­˜ï¼ŒåŒ…æ‹¬ç©ºå€¼</span></span><br><span class="line">    cache.set(key, dbResult != <span class="literal">null</span> ? dbResult : <span class="string">&quot;&quot;</span>, expireTime);</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">return</span> dbResult;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>å¸ƒéš†è¿‡æ»¤å™¨å­˜åœ¨è¯¯åˆ¤ï¼Œå³å¯èƒ½ä¼šè®¤ä¸ºæŸä¸ªæ•°æ®å­˜åœ¨ï¼Œä½†å®žé™…ä¸Šå¹¶ä¸å­˜åœ¨ã€‚ä½†ç»ä¸ä¼šæ¼åˆ¤ï¼Œå³å¦‚æžœå¸ƒéš†è¿‡æ»¤å™¨è®¤ä¸ºæŸä¸ªæ•°æ®ä¸å­˜åœ¨ï¼Œé‚£å®ƒä¸€å®šä¸å­˜åœ¨ã€‚å› æ­¤å®ƒå¯ä»¥æœ‰æ•ˆæ‹¦æˆªä¸å­˜åœ¨çš„æ•°æ®æŸ¥è¯¢ï¼Œå‡è½»æ•°æ®åº“åŽ‹åŠ›ã€‚</p>
<p>ç¬¬äºŒç§æ˜¯<strong>ç¼“å­˜ç©ºå€¼</strong>ã€‚å¯¹äºŽä¸å­˜åœ¨çš„æ•°æ®ï¼Œæˆ‘ä»¬å°†ç©ºå€¼å†™å…¥ç¼“å­˜ï¼Œå¹¶è®¾ç½®ä¸€ä¸ªåˆç†çš„è¿‡æœŸæ—¶é—´ã€‚è¿™æ ·ä¸‹æ¬¡ç›¸åŒçš„æŸ¥è¯¢å°±èƒ½ç›´æŽ¥ä»Žç¼“å­˜è¿”å›žï¼Œè€Œä¸å†è®¿é—®æ•°æ®åº“ã€‚</p>
<p><img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="https://cdn.jsdelivr.net/gh/JakicDong/blog-assets@main/images/20251028151204.png" alt="20251028151204"><br>ä¸‰åˆ†æ¶é¢æ¸£é€†è¢­ï¼šç¼“å­˜ç©ºå€¼&#x2F;é»˜è®¤å€¼</p>
<p>ä»£ç ç¤ºä¾‹ï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> String <span class="title function_">getData</span><span class="params">(String key)</span> &#123;</span><br><span class="line">    <span class="type">String</span> <span class="variable">cacheResult</span> <span class="operator">=</span> cache.get(key);</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// ç¼“å­˜å‘½ä¸­ï¼ŒåŒ…æ‹¬ç©ºå€¼</span></span><br><span class="line">    <span class="keyword">if</span> (cacheResult != <span class="literal">null</span>) &#123;</span><br><span class="line">        <span class="comment">// ç‰¹æ®Šå€¼è¡¨ç¤ºç©ºç»“æžœ</span></span><br><span class="line">        <span class="keyword">if</span> (cacheResult.equals(<span class="string">&quot;&quot;</span>)) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">null</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> cacheResult;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// ç¼“å­˜æœªå‘½ä¸­ï¼ŒæŸ¥è¯¢æ•°æ®åº“</span></span><br><span class="line">    <span class="type">String</span> <span class="variable">dbResult</span> <span class="operator">=</span> db.query(key);</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// å†™å…¥ç¼“å­˜ï¼Œç©ºå€¼ä¹Ÿç¼“å­˜ï¼Œä½†è®¾ç½®è¾ƒçŸ­çš„è¿‡æœŸæ—¶é—´</span></span><br><span class="line">    <span class="type">int</span> <span class="variable">expireTime</span> <span class="operator">=</span> dbResult == <span class="literal">null</span> ? EMPTY_EXPIRE_TIME : NORMAL_EXPIRE_TIME;</span><br><span class="line">    cache.set(key, dbResult != <span class="literal">null</span> ? dbResult : <span class="string">&quot;&quot;</span>, expireTime);</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">return</span> dbResult;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>ç¼“å­˜ç©ºå€¼çš„æ–¹æ³•å®žçŽ°èµ·æ¥æ¯”è¾ƒç®€å•ï¼Œä½†éœ€è¦ç»™ç©ºå€¼è®¾ç½®ä¸€ä¸ªåˆç†çš„è¿‡æœŸæ—¶é—´ï¼Œä»¥å…æ•°æ®åº“ä¸­æ–°å¢žäº†è¿™äº›æ•°æ®åŽï¼Œç¼“å­˜ä»ç„¶è¿”å›žç©ºå€¼ã€‚</p>
<p>åœ¨å®žé™…çš„é¡¹ç›®å½“ä¸­ï¼Œè¿˜éœ€è¦åœ¨æŽ¥å£å±‚é¢åšä¸€äº›å¤„ç†ï¼Œæ¯”å¦‚è¯´å¯¹å‚æ•°è¿›è¡Œæ ¡éªŒï¼Œæ‹¦æˆªæ˜Žæ˜¾ä¸åˆç†çš„è¯·æ±‚ï¼›æˆ–è€…å¯¹ç–‘ä¼¼æ”»å‡»çš„ IP è¿›è¡Œé™æµå’Œå°ç¦ã€‚</p>
<h4 id="ä»€ä¹ˆæ˜¯ç¼“å­˜é›ªå´©ï¼Ÿ"><a href="#ä»€ä¹ˆæ˜¯ç¼“å­˜é›ªå´©ï¼Ÿ" class="headerlink" title="ä»€ä¹ˆæ˜¯ç¼“å­˜é›ªå´©ï¼Ÿ"></a>ä»€ä¹ˆæ˜¯ç¼“å­˜é›ªå´©ï¼Ÿ</h4><p>ç¼“å­˜é›ªå´©æ˜¯æŒ‡åœ¨æŸä¸€æ—¶é—´æ®µï¼Œå¤§é‡ç¼“å­˜åŒæ—¶å¤±æ•ˆæˆ–è€…ç¼“å­˜æœåŠ¡çªç„¶å®•æœºäº†ï¼Œå¯¼è‡´å¤§é‡è¯·æ±‚ç›´æŽ¥æ¶Œå‘æ•°æ®åº“ï¼Œå¯¼è‡´æ•°æ®åº“åŽ‹åŠ›å‰§å¢žï¼Œç”šè‡³å¼•å‘ç³»ç»Ÿå´©æºƒçš„çŽ°è±¡ã€‚</p>
<p><img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="https://cdn.jsdelivr.net/gh/JakicDong/blog-assets@main/images/20251022100013.png" alt="20251022100013"><br>ä¸‰åˆ†æ¶é¢æ¸£é€†è¢­ï¼šç¼“å­˜é›ªå´©</p>
<p>ç¼“å­˜å‡»ç©¿æ˜¯å•ä¸ªçƒ­ç‚¹æ•°æ®å¤±æ•ˆå¯¼è‡´çš„ï¼Œç¼“å­˜ç©¿é€æ˜¯å› ä¸ºè¯·æ±‚ä¸å­˜åœ¨çš„æ•°æ®ï¼Œè€Œç¼“å­˜é›ªå´©æ˜¯å› ä¸ºå¤§èŒƒå›´çš„ç¼“å­˜å¤±æ•ˆã€‚</p>
<p>ç¼“å­˜é›ªå´©ä¸»è¦æœ‰ä¸‰ç§æˆå› å’Œåº”å¯¹ç­–ç•¥ã€‚</p>
<p>ç¬¬ä¸€ç§ï¼Œå¤§é‡ç¼“å­˜åŒæ—¶è¿‡æœŸï¼Œè§£å†³æ–¹æ³•æ˜¯æ·»åŠ éšæœºè¿‡æœŸæ—¶é—´ã€‚</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setCache</span><span class="params">(String key, String value)</span> &#123;</span><br><span class="line">    <span class="comment">// åŸºç¡€è¿‡æœŸæ—¶é—´ï¼Œä¾‹å¦‚30åˆ†é’Ÿ</span></span><br><span class="line">    <span class="type">int</span> <span class="variable">baseExpireSeconds</span> <span class="operator">=</span> <span class="number">1800</span>;</span><br><span class="line">    <span class="comment">// å¢žåŠ éšæœºè¿‡æœŸæ—¶é—´ï¼ŒèŒƒå›´0-300ç§’</span></span><br><span class="line">    <span class="type">int</span> <span class="variable">randomSeconds</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Random</span>().nextInt(<span class="number">300</span>);</span><br><span class="line">    <span class="comment">// æœ€ç»ˆè¿‡æœŸæ—¶é—´ä¸ºåŸºç¡€æ—¶é—´åŠ éšæœºæ—¶é—´</span></span><br><span class="line">    cache.set(key, value, baseExpireSeconds + randomSeconds);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>ç¬¬äºŒç§ï¼Œç¼“å­˜æœåŠ¡å´©æºƒï¼Œè§£å†³æ–¹æ³•æ˜¯ä½¿ç”¨é«˜å¯ç”¨çš„ç¼“å­˜é›†ç¾¤ã€‚</p>
<p>æ¯”å¦‚è¯´ä½¿ç”¨ Redis Cluster æž„å»ºå¤šèŠ‚ç‚¹é›†ç¾¤ï¼Œç¡®ä¿æ•°æ®åœ¨å¤šä¸ªèŠ‚ç‚¹ä¸Šæœ‰å¤‡ä»½ï¼Œå¹¶ä¸”æ”¯æŒè‡ªåŠ¨æ•…éšœè½¬ç§»ã€‚</p>
<p><img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="https://cdn.jsdelivr.net/gh/JakicDong/blog-assets@main/images/20251022101036.png" alt="20251022101036"><br>Rajat Pachauriï¼šRedis Cluster</p>
<p>å¯¹äºŽä¸€äº›é«˜é¢‘å…³é”®æ•°æ®ï¼Œå¯ä»¥é…ç½®æœ¬åœ°ç¼“å­˜ä½œä¸ºäºŒçº§ç¼“å­˜ï¼Œç¼“è§£ Redis çš„åŽ‹åŠ›ã€‚åœ¨<a target="_blank" rel="noopener" href="https://javabetter.cn/zhishixingqiu/paicoding.html">æŠ€æœ¯æ´¾å®žæˆ˜é¡¹ç›®</a>ä¸­ï¼Œæˆ‘ä»¬å°±é‡‡ç”¨äº†å¤šçº§ç¼“å­˜çš„ç­–ç•¥ï¼Œå…¶ä¸­å°±åŒ…æ‹¬ä½¿ç”¨æœ¬åœ°ç¼“å­˜ Caffeine æ¥ä½œä¸ºäºŒçº§ç¼“å­˜ï¼Œå½“ Redis å‡ºçŽ°é—®é¢˜æ—¶è‡ªåŠ¨åˆ‡æ¢åˆ°æœ¬åœ°ç¼“å­˜ã€‚</p>
<p>è¿™ä¸ªè¿‡ç¨‹ç§°ä¸ºâ€œç¼“å­˜é™çº§â€ï¼Œä¿è¯ Redis å‘ç”Ÿæ•…éšœæ—¶ï¼Œç³»ç»Ÿèƒ½å¤Ÿç»§ç»­æä¾›æœåŠ¡ã€‚</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">LoadingCache&lt;String, UserPermissions&gt; permissionsCache = Caffeine.newBuilder()</span><br><span class="line">    .maximumSize(<span class="number">1000</span>)</span><br><span class="line">    .expireAfterWrite(<span class="number">10</span>, TimeUnit.MINUTES)</span><br><span class="line">    .build(<span class="built_in">this</span>::loadPermissionsFromRedis);</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> UserPermissions <span class="title function_">loadPermissionsFromRedis</span><span class="params">(String userId)</span> &#123;</span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> redisClient.getPermissions(userId);</span><br><span class="line">    &#125; <span class="keyword">catch</span> (Exception ex) &#123;</span><br><span class="line">        <span class="comment">// Redis å¼‚å¸¸å¤„ç†ï¼Œå°è¯•ä»Žæœ¬åœ°ç¼“å­˜èŽ·å–</span></span><br><span class="line">        <span class="keyword">return</span> permissionsCache.getIfPresent(userId);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>ç¬¬ä¸‰ç§ï¼Œç¼“å­˜æœåŠ¡æ­£å¸¸ä½†å¹¶å‘è¯·æ±‚é‡è¶…è¿‡äº†ç¼“å­˜æœåŠ¡çš„æ‰¿è½½èƒ½åŠ›ï¼Œè¿™ç§æƒ…å†µä¸‹å¯ä»¥é‡‡ç”¨é™æµå’Œé™çº§æŽªæ–½ã€‚</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> String <span class="title function_">getData</span><span class="params">(String key)</span> &#123;</span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">        <span class="comment">// å°è¯•ä»Žç¼“å­˜èŽ·å–æ•°æ®</span></span><br><span class="line">        <span class="keyword">return</span> cache.get(key);</span><br><span class="line">    &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">        <span class="comment">// ç¼“å­˜æœåŠ¡å¼‚å¸¸ï¼Œè§¦å‘ç†”æ–­</span></span><br><span class="line">        <span class="keyword">if</span> (circuitBreaker.shouldTrip()) &#123;</span><br><span class="line">            <span class="comment">// ç›´æŽ¥ä»Žæ•°æ®åº“èŽ·å–ï¼Œå¹¶è¿›å…¥é™çº§æ¨¡å¼</span></span><br><span class="line">            circuitBreaker.trip();</span><br><span class="line">            <span class="keyword">return</span> getFromDbDirectly(key);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">throw</span> e;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">private</span> String <span class="title function_">getFromDbDirectly</span><span class="params">(String key)</span> &#123;</span><br><span class="line">    <span class="comment">// å®žæ–½é™æµä¿æŠ¤</span></span><br><span class="line">    <span class="keyword">if</span> (!rateLimit.tryAcquire()) &#123;</span><br><span class="line">        <span class="comment">// è¶…è¿‡é™æµé˜ˆå€¼ï¼Œè¿”å›žå…œåº•æ•°æ®æˆ–é»˜è®¤å€¼</span></span><br><span class="line">        <span class="keyword">return</span> getDefaultValue(key);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// é™æµé€šè¿‡ï¼Œä»Žæ•°æ®åº“æŸ¥è¯¢</span></span><br><span class="line">    <span class="keyword">return</span> db.query(key);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<blockquote>
<ol>
<li><a target="_blank" rel="noopener" href="https://javabetter.cn/zhishixingqiu/mianshi.html">Java é¢è¯•æŒ‡å—ï¼ˆä»˜è´¹ï¼‰</a>æ”¶å½•çš„è…¾è®¯é¢ç»åŒå­¦ 22 æš‘æœŸå®žä¹ ä¸€é¢é¢è¯•åŽŸé¢˜ï¼šç¼“å­˜é›ªå´©ï¼Œå¦‚ä½•è§£å†³</li>
<li><a target="_blank" rel="noopener" href="https://javabetter.cn/zhishixingqiu/mianshi.html">Java é¢è¯•æŒ‡å—ï¼ˆä»˜è´¹ï¼‰</a>æ”¶å½•çš„å¿«æ‰‹é¢ç»åŒå­¦ 7 Java åŽç«¯æŠ€æœ¯ä¸€é¢é¢è¯•åŽŸé¢˜ï¼šè¯´ä¸€ä¸‹ ç¼“å­˜ç©¿é€ã€ç¼“å­˜å‡»ç©¿ã€ç¼“å­˜é›ªå´©</li>
<li><a target="_blank" rel="noopener" href="https://javabetter.cn/zhishixingqiu/mianshi.html">Java é¢è¯•æŒ‡å—ï¼ˆä»˜è´¹ï¼‰</a>æ”¶å½•çš„å­—èŠ‚è·³åŠ¨åŒå­¦ 7 Java åŽç«¯å®žä¹ ä¸€é¢çš„åŽŸé¢˜ï¼šRedis å®•æœºä¼šä¸ä¼šå¯¹æƒé™ç³»ç»Ÿæœ‰å½±å“ï¼Ÿ</li>
<li><a target="_blank" rel="noopener" href="https://javabetter.cn/zhishixingqiu/mianshi.html">Java é¢è¯•æŒ‡å—ï¼ˆä»˜è´¹ï¼‰</a>æ”¶å½•çš„å­—èŠ‚è·³åŠ¨åŒå­¦ 7 Java åŽç«¯å®žä¹ ä¸€é¢çš„åŽŸé¢˜ï¼šè¯´ä¸€ä¸‹ Redis é›ªå´©ã€ç©¿é€ã€å‡»ç©¿ç­‰åœºæ™¯çš„è§£å†³æ–¹æ¡ˆ</li>
<li><a target="_blank" rel="noopener" href="https://javabetter.cn/zhishixingqiu/mianshi.html">Java é¢è¯•æŒ‡å—ï¼ˆä»˜è´¹ï¼‰</a>æ”¶å½•çš„å°ç±³åŒå­¦ F é¢è¯•åŽŸé¢˜ï¼šç¼“å­˜å¸¸è§é—®é¢˜å’Œè§£å†³æ–¹æ¡ˆï¼ˆå¼•ç”³åˆ°å¤šçº§ç¼“å­˜ï¼‰ï¼Œå¤šçº§ç¼“å­˜ï¼ˆredisï¼Œnginxï¼Œæœ¬åœ°ç¼“å­˜ï¼‰çš„å®žçŽ°æ€è·¯</li>
</ol>
</blockquote>
<h3 id="30-ðŸŒŸèƒ½è¯´è¯´å¸ƒéš†è¿‡æ»¤å™¨å—ï¼Ÿ"><a href="#30-ðŸŒŸèƒ½è¯´è¯´å¸ƒéš†è¿‡æ»¤å™¨å—ï¼Ÿ" class="headerlink" title="30.ðŸŒŸèƒ½è¯´è¯´å¸ƒéš†è¿‡æ»¤å™¨å—ï¼Ÿ"></a>30.ðŸŒŸèƒ½è¯´è¯´å¸ƒéš†è¿‡æ»¤å™¨å—ï¼Ÿ</h3><p>å¸ƒéš†è¿‡æ»¤å™¨æ˜¯ä¸€ç§ç©ºé—´æ•ˆçŽ‡æžé«˜çš„æ¦‚çŽ‡æ€§æ•°æ®ç»“æž„ï¼Œç”¨äºŽå¿«é€Ÿåˆ¤æ–­ä¸€ä¸ªå…ƒç´ æ˜¯å¦åœ¨ä¸€ä¸ªé›†åˆä¸­ã€‚å®ƒçš„ç‰¹ç‚¹æ˜¯èƒ½å¤Ÿä»¥æžå°çš„å†…å­˜æ¶ˆè€—ï¼Œåˆ¤æ–­ä¸€ä¸ªå…ƒç´ â€œä¸€å®šä¸åœ¨é›†åˆä¸­â€æˆ–â€œå¯èƒ½åœ¨é›†åˆä¸­â€ï¼Œå¸¸ç”¨æ¥è§£å†³ Redis ç¼“å­˜ç©¿é€çš„é—®é¢˜ã€‚</p>
<p><img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="https://cdn.jsdelivr.net/gh/JakicDong/blog-assets@main/images/20251022105702.png" alt="20251022105702"><br>ä¸‰åˆ†æ¶é¢æ¸£é€†è¢­ï¼šå¸ƒéš†è¿‡æ»¤å™¨</p>
<p>-â€”è¿™éƒ¨åˆ†é¢è¯•ä¸­å¯ä»¥ä¸èƒŒstartâ€”-</p>
<p>å¸ƒéš†è¿‡æ»¤å™¨çš„æ ¸å¿ƒç”±ä¸€ä¸ªå¾ˆé•¿çš„äºŒè¿›åˆ¶å‘é‡å’Œä¸€ç³»åˆ—å“ˆå¸Œå‡½æ•°ç»„æˆã€‚</p>
<ul>
<li>åˆå§‹åŒ–çš„æ—¶å€™ï¼Œåˆ›å»ºä¸€ä¸ªé•¿åº¦ä¸º m çš„ä½æ•°ç»„ï¼Œåˆå§‹å€¼å…¨ä¸º 0ï¼ŒåŒæ—¶é€‰æ‹© k ä¸ªä¸åŒçš„å“ˆå¸Œå‡½æ•°</li>
<li>å½“æ·»åŠ ä¸€ä¸ªå…ƒç´ æ—¶ï¼Œç”¨ k ä¸ªå“ˆå¸Œå‡½æ•°è®¡ç®—å‡º k ä¸ªå“ˆå¸Œå€¼ï¼Œç„¶åŽå¯¹ m å–æ¨¡ï¼Œå¾—åˆ° k ä¸ªä½ç½®ï¼Œå°†è¿™äº›ä½ç½®çš„äºŒè¿›åˆ¶ä½éƒ½è®¾ä¸º 1</li>
<li>å½“éœ€è¦åˆ¤æ–­ä¸€ä¸ªå…ƒç´ æ˜¯å¦åœ¨é›†åˆä¸­æ—¶ï¼ŒåŒæ ·ç”¨ k ä¸ªå“ˆå¸Œå‡½æ•°è®¡ç®—å‡º k ä¸ªä½ç½®ï¼Œå¦‚æžœè¿™äº›ä½ç½®çš„äºŒè¿›åˆ¶ä½æœ‰ä»»ä½•ä¸€ä¸ªä¸º 0ï¼Œè¯¥å…ƒç´ ä¸€å®šä¸åœ¨é›†åˆä¸­ï¼›å¦‚æžœå…¨éƒ¨ä¸º 1ï¼Œåˆ™è¯¥å…ƒç´ å¯èƒ½åœ¨é›†åˆä¸­</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">BloomFilter</span>&lt;T&gt; &#123;</span><br><span class="line">    <span class="keyword">private</span> BitSet bitSet;</span><br><span class="line">    <span class="keyword">private</span> <span class="type">int</span> bitSetSize;</span><br><span class="line">    <span class="keyword">private</span> <span class="type">int</span> numberOfHashFunctions;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">BloomFilter</span><span class="params">(<span class="type">double</span> falsePositiveProbability, <span class="type">int</span> expectedNumberOfElements)</span> &#123;</span><br><span class="line">        <span class="comment">// æ ¹æ®é¢„æœŸå…ƒç´ æ•°é‡å’ŒæœŸæœ›çš„è¯¯åˆ¤çŽ‡ï¼Œè®¡ç®—æœ€ä¼˜çš„ä½æ•°ç»„å¤§å°å’Œå“ˆå¸Œå‡½æ•°ä¸ªæ•°</span></span><br><span class="line">        <span class="built_in">this</span>.bitSetSize = calculateOptimalBitSetSize(expectedNumberOfElements, falsePositiveProbability);</span><br><span class="line">        <span class="built_in">this</span>.numberOfHashFunctions = calculateOptimalNumberOfHashFunctions(expectedNumberOfElements, bitSetSize);</span><br><span class="line">        <span class="built_in">this</span>.bitSet = <span class="keyword">new</span> <span class="title class_">BitSet</span>(bitSetSize);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">add</span><span class="params">(T element)</span> &#123;</span><br><span class="line">        <span class="type">int</span>[] hashes = createHashes(element);</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> hash : hashes) &#123;</span><br><span class="line">            bitSet.set(Math.abs(hash % bitSetSize), <span class="literal">true</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">public</span> <span class="type">boolean</span> <span class="title function_">mightContain</span><span class="params">(T element)</span> &#123;</span><br><span class="line">        <span class="type">int</span>[] hashes = createHashes(element);</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> hash : hashes) &#123;</span><br><span class="line">            <span class="keyword">if</span> (!bitSet.get(Math.abs(hash % bitSetSize))) &#123;</span><br><span class="line">                <span class="keyword">return</span> <span class="literal">false</span>; <span class="comment">// å¦‚æžœä»»ä½•ä¸€ä½ä¸º0ï¼Œå…ƒç´ ä¸€å®šä¸å­˜åœ¨</span></span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">true</span>; <span class="comment">// æ‰€æœ‰ä½éƒ½ä¸º1ï¼Œå…ƒç´ å¯èƒ½å­˜åœ¨</span></span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// å…¶ä»–è¾…åŠ©æ–¹æ³•ï¼Œå¦‚è®¡ç®—å“ˆå¸Œå€¼ï¼Œè®¡ç®—æœ€ä¼˜å‚æ•°ç­‰</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>-â€”è¿™éƒ¨åˆ†é¢è¯•ä¸­å¯ä»¥ä¸èƒŒendâ€”-</p>
<h4 id="å¸ƒéš†è¿‡æ»¤å™¨å­˜åœ¨è¯¯åˆ¤å—ï¼Ÿ"><a href="#å¸ƒéš†è¿‡æ»¤å™¨å­˜åœ¨è¯¯åˆ¤å—ï¼Ÿ" class="headerlink" title="å¸ƒéš†è¿‡æ»¤å™¨å­˜åœ¨è¯¯åˆ¤å—ï¼Ÿ"></a>å¸ƒéš†è¿‡æ»¤å™¨å­˜åœ¨è¯¯åˆ¤å—ï¼Ÿ</h4><p>æ˜¯çš„ï¼Œå¸ƒéš†è¿‡æ»¤å™¨å­˜åœ¨è¯¯åˆ¤ã€‚å®ƒå¯èƒ½ä¼šé”™è¯¯åœ°è®¤ä¸ºæŸä¸ªå…ƒç´ åœ¨é›†åˆä¸­ï¼Œè€Œå…ƒç´ å®žé™…ä¸Šå¹¶ä¸åœ¨é›†åˆä¸­ã€‚</p>
<p><img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="https://cdn.jsdelivr.net/gh/JakicDong/blog-assets@main/images/20251022105811.png" alt="20251022105811"><br>å‹‡å“¥ï¼šå¸ƒéš†è¿‡æ»¤å™¨</p>
<p>ä½†å¦‚æžœå¸ƒéš†è¿‡æ»¤å™¨è®¤ä¸ºæŸä¸ªå…ƒç´ ä¸å­˜åœ¨äºŽé›†åˆä¸­ï¼Œé‚£ä¹ˆå®ƒä¸€å®šä¸å­˜åœ¨ã€‚</p>
<p>è¯¯åˆ¤äº§ç”Ÿçš„åŽŸå› æ˜¯å› ä¸ºå“ˆå¸Œå†²çªã€‚åœ¨å¸ƒéš†è¿‡æ»¤å™¨ä¸­ï¼Œå¤šä¸ªä¸åŒçš„å…ƒç´ å¯èƒ½æ˜ å°„åˆ°ç›¸åŒçš„ä½ç½®ã€‚éšç€å‘å¸ƒéš†è¿‡æ»¤å™¨ä¸­æ·»åŠ çš„å…ƒç´ è¶Šæ¥è¶Šå¤šï¼Œä½æ•°ç»„ä¸­çš„ 1 ä¹Ÿè¶Šæ¥è¶Šå¤šï¼Œå‘ç”Ÿå“ˆå¸Œå†²çªçš„æ¦‚çŽ‡éšä¹‹å¢žåŠ ï¼Œè¯¯åˆ¤çŽ‡ä¹Ÿå°±éšä¹‹ä¸Šå‡ã€‚</p>
<p><img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="https://cdn.jsdelivr.net/gh/JakicDong/blog-assets@main/images/20251022110143.png" alt="20251022110143"><br>å‹‡å“¥ï¼šå¸ƒéš†è¿‡æ»¤å™¨çš„è¯¯åˆ¤</p>
<p>è¯¯åˆ¤çŽ‡å–å†³äºŽä»¥ä¸‹ 3 ä¸ªå› ç´ ï¼š</p>
<ol>
<li>ä½æ•°ç»„çš„å¤§å°ï¼ˆmï¼‰ï¼šm å†³å®šäº†å¯ä»¥å­˜å‚¨çš„æ ‡å¿—ä½æ•°é‡ã€‚å¦‚æžœä½æ•°ç»„è¿‡å°ï¼Œé‚£ä¹ˆå“ˆå¸Œç¢°æ’žçš„å‡ çŽ‡å°±ä¼šå¢žåŠ ï¼Œä»Žè€Œå¯¼è‡´æ›´é«˜çš„è¯¯åˆ¤çŽ‡ã€‚</li>
<li>å“ˆå¸Œå‡½æ•°çš„æ•°é‡ï¼ˆkï¼‰ï¼šk å†³å®šäº†æ¯ä¸ªå…ƒç´ åœ¨ä½æ•°ç»„ä¸­æ ‡è®°çš„ä½æ•°ã€‚å“ˆå¸Œå‡½æ•°è¶Šå¤šï¼Œç¢°æ’žçš„æ¦‚çŽ‡ä¹Ÿä¼šç›¸åº”å˜åŒ–ã€‚å¦‚æžœå“ˆå¸Œå‡½æ•°å¤ªå°‘ï¼Œè¿‡æ»¤å™¨å¾ˆå¿«ä¼šå˜å¾—ä¸ç²¾ç¡®ï¼›å¦‚æžœå¤ªå¤šï¼Œè¯¯åˆ¤çŽ‡ä¹Ÿä¼šå‡é«˜ï¼Œæ•ˆçŽ‡ä¸‹é™ã€‚</li>
<li>å­˜å…¥çš„å…ƒç´ æ•°é‡ï¼ˆnï¼‰ï¼šn è¶Šå¤šï¼Œå“ˆå¸Œç¢°æ’žçš„å‡ çŽ‡è¶Šå¤§ï¼Œä»Žè€Œå¯¼è‡´æ›´é«˜çš„è¯¯åˆ¤çŽ‡ã€‚</li>
</ol>
<p>è¦é™ä½Žè¯¯åˆ¤çŽ‡ï¼Œå¯ä»¥å¢žåŠ ä½æ•°ç»„çš„å¤§å°æˆ–è€…å‡å°‘æ’å…¥çš„å…ƒç´ æ•°é‡ã€‚</p>
<p>è¦å½»åº•è§£å†³å¸ƒéš†è¿‡æ»¤å™¨çš„è¯¯åˆ¤é—®é¢˜ï¼Œå¯ä»¥åœ¨å¸ƒéš†è¿‡æ»¤å™¨è¿”å›žâ€å¯èƒ½å­˜åœ¨â€æ—¶ï¼Œå†é€šè¿‡æ•°æ®åº“è¿›è¡ŒäºŒæ¬¡ç¡®è®¤ã€‚</p>
<h4 id="å¸ƒéš†è¿‡æ»¤å™¨æ”¯æŒåˆ é™¤å—ï¼Ÿ"><a href="#å¸ƒéš†è¿‡æ»¤å™¨æ”¯æŒåˆ é™¤å—ï¼Ÿ" class="headerlink" title="å¸ƒéš†è¿‡æ»¤å™¨æ”¯æŒåˆ é™¤å—ï¼Ÿ"></a>å¸ƒéš†è¿‡æ»¤å™¨æ”¯æŒåˆ é™¤å—ï¼Ÿ</h4><p>å¸ƒéš†è¿‡æ»¤å™¨å¹¶ä¸æ”¯æŒåˆ é™¤æ“ä½œï¼Œè¿™æ˜¯å®ƒçš„ä¸€ä¸ªé‡è¦é™åˆ¶ã€‚</p>
<p>å½“æˆ‘ä»¬æ·»åŠ ä¸€ä¸ªå…ƒç´ æ—¶ï¼Œä¼šå°†ä½æ•°ç»„ä¸­çš„ k ä¸ªä½ç½®è®¾ç½®ä¸º 1ã€‚ç”±äºŽå¤šä¸ªä¸åŒå…ƒç´ å¯èƒ½å…±äº«ç›¸åŒçš„ä½ï¼Œå¦‚æžœæˆ‘ä»¬å°è¯•åˆ é™¤ä¸€ä¸ªå…ƒç´ ï¼Œå°†å…¶å¯¹åº”çš„ k ä¸ªä½é‡ç½®ä¸º 0ï¼Œå¯èƒ½ä¼šé”™è¯¯åœ°å½±å“åˆ°å…¶ä»–å…ƒç´ çš„åˆ¤æ–­ç»“æžœã€‚</p>
<p>ä¾‹å¦‚ï¼Œå…ƒç´  A å’Œå…ƒç´  B éƒ½å°†ä½ç½® 5 è®¾ä¸º 1ï¼Œå¦‚æžœåˆ é™¤å…ƒç´  A æ—¶å°†ä½ç½® 5 é‡ç½®ä¸º 0ï¼Œé‚£ä¹ˆå¯¹å…ƒç´  B çš„æŸ¥è¯¢å°±ä¼šäº§ç”Ÿé”™è¯¯çš„â€ä¸å­˜åœ¨â€ç»“æžœï¼Œè¿™è¿èƒŒäº†å¸ƒéš†è¿‡æ»¤å™¨çš„åŸºæœ¬ç‰¹æ€§ã€‚</p>
<p>å¦‚æžœæƒ³è¦å®žçŽ°åˆ é™¤æ“ä½œï¼Œå¯ä»¥ä½¿ç”¨è®¡æ•°å¸ƒéš†è¿‡æ»¤å™¨ï¼Œå®ƒåœ¨æ¯ä¸ªä½ç½®ä¸Šå­˜å‚¨ä¸€ä¸ªè®¡æ•°å™¨è€Œä¸æ˜¯å•ä¸€çš„ä½ã€‚è¿™æ ·å¯ä»¥é€šè¿‡å‡å°‘è®¡æ•°å™¨çš„å€¼æ¥å®žçŽ°åˆ é™¤æ“ä½œï¼Œä½†ä¼šå¢žåŠ å†…å­˜å¼€é”€ã€‚</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">CountingBloomFilter</span>&lt;T&gt; &#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="type">int</span>[] counters;</span><br><span class="line">    <span class="keyword">private</span> <span class="type">int</span> size;</span><br><span class="line">    <span class="keyword">private</span> <span class="type">int</span> hashFunctions;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">CountingBloomFilter</span><span class="params">(<span class="type">int</span> size, <span class="type">int</span> hashFunctions)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.size = size;</span><br><span class="line">        <span class="built_in">this</span>.hashFunctions = hashFunctions;</span><br><span class="line">        <span class="built_in">this</span>.counters = <span class="keyword">new</span> <span class="title class_">int</span>[size];</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">add</span><span class="params">(T element)</span> &#123;</span><br><span class="line">        <span class="type">int</span>[] positions = getHashPositions(element);</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> position : positions) &#123;</span><br><span class="line">            counters[position]++;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">remove</span><span class="params">(T element)</span> &#123;</span><br><span class="line">        <span class="type">int</span>[] positions = getHashPositions(element);</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> position : positions) &#123;</span><br><span class="line">            <span class="keyword">if</span> (counters[position] &gt; <span class="number">0</span>) &#123;</span><br><span class="line">                counters[position]--;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">public</span> <span class="type">boolean</span> <span class="title function_">mightContain</span><span class="params">(T element)</span> &#123;</span><br><span class="line">        <span class="type">int</span>[] positions = getHashPositions(element);</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> position : positions) &#123;</span><br><span class="line">            <span class="keyword">if</span> (counters[position] == <span class="number">0</span>) &#123;</span><br><span class="line">                <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">private</span> <span class="type">int</span>[] getHashPositions(T element) &#123;</span><br><span class="line">        <span class="comment">// è®¡ç®—å“ˆå¸Œä½ç½®çš„ä»£ç </span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="ä¸ºä»€ä¹ˆä¸èƒ½ç”¨å“ˆå¸Œè¡¨è€Œæ˜¯ç”¨å¸ƒéš†è¿‡æ»¤å™¨ï¼Ÿ"><a href="#ä¸ºä»€ä¹ˆä¸èƒ½ç”¨å“ˆå¸Œè¡¨è€Œæ˜¯ç”¨å¸ƒéš†è¿‡æ»¤å™¨ï¼Ÿ" class="headerlink" title="ä¸ºä»€ä¹ˆä¸èƒ½ç”¨å“ˆå¸Œè¡¨è€Œæ˜¯ç”¨å¸ƒéš†è¿‡æ»¤å™¨ï¼Ÿ"></a>ä¸ºä»€ä¹ˆä¸èƒ½ç”¨å“ˆå¸Œè¡¨è€Œæ˜¯ç”¨å¸ƒéš†è¿‡æ»¤å™¨ï¼Ÿ</h4><p>å¸ƒéš†è¿‡æ»¤å™¨æœ€çªå‡ºçš„ä¼˜åŠ¿æ˜¯å†…å­˜æ•ˆçŽ‡ã€‚</p>
<p>å‡å¦‚æˆ‘ä»¬è¦åˆ¤æ–­ 10 äº¿ä¸ªç”¨æˆ· ID æ˜¯å¦æ›¾ç»è®¿é—®è¿‡ç‰¹å®šé¡µé¢ï¼Œä½¿ç”¨å“ˆå¸Œè¡¨è‡³å°‘éœ€è¦ 10G å†…å­˜ï¼ˆæ¯ä¸ª ID è‡³å°‘éœ€è¦8å­—èŠ‚ï¼‰ï¼Œè€Œä½¿ç”¨å¸ƒéš†è¿‡æ»¤å™¨åªéœ€è¦ 1.2G å†…å­˜ã€‚</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">m â‰ˆ -n*ln(p)/ln(2)Â² â‰ˆ -10â¹*ln(0.01)/ln(2)Â² â‰ˆ 9.6 billion bits â‰ˆ 1.2GB</span><br></pre></td></tr></table></figure>

<blockquote>
<ol>
<li><a target="_blank" rel="noopener" href="https://javabetter.cn/zhishixingqiu/mianshi.html">Java é¢è¯•æŒ‡å—ï¼ˆä»˜è´¹ï¼‰</a>æ”¶å½•çš„å­—èŠ‚è·³åŠ¨åŒå­¦ 7 Java åŽç«¯å®žä¹ ä¸€é¢çš„åŽŸé¢˜ï¼šæœ‰äº†è§£è¿‡å¸ƒéš†è¿‡æ»¤å™¨å—ï¼Ÿ</li>
<li><a target="_blank" rel="noopener" href="https://javabetter.cn/zhishixingqiu/mianshi.html">Java é¢è¯•æŒ‡å—ï¼ˆä»˜è´¹ï¼‰</a>æ”¶å½•çš„TPè”æ´²åŒå­¦ 5 Java åŽç«¯ä¸€é¢çš„åŽŸé¢˜ï¼šå¸ƒéš†è¿‡æ»¤å™¨åŽŸç†ï¼Œè¿™ç§æ–¹å¼ä¸‹5%çš„é”™è¯¯çŽ‡å¯æŽ¥å—ï¼Ÿ</li>
<li><a target="_blank" rel="noopener" href="https://javabetter.cn/zhishixingqiu/mianshi.html">Java é¢è¯•æŒ‡å—ï¼ˆä»˜è´¹ï¼‰</a>æ”¶å½•çš„ç¾Žå›¢åŒå­¦ 9 ä¸€é¢é¢è¯•åŽŸé¢˜ï¼šå¸ƒéš†è¿‡æ»¤å™¨ï¼Ÿå¸ƒéš†è¿‡æ»¤å™¨ä¼˜ç‚¹ï¼Ÿä¸ºä»€ä¹ˆä¸èƒ½ç”¨å“ˆå¸Œè¡¨è¦ç”¨å¸ƒéš†è¿‡æ»¤å™¨ï¼Ÿ</li>
<li><a target="_blank" rel="noopener" href="https://javabetter.cn/zhishixingqiu/mianshi.html">Java é¢è¯•æŒ‡å—ï¼ˆä»˜è´¹ï¼‰</a>æ”¶å½•çš„ç†æƒ³æ±½è½¦é¢ç»åŒå­¦ 2 ä¸€é¢é¢è¯•åŽŸé¢˜ï¼šè¿½é—®ï¼šè¯´æ˜Žä¸€ä¸‹å¸ƒéš†è¿‡æ»¤å™¨</li>
</ol>
</blockquote>
<h3 id="31-ðŸŒŸå¦‚ä½•ä¿è¯ç¼“å­˜å’Œæ•°æ®åº“çš„æ•°æ®â¼€è‡´æ€§ï¼Ÿ"><a href="#31-ðŸŒŸå¦‚ä½•ä¿è¯ç¼“å­˜å’Œæ•°æ®åº“çš„æ•°æ®â¼€è‡´æ€§ï¼Ÿ" class="headerlink" title="31.ðŸŒŸå¦‚ä½•ä¿è¯ç¼“å­˜å’Œæ•°æ®åº“çš„æ•°æ®â¼€è‡´æ€§ï¼Ÿ"></a>31.ðŸŒŸå¦‚ä½•ä¿è¯ç¼“å­˜å’Œæ•°æ®åº“çš„æ•°æ®â¼€è‡´æ€§ï¼Ÿ</h3><p>åœ¨<a target="_blank" rel="noopener" href="https://javabetter.cn/zhishixingqiu/paicoding.html">æŠ€æœ¯æ´¾å®žæˆ˜é¡¹ç›®</a>ä¸­ï¼Œå¯¹äºŽæ–‡ç« æ ‡ç­¾è¿™ç§å…è®¸çŸ­æš‚ä¸ä¸€è‡´çš„æ•°æ®ï¼Œæˆ‘ä¼šé‡‡ç”¨ <a target="_blank" rel="noopener" href="https://coolshell.cn/articles/17416.html">Cache Aside</a> + TTL è¿‡æœŸæœºåˆ¶æ¥ä¿è¯ç¼“å­˜å’Œæ•°æ®åº“çš„ä¸€è‡´æ€§ã€‚</p>
<p><img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="https://cdn.jsdelivr.net/gh/JakicDong/blog-assets@main/images/20251022110356.png" alt="20251022110356"><br>æŠ€æœ¯æ´¾æ•™ç¨‹ï¼šMySQL å’Œ Redis ä¸€è‡´æ€§</p>
<p>å…·ä½“åšæ³•æ˜¯è¯»å–æ—¶å…ˆæŸ¥ Redisï¼Œæœªå‘½ä¸­å†æŸ¥ MySQLï¼ŒåŒæ—¶ä¸ºç¼“å­˜è®¾ç½®ä¸€ä¸ªåˆç†çš„è¿‡æœŸæ—¶é—´ï¼›æ›´æ–°æ—¶å…ˆæ›´æ–° MySQLï¼Œå†åˆ é™¤ Redisã€‚</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// è¯»å–é€»è¾‘</span></span><br><span class="line"><span class="keyword">public</span> UserInfo <span class="title function_">getUser</span><span class="params">(String userId)</span> &#123;</span><br><span class="line">    <span class="comment">// å…ˆæŸ¥ç¼“å­˜</span></span><br><span class="line">    <span class="type">UserInfo</span> <span class="variable">user</span> <span class="operator">=</span> cache.get(<span class="string">&quot;user:&quot;</span> + userId);</span><br><span class="line">    <span class="keyword">if</span> (user != <span class="literal">null</span>) &#123;</span><br><span class="line">        <span class="keyword">return</span> user;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// ç¼“å­˜æœªå‘½ä¸­ï¼ŒæŸ¥æ•°æ®åº“</span></span><br><span class="line">    user = database.selectUser(userId);</span><br><span class="line">    <span class="keyword">if</span> (user != <span class="literal">null</span>) &#123;</span><br><span class="line">        <span class="comment">// æ”¾å…¥ç¼“å­˜ï¼Œè®¾ç½®åˆç†çš„è¿‡æœŸæ—¶é—´</span></span><br><span class="line">        cache.set(<span class="string">&quot;user:&quot;</span> + userId, user, <span class="number">3600</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">return</span> user;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// æ›´æ–°é€»è¾‘</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">updateUser</span><span class="params">(UserInfo user)</span> &#123;</span><br><span class="line">    <span class="comment">// å…ˆæ›´æ–°æ•°æ®åº“</span></span><br><span class="line">    database.updateUser(user);</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// åˆ é™¤ç¼“å­˜</span></span><br><span class="line">    cache.delete(<span class="string">&quot;user:&quot;</span> + user.getId());</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>è¿™ç§æ–¹å¼ç®€å•æœ‰æ•ˆï¼Œé€‚ç”¨äºŽè¯»å¤šå†™å°‘çš„åœºæ™¯ã€‚TTL è¿‡æœŸæ—¶é—´ä¹Ÿèƒ½å¤Ÿä¿è¯å³ä½¿æ›´æ–°æ“ä½œå¤±è´¥ï¼Œæœªèƒ½åŠæ—¶åˆ é™¤ç¼“å­˜ï¼Œè¿‡æœŸæ—¶é—´ä¹Ÿèƒ½ç¡®ä¿æ•°æ®æœ€ç»ˆä¸€è‡´ã€‚</p>
<h4 id="é‚£å†æ¥è¯´è¯´ä¸ºä»€ä¹ˆè¦åˆ é™¤ç¼“å­˜è€Œä¸æ˜¯æ›´æ–°ç¼“å­˜ï¼Ÿ"><a href="#é‚£å†æ¥è¯´è¯´ä¸ºä»€ä¹ˆè¦åˆ é™¤ç¼“å­˜è€Œä¸æ˜¯æ›´æ–°ç¼“å­˜ï¼Ÿ" class="headerlink" title="é‚£å†æ¥è¯´è¯´ä¸ºä»€ä¹ˆè¦åˆ é™¤ç¼“å­˜è€Œä¸æ˜¯æ›´æ–°ç¼“å­˜ï¼Ÿ"></a>é‚£å†æ¥è¯´è¯´ä¸ºä»€ä¹ˆè¦åˆ é™¤ç¼“å­˜è€Œä¸æ˜¯æ›´æ–°ç¼“å­˜ï¼Ÿ</h4><p>æœ€åˆè®¾è®¡ç¼“å­˜ç­–ç•¥æ—¶ï¼Œæˆ‘ä¹Ÿè€ƒè™‘è¿‡ç›´æŽ¥æ›´æ–°ç¼“å­˜ï¼Œä½†é€šè¿‡å®žè·µå‘çŽ°ï¼Œåˆ é™¤ç¼“å­˜æ˜¯æ›´ä¼˜çš„é€‰æ‹©ã€‚</p>
<p><img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="https://cdn.jsdelivr.net/gh/JakicDong/blog-assets@main/images/20251022110609.png" alt="20251022110609"><br>æŠ€æœ¯æ´¾ï¼šæ›´æ–° Redis è€Œä¸æ˜¯åˆ é™¤ Redis</p>
<p>æœ€ä¸»è¦çš„åŽŸå› æ˜¯åœ¨å¹¶å‘çŽ¯å¢ƒä¸‹ï¼Œå‡è®¾æˆ‘ä»¬æœ‰ä¸¤ä¸ªå¹¶å‘çš„æ›´æ–°æ“ä½œï¼Œå¦‚æžœé‡‡ç”¨æ›´æ–°ç¼“å­˜çš„ç­–ç•¥ï¼Œå°±å¯èƒ½å‡ºçŽ°è¿™æ ·çš„æ—¶åºé—®é¢˜ï¼š</p>
<ul>
<li>æ“ä½œ A å’Œæ“ä½œ B åŒæ—¶å‘ç”Ÿï¼ŒA å…ˆæ›´æ–° MySQL å°†å€¼æ”¹ä¸º 10ï¼ŒB åŽæ›´æ–° MySQL å°†å€¼æ”¹ä¸º 11ã€‚ä½†åœ¨ç¼“å­˜æ›´æ–°æ—¶ï¼Œå¯èƒ½ B å…ˆæ‰§è¡Œå°†ç¼“å­˜è®¾ä¸º 11ï¼Œç„¶åŽ A æ‰æ‰§è¡Œå°†ç¼“å­˜è®¾ä¸º10ã€‚è¿™æ ·å°±ä¼šé€ æˆ MySQL æ˜¯ 11 ä½† Redis æ˜¯ 10 çš„ä¸ä¸€è‡´çŠ¶æ€ã€‚</li>
</ul>
<p>è€Œé‡‡ç”¨åˆ é™¤ç­–ç•¥ï¼Œæ— è®º A å’Œ B è°å…ˆåˆ é™¤ç¼“å­˜ï¼ŒåŽç»­çš„è¯»å–æ“ä½œéƒ½ä¼šä»Ž MySQL èŽ·å–æœ€æ–°å€¼ã€‚</p>
<p>å¦å¤–ï¼Œç›¸å¯¹è€Œè¨€ï¼Œåˆ é™¤ç¼“å­˜çš„é€Ÿåº¦æ¯”æ›´æ–°ç¼“å­˜çš„é€Ÿåº¦å¿«å¾—å¤šã€‚</p>
<p><img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="https://cdn.jsdelivr.net/gh/JakicDong/blog-assets@main/images/20251022110559.png" alt="20251022110559"><br>ä¸‰åˆ†æ¶é¢æ¸£é€†è¢­ï¼šåˆ é™¤ç¼“å­˜å’Œæ›´æ–°ç¼“å­˜</p>
<p>å› ä¸ºåˆ é™¤æ“ä½œåªæ˜¯ç®€å•çš„ DEL å‘½ä»¤ï¼Œè€Œæ›´æ–°å¯èƒ½éœ€è¦é‡æ–°åºåˆ—åŒ–æ•´ä¸ªå¯¹è±¡å†å†™å…¥ç¼“å­˜ã€‚</p>
<h4 id="é‚£å†è¯´è¯´ä¸ºä»€ä¹ˆè¦å…ˆæ›´æ–°æ•°æ®åº“ï¼Œå†åˆ é™¤ç¼“å­˜ï¼Ÿ"><a href="#é‚£å†è¯´è¯´ä¸ºä»€ä¹ˆè¦å…ˆæ›´æ–°æ•°æ®åº“ï¼Œå†åˆ é™¤ç¼“å­˜ï¼Ÿ" class="headerlink" title="é‚£å†è¯´è¯´ä¸ºä»€ä¹ˆè¦å…ˆæ›´æ–°æ•°æ®åº“ï¼Œå†åˆ é™¤ç¼“å­˜ï¼Ÿ"></a>é‚£å†è¯´è¯´ä¸ºä»€ä¹ˆè¦å…ˆæ›´æ–°æ•°æ®åº“ï¼Œå†åˆ é™¤ç¼“å­˜ï¼Ÿ</h4><p>è¿™ä¸ªæ“ä½œé¡ºåºçš„é€‰æ‹©ä¹Ÿæ˜¯æˆ‘åœ¨å®žé™…é¡¹ç›®ä¸­è¸©è¿‡å‘æ‰æ·±åˆ»ç†è§£çš„ã€‚å‡è®¾æˆ‘ä»¬é‡‡ç”¨å…ˆåˆ ç¼“å­˜å†æ›´æ–°æ•°æ®åº“çš„ç­–ç•¥ï¼Œåœ¨é«˜å¹¶å‘åœºæ™¯ä¸‹å°±å¯èƒ½å‡ºçŽ°è¿™æ ·çš„é—®é¢˜ï¼š</p>
<ul>
<li>çº¿ç¨‹ A è¦æ›´æ–°ç”¨æˆ·ä¿¡æ¯ï¼Œå…ˆåˆ é™¤äº†ç¼“å­˜</li>
<li>çº¿ç¨‹ B æ°å¥½æ­¤æ—¶è¦è¯»å–è¯¥ç”¨æˆ·ä¿¡æ¯ï¼Œå‘çŽ°ç¼“å­˜ä¸ºç©ºï¼ŒäºŽæ˜¯æŸ¥è¯¢æ•°æ®åº“ï¼Œæ­¤æ—¶è¿˜æ˜¯æ—§å€¼</li>
<li>çº¿ç¨‹ B å°†æŸ¥åˆ°çš„æ—§å€¼é‡æ–°æ”¾å…¥ç¼“å­˜</li>
<li>çº¿ç¨‹ A å®Œæˆæ•°æ®åº“æ›´æ–°</li>
</ul>
<p>ç»“æžœå°±æ˜¯æ•°æ®åº“æ˜¯æ–°çš„å€¼ï¼Œä½†ç¼“å­˜ä¸­è¿˜æ˜¯æ—§å€¼ã€‚</p>
<p><img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="https://cdn.jsdelivr.net/gh/JakicDong/blog-assets@main/images/20251022110834.png" alt="20251022110834"><br>æŠ€æœ¯æ´¾ï¼šå…ˆåˆ  Redis å†æ›´æ–° MySQL</p>
<p>è€Œé‡‡ç”¨å…ˆæ›´æ–°æ•°æ®åº“å†åˆ ç¼“å­˜çš„ç­–ç•¥ï¼Œå³ä½¿å‡ºçŽ°ç±»ä¼¼çš„å¹¶å‘æƒ…å†µï¼Œæœ€åçš„æƒ…å†µä¹Ÿåªæ˜¯çŸ­æš‚åœ°ä»Žç¼“å­˜ä¸­è¯»å–åˆ°äº†æ—§å€¼ï¼Œä½†ç¼“å­˜åˆ é™¤åŽçš„è¯·æ±‚ä¼šç›´æŽ¥ä»Žæ•°æ®åº“ä¸­èŽ·å–æœ€æ–°å€¼ã€‚</p>
<p>å¦å¤–ï¼Œå¦‚æžœå…ˆåˆ ç¼“å­˜å†æ›´æ–°æ•°æ®åº“ï¼Œå½“æ•°æ®åº“æ›´æ–°å¤±è´¥æ—¶ï¼Œç¼“å­˜å·²ç»è¢«åˆ é™¤äº†ã€‚è¿™ä¼šå¯¼è‡´çŸ­æœŸå†…æ‰€æœ‰è¯»è¯·æ±‚éƒ½ä¼šç©¿é€åˆ°æ•°æ®åº“ï¼Œå¯¹æ•°æ®åº“é€ æˆé¢å¤–çš„åŽ‹åŠ›ã€‚</p>
<p><img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="https://cdn.jsdelivr.net/gh/JakicDong/blog-assets@main/images/20251022110950.png" alt="20251022110950"><br>ä¸‰åˆ†æ¶é¢æ¸£é€†è¢­ï¼šå…ˆæ›´æ•°æ®åº“è¿˜æ˜¯å…ˆåˆ ç¼“å­˜</p>
<p>è€Œå…ˆæ›´æ–°æ•°æ®åº“å†åˆ ç¼“å­˜ï¼Œå¦‚æžœæ•°æ®åº“æ›´æ–°å¤±è´¥ï¼Œç¼“å­˜ä¿æŒåŽŸçŠ¶ï¼Œç³»ç»Ÿä»ç„¶èƒ½ç»§ç»­æ­£å¸¸æä¾›æœåŠ¡ã€‚</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">updateUser</span><span class="params">(User user)</span> &#123;</span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">        <span class="comment">// å…ˆæ›´æ–°æ•°æ®åº“</span></span><br><span class="line">        database.updateUser(user);</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// å†åˆ é™¤ç¼“å­˜</span></span><br><span class="line">        cache.delete(<span class="string">&quot;user:&quot;</span> + user.getId());</span><br><span class="line">    &#125; <span class="keyword">catch</span> (DatabaseException e) &#123;</span><br><span class="line">        <span class="comment">// æ•°æ®åº“æ›´æ–°å¤±è´¥ï¼Œç¼“å­˜ä¿æŒåŽŸçŠ¶ï¼Œç³»ç»Ÿä»å¯æ­£å¸¸æä¾›æœåŠ¡</span></span><br><span class="line">        log.error(<span class="string">&quot;Database update failed&quot;</span>, e);</span><br><span class="line">        <span class="keyword">throw</span> e;</span><br><span class="line">    &#125; <span class="keyword">catch</span> (CacheException e) &#123;</span><br><span class="line">        <span class="comment">// ç¼“å­˜åˆ é™¤å¤±è´¥ï¼Œæ•°æ®åº“å·²æ›´æ–°ï¼Œæ•°æ®ä¼šåœ¨TTLåŽè‡ªåŠ¨ä¸€è‡´</span></span><br><span class="line">        log.warn(<span class="string">&quot;Cache deletion failed, will be eventually consistent&quot;</span>, e);</span><br><span class="line">        <span class="comment">// å¯ä»¥é€‰æ‹©ä¸æŠ›å¼‚å¸¸ï¼Œå› ä¸ºæœ‰TTLå…œåº•</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="é‚£å‡å¦‚å¯¹ç¼“å­˜æ•°æ®åº“ä¸€è‡´æ€§è¦æ±‚å¾ˆé«˜ï¼Œè¯¥æ€Žä¹ˆåŠžå‘¢ï¼Ÿ"><a href="#é‚£å‡å¦‚å¯¹ç¼“å­˜æ•°æ®åº“ä¸€è‡´æ€§è¦æ±‚å¾ˆé«˜ï¼Œè¯¥æ€Žä¹ˆåŠžå‘¢ï¼Ÿ" class="headerlink" title="é‚£å‡å¦‚å¯¹ç¼“å­˜æ•°æ®åº“ä¸€è‡´æ€§è¦æ±‚å¾ˆé«˜ï¼Œè¯¥æ€Žä¹ˆåŠžå‘¢ï¼Ÿ"></a>é‚£å‡å¦‚å¯¹ç¼“å­˜æ•°æ®åº“ä¸€è‡´æ€§è¦æ±‚å¾ˆé«˜ï¼Œè¯¥æ€Žä¹ˆåŠžå‘¢ï¼Ÿ</h4><p>å½“ä¸šåŠ¡å¯¹ç¼“å­˜ä¸Žæ•°æ®åº“çš„ä¸€è‡´æ€§è¦æ±‚å¾ˆé«˜æ—¶ï¼Œæ¯”å¦‚æ”¯ä»˜ç³»ç»Ÿã€åº“å­˜ç®¡ç†ç­‰åœºæ™¯ï¼Œæˆ‘ä¼šé‡‡ç”¨å¤šç§ç­–ç•¥æ¥ä¿è¯å¼ºä¸€è‡´æ€§ã€‚</p>
<p><img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="https://cdn.jsdelivr.net/gh/JakicDong/blog-assets@main/images/20251022111101.png" alt="20251022111101"><br>äºŒå“¥çš„ Java è¿›é˜¶ä¹‹è·¯ï¼šç¼“å­˜å¼ºä¸€è‡´æ€§</p>
<p>ç¬¬ä¸€ç§ï¼Œå¼•å…¥æ¶ˆæ¯é˜Ÿåˆ—æ¥ä¿è¯ç¼“å­˜æœ€ç»ˆè¢«åˆ é™¤ï¼Œæ¯”å¦‚è¯´åœ¨æ•°æ®åº“æ›´æ–°çš„äº‹åŠ¡ä¸­æ’å…¥ä¸€æ¡æœ¬åœ°æ¶ˆæ¯è®°å½•ï¼Œäº‹åŠ¡æäº¤åŽå¼‚æ­¥å‘é€ç»™ MQ è¿›è¡Œç¼“å­˜åˆ é™¤ã€‚</p>
<p><img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="https://cdn.jsdelivr.net/gh/JakicDong/blog-assets@main/images/20251022111121.png" alt="20251022111121"><br>ä¸‰åˆ†æ¶é¢æ¸£é€†è¢­ï¼šæ¶ˆæ¯é˜Ÿåˆ—ä¿è¯keyè¢«åˆ é™¤</p>
<p>å³ä½¿ç¼“å­˜åˆ é™¤å¤±è´¥ï¼Œæ¶ˆæ¯é˜Ÿåˆ—çš„é‡è¯•æœºåˆ¶ä¹Ÿèƒ½ä¿è¯æœ€ç»ˆä¸€è‡´æ€§ã€‚</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Transactional</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">updateUser</span><span class="params">(UserInfo user)</span> &#123;</span><br><span class="line">    <span class="comment">// åœ¨äº‹åŠ¡ä¸­æ›´æ–°æ•°æ®åº“</span></span><br><span class="line">    database.updateUser(user);</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// åœ¨åŒä¸€äº‹åŠ¡ä¸­è®°å½•éœ€è¦åˆ é™¤çš„ç¼“å­˜ä¿¡æ¯</span></span><br><span class="line">    <span class="type">LocalMessage</span> <span class="variable">message</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">LocalMessage</span>(<span class="string">&quot;CACHE_DELETE&quot;</span>, <span class="string">&quot;user:&quot;</span> + user.getId());</span><br><span class="line">    database.insertLocalMessage(message);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// æ˜¾å¼å‘å¸ƒäº‹ä»¶ï¼Œä¾›ç›‘å¬å™¨æ•èŽ·</span></span><br><span class="line">    eventPublisher.publishEvent(<span class="keyword">new</span> <span class="title class_">UserUpdateEvent</span>(<span class="built_in">this</span>, <span class="string">&quot;user:&quot;</span> + user.getId()));</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// äº‹åŠ¡æäº¤åŽå‘é€MQæ¶ˆæ¯</span></span><br><span class="line"><span class="meta">@TransactionalEventListener(phase = TransactionPhase.AFTER_COMMIT)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">sendCacheDeleteMessage</span><span class="params">(UserUpdateEvent event)</span> &#123;</span><br><span class="line">    messageQueue.send(<span class="string">&quot;cache-delete-topic&quot;</span>, event.getCacheKey());</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>ç¬¬äºŒç§ï¼Œä½¿ç”¨ <a target="_blank" rel="noopener" href="https://github.com/alibaba/canal">Canal</a> ç›‘å¬ MySQL çš„ binlogï¼Œåœ¨æ•°æ®æ›´æ–°æ—¶ï¼Œå°†æ•°æ®å˜æ›´è®°å½•åˆ°æ¶ˆæ¯é˜Ÿåˆ—ä¸­ï¼Œæ¶ˆè´¹è€…æ¶ˆæ¯ç›‘å¬åˆ°å˜æ›´åŽåŽ»åˆ é™¤ç¼“å­˜ã€‚</p>
<p><img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="https://cdn.jsdelivr.net/gh/JakicDong/blog-assets@main/images/20251022111140.png" alt="20251022111140"><br>ä¸‰åˆ†æ¶é¢æ¸£é€†è¢­ï¼šæ•°æ®åº“è®¢é˜…+æ¶ˆæ¯é˜Ÿåˆ—ä¿è¯keyè¢«åˆ é™¤</p>
<p>è¿™ç§æ–¹æ¡ˆçš„ä¼˜åŠ¿æ˜¯å®Œå…¨è§£è€¦äº†ä¸šåŠ¡ä»£ç å’Œç¼“å­˜ç»´æŠ¤é€»è¾‘ã€‚</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@CanalListener</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">CacheUpdateListener</span> &#123;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@EventHandler</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">handleUserUpdate</span><span class="params">(UserUpdateEvent event)</span> &#123;</span><br><span class="line">        <span class="comment">// ä»Žbinlogäº‹ä»¶ä¸­æå–å˜æ›´ä¿¡æ¯</span></span><br><span class="line">        <span class="type">String</span> <span class="variable">userId</span> <span class="operator">=</span> event.getUserId();</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// å‘é€ç¼“å­˜åˆ é™¤æ¶ˆæ¯</span></span><br><span class="line">        <span class="type">CacheDeleteMessage</span> <span class="variable">message</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">CacheDeleteMessage</span>();</span><br><span class="line">        message.setCacheKey(<span class="string">&quot;user:&quot;</span> + userId);</span><br><span class="line">        messageQueue.send(<span class="string">&quot;cache-delete-topic&quot;</span>, message);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// æ¶ˆè´¹è€…ç›‘å¬æ¶ˆæ¯é˜Ÿåˆ—</span></span><br><span class="line"><span class="meta">@KafkaListener(topics = &quot;cache-delete-topic&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">handleCacheDeleteMessage</span><span class="params">(CacheDeleteMessage message)</span> &#123;</span><br><span class="line">    <span class="comment">// åˆ é™¤ç¼“å­˜</span></span><br><span class="line">    cache.delete(message.getCacheKey());</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>å½“ç„¶äº†ï¼Œå¦‚æžœè¯´ä¸šåŠ¡æ¯”è¾ƒç®€å•ï¼Œä¸éœ€è¦ä¸Šæ¶ˆæ¯é˜Ÿåˆ—ï¼Œå¯ä»¥é€šè¿‡å»¶è¿ŸåŒåˆ ç­–ç•¥é™ä½Žç¼“å­˜å’Œæ•°æ®åº“ä¸ä¸€è‡´çš„æ—¶é—´çª—å£ï¼Œåœ¨ç¬¬ä¸€æ¬¡åˆ é™¤ç¼“å­˜ä¹‹åŽï¼Œè¿‡ä¸€æ®µæ—¶é—´ä¹‹åŽï¼Œå†æ¬¡å°è¯•åˆ é™¤ç¼“å­˜ã€‚</p>
<p><img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="https://cdn.jsdelivr.net/gh/JakicDong/blog-assets@main/images/20251022111245.png" alt="20251022111245"><br>ä¸‰åˆ†æ¶é¢æ¸£é€†è¢­ï¼šå»¶æ—¶åŒåˆ </p>
<p>è¿™ç§æ–¹å¼ä¸»è¦é’ˆå¯¹ç¼“å­˜ä¸å­˜åœ¨ï¼Œä½†å†™å…¥äº†è„æ•°æ®çš„æƒ…å†µã€‚</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">updateUser</span><span class="params">(UserInfo user)</span> &#123;</span><br><span class="line">    <span class="comment">// ç¬¬ä¸€æ¬¡åˆ é™¤ç¼“å­˜ï¼Œå‡å°‘ä¸ä¸€è‡´æ—¶é—´çª—å£</span></span><br><span class="line">    cache.delete(<span class="string">&quot;user:&quot;</span> + user.getId());</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// æ›´æ–°æ•°æ®åº“</span></span><br><span class="line">    database.updateUser(user);</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// ç«‹å³åˆ é™¤ç¼“å­˜</span></span><br><span class="line">    cache.delete(<span class="string">&quot;user:&quot;</span> + user.getId());</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// å»¶æ—¶åˆ é™¤ï¼Œåº”å¯¹å¯èƒ½çš„å¹¶å‘è¯»å–</span></span><br><span class="line">    CompletableFuture.runAsync(() -&gt; &#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            Thread.sleep(<span class="number">1000</span>); <span class="comment">// å»¶æ—¶æ—¶é—´æ ¹æ®ä¸»ä»ŽåŒæ­¥å»¶è¿Ÿè°ƒæ•´</span></span><br><span class="line">            cache.delete(<span class="string">&quot;user:&quot;</span> + user.getId());</span><br><span class="line">        &#125; <span class="keyword">catch</span> (InterruptedException e) &#123;</span><br><span class="line">            Thread.currentThread().interrupt();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>æœ€åŽï¼Œæ— è®ºé‡‡ç”¨å“ªç§ç­–ç•¥ï¼Œæœ€å¥½ä¸ºç¼“å­˜è®¾ç½®ä¸€ä¸ªåˆç†çš„è¿‡æœŸæ—¶é—´ä½œä¸ºæœ€åŽçš„ä¿éšœã€‚å³ä½¿æ‰€æœ‰çš„ä¸»åŠ¨åˆ é™¤æœºåˆ¶éƒ½å¤±è´¥äº†ï¼ŒTTL ä¹Ÿèƒ½ç¡®ä¿æ•°æ®æœ€ç»ˆè¾¾åˆ°ä¸€è‡´ï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// æ ¹æ®æ•°æ®çš„é‡è¦ç¨‹åº¦è®¾ç½®ä¸åŒçš„TTL</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setCache</span><span class="params">(String key, Object value, DataImportance importance)</span> &#123;</span><br><span class="line">    <span class="type">int</span> ttl;</span><br><span class="line">    <span class="keyword">switch</span> (importance) &#123;</span><br><span class="line">        <span class="keyword">case</span> HIGH:      <span class="comment">// å…³é”®æ•°æ®ï¼ŒçŸ­TTL</span></span><br><span class="line">            ttl = <span class="number">300</span>;  <span class="comment">// 5åˆ†é’Ÿ</span></span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line">        <span class="keyword">case</span> MEDIUM:    <span class="comment">// ä¸€èˆ¬æ•°æ®</span></span><br><span class="line">            ttl = <span class="number">1800</span>; <span class="comment">// 30åˆ†é’Ÿ</span></span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line">        <span class="keyword">case</span> LOW:       <span class="comment">// ä¸å¤ªé‡è¦çš„æ•°æ®</span></span><br><span class="line">            ttl = <span class="number">3600</span>; <span class="comment">// 1å°æ—¶</span></span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    cache.setWithTTL(key, value, ttl);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>è¿™ç§æ–¹å¼è™½ç„¶ç®€å•ï¼Œä½†èƒ½ç¡®ä¿å³ä½¿å‡ºçŽ°æžç«¯æƒ…å†µï¼Œæ•°æ®ä¸ä¸€è‡´çš„å½±å“ä¹Ÿæ˜¯å¯æŽ§çš„ã€‚</p>
<blockquote>
<ol>
<li><a target="_blank" rel="noopener" href="https://javabetter.cn/zhishixingqiu/mianshi.html">Java é¢è¯•æŒ‡å—ï¼ˆä»˜è´¹ï¼‰</a>æ”¶å½•çš„åŽä¸ºé¢ç»åŒå­¦ 8 æŠ€æœ¯äºŒé¢é¢è¯•åŽŸé¢˜ï¼šæ€Žæ ·ä¿è¯æ•°æ®çš„æœ€ç»ˆä¸€è‡´æ€§ï¼Ÿ</li>
<li><a target="_blank" rel="noopener" href="https://javabetter.cn/zhishixingqiu/mianshi.html">Java é¢è¯•æŒ‡å—ï¼ˆä»˜è´¹ï¼‰</a>æ”¶å½•çš„è…¾è®¯é¢ç»åŒå­¦ 23 QQ åŽå°æŠ€æœ¯ä¸€é¢é¢è¯•åŽŸé¢˜ï¼šæ•°æ®ä¸€è‡´æ€§é—®é¢˜</li>
<li><a target="_blank" rel="noopener" href="https://javabetter.cn/zhishixingqiu/mianshi.html">Java é¢è¯•æŒ‡å—ï¼ˆä»˜è´¹ï¼‰</a>æ”¶å½•çš„å¾®ä¼—é“¶è¡ŒåŒå­¦ 1 Java åŽç«¯ä¸€é¢çš„åŽŸé¢˜ï¼šMySQL å’Œç¼“å­˜ä¸€è‡´æ€§é—®é¢˜äº†è§£å—ï¼Ÿ</li>
<li><a target="_blank" rel="noopener" href="https://javabetter.cn/zhishixingqiu/mianshi.html">Java é¢è¯•æŒ‡å—ï¼ˆä»˜è´¹ï¼‰</a>æ”¶å½•çš„ç¾Žå›¢é¢ç»åŒå­¦ 3 Java åŽç«¯æŠ€æœ¯ä¸€é¢é¢è¯•åŽŸé¢˜ï¼šå¦‚ä½•ä¿è¯ redis ç¼“å­˜ä¸Žæ•°æ®åº“çš„ä¸€è‡´æ€§ï¼Œä¸ºä»€ä¹ˆè¿™ä¹ˆè®¾è®¡</li>
<li><a target="_blank" rel="noopener" href="https://javabetter.cn/zhishixingqiu/mianshi.html">Java é¢è¯•æŒ‡å—ï¼ˆä»˜è´¹ï¼‰</a>æ”¶å½•çš„æ¯”äºšè¿ªé¢ç»åŒå­¦ 12 Java æŠ€æœ¯é¢è¯•åŽŸé¢˜ï¼šæ€Žä¹ˆè§£å†³rediså’Œmysqlçš„ç¼“å­˜ä¸€è‡´æ€§é—®é¢˜</li>
<li><a target="_blank" rel="noopener" href="https://javabetter.cn/zhishixingqiu/mianshi.html">Java é¢è¯•æŒ‡å—ï¼ˆä»˜è´¹ï¼‰</a>æ”¶å½•çš„å­—èŠ‚è·³åŠ¨åŒå­¦ 17 åŽç«¯æŠ€æœ¯é¢è¯•åŽŸé¢˜ï¼šåŒå†™ä¸€è‡´æ€§æ€Žä¹ˆè§£å†³çš„</li>
<li><a target="_blank" rel="noopener" href="https://javabetter.cn/zhishixingqiu/mianshi.html">Java é¢è¯•æŒ‡å—ï¼ˆä»˜è´¹ï¼‰</a>æ”¶å½•çš„äº¬ä¸œé¢ç»åŒå­¦ 9 é¢è¯•åŽŸé¢˜ï¼šredisçš„æ•°æ®å’Œç¼“å­˜ä¸ä¸€è‡´åº”è¯¥å¤„ç†</li>
</ol>
</blockquote>
<h3 id="40-ðŸŒŸRedisæœ‰å“ªäº›å†…å­˜æ·˜æ±°ç­–ç•¥ï¼Ÿ"><a href="#40-ðŸŒŸRedisæœ‰å“ªäº›å†…å­˜æ·˜æ±°ç­–ç•¥ï¼Ÿ" class="headerlink" title="40.ðŸŒŸRedisæœ‰å“ªäº›å†…å­˜æ·˜æ±°ç­–ç•¥ï¼Ÿ"></a>40.ðŸŒŸRedisæœ‰å“ªäº›å†…å­˜æ·˜æ±°ç­–ç•¥ï¼Ÿ</h3><p>å½“å†…å­˜ä½¿ç”¨æŽ¥è¿‘ maxmemory é™åˆ¶æ—¶ï¼ŒRedis ä¼šä¾æ®å†…å­˜æ·˜æ±°ç­–ç•¥æ¥å†³å®šåˆ é™¤å“ªäº› key ä»¥ç¼“è§£å†…å­˜åŽ‹åŠ›ã€‚</p>
<p><img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="https://cdn.jsdelivr.net/gh/JakicDong/blog-assets@main/images/20251023112833.png" alt="20251023112833"><br>ç å“¥å­—èŠ‚ï¼šå†…å­˜æ·˜æ±°ç­–ç•¥</p>
<p>å¸¸ç”¨çš„å†…å­˜æ·˜æ±°ç­–ç•¥æœ‰å…«ç§ï¼Œåˆ†åˆ«æ˜¯é»˜è®¤çš„ <code>noeviction</code>ï¼Œå†…å­˜ä¸è¶³æ—¶ä¸ä¼šåˆ é™¤ä»»ä½• keyï¼Œç›´æŽ¥è¿”å›žé”™è¯¯ä¿¡æ¯ï¼Œç”Ÿäº§çŽ¯å¢ƒä¸‹åŸºæœ¬ä¸Šä¸ä¼šä½¿ç”¨ã€‚</p>
<p>ç„¶åŽæ˜¯é’ˆå¯¹æ‰€æœ‰ key çš„ <code>allkeys-lru</code>ã€<code>allkeys-lfu</code> å’Œ <code>allkeys-random</code>ã€‚lru ä¼šåˆ é™¤æœ€è¿‘æœ€å°‘ä½¿ç”¨çš„ keyï¼Œåœ¨çº¯ç¼“å­˜åœºæ™¯ä¸­æœ€å¸¸ç”¨ï¼Œèƒ½è‡ªåŠ¨ä¿ç•™çƒ­ç‚¹æ•°æ®ï¼›lfu ä¼šåˆ é™¤è®¿é—®é¢‘çŽ‡æœ€ä½Žçš„ keyï¼Œæ›´é€‚åˆé•¿æœŸè¿è¡Œçš„ç³»ç»Ÿï¼›random ä¼šéšæœºåˆ é™¤ä¸€äº› keyï¼Œä¸€èˆ¬ä¸æŽ¨èä½¿ç”¨ã€‚</p>
<p>å…¶æ¬¡æ˜¯é’ˆå¯¹è®¾ç½®äº†è¿‡æœŸæ—¶é—´çš„ keyï¼Œæœ‰ volatile-lruã€volatile-lfuã€volatile-ttl å’Œ volatile-randomã€‚</p>
<p>lru åœ¨æ··åˆå­˜å‚¨åœºæ™¯ä¸­ç»å¸¸ä½¿ç”¨ã€‚</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Service</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">HybridStorageService</span> &#123;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// é‡è¦æ•°æ®ä¸è®¾ç½®è¿‡æœŸæ—¶é—´ï¼Œä¸´æ—¶æ•°æ®è®¾ç½®è¿‡æœŸæ—¶é—´</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">storeData</span><span class="params">(String key, Object data, DataImportance importance)</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> (importance == DataImportance.HIGH) &#123;</span><br><span class="line">            <span class="comment">// é‡è¦æ•°æ®ä¸è®¾ç½®è¿‡æœŸæ—¶é—´ï¼Œåœ¨volatile-*ç­–ç•¥ä¸‹ä¸ä¼šè¢«æ·˜æ±°</span></span><br><span class="line">            redisTemplate.opsForValue().set(key, data);</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="comment">// ä¸´æ—¶æ•°æ®è®¾ç½®è¿‡æœŸæ—¶é—´ï¼Œå¯ä»¥è¢«volatile-*ç­–ç•¥æ·˜æ±°</span></span><br><span class="line">            redisTemplate.opsForValue().set(key, data, Duration.ofHours(<span class="number">1</span>));</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>lfu é€‚åˆéœ€è¦ä¿æŠ¤æŸäº›é‡è¦æ•°æ®ä¸è¢«æ·˜æ±°çš„åœºæ™¯ï¼›ttl ä¼˜å…ˆåˆ é™¤å³å°†è¿‡æœŸçš„ keyï¼Œåœ¨ç”¨æˆ·ä¼šè¯ç®¡ç†ç³»ç»Ÿä¸­æŽ¨èä½¿ç”¨ï¼›random ä»ç„¶å¾ˆå°‘ç”¨ã€‚</p>
<blockquote>
<ol>
<li><a target="_blank" rel="noopener" href="https://javabetter.cn/zhishixingqiu/mianshi.html">Java é¢è¯•æŒ‡å—ï¼ˆä»˜è´¹ï¼‰</a>æ”¶å½•çš„å°ç±³æ˜¥æ‹›åŒå­¦ K ä¸€é¢é¢è¯•åŽŸé¢˜ï¼šä¸ºä»€ä¹ˆ redis å¿«ï¼Œæ·˜æ±°ç­–ç•¥ æŒä¹…åŒ–</li>
<li><a target="_blank" rel="noopener" href="https://javabetter.cn/zhishixingqiu/mianshi.html">Java é¢è¯•æŒ‡å—ï¼ˆä»˜è´¹ï¼‰</a>æ”¶å½•çš„åŽ»å“ªå„¿é¢ç»åŒå­¦ 1 æŠ€æœ¯ 2 é¢é¢è¯•åŽŸé¢˜ï¼šredis å†…å­˜æ·˜æ±°å’Œè¿‡æœŸç­–ç•¥</li>
<li><a target="_blank" rel="noopener" href="https://javabetter.cn/zhishixingqiu/mianshi.html">Java é¢è¯•æŒ‡å—ï¼ˆä»˜è´¹ï¼‰</a>æ”¶å½•çš„ä½œä¸šå¸®é¢ç»åŒå­¦ 1 Java åŽç«¯ä¸€é¢é¢è¯•åŽŸé¢˜ï¼šrediså†…å­˜æ·˜æ±°ç­–ç•¥</li>
</ol>
</blockquote>
<h3 id="45-ðŸŒŸRedisæ”¯æŒäº‹åŠ¡å—ï¼Ÿ"><a href="#45-ðŸŒŸRedisæ”¯æŒäº‹åŠ¡å—ï¼Ÿ" class="headerlink" title="45.ðŸŒŸRedisæ”¯æŒäº‹åŠ¡å—ï¼Ÿ"></a>45.ðŸŒŸRedisæ”¯æŒäº‹åŠ¡å—ï¼Ÿ</h3><p>æ˜¯çš„ï¼ŒRedis æ”¯æŒç®€å•çš„äº‹åŠ¡ï¼Œå¯ä»¥å°† multiã€execã€discard å’Œ watch å‘½ä»¤æ‰“åŒ…ï¼Œç„¶åŽä¸€æ¬¡æ€§çš„æŒ‰é¡ºåºæ‰§è¡Œã€‚</p>
<p><img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="https://cdn.jsdelivr.net/gh/JakicDong/blog-assets@main/images/20251023160847.png" alt="20251023160847"><br>Redisè®¾è®¡ä¸Žå®žçŽ°ï¼šäº‹åŠ¡</p>
<p>åŸºæœ¬æµç¨‹æ˜¯ç”¨ multi å¼€å¯äº‹åŠ¡ï¼Œç„¶åŽæ‰§è¡Œä¸€ç³»åˆ—å‘½ä»¤ï¼Œæœ€åŽç”¨ exec æäº¤ã€‚è¿™äº›å‘½ä»¤ä¼šè¢«æ”¾å…¥é˜Ÿåˆ—ï¼Œåœ¨ exec æ—¶æ‰¹é‡æ‰§è¡Œã€‚</p>
<p><img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="https://cdn.jsdelivr.net/gh/JakicDong/blog-assets@main/images/20251023160907.png" alt="20251023160907"><br>äºŒå“¥çš„ Java è¿›é˜¶ä¹‹è·¯ï¼šRedis äº‹åŠ¡</p>
<p>å½“å®¢æˆ·ç«¯å¤„äºŽéžäº‹åŠ¡çŠ¶æ€æ—¶ï¼Œæ‰€æœ‰å‘é€ç»™ Redis æœåŠ¡çš„å‘½ä»¤éƒ½ä¼šç«‹å³æ‰§è¡Œï¼›ä½†å½“å®¢æˆ·ç«¯è¿›å…¥äº‹åŠ¡çŠ¶æ€ä¹‹åŽï¼Œè¿™äº›å‘½ä»¤ä¼šè¢«æ”¾å…¥ä¸€ä¸ªäº‹åŠ¡é˜Ÿåˆ—ä¸­ï¼Œç„¶åŽç«‹å³è¿”å›ž QUEUEDï¼Œè¡¨ç¤ºå‘½ä»¤å·²å…¥é˜Ÿã€‚</p>
<p><img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="https://cdn.jsdelivr.net/gh/JakicDong/blog-assets@main/images/20251023160922.png" alt="20251023160922"><br>Redisè®¾è®¡ä¸Žå®žçŽ°ï¼šäº‹åŠ¡å’Œéžäº‹åŠ¡çš„åŒºåˆ«</p>
<p>å½“ exec å‘½ä»¤æ‰§è¡Œæ—¶ï¼ŒRedis ä¼šå°†äº‹åŠ¡é˜Ÿåˆ—ä¸­çš„æ‰€æœ‰å‘½ä»¤æŒ‰å…ˆè¿›å…ˆå‡ºçš„é¡ºåºæ‰§è¡Œã€‚å½“äº‹åŠ¡é˜Ÿåˆ—é‡Œçš„å‘½ä»¤å…¨éƒ¨æ‰§è¡Œå®Œæ¯•åŽï¼ŒRedis ä¼šè¿”å›žä¸€ä¸ªæ•°ç»„ï¼ŒåŒ…å«æ¯ä¸ªå‘½ä»¤çš„æ‰§è¡Œç»“æžœã€‚</p>
<p>discard å‘½ä»¤ç”¨äºŽå–æ¶ˆä¸€ä¸ªäº‹åŠ¡ï¼Œå®ƒä¼šæ¸…ç©ºäº‹åŠ¡é˜Ÿåˆ—å¹¶é€€å‡ºäº‹åŠ¡çŠ¶æ€ã€‚</p>
<p><img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="https://cdn.jsdelivr.net/gh/JakicDong/blog-assets@main/images/20251023160930.png" alt="20251023160930"><br>äºŒå“¥çš„ Java è¿›é˜¶ä¹‹è·¯ï¼šdiscard</p>
<p>watch å‘½ä»¤ç”¨äºŽç›‘è§†ä¸€ä¸ªæˆ–è€…å¤šä¸ª keyï¼Œå¦‚æžœè¿™ä¸ª key åœ¨äº‹åŠ¡æ‰§è¡Œä¹‹å‰ è¢«å…¶ä»–å‘½ä»¤æ”¹åŠ¨ï¼Œé‚£ä¹ˆäº‹åŠ¡å°†ä¼šè¢«æ‰“æ–­ã€‚</p>
<p><img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="https://cdn.jsdelivr.net/gh/JakicDong/blog-assets@main/images/20251023160946.png" alt="20251023160946"><br>ç å“¥å­—èŠ‚ï¼šwatch</p>
<p>ä½† Redis çš„äº‹åŠ¡ä¸Ž MySQL çš„æœ‰å¾ˆå¤§ä¸åŒï¼Œå®ƒå¹¶ä¸æ”¯æŒå›žæ»šï¼Œä¹Ÿä¸æ”¯æŒéš”ç¦»çº§åˆ«ã€‚</p>
<h4 id="è¯´ä¸€ä¸‹-Redis-äº‹åŠ¡çš„åŽŸç†ï¼Ÿ"><a href="#è¯´ä¸€ä¸‹-Redis-äº‹åŠ¡çš„åŽŸç†ï¼Ÿ" class="headerlink" title="è¯´ä¸€ä¸‹ Redis äº‹åŠ¡çš„åŽŸç†ï¼Ÿ"></a>è¯´ä¸€ä¸‹ Redis äº‹åŠ¡çš„åŽŸç†ï¼Ÿ</h4><p>Redis äº‹åŠ¡çš„åŽŸç†å¹¶ä¸å¤æ‚ï¼Œæ ¸å¿ƒå°±æ˜¯ä¸€ä¸ªâ€å…ˆæŽ’é˜Ÿï¼ŒåŽæ‰§è¡Œâ€çš„æœºåˆ¶ã€‚</p>
<p><img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="https://cdn.jsdelivr.net/gh/JakicDong/blog-assets@main/images/20251023161016.png" alt="20251023161016"><br>å°ç”Ÿå‡¡ä¸€ï¼šRedisäº‹åŠ¡</p>
<p>å½“æ‰§è¡Œ MULTI å‘½ä»¤æ—¶ï¼ŒRedis ä¼šç»™è¿™ä¸ªå®¢æˆ·ç«¯æ‰“ä¸€ä¸ªäº‹åŠ¡çš„æ ‡è®°ï¼Œè¡¨ç¤ºè¿™ä¸ªå®¢æˆ·ç«¯åŽé¢å‘é€çš„å‘½ä»¤ä¸ä¼šè¢«ç«‹å³æ‰§è¡Œï¼Œè€Œæ˜¯è¢«æ”¾åˆ°ä¸€ä¸ªé˜Ÿåˆ—é‡ŒæŽ’é˜Ÿç­‰ç€ã€‚</p>
<p><img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="https://cdn.jsdelivr.net/gh/JakicDong/blog-assets@main/images/20251023161037.png" alt="20251023161037"><br>å°ç”Ÿå‡¡ä¸€ï¼šMULTI</p>
<p>å½“ Redis æ”¶åˆ° EXEC å‘½ä»¤æ—¶ï¼Œå®ƒä¼šæŠŠé˜Ÿåˆ—é‡Œçš„å‘½ä»¤ä¸€ä¸ªä¸ªæ‹¿å‡ºæ¥æ‰§è¡Œã€‚å› ä¸º Redis æ˜¯å•çº¿ç¨‹çš„ï¼Œæ‰€ä»¥è¿™ä¸ªè¿‡ç¨‹ä¸ä¼šè¢«å…¶ä»–å‘½ä»¤æ‰“æ–­ï¼Œè¿™å°±ä¿è¯äº†Redis äº‹åŠ¡çš„åŽŸå­æ€§ã€‚</p>
<p><img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="https://cdn.jsdelivr.net/gh/JakicDong/blog-assets@main/images/20251023161053.png" alt="20251023161053"><br>å°ç”Ÿå‡¡ä¸€ï¼šWATCH</p>
<p>å½“æ‰§è¡Œ WATCH å‘½ä»¤æ—¶ï¼ŒRedis ä¼šå°† key æ·»åŠ åˆ°å…¨å±€ç›‘è§†å­—å…¸ä¸­ï¼›åªè¦è¿™äº› key åœ¨ EXEC å‰è¢«å…¶ä»–å®¢æˆ·ç«¯ä¿®æ”¹ï¼ŒRedis å°±ä¼šç»™ç›¸å…³å®¢æˆ·ç«¯æ‰“ä¸Šè„æ ‡è®°ï¼ŒEXEC æ—¶å‘çŽ°äº‹åŠ¡å·²è¢«å¹²æ‰°å°±ä¼šç›´æŽ¥å–æ¶ˆæ•´ä¸ªäº‹åŠ¡ã€‚</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// å…¨å±€ç›‘è§†å­—å…¸</span></span><br><span class="line">dict *watched_keys;</span><br><span class="line"></span><br><span class="line"><span class="keyword">typedef</span> <span class="class"><span class="keyword">struct</span> <span class="title">watchedKey</span> &#123;</span></span><br><span class="line">    robj *key;</span><br><span class="line">    redisDb *db;</span><br><span class="line">&#125; watchedKey;</span><br></pre></td></tr></table></figure>

<p>DISCARD åšçš„äº‹æƒ…å¾ˆç®€å•ç›´æŽ¥ï¼Œé¦–å…ˆæ£€æŸ¥å®¢æˆ·ç«¯æ˜¯å¦çœŸçš„åœ¨äº‹åŠ¡çŠ¶æ€ï¼Œå¦‚æžœä¸åœ¨å°±æŠ¥é”™ï¼›å¦‚æžœåœ¨äº‹åŠ¡çŠ¶æ€ï¼Œå°±æ¸…ç©ºäº‹åŠ¡é˜Ÿåˆ—å¹¶é€€å‡ºäº‹åŠ¡çŠ¶æ€ã€‚</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">void</span> <span class="title function_">discardCommand</span><span class="params">(client *c)</span> &#123;</span><br><span class="line">    <span class="keyword">if</span> (!(c-&gt;flags &amp; CLIENT_MULTI)) &#123;</span><br><span class="line">        addReplyError(c,<span class="string">&quot;DISCARD without MULTI&quot;</span>);</span><br><span class="line">        <span class="keyword">return</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    discardTransaction(c);</span><br><span class="line">    addReply(c,shared.ok);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="Redis-äº‹åŠ¡æœ‰å“ªäº›æ³¨æ„ç‚¹ï¼Ÿ"><a href="#Redis-äº‹åŠ¡æœ‰å“ªäº›æ³¨æ„ç‚¹ï¼Ÿ" class="headerlink" title="Redis äº‹åŠ¡æœ‰å“ªäº›æ³¨æ„ç‚¹ï¼Ÿ"></a>Redis äº‹åŠ¡æœ‰å“ªäº›æ³¨æ„ç‚¹ï¼Ÿ</h4><p>æœ€é‡è¦çš„çš„ä¸€ç‚¹æ˜¯ï¼ŒRedis äº‹åŠ¡ä¸æ”¯æŒå›žæ»šï¼Œä¸€æ—¦ EXEC å‘½ä»¤è¢«è°ƒç”¨ï¼Œæ‰€æœ‰å‘½ä»¤éƒ½ä¼šè¢«æ‰§è¡Œï¼Œå³ä½¿æœ‰äº›å‘½ä»¤å¯èƒ½æ‰§è¡Œå¤±è´¥ã€‚</p>
<h4 id="Redisäº‹åŠ¡ä¸ºä»€ä¹ˆä¸æ”¯æŒå›žæ»šï¼Ÿ"><a href="#Redisäº‹åŠ¡ä¸ºä»€ä¹ˆä¸æ”¯æŒå›žæ»šï¼Ÿ" class="headerlink" title="Redisäº‹åŠ¡ä¸ºä»€ä¹ˆä¸æ”¯æŒå›žæ»šï¼Ÿ"></a>Redisäº‹åŠ¡ä¸ºä»€ä¹ˆä¸æ”¯æŒå›žæ»šï¼Ÿ</h4><p>Redis çš„æ ¸å¿ƒè®¾è®¡ç†å¿µæ˜¯ç®€å•ã€é«˜æ•ˆï¼Œè€Œä¸æ˜¯å®Œæ•´çš„ ACID ç‰¹æ€§ã€‚è€Œå®žçŽ°å›žæ»šéœ€è¦åœ¨æ‰§è¡Œè¿‡ç¨‹ä¸­ä¿å­˜å¤§é‡çš„çŠ¶æ€ä¿¡æ¯ï¼Œå¹¶åœ¨å‘ç”Ÿé”™è¯¯æ—¶é€†å‘æ‰§è¡Œå‘½ä»¤ä»¥æ¢å¤åŽŸå§‹çŠ¶æ€ã€‚è¿™ä¼šå¢žåŠ  Redis çš„å¤æ‚æ€§å’Œæ€§èƒ½å¼€é”€ã€‚</p>
<p><img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="https://cdn.jsdelivr.net/gh/JakicDong/blog-assets@main/images/20251023161146.png" alt="20251023161146"><br>redis.ioï¼šä¸æ”¯æŒäº‹åŠ¡å›žæ»š</p>
<h4 id="Redisäº‹åŠ¡æ»¡è¶³åŽŸå­æ€§å—ï¼Ÿè¦æ€Žä¹ˆæ”¹è¿›ï¼Ÿ"><a href="#Redisäº‹åŠ¡æ»¡è¶³åŽŸå­æ€§å—ï¼Ÿè¦æ€Žä¹ˆæ”¹è¿›ï¼Ÿ" class="headerlink" title="Redisäº‹åŠ¡æ»¡è¶³åŽŸå­æ€§å—ï¼Ÿè¦æ€Žä¹ˆæ”¹è¿›ï¼Ÿ"></a>Redisäº‹åŠ¡æ»¡è¶³åŽŸå­æ€§å—ï¼Ÿè¦æ€Žä¹ˆæ”¹è¿›ï¼Ÿ</h4><p>Redis çš„äº‹åŠ¡ä¸èƒ½æ»¡è¶³æ ‡å‡†çš„åŽŸå­æ€§ï¼Œå› ä¸ºå®ƒä¸æ”¯æŒäº‹åŠ¡å›žæ»šï¼Œä¹Ÿå°±æ˜¯è¯´ï¼Œå‡å¦‚æŸä¸ªå‘½ä»¤æ‰§è¡Œå¤±è´¥ï¼Œæ•´ä¸ªäº‹åŠ¡å¹¶ä¸ä¼šè‡ªåŠ¨å›žæ»šåˆ°åˆå§‹çŠ¶æ€ã€‚</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// ä¸€ä¸ªè½¬è´¦äº‹åŠ¡</span></span><br><span class="line">redisTemplate.multi();</span><br><span class="line">redisTemplate.opsForValue().decrement(<span class="string">&quot;user:1:balance&quot;</span>, <span class="number">100</span>); <span class="comment">// æˆåŠŸ</span></span><br><span class="line">redisTemplate.opsForList().leftPush(<span class="string">&quot;user:1:balance&quot;</span>, <span class="string">&quot;log&quot;</span>);  <span class="comment">// ç±»åž‹é”™è¯¯ï¼Œå¤±è´¥</span></span><br><span class="line">redisTemplate.opsForValue().increment(<span class="string">&quot;user:2:balance&quot;</span>, <span class="number">100</span>);  <span class="comment">// è¿˜æ˜¯ä¼šæ‰§è¡Œ</span></span><br><span class="line">List&lt;Object&gt; results = redisTemplate.exec();</span><br><span class="line"></span><br><span class="line"><span class="comment">// ç»“æžœï¼šç”¨æˆ·1è¢«æ‰£äº†é’±ï¼Œç”¨æˆ·2ä¹Ÿæ”¶åˆ°äº†é’±ï¼Œä½†ä¸­é—´çš„æ—¥å¿—æ“ä½œå¤±è´¥äº†</span></span><br><span class="line"><span class="comment">// è¿™ç¬¦åˆRedisçš„åŽŸå­æ€§å®šä¹‰ï¼Œä½†ä¸ç¬¦åˆä¸šåŠ¡æœŸæœ›</span></span><br></pre></td></tr></table></figure>

<p>å¯ä»¥ä½¿ç”¨ Lua è„šæœ¬æ¥æ›¿ä»£äº‹åŠ¡ï¼Œè„šæœ¬è¿è¡ŒæœŸé—´ï¼ŒRedis ä¸ä¼šå¤„ç†å…¶ä»–å‘½ä»¤ï¼Œå¹¶ä¸”æˆ‘ä»¬å¯ä»¥åœ¨è„šæœ¬ä¸­å¤„ç†æ•´ä¸ªä¸šåŠ¡é€»è¾‘ï¼ŒåŒ…æ‹¬æ¡ä»¶æ£€æŸ¥å’Œé”™è¯¯å¤„ç†ï¼Œä¿è¯è¦ä¹ˆæ‰§è¡ŒæˆåŠŸï¼Œè¦ä¹ˆä¿æŒæœ€åˆçš„çŠ¶æ€ï¼Œä¸ä¼šå‡ºçŽ°ä¸€ä¸ªå‘½ä»¤æ‰§è¡Œå¤±è´¥ã€å…¶ä»–å‘½ä»¤æ‰§è¡ŒæˆåŠŸçš„æƒ…å†µã€‚</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Service</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ImprovedTransactionService</span> &#123;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">public</span> <span class="type">boolean</span> <span class="title function_">atomicTransfer</span><span class="params">(String fromUser, String toUser, <span class="type">int</span> amount)</span> &#123;</span><br><span class="line">        <span class="type">String</span> <span class="variable">luaScript</span> <span class="operator">=</span> </span><br><span class="line">            <span class="string">&quot;local from_key = KEYS[1] &quot;</span> +</span><br><span class="line">            <span class="string">&quot;local to_key = KEYS[2] &quot;</span> +</span><br><span class="line">            <span class="string">&quot;local amount = tonumber(ARGV[1]) &quot;</span> +</span><br><span class="line">            </span><br><span class="line">            <span class="comment">// æ£€æŸ¥è½¬å‡ºè´¦æˆ·ä½™é¢</span></span><br><span class="line">            <span class="string">&quot;local from_balance = redis.call(&#x27;GET&#x27;, from_key) &quot;</span> +</span><br><span class="line">            <span class="string">&quot;if not from_balance then return -1 end &quot;</span> +</span><br><span class="line">            </span><br><span class="line">            <span class="string">&quot;from_balance = tonumber(from_balance) &quot;</span> +</span><br><span class="line">            <span class="string">&quot;if from_balance &lt; amount then return -2 end &quot;</span> +</span><br><span class="line">            </span><br><span class="line">            <span class="comment">// æ£€æŸ¥è½¬å…¥è´¦æˆ·æ˜¯å¦å­˜åœ¨</span></span><br><span class="line">            <span class="string">&quot;if redis.call(&#x27;EXISTS&#x27;, to_key) == 0 then return -3 end &quot;</span> +</span><br><span class="line">            </span><br><span class="line">            <span class="comment">// æ‰€æœ‰æ£€æŸ¥é€šè¿‡ï¼Œæ‰§è¡Œè½¬è´¦</span></span><br><span class="line">            <span class="string">&quot;redis.call(&#x27;DECRBY&#x27;, from_key, amount) &quot;</span> +</span><br><span class="line">            <span class="string">&quot;redis.call(&#x27;INCRBY&#x27;, to_key, amount) &quot;</span> +</span><br><span class="line">            </span><br><span class="line">            <span class="comment">// è®°å½•è½¬è´¦æ—¥å¿—</span></span><br><span class="line">            <span class="string">&quot;local log = from_key .. &#x27;:&#x27; .. to_key .. &#x27;:&#x27; .. amount &quot;</span> +</span><br><span class="line">            <span class="string">&quot;redis.call(&#x27;LPUSH&#x27;, &#x27;transfer:log&#x27;, log) &quot;</span> +</span><br><span class="line">            </span><br><span class="line">            <span class="string">&quot;return 1&quot;</span>;</span><br><span class="line">        </span><br><span class="line">        DefaultRedisScript&lt;Long&gt; script = <span class="keyword">new</span> <span class="title class_">DefaultRedisScript</span>&lt;&gt;();</span><br><span class="line">        script.setScriptText(luaScript);</span><br><span class="line">        script.setResultType(Long.class);</span><br><span class="line">        </span><br><span class="line">        <span class="type">Long</span> <span class="variable">result</span> <span class="operator">=</span> redisTemplate.execute(script, </span><br><span class="line">            Arrays.asList(<span class="string">&quot;user:&quot;</span> + fromUser + <span class="string">&quot;:balance&quot;</span>, <span class="string">&quot;user:&quot;</span> + toUser + <span class="string">&quot;:balance&quot;</span>),</span><br><span class="line">            amount);</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">return</span> result != <span class="literal">null</span> &amp;&amp; result == <span class="number">1</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="Redis-äº‹åŠ¡çš„-ACID-ç‰¹æ€§å¦‚ä½•ä½“çŽ°ï¼Ÿ"><a href="#Redis-äº‹åŠ¡çš„-ACID-ç‰¹æ€§å¦‚ä½•ä½“çŽ°ï¼Ÿ" class="headerlink" title="Redis äº‹åŠ¡çš„ ACID ç‰¹æ€§å¦‚ä½•ä½“çŽ°ï¼Ÿ"></a>Redis äº‹åŠ¡çš„ ACID ç‰¹æ€§å¦‚ä½•ä½“çŽ°ï¼Ÿ</h4><p>å•ä¸ª Redis å‘½ä»¤çš„æ‰§è¡Œæ˜¯åŽŸå­æ€§çš„ï¼Œä½† Redis æ²¡æœ‰åœ¨äº‹åŠ¡ä¸Šå¢žåŠ ä»»ä½•ç»´æŒåŽŸå­æ€§çš„æœºåˆ¶ï¼Œæ‰€ä»¥ Redis äº‹åŠ¡åœ¨æ‰§è¡Œè¿‡ç¨‹ä¸­å¦‚æžœæŸä¸ªå‘½ä»¤å¤±è´¥äº†ï¼Œå…¶ä»–å‘½ä»¤è¿˜æ˜¯ä¼šç»§ç»­æ‰§è¡Œï¼Œä¸ä¼šå›žæ»šã€‚</p>
<p><img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="https://cdn.jsdelivr.net/gh/JakicDong/blog-assets@main/images/20251023161307.png" alt="20251023161307"><br>å°ç”Ÿå‡¡ä¸€ï¼šRedis äº‹åŠ¡çš„åŽŸå­æ€§</p>
<p>ä¸€è‡´æ€§æŒ‡çš„æ˜¯ï¼Œå¦‚æžœæ•°æ®åœ¨æ‰§è¡Œäº‹åŠ¡ä¹‹å‰æ˜¯ä¸€è‡´çš„ï¼Œé‚£ä¹ˆåœ¨äº‹åŠ¡æ‰§è¡Œä¹‹åŽï¼Œæ— è®ºäº‹åŠ¡æ˜¯å¦æ‰§è¡ŒæˆåŠŸï¼Œæ•°æ®ä¹Ÿåº”è¯¥æ˜¯ä¸€è‡´çš„ã€‚ä½† Redis äº‹åŠ¡å¹¶ä¸ä¿è¯ä¸€è‡´æ€§ï¼Œå› ä¸ºå¦‚æžœäº‹åŠ¡ä¸­çš„æŸä¸ªå‘½ä»¤å¤±è´¥äº†ï¼Œå…¶ä»–å‘½ä»¤ä»ç„¶ä¼šæ‰§è¡Œï¼Œå°±ä¼šå‡ºçŽ°æ•°æ®ä¸ä¸€è‡´çš„æƒ…å†µã€‚</p>
<p>Redis æ˜¯å•çº¿ç¨‹æ‰§è¡Œäº‹åŠ¡çš„ï¼Œå¹¶ä¸”ä¸ä¼šä¸­æ–­ï¼Œç›´åˆ°æ‰§è¡Œå®Œæ‰€æœ‰äº‹åŠ¡é˜Ÿåˆ—ä¸­çš„å‘½ä»¤ä¸ºæ­¢ã€‚å› æ­¤ï¼Œæˆ‘è®¤ä¸º Redis çš„äº‹åŠ¡å…·æœ‰éš”ç¦»æ€§çš„ç‰¹å¾ã€‚</p>
<p><img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="https://cdn.jsdelivr.net/gh/JakicDong/blog-assets@main/images/20251023161344.png" alt="20251023161344"><br>å°ç”Ÿå‡¡ä¸€ï¼šRedis äº‹åŠ¡çš„éš”ç¦»æ€§</p>
<p>Redis äº‹åŠ¡çš„æŒä¹…æ€§å®Œå…¨ä¾èµ–äºŽ Redis æœ¬èº«çš„æŒä¹…åŒ–æœºåˆ¶ï¼Œå¦‚æžœå¼€å¯äº† AOFï¼Œé‚£ä¹ˆäº‹åŠ¡ä¸­çš„å‘½ä»¤ä¼šä½œä¸ºä¸€ä¸ªæ•´ä½“è®°å½•åˆ° AOF æ–‡ä»¶ä¸­ï¼Œå½“ç„¶ä¹Ÿè¦çœ‹ AOF çš„ fsync ç­–ç•¥ã€‚</p>
<p>å¦‚æžœåªå¼€å¯äº† RDBï¼Œäº‹åŠ¡ä¸­çš„å‘½ä»¤å¯èƒ½ä¼šåœ¨ä¸‹æ¬¡å¿«ç…§å‰ä¸¢å¤±ã€‚å¦‚æžœä¸¤ä¸ªéƒ½æ²¡æœ‰å¼€å¯ï¼Œè‚¯å®šæ˜¯ä¸æ»¡è¶³æŒä¹…æ€§çš„ã€‚</p>
<blockquote>
<ol>
<li><a target="_blank" rel="noopener" href="https://javabetter.cn/zhishixingqiu/mianshi.html">Java é¢è¯•æŒ‡å—ï¼ˆä»˜è´¹ï¼‰</a>æ”¶å½•çš„åŽä¸ºä¸€é¢åŽŸé¢˜ï¼šè¯´ä¸‹ Redis äº‹åŠ¡</li>
<li><a target="_blank" rel="noopener" href="https://javabetter.cn/zhishixingqiu/">äºŒå“¥ç¼–ç¨‹æ˜Ÿçƒ</a>çƒå‹<a target="_blank" rel="noopener" href="https://t.zsxq.com/BaHOh">æž•äº‘çœ ç¾Žå›¢ AI é¢è¯•åŽŸé¢˜</a>ï¼šä»€ä¹ˆæ˜¯ redis çš„äº‹åŠ¡ï¼Œå®ƒçš„ ACID å±žæ€§å¦‚ä½•ä½“çŽ°</li>
<li><a target="_blank" rel="noopener" href="https://javabetter.cn/zhishixingqiu/mianshi.html">Java é¢è¯•æŒ‡å—ï¼ˆä»˜è´¹ï¼‰</a>æ”¶å½•çš„å¿«æ‰‹åŒå­¦ 4 ä¸€é¢åŽŸé¢˜ï¼šRedisäº‹åŠ¡æ»¡è¶³åŽŸå­æ€§å—ï¼Ÿè¦æ€Žä¹ˆæ”¹è¿›ï¼Ÿ</li>
</ol>
</blockquote>
<h3 id="48-ðŸŒŸRedisèƒ½å®žçŽ°åˆ†å¸ƒå¼é”å—ï¼Ÿ"><a href="#48-ðŸŒŸRedisèƒ½å®žçŽ°åˆ†å¸ƒå¼é”å—ï¼Ÿ" class="headerlink" title="48.ðŸŒŸRedisèƒ½å®žçŽ°åˆ†å¸ƒå¼é”å—ï¼Ÿ"></a>48.ðŸŒŸRedisèƒ½å®žçŽ°åˆ†å¸ƒå¼é”å—ï¼Ÿ</h3><p>åˆ†å¸ƒå¼é”æ˜¯ä¸€ç§ç”¨äºŽæŽ§åˆ¶å¤šä¸ªä¸åŒè¿›ç¨‹åœ¨åˆ†å¸ƒå¼ç³»ç»Ÿä¸­è®¿é—®å…±äº«èµ„æºçš„é”æœºåˆ¶ã€‚å®ƒèƒ½ç¡®ä¿åœ¨åŒä¸€æ—¶åˆ»ï¼Œåªæœ‰ä¸€ä¸ªèŠ‚ç‚¹å¯ä»¥å¯¹èµ„æºè¿›è¡Œè®¿é—®ï¼Œä»Žè€Œé¿å…åˆ†å¸ƒå¼åœºæ™¯ä¸‹çš„å¹¶å‘é—®é¢˜ã€‚</p>
<p>å¯ä»¥ä½¿ç”¨ Redis çš„ SETNX å‘½ä»¤å®žçŽ°ç®€å•çš„åˆ†å¸ƒå¼é”ã€‚æ¯”å¦‚ <code>SET key value NX PX 3000</code> å°±åˆ›å»ºäº†ä¸€ä¸ªé”åä¸º <code>key</code> çš„åˆ†å¸ƒå¼é”ï¼Œé”çš„æŒæœ‰è€…ä¸º <code>value</code>ã€‚NX ä¿è¯åªæœ‰åœ¨ key ä¸å­˜åœ¨æ—¶æ‰èƒ½åˆ›å»ºæˆåŠŸï¼ŒEX è®¾ç½®è¿‡æœŸæ—¶é—´ç”¨ä»¥é˜²æ­¢æ­»é”ã€‚</p>
<p><img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="https://cdn.jsdelivr.net/gh/JakicDong/blog-assets@main/images/20251023162344.png" alt="20251023162344"><br>ä¸‰åˆ†æ¶é¢æ¸£é€†è¢­ï¼šsetåŽŸå­å‘½ä»¤</p>
<h4 id="Rediså¦‚ä½•ä¿è¯-SETNX-ä¸ä¼šå‘ç”Ÿå†²çªï¼Ÿ"><a href="#Rediså¦‚ä½•ä¿è¯-SETNX-ä¸ä¼šå‘ç”Ÿå†²çªï¼Ÿ" class="headerlink" title="Rediså¦‚ä½•ä¿è¯ SETNX ä¸ä¼šå‘ç”Ÿå†²çªï¼Ÿ"></a>Rediså¦‚ä½•ä¿è¯ SETNX ä¸ä¼šå‘ç”Ÿå†²çªï¼Ÿ</h4><p>å½“æˆ‘ä»¬ä½¿ç”¨ <code>SET key value NX EX 30</code> è¿™ä¸ªå‘½ä»¤è¿›è¡ŒåŠ é”æ—¶ï¼ŒRedis ä¼šæŠŠæ•´ä¸ªæ“ä½œå½“ä½œä¸€ä¸ªåŽŸå­æŒ‡ä»¤æ¥æ‰§è¡Œã€‚å› ä¸º Redis çš„å‘½ä»¤å¤„ç†æ˜¯å•çº¿ç¨‹çš„ï¼Œæ‰€ä»¥åœ¨åŒä¸€æ—¶åˆ»åªèƒ½æœ‰ä¸€ä¸ªå‘½ä»¤åœ¨æ‰§è¡Œã€‚</p>
<p>æ¯”å¦‚è¯´ä¸¤ä¸ªå®¢æˆ·ç«¯ A å’Œ B åŒæ—¶è¯·æ±‚åŒä¸€ä¸ªé”ï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">å®¢æˆ·ç«¯A: SET lock_key uuid_a NX EX 30</span><br><span class="line">å®¢æˆ·ç«¯B: SET lock_key uuid_b NX EX 30</span><br></pre></td></tr></table></figure>

<p>è™½ç„¶è¿™ä¸¤ä¸ªè¯·æ±‚å¯èƒ½å‡ ä¹ŽåŒæ—¶åˆ°è¾¾ Redis æœåŠ¡å™¨ï¼Œä½† Redis ä¼šä¸¥æ ¼æŒ‰ç…§åˆ°è¾¾çš„å…ˆåŽé¡ºåºæ¥å¤„ç†ã€‚å‡è®¾ A çš„è¯·æ±‚å…ˆåˆ°ï¼ŒRedis ä¼šå…ˆæ‰§è¡Œ A çš„ SET å‘½ä»¤ï¼Œè¿™æ—¶ lock_key è¢«è®¾ç½®ä¸º uuid_aã€‚</p>
<p>å½“å¤„ç† B çš„è¯·æ±‚æ—¶ï¼Œå› ä¸º lock_key å·²ç»å­˜åœ¨äº†ï¼ŒNX æ¡ä»¶ä¸æ»¡è¶³ï¼Œæ‰€ä»¥ B çš„ SET å‘½ä»¤ä¼šå¤±è´¥ï¼Œè¿”å›ž NULLã€‚è¿™æ ·å°±ä¿è¯äº†åªæœ‰ A èƒ½èŽ·å–åˆ°é”ã€‚</p>
<p>å…³é”®ç‚¹åœ¨äºŽ NX çš„è¯­ä¹‰ï¼š<code>NOT EXISTS</code>ï¼Œåªæœ‰åœ¨ key ä¸å­˜åœ¨çš„æ—¶å€™æ‰ä¼šè®¾ç½®æˆåŠŸã€‚Redis åœ¨æ‰§è¡Œè¿™ä¸ªå‘½ä»¤æ—¶ï¼Œä¼šå…ˆæ£€æŸ¥ key æ˜¯å¦å­˜åœ¨ï¼Œå¦‚æžœä¸å­˜åœ¨æ‰ä¼šè®¾ç½®å€¼ï¼Œè¿™æ•´ä¸ªè¿‡ç¨‹æ˜¯åŽŸå­çš„ï¼Œä¸ä¼šè¢«å…¶ä»–å‘½ä»¤æ‰“æ–­ã€‚</p>
<h4 id="SETNXæœ‰ä»€ä¹ˆé—®é¢˜ï¼Œå¦‚ä½•è§£å†³ï¼Ÿ"><a href="#SETNXæœ‰ä»€ä¹ˆé—®é¢˜ï¼Œå¦‚ä½•è§£å†³ï¼Ÿ" class="headerlink" title="SETNXæœ‰ä»€ä¹ˆé—®é¢˜ï¼Œå¦‚ä½•è§£å†³ï¼Ÿ"></a>SETNXæœ‰ä»€ä¹ˆé—®é¢˜ï¼Œå¦‚ä½•è§£å†³ï¼Ÿ</h4><p>ä½¿ç”¨ SETNX åˆ›å»ºåˆ†å¸ƒå¼é”æ—¶ï¼Œè™½ç„¶å¯ä»¥é€šè¿‡è®¾ç½®è¿‡æœŸæ—¶é—´æ¥é¿å…æ­»é”ï¼Œä½†ä¼šè¯¯åˆ é”ã€‚æ¯”å¦‚çº¿ç¨‹ A èŽ·å–é”åŽï¼Œä¸šåŠ¡æ‰§è¡Œæ—¶é—´æ¯”è¾ƒé•¿ï¼Œé”è¿‡æœŸäº†ã€‚è¿™æ—¶çº¿ç¨‹ B èŽ·å–åˆ°é”ï¼Œä½†çº¿ç¨‹ A æ‰§è¡Œå®Œä¸šåŠ¡é€»è¾‘åŽï¼Œä¼šå°è¯•åˆ é™¤é”ï¼Œè¿™æ—¶å€™åˆ æŽ‰çš„å…¶å®žæ˜¯çº¿ç¨‹ B çš„é”ã€‚</p>
<p><img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="https://cdn.jsdelivr.net/gh/JakicDong/blog-assets@main/images/20251023162513.png" alt="20251023162513"><br>æŠ€æœ¯æ´¾ï¼šRedis é”</p>
<p>å¯ä»¥é€šè¿‡é”çš„è‡ªåŠ¨ç»­æœŸæœºåˆ¶æ¥è§£å†³é”è¿‡æœŸçš„é—®é¢˜ï¼Œæ¯”å¦‚ Redisson çš„çœ‹é—¨ç‹—æœºåˆ¶ï¼Œåœ¨åŽå°å¯åŠ¨ä¸€ä¸ªå®šæ—¶ä»»åŠ¡ï¼Œæ¯éš”ä¸€æ®µæ—¶é—´å°±æ£€æŸ¥é”æ˜¯å¦è¿˜è¢«å½“å‰çº¿ç¨‹æŒæœ‰ï¼Œå¦‚æžœæ˜¯å°±è‡ªåŠ¨å»¶é•¿è¿‡æœŸæ—¶é—´ã€‚è¿™æ ·æ—¢é¿å…äº†æ­»é”ï¼Œåˆé˜²æ­¢äº†é”è¢«æå‰é‡Šæ”¾ã€‚</p>
<p><img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="https://cdn.jsdelivr.net/gh/JakicDong/blog-assets@main/images/20251023162536.png" alt="20251023162536"><br>æŠ€æœ¯æ´¾ï¼šredisson çœ‹é—¨ç‹—</p>
<h4 id="Redissonäº†è§£å¤šå°‘ï¼Ÿ"><a href="#Redissonäº†è§£å¤šå°‘ï¼Ÿ" class="headerlink" title="Redissonäº†è§£å¤šå°‘ï¼Ÿ"></a>Redissonäº†è§£å¤šå°‘ï¼Ÿ</h4><p>Redisson æ˜¯ä¸€ä¸ªåŸºäºŽ Redis çš„ Java å®¢æˆ·ç«¯ï¼Œå®ƒä¸åªæ˜¯å¯¹ Redis çš„æ“ä½œè¿›è¡Œç®€å•åœ°å°è£…ï¼Œè¿˜æä¾›äº†å¾ˆå¤šåˆ†å¸ƒå¼çš„æ•°æ®ç»“æž„å’ŒæœåŠ¡ï¼Œæ¯”å¦‚æœ€å¸¸ç”¨çš„åˆ†å¸ƒå¼é”ã€‚</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">RLock</span> <span class="variable">lock</span> <span class="operator">=</span> redisson.getLock(<span class="string">&quot;lock&quot;</span>);</span><br><span class="line">lock.lock();</span><br><span class="line"><span class="keyword">try</span> &#123;</span><br><span class="line">    <span class="comment">// do something</span></span><br><span class="line">&#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">    lock.unlock();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>Redisson çš„åˆ†å¸ƒå¼é”æ¯” SETNX å®Œå–„çš„å¾—å¤šï¼Œå®ƒçš„çœ‹é—¨ç‹—æœºåˆ¶å¯ä»¥è®©æˆ‘ä»¬åœ¨èŽ·å–é”çš„æ—¶å€™çœåŽ»æ‰‹åŠ¨è®¾ç½®è¿‡æœŸæ—¶é—´çš„æ­¥éª¤ï¼Œå®ƒåœ¨å†…éƒ¨å°è£…äº†ä¸€ä¸ªå®šæ—¶ä»»åŠ¡ï¼Œæ¯éš” 10 ç§’ä¼šæ£€æŸ¥ä¸€æ¬¡ï¼Œå¦‚æžœå½“å‰çº¿ç¨‹è¿˜æŒæœ‰é”å°±è‡ªåŠ¨ç»­æœŸ 30 ç§’ã€‚</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">private</span> Long <span class="title function_">tryAcquire</span><span class="params">(<span class="type">long</span> waitTime, <span class="type">long</span> leaseTime, TimeUnit unit, <span class="type">long</span> threadId)</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> get(tryAcquireAsync(waitTime, leaseTime, unit, threadId));</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">private</span> &lt;T&gt; RFuture&lt;Long&gt; <span class="title function_">tryAcquireAsync</span><span class="params">(<span class="type">long</span> waitTime, <span class="type">long</span> leaseTime, TimeUnit unit, <span class="type">long</span> threadId)</span> &#123;</span><br><span class="line">    RFuture&lt;Long&gt; ttlRemainingFuture;</span><br><span class="line">    <span class="keyword">if</span> (leaseTime != -<span class="number">1</span>) &#123;</span><br><span class="line">        <span class="comment">// æ‰‹åŠ¨è®¾ç½®è¿‡æœŸæ—¶é—´</span></span><br><span class="line">        ttlRemainingFuture = tryLockInnerAsync(waitTime, leaseTime, unit, threadId, RedisCommands.EVAL_LONG);</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="comment">// å¯ç”¨çœ‹é—¨ç‹—æœºåˆ¶ï¼Œä½¿ç”¨é»˜è®¤çš„30ç§’è¿‡æœŸæ—¶é—´</span></span><br><span class="line">        ttlRemainingFuture = tryLockInnerAsync(waitTime, internalLockLeaseTime,</span><br><span class="line">                TimeUnit.MILLISECONDS, threadId, RedisCommands.EVAL_LONG);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// å¤„ç†èŽ·å–é”æˆåŠŸçš„æƒ…å†µ</span></span><br><span class="line">    ttlRemainingFuture.onComplete((ttlRemaining, e) -&gt; &#123;</span><br><span class="line">        <span class="keyword">if</span> (e != <span class="literal">null</span>) &#123;</span><br><span class="line">            <span class="keyword">return</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">// å¦‚æžœèŽ·å–é”æˆåŠŸä¸”å¯ç”¨çœ‹é—¨ç‹—æœºåˆ¶</span></span><br><span class="line">        <span class="keyword">if</span> (ttlRemaining == <span class="literal">null</span>) &#123;</span><br><span class="line">            <span class="keyword">if</span> (leaseTime != -<span class="number">1</span>) &#123;</span><br><span class="line">                internalLockLeaseTime = unit.toMillis(leaseTime);</span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                scheduleExpirationRenewal(threadId); <span class="comment">// å¯åŠ¨çœ‹é—¨ç‹—</span></span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;);</span><br><span class="line">    <span class="keyword">return</span> ttlRemainingFuture;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>å¦å¤–ï¼ŒRedisson è¿˜æä¾›äº†åˆ†å¸ƒå¼é™æµå™¨ RRateLimiterï¼ŒåŸºäºŽä»¤ç‰Œæ¡¶ç®—æ³•å®žçŽ°ï¼Œç”¨äºŽæŽ§åˆ¶åˆ†å¸ƒå¼çŽ¯å¢ƒä¸‹çš„è®¿é—®é¢‘çŽ‡ã€‚</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// API æŽ¥å£é™æµ</span></span><br><span class="line"><span class="meta">@RestController</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ApiController</span> &#123;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> RedissonClient redissonClient;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@GetMapping(&quot;/api/data&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> ResponseEntity&lt;?&gt; getData() &#123;</span><br><span class="line">        <span class="type">RRateLimiter</span> <span class="variable">limiter</span> <span class="operator">=</span> redissonClient.getRateLimiter(<span class="string">&quot;api.data&quot;</span>);</span><br><span class="line">        limiter.trySetRate(RateType.OVERALL, <span class="number">100</span>, <span class="number">1</span>, RateIntervalUnit.MINUTES);</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">if</span> (limiter.tryAcquire()) &#123;</span><br><span class="line">            <span class="comment">// å¤„ç†è¯·æ±‚</span></span><br><span class="line">            <span class="keyword">return</span> ResponseEntity.ok(processData());</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="comment">// é™æµè§¦å‘</span></span><br><span class="line">            <span class="keyword">return</span> ResponseEntity.status(<span class="number">429</span>).body(<span class="string">&quot;Rate limit exceeded&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="è¯¦ç»†è¯´è¯´Redissonçš„çœ‹é—¨ç‹—æœºåˆ¶ï¼Ÿ"><a href="#è¯¦ç»†è¯´è¯´Redissonçš„çœ‹é—¨ç‹—æœºåˆ¶ï¼Ÿ" class="headerlink" title="è¯¦ç»†è¯´è¯´Redissonçš„çœ‹é—¨ç‹—æœºåˆ¶ï¼Ÿ"></a>è¯¦ç»†è¯´è¯´Redissonçš„çœ‹é—¨ç‹—æœºåˆ¶ï¼Ÿ</h4><p>Redisson çš„çœ‹é—¨ç‹—æœºåˆ¶æ˜¯ä¸€ç§è‡ªåŠ¨ç»­æœŸæœºåˆ¶ï¼Œç”¨äºŽè§£å†³åˆ†å¸ƒå¼é”çš„è¿‡æœŸé—®é¢˜ã€‚</p>
<p>åŸºæœ¬åŽŸç†æ˜¯è¿™æ ·çš„ï¼šå½“è°ƒç”¨ <code>lock()</code> æ–¹æ³•åŠ é”æ—¶ï¼Œå¦‚æžœæ²¡æœ‰æ˜¾å¼è®¾ç½®è¿‡æœŸæ—¶é—´ï¼ŒRedisson ä¼šé»˜è®¤ç»™é”åŠ ä¸€ä¸ª 30 ç§’çš„è¿‡æœŸæ—¶é—´ï¼ŒåŒæ—¶å¯ç”¨ä¸€ä¸ªåä¸ºâ€œçœ‹é—¨ç‹—â€çš„å®šæ—¶ä»»åŠ¡ï¼Œæ¯éš” 10 ç§’ï¼ˆé»˜è®¤æ˜¯è¿‡æœŸæ—¶é—´çš„ 1&#x2F;3ï¼‰ï¼ŒåŽ»æ£€æŸ¥ä¸€æ¬¡é”æ˜¯å¦è¿˜è¢«å½“å‰çº¿ç¨‹æŒæœ‰ï¼Œå¦‚æžœæ˜¯ï¼Œå°±è‡ªåŠ¨ç»­æœŸï¼Œå°†è¿‡æœŸæ—¶é—´å»¶é•¿åˆ° 30 ç§’ã€‚</p>
<p><img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="https://cdn.jsdelivr.net/gh/JakicDong/blog-assets@main/images/20251023162648.png" alt="20251023162648"><br>éƒ­æ…•è£åšå®¢å›­ï¼šçœ‹é—¨ç‹—</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// ä¼ªä»£ç å±•ç¤ºæ ¸å¿ƒé€»è¾‘</span></span><br><span class="line"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title function_">renewExpiration</span><span class="params">()</span> &#123;</span><br><span class="line">    <span class="type">Timeout</span> <span class="variable">task</span> <span class="operator">=</span> commandExecutor.getConnectionManager()</span><br><span class="line">        .newTimeout(<span class="keyword">new</span> <span class="title class_">TimerTask</span>() &#123;</span><br><span class="line">            <span class="meta">@Override</span></span><br><span class="line">            <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">run</span><span class="params">(Timeout timeout)</span> &#123;</span><br><span class="line">                <span class="comment">// ç”¨ Lua è„šæœ¬æ£€æŸ¥å¹¶ç»­æœŸ</span></span><br><span class="line">                <span class="keyword">if</span> (redis.call(<span class="string">&quot;get&quot;</span>, lockKey) == currentThreadId) &#123;</span><br><span class="line">                    redis.call(<span class="string">&quot;expire&quot;</span>, lockKey, <span class="number">30</span>);</span><br><span class="line">                    <span class="comment">// é€’å½’è°ƒç”¨ï¼Œç»§ç»­ä¸‹ä¸€æ¬¡ç»­æœŸ</span></span><br><span class="line">                    renewExpiration();</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;, <span class="number">10</span>, TimeUnit.SECONDS);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>ç»­æœŸçš„ Lua è„šæœ¬ä¼šæ£€æŸ¥é”çš„ value æ˜¯å¦åŒ¹é…å½“å‰çº¿ç¨‹ï¼Œå¦‚æžœåŒ¹é…å°±å»¶é•¿è¿‡æœŸæ—¶é—´ã€‚è¿™æ ·å°±èƒ½ä¿è¯åªæœ‰é”çš„çœŸæ­£æŒæœ‰è€…æ‰èƒ½ç»­æœŸã€‚</p>
<p>å½“è°ƒç”¨ <code>unlock()</code> æ–¹æ³•æ—¶ï¼Œçœ‹é—¨ç‹—ä»»åŠ¡ä¼šè¢«å–æ¶ˆã€‚æˆ–è€…å¦‚æžœä¸šåŠ¡é€»è¾‘æ‰§è¡Œå®Œä½†å¿˜è®° unlock äº†ï¼Œçœ‹é—¨ç‹—ä¹Ÿä¼šå¸®æˆ‘ä»¬è‡ªåŠ¨æ£€æŸ¥é”ï¼Œå¦‚æžœé”å·²ç»ä¸å±žäºŽå½“å‰çº¿ç¨‹äº†ï¼Œä¹Ÿä¼šè‡ªåŠ¨åœæ­¢ç»­æœŸã€‚</p>
<p>è¿™æ ·æˆ‘ä»¬å°±ä¸ç”¨æ‹…å¿ƒä¸šåŠ¡æ‰§è¡Œæ—¶é—´è¿‡é•¿å¯¼è‡´é”è¢«æå‰é‡Šæ”¾ï¼Œä¹Ÿé¿å…äº†æ‰‹åŠ¨ä¼°ç®—è¿‡æœŸæ—¶é—´çš„éº»çƒ¦ï¼ŒåŒæ—¶ä¹Ÿè§£å†³äº†åˆ†å¸ƒå¼çŽ¯å¢ƒä¸‹çš„æ­»é”é—®é¢˜ã€‚</p>
<h4 id="çœ‹é—¨ç‹—æœºåˆ¶ä¸­çš„æ£€æŸ¥é”è¿‡ç¨‹æ˜¯åŽŸå­æ“ä½œå—ï¼Ÿ"><a href="#çœ‹é—¨ç‹—æœºåˆ¶ä¸­çš„æ£€æŸ¥é”è¿‡ç¨‹æ˜¯åŽŸå­æ“ä½œå—ï¼Ÿ" class="headerlink" title="çœ‹é—¨ç‹—æœºåˆ¶ä¸­çš„æ£€æŸ¥é”è¿‡ç¨‹æ˜¯åŽŸå­æ“ä½œå—ï¼Ÿ"></a>çœ‹é—¨ç‹—æœºåˆ¶ä¸­çš„æ£€æŸ¥é”è¿‡ç¨‹æ˜¯åŽŸå­æ“ä½œå—ï¼Ÿ</h4><p>æ˜¯çš„ï¼ŒRedisson ä½¿ç”¨äº† Lua è„šæœ¬æ¥ä¿è¯é”æ£€æŸ¥çš„åŽŸå­æ€§ã€‚</p>
<p><img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="https://cdn.jsdelivr.net/gh/JakicDong/blog-assets@main/images/20251023162726.png" alt="20251023162726"><br>äºŒå“¥çš„ Java è¿›é˜¶ä¹‹è·¯ï¼šçœ‹é—¨ç‹— lua è„šæœ¬æ£€æŸ¥é”</p>
<p>Redis åœ¨æ‰§è¡Œ Lua è„šæœ¬æ—¶ï¼Œä¼šæŠŠæ•´ä¸ªè„šæœ¬å½“ä½œä¸€ä¸ªå‘½ä»¤æ¥å¤„ç†ï¼ŒæœŸé—´ä¸ä¼šæ‰§è¡Œå…¶ä»–å‘½ä»¤ã€‚æ‰€ä»¥ hexists æ£€æŸ¥å’Œ expire ç»­æœŸæ˜¯åŽŸå­æ‰§è¡Œçš„ã€‚</p>
<h4 id="Redlockä½ äº†è§£å¤šå°‘ï¼Ÿ"><a href="#Redlockä½ äº†è§£å¤šå°‘ï¼Ÿ" class="headerlink" title="Redlockä½ äº†è§£å¤šå°‘ï¼Ÿ"></a>Redlockä½ äº†è§£å¤šå°‘ï¼Ÿ</h4><p>Redlock æ˜¯ Redis ä½œè€… antirez æå‡ºçš„ä¸€ç§åˆ†å¸ƒå¼é”ç®—æ³•ï¼Œç”¨äºŽè§£å†³å•ä¸ª Redis å®žä¾‹ä½œä¸ºåˆ†å¸ƒå¼é”æ—¶å­˜åœ¨çš„å•ç‚¹æ•…éšœé—®é¢˜ã€‚</p>
<p>Redlock çš„æ ¸å¿ƒæ€æƒ³æ˜¯é€šè¿‡åœ¨å¤šä¸ªå®Œå…¨ç‹¬ç«‹çš„ Redis å®žä¾‹ä¸ŠåŒæ—¶èŽ·å–é”æ¥å®žçŽ°å®¹é”™ã€‚</p>
<p><img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="https://cdn.jsdelivr.net/gh/JakicDong/blog-assets@main/images/20251023162805.png" alt="20251023162805"><br>äºŒå“¥çš„ Java è¿›é˜¶ä¹‹è·¯ï¼šRedissonRedLock</p>
<p>minLocksAmount æ–¹æ³•è¿”å›žçš„ <code>locks.size()/2 + 1</code>ï¼Œæ­£æ˜¯ Redlock ç®—æ³•è¦æ±‚çš„å°‘æ•°æœä»Žå¤šæ•°åŽŸåˆ™ã€‚failedLocksLimit æ–¹æ³•ä¼šè®¡ç®—å…è®¸å¤±è´¥çš„é”æ•°é‡ï¼Œç¡®ä¿å³ä½¿éƒ¨åˆ†å®žä¾‹å¤±è´¥ï¼Œåªè¦æˆåŠŸçš„å®žä¾‹æ•°é‡è¶…è¿‡ä¸€åŠå°±è®¤ä¸ºèŽ·å–é”æˆåŠŸã€‚</p>
<p>çº¢é”ä¼šå°è¯•ä¾æ¬¡å‘æ‰€æœ‰ Redis å®žä¾‹èŽ·å–é”ï¼Œå¹¶è®°å½•æˆåŠŸèŽ·å–çš„é”æ•°é‡ï¼Œå½“æ•°é‡è¾¾åˆ° minLocksAmount æ—¶å°±è®¤ä¸ºèŽ·å–æˆåŠŸï¼Œå¦åˆ™é‡Šæ”¾å·²èŽ·å–çš„é”å¹¶è¿”å›žå¤±è´¥ã€‚</p>
<p>è™½ç„¶ Redlock å­˜åœ¨ä¸€äº›äº‰è®®ï¼Œæ¯”å¦‚è¯´æ—¶é’Ÿæ¼‚ç§»é—®é¢˜ã€ç½‘ç»œåˆ†åŒºå¯¼è‡´çš„è„‘è£‚é—®é¢˜ï¼Œä½†å®ƒä»ç„¶æ˜¯ä¸€ä¸ªç›¸å¯¹æˆç†Ÿçš„åˆ†å¸ƒå¼é”è§£å†³æ–¹æ¡ˆã€‚</p>
<h4 id="çº¢é”èƒ½ä¸èƒ½ä¿è¯ç™¾åˆ†ç™¾ä¸Šé”ï¼Ÿ"><a href="#çº¢é”èƒ½ä¸èƒ½ä¿è¯ç™¾åˆ†ç™¾ä¸Šé”ï¼Ÿ" class="headerlink" title="çº¢é”èƒ½ä¸èƒ½ä¿è¯ç™¾åˆ†ç™¾ä¸Šé”ï¼Ÿ"></a>çº¢é”èƒ½ä¸èƒ½ä¿è¯ç™¾åˆ†ç™¾ä¸Šé”ï¼Ÿ</h4><p>ä¸èƒ½ï¼ŒRedlock æ— æ³•ä¿è¯ç™¾åˆ†ç™¾ä¸Šé”æˆåŠŸï¼Œè¿™æ˜¯ç”±åˆ†å¸ƒå¼ç³»ç»Ÿçš„æœ¬è´¨ç‰¹æ€§å†³å®šçš„ã€‚</p>
<p>å½“æœ‰ç½‘ç»œåˆ†åŒºæ—¶ï¼Œå®¢æˆ·ç«¯å¯èƒ½æ— æ³•ä¸Žè¶³å¤Ÿæ•°é‡çš„ Redis å®žä¾‹é€šä¿¡ã€‚æ¯”å¦‚åœ¨ 5 ä¸ª Redis å®žä¾‹çš„éƒ¨ç½²ä¸­ï¼Œå¦‚æžœç½‘ç»œåˆ†åŒºå¯¼è‡´å®¢æˆ·ç«¯åªèƒ½è®¿é—®åˆ° 2 ä¸ªå®žä¾‹ï¼Œé‚£ä¹ˆæ— è®ºå¦‚ä½•éƒ½æ— æ³•æ»¡è¶³çº¢é”è¦æ±‚çš„å°‘æ•°æœä»Žå¤šæ•°åŽŸåˆ™ï¼ŒèŽ·å–é”çš„æ—¶å€™å¿…ç„¶å¤±è´¥ã€‚</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="type">boolean</span> <span class="title function_">tryLock</span><span class="params">(<span class="type">long</span> waitTime, <span class="type">long</span> leaseTime, TimeUnit unit)</span> <span class="keyword">throws</span> InterruptedException &#123;</span><br><span class="line">    <span class="comment">// ...</span></span><br><span class="line">    <span class="keyword">for</span> (ListIterator&lt;RLock&gt; iterator = locks.listIterator(); iterator.hasNext();) &#123;</span><br><span class="line">        <span class="type">RLock</span> <span class="variable">lock</span> <span class="operator">=</span> iterator.next();</span><br><span class="line">        <span class="type">boolean</span> lockAcquired;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            lockAcquired = lock.tryLock(awaitTime, newLeaseTime, TimeUnit.MILLISECONDS);</span><br><span class="line">        &#125; <span class="keyword">catch</span> (RedisResponseTimeoutException e) &#123;</span><br><span class="line">            lockAcquired = <span class="literal">false</span>; <span class="comment">// ç½‘ç»œè¶…æ—¶å¯¼è‡´å¤±è´¥</span></span><br><span class="line">        &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">            lockAcquired = <span class="literal">false</span>; <span class="comment">// å…¶ä»–å¼‚å¸¸å¯¼è‡´å¤±è´¥</span></span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// å¦‚æžœå‰©ä½™å¯å°è¯•çš„å®žä¾‹æ•°é‡ä¸è¶³ä»¥è¾¾åˆ°å¤šæ•°æ´¾ï¼Œç›´æŽ¥é€€å‡º</span></span><br><span class="line">        <span class="keyword">if</span> (locks.size() - acquiredLocks.size() == failedLocksLimit()) &#123;</span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// æ£€æŸ¥æ˜¯å¦è¾¾åˆ°å¤šæ•°æ´¾è¦æ±‚</span></span><br><span class="line">    <span class="keyword">if</span> (acquiredLocks.size() &gt;= minLocksAmount(locks)) &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        unlockInner(acquiredLocks);</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">false</span>; <span class="comment">// æœªè¾¾åˆ°å¤šæ•°æ´¾ï¼ŒèŽ·å–å¤±è´¥</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>æ—¶é’Ÿæ¼‚ç§»ä¹Ÿä¼šå½±å“æˆåŠŸçŽ‡ã€‚å³ä½¿æ‰€æœ‰å®žä¾‹éƒ½å¯è¾¾ï¼Œå¦‚æžœå„ä¸ª Redis å®žä¾‹ä¹‹é—´å­˜åœ¨æ˜Žæ˜¾çš„æ—¶é’Ÿæ¼‚ç§»ï¼Œæˆ–è€…å®¢æˆ·ç«¯åœ¨èŽ·å–é”çš„è¿‡ç¨‹ä¸­è€—æ—¶è¿‡é•¿ï¼Œæ¯”å¦‚ç½‘ç»œå»¶è¿Ÿã€GC åœé¡¿ç­‰ï¼Œéƒ½å¯èƒ½ä¼šå¯¼è‡´é”åœ¨èŽ·å–å®Œæˆå‰å°±è¿‡æœŸï¼Œä»Žè€ŒèŽ·å–å¤±è´¥ã€‚</p>
<p>åœ¨å®žé™…åº”ç”¨ä¸­ï¼Œå¯ä»¥é€šè¿‡é‡è¯•æœºåˆ¶æ¥æé«˜é”çš„æˆåŠŸçŽ‡ã€‚</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; maxRetries; i++) &#123;</span><br><span class="line">    <span class="keyword">if</span> (redLock.tryLock(waitTime, leaseTime, TimeUnit.MILLISECONDS)) &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    Thread.sleep(retryDelay);</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">return</span> <span class="literal">false</span>;</span><br></pre></td></tr></table></figure>

<h4 id="é¡¹ç›®ä¸­æœ‰ç”¨åˆ°åˆ†å¸ƒå¼é”å—ï¼Ÿ"><a href="#é¡¹ç›®ä¸­æœ‰ç”¨åˆ°åˆ†å¸ƒå¼é”å—ï¼Ÿ" class="headerlink" title="é¡¹ç›®ä¸­æœ‰ç”¨åˆ°åˆ†å¸ƒå¼é”å—ï¼Ÿ"></a>é¡¹ç›®ä¸­æœ‰ç”¨åˆ°åˆ†å¸ƒå¼é”å—ï¼Ÿ</h4><p>åœ¨<a target="_blank" rel="noopener" href="https://javabetter.cn/zhishixingqiu/pmhub.html">PmHub</a>é¡¹ç›®ä¸­ï¼Œæˆ‘æœ‰ä½¿ç”¨ Redission çš„åˆ†å¸ƒå¼é”æ¥ç¡®ä¿æµç¨‹çŠ¶æ€çš„æ›´æ–°æŒ‰é¡ºåºæ‰§è¡Œï¼Œä¸”ä¸è¢«å…¶ä»–æµç¨‹æœåŠ¡å¹²æ‰°ã€‚</p>
<p><img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="https://cdn.jsdelivr.net/gh/JakicDong/blog-assets@main/images/20251023164922.png" alt="20251023164922"><br>PmHubï¼šåˆ†å¸ƒå¼é”ä¿éšœæµç¨‹çŠ¶æ€æ›´æ–°</p>
<h3 id="49-ðŸŒŸRediséƒ½æœ‰å“ªäº›åº•å±‚æ•°æ®ç»“æž„ï¼Ÿ"><a href="#49-ðŸŒŸRediséƒ½æœ‰å“ªäº›åº•å±‚æ•°æ®ç»“æž„ï¼Ÿ" class="headerlink" title="49.ðŸŒŸRediséƒ½æœ‰å“ªäº›åº•å±‚æ•°æ®ç»“æž„ï¼Ÿ"></a>49.ðŸŒŸRediséƒ½æœ‰å“ªäº›åº•å±‚æ•°æ®ç»“æž„ï¼Ÿ</h3><p>Redis ä¹‹æ‰€ä»¥å¿«ï¼Œé™¤äº†åŸºäºŽå†…å­˜è¯»å†™ä¹‹å¤–ï¼Œè¿˜æœ‰å¾ˆé‡è¦çš„ä¸€ç‚¹å°±æ˜¯å®ƒç²¾å¿ƒè®¾è®¡çš„åº•å±‚æ•°æ®ç»“æž„ã€‚Redis æ€»å…±æœ‰ 8 ç§æ ¸å¿ƒçš„åº•å±‚æ•°æ®ç»“æž„ï¼Œæˆ‘æŒ‰ç…§é‡è¦ç¨‹åº¦æ¥è¯´ä¸€ä¸‹ã€‚</p>
<p><img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="https://cdn.jsdelivr.net/gh/JakicDong/blog-assets@main/images/20251023164947.png" alt="20251023164947"><br>ä¸‰åˆ†æ¶é¢æ¸£é€†è¢­ï¼šRedis Objectå¯¹åº”çš„æ˜ å°„</p>
<p>é¦–å…ˆæ˜¯ SDSï¼Œè¿™æ˜¯ Redis è‡ªå·±å®žçŽ°çš„åŠ¨æ€å­—ç¬¦ä¸²ï¼Œå®ƒä¿ç•™äº† C è¯­è¨€åŽŸç”Ÿçš„å­—ç¬¦ä¸²é•¿åº¦ï¼Œæ‰€ä»¥èŽ·å–é•¿åº¦çš„æ—¶é—´å¤æ‚åº¦æ˜¯ <code>O(1)</code>ï¼Œåœ¨æ­¤åŸºç¡€ä¸Šè¿˜æ”¯æŒåŠ¨æ€æ‰©å®¹ï¼Œä»¥åŠå­˜å‚¨äºŒè¿›åˆ¶æ•°æ®ã€‚</p>
<p><img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="https://cdn.jsdelivr.net/gh/JakicDong/blog-assets@main/images/20251023165020.png" alt="20251023165020"><br>ä¸‰åˆ†æ¶é¢æ¸£é€†è¢­ï¼šSDS</p>
<p>ç„¶åŽæ˜¯å­—å…¸ï¼Œæ›´åº•å±‚æ˜¯ç”¨æ•°ç»„+é“¾è¡¨å®žçŽ°çš„å“ˆå¸Œè¡¨ã€‚å®ƒçš„è®¾è®¡å¾ˆå·§å¦™ï¼Œç”¨äº†ä¸¤ä¸ªå“ˆå¸Œè¡¨ï¼Œå¹³æ—¶ç”¨ç¬¬ä¸€ä¸ªï¼Œrehash çš„æ—¶å€™ç”¨ç¬¬äºŒä¸ªï¼Œè¿™æ ·å¯ä»¥æ¸è¿›å¼åœ°è¿›è¡Œæ‰©å®¹ï¼Œä¸ä¼šé˜»å¡žå¤ªä¹…ã€‚</p>
<p><img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="https://cdn.jsdelivr.net/gh/JakicDong/blog-assets@main/images/20251023165052.png" alt="20251023165052"><br>ä¸‰åˆ†æ¶é¢æ¸£é€†è¢­ï¼šå­—å…¸</p>
<p>æŽ¥ä¸‹æ¥åŽ‹ç¼©åˆ—è¡¨ ziplistï¼Œè¿™ä¸ªè®¾è®¡å¾ˆæœ‰æ„æ€ã€‚Redis ä¸ºäº†èŠ‚çœå†…å­˜ï¼Œè®¾è®¡äº†è¿™ç§ç´§å‡‘åž‹çš„æ•°æ®ç»“æž„ï¼ŒæŠŠæ‰€æœ‰å…ƒç´ è¿žç»­å­˜å‚¨åœ¨ä¸€å—å†…å­˜é‡Œã€‚ä½†æ˜¯å®ƒæœ‰ä¸ªè‡´å‘½é—®é¢˜å«â€è¿žé”æ›´æ–°â€ï¼Œå°±æ˜¯å½“æˆ‘ä»¬ä¿®æ”¹ä¸€ä¸ªå…ƒç´ çš„æ—¶å€™ï¼Œå¯èƒ½ä¼šå¯¼è‡´åŽé¢æ‰€æœ‰çš„å…ƒç´ éƒ½è¦é‡æ–°ç¼–ç ï¼Œæ€§èƒ½ä¼šæ€¥å‰§ä¸‹é™ã€‚</p>
<p><img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="https://cdn.jsdelivr.net/gh/JakicDong/blog-assets@main/images/20251023165136.png" alt="20251023165136"><br>Shubhi Jainï¼šZiplist</p>
<p>ä¸ºäº†è§£å†³åŽ‹ç¼©åˆ—è¡¨çš„é—®é¢˜ï¼ŒRedis åŽæ¥è®¾è®¡äº† quicklistã€‚è¿™ä¸ªè®¾è®¡æ€è·¯å¾ˆèªæ˜Žï¼Œå®ƒæŠŠ ziplist æ‹†åˆ†æˆå°å—ï¼Œç„¶åŽç”¨åŒå‘é“¾è¡¨æŠŠè¿™äº›å°å—ä¸²èµ·æ¥ã€‚è¿™æ ·æ—¢ä¿æŒäº† ziplist èŠ‚çœå†…å­˜çš„ä¼˜åŠ¿ï¼Œåˆé¿å…äº†è¿žé”æ›´æ–°çš„é—®é¢˜ï¼Œå› ä¸ºæ¯ä¸ªå°å—çš„ ziplist éƒ½ä¸ä¼šå¤ªå¤§ã€‚</p>
<p><img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="https://cdn.jsdelivr.net/gh/JakicDong/blog-assets@main/images/20251023165213.png" alt="20251023165213"><br>Mr.äºŽåšå®¢å›­ï¼šquicklist</p>
<p>å†åŽæ¥ï¼ŒRedis åˆè®¾è®¡äº† listpackï¼Œè¿™ä¸ªå¯ä»¥è¯´æ˜¯ ziplist çš„å®Œç¾Žæ›¿ä»£å“ã€‚å®ƒæœ€å¤§çš„ç‰¹ç‚¹æ˜¯æ¯ä¸ªå…ƒç´ åªè®°å½•è‡ªå·±çš„é•¿åº¦ï¼Œä¸è®°å½•å‰ä¸€ä¸ªå…ƒç´ çš„é•¿åº¦ï¼Œè¿™æ ·å°±å½»åº•è§£å†³äº†è¿žé”æ›´æ–°çš„é—®é¢˜ã€‚Redis 5.0 å·²ç»ç”¨ listpack æ›¿æ¢äº† ziplistã€‚</p>
<p><img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="https://cdn.jsdelivr.net/gh/JakicDong/blog-assets@main/images/20251023165228.png" alt="20251023165228"><br>baseoncppï¼šlistpack</p>
<p>è·³è¡¨skiplist ä¸»è¦ç”¨åœ¨ ZSet ä¸­ã€‚å®ƒçš„è®¾è®¡å¾ˆå·§å¦™ï¼Œé€šè¿‡å¤šå±‚æŒ‡é’ˆæ¥å®žçŽ°å¿«é€ŸæŸ¥æ‰¾ï¼Œå¹³å‡æ—¶é—´å¤æ‚åº¦æ˜¯ <code>O(log N)</code>ã€‚ç›¸æ¯”çº¢é»‘æ ‘ï¼Œè·³è¡¨çš„å®žçŽ°æ›´ç®€å•ï¼Œè€Œä¸”æ”¯æŒèŒƒå›´æŸ¥è¯¢ï¼Œè¿™å¯¹ Redis çš„æœ‰åºé›†åˆæ¥è¯´å¾ˆé‡è¦ã€‚</p>
<p><img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="https://cdn.jsdelivr.net/gh/JakicDong/blog-assets@main/images/20251023165726.png" alt="20251023165726"><br>ä¸‰åˆ†æ¶é¢æ¸£é€†è¢­ï¼šè·³è¡¨</p>
<p>è¿˜æœ‰æ•´æ•°é›†åˆintsetï¼Œå½“ Set ä¸­éƒ½æ˜¯æ•´æ•°ä¸”å…ƒç´ æ•°é‡è¾ƒå°‘æ—¶ä½¿ç”¨ï¼Œå†…éƒ¨æ˜¯ä¸€ä¸ªæœ‰åºæ•°ç»„ï¼ŒæŸ¥æ‰¾ç”¨çš„äºŒåˆ†æ³•ã€‚</p>
<p><img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="https://cdn.jsdelivr.net/gh/JakicDong/blog-assets@main/images/20251023165813.png" alt="20251023165813"><br>zhangtielei.comï¼šintset</p>
<p>æœ€åŽæ˜¯åŒå‘é“¾è¡¨LinkedListï¼Œæ—©æœŸç‰ˆæœ¬çš„ Redis ä¼šåœ¨ List ä¸­ç”¨åˆ°ï¼Œä½† Redis 3.2 åŽå°±è¢« quicklist æ›¿ä»£äº†ï¼Œå› ä¸ºçº¯é“¾è¡¨çš„é—®é¢˜æ˜¯å†…å­˜ä¸è¿žç»­ï¼Œå½±å“ CPU ç¼“å­˜æ€§èƒ½ã€‚</p>
<p><img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="https://cdn.jsdelivr.net/gh/JakicDong/blog-assets@main/images/20251023165854.png" alt="20251023165854"><br>pdaiï¼šRedis åº•å±‚æ•°æ®ç»“æž„å’Œæ•°æ®ç±»åž‹å…³ç³»</p>
<h4 id="ç®€å•ä»‹ç»ä¸‹é“¾è¡¨ï¼Ÿ"><a href="#ç®€å•ä»‹ç»ä¸‹é“¾è¡¨ï¼Ÿ" class="headerlink" title="ç®€å•ä»‹ç»ä¸‹é“¾è¡¨ï¼Ÿ"></a>ç®€å•ä»‹ç»ä¸‹é“¾è¡¨ï¼Ÿ</h4><p>Redis çš„ linkedlist æ˜¯â¼€ä¸ªåŒå‘â½†çŽ¯é“¾è¡¨ç»“æž„ï¼Œå’Œ Java ä¸­çš„ <a target="_blank" rel="noopener" href="https://javabetter.cn/collection/linkedlist.html">LinkedList</a> ç±»ä¼¼ã€‚</p>
<p>èŠ‚ç‚¹ç”± listNode è¡¨ç¤ºï¼Œæ¯ä¸ªèŠ‚ç‚¹éƒ½æœ‰æŒ‡å‘å…¶å‰ç½®èŠ‚ç‚¹å’ŒåŽç½®èŠ‚ç‚¹çš„æŒ‡é’ˆï¼Œå¤´èŠ‚ç‚¹çš„å‰ç½®å’Œå°¾èŠ‚ç‚¹çš„åŽç½®å‡æŒ‡å‘ nullã€‚</p>
<p><img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="https://cdn.jsdelivr.net/gh/JakicDong/blog-assets@main/images/20251023165930.png" alt="20251023165930"><br>ä¸‰åˆ†æ¶é¢æ¸£é€†è¢­ï¼šé“¾è¡¨linkedlist</p>
<h4 id="å…³äºŽæ•´æ•°é›†åˆï¼Œèƒ½å†è¯¦ç»†è¯´è¯´å—ï¼Ÿ"><a href="#å…³äºŽæ•´æ•°é›†åˆï¼Œèƒ½å†è¯¦ç»†è¯´è¯´å—ï¼Ÿ" class="headerlink" title="å…³äºŽæ•´æ•°é›†åˆï¼Œèƒ½å†è¯¦ç»†è¯´è¯´å—ï¼Ÿ"></a>å…³äºŽæ•´æ•°é›†åˆï¼Œèƒ½å†è¯¦ç»†è¯´è¯´å—ï¼Ÿ</h4><p>æ•´æ•°é›†åˆæ˜¯ Redis ä¸­ä¸€ä¸ªéžå¸¸ç²¾å·§çš„æ•°æ®ç»“æž„ï¼Œå½“ä¸€ä¸ª Set åªåŒ…å«æ•´æ•°å…ƒç´ ï¼Œå¹¶ä¸”æ•°é‡ä¸å¤šæ—¶ï¼Œé»˜è®¤ä¸è¶…è¿‡ 512 ä¸ªï¼ŒRedis å°±ä¼šç”¨ intset æ¥å­˜å‚¨è¿™äº›æ•°æ®ã€‚</p>
<p><img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="https://cdn.jsdelivr.net/gh/JakicDong/blog-assets@main/images/20251023170000.png" alt="20251023170000"><br>ä¸‰åˆ†æ¶é¢æ¸£é€†è¢­ï¼šæ•´æ•°é›†åˆintset</p>
<p>intset æœ€æœ‰æ„æ€çš„åœ°æ–¹æ˜¯ç±»åž‹å‡çº§æœºåˆ¶ã€‚å®ƒæœ‰ä¸‰ç§ç¼–ç æ–¹å¼ï¼š16ä½ã€32ä½å’Œ 64ä½ï¼Œä¼šæ ¹æ®å­˜å‚¨çš„æ•´æ•°å¤§å°åŠ¨æ€è°ƒæ•´ã€‚æ¯”å¦‚åŽŸæ¥å­˜çš„éƒ½æ˜¯å°æ•´æ•°ï¼Œç”¨ 16 ä½ç¼–ç å°±å¤Ÿäº†ï¼Œä½†çªç„¶æ’å…¥äº†ä¸€ä¸ªå¾ˆå¤§çš„æ•°ï¼Œè¶…å‡ºäº† 16 ä½çš„èŒƒå›´ï¼Œè¿™æ—¶æ•´ä¸ªæ•°ç»„ä¼šå‡çº§åˆ° 32 ä½ç¼–ç ã€‚</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">typedef</span> <span class="class"><span class="keyword">struct</span> <span class="title">intset</span> &#123;</span></span><br><span class="line">    <span class="type">uint32_t</span> encoding;   <span class="comment">// ç¼–ç æ–¹å¼ï¼š16ä½ã€32ä½æˆ–64ä½</span></span><br><span class="line">    <span class="type">uint32_t</span> length;     <span class="comment">// å…ƒç´ æ•°é‡</span></span><br><span class="line">    <span class="type">int8_t</span> contents[];   <span class="comment">// ä¿å­˜å…ƒç´ çš„æ•°ç»„</span></span><br><span class="line">&#125; intset;</span><br></pre></td></tr></table></figure>

<p>å½“ç„¶äº†ï¼Œè¿™ç§å‡çº§æ˜¯æœ‰ä»£ä»·çš„ï¼Œå› ä¸ºéœ€è¦é‡æ–°åˆ†é…å†…å­˜å¹¶å¤åˆ¶æ•°æ®ï¼Œå¹¶ä¸”æ˜¯ä¸å¯é€†çš„ï¼Œä½†å®ƒçš„å¥½å¤„æ˜¯å¯ä»¥èŠ‚çœå†…å­˜ç©ºé—´ï¼Œç‰¹åˆ«æ˜¯åœ¨å­˜å‚¨å¤§é‡å°æ•´æ•°æ—¶ã€‚</p>
<p>å¦å¤–ï¼Œæ‰€æœ‰å…ƒç´ åœ¨æ•°ç»„ä¸­æŒ‰ç…§ä»Žå°åˆ°å¤§çš„é¡ºåºæŽ’åˆ—ï¼Œè¿™æ ·å°±å¯ä»¥ä½¿ç”¨äºŒåˆ†æŸ¥æ‰¾æ¥å®šä½å…ƒç´ ï¼Œæ—¶é—´å¤æ‚åº¦ä¸º <code>O(log N)</code>ã€‚</p>
<h4 id="è¯´ä¸€ä¸‹zset-çš„åº•å±‚åŽŸç†ï¼Ÿ"><a href="#è¯´ä¸€ä¸‹zset-çš„åº•å±‚åŽŸç†ï¼Ÿ" class="headerlink" title="è¯´ä¸€ä¸‹zset çš„åº•å±‚åŽŸç†ï¼Ÿ"></a>è¯´ä¸€ä¸‹zset çš„åº•å±‚åŽŸç†ï¼Ÿ</h4><p>ZSet æ˜¯ Redis æœ€å¤æ‚çš„æ•°æ®ç±»åž‹ï¼Œå®ƒæœ‰ä¸¤ç§åº•å±‚å®žçŽ°æ–¹å¼ï¼šåŽ‹ç¼©åˆ—è¡¨å’Œè·³è¡¨ã€‚</p>
<p><img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="https://cdn.jsdelivr.net/gh/JakicDong/blog-assets@main/images/20251023170235.png" alt="20251023170235"><br>0xcafebabeï¼šzset çš„åº•å±‚å®žçŽ°</p>
<p>å½“ä¿å­˜çš„å…ƒç´ æ•°é‡å°‘äºŽ 128 ä¸ªï¼Œä¸”ä¿å­˜çš„æ‰€æœ‰å…ƒç´ å¤§å°éƒ½å°äºŽ 64 å­—èŠ‚æ—¶ï¼ŒRedis ä¼šé‡‡ç”¨åŽ‹ç¼©åˆ—è¡¨çš„ç¼–ç æ–¹å¼ï¼›å¦åˆ™å°±ç”¨è·³è¡¨ã€‚</p>
<p>å½“ç„¶ï¼Œè¿™ä¸¤ä¸ªæ¡ä»¶éƒ½å¯ä»¥é€šè¿‡å‚æ•°è¿›è¡Œè°ƒæ•´ã€‚</p>
<p>é€‰æ‹©åŽ‹ç¼©åˆ—è¡¨ä½œä¸ºåº•å±‚å®žçŽ°æ—¶ï¼Œæ¯ä¸ªå…ƒç´ ä¼šä½¿ç”¨ä¸¤ä¸ªç´§æŒ¨åœ¨ä¸€èµ·çš„èŠ‚ç‚¹æ¥ä¿å­˜ï¼šç¬¬ä¸€ä¸ªèŠ‚ç‚¹ä¿å­˜å…ƒç´ çš„æˆå‘˜ï¼Œç¬¬äºŒä¸ªèŠ‚ç‚¹ä¿å­˜å…ƒç´ çš„åˆ†å€¼ã€‚</p>
<p><img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="https://cdn.jsdelivr.net/gh/JakicDong/blog-assets@main/images/20251023170247.png" alt="20251023170247"><br>0xcafebabeï¼šzset ä½¿ç”¨åŽ‹ç¼©åˆ—è¡¨</p>
<p>æ‰€æœ‰å…ƒç´ æŒ‰åˆ†å€¼ä»Žå°åˆ°å¤§æœ‰åºæŽ’åˆ—ï¼Œå°çš„æ”¾åœ¨é è¿‘è¡¨å¤´çš„ä½ç½®ï¼Œå¤§çš„æ”¾åœ¨é è¿‘è¡¨å°¾çš„ä½ç½®ã€‚</p>
<p>ä½†è·³è¡¨çš„ç¼ºç‚¹æ˜¯æŸ¥æ‰¾åªèƒ½æŒ‰é¡ºåºè¿›è¡Œï¼Œæ—¶é—´å¤æ‚åº¦ä¸º <code>O(N)</code>ï¼Œè€Œä¸”åœ¨æœ€åçš„æƒ…å†µä¸‹ï¼Œæ’å…¥å’Œåˆ é™¤æ“ä½œè¿˜å¯èƒ½ä¼šå¼•èµ·è¿žé”æ›´æ–°ã€‚</p>
<p>å½“å…ƒç´ æ•°é‡è¾ƒå¤šæˆ–å…ƒç´ è¾ƒå¤§æ—¶ï¼ŒRedis ä¼šä½¿ç”¨ skiplist çš„ç¼–ç æ–¹å¼ï¼›è¿™ä¸ªè®¾è®¡éžå¸¸çš„å·§å¦™ï¼ŒåŒæ—¶ä½¿ç”¨äº†ä¸¤ç§æ•°æ®ç»“æž„ï¼š</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">typedef</span> <span class="class"><span class="keyword">struct</span> <span class="title">zset</span> &#123;</span></span><br><span class="line">    zskiplist *zsl;  <span class="comment">// è·³è·ƒè¡¨</span></span><br><span class="line">    dict *dict;      <span class="comment">// å­—å…¸</span></span><br><span class="line">&#125; zset;</span><br></pre></td></tr></table></figure>

<p>è·³è¡¨æŒ‰åˆ†æ•°æœ‰åºä¿å­˜æ‰€æœ‰å…ƒç´ ï¼Œä¸”æ”¯æŒèŒƒå›´æŸ¥è¯¢ï¼ˆå¦‚ <code>ZRANGE</code>ã€<code>ZRANGEBYSCORE</code>ï¼‰ï¼Œå¹³å‡æ—¶é—´å¤æ‚åº¦ä¸º <code>O(log N)</code>ã€‚è€Œå“ˆå¸Œè¡¨åˆ™ç”¨æ¥å­˜å‚¨æˆå‘˜å’Œåˆ†å€¼çš„æ˜ å°„å…³ç³»ï¼ŒæŸ¥æ‰¾æ—¶é—´å¤æ‚åº¦ä¸º <code>O(1)</code>ã€‚</p>
<p><img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="https://cdn.jsdelivr.net/gh/JakicDong/blog-assets@main/images/20251023170359.png" alt="20251023170359"><br>0xcafebabeï¼šzset ä½¿ç”¨è·³è¡¨</p>
<p>è™½ç„¶åŒæ—¶ä½¿ç”¨ä¸¤ç§ç»“æž„ï¼Œä½†å®ƒä»¬ä¼šé€šè¿‡æŒ‡é’ˆæ¥å…±äº«ç›¸åŒå…ƒç´ çš„æˆå‘˜å’Œåˆ†å€¼ï¼Œå› æ­¤ä¸ä¼šæµªè´¹é¢å¤–çš„å†…å­˜ã€‚</p>
<h4 id="ä½ çŸ¥é“ä¸ºä»€ä¹ˆRedis-7-0è¦ç”¨listpackæ¥æ›¿ä»£ziplistå—ï¼Ÿ"><a href="#ä½ çŸ¥é“ä¸ºä»€ä¹ˆRedis-7-0è¦ç”¨listpackæ¥æ›¿ä»£ziplistå—ï¼Ÿ" class="headerlink" title="ä½ çŸ¥é“ä¸ºä»€ä¹ˆRedis 7.0è¦ç”¨listpackæ¥æ›¿ä»£ziplistå—ï¼Ÿ"></a>ä½ çŸ¥é“ä¸ºä»€ä¹ˆRedis 7.0è¦ç”¨listpackæ¥æ›¿ä»£ziplistå—ï¼Ÿ</h4><p>ç­”ï¼šä¸»è¦æ˜¯ä¸ºäº†è§£å†³åŽ‹ç¼©åˆ—è¡¨çš„ä¸€ä¸ªæ ¸å¿ƒé—®é¢˜â€”â€”è¿žé”æ›´æ–°ã€‚åœ¨åŽ‹ç¼©åˆ—è¡¨ä¸­ï¼Œæ¯ä¸ªèŠ‚ç‚¹éƒ½éœ€è¦è®°å½•å‰ä¸€ä¸ªèŠ‚ç‚¹çš„é•¿åº¦ä¿¡æ¯ã€‚</p>
<p><img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="https://cdn.jsdelivr.net/gh/JakicDong/blog-assets@main/images/20251023170416.png" alt="20251023170416"><br>wenfh2020.comï¼šredis ziplist</p>
<p>å½“æ’å…¥æˆ–åˆ é™¤ä¸€ä¸ªèŠ‚ç‚¹æ—¶ï¼Œå¦‚æžœè¿™ä¸ªæ“ä½œå¯¼è‡´æŸä¸ªèŠ‚ç‚¹çš„é•¿åº¦å‘ç”Ÿäº†å˜åŒ–ï¼Œé‚£ä¹ˆåŽç»­çš„èŠ‚ç‚¹å¯èƒ½éƒ½éœ€è¦æ›´æ–°å®ƒä»¬å­˜å‚¨çš„â€å‰ä¸€ä¸ªèŠ‚ç‚¹é•¿åº¦â€å­—æ®µã€‚æœ€åçš„æƒ…å†µä¸‹ï¼Œä¸€æ¬¡æ“ä½œå¯èƒ½è§¦å‘æ•´ä¸ªé“¾è¡¨çš„æ›´æ–°ï¼Œæ—¶é—´å¤æ‚åº¦ä¼šä»Ž <code>O(1)</code>é€€åŒ–åˆ° <code>O(nÂ²)</code>ã€‚</p>
<p>è€Œ listpack çš„è®¾è®¡ç†å¿µå®Œå…¨ä¸åŒã€‚å®ƒè®©æ¯ä¸ªèŠ‚ç‚¹åªè®°å½•è‡ªå·±çš„é•¿åº¦ä¿¡æ¯ï¼Œä¸å†ä¾èµ–å‰ä¸€ä¸ªèŠ‚ç‚¹çš„é•¿åº¦ã€‚è¿™æ ·å°±ä»Žæ ¹æœ¬ä¸Šé¿å…äº†è¿žé”æ›´æ–°çš„é—®é¢˜ã€‚</p>
<p><img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="https://cdn.jsdelivr.net/gh/JakicDong/blog-assets@main/images/20251023170521.png" alt="20251023170521"><br>æžå®¢æ—¶é—´ï¼šlistpack</p>
<p>listpack ä¸­çš„èŠ‚ç‚¹ä¸å†ä¿å­˜å…¶å‰ä¸€ä¸ªèŠ‚ç‚¹çš„é•¿åº¦ï¼Œè€Œæ˜¯ä¿å­˜å½“å‰èŠ‚ç‚¹çš„ç¼–ç ç±»åž‹ã€æ•°æ®å’Œé•¿åº¦ã€‚</p>
<p><img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="https://cdn.jsdelivr.net/gh/JakicDong/blog-assets@main/images/20251023170535.png" alt="20251023170535"><br>æžå®¢æ—¶é—´ï¼šlistpack çš„å…ƒç´ </p>
<h4 id="è¿žé”æ›´æ–°æ˜¯æ€Žä¹ˆå‘ç”Ÿçš„ï¼Ÿ"><a href="#è¿žé”æ›´æ–°æ˜¯æ€Žä¹ˆå‘ç”Ÿçš„ï¼Ÿ" class="headerlink" title="è¿žé”æ›´æ–°æ˜¯æ€Žä¹ˆå‘ç”Ÿçš„ï¼Ÿ"></a>è¿žé”æ›´æ–°æ˜¯æ€Žä¹ˆå‘ç”Ÿçš„ï¼Ÿ</h4><p>æ¯”å¦‚è¯´æˆ‘ä»¬æœ‰ä¸€ä¸ªåŽ‹ç¼©åˆ—è¡¨ï¼Œå…¶ä¸­æœ‰å‡ ä¸ªèŠ‚ç‚¹çš„é•¿åº¦éƒ½æ˜¯ 253 ä¸ªå­—èŠ‚ã€‚åœ¨ ziplist çš„ç¼–ç ä¸­ï¼Œå¦‚æžœå‰ä¸€ä¸ªèŠ‚ç‚¹çš„é•¿åº¦å°äºŽ 254 å­—èŠ‚ï¼Œæˆ‘ä»¬åªéœ€è¦ 1 ä¸ªå­—èŠ‚æ¥å­˜å‚¨è¿™ä¸ªé•¿åº¦ä¿¡æ¯ã€‚</p>
<p><img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="https://cdn.tobebetterjavaer.com/stutymore/redis-20250607100252.png" alt="Hello Jellyï¼šè¿žé”æ›´æ–°"></p>
<p>Hello Jellyï¼šè¿žé”æ›´æ–°</p>
<p>ä½†å¦‚æžœåœ¨è¿™äº›èŠ‚ç‚¹å‰é¢æ’å…¥ä¸€ä¸ªé•¿åº¦ä¸º 254 å­—èŠ‚çš„èŠ‚ç‚¹ï¼Œé‚£ä¹ˆåŽŸæ¥åªéœ€è¦ 1 ä¸ªå­—èŠ‚å­˜å‚¨é•¿åº¦çš„èŠ‚ç‚¹çŽ°åœ¨éœ€è¦ 5 ä¸ªå­—èŠ‚æ¥å­˜å‚¨é•¿åº¦ä¿¡æ¯ã€‚è¿™å°±ä¼šå¯¼è‡´åŽç»­æ‰€æœ‰èŠ‚ç‚¹çš„é•¿åº¦ä¿¡æ¯éƒ½éœ€è¦æ›´æ–°ã€‚</p>
<blockquote>
<ol>
<li><a target="_blank" rel="noopener" href="https://javabetter.cn/zhishixingqiu/mianshi.html">Java é¢è¯•æŒ‡å—ï¼ˆä»˜è´¹ï¼‰</a>æ”¶å½•çš„å­—èŠ‚è·³åŠ¨å•†ä¸šåŒ–ä¸€é¢çš„åŽŸé¢˜ï¼šè¯´è¯´ Redis çš„ zsetï¼Œä»€ä¹ˆæ˜¯è·³è¡¨ï¼Œæ’å…¥ä¸€ä¸ªèŠ‚ç‚¹è¦æž„å»ºå‡ å±‚ç´¢å¼•</li>
<li><a target="_blank" rel="noopener" href="https://javabetter.cn/zhishixingqiu/mianshi.html">Java é¢è¯•æŒ‡å—ï¼ˆä»˜è´¹ï¼‰</a>æ”¶å½•çš„å­—èŠ‚è·³åŠ¨é¢ç»åŒå­¦ 9 é£žä¹¦åŽç«¯æŠ€æœ¯ä¸€é¢é¢è¯•åŽŸé¢˜ï¼šRedis çš„æ•°æ®ç±»åž‹ï¼ŒZSet çš„å®žçŽ°</li>
<li><a target="_blank" rel="noopener" href="https://javabetter.cn/zhishixingqiu/mianshi.html">Java é¢è¯•æŒ‡å—ï¼ˆä»˜è´¹ï¼‰</a>æ”¶å½•çš„å°ç±³æš‘æœŸå®žä¹ åŒå­¦ E ä¸€é¢é¢è¯•åŽŸé¢˜ï¼šä½ çŸ¥é“ Redis çš„ zset åº•å±‚å®žçŽ°å—</li>
<li><a target="_blank" rel="noopener" href="https://javabetter.cn/zhishixingqiu/mianshi.html">Java é¢è¯•æŒ‡å—ï¼ˆä»˜è´¹ï¼‰</a>æ”¶å½•çš„è…¾è®¯é¢ç»åŒå­¦ 23 QQ åŽå°æŠ€æœ¯ä¸€é¢é¢è¯•åŽŸé¢˜ï¼šzset çš„åº•å±‚åŽŸç†</li>
<li><a target="_blank" rel="noopener" href="https://javabetter.cn/zhishixingqiu/mianshi.html">Java é¢è¯•æŒ‡å—ï¼ˆä»˜è´¹ï¼‰</a>æ”¶å½•çš„å¿«æ‰‹é¢ç»åŒå­¦ 7 Java åŽç«¯æŠ€æœ¯ä¸€é¢é¢è¯•åŽŸé¢˜ï¼šè¯´ä¸€ä¸‹ ZSet åº•å±‚ç»“æž„</li>
<li><a target="_blank" rel="noopener" href="https://javabetter.cn/zhishixingqiu/mianshi.html">Java é¢è¯•æŒ‡å—ï¼ˆä»˜è´¹ï¼‰</a>æ”¶å½•çš„ç¾Žå›¢åŒå­¦ 9 ä¸€é¢é¢è¯•åŽŸé¢˜ï¼šredisçš„æ•°æ®ç»“æž„åº•å±‚åŽŸç†ï¼Ÿ</li>
<li><a target="_blank" rel="noopener" href="https://javabetter.cn/zhishixingqiu/mianshi.html">Java é¢è¯•æŒ‡å—ï¼ˆä»˜è´¹ï¼‰</a>æ”¶å½•çš„è…¾è®¯é¢ç»åŒå­¦ 27 äº‘åŽå°æŠ€æœ¯ä¸€é¢é¢è¯•åŽŸé¢˜ï¼šZsetçš„åº•å±‚å®žçŽ°ï¼Ÿ</li>
<li><a target="_blank" rel="noopener" href="https://javabetter.cn/zhishixingqiu/mianshi.html">Java é¢è¯•æŒ‡å—ï¼ˆä»˜è´¹ï¼‰</a>æ”¶å½•çš„å¾—ç‰©é¢ç»åŒå­¦ 9 é¢è¯•é¢˜ç›®åŽŸé¢˜ï¼šZsetçš„åº•å±‚å¦‚ä½•å®žçŽ°ï¼Ÿ</li>
</ol>
</blockquote>
<h3 id="52-ðŸŒŸä½ äº†è§£è·³è¡¨å—ï¼Ÿ"><a href="#52-ðŸŒŸä½ äº†è§£è·³è¡¨å—ï¼Ÿ" class="headerlink" title="52.ðŸŒŸä½ äº†è§£è·³è¡¨å—ï¼Ÿ"></a>52.ðŸŒŸä½ äº†è§£è·³è¡¨å—ï¼Ÿ</h3><p>è·³è¡¨æ˜¯ä¸€ç§éžå¸¸å·§å¦™çš„æ•°æ®ç»“æž„ï¼Œå®ƒåœ¨æœ‰åºé“¾è¡¨çš„åŸºç¡€ä¸Šå»ºç«‹äº†å¤šå±‚ç´¢å¼•ï¼Œæœ€åº•å±‚åŒ…å«æ‰€æœ‰æ•°æ®ï¼Œæ¯å¾€ä¸Šä¸€å±‚ï¼ŒèŠ‚ç‚¹æ•°é‡å°±å‡å°‘ä¸€åŠã€‚</p>
<p><img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="https://cdn.jsdelivr.net/gh/JakicDong/blog-assets@main/images/20251024094421.png" alt="20251024094421"><br>metahub followerï¼šskiplist</p>
<p>å®ƒçš„æ ¸å¿ƒæ€æƒ³æ˜¯â€ç”¨ç©ºé—´æ¢æ—¶é—´â€ï¼Œé€šè¿‡å¤šå±‚ç´¢å¼•æ¥è·³è¿‡å¤§é‡èŠ‚ç‚¹ï¼Œä»Žè€Œæé«˜æŸ¥æ‰¾æ•ˆçŽ‡ã€‚</p>
<p><img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="https://cdn.jsdelivr.net/gh/JakicDong/blog-assets@main/images/20251024094451.png" alt="20251024094451"><br>ä¸‰åˆ†æ¶é¢æ¸£é€†è¢­ï¼šè·³è¡¨</p>
<p>æ¯ä¸ªèŠ‚ç‚¹æœ‰ 50% çš„æ¦‚çŽ‡åªåœ¨ç¬¬ 1 å±‚å‡ºçŽ°ï¼Œ25% çš„æ¦‚çŽ‡åœ¨ç¬¬ 2 å±‚å‡ºçŽ°ï¼Œä¾æ­¤ç±»æŽ¨ã€‚æŸ¥æ‰¾çš„æ—¶å€™ä»Žæœ€é«˜å±‚å¼€å§‹æ°´å¹³ç§»åŠ¨ï¼Œå½“ä¸‹ä¸€ä¸ªèŠ‚ç‚¹å€¼å¤§äºŽç›®æ ‡æ—¶ï¼Œå°±å‘ä¸‹è·³ä¸€å±‚ï¼Œç›´åˆ°æ‰¾åˆ°ç›®æ ‡èŠ‚ç‚¹ã€‚</p>
<p><img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="https://cdn.jsdelivr.net/gh/JakicDong/blog-assets@main/images/20251024094551.png" alt="20251024094551"><br>Dylan Wangï¼šSkiplist</p>
<h4 id="æ€Žä¹ˆå¾€è·³è¡¨æ’å…¥èŠ‚ç‚¹å‘¢ï¼Ÿ"><a href="#æ€Žä¹ˆå¾€è·³è¡¨æ’å…¥èŠ‚ç‚¹å‘¢ï¼Ÿ" class="headerlink" title="æ€Žä¹ˆå¾€è·³è¡¨æ’å…¥èŠ‚ç‚¹å‘¢ï¼Ÿ"></a>æ€Žä¹ˆå¾€è·³è¡¨æ’å…¥èŠ‚ç‚¹å‘¢ï¼Ÿ</h4><p>é¦–å…ˆæ˜¯æ‰¾åˆ°æ’å…¥ä½ç½®ï¼Œä»Žæœ€é«˜å±‚çš„å¤´èŠ‚ç‚¹å¼€å§‹ï¼Œåœ¨æ¯ä¸€å±‚éƒ½æ‰¾åˆ°åº”è¯¥æ’å…¥ä½ç½®çš„å‰é©±èŠ‚ç‚¹ï¼Œç”¨ä¸€ä¸ª update æ•°ç»„æŠŠè¿™äº›å‰é©±èŠ‚ç‚¹è®°å½•ä¸‹æ¥ã€‚è¿™ä¸ªæŸ¥æ‰¾è¿‡ç¨‹å’Œæ™®é€šæŸ¥æ‰¾ä¸€æ ·ï¼Œåœ¨æ¯å±‚å‘å³ç§»åŠ¨ç›´åˆ°ä¸‹ä¸ªèŠ‚ç‚¹çš„å€¼å¤§äºŽè¦æ’å…¥çš„å€¼ï¼Œç„¶åŽä¸‹é™åˆ°ä¸‹ä¸€å±‚ã€‚</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// è®°å½•æ¯å±‚çš„æ’å…¥ä½ç½®</span></span><br><span class="line">zskiplistNode *update[ZSKIPLIST_MAXLEVEL];</span><br><span class="line">zskiplistNode *x;</span><br><span class="line"><span class="type">int</span> i, level;</span><br><span class="line"></span><br><span class="line"><span class="comment">// ä»Žæœ€é«˜å±‚å¼€å§‹æŸ¥æ‰¾</span></span><br><span class="line">x = zsl-&gt;header;</span><br><span class="line"><span class="keyword">for</span> (i = zsl-&gt;level<span class="number">-1</span>; i &gt;= <span class="number">0</span>; i--) &#123;</span><br><span class="line">    <span class="comment">// åœ¨å½“å‰å±‚æ°´å¹³ç§»åŠ¨ï¼Œæ‰¾åˆ°æ’å…¥ä½ç½®</span></span><br><span class="line">    <span class="keyword">while</span> (x-&gt;level[i].forward &amp;&amp;</span><br><span class="line">           (x-&gt;level[i].forward-&gt;score &lt; score ||</span><br><span class="line">            (x-&gt;level[i].forward-&gt;score == score &amp;&amp;</span><br><span class="line">             sdscmp(x-&gt;level[i].forward-&gt;ele, ele) &lt; <span class="number">0</span>)))</span><br><span class="line">    &#123;</span><br><span class="line">        x = x-&gt;level[i].forward;</span><br><span class="line">    &#125;</span><br><span class="line">    update[i] = x;  <span class="comment">// è®°å½•æ¯å±‚çš„å‰é©±èŠ‚ç‚¹</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>æŽ¥ä¸‹æ¥éšæœºç”Ÿæˆæ–°èŠ‚ç‚¹çš„å±‚æ•°ã€‚é€šå¸¸ç”¨ä¸€ä¸ªå¾ªçŽ¯ï¼Œæ¯æ¬¡æœ‰ 50% çš„æ¦‚çŽ‡ç»§ç»­å¾€ä¸Šï¼Œç›´åˆ°éšæœºå¤±è´¥æˆ–è¾¾åˆ°æœ€å¤§å±‚æ•°é™åˆ¶ã€‚</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Redis ä¸­çš„éšæœºå±‚æ•°ç”Ÿæˆ</span></span><br><span class="line"><span class="type">int</span> <span class="title function_">zslRandomLevel</span><span class="params">(<span class="type">void</span>)</span> &#123;</span><br><span class="line">    <span class="type">int</span> level = <span class="number">1</span>;</span><br><span class="line">    <span class="keyword">while</span> ((random()&amp;<span class="number">0xFFFF</span>) &lt; (ZSKIPLIST_P * <span class="number">0xFFFF</span>))</span><br><span class="line">        level += <span class="number">1</span>;</span><br><span class="line">    <span class="keyword">return</span> (level &lt; ZSKIPLIST_MAXLEVEL) ? level : ZSKIPLIST_MAXLEVEL;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// ç”Ÿæˆæ–°èŠ‚ç‚¹çš„å±‚æ•°</span></span><br><span class="line">level = zslRandomLevel();</span><br></pre></td></tr></table></figure>

<p>åˆ›å»ºæ–°èŠ‚ç‚¹åŽï¼Œä»Žåº•å±‚å¼€å§‹åˆ°æ–°èŠ‚ç‚¹çš„æœ€é«˜å±‚ï¼Œåœ¨æ¯ä¸€å±‚éƒ½è¿›è¡Œæ ‡å‡†çš„é“¾è¡¨æ’å…¥æ“ä½œã€‚è¿™ä¸€æ­¥è¦åˆ©ç”¨ä¹‹å‰è®°å½•çš„ update æ•°ç»„ï¼Œå°†æ–°èŠ‚ç‚¹æ’å…¥åˆ°æ­£ç¡®ä½ç½®ï¼Œç„¶åŽæ›´æ–°å‰åŽæŒ‡é’ˆçš„è¿žæŽ¥å…³ç³»ã€‚</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// æ›´æ–°å‰è¿›æŒ‡é’ˆ</span></span><br><span class="line"><span class="keyword">for</span> (i = <span class="number">0</span>; i &lt; level; i++) &#123;</span><br><span class="line">    x-&gt;level[i].forward = update[i]-&gt;level[i].forward;</span><br><span class="line">    update[i]-&gt;level[i].forward = x;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// æ›´æ–°è·¨åº¦ä¿¡æ¯</span></span><br><span class="line">    x-&gt;level[i].span = update[i]-&gt;level[i].span - (rank[<span class="number">0</span>] - rank[i]);</span><br><span class="line">    update[i]-&gt;level[i].span = (rank[<span class="number">0</span>] - rank[i]) + <span class="number">1</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// æ›´æ–°æœªæ¶‰åŠå±‚çš„è·¨åº¦</span></span><br><span class="line"><span class="keyword">for</span> (i = level; i &lt; zsl-&gt;level; i++) &#123;</span><br><span class="line">    update[i]-&gt;level[i].span++;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// æ›´æ–°åŽé€€æŒ‡é’ˆ</span></span><br><span class="line">x-&gt;backward = (update[<span class="number">0</span>] == zsl-&gt;header) ? <span class="literal">NULL</span> : update[<span class="number">0</span>];</span><br><span class="line"><span class="keyword">if</span> (x-&gt;level[<span class="number">0</span>].forward)</span><br><span class="line">    x-&gt;level[<span class="number">0</span>].forward-&gt;backward = x;</span><br><span class="line"><span class="keyword">else</span></span><br><span class="line">    zsl-&gt;tail = x;</span><br><span class="line"></span><br><span class="line"><span class="comment">// æ›´æ–°è·³è¡¨é•¿åº¦</span></span><br><span class="line">zsl-&gt;length++;</span><br></pre></td></tr></table></figure>

<p>æˆ‘ä»¬æ¥æ¨¡æ‹Ÿä¸€ä¸ªè·³è¡¨çš„æ’å…¥è¿‡ç¨‹ï¼Œå‡è®¾æ’å…¥çš„æ•°æ®ä¾æ¬¡æ˜¯ 22ã€19ã€7ã€3ã€37ã€11ã€26ã€‚</p>
<p><img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="https://cdn.jsdelivr.net/gh/JakicDong/blog-assets@main/images/20251024095121.png" alt="20251024095121"><br>zhangtielei.comï¼šè·³è¡¨æ’å…¥è¿‡ç¨‹</p>
<p>é‚£å‡å¦‚æˆ‘ä»¬åœ¨ä¸€ä¸ªå·²ç»åˆ†å¸ƒäº† 1ã€14ã€27ã€31ã€44ã€56ã€63ã€70ã€80ã€91 çš„è·³è¡¨ä¸­æ’å…¥ä¸€ä¸ª 67 çš„èŠ‚ç‚¹ï¼Œæ’å…¥è¿‡ç¨‹æ˜¯è¿™æ ·çš„ï¼š</p>
<p><img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="https://cdn.jsdelivr.net/gh/JakicDong/blog-assets@main/images/20251024095130.png" alt="20251024095130"><br>Dylan Wangï¼šæ’å…¥èŠ‚ç‚¹</p>
<h4 id="zsetä¸ºä»€ä¹ˆè¦ä½¿ç”¨è·³è¡¨å‘¢ï¼Ÿ"><a href="#zsetä¸ºä»€ä¹ˆè¦ä½¿ç”¨è·³è¡¨å‘¢ï¼Ÿ" class="headerlink" title="zsetä¸ºä»€ä¹ˆè¦ä½¿ç”¨è·³è¡¨å‘¢ï¼Ÿ"></a>zsetä¸ºä»€ä¹ˆè¦ä½¿ç”¨è·³è¡¨å‘¢ï¼Ÿ</h4><p>ç¬¬ä¸€ï¼Œè·³è¡¨å¤©ç„¶å°±æ˜¯æœ‰åºçš„æ•°æ®ç»“æž„ï¼ŒæŸ¥æ‰¾ã€æ’å…¥å’Œåˆ é™¤éƒ½èƒ½ä¿æŒ <code>O(log n)</code> çš„æ—¶é—´å¤æ‚åº¦ã€‚</p>
<p>ç¬¬äºŒï¼Œè·³è¡¨æ”¯æŒèŒƒå›´æŸ¥è¯¢ï¼Œæ‰¾åˆ°èµ·å§‹ä½ç½®åŽå¯ä»¥ç›´æŽ¥æ²¿ç€åº•å±‚é“¾è¡¨é¡ºåºéåŽ†ï¼Œæ»¡è¶³ ZRANGE æŒ‰æŽ’åèŽ·å–å…ƒç´ ï¼Œæˆ–è€… ZRANGEBYSCORE æŒ‰åˆ†å€¼èŒƒå›´èŽ·å–å…ƒç´ ã€‚</p>
<h4 id="è·³è¡¨æ˜¯å¦‚ä½•å®šä¹‰çš„å‘¢ï¼Ÿ"><a href="#è·³è¡¨æ˜¯å¦‚ä½•å®šä¹‰çš„å‘¢ï¼Ÿ" class="headerlink" title="è·³è¡¨æ˜¯å¦‚ä½•å®šä¹‰çš„å‘¢ï¼Ÿ"></a>è·³è¡¨æ˜¯å¦‚ä½•å®šä¹‰çš„å‘¢ï¼Ÿ</h4><p>è·³è¡¨æœ¬è´¨ä¸Šæ˜¯ä¸€ä¸ªå¤šå±‚é“¾è¡¨ï¼Œåº•å±‚æ˜¯ä¸€ä¸ªåŒ…å«æ‰€æœ‰å…ƒç´ çš„æœ‰åºé“¾è¡¨ï¼Œä¸Šä¸€å±‚ä½œä¸ºç´¢å¼•å±‚ï¼ŒåŒ…å«äº†ä¸‹ä¸€å±‚çš„éƒ¨åˆ†èŠ‚ç‚¹ï¼›å±‚æ•°é€šè¿‡éšæœºç®—æ³•ç¡®å®šï¼Œç†è®ºä¸Šå¯ä»¥æ— é™é«˜ã€‚</p>
<p><img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="https://cdn.jsdelivr.net/gh/JakicDong/blog-assets@main/images/20251024095312.png" alt="20251024095312"><br>metahub followerï¼šè·³è¡¨</p>
<p>è·³è¡¨èŠ‚ç‚¹åŒ…å«åˆ†å€¼ scoreã€æˆå‘˜å¯¹è±¡ objã€ä¸€ä¸ªåŽé€€æŒ‡é’ˆ backwardï¼Œä»¥åŠä¸€ä¸ªå±‚çº§æ•°ç»„ levelã€‚æ¯ä¸ªå±‚çº§åŒ…å« forward å‰è¿›æŒ‡é’ˆå’Œ span è·¨åº¦ä¿¡æ¯ã€‚</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">typedef</span> <span class="class"><span class="keyword">struct</span> <span class="title">skiplistNode</span> &#123;</span></span><br><span class="line">    <span class="type">double</span> score;                    <span class="comment">// åˆ†å€¼ï¼ˆç”¨äºŽæŽ’åºï¼‰</span></span><br><span class="line">    robj *obj;                      <span class="comment">// æ•°æ®å¯¹è±¡</span></span><br><span class="line">    <span class="class"><span class="keyword">struct</span> <span class="title">skiplistNode</span> *<span class="title">backward</span>;</span>   <span class="comment">// åŽé€€æŒ‡é’ˆ</span></span><br><span class="line">    <span class="class"><span class="keyword">struct</span> <span class="title">skiplistLevel</span> &#123;</span></span><br><span class="line">        <span class="class"><span class="keyword">struct</span> <span class="title">skiplistNode</span> *<span class="title">forward</span>;</span> <span class="comment">// å‰è¿›æŒ‡é’ˆ</span></span><br><span class="line">        <span class="type">unsigned</span> <span class="type">int</span> span;           <span class="comment">// è·¨åº¦ï¼ˆåˆ°ä¸‹ä¸ªèŠ‚ç‚¹çš„è·ç¦»ï¼‰</span></span><br><span class="line">    &#125; level[];                      <span class="comment">// å±‚çº§æ•°ç»„</span></span><br><span class="line">&#125; skiplistNode;</span><br></pre></td></tr></table></figure>

<p>è·³è¡¨æœ¬èº«åŒ…å«å¤´å°¾èŠ‚ç‚¹æŒ‡é’ˆã€èŠ‚ç‚¹æ€»æ•° length å’Œå½“å‰æœ€å¤§å±‚æ•° levelã€‚</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">typedef</span> <span class="class"><span class="keyword">struct</span> <span class="title">skiplist</span> &#123;</span></span><br><span class="line">    <span class="class"><span class="keyword">struct</span> <span class="title">skiplistNode</span> *<span class="title">header</span>, *<span class="title">tail</span>;</span> <span class="comment">// å¤´å°¾èŠ‚ç‚¹</span></span><br><span class="line">    <span class="type">unsigned</span> <span class="type">long</span> length;               <span class="comment">// èŠ‚ç‚¹æ•°é‡</span></span><br><span class="line">    <span class="type">int</span> level;                         <span class="comment">// æœ€å¤§å±‚æ•°</span></span><br><span class="line">&#125; skiplist;</span><br></pre></td></tr></table></figure>

<h4 id="span-è·¨åº¦æœ‰ä»€ä¹ˆç”¨ï¼Ÿ"><a href="#span-è·¨åº¦æœ‰ä»€ä¹ˆç”¨ï¼Ÿ" class="headerlink" title="span è·¨åº¦æœ‰ä»€ä¹ˆç”¨ï¼Ÿ"></a>span è·¨åº¦æœ‰ä»€ä¹ˆç”¨ï¼Ÿ</h4><p>span è®°å½•äº†å½“å‰èŠ‚ç‚¹åˆ°ä¸‹ä¸€èŠ‚ç‚¹ä¹‹é—´ï¼Œåº•å±‚åˆ°åº•è·¨è¶Šäº†å‡ ä¸ªèŠ‚ç‚¹ï¼Œå®ƒçš„ä¸»è¦ä½œç”¨æ˜¯å¿«é€Ÿæ‰¾åˆ° ZSet ä¸­æŸä¸ªåˆ†å€¼çš„æŽ’åã€‚</p>
<p><img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="https://cdn.jsdelivr.net/gh/JakicDong/blog-assets@main/images/20251024100031.png" alt="20251024100031"><br>Aparajita Pandeyï¼šspan</p>
<p>æ¯”å¦‚è¯´æˆ‘ä»¬æ‰§è¡Œ <code>ZRANK</code> å‘½ä»¤æ—¶ï¼Œå¦‚æžœæ²¡æœ‰ spanï¼Œå°±éœ€è¦ä»Žå¤´èŠ‚ç‚¹å¼€å§‹éåŽ†æ¯ä¸ªèŠ‚ç‚¹ï¼Œç›´åˆ°æ‰¾åˆ°ç›®æ ‡åˆ†å€¼ï¼Œè¿™æ ·æ—¶é—´å¤æ‚åº¦æ˜¯ <code>O(n)</code>ã€‚</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// æ²¡æœ‰spançš„æŽ’åæŸ¥è¯¢ - O(n)</span></span><br><span class="line"><span class="type">int</span> <span class="title function_">getRankWithoutSpan</span><span class="params">(skiplist *zsl, <span class="type">double</span> score, robj *obj)</span> &#123;</span><br><span class="line">    skiplistNode *x = zsl-&gt;header-&gt;level[<span class="number">0</span>].forward;</span><br><span class="line">    <span class="type">int</span> rank = <span class="number">0</span>;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">while</span> (x) &#123;</span><br><span class="line">        <span class="keyword">if</span> (x-&gt;score == score &amp;&amp; equalStringObjects(x-&gt;obj, obj)) &#123;</span><br><span class="line">            <span class="keyword">return</span> rank + <span class="number">1</span>;  <span class="comment">// æŽ’åä»Ž1å¼€å§‹</span></span><br><span class="line">        &#125;</span><br><span class="line">        rank++;</span><br><span class="line">        x = x-&gt;level[<span class="number">0</span>].forward;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>ä½†æœ‰äº† spanï¼Œæˆ‘ä»¬åœ¨ä»Žé«˜å±‚å¾€ä½Žå±‚æœç´¢çš„æ—¶å€™ï¼Œå¯ä»¥ç›´æŽ¥è·³è¿‡ä¸€äº›èŠ‚ç‚¹ï¼Œå¿«é€Ÿå®šä½åˆ°ç›®æ ‡åˆ†å€¼æ‰€åœ¨çš„èŒƒå›´ã€‚è¿™æ ·å°±èƒ½æŠŠæ—¶é—´å¤æ‚åº¦é™åˆ° <code>O(log n)</code>ã€‚</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">long</span> <span class="title function_">skiplistGetRank</span><span class="params">(skiplist *zsl, <span class="type">double</span> score, robj *obj)</span> &#123;</span><br><span class="line">    skiplistNode *x = zsl-&gt;header;</span><br><span class="line">    <span class="type">unsigned</span> <span class="type">long</span> rank = <span class="number">0</span>;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// ä»Žæœ€é«˜å±‚å¼€å§‹æŸ¥æ‰¾</span></span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = zsl-&gt;level - <span class="number">1</span>; i &gt;= <span class="number">0</span>; i--) &#123;</span><br><span class="line">        <span class="keyword">while</span> (x-&gt;level[i].forward &amp;&amp;</span><br><span class="line">               (x-&gt;level[i].forward-&gt;score &lt; score ||</span><br><span class="line">                (x-&gt;level[i].forward-&gt;score == score &amp;&amp;</span><br><span class="line">                 compareStringObjects(x-&gt;level[i].forward-&gt;obj, obj) &lt; <span class="number">0</span>))) &#123;</span><br><span class="line">            </span><br><span class="line">            rank += x-&gt;level[i].span;  <span class="comment">// ç´¯åŠ è·¨åº¦</span></span><br><span class="line">            x = x-&gt;level[i].forward;</span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// æ‰¾åˆ°ç›®æ ‡èŠ‚ç‚¹</span></span><br><span class="line">        <span class="keyword">if</span> (x-&gt;level[i].forward &amp;&amp;</span><br><span class="line">            x-&gt;level[i].forward-&gt;score == score &amp;&amp;</span><br><span class="line">            equalStringObjects(x-&gt;level[i].forward-&gt;obj, obj)) &#123;</span><br><span class="line">            rank += x-&gt;level[i].span;</span><br><span class="line">            <span class="keyword">return</span> rank;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="ä¸ºä»€ä¹ˆè·³è¡¨çš„èŒƒå›´æŸ¥è¯¢æ•ˆçŽ‡æ¯”å­—å…¸é«˜ï¼Ÿ"><a href="#ä¸ºä»€ä¹ˆè·³è¡¨çš„èŒƒå›´æŸ¥è¯¢æ•ˆçŽ‡æ¯”å­—å…¸é«˜ï¼Ÿ" class="headerlink" title="ä¸ºä»€ä¹ˆè·³è¡¨çš„èŒƒå›´æŸ¥è¯¢æ•ˆçŽ‡æ¯”å­—å…¸é«˜ï¼Ÿ"></a>ä¸ºä»€ä¹ˆè·³è¡¨çš„èŒƒå›´æŸ¥è¯¢æ•ˆçŽ‡æ¯”å­—å…¸é«˜ï¼Ÿ</h4><p>å­—å…¸æ˜¯é€šè¿‡å“ˆå¸Œå‡½æ•°å°†é”®å€¼å¯¹åˆ†æ•£å­˜å‚¨çš„ï¼Œå…ƒç´ åœ¨å†…å­˜ä¸­æ˜¯æ— åºåˆ†å¸ƒçš„ï¼Œæ²¡æœ‰ä»»ä½•é¡ºåºå…³ç³»ã€‚è€Œè·³è¡¨æœ¬èº«å°±æ˜¯æœ‰åºçš„æ•°æ®ç»“æž„ï¼Œæ‰€æœ‰å…ƒç´ æŒ‰ç…§åˆ†å€¼ä»Žå°åˆ°å¤§æŽ’åˆ—ã€‚</p>
<p><img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="https://cdn.jsdelivr.net/gh/JakicDong/blog-assets@main/images/20251024100154.png" alt="20251024100154"><br>WARRIORï¼šè·³è¡¨</p>
<p>å½“éœ€è¦è¿›è¡ŒèŒƒå›´æŸ¥è¯¢æ—¶ï¼Œå­—å…¸å¿…é¡»éåŽ†æ‰€æœ‰å…ƒç´ ï¼Œé€ä¸ªæ£€æŸ¥æ¯ä¸ªå…ƒç´ æ˜¯å¦åœ¨æŒ‡å®šèŒƒå›´å†…ï¼Œæ—¶é—´å¤æ‚åº¦æ˜¯ <code>O(n)</code>ã€‚æ¯”å¦‚è¦æ‰¾åˆ†å€¼åœ¨ 60 åˆ° 80 ä¹‹é—´çš„æ‰€æœ‰å…ƒç´ ï¼Œå­—å…¸åªèƒ½æŠŠæ•´ä¸ªå“ˆå¸Œè¡¨æ‰«æä¸€éï¼Œå› ä¸ºå®ƒæ— æ³•çŸ¥é“ç¬¦åˆæ¡ä»¶çš„å…ƒç´ åœ¨å“ªé‡Œã€‚</p>
<p>è€Œè·³è¡¨çš„èŒƒå›´æŸ¥è¯¢å°±é«˜æ•ˆå¤šäº†ã€‚é¦–å…ˆç”¨ <code>O(log n)</code> æ—¶é—´æ‰¾åˆ°èŒƒå›´çš„èµ·å§‹ä½ç½®ï¼Œç„¶åŽæ²¿ç€åº•å±‚çš„æœ‰åºé“¾è¡¨é¡ºåºéåŽ†ï¼Œç›´åˆ°è¶…å‡ºèŒƒå›´ä¸ºæ­¢ã€‚æ€»æ—¶é—´å¤æ‚åº¦æ˜¯ <code>O(log n + k)</code>ï¼Œå…¶ä¸­ k æ˜¯ç»“æžœé›†çš„å¤§å°ã€‚è¿™ç§æ•ˆçŽ‡å·®å¼‚åœ¨æ•°æ®é‡å¤§çš„æ—¶å€™éžå¸¸æ˜Žæ˜¾ã€‚</p>
<p><img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="https://cdn.jsdelivr.net/gh/JakicDong/blog-assets@main/images/20251024100219.png" alt="20251024100219"><br>æ™´å¤©å“¥ï¼šzset åº•å±‚ç”±å­—å…¸å’Œè·³è¡¨ç»„æˆ</p>
<p>è¿™ä¹Ÿæ˜¯ä¸ºä»€ä¹ˆ Redis çš„ zset è¦ç”¨è·³è¡¨è€Œä¸æ˜¯çº¯å“ˆå¸Œè¡¨çš„é‡è¦åŽŸå› ï¼Œå› ä¸º zset ç»å¸¸éœ€è¦ ZRANGEã€ZRANGEBYSCORE è¿™ç±»èŒƒå›´æ“ä½œã€‚å®žé™…ä¸Š Redis çš„ zset æ˜¯è·³è¡¨å’Œå“ˆå¸Œè¡¨çš„ç»„åˆï¼šè·³è¡¨ä¿è¯æœ‰åºæ€§æ”¯æŒèŒƒå›´æŸ¥è¯¢ï¼Œå“ˆå¸Œè¡¨ä¿è¯ <code>O(1)</code> çš„å•ç‚¹æŸ¥æ‰¾æ•ˆçŽ‡ï¼Œä¸¤è€…äº’è¡¥ã€‚</p>
<blockquote>
<ol>
<li><a target="_blank" rel="noopener" href="https://javabetter.cn/zhishixingqiu/mianshi.html">Java é¢è¯•æŒ‡å—ï¼ˆä»˜è´¹ï¼‰</a>æ”¶å½•çš„å°ç±³æš‘æœŸå®žä¹ åŒå­¦ E ä¸€é¢é¢è¯•åŽŸé¢˜ï¼šä¸ºä»€ä¹ˆ hash è¡¨èŒƒå›´æŸ¥è¯¢æ•ˆçŽ‡æ¯”è·³è¡¨ä½Ž</li>
<li><a target="_blank" rel="noopener" href="https://javabetter.cn/zhishixingqiu/mianshi.html">Java é¢è¯•æŒ‡å—ï¼ˆä»˜è´¹ï¼‰</a>æ”¶å½•çš„å¾—ç‰©é¢ç»åŒå­¦ 8 ä¸€é¢é¢è¯•åŽŸé¢˜ï¼šè·³è¡¨çš„ç»“æž„</li>
<li><a target="_blank" rel="noopener" href="https://javabetter.cn/zhishixingqiu/mianshi.html">Java é¢è¯•æŒ‡å—ï¼ˆä»˜è´¹ï¼‰</a>æ”¶å½•çš„ç¾Žå›¢é¢ç»åŒå­¦ 4 ä¸€é¢é¢è¯•åŽŸé¢˜ï¼šRedis è·³è¡¨</li>
<li><a target="_blank" rel="noopener" href="https://javabetter.cn/zhishixingqiu/mianshi.html">Java é¢è¯•æŒ‡å—ï¼ˆä»˜è´¹ï¼‰</a>æ”¶å½•çš„é˜¿é‡Œç³»é¢ç»åŒå­¦ 19 é¥¿äº†ä¹ˆé¢è¯•åŽŸé¢˜ï¼šè·³è¡¨äº†è§£å—</li>
</ol>
</blockquote>
<h2 id="Spring"><a href="#Spring" class="headerlink" title="Spring"></a>Spring</h2><h3 id="4-ðŸŒŸSpringç”¨äº†å“ªäº›è®¾è®¡æ¨¡å¼ï¼Ÿ"><a href="#4-ðŸŒŸSpringç”¨äº†å“ªäº›è®¾è®¡æ¨¡å¼ï¼Ÿ" class="headerlink" title="4.ðŸŒŸSpringç”¨äº†å“ªäº›è®¾è®¡æ¨¡å¼ï¼Ÿ"></a>4.ðŸŒŸSpringç”¨äº†å“ªäº›è®¾è®¡æ¨¡å¼ï¼Ÿ</h3><p>Spring æ¡†æž¶é‡Œé¢ç¡®å®žç”¨äº†å¾ˆå¤šè®¾è®¡æ¨¡å¼ï¼Œæˆ‘ä»Žå¹³æ—¶å·¥ä½œä¸­èƒ½è§‚å¯Ÿåˆ°çš„å‡ ä¸ªæ¥è¯´è¯´ã€‚</p>
<p>é¦–å…ˆæ˜¯å·¥åŽ‚æ¨¡å¼ï¼Œè¿™ä¸ªåœ¨ Spring é‡Œç”¨å¾—éžå¸¸å¤šã€‚BeanFactory å°±æ˜¯ä¸€ä¸ªå…¸åž‹çš„å·¥åŽ‚ï¼Œå®ƒè´Ÿè´£åˆ›å»ºå’Œç®¡ç†æ‰€æœ‰çš„ Bean å¯¹è±¡ã€‚æˆ‘ä»¬å¹³æ—¶ç”¨çš„ ApplicationContext å…¶å®žä¹Ÿæ˜¯ BeanFactory çš„ä¸€ä¸ªå®žçŽ°ã€‚å½“æˆ‘ä»¬é€šè¿‡ <code>@Autowired</code> èŽ·å–ä¸€ä¸ª Bean çš„æ—¶å€™ï¼Œåº•å±‚å°±æ˜¯é€šè¿‡å·¥åŽ‚æ¨¡å¼æ¥åˆ›å»ºå’ŒèŽ·å–å¯¹è±¡çš„ã€‚</p>
<p><img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="https://cdn.jsdelivr.net/gh/JakicDong/blog-assets@main/images/20251022155254.png" alt="20251022155254"><br>ä¸‰åˆ†æ¶é¢æ¸£é€†è¢­ï¼šSpringä¸­ç”¨åˆ°çš„è®¾è®¡æ¨¡å¼</p>
<p>å•ä¾‹æ¨¡å¼ä¹Ÿæ˜¯ Spring çš„é»˜è®¤è¡Œä¸ºã€‚é»˜è®¤æƒ…å†µä¸‹ï¼ŒSpring å®¹å™¨ä¸­çš„ Bean éƒ½æ˜¯å•ä¾‹çš„ï¼Œæ•´ä¸ªåº”ç”¨ä¸­åªä¼šæœ‰ä¸€ä¸ªå®žä¾‹ã€‚è¿™æ ·å¯ä»¥èŠ‚çœå†…å­˜ï¼Œæé«˜æ€§èƒ½ã€‚å½“ç„¶æˆ‘ä»¬ä¹Ÿå¯ä»¥é€šè¿‡ <code>@Scope</code> æ³¨è§£æ¥æ”¹å˜ Bean çš„ä½œç”¨åŸŸï¼Œæ¯”å¦‚è®¾ç½®ä¸º prototype å°±æ˜¯æ¯æ¬¡èŽ·å–éƒ½åˆ›å»ºæ–°å®žä¾‹ã€‚</p>
<p><img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="https://cdn.jsdelivr.net/gh/JakicDong/blog-assets@main/images/20251022155349.png" alt="20251022155349"><br>äºŒå“¥çš„ Java è¿›é˜¶ä¹‹è·¯ï¼š@Scopeæ³¨è§£</p>
<p>ä»£ç†æ¨¡å¼åœ¨ AOP ä¸­ç”¨å¾—ç‰¹åˆ«å¤šã€‚Spring AOP çš„åº•å±‚å®žçŽ°å°±æ˜¯åŸºäºŽåŠ¨æ€ä»£ç†çš„ï¼Œå¯¹äºŽå®žçŽ°äº†æŽ¥å£çš„ç±»ç”¨ JDK åŠ¨æ€ä»£ç†ï¼Œæ²¡æœ‰å®žçŽ°æŽ¥å£çš„ç±»ç”¨ CGLIB ä»£ç†ã€‚æ¯”å¦‚æˆ‘ä»¬ç”¨ <code>@Transactional</code> æ³¨è§£çš„æ—¶å€™ï¼ŒSpring ä¼šä¸ºæˆ‘ä»¬çš„ç±»åˆ›å»ºä¸€ä¸ªä»£ç†å¯¹è±¡ï¼Œåœ¨æ–¹æ³•æ‰§è¡Œå‰åŽæ·»åŠ äº‹åŠ¡å¤„ç†é€»è¾‘ã€‚</p>
<p>æ¨¡æ¿æ–¹æ³•æ¨¡å¼åœ¨ Spring é‡Œä¹Ÿå¾ˆå¸¸è§ï¼Œæ¯”å¦‚ JdbcTemplateã€‚å®ƒå®šä¹‰äº†æ•°æ®åº“æ“ä½œçš„åŸºæœ¬æµç¨‹ï¼šèŽ·å–è¿žæŽ¥ã€æ‰§è¡Œ SQLã€å¤„ç†ç»“æžœã€å…³é—­è¿žæŽ¥ï¼Œä½†æ˜¯å…·ä½“çš„ SQL è¯­å¥å’Œç»“æžœå¤„ç†é€»è¾‘ç”±æˆ‘ä»¬æ¥å®žçŽ°ã€‚</p>
<p><img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="https://cdn.jsdelivr.net/gh/JakicDong/blog-assets@main/images/20251022155821.png" alt="20251022155821"><br>æŠ€æœ¯æ´¾æºç ï¼šJdbcTemplate</p>
<p>è§‚å¯Ÿè€…æ¨¡å¼åœ¨ Spring çš„äº‹ä»¶æœºåˆ¶ä¸­æœ‰æ‰€ä½“çŽ°ã€‚æˆ‘ä»¬å¯ä»¥é€šè¿‡ ApplicationEvent å’Œ ApplicationListener æ¥å®žçŽ°äº‹ä»¶çš„å‘å¸ƒå’Œç›‘å¬ã€‚æ¯”å¦‚ç”¨æˆ·æ³¨å†ŒæˆåŠŸåŽï¼Œæˆ‘ä»¬å¯ä»¥å‘å¸ƒä¸€ä¸ªç”¨æˆ·æ³¨å†Œäº‹ä»¶ï¼Œç„¶åŽæœ‰å¤šä¸ªç›‘å¬å™¨æ¥å¤„ç†åŽç»­çš„ä¸šåŠ¡é€»è¾‘ï¼Œæ¯”å¦‚å‘é€é‚®ä»¶ã€è®°å½•æ—¥å¿—ç­‰ã€‚</p>
<p><img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="https://cdn.jsdelivr.net/gh/JakicDong/blog-assets@main/images/20251022155845.png" alt="20251022155845"><br>æŠ€æœ¯æ´¾æºç ï¼šApplicationListener</p>
<p>è¿™äº›è®¾è®¡æ¨¡å¼çš„åº”ç”¨è®© Spring æ¡†æž¶æ—¢çµæ´»åˆå¼ºå¤§ï¼Œä¹Ÿè®©æˆ‘åœ¨å®žé™…çš„å¼€å‘ä¸­å­¦åˆ°å¾ˆå¤šç»å…¸çš„è®¾è®¡æ€æƒ³ã€‚</p>
<h4 id="Springå¦‚ä½•å®žçŽ°å•ä¾‹æ¨¡å¼ï¼Ÿ"><a href="#Springå¦‚ä½•å®žçŽ°å•ä¾‹æ¨¡å¼ï¼Ÿ" class="headerlink" title="Springå¦‚ä½•å®žçŽ°å•ä¾‹æ¨¡å¼ï¼Ÿ"></a>Springå¦‚ä½•å®žçŽ°å•ä¾‹æ¨¡å¼ï¼Ÿ</h4><p>ä¼ ç»Ÿçš„å•ä¾‹æ¨¡å¼æ˜¯åœ¨ç±»çš„å†…éƒ¨æŽ§åˆ¶åªèƒ½åˆ›å»ºä¸€ä¸ªå®žä¾‹ï¼Œæ¯”å¦‚ç”¨ private æž„é€ æ–¹æ³•åŠ  <code>static getInstance()</code> è¿™ç§æ–¹å¼ã€‚ä½†æ˜¯ Spring çš„å•ä¾‹æ˜¯å®¹å™¨çº§åˆ«çš„ï¼ŒåŒä¸€ä¸ª Bean åœ¨æ•´ä¸ª Spring å®¹å™¨ä¸­åªä¼šæœ‰ä¸€ä¸ªå®žä¾‹ã€‚</p>
<p>å…·ä½“çš„å®žçŽ°æœºåˆ¶æ˜¯è¿™æ ·çš„ï¼šSpring åœ¨å¯åŠ¨çš„æ—¶å€™ä¼šæŠŠæ‰€æœ‰çš„ Bean å®šä¹‰ä¿¡æ¯åŠ è½½è¿›æ¥ï¼Œç„¶åŽåœ¨ DefaultSingletonBeanRegistry è¿™ä¸ªç±»é‡Œé¢ç»´æŠ¤äº†ä¸€ä¸ªå« singletonObjects çš„ ConcurrentHashMapï¼Œè¿™ä¸ª Map å°±æ˜¯ç”¨æ¥å­˜å‚¨å•ä¾‹ Bean çš„ã€‚key æ˜¯ Bean çš„åç§°ï¼Œvalue å°±æ˜¯ Bean çš„å®žä¾‹å¯¹è±¡ã€‚</p>
<p><img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="https://cdn.jsdelivr.net/gh/JakicDong/blog-assets@main/images/20251022160045.png" alt="20251022160045"><br>äºŒå“¥çš„ Java è¿›é˜¶ä¹‹è·¯ï¼šDefaultSingletonBeanRegistry</p>
<p>å½“æˆ‘ä»¬ç¬¬ä¸€æ¬¡èŽ·å–æŸä¸ª Bean çš„æ—¶å€™ï¼ŒSpring ä¼šå…ˆæ£€æŸ¥ singletonObjects è¿™ä¸ª Map é‡Œé¢æœ‰æ²¡æœ‰è¿™ä¸ª Beanï¼Œå¦‚æžœæ²¡æœ‰å°±ä¼šåˆ›å»ºä¸€ä¸ªæ–°çš„å®žä¾‹ï¼Œç„¶åŽæ”¾åˆ° Map é‡Œé¢ã€‚åŽé¢å†èŽ·å–åŒä¸€ä¸ª Bean çš„æ—¶å€™ï¼Œç›´æŽ¥ä»Ž Map é‡Œé¢å–å°±è¡Œäº†ï¼Œè¿™æ ·å°±ä¿è¯äº†å•ä¾‹ã€‚</p>
<p><img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="https://cdn.jsdelivr.net/gh/JakicDong/blog-assets@main/images/20251022160058.png" alt="20251022160058"><br>äºŒå“¥çš„ Java è¿›é˜¶ä¹‹è·¯ï¼šregisterSingleton</p>
<p>è¿˜æœ‰ä¸€ä¸ªç»†èŠ‚å°±æ˜¯ Spring ä¸ºäº†è§£å†³å¾ªçŽ¯ä¾èµ–çš„é—®é¢˜ï¼Œè¿˜ç”¨äº†ä¸‰çº§ç¼“å­˜ã€‚é™¤äº† singletonObjects è¿™ä¸ªä¸€çº§ç¼“å­˜ï¼Œè¿˜æœ‰ earlySingletonObjects äºŒçº§ç¼“å­˜å’Œ singletonFactories ä¸‰çº§ç¼“å­˜ã€‚è¿™æ ·å³ä½¿æœ‰å¾ªçŽ¯ä¾èµ–ï¼ŒSpring ä¹Ÿèƒ½æ­£ç¡®å¤„ç†ã€‚</p>
<p>è€Œä¸” Spring çš„å•ä¾‹æ˜¯çº¿ç¨‹å®‰å…¨çš„ï¼Œå› ä¸ºç”¨çš„æ˜¯ ConcurrentHashMapï¼Œå¤šçº¿ç¨‹è®¿é—®ä¸ä¼šæœ‰é—®é¢˜ã€‚</p>
<blockquote>
<ol>
<li><a target="_blank" rel="noopener" href="https://javabetter.cn/zhishixingqiu/mianshi.html">Java é¢è¯•æŒ‡å—ï¼ˆä»˜è´¹ï¼‰</a>æ”¶å½•çš„æºç¨‹é¢ç»åŒå­¦ 10 Java æš‘æœŸå®žä¹ ä¸€é¢é¢è¯•åŽŸé¢˜ï¼šSpring IoC çš„è®¾è®¡æ¨¡å¼ï¼ŒAOP çš„è®¾è®¡æ¨¡å¼</li>
<li><a target="_blank" rel="noopener" href="https://javabetter.cn/zhishixingqiu/mianshi.html">Java é¢è¯•æŒ‡å—ï¼ˆä»˜è´¹ï¼‰</a>æ”¶å½•çš„å°å…¬å¸é¢ç»åˆé›†åŒå­¦ 1 Java åŽç«¯é¢è¯•åŽŸé¢˜ï¼šSpring æ¡†æž¶ä½¿ç”¨åˆ°çš„è®¾è®¡æ¨¡å¼ï¼Ÿ</li>
<li><a target="_blank" rel="noopener" href="https://javabetter.cn/zhishixingqiu/mianshi.html">Java é¢è¯•æŒ‡å—ï¼ˆä»˜è´¹ï¼‰</a>æ”¶å½•çš„åŒå­¦ 1 è´å£³æ‰¾æˆ¿åŽç«¯æŠ€æœ¯ä¸€é¢é¢è¯•åŽŸé¢˜ï¼šSpringç”¨äº†ä»€ä¹ˆè®¾è®¡æ¨¡å¼ï¼Ÿ</li>
<li><a target="_blank" rel="noopener" href="https://javabetter.cn/zhishixingqiu/mianshi.html">Java é¢è¯•æŒ‡å—ï¼ˆä»˜è´¹ï¼‰</a>æ”¶å½•çš„å¿«æ‰‹åŒå­¦ 4 ä¸€é¢åŽŸé¢˜ï¼šSpringä¸­ä½¿ç”¨äº†å“ªäº›è®¾è®¡æ¨¡å¼ï¼Œä»¥å…¶ä¸­ä¸€ç§æ¨¡å¼ä¸¾ä¾‹è¯´æ˜Žï¼ŸSpringå¦‚ä½•å®žçŽ°å•ä¾‹æ¨¡å¼ï¼Ÿ</li>
</ol>
</blockquote>
<h3 id="7-ðŸŒŸèƒ½è¯´ä¸€ä¸‹Beançš„ç”Ÿå‘½å‘¨æœŸå—ï¼Ÿ"><a href="#7-ðŸŒŸèƒ½è¯´ä¸€ä¸‹Beançš„ç”Ÿå‘½å‘¨æœŸå—ï¼Ÿ" class="headerlink" title="7.ðŸŒŸèƒ½è¯´ä¸€ä¸‹Beançš„ç”Ÿå‘½å‘¨æœŸå—ï¼Ÿ"></a>7.ðŸŒŸèƒ½è¯´ä¸€ä¸‹Beançš„ç”Ÿå‘½å‘¨æœŸå—ï¼Ÿ</h3><p>æŽ¨èé˜…è¯»ï¼š<a target="_blank" rel="noopener" href="https://mp.weixin.qq.com/s/zb6eA3Se0gQoqL8PylCPLw">ä¸‰åˆ†æ¶ï¼šSpring Bean ç”Ÿå‘½å‘¨æœŸï¼Œå¥½åƒäººçš„ä¸€ç”Ÿ</a></p>
<p>å¥½çš„ã€‚</p>
<p>Bean çš„ç”Ÿå‘½å‘¨æœŸå¯ä»¥åˆ†ä¸º 5 ä¸ªä¸»è¦é˜¶æ®µï¼Œæˆ‘æŒ‰ç…§å®žé™…çš„æ‰§è¡Œé¡ºåºæ¥è¯´ä¸€ä¸‹ã€‚</p>
<p><img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="https://cdn.jsdelivr.net/gh/JakicDong/blog-assets@main/images/20251022164805.png" alt="20251022164805"><br>ä¸‰åˆ†æ¶é¢æ¸£é€†è¢­ï¼šBeanç”Ÿå‘½å‘¨æœŸäº”ä¸ªé˜¶æ®µ</p>
<p>ç¬¬ä¸€ä¸ªé˜¶æ®µæ˜¯å®žä¾‹åŒ–ã€‚Spring å®¹å™¨ä¼šæ ¹æ® BeanDefinitionï¼Œé€šè¿‡åå°„è°ƒç”¨ Bean çš„æž„é€ æ–¹æ³•åˆ›å»ºå¯¹è±¡å®žä¾‹ã€‚å¦‚æžœæœ‰å¤šä¸ªæž„é€ æ–¹æ³•ï¼ŒSpring ä¼šæ ¹æ®ä¾èµ–æ³¨å…¥çš„è§„åˆ™é€‰æ‹©åˆé€‚çš„æž„é€ æ–¹æ³•ã€‚</p>
<p><img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="https://cdn.jsdelivr.net/gh/JakicDong/blog-assets@main/images/20251022164814.png" alt="20251022164814"><br>ä¸‰åˆ†æ¶é¢æ¸£é€†è¢­ï¼šSpring Beanç”Ÿå‘½å‘¨æœŸ</p>
<p>ç¬¬äºŒé˜¶æ®µæ˜¯å±žæ€§èµ‹å€¼ã€‚è¿™ä¸ªé˜¶æ®µ Spring ä¼šç»™ Bean çš„å±žæ€§èµ‹å€¼ï¼ŒåŒ…æ‹¬é€šè¿‡ <code>@Autowired</code>ã€<code>@Resource</code> è¿™äº›æ³¨è§£æ³¨å…¥çš„ä¾èµ–å¯¹è±¡ï¼Œä»¥åŠé€šè¿‡ <code>@Value</code> æ³¨å…¥çš„é…ç½®å€¼ã€‚</p>
<p><img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="https://cdn.jsdelivr.net/gh/JakicDong/blog-assets@main/images/20251022164823.png" alt="20251022164823"><br>äºŒå“¥çš„ Java è¿›é˜¶ä¹‹è·¯ï¼šdoCreateBean æ–¹æ³•æºç </p>
<p>ç¬¬ä¸‰é˜¶æ®µæ˜¯åˆå§‹åŒ–ã€‚è¿™ä¸ªé˜¶æ®µä¼šä¾æ¬¡æ‰§è¡Œï¼š</p>
<ul>
<li><code>@PostConstruct</code> æ ‡æ³¨çš„æ–¹æ³•</li>
<li>InitializingBean æŽ¥å£çš„ afterPropertiesSet æ–¹æ³•</li>
<li>é€šè¿‡ <code>@Bean</code> çš„ initMethod æŒ‡å®šçš„åˆå§‹åŒ–æ–¹æ³•</li>
</ul>
<p><img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="https://cdn.jsdelivr.net/gh/JakicDong/blog-assets@main/images/20251022164834.png" alt="20251022164834"><br>ä¸‰åˆ†æ¶é¢æ¸£é€†è¢­ï¼šBeanç”Ÿå‘½å‘¨æœŸæºç è¿½è¸ª</p>
<p>æˆ‘åœ¨é¡¹ç›®ä¸­ç»å¸¸ç”¨ <code>@PostConstruct</code> æ¥åšä¸€äº›åˆå§‹åŒ–å·¥ä½œï¼Œæ¯”å¦‚ç¼“å­˜é¢„åŠ è½½ã€DB é…ç½®ç­‰ç­‰ã€‚</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// CategoryServiceImplä¸­çš„ç¼“å­˜åˆå§‹åŒ–</span></span><br><span class="line"><span class="meta">@PostConstruct</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">init</span><span class="params">()</span> &#123;</span><br><span class="line">    categoryCaches = CacheBuilder.newBuilder().maximumSize(<span class="number">300</span>).build(<span class="keyword">new</span> <span class="title class_">CacheLoader</span>&lt;Long, CategoryDTO&gt;() &#123;</span><br><span class="line">        <span class="meta">@Override</span></span><br><span class="line">        <span class="keyword">public</span> CategoryDTO <span class="title function_">load</span><span class="params">(<span class="meta">@NotNull</span> Long categoryId)</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">            <span class="type">CategoryDO</span> <span class="variable">category</span> <span class="operator">=</span> categoryDao.getById(categoryId);</span><br><span class="line">            <span class="comment">// ...</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// DynamicConfigContainerä¸­çš„é…ç½®åˆå§‹åŒ–</span></span><br><span class="line"><span class="meta">@PostConstruct</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">init</span><span class="params">()</span> &#123;</span><br><span class="line">    cache = Maps.newHashMap();</span><br><span class="line">    bindBeansFromLocalCache(<span class="string">&quot;dbConfig&quot;</span>, cache);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>åˆå§‹åŒ–åŽï¼ŒSpring è¿˜ä¼šè°ƒç”¨æ‰€æœ‰æ³¨å†Œçš„ BeanPostProcessor åŽç½®å¤„ç†æ–¹æ³•ã€‚è¿™ä¸ªé˜¶æ®µç»å¸¸ç”¨æ¥åˆ›å»ºä»£ç†å¯¹è±¡ï¼Œæ¯”å¦‚ AOP ä»£ç†ã€‚</p>
<p>ç¬¬äº”é˜¶æ®µæ˜¯ä½¿ç”¨ Beanã€‚æ¯”å¦‚æˆ‘ä»¬çš„ Controller è°ƒç”¨ Serviceï¼ŒService è°ƒç”¨ DAOã€‚</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// UserControllerä¸­çš„ä½¿ç”¨ç¤ºä¾‹</span></span><br><span class="line"><span class="meta">@Autowired</span></span><br><span class="line"><span class="keyword">private</span> UserService userService;</span><br><span class="line"><span class="meta">@GetMapping(&quot;/users/&#123;id&#125;&quot;)</span></span><br><span class="line"><span class="keyword">public</span> UserDTO <span class="title function_">getUser</span><span class="params">(<span class="meta">@PathVariable</span> Long id)</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> userService.getUserById(id);</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// UserServiceä¸­çš„ä½¿ç”¨ç¤ºä¾‹</span></span><br><span class="line"><span class="meta">@Autowired</span></span><br><span class="line"><span class="keyword">private</span> UserDao userDao;</span><br><span class="line"><span class="keyword">public</span> UserDTO <span class="title function_">getUserById</span><span class="params">(Long id)</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> userDao.getById(id);</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// UserDaoä¸­çš„ä½¿ç”¨ç¤ºä¾‹</span></span><br><span class="line"><span class="meta">@Autowired</span></span><br><span class="line"><span class="keyword">private</span> JdbcTemplate jdbcTemplate;</span><br><span class="line"><span class="keyword">public</span> UserDTO <span class="title function_">getById</span><span class="params">(Long id)</span> &#123;</span><br><span class="line">    <span class="type">String</span> <span class="variable">sql</span> <span class="operator">=</span> <span class="string">&quot;SELECT * FROM users WHERE id = ?&quot;</span>;</span><br><span class="line">    <span class="keyword">return</span> jdbcTemplate.queryForObject(sql, <span class="keyword">new</span> <span class="title class_">Object</span>[]&#123;id&#125;, <span class="keyword">new</span> <span class="title class_">UserRowMapper</span>());</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>æœ€åŽæ˜¯é”€æ¯é˜¶æ®µã€‚å½“å®¹å™¨å…³é—­æˆ–è€… Bean è¢«ç§»é™¤çš„æ—¶å€™ï¼Œä¼šä¾æ¬¡æ‰§è¡Œï¼š</p>
<ul>
<li><code>@PreDestroy</code> æ ‡æ³¨çš„æ–¹æ³•</li>
<li>DisposableBean æŽ¥å£çš„ destroy æ–¹æ³•</li>
<li>é€šè¿‡ <code>@Bean</code> çš„ destroyMethod æŒ‡å®šçš„é”€æ¯æ–¹æ³•</li>
</ul>
<p><img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="https://cdn.jsdelivr.net/gh/JakicDong/blog-assets@main/images/20251022164849.png" alt="20251022164849"><br>äºŒå“¥çš„ Java è¿›é˜¶ä¹‹è·¯ï¼šclose æºç </p>
<h4 id="Aware-ç±»åž‹çš„æŽ¥å£æœ‰ä»€ä¹ˆä½œç”¨ï¼Ÿ"><a href="#Aware-ç±»åž‹çš„æŽ¥å£æœ‰ä»€ä¹ˆä½œç”¨ï¼Ÿ" class="headerlink" title="Aware ç±»åž‹çš„æŽ¥å£æœ‰ä»€ä¹ˆä½œç”¨ï¼Ÿ"></a>Aware ç±»åž‹çš„æŽ¥å£æœ‰ä»€ä¹ˆä½œç”¨ï¼Ÿ</h4><p>Aware æŽ¥å£åœ¨ Spring ä¸­æ˜¯ä¸€ä¸ªå¾ˆæœ‰æ„æ€çš„è®¾è®¡ï¼Œå®ƒä»¬çš„ä½œç”¨æ˜¯è®© Bean èƒ½å¤Ÿæ„ŸçŸ¥åˆ° Spring å®¹å™¨çš„ä¸€äº›å†…éƒ¨ç»„ä»¶ã€‚</p>
<p>ä»Žè®¾è®¡ç†å¿µæ¥è¯´ï¼ŒAware æŽ¥å£å®žçŽ°äº†ä¸€ç§â€œå›žè°ƒâ€æœºåˆ¶ã€‚æ­£å¸¸æƒ…å†µä¸‹ï¼ŒBean ä¸åº”è¯¥ç›´æŽ¥ä¾èµ– Spring å®¹å™¨ï¼Œè¿™æ ·å¯ä»¥ä¿æŒä»£ç çš„ç‹¬ç«‹æ€§ã€‚ä½†æœ‰äº›æ—¶å€™ï¼ŒBean ç¡®å®žéœ€è¦èŽ·å–å®¹å™¨çš„ä¸€äº›ä¿¡æ¯æˆ–è€…ç»„ä»¶ï¼ŒAware æŽ¥å£å°±æä¾›äº†è¿™æ ·ä¸€ä¸ªèƒ½åŠ›ã€‚</p>
<p>æˆ‘æœ€å¸¸ç”¨çš„ Aware æŽ¥å£æ˜¯ ApplicationContextAwareï¼Œå®ƒå¯ä»¥è®© Bean èŽ·å–åˆ° ApplicationContext å®¹å™¨æœ¬èº«ã€‚</p>
<p><img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="https://cdn.jsdelivr.net/gh/JakicDong/blog-assets@main/images/20251022164904.png" alt="20251022164904"><br>æŠ€æœ¯æ´¾æºç ï¼šApplicationContextAware</p>
<p>åœ¨<a target="_blank" rel="noopener" href="https://javabetter.cn/zhishixingqiu/paicoding.html">æŠ€æœ¯æ´¾é¡¹ç›®</a>ä¸­ï¼Œæˆ‘å°±é€šè¿‡å®žçŽ° ApplicationContextAware å’Œ EnvironmentAware æŽ¥å£å°è£…äº†ä¸€ä¸ª SpringUtil å·¥å…·ç±»ï¼Œé€šè¿‡ getBean å’Œ getProperty æ–¹æ³•æ¥èŽ·å– Bean å’Œé…ç½®å±žæ€§ã€‚</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// é™æ€æ–¹æ³•èŽ·å–Beanï¼Œæ–¹ä¾¿åœ¨éžSpringç®¡ç†çš„ç±»ä¸­ä½¿ç”¨</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> &lt;T&gt; T <span class="title function_">getBean</span><span class="params">(Class&lt;T&gt; clazz)</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> context.getBean(clazz);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// èŽ·å–é…ç½®å±žæ€§</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> String <span class="title function_">getProperty</span><span class="params">(String key)</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> environment.getProperty(key);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="å¦‚æžœé…ç½®äº†-init-method-å’Œ-destroy-methodï¼ŒSpring-ä¼šåœ¨ä»€ä¹ˆæ—¶å€™è°ƒç”¨å…¶é…ç½®çš„æ–¹æ³•ï¼Ÿ"><a href="#å¦‚æžœé…ç½®äº†-init-method-å’Œ-destroy-methodï¼ŒSpring-ä¼šåœ¨ä»€ä¹ˆæ—¶å€™è°ƒç”¨å…¶é…ç½®çš„æ–¹æ³•ï¼Ÿ" class="headerlink" title="å¦‚æžœé…ç½®äº† init-method å’Œ destroy-methodï¼ŒSpring ä¼šåœ¨ä»€ä¹ˆæ—¶å€™è°ƒç”¨å…¶é…ç½®çš„æ–¹æ³•ï¼Ÿ"></a>å¦‚æžœé…ç½®äº† init-method å’Œ destroy-methodï¼ŒSpring ä¼šåœ¨ä»€ä¹ˆæ—¶å€™è°ƒç”¨å…¶é…ç½®çš„æ–¹æ³•ï¼Ÿ</h4><p>init-method æŒ‡å®šçš„åˆå§‹åŒ–æ–¹æ³•ä¼šåœ¨ Bean çš„åˆå§‹åŒ–é˜¶æ®µè¢«è°ƒç”¨ï¼Œå…·ä½“çš„æ‰§è¡Œé¡ºåºæ˜¯ï¼š</p>
<ul>
<li>å…ˆæ‰§è¡Œ <code>@PostConstruct</code> æ ‡æ³¨çš„æ–¹æ³•</li>
<li>ç„¶åŽæ‰§è¡Œ InitializingBean æŽ¥å£çš„ <code>afterPropertiesSet()</code> æ–¹æ³•</li>
<li>æœ€åŽå†æ‰§è¡Œ init-method æŒ‡å®šçš„æ–¹æ³•</li>
</ul>
<p>ä¹Ÿå°±æ˜¯è¯´ï¼Œinit-method æ˜¯åœ¨æ‰€æœ‰å…¶ä»–åˆå§‹åŒ–æ–¹æ³•ä¹‹åŽæ‰§è¡Œçš„ã€‚</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">MyService</span> &#123;</span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> UserDao userDao;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@PostConstruct</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">postConstruct</span><span class="params">()</span> &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;1. @PostConstructæ‰§è¡Œ&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">customInit</span><span class="params">()</span> &#123;  <span class="comment">// é€šè¿‡@Beançš„initMethodæŒ‡å®š</span></span><br><span class="line">        System.out.println(<span class="string">&quot;3. init-methodæ‰§è¡Œ&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">AppConfig</span> &#123;</span><br><span class="line">    <span class="meta">@Bean(initMethod = &quot;customInit&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> MyService <span class="title function_">myService</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">MyService</span>();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>destroy-method ä¼šåœ¨ Bean é”€æ¯é˜¶æ®µè¢«è°ƒç”¨ã€‚</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">MyService</span> &#123;</span><br><span class="line">    <span class="meta">@PreDestroy</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">preDestroy</span><span class="params">()</span> &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;1. @PreDestroyæ‰§è¡Œ&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">customDestroy</span><span class="params">()</span> &#123;  <span class="comment">// é€šè¿‡@Beançš„destroyMethodæŒ‡å®š</span></span><br><span class="line">        System.out.println(<span class="string">&quot;3. destroy-methodæ‰§è¡Œ&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>ä¸è¿‡åœ¨å®žé™…å¼€å‘ä¸­ï¼Œé€šå¸¸ç”¨ <code>@PostConstruct</code> å’Œ <code>@PreDestroy</code> å°±å¤Ÿäº†ï¼Œå®ƒä»¬æ›´ç®€æ´ã€‚</p>
<blockquote>
<ol>
<li><a target="_blank" rel="noopener" href="https://javabetter.cn/zhishixingqiu/mianshi.html">Java é¢è¯•æŒ‡å—ï¼ˆä»˜è´¹ï¼‰</a>æ”¶å½•çš„å°ç±³ 25 å±Šæ—¥å¸¸å®žä¹ ä¸€é¢åŽŸé¢˜ï¼šè¯´è¯´ Bean çš„ç”Ÿå‘½å‘¨æœŸ</li>
<li><a target="_blank" rel="noopener" href="https://javabetter.cn/zhishixingqiu/mianshi.html">Java é¢è¯•æŒ‡å—ï¼ˆä»˜è´¹ï¼‰</a>æ”¶å½•çš„ç™¾åº¦é¢ç»åŒå­¦ 1 æ–‡å¿ƒä¸€è¨€ 25 å®žä¹  Java åŽç«¯é¢è¯•åŽŸé¢˜ï¼šSpringä¸­beanç”Ÿå‘½å‘¨æœŸ</li>
<li><a target="_blank" rel="noopener" href="https://javabetter.cn/zhishixingqiu/mianshi.html">Java é¢è¯•æŒ‡å—ï¼ˆä»˜è´¹ï¼‰</a>æ”¶å½•çš„8 åŽç«¯å¼€å‘ç§‹æ‹›ä¸€é¢é¢è¯•åŽŸé¢˜ï¼šè®²ä¸€ä¸‹Spring Beançš„ç”Ÿå‘½å‘¨æœŸ</li>
<li><a target="_blank" rel="noopener" href="https://javabetter.cn/zhishixingqiu/mianshi.html">Java é¢è¯•æŒ‡å—ï¼ˆä»˜è´¹ï¼‰</a>æ”¶å½•çš„åŒå­¦ 1 è´å£³æ‰¾æˆ¿åŽç«¯æŠ€æœ¯ä¸€é¢é¢è¯•åŽŸé¢˜ï¼šbeanç”Ÿå‘½å‘¨æœŸ</li>
<li><a target="_blank" rel="noopener" href="https://javabetter.cn/zhishixingqiu/mianshi.html">Java é¢è¯•æŒ‡å—ï¼ˆä»˜è´¹ï¼‰</a>æ”¶å½•çš„å¿«æ‰‹åŒå­¦ 4 ä¸€é¢åŽŸé¢˜ï¼šä»‹ç»ä¸‹Beançš„ç”Ÿå‘½å‘¨æœŸï¼ŸAwareç±»åž‹æŽ¥å£çš„ä½œç”¨ï¼Ÿå¦‚æžœé…ç½®äº†init-methodå’Œdestroy-methodï¼ŒSpringä¼šåœ¨ä»€ä¹ˆæ—¶å€™è°ƒç”¨å…¶é…ç½®çš„æ–¹æ³•ï¼Ÿ</li>
</ol>
</blockquote>
<h3 id="14-ðŸŒŸSpringæ€Žä¹ˆè§£å†³å¾ªçŽ¯ä¾èµ–å‘¢ï¼Ÿ"><a href="#14-ðŸŒŸSpringæ€Žä¹ˆè§£å†³å¾ªçŽ¯ä¾èµ–å‘¢ï¼Ÿ" class="headerlink" title="14.ðŸŒŸSpringæ€Žä¹ˆè§£å†³å¾ªçŽ¯ä¾èµ–å‘¢ï¼Ÿ"></a>14.ðŸŒŸSpringæ€Žä¹ˆè§£å†³å¾ªçŽ¯ä¾èµ–å‘¢ï¼Ÿ</h3><p>Spring é€šè¿‡ä¸‰çº§ç¼“å­˜æœºåˆ¶æ¥è§£å†³å¾ªçŽ¯ä¾èµ–ï¼š</p>
<ol>
<li>ä¸€çº§ç¼“å­˜ï¼šå­˜æ”¾å®Œå…¨åˆå§‹åŒ–å¥½çš„å•ä¾‹ Beanã€‚</li>
<li>äºŒçº§ç¼“å­˜ï¼šå­˜æ”¾æå‰æš´éœ²çš„ Beanï¼Œå®žä¾‹åŒ–å®Œæˆï¼Œä½†æœªåˆå§‹åŒ–å®Œæˆã€‚</li>
<li>ä¸‰çº§ç¼“å­˜ï¼šå­˜æ”¾ Bean å·¥åŽ‚ï¼Œç”¨äºŽç”Ÿæˆæå‰æš´éœ²çš„ Beanã€‚</li>
</ol>
<p><img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="https://cdn.jsdelivr.net/gh/JakicDong/blog-assets@main/images/20251022165402.png" alt="20251022165402"><br>ä¸‰åˆ†æ¶é¢æ¸£é€†è¢­ï¼šä¸‰çº§ç¼“å­˜</p>
<p>ä»¥ Aã€B ä¸¤ä¸ªç±»å‘ç”Ÿå¾ªçŽ¯ä¾èµ–ä¸ºä¾‹ï¼š</p>
<p><img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="https://cdn.jsdelivr.net/gh/JakicDong/blog-assets@main/images/20251022165409.png" alt="20251022165409"><br>ä¸‰åˆ†æ¶é¢æ¸£é€†è¢­ï¼šå¾ªçŽ¯ä¾èµ–</p>
<p>ç¬¬ 1 æ­¥ï¼šå¼€å§‹åˆ›å»º Bean Aã€‚</p>
<ul>
<li>Spring è°ƒç”¨ A çš„æž„é€ æ–¹æ³•ï¼Œåˆ›å»º A çš„å®žä¾‹ã€‚æ­¤æ—¶ A å¯¹è±¡å·²å­˜åœ¨ï¼Œä½† bå±žæ€§è¿˜æ˜¯ nullã€‚</li>
<li>å°† A çš„å¯¹è±¡å·¥åŽ‚æ”¾å…¥ä¸‰çº§ç¼“å­˜ã€‚</li>
<li>å¼€å§‹è¿›è¡Œ A çš„å±žæ€§æ³¨å…¥ã€‚</li>
</ul>
<p><img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="https://cdn.jsdelivr.net/gh/JakicDong/blog-assets@main/images/20251022165417.png" alt="20251022165417"><br>ä¸‰åˆ†æ¶é¢æ¸£é€†è¢­ï¼šA å¯¹è±¡å·¥åŽ‚</p>
<p>ç¬¬ 2 æ­¥ï¼šA éœ€è¦æ³¨å…¥ Bï¼Œå¼€å§‹åˆ›å»º Bean Bã€‚</p>
<ul>
<li>å‘çŽ°éœ€è¦ Bï¼Œä½† B è¿˜ä¸å­˜åœ¨ï¼Œæ‰€ä»¥å¼€å§‹åˆ›å»º Bã€‚</li>
<li>è°ƒç”¨ B çš„æž„é€ æ–¹æ³•ï¼Œåˆ›å»º B çš„å®žä¾‹ã€‚æ­¤æ—¶ B å¯¹è±¡å·²å­˜åœ¨ï¼Œä½† a å±žæ€§è¿˜æ˜¯ nullã€‚</li>
<li>å°† B çš„å¯¹è±¡å·¥åŽ‚æ”¾å…¥ä¸‰çº§ç¼“å­˜ã€‚</li>
<li>å¼€å§‹è¿›è¡Œ B çš„å±žæ€§æ³¨å…¥ã€‚</li>
</ul>
<p>ç¬¬ 3 æ­¥ï¼šB éœ€è¦æ³¨å…¥ Aï¼Œä»Žç¼“å­˜ä¸­èŽ·å– Aã€‚</p>
<ul>
<li>B éœ€è¦æ³¨å…¥ Aï¼Œå…ˆä»Žä¸€çº§ç¼“å­˜æ‰¾ Aï¼Œæ²¡æ‰¾åˆ°ã€‚</li>
<li>å†ä»ŽäºŒçº§ç¼“å­˜æ‰¾ Aï¼Œä¹Ÿæ²¡æ‰¾åˆ°ã€‚</li>
<li>æœ€åŽä»Žä¸‰çº§ç¼“å­˜æ‰¾ Aï¼Œæ‰¾åˆ°äº† A çš„å¯¹è±¡å·¥åŽ‚ã€‚</li>
<li>è°ƒç”¨ A çš„å¯¹è±¡å·¥åŽ‚å¾—åˆ° A çš„å®žä¾‹ã€‚è¿™æ—¶ A å·²ç»å®žä¾‹åŒ–äº†ï¼Œè™½ç„¶è¿˜æ²¡å®Œå…¨åˆå§‹åŒ–ã€‚</li>
<li>å°† A ä»Žä¸‰çº§ç¼“å­˜ç§»åˆ°äºŒçº§ç¼“å­˜ã€‚</li>
<li>B æ‹¿åˆ° A çš„å¼•ç”¨ï¼Œå®Œæˆå±žæ€§æ³¨å…¥ã€‚</li>
</ul>
<p><img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="https://cdn.jsdelivr.net/gh/JakicDong/blog-assets@main/images/20251022165426.png" alt="20251022165426"><br>ä¸‰åˆ†æ¶é¢æ¸£é€†è¢­ï¼šA æ”¾å…¥äºŒçº§ç¼“å­˜ï¼ŒB æ”¾å…¥ä¸€çº§ç¼“å­˜</p>
<p>ç¬¬ 4 æ­¥ï¼šB å®Œæˆåˆå§‹åŒ–ã€‚</p>
<ul>
<li>B çš„å±žæ€§æ³¨å…¥å®Œæˆï¼Œæ‰§è¡Œ <code>@PostConstruct</code> ç­‰åˆå§‹åŒ–é€»è¾‘ã€‚</li>
<li>B å®Œå…¨åˆ›å»ºå®Œæˆï¼Œä»Žä¸‰çº§ç¼“å­˜ç§»é™¤ï¼Œæ”¾å…¥ä¸€çº§ç¼“å­˜ã€‚</li>
</ul>
<p>ç¬¬ 5 æ­¥ï¼šA å®Œæˆåˆå§‹åŒ–ã€‚</p>
<ul>
<li>å›žåˆ° A çš„åˆ›å»ºè¿‡ç¨‹ï¼ŒA æ‹¿åˆ°å®Œæ•´çš„ B å®žä¾‹ï¼Œå®Œæˆå±žæ€§æ³¨å…¥ã€‚</li>
<li>A æ‰§è¡Œåˆå§‹åŒ–é€»è¾‘ï¼Œåˆ›å»ºå®Œæˆã€‚</li>
<li>A ä»ŽäºŒçº§ç¼“å­˜ç§»é™¤ï¼Œæ”¾å…¥ä¸€çº§ç¼“å­˜ã€‚</li>
</ul>
<p><img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="https://cdn.jsdelivr.net/gh/JakicDong/blog-assets@main/images/20251022165435.png" alt="20251022165435"><br>ä¸‰åˆ†æ¶é¢æ¸£é€†è¢­ï¼šAB éƒ½å¥½äº†</p>
<p>ç”¨ä»£ç æ¥æ¨¡æ‹Ÿè¿™ä¸ªè¿‡ç¨‹ï¼Œæ˜¯è¿™æ ·çš„ï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// æ¨¡æ‹ŸSpringçš„è§£å†³è¿‡ç¨‹</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">CircularDependencyDemo</span> &#123;</span><br><span class="line">    <span class="comment">// ä¸‰çº§ç¼“å­˜</span></span><br><span class="line">    Map&lt;String, Object&gt; singletonObjects = <span class="keyword">new</span> <span class="title class_">HashMap</span>&lt;&gt;();</span><br><span class="line">    Map&lt;String, Object&gt; earlySingletonObjects = <span class="keyword">new</span> <span class="title class_">HashMap</span>&lt;&gt;();</span><br><span class="line">    Map&lt;String, ObjectFactory&gt; singletonFactories = <span class="keyword">new</span> <span class="title class_">HashMap</span>&lt;&gt;();</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">public</span> Object <span class="title function_">getBean</span><span class="params">(String beanName)</span> &#123;</span><br><span class="line">        <span class="comment">// å…ˆä»Žä¸€çº§ç¼“å­˜èŽ·å–</span></span><br><span class="line">        <span class="type">Object</span> <span class="variable">bean</span> <span class="operator">=</span> singletonObjects.get(beanName);</span><br><span class="line">        <span class="keyword">if</span> (bean != <span class="literal">null</span>) <span class="keyword">return</span> bean;</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// å†ä»ŽäºŒçº§ç¼“å­˜èŽ·å–</span></span><br><span class="line">        bean = earlySingletonObjects.get(beanName);</span><br><span class="line">        <span class="keyword">if</span> (bean != <span class="literal">null</span>) <span class="keyword">return</span> bean;</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// æœ€åŽä»Žä¸‰çº§ç¼“å­˜èŽ·å–</span></span><br><span class="line">        <span class="type">ObjectFactory</span> <span class="variable">factory</span> <span class="operator">=</span> singletonFactories.get(beanName);</span><br><span class="line">        <span class="keyword">if</span> (factory != <span class="literal">null</span>) &#123;</span><br><span class="line">            bean = factory.getObject();</span><br><span class="line">            earlySingletonObjects.put(beanName, bean);  <span class="comment">// ç§»åˆ°äºŒçº§ç¼“å­˜</span></span><br><span class="line">            singletonFactories.remove(beanName);        <span class="comment">// ä»Žä¸‰çº§ç¼“å­˜ç§»é™¤</span></span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">return</span> bean;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="å“ªäº›æƒ…å†µä¸‹Springæ— æ³•è§£å†³å¾ªçŽ¯ä¾èµ–ï¼Ÿ"><a href="#å“ªäº›æƒ…å†µä¸‹Springæ— æ³•è§£å†³å¾ªçŽ¯ä¾èµ–ï¼Ÿ" class="headerlink" title="å“ªäº›æƒ…å†µä¸‹Springæ— æ³•è§£å†³å¾ªçŽ¯ä¾èµ–ï¼Ÿ"></a>å“ªäº›æƒ…å†µä¸‹Springæ— æ³•è§£å†³å¾ªçŽ¯ä¾èµ–ï¼Ÿ</h4><p>Spring è™½ç„¶èƒ½è§£å†³å¤§éƒ¨åˆ†å¾ªçŽ¯ä¾èµ–é—®é¢˜ï¼Œä½†ç¡®å®žæœ‰å‡ ç§æƒ…å†µæ˜¯æ— æ³•å¤„ç†çš„ï¼Œæˆ‘æ¥è¯¦ç»†è¯´è¯´ã€‚</p>
<p><img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="https://cdn.jsdelivr.net/gh/JakicDong/blog-assets@main/images/20251022165456.png" alt="20251022165456"><br>ä¸‰åˆ†æ¶é¢æ¸£é€†è¢­ï¼šå¾ªçŽ¯ä¾èµ–çš„å‡ ç§æƒ…å½¢</p>
<p>ç¬¬ä¸€ç§ï¼Œæž„é€ æ–¹æ³•çš„å¾ªçŽ¯ä¾èµ–ï¼Œè¿™ç§æƒ…å†µ Spring ä¼šç›´æŽ¥æŠ›å‡º BeanCurrentlyInCreationException å¼‚å¸¸ã€‚</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">A</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> B b;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">A</span><span class="params">(B b)</span> &#123;  <span class="comment">// æž„é€ æ–¹æ³•æ³¨å…¥</span></span><br><span class="line">        <span class="built_in">this</span>.b = b;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">B</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> A a;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">B</span><span class="params">(A a)</span> &#123;  <span class="comment">// æž„é€ æ–¹æ³•æ³¨å…¥</span></span><br><span class="line">        <span class="built_in">this</span>.a = a;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>å› ä¸ºæž„é€ æ–¹æ³•æ³¨å…¥å‘ç”Ÿåœ¨å®žä¾‹åŒ–é˜¶æ®µï¼Œåˆ›å»º A çš„æ—¶å€™å¿…é¡»å…ˆæœ‰ Bï¼Œä½†åˆ›å»º Båˆå¿…é¡»å…ˆæœ‰ Aï¼Œè¿™æ—¶å€™ä¸¤ä¸ªå¯¹è±¡éƒ½è¿˜æ²¡åˆ›å»ºå‡ºæ¥ï¼Œæ— æ³•æå‰æš´éœ²åˆ°ç¼“å­˜ä¸­ã€‚</p>
<p>ç¬¬äºŒç§ï¼Œprototype ä½œç”¨åŸŸçš„å¾ªçŽ¯ä¾èµ–ã€‚prototype ä½œç”¨åŸŸçš„ Bean æ¯æ¬¡èŽ·å–éƒ½ä¼šåˆ›å»ºæ–°å®žä¾‹ï¼ŒSpring æ— æ³•ç¼“å­˜è¿™äº›å®žä¾‹ï¼Œæ‰€ä»¥ä¹Ÿæ— æ³•è§£å†³å¾ªçŽ¯ä¾èµ–ã€‚</p>
<p>-â€”é¢è¯•ä¸­å¯ä»¥ä¸èƒŒï¼Œæ–¹ä¾¿å¤§å®¶ç†è§£ startâ€”-</p>
<p>æˆ‘ä»¬æ¥çœ‹ä¸€ä¸ªå®žä¾‹ï¼Œå…ˆæ˜¯ PrototypeBeanAï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="meta">@Scope(&quot;prototype&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">PrototypeBeanA</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> PrototypeBeanB prototypeBeanB;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">PrototypeBeanA</span><span class="params">(PrototypeBeanB prototypeBeanB)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.prototypeBeanB = prototypeBeanB;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>ç„¶åŽæ˜¯ PrototypeBeanBï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="meta">@Scope(&quot;prototype&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">PrototypeBeanB</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> PrototypeBeanA prototypeBeanA;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">PrototypeBeanB</span><span class="params">(PrototypeBeanA prototypeBeanA)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.prototypeBeanA = prototypeBeanA;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>å†ç„¶åŽæ˜¯æµ‹è¯•ï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@SpringBootApplication</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">DemoApplication</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        SpringApplication.run(DemoApplication.class, args);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    CommandLineRunner <span class="title function_">commandLineRunner</span><span class="params">(ApplicationContext ctx)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> args -&gt; &#123;</span><br><span class="line">            <span class="comment">// å°è¯•èŽ·å–PrototypeBeanAçš„å®žä¾‹</span></span><br><span class="line">            <span class="type">PrototypeBeanA</span> <span class="variable">beanA</span> <span class="operator">=</span> ctx.getBean(PrototypeBeanA.class);</span><br><span class="line">        &#125;;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>è¿è¡Œç»“æžœï¼š</p>
<p><img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="https://cdn.jsdelivr.net/gh/JakicDong/blog-assets@main/images/20251022165524.png" alt="20251022165524"><br>äºŒå“¥çš„ Java è¿›é˜¶ä¹‹è·¯ï¼šå¾ªçŽ¯ä¾èµ–</p>
<p>-â€”é¢è¯•ä¸­å¯ä»¥ä¸èƒŒï¼Œæ–¹ä¾¿å¤§å®¶ç†è§£ endâ€”-</p>
<blockquote>
<ol>
<li><a target="_blank" rel="noopener" href="https://javabetter.cn/zhishixingqiu/mianshi.html">Java é¢è¯•æŒ‡å—ï¼ˆä»˜è´¹ï¼‰</a>æ”¶å½•çš„å°ç±³ 25 å±Šæ—¥å¸¸å®žä¹ ä¸€é¢åŽŸé¢˜ï¼šå¦‚ä½•è§£å†³å¾ªçŽ¯ä¾èµ–ï¼Ÿ</li>
<li><a target="_blank" rel="noopener" href="https://javabetter.cn/zhishixingqiu/mianshi.html">Java é¢è¯•æŒ‡å—ï¼ˆä»˜è´¹ï¼‰</a>æ”¶å½•çš„ç™¾åº¦é¢ç»åŒå­¦ 1 æ–‡å¿ƒä¸€è¨€ 25 å®žä¹  Java åŽç«¯é¢è¯•åŽŸé¢˜ï¼šSpringå¦‚ä½•è§£å†³å¾ªçŽ¯ä¾èµ–ï¼Ÿ</li>
<li><a target="_blank" rel="noopener" href="https://javabetter.cn/zhishixingqiu/mianshi.html">Java é¢è¯•æŒ‡å—ï¼ˆä»˜è´¹ï¼‰</a>æ”¶å½•çš„å¾—ç‰©é¢ç»åŒå­¦ 9 é¢è¯•é¢˜ç›®åŽŸé¢˜ï¼šSpringæºç çœ‹è¿‡å—ï¼ŸSpringçš„ä¸‰çº§ç¼“å­˜çŸ¥é“å—ï¼Ÿ</li>
<li><a target="_blank" rel="noopener" href="https://javabetter.cn/zhishixingqiu/mianshi.html">Java é¢è¯•æŒ‡å—ï¼ˆä»˜è´¹ï¼‰</a>æ”¶å½•çš„é˜¿é‡Œäº‘é¢ç»åŒå­¦ 22 é¢ç»ï¼šspringä¸‰çº§ç¼“å­˜è§£å†³å¾ªçŽ¯ä¾èµ–é—®é¢˜</li>
</ol>
</blockquote>
<h3 id="16-ðŸŒŸè¯´ä¸€è¯´ä»€ä¹ˆæ˜¯IoCï¼Ÿ"><a href="#16-ðŸŒŸè¯´ä¸€è¯´ä»€ä¹ˆæ˜¯IoCï¼Ÿ" class="headerlink" title="16.ðŸŒŸè¯´ä¸€è¯´ä»€ä¹ˆæ˜¯IoCï¼Ÿ"></a>16.ðŸŒŸè¯´ä¸€è¯´ä»€ä¹ˆæ˜¯IoCï¼Ÿ</h3><p>æŽ¨èé˜…è¯»ï¼š<a target="_blank" rel="noopener" href="https://javabetter.cn/springboot/ioc.html">IoC æ‰«ç›²</a></p>
<p>IoC çš„å…¨ç§°æ˜¯ Inversion of Controlï¼Œä¹Ÿå°±æ˜¯æŽ§åˆ¶åè½¬ã€‚è¿™é‡Œçš„â€œæŽ§åˆ¶â€æŒ‡çš„æ˜¯å¯¹è±¡åˆ›å»ºå’Œä¾èµ–å…³ç³»ç®¡ç†çš„æŽ§åˆ¶æƒã€‚</p>
<p><img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="https://cdn.jsdelivr.net/gh/JakicDong/blog-assets@main/images/20251022165715.png" alt="20251022165715"><br>å›¾ç‰‡æ¥æºäºŽç½‘ç»œï¼šIoC</p>
<p>ä»¥å‰æˆ‘ä»¬å†™ä»£ç çš„æ—¶å€™ï¼Œå¦‚æžœ A ç±»éœ€è¦ç”¨åˆ° B ç±»ï¼Œæˆ‘ä»¬å°±åœ¨ A ç±»é‡Œé¢ç›´æŽ¥ new ä¸€ä¸ª B å¯¹è±¡å‡ºæ¥ï¼Œè¿™æ · A ç±»å°±æŽ§åˆ¶äº† B ç±»å¯¹è±¡çš„åˆ›å»ºã€‚</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// ä¼ ç»Ÿæ–¹å¼ï¼šå¯¹è±¡ä¸»åŠ¨åˆ›å»ºä¾èµ–</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">UserService</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> UserDao userDao;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">UserService</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="comment">// ä¸»åŠ¨åˆ›å»ºä¾èµ–å¯¹è±¡</span></span><br><span class="line">        <span class="built_in">this</span>.userDao = <span class="keyword">new</span> <span class="title class_">UserDaoImpl</span>();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>æœ‰äº† IoC ä¹‹åŽï¼Œè¿™ä¸ªæŽ§åˆ¶æƒå°±â€œåè½¬â€äº†ï¼Œä¸å†ç”± A ç±»æ¥æŽ§åˆ¶ B å¯¹è±¡çš„åˆ›å»ºï¼Œè€Œæ˜¯äº¤ç»™å¤–éƒ¨çš„å®¹å™¨æ¥ç®¡ç†ã€‚</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/** </span></span><br><span class="line"><span class="comment"> * ä½¿ç”¨ Spring IoC å®¹å™¨æ¥ç®¡ç† UserDao çš„åˆ›å»ºå’Œæ³¨å…¥</span></span><br><span class="line"><span class="comment"> * æŠ€æœ¯æ´¾æºç ï¼šhttps://github.com/itwanger/paicoding</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Service</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">UserServiceImpl</span> <span class="keyword">implements</span> <span class="title class_">UserService</span> &#123;</span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> UserDao userDao;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// ä¸éœ€è¦ä¸»åŠ¨åˆ›å»º UserDaoï¼Œç”± Spring å®¹å™¨æ³¨å…¥</span></span><br><span class="line">    <span class="keyword">public</span> BaseUserInfoDTO <span class="title function_">getAndUpdateUserIpInfoBySessionId</span><span class="params">(String session, String clientIp)</span> &#123;</span><br><span class="line">        <span class="comment">// ç›´æŽ¥ä½¿ç”¨æ³¨å…¥çš„ userDao</span></span><br><span class="line">        <span class="keyword">return</span> userDao.getBySessionId(session);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>-â€”è¿™éƒ¨åˆ†é¢è¯•ä¸­å¯ä»¥ä¸èƒŒ startâ€”-</p>
<p>æ²¡æœ‰ IoC ä¹‹å‰ï¼š</p>
<blockquote>
<p>æˆ‘éœ€è¦ä¸€ä¸ªå¥³æœ‹å‹ï¼Œåˆšå¥½å¤§è¡—ä¸Šçªç„¶çœ‹åˆ°äº†ä¸€ä¸ªå°å§å§ï¼Œäººå¾ˆå¥½çœ‹ï¼ŒäºŽæ˜¯æˆ‘å°±è‡ªå·±ä¸»åŠ¨ä¸ŠåŽ»æ­è®ªï¼Œè¦å¥¹çš„å¾®ä¿¡å·ï¼Œæ‰¾æœºä¼šèŠå¤©å…³å¿ƒå¥¹ï¼Œç„¶åŽçº¦å¥¹å‡ºæ¥åƒé¥­ï¼Œæ‰“å¬å¥¹çš„çˆ±å¥½ï¼Œä¸‰è§‚ã€‚ã€‚ã€‚</p>
</blockquote>
<p>æœ‰äº† IoC ä¹‹åŽï¼š</p>
<blockquote>
<p>æˆ‘éœ€è¦ä¸€ä¸ªå¥³æœ‹å‹ï¼ŒäºŽæ˜¯æˆ‘å°±åŽ»æ‰¾å©šä»‹æ‰€ï¼Œå‘Šè¯‰å©šä»‹æ‰€ï¼Œæˆ‘éœ€è¦ä¸€ä¸ªé•¿çš„åƒèµµéœ²æ€çš„ï¼Œä¼šæ‰“ Dota2 çš„ï¼ŒäºŽæ˜¯å©šä»‹æ‰€åœ¨å®ƒçš„äººæ‰åº“é‡Œå¼€å§‹æ‰¾ï¼Œæ‰¾ä¸åˆ°å®ƒå°±ç›´æŽ¥è¯´æ²¡æœ‰ï¼Œæ‰¾åˆ°å®ƒå°±ç›´æŽ¥ä»‹ç»ç»™æˆ‘ã€‚</p>
</blockquote>
<p>å©šä»‹æ‰€å°±ç›¸å½“äºŽä¸€ä¸ª IoC å®¹å™¨ï¼Œæˆ‘å°±æ˜¯ä¸€ä¸ªå¯¹è±¡ï¼Œæˆ‘éœ€è¦çš„å¥³æœ‹å‹å°±æ˜¯å¦ä¸€ä¸ªå¯¹è±¡ï¼Œæˆ‘ä¸ç”¨å…³å¿ƒå¥³æœ‹å‹æ˜¯æ€Žä¹ˆæ¥çš„ï¼Œæˆ‘åªéœ€è¦å‘Šè¯‰å©šä»‹æ‰€æˆ‘éœ€è¦ä»€ä¹ˆæ ·çš„å¥³æœ‹å‹ï¼Œå©šä»‹æ‰€å°±å¸®æˆ‘åŽ»æ‰¾ã€‚</p>
<p><img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="https://cdn.jsdelivr.net/gh/JakicDong/blog-assets@main/images/20251022165731.png" alt="20251022165731"><br>ä¸‰åˆ†æ¶é¢æ¸£é€†è¢­ï¼šå¼•å…¥IoCä¹‹å‰å’Œå¼•å…¥IoCä¹‹åŽ</p>
<p>-â€”è¿™éƒ¨åˆ†é¢è¯•ä¸­å¯ä»¥ä¸èƒŒ endâ€”-</p>
<h4 id="DIå’ŒIoCçš„åŒºåˆ«äº†è§£å—ï¼Ÿ"><a href="#DIå’ŒIoCçš„åŒºåˆ«äº†è§£å—ï¼Ÿ" class="headerlink" title="DIå’ŒIoCçš„åŒºåˆ«äº†è§£å—ï¼Ÿ"></a>DIå’ŒIoCçš„åŒºåˆ«äº†è§£å—ï¼Ÿ</h4><p>IoC çš„æ€æƒ³æ˜¯æŠŠå¯¹è±¡åˆ›å»ºå’Œä¾èµ–å…³ç³»çš„æŽ§åˆ¶æƒç”±ä¸šåŠ¡ä»£ç è½¬ç§»ç»™ Spring å®¹å™¨ã€‚è¿™æ˜¯ä¸€ä¸ªæ¯”è¾ƒæŠ½è±¡çš„æ¦‚å¿µï¼Œå‘Šè¯‰æˆ‘ä»¬åº”è¯¥æ€Žä¹ˆåŽ»è®¾è®¡ç³»ç»Ÿæž¶æž„ã€‚</p>
<p><img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="https://cdn.jsdelivr.net/gh/JakicDong/blog-assets@main/images/20251022165745.png" alt="20251022165745"><br>Martin Fowlerâ€™s Definition</p>
<p>è€Œ DIï¼Œä¹Ÿå°±æ˜¯ä¾èµ–æ³¨å…¥ï¼Œå®ƒæ˜¯å®žçŽ° IoC è¿™ç§æ€æƒ³çš„å…·ä½“æŠ€æœ¯æ‰‹æ®µã€‚åœ¨ Spring é‡Œï¼Œæˆ‘ä»¬ç”¨ <code>@Autowired</code> æ³¨è§£å°±æ˜¯åœ¨ä½¿ç”¨ DI çš„å­—æ®µæ³¨å…¥æ–¹å¼ã€‚</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Service</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ArticleReadServiceImpl</span> <span class="keyword">implements</span> <span class="title class_">ArticleReadService</span> &#123;</span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> ArticleDao articleDao;  <span class="comment">// å­—æ®µæ³¨å…¥</span></span><br><span class="line">    </span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> UserDao userDao;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>ä»Žå®žçŽ°è§’åº¦æ¥çœ‹ï¼ŒDI é™¤äº†å­—æ®µæ³¨å…¥ï¼Œè¿˜æœ‰æž„é€ æ–¹æ³•æ³¨å…¥å’Œ Setter æ–¹æ³•æ³¨å…¥ç­‰æ–¹å¼ã€‚åœ¨åš<a target="_blank" rel="noopener" href="https://javabetter.cn/zhishixingqiu/paicoding.html">æŠ€æœ¯æ´¾</a>é¡¹ç›®çš„æ—¶å€™ï¼Œæˆ‘å°±å°è¯•è¿‡æž„é€ æ–¹æ³•æ³¨å…¥çš„æ–¹å¼ã€‚</p>
<p><img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="https://cdn.jsdelivr.net/gh/JakicDong/blog-assets@main/images/20251022165756.png" alt="20251022165756"><br>æŠ€æœ¯æ´¾æºç ï¼šæž„é€ æ–¹æ³•çš„æ³¨å…¥æ–¹å¼</p>
<p>å½“ç„¶äº†ï¼ŒDI å¹¶ä¸æ˜¯å®žçŽ° IoC çš„å”¯ä¸€æ–¹å¼ï¼Œè¿˜æœ‰ Service Locator æ¨¡å¼ï¼Œå¯ä»¥é€šè¿‡å®žçŽ° ApplicationContextAware æŽ¥å£æ¥èŽ·å– Spring å®¹å™¨ä¸­çš„ Beanã€‚</p>
<p><img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="https://cdn.jsdelivr.net/gh/JakicDong/blog-assets@main/images/20251022165805.png" alt="20251022165805"><br>æŠ€æœ¯æ´¾æºç ï¼šIoC çš„Service Locator æ¨¡å¼</p>
<p>ä¹‹æ‰€ä»¥ ID åŽæˆä¸º IoC çš„é¦–é€‰å®žçŽ°æ–¹å¼ï¼Œæ˜¯å› ä¸ºä»£ç æ›´æ¸…æ™°ã€å¯è¯»æ€§æ›´é«˜ã€‚</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">IoCï¼ˆæŽ§åˆ¶åè½¬ï¼‰</span><br><span class="line">â”œâ”€â”€ DIï¼ˆä¾èµ–æ³¨å…¥ï¼‰          â† ä¸»è¦å®žçŽ°æ–¹å¼</span><br><span class="line">â”‚   â”œâ”€â”€ æž„é€ å™¨æ³¨å…¥</span><br><span class="line">â”‚   â”œâ”€â”€ å­—æ®µæ³¨å…¥</span><br><span class="line">â”‚   â””â”€â”€ Setteræ³¨å…¥</span><br><span class="line">â”œâ”€â”€ æœåŠ¡å®šä½å™¨æ¨¡å¼</span><br><span class="line">â”œâ”€â”€ å·¥åŽ‚æ¨¡å¼</span><br><span class="line">â””â”€â”€ å…¶ä»–å®žçŽ°æ–¹å¼</span><br></pre></td></tr></table></figure>

<h4 id="ä¸ºä»€ä¹ˆè¦ä½¿ç”¨-IoC-å‘¢ï¼Ÿ"><a href="#ä¸ºä»€ä¹ˆè¦ä½¿ç”¨-IoC-å‘¢ï¼Ÿ" class="headerlink" title="ä¸ºä»€ä¹ˆè¦ä½¿ç”¨ IoC å‘¢ï¼Ÿ"></a>ä¸ºä»€ä¹ˆè¦ä½¿ç”¨ IoC å‘¢ï¼Ÿ</h4><p>åœ¨æ—¥å¸¸å¼€å‘ä¸­ï¼Œå¦‚æžœæˆ‘ä»¬éœ€è¦å®žçŽ°æŸä¸€ä¸ªåŠŸèƒ½ï¼Œå¯èƒ½è‡³å°‘éœ€è¦ä¸¤ä¸ªä»¥ä¸Šçš„å¯¹è±¡æ¥ååŠ©å®Œæˆï¼Œåœ¨æ²¡æœ‰ Spring ä¹‹å‰ï¼Œæ¯ä¸ªå¯¹è±¡åœ¨éœ€è¦å®ƒçš„åˆä½œå¯¹è±¡æ—¶ï¼Œéœ€è¦è‡ªå·± new ä¸€ä¸ªï¼Œæ¯”å¦‚è¯´ A è¦ä½¿ç”¨ Bï¼ŒA å°±å¯¹ B äº§ç”Ÿäº†ä¾èµ–ï¼Œä¹Ÿå°±æ˜¯ A å’Œ B ä¹‹é—´å­˜åœ¨äº†ä¸€ç§è€¦åˆå…³ç³»ã€‚</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// ä¼ ç»Ÿæ–¹å¼ï¼šå¯¹è±¡è‡ªå·±åˆ›å»ºä¾èµ–</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">UserService</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="type">UserDao</span> <span class="variable">userDao</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">UserDaoImpl</span>(); <span class="comment">// ç¡¬ç¼–ç ä¾èµ–</span></span><br><span class="line">    </span><br><span class="line">    <span class="keyword">public</span> User <span class="title function_">getUser</span><span class="params">(Long id)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> userDao.findById(id);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>æœ‰äº† Spring ä¹‹åŽï¼Œåˆ›å»º B çš„å·¥ä½œäº¤ç»™äº† Spring æ¥å®Œæˆï¼ŒSpring åˆ›å»ºå¥½äº† B å¯¹è±¡åŽå°±æ”¾åˆ°å®¹å™¨ä¸­ï¼ŒA å‘Šè¯‰ Spring æˆ‘éœ€è¦ Bï¼ŒSpring å°±ä»Žå®¹å™¨ä¸­å–å‡º B äº¤ç»™ A æ¥ä½¿ç”¨ã€‚</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// IoC æ–¹å¼ï¼šä¾èµ–ç”±å¤–éƒ¨æ³¨å…¥</span></span><br><span class="line"><span class="meta">@Service</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">UserServiceImpl</span> <span class="keyword">implements</span> <span class="title class_">UserService</span> &#123;</span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> UserDao userDao; <span class="comment">// ä¾èµ–æ³¨å…¥ï¼Œä¸å…³å¿ƒå…·ä½“å®žçŽ°</span></span><br><span class="line">    </span><br><span class="line">    <span class="keyword">public</span> User <span class="title function_">getUser</span><span class="params">(Long id)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> userDao.findById(id);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>è‡³äºŽ B æ˜¯æ€Žä¹ˆæ¥çš„ï¼ŒA å°±ä¸å†å…³å¿ƒäº†ï¼ŒSpring å®¹å™¨æƒ³é€šè¿‡ newnew åˆ›å»º B è¿˜æ˜¯ new åˆ›å»º Bï¼Œæ— æ‰€è°“ã€‚</p>
<p>è¿™å°±æ˜¯ IoC çš„å¥½å¤„ï¼Œå®ƒé™ä½Žäº†å¯¹è±¡ä¹‹é—´çš„è€¦åˆåº¦ï¼Œè®©æ¯ä¸ªå¯¹è±¡åªå…³æ³¨è‡ªå·±çš„ä¸šåŠ¡å®žçŽ°ï¼Œä¸å…³å¿ƒå…¶ä»–å¯¹è±¡æ˜¯æ€Žä¹ˆåˆ›å»ºçš„ã€‚</p>
<p>æŽ¨èé˜…è¯»ï¼š<a target="_blank" rel="noopener" href="https://www.cnblogs.com/xdp-gacl/p/4249939.html">å­¤å‚²è‹ç‹¼ï¼šè°ˆè°ˆå¯¹ Spring IOC çš„ç†è§£</a></p>
<blockquote>
<ol>
<li><a target="_blank" rel="noopener" href="https://javabetter.cn/zhishixingqiu/mianshi.html">Java é¢è¯•æŒ‡å—ï¼ˆä»˜è´¹ï¼‰</a>æ”¶å½•çš„å°ç±³ 25 å±Šæ—¥å¸¸å®žä¹ ä¸€é¢åŽŸé¢˜ï¼šè¯´è¯´ä½ å¯¹ AOP å’Œ IoC çš„ç†è§£ã€‚</li>
<li><a target="_blank" rel="noopener" href="https://javabetter.cn/zhishixingqiu/mianshi.html">Java é¢è¯•æŒ‡å—ï¼ˆä»˜è´¹ï¼‰</a>æ”¶å½•çš„å°å…¬å¸é¢ç»åˆé›†åŒå­¦ 1 Java åŽç«¯é¢è¯•åŽŸé¢˜ï¼šä»‹ç» Spring IoC å’Œ AOP?</li>
<li><a target="_blank" rel="noopener" href="https://javabetter.cn/zhishixingqiu/mianshi.html">Java é¢è¯•æŒ‡å—ï¼ˆä»˜è´¹ï¼‰</a>æ”¶å½•çš„æ‹›å•†é“¶è¡Œé¢ç»åŒå­¦ 6 æ‹›é“¶ç½‘ç»œç§‘æŠ€é¢è¯•åŽŸé¢˜ï¼šSpringBootæ¡†æž¶çš„AOPã€IOC&#x2F;DIï¼Ÿ</li>
<li><a target="_blank" rel="noopener" href="https://javabetter.cn/zhishixingqiu/mianshi.html">Java é¢è¯•æŒ‡å—ï¼ˆä»˜è´¹ï¼‰</a>æ”¶å½•çš„äº¬ä¸œé¢ç»åŒå­¦ 8 é¢è¯•åŽŸé¢˜ï¼šIOCï¼ŒAOP</li>
<li><a target="_blank" rel="noopener" href="https://javabetter.cn/zhishixingqiu/mianshi.html">Java é¢è¯•æŒ‡å—ï¼ˆä»˜è´¹ï¼‰</a>æ”¶å½•çš„å¿«æ‰‹åŒå­¦ 4 ä¸€é¢åŽŸé¢˜ï¼šè§£é‡Šä¸‹ä»€ä¹ˆæ˜¯IOCå’ŒAOPï¼Ÿåˆ†åˆ«è§£å†³äº†ä»€ä¹ˆé—®é¢˜ï¼ŸIOCå’ŒDIçš„åŒºåˆ«ï¼Ÿ</li>
</ol>
</blockquote>
<h3 id="19-ðŸŒŸé¡¹ç›®å¯åŠ¨æ—¶Springçš„IoCä¼šåšä»€ä¹ˆï¼Ÿ"><a href="#19-ðŸŒŸé¡¹ç›®å¯åŠ¨æ—¶Springçš„IoCä¼šåšä»€ä¹ˆï¼Ÿ" class="headerlink" title="19.ðŸŒŸé¡¹ç›®å¯åŠ¨æ—¶Springçš„IoCä¼šåšä»€ä¹ˆï¼Ÿ"></a>19.ðŸŒŸé¡¹ç›®å¯åŠ¨æ—¶Springçš„IoCä¼šåšä»€ä¹ˆï¼Ÿ</h3><p>ç¬¬ä¸€ä»¶äº‹æ˜¯æ‰«æå’Œæ³¨å†Œ Beanã€‚IoC å®¹å™¨ä¼šæ ¹æ®æˆ‘ä»¬çš„é…ç½®ï¼Œæ¯”å¦‚ <code>@ComponentScan</code> æŒ‡å®šçš„åŒ…è·¯å¾„ï¼ŒåŽ»æ‰«ææ‰€æœ‰æ ‡æ³¨äº† <code>@Component</code>ã€<code>@Service</code>ã€<code>@Controller</code> è¿™äº›æ³¨è§£çš„ç±»ã€‚ç„¶åŽæŠŠè¿™äº›ç±»çš„å…ƒä¿¡æ¯åŒ…è£…æˆ BeanDefinition å¯¹è±¡ï¼Œæ³¨å†Œåˆ°å®¹å™¨çš„ BeanDefinitionRegistry ä¸­ã€‚è¿™ä¸ªé˜¶æ®µåªæ˜¯æ”¶é›†ä¿¡æ¯ï¼Œè¿˜æ²¡æœ‰çœŸæ­£åˆ›å»ºå¯¹è±¡ã€‚</p>
<p><img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="https://cdn.jsdelivr.net/gh/JakicDong/blog-assets@main/images/20251024162351.png" alt="20251024162351"><br>pdai.techï¼šIoC</p>
<p>ç¬¬äºŒä»¶äº‹æ˜¯ Bean çš„å®žä¾‹åŒ–å’Œæ³¨å…¥ã€‚è¿™æ˜¯æœ€æ ¸å¿ƒçš„è¿‡ç¨‹ï¼ŒIoC å®¹å™¨ä¼šæŒ‰ç…§ä¾èµ–å…³ç³»çš„é¡ºåºå¼€å§‹åˆ›å»º Bean å®žä¾‹ã€‚å¯¹äºŽå•ä¾‹ Beanï¼Œå®¹å™¨ä¼šé€šè¿‡åå°„è°ƒç”¨æž„é€ æ–¹æ³•åˆ›å»ºå®žä¾‹ï¼Œç„¶åŽè¿›è¡Œå±žæ€§æ³¨å…¥ï¼Œæœ€åŽæ‰§è¡Œåˆå§‹åŒ–å›žè°ƒæ–¹æ³•ã€‚</p>
<p><img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="https://cdn.jsdelivr.net/gh/JakicDong/blog-assets@main/images/20251024162423.png" alt="20251024162423"><br>Tomå¼¹æž¶æž„ï¼šBean çš„å®žä¾‹åŒ–å’Œæ³¨å…¥</p>
<p>åœ¨ä¾èµ–æ³¨å…¥æ—¶ï¼Œå®¹å™¨ä¼šæ ¹æ® <code>@Autowired</code>ã€<code>@Resource</code> è¿™äº›æ³¨è§£ï¼ŒæŠŠç›¸åº”çš„ä¾èµ–å¯¹è±¡æ³¨å…¥åˆ°ç›®æ ‡ Bean ä¸­ã€‚æ¯”å¦‚ UserService éœ€è¦ UserDaoï¼Œå®¹å™¨å°±ä¼šæŠŠ UserDao çš„å®žä¾‹æ³¨å…¥åˆ° UserService ä¸­ã€‚</p>
<h4 id="è¯´è¯´Springçš„Beanå®žä¾‹åŒ–æ–¹å¼ï¼Ÿ"><a href="#è¯´è¯´Springçš„Beanå®žä¾‹åŒ–æ–¹å¼ï¼Ÿ" class="headerlink" title="è¯´è¯´Springçš„Beanå®žä¾‹åŒ–æ–¹å¼ï¼Ÿ"></a>è¯´è¯´Springçš„Beanå®žä¾‹åŒ–æ–¹å¼ï¼Ÿ</h4><p>Spring æä¾›äº† 4 ç§æ–¹å¼æ¥å®žä¾‹åŒ– Beanï¼Œä»¥æ»¡è¶³ä¸åŒåœºæ™¯ä¸‹çš„éœ€æ±‚ã€‚</p>
<p>ç¬¬ä¸€ç§æ˜¯é€šè¿‡æž„é€ æ–¹æ³•å®žä¾‹åŒ–ï¼Œè¿™æ˜¯æœ€å¸¸ç”¨çš„æ–¹å¼ã€‚å½“æˆ‘ä»¬ç”¨ <code>@Component</code>ã€<code>@Service</code> è¿™äº›æ³¨è§£æ ‡æ³¨ç±»çš„æ—¶å€™ï¼ŒSpring é»˜è®¤é€šè¿‡æ— å‚æž„é€ å™¨æ¥åˆ›å»ºå®žä¾‹çš„ã€‚å¦‚æžœç±»åªæœ‰ä¸€ä¸ªæœ‰å‚æž„é€ æ–¹æ³•ï¼ŒSpring ä¼šè‡ªåŠ¨è¿›è¡Œæž„é€ æ–¹æ³•æ³¨å…¥ã€‚</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Service</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">UserService</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> UserDao userDao;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">UserService</span><span class="params">(UserDao userDao)</span> &#123;  <span class="comment">// æž„é€ æ–¹æ³•æ³¨å…¥</span></span><br><span class="line">        <span class="built_in">this</span>.userDao = userDao;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>ç¬¬äºŒç§æ˜¯é€šè¿‡é™æ€å·¥åŽ‚æ–¹æ³•å®žä¾‹åŒ–ã€‚æœ‰æ—¶å€™å¯¹è±¡çš„åˆ›å»ºæ¯”è¾ƒå¤æ‚ï¼Œæˆ‘ä»¬ä¼šå†™ä¸€ä¸ªé™æ€å·¥åŽ‚æ–¹æ³•æ¥åˆ›å»ºï¼Œç„¶åŽç”¨ <code>@Bean</code> æ³¨è§£æ¥æ ‡æ³¨è¿™ä¸ªæ–¹æ³•ã€‚Spring ä¼šè°ƒç”¨è¿™ä¸ªé™æ€æ–¹æ³•æ¥èŽ·å– Bean å®žä¾‹ã€‚</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">AppConfig</span> &#123;</span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> DataSource <span class="title function_">createDataSource</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="comment">// å¤æ‚çš„DataSourceåˆ›å»ºé€»è¾‘</span></span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">HikariDataSource</span>();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>ç¬¬ä¸‰ç§æ˜¯é€šè¿‡å®žä¾‹å·¥åŽ‚æ–¹æ³•å®žä¾‹åŒ–ã€‚è¿™ç§æ–¹å¼æ˜¯å…ˆåˆ›å»ºå·¥åŽ‚å¯¹è±¡ï¼Œç„¶åŽé€šè¿‡å·¥åŽ‚å¯¹è±¡çš„æ–¹æ³•æ¥åˆ›å»ºBeanï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">AppConfig</span> &#123;</span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="keyword">public</span> ConnectionFactory <span class="title function_">connectionFactory</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">ConnectionFactory</span>();</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="keyword">public</span> Connection <span class="title function_">createConnection</span><span class="params">(ConnectionFactory factory)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> factory.createConnection();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>ç¬¬å››ç§æ˜¯é€šè¿‡ FactoryBean æŽ¥å£å®žä¾‹åŒ–ã€‚è¿™æ˜¯ Spring æä¾›çš„ä¸€ä¸ªç‰¹æ®ŠæŽ¥å£ï¼Œå½“æˆ‘ä»¬éœ€è¦åˆ›å»ºå¤æ‚å¯¹è±¡çš„æ—¶å€™ç‰¹åˆ«æœ‰ç”¨ï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">MyFactoryBean</span> <span class="keyword">implements</span> <span class="title class_">FactoryBean</span>&lt;MyObject&gt; &#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> MyObject <span class="title function_">getObject</span><span class="params">()</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">        <span class="comment">// å¤æ‚çš„å¯¹è±¡åˆ›å»ºé€»è¾‘</span></span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">MyObject</span>();</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> Class&lt;?&gt; getObjectType() &#123;</span><br><span class="line">        <span class="keyword">return</span> MyObject.class;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>åœ¨å®žé™…å·¥ä½œä¸­ï¼Œç”¨å¾—æœ€å¤šçš„è¿˜æ˜¯æž„é€ æ–¹æ³•å®žä¾‹åŒ–ï¼Œå› ä¸ºç®€å•ç›´æŽ¥ã€‚å·¥åŽ‚æ–¹æ³•ä¸€èˆ¬ç”¨åœ¨éœ€è¦å¤æ‚åˆå§‹åŒ–é€»è¾‘çš„åœºæ™¯ï¼Œæ¯”å¦‚æ•°æ®åº“è¿žæŽ¥æ± ã€æ¶ˆæ¯é˜Ÿåˆ—è¿žæŽ¥è¿™äº›ã€‚FactoryBean ä¸»è¦æ˜¯åœ¨æ¡†æž¶å¼€å‘æˆ–è€…éœ€è¦åŠ¨æ€åˆ›å»ºå¯¹è±¡çš„æ—¶å€™ä½¿ç”¨ã€‚</p>
<p>Spring åœ¨å®žä¾‹åŒ–çš„æ—¶å€™ä¼šæ ¹æ® Bean çš„å®šä¹‰è‡ªåŠ¨é€‰æ‹©åˆé€‚çš„æ–¹å¼ï¼Œæˆ‘ä»¬ä½œä¸ºå¼€å‘è€…ä¸»è¦æ˜¯é€šè¿‡æ³¨è§£å’Œé…ç½®æ¥å‘Šè¯‰ Spring åº”è¯¥æ€Žä¹ˆåˆ›å»ºå¯¹è±¡ã€‚</p>
<blockquote>
<ol>
<li><a target="_blank" rel="noopener" href="https://javabetter.cn/zhishixingqiu/mianshi.html">Java é¢è¯•æŒ‡å—ï¼ˆä»˜è´¹ï¼‰</a>æ”¶å½•çš„åŽä¸ºé¢ç»åŒå­¦ 8 æŠ€æœ¯äºŒé¢é¢è¯•åŽŸé¢˜ï¼šè¯´è¯´ Spring çš„ Bean å®žä¾‹åŒ–æ–¹å¼</li>
<li><a target="_blank" rel="noopener" href="https://javabetter.cn/zhishixingqiu/mianshi.html">Java é¢è¯•æŒ‡å—ï¼ˆä»˜è´¹ï¼‰</a>æ”¶å½•çš„ç¾Žå›¢åŒå­¦ 2 ä¼˜é€‰ç‰©æµè°ƒåº¦æŠ€æœ¯ 2 é¢é¢è¯•åŽŸé¢˜ï¼šbeanåŠ å·¥æœ‰å“ªäº›æ–¹æ³•ï¼Ÿ</li>
</ol>
</blockquote>
<h3 id="20-ðŸŒŸè¯´è¯´ä»€ä¹ˆæ˜¯-AOPï¼Ÿ"><a href="#20-ðŸŒŸè¯´è¯´ä»€ä¹ˆæ˜¯-AOPï¼Ÿ" class="headerlink" title="20.ðŸŒŸè¯´è¯´ä»€ä¹ˆæ˜¯ AOPï¼Ÿ"></a>20.ðŸŒŸè¯´è¯´ä»€ä¹ˆæ˜¯ AOPï¼Ÿ</h3><p>AOPï¼Œä¹Ÿå°±æ˜¯é¢å‘åˆ‡é¢ç¼–ç¨‹ï¼Œç®€å•ç‚¹è¯´ï¼ŒAOP å°±æ˜¯æŠŠä¸€äº›ä¸šåŠ¡é€»è¾‘ä¸­çš„ç›¸åŒä»£ç æŠ½å–åˆ°ä¸€ä¸ªç‹¬ç«‹çš„æ¨¡å—ä¸­ï¼Œè®©ä¸šåŠ¡é€»è¾‘æ›´åŠ æ¸…çˆ½ã€‚</p>
<p><img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="https://cdn.jsdelivr.net/gh/JakicDong/blog-assets@main/images/20251024163612.png" alt="20251024163612"><br>ä¸‰åˆ†æ¶é¢æ¸£é€†è¢­ï¼šæ¨ªå‘æŠ½å–</p>
<p>-â€”è¿™éƒ¨åˆ†é¢è¯•ä¸­å¯ä»¥ä¸èƒŒï¼Œæ–¹ä¾¿å¤§å®¶ç†è§£ startâ€”-</p>
<p>ä¸¾ä¸ªç®€å•çš„ä¾‹å­ï¼Œå‡è®¾æˆ‘ä»¬æœ‰å¾ˆå¤šä¸ª Service æ–¹æ³•ï¼Œæ¯ä¸ªæ–¹æ³•éƒ½éœ€è¦è®°å½•æ‰§è¡Œæ—¥å¿—ã€æ£€æŸ¥æƒé™ã€ç®¡ç†äº‹åŠ¡ç­‰ç­‰ã€‚å¦‚æžœæ²¡æœ‰ AOP çš„è¯ï¼Œæˆ‘ä»¬å¯èƒ½éœ€è¦åœ¨æ¯ä¸ªæ–¹æ³•é‡Œéƒ½å†™è¿™æ ·çš„ä»£ç ï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">createUser</span><span class="params">(User user)</span> &#123;</span><br><span class="line">    log.info(<span class="string">&quot;å¼€å§‹æ‰§è¡ŒcreateUseræ–¹æ³•&quot;</span>);</span><br><span class="line">    <span class="comment">// æƒé™æ£€æŸ¥</span></span><br><span class="line">    <span class="keyword">if</span> (!hasPermission()) &#123;</span><br><span class="line">        <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">SecurityException</span>(<span class="string">&quot;æ— æƒé™&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// å¼€å¯äº‹åŠ¡</span></span><br><span class="line">    transactionManager.begin();</span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">        <span class="comment">// çœŸæ­£çš„ä¸šåŠ¡é€»è¾‘</span></span><br><span class="line">        userDao.save(user);</span><br><span class="line">        transactionManager.commit();</span><br><span class="line">        log.info(<span class="string">&quot;createUseræ–¹æ³•æ‰§è¡ŒæˆåŠŸ&quot;</span>);</span><br><span class="line">    &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">        transactionManager.rollback();</span><br><span class="line">        log.error(<span class="string">&quot;createUseræ–¹æ³•æ‰§è¡Œå¤±è´¥&quot;</span>, e);</span><br><span class="line">        <span class="keyword">throw</span> e;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>å¦‚æžœæ¯ä¸ªæ–¹æ³•éƒ½è¿™æ ·å†™ï¼Œä»£ç å°±ä¼šå˜å¾—éžå¸¸è‡ƒè‚¿ï¼ŒAOP å°±æ˜¯ä¸ºäº†è§£å†³è¿™ä¸ªé—®é¢˜ï¼Œå®ƒå¯ä»¥è®©æˆ‘ä»¬æŠŠè¿™äº›æ¨ªåˆ‡å…³æ³¨ç‚¹ï¼ˆå¦‚æ—¥å¿—ã€æƒé™ã€äº‹åŠ¡ç­‰ï¼‰ä»Žä¸šåŠ¡ä»£ç ä¸­æŠ½å–å‡ºæ¥ã€‚</p>
<p>è¿™æ ·ï¼Œæˆ‘ä»¬å°±å¯ä»¥å®šä¹‰ä¸€ä¸ªåˆ‡é¢ï¼Œåœ¨åˆ‡é¢ä¸­ç»Ÿä¸€å¤„ç†è¿™äº›æ¨ªåˆ‡å…³æ³¨ç‚¹ï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Aspect</span></span><br><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">LoggingAspect</span> &#123;</span><br><span class="line">    <span class="meta">@Before(&quot;execution(* com.example.service.*.*(..))&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">logBefore</span><span class="params">(JoinPoint joinPoint)</span> &#123;</span><br><span class="line">        log.info(<span class="string">&quot;å¼€å§‹æ‰§è¡Œæ–¹æ³•: &quot;</span> + joinPoint.getSignature().getName());</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="meta">@AfterReturning(&quot;execution(* com.example.service.*.*(..))&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">logAfterReturning</span><span class="params">(JoinPoint joinPoint)</span> &#123;</span><br><span class="line">        log.info(<span class="string">&quot;æ–¹æ³•æ‰§è¡ŒæˆåŠŸ: &quot;</span> + joinPoint.getSignature().getName());</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="meta">@AfterThrowing(pointcut = &quot;execution(* com.example.service.*.*(..))&quot;,</span></span><br><span class="line"><span class="meta">                   throwing = &quot;ex&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">logAfterThrowing</span><span class="params">(JoinPoint joinPoint, Throwable ex)</span> &#123;</span><br><span class="line">        log.error(<span class="string">&quot;æ–¹æ³•æ‰§è¡Œå¤±è´¥: &quot;</span> + joinPoint.getSignature().getName(), ex);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>ç„¶åŽï¼Œä¸šåŠ¡ä»£ç å°±å˜å¾—éžå¸¸å¹²å‡€äº†ï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">createUser</span><span class="params">(User user)</span> &#123;</span><br><span class="line">    <span class="comment">// åªéœ€è¦å…³æ³¨ä¸šåŠ¡é€»è¾‘ï¼Œä¸éœ€è¦å…³å¿ƒæ—¥å¿—ã€æƒé™ã€äº‹åŠ¡ç­‰</span></span><br><span class="line">    userDao.save(user);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>-â€”é¢è¯•ä¸­å¯ä»¥ä¸èƒŒï¼Œæ–¹ä¾¿å¤§å®¶ç†è§£ endâ€”-</p>
<p>ä»ŽæŠ€æœ¯å®žçŽ°ä¸Šæ¥è¯´ï¼ŒAOP ä¸»è¦æ˜¯é€šè¿‡åŠ¨æ€ä»£ç†æ¥å®žçŽ°çš„ã€‚å¦‚æžœç›®æ ‡ç±»å®žçŽ°äº†æŽ¥å£ï¼Œå°±ç”¨ JDK åŠ¨æ€ä»£ç†ï¼›å¦‚æžœæ²¡æœ‰å®žçŽ°æŽ¥å£ï¼Œå°±ç”¨ CGLIB æ¥åˆ›å»ºå­ç±»ä»£ç†ã€‚ä»£ç†å¯¹è±¡ä¼šåœ¨æ–¹æ³•æ‰§è¡Œå‰åŽæ’å…¥æˆ‘ä»¬å®šä¹‰çš„åˆ‡é¢é€»è¾‘ã€‚</p>
<p><img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="https://cdn.jsdelivr.net/gh/JakicDong/blog-assets@main/images/20251024163711.png" alt="20251024163711"><br>stack overflowï¼šJDK Proxy vs CGLIB Proxy</p>
<h4 id="Spring-AOP-æœ‰å“ªäº›æ ¸å¿ƒæ¦‚å¿µï¼Ÿ"><a href="#Spring-AOP-æœ‰å“ªäº›æ ¸å¿ƒæ¦‚å¿µï¼Ÿ" class="headerlink" title="Spring AOP æœ‰å“ªäº›æ ¸å¿ƒæ¦‚å¿µï¼Ÿ"></a>Spring AOP æœ‰å“ªäº›æ ¸å¿ƒæ¦‚å¿µï¼Ÿ</h4><p>Spring AOP æ˜¯ AOP çš„ä¸€ä¸ªå…·ä½“å®žçŽ°ï¼Œæˆ‘æŒ‰ç…§åœ¨å·¥ä½œ&#x2F;å­¦ä¹ ä¸­ç†è§£çš„é‡è¦ç¨‹åº¦æ¥è¯´ä¸€ä¸‹ï¼š</p>
<p><img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="https://cdn.jsdelivr.net/gh/JakicDong/blog-assets@main/images/20251024163740.png" alt="20251024163740"><br>DataFlair Teamï¼šAOP æ ¸å¿ƒæ¦‚å¿µ</p>
<p>â‘ ã€<strong>åˆ‡é¢</strong>ï¼šæˆ‘ä»¬å®šä¹‰çš„ä¸€ä¸ªç±»ï¼ŒåŒ…å«äº†è¦åœ¨ä»€ä¹ˆæ—¶å€™ã€ä»€ä¹ˆåœ°æ–¹æ‰§è¡Œä»€ä¹ˆé€»è¾‘ã€‚æ¯”å¦‚æˆ‘ä»¬å®šä¹‰ä¸€ä¸ªæ—¥å¿—åˆ‡é¢ï¼Œä¸“é—¨è´Ÿè´£è®°å½•æ–¹æ³•çš„æ‰§è¡Œæƒ…å†µã€‚åœ¨ Spring ä¸­ï¼Œæˆ‘ä»¬ä¼šç”¨ <code>@Aspect</code> æ³¨è§£æ¥æ ‡è¯†ä¸€ä¸ªåˆ‡é¢ç±»ã€‚</p>
<p>â‘¡ã€<strong>åˆ‡ç‚¹</strong>ï¼šå®šä¹‰äº†åœ¨å“ªäº›åœ°æ–¹åº”ç”¨åˆ‡é¢é€»è¾‘ã€‚è¯´ç™½äº†å°±æ˜¯å‘Šè¯‰ Springï¼Œæˆ‘è¿™ä¸ªåˆ‡é¢è¦åœ¨å“ªäº›æ–¹æ³•ä¸Šç”Ÿæ•ˆã€‚æ¯”å¦‚æˆ‘ä»¬å¯ä»¥å®šä¹‰ä¸€ä¸ªåˆ‡ç‚¹è¡¨è¾¾å¼ï¼Œè®©å®ƒåŒ¹é…æ‰€æœ‰ Service å±‚çš„æ–¹æ³•ï¼Œæˆ–è€…åŒ¹é…æŸä¸ªç‰¹å®šåŒ…ä¸‹çš„æ‰€æœ‰æ–¹æ³•ã€‚åœ¨ Spring ä¸­ç”¨ <code>@Pointcut</code> æ³¨è§£æ¥å®šä¹‰ï¼Œé€šå¸¸ä¼šå†™ä¸€äº›è¡¨è¾¾å¼ï¼Œæ¯”å¦‚ <code>execution( com.example.service..*(..))</code> è¿™æ ·çš„ã€‚</p>
<p>â‘¢ã€<strong>é€šçŸ¥</strong>ï¼šæ˜¯åˆ‡é¢ä¸­å…·ä½“è¦æ‰§è¡Œçš„ä»£ç é€»è¾‘ã€‚å®ƒæœ‰å‡ ç§ç±»åž‹ï¼š<code>@Before</code> æ˜¯åœ¨æ–¹æ³•æ‰§è¡Œå‰æ‰§è¡Œï¼Œ<code>@After</code> æ˜¯åœ¨æ–¹æ³•æ‰§è¡ŒåŽæ‰§è¡Œï¼Œ<code>@Around</code> æ˜¯çŽ¯ç»•é€šçŸ¥ï¼Œå¯ä»¥åœ¨æ–¹æ³•æ‰§è¡Œå‰åŽéƒ½æ‰§è¡Œï¼Œ<code>@AfterReturning</code> æ˜¯åœ¨æ–¹æ³•æ­£å¸¸è¿”å›žåŽæ‰§è¡Œï¼Œ<code>@AfterThrowing</code> æ˜¯åœ¨æ–¹æ³•æŠ›å‡ºå¼‚å¸¸åŽæ‰§è¡Œã€‚æˆ‘ä¸€èˆ¬ç”¨å¾—æœ€å¤šçš„æ˜¯ <code>@Around</code>ï¼Œå› ä¸ºå®ƒæœ€çµæ´»ï¼Œå¯ä»¥æŽ§åˆ¶æ–¹æ³•æ˜¯å¦æ‰§è¡Œï¼Œä¹Ÿå¯ä»¥ä¿®æ”¹å‚æ•°å’Œè¿”å›žå€¼ã€‚</p>
<p>â‘£ã€<strong>è¿žæŽ¥ç‚¹</strong>ï¼šè¢«æ‹¦æˆªåˆ°çš„ç‚¹ï¼Œå› ä¸º Spring åªæ”¯æŒæ–¹æ³•ç±»åž‹çš„è¿žæŽ¥ç‚¹ï¼Œæ‰€ä»¥åœ¨ Spring ä¸­ï¼Œè¿žæŽ¥ç‚¹æŒ‡çš„æ˜¯è¢«æ‹¦æˆªåˆ°çš„æ–¹æ³•ï¼Œå®žé™…ä¸Šè¿žæŽ¥ç‚¹è¿˜å¯ä»¥æ˜¯å­—æ®µæˆ–è€…æž„é€ æ–¹æ³•ã€‚</p>
<p>â‘¤ã€<strong>ç»‡å…¥</strong>ï¼šæ˜¯æŠŠåˆ‡é¢é€»è¾‘åº”ç”¨åˆ°ç›®æ ‡å¯¹è±¡çš„è¿‡ç¨‹ã€‚Spring AOP æ˜¯åœ¨è¿è¡Œæ—¶é€šè¿‡åŠ¨æ€ä»£ç†æ¥å®žçŽ°ç»‡å…¥çš„ï¼Œå½“æˆ‘ä»¬ä»Ž Spring å®¹å™¨ä¸­èŽ·å– Bean çš„æ—¶å€™ï¼Œå¦‚æžœè¿™ä¸ª Bean éœ€è¦è¢«åˆ‡é¢å¤„ç†ï¼ŒSpring å°±ä¼šè¿”å›žä¸€ä¸ªä»£ç†å¯¹è±¡ç»™æˆ‘ä»¬ã€‚</p>
<p>â‘¥ã€<strong>ç›®æ ‡å¯¹è±¡</strong>ï¼šè¢«åˆ‡é¢å¤„ç†çš„å¯¹è±¡ï¼Œä¹Ÿå°±æ˜¯æˆ‘ä»¬å¹³æ—¶å†™çš„ Serviceã€Controller ç­‰ç±»ã€‚Spring AOP ä¼šåœ¨ç›®æ ‡å¯¹è±¡ä¸Šç»‡å…¥åˆ‡é¢é€»è¾‘ã€‚</p>
<p>å®ƒä»¬ä¹‹é—´çš„é€»è¾‘å…³ç³»å›¾æ˜¯è¿™æ ·çš„ï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">åˆ‡é¢ï¼ˆAspectï¼‰</span><br><span class="line">    â”œâ”€â”€ åˆ‡å…¥ç‚¹ï¼ˆPointcutï¼‰â”€â”€â”€ å®šä¹‰åœ¨å“ªé‡Œæ‰§è¡Œ</span><br><span class="line">    â””â”€â”€ é€šçŸ¥ï¼ˆAdviceï¼‰   â”€â”€â”€ å®šä¹‰ä½•æ—¶æ‰§è¡Œä»€ä¹ˆ</span><br><span class="line">            â”œâ”€â”€ @Before</span><br><span class="line">            â”œâ”€â”€ @After</span><br><span class="line">            â”œâ”€â”€ @AfterReturning</span><br><span class="line">            â”œâ”€â”€ @AfterThrowing</span><br><span class="line">            â””â”€â”€ @Around</span><br><span class="line"></span><br><span class="line">ç›®æ ‡å¯¹è±¡ï¼ˆTargetï¼‰â”€â”€â†’ ä»£ç†å¯¹è±¡ï¼ˆProxyï¼‰â”€â”€â†’ ç»‡å…¥ï¼ˆWeavingï¼‰</span><br><span class="line">     â†‘                                    â†“</span><br><span class="line">è¿žæŽ¥ç‚¹ï¼ˆJoin Pointï¼‰                    å®¢æˆ·ç«¯è°ƒç”¨</span><br></pre></td></tr></table></figure>

<h4 id="Spring-AOP-ç»‡å…¥æœ‰å“ªå‡ ç§æ–¹å¼ï¼Ÿ"><a href="#Spring-AOP-ç»‡å…¥æœ‰å“ªå‡ ç§æ–¹å¼ï¼Ÿ" class="headerlink" title="Spring AOP ç»‡å…¥æœ‰å“ªå‡ ç§æ–¹å¼ï¼Ÿ"></a>Spring AOP ç»‡å…¥æœ‰å“ªå‡ ç§æ–¹å¼ï¼Ÿ</h4><p>ç»‡å…¥æœ‰ä¸‰ç§ä¸»è¦æ–¹å¼ï¼Œæˆ‘æŒ‰ç…§å®ƒä»¬çš„æ‰§è¡Œæ—¶æœºæ¥è¯´ä¸€ä¸‹ã€‚</p>
<p><img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="https://cdn.jsdelivr.net/gh/JakicDong/blog-assets@main/images/20251024163839.png" alt="20251024163839"><br>AOP ç»‡å…¥æ–¹å¼</p>
<p>ç¼–è¯‘æœŸç»‡å…¥æ˜¯åœ¨ç¼–è¯‘ Java æºç çš„æ—¶å€™å°±æŠŠåˆ‡é¢é€»è¾‘ç»‡å…¥åˆ°ç›®æ ‡ç±»ä¸­ã€‚è¿™ç§æ–¹å¼æœ€å…¸åž‹çš„å®žçŽ°å°±æ˜¯ AspectJ ç¼–è¯‘å™¨ã€‚å®ƒä¼šåœ¨ç¼–è¯‘çš„æ—¶å€™ç›´æŽ¥ä¿®æ”¹å­—èŠ‚ç ï¼ŒæŠŠåˆ‡é¢çš„é€»è¾‘æ’å…¥åˆ°ç›®æ ‡æ–¹æ³•ä¸­ã€‚</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// æºä»£ç </span></span><br><span class="line"><span class="meta">@Aspect</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">LoggingAspect</span> &#123;</span><br><span class="line">    <span class="meta">@Before(&quot;execution(* com.example.service.*.*(..))&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">logBefore</span><span class="params">(JoinPoint joinPoint)</span> &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;æ–¹æ³•æ‰§è¡Œå‰: &quot;</span> + joinPoint.getSignature().getName());</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Service</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">UserService</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">saveUser</span><span class="params">(String username)</span> &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;ä¿å­˜ç”¨æˆ·: &quot;</span> + username);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>è¿™æ ·ç”Ÿæˆçš„ class æ–‡ä»¶å°±å·²ç»åŒ…å«äº†åˆ‡é¢é€»è¾‘ï¼Œè¿è¡Œæ—¶ä¸éœ€è¦é¢å¤–çš„ä»£ç†æœºåˆ¶ã€‚</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// ç¼–è¯‘å™¨è‡ªåŠ¨ç”Ÿæˆçš„ä»£ç </span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">UserService</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">saveUser</span><span class="params">(String username)</span> &#123;</span><br><span class="line">        <span class="comment">// ç»‡å…¥çš„åˆ‡é¢ä»£ç </span></span><br><span class="line">        System.out.println(<span class="string">&quot;æ–¹æ³•æ‰§è¡Œå‰: saveUser&quot;</span>);</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// åŽŸå§‹ä¸šåŠ¡ä»£ç </span></span><br><span class="line">        System.out.println(<span class="string">&quot;ä¿å­˜ç”¨æˆ·: &quot;</span> + username);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>ç¼–è¯‘æœŸç»‡å…¥çš„ä¼˜ç‚¹æ˜¯æ€§èƒ½æœ€å¥½ï¼Œå› ä¸ºæ²¡æœ‰ä»£ç†çš„å¼€é”€ï¼Œä½†ç¼ºç‚¹æ˜¯éœ€è¦ä½¿ç”¨ç‰¹æ®Šçš„ç¼–è¯‘å™¨ï¼Œè€Œä¸”æ¯”è¾ƒå¤æ‚ï¼Œåœ¨ Spring é¡¹ç›®ä¸­ç”¨å¾—ä¸å¤šã€‚</p>
<p>ç±»åŠ è½½æœŸç»‡å…¥æ˜¯åœ¨ JVM åŠ è½½ class æ–‡ä»¶çš„æ—¶å€™è¿›è¡Œç»‡å…¥ã€‚è¿™ç§æ–¹å¼é€šè¿‡ Java çš„ Instrumentation API æˆ–è€…è‡ªå®šä¹‰çš„ ClassLoader æ¥å®žçŽ°ï¼Œåœ¨ç±»è¢«åŠ è½½åˆ° JVM ä¹‹å‰ä¿®æ”¹å­—èŠ‚ç ã€‚</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">WeavingClassLoader</span> <span class="keyword">extends</span> <span class="title class_">ClassLoader</span> &#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">protected</span> Class&lt;?&gt; findClass(String name) <span class="keyword">throws</span> ClassNotFoundException &#123;</span><br><span class="line">        <span class="type">byte</span>[] classBytes = loadClassBytes(name);</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// åœ¨è¿™é‡Œè¿›è¡Œå­—èŠ‚ç ç»‡å…¥</span></span><br><span class="line">        <span class="type">byte</span>[] wovenBytes = weaveAspects(classBytes);</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">return</span> defineClass(name, wovenBytes, <span class="number">0</span>, wovenBytes.length);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">private</span> <span class="type">byte</span>[] weaveAspects(<span class="type">byte</span>[] classBytes) &#123;</span><br><span class="line">        <span class="comment">// ä½¿ç”¨ ASM æˆ–å…¶ä»–å­—èŠ‚ç æ“ä½œåº“è¿›è¡Œç»‡å…¥</span></span><br><span class="line">        <span class="keyword">return</span> classBytes;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>AspectJ çš„ Load-Time Weaving å°±æ˜¯è¿™ç§æ–¹å¼çš„å…¸åž‹å®žçŽ°ã€‚å®ƒæ¯”ç¼–è¯‘æœŸç»‡å…¥æ›´çµæ´»ä¸€äº›ï¼Œä½†æ˜¯é…ç½®ç›¸å¯¹å¤æ‚ï¼Œéœ€è¦åœ¨ JVM å¯åŠ¨å‚æ•°ä¸­æŒ‡å®š Java agentï¼Œåœ¨ Spring ä¸­ä¹Ÿæœ‰æ”¯æŒï¼Œä½†ç”¨å¾—ä¸æ˜¯ç‰¹åˆ«å¤šã€‚</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"># JVM å¯åŠ¨å‚æ•°</span><br><span class="line">java -javaagent:aspectjweaver.jar -jar myapp.jar</span><br></pre></td></tr></table></figure>

<p>è¿è¡Œæ—¶ç»‡å…¥æ˜¯æˆ‘ä»¬åœ¨ Spring ä¸­æœ€å¸¸è§çš„æ–¹å¼ï¼Œä¹Ÿå°±æ˜¯é€šè¿‡åŠ¨æ€ä»£ç†æ¥å®žçŽ°ã€‚Spring AOP é‡‡ç”¨çš„å°±æ˜¯è¿™ç§æ–¹å¼ã€‚å½“ Spring å®¹å™¨å¯åŠ¨çš„æ—¶å€™ï¼Œå¦‚æžœå‘çŽ°æŸä¸ª Bean éœ€è¦è¢«åˆ‡é¢å¤„ç†ï¼Œå°±ä¼šä¸ºè¿™ä¸ª Bean åˆ›å»ºä¸€ä¸ªä»£ç†å¯¹è±¡ã€‚å¦‚æžœç›®æ ‡ç±»å®žçŽ°äº†æŽ¥å£ï¼ŒSpring ä¼šä½¿ç”¨ JDK çš„åŠ¨æ€ä»£ç†æŠ€æœ¯ã€‚</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// æŽ¥å£</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">UserService</span> &#123;</span><br><span class="line">    <span class="keyword">void</span> <span class="title function_">saveUser</span><span class="params">(String username)</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// å®žçŽ°ç±»</span></span><br><span class="line"><span class="meta">@Service</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">UserServiceImpl</span> <span class="keyword">implements</span> <span class="title class_">UserService</span> &#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">saveUser</span><span class="params">(String username)</span> &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;ä¿å­˜ç”¨æˆ·: &quot;</span> + username);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// Spring è‡ªåŠ¨åˆ›å»ºçš„ä»£ç†ï¼ˆä¼ªä»£ç ï¼‰</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">UserServiceProxy</span> <span class="keyword">implements</span> <span class="title class_">UserService</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> UserService target;</span><br><span class="line">    <span class="keyword">private</span> List&lt;Advisor&gt; advisors;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">saveUser</span><span class="params">(String username)</span> &#123;</span><br><span class="line">        <span class="comment">// æ‰§è¡Œå‰ç½®é€šçŸ¥</span></span><br><span class="line">        <span class="keyword">for</span> (Advisor advisor : advisors) &#123;</span><br><span class="line">            <span class="keyword">if</span> (advisor.getPointcut().matches(<span class="built_in">this</span>.getClass().getMethod(<span class="string">&quot;saveUser&quot;</span>, String.class))) &#123;</span><br><span class="line">                advisor.getAdvice().before();</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// æ‰§è¡Œç›®æ ‡æ–¹æ³•</span></span><br><span class="line">        target.saveUser(username);</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// æ‰§è¡ŒåŽç½®é€šçŸ¥</span></span><br><span class="line">        <span class="keyword">for</span> (Advisor advisor : advisors) &#123;</span><br><span class="line">            advisor.getAdvice().after();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>å¦‚æžœç›®æ ‡ç±»æ²¡æœ‰å®žçŽ°æŽ¥å£ï¼Œå°±ä¼šä½¿ç”¨ CGLIB æ¥åˆ›å»ºä¸€ä¸ªå­ç±»ä½œä¸ºä»£ç†ã€‚è¿è¡Œæ—¶ç»‡å…¥çš„ä¼˜ç‚¹æ˜¯å®žçŽ°ç®€å•ï¼Œä¸éœ€è¦ç‰¹æ®Šçš„ç¼–è¯‘å™¨æˆ– JVM é…ç½®ï¼Œç¼ºç‚¹æ˜¯æœ‰ä¸€å®šçš„æ€§èƒ½å¼€é”€ï¼Œå› ä¸ºæ¯æ¬¡æ–¹æ³•è°ƒç”¨éƒ½è¦ç»è¿‡ä»£ç†ã€‚</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// æ²¡æœ‰æŽ¥å£çš„ç±»</span></span><br><span class="line"><span class="meta">@Service</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">OrderService</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">createOrder</span><span class="params">(String orderId)</span> &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;åˆ›å»ºè®¢å•: &quot;</span> + orderId);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// CGLIB ç”Ÿæˆçš„ä»£ç†å­ç±»ï¼ˆä¼ªä»£ç ï¼‰</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">OrderService$$EnhancerByCGLIB$$12345</span> <span class="keyword">extends</span> <span class="title class_">OrderService</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> MethodInterceptor interceptor;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">createOrder</span><span class="params">(String orderId)</span> &#123;</span><br><span class="line">        <span class="comment">// é€šè¿‡ MethodInterceptor æ‰§è¡Œåˆ‡é¢é€»è¾‘</span></span><br><span class="line">        interceptor.intercept(<span class="built_in">this</span>, getMethod(<span class="string">&quot;createOrder&quot;</span>), <span class="keyword">new</span> <span class="title class_">Object</span>[]&#123;orderId&#125;, </span><br><span class="line">                            <span class="keyword">new</span> <span class="title class_">MethodProxy</span>() &#123;</span><br><span class="line">                                <span class="meta">@Override</span></span><br><span class="line">                                <span class="keyword">public</span> Object <span class="title function_">invokeSuper</span><span class="params">(Object obj, Object[] args)</span> &#123;</span><br><span class="line">                                    <span class="keyword">return</span> OrderService.<span class="built_in">super</span>.createOrder((String) args[<span class="number">0</span>]);</span><br><span class="line">                                &#125;</span><br><span class="line">                            &#125;);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>Spring AOP é»˜è®¤çš„ç»‡å…¥æ–¹å¼å°±æ˜¯è¿è¡Œæ—¶ç»‡å…¥ï¼Œä½¿ç”¨èµ·æ¥éžå¸¸ç®€å•ï¼Œåªéœ€è¦åŠ ä¸ª <code>@Aspect</code> æ³¨è§£å’Œç›¸åº”çš„é€šçŸ¥æ³¨è§£å°±å¯ä»¥äº†ã€‚è™½ç„¶æ€§èƒ½ä¸Šä¸å¦‚ç¼–è¯‘æœŸç»‡å…¥ï¼Œä½†æ˜¯å¯¹äºŽå¤§éƒ¨åˆ†ä¸šåŠ¡åœºæ™¯æ¥è¯´ï¼Œè¿™ç‚¹æ€§èƒ½å¼€é”€æ˜¯å®Œå…¨å¯ä»¥æŽ¥å—çš„ã€‚</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Spring AOP çš„ä»£ç†åˆ›å»ºè¿‡ç¨‹</span></span><br><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="meta">@EnableAspectJAutoProxy</span>  <span class="comment">// å¯ç”¨ AOP è‡ªåŠ¨ä»£ç†</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">AopConfig</span> &#123;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// Spring å†…éƒ¨çš„ä»£ç†åˆ›å»ºé€»è¾‘ï¼ˆç®€åŒ–ç‰ˆï¼‰</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">DefaultAopProxyFactory</span> <span class="keyword">implements</span> <span class="title class_">AopProxyFactory</span> &#123;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> AopProxy <span class="title function_">createAopProxy</span><span class="params">(AdvisedSupport config)</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> (config.isOptimize() || config.isProxyTargetClass() || hasNoUserSuppliedProxyInterfaces(config)) &#123;</span><br><span class="line">            <span class="comment">// ä½¿ç”¨ CGLIB ä»£ç†</span></span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">CglibAopProxy</span>(config);</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="comment">// ä½¿ç”¨ JDK åŠ¨æ€ä»£ç†</span></span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">JdkDynamicAopProxy</span>(config);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="AspectJ-æ˜¯ä»€ä¹ˆï¼Ÿ"><a href="#AspectJ-æ˜¯ä»€ä¹ˆï¼Ÿ" class="headerlink" title="AspectJ æ˜¯ä»€ä¹ˆï¼Ÿ"></a>AspectJ æ˜¯ä»€ä¹ˆï¼Ÿ</h4><p>AspectJ æ˜¯ä¸€ä¸ª AOP æ¡†æž¶ï¼Œå®ƒå¯ä»¥åšå¾ˆå¤š Spring AOP å¹²ä¸äº†çš„äº‹æƒ…ï¼Œæ¯”å¦‚è¯´ç¼–è¯‘æ—¶ã€ç¼–è¯‘åŽå’Œç±»åŠ è½½æ—¶ç»‡å…¥åˆ‡é¢ã€‚å¹¶ä¸”æä¾›äº†å¾ˆå¤šå¤æ‚çš„åˆ‡ç‚¹è¡¨è¾¾å¼å’Œé€šçŸ¥ç±»åž‹ã€‚</p>
<p><img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="https://cdn.jsdelivr.net/gh/JakicDong/blog-assets@main/images/20251024164017.png" alt="20251024164017"><br>AspectJ å®˜ç½‘</p>
<p>Spring AOP åªæ”¯æŒæ–¹æ³•çº§åˆ«çš„æ‹¦æˆªï¼Œè€Œä¸”åªèƒ½æ‹¦æˆª Spring å®¹å™¨ç®¡ç†çš„ Beanã€‚ä½†æ˜¯ AspectJ å¯ä»¥æ‹¦æˆªä»»ä½• Java å¯¹è±¡çš„æ–¹æ³•è°ƒç”¨ã€å­—æ®µè®¿é—®ã€æž„é€ æ–¹æ³•æ‰§è¡Œã€å¼‚å¸¸å¤„ç†ç­‰ç­‰ã€‚</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Spring AOP åªèƒ½åšåˆ°è¿™äº›</span></span><br><span class="line"><span class="meta">@Aspect</span></span><br><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">SpringAopAspect</span> &#123;</span><br><span class="line">    <span class="comment">// âœ… å¯ä»¥æ‹¦æˆªï¼špublic æ–¹æ³•è°ƒç”¨</span></span><br><span class="line">    <span class="meta">@Around(&quot;execution(public * com.example.service.*.*(..))&quot;)</span> </span><br><span class="line">    <span class="keyword">public</span> Object <span class="title function_">aroundPublicMethod</span><span class="params">(ProceedingJoinPoint pjp)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> pjp.proceed();</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// âŒ æ— æ³•æ‹¦æˆªï¼šå­—æ®µè®¿é—®</span></span><br><span class="line">    <span class="comment">// âŒ æ— æ³•æ‹¦æˆªï¼šæž„é€ å‡½æ•°</span></span><br><span class="line">    <span class="comment">// âŒ æ— æ³•æ‹¦æˆªï¼šç§æœ‰æ–¹æ³•</span></span><br><span class="line">    <span class="comment">// âŒ æ— æ³•æ‹¦æˆªï¼šé™æ€æ–¹æ³•</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="Spring-AOP-æœ‰å“ªäº›é€šçŸ¥æ–¹å¼ï¼Ÿ"><a href="#Spring-AOP-æœ‰å“ªäº›é€šçŸ¥æ–¹å¼ï¼Ÿ" class="headerlink" title="Spring AOP æœ‰å“ªäº›é€šçŸ¥æ–¹å¼ï¼Ÿ"></a>Spring AOP æœ‰å“ªäº›é€šçŸ¥æ–¹å¼ï¼Ÿ</h4><p>Spring AOP æä¾›äº†å¤šç§é€šçŸ¥æ–¹å¼ï¼Œå…è®¸æˆ‘ä»¬åœ¨æ–¹æ³•æ‰§è¡Œçš„ä¸åŒé˜¶æ®µæ’å…¥é€»è¾‘ã€‚å¸¸ç”¨çš„é€šçŸ¥æ–¹å¼æœ‰ï¼š</p>
<ul>
<li>å‰ç½®é€šçŸ¥ (@Before)</li>
<li>è¿”å›žé€šçŸ¥ (@AfterReturning)</li>
<li>å¼‚å¸¸é€šçŸ¥ (@AfterThrowing)</li>
<li>åŽç½®é€šçŸ¥ (@After)</li>
<li>çŽ¯ç»•é€šçŸ¥ (@Around)</li>
</ul>
<p><img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="https://cdn.jsdelivr.net/gh/JakicDong/blog-assets@main/images/20251024164058.png" alt="20251024164058"><br>ä¸‰åˆ†æ¶é¢æ¸£é€†è¢­ï¼šSpring AOP é€šçŸ¥æ–¹å¼</p>
<p>å‰ç½®é€šçŸ¥æ˜¯åœ¨ç›®æ ‡æ–¹æ³•æ‰§è¡Œä¹‹å‰æ‰§è¡Œçš„é€šçŸ¥ã€‚è¿™ç§é€šçŸ¥æ¯”è¾ƒç®€å•ï¼Œä¸»è¦ç”¨æ¥åšä¸€äº›å‡†å¤‡å·¥ä½œï¼Œæ¯”å¦‚å‚æ•°æ ¡éªŒã€æƒé™æ£€æŸ¥ã€è®°å½•æ–¹æ³•å¼€å§‹æ‰§è¡Œçš„æ—¥å¿—ç­‰ç­‰ã€‚å‰ç½®é€šçŸ¥æ— æ³•é˜»æ­¢ç›®æ ‡æ–¹æ³•çš„æ‰§è¡Œï¼Œä¹Ÿæ— æ³•ä¿®æ”¹æ–¹æ³•çš„å‚æ•°ï¼Œå®ƒåªèƒ½åœ¨æ–¹æ³•æ‰§è¡Œå‰åšä¸€äº›é¢å¤–çš„æ“ä½œã€‚æˆ‘ä»¬åœ¨é¡¹ç›®ä¸­ç»å¸¸ç”¨å®ƒæ¥è®°å½•æ“ä½œæ—¥å¿—ï¼Œæ¯”å¦‚è®°å½•è°åœ¨ä»€ä¹ˆæ—¶å€™è°ƒç”¨äº†ä»€ä¹ˆæ–¹æ³•ã€‚</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Aspect</span></span><br><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">LoggingAspect</span> &#123;</span><br><span class="line">    <span class="meta">@Before(&quot;execution(* com.example.service.*.*(..))&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">logBefore</span><span class="params">(JoinPoint joinPoint)</span> &#123;</span><br><span class="line">        <span class="comment">// æ‰“å°æ–¹æ³•åå’Œå‚æ•°</span></span><br><span class="line">        System.out.println(<span class="string">&quot;è°ƒç”¨æ–¹æ³•: &quot;</span> + joinPoint.getSignature().getName());</span><br><span class="line">        System.out.println(<span class="string">&quot;å‚æ•°: &quot;</span> + Arrays.toString(joinPoint.getArgs()));</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>åŽç½®é€šçŸ¥æ˜¯åœ¨ç›®æ ‡æ–¹æ³•æ‰§è¡Œå®ŒæˆåŽæ‰§è¡Œçš„ï¼Œä¸ç®¡æ–¹æ³•æ˜¯æ­£å¸¸è¿”å›žè¿˜æ˜¯æŠ›å‡ºå¼‚å¸¸éƒ½ä¼šæ‰§è¡Œã€‚è¿™ç§é€šçŸ¥ä¸»è¦ç”¨æ¥åšä¸€äº›æ¸…ç†å·¥ä½œï¼Œæ¯”å¦‚é‡Šæ”¾èµ„æºã€è®°å½•æ–¹æ³•æ‰§è¡Œå®Œæˆçš„æ—¥å¿—ç­‰ç­‰ã€‚éœ€è¦æ³¨æ„çš„æ˜¯ï¼ŒåŽç½®é€šçŸ¥æ‹¿ä¸åˆ°æ–¹æ³•çš„è¿”å›žå€¼ï¼Œä¹Ÿæ•èŽ·ä¸åˆ°å¼‚å¸¸ä¿¡æ¯ï¼Œå®ƒå°±æ˜¯çº¯ç²¹çš„åœ¨æ–¹æ³•æ‰§è¡ŒåŽåšä¸€äº›æ”¶å°¾å·¥ä½œã€‚</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Aspect</span></span><br><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">LoggingAspect</span> &#123;</span><br><span class="line">    <span class="meta">@After(&quot;execution(* com.example.service.*.*(..))&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">logAfter</span><span class="params">(JoinPoint joinPoint)</span> &#123;</span><br><span class="line">        <span class="comment">// æ‰“å°æ–¹æ³•æ‰§è¡Œå®Œæˆçš„æ—¥å¿—</span></span><br><span class="line">        System.out.println(<span class="string">&quot;æ–¹æ³•æ‰§è¡Œå®Œæˆ: &quot;</span> + joinPoint.getSignature().getName());</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>è¿”å›žé€šçŸ¥æ˜¯åœ¨ç›®æ ‡æ–¹æ³•æ­£å¸¸è¿”å›žåŽæ‰§è¡Œçš„ã€‚è¿™ç§é€šçŸ¥å¯ä»¥èŽ·å–åˆ°æ–¹æ³•çš„è¿”å›žå€¼ï¼Œæˆ‘ä»¬å¯ä»¥åœ¨æ³¨è§£ä¸­æŒ‡å®š returning å‚æ•°æ¥æŽ¥æ”¶è¿”å›žå€¼ã€‚è¿”å›žé€šçŸ¥ç»å¸¸ç”¨æ¥åšä¸€äº›åŸºäºŽè¿”å›žç»“æžœçš„åŽç»­å¤„ç†ï¼Œæ¯”å¦‚ç¼“å­˜æ–¹æ³•çš„è¿”å›žç»“æžœã€æ ¹æ®è¿”å›žå€¼å‘é€é€šçŸ¥ç­‰ç­‰ã€‚å¦‚æžœæ–¹æ³•æŠ›å‡ºå¼‚å¸¸çš„è¯ï¼Œè¿”å›žé€šçŸ¥æ˜¯ä¸ä¼šæ‰§è¡Œçš„ã€‚</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Aspect</span></span><br><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">LoggingAspect</span> &#123;</span><br><span class="line">    <span class="meta">@AfterReturning(pointcut = &quot;execution(* com.example.service.*.*(..))&quot;, returning = &quot;result&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">logAfterReturning</span><span class="params">(JoinPoint joinPoint, Object result)</span> &#123;</span><br><span class="line">        <span class="comment">// æ‰“å°æ–¹æ³•æ‰§è¡Œå®Œæˆçš„æ—¥å¿—</span></span><br><span class="line">        System.out.println(<span class="string">&quot;æ–¹æ³•æ‰§è¡Œå®Œæˆ: &quot;</span> + joinPoint.getSignature().getName());</span><br><span class="line">        <span class="comment">// æ‰“å°æ–¹æ³•è¿”å›žå€¼</span></span><br><span class="line">        System.out.println(<span class="string">&quot;è¿”å›žå€¼: &quot;</span> + result);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>å¼‚å¸¸é€šçŸ¥æ˜¯åœ¨ç›®æ ‡æ–¹æ³•æŠ›å‡ºå¼‚å¸¸åŽæ‰§è¡Œçš„ã€‚æˆ‘ä»¬å¯ä»¥åœ¨æ³¨è§£ä¸­æŒ‡å®š throwing å‚æ•°æ¥æŽ¥æ”¶å¼‚å¸¸å¯¹è±¡ã€‚å¼‚å¸¸é€šçŸ¥ä¸»è¦ç”¨æ¥åšå¼‚å¸¸å¤„ç†å’Œè®°å½•ï¼Œæ¯”å¦‚è®°å½•é”™è¯¯æ—¥å¿—ã€å‘é€å‘Šè­¦ã€å¼‚å¸¸ç»Ÿè®¡ç­‰ç­‰ã€‚éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œå¼‚å¸¸é€šçŸ¥ä¸èƒ½å¤„ç†å¼‚å¸¸ï¼Œå¼‚å¸¸è¿˜æ˜¯ä¼šç»§ç»­å‘ä¸ŠæŠ›å‡ºã€‚</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Aspect</span></span><br><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">LoggingAspect</span> &#123;</span><br><span class="line">    <span class="meta">@AfterThrowing(pointcut = &quot;execution(* com.example.service.*.*(..))&quot;,</span></span><br><span class="line"><span class="meta">                     throwing = &quot;ex&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">logAfterThrowing</span><span class="params">(JoinPoint joinPoint, Throwable ex)</span> &#123;</span><br><span class="line">        <span class="comment">// æ‰“å°æ–¹æ³•åå’Œå¼‚å¸¸ä¿¡æ¯</span></span><br><span class="line">        System.out.println(<span class="string">&quot;æ–¹æ³•æ‰§è¡Œå¼‚å¸¸: &quot;</span> + joinPoint.getSignature().getName());</span><br><span class="line">        System.out.println(<span class="string">&quot;å¼‚å¸¸ä¿¡æ¯: &quot;</span> + ex.getMessage());</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>çŽ¯ç»•é€šçŸ¥æ˜¯æœ€å¼ºå¤§ä¹Ÿæ˜¯æˆ‘ä»¬ç”¨å¾—æœ€å¤šçš„ä¸€ç§é€šçŸ¥ã€‚å®ƒå¯ä»¥åœ¨æ–¹æ³•æ‰§è¡Œå‰åŽéƒ½æ‰§è¡Œé€»è¾‘ï¼Œè€Œä¸”å¯ä»¥æŽ§åˆ¶ç›®æ ‡æ–¹æ³•æ˜¯å¦æ‰§è¡Œï¼Œè¿˜å¯ä»¥ä¿®æ”¹æ–¹æ³•çš„å‚æ•°å’Œè¿”å›žå€¼ã€‚çŽ¯ç»•é€šçŸ¥çš„æ–¹æ³•å¿…é¡»æŽ¥æ”¶ä¸€ä¸ª ProceedingJoinPoint å‚æ•°ï¼Œé€šè¿‡è°ƒç”¨å…¶ <code>proceed()</code> æ–¹æ³•æ¥æ‰§è¡Œç›®æ ‡æ–¹æ³•ã€‚</p>
<p><a target="_blank" rel="noopener" href="https://javabetter.cn/zhishixingqiu/paicoding.html">æŠ€æœ¯æ´¾</a> é¡¹ç›®ä¸­å°±ä¸»è¦æ˜¯é€šè¿‡çŽ¯ç»•é€šçŸ¥æ¥å®žçŽ°åˆ‡é¢ã€‚</p>
<p><img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="https://cdn.jsdelivr.net/gh/JakicDong/blog-assets@main/images/20251024164130.png" alt="20251024164130"><br>æŠ€æœ¯æ´¾æºç ï¼šçŽ¯ç»•é€šçŸ¥</p>
<p>å¦‚æžœæœ‰å¤šä¸ªåˆ‡é¢ï¼Œè¿˜å¯ä»¥é€šè¿‡ <code>@Order</code> æ³¨è§£æŒ‡å®šå…ˆåŽé¡ºåºï¼Œæ•°å­—è¶Šå°ï¼Œä¼˜å…ˆçº§è¶Šé«˜ã€‚ä»£ç ç¤ºä¾‹å¦‚ä¸‹ï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Aspect</span></span><br><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">WebLogAspect</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> <span class="keyword">static</span> <span class="type">Logger</span> <span class="variable">logger</span> <span class="operator">=</span> LoggerFactory.getLogger(WebLogAspect.class);</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Pointcut(&quot;@annotation(cn.fighter3.spring.aop_demo.WebLog)&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">webLog</span><span class="params">()</span> &#123;&#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Before(&quot;webLog()&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">doBefore</span><span class="params">(JoinPoint joinPoint)</span> <span class="keyword">throws</span> Throwable &#123;</span><br><span class="line">        <span class="comment">// å¼€å§‹æ‰“å°è¯·æ±‚æ—¥å¿—</span></span><br><span class="line">        <span class="type">ServletRequestAttributes</span> <span class="variable">attributes</span> <span class="operator">=</span> (ServletRequestAttributes) RequestContextHolder.getRequestAttributes();</span><br><span class="line">        <span class="type">HttpServletRequest</span> <span class="variable">request</span> <span class="operator">=</span> attributes.getRequest();</span><br><span class="line">        <span class="comment">// æ‰“å°è¯·æ±‚ç›¸å…³å‚æ•°</span></span><br><span class="line">        logger.info(<span class="string">&quot;========================================== Start ==========================================&quot;</span>);</span><br><span class="line">        <span class="comment">// æ‰“å°è¯·æ±‚ url</span></span><br><span class="line">        logger.info(<span class="string">&quot;URL            : &#123;&#125;&quot;</span>, request.getRequestURL().toString());</span><br><span class="line">        <span class="comment">// æ‰“å° Http method</span></span><br><span class="line">        logger.info(<span class="string">&quot;HTTP Method    : &#123;&#125;&quot;</span>, request.getMethod());</span><br><span class="line">        <span class="comment">// æ‰“å°è°ƒç”¨ controller çš„å…¨è·¯å¾„ä»¥åŠæ‰§è¡Œæ–¹æ³•</span></span><br><span class="line">        logger.info(<span class="string">&quot;Class Method   : &#123;&#125;.&#123;&#125;&quot;</span>, joinPoint.getSignature().getDeclaringTypeName(), joinPoint.getSignature().getName());</span><br><span class="line">        <span class="comment">// æ‰“å°è¯·æ±‚çš„ IP</span></span><br><span class="line">        logger.info(<span class="string">&quot;IP             : &#123;&#125;&quot;</span>, request.getRemoteAddr());</span><br><span class="line">        <span class="comment">// æ‰“å°è¯·æ±‚å…¥å‚</span></span><br><span class="line">        logger.info(<span class="string">&quot;Request Args   : &#123;&#125;&quot;</span>,<span class="keyword">new</span> <span class="title class_">ObjectMapper</span>().writeValueAsString(joinPoint.getArgs()));</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@After(&quot;webLog()&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">doAfter</span><span class="params">()</span> <span class="keyword">throws</span> Throwable &#123;</span><br><span class="line">        <span class="comment">// ç»“æŸåŽæ‰“ä¸ªåˆ†éš”çº¿ï¼Œæ–¹ä¾¿æŸ¥çœ‹</span></span><br><span class="line">        logger.info(<span class="string">&quot;=========================================== End ===========================================&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Around(&quot;webLog()&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> Object <span class="title function_">doAround</span><span class="params">(ProceedingJoinPoint proceedingJoinPoint)</span> <span class="keyword">throws</span> Throwable &#123;</span><br><span class="line">        <span class="comment">//å¼€å§‹æ—¶é—´</span></span><br><span class="line">        <span class="type">long</span> <span class="variable">startTime</span> <span class="operator">=</span> System.currentTimeMillis();</span><br><span class="line">        <span class="type">Object</span> <span class="variable">result</span> <span class="operator">=</span> proceedingJoinPoint.proceed();</span><br><span class="line">        <span class="comment">// æ‰“å°å‡ºå‚</span></span><br><span class="line">        logger.info(<span class="string">&quot;Response Args  : &#123;&#125;&quot;</span>, <span class="keyword">new</span> <span class="title class_">ObjectMapper</span>().writeValueAsString(result));</span><br><span class="line">        <span class="comment">// æ‰§è¡Œè€—æ—¶</span></span><br><span class="line">        logger.info(<span class="string">&quot;Time-Consuming : &#123;&#125; ms&quot;</span>, System.currentTimeMillis() - startTime);</span><br><span class="line">        <span class="keyword">return</span> result;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="Spring-AOP-å‘ç”Ÿåœ¨ä»€ä¹ˆæ—¶å€™ï¼Ÿ"><a href="#Spring-AOP-å‘ç”Ÿåœ¨ä»€ä¹ˆæ—¶å€™ï¼Ÿ" class="headerlink" title="Spring AOP å‘ç”Ÿåœ¨ä»€ä¹ˆæ—¶å€™ï¼Ÿ"></a>Spring AOP å‘ç”Ÿåœ¨ä»€ä¹ˆæ—¶å€™ï¼Ÿ</h4><p>Spring AOP æ˜¯åœ¨ Bean çš„åˆå§‹åŒ–é˜¶æ®µå‘ç”Ÿçš„ï¼Œå…·ä½“æ¥è¯´æ˜¯åœ¨ Bean ç”Ÿå‘½å‘¨æœŸçš„åŽç½®å¤„ç†é˜¶æ®µã€‚</p>
<p>åœ¨ Bean å®žä¾‹åŒ–å®Œæˆã€å±žæ€§æ³¨å…¥å®Œæˆä¹‹åŽï¼ŒSpring ä¼šè°ƒç”¨æ‰€æœ‰ BeanPostProcessor çš„ postProcessAfterInitialization æ–¹æ³•ï¼ŒAOP ä»£ç†çš„åˆ›å»ºå°±æ˜¯åœ¨è¿™ä¸ªé˜¶æ®µå®Œæˆçš„ã€‚</p>
<p><img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="https://cdn.jsdelivr.net/gh/JakicDong/blog-assets@main/images/20251024164150.png" alt="20251024164150"><br>äºŒå“¥çš„ Java è¿›é˜¶ä¹‹è·¯ï¼šBeanPostProcessor</p>
<h4 id="ç®€å•æ€»ç»“ä¸€ä¸‹-AOP"><a href="#ç®€å•æ€»ç»“ä¸€ä¸‹-AOP" class="headerlink" title="ç®€å•æ€»ç»“ä¸€ä¸‹ AOP"></a>ç®€å•æ€»ç»“ä¸€ä¸‹ AOP</h4><p>AOPï¼Œä¹Ÿå°±æ˜¯é¢å‘åˆ‡é¢ç¼–ç¨‹ï¼Œæ˜¯ä¸€ç§ç¼–ç¨‹èŒƒå¼ï¼Œæ—¨åœ¨æé«˜ä»£ç çš„æ¨¡å—åŒ–ã€‚æ¯”å¦‚è¯´å¯ä»¥å°†æ—¥å¿—è®°å½•ã€äº‹åŠ¡ç®¡ç†ç­‰åˆ†ç¦»å‡ºæ¥ï¼Œæ¥æé«˜ä»£ç çš„å¯é‡ç”¨æ€§ã€‚</p>
<p>AOP çš„æ ¸å¿ƒæ¦‚å¿µåŒ…æ‹¬åˆ‡é¢ã€è¿žæŽ¥ç‚¹ã€é€šçŸ¥ã€åˆ‡ç‚¹å’Œç»‡å…¥ç­‰ã€‚</p>
<p>â‘  åƒæ—¥å¿—æ‰“å°ã€äº‹åŠ¡ç®¡ç†ç­‰éƒ½å¯ä»¥æŠ½ç¦»ä¸ºåˆ‡é¢ï¼Œå¯ä»¥å£°æ˜Žåœ¨ç±»çš„æ–¹æ³•ä¸Šã€‚åƒ <code>@Transactional</code> æ³¨è§£ï¼Œå°±æ˜¯ä¸€ä¸ªå…¸åž‹çš„ AOP åº”ç”¨ï¼Œå®ƒå°±æ˜¯é€šè¿‡ AOP æ¥å®žçŽ°äº‹åŠ¡ç®¡ç†çš„ã€‚æˆ‘ä»¬åªéœ€è¦åœ¨æ–¹æ³•ä¸Šæ·»åŠ  <code>@Transactional</code> æ³¨è§£ï¼ŒSpring å°±ä¼šåœ¨æ–¹æ³•æ‰§è¡Œå‰åŽæ·»åŠ äº‹åŠ¡ç®¡ç†çš„é€»è¾‘ã€‚</p>
<p>â‘¡ Spring AOP æ˜¯åŸºäºŽä»£ç†çš„ï¼Œå®ƒé»˜è®¤ä½¿ç”¨ JDK åŠ¨æ€ä»£ç†å’Œ CGLIB ä»£ç†æ¥å®žçŽ° AOPã€‚</p>
<p>â‘¢ Spring AOP çš„ç»‡å…¥æ–¹å¼æ˜¯è¿è¡Œæ—¶ç»‡å…¥ï¼Œè€Œ AspectJ æ”¯æŒç¼–è¯‘æ—¶ç»‡å…¥ã€ç±»åŠ è½½æ—¶ç»‡å…¥ã€‚</p>
<h4 id="AOPå’Œ-OOP-çš„å…³ç³»ï¼Ÿ"><a href="#AOPå’Œ-OOP-çš„å…³ç³»ï¼Ÿ" class="headerlink" title="AOPå’Œ OOP çš„å…³ç³»ï¼Ÿ"></a>AOPå’Œ OOP çš„å…³ç³»ï¼Ÿ</h4><p>AOP å’Œ OOP æ˜¯äº’è¡¥çš„ç¼–ç¨‹æ€æƒ³ï¼š</p>
<ol>
<li>OOP é€šè¿‡ç±»å’Œå¯¹è±¡å°è£…æ•°æ®å’Œè¡Œä¸ºï¼Œä¸“æ³¨äºŽæ ¸å¿ƒä¸šåŠ¡é€»è¾‘ã€‚</li>
<li>AOP æä¾›äº†è§£å†³æ¨ªåˆ‡å…³æ³¨ç‚¹ï¼ˆå¦‚æ—¥å¿—ã€æƒé™ã€äº‹åŠ¡ç­‰ï¼‰çš„æœºåˆ¶ï¼Œå°†è¿™äº›é€»è¾‘é›†ä¸­ç®¡ç†ã€‚</li>
</ol>
<blockquote>
<ol>
<li><a target="_blank" rel="noopener" href="https://javabetter.cn/zhishixingqiu/mianshi.html">Java é¢è¯•æŒ‡å—ï¼ˆä»˜è´¹ï¼‰</a>æ”¶å½•çš„è…¾è®¯ Java åŽç«¯å®žä¹ ä¸€é¢åŽŸé¢˜ï¼šè¯´è¯´ AOP çš„åŽŸç†ã€‚</li>
<li><a target="_blank" rel="noopener" href="https://javabetter.cn/zhishixingqiu/mianshi.html">Java é¢è¯•æŒ‡å—ï¼ˆä»˜è´¹ï¼‰</a>æ”¶å½•çš„å°ç±³ 25 å±Šæ—¥å¸¸å®žä¹ ä¸€é¢åŽŸé¢˜ï¼šè¯´è¯´ä½ å¯¹ AOP å’Œ IoC çš„ç†è§£ã€‚</li>
<li><a target="_blank" rel="noopener" href="https://javabetter.cn/zhishixingqiu/mianshi.html">Java é¢è¯•æŒ‡å—ï¼ˆä»˜è´¹ï¼‰</a>æ”¶å½•çš„å¿«æ‰‹é¢ç»åŒå­¦ 7 Java åŽç«¯æŠ€æœ¯ä¸€é¢é¢è¯•åŽŸé¢˜ï¼šè¯´ä¸€ä¸‹ Spring AOP çš„å®žçŽ°åŽŸç†</li>
<li><a target="_blank" rel="noopener" href="https://javabetter.cn/zhishixingqiu/mianshi.html">Java é¢è¯•æŒ‡å—ï¼ˆä»˜è´¹ï¼‰</a>æ”¶å½•çš„å°å…¬å¸é¢ç»åˆé›†åŒå­¦ 1 Java åŽç«¯é¢è¯•åŽŸé¢˜ï¼šä»‹ç» Spring IoC å’Œ AOP?</li>
<li><a target="_blank" rel="noopener" href="https://javabetter.cn/zhishixingqiu/mianshi.html">Java é¢è¯•æŒ‡å—ï¼ˆä»˜è´¹ï¼‰</a>æ”¶å½•çš„æ‹›å•†é“¶è¡Œé¢ç»åŒå­¦ 6 æ‹›é“¶ç½‘ç»œç§‘æŠ€é¢è¯•åŽŸé¢˜ï¼šSpringBootæ¡†æž¶çš„AOPã€IOC&#x2F;DIï¼Ÿ</li>
<li><a target="_blank" rel="noopener" href="https://javabetter.cn/zhishixingqiu/mianshi.html">Java é¢è¯•æŒ‡å—ï¼ˆä»˜è´¹ï¼‰</a>æ”¶å½•çš„ç¾Žå›¢é¢ç»åŒå­¦ 4 ä¸€é¢é¢è¯•åŽŸé¢˜ï¼šSpring AOPå‘ç”Ÿåœ¨ä»€ä¹ˆæ—¶å€™</li>
<li><a target="_blank" rel="noopener" href="https://javabetter.cn/zhishixingqiu/mianshi.html">Java é¢è¯•æŒ‡å—ï¼ˆä»˜è´¹ï¼‰</a>æ”¶å½•çš„ç†æƒ³æ±½è½¦é¢ç»åŒå­¦ 2 ä¸€é¢é¢è¯•åŽŸé¢˜ï¼šSpring AOPçš„æ¦‚å¿µäº†è§£å—ï¼ŸAOPå’Œ OOP çš„å…³ç³»ï¼Ÿ</li>
</ol>
</blockquote>
<h3 id="21-ðŸŒŸAOPçš„åº”ç”¨åœºæ™¯æœ‰å“ªäº›ï¼Ÿ"><a href="#21-ðŸŒŸAOPçš„åº”ç”¨åœºæ™¯æœ‰å“ªäº›ï¼Ÿ" class="headerlink" title="21.ðŸŒŸAOPçš„åº”ç”¨åœºæ™¯æœ‰å“ªäº›ï¼Ÿ"></a>21.ðŸŒŸAOPçš„åº”ç”¨åœºæ™¯æœ‰å“ªäº›ï¼Ÿ</h3><p>ç­”ï¼šAOP åœ¨å®žé™…å·¥ä½œ&#x2F;ç¼–ç å­¦ä¹ ä¸­æœ‰å¾ˆå¤šåº”ç”¨åœºæ™¯ï¼Œæˆ‘æŒ‰ç…§ä½¿ç”¨é¢‘çŽ‡æ¥è¯´è¯´å‡ ä¸ªä¸»è¦çš„ã€‚</p>
<p>äº‹åŠ¡ç®¡ç†æ˜¯ç”¨å¾—æœ€å¤šçš„åœºæ™¯ï¼ŒåŸºæœ¬ä¸Šæ¯ä¸ªé¡¹ç›®éƒ½ä¼šç”¨åˆ°ã€‚åªéœ€è¦åœ¨ Service æ–¹æ³•ä¸ŠåŠ ä¸ª <code>@Transactional</code> æ³¨è§£ï¼ŒSpring å°±ä¼šè‡ªåŠ¨å¸®æˆ‘ä»¬ç®¡ç†äº‹åŠ¡çš„å¼€å¯ã€æäº¤å’Œå›žæ»šã€‚</p>
<p><img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="https://cdn.jsdelivr.net/gh/JakicDong/blog-assets@main/images/20251024164321.png" alt="20251024164321"><br>æŠ€æœ¯æ´¾æºç ï¼š@Transactionaläº‹åŠ¡</p>
<p>æ—¥å¿—è®°å½•ä¹Ÿæ˜¯ä¸€ä¸ªå¾ˆå¸¸è§çš„åº”ç”¨ã€‚åœ¨<a target="_blank" rel="noopener" href="https://javabetter.cn/zhishixingqiu/paicoding.html">æŠ€æœ¯æ´¾å®žæˆ˜é¡¹ç›®</a>ä¸­ï¼Œå°±åˆ©ç”¨äº† AOP æ¥æ‰“å°æŽ¥å£çš„å…¥å‚å’Œå‡ºå‚æ—¥å¿—ã€æ‰§è¡Œæ—¶é—´ï¼Œæ–¹ä¾¿åŽæœŸ bug æº¯æºå’Œæ€§èƒ½è°ƒä¼˜ã€‚</p>
<p><img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="https://cdn.jsdelivr.net/gh/JakicDong/blog-assets@main/images/20251024164332.png" alt="20251024164332"><br>æ²‰é»˜çŽ‹äºŒï¼šæŠ€æœ¯æ´¾æ•™ç¨‹</p>
<p>-â€”è¿™éƒ¨åˆ†é¢è¯•å¯ä»¥ä¸èƒŒï¼Œæ–¹ä¾¿å¤§å®¶ç†è§£ startâ€”-</p>
<p>ç¬¬ä¸€æ­¥ï¼Œå®šä¹‰ <code>@MdcDot</code> æ³¨è§£ï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Target(&#123;ElementType.METHOD, ElementType.TYPE&#125;)</span></span><br><span class="line"><span class="meta">@Retention(RetentionPolicy.RUNTIME)</span></span><br><span class="line"><span class="meta">@Documented</span></span><br><span class="line"><span class="keyword">public</span> <span class="meta">@interface</span> MdcDot &#123;</span><br><span class="line">    String <span class="title function_">bizCode</span><span class="params">()</span> <span class="keyword">default</span> <span class="string">&quot;&quot;</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>ç¬¬äºŒæ­¥ï¼Œé…ç½® MdcAspect åˆ‡é¢ï¼Œæ‹¦æˆªå¸¦æœ‰ <code>@MdcDot</code> æ³¨è§£çš„æ–¹æ³•æˆ–ç±»ï¼Œåœ¨æ–¹æ³•æ‰§è¡Œå‰åŽè¿›è¡Œ MDC æ“ä½œï¼Œè®°å½•æ–¹æ³•æ‰§è¡Œè€—æ—¶ã€‚</p>
<p><img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="https://cdn.jsdelivr.net/gh/JakicDong/blog-assets@main/images/20251024164346.png" alt="20251024164346"><br>æŠ€æœ¯æ´¾é¡¹ç›®ï¼šé…ç½® AOP åˆ‡é¢</p>
<p>ç¬¬ä¸‰æ­¥ï¼Œåœ¨éœ€è¦çš„åœ°æ–¹åŠ ä¸Š <code>@MdcDot</code> æ³¨è§£ã€‚</p>
<p><img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="https://cdn.jsdelivr.net/gh/JakicDong/blog-assets@main/images/20251024164358.png" alt="20251024164358"><br>æŠ€æœ¯æ´¾é¡¹ç›®ï¼šä½¿ç”¨æ³¨è§£</p>
<p>ç¬¬å››æ­¥ï¼Œå½“æŽ¥å£è¢«è°ƒç”¨æ—¶ï¼Œå°±å¯ä»¥çœ‹åˆ°å¯¹åº”çš„æ‰§è¡Œæ—¥å¿—ã€‚</p>
<figure class="highlight txt"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">2023-06-16 11:06:13,008 [http-nio-8080-exec-3] INFO |00000000.1686884772947.468581113|101|c.g.p.forum.core.mdc.MdcAspect.handle(MdcAspect.java:47) - æ–¹æ³•æ‰§è¡Œè€—æ—¶: com.github.paicoding.forum.web.front.article.rest.ArticleRestController#recommend = 47</span><br></pre></td></tr></table></figure>

<p>-â€”é¢è¯•å¯ä»¥ä¸èƒŒï¼Œæ–¹ä¾¿å¤§å®¶ç†è§£ endâ€”-</p>
<p>é™¤æ­¤ä¹‹å¤–ï¼Œè¿˜æœ‰æƒé™æŽ§åˆ¶ã€æ€§èƒ½ç›‘æŽ§ã€ç¼“å­˜å¤„ç†ç­‰åœºæ™¯ã€‚æ€»çš„æ¥è¯´ï¼Œä»»ä½•éœ€è¦åœ¨å¤šä¸ªåœ°æ–¹é‡å¤æ‰§è¡Œçš„é€šç”¨é€»è¾‘ï¼Œéƒ½å¯ä»¥è€ƒè™‘ç”¨ AOP æ¥å®žçŽ°ã€‚</p>
<blockquote>
<ol>
<li><a target="_blank" rel="noopener" href="https://javabetter.cn/zhishixingqiu/mianshi.html">Java é¢è¯•æŒ‡å—ï¼ˆä»˜è´¹ï¼‰</a>æ”¶å½•çš„äº¬ä¸œé¢ç»åŒå­¦ 5 Java åŽç«¯æŠ€æœ¯ä¸€é¢é¢è¯•åŽŸé¢˜ï¼šAOPåº”ç”¨åœºæ™¯</li>
<li><a target="_blank" rel="noopener" href="https://javabetter.cn/zhishixingqiu/mianshi.html">Java é¢è¯•æŒ‡å—ï¼ˆä»˜è´¹ï¼‰</a>æ”¶å½•çš„ç†æƒ³æ±½è½¦é¢ç»åŒå­¦ 2 ä¸€é¢é¢è¯•åŽŸé¢˜ï¼šAOPçš„ä½¿ç”¨åœºæ™¯æœ‰å“ªäº›ï¼Ÿ</li>
<li><a target="_blank" rel="noopener" href="https://javabetter.cn/zhishixingqiu/mianshi.html">Java é¢è¯•æŒ‡å—ï¼ˆä»˜è´¹ï¼‰</a>æ”¶å½•çš„äº¬ä¸œé¢ç»åŒå­¦ 9 é¢è¯•åŽŸé¢˜ï¼šé¡¹ç›®ä¸­çš„AOPæ˜¯æ€Žä¹ˆç”¨åˆ°çš„</li>
</ol>
</blockquote>
<h3 id="24-ðŸŒŸè¯´è¯´JDKåŠ¨æ€ä»£ç†å’ŒCGLIBä»£ç†çš„åŒºåˆ«ï¼Ÿ"><a href="#24-ðŸŒŸè¯´è¯´JDKåŠ¨æ€ä»£ç†å’ŒCGLIBä»£ç†çš„åŒºåˆ«ï¼Ÿ" class="headerlink" title="24.ðŸŒŸè¯´è¯´JDKåŠ¨æ€ä»£ç†å’ŒCGLIBä»£ç†çš„åŒºåˆ«ï¼Ÿ"></a>24.ðŸŒŸè¯´è¯´JDKåŠ¨æ€ä»£ç†å’ŒCGLIBä»£ç†çš„åŒºåˆ«ï¼Ÿ</h3><p>JDK åŠ¨æ€ä»£ç†å’Œ CGLIB ä»£ç†æ˜¯ Spring AOP ç”¨æ¥åˆ›å»ºä»£ç†å¯¹è±¡çš„ä¸¤ç§æ–¹å¼ã€‚</p>
<p><img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="https://cdn.jsdelivr.net/gh/JakicDong/blog-assets@main/images/20251024164722.png" alt="20251024164722"><br>logbasexï¼šJDK åŠ¨æ€ä»£ç†å’Œ CGLIB ä»£ç†</p>
<p>ä»Žä½¿ç”¨æ¡ä»¶æ¥è¯´ï¼ŒJDK åŠ¨æ€ä»£ç†è¦æ±‚ç›®æ ‡ç±»å¿…é¡»å®žçŽ°è‡³å°‘ä¸€ä¸ªæŽ¥å£ï¼Œå› ä¸ºå®ƒæ˜¯åŸºäºŽæŽ¥å£æ¥åˆ›å»ºä»£ç†çš„ã€‚è€Œ CGLIB ä»£ç†ä¸éœ€è¦ç›®æ ‡ç±»å®žçŽ°æŽ¥å£ï¼Œå®ƒæ˜¯é€šè¿‡ç»§æ‰¿ç›®æ ‡ç±»æ¥åˆ›å»ºä»£ç†çš„ã€‚</p>
<p>è¿™æ˜¯ä¸¤è€…æœ€æ ¹æœ¬çš„åŒºåˆ«ã€‚æ¯”å¦‚æˆ‘ä»¬æœ‰ä¸€ä¸ª TransferService æŽ¥å£å’Œ TransferServiceImpl å®žçŽ°ç±»ï¼Œå¦‚æžœç”¨ JDK åŠ¨æ€ä»£ç†ï¼Œåˆ›å»ºçš„ä»£ç†å¯¹è±¡ä¼šå®žçŽ° TransferService æŽ¥å£ï¼›</p>
<p><img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="https://cdn.jsdelivr.net/gh/JakicDong/blog-assets@main/images/20251024164917.png" alt="20251024164917"><br>logbasexï¼šJDK åŠ¨æ€ä»£ç†</p>
<p>å¦‚æžœç”¨ CGLIBï¼Œä»£ç†å¯¹è±¡ä¼šç»§æ‰¿ TransferServiceImpl ç±»ã€‚</p>
<p><img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="https://cdn.jsdelivr.net/gh/JakicDong/blog-assets@main/images/20251024165053.png" alt="20251024165053"><br>logbasexï¼šCGLIB ä»£ç†</p>
<p>ä»Žå®žçŽ°åŽŸç†æ¥è¯´ï¼ŒJDK åŠ¨æ€ä»£ç†æ˜¯ Java åŽŸç”Ÿæ”¯æŒçš„ï¼Œå®ƒé€šè¿‡åå°„æœºåˆ¶åœ¨è¿è¡Œæ—¶åŠ¨æ€åˆ›å»ºä¸€ä¸ªå®žçŽ°äº†æŒ‡å®šæŽ¥å£çš„ä»£ç†ç±»ã€‚å½“æˆ‘ä»¬è°ƒç”¨ä»£ç†å¯¹è±¡çš„æ–¹æ³•æ—¶ï¼Œä¼šè¢«è½¬å‘åˆ° InvocationHandler çš„ invoke æ–¹æ³•ä¸­ï¼Œæˆ‘ä»¬å¯ä»¥åœ¨è¿™ä¸ªæ–¹æ³•é‡Œæ’å…¥åˆ‡é¢é€»è¾‘ï¼Œç„¶åŽå†é€šè¿‡åå°„è°ƒç”¨ç›®æ ‡å¯¹è±¡çš„çœŸå®žæ–¹æ³•ã€‚</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">JdkProxyExample</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        <span class="type">UserService</span> <span class="variable">target</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">UserServiceImpl</span>();</span><br><span class="line">        </span><br><span class="line">        <span class="type">UserService</span> <span class="variable">proxy</span> <span class="operator">=</span> (UserService) Proxy.newProxyInstance(</span><br><span class="line">            target.getClass().getClassLoader(),</span><br><span class="line">            target.getClass().getInterfaces(),</span><br><span class="line">            (proxy1, method, args1) -&gt; &#123;</span><br><span class="line">                System.out.println(<span class="string">&quot;Before method: &quot;</span> + method.getName());</span><br><span class="line">                <span class="type">Object</span> <span class="variable">result</span> <span class="operator">=</span> method.invoke(target, args1);</span><br><span class="line">                System.out.println(<span class="string">&quot;After method: &quot;</span> + method.getName());</span><br><span class="line">                <span class="keyword">return</span> result;</span><br><span class="line">            &#125;</span><br><span class="line">        );</span><br><span class="line">        </span><br><span class="line">        proxy.findUser(<span class="number">1L</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>CGLIB åˆ™æ˜¯ä¸€ä¸ªç¬¬ä¸‰æ–¹çš„å­—èŠ‚ç ç”Ÿæˆåº“ï¼Œå®ƒé€šè¿‡ ASM å­—èŠ‚ç æ¡†æž¶åŠ¨æ€ç”Ÿæˆç›®æ ‡ç±»çš„å­ç±»ï¼Œç„¶åŽé‡å†™çˆ¶ç±»çš„æ–¹æ³•æ¥æ’å…¥åˆ‡é¢é€»è¾‘ã€‚</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">CglibProxyExample</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        <span class="type">Enhancer</span> <span class="variable">enhancer</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Enhancer</span>();</span><br><span class="line">        enhancer.setSuperclass(UserController.class);</span><br><span class="line">        enhancer.setCallback(<span class="keyword">new</span> <span class="title class_">MethodInterceptor</span>() &#123;</span><br><span class="line">            <span class="meta">@Override</span></span><br><span class="line">            <span class="keyword">public</span> Object <span class="title function_">intercept</span><span class="params">(Object obj, Method method, Object[] args, MethodProxy proxy)</span> <span class="keyword">throws</span> Throwable &#123;</span><br><span class="line">                System.out.println(<span class="string">&quot;Before method: &quot;</span> + method.getName());</span><br><span class="line">                <span class="type">Object</span> <span class="variable">result</span> <span class="operator">=</span> proxy.invokeSuper(obj, args);</span><br><span class="line">                System.out.println(<span class="string">&quot;After method: &quot;</span> + method.getName());</span><br><span class="line">                <span class="keyword">return</span> result;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;);</span><br><span class="line">        </span><br><span class="line">        <span class="type">UserController</span> <span class="variable">proxy</span> <span class="operator">=</span> (UserController) enhancer.create();</span><br><span class="line">        proxy.getUser(<span class="number">1L</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="é€‰æ‹©-CGLIB-è¿˜æ˜¯-JDK-åŠ¨æ€ä»£ç†ï¼Ÿ"><a href="#é€‰æ‹©-CGLIB-è¿˜æ˜¯-JDK-åŠ¨æ€ä»£ç†ï¼Ÿ" class="headerlink" title="é€‰æ‹© CGLIB è¿˜æ˜¯ JDK åŠ¨æ€ä»£ç†ï¼Ÿ"></a>é€‰æ‹© CGLIB è¿˜æ˜¯ JDK åŠ¨æ€ä»£ç†ï¼Ÿ</h4><p>å¦‚æžœç›®æ ‡å¯¹è±¡æ²¡æœ‰å®žçŽ°ä»»ä½•æŽ¥å£ï¼Œå°±åªèƒ½ä½¿ç”¨ CGLIB ä»£ç†ï¼Œå°±æ¯”å¦‚è¯´ Controller å±‚çš„ç±»ã€‚</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// æ²¡æœ‰å®žçŽ°æŽ¥å£çš„Controller</span></span><br><span class="line"><span class="meta">@RestController</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ArticleController</span> &#123;</span><br><span class="line">    <span class="meta">@MdcDot(bizCode = &quot;article.create&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> ResponseVo&lt;String&gt; <span class="title function_">create</span><span class="params">(<span class="meta">@RequestBody</span> ArticleReq req)</span> &#123;</span><br><span class="line">        <span class="comment">// ä¸šåŠ¡é€»è¾‘</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>å¦‚æžœç›®æ ‡å¯¹è±¡å®žçŽ°äº†æŽ¥å£ï¼Œé€šå¸¸é¦–é€‰ JDK åŠ¨æ€ä»£ç†ï¼Œæ¯”å¦‚è¯´ Service å±‚çš„ç±»ï¼Œä¸€èˆ¬éƒ½ä¼šå…ˆå®šä¹‰æŽ¥å£ï¼Œå†å®žçŽ°æŽ¥å£ã€‚</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// æŽ¥å£å®šä¹‰</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">ArticleService</span> &#123;</span><br><span class="line">    <span class="keyword">void</span> <span class="title function_">saveArticle</span><span class="params">(Article article)</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// å®žçŽ°ç±»</span></span><br><span class="line"><span class="meta">@Service</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ArticleServiceImpl</span> <span class="keyword">implements</span> <span class="title class_">ArticleService</span> &#123;</span><br><span class="line">    <span class="meta">@Transactional(rollbackFor = Exception.class)</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">saveArticle</span><span class="params">(Article article)</span> &#123;</span><br><span class="line">        <span class="comment">// ä¸šåŠ¡é€»è¾‘</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>åœ¨ Spring Boot 2.0 ä¹‹åŽï¼ŒSpring AOP é»˜è®¤ä½¿ç”¨ CGLIB ä»£ç†ã€‚è¿™æ˜¯å› ä¸º Spring Boot ä½œä¸ºä¸€ä¸ªè¿½æ±‚â€œçº¦å®šä¼˜äºŽé…ç½®â€çš„æ¡†æž¶ï¼Œé€‰æ‹© CGLIBï¼Œå¯ä»¥ç®€åŒ–å¼€å‘è€…çš„å¿ƒæ™ºè´Ÿæ‹…ï¼Œé¿å…å› ä¸ºå¿˜è®°å®žçŽ°æŽ¥å£è€Œå¯¼è‡´ AOP ä¸ç”Ÿæ•ˆçš„é—®é¢˜ã€‚</p>
<p><img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="https://cdn.jsdelivr.net/gh/JakicDong/blog-assets@main/images/20251024165224.png" alt="20251024165224"><br>æŠ€æœ¯æ´¾æºç ï¼šAopAutoConfiguration</p>
<h4 id="ä½ ä¼šç”¨-JDK-åŠ¨æ€ä»£ç†å—ï¼Ÿ"><a href="#ä½ ä¼šç”¨-JDK-åŠ¨æ€ä»£ç†å—ï¼Ÿ" class="headerlink" title="ä½ ä¼šç”¨ JDK åŠ¨æ€ä»£ç†å—ï¼Ÿ"></a>ä½ ä¼šç”¨ JDK åŠ¨æ€ä»£ç†å—ï¼Ÿ</h4><p>ä¼šçš„ã€‚</p>
<p>å‡è®¾æˆ‘ä»¬æœ‰è¿™æ ·ä¸€ä¸ªå°åœºæ™¯ï¼Œå®¢æœä¸­è½¬ï¼Œè§£å†³ç”¨æˆ·é—®é¢˜ï¼š</p>
<p><img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="https://cdn.jsdelivr.net/gh/JakicDong/blog-assets@main/images/20251024165235.png" alt="20251024165235"><br>ä¸‰åˆ†æ¶é¢æ¸£é€†è¢­ï¼šç”¨æˆ·å‘å®¢æœæé—®é¢˜</p>
<p>æˆ‘ä»¬å¯ä»¥ç”¨ JDK åŠ¨æ€ä»£ç†æ¥å®žçŽ°è¿™ä¸ªåœºæ™¯ã€‚JDK åŠ¨æ€ä»£ç†çš„æ ¸å¿ƒæ˜¯é€šè¿‡åå°„æœºåˆ¶åœ¨è¿è¡Œæ—¶åˆ›å»ºä¸€ä¸ªå®žçŽ°äº†æŒ‡å®šæŽ¥å£çš„ä»£ç†ç±»ã€‚</p>
<p><img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="https://cdn.jsdelivr.net/gh/JakicDong/blog-assets@main/images/20251024165247.png" alt="20251024165247"><br>ä¸‰åˆ†æ¶é¢æ¸£é€†è¢­ï¼šJDKåŠ¨æ€ä»£ç†ç±»å›¾</p>
<p>ç¬¬ä¸€æ­¥ï¼Œåˆ›å»ºæŽ¥å£ã€‚</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">ISolver</span> &#123;</span><br><span class="line">    <span class="keyword">void</span> <span class="title function_">solve</span><span class="params">()</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>ç¬¬äºŒæ­¥ï¼Œå®žçŽ°æŽ¥å£ã€‚</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Solver</span> <span class="keyword">implements</span> <span class="title class_">ISolver</span> &#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">solve</span><span class="params">()</span> &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;ç–¯ç‹‚æŽ‰å¤´å‘è§£å†³é—®é¢˜â€¦â€¦&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>ç¬¬ä¸‰æ­¥ï¼Œä½¿ç”¨ç”¨åå°„ç”Ÿæˆç›®æ ‡å¯¹è±¡çš„ä»£ç†ï¼Œè¿™é‡Œç”¨äº†ä¸€ä¸ªåŒ¿åå†…éƒ¨ç±»æ–¹å¼é‡å†™ InvocationHandler æ–¹æ³•ã€‚</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ProxyFactory</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// ç»´æŠ¤ä¸€ä¸ªç›®æ ‡å¯¹è±¡</span></span><br><span class="line">    <span class="keyword">private</span> Object target;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">ProxyFactory</span><span class="params">(Object target)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.target = target;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// ä¸ºç›®æ ‡å¯¹è±¡ç”Ÿæˆä»£ç†å¯¹è±¡</span></span><br><span class="line">    <span class="keyword">public</span> Object <span class="title function_">getProxyInstance</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> Proxy.newProxyInstance(target.getClass().getClassLoader(), target.getClass().getInterfaces(),</span><br><span class="line">                <span class="keyword">new</span> <span class="title class_">InvocationHandler</span>() &#123;</span><br><span class="line">                    <span class="meta">@Override</span></span><br><span class="line">                    <span class="keyword">public</span> Object <span class="title function_">invoke</span><span class="params">(Object proxy, Method method, Object[] args)</span> <span class="keyword">throws</span> Throwable &#123;</span><br><span class="line">                        System.out.println(<span class="string">&quot;è¯·é—®æœ‰ä»€ä¹ˆå¯ä»¥å¸®åˆ°æ‚¨ï¼Ÿ&quot;</span>);</span><br><span class="line"></span><br><span class="line">                        <span class="comment">// è°ƒç”¨ç›®æ ‡å¯¹è±¡æ–¹æ³•</span></span><br><span class="line">                        <span class="type">Object</span> <span class="variable">returnValue</span> <span class="operator">=</span> method.invoke(target, args);</span><br><span class="line"></span><br><span class="line">                        System.out.println(<span class="string">&quot;é—®é¢˜å·²ç»è§£å†³å•¦ï¼&quot;</span>);</span><br><span class="line">                        <span class="keyword">return</span> <span class="literal">null</span>;</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>ç¬¬å››æ­¥ï¼Œç”Ÿæˆä¸€ä¸ªä»£ç†å¯¹è±¡å®žä¾‹ï¼Œé€šè¿‡ä»£ç†å¯¹è±¡è°ƒç”¨ç›®æ ‡å¯¹è±¡æ–¹æ³•ã€‚</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Client</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        <span class="comment">//ç›®æ ‡å¯¹è±¡:ç¨‹åºå‘˜</span></span><br><span class="line">        <span class="type">ISolver</span> <span class="variable">developer</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Solver</span>();</span><br><span class="line">        <span class="comment">//ä»£ç†ï¼šå®¢æœå°å§å§</span></span><br><span class="line">        <span class="type">ISolver</span> <span class="variable">csProxy</span> <span class="operator">=</span> (ISolver) <span class="keyword">new</span> <span class="title class_">ProxyFactory</span>(developer).getProxyInstance();</span><br><span class="line">        <span class="comment">//ç›®æ ‡æ–¹æ³•ï¼šè§£å†³é—®é¢˜</span></span><br><span class="line">        csProxy.solve();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="ä½ ä¼šç”¨-CGLIB-åŠ¨æ€ä»£ç†å—ï¼Ÿ"><a href="#ä½ ä¼šç”¨-CGLIB-åŠ¨æ€ä»£ç†å—ï¼Ÿ" class="headerlink" title="ä½ ä¼šç”¨ CGLIB åŠ¨æ€ä»£ç†å—ï¼Ÿ"></a>ä½ ä¼šç”¨ CGLIB åŠ¨æ€ä»£ç†å—ï¼Ÿ</h4><p>ä¼šçš„ã€‚</p>
<p><img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="https://cdn.jsdelivr.net/gh/JakicDong/blog-assets@main/images/20251024165344.png" alt="20251024165344"><br>ä¸‰åˆ†æ¶é¢æ¸£é€†è¢­ï¼šCGLIBåŠ¨æ€ä»£ç†ç±»å›¾</p>
<p>ç¬¬ä¸€æ­¥ï¼šå®šä¹‰ç›®æ ‡ç±» Solverï¼Œå®šä¹‰ solve æ–¹æ³•ï¼Œæ¨¡æ‹Ÿè§£å†³é—®é¢˜çš„è¡Œä¸ºã€‚ç›®æ ‡ç±»ä¸éœ€è¦å®žçŽ°ä»»ä½•æŽ¥å£ï¼Œè¿™ä¸Ž JDK åŠ¨æ€ä»£ç†çš„è¦æ±‚ä¸åŒã€‚</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Solver</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">solve</span><span class="params">()</span> &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;ç–¯ç‹‚æŽ‰å¤´å‘è§£å†³é—®é¢˜â€¦â€¦&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>ç¬¬äºŒæ­¥ï¼šåˆ›å»ºä»£ç†å·¥åŽ‚ ProxyFactoryï¼Œä½¿ç”¨ CGLIB çš„ Enhancer ç±»æ¥ç”Ÿæˆç›®æ ‡ç±»çš„å­ç±»ï¼ˆä»£ç†å¯¹è±¡ï¼‰ã€‚CGLIB å…è®¸æˆ‘ä»¬åœ¨è¿è¡Œæ—¶åŠ¨æ€åˆ›å»ºä¸€ä¸ªç»§æ‰¿è‡ªç›®æ ‡ç±»çš„ä»£ç†ç±»ï¼Œå¹¶é‡å†™ç›®æ ‡æ–¹æ³•ã€‚</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ProxyFactory</span> <span class="keyword">implements</span> <span class="title class_">MethodInterceptor</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//ç»´æŠ¤ä¸€ä¸ªç›®æ ‡å¯¹è±¡</span></span><br><span class="line">    <span class="keyword">private</span> Object target;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">ProxyFactory</span><span class="params">(Object target)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.target = target;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//ä¸ºç›®æ ‡å¯¹è±¡ç”Ÿæˆä»£ç†å¯¹è±¡</span></span><br><span class="line">    <span class="keyword">public</span> Object <span class="title function_">getProxyInstance</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="comment">//å·¥å…·ç±»</span></span><br><span class="line">        <span class="type">Enhancer</span> <span class="variable">en</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Enhancer</span>();</span><br><span class="line">        <span class="comment">//è®¾ç½®çˆ¶ç±»</span></span><br><span class="line">        en.setSuperclass(target.getClass());</span><br><span class="line">        <span class="comment">//è®¾ç½®å›žè°ƒå‡½æ•°</span></span><br><span class="line">        en.setCallback(<span class="built_in">this</span>);</span><br><span class="line">        <span class="comment">//åˆ›å»ºå­ç±»å¯¹è±¡ä»£ç†</span></span><br><span class="line">        <span class="keyword">return</span> en.create();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> Object <span class="title function_">intercept</span><span class="params">(Object obj, Method method, Object[] args, MethodProxy proxy)</span> <span class="keyword">throws</span> Throwable &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;è¯·é—®æœ‰ä»€ä¹ˆå¯ä»¥å¸®åˆ°æ‚¨ï¼Ÿ&quot;</span>);</span><br><span class="line">        <span class="comment">// æ‰§è¡Œç›®æ ‡å¯¹è±¡çš„æ–¹æ³•</span></span><br><span class="line">        <span class="type">Object</span> <span class="variable">returnValue</span> <span class="operator">=</span> method.invoke(target, args);</span><br><span class="line">        System.out.println(<span class="string">&quot;é—®é¢˜å·²ç»è§£å†³å•¦ï¼&quot;</span>);</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">null</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>ç¬¬ä¸‰æ­¥ï¼šåˆ›å»ºå®¢æˆ·ç«¯ Clientï¼ŒèŽ·å–ä»£ç†å¯¹è±¡å¹¶è°ƒç”¨ç›®æ ‡æ–¹æ³•ã€‚</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Client</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        <span class="comment">//ç›®æ ‡å¯¹è±¡:ç¨‹åºå‘˜</span></span><br><span class="line">        <span class="type">Solver</span> <span class="variable">developer</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Solver</span>();</span><br><span class="line">        <span class="comment">//ä»£ç†ï¼šå®¢æœå°å§å§</span></span><br><span class="line">        <span class="type">Solver</span> <span class="variable">csProxy</span> <span class="operator">=</span> (Solver) <span class="keyword">new</span> <span class="title class_">ProxyFactory</span>(developer).getProxyInstance();</span><br><span class="line">        <span class="comment">//ç›®æ ‡æ–¹æ³•ï¼šè§£å†³é—®é¢˜</span></span><br><span class="line">        csProxy.solve();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<blockquote>
<ol>
<li><a target="_blank" rel="noopener" href="https://javabetter.cn/zhishixingqiu/mianshi.html">Java é¢è¯•æŒ‡å—ï¼ˆä»˜è´¹ï¼‰</a>æ”¶å½•çš„å¸†è½¯åŒå­¦ 3 Java åŽç«¯ä¸€é¢çš„åŽŸé¢˜ï¼šcglib çš„åŽŸç†</li>
<li><a target="_blank" rel="noopener" href="https://javabetter.cn/zhishixingqiu/mianshi.html">Java é¢è¯•æŒ‡å—ï¼ˆä»˜è´¹ï¼‰</a>æ”¶å½•çš„è…¾è®¯é¢ç»åŒå­¦ 22 æš‘æœŸå®žä¹ ä¸€é¢é¢è¯•åŽŸé¢˜ï¼šSpring AOP å®žçŽ°åŽŸç†</li>
<li><a target="_blank" rel="noopener" href="https://javabetter.cn/zhishixingqiu/mianshi.html">Java é¢è¯•æŒ‡å—ï¼ˆä»˜è´¹ï¼‰</a>æ”¶å½•çš„å°ç±³é¢ç»åŒå­¦ F é¢è¯•åŽŸé¢˜ï¼šä¸¤ç§åŠ¨æ€ä»£ç†çš„åŒºåˆ«</li>
<li><a target="_blank" rel="noopener" href="https://javabetter.cn/zhishixingqiu/mianshi.html">Java é¢è¯•æŒ‡å—ï¼ˆä»˜è´¹ï¼‰</a>æ”¶å½•çš„å­—èŠ‚è·³åŠ¨é¢ç»åŒå­¦ 8 Java åŽç«¯å®žä¹ ä¸€é¢é¢è¯•åŽŸé¢˜ï¼šspringçš„aopæ˜¯å¦‚ä½•å®žçŽ°çš„</li>
<li><a target="_blank" rel="noopener" href="https://javabetter.cn/zhishixingqiu/mianshi.html">Java é¢è¯•æŒ‡å—ï¼ˆä»˜è´¹ï¼‰</a>æ”¶å½•çš„è…¾è®¯äº‘æ™ºé¢ç»åŒå­¦ 20 äºŒé¢é¢è¯•åŽŸé¢˜ï¼šspring aopçš„åº•å±‚åŽŸç†æ˜¯ä»€ä¹ˆï¼Ÿ</li>
<li><a target="_blank" rel="noopener" href="https://javabetter.cn/zhishixingqiu/mianshi.html">Java é¢è¯•æŒ‡å—ï¼ˆä»˜è´¹ï¼‰</a>æ”¶å½•çš„ç¾Žå›¢é¢ç»åŒå­¦ 3 Java åŽç«¯æŠ€æœ¯ä¸€é¢é¢è¯•åŽŸé¢˜ï¼šjavaçš„åå°„æœºåˆ¶ï¼Œåå°„çš„åº”ç”¨åœºæ™¯AOPçš„å®žçŽ°åŽŸç†æ˜¯ä»€ä¹ˆï¼Œä¸ŽåŠ¨æ€ä»£ç†å’Œåå°„æœ‰ä»€ä¹ˆåŒºåˆ«</li>
<li><a target="_blank" rel="noopener" href="https://javabetter.cn/zhishixingqiu/mianshi.html">Java é¢è¯•æŒ‡å—ï¼ˆä»˜è´¹ï¼‰</a>æ”¶å½•çš„æ¯”äºšè¿ªé¢ç»åŒå­¦ 12 Java æŠ€æœ¯é¢è¯•åŽŸé¢˜ï¼šä»£ç†ä»‹ç»ä¸€ä¸‹ï¼Œjdkå’Œcglibçš„åŒºåˆ«</li>
<li><a target="_blank" rel="noopener" href="https://javabetter.cn/zhishixingqiu/mianshi.html">Java é¢è¯•æŒ‡å—ï¼ˆä»˜è´¹ï¼‰</a>æ”¶å½•çš„å¿«æ‰‹åŒå­¦ 4 ä¸€é¢åŽŸé¢˜ï¼šSpring AOPçš„å®žçŽ°åŽŸç†ï¼ŸJDKåŠ¨æ€ä»£ç†å’ŒCGLibåŠ¨æ€ä»£ç†çš„å„è‡ªå®žçŽ°åŠå…¶åŒºåˆ«ï¼ŸçŽ°åœ¨éœ€è¦ç»Ÿè®¡æ–¹æ³•çš„å…·ä½“æ‰§è¡Œæ—¶é—´ï¼Œè¯´ä¸‹å¦‚ä½•ä½¿ç”¨AOPæ¥å®žçŽ°ï¼Ÿ</li>
<li><a target="_blank" rel="noopener" href="https://javabetter.cn/zhishixingqiu/mianshi.html">Java é¢è¯•æŒ‡å—ï¼ˆä»˜è´¹ï¼‰</a>æ”¶å½•çš„ç†æƒ³æ±½è½¦é¢ç»åŒå­¦ 2 ä¸€é¢é¢è¯•åŽŸé¢˜ï¼šäº†è§£AOPåº•å±‚æ˜¯æ€Žä¹ˆåšçš„å—ï¼Ÿ</li>
</ol>
</blockquote>
<h3 id="25-ðŸŒŸè¯´è¯´ä½ å¯¹Springäº‹åŠ¡çš„ç†è§£ï¼Ÿ"><a href="#25-ðŸŒŸè¯´è¯´ä½ å¯¹Springäº‹åŠ¡çš„ç†è§£ï¼Ÿ" class="headerlink" title="25.ðŸŒŸè¯´è¯´ä½ å¯¹Springäº‹åŠ¡çš„ç†è§£ï¼Ÿ"></a>25.ðŸŒŸè¯´è¯´ä½ å¯¹Springäº‹åŠ¡çš„ç†è§£ï¼Ÿ</h3><p>Spring æä¾›äº†ä¸¤ç§äº‹åŠ¡ç®¡ç†æ–¹å¼ï¼Œç¼–ç¨‹å¼äº‹åŠ¡å’Œå£°æ˜Žå¼äº‹åŠ¡ã€‚ç¼–ç¨‹å¼äº‹åŠ¡å°±æ˜¯æˆ‘ä»¬è¦æ‰‹åŠ¨è°ƒç”¨äº‹åŠ¡çš„å¼€å§‹ã€æäº¤ã€å›žæ»šè¿™äº›æ“ä½œï¼Œè™½ç„¶çµæ´»ä½†æ˜¯ä»£ç æ¯”è¾ƒç¹çã€‚å£°æ˜Žå¼äº‹åŠ¡åªéœ€è¦åœ¨éœ€è¦äº‹åŠ¡çš„æ–¹æ³•ä¸ŠåŠ ä¸Š <code>@Transactional</code> æ³¨è§£å°±å¥½äº†ï¼ŒSpring ä¼šå¸®æˆ‘ä»¬è‡ªåŠ¨å¤„ç†äº‹åŠ¡çš„æ•´ä¸ªç”Ÿå‘½å‘¨æœŸã€‚</p>
<p><img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="https://cdn.jsdelivr.net/gh/JakicDong/blog-assets@main/images/20251024184234.png" alt="20251024184234"><br>Spring TransactionInterceptor</p>
<p>-â€”è¿™éƒ¨åˆ†å¯ä»¥ä¸èƒŒï¼Œæ–¹ä¾¿å¤§å®¶ç†è§£ startâ€”-</p>
<p>ç¼–ç¨‹å¼äº‹åŠ¡å¯ä»¥ä½¿ç”¨ TransactionTemplate å’Œ PlatformTransactionManager æ¥å®žçŽ°ï¼Œå…è®¸æˆ‘ä»¬åœ¨ä»£ç ä¸­ç›´æŽ¥æŽ§åˆ¶äº‹åŠ¡çš„è¾¹ç•Œã€‚</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">AccountService</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> TransactionTemplate transactionTemplate;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setTransactionTemplate</span><span class="params">(TransactionTemplate transactionTemplate)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.transactionTemplate = transactionTemplate;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">transfer</span><span class="params">(<span class="keyword">final</span> String out, <span class="keyword">final</span> String in, <span class="keyword">final</span> Double money)</span> &#123;</span><br><span class="line">        transactionTemplate.execute(<span class="keyword">new</span> <span class="title class_">TransactionCallbackWithoutResult</span>() &#123;</span><br><span class="line">            <span class="meta">@Override</span></span><br><span class="line">            <span class="keyword">protected</span> <span class="keyword">void</span> <span class="title function_">doInTransactionWithoutResult</span><span class="params">(TransactionStatus status)</span> &#123;</span><br><span class="line">                <span class="comment">// è½¬å‡º</span></span><br><span class="line">                accountDao.outMoney(out, money);</span><br><span class="line">                <span class="comment">// è½¬å…¥</span></span><br><span class="line">                accountDao.inMoney(in, money);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>-â€”è¿™éƒ¨åˆ†å¯ä»¥ä¸èƒŒï¼Œæ–¹ä¾¿å¤§å®¶ç†è§£ endâ€”-</p>
<p>Spring äº‹åŠ¡çš„åº•å±‚å®žçŽ°æ˜¯é€šè¿‡ AOP æ¥å®Œæˆçš„ã€‚å½“æˆ‘ä»¬åœ¨æ–¹æ³•ä¸ŠåŠ  <code>@Transactional</code> æ³¨è§£åŽï¼ŒSpring ä¼šä¸ºè¿™ä¸ª Bean åˆ›å»ºä»£ç†å¯¹è±¡ï¼Œåœ¨æ–¹æ³•æ‰§è¡Œå‰å¼€å¯äº‹åŠ¡ï¼Œæ–¹æ³•æ­£å¸¸è¿”å›žæ—¶æäº¤äº‹åŠ¡ï¼Œå¦‚æžœæ–¹æ³•æŠ›å‡ºå¼‚å¸¸å°±å›žæ»šäº‹åŠ¡ã€‚</p>
<p>å£°æ˜Žå¼äº‹åŠ¡çš„ä¼˜ç‚¹æ˜¯ä¸éœ€è¦åœ¨ä¸šåŠ¡é€»è¾‘ä»£ç ä¸­æŽºæ‚äº‹åŠ¡ç®¡ç†çš„ä»£ç ï¼Œç¼ºç‚¹æ˜¯ï¼Œæœ€ç»†ç²’åº¦åªèƒ½åˆ°æ–¹æ³•çº§åˆ«ï¼Œæ— æ³•åˆ°ä»£ç å—çº§åˆ«ã€‚</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Service</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">AccountService</span> &#123;</span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> AccountDao accountDao;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Transactional</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">transfer</span><span class="params">(String out, String in, Double money)</span> &#123;</span><br><span class="line">        <span class="comment">// è½¬å‡º</span></span><br><span class="line">        accountDao.outMoney(out, money);</span><br><span class="line">        <span class="comment">// è½¬å…¥</span></span><br><span class="line">        accountDao.inMoney(in, money);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<blockquote>
<ol>
<li><a target="_blank" rel="noopener" href="https://javabetter.cn/zhishixingqiu/mianshi.html">Java é¢è¯•æŒ‡å—ï¼ˆä»˜è´¹ï¼‰</a>æ”¶å½•çš„äº¬ä¸œåŒå­¦ 10 åŽç«¯å®žä¹ ä¸€é¢çš„åŽŸé¢˜ï¼šSpring äº‹åŠ¡æ€Žä¹ˆå®žçŽ°çš„</li>
<li><a target="_blank" rel="noopener" href="https://javabetter.cn/zhishixingqiu/mianshi.html">Java é¢è¯•æŒ‡å—ï¼ˆä»˜è´¹ï¼‰</a>æ”¶å½•çš„å†œä¸šé“¶è¡Œé¢ç»åŒå­¦ 7 Java åŽç«¯é¢è¯•åŽŸé¢˜ï¼šSpring å¦‚ä½•ä¿è¯äº‹åŠ¡</li>
<li><a target="_blank" rel="noopener" href="https://javabetter.cn/zhishixingqiu/mianshi.html">Java é¢è¯•æŒ‡å—ï¼ˆä»˜è´¹ï¼‰</a>æ”¶å½•çš„æ¯”äºšè¿ªé¢ç»åŒå­¦ 12 Java æŠ€æœ¯é¢è¯•åŽŸé¢˜ï¼šSpringçš„äº‹åŠ¡ç”¨è¿‡å—ï¼Œåœ¨é¡¹ç›®é‡Œé¢æ€Žä¹ˆä½¿ç”¨çš„</li>
<li><a target="_blank" rel="noopener" href="https://javabetter.cn/zhishixingqiu/mianshi.html">Java é¢è¯•æŒ‡å—ï¼ˆä»˜è´¹ï¼‰</a>æ”¶å½•çš„è™¾çš®é¢ç»åŒå­¦ 13 ä¸€é¢é¢è¯•åŽŸé¢˜ï¼šspringäº‹åŠ¡</li>
<li><a target="_blank" rel="noopener" href="https://javabetter.cn/zhishixingqiu/mianshi.html">Java é¢è¯•æŒ‡å—ï¼ˆä»˜è´¹ï¼‰</a>æ”¶å½•çš„é˜¿é‡Œäº‘é¢ç»åŒå­¦ 22 é¢ç»ï¼šå¦‚ä½•ä½¿ç”¨springå®žçŽ°äº‹åŠ¡</li>
</ol>
</blockquote>
<h3 id="29-ðŸŒŸè¯´è¯´Springçš„äº‹åŠ¡ä¼ æ’­æœºåˆ¶ï¼Ÿ"><a href="#29-ðŸŒŸè¯´è¯´Springçš„äº‹åŠ¡ä¼ æ’­æœºåˆ¶ï¼Ÿ" class="headerlink" title="29.ðŸŒŸè¯´è¯´Springçš„äº‹åŠ¡ä¼ æ’­æœºåˆ¶ï¼Ÿ"></a>29.ðŸŒŸè¯´è¯´Springçš„äº‹åŠ¡ä¼ æ’­æœºåˆ¶ï¼Ÿ</h3><p>ç®€å•æ¥è¯´ï¼Œå½“ä¸€ä¸ªäº‹åŠ¡æ–¹æ³• A è°ƒç”¨å¦ä¸€ä¸ªäº‹åŠ¡æ–¹æ³• B æ—¶ï¼Œæ–¹æ³• B çš„äº‹åŠ¡åº”è¯¥å¦‚ä½•è¿è¡Œï¼Ÿæ˜¯åŠ å…¥æ–¹æ³• A çš„çŽ°æœ‰äº‹åŠ¡ï¼Œè¿˜æ˜¯å¼€å¯ä¸€ä¸ªæ–°äº‹åŠ¡ï¼Œæˆ–è€…ä»¥éžäº‹åŠ¡æ–¹å¼è¿è¡Œï¼Ÿè¿™å°±æ˜¯äº‹åŠ¡ä¼ æ’­æœºåˆ¶è¦è§£å†³çš„é—®é¢˜ã€‚</p>
<p>Spring å®šä¹‰äº†ä¸ƒç§äº‹åŠ¡ä¼ æ’­è¡Œä¸ºï¼Œå…¶ä¸­ REQUIRED æ˜¯é»˜è®¤çš„ä¼ æ’­è¡Œä¸ºï¼Œè¡¨ç¤ºå¦‚æžœå½“å‰å­˜åœ¨äº‹åŠ¡ï¼Œåˆ™åŠ å…¥è¯¥äº‹åŠ¡ï¼›å¦‚æžœå½“å‰æ²¡æœ‰äº‹åŠ¡ï¼Œåˆ™åˆ›å»ºä¸€ä¸ªæ–°çš„äº‹åŠ¡ã€‚</p>
<p><img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="https://cdn.jsdelivr.net/gh/JakicDong/blog-assets@main/images/20251024184604.png" alt="20251024184604"><br>ä¸‰åˆ†æ¶é¢æ¸£é€†è¢­ï¼šäº‹åŠ¡ä¼ æ’­æœºåˆ¶</p>
<p>æ¯”å¦‚è¯´åœ¨<a target="_blank" rel="noopener" href="https://javabetter.cn/zhishixingqiu/paicoding.html">æŠ€æœ¯æ´¾å®žæˆ˜é¡¹ç›®</a>ä¸­ï¼Œä¸€ä¸ªç”¨æˆ·è§£é”ä»˜è´¹æ–‡ç« çš„æ“ä½œï¼Œä¼šæ¶‰åŠåˆ°åˆ›å»ºæ”¯ä»˜è®¢å•ã€æ›´æ–°è®¢å•çŠ¶æ€ç­‰å¥½å‡ ä¸ªæ•°æ®åº“æ“ä½œã€‚</p>
<p><img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="https://cdn.jsdelivr.net/gh/JakicDong/blog-assets@main/images/20251024184803.png" alt="20251024184803"><br>æŠ€æœ¯æ´¾æºç ï¼šSpringäº‹åŠ¡ä¼ æ’­æœºåˆ¶</p>
<p>è¿™äº›ä¸åŒæ“ä½œçš„æ–¹æ³•å°±å¯ä»¥æ”¾åœ¨ä¸€ä¸ª <code>@Transactional</code> æ³¨è§£çš„æ–¹æ³•é‡Œï¼Œå®ƒä»¬å°±è‡ªåŠ¨åœ¨åŒä¸€ä¸ªäº‹åŠ¡é‡Œäº†ï¼Œè¦ä¹ˆä¸€èµ·æˆåŠŸï¼Œè¦ä¹ˆä¸€èµ·å¤±è´¥ã€‚</p>
<p>å½“ç„¶ï¼Œè¿˜æœ‰ä¸€äº›ç‰¹æ®Šæƒ…å†µã€‚æ¯”å¦‚ï¼Œæˆ‘ä»¬å¸Œæœ›è®°å½•ä¸€äº›æ“ä½œæ—¥å¿—ï¼Œä½†ä¸æƒ³å› ä¸ºä¸»ä¸šåŠ¡å¤±è´¥å¯¼è‡´æ—¥å¿—å›žæ»šã€‚è¿™æ—¶å€™ REQUIRES_NEW å°±æ´¾ä¸Šç”¨åœºäº†ã€‚å®ƒä¸ç®¡å½“å‰æœ‰æ²¡æœ‰äº‹åŠ¡ï¼Œéƒ½é‡æ–°å¼€å¯ä¸€ä¸ªå…¨æ–°çš„ã€ç‹¬ç«‹çš„äº‹åŠ¡æ¥æ‰§è¡Œã€‚è¿™æ ·ï¼Œæ—¥å¿—ä¿å­˜çš„äº‹åŠ¡å’Œä¸»ä¸šåŠ¡çš„äº‹åŠ¡å°±äº’ä¸å¹²æ‰°ï¼Œå³ä½¿ä¸»ä¸šåŠ¡å¤±è´¥å›žæ»šï¼Œæ—¥å¿—ä¹Ÿèƒ½å¦¥å¦¥åœ°ä¿å­˜ä¸‹æ¥ã€‚</p>
<p>å¦å¤–ï¼Œè¿˜æœ‰åƒ SUPPORTSã€ NOT_SUPPORTED è¿™äº›ã€‚SUPPORTS æ¯”è¾ƒä½›ç³»ï¼Œæœ‰äº‹åŠ¡å°±ç”¨ï¼Œæ²¡äº‹åŠ¡å°±ä¸ç”¨ï¼Œé€‚åˆä¸€äº›ä¸é‡è¦çš„æ›´æ–°æ“ä½œã€‚è€Œ NOT_SUPPORTED åˆ™æ›´å¹²è„†ï¼Œå®ƒä¼šæŠŠå½“å‰çš„äº‹åŠ¡æŒ‚èµ·ï¼Œä»¥éžäº‹åŠ¡çš„æ–¹å¼åŽ»æ‰§è¡Œã€‚æ¯”å¦‚è¯´æˆ‘ä»¬çš„äº‹åŠ¡é‡Œéœ€è¦è°ƒç”¨ä¸€ä¸ªç¬¬ä¸‰æ–¹çš„ã€å“åº”å¾ˆæ…¢çš„æŽ¥å£ï¼Œå¦‚æžœè¿™ä¸ªè°ƒç”¨ä¹ŸåŒ…å«åœ¨äº‹åŠ¡é‡Œï¼Œå°±ä¼šé•¿æ—¶é—´å ç”¨æ•°æ®åº“è¿žæŽ¥ã€‚æŠŠå®ƒç”¨ NOT_SUPPORTED åŒ…èµ·æ¥ï¼Œå°±å¯ä»¥é¿å…è¿™ä¸ªé—®é¢˜ã€‚</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Transactional(propagation = Propagation.NOT_SUPPORTED)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">callExternalApi</span><span class="params">()</span> &#123;</span><br><span class="line">    <span class="comment">// è°ƒç”¨ç¬¬ä¸‰æ–¹æŽ¥å£</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>æœ€åŽè¿˜æœ‰ä¸€ä¸ªæ¯”è¾ƒç‰¹æ®Šçš„ NESTEDï¼ŒåµŒå¥—äº‹åŠ¡ã€‚å®ƒæœ‰ç‚¹åƒ REQUIRES_NEWï¼Œä½†åˆä¸å®Œå…¨ä¸€æ ·ã€‚NESTED æ˜¯çˆ¶äº‹åŠ¡çš„ä¸€ä¸ªå­äº‹åŠ¡ï¼Œçˆ¶äº‹åŠ¡å›žæ»šï¼Œå®ƒè‚¯å®šä¹Ÿå¾—å›žæ»šã€‚ä½†å®ƒè‡ªå·±å›žæ»šï¼Œå´ä¸ä¼šå½±å“åˆ°çˆ¶äº‹åŠ¡ã€‚è¿™ä¸ªç‰¹æ€§åœ¨å¤„ç†ä¸€äº›æ‰¹é‡æ“ä½œï¼Œå¸Œæœ›èƒ½éƒ¨åˆ†å›žæ»šçš„åœºæ™¯ä¸‹ç‰¹åˆ«æœ‰ç”¨ã€‚ä¸è¿‡å®ƒéœ€è¦æ•°æ®åº“æ”¯æŒ Savepoint åŠŸèƒ½ï¼ŒMySQL å°±æ”¯æŒã€‚</p>
<h4 id="äº‹åŠ¡èƒ½åœ¨æ–°çº¿ç¨‹ä¸­ä¼ æ’­å—ï¼Ÿ"><a href="#äº‹åŠ¡èƒ½åœ¨æ–°çº¿ç¨‹ä¸­ä¼ æ’­å—ï¼Ÿ" class="headerlink" title="äº‹åŠ¡èƒ½åœ¨æ–°çº¿ç¨‹ä¸­ä¼ æ’­å—ï¼Ÿ"></a>äº‹åŠ¡èƒ½åœ¨æ–°çº¿ç¨‹ä¸­ä¼ æ’­å—ï¼Ÿ</h4><p>äº‹åŠ¡ä¼ æ’­æœºåˆ¶æ˜¯é€šè¿‡ <a target="_blank" rel="noopener" href="https://javabetter.cn/thread/ThreadLocal.html">ThreadLocal</a> å®žçŽ°çš„ï¼Œæ‰€ä»¥ï¼Œå¦‚æžœè°ƒç”¨çš„æ–¹æ³•æ˜¯åœ¨æ–°çº¿ç¨‹ä¸­ï¼Œäº‹åŠ¡ä¼ æ’­å°±ä¼šå¤±æ•ˆã€‚</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Transactional</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">parentMethod</span><span class="params">()</span> &#123;</span><br><span class="line">    <span class="keyword">new</span> <span class="title class_">Thread</span>(() -&gt; childMethod()).start();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">childMethod</span><span class="params">()</span> &#123;</span><br><span class="line">    <span class="comment">// è¿™é‡Œçš„æ“ä½œå°†ä¸ä¼šåœ¨ parentMethod çš„äº‹åŠ¡èŒƒå›´å†…æ‰§è¡Œ</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="protected-å’Œ-private-æ–¹æ³•åŠ äº‹åŠ¡ä¼šç”Ÿæ•ˆå—ï¼Ÿ"><a href="#protected-å’Œ-private-æ–¹æ³•åŠ äº‹åŠ¡ä¼šç”Ÿæ•ˆå—ï¼Ÿ" class="headerlink" title="protected å’Œ private æ–¹æ³•åŠ äº‹åŠ¡ä¼šç”Ÿæ•ˆå—ï¼Ÿ"></a>protected å’Œ private æ–¹æ³•åŠ äº‹åŠ¡ä¼šç”Ÿæ•ˆå—ï¼Ÿ</h4><p>æˆ‘çš„ç†è§£æ˜¯ï¼šåœ¨ private æ–¹æ³•ä¸ŠåŠ äº‹åŠ¡æ˜¯è‚¯å®šä¸ä¼šç”Ÿæ•ˆçš„ï¼Œè€Œ protected æ–¹æ³•åœ¨ç‰¹å®šçš„ä»£ç†æ¨¡å¼ä¸‹æ˜¯å¯èƒ½ç”Ÿæ•ˆçš„ï¼Œä½†è¿™ä¸¤ç§ç”¨æ³•éƒ½åº”è¯¥é¿å…ï¼Œä¸æ˜¯æŽ¨èçš„ä½¿ç”¨æ–¹å¼ã€‚</p>
<p>è¿™èƒŒåŽæ¶‰åŠåˆ° Spring AOP çš„ä»£ç†æœºåˆ¶ã€‚</p>
<p>æˆ‘å…ˆè¯´ä¸€ä¸‹ JDK åŠ¨æ€ä»£ç†ï¼Œå®ƒè¦æ±‚ç›®æ ‡ç±»å¿…é¡»å®žçŽ°ä¸€ä¸ªæˆ–è€…å¤šä¸ªæŽ¥å£ã€‚ä¹Ÿå°±æ„å‘³ç€ä»£ç†åªèƒ½æ‹¦æˆªæŽ¥å£ä¸­å£°æ˜Žçš„æ–¹æ³•ï¼Œè€Œ protected å’Œ private æ–¹æ³•å¹¶ä¸èƒ½åœ¨æŽ¥å£ä¸­å£°æ˜Žï¼Œå› æ­¤åœ¨ JDK åŠ¨æ€ä»£ç†ä¸‹ï¼Œè¿™äº›æ–¹æ³•çš„äº‹åŠ¡æ³¨è§£æ˜¯ä¼šè¢«ç›´æŽ¥å¿½ç•¥çš„ã€‚</p>
<p>é‚£ Spring Boot 2.0 ä¹‹åŽï¼ŒSpring AOP é»˜è®¤ä½¿ç”¨çš„æ˜¯ CGLIB ä»£ç†ã€‚CGLIB ä»£ç†æ˜¯é€šè¿‡ç»§æ‰¿ç›®æ ‡ç±»æ¥åˆ›å»ºä»£ç†å¯¹è±¡çš„ã€‚</p>
<p>é‚£å¯¹äºŽ private æ–¹æ³•æ¥è¯´ï¼Œç”±äºŽæ— æ³•è¢«å­ç±»é‡å†™ï¼Œæ‰€ä»¥ CGLIB ä»£ç†ä¹Ÿæ— æ³•æ‹¦æˆªï¼Œäº‹åŠ¡ä¹Ÿå°±æ— æ³•ç”Ÿæ•ˆã€‚å¯¹äºŽ protected æ–¹æ³•æ¥è¯´ï¼Œå› ä¸ºå®ƒå¯ä»¥è¢«å­ç±»é‡å†™ï¼Œæ‰€ä»¥ç†è®ºä¸Šäº‹åŠ¡æ˜¯ç”Ÿæ•ˆçš„ã€‚</p>
<p>-â€”è¿™éƒ¨åˆ†å¯ä»¥ä¸èƒŒï¼Œæ–¹ä¾¿å¤§å®¶ç†è§£ startâ€”-</p>
<p>æˆ‘ä»¬åˆ›å»ºä¸€ä¸ª protected æ–¹æ³•ï¼Œåä¸º <code>protectedTransactionalMethod</code> ï¼Œå®ƒè¢« <code>@Transactional</code> æ³¨è§£æ ‡è®°ã€‚è¿™ä¸ªæ–¹æ³•ä¼šå…ˆå‘æ•°æ®åº“ä¸­æ’å…¥ä¸€æ¡è®°å½•ï¼ˆä¸€ä¸ª TestEntity å®žä¾‹ï¼‰ã€‚ç´§æŽ¥ç€ï¼Œå®ƒä¼šç«‹å³æŠ›å‡ºä¸€ä¸ª RuntimeException ã€‚</p>
<p><img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="https://cdn.jsdelivr.net/gh/JakicDong/blog-assets@main/images/20251024185126.png" alt="20251024185126"><br>æ´¾èªæ˜Žæºç ï¼šæµ‹è¯• protected æ–¹æ³•çš„äº‹åŠ¡æ˜¯å¦ç”Ÿæ•ˆ</p>
<ul>
<li>å¦‚æžœäº‹åŠ¡ç”Ÿæ•ˆï¼šå½“ RuntimeException æŠ›å‡ºæ—¶ï¼ŒSpring çš„äº‹åŠ¡ç®¡ç†å™¨ä¼šæ•èŽ·å®ƒï¼Œå¹¶è§¦å‘äº‹åŠ¡å›žæ»šã€‚è¿™æ„å‘³ç€ï¼Œä¹‹å‰æ’å…¥æ•°æ®åº“çš„é‚£æ¡è®°å½•ä¼šè¢«æ’¤é”€ã€‚æœ€ç»ˆï¼Œæ•°æ®åº“é‡Œä¸ä¼šç•™ä¸‹è¿™æ¡è®°å½•ã€‚</li>
<li>å¦‚æžœäº‹åŠ¡å¤±æ•ˆï¼šå³ä½¿ RuntimeException è¢«æŠ›å‡ºï¼Œç”±äºŽæ²¡æœ‰äº‹åŠ¡ç®¡ç†ï¼Œå·²ç»æ‰§è¡Œçš„æ•°æ®åº“æ’å…¥æ“ä½œä¸ä¼šè¢«æ’¤é”€ã€‚æœ€ç»ˆï¼Œæ•°æ®åº“é‡Œä¼šç•™ä¸‹è¿™æ¡è®°å½•ã€‚</li>
</ul>
<p>æˆ‘ä»¬åˆ›å»ºäº†ä¸€ä¸ª public æ–¹æ³• <code>testProtectedTransaction</code> ï¼Œå®ƒé€šè¿‡ <code>this.protectedTransactionalMethod()</code> çš„æ–¹å¼ç›´æŽ¥è°ƒç”¨äº†é‚£ä¸ª protected æ–¹æ³•ã€‚æŽ¥ç€æˆ‘ä»¬è®¿é—® <code>/api/v1/test/transaction/protected</code> æ¥è§¦å‘è¿™ä¸ªè°ƒç”¨ã€‚</p>
<p>ç»“æžœï¼šæ•°æ®åº“ä¸­ä¼šç•™ä¸‹ä¸€æ¡åä¸º â€˜test-protectedâ€™ çš„è®°å½•ã€‚è¿™è¯æ˜Žäº†ç”±äºŽæ˜¯å†…éƒ¨è°ƒç”¨ï¼Œç»•è¿‡äº† Spring AOP ä»£ç†ï¼Œ<code>@Transactional</code> æ³¨è§£æ²¡æœ‰ç”Ÿæ•ˆã€‚</p>
<p>æˆ‘ä»¬åˆ›å»ºäº†å¦ä¸€ä¸ª public æ–¹æ³• <code>testProtectedTransactionWithSelfProxy</code>ã€‚åœ¨è¿™ä¸ªæ–¹æ³•é‡Œï¼Œæˆ‘ä»¬é€šè¿‡ä¸€ä¸ªâ€œè‡ªæ³¨å…¥â€çš„ä»£ç†å¯¹è±¡ self æ¥è°ƒç”¨ <code>self.protectedTransactionalMethod()</code>ã€‚æŽ¥ç€æˆ‘ä»¬é€šè¿‡è®¿é—® <code>/api/v1/test/transaction/protected/proxy</code> æ¥è§¦å‘è¿™ä¸ªè°ƒç”¨ã€‚</p>
<p>ç»“æžœï¼šæ•°æ®åº“ä¸­ä¸ä¼šç•™ä¸‹åä¸º â€˜test-protected-proxyâ€™ çš„è®°å½•ã€‚è¿™è¯æ˜Žé€šè¿‡ä»£ç†å¯¹è±¡çš„è°ƒç”¨ï¼ŒSpring AOP æˆåŠŸæ‹¦æˆªå¹¶å¼€å¯äº†äº‹åŠ¡ï¼Œæœ€ç»ˆåœ¨å¼‚å¸¸å‘ç”Ÿæ—¶æ­£ç¡®åœ°å›žæ»šäº†äº‹åŠ¡ã€‚</p>
<p><img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="https://cdn.tobebetterjavaer.com/stutymore/spring-20250714171739.png" alt="æ´¾èªæ˜Žæºç ï¼šprotected æ–¹æ³•çš„äº‹åŠ¡ç”Ÿæ•ˆç»“æžœ"></p>
<p>æ´¾èªæ˜Žæºç ï¼šprotected æ–¹æ³•çš„äº‹åŠ¡ç”Ÿæ•ˆç»“æžœ</p>
<p>-â€”è¿™éƒ¨åˆ†å¯ä»¥ä¸èƒŒï¼Œæ–¹ä¾¿å¤§å®¶ç†è§£ endâ€”-</p>
<blockquote>
<ol>
<li><a target="_blank" rel="noopener" href="https://javabetter.cn/zhishixingqiu/mianshi.html">Java é¢è¯•æŒ‡å—ï¼ˆä»˜è´¹ï¼‰</a>æ”¶å½•çš„äº¬ä¸œåŒå­¦ 10 åŽç«¯å®žä¹ ä¸€é¢çš„åŽŸé¢˜ï¼šäº‹åŠ¡çš„ä¼ æ’­æœºåˆ¶</li>
<li><a target="_blank" rel="noopener" href="https://javabetter.cn/zhishixingqiu/mianshi.html">Java é¢è¯•æŒ‡å—ï¼ˆä»˜è´¹ï¼‰</a>æ”¶å½•çš„å°ç±³æ˜¥æ‹›åŒå­¦ K ä¸€é¢é¢è¯•åŽŸé¢˜ï¼šäº‹åŠ¡ä¼ æ’­ï¼Œprotected å’Œ private åŠ äº‹åŠ¡ä¼šç”Ÿæ•ˆå—,è¿˜æœ‰é‚£äº›ä¸ç”Ÿæ•ˆçš„æƒ…å†µ</li>
<li><a target="_blank" rel="noopener" href="https://javabetter.cn/zhishixingqiu/mianshi.html">Java é¢è¯•æŒ‡å—ï¼ˆä»˜è´¹ï¼‰</a>æ”¶å½•çš„åŽä¸ºé¢ç»åŒå­¦ 8 æŠ€æœ¯äºŒé¢é¢è¯•åŽŸé¢˜ï¼šSpring ä¸­çš„äº‹åŠ¡çš„éš”ç¦»çº§åˆ«ï¼Œäº‹åŠ¡çš„ä¼ æ’­è¡Œä¸ºï¼Ÿ</li>
<li><a target="_blank" rel="noopener" href="https://javabetter.cn/zhishixingqiu/mianshi.html">Java é¢è¯•æŒ‡å—ï¼ˆä»˜è´¹ï¼‰</a>æ”¶å½•çš„oppo é¢ç»åŒå­¦ 8 åŽç«¯å¼€å‘ç§‹æ‹›ä¸€é¢é¢è¯•åŽŸé¢˜ï¼šè®²ä¸€ä¸‹Springäº‹åŠ¡ä¼ æ’­æœºåˆ¶</li>
<li><a target="_blank" rel="noopener" href="https://javabetter.cn/zhishixingqiu/mianshi.html">Java é¢è¯•æŒ‡å—ï¼ˆä»˜è´¹ï¼‰</a>æ”¶å½•çš„é˜¿é‡Œäº‘é¢ç»åŒå­¦ 22 é¢ç»ï¼šä»‹ç»äº‹åŠ¡ä¼ æ’­æ¨¡åž‹</li>
</ol>
</blockquote>
<h3 id="31-ðŸŒŸSpring-MVC-çš„å·¥ä½œæµç¨‹äº†è§£å—ï¼Ÿ"><a href="#31-ðŸŒŸSpring-MVC-çš„å·¥ä½œæµç¨‹äº†è§£å—ï¼Ÿ" class="headerlink" title="31.ðŸŒŸSpring MVC çš„å·¥ä½œæµç¨‹äº†è§£å—ï¼Ÿ"></a>31.ðŸŒŸSpring MVC çš„å·¥ä½œæµç¨‹äº†è§£å—ï¼Ÿ</h3><p>ç®€å•æ¥è¯´ï¼ŒSpring MVC æ˜¯ä¸€ä¸ªåŸºäºŽ Servlet çš„è¯·æ±‚å¤„ç†æ¡†æž¶ï¼Œæ ¸å¿ƒæµç¨‹å¯ä»¥æ¦‚æ‹¬ä¸ºï¼šè¯·æ±‚æŽ¥æ”¶ â†’ è·¯ç”±åˆ†å‘ â†’ æŽ§åˆ¶å™¨å¤„ç† â†’ è§†å›¾è§£æžã€‚</p>
<p><img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="https://cdn.jsdelivr.net/gh/JakicDong/blog-assets@main/images/20251024185306.png" alt="20251024185306"><br>ä¸‰åˆ†æ¶é¢æ¸£é€†è¢­ï¼šSpring MVCçš„å·¥ä½œæµç¨‹</p>
<p><img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="https://cdn.jsdelivr.net/gh/JakicDong/blog-assets@main/images/20251024185314.png" alt="20251024185314"><br>å›¾ç‰‡æ¥æºäºŽç½‘ç»œï¼šSpringMVCå·¥ä½œæµç¨‹å›¾</p>
<p><img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="https://cdn.jsdelivr.net/gh/JakicDong/blog-assets@main/images/20251024185323.png" alt="20251024185323"><br>_æœªæ¥å¯æœŸï¼šSpringMVCå·¥ä½œæµç¨‹å›¾</p>
<p>ç”¨æˆ·å‘èµ·çš„ HTTP è¯·æ±‚ï¼Œé¦–å…ˆä¼šè¢« DispatcherServlet æ•èŽ·ï¼Œè¿™æ˜¯ Spring MVC çš„â€œå‰ç«¯æŽ§åˆ¶å™¨â€ï¼Œè´Ÿè´£æ‹¦æˆªæ‰€æœ‰è¯·æ±‚ï¼Œèµ·åˆ°ç»Ÿä¸€å…¥å£çš„ä½œç”¨ã€‚</p>
<p>DispatcherServlet æŽ¥æ”¶åˆ°è¯·æ±‚åŽï¼Œä¼šæ ¹æ® URLã€è¯·æ±‚æ–¹æ³•ç­‰ä¿¡æ¯ï¼Œäº¤ç»™ HandlerMapping è¿›è¡Œè·¯ç”±åŒ¹é…ï¼ŒæŸ¥æ‰¾å¯¹åº”çš„å¤„ç†å™¨ï¼Œä¹Ÿå°±æ˜¯ Controller ä¸­çš„å…·ä½“æ–¹æ³•ã€‚</p>
<p><img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="https://cdn.jsdelivr.net/gh/JakicDong/blog-assets@main/images/20251024185332.png" alt="20251024185332"><br>æŠ€æœ¯æ´¾æºç ï¼šController</p>
<p>æ‰¾åˆ°å¯¹åº” Controller æ–¹æ³•åŽï¼ŒDispatcherServlet ä¼šå§”æ‰˜ç»™å¤„ç†å™¨é€‚é…å™¨ HandlerAdapter è¿›è¡Œè°ƒç”¨ã€‚å¤„ç†å™¨é€‚é…å™¨è´Ÿè´£æ‰§è¡Œæ–¹æ³•æœ¬èº«ï¼Œå¹¶å¤„ç†å‚æ•°ç»‘å®šã€æ•°æ®ç±»åž‹è½¬æ¢ç­‰ã€‚åœ¨æ³¨è§£é©±åŠ¨å¼€å‘ä¸­ï¼Œå¸¸ç”¨çš„æ˜¯ RequestMappingHandlerAdapterã€‚è¿™ä¸€å±‚ä¼šæŠŠè¯·æ±‚å‚æ•°è‡ªåŠ¨æ³¨å…¥åˆ°æ–¹æ³•å½¢å‚ä¸­ï¼Œå¹¶è°ƒç”¨ Controller æ‰§è¡Œå®žé™…çš„ä¸šåŠ¡é€»è¾‘ã€‚</p>
<p><img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="https://cdn.jsdelivr.net/gh/JakicDong/blog-assets@main/images/20251024185702.png" alt="20251024185702"><br>æŠ€æœ¯æ´¾æºç ï¼šRequestMappingHandlerAdapter</p>
<p>Controller æ–¹æ³•æœ€ç»ˆä¼šè¿”å›žç»“æžœï¼Œæ¯”å¦‚è§†å›¾åç§°ã€ModelAndView æˆ–ç›´æŽ¥è¿”å›ž JSON æ•°æ®ã€‚</p>
<p>å½“ Controller æ–¹æ³•è¿”å›žè§†å›¾åæ—¶ï¼ŒDispatcherServlet ä¼šè°ƒç”¨ ViewResolver å°†å…¶è§£æžä¸ºå®žé™…çš„ View å¯¹è±¡ï¼Œæ¯”å¦‚ Thymeleaf é¡µé¢ã€‚åœ¨å‰åŽç«¯åˆ†ç¦»çš„æŽ¥å£é¡¹ç›®ä¸­ï¼Œè¿™ä¸€æ­¥åˆ™é€šå¸¸æ˜¯è¿”å›ž JSON æ•°æ®ã€‚</p>
<p>æœ€åŽï¼Œç”± View å¯¹è±¡å®Œæˆæ¸²æŸ“ï¼Œæˆ–è€…å°† JSON ç»“æžœç›´æŽ¥é€šè¿‡ DispatcherServlet è¿”å›žç»™å®¢æˆ·ç«¯ã€‚</p>
<h4 id="ä¸ºä»€ä¹ˆè¿˜éœ€è¦-HandlerAdapterï¼Ÿ"><a href="#ä¸ºä»€ä¹ˆè¿˜éœ€è¦-HandlerAdapterï¼Ÿ" class="headerlink" title="ä¸ºä»€ä¹ˆè¿˜éœ€è¦ HandlerAdapterï¼Ÿ"></a>ä¸ºä»€ä¹ˆè¿˜éœ€è¦ HandlerAdapterï¼Ÿ</h4><p>Spring MVC æ”¯æŒå¤šç§é£Žæ ¼çš„å¤„ç†å™¨ï¼Œæ¯”å¦‚åŸºäºŽ <code>@Controller</code> æ³¨è§£çš„å¤„ç†å™¨ã€å®žçŽ°äº† Controller æŽ¥å£çš„å¤„ç†å™¨ç­‰ã€‚å¦‚æžœæ²¡æœ‰å¤„ç†å™¨é€‚é…å™¨ï¼ŒDispatcherServlet å°±éœ€è¦ç¡¬ç¼–ç æ¯ç§å¤„ç†å™¨çš„è°ƒç”¨æ–¹å¼ï¼Œæ¡†æž¶å°±ä¼šå˜å¾—éžå¸¸åƒµç¡¬â€”â€”æ–°å¢žä¸€ç§ Controller ç±»åž‹ï¼Œå°±å¿…é¡»æ”¹ DispatcherServlet çš„ä»£ç ã€‚</p>
<p>å› æ­¤ï¼ŒSpring å¼•å…¥äº† HandlerAdapter ä½œä¸ºé€‚é…å™¨ï¼Œå±è”½ä¸åŒæŽ§åˆ¶å™¨çš„å·®å¼‚ï¼Œç»™ DispatcherServlet æä¾›ä¸€ä¸ªç»Ÿä¸€çš„è°ƒç”¨å…¥å£ã€‚</p>
<p>æ¯”å¦‚è¯´ï¼Œå¦‚æžœæ˜¯å®žçŽ°äº† Controller æŽ¥å£çš„å¤„ç†å™¨ï¼ŒDispatcherServlet ä¼šä½¿ç”¨ SimpleControllerHandlerAdapter æ¥é€‚é…å®ƒã€‚</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">SimpleControllerHandlerAdapter</span> <span class="keyword">implements</span> <span class="title class_">HandlerAdapter</span> &#123;</span><br><span class="line"></span><br><span class="line">	<span class="meta">@Override</span></span><br><span class="line">	<span class="keyword">public</span> <span class="type">boolean</span> <span class="title function_">supports</span><span class="params">(Object handler)</span> &#123;</span><br><span class="line">		<span class="keyword">return</span> (handler <span class="keyword">instanceof</span> Controller);</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="meta">@Override</span></span><br><span class="line">	<span class="meta">@Nullable</span></span><br><span class="line">	<span class="keyword">public</span> ModelAndView <span class="title function_">handle</span><span class="params">(HttpServletRequest request, HttpServletResponse response, Object handler)</span></span><br><span class="line">			<span class="keyword">throws</span> Exception &#123;</span><br><span class="line"></span><br><span class="line">		<span class="keyword">return</span> ((Controller) handler).handleRequest(request, response);</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// ... çœç•¥ä¸€ä¸ªæ— å…³æ–¹æ³• ...</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>å¦‚æžœæ˜¯ä½¿ç”¨ <code>@RequestMapping</code> æ³¨è§£çš„å¤„ç†å™¨ï¼ŒDispatcherServlet åˆ™ä¼šä½¿ç”¨ RequestMappingHandlerAdapter æ¥é€‚é…ã€‚</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">RequestMappingHandlerAdapter</span> <span class="keyword">implements</span> <span class="title class_">HandlerAdapter</span> &#123;</span><br><span class="line">    <span class="meta">@Override</span>   </span><br><span class="line">    <span class="keyword">public</span> <span class="type">boolean</span> <span class="title function_">supports</span><span class="params">(Object handler)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> (handler <span class="keyword">instanceof</span> HandlerMethod);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="meta">@Nullable</span></span><br><span class="line">    <span class="keyword">public</span> ModelAndView <span class="title function_">handle</span><span class="params">(HttpServletRequest request, HttpServletResponse response, Object handler)</span></span><br><span class="line">            <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">        <span class="type">HandlerMethod</span> <span class="variable">handlerMethod</span> <span class="operator">=</span> (HandlerMethod) handler;</span><br><span class="line">        <span class="comment">// æ‰§è¡Œæ–¹æ³•å¹¶è¿”å›ž ModelAndView      </span></span><br><span class="line">        <span class="keyword">return</span> invokeHandlerMethod(handlerMethod, request, response);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<blockquote>
<ol>
<li><a target="_blank" rel="noopener" href="https://javabetter.cn/zhishixingqiu/mianshi.html">Java é¢è¯•æŒ‡å—ï¼ˆä»˜è´¹ï¼‰</a>æ”¶å½•çš„è…¾è®¯ Java åŽç«¯å®žä¹ ä¸€é¢åŽŸé¢˜ï¼šè¯´è¯´å‰ç«¯å‘èµ·è¯·æ±‚åˆ° SpringMVC çš„æ•´ä¸ªå¤„ç†æµç¨‹ã€‚</li>
<li><a target="_blank" rel="noopener" href="https://javabetter.cn/zhishixingqiu/mianshi.html">Java é¢è¯•æŒ‡å—ï¼ˆä»˜è´¹ï¼‰</a>æ”¶å½•çš„å›½ä¼é¢è¯•åŽŸé¢˜ï¼šè¯´è¯´ SpringMVC çš„æµç¨‹å§</li>
<li><a target="_blank" rel="noopener" href="https://javabetter.cn/zhishixingqiu/mianshi.html">Java é¢è¯•æŒ‡å—ï¼ˆä»˜è´¹ï¼‰</a>æ”¶å½•çš„å°å…¬å¸é¢ç»åŒå­¦ 5 Java åŽç«¯é¢è¯•åŽŸé¢˜ï¼šspringMVC å·¥ä½œæµç¨‹ æˆ‘å¤§æ¦‚å°±æ˜¯æŒ‰é¢æ¸£é€†è¢­é‡Œç­”çš„ï¼Œç­”åˆ°ä¸€åŠæ‰“æ–­æˆ‘ï¼šç„¶åŽä¼šæœ‰ä¸ª Handlerï¼Œè¿™ä¸ª Handler æ˜¯ä»€ä¹ˆä¸œè¥¿å•Šã€‚å‰é¢ Handler ä¸æ˜¯å·²ç»çŸ¥é“ controller äº†å—ï¼Œæˆ‘ç›´æŽ¥æ‰§è¡Œä¸å°±è¡Œäº†ï¼Œä¸ºä»€ä¹ˆè¿˜è¦ Adapter å‘¢ã€‚</li>
<li><a target="_blank" rel="noopener" href="https://javabetter.cn/zhishixingqiu/mianshi.html">Java é¢è¯•æŒ‡å—ï¼ˆä»˜è´¹ï¼‰</a>æ”¶å½•çš„äº¬ä¸œé¢ç»åŒå­¦ 8 é¢è¯•åŽŸé¢˜ï¼šSpringMVCæ¡†æž¶</li>
<li><a target="_blank" rel="noopener" href="https://javabetter.cn/zhishixingqiu/mianshi.html">Java é¢è¯•æŒ‡å—ï¼ˆä»˜è´¹ï¼‰</a>æ”¶å½•çš„å­—èŠ‚è·³åŠ¨åŒå­¦ 17 åŽç«¯æŠ€æœ¯é¢è¯•åŽŸé¢˜ï¼šspringmvcæ‰§è¡Œæµç¨‹</li>
</ol>
</blockquote>
<h3 id="33-ðŸŒŸä»‹ç»ä¸€ä¸‹-SpringBootï¼Ÿ"><a href="#33-ðŸŒŸä»‹ç»ä¸€ä¸‹-SpringBootï¼Ÿ" class="headerlink" title="33.ðŸŒŸä»‹ç»ä¸€ä¸‹ SpringBootï¼Ÿ"></a>33.ðŸŒŸä»‹ç»ä¸€ä¸‹ SpringBootï¼Ÿ</h3><p>Spring Boot å¯ä»¥è¯´æ˜¯ Spring ç”Ÿæ€çš„ä¸€ä¸ªé‡å¤§çªç ´ï¼Œå®ƒæžå¤§åœ°ç®€åŒ–äº† Spring åº”ç”¨çš„å¼€å‘å’Œéƒ¨ç½²è¿‡ç¨‹ã€‚</p>
<p><img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="https://cdn.jsdelivr.net/gh/JakicDong/blog-assets@main/images/20251024190129.png" alt="20251024190129"><br>SpringBootå›¾æ ‡</p>
<p>ä»¥å‰æˆ‘ä»¬ç”¨ Spring å¼€å‘é¡¹ç›®çš„æ—¶å€™ï¼Œéœ€è¦é…ç½®ä¸€å¤§å † XML æ–‡ä»¶ï¼ŒåŒ…æ‹¬ Bean çš„å®šä¹‰ã€æ•°æ®æºé…ç½®ã€äº‹åŠ¡é…ç½®ç­‰ç­‰ï¼Œéžå¸¸ç¹çã€‚è€Œä¸”è¿˜è¦æ‰‹åŠ¨ç®¡ç†å„ç§ jar åŒ…çš„ä¾èµ–å…³ç³»ï¼Œå¾ˆå®¹æ˜“å‡ºçŽ°ç‰ˆæœ¬å†²çªçš„é—®é¢˜ã€‚éƒ¨ç½²çš„æ—¶å€™è¿˜è¦å•ç‹¬æ­å»º Tomcat æœåŠ¡å™¨ï¼Œæ•´ä¸ªè¿‡ç¨‹å¾ˆå¤æ‚ã€‚Spring Boot å°±æ˜¯ä¸ºäº†è§£å†³è¿™äº›ç—›ç‚¹è€Œç”Ÿçš„ã€‚</p>
<p>â€œçº¦å®šå¤§äºŽé…ç½®â€æ˜¯ Spring Boot æœ€æ ¸å¿ƒçš„ç†å¿µã€‚å®ƒé¢„è®¾äº†å¾ˆå¤šé»˜è®¤é…ç½®ï¼Œæ¯”å¦‚é»˜è®¤ä½¿ç”¨å†…åµŒçš„ Tomcat æœåŠ¡å™¨ï¼Œé»˜è®¤çš„æ—¥å¿—æ¡†æž¶æ˜¯ Logback ç­‰ç­‰ã€‚è¿™æ ·ï¼Œæˆ‘ä»¬å¼€å‘è€…å°±åªéœ€è¦å…³æ³¨ä¸šåŠ¡é€»è¾‘ï¼Œä¸ç”¨å†çº ç»“äºŽå„ç§é…ç½®ç»†èŠ‚ã€‚</p>
<p>è‡ªåŠ¨è£…é…ä¹Ÿæ˜¯ Spring Boot çš„ä¸€å¤§ç‰¹è‰²ï¼Œå®ƒä¼šæ ¹æ®é¡¹ç›®ä¸­å¼•å…¥çš„ä¾èµ–è‡ªåŠ¨é…ç½®åˆé€‚çš„ Beanã€‚æ¯”å¦‚è¯´ï¼Œæˆ‘ä»¬å¼•å…¥äº† Spring Data JPAï¼ŒSpring Boot å°±ä¼šè‡ªåŠ¨é…ç½®æ•°æ®æºï¼›æ¯”å¦‚è¯´ï¼Œæˆ‘ä»¬å¼•å…¥äº† Spring Securityï¼ŒSpring Boot å°±ä¼šè‡ªåŠ¨é…ç½®å®‰å…¨ç›¸å…³çš„ Beanã€‚</p>
<p>Spring Boot è¿˜æä¾›äº†å¾ˆå¤šå¼€ç®±å³ç”¨çš„åŠŸèƒ½ï¼Œæ¯”å¦‚ Actuator ç›‘æŽ§ã€DevTools å¼€å‘å·¥å…·ã€Spring Boot Starter ç­‰ç­‰ã€‚Actuator å¯ä»¥è®©æˆ‘ä»¬è½»æ¾ç›‘æŽ§åº”ç”¨çš„å¥åº·çŠ¶æ€ã€æ€§èƒ½æŒ‡æ ‡ç­‰ï¼›DevTools å¯ä»¥åŠ å¿«å¼€å‘æ•ˆçŽ‡ï¼Œæ¯”å¦‚è‡ªåŠ¨é‡å¯ã€çƒ­éƒ¨ç½²ç­‰ï¼›Spring Boot Starter åˆ™æ˜¯ä¸€äº›é¢„é…ç½®å¥½çš„ä¾èµ–é›†åˆï¼Œè®©æˆ‘ä»¬å¯ä»¥å¿«é€Ÿå¼•å…¥æŸäº›å¸¸ç”¨çš„åŠŸèƒ½ã€‚</p>
<h4 id="Spring-Bootå¸¸ç”¨æ³¨è§£æœ‰å“ªäº›ï¼Ÿ"><a href="#Spring-Bootå¸¸ç”¨æ³¨è§£æœ‰å“ªäº›ï¼Ÿ" class="headerlink" title="Spring Bootå¸¸ç”¨æ³¨è§£æœ‰å“ªäº›ï¼Ÿ"></a>Spring Bootå¸¸ç”¨æ³¨è§£æœ‰å“ªäº›ï¼Ÿ</h4><p>Spring Boot çš„æ³¨è§£å¾ˆå¤šï¼Œæˆ‘å°±æŒ‘ä¸¤ä¸ªè¯´ä¸€ä¸‹å§ã€‚</p>
<ul>
<li><code>@SpringBootApplication</code>ï¼šè¿™æ˜¯ Spring Boot çš„æ ¸å¿ƒæ³¨è§£ï¼Œå®ƒæ˜¯ä¸€ä¸ªç»„åˆæ³¨è§£ï¼ŒåŒ…å«äº† <code>@Configuration</code>ã€<code>@EnableAutoConfiguration</code> å’Œ <code>@ComponentScan</code>ã€‚å®ƒæ ‡å¿—ç€ä¸€ä¸ª Spring Boot åº”ç”¨çš„å…¥å£ã€‚</li>
<li><code>@SpringBootTest</code>ï¼šç”¨äºŽæµ‹è¯• Spring Boot åº”ç”¨çš„æ³¨è§£ï¼Œå®ƒä¼šåŠ è½½æ•´ä¸ª Spring ä¸Šä¸‹æ–‡ï¼Œé€‚åˆé›†æˆæµ‹è¯•ã€‚</li>
</ul>
<blockquote>
<ol>
<li><a target="_blank" rel="noopener" href="https://javabetter.cn/zhishixingqiu/mianshi.html">Java é¢è¯•æŒ‡å—ï¼ˆä»˜è´¹ï¼‰</a>æ”¶å½•çš„åŽä¸º OD é¢ç»ä¸­å‡ºçŽ°è¿‡è¯¥é¢˜ï¼šè®²è®² Spring Boot çš„ç‰¹æ€§ã€‚</li>
<li><a target="_blank" rel="noopener" href="https://javabetter.cn/zhishixingqiu/mianshi.html">Java é¢è¯•æŒ‡å—ï¼ˆä»˜è´¹ï¼‰</a>æ”¶å½•çš„ç™¾åº¦é¢ç»åŒå­¦ 1 æ–‡å¿ƒä¸€è¨€ 25 å®žä¹  Java åŽç«¯é¢è¯•åŽŸé¢˜ï¼šSpringBootåŸºæœ¬åŽŸç†</li>
<li><a target="_blank" rel="noopener" href="https://javabetter.cn/zhishixingqiu/mianshi.html">Java é¢è¯•æŒ‡å—ï¼ˆä»˜è´¹ï¼‰</a>æ”¶å½•çš„å›½ä¼é›¶ç¢Žé¢ç»åŒå­¦ 9 é¢è¯•åŽŸé¢˜ï¼šSpringbootåŸºäºŽSpringçš„é…ç½®æœ‰å“ªå‡ ç§</li>
<li><a target="_blank" rel="noopener" href="https://javabetter.cn/zhishixingqiu/mianshi.html">Java é¢è¯•æŒ‡å—ï¼ˆä»˜è´¹ï¼‰</a>æ”¶å½•çš„é˜¿é‡Œäº‘é¢ç»åŒå­¦ 22 é¢ç»ï¼šspringbootå¸¸ç”¨æ³¨è§£</li>
</ol>
</blockquote>
<h3 id="34-ðŸŒŸSpring-Bootçš„è‡ªåŠ¨è£…é…åŽŸç†äº†è§£å—ï¼Ÿ"><a href="#34-ðŸŒŸSpring-Bootçš„è‡ªåŠ¨è£…é…åŽŸç†äº†è§£å—ï¼Ÿ" class="headerlink" title="34.ðŸŒŸSpring Bootçš„è‡ªåŠ¨è£…é…åŽŸç†äº†è§£å—ï¼Ÿ"></a>34.ðŸŒŸSpring Bootçš„è‡ªåŠ¨è£…é…åŽŸç†äº†è§£å—ï¼Ÿ</h3><p>åœ¨ Spring Boot ä¸­ï¼Œå¼€å¯è‡ªåŠ¨è£…é…çš„æ³¨è§£æ˜¯<code>@EnableAutoConfiguration</code>ã€‚è¿™ä¸ªæ³¨è§£ä¼šå‘Šè¯‰ Spring åŽ»æ‰«ææ‰€æœ‰å¯ç”¨çš„è‡ªåŠ¨é…ç½®ç±»ã€‚</p>
<p><img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="https://cdn.jsdelivr.net/gh/JakicDong/blog-assets@main/images/20251024190137.png" alt="20251024190137"><br>äºŒå“¥çš„ Java è¿›é˜¶ä¹‹è·¯ï¼š@EnableAutoConfiguration æºç </p>
<p>Spring Boot ä¸ºäº†è¿›ä¸€æ­¥ç®€åŒ–ï¼ŒæŠŠè¿™ä¸ªæ³¨è§£åŒ…å«åˆ°äº† <code>@SpringBootApplication</code> æ³¨è§£ä¸­ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œå½“æˆ‘ä»¬åœ¨ä¸»ç±»ä¸Šä½¿ç”¨ <code>@SpringBootApplication</code> æ³¨è§£æ—¶ï¼Œå®žé™…ä¸Šå°±å·²ç»å¼€å¯äº†è‡ªåŠ¨è£…é…ã€‚</p>
<p>å½“ main æ–¹æ³•è¿è¡Œçš„æ—¶å€™ï¼ŒSpring ä¼šåŽ»ç±»è·¯å¾„ä¸‹æ‰¾ <code>spring.factories</code> è¿™ä¸ªæ–‡ä»¶ï¼Œè¯»å–é‡Œé¢é…ç½®çš„è‡ªåŠ¨é…ç½®ç±»åˆ—è¡¨ã€‚æ¯”å¦‚åœ¨æˆ‘ä»¬çš„<a target="_blank" rel="noopener" href="https://javabetter.cn/zhishixingqiu/paicoding.html">æŠ€æœ¯æ´¾é¡¹ç›®</a>ä¸­ï¼Œpaicoding-core å’Œ paicoding-service æ¨¡å—é‡Œéƒ½æœ‰ spring.factoriesï¼Œåˆ†åˆ«æ³¨å†Œäº† ForumCoreAutoConfig å’Œ ServiceAutoConfigï¼Œè¿™ä¸¤ä¸ªé…ç½®ç±»å°±ä¼šåœ¨é¡¹ç›®å¯åŠ¨çš„æ—¶å€™è¢«è‡ªåŠ¨åŠ è½½ã€‚</p>
<p><img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="https://cdn.jsdelivr.net/gh/JakicDong/blog-assets@main/images/20251024190147.png" alt="20251024190147"><br>æŠ€æœ¯æ´¾æºç ï¼šspring.factories</p>
<p>ç„¶åŽæ¯ä¸ªè‡ªåŠ¨é…ç½®ç±»å†…éƒ¨ï¼Œé€šå¸¸ä¼šæœ‰ä¸€ä¸ª <code>@Configuration</code> æ³¨è§£ï¼ŒåŒæ—¶ç»“åˆå„ç§ <code>@Conditional</code> æ³¨è§£æ¥åšæ¡ä»¶æŽ§åˆ¶ã€‚åƒ<a target="_blank" rel="noopener" href="https://javabetter.cn/zhishixingqiu/paicoding.html">æŠ€æœ¯æ´¾</a>çš„ RabbitMqAutoConfig ç±»ï¼Œå°±ç”¨äº† <code>@ConditionalOnProperty</code> æ³¨è§£æ¥åˆ¤æ–­é…ç½®æ–‡ä»¶é‡Œæœ‰æ²¡æœ‰å¼€å¯ rabbitmq.switchFlagï¼Œæ¥å†³å®šæ˜¯å¦åˆå§‹åŒ– RabbitMQ æ¶ˆè´¹çº¿ç¨‹ã€‚</p>
<p><img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="https://cdn.jsdelivr.net/gh/JakicDong/blog-assets@main/images/20251024190156.png" alt="20251024190156"><br>æŠ€æœ¯æ´¾æºç ï¼šRabbitMqAutoConfig</p>
<p>å¦å¤–ä¸€ä¸ªå¸¸è§çš„åœºæ™¯æ˜¯è‡ªåŠ¨æ³¨å…¥ Beanï¼Œæ¯”å¦‚<a target="_blank" rel="noopener" href="https://javabetter.cn/zhishixingqiu/paicoding.html">æŠ€æœ¯æ´¾</a>çš„ ServiceAutoConfig ä¸­å°±ç”¨äº† <code>@ComponentScan</code> æ¥æ‰«æ service åŒ…ï¼Œ<code>@MapperScan</code> æ‰«æ MyBatis çš„ mapper æŽ¥å£ï¼Œå®žçŽ°ä¸šåŠ¡å±‚å’Œ DAO å±‚çš„è‡ªåŠ¨è£…é…ã€‚</p>
<p>å…·ä½“çš„æ‰§è¡Œè¿‡ç¨‹å¯ä»¥æ€»ç»“ä¸ºï¼šSpring Boot é¡¹ç›®åœ¨å¯åŠ¨æ—¶åŠ è½½æ‰€æœ‰çš„è‡ªåŠ¨é…ç½®ç±»ï¼Œç„¶åŽé€ä¸ªæ£€æŸ¥å®ƒä»¬çš„ç”Ÿæ•ˆæ¡ä»¶ï¼Œå½“æ¡ä»¶æ»¡è¶³æ—¶å°±å®žä¾‹åŒ–å¹¶åˆ›å»ºç›¸åº”çš„ Beanã€‚</p>
<p><img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="https://cdn.jsdelivr.net/gh/JakicDong/blog-assets@main/images/20251024190207.png" alt="20251024190207"><br>ä¸‰åˆ†æ¶é¢æ¸£é€†è¢­ï¼šSpring Bootçš„è‡ªåŠ¨è£…é…åŽŸç†</p>
<p>è‡ªåŠ¨è£…é…çš„æ‰§è¡Œæ—¶æœºæ˜¯åœ¨ Spring å®¹å™¨å¯åŠ¨çš„æ—¶å€™ã€‚å…·ä½“æ¥è¯´æ˜¯åœ¨ ConfigurationClassPostProcessor è¿™ä¸ª BeanPostProcessor ä¸­å¤„ç†çš„ï¼Œå®ƒä¼šè§£æž <code>@Configuration</code> ç±»ï¼ŒåŒ…æ‹¬é€šè¿‡ <code>@Import</code> å¯¼å…¥çš„è‡ªåŠ¨é…ç½®ç±»ã€‚</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">protected</span> AutoConfigurationEntry <span class="title function_">getAutoConfigurationEntry</span><span class="params">(AnnotationMetadata annotationMetadata)</span> &#123;</span><br><span class="line">    <span class="comment">// æ£€æŸ¥è‡ªåŠ¨é…ç½®æ˜¯å¦å¯ç”¨ã€‚å¦‚æžœ@ConditionalOnClassç­‰æ¡ä»¶æ³¨è§£ä½¿å¾—è‡ªåŠ¨é…ç½®ä¸é€‚ç”¨äºŽå½“å‰çŽ¯å¢ƒï¼Œåˆ™è¿”å›žä¸€ä¸ªç©ºçš„é…ç½®æ¡ç›®ã€‚</span></span><br><span class="line">    <span class="keyword">if</span> (!isEnabled(annotationMetadata)) &#123;</span><br><span class="line">        <span class="keyword">return</span> EMPTY_ENTRY;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// èŽ·å–å¯åŠ¨ç±»ä¸Šçš„@EnableAutoConfigurationæ³¨è§£çš„å±žæ€§ï¼Œè¿™å¯èƒ½åŒ…æ‹¬å¯¹ç‰¹å®šè‡ªåŠ¨é…ç½®ç±»çš„æŽ’é™¤ã€‚</span></span><br><span class="line">    <span class="type">AnnotationAttributes</span> <span class="variable">attributes</span> <span class="operator">=</span> getAttributes(annotationMetadata);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// ä»Žspring.factoriesä¸­èŽ·å–æ‰€æœ‰å€™é€‰çš„è‡ªåŠ¨é…ç½®ç±»ã€‚è¿™æ˜¯é€šè¿‡åŠ è½½META-INF/spring.factoriesæ–‡ä»¶ä¸­å¯¹åº”çš„æ¡ç›®æ¥å®žçŽ°çš„ã€‚</span></span><br><span class="line">    List&lt;String&gt; configurations = getCandidateConfigurations(annotationMetadata, attributes);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// ç§»é™¤é…ç½®åˆ—è¡¨ä¸­çš„é‡å¤é¡¹ï¼Œç¡®ä¿æ¯ä¸ªè‡ªåŠ¨é…ç½®ç±»åªè¢«è€ƒè™‘ä¸€æ¬¡ã€‚</span></span><br><span class="line">    configurations = removeDuplicates(configurations);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// æ ¹æ®æ³¨è§£å±žæ€§è§£æžå‡ºéœ€è¦æŽ’é™¤çš„è‡ªåŠ¨é…ç½®ç±»ã€‚</span></span><br><span class="line">    Set&lt;String&gt; exclusions = getExclusions(annotationMetadata, attributes);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// æ£€æŸ¥æŽ’é™¤çš„ç±»æ˜¯å¦å­˜åœ¨äºŽå€™é€‰é…ç½®ä¸­ï¼Œå¦‚æžœå­˜åœ¨ï¼Œåˆ™æŠ›å‡ºå¼‚å¸¸ã€‚</span></span><br><span class="line">    checkExcludedClasses(configurations, exclusions);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// ä»Žå€™é€‰é…ç½®ä¸­ç§»é™¤æŽ’é™¤çš„ç±»ã€‚</span></span><br><span class="line">    configurations.removeAll(exclusions);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// åº”ç”¨è¿‡æ»¤å™¨è¿›ä¸€æ­¥ç­›é€‰è‡ªåŠ¨é…ç½®ç±»ã€‚è¿‡æ»¤å™¨å¯èƒ½åŸºäºŽæ¡ä»¶æ³¨è§£å¦‚@ConditionalOnBeanç­‰æ¥æŽ’é™¤ç‰¹å®šçš„é…ç½®ç±»ã€‚</span></span><br><span class="line">    configurations = getConfigurationClassFilter().filter(configurations);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// è§¦å‘è‡ªåŠ¨é…ç½®å¯¼å…¥äº‹ä»¶ï¼Œå…è®¸ç›‘å¬å™¨å¯¹è‡ªåŠ¨é…ç½®è¿‡ç¨‹è¿›è¡Œå¹²é¢„ã€‚</span></span><br><span class="line">    fireAutoConfigurationImportEvents(configurations, exclusions);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// åˆ›å»ºå¹¶è¿”å›žä¸€ä¸ªåŒ…å«æœ€ç»ˆç¡®å®šçš„è‡ªåŠ¨é…ç½®ç±»å’ŒæŽ’é™¤çš„é…ç½®ç±»çš„AutoConfigurationEntryå¯¹è±¡ã€‚</span></span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">AutoConfigurationEntry</span>(configurations, exclusions);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<blockquote>
<ol>
<li><a target="_blank" rel="noopener" href="https://javabetter.cn/zhishixingqiu/mianshi.html">Java é¢è¯•æŒ‡å—ï¼ˆä»˜è´¹ï¼‰</a>æ”¶å½•çš„æ»´æ»´åŒå­¦ 2 æŠ€æœ¯äºŒé¢çš„åŽŸé¢˜ï¼šSpringBoot å¯åŠ¨æ—¶ä¸ºä»€ä¹ˆèƒ½å¤Ÿè‡ªåŠ¨è£…é…</li>
<li><a target="_blank" rel="noopener" href="https://javabetter.cn/zhishixingqiu/mianshi.html">Java é¢è¯•æŒ‡å—ï¼ˆä»˜è´¹ï¼‰</a>æ”¶å½•çš„è…¾è®¯é¢ç»åŒå­¦ 22 æš‘æœŸå®žä¹ ä¸€é¢é¢è¯•åŽŸé¢˜ï¼šSpring Boot å¦‚ä½•åšåˆ°å¯åŠ¨çš„æ—¶å€™æ³¨å…¥ä¸€äº› bean</li>
<li><a target="_blank" rel="noopener" href="https://javabetter.cn/zhishixingqiu/mianshi.html">Java é¢è¯•æŒ‡å—ï¼ˆä»˜è´¹ï¼‰</a>æ”¶å½•çš„æ¯”äºšè¿ªé¢ç»åŒå­¦ 3 Java æŠ€æœ¯ä¸€é¢é¢è¯•åŽŸé¢˜ï¼šè¯´ä¸€ä¸‹ Spring Boot çš„è‡ªåŠ¨è£…é…åŽŸç†</li>
<li><a target="_blank" rel="noopener" href="https://javabetter.cn/zhishixingqiu/mianshi.html">Java é¢è¯•æŒ‡å—ï¼ˆä»˜è´¹ï¼‰</a>æ”¶å½•çš„å†œä¸šé“¶è¡ŒåŒå­¦ 1 é¢è¯•åŽŸé¢˜ï¼šspring boot çš„è‡ªåŠ¨è£…é…</li>
<li><a target="_blank" rel="noopener" href="https://javabetter.cn/zhishixingqiu/mianshi.html">Java é¢è¯•æŒ‡å—ï¼ˆä»˜è´¹ï¼‰</a>æ”¶å½•çš„ç™¾åº¦é¢ç»åŒå­¦ 1 æ–‡å¿ƒä¸€è¨€ 25 å®žä¹  Java åŽç«¯é¢è¯•åŽŸé¢˜ï¼šSpringBootå¦‚ä½•å®žçŽ°è‡ªåŠ¨è£…é…</li>
<li><a target="_blank" rel="noopener" href="https://javabetter.cn/zhishixingqiu/mianshi.html">Java é¢è¯•æŒ‡å—ï¼ˆä»˜è´¹ï¼‰</a>æ”¶å½•çš„ OPPO é¢ç»åŒå­¦ 1 é¢è¯•åŽŸé¢˜ï¼šè‡ªåŠ¨é…ç½®æ€Žä¹ˆå®žçŽ°çš„ï¼Ÿ</li>
</ol>
</blockquote>
<h3 id="35-ðŸŒŸå¦‚ä½•è‡ªå®šä¹‰ä¸€ä¸ª-SpringBoot-Starter"><a href="#35-ðŸŒŸå¦‚ä½•è‡ªå®šä¹‰ä¸€ä¸ª-SpringBoot-Starter" class="headerlink" title="35.ðŸŒŸå¦‚ä½•è‡ªå®šä¹‰ä¸€ä¸ª SpringBoot Starter?"></a>35.ðŸŒŸå¦‚ä½•è‡ªå®šä¹‰ä¸€ä¸ª SpringBoot Starter?</h3><p>ç¬¬ä¸€æ­¥ï¼ŒSpringBoot å®˜æ–¹å»ºè®®ç¬¬ä¸‰æ–¹ starter çš„å‘½åæ ¼å¼æ˜¯ xxx-spring-boot-starterï¼Œæ‰€ä»¥æˆ‘ä»¬å¯ä»¥åˆ›å»ºä¸€ä¸ªåä¸º <code>my-spring-boot-starter</code> çš„é¡¹ç›®ï¼Œä¸€å…±åŒ…æ‹¬ä¸¤ä¸ªæ¨¡å—ï¼Œä¸€ä¸ªæ˜¯ autoconfigure æ¨¡å—ï¼ŒåŒ…å«è‡ªåŠ¨é…ç½®é€»è¾‘ï¼›ä¸€ä¸ªæ˜¯ starter æ¨¡å—ï¼ŒåªåŒ…å«ä¾èµ–å£°æ˜Žã€‚</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">&lt;properties&gt;</span><br><span class="line">    &lt;spring.boot.version&gt;<span class="number">2.3</span><span class="number">.1</span>.RELEASE&lt;/spring.boot.version&gt;</span><br><span class="line">&lt;/properties&gt;</span><br><span class="line"></span><br><span class="line">&lt;dependencies&gt;</span><br><span class="line">    &lt;dependency&gt;</span><br><span class="line">        &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;</span><br><span class="line">        &lt;artifactId&gt;spring-boot-autoconfigure&lt;/artifactId&gt;</span><br><span class="line">        &lt;version&gt;$&#123;spring.boot.version&#125;&lt;/version&gt;</span><br><span class="line">    &lt;/dependency&gt;</span><br><span class="line">    &lt;dependency&gt;</span><br><span class="line">        &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;</span><br><span class="line">        &lt;artifactId&gt;spring-boot-starter&lt;/artifactId&gt;</span><br><span class="line">        &lt;version&gt;$&#123;spring.boot.version&#125;&lt;/version&gt;</span><br><span class="line">    &lt;/dependency&gt;</span><br><span class="line">&lt;/dependencies&gt;</span><br></pre></td></tr></table></figure>

<p>ç¬¬äºŒæ­¥ï¼Œåˆ›å»ºä¸€ä¸ªè‡ªåŠ¨é…ç½®ç±»ï¼Œé€šå¸¸åœ¨ autoconfigure åŒ…ä¸‹ï¼Œè¯¥ç±»çš„ä½œç”¨æ˜¯æ ¹æ®é…ç½®æ–‡ä»¶ä¸­çš„å±žæ€§æ¥åˆ›å»ºå’Œé…ç½® Beanã€‚</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="meta">@EnableConfigurationProperties(MyStarterProperties.class)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">MyServiceAutoConfiguration</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="meta">@ConditionalOnMissingBean</span></span><br><span class="line">    <span class="keyword">public</span> MyService <span class="title function_">myService</span><span class="params">(MyStarterProperties properties)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">MyService</span>(properties.getMessage());</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>ç¬¬ä¸‰æ­¥ï¼Œåˆ›å»ºä¸€ä¸ªé…ç½®å±žæ€§ç±»ï¼Œç”¨äºŽè¯»å–é…ç½®æ–‡ä»¶ä¸­çš„å±žæ€§ã€‚é€šå¸¸ä½¿ç”¨ <code>@ConfigurationProperties</code> æ³¨è§£æ¥æ ‡è®°è¿™ä¸ªç±»ã€‚</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@ConfigurationProperties(prefix = &quot;mystarter&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">MyStarterProperties</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="type">String</span> <span class="variable">message</span> <span class="operator">=</span> <span class="string">&quot;äºŒå“¥çš„ Java è¿›é˜¶ä¹‹è·¯ä¸é”™å•Š!&quot;</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">getMessage</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> message;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setMessage</span><span class="params">(String message)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.message = message;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>ç¬¬å››æ­¥ï¼Œåˆ›å»ºä¸€ä¸ªç®€å•çš„æœåŠ¡ç±»ï¼Œç”¨äºŽæä¾›ä¸šåŠ¡é€»è¾‘ã€‚</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">MyService</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> String message;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">MyService</span><span class="params">(String message)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.message = message;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">getMessage</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> message;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>ç¬¬äº”æ­¥ï¼Œåœ¨ <code>src/main/resources/META-INF</code> ç›®å½•ä¸‹åˆ›å»ºä¸€ä¸ªåä¸º spring.factories æ–‡ä»¶ï¼Œå‘Šè¯‰ SpringBoot åœ¨å¯åŠ¨æ—¶è¦åŠ è½½æˆ‘ä»¬çš„è‡ªåŠ¨é…ç½®ç±»ã€‚</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">org.springframework.boot.autoconfigure.EnableAutoConfiguration=\</span><br><span class="line">com.itwanger.mystarter.autoconfigure.MyServiceAutoConfiguration</span><br></pre></td></tr></table></figure>

<p>ç¬¬å…­æ­¥ï¼Œä½¿ç”¨ Maven æ‰“åŒ…è¿™ä¸ªé¡¹ç›®ã€‚</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mvn clean install</span><br></pre></td></tr></table></figure>

<p>ç¬¬ä¸ƒæ­¥ï¼Œåœ¨å…¶ä»–çš„ Spring Boot é¡¹ç›®ä¸­ï¼Œé€šè¿‡ Maven æ¥æ·»åŠ è¿™ä¸ªè‡ªå®šä¹‰çš„ Starter ä¾èµ–ï¼Œå¹¶é€šè¿‡ application.properties é…ç½®ä¿¡æ¯ï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mystarter.message=javabetter.cn</span><br></pre></td></tr></table></figure>

<p>ç„¶åŽå°±å¯ä»¥åœ¨ Spring Boot é¡¹ç›®ä¸­æ³¨å…¥ MyStarterProperties æ¥ä½¿ç”¨å®ƒã€‚</p>
<p><img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="https://cdn.jsdelivr.net/gh/JakicDong/blog-assets@main/images/20251024190258.png" alt="20251024190258"><br>MyStarterProperties æ³¨å…¥ç¤ºä¾‹</p>
<p>å¯åŠ¨é¡¹ç›®ï¼Œç„¶åŽåœ¨æµè§ˆå™¨ä¸­è¾“å…¥ <code>localhost:8081/hello</code>ï¼Œå°±å¯ä»¥çœ‹åˆ°è¿”å›žçš„å†…å®¹æ˜¯ <code>javabetter.cn</code>ï¼Œè¯´æ˜Žæˆ‘ä»¬çš„è‡ªå®šä¹‰ Starter å·²ç»æˆåŠŸå·¥ä½œäº†ã€‚</p>
<p><img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="https://cdn.jsdelivr.net/gh/JakicDong/blog-assets@main/images/20251024190310.png" alt="20251024190310"><br>äºŒå“¥çš„ Java è¿›é˜¶ä¹‹è·¯ï¼šè‡ªå®šä¹‰ Spring Boot Stater</p>
<h4 id="Spring-Boot-Starter-çš„åŽŸç†äº†è§£å—ï¼Ÿ"><a href="#Spring-Boot-Starter-çš„åŽŸç†äº†è§£å—ï¼Ÿ" class="headerlink" title="Spring Boot Starter çš„åŽŸç†äº†è§£å—ï¼Ÿ"></a>Spring Boot Starter çš„åŽŸç†äº†è§£å—ï¼Ÿ</h4><p>Starter çš„æ ¸å¿ƒæ€æƒ³æ˜¯æŠŠç›¸å…³çš„ä¾èµ–æ‰“åŒ…åœ¨ä¸€èµ·ï¼Œè®©å¼€å‘è€…åªéœ€è¦å¼•å…¥ä¸€ä¸ª starter ä¾èµ–ï¼Œå°±èƒ½èŽ·å¾—å®Œæ•´çš„åŠŸèƒ½æ¨¡å—ã€‚</p>
<p>å½“æˆ‘ä»¬åœ¨ pom.xml ä¸­å¼•å…¥ä¸€ä¸ª starter æ—¶ï¼ŒMaven å°±ä¼šè‡ªåŠ¨è§£æžè¿™ä¸ª starter çš„ä¾èµ–æ ‘ï¼ŒæŠŠæ‰€æœ‰éœ€è¦çš„ jar åŒ…éƒ½ä¸‹è½½ä¸‹æ¥ã€‚</p>
<p>æ¯ä¸ª starter éƒ½ä¼šåŒ…å«å¯¹åº”çš„è‡ªåŠ¨é…ç½®ç±»ï¼Œè¿™äº›é…ç½®ç±»é€šè¿‡æ¡ä»¶æ³¨è§£æ¥åˆ¤æ–­æ˜¯å¦åº”è¯¥ç”Ÿæ•ˆã€‚æ¯”å¦‚å½“æˆ‘ä»¬å¼•å…¥äº† <code>spring-boot-starter-web</code>ï¼Œå®ƒä¼šè‡ªåŠ¨é…ç½® Spring MVCã€å†…åµŒçš„ Tomcat æœåŠ¡å™¨ç­‰ã€‚</p>
<p>spring.factories æ–‡ä»¶æ˜¯ Spring Boot è‡ªåŠ¨è£…é…çš„æ ¸å¿ƒï¼Œå®ƒä½äºŽæ¯ä¸ª starter çš„ <code>META-INF</code> ç›®å½•ä¸‹ã€‚è¿™ä¸ªæ–‡ä»¶åˆ—å‡ºäº†æ‰€æœ‰çš„è‡ªåŠ¨é…ç½®ç±»ï¼ŒSpring Boot åœ¨å¯åŠ¨æ—¶ä¼šè¯»å–è¿™ä¸ªæ–‡ä»¶ï¼ŒåŠ è½½å¯¹åº”çš„é…ç½®ç±»ã€‚</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">org.springframework.boot.autoconfigure.EnableAutoConfiguration=\</span><br><span class="line">com.example.demo.autoconfigure.DemoAutoConfiguration,\</span><br><span class="line">com.example.demo.autoconfigure.AnotherAutoConfiguration</span><br></pre></td></tr></table></figure>

<blockquote>
<ol>
<li><a target="_blank" rel="noopener" href="https://javabetter.cn/zhishixingqiu/mianshi.html">Java é¢è¯•æŒ‡å—ï¼ˆä»˜è´¹ï¼‰</a>æ”¶å½•çš„å­—èŠ‚è·³åŠ¨é¢ç»åŒå­¦ 1 Java åŽç«¯æŠ€æœ¯ä¸€é¢é¢è¯•åŽŸé¢˜ï¼šä½ å°è£…è¿‡ springboot starter å—ï¼Ÿ</li>
<li><a target="_blank" rel="noopener" href="https://javabetter.cn/zhishixingqiu/mianshi.html">Java é¢è¯•æŒ‡å—ï¼ˆä»˜è´¹ï¼‰</a>æ”¶å½•çš„è…¾è®¯äº‘æ™ºé¢ç»åŒå­¦ 20 äºŒé¢é¢è¯•åŽŸé¢˜ï¼šSpring Boot Starter çš„åŽŸç†äº†è§£å—ï¼Ÿ</li>
<li><a target="_blank" rel="noopener" href="https://javabetter.cn/zhishixingqiu/mianshi.html">Java é¢è¯•æŒ‡å—ï¼ˆä»˜è´¹ï¼‰</a>æ”¶å½•çš„å¿«æ‰‹åŒå­¦ 4 ä¸€é¢åŽŸé¢˜ï¼šä¸ºä»€ä¹ˆä½¿ç”¨SpringBootï¼ŸSpringBootè‡ªåŠ¨è£…é…çš„åŽŸç†åŠæµç¨‹ï¼Ÿ@Importçš„ä½œç”¨ï¼Ÿå¦‚æžœæƒ³è®©SpringBootå¯¹è‡ªå®šä¹‰çš„jaråŒ…è¿›è¡Œè‡ªåŠ¨é…ç½®çš„è¯ï¼Œéœ€è¦æ€Žä¹ˆåšï¼Ÿ</li>
</ol>
</blockquote>
<h3 id="36-ðŸŒŸSpring-Boot-å¯åŠ¨åŽŸç†äº†è§£å—ï¼Ÿ"><a href="#36-ðŸŒŸSpring-Boot-å¯åŠ¨åŽŸç†äº†è§£å—ï¼Ÿ" class="headerlink" title="36.ðŸŒŸSpring Boot å¯åŠ¨åŽŸç†äº†è§£å—ï¼Ÿ"></a>36.ðŸŒŸSpring Boot å¯åŠ¨åŽŸç†äº†è§£å—ï¼Ÿ</h3><p>Spring Boot çš„å¯åŠ¨ä¸»è¦å›´ç»•ä¸¤ä¸ªæ ¸å¿ƒå±•å¼€ï¼Œä¸€ä¸ªæ˜¯ <code>@SpringBootApplication</code> æ³¨è§£ï¼Œä¸€ä¸ªæ˜¯ <code>SpringApplication.run()</code> æ–¹æ³•ã€‚</p>
<p><img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="https://cdn.jsdelivr.net/gh/JakicDong/blog-assets@main/images/20251024190348.png" alt="20251024190348"><br>SpringBoot å¯åŠ¨å¤§è‡´æµç¨‹-å›¾ç‰‡æ¥æºç½‘ç»œ</p>
<p>æˆ‘å…ˆè¯´ä¸€ä¸‹ <code>@SpringBootApplication</code> æ³¨è§£ï¼Œå®ƒæ˜¯ä¸€ä¸ªç»„åˆæ³¨è§£ï¼ŒåŒ…å«äº† <code>@SpringBootConfiguration</code>ã€<code>@EnableAutoConfiguration</code> å’Œ <code>@ComponentScan</code>ï¼Œè¿™ä¸‰ä¸ªæ³¨è§£çš„ä½œç”¨åˆ†åˆ«æ˜¯ï¼š</p>
<ul>
<li><code>@SpringBootConfiguration</code>ï¼šæ ‡è®°è¿™ä¸ªç±»æ˜¯ä¸€ä¸ª Spring Boot é…ç½®ç±»ï¼Œç›¸å½“äºŽä¸€ä¸ª Spring é…ç½®æ–‡ä»¶ã€‚</li>
<li><code>@EnableAutoConfiguration</code>ï¼šå‘Šè¯‰ Spring Boot å¯ä»¥è¿›è¡Œè‡ªåŠ¨é…ç½®ã€‚æ¯”å¦‚è¯´ï¼Œé¡¹ç›®å¼•å…¥äº† Spring MVC çš„ä¾èµ–ï¼Œé‚£ä¹ˆ Spring Boot å°±ä¼šè‡ªåŠ¨é…ç½® DispatcherServletã€HandlerMapping ç­‰ç»„ä»¶ã€‚</li>
<li><code>@ComponentScan</code>ï¼šæ‰«æå½“å‰åŒ…åŠå…¶å­åŒ…ä¸‹çš„ç»„ä»¶ï¼Œæ³¨å†Œä¸º Beanã€‚</li>
</ul>
<p><img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="https://cdn.jsdelivr.net/gh/JakicDong/blog-assets@main/images/20251024190356.png" alt="20251024190356"><br>æ´¾èªæ˜Žæºç ï¼šå¯åŠ¨ç±»</p>
<p>å¥½ï¼ŒæŽ¥ä¸‹æ¥æˆ‘å†è¯´ä¸€ä¸‹ <code>SpringApplication.run()</code> æ–¹æ³•ï¼Œå®ƒæ˜¯ Spring Boot é¡¹ç›®çš„å¯åŠ¨å…¥å£ï¼Œå†…éƒ¨æµç¨‹å¤§è‡´å¯ä»¥åˆ†ä¸º 5 ä¸ªæ­¥éª¤ï¼š</p>
<p>â‘ ã€åˆ›å»º SpringApplication å®žä¾‹ï¼Œå¹¶è¯†åˆ«åº”ç”¨ç±»åž‹ï¼Œæ¯”å¦‚è¯´æ˜¯æ ‡å‡†çš„ Servlet Web è¿˜æ˜¯å“åº”å¼çš„ WebFluxï¼Œç„¶åŽå‡†å¤‡ç›‘å¬å™¨å’Œåˆå§‹åŒ–ç›‘å¬å®¹å™¨ã€‚</p>
<p>â‘¡ã€åˆ›å»ºå¹¶å‡†å¤‡ ApplicationContextï¼Œå°†ä¸»ç±»ä½œä¸ºé…ç½®æºè¿›è¡ŒåŠ è½½ã€‚</p>
<p>â‘¢ã€åˆ·æ–° Spring ä¸Šä¸‹æ–‡ï¼Œè§¦å‘ Bean çš„å®žä¾‹åŒ–ï¼Œæ¯”å¦‚è¯´æ‰«æå¹¶æ³¨å†Œ <code>@ComponentScan</code> æŒ‡å®šè·¯å¾„ä¸‹çš„ Beanã€‚</p>
<p>â‘£ã€è§¦å‘è‡ªåŠ¨é…ç½®ï¼Œåœ¨ Spring Boot 2.7 åŠä¹‹å‰æ˜¯é€šè¿‡ spring.factories åŠ è½½çš„ï¼Œ3.x æ˜¯é€šè¿‡è¯»å– <code>AutoConfiguration.imports</code>ï¼Œå¹¶ç»“åˆ <code>@ConditionalOn</code> ç³»åˆ—æ³¨è§£ä¾æ®æ¡ä»¶æ³¨å†Œ Beanã€‚</p>
<p>â‘¤ã€å¦‚æžœå¼•å…¥äº† Web ç›¸å…³ä¾èµ–ï¼Œä¼šåˆ›å»ºå¹¶å¯åŠ¨ Tomcat å®¹å™¨ï¼Œå®Œæˆ HTTP ç«¯å£ç›‘å¬ã€‚</p>
<p>å…³é”®çš„ä»£ç é€»è¾‘å¦‚ä¸‹ï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> ConfigurableApplicationContext <span class="title function_">run</span><span class="params">(String... args)</span> &#123;</span><br><span class="line">    <span class="comment">// 1. åˆ›å»ºå¯åŠ¨æ—¶çš„ç›‘å¬å™¨å¹¶è§¦å‘å¯åŠ¨äº‹ä»¶</span></span><br><span class="line">    <span class="type">SpringApplicationRunListeners</span> <span class="variable">listeners</span> <span class="operator">=</span> getRunListeners(args);</span><br><span class="line">    listeners.starting();</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 2. å‡†å¤‡è¿è¡ŒçŽ¯å¢ƒ</span></span><br><span class="line">    <span class="type">ConfigurableEnvironment</span> <span class="variable">environment</span> <span class="operator">=</span> prepareEnvironment(listeners);</span><br><span class="line">    configureIgnoreBeanInfo(environment);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 3. åˆ›å»ºä¸Šä¸‹æ–‡</span></span><br><span class="line">    <span class="type">ConfigurableApplicationContext</span> <span class="variable">context</span> <span class="operator">=</span> createApplicationContext();</span><br><span class="line"></span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">        <span class="comment">// 4. å‡†å¤‡ä¸Šä¸‹æ–‡</span></span><br><span class="line">        prepareContext(context, environment, listeners, args);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 5. åˆ·æ–°ä¸Šä¸‹æ–‡ï¼Œå®Œæˆ Bean åˆå§‹åŒ–å’Œè£…é…</span></span><br><span class="line">        refreshContext(context);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 6. è°ƒç”¨è¿è¡Œå™¨</span></span><br><span class="line">        afterRefresh(context, args);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 7. è§¦å‘å¯åŠ¨å®Œæˆäº‹ä»¶</span></span><br><span class="line">        listeners.started(context);</span><br><span class="line">    &#125; <span class="keyword">catch</span> (Exception ex) &#123;</span><br><span class="line">        handleRunFailure(context, ex, listeners);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> context;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="è¦åœ¨å¯åŠ¨é˜¶æ®µè‡ªå®šä¹‰é€»è¾‘è¯¥æ€Žä¹ˆåšï¼Ÿ"><a href="#è¦åœ¨å¯åŠ¨é˜¶æ®µè‡ªå®šä¹‰é€»è¾‘è¯¥æ€Žä¹ˆåšï¼Ÿ" class="headerlink" title="è¦åœ¨å¯åŠ¨é˜¶æ®µè‡ªå®šä¹‰é€»è¾‘è¯¥æ€Žä¹ˆåšï¼Ÿ"></a>è¦åœ¨å¯åŠ¨é˜¶æ®µè‡ªå®šä¹‰é€»è¾‘è¯¥æ€Žä¹ˆåšï¼Ÿ</h4><p>å¯ä»¥é€šè¿‡å®žçŽ° <code>ApplicationRunner</code> æŽ¥å£æ¥å®Œæˆå¯åŠ¨åŽçš„è‡ªå®šä¹‰é€»è¾‘ã€‚</p>
<p>æ¯”å¦‚è¯´åœ¨<a target="_blank" rel="noopener" href="https://javabetter.cn/zhishixingqiu/paicoding.html">æŠ€æœ¯æ´¾é¡¹ç›®</a>ä¸­ï¼Œæˆ‘ä»¬å°±åœ¨ run æ–¹æ³•ä¸­è¿½åŠ äº†ï¼šJSON ç±»åž‹è½¬æ¢é…ç½®å’ŒåŠ¨æ€è®¾ç½®åº”ç”¨è®¿é—®åœ°å€ç­‰ã€‚</p>
<p><img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="https://cdn.jsdelivr.net/gh/JakicDong/blog-assets@main/images/20251024190407.png" alt="20251024190407"><br>æŠ€æœ¯æ´¾æºç ï¼šå¯åŠ¨åŽæ·»åŠ è‡ªå®šä¹‰é€»è¾‘</p>
<h4 id="ä¸ºä»€ä¹ˆ-Spring-Boot-åœ¨å¯åŠ¨çš„æ—¶å€™èƒ½å¤Ÿæ‰¾åˆ°-main-æ–¹æ³•ä¸Šçš„-SpringBootApplication-æ³¨è§£ï¼Ÿ"><a href="#ä¸ºä»€ä¹ˆ-Spring-Boot-åœ¨å¯åŠ¨çš„æ—¶å€™èƒ½å¤Ÿæ‰¾åˆ°-main-æ–¹æ³•ä¸Šçš„-SpringBootApplication-æ³¨è§£ï¼Ÿ" class="headerlink" title="ä¸ºä»€ä¹ˆ Spring Boot åœ¨å¯åŠ¨çš„æ—¶å€™èƒ½å¤Ÿæ‰¾åˆ° main æ–¹æ³•ä¸Šçš„@SpringBootApplication æ³¨è§£ï¼Ÿ"></a>ä¸ºä»€ä¹ˆ Spring Boot åœ¨å¯åŠ¨çš„æ—¶å€™èƒ½å¤Ÿæ‰¾åˆ° main æ–¹æ³•ä¸Šçš„@SpringBootApplication æ³¨è§£ï¼Ÿ</h4><p>å…¶å®ž Spring Boot å¹¶ä¸æ˜¯è‡ªå·±æ‰¾åˆ° <code>@SpringBootApplication</code> æ³¨è§£çš„ï¼Œè€Œæ˜¯æˆ‘ä»¬é€šè¿‡ç¨‹åºå‘Šè¯‰å®ƒçš„ã€‚</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@SpringBootApplication</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">MyApplication</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        SpringApplication.run(MyApplication.class, args);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>æˆ‘ä»¬æŠŠ <code>Application.class</code> ä½œä¸ºå‚æ•°ä¼ ç»™äº† run æ–¹æ³•ã€‚è¿™ä¸ª Application ç±»æ ‡æ³¨äº† <code>@SpringBootApplication</code> æ³¨è§£ï¼Œç”¨æ¥å‘Šè¯‰ Spring Bootï¼šè¯·ç”¨è¿™ä¸ªç±»ä½œä¸ºé…ç½®ç±»æ¥å¯åŠ¨ã€‚</p>
<p>ç„¶åŽï¼ŒSpringApplication åœ¨è¿è¡Œæ—¶å°±ä¼šæŠŠè¿™ä¸ªç±»æ³¨å†Œåˆ° Spring å®¹å™¨ä¸­ã€‚</p>
<h4 id="Spring-Boot-é»˜è®¤çš„åŒ…æ‰«æè·¯å¾„æ˜¯ä»€ä¹ˆï¼Ÿ"><a href="#Spring-Boot-é»˜è®¤çš„åŒ…æ‰«æè·¯å¾„æ˜¯ä»€ä¹ˆï¼Ÿ" class="headerlink" title="Spring Boot é»˜è®¤çš„åŒ…æ‰«æè·¯å¾„æ˜¯ä»€ä¹ˆï¼Ÿ"></a>Spring Boot é»˜è®¤çš„åŒ…æ‰«æè·¯å¾„æ˜¯ä»€ä¹ˆï¼Ÿ</h4><p>Spring Boot é»˜è®¤çš„åŒ…æ‰«æè·¯å¾„æ˜¯ä¸»ç±»æ‰€åœ¨çš„åŒ…åŠå…¶å­åŒ…ã€‚</p>
<p>æ¯”å¦‚è¯´åœ¨<a target="_blank" rel="noopener" href="https://javabetter.cn/zhishixingqiu/paicoding.html">æŠ€æœ¯æ´¾å®žæˆ˜é¡¹ç›®</a>ä¸­ï¼Œå¯åŠ¨ç±»<code>QuickForumApplication</code>æ‰€åœ¨çš„åŒ…æ˜¯<code>com.github.paicoding.forum.web</code>ï¼Œé‚£ä¹ˆ Spring Boot é»˜è®¤ä¼šæ‰«æ<code>com.github.paicoding.forum.web</code>åŒ…åŠå…¶å­åŒ…ä¸‹çš„æ‰€æœ‰ç»„ä»¶ã€‚</p>
<p><img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="https://cdn.jsdelivr.net/gh/JakicDong/blog-assets@main/images/20251024190421.png" alt="20251024190421"><br>æ²‰é»˜çŽ‹äºŒï¼šæŠ€æœ¯æ´¾é¡¹ç›®æˆªå›¾</p>
<blockquote>
<ol>
<li><a target="_blank" rel="noopener" href="https://javabetter.cn/zhishixingqiu/mianshi.html">Java é¢è¯•æŒ‡å—ï¼ˆä»˜è´¹ï¼‰</a>æ”¶å½•çš„æ»´æ»´åŒå­¦ 2 æŠ€æœ¯äºŒé¢çš„åŽŸé¢˜ï¼šä¸ºä»€ä¹ˆ Spring Boot å¯åŠ¨æ—¶èƒ½æ‰¾åˆ° Main ç±»ä¸Šé¢çš„æ³¨è§£</li>
<li><a target="_blank" rel="noopener" href="https://javabetter.cn/zhishixingqiu/mianshi.html">Java é¢è¯•æŒ‡å—ï¼ˆä»˜è´¹ï¼‰</a>æ”¶å½•çš„è…¾è®¯é¢ç»åŒå­¦ 22 æš‘æœŸå®žä¹ ä¸€é¢é¢è¯•åŽŸé¢˜ï¼šSpring Boot é»˜è®¤çš„åŒ…æ‰«æè·¯å¾„ï¼Ÿ</li>
<li><a target="_blank" rel="noopener" href="https://javabetter.cn/zhishixingqiu/mianshi.html">Java é¢è¯•æŒ‡å—ï¼ˆä»˜è´¹ï¼‰</a>æ”¶å½•çš„å¾®ä¼—é“¶è¡ŒåŒå­¦ 1 Java åŽç«¯ä¸€é¢çš„åŽŸé¢˜ï¼š@SpringBootApplication æ³¨è§£äº†è§£å—ï¼Ÿ</li>
<li><a target="_blank" rel="noopener" href="https://javabetter.cn/zhishixingqiu/mianshi.html">Java é¢è¯•æŒ‡å—ï¼ˆä»˜è´¹ï¼‰</a>æ”¶å½•çš„å›½ä¼é›¶ç¢Žé¢ç»åŒå­¦ 9 é¢è¯•åŽŸé¢˜ï¼šSpringbootçš„å·¥ä½œåŽŸç†ï¼Ÿ</li>
<li><a target="_blank" rel="noopener" href="https://javabetter.cn/zhishixingqiu/mianshi.html">Java é¢è¯•æŒ‡å—ï¼ˆä»˜è´¹ï¼‰</a>æ”¶å½•çš„äº¬ä¸œé¢ç»åŒå­¦ 5 Java åŽç«¯æŠ€æœ¯ä¸€é¢é¢è¯•åŽŸé¢˜ï¼šSpringBootå¯åŠ¨æµç¨‹ï¼ˆå¿˜äº†ï¼‰</li>
<li><a target="_blank" rel="noopener" href="https://javabetter.cn/zhishixingqiu/mianshi.html">Java é¢è¯•æŒ‡å—ï¼ˆä»˜è´¹ï¼‰</a>æ”¶å½•çš„å“”å“©å“”å“©åŒå­¦ 1 äºŒé¢é¢è¯•åŽŸé¢˜ï¼šspringBootå¯åŠ¨æœºåˆ¶ï¼Œå¯åŠ¨ä¹‹åŽåšäº†å“ªäº›æ­¥éª¤</li>
</ol>
</blockquote>
<h2 id="æ“ä½œç³»ç»Ÿ"><a href="#æ“ä½œç³»ç»Ÿ" class="headerlink" title="æ“ä½œç³»ç»Ÿ"></a>æ“ä½œç³»ç»Ÿ</h2><p>è¯¦è§æ“ä½œç³»ç»Ÿå­¦ä¹ ç¬”è®°</p>
<h2 id="è®¡ç®—æœºç½‘ç»œ"><a href="#è®¡ç®—æœºç½‘ç»œ" class="headerlink" title="è®¡ç®—æœºç½‘ç»œ"></a>è®¡ç®—æœºç½‘ç»œ</h2><h3 id="ðŸŒŸ18-è¯´è¯´-HTTP-ä¸Ž-HTTPS-æœ‰å“ªäº›åŒºåˆ«ï¼Ÿ"><a href="#ðŸŒŸ18-è¯´è¯´-HTTP-ä¸Ž-HTTPS-æœ‰å“ªäº›åŒºåˆ«ï¼Ÿ" class="headerlink" title="ðŸŒŸ18.è¯´è¯´ HTTP ä¸Ž HTTPS æœ‰å“ªäº›åŒºåˆ«ï¼Ÿ"></a>ðŸŒŸ18.è¯´è¯´ HTTP ä¸Ž HTTPS æœ‰å“ªäº›åŒºåˆ«ï¼Ÿ</h3><p><code>HTTPS</code> æ˜¯ <code>HTTP</code> çš„å¢žå¼ºç‰ˆï¼Œåœ¨ <code>HTTP</code> çš„åŸºç¡€ä¸ŠåŠ å…¥äº† <code>SSL/TLS</code> åè®®ï¼Œ<strong>ç¡®ä¿æ•°æ®åœ¨ä¼ è¾“è¿‡ç¨‹ä¸­æ˜¯åŠ å¯†çš„</strong>ã€‚</p>
<p><img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="https://cdn.jsdelivr.net/gh/JakicDong/blog-assets@main/images/20251025143412.png" alt="20251025143412"></p>
<p><code>HTTP</code> çš„é»˜è®¤ç«¯â¼å·æ˜¯ <code>80</code>ï¼Œ<code>URL</code> ä»¥<code>http://</code>å¼€å¤´ï¼›<br><code>HTTPS</code> çš„é»˜è®¤ç«¯â¼å·æ˜¯ <code>443</code>ï¼Œ<code>URL</code> ä»¥<code>https://</code>å¼€å¤´ã€‚</p>
<h3 id="ðŸŒŸ25-TCP-æ¡æ‰‹ä¸ºä»€ä¹ˆæ˜¯ä¸‰æ¬¡ï¼Œä¸ºä»€ä¹ˆä¸èƒ½æ˜¯ä¸¤æ¬¡ï¼Ÿä¸èƒ½æ˜¯å››æ¬¡ï¼Ÿ"><a href="#ðŸŒŸ25-TCP-æ¡æ‰‹ä¸ºä»€ä¹ˆæ˜¯ä¸‰æ¬¡ï¼Œä¸ºä»€ä¹ˆä¸èƒ½æ˜¯ä¸¤æ¬¡ï¼Ÿä¸èƒ½æ˜¯å››æ¬¡ï¼Ÿ" class="headerlink" title="ðŸŒŸ25.TCP æ¡æ‰‹ä¸ºä»€ä¹ˆæ˜¯ä¸‰æ¬¡ï¼Œä¸ºä»€ä¹ˆä¸èƒ½æ˜¯ä¸¤æ¬¡ï¼Ÿä¸èƒ½æ˜¯å››æ¬¡ï¼Ÿ"></a>ðŸŒŸ25.TCP æ¡æ‰‹ä¸ºä»€ä¹ˆæ˜¯ä¸‰æ¬¡ï¼Œä¸ºä»€ä¹ˆä¸èƒ½æ˜¯ä¸¤æ¬¡ï¼Ÿä¸èƒ½æ˜¯å››æ¬¡ï¼Ÿ</h3><p>ä½¿ç”¨<strong>ä¸‰æ¬¡æ¡æ‰‹å¯ä»¥å»ºç«‹ä¸€ä¸ªå¯é çš„è¿žæŽ¥</strong>ã€‚è¿™ä¸€è¿‡ç¨‹çš„ç›®çš„æ˜¯ç¡®ä¿åŒæ–¹éƒ½çŸ¥é“å¯¹æ–¹å·²å‡†å¤‡å¥½è¿›è¡Œé€šä¿¡ï¼Œå¹¶åŒæ­¥åŒæ–¹çš„åºåˆ—å·ï¼Œä»Žè€Œä¿æŒæ•°æ®åŒ…çš„é¡ºåºå’Œå®Œæ•´æ€§ã€‚</p>
<h4 id="ä¸ºä»€ä¹ˆ-TCP-æ¡æ‰‹ä¸èƒ½æ˜¯ä¸¤æ¬¡ï¼Ÿ"><a href="#ä¸ºä»€ä¹ˆ-TCP-æ¡æ‰‹ä¸èƒ½æ˜¯ä¸¤æ¬¡ï¼Ÿ" class="headerlink" title="ä¸ºä»€ä¹ˆ TCP æ¡æ‰‹ä¸èƒ½æ˜¯ä¸¤æ¬¡ï¼Ÿ"></a>ä¸ºä»€ä¹ˆ TCP æ¡æ‰‹ä¸èƒ½æ˜¯ä¸¤æ¬¡ï¼Ÿ</h4><ul>
<li>ä¸ºäº†<strong>é˜²æ­¢æœåŠ¡å™¨ä¸€ç›´ç­‰ï¼Œç­‰åˆ°é»„èŠ±èœéƒ½å‡‰äº†</strong>ã€‚</li>
<li>ä¸ºäº†<strong>é˜²æ­¢å®¢æˆ·ç«¯å·²ç»å¤±æ•ˆçš„è¿žæŽ¥è¯·æ±‚çªç„¶åˆä¼ é€åˆ°äº†æœåŠ¡å™¨</strong>ã€‚</li>
</ul>
<p>è¦çŸ¥é“ï¼Œç½‘ç»œä¼ è¾“æ˜¯æœ‰å»¶æ—¶çš„ï¼ˆè¦é€šè¿‡ç½‘ç»œå…‰çº¤ã€WIFIã€å«æ˜Ÿä¿¡å·ä¼ è¾“ç­‰ï¼‰ã€‚</p>
<p>å‡å¦‚è¯´å®¢æˆ·ç«¯å‘èµ·äº† SYN&#x3D;1 çš„ç¬¬ä¸€æ¬¡æ¡æ‰‹ã€‚æœåŠ¡å™¨ä¹ŸåŠæ—¶å›žå¤äº† SYN&#x3D;2 å’Œ ACK&#x3D;1 çš„ç¬¬äºŒæ¬¡æ¡æ‰‹ï¼Œä½†æ˜¯è¿™ä¸ª ACK&#x3D;1 çš„ç¡®è®¤æŠ¥æ–‡æ®µå› ä¸ºæŸäº›åŽŸå› åœ¨ä¼ è¾“è¿‡ç¨‹ä¸­ä¸¢å¤±äº†ã€‚</p>
<p>å¦‚æžœæ²¡æœ‰ç¬¬ä¸‰æ¬¡æ¡æ‰‹å‘Šè¯‰æœåŠ¡å™¨ï¼Œå®¢æˆ·ç«¯æ”¶åˆ°äº†æœåŠ¡å™¨çš„å›žåº”ï¼Œé‚£æœåŠ¡å™¨æ˜¯ä¸çŸ¥é“å®¢æˆ·ç«¯æœ‰æ²¡æœ‰æŽ¥æ”¶åˆ°çš„ã€‚</p>
<p>äºŽæ˜¯æœåŠ¡å™¨å°±ä¸€ç›´å¹²å·´å·´åœ°å¼€ç€ç«¯å£åœ¨ç­‰ç€å®¢æˆ·ç«¯å‘æ¶ˆæ¯å‘¢ï¼Œä½†å…¶å®žå®¢æˆ·ç«¯å¹¶æ²¡æœ‰æ”¶åˆ°æœåŠ¡å™¨çš„å›žåº”ï¼Œå¿ƒç°æ„å†·åœ°è·‘äº†ã€‚</p>
<p><img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="https://cdn.jsdelivr.net/gh/JakicDong/blog-assets@main/images/20251025143839.png" alt="20251025143839"></p>
<p>è¿˜æœ‰ä¸€ç§æƒ…å†µæ˜¯ï¼Œä¸€ä¸ªæ—§çš„ã€å»¶è¿Ÿçš„è¿žæŽ¥è¯·æ±‚ï¼ˆSYN&#x3D;1ï¼‰è¢«æœåŠ¡å™¨æŽ¥å—ï¼Œå¯¼è‡´æœåŠ¡å™¨é”™è¯¯åœ°å¼€å¯ä¸€ä¸ªä¸å†éœ€è¦çš„è¿žæŽ¥ã€‚</p>
<p><img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="https://cdn.jsdelivr.net/gh/JakicDong/blog-assets@main/images/20250715112359.png" alt="20250715112359"></p>
<p>ä¸¾ä¸ªä¾‹å­ï¼šå‡è®¾ä½ ï¼ˆå®¢æˆ·ç«¯ï¼‰ç»™ä½ çš„æœ‹å‹ï¼ˆæœåŠ¡å™¨ï¼‰å‘é€äº†ä¸€ä¸ªé‚®ä»¶ï¼ˆè¿žæŽ¥è¯·æ±‚ï¼‰ã€‚å› ä¸ºæŸäº›åŽŸå› ï¼Œè¿™å°é‚®ä»¶è¿Ÿè¿Ÿæ²¡æœ‰åˆ°è¾¾æœ‹å‹é‚£é‡Œï¼Œå¯èƒ½æ˜¯å› ä¸ºé‚®å±€çš„å»¶è¯¯ã€‚äºŽæ˜¯ä½ å†³å®šå†å‘ä¸€å°æ–°çš„é‚®ä»¶ã€‚æœ‹å‹æ”¶åˆ°äº†ç¬¬äºŒå°é‚®ä»¶ï¼Œä½ ä»¬æˆåŠŸåœ°å»ºç«‹äº†è¿žæŽ¥å¹¶å¼€å§‹é€šä¿¡ã€‚</p>
<p>ä½†æ˜¯ï¼Œè¿‡äº†å¾ˆä¹…ï¼Œé‚£å°å»¶è¯¯çš„æ—§é‚®ä»¶çªç„¶ä¹Ÿåˆ°äº†ä½ æœ‹å‹é‚£é‡Œã€‚å¦‚æžœæ²¡æœ‰ä¸€ç§æœºåˆ¶æ¥è¯†åˆ«å’Œå¤„ç†è¿™ç§å»¶è¯¯çš„é‚®ä»¶ï¼Œä½ çš„æœ‹å‹å¯èƒ½ä¼šä»¥ä¸ºè¿™æ˜¯ä¸€ä¸ªæ–°çš„è¿žæŽ¥è¯·æ±‚ï¼Œå¹¶å°è¯•å“åº”å®ƒï¼Œä½†å…¶å®žä½ å·²ç»é‡æ–°å‘äº†è¯·æ±‚ï¼ŒåŽŸæ¥çš„ä¸éœ€è¦äº†ã€‚è¿™å°±å¯¼è‡´äº†ä¸å¿…è¦çš„æ··ä¹±å’Œèµ„æºæµªè´¹ã€‚</p>
<p>æ‰€ä»¥æˆ‘ä»¬éœ€è¦â€œä¸‰æ¬¡æ¡æ‰‹â€æ¥ç¡®è®¤è¿™ä¸ªè¿‡ç¨‹ï¼š</p>
<p>ç¬¬ä¸€æ¬¡æ¡æ‰‹ï¼šå®¢æˆ·ç«¯å‘é€ SYN åŒ…ï¼ˆè¿žæŽ¥è¯·æ±‚ï¼‰ç»™æœåŠ¡å™¨ï¼Œå¦‚æžœè¿™ä¸ªåŒ…å»¶è¿Ÿäº†ï¼Œå®¢æˆ·ç«¯ä¸ä¼šä¸€ç›´ç­‰å¾…ï¼Œå®ƒ<strong>å¯èƒ½ä¼šé‡è¯•å¹¶å‘é€ä¸€ä¸ªæ–°çš„è¿žæŽ¥è¯·æ±‚</strong>ã€‚<br>ç¬¬äºŒæ¬¡æ¡æ‰‹ï¼šæœåŠ¡å™¨æ”¶åˆ° SYN åŒ…åŽï¼Œå‘é€ä¸€ä¸ª SYN-ACK åŒ…ï¼ˆç¡®è®¤æŽ¥æ”¶åˆ°è¿žæŽ¥è¯·æ±‚ï¼‰å›žå®¢æˆ·ç«¯ã€‚<br>ç¬¬ä¸‰æ¬¡æ¡æ‰‹ï¼šå®¢æˆ·ç«¯æ”¶åˆ° SYN-ACK åŒ…åŽï¼Œå†å‘é€ä¸€ä¸ª ACK åŒ…ç»™æœåŠ¡å™¨ï¼Œç¡®è®¤æ”¶åˆ°äº†æœåŠ¡å™¨çš„å“åº”ã€‚</p>
<h4 id="ä¸ºä»€ä¹ˆä¸æ˜¯å››æ¬¡ï¼Ÿ"><a href="#ä¸ºä»€ä¹ˆä¸æ˜¯å››æ¬¡ï¼Ÿ" class="headerlink" title="ä¸ºä»€ä¹ˆä¸æ˜¯å››æ¬¡ï¼Ÿ"></a>ä¸ºä»€ä¹ˆä¸æ˜¯å››æ¬¡ï¼Ÿ</h4><p>ä¸‰æ¬¡æ¡æ‰‹å·²ç»è¶³å¤Ÿåˆ›å»ºå¯é çš„è¿žæŽ¥äº†ï¼Œæ²¡æœ‰å¿…è¦å†å¤šä¸€æ¬¡æ¡æ‰‹ã€‚</p>
<h4 id="ä»€ä¹ˆæ˜¯æ³›æ´ªæ”»å‡»ï¼Ÿ"><a href="#ä»€ä¹ˆæ˜¯æ³›æ´ªæ”»å‡»ï¼Ÿ" class="headerlink" title="ä»€ä¹ˆæ˜¯æ³›æ´ªæ”»å‡»ï¼Ÿ"></a>ä»€ä¹ˆæ˜¯æ³›æ´ªæ”»å‡»ï¼Ÿ</h4><p>æ³›æ´ªæ”»å‡»ï¼ˆSYN Flood Attackï¼‰æ˜¯ä¸€ç§å¸¸è§çš„ DoSï¼ˆæ‹’ç»æœåŠ¡ï¼‰æ”»å‡»ï¼Œæ”»å‡»è€…ä¼šå‘é€å¤§é‡çš„ä¼ªé€ çš„ TCP è¿žæŽ¥è¯·æ±‚ï¼Œå¯¼è‡´æœåŠ¡å™¨èµ„æºè€—å°½ï¼Œæ— æ³•å¤„ç†æ­£å¸¸çš„è¿žæŽ¥è¯·æ±‚ã€‚</p>
<p>åŠè¿žæŽ¥æœåŠ¡æ‹’ç»ï¼Œä¹Ÿç§°ä¸º SYN æ´ªæ³›æ”»å‡»æˆ– SYN Floodã€‚</p>
<p>æ‰€è°“çš„åŠè¿žæŽ¥å°±æ˜¯æŒ‡åœ¨ TCP çš„ä¸‰æ¬¡æ¡æ‰‹è¿‡ç¨‹ä¸­ï¼Œå½“æœåŠ¡å™¨æŽ¥æ”¶åˆ°æ¥è‡ªå®¢æˆ·ç«¯çš„ç¬¬ä¸€ä¸ª SYN åŒ…åŽï¼Œå®ƒä¼šå›žå¤ä¸€ä¸ª SYN-ACK åŒ…ï¼Œæ­¤æ—¶è¿žæŽ¥å¤„äºŽâ€œåŠå¼€â€çŠ¶æ€ï¼Œå› ä¸ºè¿žæŽ¥çš„å»ºç«‹è¿˜éœ€è¦å®¢æˆ·ç«¯å‘é€æœ€åŽä¸€ä¸ª ACK åŒ…ã€‚</p>
<p>åœ¨æ”¶åˆ°æœ€åŽçš„ ACK åŒ…ä¹‹å‰ï¼ŒæœåŠ¡å™¨ä¼šä¸ºè¿™ä¸ªå°šæœªå®Œæˆçš„è¿žæŽ¥åˆ†é…ä¸€å®šçš„èµ„æºï¼Œå¹¶åœ¨å®ƒçš„é˜Ÿåˆ—ä¸­ä¿ç•™è¿™ä¸ªè¿žæŽ¥çš„ä½ç½®ã€‚</p>
<h4 id="å¦‚æžœè®©ä½ é‡æ–°è®¾è®¡ï¼Œæ€Žä¹ˆè®¾è®¡ï¼Ÿ"><a href="#å¦‚æžœè®©ä½ é‡æ–°è®¾è®¡ï¼Œæ€Žä¹ˆè®¾è®¡ï¼Ÿ" class="headerlink" title="å¦‚æžœè®©ä½ é‡æ–°è®¾è®¡ï¼Œæ€Žä¹ˆè®¾è®¡ï¼Ÿ"></a>å¦‚æžœè®©ä½ é‡æ–°è®¾è®¡ï¼Œæ€Žä¹ˆè®¾è®¡ï¼Ÿ</h4><p>å¦‚æžœé‡æ–°è®¾è®¡ TCP çš„è¿žæŽ¥å»ºç«‹è¿‡ç¨‹ï¼Œå¯ä»¥è€ƒè™‘å¼•å…¥ <code>SYN cookies</code>ï¼Œè¿™ç§æŠ€æœ¯é€šè¿‡åœ¨ <code>SYN-ACK</code> å“åº”ä¸­ç¼–ç è¿žæŽ¥ä¿¡æ¯ï¼Œä»Žè€Œåœ¨ä¸å ç”¨å¤§é‡èµ„æºçš„æƒ…å†µä¸‹éªŒè¯å®¢æˆ·ç«¯ã€‚</p>
<h3 id="ðŸŒŸ30-è¯´è¯´-TCP-å››æ¬¡æŒ¥æ‰‹çš„è¿‡ç¨‹ï¼Ÿ"><a href="#ðŸŒŸ30-è¯´è¯´-TCP-å››æ¬¡æŒ¥æ‰‹çš„è¿‡ç¨‹ï¼Ÿ" class="headerlink" title="ðŸŒŸ30.è¯´è¯´ TCP å››æ¬¡æŒ¥æ‰‹çš„è¿‡ç¨‹ï¼Ÿ"></a>ðŸŒŸ30.è¯´è¯´ TCP å››æ¬¡æŒ¥æ‰‹çš„è¿‡ç¨‹ï¼Ÿ</h3><p>TCP è¿žæŽ¥çš„æ–­å¼€è¿‡ç¨‹è¢«å½¢è±¡åœ°æ¦‚æ‹¬ä¸º<strong>å››æ¬¡æŒ¥æ‰‹</strong>ã€‚</p>
<p><img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="https://cdn.jsdelivr.net/gh/JakicDong/blog-assets@main/images/20251025144223.png" alt="20251025144223"></p>
<p><strong>ç¬¬ä¸€æ¬¡æŒ¥æ‰‹</strong>ï¼šå®¢æˆ·ç«¯å‘æœåŠ¡å™¨å‘é€ä¸€ä¸ª <code>FIN</code> ç»“æŸæŠ¥æ–‡ï¼Œè¡¨ç¤ºå®¢æˆ·ç«¯æ²¡æœ‰æ•°æ®è¦å‘é€äº†ï¼Œä½†ä»ç„¶å¯ä»¥æŽ¥æ”¶æ•°æ®ã€‚å®¢æˆ·ç«¯è¿›å…¥ <code>FIN-WAIT-1</code> çŠ¶æ€ã€‚</p>
<p><strong>ç¬¬äºŒæ¬¡æŒ¥æ‰‹</strong>ï¼šæœåŠ¡å™¨æŽ¥æ”¶åˆ° <code>FIN</code> æŠ¥æ–‡åŽï¼Œå‘å®¢æˆ·ç«¯å‘é€ä¸€ä¸ª <code>ACK</code> æŠ¥æ–‡ï¼Œç¡®è®¤å·²æŽ¥æ”¶åˆ°å®¢æˆ·ç«¯çš„ <code>FIN</code> è¯·æ±‚ã€‚æœåŠ¡å™¨è¿›å…¥ <code>CLOSE-WAIT</code> çŠ¶æ€ï¼Œå®¢æˆ·ç«¯è¿›å…¥ <code>FIN-WAIT-2</code> çŠ¶æ€ã€‚</p>
<p><strong>ç¬¬ä¸‰æ¬¡æŒ¥æ‰‹</strong>ï¼šæœåŠ¡å™¨å‘å®¢æˆ·ç«¯å‘é€ä¸€ä¸ª <code>FIN</code> æŠ¥æ–‡ï¼Œè¡¨ç¤ºæœåŠ¡å™¨ä¹Ÿæ²¡æœ‰æ•°æ®è¦å‘é€äº†ã€‚æœåŠ¡å™¨è¿›å…¥ <code>LAST-ACK </code>çŠ¶æ€ã€‚</p>
<p><strong>ç¬¬å››æ¬¡æŒ¥æ‰‹</strong>ï¼šå®¢æˆ·ç«¯æŽ¥æ”¶åˆ° <code>FIN</code> æŠ¥æ–‡åŽï¼Œå‘æœåŠ¡å™¨å‘é€ä¸€ä¸ª <code>ACK</code> æŠ¥æ–‡ï¼Œç¡®è®¤å·²æŽ¥æ”¶åˆ°æœåŠ¡å™¨çš„ <code>FIN</code> è¯·æ±‚ã€‚å®¢æˆ·ç«¯è¿›å…¥ <code>TIME-WAIT</code> çŠ¶æ€ï¼Œç­‰å¾…ä¸€æ®µæ—¶é—´ä»¥ç¡®ä¿æœåŠ¡å™¨æŽ¥æ”¶åˆ° <code>ACK</code> æŠ¥æ–‡ã€‚æœåŠ¡å™¨æŽ¥æ”¶åˆ° <code>ACK</code> æŠ¥æ–‡åŽè¿›å…¥ <code>CLOSED</code> çŠ¶æ€ã€‚å®¢æˆ·ç«¯åœ¨ç­‰å¾…ä¸€æ®µæ—¶é—´åŽä¹Ÿè¿›å…¥ <code>CLOSED</code> çŠ¶æ€ã€‚</p>
<h3 id="ðŸŒŸ31-TCP-æŒ¥æ‰‹ä¸ºä»€ä¹ˆéœ€è¦å››æ¬¡å‘¢ï¼Ÿ"><a href="#ðŸŒŸ31-TCP-æŒ¥æ‰‹ä¸ºä»€ä¹ˆéœ€è¦å››æ¬¡å‘¢ï¼Ÿ" class="headerlink" title="ðŸŒŸ31.TCP æŒ¥æ‰‹ä¸ºä»€ä¹ˆéœ€è¦å››æ¬¡å‘¢ï¼Ÿ"></a>ðŸŒŸ31.TCP æŒ¥æ‰‹ä¸ºä»€ä¹ˆéœ€è¦å››æ¬¡å‘¢ï¼Ÿ</h3><p>å› ä¸º <strong>TCP æ˜¯å…¨åŒå·¥é€šä¿¡åè®®</strong>ï¼Œæ•°æ®çš„å‘é€å’ŒæŽ¥æ”¶éœ€è¦ä¸¤æ¬¡ä¸€æ¥ä¸€å›žï¼Œä¹Ÿå°±æ˜¯å››æ¬¡ï¼Œæ¥ç¡®ä¿åŒæ–¹éƒ½èƒ½æ­£ç¡®å…³é—­è¿žæŽ¥ã€‚</p>
<p><img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="https://cdn.jsdelivr.net/gh/JakicDong/blog-assets@main/images/20250716110915.png" alt="20250716110915"></p>
<ol>
<li>ç¬¬ä¸€æ¬¡æŒ¥æ‰‹ï¼šå®¢æˆ·ç«¯è¡¨ç¤ºæ•°æ®å‘é€å®Œæˆäº†ï¼Œå‡†å¤‡å…³é—­ï¼Œä½ ç¡®è®¤ä¸€ä¸‹ã€‚</li>
<li>ç¬¬äºŒæ¬¡æŒ¥æ‰‹ï¼šæœåŠ¡ç«¯å›žè¯è¯´ okï¼Œæˆ‘é©¬ä¸Šå¤„ç†å®Œæ•°æ®ï¼Œç¨ç­‰ã€‚</li>
<li>ç¬¬ä¸‰æ¬¡æŒ¥æ‰‹ï¼šæœåŠ¡ç«¯è¡¨ç¤ºå¤„ç†å®Œäº†ï¼Œå¯ä»¥å…³é—­äº†ã€‚</li>
<li>ç¬¬å››æ¬¡æŒ¥æ‰‹ï¼šå®¢æˆ·ç«¯è¯´å¥½ï¼Œè¿›å…¥ TIME_WAIT çŠ¶æ€ï¼Œç¡®ä¿æœåŠ¡ç«¯å…³é—­è¿žæŽ¥åŽï¼Œè‡ªå·±å†å…³é—­è¿žæŽ¥ã€‚</li>
</ol>

<div class="article-footer slide-up fs14">
    <section id="license">
      <div class="header"><span>è®¸å¯åè®®</span></div>
      <div class="body"><p>æœ¬æ–‡é‡‡ç”¨ <a target="_blank" rel="noopener" href="https://creativecommons.org/licenses/by-nc-sa/4.0/">ç½²å-éžå•†ä¸šæ€§ä½¿ç”¨-ç›¸åŒæ–¹å¼å…±äº« 4.0 å›½é™…</a> è®¸å¯åè®®ï¼Œè½¬è½½è¯·æ³¨æ˜Žå‡ºå¤„ã€‚</p>
</div>
    </section>
    </div>
</article>
<div class="related-wrap slide-up" id="read-next"><section class="body"><div class="item" id="prev"><div class="note">è¾ƒæ–°æ–‡ç« </div><a href="/2025/10/24/%E5%AD%A6%E4%B9%A0%E6%97%A5%E8%AE%B025%E5%B9%B410%E6%9C%88/2025.10.24%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/">2025.10.24å­¦ä¹ æ—¥è®°</a></div><div class="item" id="next"><div class="note">è¾ƒæ—©æ–‡ç« </div><a href="/2025/10/23/Java%E9%97%AE%E7%AD%94%E7%AC%94%E8%AE%B0/Java%E5%9C%BA%E6%99%AF%E8%AE%BE%E8%AE%A1%E9%A2%98%E7%9B%AE%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/">åœºæ™¯è®¾è®¡å­¦ä¹ ç¬”è®°-é—¯æž¶æž„å¤©å®«æ¼”è¯¸æ³•,é™éœ€æ±‚å¿ƒé­”å®šç¦…å¿ƒ</a></div></section></div>







<footer class="page-footer slide-up footnote"><hr><div class="text"><p>æœ¬ç«™ç”± <a href="/">JakicDong</a> ä½¿ç”¨ <a target="_blank" rel="noopener" href="https://github.com/xaoxuu/hexo-theme-stellar/tree/1.30.0">Stellar 1.30.0</a> ä¸»é¢˜åˆ›å»ºã€‚<br>æœ¬åšå®¢æ‰€æœ‰æ–‡ç« é™¤ç‰¹åˆ«å£°æ˜Žå¤–ï¼Œå‡é‡‡ç”¨ <a target="_blank" rel="noopener" href="https://creativecommons.org/licenses/by-nc-sa/4.0/">CC BY-NC-SA 4.0</a> è®¸å¯åè®®ï¼Œè½¬è½½è¯·æ³¨æ˜Žå‡ºå¤„ã€‚</p>
</div></footer>
<div class="main-mask" onclick="sidebar.dismiss()"></div></div><aside class="l_right">
<div class="widgets">



<widget class="widget-wrapper slide-up toc" id="data-toc" collapse="false"><div class="widget-header dis-select"><span class="name">æœ¬æ–‡ç›®å½•</span><a class="cap-action" onclick="sidebar.toggleTOC()" ><svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" viewBox="0 0 24 24"><path fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10 6h11m-11 6h11m-11 6h11M4 6h1v4m-1 0h2m0 8H4c0-1 2-2 2-3s-1-1.5-2-1"/></svg></a></div><div class="widget-body"><ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#JavaSE"><span class="toc-text">JavaSE</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#1-%F0%9F%8C%9F%E4%BB%80%E4%B9%88%E6%98%AF-Java%EF%BC%9F"><span class="toc-text">1.ðŸŒŸä»€ä¹ˆæ˜¯ Javaï¼Ÿ</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#Java-%E8%AF%AD%E8%A8%80%E5%92%8C-C-%E8%AF%AD%E8%A8%80%E6%9C%89%E5%93%AA%E4%BA%9B%E5%8C%BA%E5%88%AB%EF%BC%9F"><span class="toc-text">Java è¯­è¨€å’Œ C è¯­è¨€æœ‰å“ªäº›åŒºåˆ«ï¼Ÿ</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#7-%F0%9F%8C%9FJava-%E6%9C%89%E5%93%AA%E4%BA%9B%E6%95%B0%E6%8D%AE%E7%B1%BB%E5%9E%8B%EF%BC%9F"><span class="toc-text">7.ðŸŒŸJava æœ‰å“ªäº›æ•°æ®ç±»åž‹ï¼Ÿ</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#boolean-%E7%B1%BB%E5%9E%8B%E5%AE%9E%E9%99%85%E5%8D%A0%E7%94%A8%E5%87%A0%E4%B8%AA%E5%AD%97%E8%8A%82%EF%BC%9F"><span class="toc-text">boolean ç±»åž‹å®žé™…å ç”¨å‡ ä¸ªå­—èŠ‚ï¼Ÿ</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E7%BB%99Integer%E6%9C%80%E5%A4%A7%E5%80%BC-1%EF%BC%8C%E6%98%AF%E4%BB%80%E4%B9%88%E7%BB%93%E6%9E%9C%EF%BC%9F"><span class="toc-text">ç»™Integeræœ€å¤§å€¼+1ï¼Œæ˜¯ä»€ä¹ˆç»“æžœï¼Ÿ</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#18-%F0%9F%8C%9F%E9%9D%A2%E5%90%91%E5%AF%B9%E8%B1%A1%E7%BC%96%E7%A8%8B%E6%9C%89%E5%93%AA%E4%BA%9B%E7%89%B9%E6%80%A7%EF%BC%9F"><span class="toc-text">18.ðŸŒŸé¢å‘å¯¹è±¡ç¼–ç¨‹æœ‰å“ªäº›ç‰¹æ€§ï¼Ÿ</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%B0%81%E8%A3%85%E6%98%AF%E4%BB%80%E4%B9%88%EF%BC%9F"><span class="toc-text">å°è£…æ˜¯ä»€ä¹ˆï¼Ÿ</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E7%BB%A7%E6%89%BF%E6%98%AF%E4%BB%80%E4%B9%88%EF%BC%9F"><span class="toc-text">ç»§æ‰¿æ˜¯ä»€ä¹ˆï¼Ÿ</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E4%BB%80%E4%B9%88%E6%98%AF%E5%A4%9A%E6%80%81%EF%BC%9F"><span class="toc-text">ä»€ä¹ˆæ˜¯å¤šæ€ï¼Ÿ</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E4%B8%BA%E4%BB%80%E4%B9%88Java%E9%87%8C%E9%9D%A2%E8%A6%81%E5%A4%9A%E7%BB%84%E5%90%88%E5%B0%91%E7%BB%A7%E6%89%BF%EF%BC%9F"><span class="toc-text">ä¸ºä»€ä¹ˆJavaé‡Œé¢è¦å¤šç»„åˆå°‘ç»§æ‰¿ï¼Ÿ</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#23-%F0%9F%8C%9F%E6%8A%BD%E8%B1%A1%E7%B1%BB%E5%92%8C%E6%8E%A5%E5%8F%A3%E6%9C%89%E4%BB%80%E4%B9%88%E5%8C%BA%E5%88%AB%EF%BC%9F"><span class="toc-text">23.ðŸŒŸæŠ½è±¡ç±»å’ŒæŽ¥å£æœ‰ä»€ä¹ˆåŒºåˆ«ï¼Ÿ</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%8A%BD%E8%B1%A1%E7%B1%BB%E5%8F%AF%E4%BB%A5%E5%AE%9A%E4%B9%89%E6%9E%84%E9%80%A0%E6%96%B9%E6%B3%95%E5%90%97%EF%BC%9F"><span class="toc-text">æŠ½è±¡ç±»å¯ä»¥å®šä¹‰æž„é€ æ–¹æ³•å—ï¼Ÿ</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%8E%A5%E5%8F%A3%E5%8F%AF%E4%BB%A5%E5%AE%9A%E4%B9%89%E6%9E%84%E9%80%A0%E6%96%B9%E6%B3%95%E5%90%97%EF%BC%9F"><span class="toc-text">æŽ¥å£å¯ä»¥å®šä¹‰æž„é€ æ–¹æ³•å—ï¼Ÿ</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Java%E6%94%AF%E6%8C%81%E5%A4%9A%E7%BB%A7%E6%89%BF%E5%90%97%EF%BC%9F"><span class="toc-text">Javaæ”¯æŒå¤šç»§æ‰¿å—ï¼Ÿ</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%8E%A5%E5%8F%A3%E5%8F%AF%E4%BB%A5%E5%A4%9A%E7%BB%A7%E6%89%BF%E5%90%97%EF%BC%9F"><span class="toc-text">æŽ¥å£å¯ä»¥å¤šç»§æ‰¿å—ï¼Ÿ</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E7%BB%A7%E6%89%BF%E5%92%8C%E6%8A%BD%E8%B1%A1%E7%9A%84%E5%8C%BA%E5%88%AB%EF%BC%9F"><span class="toc-text">ç»§æ‰¿å’ŒæŠ½è±¡çš„åŒºåˆ«ï¼Ÿ</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%8A%BD%E8%B1%A1%E7%B1%BB%E5%92%8C%E6%99%AE%E9%80%9A%E7%B1%BB%E7%9A%84%E5%8C%BA%E5%88%AB%EF%BC%9F"><span class="toc-text">æŠ½è±¡ç±»å’Œæ™®é€šç±»çš„åŒºåˆ«ï¼Ÿ</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#29-%F0%9F%8C%9F%E4%B8%BA%E4%BB%80%E4%B9%88%E9%87%8D%E5%86%99-equals-%E6%97%B6%E5%BF%85%E9%A1%BB%E9%87%8D%E5%86%99-hashCode-%E2%BD%85%E6%B3%95%EF%BC%9F"><span class="toc-text">29.ðŸŒŸä¸ºä»€ä¹ˆé‡å†™ equals æ—¶å¿…é¡»é‡å†™ hashCode â½…æ³•ï¼Ÿ</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E4%BB%80%E4%B9%88%E6%98%AF-hashCode-%E6%96%B9%E6%B3%95%EF%BC%9F"><span class="toc-text">ä»€ä¹ˆæ˜¯ hashCode æ–¹æ³•ï¼Ÿ</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E4%B8%BA%E4%BB%80%E4%B9%88%E8%A6%81%E6%9C%89-hashCode-%E6%96%B9%E6%B3%95%EF%BC%9F"><span class="toc-text">ä¸ºä»€ä¹ˆè¦æœ‰ hashCode æ–¹æ³•ï¼Ÿ</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E4%B8%BA%E4%BB%80%E4%B9%88%E4%B8%A4%E4%B8%AA%E5%AF%B9%E8%B1%A1%E6%9C%89%E7%9B%B8%E5%90%8C%E7%9A%84-hashcode-%E5%80%BC%EF%BC%8C%E5%AE%83%E4%BB%AC%E4%B9%9F%E4%B8%8D%E2%BC%80%E5%AE%9A%E7%9B%B8%E7%AD%89%EF%BC%9F"><span class="toc-text">ä¸ºä»€ä¹ˆä¸¤ä¸ªå¯¹è±¡æœ‰ç›¸åŒçš„ hashcode å€¼ï¼Œå®ƒä»¬ä¹Ÿä¸â¼€å®šç›¸ç­‰ï¼Ÿ</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#hashCode-%E5%92%8C-equals-%E6%96%B9%E6%B3%95%E7%9A%84%E5%85%B3%E7%B3%BB%EF%BC%9F"><span class="toc-text">hashCode å’Œ equals æ–¹æ³•çš„å…³ç³»ï¼Ÿ</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#34-%F0%9F%8C%9FString-%E5%92%8C-StringBuilder%E3%80%81StringBuffer-%E7%9A%84%E5%8C%BA%E5%88%AB%EF%BC%9F"><span class="toc-text">34.ðŸŒŸString å’Œ StringBuilderã€StringBuffer çš„åŒºåˆ«ï¼Ÿ</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E8%AF%B7%E8%AF%B4%E8%AF%B4-String-%E7%9A%84%E7%89%B9%E7%82%B9"><span class="toc-text">è¯·è¯´è¯´ String çš„ç‰¹ç‚¹</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E8%AF%B7%E8%AF%B4%E8%AF%B4-StringBuilder-%E7%9A%84%E7%89%B9%E7%82%B9"><span class="toc-text">è¯·è¯´è¯´ StringBuilder çš„ç‰¹ç‚¹</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E8%AF%B7%E8%AF%B4%E8%AF%B4-StringBuffer-%E7%9A%84%E7%89%B9%E7%82%B9"><span class="toc-text">è¯·è¯´è¯´ StringBuffer çš„ç‰¹ç‚¹</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E8%AF%B7%E6%80%BB%E7%BB%93%E4%B8%80%E4%B8%8B%E4%BD%BF%E7%94%A8%E5%9C%BA%E6%99%AF"><span class="toc-text">è¯·æ€»ç»“ä¸€ä¸‹ä½¿ç”¨åœºæ™¯</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#41-%F0%9F%8C%9FJava-%E4%B8%AD%E5%BC%82%E5%B8%B8%E5%A4%84%E7%90%86%E4%BD%93%E7%B3%BB"><span class="toc-text">41.ðŸŒŸJava ä¸­å¼‚å¸¸å¤„ç†ä½“ç³»?</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#46-%F0%9F%8C%9FBIO%E3%80%81NIO%E3%80%81AIO-%E4%B9%8B%E9%97%B4%E7%9A%84%E5%8C%BA%E5%88%AB%EF%BC%9F"><span class="toc-text">46.ðŸŒŸBIOã€NIOã€AIO ä¹‹é—´çš„åŒºåˆ«ï¼Ÿ</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E7%AE%80%E5%8D%95%E8%AF%B4%E4%B8%80%E4%B8%8B-BIO%EF%BC%9F"><span class="toc-text">ç®€å•è¯´ä¸€ä¸‹ BIOï¼Ÿ</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E7%AE%80%E5%8D%95%E8%AF%B4%E4%B8%8B-NIO%EF%BC%9F"><span class="toc-text">ç®€å•è¯´ä¸‹ NIOï¼Ÿ</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E7%AE%80%E5%8D%95%E8%AF%B4%E4%B8%8B-AIO%EF%BC%9F"><span class="toc-text">ç®€å•è¯´ä¸‹ AIOï¼Ÿ</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#52-%F0%9F%8C%9F%E4%BB%80%E4%B9%88%E6%98%AF%E5%8F%8D%E5%B0%84%EF%BC%9F%E5%BA%94%E7%94%A8%EF%BC%9F%E5%8E%9F%E7%90%86%EF%BC%9F"><span class="toc-text">52.ðŸŒŸä»€ä¹ˆæ˜¯åå°„ï¼Ÿåº”ç”¨ï¼ŸåŽŸç†ï¼Ÿ</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%8F%8D%E5%B0%84%E6%9C%89%E5%93%AA%E4%BA%9B%E5%BA%94%E7%94%A8%E5%9C%BA%E6%99%AF%EF%BC%9F"><span class="toc-text">åå°„æœ‰å“ªäº›åº”ç”¨åœºæ™¯ï¼Ÿ</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%8F%8D%E5%B0%84%E7%9A%84%E5%8E%9F%E7%90%86%E6%98%AF%E4%BB%80%E4%B9%88%EF%BC%9F"><span class="toc-text">åå°„çš„åŽŸç†æ˜¯ä»€ä¹ˆï¼Ÿ</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Java%E9%9B%86%E5%90%88%E6%A1%86%E6%9E%B6"><span class="toc-text">Javaé›†åˆæ¡†æž¶</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#1-%F0%9F%8C%9F%E8%AF%B4%E8%AF%B4%E6%9C%89%E5%93%AA%E4%BA%9B%E5%B8%B8%E8%A7%81%E7%9A%84%E9%9B%86%E5%90%88%E6%A1%86%E6%9E%B6%EF%BC%9F"><span class="toc-text">1.ðŸŒŸè¯´è¯´æœ‰å“ªäº›å¸¸è§çš„é›†åˆæ¡†æž¶ï¼Ÿ</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E9%9B%86%E5%90%88%E6%A1%86%E6%9E%B6%E6%9C%89%E5%93%AA%E5%87%A0%E4%B8%AA%E5%B8%B8%E7%94%A8%E5%B7%A5%E5%85%B7%E7%B1%BB%EF%BC%9F"><span class="toc-text">é›†åˆæ¡†æž¶æœ‰å“ªå‡ ä¸ªå¸¸ç”¨å·¥å…·ç±»ï¼Ÿ</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E7%AE%80%E5%8D%95%E4%BB%8B%E7%BB%8D%E4%B8%80%E4%B8%8B%E9%98%9F%E5%88%97"><span class="toc-text">ç®€å•ä»‹ç»ä¸€ä¸‹é˜Ÿåˆ—</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E7%94%A8%E8%BF%87%E5%93%AA%E4%BA%9B%E9%9B%86%E5%90%88%E7%B1%BB%EF%BC%8C%E5%AE%83%E4%BB%AC%E7%9A%84%E4%BC%98%E5%8A%A3%EF%BC%9F"><span class="toc-text">ç”¨è¿‡å“ªäº›é›†åˆç±»ï¼Œå®ƒä»¬çš„ä¼˜åŠ£ï¼Ÿ</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E9%98%9F%E5%88%97%E5%92%8C%E6%A0%88%E7%9A%84%E5%8C%BA%E5%88%AB%E4%BA%86%E8%A7%A3%E5%90%97%EF%BC%9F"><span class="toc-text">é˜Ÿåˆ—å’Œæ ˆçš„åŒºåˆ«äº†è§£å—ï¼Ÿ</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%93%AA%E4%BA%9B%E6%98%AF%E7%BA%BF%E7%A8%8B%E5%AE%89%E5%85%A8%E7%9A%84%E5%AE%B9%E5%99%A8%EF%BC%9F"><span class="toc-text">å“ªäº›æ˜¯çº¿ç¨‹å®‰å…¨çš„å®¹å™¨ï¼Ÿ</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Collection-%E7%BB%A7%E6%89%BF%E4%BA%86%E5%93%AA%E4%BA%9B%E6%8E%A5%E5%8F%A3%EF%BC%9F"><span class="toc-text">Collection ç»§æ‰¿äº†å“ªäº›æŽ¥å£ï¼Ÿ</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-%F0%9F%8C%9FArrayList-%E5%92%8C-LinkedList-%E6%9C%89%E4%BB%80%E4%B9%88%E5%8C%BA%E5%88%AB%EF%BC%9F"><span class="toc-text">2.ðŸŒŸArrayList å’Œ LinkedList æœ‰ä»€ä¹ˆåŒºåˆ«ï¼Ÿ</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#ArrayList-%E5%92%8C-LinkedList-%E7%9A%84%E7%94%A8%E9%80%94%E6%9C%89%E4%BB%80%E4%B9%88%E4%B8%8D%E5%90%8C%EF%BC%9F"><span class="toc-text">ArrayList å’Œ LinkedList çš„ç”¨é€”æœ‰ä»€ä¹ˆä¸åŒï¼Ÿ</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#ArrayList-%E5%92%8C-LinkedList-%E6%98%AF%E5%90%A6%E6%94%AF%E6%8C%81%E9%9A%8F%E6%9C%BA%E8%AE%BF%E9%97%AE%EF%BC%9F"><span class="toc-text">ArrayList å’Œ LinkedList æ˜¯å¦æ”¯æŒéšæœºè®¿é—®ï¼Ÿ</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#ArrayList-%E5%92%8C-LinkedList-%E5%86%85%E5%AD%98%E5%8D%A0%E7%94%A8%E6%9C%89%E4%BD%95%E4%B8%8D%E5%90%8C%EF%BC%9F"><span class="toc-text">ArrayList å’Œ LinkedList å†…å­˜å ç”¨æœ‰ä½•ä¸åŒï¼Ÿ</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#ArrayList-%E5%92%8C-LinkedList-%E7%9A%84%E4%BD%BF%E7%94%A8%E5%9C%BA%E6%99%AF%E6%9C%89%E4%BB%80%E4%B9%88%E4%B8%8D%E5%90%8C%EF%BC%9F"><span class="toc-text">ArrayList å’Œ LinkedList çš„ä½¿ç”¨åœºæ™¯æœ‰ä»€ä¹ˆä¸åŒï¼Ÿ</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E9%93%BE%E8%A1%A8%E5%92%8C%E6%95%B0%E7%BB%84%E6%9C%89%E4%BB%80%E4%B9%88%E5%8C%BA%E5%88%AB%EF%BC%9F"><span class="toc-text">é“¾è¡¨å’Œæ•°ç»„æœ‰ä»€ä¹ˆåŒºåˆ«ï¼Ÿ</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#8-%F0%9F%8C%9F%E8%83%BD%E8%AF%B4%E4%B8%80%E4%B8%8B-HashMap-%E7%9A%84%E5%BA%95%E5%B1%82%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84%E5%90%97%EF%BC%9F"><span class="toc-text">8.ðŸŒŸèƒ½è¯´ä¸€ä¸‹ HashMap çš„åº•å±‚æ•°æ®ç»“æž„å—ï¼Ÿ</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#11-%F0%9F%8C%9FHashMap-%E7%9A%84-put-%E6%B5%81%E7%A8%8B%E7%9F%A5%E9%81%93%E5%90%97%EF%BC%9F"><span class="toc-text">11.ðŸŒŸHashMap çš„ put æµç¨‹çŸ¥é“å—ï¼Ÿ</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%8F%AA%E9%87%8D%E5%86%99%E5%85%83%E7%B4%A0%E7%9A%84-equals-%E6%96%B9%E6%B3%95%E6%B2%A1%E9%87%8D%E5%86%99-hashCode%EF%BC%8Cput-%E7%9A%84%E6%97%B6%E5%80%99%E4%BC%9A%E5%8F%91%E7%94%9F%E4%BB%80%E4%B9%88"><span class="toc-text">åªé‡å†™å…ƒç´ çš„ equals æ–¹æ³•æ²¡é‡å†™ hashCodeï¼Œput çš„æ—¶å€™ä¼šå‘ç”Ÿä»€ä¹ˆ?</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#21-%F0%9F%8C%9FHashMap%E7%9A%84%E6%89%A9%E5%AE%B9%E6%9C%BA%E5%88%B6%E4%BA%86%E8%A7%A3%E5%90%97%EF%BC%9F"><span class="toc-text">21.ðŸŒŸHashMapçš„æ‰©å®¹æœºåˆ¶äº†è§£å—ï¼Ÿ</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#JDK-7-%E6%89%A9%E5%AE%B9%E7%9A%84%E6%97%B6%E5%80%99%E6%9C%89%E4%BB%80%E4%B9%88%E9%97%AE%E9%A2%98%EF%BC%9F"><span class="toc-text">JDK 7 æ‰©å®¹çš„æ—¶å€™æœ‰ä»€ä¹ˆé—®é¢˜ï¼Ÿ</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#JDK-8-%E6%98%AF%E6%80%8E%E4%B9%88%E8%A7%A3%E5%86%B3%E8%BF%99%E4%B8%AA%E9%97%AE%E9%A2%98%E7%9A%84%EF%BC%9F"><span class="toc-text">JDK 8 æ˜¯æ€Žä¹ˆè§£å†³è¿™ä¸ªé—®é¢˜çš„ï¼Ÿ</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%89%A9%E5%AE%B9%E7%9A%84%E6%97%B6%E5%80%99%E6%AF%8F%E4%B8%AA%E8%8A%82%E7%82%B9%E9%83%BD%E8%A6%81%E8%BF%9B%E8%A1%8C%E4%BD%8D%E8%BF%90%E7%AE%97%E5%90%97%EF%BC%9F"><span class="toc-text">æ‰©å®¹çš„æ—¶å€™æ¯ä¸ªèŠ‚ç‚¹éƒ½è¦è¿›è¡Œä½è¿ç®—å—ï¼Ÿ</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#24-%F0%9F%8C%9FHashMap-%E6%98%AF%E7%BA%BF%E7%A8%8B%E5%AE%89%E5%85%A8%E7%9A%84%E5%90%97%EF%BC%9F"><span class="toc-text">24.ðŸŒŸHashMap æ˜¯çº¿ç¨‹å®‰å…¨çš„å—ï¼Ÿ</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#25-%F0%9F%8C%9F%E6%80%8E%E4%B9%88%E8%A7%A3%E5%86%B3-HashMap-%E7%BA%BF%E7%A8%8B%E4%B8%8D%E5%AE%89%E5%85%A8%E7%9A%84%E9%97%AE%E9%A2%98%E5%91%A2%EF%BC%9F"><span class="toc-text">25.ðŸŒŸæ€Žä¹ˆè§£å†³ HashMap çº¿ç¨‹ä¸å®‰å…¨çš„é—®é¢˜å‘¢ï¼Ÿ</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Java%E5%B9%B6%E5%8F%91%E7%BC%96%E7%A8%8B"><span class="toc-text">Javaå¹¶å‘ç¼–ç¨‹</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#2-%F0%9F%8C%9F%E8%AF%B4%E8%AF%B4%E8%BF%9B%E7%A8%8B%E5%92%8C%E7%BA%BF%E7%A8%8B%E7%9A%84%E5%8C%BA%E5%88%AB%EF%BC%9F"><span class="toc-text">2.ðŸŒŸè¯´è¯´è¿›ç¨‹å’Œçº¿ç¨‹çš„åŒºåˆ«ï¼Ÿ</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%A6%82%E4%BD%95%E7%90%86%E8%A7%A3%E5%8D%8F%E7%A8%8B%EF%BC%9F"><span class="toc-text">å¦‚ä½•ç†è§£åç¨‹ï¼Ÿ</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E7%BA%BF%E7%A8%8B%E9%97%B4%E6%98%AF%E5%A6%82%E4%BD%95%E8%BF%9B%E8%A1%8C%E9%80%9A%E4%BF%A1%E7%9A%84%EF%BC%9F"><span class="toc-text">çº¿ç¨‹é—´æ˜¯å¦‚ä½•è¿›è¡Œé€šä¿¡çš„ï¼Ÿ</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3-%F0%9F%8C%9F%E8%AF%B4%E8%AF%B4%E7%BA%BF%E7%A8%8B%E6%9C%89%E5%87%A0%E7%A7%8D%E5%88%9B%E5%BB%BA%E6%96%B9%E5%BC%8F%EF%BC%9F"><span class="toc-text">3.ðŸŒŸè¯´è¯´çº¿ç¨‹æœ‰å‡ ç§åˆ›å»ºæ–¹å¼ï¼Ÿ</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E4%B8%80%E4%B8%AA-8G-%E5%86%85%E5%AD%98%E7%9A%84%E7%B3%BB%E7%BB%9F%E6%9C%80%E5%A4%9A%E8%83%BD%E5%88%9B%E5%BB%BA%E5%A4%9A%E5%B0%91%E4%B8%AA%E7%BA%BF%E7%A8%8B"><span class="toc-text">ä¸€ä¸ª 8G å†…å­˜çš„ç³»ç»Ÿæœ€å¤šèƒ½åˆ›å»ºå¤šå°‘ä¸ªçº¿ç¨‹?</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%90%AF%E5%8A%A8%E4%B8%80%E4%B8%AA-Java-%E7%A8%8B%E5%BA%8F%EF%BC%8C%E4%BD%A0%E8%83%BD%E8%AF%B4%E8%AF%B4%E9%87%8C%E9%9D%A2%E6%9C%89%E5%93%AA%E4%BA%9B%E7%BA%BF%E7%A8%8B%E5%90%97%EF%BC%9F"><span class="toc-text">å¯åŠ¨ä¸€ä¸ª Java ç¨‹åºï¼Œä½ èƒ½è¯´è¯´é‡Œé¢æœ‰å“ªäº›çº¿ç¨‹å—ï¼Ÿ</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#4-%F0%9F%8C%9F%E8%B0%83%E7%94%A8-start-%E6%96%B9%E6%B3%95%E6%97%B6%E4%BC%9A%E6%89%A7%E8%A1%8C-run-%E6%96%B9%E6%B3%95%EF%BC%8C%E9%82%A3%E6%80%8E%E4%B9%88%E4%B8%8D%E7%9B%B4%E6%8E%A5%E8%B0%83%E7%94%A8-run%E6%96%B9%E6%B3%95%EF%BC%9F"><span class="toc-text">4.ðŸŒŸè°ƒç”¨ start æ–¹æ³•æ—¶ä¼šæ‰§è¡Œ run æ–¹æ³•ï¼Œé‚£æ€Žä¹ˆä¸ç›´æŽ¥è°ƒç”¨ runæ–¹æ³•ï¼Ÿ</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#6-%F0%9F%8C%9F%E7%BA%BF%E7%A8%8B%E6%9C%89%E5%87%A0%E7%A7%8D%E7%8A%B6%E6%80%81%EF%BC%9F"><span class="toc-text">6.ðŸŒŸçº¿ç¨‹æœ‰å‡ ç§çŠ¶æ€ï¼Ÿ</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%A6%82%E4%BD%95%E5%BC%BA%E5%88%B6%E7%BB%88%E6%AD%A2%E7%BA%BF%E7%A8%8B%EF%BC%9F"><span class="toc-text">å¦‚ä½•å¼ºåˆ¶ç»ˆæ­¢çº¿ç¨‹ï¼Ÿ</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#10-%F0%9F%8C%9F%E8%AF%B7%E8%AF%B4%E8%AF%B4-sleep-%E5%92%8C-wait-%E7%9A%84%E5%8C%BA%E5%88%AB%EF%BC%9F%EF%BC%88%E8%A1%A5%E5%85%85%EF%BC%89"><span class="toc-text">10.ðŸŒŸè¯·è¯´è¯´ sleep å’Œ wait çš„åŒºåˆ«ï¼Ÿï¼ˆè¡¥å……ï¼‰</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#11-%F0%9F%8C%9F%E6%80%8E%E4%B9%88%E4%BF%9D%E8%AF%81%E7%BA%BF%E7%A8%8B%E5%AE%89%E5%85%A8%EF%BC%9F%EF%BC%88%E8%A1%A5%E5%85%85%EF%BC%89"><span class="toc-text">11.ðŸŒŸæ€Žä¹ˆä¿è¯çº¿ç¨‹å®‰å…¨ï¼Ÿï¼ˆè¡¥å……ï¼‰</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%9C%89%E4%B8%AAint%E7%9A%84%E5%8F%98%E9%87%8F%E4%B8%BA0%EF%BC%8C%E5%8D%81%E4%B8%AA%E7%BA%BF%E7%A8%8B%E8%BD%AE%E6%B5%81%E5%AF%B9%E5%85%B6%E8%BF%9B%E8%A1%8C-%E6%93%8D%E4%BD%9C%EF%BC%88%E5%BE%AA%E7%8E%AF10000%E6%AC%A1%EF%BC%89%EF%BC%8C%E7%BB%93%E6%9E%9C%E5%A4%A7%E4%BA%8E10-%E4%B8%87%E8%BF%98%E6%98%AF%E5%B0%8F%E4%BA%8E%E7%AD%89%E4%BA%8E10%E4%B8%87%EF%BC%8C%E4%B8%BA%E4%BB%80%E4%B9%88%EF%BC%9F"><span class="toc-text">æœ‰ä¸ªintçš„å˜é‡ä¸º0ï¼Œåä¸ªçº¿ç¨‹è½®æµå¯¹å…¶è¿›è¡Œ++æ“ä½œï¼ˆå¾ªçŽ¯10000æ¬¡ï¼‰ï¼Œç»“æžœå¤§äºŽ10 ä¸‡è¿˜æ˜¯å°äºŽç­‰äºŽ10ä¸‡ï¼Œä¸ºä»€ä¹ˆï¼Ÿ</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%9C%BA%E6%99%AF-%E6%9C%89%E4%B8%80%E4%B8%AA-key-%E5%AF%B9%E5%BA%94%E7%9A%84-value-%E6%98%AF%E4%B8%80%E4%B8%AAjson-%E7%BB%93%E6%9E%84%EF%BC%8Cjson-%E5%BD%93%E4%B8%AD%E6%9C%89%E5%A5%BD%E5%87%A0%E4%B8%AA%E5%AD%90%E4%BB%BB%E5%8A%A1%EF%BC%8C%E8%BF%99%E4%BA%9B%E5%AD%90%E4%BB%BB%E5%8A%A1%E5%A6%82%E6%9E%9C%E5%AF%B9-key-%E8%BF%9B%E8%A1%8C%E4%BF%AE%E6%94%B9%E7%9A%84%E8%AF%9D%EF%BC%8C%E4%BC%9A%E4%B8%8D%E4%BC%9A%E5%AD%98%E5%9C%A8%E7%BA%BF%E7%A8%8B%E5%AE%89%E5%85%A8%E7%9A%84%E9%97%AE%E9%A2%98%EF%BC%9F"><span class="toc-text">åœºæ™¯:æœ‰ä¸€ä¸ª key å¯¹åº”çš„ value æ˜¯ä¸€ä¸ªjson ç»“æž„ï¼Œjson å½“ä¸­æœ‰å¥½å‡ ä¸ªå­ä»»åŠ¡ï¼Œè¿™äº›å­ä»»åŠ¡å¦‚æžœå¯¹ key è¿›è¡Œä¿®æ”¹çš„è¯ï¼Œä¼šä¸ä¼šå­˜åœ¨çº¿ç¨‹å®‰å…¨çš„é—®é¢˜ï¼Ÿ</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E8%AF%B4%E4%B8%80%E4%B8%AA%E7%BA%BF%E7%A8%8B%E5%AE%89%E5%85%A8%E7%9A%84%E4%BD%BF%E7%94%A8%E5%9C%BA%E6%99%AF%EF%BC%9F"><span class="toc-text">è¯´ä¸€ä¸ªçº¿ç¨‹å®‰å…¨çš„ä½¿ç”¨åœºæ™¯ï¼Ÿ</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E8%83%BD%E8%AF%B4%E4%B8%80%E4%B8%8B-Hashtable-%E7%9A%84%E5%BA%95%E5%B1%82%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84%E5%90%97%EF%BC%9F"><span class="toc-text">èƒ½è¯´ä¸€ä¸‹ Hashtable çš„åº•å±‚æ•°æ®ç»“æž„å—ï¼Ÿ</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#12-%F0%9F%8C%9FThreadLocal-%E6%98%AF%E4%BB%80%E4%B9%88%EF%BC%9F"><span class="toc-text">12.ðŸŒŸThreadLocal æ˜¯ä»€ä¹ˆï¼Ÿ</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#ThreadLocal-%E6%9C%89%E5%93%AA%E4%BA%9B%E4%BC%98%E7%82%B9%EF%BC%9F"><span class="toc-text">ThreadLocal æœ‰å“ªäº›ä¼˜ç‚¹ï¼Ÿ</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#14-%F0%9F%8C%9FThreadLocal-%E6%80%8E%E4%B9%88%E5%AE%9E%E7%8E%B0%E7%9A%84%E5%91%A2%EF%BC%9F"><span class="toc-text">14.ðŸŒŸThreadLocal æ€Žä¹ˆå®žçŽ°çš„å‘¢ï¼Ÿ</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E4%BB%80%E4%B9%88%E6%98%AF%E5%BC%B1%E5%BC%95%E7%94%A8%EF%BC%8C%E4%BB%80%E4%B9%88%E6%98%AF%E5%BC%BA%E5%BC%95%E7%94%A8%EF%BC%9F"><span class="toc-text">ä»€ä¹ˆæ˜¯å¼±å¼•ç”¨ï¼Œä»€ä¹ˆæ˜¯å¼ºå¼•ç”¨ï¼Ÿ</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#15-%F0%9F%8C%9FThreadLocal-%E5%86%85%E5%AD%98%E6%B3%84%E9%9C%B2%E6%98%AF%E6%80%8E%E4%B9%88%E5%9B%9E%E4%BA%8B%EF%BC%9F"><span class="toc-text">15.ðŸŒŸThreadLocal å†…å­˜æ³„éœ²æ˜¯æ€Žä¹ˆå›žäº‹ï¼Ÿ</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E9%82%A3%E6%80%8E%E4%B9%88%E8%A7%A3%E5%86%B3%E5%86%85%E5%AD%98%E6%B3%84%E6%BC%8F%E9%97%AE%E9%A2%98%E5%91%A2%EF%BC%9F"><span class="toc-text">é‚£æ€Žä¹ˆè§£å†³å†…å­˜æ³„æ¼é—®é¢˜å‘¢ï¼Ÿ</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E9%82%A3%E4%B8%BA%E4%BB%80%E4%B9%88-key-%E8%A6%81%E8%AE%BE%E8%AE%A1%E6%88%90%E5%BC%B1%E5%BC%95%E7%94%A8%EF%BC%9F"><span class="toc-text">é‚£ä¸ºä»€ä¹ˆ key è¦è®¾è®¡æˆå¼±å¼•ç”¨ï¼Ÿ</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E4%BD%A0%E4%BA%86%E8%A7%A3%E5%93%AA%E4%BA%9B-ThreadLocal-%E7%9A%84%E6%94%B9%E8%BF%9B%E6%96%B9%E6%A1%88%EF%BC%9F"><span class="toc-text">ä½ äº†è§£å“ªäº› ThreadLocal çš„æ”¹è¿›æ–¹æ¡ˆï¼Ÿ</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#20-%F0%9F%8C%9F%E8%AF%B4%E4%B8%80%E4%B8%8B%E4%BD%A0%E5%AF%B9-Java-%E5%86%85%E5%AD%98%E6%A8%A1%E5%9E%8B%E7%9A%84%E7%90%86%E8%A7%A3%EF%BC%9F"><span class="toc-text">20.ðŸŒŸè¯´ä¸€ä¸‹ä½ å¯¹ Java å†…å­˜æ¨¡åž‹çš„ç†è§£ï¼Ÿ</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E4%B8%BA%E4%BB%80%E4%B9%88%E7%BA%BF%E7%A8%8B%E8%A6%81%E7%94%A8%E8%87%AA%E5%B7%B1%E7%9A%84%E5%86%85%E5%AD%98%EF%BC%9F"><span class="toc-text">ä¸ºä»€ä¹ˆçº¿ç¨‹è¦ç”¨è‡ªå·±çš„å†…å­˜ï¼Ÿ</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#25-%F0%9F%8C%9Fvolatile-%E4%BA%86%E8%A7%A3%E5%90%97%EF%BC%9F"><span class="toc-text">25.ðŸŒŸvolatile äº†è§£å—ï¼Ÿ</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#volatile-%E6%80%8E%E4%B9%88%E4%BF%9D%E8%AF%81%E5%8F%AF%E8%A7%81%E6%80%A7%E7%9A%84%EF%BC%9F"><span class="toc-text">volatile æ€Žä¹ˆä¿è¯å¯è§æ€§çš„ï¼Ÿ</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#volatile-%E6%80%8E%E4%B9%88%E4%BF%9D%E8%AF%81%E6%9C%89%E5%BA%8F%E6%80%A7%E7%9A%84%EF%BC%9F"><span class="toc-text">volatile æ€Žä¹ˆä¿è¯æœ‰åºæ€§çš„ï¼Ÿ</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#volatile-%E5%92%8C-synchronized-%E7%9A%84%E5%8C%BA%E5%88%AB%EF%BC%9F"><span class="toc-text">volatile å’Œ synchronized çš„åŒºåˆ«ï¼Ÿ</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#volatile-%E5%8A%A0%E5%9C%A8%E5%9F%BA%E6%9C%AC%E7%B1%BB%E5%9E%8B%E5%92%8C%E5%AF%B9%E8%B1%A1%E4%B8%8A%E7%9A%84%E5%8C%BA%E5%88%AB%EF%BC%9F"><span class="toc-text">volatile åŠ åœ¨åŸºæœ¬ç±»åž‹å’Œå¯¹è±¡ä¸Šçš„åŒºåˆ«ï¼Ÿ</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#29-%F0%9F%8C%9Fsynchronized-%E9%94%81%E5%8D%87%E7%BA%A7%E4%BA%86%E8%A7%A3%E5%90%97%EF%BC%9F"><span class="toc-text">29.ðŸŒŸsynchronized é”å‡çº§äº†è§£å—ï¼Ÿ</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E4%BA%86%E8%A7%A3-synchronized-%E5%9B%9B%E7%A7%8D%E9%94%81%E7%8A%B6%E6%80%81%E5%90%97%EF%BC%9F"><span class="toc-text">äº†è§£ synchronized å››ç§é”çŠ¶æ€å—ï¼Ÿ</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#synchronized-%E5%81%9A%E4%BA%86%E5%93%AA%E4%BA%9B%E4%BC%98%E5%8C%96%EF%BC%9F"><span class="toc-text">synchronized åšäº†å“ªäº›ä¼˜åŒ–ï¼Ÿ</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E8%AF%B7%E8%AF%A6%E7%BB%86%E8%AF%B4%E8%AF%B4%E9%94%81%E5%8D%87%E7%BA%A7%E7%9A%84%E8%BF%87%E7%A8%8B%EF%BC%9F"><span class="toc-text">è¯·è¯¦ç»†è¯´è¯´é”å‡çº§çš„è¿‡ç¨‹ï¼Ÿ</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#30-%F0%9F%8C%9Fsynchronized-%E5%92%8C-ReentrantLock-%E7%9A%84%E5%8C%BA%E5%88%AB%E4%BA%86%E8%A7%A3%E5%90%97%EF%BC%9F"><span class="toc-text">30.ðŸŒŸsynchronized å’Œ ReentrantLock çš„åŒºåˆ«äº†è§£å—ï¼Ÿ</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%B9%B6%E5%8F%91%E9%87%8F%E5%A4%A7%E7%9A%84%E6%83%85%E5%86%B5%E4%B8%8B%EF%BC%8C%E4%BD%BF%E7%94%A8-synchronized-%E8%BF%98%E6%98%AF-ReentrantLock%EF%BC%9F"><span class="toc-text">å¹¶å‘é‡å¤§çš„æƒ…å†µä¸‹ï¼Œä½¿ç”¨ synchronized è¿˜æ˜¯ ReentrantLockï¼Ÿ</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Lock-%E4%BA%86%E8%A7%A3%E5%90%97%EF%BC%9F"><span class="toc-text">Lock äº†è§£å—ï¼Ÿ</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#ReentrantLock-%E7%9A%84-lock-%E6%96%B9%E6%B3%95%E5%AE%9E%E7%8E%B0%E9%80%BB%E8%BE%91%E4%BA%86%E8%A7%A3%E5%90%97%EF%BC%9F"><span class="toc-text">ReentrantLock çš„ lock() æ–¹æ³•å®žçŽ°é€»è¾‘äº†è§£å—ï¼Ÿ</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#32-%F0%9F%8C%9F%E8%AF%B4%E8%AF%B4-ReentrantLock-%E7%9A%84%E5%AE%9E%E7%8E%B0%E5%8E%9F%E7%90%86%EF%BC%9F"><span class="toc-text">32.ðŸŒŸè¯´è¯´ ReentrantLock çš„å®žçŽ°åŽŸç†ï¼Ÿ</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#34-%F0%9F%8C%9FCAS-%E4%BA%86%E8%A7%A3%E5%A4%9A%E5%B0%91%EF%BC%9F"><span class="toc-text">34.ðŸŒŸCAS äº†è§£å¤šå°‘ï¼Ÿ</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%80%8E%E4%B9%88%E4%BF%9D%E8%AF%81-CAS-%E7%9A%84%E5%8E%9F%E5%AD%90%E6%80%A7%EF%BC%9F"><span class="toc-text">æ€Žä¹ˆä¿è¯ CAS çš„åŽŸå­æ€§ï¼Ÿ</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#35-%F0%9F%8C%9FCAS-%E6%9C%89%E4%BB%80%E4%B9%88%E9%97%AE%E9%A2%98%EF%BC%9F"><span class="toc-text">35.ðŸŒŸCAS æœ‰ä»€ä¹ˆé—®é¢˜ï¼Ÿ</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E4%BB%80%E4%B9%88%E6%98%AF-ABA-%E9%97%AE%E9%A2%98%EF%BC%9F"><span class="toc-text">ä»€ä¹ˆæ˜¯ ABA é—®é¢˜ï¼Ÿ</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E8%87%AA%E6%97%8B%E5%BC%80%E9%94%80%E5%A4%A7%E6%80%8E%E4%B9%88%E8%A7%A3%E5%86%B3%EF%BC%9F"><span class="toc-text">è‡ªæ—‹å¼€é”€å¤§æ€Žä¹ˆè§£å†³ï¼Ÿ</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%B6%89%E5%8F%8A%E5%88%B0%E5%A4%9A%E4%B8%AA%E5%8F%98%E9%87%8F%E5%90%8C%E6%97%B6%E6%9B%B4%E6%96%B0%E6%80%8E%E4%B9%88%E5%8A%9E%EF%BC%9F"><span class="toc-text">æ¶‰åŠåˆ°å¤šä¸ªå˜é‡åŒæ—¶æ›´æ–°æ€Žä¹ˆåŠžï¼Ÿ</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#40-%F0%9F%8C%9F%E6%AD%BB%E9%94%81%E9%97%AE%E9%A2%98%E6%80%8E%E4%B9%88%E6%8E%92%E6%9F%A5%E5%91%A2%EF%BC%9F"><span class="toc-text">40.ðŸŒŸæ­»é”é—®é¢˜æ€Žä¹ˆæŽ’æŸ¥å‘¢ï¼Ÿ</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#42-%F0%9F%8C%9F%E8%81%8A%E8%81%8A%E6%82%B2%E8%A7%82%E9%94%81%E5%92%8C%E4%B9%90%E8%A7%82%E9%94%81%EF%BC%9F%EF%BC%88%E8%A1%A5%E5%85%85%EF%BC%89"><span class="toc-text">42.ðŸŒŸèŠèŠæ‚²è§‚é”å’Œä¹è§‚é”ï¼Ÿï¼ˆè¡¥å……ï¼‰</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E4%B9%90%E8%A7%82%E9%94%81%E5%8F%91%E7%8E%B0%E6%9C%89%E7%BA%BF%E7%A8%8B%E8%BF%87%E6%9D%A5%E4%BF%AE%E6%94%B9%E6%95%B0%E6%8D%AE%EF%BC%8C%E6%80%8E%E4%B9%88%E5%8A%9E%EF%BC%9F"><span class="toc-text">ä¹è§‚é”å‘çŽ°æœ‰çº¿ç¨‹è¿‡æ¥ä¿®æ”¹æ•°æ®ï¼Œæ€Žä¹ˆåŠžï¼Ÿ</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#48-%F0%9F%8C%9F%E8%83%BD%E8%AF%B4%E4%B8%80%E4%B8%8B-ConcurrentHashMap-%E7%9A%84%E5%AE%9E%E7%8E%B0%E5%90%97%EF%BC%9F%EF%BC%88%E8%A1%A5%E5%85%85%EF%BC%89"><span class="toc-text">48.ðŸŒŸèƒ½è¯´ä¸€ä¸‹ ConcurrentHashMap çš„å®žçŽ°å—ï¼Ÿï¼ˆè¡¥å……ï¼‰</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E8%AF%B4%E4%B8%80%E4%B8%8B-JDK-7-%E4%B8%AD-ConcurrentHashMap-%E7%9A%84%E5%AE%9E%E7%8E%B0%E5%8E%9F%E7%90%86%EF%BC%9F"><span class="toc-text">è¯´ä¸€ä¸‹ JDK 7 ä¸­ ConcurrentHashMap çš„å®žçŽ°åŽŸç†ï¼Ÿ</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E8%AF%B4%E4%B8%80%E4%B8%8B-JDK-7-%E4%B8%AD-ConcurrentHashMap-%E7%9A%84-put-%E6%B5%81%E7%A8%8B%EF%BC%9F"><span class="toc-text">è¯´ä¸€ä¸‹ JDK 7 ä¸­ ConcurrentHashMap çš„ put æµç¨‹ï¼Ÿ</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E8%AF%B4%E4%B8%80%E4%B8%8B-JDK-7-%E4%B8%AD-ConcurrentHashMap-%E7%9A%84-get-%E6%B5%81%E7%A8%8B%EF%BC%9F"><span class="toc-text">è¯´ä¸€ä¸‹ JDK 7 ä¸­ ConcurrentHashMap çš„ get æµç¨‹ï¼Ÿ</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E8%AF%B4%E4%B8%80%E4%B8%8B-JDK-8-%E4%B8%AD-ConcurrentHashMap-%E7%9A%84%E5%AE%9E%E7%8E%B0%E5%8E%9F%E7%90%86%EF%BC%9F"><span class="toc-text">è¯´ä¸€ä¸‹ JDK 8 ä¸­ ConcurrentHashMap çš„å®žçŽ°åŽŸç†ï¼Ÿ</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E8%AF%B4%E4%B8%80%E4%B8%8B-JDK-8-%E4%B8%AD-ConcurrentHashMap-%E7%9A%84-put-%E6%B5%81%E7%A8%8B%EF%BC%9F"><span class="toc-text">è¯´ä¸€ä¸‹ JDK 8 ä¸­ ConcurrentHashMap çš„ put æµç¨‹ï¼Ÿ</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E8%AF%B4%E4%B8%80%E4%B8%8B-JDK-8-%E4%B8%AD-ConcurrentHashMap-%E7%9A%84-get-%E6%B5%81%E7%A8%8B%EF%BC%9F"><span class="toc-text">è¯´ä¸€ä¸‹ JDK 8 ä¸­ ConcurrentHashMap çš„ get æµç¨‹ï¼Ÿ</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E8%AF%B4%E4%B8%80%E4%B8%8B-HashMap-%E5%92%8C-ConcurrentHashMap-%E7%9A%84%E5%8C%BA%E5%88%AB%EF%BC%9F"><span class="toc-text">è¯´ä¸€ä¸‹ HashMap å’Œ ConcurrentHashMap çš„åŒºåˆ«ï¼Ÿ</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E4%BD%A0%E9%A1%B9%E7%9B%AE%E4%B8%AD%E6%80%8E%E4%B9%88%E4%BD%BF%E7%94%A8-ConcurrentHashMap-%E7%9A%84%EF%BC%9F"><span class="toc-text">ä½ é¡¹ç›®ä¸­æ€Žä¹ˆä½¿ç”¨ ConcurrentHashMap çš„ï¼Ÿ</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E8%AF%B4%E4%B8%80%E4%B8%8B-ConcurrentHashMap-%E5%AF%B9-HashMap-%E7%9A%84%E6%94%B9%E8%BF%9B%EF%BC%9F"><span class="toc-text">è¯´ä¸€ä¸‹ ConcurrentHashMap å¯¹ HashMap çš„æ”¹è¿›ï¼Ÿ</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E4%B8%BA%E4%BB%80%E4%B9%88-ConcurrentHashMap-%E5%9C%A8-JDK-1-7-%E4%B8%AD%E8%A6%81%E7%94%A8-ReentrantLock%EF%BC%8C%E8%80%8C%E5%9C%A8-JDK-1-8-%E8%A6%81%E7%94%A8-synchronized"><span class="toc-text">ä¸ºä»€ä¹ˆ ConcurrentHashMap åœ¨ JDK 1.7 ä¸­è¦ç”¨ ReentrantLockï¼Œè€Œåœ¨ JDK 1.8 è¦ç”¨ synchronized</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#53-%F0%9F%8C%9F%E4%BB%80%E4%B9%88%E6%98%AF%E7%BA%BF%E7%A8%8B%E6%B1%A0%EF%BC%9F"><span class="toc-text">53.ðŸŒŸä»€ä¹ˆæ˜¯çº¿ç¨‹æ± ï¼Ÿ</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#55-%F0%9F%8C%9F%E8%AF%B4%E4%B8%80%E4%B8%8B%E7%BA%BF%E7%A8%8B%E6%B1%A0%E7%9A%84%E5%B7%A5%E4%BD%9C%E6%B5%81%E7%A8%8B%EF%BC%9F"><span class="toc-text">55.ðŸŒŸè¯´ä¸€ä¸‹çº¿ç¨‹æ± çš„å·¥ä½œæµç¨‹ï¼Ÿ</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E8%83%BD%E7%94%A8%E4%B8%80%E4%B8%AA%E7%94%9F%E6%B4%BB%E4%B8%AD%E7%9A%84%E4%BE%8B%E5%AD%90%E8%AF%B4%E6%98%8E%E4%B8%8B%E5%90%97%EF%BC%9F"><span class="toc-text">èƒ½ç”¨ä¸€ä¸ªç”Ÿæ´»ä¸­çš„ä¾‹å­è¯´æ˜Žä¸‹å—ï¼Ÿ</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#56-%F0%9F%8C%9F%E7%BA%BF%E7%A8%8B%E6%B1%A0%E7%9A%84%E4%B8%BB%E8%A6%81%E5%8F%82%E6%95%B0%E6%9C%89%E5%93%AA%E4%BA%9B%EF%BC%9F"><span class="toc-text">56.ðŸŒŸçº¿ç¨‹æ± çš„ä¸»è¦å‚æ•°æœ‰å“ªäº›ï¼Ÿ</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E8%83%BD%E7%AE%80%E5%8D%95%E8%AF%B4%E4%B8%80%E4%B8%8B%E5%8F%82%E6%95%B0%E4%B9%8B%E9%97%B4%E7%9A%84%E5%85%B3%E7%B3%BB%E5%90%97%EF%BC%9F"><span class="toc-text">èƒ½ç®€å•è¯´ä¸€ä¸‹å‚æ•°ä¹‹é—´çš„å…³ç³»å—ï¼Ÿ</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%A0%B8%E5%BF%83%E7%BA%BF%E7%A8%8B%E6%95%B0%E4%B8%8D%E5%A4%9F%E4%BC%9A%E6%80%8E%E4%B9%88%E8%BF%9B%E8%A1%8C%E5%A4%84%E7%90%86%EF%BC%9F"><span class="toc-text">æ ¸å¿ƒçº¿ç¨‹æ•°ä¸å¤Ÿä¼šæ€Žä¹ˆè¿›è¡Œå¤„ç†ï¼Ÿ</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E4%B8%BE%E4%B8%AA%E4%BE%8B%E5%AD%90%E8%AF%B4%E4%B8%80%E4%B8%8B%E8%BF%99%E4%BA%9B%E5%8F%82%E6%95%B0%E7%9A%84%E5%8F%98%E5%8C%96%EF%BC%9F"><span class="toc-text">ä¸¾ä¸ªä¾‹å­è¯´ä¸€ä¸‹è¿™äº›å‚æ•°çš„å˜åŒ–ï¼Ÿ</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#57-%F0%9F%8C%9F%E7%BA%BF%E7%A8%8B%E6%B1%A0%E7%9A%84%E6%8B%92%E7%BB%9D%E7%AD%96%E7%95%A5%E6%9C%89%E5%93%AA%E4%BA%9B%EF%BC%9F"><span class="toc-text">57.ðŸŒŸçº¿ç¨‹æ± çš„æ‹’ç»ç­–ç•¥æœ‰å“ªäº›ï¼Ÿ</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#67-%F0%9F%8C%9F%E7%BA%BF%E7%A8%8B%E6%B1%A0%E8%B0%83%E4%BC%98%E4%BA%86%E8%A7%A3%E5%90%97%EF%BC%9F%EF%BC%88%E8%A1%A5%E5%85%85%EF%BC%89"><span class="toc-text">67.ðŸŒŸçº¿ç¨‹æ± è°ƒä¼˜äº†è§£å—ï¼Ÿï¼ˆè¡¥å……ï¼‰</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#69-%F0%9F%8C%9F%E4%BD%A0%E8%83%BD%E8%AE%BE%E8%AE%A1%E5%AE%9E%E7%8E%B0%E4%B8%80%E4%B8%AA%E7%BA%BF%E7%A8%8B%E6%B1%A0%E5%90%97%EF%BC%9F"><span class="toc-text">69.ðŸŒŸä½ èƒ½è®¾è®¡å®žçŽ°ä¸€ä¸ªçº¿ç¨‹æ± å—ï¼Ÿ</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%89%8B%E5%86%99%E4%B8%80%E4%B8%AA%E6%95%B0%E6%8D%AE%E5%BA%93%E8%BF%9E%E6%8E%A5%E6%B1%A0%EF%BC%8C%E5%8F%AF%E4%BB%A5%E5%90%97%EF%BC%9F"><span class="toc-text">æ‰‹å†™ä¸€ä¸ªæ•°æ®åº“è¿žæŽ¥æ± ï¼Œå¯ä»¥å—ï¼Ÿ</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#JVM"><span class="toc-text">JVM</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#3-%F0%9F%8C%9F%E8%83%BD%E8%AF%B4%E4%B8%80%E4%B8%8B-JVM-%E7%9A%84%E5%86%85%E5%AD%98%E5%8C%BA%E5%9F%9F%E5%90%97%EF%BC%9F"><span class="toc-text">3.ðŸŒŸèƒ½è¯´ä¸€ä¸‹ JVM çš„å†…å­˜åŒºåŸŸå—ï¼Ÿ</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E4%BB%8B%E7%BB%8D%E4%B8%80%E4%B8%8B%E7%A8%8B%E5%BA%8F%E8%AE%A1%E6%95%B0%E5%99%A8%EF%BC%9F"><span class="toc-text">ä»‹ç»ä¸€ä¸‹ç¨‹åºè®¡æ•°å™¨ï¼Ÿ</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E4%BB%8B%E7%BB%8D%E4%B8%80%E4%B8%8B-Java-%E8%99%9A%E6%8B%9F%E6%9C%BA%E6%A0%88%EF%BC%9F"><span class="toc-text">ä»‹ç»ä¸€ä¸‹ Java è™šæ‹Ÿæœºæ ˆï¼Ÿ</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E4%B8%80%E4%B8%AA%E4%BB%80%E4%B9%88%E9%83%BD%E6%B2%A1%E6%9C%89%E7%9A%84%E7%A9%BA%E6%96%B9%E6%B3%95%EF%BC%8C%E7%A9%BA%E7%9A%84%E5%8F%82%E6%95%B0%E9%83%BD%E6%B2%A1%E6%9C%89%EF%BC%8C%E9%82%A3%E5%B1%80%E9%83%A8%E5%8F%98%E9%87%8F%E8%A1%A8%E9%87%8C%E6%9C%89%E6%B2%A1%E6%9C%89%E5%8F%98%E9%87%8F%EF%BC%9F"><span class="toc-text">ä¸€ä¸ªä»€ä¹ˆéƒ½æ²¡æœ‰çš„ç©ºæ–¹æ³•ï¼Œç©ºçš„å‚æ•°éƒ½æ²¡æœ‰ï¼Œé‚£å±€éƒ¨å˜é‡è¡¨é‡Œæœ‰æ²¡æœ‰å˜é‡ï¼Ÿ</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E4%BB%8B%E7%BB%8D%E4%B8%80%E4%B8%8B%E6%9C%AC%E5%9C%B0%E6%96%B9%E6%B3%95%E6%A0%88%EF%BC%9F"><span class="toc-text">ä»‹ç»ä¸€ä¸‹æœ¬åœ°æ–¹æ³•æ ˆï¼Ÿ</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E4%BB%8B%E7%BB%8D%E4%B8%80%E4%B8%8B%E6%9C%AC%E5%9C%B0%E6%96%B9%E6%B3%95%E6%A0%88%E7%9A%84%E8%BF%90%E8%A1%8C%E5%9C%BA%E6%99%AF%EF%BC%9F"><span class="toc-text">ä»‹ç»ä¸€ä¸‹æœ¬åœ°æ–¹æ³•æ ˆçš„è¿è¡Œåœºæ™¯ï¼Ÿ</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#native-%E6%96%B9%E6%B3%95%E8%A7%A3%E9%87%8A%E4%B8%80%E4%B8%8B%EF%BC%9F"><span class="toc-text">native æ–¹æ³•è§£é‡Šä¸€ä¸‹ï¼Ÿ</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E4%BB%8B%E7%BB%8D%E4%B8%80%E4%B8%8B-Java-%E5%A0%86%EF%BC%9F"><span class="toc-text">ä»‹ç»ä¸€ä¸‹ Java å †ï¼Ÿ</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%A0%86%E5%92%8C%E6%A0%88%E7%9A%84%E5%8C%BA%E5%88%AB%E6%98%AF%E4%BB%80%E4%B9%88%EF%BC%9F"><span class="toc-text">å †å’Œæ ˆçš„åŒºåˆ«æ˜¯ä»€ä¹ˆï¼Ÿ</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E4%BB%8B%E7%BB%8D%E4%B8%80%E4%B8%8B%E6%96%B9%E6%B3%95%E5%8C%BA%EF%BC%9F"><span class="toc-text">ä»‹ç»ä¸€ä¸‹æ–¹æ³•åŒºï¼Ÿ</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%8F%98%E9%87%8F%E5%AD%98%E5%9C%A8%E5%A0%86%E6%A0%88%E7%9A%84%E4%BB%80%E4%B9%88%E4%BD%8D%E7%BD%AE%EF%BC%9F"><span class="toc-text">å˜é‡å­˜åœ¨å †æ ˆçš„ä»€ä¹ˆä½ç½®ï¼Ÿ</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#6-%F0%9F%8C%9F%E5%AF%B9%E8%B1%A1%E5%88%9B%E5%BB%BA%E7%9A%84%E8%BF%87%E7%A8%8B%E4%BA%86%E8%A7%A3%E5%90%97%EF%BC%9F"><span class="toc-text">6.ðŸŒŸå¯¹è±¡åˆ›å»ºçš„è¿‡ç¨‹äº†è§£å—ï¼Ÿ</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%AF%B9%E8%B1%A1%E7%9A%84%E9%94%80%E6%AF%81%E8%BF%87%E7%A8%8B%E4%BA%86%E8%A7%A3%E5%90%97%EF%BC%9F"><span class="toc-text">å¯¹è±¡çš„é”€æ¯è¿‡ç¨‹äº†è§£å—ï¼Ÿ</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#14-%F0%9F%8C%9F%E5%AF%B9%E8%B1%A1%E4%BB%80%E4%B9%88%E6%97%B6%E5%80%99%E4%BC%9A%E8%BF%9B%E5%85%A5%E8%80%81%E5%B9%B4%E4%BB%A3%EF%BC%9F"><span class="toc-text">14.ðŸŒŸå¯¹è±¡ä»€ä¹ˆæ—¶å€™ä¼šè¿›å…¥è€å¹´ä»£ï¼Ÿ</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E9%95%BF%E6%9C%9F%E5%AD%98%E6%B4%BB%E7%9A%84%E5%AF%B9%E8%B1%A1%E5%A6%82%E4%BD%95%E5%88%A4%E6%96%AD%EF%BC%9F"><span class="toc-text">é•¿æœŸå­˜æ´»çš„å¯¹è±¡å¦‚ä½•åˆ¤æ–­ï¼Ÿ</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%A4%A7%E5%AF%B9%E8%B1%A1%E5%A6%82%E4%BD%95%E5%88%A4%E6%96%AD%EF%BC%9F"><span class="toc-text">å¤§å¯¹è±¡å¦‚ä½•åˆ¤æ–­ï¼Ÿ</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%8A%A8%E6%80%81%E5%B9%B4%E9%BE%84%E5%88%A4%E5%AE%9A%E4%BA%86%E8%A7%A3%E5%90%97%EF%BC%9F"><span class="toc-text">åŠ¨æ€å¹´é¾„åˆ¤å®šäº†è§£å—ï¼Ÿ</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#23-%F0%9F%8C%9F%E8%AE%B2%E8%AE%B2-JVM-%E7%9A%84%E5%9E%83%E5%9C%BE%E5%9B%9E%E6%94%B6%E6%9C%BA%E5%88%B6%EF%BC%88%E8%A1%A5%E5%85%85%EF%BC%89"><span class="toc-text">23.ðŸŒŸè®²è®² JVM çš„åžƒåœ¾å›žæ”¶æœºåˆ¶ï¼ˆè¡¥å……ï¼‰</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%9E%83%E5%9C%BE%E5%9B%9E%E6%94%B6%E7%9A%84%E8%BF%87%E7%A8%8B%E6%98%AF%E4%BB%80%E4%B9%88%EF%BC%9F"><span class="toc-text">åžƒåœ¾å›žæ”¶çš„è¿‡ç¨‹æ˜¯ä»€ä¹ˆï¼Ÿ</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#24-%F0%9F%8C%9F%E5%A6%82%E4%BD%95%E5%88%A4%E6%96%AD%E5%AF%B9%E8%B1%A1%E4%BB%8D%E7%84%B6%E5%AD%98%E6%B4%BB%EF%BC%9F"><span class="toc-text">24.ðŸŒŸå¦‚ä½•åˆ¤æ–­å¯¹è±¡ä»ç„¶å­˜æ´»ï¼Ÿ</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E4%BB%80%E4%B9%88%E6%98%AF%E5%BC%95%E7%94%A8%E8%AE%A1%E6%95%B0%E6%B3%95%EF%BC%9F"><span class="toc-text">ä»€ä¹ˆæ˜¯å¼•ç”¨è®¡æ•°æ³•ï¼Ÿ</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%81%9A%E5%8F%AF%E8%BE%BE%E6%80%A7%E5%88%86%E6%9E%90%E7%9A%84%E6%97%B6%E5%80%99%EF%BC%8C%E5%BA%94%E8%AF%A5%E6%9C%89%E5%93%AA%E4%BA%9B%E5%89%8D%E7%BD%AE%E6%80%A7%E7%9A%84%E6%93%8D%E4%BD%9C%EF%BC%9F"><span class="toc-text">åšå¯è¾¾æ€§åˆ†æžçš„æ—¶å€™ï¼Œåº”è¯¥æœ‰å“ªäº›å‰ç½®æ€§çš„æ“ä½œï¼Ÿ</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#27-%F0%9F%8C%9F%E5%9E%83%E5%9C%BE%E6%94%B6%E9%9B%86%E7%AE%97%E6%B3%95%E4%BA%86%E8%A7%A3%E5%90%97%EF%BC%9F"><span class="toc-text">27.ðŸŒŸåžƒåœ¾æ”¶é›†ç®—æ³•äº†è§£å—ï¼Ÿ</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E8%AF%B4%E8%AF%B4%E6%A0%87%E8%AE%B0-%E6%B8%85%E9%99%A4%E7%AE%97%E6%B3%95%EF%BC%9F"><span class="toc-text">è¯´è¯´æ ‡è®°-æ¸…é™¤ç®—æ³•ï¼Ÿ</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E8%AF%B4%E8%AF%B4%E6%A0%87%E8%AE%B0-%E5%A4%8D%E5%88%B6%E7%AE%97%E6%B3%95%EF%BC%9F"><span class="toc-text">è¯´è¯´æ ‡è®°-å¤åˆ¶ç®—æ³•ï¼Ÿ</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E8%AF%B4%E8%AF%B4%E6%A0%87%E8%AE%B0-%E6%95%B4%E7%90%86%E7%AE%97%E6%B3%95%EF%BC%9F"><span class="toc-text">è¯´è¯´æ ‡è®°-æ•´ç†ç®—æ³•ï¼Ÿ</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E8%AF%B4%E8%AF%B4%E5%88%86%E4%BB%A3%E6%94%B6%E9%9B%86%E7%AE%97%E6%B3%95%EF%BC%9F"><span class="toc-text">è¯´è¯´åˆ†ä»£æ”¶é›†ç®—æ³•ï¼Ÿ</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E4%B8%BA%E4%BB%80%E4%B9%88%E8%A6%81%E7%94%A8%E5%88%86%E4%BB%A3%E6%94%B6%E9%9B%86%E5%91%A2%EF%BC%9F"><span class="toc-text">ä¸ºä»€ä¹ˆè¦ç”¨åˆ†ä»£æ”¶é›†å‘¢ï¼Ÿ</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%A0%87%E8%AE%B0%E5%A4%8D%E5%88%B6%E7%9A%84%E6%A0%87%E8%AE%B0%E8%BF%87%E7%A8%8B%E5%92%8C%E5%A4%8D%E5%88%B6%E8%BF%87%E7%A8%8B%E4%BC%9A%E4%B8%8D%E4%BC%9A%E5%81%9C%E9%A1%BF%EF%BC%9F"><span class="toc-text">æ ‡è®°å¤åˆ¶çš„æ ‡è®°è¿‡ç¨‹å’Œå¤åˆ¶è¿‡ç¨‹ä¼šä¸ä¼šåœé¡¿ï¼Ÿ</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#31-%F0%9F%8C%9F%E7%9F%A5%E9%81%93%E5%93%AA%E4%BA%9B%E5%9E%83%E5%9C%BE%E6%94%B6%E9%9B%86%E5%99%A8%EF%BC%9F"><span class="toc-text">31.ðŸŒŸçŸ¥é“å“ªäº›åžƒåœ¾æ”¶é›†å™¨ï¼Ÿ</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E8%AF%B4%E8%AF%B4-Serial-%E6%94%B6%E9%9B%86%E5%99%A8%EF%BC%9F"><span class="toc-text">è¯´è¯´ Serial æ”¶é›†å™¨ï¼Ÿ</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E8%AF%B4%E8%AF%B4-ParNew-%E6%94%B6%E9%9B%86%E5%99%A8%EF%BC%9F"><span class="toc-text">è¯´è¯´ ParNew æ”¶é›†å™¨ï¼Ÿ</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E8%AF%B4%E8%AF%B4-Parallel-Scavenge-%E6%94%B6%E9%9B%86%E5%99%A8%EF%BC%9F"><span class="toc-text">è¯´è¯´ Parallel Scavenge æ”¶é›†å™¨ï¼Ÿ</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E8%AF%B4%E8%AF%B4-Serial-Old-%E6%94%B6%E9%9B%86%E5%99%A8%EF%BC%9F"><span class="toc-text">è¯´è¯´ Serial Old æ”¶é›†å™¨ï¼Ÿ</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E8%AF%B4%E8%AF%B4-Parallel-Old-%E6%94%B6%E9%9B%86%E5%99%A8%EF%BC%9F"><span class="toc-text">è¯´è¯´ Parallel Old æ”¶é›†å™¨ï¼Ÿ</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E8%AF%B4%E8%AF%B4-CMS-%E6%94%B6%E9%9B%86%E5%99%A8%EF%BC%9F"><span class="toc-text">è¯´è¯´ CMS æ”¶é›†å™¨ï¼Ÿ</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E8%AF%B4%E8%AF%B4-G1-%E6%94%B6%E9%9B%86%E5%99%A8%EF%BC%9F"><span class="toc-text">è¯´è¯´ G1 æ”¶é›†å™¨ï¼Ÿ</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E8%AF%B4%E8%AF%B4-ZGC-%E6%94%B6%E9%9B%86%E5%99%A8%EF%BC%9F"><span class="toc-text">è¯´è¯´ ZGC æ”¶é›†å™¨ï¼Ÿ</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%9E%83%E5%9C%BE%E5%9B%9E%E6%94%B6%E5%99%A8%E7%9A%84%E4%BD%9C%E7%94%A8%E6%98%AF%E4%BB%80%E4%B9%88%EF%BC%9F"><span class="toc-text">åžƒåœ¾å›žæ”¶å™¨çš„ä½œç”¨æ˜¯ä»€ä¹ˆï¼Ÿ</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#32-%F0%9F%8C%9F%E8%83%BD%E8%AF%A6%E7%BB%86%E8%AF%B4%E4%B8%80%E4%B8%8B-CMS-%E7%9A%84%E5%9E%83%E5%9C%BE%E6%94%B6%E9%9B%86%E8%BF%87%E7%A8%8B%E5%90%97%EF%BC%9F"><span class="toc-text">32.ðŸŒŸèƒ½è¯¦ç»†è¯´ä¸€ä¸‹ CMS çš„åžƒåœ¾æ”¶é›†è¿‡ç¨‹å—ï¼Ÿ</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E4%BD%A0%E6%8F%90%E5%88%B0%E4%BA%86remark%EF%BC%8C%E9%82%A3%E5%AE%83remark%E5%85%B7%E4%BD%93%E6%98%AF%E6%80%8E%E4%B9%88%E6%89%A7%E8%A1%8C%E7%9A%84%EF%BC%9F%E4%B8%89%E8%89%B2%E6%A0%87%E8%AE%B0%E6%B3%95%EF%BC%9F"><span class="toc-text">ä½ æåˆ°äº†remarkï¼Œé‚£å®ƒremarkå…·ä½“æ˜¯æ€Žä¹ˆæ‰§è¡Œçš„ï¼Ÿä¸‰è‰²æ ‡è®°æ³•ï¼Ÿ</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E4%BB%80%E4%B9%88%E6%98%AF%E4%B8%89%E8%89%B2%E6%A0%87%E8%AE%B0%E6%B3%95%EF%BC%9F"><span class="toc-text">ä»€ä¹ˆæ˜¯ä¸‰è‰²æ ‡è®°æ³•ï¼Ÿ</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#33-%F0%9F%8C%9FG1-%E5%9E%83%E5%9C%BE%E6%94%B6%E9%9B%86%E5%99%A8%E4%BA%86%E8%A7%A3%E5%90%97%EF%BC%9F"><span class="toc-text">33.ðŸŒŸG1 åžƒåœ¾æ”¶é›†å™¨äº†è§£å—ï¼Ÿ</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#45-%F0%9F%8C%9F%E4%BA%86%E8%A7%A3%E7%B1%BB%E7%9A%84%E5%8A%A0%E8%BD%BD%E6%9C%BA%E5%88%B6%E5%90%97%EF%BC%9F%EF%BC%88%E8%A1%A5%E5%85%85%EF%BC%89"><span class="toc-text">45.ðŸŒŸäº†è§£ç±»çš„åŠ è½½æœºåˆ¶å—ï¼Ÿï¼ˆè¡¥å……ï¼‰</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#48-%F0%9F%8C%9F%E7%B1%BB%E8%A3%85%E8%BD%BD%E7%9A%84%E8%BF%87%E7%A8%8B%E7%9F%A5%E9%81%93%E5%90%97%EF%BC%9F"><span class="toc-text">48.ðŸŒŸç±»è£…è½½çš„è¿‡ç¨‹çŸ¥é“å—ï¼Ÿ</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E8%BD%BD%E5%85%A5%E8%BF%87%E7%A8%8B-JVM-%E4%BC%9A%E5%81%9A%E4%BB%80%E4%B9%88%EF%BC%9F"><span class="toc-text">è½½å…¥è¿‡ç¨‹ JVM ä¼šåšä»€ä¹ˆï¼Ÿ</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#49-%F0%9F%8C%9F%E4%BB%80%E4%B9%88%E6%98%AF%E5%8F%8C%E4%BA%B2%E5%A7%94%E6%B4%BE%E6%A8%A1%E5%9E%8B%EF%BC%9F"><span class="toc-text">49.ðŸŒŸä»€ä¹ˆæ˜¯åŒäº²å§”æ´¾æ¨¡åž‹ï¼Ÿ</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#MySQL"><span class="toc-text">MySQL</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%F0%9F%8C%9F0-%E4%BB%80%E4%B9%88%E6%98%AFMYSQL"><span class="toc-text">ðŸŒŸ0.ä»€ä¹ˆæ˜¯MYSQL</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%88%A0%E9%99%A4-%E5%88%9B%E5%BB%BA%E4%B8%80%E5%BC%A0%E8%A1%A8"><span class="toc-text">åˆ é™¤&#x2F;åˆ›å»ºä¸€å¼ è¡¨</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%86%99%E4%B8%80%E4%B8%AA%E5%8D%87%E5%BA%8F-%E9%99%8D%E5%BA%8F%E7%9A%84SQL%E8%AF%AD%E5%8F%A5"><span class="toc-text">å†™ä¸€ä¸ªå‡åº&#x2F;é™åºçš„SQLè¯­å¥</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#MYSQL%E5%87%BA%E7%8E%B0%E6%80%A7%E8%83%BD%E5%B7%AE%E7%9A%84%E5%8E%9F%E5%9B%A0"><span class="toc-text">MYSQLå‡ºçŽ°æ€§èƒ½å·®çš„åŽŸå› </span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#9-%F0%9F%8C%9F%E5%A6%82%E4%BD%95%E5%AD%98%E5%82%A8emoji"><span class="toc-text">9.ðŸŒŸå¦‚ä½•å­˜å‚¨emoji?</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#21-%F0%9F%8C%9F%E4%B8%80%E6%9D%A1%E6%9F%A5%E8%AF%A2%E8%AF%AD%E5%8F%A5SELECT%E6%98%AF%E5%A6%82%E4%BD%95%E6%89%A7%E8%A1%8C%E7%9A%84%EF%BC%9F"><span class="toc-text">21.ðŸŒŸä¸€æ¡æŸ¥è¯¢è¯­å¥SELECTæ˜¯å¦‚ä½•æ‰§è¡Œçš„ï¼Ÿ</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#24-%F0%9F%8C%9FMySQL-%E6%9C%89%E5%93%AA%E4%BA%9B%E5%B8%B8%E8%A7%81%E5%AD%98%E5%82%A8%E5%BC%95%E6%93%8E%EF%BC%9F"><span class="toc-text">24.ðŸŒŸMySQL æœ‰å“ªäº›å¸¸è§å­˜å‚¨å¼•æ“Žï¼Ÿ</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#28-%F0%9F%8C%9FMySQL-%E6%97%A5%E5%BF%97%E6%96%87%E4%BB%B6%E6%9C%89%E5%93%AA%E4%BA%9B%EF%BC%9F"><span class="toc-text">28.ðŸŒŸMySQL æ—¥å¿—æ–‡ä»¶æœ‰å“ªäº›ï¼Ÿ</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E8%AF%B7%E9%87%8D%E7%82%B9%E8%AF%B4%E8%AF%B4-binlog%EF%BC%9F"><span class="toc-text">è¯·é‡ç‚¹è¯´è¯´ binlogï¼Ÿ</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#binlog-%E7%9A%84%E9%85%8D%E7%BD%AE%E5%8F%82%E6%95%B0%E9%83%BD%E4%BA%86%E8%A7%A3%E5%93%AA%E4%BA%9B%EF%BC%9F"><span class="toc-text">binlog çš„é…ç½®å‚æ•°éƒ½äº†è§£å“ªäº›ï¼Ÿ</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%9C%89%E4%BA%86binlog%E4%B8%BA%E4%BB%80%E4%B9%88%E8%BF%98%E8%A6%81undolog-redolog%EF%BC%9F"><span class="toc-text">æœ‰äº†binlogä¸ºä»€ä¹ˆè¿˜è¦undolog redologï¼Ÿ</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E8%AF%A6%E7%BB%86%E6%8E%A2%E7%A9%B6%E4%B8%80%E4%B8%8Bbinlog-%E9%95%BF%E6%96%87%E8%AD%A6%E5%91%8A%E2%9A%A0%EF%B8%8F"><span class="toc-text">è¯¦ç»†æŽ¢ç©¶ä¸€ä¸‹binlog(é•¿æ–‡è­¦å‘Šâš ï¸):</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#Binlog-%E7%9A%84%E4%B8%BB%E8%A6%81%E4%BD%9C%E7%94%A8%E6%9C%89%E4%B8%A4%E4%B8%AA%EF%BC%9A"><span class="toc-text">Binlog çš„ä¸»è¦ä½œç”¨æœ‰ä¸¤ä¸ªï¼š</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#Binlog-%E6%97%A5%E5%BF%97%E6%A0%BC%E5%BC%8F"><span class="toc-text">Binlog æ—¥å¿—æ ¼å¼:</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E5%A6%82%E4%BD%95%E9%80%9A%E8%BF%87-mysqlbinlog-%E5%91%BD%E4%BB%A4%E6%89%8B%E5%8A%A8%E6%81%A2%E5%A4%8D%E6%95%B0%E6%8D%AE"><span class="toc-text">å¦‚ä½•é€šè¿‡ mysqlbinlog å‘½ä»¤æ‰‹åŠ¨æ¢å¤æ•°æ®</span></a></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E8%AF%B4%E8%AF%B4-redo-log-%E7%9A%84%E5%B7%A5%E4%BD%9C%E6%9C%BA%E5%88%B6%EF%BC%9F"><span class="toc-text">è¯´è¯´ redo log çš„å·¥ä½œæœºåˆ¶ï¼Ÿ</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#redo-log-%E6%96%87%E4%BB%B6%E7%9A%84%E5%A4%A7%E5%B0%8F%E6%98%AF%E5%9B%BA%E5%AE%9A%E7%9A%84%E5%90%97%EF%BC%9F"><span class="toc-text">redo log æ–‡ä»¶çš„å¤§å°æ˜¯å›ºå®šçš„å—ï¼Ÿ</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E8%AF%B4%E4%B8%80%E8%AF%B4WAL"><span class="toc-text">è¯´ä¸€è¯´WAL?</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#30-%F0%9F%8C%9F%E4%B8%BA%E4%BB%80%E4%B9%88%E8%A6%81%E4%B8%A4%E9%98%B6%E6%AE%B5%E6%8F%90%E4%BA%A4"><span class="toc-text">30.ðŸŒŸä¸ºä»€ä¹ˆè¦ä¸¤é˜¶æ®µæäº¤?</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E4%B8%BA%E4%BB%80%E4%B9%88-2PC-%E8%83%BD%E4%BF%9D%E8%AF%81-redo-log-%E5%92%8C-binlog-%E7%9A%84%E5%BC%BA%E2%BC%80%E8%87%B4%E6%80%A7%EF%BC%9F"><span class="toc-text">ä¸ºä»€ä¹ˆ 2PC èƒ½ä¿è¯ redo log å’Œ binlog çš„å¼ºâ¼€è‡´æ€§ï¼Ÿ</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#XID-%E4%BA%86%E8%A7%A3%E5%90%97%EF%BC%9F"><span class="toc-text">XID äº†è§£å—ï¼Ÿ</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#31-%F0%9F%8C%9Fredo-log-%E7%9A%84%E5%86%99%E5%85%A5%E8%BF%87%E7%A8%8B%E4%BA%86%E8%A7%A3%E5%90%97%EF%BC%9F"><span class="toc-text">31.ðŸŒŸredo log çš„å†™å…¥è¿‡ç¨‹äº†è§£å—ï¼Ÿ</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%93%AA%E4%BA%9B%E5%9C%BA%E6%99%AF%E4%BC%9A%E8%A7%A6%E5%8F%91-redo-log-%E7%9A%84%E5%88%B7%E7%9B%98%E5%8A%A8%E4%BD%9C%EF%BC%9F"><span class="toc-text">å“ªäº›åœºæ™¯ä¼šè§¦å‘ redo log çš„åˆ·ç›˜åŠ¨ä½œï¼Ÿ</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#innodb-flush-log-at-trx-commit-%E5%8F%82%E6%95%B0%E4%BD%A0%E4%BA%86%E8%A7%A3%E5%A4%9A%E5%B0%91%EF%BC%9F"><span class="toc-text">innodb_flush_log_at_trx_commit å‚æ•°ä½ äº†è§£å¤šå°‘ï¼Ÿ</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E4%B8%80%E4%B8%AA%E6%B2%A1%E6%9C%89%E6%8F%90%E4%BA%A4%E4%BA%8B%E5%8A%A1%E7%9A%84-redo-log%EF%BC%8C%E4%BC%9A%E4%B8%8D%E4%BC%9A%E5%88%B7%E7%9B%98%EF%BC%9F"><span class="toc-text">ä¸€ä¸ªæ²¡æœ‰æäº¤äº‹åŠ¡çš„ redo logï¼Œä¼šä¸ä¼šåˆ·ç›˜ï¼Ÿ</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Redo-Log-Buffer-%E6%98%AF%E9%A1%BA%E5%BA%8F%E5%86%99%E8%BF%98%E6%98%AF%E9%9A%8F%E6%9C%BA%E5%86%99%EF%BC%9F"><span class="toc-text">Redo Log Buffer æ˜¯é¡ºåºå†™è¿˜æ˜¯éšæœºå†™ï¼Ÿ</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#buf-next-to-write-%E4%BA%86%E8%A7%A3%E5%90%97%EF%BC%9F"><span class="toc-text">buf_next_to_write äº†è§£å—ï¼Ÿ</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E4%BA%86%E8%A7%A3-MTR-%E5%90%97%EF%BC%9F"><span class="toc-text">äº†è§£ MTR å—ï¼Ÿ</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Redo-Log-Block-%E7%9A%84%E7%BB%93%E6%9E%84%E4%BA%86%E8%A7%A3%E5%90%97%EF%BC%9F"><span class="toc-text">Redo Log Block çš„ç»“æž„äº†è§£å—ï¼Ÿ</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Redo-Log-Block-%E4%B8%BA%E4%BB%80%E4%B9%88%E8%AE%BE%E8%AE%A1%E6%88%90-512-%E5%AD%97%E8%8A%82%EF%BC%9F"><span class="toc-text">Redo Log Block ä¸ºä»€ä¹ˆè®¾è®¡æˆ 512 å­—èŠ‚ï¼Ÿ</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#LSN-%E4%BA%86%E8%A7%A3%E5%90%97%EF%BC%9F"><span class="toc-text">LSN äº†è§£å—ï¼Ÿ</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Checkpoint-%E4%BA%86%E8%A7%A3%E5%A4%9A%E5%B0%91%EF%BC%9F"><span class="toc-text">Checkpoint äº†è§£å¤šå°‘ï¼Ÿ</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%85%B3%E4%BA%8Eredo-log-%E7%9A%84%E8%B0%83%E4%BC%98%E5%8F%82%E6%95%B0%E4%BA%86%E8%A7%A3%E5%A4%9A%E5%B0%91%EF%BC%9F"><span class="toc-text">å…³äºŽredo log çš„è°ƒä¼˜å‚æ•°äº†è§£å¤šå°‘ï¼Ÿ</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%80%BB%E7%BB%93"><span class="toc-text">æ€»ç»“</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%F0%9F%8C%9F32-%E4%BB%80%E4%B9%88%E6%98%AF%E6%85%A2-SQL%EF%BC%9F"><span class="toc-text">ðŸŒŸ32.ä»€ä¹ˆæ˜¯æ…¢ SQLï¼Ÿ</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#SQL-%E7%9A%84%E6%89%A7%E8%A1%8C%E8%BF%87%E7%A8%8B%E4%BA%86%E8%A7%A3%E5%90%97%EF%BC%9F"><span class="toc-text">SQL çš„æ‰§è¡Œè¿‡ç¨‹äº†è§£å—ï¼Ÿ</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%A6%82%E4%BD%95%E4%BC%98%E5%8C%96%E6%85%A2SQL"><span class="toc-text">å¦‚ä½•ä¼˜åŒ–æ…¢SQL?</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%85%A2sql%E6%97%A5%E5%BF%97%E6%80%8E%E4%B9%88%E5%BC%80%E5%90%AF%EF%BC%9F"><span class="toc-text">æ…¢sqlæ—¥å¿—æ€Žä¹ˆå¼€å¯ï¼Ÿ</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%F0%9F%8C%9F33-%E4%BD%A0%E7%9F%A5%E9%81%93%E5%93%AA%E4%BA%9B%E6%96%B9%E6%B3%95%E6%9D%A5%E4%BC%98%E5%8C%96-SQL%EF%BC%9F"><span class="toc-text">ðŸŒŸ33.ä½ çŸ¥é“å“ªäº›æ–¹æ³•æ¥ä¼˜åŒ– SQLï¼Ÿ</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%A6%82%E4%BD%95%E5%88%A9%E7%94%A8%E8%A6%86%E7%9B%96%E7%B4%A2%E5%BC%95%EF%BC%9F"><span class="toc-text">å¦‚ä½•åˆ©ç”¨è¦†ç›–ç´¢å¼•ï¼Ÿ</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%A6%82%E4%BD%95%E6%AD%A3%E7%A1%AE%E4%BD%BF%E7%94%A8%E8%81%94%E5%90%88%E7%B4%A2%E5%BC%95%EF%BC%9F"><span class="toc-text">å¦‚ä½•æ­£ç¡®ä½¿ç”¨è”åˆç´¢å¼•ï¼Ÿ</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%A6%82%E4%BD%95%E8%BF%9B%E8%A1%8C%E5%88%86%E9%A1%B5%E4%BC%98%E5%8C%96%EF%BC%9F"><span class="toc-text">å¦‚ä½•è¿›è¡Œåˆ†é¡µä¼˜åŒ–ï¼Ÿ</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E4%B8%BA%E4%BB%80%E4%B9%88%E5%88%86%E9%A1%B5%E4%BC%9A%E5%8F%98%E6%85%A2%EF%BC%9F"><span class="toc-text">ä¸ºä»€ä¹ˆåˆ†é¡µä¼šå˜æ…¢ï¼Ÿ</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#JOIN-%E4%BB%A3%E6%9B%BF%E5%AD%90%E6%9F%A5%E8%AF%A2%E6%9C%89%E4%BB%80%E4%B9%88%E5%A5%BD%E5%A4%84%EF%BC%9F"><span class="toc-text">JOIN ä»£æ›¿å­æŸ¥è¯¢æœ‰ä»€ä¹ˆå¥½å¤„ï¼Ÿ</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#JOIN%E6%93%8D%E4%BD%9C%E4%B8%BA%E4%BB%80%E4%B9%88%E8%A6%81%E5%B0%8F%E8%A1%A8%E9%A9%B1%E5%8A%A8%E5%A4%A7%E8%A1%A8%EF%BC%9F"><span class="toc-text">JOINæ“ä½œä¸ºä»€ä¹ˆè¦å°è¡¨é©±åŠ¨å¤§è¡¨ï¼Ÿ</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E4%B8%BA%E4%BB%80%E4%B9%88%E8%A6%81%E9%81%BF%E5%85%8D%E4%BD%BF%E7%94%A8-JOIN-%E5%85%B3%E8%81%94%E5%A4%AA%E5%A4%9A%E7%9A%84%E8%A1%A8%EF%BC%9F"><span class="toc-text">ä¸ºä»€ä¹ˆè¦é¿å…ä½¿ç”¨ JOIN å…³è”å¤ªå¤šçš„è¡¨ï¼Ÿ</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%A6%82%E4%BD%95%E8%BF%9B%E8%A1%8C%E6%8E%92%E5%BA%8F%E4%BC%98%E5%8C%96%EF%BC%9F"><span class="toc-text">å¦‚ä½•è¿›è¡ŒæŽ’åºä¼˜åŒ–ï¼Ÿ</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E4%BB%80%E4%B9%88%E6%98%AF-filesort%EF%BC%9F"><span class="toc-text">ä»€ä¹ˆæ˜¯ filesortï¼Ÿ</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%85%A8%E5%AD%97%E6%AE%B5%E6%8E%92%E5%BA%8F%E5%92%8C-rowid-%E6%8E%92%E5%BA%8F%E4%BA%86%E8%A7%A3%E5%A4%9A%E5%B0%91%EF%BC%9F"><span class="toc-text">å…¨å­—æ®µæŽ’åºå’Œ rowid æŽ’åºäº†è§£å¤šå°‘ï¼Ÿ</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E4%BD%A0%E5%AF%B9-Sort-merge-passes-%E5%8F%82%E6%95%B0%E4%BA%86%E8%A7%A3%E5%90%97%EF%BC%9F"><span class="toc-text">ä½ å¯¹ Sort_merge_passes å‚æ•°äº†è§£å—ï¼Ÿ</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%9D%A1%E4%BB%B6%E4%B8%8B%E6%8E%A8%E4%BD%A0%E4%BA%86%E8%A7%A3%E5%A4%9A%E5%B0%91%EF%BC%9F"><span class="toc-text">æ¡ä»¶ä¸‹æŽ¨ä½ äº†è§£å¤šå°‘ï¼Ÿ</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E4%B8%BA%E4%BB%80%E4%B9%88%E8%A6%81%E5%B0%BD%E9%87%8F%E9%81%BF%E5%85%8D%E4%BD%BF%E7%94%A8-select-%EF%BC%9F"><span class="toc-text">ä¸ºä»€ä¹ˆè¦å°½é‡é¿å…ä½¿ç”¨ select *ï¼Ÿ</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E4%BD%A0%E8%BF%98%E7%9F%A5%E9%81%93%E5%93%AA%E4%BA%9B-SQL-%E4%BC%98%E5%8C%96%E6%96%B9%E6%B3%95%EF%BC%9F"><span class="toc-text">ä½ è¿˜çŸ¥é“å“ªäº› SQL ä¼˜åŒ–æ–¹æ³•ï¼Ÿ</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#34-%F0%9F%8C%9Fexplain%E5%B9%B3%E5%B8%B8%E6%9C%89%E7%94%A8%E8%BF%87%E5%90%97%EF%BC%9F"><span class="toc-text">34.ðŸŒŸexplainå¹³å¸¸æœ‰ç”¨è¿‡å—ï¼Ÿ</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#explain-%E8%BE%93%E5%87%BA%E7%BB%93%E6%9E%9C%E4%B8%AD%E5%B8%B8%E8%A7%81%E7%9A%84%E5%AD%97%E6%AE%B5%E5%90%AB%E4%B9%89%E7%90%86%E8%A7%A3%E5%90%97%EF%BC%9F"><span class="toc-text">explain è¾“å‡ºç»“æžœä¸­å¸¸è§çš„å­—æ®µå«ä¹‰ç†è§£å—ï¼Ÿ</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#type%E7%9A%84%E6%89%A7%E8%A1%8C%E6%95%88%E7%8E%87%E7%AD%89%E7%BA%A7%EF%BC%8C%E8%BE%BE%E5%88%B0%E4%BB%80%E4%B9%88%E7%BA%A7%E5%88%AB%E6%AF%94%E8%BE%83%E5%90%88%E9%80%82%EF%BC%9F"><span class="toc-text">typeçš„æ‰§è¡Œæ•ˆçŽ‡ç­‰çº§ï¼Œè¾¾åˆ°ä»€ä¹ˆçº§åˆ«æ¯”è¾ƒåˆé€‚ï¼Ÿ</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#35-%F0%9F%8C%9F%E7%B4%A2%E5%BC%95%E4%B8%BA%E4%BB%80%E4%B9%88%E8%83%BD%E6%8F%90%E9%AB%98MySQL%E6%9F%A5%E8%AF%A2%E6%95%88%E7%8E%87%EF%BC%9F"><span class="toc-text">35.ðŸŒŸç´¢å¼•ä¸ºä»€ä¹ˆèƒ½æé«˜MySQLæŸ¥è¯¢æ•ˆçŽ‡ï¼Ÿ</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#36-%F0%9F%8C%9F%E8%83%BD%E7%AE%80%E5%8D%95%E8%AF%B4%E4%B8%80%E4%B8%8B%E7%B4%A2%E5%BC%95%E7%9A%84%E5%88%86%E7%B1%BB%E5%90%97%EF%BC%9F"><span class="toc-text">36.ðŸŒŸèƒ½ç®€å•è¯´ä¸€ä¸‹ç´¢å¼•çš„åˆ†ç±»å—ï¼Ÿ</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E4%BD%A0%E5%AF%B9%E4%B8%BB%E9%94%AE%E7%B4%A2%E5%BC%95%E4%BA%86%E8%A7%A3%E5%A4%9A%E5%B0%91%EF%BC%9F"><span class="toc-text">ä½ å¯¹ä¸»é”®ç´¢å¼•äº†è§£å¤šå°‘ï¼Ÿ</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%94%AF%E4%B8%80%E7%B4%A2%E5%BC%95%E5%92%8C%E4%B8%BB%E9%94%AE%E7%B4%A2%E5%BC%95%E6%9C%89%E4%BB%80%E4%B9%88%E5%8C%BA%E5%88%AB%EF%BC%9F"><span class="toc-text">å”¯ä¸€ç´¢å¼•å’Œä¸»é”®ç´¢å¼•æœ‰ä»€ä¹ˆåŒºåˆ«ï¼Ÿ</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#unique-key-%E5%92%8C-unique-index-%E6%9C%89%E4%BB%80%E4%B9%88%E5%8C%BA%E5%88%AB%EF%BC%9F"><span class="toc-text">unique key å’Œ unique index æœ‰ä»€ä¹ˆåŒºåˆ«ï¼Ÿ</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%99%AE%E9%80%9A%E7%B4%A2%E5%BC%95%E5%92%8C%E5%94%AF%E4%B8%80%E7%B4%A2%E5%BC%95%E6%9C%89%E4%BB%80%E4%B9%88%E5%8C%BA%E5%88%AB%EF%BC%9F"><span class="toc-text">æ™®é€šç´¢å¼•å’Œå”¯ä¸€ç´¢å¼•æœ‰ä»€ä¹ˆåŒºåˆ«ï¼Ÿ</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E4%BD%A0%E5%AF%B9%E5%85%A8%E6%96%87%E7%B4%A2%E5%BC%95%E4%BA%86%E8%A7%A3%E5%A4%9A%E5%B0%91%EF%BC%9F"><span class="toc-text">ä½ å¯¹å…¨æ–‡ç´¢å¼•äº†è§£å¤šå°‘ï¼Ÿ</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#37-%F0%9F%8C%9F%E5%88%9B%E5%BB%BA%E7%B4%A2%E5%BC%95%E6%9C%89%E5%93%AA%E4%BA%9B%E6%B3%A8%E6%84%8F%E7%82%B9%EF%BC%9F"><span class="toc-text">37.ðŸŒŸåˆ›å»ºç´¢å¼•æœ‰å“ªäº›æ³¨æ„ç‚¹ï¼Ÿ</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#38-%F0%9F%8C%9F%E7%B4%A2%E5%BC%95%E5%93%AA%E4%BA%9B%E6%83%85%E5%86%B5%E4%B8%8B%E4%BC%9A%E5%A4%B1%E6%95%88%E5%91%A2%EF%BC%9F"><span class="toc-text">38.ðŸŒŸç´¢å¼•å“ªäº›æƒ…å†µä¸‹ä¼šå¤±æ•ˆå‘¢ï¼Ÿ</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E4%BB%80%E4%B9%88%E6%83%85%E5%86%B5%E4%B8%8B%E6%A8%A1%E7%B3%8A%E6%9F%A5%E8%AF%A2%E4%B8%8D%E8%B5%B0%E7%B4%A2%E5%BC%95%EF%BC%9F"><span class="toc-text">ä»€ä¹ˆæƒ…å†µä¸‹æ¨¡ç³ŠæŸ¥è¯¢ä¸èµ°ç´¢å¼•ï¼Ÿ</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#41-%F0%9F%8C%9F%E4%B8%BA%E4%BB%80%E4%B9%88-InnoDB-%E8%A6%81%E4%BD%BF%E7%94%A8-B-%E6%A0%91%E4%BD%9C%E4%B8%BA%E7%B4%A2%E5%BC%95%EF%BC%9F"><span class="toc-text">41.ðŸŒŸä¸ºä»€ä¹ˆ InnoDB è¦ä½¿ç”¨ B+æ ‘ä½œä¸ºç´¢å¼•ï¼Ÿ</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#B-%E6%A0%91%E7%9A%84%E5%8F%B6%E5%AD%90%E8%8A%82%E7%82%B9%E6%98%AF%E5%8D%95%E5%90%91%E9%93%BE%E8%A1%A8%E8%BF%98%E6%98%AF%E5%8F%8C%E5%90%91%E9%93%BE%E8%A1%A8%EF%BC%9F%E5%A6%82%E6%9E%9C%E4%BB%8E%E5%A4%A7%E5%80%BC%E5%90%91%E5%B0%8F%E5%80%BC%E6%A3%80%E7%B4%A2%EF%BC%8C%E5%A6%82%E4%BD%95%E6%93%8D%E4%BD%9C%EF%BC%9F"><span class="toc-text">B+æ ‘çš„å¶å­èŠ‚ç‚¹æ˜¯å•å‘é“¾è¡¨è¿˜æ˜¯åŒå‘é“¾è¡¨ï¼Ÿå¦‚æžœä»Žå¤§å€¼å‘å°å€¼æ£€ç´¢ï¼Œå¦‚ä½•æ“ä½œï¼Ÿ</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E4%B8%BA%E4%BB%80%E4%B9%88-MongoDB-%E7%9A%84%E7%B4%A2%E5%BC%95%E7%94%A8-B%E6%A0%91%EF%BC%8C%E8%80%8C-MySQL-%E7%94%A8-B-%E6%A0%91%EF%BC%9F"><span class="toc-text">ä¸ºä»€ä¹ˆ MongoDB çš„ç´¢å¼•ç”¨ Bæ ‘ï¼Œè€Œ MySQL ç”¨ B+ æ ‘ï¼Ÿ</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#42-%F0%9F%8C%9F%E4%B8%80%E6%A3%B5B-%E6%A0%91%E8%83%BD%E5%AD%98%E5%82%A8%E5%A4%9A%E5%B0%91%E6%9D%A1%E6%95%B0%E6%8D%AE%E5%91%A2%EF%BC%9F"><span class="toc-text">42.ðŸŒŸä¸€æ£µB+æ ‘èƒ½å­˜å‚¨å¤šå°‘æ¡æ•°æ®å‘¢ï¼Ÿ</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%AF%8F%E4%B8%AA%E5%8F%B6%E5%AD%90%E8%8A%82%E7%82%B9%E8%83%BD%E5%AD%98%E6%94%BE%E5%A4%9A%E5%B0%91%E6%9D%A1%E6%95%B0%E6%8D%AE%EF%BC%9F"><span class="toc-text">æ¯ä¸ªå¶å­èŠ‚ç‚¹èƒ½å­˜æ”¾å¤šå°‘æ¡æ•°æ®ï¼Ÿ</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#44-%F0%9F%8C%9F%E4%B8%BA%E4%BB%80%E4%B9%88%E7%94%A8-B-%E6%A0%91%E8%80%8C%E4%B8%8D%E7%94%A8-B-%E6%A0%91%E5%91%A2%EF%BC%9F"><span class="toc-text">44.ðŸŒŸä¸ºä»€ä¹ˆç”¨ B+ æ ‘è€Œä¸ç”¨ B æ ‘å‘¢ï¼Ÿ</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#B-%E6%A0%91%E7%9A%84%E6%97%B6%E9%97%B4%E5%A4%8D%E6%9D%82%E5%BA%A6%E6%98%AF%E5%A4%9A%E5%B0%91%EF%BC%9F"><span class="toc-text">B+æ ‘çš„æ—¶é—´å¤æ‚åº¦æ˜¯å¤šå°‘ï¼Ÿ</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E4%B8%BA%E4%BB%80%E4%B9%88%E7%94%A8-B-%E6%A0%91%E4%B8%8D%E7%94%A8%E8%B7%B3%E8%A1%A8%E5%91%A2%EF%BC%9F"><span class="toc-text">ä¸ºä»€ä¹ˆç”¨ B+æ ‘ä¸ç”¨è·³è¡¨å‘¢ï¼Ÿ</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#B-%E6%A0%91%E7%9A%84%E8%8C%83%E5%9B%B4%E6%9F%A5%E6%89%BE%E6%80%8E%E4%B9%88%E5%81%9A%E7%9A%84%EF%BC%9F"><span class="toc-text">B+æ ‘çš„èŒƒå›´æŸ¥æ‰¾æ€Žä¹ˆåšçš„ï¼Ÿ</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E4%BA%86%E8%A7%A3%E5%BF%AB%E6%8E%92%E5%90%97"><span class="toc-text">äº†è§£å¿«æŽ’å—</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#46-%F0%9F%8C%9F%E8%81%9A%E6%97%8F%E7%B4%A2%E5%BC%95%E5%92%8C%E9%9D%9E%E8%81%9A%E6%97%8F%E7%B4%A2%E5%BC%95%E6%9C%89%E4%BB%80%E4%B9%88%E5%8C%BA%E5%88%AB%EF%BC%9F"><span class="toc-text">46.ðŸŒŸèšæ—ç´¢å¼•å’Œéžèšæ—ç´¢å¼•æœ‰ä»€ä¹ˆåŒºåˆ«ï¼Ÿ</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#47-%F0%9F%8C%9F%E5%9B%9E%E8%A1%A8%E4%BA%86%E8%A7%A3%E5%90%97%EF%BC%9F"><span class="toc-text">47.ðŸŒŸå›žè¡¨äº†è§£å—ï¼Ÿ</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%9B%9E%E8%A1%A8%E7%9A%84%E4%BB%A3%E4%BB%B7%E6%98%AF%E4%BB%80%E4%B9%88%EF%BC%9F"><span class="toc-text">å›žè¡¨çš„ä»£ä»·æ˜¯ä»€ä¹ˆï¼Ÿ</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E4%BA%86%E8%A7%A3-MRR-%E5%90%97%EF%BC%9F"><span class="toc-text">äº†è§£ MRR å—ï¼Ÿ</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#48-%F0%9F%8C%9F%E8%81%94%E5%90%88%E7%B4%A2%E5%BC%95%E4%BA%86%E8%A7%A3%E5%90%97%EF%BC%9F%EF%BC%88%E8%A1%A5%E5%85%85%EF%BC%89"><span class="toc-text">48.ðŸŒŸè”åˆç´¢å¼•äº†è§£å—ï¼Ÿï¼ˆè¡¥å……ï¼‰</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E8%81%94%E5%90%88%E7%B4%A2%E5%BC%95%E5%BA%95%E5%B1%82%E7%9A%84%E5%AD%98%E5%82%A8%E7%BB%93%E6%9E%84%E6%98%AF%E6%80%8E%E6%A0%B7%E7%9A%84%EF%BC%9F"><span class="toc-text">è”åˆç´¢å¼•åº•å±‚çš„å­˜å‚¨ç»“æž„æ˜¯æ€Žæ ·çš„ï¼Ÿ</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E8%81%94%E5%90%88%E7%B4%A2%E5%BC%95%E7%9A%84%E5%8F%B6%E5%AD%90%E8%8A%82%E7%82%B9%E5%AD%98%E7%9A%84%E4%BB%80%E4%B9%88%E5%86%85%E5%AE%B9"><span class="toc-text">è”åˆç´¢å¼•çš„å¶å­èŠ‚ç‚¹å­˜çš„ä»€ä¹ˆå†…å®¹?</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#49-%F0%9F%8C%9F%E8%A6%86%E7%9B%96%E7%B4%A2%E5%BC%95%E4%BA%86%E8%A7%A3%E5%90%97%EF%BC%9F"><span class="toc-text">49.ðŸŒŸè¦†ç›–ç´¢å¼•äº†è§£å—ï¼Ÿ</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#50-%F0%9F%8C%9F%E4%BB%80%E4%B9%88%E6%98%AF%E6%9C%80%E5%B7%A6%E5%89%8D%E7%BC%80%E5%8E%9F%E5%88%99%EF%BC%9F"><span class="toc-text">50.ðŸŒŸä»€ä¹ˆæ˜¯æœ€å·¦å‰ç¼€åŽŸåˆ™ï¼Ÿ</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E8%8C%83%E5%9B%B4%E6%9F%A5%E8%AF%A2%E5%90%8E%E7%9A%84%E5%88%97%E8%BF%98%E8%83%BD%E7%94%A8%E7%B4%A2%E5%BC%95%E5%90%97%EF%BC%9F"><span class="toc-text">èŒƒå›´æŸ¥è¯¢åŽçš„åˆ—è¿˜èƒ½ç”¨ç´¢å¼•å—ï¼Ÿ</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E4%B8%BA%E4%BB%80%E4%B9%88%E4%B8%8D%E4%BB%8E%E6%9C%80%E5%B7%A6%E5%BC%80%E5%A7%8B%E6%9F%A5%EF%BC%8C%E5%B0%B1%E6%97%A0%E6%B3%95%E5%8C%B9%E9%85%8D%E5%91%A2%EF%BC%9F"><span class="toc-text">ä¸ºä»€ä¹ˆä¸ä»Žæœ€å·¦å¼€å§‹æŸ¥ï¼Œå°±æ— æ³•åŒ¹é…å‘¢ï¼Ÿ</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E8%81%94%E5%90%88%E7%B4%A2%E5%BC%95-a-b-%EF%BC%8Cwhere-a-1-%E5%92%8C-where-b-1%EF%BC%8C%E6%95%88%E6%9E%9C%E6%98%AF%E4%B8%80%E6%A0%B7%E7%9A%84%E5%90%97"><span class="toc-text">è”åˆç´¢å¼• (a, b)ï¼Œwhere a &#x3D; 1 å’Œ where b &#x3D; 1ï¼Œæ•ˆæžœæ˜¯ä¸€æ ·çš„å—</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%81%87%E5%A6%82%E6%9C%89%E8%81%94%E5%90%88%E7%B4%A2%E5%BC%95-abc%EF%BC%8C%E4%B8%8B%E9%9D%A2%E7%9A%84-sql-%E6%80%8E%E4%B9%88%E8%B5%B0%E7%9A%84%E8%81%94%E5%90%88%E7%B4%A2%E5%BC%95%EF%BC%9F"><span class="toc-text">å‡å¦‚æœ‰è”åˆç´¢å¼• abcï¼Œä¸‹é¢çš„ sql æ€Žä¹ˆèµ°çš„è”åˆç´¢å¼•ï¼Ÿ</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#A-B-C-%E8%81%94%E5%90%88%E7%B4%A2%E5%BC%95-select-from-tbn-where-a-and-b-in-and-c-%E4%BC%9A%E8%B5%B0%E7%B4%A2%E5%BC%95%E5%90%97%EF%BC%9F"><span class="toc-text">(A,B,C) è”åˆç´¢å¼• select * from tbn where a&#x3D;? and b in (?,?) and c&gt;? ä¼šèµ°ç´¢å¼•å—ï¼Ÿ</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E8%81%94%E5%90%88%E7%B4%A2%E5%BC%95%E7%9A%84%E4%B8%80%E4%B8%AA%E5%9C%BA%E6%99%AF%E9%A2%98%EF%BC%9A-a-b-c-%E8%81%94%E5%90%88%E7%B4%A2%E5%BC%95%EF%BC%8C-b-c-%E6%98%AF%E5%90%A6%E4%BC%9A%E8%B5%B0%E7%B4%A2%E5%BC%95%E5%90%97%EF%BC%9F"><span class="toc-text">è”åˆç´¢å¼•çš„ä¸€ä¸ªåœºæ™¯é¢˜ï¼š(a,b,c)è”åˆç´¢å¼•ï¼Œ(b,c)æ˜¯å¦ä¼šèµ°ç´¢å¼•å—ï¼Ÿ</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%BB%BA%E7%AB%8B%E8%81%94%E5%90%88%E7%B4%A2%E5%BC%95-a-b-c-%EF%BC%8Cwhere-c-5-%E6%98%AF%E5%90%A6%E4%BC%9A%E7%94%A8%E5%88%B0%E7%B4%A2%E5%BC%95%EF%BC%9F%E4%B8%BA%E4%BB%80%E4%B9%88%EF%BC%9F"><span class="toc-text">å»ºç«‹è”åˆç´¢å¼•(a,b,c)ï¼Œwhere c &#x3D; 5 æ˜¯å¦ä¼šç”¨åˆ°ç´¢å¼•ï¼Ÿä¸ºä»€ä¹ˆï¼Ÿ</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#sql%E4%B8%AD%E4%BD%BF%E7%94%A8like%EF%BC%8C%E5%A6%82%E6%9E%9C%E9%81%B5%E5%BE%AA%E6%9C%80%E5%B7%A6%E5%89%8D%E7%BC%80%E5%8C%B9%E9%85%8D%EF%BC%8C%E6%9F%A5%E8%AF%A2%E6%98%AF%E4%B8%8D%E6%98%AF%E4%B8%80%E5%AE%9A%E4%BC%9A%E7%94%A8%E5%88%B0%E7%B4%A2%E5%BC%95%EF%BC%9F"><span class="toc-text">sqlä¸­ä½¿ç”¨likeï¼Œå¦‚æžœéµå¾ªæœ€å·¦å‰ç¼€åŒ¹é…ï¼ŒæŸ¥è¯¢æ˜¯ä¸æ˜¯ä¸€å®šä¼šç”¨åˆ°ç´¢å¼•ï¼Ÿ</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#51-%F0%9F%8C%9F%E4%BB%80%E4%B9%88%E6%98%AF%E7%B4%A2%E5%BC%95%E4%B8%8B%E6%8E%A8%EF%BC%9F"><span class="toc-text">51.ðŸŒŸä»€ä¹ˆæ˜¯ç´¢å¼•ä¸‹æŽ¨ï¼Ÿ</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#53-%F0%9F%8C%9FMySQL-%E4%B8%AD%E6%9C%89%E5%93%AA%E5%87%A0%E7%A7%8D%E9%94%81%EF%BC%9F"><span class="toc-text">53.ðŸŒŸMySQL ä¸­æœ‰å“ªå‡ ç§é”ï¼Ÿ</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#55-%F0%9F%8C%9F%E8%AF%B4%E8%AF%B4-MySQL-%E7%9A%84%E8%A1%8C%E9%94%81%EF%BC%9F"><span class="toc-text">55.ðŸŒŸè¯´è¯´ MySQL çš„è¡Œé”ï¼Ÿ</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#select-for-update-%E6%9C%89%E4%BB%80%E4%B9%88%E9%9C%80%E8%A6%81%E6%B3%A8%E6%84%8F%E7%9A%84%EF%BC%9F"><span class="toc-text">select for update æœ‰ä»€ä¹ˆéœ€è¦æ³¨æ„çš„ï¼Ÿ</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E8%AF%B4%E8%AF%B4%E8%AE%B0%E5%BD%95%E9%94%81%E5%90%A7%EF%BC%9F"><span class="toc-text">è¯´è¯´è®°å½•é”å§ï¼Ÿ</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E9%97%B4%E9%9A%99%E9%94%81%E4%BA%86%E8%A7%A3%E5%90%97%EF%BC%9F"><span class="toc-text">é—´éš™é”äº†è§£å—ï¼Ÿ</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%89%A7%E8%A1%8C%E4%BB%80%E4%B9%88%E5%91%BD%E4%BB%A4%E4%BC%9A%E5%8A%A0%E4%B8%8A%E9%97%B4%E9%9A%99%E9%94%81%EF%BC%9F"><span class="toc-text">æ‰§è¡Œä»€ä¹ˆå‘½ä»¤ä¼šåŠ ä¸Šé—´éš™é”ï¼Ÿ</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#58-%F0%9F%8C%9FMySQL%E7%9A%84%E4%B9%90%E8%A7%82%E9%94%81%E5%92%8C%E6%82%B2%E8%A7%82%E9%94%81%E4%BA%86%E8%A7%A3%E5%90%97%EF%BC%9F"><span class="toc-text">58.ðŸŒŸMySQLçš„ä¹è§‚é”å’Œæ‚²è§‚é”äº†è§£å—ï¼Ÿ</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%A6%82%E4%BD%95%E9%80%9A%E8%BF%87%E6%82%B2%E8%A7%82%E9%94%81%E5%92%8C%E4%B9%90%E8%A7%82%E9%94%81%E8%A7%A3%E5%86%B3%E5%BA%93%E5%AD%98%E8%B6%85%E5%8D%96%E9%97%AE%E9%A2%98%EF%BC%9F"><span class="toc-text">å¦‚ä½•é€šè¿‡æ‚²è§‚é”å’Œä¹è§‚é”è§£å†³åº“å­˜è¶…å–é—®é¢˜ï¼Ÿ</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#60-%F0%9F%8C%9FMySQL%E4%BA%8B%E5%8A%A1%E7%9A%84%E5%9B%9B%E5%A4%A7%E7%89%B9%E6%80%A7%E8%AF%B4%E4%B8%80%E4%B8%8B%EF%BC%9F"><span class="toc-text">60.ðŸŒŸMySQLäº‹åŠ¡çš„å››å¤§ç‰¹æ€§è¯´ä¸€ä¸‹ï¼Ÿ</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E8%AF%A6%E7%BB%86%E8%AF%B4%E4%B8%80%E4%B8%8B%E5%8E%9F%E5%AD%90%E6%80%A7%EF%BC%9F"><span class="toc-text">è¯¦ç»†è¯´ä¸€ä¸‹åŽŸå­æ€§ï¼Ÿ</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E8%AF%A6%E7%BB%86%E8%AF%B4%E4%B8%80%E4%B8%8B%E4%B8%80%E8%87%B4%E6%80%A7%EF%BC%9F"><span class="toc-text">è¯¦ç»†è¯´ä¸€ä¸‹ä¸€è‡´æ€§ï¼Ÿ</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E8%AF%A6%E7%BB%86%E8%AF%B4%E4%B8%80%E4%B8%8B%E9%9A%94%E7%A6%BB%E6%80%A7%EF%BC%9F"><span class="toc-text">è¯¦ç»†è¯´ä¸€ä¸‹éš”ç¦»æ€§ï¼Ÿ</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E8%AF%A6%E7%BB%86%E8%AF%B4%E4%B8%80%E4%B8%8B%E6%8C%81%E4%B9%85%E6%80%A7%EF%BC%9F"><span class="toc-text">è¯¦ç»†è¯´ä¸€ä¸‹æŒä¹…æ€§ï¼Ÿ</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#62-%F0%9F%8C%9F%E4%BA%8B%E5%8A%A1%E7%9A%84%E9%9A%94%E7%A6%BB%E7%BA%A7%E5%88%AB%E6%9C%89%E5%93%AA%E4%BA%9B%EF%BC%9F"><span class="toc-text">62.ðŸŒŸäº‹åŠ¡çš„éš”ç¦»çº§åˆ«æœ‰å“ªäº›ï¼Ÿ</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E8%AF%A6%E7%BB%86%E8%AF%B4%E8%AF%B4%E8%AF%BB%E6%9C%AA%E6%8F%90%E4%BA%A4%EF%BC%9F"><span class="toc-text">è¯¦ç»†è¯´è¯´è¯»æœªæäº¤ï¼Ÿ</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E4%BB%80%E4%B9%88%E6%98%AF%E8%AF%BB%E5%B7%B2%E6%8F%90%E4%BA%A4%EF%BC%9F"><span class="toc-text">ä»€ä¹ˆæ˜¯è¯»å·²æäº¤ï¼Ÿ</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E4%BB%80%E4%B9%88%E6%98%AF%E5%8F%AF%E9%87%8D%E5%A4%8D%E8%AF%BB%EF%BC%9F"><span class="toc-text">ä»€ä¹ˆæ˜¯å¯é‡å¤è¯»ï¼Ÿ</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E4%BB%80%E4%B9%88%E6%98%AF%E4%B8%B2%E8%A1%8C%E5%8C%96%EF%BC%9F"><span class="toc-text">ä»€ä¹ˆæ˜¯ä¸²è¡ŒåŒ–ï¼Ÿ</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#A-%E4%BA%8B%E5%8A%A1%E6%9C%AA%E6%8F%90%E4%BA%A4%EF%BC%8CB-%E4%BA%8B%E5%8A%A1%E4%B8%8A%E6%9F%A5%E8%AF%A2%E5%88%B0%E7%9A%84%E6%98%AF%E6%97%A7%E5%80%BC%E8%BF%98%E6%98%AF%E6%96%B0%E5%80%BC%EF%BC%9F"><span class="toc-text">A äº‹åŠ¡æœªæäº¤ï¼ŒB äº‹åŠ¡ä¸ŠæŸ¥è¯¢åˆ°çš„æ˜¯æ—§å€¼è¿˜æ˜¯æ–°å€¼ï¼Ÿ</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%80%8E%E4%B9%88%E6%9B%B4%E6%94%B9%E4%BA%8B%E5%8A%A1%E7%9A%84%E9%9A%94%E7%A6%BB%E7%BA%A7%E5%88%AB%EF%BC%9F"><span class="toc-text">æ€Žä¹ˆæ›´æ”¹äº‹åŠ¡çš„éš”ç¦»çº§åˆ«ï¼Ÿ</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#64-%F0%9F%8C%9F%E8%AF%B7%E8%AF%A6%E7%BB%86%E8%AF%B4%E8%AF%B4%E5%B9%BB%E8%AF%BB%E5%91%A2%EF%BC%9F"><span class="toc-text">64.ðŸŒŸè¯·è¯¦ç»†è¯´è¯´å¹»è¯»å‘¢ï¼Ÿ</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%A6%82%E4%BD%95%E9%81%BF%E5%85%8D%E5%B9%BB%E8%AF%BB%EF%BC%9F"><span class="toc-text">å¦‚ä½•é¿å…å¹»è¯»ï¼Ÿ</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E4%BB%80%E4%B9%88%E6%98%AF%E5%BD%93%E5%89%8D%E8%AF%BB%E5%91%A2%EF%BC%9F"><span class="toc-text">ä»€ä¹ˆæ˜¯å½“å‰è¯»å‘¢ï¼Ÿ</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E4%B8%BA%E4%BB%80%E4%B9%88-UPDATE-%E5%92%8C-DELETE-%E4%B9%9F%E5%B1%9E%E4%BA%8E%E5%BD%93%E5%89%8D%E8%AF%BB%EF%BC%9F"><span class="toc-text">ä¸ºä»€ä¹ˆ UPDATE å’Œ DELETE ä¹Ÿå±žäºŽå½“å‰è¯»ï¼Ÿ</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E4%BB%80%E4%B9%88%E6%98%AF%E5%BF%AB%E7%85%A7%E8%AF%BB%E5%91%A2%EF%BC%9F"><span class="toc-text">ä»€ä¹ˆæ˜¯å¿«ç…§è¯»å‘¢ï¼Ÿ</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#65-%F0%9F%8C%9FMVCC-%E4%BA%86%E8%A7%A3%E5%90%97%EF%BC%9F"><span class="toc-text">65.ðŸŒŸMVCC äº†è§£å—ï¼Ÿ</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E8%AF%B7%E8%AF%A6%E7%BB%86%E8%AF%B4%E8%AF%B4%E4%BB%80%E4%B9%88%E6%98%AF%E7%89%88%E6%9C%AC%E9%93%BE%EF%BC%9F"><span class="toc-text">è¯·è¯¦ç»†è¯´è¯´ä»€ä¹ˆæ˜¯ç‰ˆæœ¬é“¾ï¼Ÿ</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E8%AF%B7%E8%AF%A6%E7%BB%86%E8%AF%B4%E8%AF%B4%E4%BB%80%E4%B9%88%E6%98%AFReadView%EF%BC%9F"><span class="toc-text">è¯·è¯¦ç»†è¯´è¯´ä»€ä¹ˆæ˜¯ReadViewï¼Ÿ</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#ReadView-%E6%98%AF%E5%A6%82%E4%BD%95%E5%88%A4%E6%96%AD%E8%AE%B0%E5%BD%95%E7%9A%84%E6%9F%90%E4%B8%AA%E7%89%88%E6%9C%AC%E6%98%AF%E5%90%A6%E5%8F%AF%E8%A7%81%E7%9A%84%EF%BC%9F"><span class="toc-text">ReadView æ˜¯å¦‚ä½•åˆ¤æ–­è®°å½•çš„æŸä¸ªç‰ˆæœ¬æ˜¯å¦å¯è§çš„ï¼Ÿ</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%8F%AF%E9%87%8D%E5%A4%8D%E8%AF%BB%E5%92%8C%E8%AF%BB%E5%B7%B2%E6%8F%90%E4%BA%A4%E5%9C%A8-ReadView-%E4%B8%8A%E7%9A%84%E5%8C%BA%E5%88%AB%E6%98%AF%E4%BB%80%E4%B9%88%EF%BC%9F"><span class="toc-text">å¯é‡å¤è¯»å’Œè¯»å·²æäº¤åœ¨ ReadView ä¸Šçš„åŒºåˆ«æ˜¯ä»€ä¹ˆï¼Ÿ</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%A6%82%E6%9E%9C%E4%B8%A4%E4%B8%AA-AB-%E4%BA%8B%E5%8A%A1%E5%B9%B6%E5%8F%91%E4%BF%AE%E6%94%B9%E4%B8%80%E4%B8%AA%E5%8F%98%E9%87%8F%EF%BC%8C%E9%82%A3%E4%B9%88-A-%E8%AF%BB%E5%88%B0%E7%9A%84%E5%80%BC%E6%98%AF%E4%BB%80%E4%B9%88%EF%BC%8C%E6%80%8E%E4%B9%88%E5%88%86%E6%9E%90%E3%80%82"><span class="toc-text">å¦‚æžœä¸¤ä¸ª AB äº‹åŠ¡å¹¶å‘ä¿®æ”¹ä¸€ä¸ªå˜é‡ï¼Œé‚£ä¹ˆ A è¯»åˆ°çš„å€¼æ˜¯ä»€ä¹ˆï¼Œæ€Žä¹ˆåˆ†æžã€‚</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#70-%F0%9F%8C%9F%E4%BD%A0%E4%BB%AC%E4%B8%80%E8%88%AC%E6%98%AF%E6%80%8E%E4%B9%88%E5%88%86%E5%BA%93%E7%9A%84%E5%91%A2%EF%BC%9F"><span class="toc-text">70.ðŸŒŸä½ ä»¬ä¸€èˆ¬æ˜¯æ€Žä¹ˆåˆ†åº“çš„å‘¢ï¼Ÿ</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#71-%F0%9F%8C%9F%E9%82%A3%E4%BD%A0%E4%BB%AC%E6%98%AF%E6%80%8E%E4%B9%88%E5%88%86%E8%A1%A8%E7%9A%84%EF%BC%9F"><span class="toc-text">71.ðŸŒŸé‚£ä½ ä»¬æ˜¯æ€Žä¹ˆåˆ†è¡¨çš„ï¼Ÿ</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Redis"><span class="toc-text">Redis</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#1-%F0%9F%8C%9F%E8%AF%B4%E8%AF%B4%E4%BB%80%E4%B9%88%E6%98%AF-Redis"><span class="toc-text">1.ðŸŒŸè¯´è¯´ä»€ä¹ˆæ˜¯ Redis?</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#Redis-%E5%92%8C-MySQL-%E7%9A%84%E5%8C%BA%E5%88%AB%EF%BC%9F"><span class="toc-text">Redis å’Œ MySQL çš„åŒºåˆ«ï¼Ÿ</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#TecHub%E9%A1%B9%E7%9B%AE%E9%87%8C%E5%93%AA%E9%87%8C%E7%94%A8%E5%88%B0%E4%BA%86-Redis%EF%BC%9F"><span class="toc-text">TecHubé¡¹ç›®é‡Œå“ªé‡Œç”¨åˆ°äº† Redisï¼Ÿ</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E9%83%A8%E7%BD%B2%E8%BF%87-Redis-%E5%90%97%EF%BC%9F"><span class="toc-text">éƒ¨ç½²è¿‡ Redis å—ï¼Ÿ</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Redis-%E7%9A%84%E9%AB%98%E5%8F%AF%E7%94%A8%E6%96%B9%E6%A1%88%E6%9C%89%E9%83%A8%E7%BD%B2%E8%BF%87%E5%90%97%EF%BC%9F"><span class="toc-text">Redis çš„é«˜å¯ç”¨æ–¹æ¡ˆæœ‰éƒ¨ç½²è¿‡å—ï¼Ÿ</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3-%F0%9F%8C%9FRedis%E6%9C%89%E5%93%AA%E4%BA%9B%E6%95%B0%E6%8D%AE%E7%B1%BB%E5%9E%8B%EF%BC%9F"><span class="toc-text">3.ðŸŒŸRedisæœ‰å“ªäº›æ•°æ®ç±»åž‹ï¼Ÿ</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E8%AF%A6%E7%BB%86%E4%BB%8B%E7%BB%8D%E4%B8%8B%E5%AD%97%E7%AC%A6%E4%B8%B2%EF%BC%9F"><span class="toc-text">è¯¦ç»†ä»‹ç»ä¸‹å­—ç¬¦ä¸²ï¼Ÿ</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E8%AF%A6%E7%BB%86%E4%BB%8B%E7%BB%8D%E4%B8%8B%E5%88%97%E8%A1%A8%EF%BC%9F"><span class="toc-text">è¯¦ç»†ä»‹ç»ä¸‹åˆ—è¡¨ï¼Ÿ</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E8%AF%A6%E7%BB%86%E4%BB%8B%E7%BB%8D%E4%B8%8B%E5%93%88%E5%B8%8C%EF%BC%9F"><span class="toc-text">è¯¦ç»†ä»‹ç»ä¸‹å“ˆå¸Œï¼Ÿ</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E8%AF%A6%E7%BB%86%E4%BB%8B%E7%BB%8D%E4%B8%8B%E9%9B%86%E5%90%88%EF%BC%9F"><span class="toc-text">è¯¦ç»†ä»‹ç»ä¸‹é›†åˆï¼Ÿ</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E8%AF%A6%E7%BB%86%E4%BB%8B%E7%BB%8D%E4%B8%8B%E6%9C%89%E5%BA%8F%E9%9B%86%E5%90%88%EF%BC%9F"><span class="toc-text">è¯¦ç»†ä»‹ç»ä¸‹æœ‰åºé›†åˆï¼Ÿ</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E8%AF%A6%E7%BB%86%E4%BB%8B%E7%BB%8D%E4%B8%8BBitmap%EF%BC%9F"><span class="toc-text">è¯¦ç»†ä»‹ç»ä¸‹Bitmapï¼Ÿ</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E8%AF%A6%E7%BB%86%E4%BB%8B%E7%BB%8D%E4%B8%8BHyperLogLog%EF%BC%9F"><span class="toc-text">è¯¦ç»†ä»‹ç»ä¸‹HyperLogLogï¼Ÿ</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E8%AF%A6%E7%BB%86%E4%BB%8B%E7%BB%8D%E4%B8%8BGEO%EF%BC%9F"><span class="toc-text">è¯¦ç»†ä»‹ç»ä¸‹GEOï¼Ÿ</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E4%B8%BA%E4%BB%80%E4%B9%88%E4%BD%BF%E7%94%A8-hash-%E7%B1%BB%E5%9E%8B%E8%80%8C%E4%B8%8D%E4%BD%BF%E7%94%A8-string-%E7%B1%BB%E5%9E%8B%E5%BA%8F%E5%88%97%E5%8C%96%E5%AD%98%E5%82%A8%EF%BC%9F"><span class="toc-text">ä¸ºä»€ä¹ˆä½¿ç”¨ hash ç±»åž‹è€Œä¸ä½¿ç”¨ string ç±»åž‹åºåˆ—åŒ–å­˜å‚¨ï¼Ÿ</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#4-%F0%9F%8C%9FRedis-%E4%B8%BA%E4%BB%80%E4%B9%88%E5%BF%AB%E5%91%A2%EF%BC%9F"><span class="toc-text">4.ðŸŒŸRedis ä¸ºä»€ä¹ˆå¿«å‘¢ï¼Ÿ</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#10-%F0%9F%8C%9FRedis%E7%9A%84%E6%8C%81%E4%B9%85%E5%8C%96%E6%96%B9%E5%BC%8F%E6%9C%89%E5%93%AA%E4%BA%9B%EF%BC%9F"><span class="toc-text">10.ðŸŒŸRedisçš„æŒä¹…åŒ–æ–¹å¼æœ‰å“ªäº›ï¼Ÿ</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E8%AF%A6%E7%BB%86%E8%AF%B4%E4%B8%80%E4%B8%8B-RDB%EF%BC%9F"><span class="toc-text">è¯¦ç»†è¯´ä¸€ä¸‹ RDBï¼Ÿ</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E4%BB%80%E4%B9%88%E6%83%85%E5%86%B5%E4%B8%8B%E4%BC%9A%E8%87%AA%E5%8A%A8%E8%A7%A6%E5%8F%91-RDB-%E6%8C%81%E4%B9%85%E5%8C%96%EF%BC%9F"><span class="toc-text">ä»€ä¹ˆæƒ…å†µä¸‹ä¼šè‡ªåŠ¨è§¦å‘ RDB æŒä¹…åŒ–ï¼Ÿ</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E8%AF%A6%E7%BB%86%E8%AF%B4%E4%B8%80%E4%B8%8B-AOF%EF%BC%9F"><span class="toc-text">è¯¦ç»†è¯´ä¸€ä¸‹ AOFï¼Ÿ</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#AOF-%E7%9A%84%E5%88%B7%E7%9B%98%E7%AD%96%E7%95%A5%E4%BA%86%E8%A7%A3%E5%90%97%EF%BC%9F"><span class="toc-text">AOF çš„åˆ·ç›˜ç­–ç•¥äº†è§£å—ï¼Ÿ</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E8%AF%B4%E8%AF%B4AOF%E7%9A%84%E9%87%8D%E5%86%99%E6%9C%BA%E5%88%B6%EF%BC%9F"><span class="toc-text">è¯´è¯´AOFçš„é‡å†™æœºåˆ¶ï¼Ÿ</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#AOF-%E9%87%8D%E5%86%99%E7%9A%84%E5%85%B7%E4%BD%93%E8%BF%87%E7%A8%8B%E6%98%AF%E6%80%8E%E6%A0%B7%E7%9A%84%EF%BC%9F"><span class="toc-text">AOF é‡å†™çš„å…·ä½“è¿‡ç¨‹æ˜¯æ€Žæ ·çš„ï¼Ÿ</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#AOF-%E6%96%87%E4%BB%B6%E5%AD%98%E5%82%A8%E7%9A%84%E6%98%AF%E4%BB%80%E4%B9%88%E7%B1%BB%E5%9E%8B%E7%9A%84%E6%95%B0%E6%8D%AE%EF%BC%9F"><span class="toc-text">AOF æ–‡ä»¶å­˜å‚¨çš„æ˜¯ä»€ä¹ˆç±»åž‹çš„æ•°æ®ï¼Ÿ</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#AOF%E9%87%8D%E5%86%99%E6%9C%9F%E9%97%B4%E5%91%BD%E4%BB%A4%E5%8F%AF%E8%83%BD%E4%BC%9A%E5%86%99%E5%85%A5%E4%B8%A4%E6%AC%A1%EF%BC%8C%E4%BC%9A%E9%80%A0%E6%88%90%E4%BB%80%E4%B9%88%E5%BD%B1%E5%93%8D%EF%BC%9F"><span class="toc-text">AOFé‡å†™æœŸé—´å‘½ä»¤å¯èƒ½ä¼šå†™å…¥ä¸¤æ¬¡ï¼Œä¼šé€ æˆä»€ä¹ˆå½±å“ï¼Ÿ</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#14-%F0%9F%8C%9FRedis-4-0-%E7%9A%84%E6%B7%B7%E5%90%88%E6%8C%81%E4%B9%85%E5%8C%96%E4%BA%86%E8%A7%A3%E5%90%97%EF%BC%9F"><span class="toc-text">14.ðŸŒŸRedis 4.0 çš„æ··åˆæŒä¹…åŒ–äº†è§£å—ï¼Ÿ</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%A6%82%E4%BD%95%E8%AE%BE%E7%BD%AE%E6%8C%81%E4%B9%85%E5%8C%96%E6%A8%A1%E5%BC%8F%EF%BC%9F"><span class="toc-text">å¦‚ä½•è®¾ç½®æŒä¹…åŒ–æ¨¡å¼ï¼Ÿ</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E4%BD%A0%E5%9C%A8%E5%BC%80%E5%8F%91%E4%B8%AD%E6%98%AF%E6%80%8E%E4%B9%88%E9%85%8D%E7%BD%AE-RDB-%E5%92%8C-AOF-%E7%9A%84%EF%BC%9F"><span class="toc-text">ä½ åœ¨å¼€å‘ä¸­æ˜¯æ€Žä¹ˆé…ç½® RDB å’Œ AOF çš„ï¼Ÿ</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#29-%F0%9F%8C%9F%E4%BB%80%E4%B9%88%E6%98%AF%E7%BC%93%E5%AD%98%E5%87%BB%E7%A9%BF%EF%BC%9F"><span class="toc-text">29.ðŸŒŸä»€ä¹ˆæ˜¯ç¼“å­˜å‡»ç©¿ï¼Ÿ</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E4%BB%80%E4%B9%88%E6%98%AF%E7%BC%93%E5%AD%98%E7%A9%BF%E9%80%8F%EF%BC%9F"><span class="toc-text">ä»€ä¹ˆæ˜¯ç¼“å­˜ç©¿é€ï¼Ÿ</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E4%BB%80%E4%B9%88%E6%98%AF%E7%BC%93%E5%AD%98%E9%9B%AA%E5%B4%A9%EF%BC%9F"><span class="toc-text">ä»€ä¹ˆæ˜¯ç¼“å­˜é›ªå´©ï¼Ÿ</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#30-%F0%9F%8C%9F%E8%83%BD%E8%AF%B4%E8%AF%B4%E5%B8%83%E9%9A%86%E8%BF%87%E6%BB%A4%E5%99%A8%E5%90%97%EF%BC%9F"><span class="toc-text">30.ðŸŒŸèƒ½è¯´è¯´å¸ƒéš†è¿‡æ»¤å™¨å—ï¼Ÿ</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%B8%83%E9%9A%86%E8%BF%87%E6%BB%A4%E5%99%A8%E5%AD%98%E5%9C%A8%E8%AF%AF%E5%88%A4%E5%90%97%EF%BC%9F"><span class="toc-text">å¸ƒéš†è¿‡æ»¤å™¨å­˜åœ¨è¯¯åˆ¤å—ï¼Ÿ</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%B8%83%E9%9A%86%E8%BF%87%E6%BB%A4%E5%99%A8%E6%94%AF%E6%8C%81%E5%88%A0%E9%99%A4%E5%90%97%EF%BC%9F"><span class="toc-text">å¸ƒéš†è¿‡æ»¤å™¨æ”¯æŒåˆ é™¤å—ï¼Ÿ</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E4%B8%BA%E4%BB%80%E4%B9%88%E4%B8%8D%E8%83%BD%E7%94%A8%E5%93%88%E5%B8%8C%E8%A1%A8%E8%80%8C%E6%98%AF%E7%94%A8%E5%B8%83%E9%9A%86%E8%BF%87%E6%BB%A4%E5%99%A8%EF%BC%9F"><span class="toc-text">ä¸ºä»€ä¹ˆä¸èƒ½ç”¨å“ˆå¸Œè¡¨è€Œæ˜¯ç”¨å¸ƒéš†è¿‡æ»¤å™¨ï¼Ÿ</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#31-%F0%9F%8C%9F%E5%A6%82%E4%BD%95%E4%BF%9D%E8%AF%81%E7%BC%93%E5%AD%98%E5%92%8C%E6%95%B0%E6%8D%AE%E5%BA%93%E7%9A%84%E6%95%B0%E6%8D%AE%E2%BC%80%E8%87%B4%E6%80%A7%EF%BC%9F"><span class="toc-text">31.ðŸŒŸå¦‚ä½•ä¿è¯ç¼“å­˜å’Œæ•°æ®åº“çš„æ•°æ®â¼€è‡´æ€§ï¼Ÿ</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E9%82%A3%E5%86%8D%E6%9D%A5%E8%AF%B4%E8%AF%B4%E4%B8%BA%E4%BB%80%E4%B9%88%E8%A6%81%E5%88%A0%E9%99%A4%E7%BC%93%E5%AD%98%E8%80%8C%E4%B8%8D%E6%98%AF%E6%9B%B4%E6%96%B0%E7%BC%93%E5%AD%98%EF%BC%9F"><span class="toc-text">é‚£å†æ¥è¯´è¯´ä¸ºä»€ä¹ˆè¦åˆ é™¤ç¼“å­˜è€Œä¸æ˜¯æ›´æ–°ç¼“å­˜ï¼Ÿ</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E9%82%A3%E5%86%8D%E8%AF%B4%E8%AF%B4%E4%B8%BA%E4%BB%80%E4%B9%88%E8%A6%81%E5%85%88%E6%9B%B4%E6%96%B0%E6%95%B0%E6%8D%AE%E5%BA%93%EF%BC%8C%E5%86%8D%E5%88%A0%E9%99%A4%E7%BC%93%E5%AD%98%EF%BC%9F"><span class="toc-text">é‚£å†è¯´è¯´ä¸ºä»€ä¹ˆè¦å…ˆæ›´æ–°æ•°æ®åº“ï¼Œå†åˆ é™¤ç¼“å­˜ï¼Ÿ</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E9%82%A3%E5%81%87%E5%A6%82%E5%AF%B9%E7%BC%93%E5%AD%98%E6%95%B0%E6%8D%AE%E5%BA%93%E4%B8%80%E8%87%B4%E6%80%A7%E8%A6%81%E6%B1%82%E5%BE%88%E9%AB%98%EF%BC%8C%E8%AF%A5%E6%80%8E%E4%B9%88%E5%8A%9E%E5%91%A2%EF%BC%9F"><span class="toc-text">é‚£å‡å¦‚å¯¹ç¼“å­˜æ•°æ®åº“ä¸€è‡´æ€§è¦æ±‚å¾ˆé«˜ï¼Œè¯¥æ€Žä¹ˆåŠžå‘¢ï¼Ÿ</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#40-%F0%9F%8C%9FRedis%E6%9C%89%E5%93%AA%E4%BA%9B%E5%86%85%E5%AD%98%E6%B7%98%E6%B1%B0%E7%AD%96%E7%95%A5%EF%BC%9F"><span class="toc-text">40.ðŸŒŸRedisæœ‰å“ªäº›å†…å­˜æ·˜æ±°ç­–ç•¥ï¼Ÿ</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#45-%F0%9F%8C%9FRedis%E6%94%AF%E6%8C%81%E4%BA%8B%E5%8A%A1%E5%90%97%EF%BC%9F"><span class="toc-text">45.ðŸŒŸRedisæ”¯æŒäº‹åŠ¡å—ï¼Ÿ</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E8%AF%B4%E4%B8%80%E4%B8%8B-Redis-%E4%BA%8B%E5%8A%A1%E7%9A%84%E5%8E%9F%E7%90%86%EF%BC%9F"><span class="toc-text">è¯´ä¸€ä¸‹ Redis äº‹åŠ¡çš„åŽŸç†ï¼Ÿ</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Redis-%E4%BA%8B%E5%8A%A1%E6%9C%89%E5%93%AA%E4%BA%9B%E6%B3%A8%E6%84%8F%E7%82%B9%EF%BC%9F"><span class="toc-text">Redis äº‹åŠ¡æœ‰å“ªäº›æ³¨æ„ç‚¹ï¼Ÿ</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Redis%E4%BA%8B%E5%8A%A1%E4%B8%BA%E4%BB%80%E4%B9%88%E4%B8%8D%E6%94%AF%E6%8C%81%E5%9B%9E%E6%BB%9A%EF%BC%9F"><span class="toc-text">Redisäº‹åŠ¡ä¸ºä»€ä¹ˆä¸æ”¯æŒå›žæ»šï¼Ÿ</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Redis%E4%BA%8B%E5%8A%A1%E6%BB%A1%E8%B6%B3%E5%8E%9F%E5%AD%90%E6%80%A7%E5%90%97%EF%BC%9F%E8%A6%81%E6%80%8E%E4%B9%88%E6%94%B9%E8%BF%9B%EF%BC%9F"><span class="toc-text">Redisäº‹åŠ¡æ»¡è¶³åŽŸå­æ€§å—ï¼Ÿè¦æ€Žä¹ˆæ”¹è¿›ï¼Ÿ</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Redis-%E4%BA%8B%E5%8A%A1%E7%9A%84-ACID-%E7%89%B9%E6%80%A7%E5%A6%82%E4%BD%95%E4%BD%93%E7%8E%B0%EF%BC%9F"><span class="toc-text">Redis äº‹åŠ¡çš„ ACID ç‰¹æ€§å¦‚ä½•ä½“çŽ°ï¼Ÿ</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#48-%F0%9F%8C%9FRedis%E8%83%BD%E5%AE%9E%E7%8E%B0%E5%88%86%E5%B8%83%E5%BC%8F%E9%94%81%E5%90%97%EF%BC%9F"><span class="toc-text">48.ðŸŒŸRedisèƒ½å®žçŽ°åˆ†å¸ƒå¼é”å—ï¼Ÿ</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#Redis%E5%A6%82%E4%BD%95%E4%BF%9D%E8%AF%81-SETNX-%E4%B8%8D%E4%BC%9A%E5%8F%91%E7%94%9F%E5%86%B2%E7%AA%81%EF%BC%9F"><span class="toc-text">Rediså¦‚ä½•ä¿è¯ SETNX ä¸ä¼šå‘ç”Ÿå†²çªï¼Ÿ</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#SETNX%E6%9C%89%E4%BB%80%E4%B9%88%E9%97%AE%E9%A2%98%EF%BC%8C%E5%A6%82%E4%BD%95%E8%A7%A3%E5%86%B3%EF%BC%9F"><span class="toc-text">SETNXæœ‰ä»€ä¹ˆé—®é¢˜ï¼Œå¦‚ä½•è§£å†³ï¼Ÿ</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Redisson%E4%BA%86%E8%A7%A3%E5%A4%9A%E5%B0%91%EF%BC%9F"><span class="toc-text">Redissonäº†è§£å¤šå°‘ï¼Ÿ</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E8%AF%A6%E7%BB%86%E8%AF%B4%E8%AF%B4Redisson%E7%9A%84%E7%9C%8B%E9%97%A8%E7%8B%97%E6%9C%BA%E5%88%B6%EF%BC%9F"><span class="toc-text">è¯¦ç»†è¯´è¯´Redissonçš„çœ‹é—¨ç‹—æœºåˆ¶ï¼Ÿ</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E7%9C%8B%E9%97%A8%E7%8B%97%E6%9C%BA%E5%88%B6%E4%B8%AD%E7%9A%84%E6%A3%80%E6%9F%A5%E9%94%81%E8%BF%87%E7%A8%8B%E6%98%AF%E5%8E%9F%E5%AD%90%E6%93%8D%E4%BD%9C%E5%90%97%EF%BC%9F"><span class="toc-text">çœ‹é—¨ç‹—æœºåˆ¶ä¸­çš„æ£€æŸ¥é”è¿‡ç¨‹æ˜¯åŽŸå­æ“ä½œå—ï¼Ÿ</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Redlock%E4%BD%A0%E4%BA%86%E8%A7%A3%E5%A4%9A%E5%B0%91%EF%BC%9F"><span class="toc-text">Redlockä½ äº†è§£å¤šå°‘ï¼Ÿ</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E7%BA%A2%E9%94%81%E8%83%BD%E4%B8%8D%E8%83%BD%E4%BF%9D%E8%AF%81%E7%99%BE%E5%88%86%E7%99%BE%E4%B8%8A%E9%94%81%EF%BC%9F"><span class="toc-text">çº¢é”èƒ½ä¸èƒ½ä¿è¯ç™¾åˆ†ç™¾ä¸Šé”ï¼Ÿ</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E9%A1%B9%E7%9B%AE%E4%B8%AD%E6%9C%89%E7%94%A8%E5%88%B0%E5%88%86%E5%B8%83%E5%BC%8F%E9%94%81%E5%90%97%EF%BC%9F"><span class="toc-text">é¡¹ç›®ä¸­æœ‰ç”¨åˆ°åˆ†å¸ƒå¼é”å—ï¼Ÿ</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#49-%F0%9F%8C%9FRedis%E9%83%BD%E6%9C%89%E5%93%AA%E4%BA%9B%E5%BA%95%E5%B1%82%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84%EF%BC%9F"><span class="toc-text">49.ðŸŒŸRediséƒ½æœ‰å“ªäº›åº•å±‚æ•°æ®ç»“æž„ï¼Ÿ</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E7%AE%80%E5%8D%95%E4%BB%8B%E7%BB%8D%E4%B8%8B%E9%93%BE%E8%A1%A8%EF%BC%9F"><span class="toc-text">ç®€å•ä»‹ç»ä¸‹é“¾è¡¨ï¼Ÿ</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%85%B3%E4%BA%8E%E6%95%B4%E6%95%B0%E9%9B%86%E5%90%88%EF%BC%8C%E8%83%BD%E5%86%8D%E8%AF%A6%E7%BB%86%E8%AF%B4%E8%AF%B4%E5%90%97%EF%BC%9F"><span class="toc-text">å…³äºŽæ•´æ•°é›†åˆï¼Œèƒ½å†è¯¦ç»†è¯´è¯´å—ï¼Ÿ</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E8%AF%B4%E4%B8%80%E4%B8%8Bzset-%E7%9A%84%E5%BA%95%E5%B1%82%E5%8E%9F%E7%90%86%EF%BC%9F"><span class="toc-text">è¯´ä¸€ä¸‹zset çš„åº•å±‚åŽŸç†ï¼Ÿ</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E4%BD%A0%E7%9F%A5%E9%81%93%E4%B8%BA%E4%BB%80%E4%B9%88Redis-7-0%E8%A6%81%E7%94%A8listpack%E6%9D%A5%E6%9B%BF%E4%BB%A3ziplist%E5%90%97%EF%BC%9F"><span class="toc-text">ä½ çŸ¥é“ä¸ºä»€ä¹ˆRedis 7.0è¦ç”¨listpackæ¥æ›¿ä»£ziplistå—ï¼Ÿ</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E8%BF%9E%E9%94%81%E6%9B%B4%E6%96%B0%E6%98%AF%E6%80%8E%E4%B9%88%E5%8F%91%E7%94%9F%E7%9A%84%EF%BC%9F"><span class="toc-text">è¿žé”æ›´æ–°æ˜¯æ€Žä¹ˆå‘ç”Ÿçš„ï¼Ÿ</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#52-%F0%9F%8C%9F%E4%BD%A0%E4%BA%86%E8%A7%A3%E8%B7%B3%E8%A1%A8%E5%90%97%EF%BC%9F"><span class="toc-text">52.ðŸŒŸä½ äº†è§£è·³è¡¨å—ï¼Ÿ</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%80%8E%E4%B9%88%E5%BE%80%E8%B7%B3%E8%A1%A8%E6%8F%92%E5%85%A5%E8%8A%82%E7%82%B9%E5%91%A2%EF%BC%9F"><span class="toc-text">æ€Žä¹ˆå¾€è·³è¡¨æ’å…¥èŠ‚ç‚¹å‘¢ï¼Ÿ</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#zset%E4%B8%BA%E4%BB%80%E4%B9%88%E8%A6%81%E4%BD%BF%E7%94%A8%E8%B7%B3%E8%A1%A8%E5%91%A2%EF%BC%9F"><span class="toc-text">zsetä¸ºä»€ä¹ˆè¦ä½¿ç”¨è·³è¡¨å‘¢ï¼Ÿ</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E8%B7%B3%E8%A1%A8%E6%98%AF%E5%A6%82%E4%BD%95%E5%AE%9A%E4%B9%89%E7%9A%84%E5%91%A2%EF%BC%9F"><span class="toc-text">è·³è¡¨æ˜¯å¦‚ä½•å®šä¹‰çš„å‘¢ï¼Ÿ</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#span-%E8%B7%A8%E5%BA%A6%E6%9C%89%E4%BB%80%E4%B9%88%E7%94%A8%EF%BC%9F"><span class="toc-text">span è·¨åº¦æœ‰ä»€ä¹ˆç”¨ï¼Ÿ</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E4%B8%BA%E4%BB%80%E4%B9%88%E8%B7%B3%E8%A1%A8%E7%9A%84%E8%8C%83%E5%9B%B4%E6%9F%A5%E8%AF%A2%E6%95%88%E7%8E%87%E6%AF%94%E5%AD%97%E5%85%B8%E9%AB%98%EF%BC%9F"><span class="toc-text">ä¸ºä»€ä¹ˆè·³è¡¨çš„èŒƒå›´æŸ¥è¯¢æ•ˆçŽ‡æ¯”å­—å…¸é«˜ï¼Ÿ</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Spring"><span class="toc-text">Spring</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#4-%F0%9F%8C%9FSpring%E7%94%A8%E4%BA%86%E5%93%AA%E4%BA%9B%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F%EF%BC%9F"><span class="toc-text">4.ðŸŒŸSpringç”¨äº†å“ªäº›è®¾è®¡æ¨¡å¼ï¼Ÿ</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#Spring%E5%A6%82%E4%BD%95%E5%AE%9E%E7%8E%B0%E5%8D%95%E4%BE%8B%E6%A8%A1%E5%BC%8F%EF%BC%9F"><span class="toc-text">Springå¦‚ä½•å®žçŽ°å•ä¾‹æ¨¡å¼ï¼Ÿ</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#7-%F0%9F%8C%9F%E8%83%BD%E8%AF%B4%E4%B8%80%E4%B8%8BBean%E7%9A%84%E7%94%9F%E5%91%BD%E5%91%A8%E6%9C%9F%E5%90%97%EF%BC%9F"><span class="toc-text">7.ðŸŒŸèƒ½è¯´ä¸€ä¸‹Beançš„ç”Ÿå‘½å‘¨æœŸå—ï¼Ÿ</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#Aware-%E7%B1%BB%E5%9E%8B%E7%9A%84%E6%8E%A5%E5%8F%A3%E6%9C%89%E4%BB%80%E4%B9%88%E4%BD%9C%E7%94%A8%EF%BC%9F"><span class="toc-text">Aware ç±»åž‹çš„æŽ¥å£æœ‰ä»€ä¹ˆä½œç”¨ï¼Ÿ</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%A6%82%E6%9E%9C%E9%85%8D%E7%BD%AE%E4%BA%86-init-method-%E5%92%8C-destroy-method%EF%BC%8CSpring-%E4%BC%9A%E5%9C%A8%E4%BB%80%E4%B9%88%E6%97%B6%E5%80%99%E8%B0%83%E7%94%A8%E5%85%B6%E9%85%8D%E7%BD%AE%E7%9A%84%E6%96%B9%E6%B3%95%EF%BC%9F"><span class="toc-text">å¦‚æžœé…ç½®äº† init-method å’Œ destroy-methodï¼ŒSpring ä¼šåœ¨ä»€ä¹ˆæ—¶å€™è°ƒç”¨å…¶é…ç½®çš„æ–¹æ³•ï¼Ÿ</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#14-%F0%9F%8C%9FSpring%E6%80%8E%E4%B9%88%E8%A7%A3%E5%86%B3%E5%BE%AA%E7%8E%AF%E4%BE%9D%E8%B5%96%E5%91%A2%EF%BC%9F"><span class="toc-text">14.ðŸŒŸSpringæ€Žä¹ˆè§£å†³å¾ªçŽ¯ä¾èµ–å‘¢ï¼Ÿ</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%93%AA%E4%BA%9B%E6%83%85%E5%86%B5%E4%B8%8BSpring%E6%97%A0%E6%B3%95%E8%A7%A3%E5%86%B3%E5%BE%AA%E7%8E%AF%E4%BE%9D%E8%B5%96%EF%BC%9F"><span class="toc-text">å“ªäº›æƒ…å†µä¸‹Springæ— æ³•è§£å†³å¾ªçŽ¯ä¾èµ–ï¼Ÿ</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#16-%F0%9F%8C%9F%E8%AF%B4%E4%B8%80%E8%AF%B4%E4%BB%80%E4%B9%88%E6%98%AFIoC%EF%BC%9F"><span class="toc-text">16.ðŸŒŸè¯´ä¸€è¯´ä»€ä¹ˆæ˜¯IoCï¼Ÿ</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#DI%E5%92%8CIoC%E7%9A%84%E5%8C%BA%E5%88%AB%E4%BA%86%E8%A7%A3%E5%90%97%EF%BC%9F"><span class="toc-text">DIå’ŒIoCçš„åŒºåˆ«äº†è§£å—ï¼Ÿ</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E4%B8%BA%E4%BB%80%E4%B9%88%E8%A6%81%E4%BD%BF%E7%94%A8-IoC-%E5%91%A2%EF%BC%9F"><span class="toc-text">ä¸ºä»€ä¹ˆè¦ä½¿ç”¨ IoC å‘¢ï¼Ÿ</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#19-%F0%9F%8C%9F%E9%A1%B9%E7%9B%AE%E5%90%AF%E5%8A%A8%E6%97%B6Spring%E7%9A%84IoC%E4%BC%9A%E5%81%9A%E4%BB%80%E4%B9%88%EF%BC%9F"><span class="toc-text">19.ðŸŒŸé¡¹ç›®å¯åŠ¨æ—¶Springçš„IoCä¼šåšä»€ä¹ˆï¼Ÿ</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E8%AF%B4%E8%AF%B4Spring%E7%9A%84Bean%E5%AE%9E%E4%BE%8B%E5%8C%96%E6%96%B9%E5%BC%8F%EF%BC%9F"><span class="toc-text">è¯´è¯´Springçš„Beanå®žä¾‹åŒ–æ–¹å¼ï¼Ÿ</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#20-%F0%9F%8C%9F%E8%AF%B4%E8%AF%B4%E4%BB%80%E4%B9%88%E6%98%AF-AOP%EF%BC%9F"><span class="toc-text">20.ðŸŒŸè¯´è¯´ä»€ä¹ˆæ˜¯ AOPï¼Ÿ</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#Spring-AOP-%E6%9C%89%E5%93%AA%E4%BA%9B%E6%A0%B8%E5%BF%83%E6%A6%82%E5%BF%B5%EF%BC%9F"><span class="toc-text">Spring AOP æœ‰å“ªäº›æ ¸å¿ƒæ¦‚å¿µï¼Ÿ</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Spring-AOP-%E7%BB%87%E5%85%A5%E6%9C%89%E5%93%AA%E5%87%A0%E7%A7%8D%E6%96%B9%E5%BC%8F%EF%BC%9F"><span class="toc-text">Spring AOP ç»‡å…¥æœ‰å“ªå‡ ç§æ–¹å¼ï¼Ÿ</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#AspectJ-%E6%98%AF%E4%BB%80%E4%B9%88%EF%BC%9F"><span class="toc-text">AspectJ æ˜¯ä»€ä¹ˆï¼Ÿ</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Spring-AOP-%E6%9C%89%E5%93%AA%E4%BA%9B%E9%80%9A%E7%9F%A5%E6%96%B9%E5%BC%8F%EF%BC%9F"><span class="toc-text">Spring AOP æœ‰å“ªäº›é€šçŸ¥æ–¹å¼ï¼Ÿ</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Spring-AOP-%E5%8F%91%E7%94%9F%E5%9C%A8%E4%BB%80%E4%B9%88%E6%97%B6%E5%80%99%EF%BC%9F"><span class="toc-text">Spring AOP å‘ç”Ÿåœ¨ä»€ä¹ˆæ—¶å€™ï¼Ÿ</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E7%AE%80%E5%8D%95%E6%80%BB%E7%BB%93%E4%B8%80%E4%B8%8B-AOP"><span class="toc-text">ç®€å•æ€»ç»“ä¸€ä¸‹ AOP</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#AOP%E5%92%8C-OOP-%E7%9A%84%E5%85%B3%E7%B3%BB%EF%BC%9F"><span class="toc-text">AOPå’Œ OOP çš„å…³ç³»ï¼Ÿ</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#21-%F0%9F%8C%9FAOP%E7%9A%84%E5%BA%94%E7%94%A8%E5%9C%BA%E6%99%AF%E6%9C%89%E5%93%AA%E4%BA%9B%EF%BC%9F"><span class="toc-text">21.ðŸŒŸAOPçš„åº”ç”¨åœºæ™¯æœ‰å“ªäº›ï¼Ÿ</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#24-%F0%9F%8C%9F%E8%AF%B4%E8%AF%B4JDK%E5%8A%A8%E6%80%81%E4%BB%A3%E7%90%86%E5%92%8CCGLIB%E4%BB%A3%E7%90%86%E7%9A%84%E5%8C%BA%E5%88%AB%EF%BC%9F"><span class="toc-text">24.ðŸŒŸè¯´è¯´JDKåŠ¨æ€ä»£ç†å’ŒCGLIBä»£ç†çš„åŒºåˆ«ï¼Ÿ</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E9%80%89%E6%8B%A9-CGLIB-%E8%BF%98%E6%98%AF-JDK-%E5%8A%A8%E6%80%81%E4%BB%A3%E7%90%86%EF%BC%9F"><span class="toc-text">é€‰æ‹© CGLIB è¿˜æ˜¯ JDK åŠ¨æ€ä»£ç†ï¼Ÿ</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E4%BD%A0%E4%BC%9A%E7%94%A8-JDK-%E5%8A%A8%E6%80%81%E4%BB%A3%E7%90%86%E5%90%97%EF%BC%9F"><span class="toc-text">ä½ ä¼šç”¨ JDK åŠ¨æ€ä»£ç†å—ï¼Ÿ</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E4%BD%A0%E4%BC%9A%E7%94%A8-CGLIB-%E5%8A%A8%E6%80%81%E4%BB%A3%E7%90%86%E5%90%97%EF%BC%9F"><span class="toc-text">ä½ ä¼šç”¨ CGLIB åŠ¨æ€ä»£ç†å—ï¼Ÿ</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#25-%F0%9F%8C%9F%E8%AF%B4%E8%AF%B4%E4%BD%A0%E5%AF%B9Spring%E4%BA%8B%E5%8A%A1%E7%9A%84%E7%90%86%E8%A7%A3%EF%BC%9F"><span class="toc-text">25.ðŸŒŸè¯´è¯´ä½ å¯¹Springäº‹åŠ¡çš„ç†è§£ï¼Ÿ</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#29-%F0%9F%8C%9F%E8%AF%B4%E8%AF%B4Spring%E7%9A%84%E4%BA%8B%E5%8A%A1%E4%BC%A0%E6%92%AD%E6%9C%BA%E5%88%B6%EF%BC%9F"><span class="toc-text">29.ðŸŒŸè¯´è¯´Springçš„äº‹åŠ¡ä¼ æ’­æœºåˆ¶ï¼Ÿ</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E4%BA%8B%E5%8A%A1%E8%83%BD%E5%9C%A8%E6%96%B0%E7%BA%BF%E7%A8%8B%E4%B8%AD%E4%BC%A0%E6%92%AD%E5%90%97%EF%BC%9F"><span class="toc-text">äº‹åŠ¡èƒ½åœ¨æ–°çº¿ç¨‹ä¸­ä¼ æ’­å—ï¼Ÿ</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#protected-%E5%92%8C-private-%E6%96%B9%E6%B3%95%E5%8A%A0%E4%BA%8B%E5%8A%A1%E4%BC%9A%E7%94%9F%E6%95%88%E5%90%97%EF%BC%9F"><span class="toc-text">protected å’Œ private æ–¹æ³•åŠ äº‹åŠ¡ä¼šç”Ÿæ•ˆå—ï¼Ÿ</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#31-%F0%9F%8C%9FSpring-MVC-%E7%9A%84%E5%B7%A5%E4%BD%9C%E6%B5%81%E7%A8%8B%E4%BA%86%E8%A7%A3%E5%90%97%EF%BC%9F"><span class="toc-text">31.ðŸŒŸSpring MVC çš„å·¥ä½œæµç¨‹äº†è§£å—ï¼Ÿ</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E4%B8%BA%E4%BB%80%E4%B9%88%E8%BF%98%E9%9C%80%E8%A6%81-HandlerAdapter%EF%BC%9F"><span class="toc-text">ä¸ºä»€ä¹ˆè¿˜éœ€è¦ HandlerAdapterï¼Ÿ</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#33-%F0%9F%8C%9F%E4%BB%8B%E7%BB%8D%E4%B8%80%E4%B8%8B-SpringBoot%EF%BC%9F"><span class="toc-text">33.ðŸŒŸä»‹ç»ä¸€ä¸‹ SpringBootï¼Ÿ</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#Spring-Boot%E5%B8%B8%E7%94%A8%E6%B3%A8%E8%A7%A3%E6%9C%89%E5%93%AA%E4%BA%9B%EF%BC%9F"><span class="toc-text">Spring Bootå¸¸ç”¨æ³¨è§£æœ‰å“ªäº›ï¼Ÿ</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#34-%F0%9F%8C%9FSpring-Boot%E7%9A%84%E8%87%AA%E5%8A%A8%E8%A3%85%E9%85%8D%E5%8E%9F%E7%90%86%E4%BA%86%E8%A7%A3%E5%90%97%EF%BC%9F"><span class="toc-text">34.ðŸŒŸSpring Bootçš„è‡ªåŠ¨è£…é…åŽŸç†äº†è§£å—ï¼Ÿ</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#35-%F0%9F%8C%9F%E5%A6%82%E4%BD%95%E8%87%AA%E5%AE%9A%E4%B9%89%E4%B8%80%E4%B8%AA-SpringBoot-Starter"><span class="toc-text">35.ðŸŒŸå¦‚ä½•è‡ªå®šä¹‰ä¸€ä¸ª SpringBoot Starter?</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#Spring-Boot-Starter-%E7%9A%84%E5%8E%9F%E7%90%86%E4%BA%86%E8%A7%A3%E5%90%97%EF%BC%9F"><span class="toc-text">Spring Boot Starter çš„åŽŸç†äº†è§£å—ï¼Ÿ</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#36-%F0%9F%8C%9FSpring-Boot-%E5%90%AF%E5%8A%A8%E5%8E%9F%E7%90%86%E4%BA%86%E8%A7%A3%E5%90%97%EF%BC%9F"><span class="toc-text">36.ðŸŒŸSpring Boot å¯åŠ¨åŽŸç†äº†è§£å—ï¼Ÿ</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E8%A6%81%E5%9C%A8%E5%90%AF%E5%8A%A8%E9%98%B6%E6%AE%B5%E8%87%AA%E5%AE%9A%E4%B9%89%E9%80%BB%E8%BE%91%E8%AF%A5%E6%80%8E%E4%B9%88%E5%81%9A%EF%BC%9F"><span class="toc-text">è¦åœ¨å¯åŠ¨é˜¶æ®µè‡ªå®šä¹‰é€»è¾‘è¯¥æ€Žä¹ˆåšï¼Ÿ</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E4%B8%BA%E4%BB%80%E4%B9%88-Spring-Boot-%E5%9C%A8%E5%90%AF%E5%8A%A8%E7%9A%84%E6%97%B6%E5%80%99%E8%83%BD%E5%A4%9F%E6%89%BE%E5%88%B0-main-%E6%96%B9%E6%B3%95%E4%B8%8A%E7%9A%84-SpringBootApplication-%E6%B3%A8%E8%A7%A3%EF%BC%9F"><span class="toc-text">ä¸ºä»€ä¹ˆ Spring Boot åœ¨å¯åŠ¨çš„æ—¶å€™èƒ½å¤Ÿæ‰¾åˆ° main æ–¹æ³•ä¸Šçš„@SpringBootApplication æ³¨è§£ï¼Ÿ</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Spring-Boot-%E9%BB%98%E8%AE%A4%E7%9A%84%E5%8C%85%E6%89%AB%E6%8F%8F%E8%B7%AF%E5%BE%84%E6%98%AF%E4%BB%80%E4%B9%88%EF%BC%9F"><span class="toc-text">Spring Boot é»˜è®¤çš„åŒ…æ‰«æè·¯å¾„æ˜¯ä»€ä¹ˆï¼Ÿ</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F"><span class="toc-text">æ“ä½œç³»ç»Ÿ</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C"><span class="toc-text">è®¡ç®—æœºç½‘ç»œ</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%F0%9F%8C%9F18-%E8%AF%B4%E8%AF%B4-HTTP-%E4%B8%8E-HTTPS-%E6%9C%89%E5%93%AA%E4%BA%9B%E5%8C%BA%E5%88%AB%EF%BC%9F"><span class="toc-text">ðŸŒŸ18.è¯´è¯´ HTTP ä¸Ž HTTPS æœ‰å“ªäº›åŒºåˆ«ï¼Ÿ</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%F0%9F%8C%9F25-TCP-%E6%8F%A1%E6%89%8B%E4%B8%BA%E4%BB%80%E4%B9%88%E6%98%AF%E4%B8%89%E6%AC%A1%EF%BC%8C%E4%B8%BA%E4%BB%80%E4%B9%88%E4%B8%8D%E8%83%BD%E6%98%AF%E4%B8%A4%E6%AC%A1%EF%BC%9F%E4%B8%8D%E8%83%BD%E6%98%AF%E5%9B%9B%E6%AC%A1%EF%BC%9F"><span class="toc-text">ðŸŒŸ25.TCP æ¡æ‰‹ä¸ºä»€ä¹ˆæ˜¯ä¸‰æ¬¡ï¼Œä¸ºä»€ä¹ˆä¸èƒ½æ˜¯ä¸¤æ¬¡ï¼Ÿä¸èƒ½æ˜¯å››æ¬¡ï¼Ÿ</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E4%B8%BA%E4%BB%80%E4%B9%88-TCP-%E6%8F%A1%E6%89%8B%E4%B8%8D%E8%83%BD%E6%98%AF%E4%B8%A4%E6%AC%A1%EF%BC%9F"><span class="toc-text">ä¸ºä»€ä¹ˆ TCP æ¡æ‰‹ä¸èƒ½æ˜¯ä¸¤æ¬¡ï¼Ÿ</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E4%B8%BA%E4%BB%80%E4%B9%88%E4%B8%8D%E6%98%AF%E5%9B%9B%E6%AC%A1%EF%BC%9F"><span class="toc-text">ä¸ºä»€ä¹ˆä¸æ˜¯å››æ¬¡ï¼Ÿ</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E4%BB%80%E4%B9%88%E6%98%AF%E6%B3%9B%E6%B4%AA%E6%94%BB%E5%87%BB%EF%BC%9F"><span class="toc-text">ä»€ä¹ˆæ˜¯æ³›æ´ªæ”»å‡»ï¼Ÿ</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%A6%82%E6%9E%9C%E8%AE%A9%E4%BD%A0%E9%87%8D%E6%96%B0%E8%AE%BE%E8%AE%A1%EF%BC%8C%E6%80%8E%E4%B9%88%E8%AE%BE%E8%AE%A1%EF%BC%9F"><span class="toc-text">å¦‚æžœè®©ä½ é‡æ–°è®¾è®¡ï¼Œæ€Žä¹ˆè®¾è®¡ï¼Ÿ</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%F0%9F%8C%9F30-%E8%AF%B4%E8%AF%B4-TCP-%E5%9B%9B%E6%AC%A1%E6%8C%A5%E6%89%8B%E7%9A%84%E8%BF%87%E7%A8%8B%EF%BC%9F"><span class="toc-text">ðŸŒŸ30.è¯´è¯´ TCP å››æ¬¡æŒ¥æ‰‹çš„è¿‡ç¨‹ï¼Ÿ</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%F0%9F%8C%9F31-TCP-%E6%8C%A5%E6%89%8B%E4%B8%BA%E4%BB%80%E4%B9%88%E9%9C%80%E8%A6%81%E5%9B%9B%E6%AC%A1%E5%91%A2%EF%BC%9F"><span class="toc-text">ðŸŒŸ31.TCP æŒ¥æ‰‹ä¸ºä»€ä¹ˆéœ€è¦å››æ¬¡å‘¢ï¼Ÿ</span></a></li></ol></li></ol></div><div class="widget-footer">

<a class="top" onclick="util.scrollTop()"><svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" viewBox="0 0 24 24"><g fill="none" stroke="currentColor" stroke-width="1.5"><path d="M2 12c0-4.714 0-7.071 1.464-8.536C4.93 2 7.286 2 12 2c4.714 0 7.071 0 8.535 1.464C22 4.93 22 7.286 22 12c0 4.714 0 7.071-1.465 8.535C19.072 22 16.714 22 12 22s-7.071 0-8.536-1.465C2 19.072 2 16.714 2 12Z"/><path stroke-linecap="round" stroke-linejoin="round" d="m9 15.5l3-3l3 3m-6-4l3-3l3 3"/></g></svg><span>å›žåˆ°é¡¶éƒ¨</span></a></div></widget>
</div></aside><div class='float-panel blur'>
  <button type='button' style='display:none' class='laptop-only rightbar-toggle mobile' onclick='sidebar.rightbar()'>
    <svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" viewBox="0 0 24 24"><path fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10 6h11m-11 6h11m-11 6h11M4 6h1v4m-1 0h2m0 8H4c0-1 2-2 2-3s-1-1.5-2-1"/></svg>
  </button>
  <button type='button' style='display:none' class='mobile-only leftbar-toggle mobile' onclick='sidebar.leftbar()'>
    <svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" viewBox="0 0 24 24"><g fill="none" stroke="currentColor" stroke-width="1.5"><path d="M2 11c0-3.771 0-5.657 1.172-6.828C4.343 3 6.229 3 10 3h4c3.771 0 5.657 0 6.828 1.172C22 5.343 22 7.229 22 11v2c0 3.771 0 5.657-1.172 6.828C19.657 21 17.771 21 14 21h-4c-3.771 0-5.657 0-6.828-1.172C2 18.657 2 16.771 2 13z"/><path id="sep" stroke-linecap="round" d="M5.5 10h6m-5 4h4m4.5 7V3"/></g></svg>
  </button>
</div>
</div><div class="scripts">
<script type="text/javascript">
  const ctx = {
    date_suffix: {
      just: `åˆšåˆš`,
      min: `åˆ†é’Ÿå‰`,
      hour: `å°æ—¶å‰`,
      day: `å¤©å‰`,
    },
    root : `/`,
    tag_plugins: {
      chat: Object.assign({"api":"https://siteinfo.listentothewind.cn/api/v1"}),
    }
  };

  // required plugins (only load if needs)
  if (`local_search`) {
    ctx.search = {};
    ctx.search.service = `local_search`;
    if (ctx.search.service == 'local_search') {
      let service_obj = Object.assign({}, `{"field":"all","path":"/search.json","content":true,"skip_search":null,"sort":"-date"}`);
      ctx.search[ctx.search.service] = service_obj;
    }
  }
  const def = {
    avatar: `https://gcore.jsdelivr.net/gh/cdn-x/placeholder@1.0.12/avatar/round/3442075.svg`,
    cover: `https://gcore.jsdelivr.net/gh/cdn-x/placeholder@1.0.12/cover/76b86c0226ffd.svg`,
  };
  const deps = {
    jquery: `https://cdn.jsdelivr.net/npm/jquery@3.7.1/dist/jquery.min.js`,
    marked: `https://cdn.jsdelivr.net/npm/marked@13.0.1/lib/marked.umd.min.js`
  }
  

</script>

<script type="text/javascript">
  function RunItem() {
    this.list = []; // å­˜æ”¾å›žè°ƒå‡½æ•°
    this.start = () => {
      for (var i = 0; i < this.list.length; i++) {
        this.list[i].run();
      }
    };
    this.push = (fn, name, setRequestAnimationFrame = true) => {
      let myfn = fn
      if (setRequestAnimationFrame) {
        myfn = () => {
          utils.requestAnimationFrame(fn)
        }
      }
      var f = new Item(myfn, name);
      this.list.push(f);
    };
    this.remove = (name) => {
      for (let index = 0; index < this.list.length; index++) {
        const e = this.list[index];
        if (e.name == name) {
          this.list.splice(index, 1);
        }
      }
    }
    // æž„é€ ä¸€ä¸ªå¯ä»¥runçš„å¯¹è±¡
    function Item(fn, name) {
      // å‡½æ•°åç§°
      this.name = name || fn.name;
      // runæ–¹æ³•
      this.run = () => {
        try {
          fn()
        } catch (error) {
          console.log(error);
        }
      };
    }
  }

  const utils = {
    // æ‡’åŠ è½½ css https://github.com/filamentgroup/loadCSS
    css: (href, before, media, attributes) => {
      var doc = window.document;
      var ss = doc.createElement("link");
      var ref;
      if (before) {
        ref = before;
      } else {
        var refs = (doc.body || doc.getElementsByTagName("head")[0]).childNodes;
        ref = refs[refs.length - 1];
      }
      var sheets = doc.styleSheets;
      if (attributes) {
        for (var attributeName in attributes) {
          if (attributes.hasOwnProperty(attributeName)) {
            ss.setAttribute(attributeName, attributes[attributeName]);
          }
        }
      }
      ss.rel = "stylesheet";
      ss.href = href;
      ss.media = "only x";
      function ready(cb) {
        if (doc.body) {
          return cb();
        }
        setTimeout(function () {
          ready(cb);
        });
      }
      ready(function () {
        ref.parentNode.insertBefore(ss, before ? ref : ref.nextSibling);
      });
      var onloadcssdefined = function (cb) {
        var resolvedHref = ss.href;
        var i = sheets.length;
        while (i--) {
          if (sheets[i].href === resolvedHref) {
            return cb();
          }
        }
        setTimeout(function () {
          onloadcssdefined(cb);
        });
      };
      function loadCB() {
        if (ss.addEventListener) {
          ss.removeEventListener("load", loadCB);
        }
        ss.media = media || "all";
      }
      if (ss.addEventListener) {
        ss.addEventListener("load", loadCB);
      }
      ss.onloadcssdefined = onloadcssdefined;
      onloadcssdefined(loadCB);
      return ss;
    },

    js: (src, opt) => new Promise((resolve, reject) => {
      var script = document.createElement('script');
      if (src.startsWith('/')) {
        src = ctx.root + src.substring(1);
      }
      script.src = src;
      if (opt) {
        for (let key of Object.keys(opt)) {
          script[key] = opt[key]
        }
      } else {
        // é»˜è®¤å¼‚æ­¥ï¼Œå¦‚æžœéœ€è¦åŒæ­¥ï¼Œç¬¬äºŒä¸ªå‚æ•°ä¼ å…¥ {} å³å¯
        script.async = true
      }
      script.onerror = reject
      script.onload = script.onreadystatechange = function () {
        const loadState = this.readyState
        if (loadState && loadState !== 'loaded' && loadState !== 'complete') return
        script.onload = script.onreadystatechange = null
        resolve()
      }
      document.head.appendChild(script)
    }),

    jq: (fn) => {
      if (typeof jQuery === 'undefined') {
        utils.js(deps.jquery).then(fn)
      } else {
        fn()
      }
    },

    onLoading: (el) => {
      if (el) {
        $(el).append('<div class="loading-wrap"><svg xmlns="http://www.w3.org/2000/svg" width="2em" height="2em" preserveAspectRatio="xMidYMid meet" viewBox="0 0 24 24"><g fill="none" stroke="currentColor" stroke-linecap="round" stroke-width="2"><path stroke-dasharray="60" stroke-dashoffset="60" stroke-opacity=".3" d="M12 3C16.9706 3 21 7.02944 21 12C21 16.9706 16.9706 21 12 21C7.02944 21 3 16.9706 3 12C3 7.02944 7.02944 3 12 3Z"><animate fill="freeze" attributeName="stroke-dashoffset" dur="1.3s" values="60;0"/></path><path stroke-dasharray="15" stroke-dashoffset="15" d="M12 3C16.9706 3 21 7.02944 21 12"><animate fill="freeze" attributeName="stroke-dashoffset" dur="0.3s" values="15;0"/><animateTransform attributeName="transform" dur="1.5s" repeatCount="indefinite" type="rotate" values="0 12 12;360 12 12"/></path></g></svg></div>');
      }
    },
    onLoadSuccess: (el) => {
      if (el) {
        $(el).find('.loading-wrap').remove();
      }
    },
    onLoadFailure: (el) => {
      if (el) {
        $(el).find('.loading-wrap svg').remove();
        $(el).find('.loading-wrap').append('<svg xmlns="http://www.w3.org/2000/svg" width="2em" height="2em" preserveAspectRatio="xMidYMid meet" viewBox="0 0 24 24"><g fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2"><path stroke-dasharray="60" stroke-dashoffset="60" d="M12 3L21 20H3L12 3Z"><animate fill="freeze" attributeName="stroke-dashoffset" dur="0.5s" values="60;0"/></path><path stroke-dasharray="6" stroke-dashoffset="6" d="M12 10V14"><animate fill="freeze" attributeName="stroke-dashoffset" begin="0.6s" dur="0.2s" values="6;0"/></path></g><circle cx="12" cy="17" r="1" fill="currentColor" fill-opacity="0"><animate fill="freeze" attributeName="fill-opacity" begin="0.8s" dur="0.4s" values="0;1"/></circle></svg>');
        $(el).find('.loading-wrap').addClass('error');
      }
    },
    request: (el, url, callback, onFailure) => {
      let retryTimes = 3;
      utils.onLoading(el);
      function req() {
        return new Promise((resolve, reject) => {
          let status = 0; // 0 ç­‰å¾… 1 å®Œæˆ 2 è¶…æ—¶
          let timer = setTimeout(() => {
            if (status === 0) {
              status = 2;
              timer = null;
              reject('è¯·æ±‚è¶…æ—¶');
              if (retryTimes == 0) {
                onFailure();
              }
            }
          }, 5000);
          fetch(url).then(function (response) {
            if (status !== 2) {
              clearTimeout(timer);
              resolve(response);
              timer = null;
              status = 1;
            }
            if (response.ok) {
              return response.json();
            }
            throw new Error('Network response was not ok.');
          }).then(function (data) {
            retryTimes = 0;
            utils.onLoadSuccess(el);
            callback(data);
          }).catch(function (error) {
            if (retryTimes > 0) {
              retryTimes -= 1;
              setTimeout(() => {
                req();
              }, 5000);
            } else {
              utils.onLoadFailure(el);
              onFailure();
            }
          });
        });
      }
      req();
    },
    /********************** requestAnimationFrame ********************************/
    // 1ã€requestAnimationFrame ä¼šæŠŠæ¯ä¸€å¸§ä¸­çš„æ‰€æœ‰ DOM æ“ä½œé›†ä¸­èµ·æ¥ï¼Œåœ¨ä¸€æ¬¡é‡ç»˜æˆ–å›žæµä¸­å°±å®Œæˆï¼Œå¹¶ä¸”é‡ç»˜æˆ–å›žæµçš„æ—¶é—´é—´éš”ç´§ç´§è·Ÿéšæµè§ˆå™¨çš„åˆ·æ–°é¢‘çŽ‡ï¼Œä¸€èˆ¬æ¥è¯´ï¼Œè¿™ä¸ªé¢‘çŽ‡ä¸ºæ¯ç§’60å¸§ã€‚
    // 2ã€åœ¨éšè—æˆ–ä¸å¯è§çš„å…ƒç´ ä¸­ï¼ŒrequestAnimationFrame å°†ä¸ä¼šè¿›è¡Œé‡ç»˜æˆ–å›žæµï¼Œè¿™å½“ç„¶å°±æ„å‘³ç€æ›´å°‘çš„çš„ cpuï¼Œgpu å’Œå†…å­˜ä½¿ç”¨é‡ã€‚
    requestAnimationFrame: (fn) => {
      if (!window.requestAnimationFrame) {
        window.requestAnimationFrame = window.requestAnimationFrame || window.mozRequestAnimationFrame || window.webkitRequestAnimationFrame;
      }
      window.requestAnimationFrame(fn)
    },
    dark: {},
  };

  // utils.dark.mode å½“å‰æ¨¡å¼ dark or light
  // utils.dark.toggle() æš—é»‘æ¨¡å¼è§¦å‘å™¨
  // utils.dark.push(callBack[,"callBackName"]) ä¼ å…¥è§¦å‘å™¨å›žè°ƒå‡½æ•°
  utils.dark.method = {
    toggle: new RunItem(),
  };
  utils.dark = Object.assign(utils.dark, {
    push: utils.dark.method.toggle.push,
  });
</script>
<script>
  const sidebar = {
    leftbar: () => {
      if (l_body) {
        l_body.toggleAttribute('leftbar');
        l_body.removeAttribute('rightbar');
      }
    },
    rightbar: () => {
      if (l_body) {
        l_body.toggleAttribute('rightbar');
        l_body.removeAttribute('leftbar');
      }
    },
    dismiss: () => {
      if (l_body) {
        l_body.removeAttribute('leftbar');
        l_body.removeAttribute('rightbar');
      }
    },
    toggleTOC: () => {
      document.querySelector('#data-toc').classList.toggle('collapse');
    }
  }
</script>
<script type="text/javascript">
  (() => {
    const tagSwitchers = document.querySelectorAll('.tag-subtree.parent-tag > a > .tag-switcher-wrapper')
    for (const tagSwitcher of tagSwitchers) {
      tagSwitcher.addEventListener('click', (e) => {
        const parent = e.target.closest('.tag-subtree.parent-tag')
        parent.classList.toggle('expanded')
        e.preventDefault()
      })
    }

    // Get active tag from query string, then activate it.
    const urlParams = new URLSearchParams(window.location.search)
    const activeTag = urlParams.get('tag')
    if (activeTag) {
      let tag = document.querySelector(`.tag-subtree[data-tag="${activeTag}"]`)
      if (tag) {
        tag.querySelector('a').classList.add('active')
        
        while (tag) {
          tag.classList.add('expanded')
          tag = tag.parentElement.closest('.tag-subtree.parent-tag')
        }
      }
    }
  })()
</script>


<!-- required -->
<script src="/js/main.js?v=1.30.0" defer></script>

<script type="text/javascript">
  const applyTheme = (theme) => {
    if (theme === 'auto') {
      document.documentElement.removeAttribute('data-theme')
    } else {
      document.documentElement.setAttribute('data-theme', theme)
    }

    applyThemeToGiscus(theme)
  }

  const applyThemeToGiscus = (theme) => {
    theme = theme === 'auto' ? 'preferred_color_scheme' : theme

    const cmt = document.getElementById('giscus')
    if (cmt) {
      // This works before giscus load.
      cmt.setAttribute('data-theme', theme)
    }

    const iframe = document.querySelector('#comments > section.giscus > iframe')
    if (iframe) {
      // This works after giscus loaded.
      const src = iframe.src
      const newSrc = src.replace(/theme=[\w]+/, `theme=${theme}`)
      iframe.src = newSrc
    }
  }

  const switchTheme = () => {
    // light -> dark -> auto -> light -> ...
    const currentTheme = document.documentElement.getAttribute('data-theme')
    let newTheme;
    switch (currentTheme) {
      case 'light':
        newTheme = 'dark'
        break
      case 'dark':
        newTheme = 'auto'
        break
      default:
        newTheme = 'light'
    }
    applyTheme(newTheme)
    window.localStorage.setItem('Stellar.theme', newTheme)
    utils.dark.mode = newTheme === 'auto' ? (window.matchMedia("(prefers-color-scheme: dark)").matches ? "dark" : "light") : newTheme;
    utils.dark.method.toggle.start();

    const messages = {
      light: `åˆ‡æ¢åˆ°æµ…è‰²æ¨¡å¼`,
      dark: `åˆ‡æ¢åˆ°æ·±è‰²æ¨¡å¼`,
      auto: `åˆ‡æ¢åˆ°è·Ÿéšç³»ç»Ÿé…è‰²`,
    }
    hud?.toast?.(messages[newTheme])
  }

  (() => {
    // Apply user's preferred theme, if any.
    const theme = window.localStorage.getItem('Stellar.theme')
    if (theme !== null) {
      applyTheme(theme)
    } else {
      utils.dark.mode = window.matchMedia("(prefers-color-scheme: dark)").matches ? "dark" : "light";
    }
    utils.dark.method.toggle.start();
  })()
</script>


<!-- optional -->



<script defer>
  window.addEventListener('DOMContentLoaded', (event) => {
    ctx.services = Object.assign({}, JSON.parse(`{"mdrender":{"js":"/js/services/mdrender.js"},"siteinfo":{"js":"/js/services/siteinfo.js","api":null},"ghinfo":{"js":"/js/services/ghinfo.js"},"sites":{"js":"/js/services/sites.js"},"friends":{"js":"/js/services/friends.js"},"friends_and_posts":{"js":"/js/services/friends_and_posts.js"},"timeline":{"js":"/js/services/timeline.js"},"fcircle":{"js":"/js/services/fcircle.js"},"weibo":{"js":"/js/services/weibo.js"},"memos":{"js":"/js/services/memos.js"},"voice":{"js":"/js/plugins/voice.js"},"video":{"js":"/js/plugins/video.js"},"download-file":{"js":"/js/plugins/download-file.js"},"twikoo":{"js":"/js/services/twikoo_latest_comment.js"},"waline":{"js":"/js/services/waline_latest_comment.js"},"artalk":{"js":"/js/services/artalk_latest_comment.js"},"giscus":{"js":"/js/services/giscus_latest_comment.js"}}`));
    for (let id of Object.keys(ctx.services)) {
      const js = ctx.services[id].js;
      if (id == 'siteinfo') {
        ctx.cardlinks = document.querySelectorAll('a.link-card[cardlink]');
        if (ctx.cardlinks?.length > 0) {
          utils.js(js, { defer: true }).then(function () {
            setCardLink(ctx.cardlinks);
          });
        }
      } else if (id == 'voice') {
        ctx.voiceAudios = document.querySelectorAll('.voice>audio');
        if (ctx.voiceAudios?.length > 0) {
          utils.js(js, { defer: true }).then(function () {
            createVoiceDom(ctx.voiceAudios);
          });
        }
      } else if (id == 'video') {
        ctx.videos = document.querySelectorAll('.video>video');
        if (ctx.videos?.length > 0) {
          utils.js(js, { defer: true }).then(function () {
            videoEvents(ctx.videos);
          });
        }
      } else if (id == 'download-file') {
        ctx.files = document.querySelectorAll('.file');
        if (ctx.files?.length > 0) {
          utils.js(js, { defer: true }).then(function () {
            downloadFileEvent(ctx.files);
          });
        }
      } else {
        const els = document.getElementsByClassName(`ds-${id}`);
        if (els?.length > 0) {
          utils.jq(() => {
            if (id == 'timeline' || 'memos' || 'marked') {
              utils.js(deps.marked).then(function () {
                utils.js(js, { defer: true });
              });
            } else {
              utils.js(js, { defer: true });
            }
          });
        }
      }
    }

    // chat iphone time
    let phoneTimes = document.querySelectorAll('.chat .status-bar .time');

    if (phoneTimes.length > 0) {
      NowTime();
      var date = new Date();
      var sec = date.getSeconds();
      var firstAdjustInterval = setInterval(firstAdjustTime, 1000 * (60 - sec));
    }

    function firstAdjustTime() {
      NowTime();
      clearInterval(firstAdjustInterval);
      setInterval(NowTime, 1000 * 60);
    }

    function NowTime() {
      for (let i = 0; i < phoneTimes.length; ++i) {
        var timeSpan = phoneTimes[i];
        var date = new Date();
        var hour = date.getHours();
        var min = date.getMinutes();
        timeSpan.innerHTML = check(hour) + ":" + check(min);
      }
    };

    function check(val) {
      if (val < 10) {
        return ("0" + val);
      }
      return (val);
    }

    // chat quote
    const chat_quote_obverser = new IntersectionObserver((entries, observer) => {
      entries.filter((entry) => { return entry.isIntersecting }).sort((a, b) => a.intersectionRect.y !== b.intersectionRect.y ? a.intersectionRect.y - b.intersectionRect.y : a.intersectionRect.x - b.intersectionRect.x).forEach((entry, index) => {
          observer.unobserve(entry.target);
          setTimeout(() => {
            entry.target.classList.add('quote-blink');
            setTimeout(() => {
              entry.target.classList.remove('quote-blink');
            }, 1000);
          }, Math.max(100, 16) * (index + 1));
        });
    });

    var chatQuotes = document.querySelectorAll(".chat .talk .quote");
    chatQuotes.forEach((quote) => {
      quote.addEventListener('click', function () {
        var chatCellDom = document.getElementById("quote-" + quote.getAttribute("quotedCellTag"));
        if (chatCellDom) {
          var chatDiv = chatCellDom.parentElement;
          var mid = chatDiv.clientHeight / 2;
          var offsetTop = chatCellDom.offsetTop;
          if (offsetTop > mid - chatCellDom.clientHeight / 2) {
            chatDiv.scrollTo({
              top: chatCellDom.offsetTop - mid + chatCellDom.clientHeight / 2,
              behavior: "smooth"
            });
          } else {
            chatDiv.scrollTo({
              top: 0,
              behavior: "smooth"
            });
          }
          chat_quote_obverser.observe(chatCellDom);
        }
      });
    });
  });
</script>

<script>
  window.addEventListener('DOMContentLoaded', (event) => {
    ctx.search = {
      path: `/search.json`,
    }
    utils.js('/js/search/local-search.js', { defer: true });
  });
</script><script>
  window.FPConfig = {
    delay: 0,
    ignoreKeywords: [],
    maxRPS: 5,
    hoverDelay: 25
  };
</script>
<script defer src="https://cdn.jsdelivr.net/npm/flying-pages@2/flying-pages.min.js"></script><script defer src="https://cdn.jsdelivr.net/npm/vanilla-lazyload@19.1.3/dist/lazyload.min.js"></script>
<script>
  // https://www.npmjs.com/package/vanilla-lazyload
  // Set the options globally
  // to make LazyLoad self-initialize
  window.lazyLoadOptions = {
    elements_selector: ".lazy",
  };
  // Listen to the initialization event
  // and get the instance of LazyLoad
  window.addEventListener(
    "LazyLoad::Initialized",
    function (event) {
      window.lazyLoadInstance = event.detail.instance;
    },
    false
  );
  document.addEventListener('DOMContentLoaded', function () {
    window.lazyLoadInstance?.update();
  });
</script><script>
  ctx.fancybox = {
    selector: `.timenode p>img`,
    css: `https://cdn.jsdelivr.net/npm/@fancyapps/ui@5.0/dist/fancybox/fancybox.css`,
    js: `https://cdn.jsdelivr.net/npm/@fancyapps/ui@5.0/dist/fancybox/fancybox.umd.js`
  };
  var selector = '[data-fancybox]:not(.error)';
  if (ctx.fancybox.selector) {
    selector += `, ${ctx.fancybox.selector}`
  }
  var needFancybox = document.querySelectorAll(selector).length !== 0;
  if (!needFancybox) {
    const els = document.getElementsByClassName('ds-memos');
    if (els != undefined && els.length > 0) {
      needFancybox = true;
    }
  }
  if (needFancybox) {
    utils.css(ctx.fancybox.css);
    utils.js(ctx.fancybox.js, { defer: true }).then(function () {
      Fancybox.bind(selector, {
        hideScrollbar: false,
        Thumbs: {
          autoStart: false,
        },
        caption: (fancybox, slide) => {
          return slide.triggerEl.alt || slide.triggerEl.dataset.caption || null
        }
      });
    })
  }
</script>
<script>
  window.addEventListener('DOMContentLoaded', (event) => {
    const swiper_api = document.getElementById('swiper-api');
    if (swiper_api != undefined) {
      utils.css(`https://unpkg.com/swiper@10.3.1/swiper-bundle.min.css`);
      utils.js(`https://unpkg.com/swiper@10.3.1/swiper-bundle.min.js`, { defer: true }).then(function () {
        const effect = swiper_api.getAttribute('effect') || '';
        var swiper = new Swiper('.swiper#swiper-api', {
          slidesPerView: 'auto',
          spaceBetween: 8,
          centeredSlides: true,
          effect: effect,
          rewind: true,
          pagination: {
            el: '.swiper-pagination',
            clickable: true,
          },
          navigation: {
            nextEl: '.swiper-button-next',
            prevEl: '.swiper-button-prev',
          },
        });
      })
    }
  });
</script>
<script defer src="https://cdn.jsdelivr.net/npm/scrollreveal@4.0.9/dist/scrollreveal.min.js"></script>
<script>
  window.addEventListener('DOMContentLoaded', (event) => {
    const slideUp = {
      distance: `16px`,
      duration: `800`,
      interval: `100`,
      scale: `1`,
      opacity: 0,
      easing: "ease-out"
    };
    ScrollReveal().reveal('.l_left .slide-up', slideUp);
    ScrollReveal().reveal('.l_main .slide-up', slideUp);
    ScrollReveal().reveal('.l_right .slide-up', slideUp);
  });
</script>
<script>
  document.addEventListener('DOMContentLoaded', function () {
    window.codeElements = document.querySelectorAll('.code');
    if (window.codeElements.length > 0) {
      ctx.copycode = {
        default_text: `Copy`,
        success_text: `Copied`,
        toast: `å¤åˆ¶æˆåŠŸ`,
      };
      utils.js('/js/plugins/copycode.js');
    }
  });
</script>




<!-- inject -->

<script src="https://cdn.jsdelivr.net/npm/jquery@3.7.1/dist/jquery.min.js"></script><script src="/js/check-in.js"></script></div></body></html>
