[{"title":"2025.9.1å­¦ä¹ æ—¥è®°","path":"/2025/09/01/å­¦ä¹ æ—¥è®°25å¹´9æœˆ/2025.9.1å­¦ä¹ ç¬”è®°/","content":"ä»Šæ—¥å­¦ä¹ å†…å®¹ä»Šå¤©å›å­¦æ ¡,ç»§ç»­å­¦ä¹ ! åŠ›æ‰£æ¯æ—¥ä¸€é¢˜ä»Šå¤©çš„æ¯æ—¥ä¸€é¢˜æ˜¯ä¼˜å…ˆé˜Ÿåˆ—ç›¸å…³çš„é¢˜ç›®,æ±‚ä¸€å †ç­çº§åŠæ ¼ç‡çš„å¹³å‡å€¼æœ€å¤§,å¯ä»¥æ’å…¥å¿…è¿‡çš„åŒå­¦.æ€è·¯æ˜¯é€šè¿‡ä¼˜å…ˆé˜Ÿåˆ—,æŒ‰ç…§åŠæ ¼ç‡çš„å¢é‡æ¥è¿›è¡Œæ’åº,æ¯æ¬¡æ’å…¥å¿…è¿‡çš„åŒå­¦åˆ°å¢é‡æœ€å¤§çš„ç­çº§å½“ä¸­,è´ªå¿ƒçš„æ¥è®¡ç®—æœ€å¤§å¹³å‡å€¼.æ€è·¯å¾ˆå·§å¦™,å®ç°å°±æ˜¯ç®€å•çš„ä¼˜å…ˆé˜Ÿåˆ—ä½¿ç”¨. é…ç½®winå°å¼çš„sshå°å¼ç”µè„‘çš„sshç§˜é’¥è¿‡æœŸäº†,æ‰€ä»¥é‡æ–°é…ç½®äº†ä¸€ä¸‹,æ­¥éª¤ç®€å•è´´åœ¨ä¸‹é¢. 1. ç›´æ¥ä½¿ç”¨Git Bash2. æ‰“å¼€Git Bashï¼ˆä¸æ˜¯PowerShellï¼‰3. åœ¨å¼€å§‹èœå•æœç´¢Git Bash4. æˆ–è€…åœ¨å½“å‰æ–‡ä»¶å¤¹å³é”®é€‰æ‹©Git Bash Here5. åœ¨Git Bashä¸­æ‰§è¡Œä»¥ä¸‹å‘½ä»¤ï¼š6. ç„¶ååœ¨GitHubä¸Šæ·»åŠ SSHå¯†é’¥ï¼š7. ç™»å½•GitHub8. è¿›å…¥ Settings â†’ SSH and GPG keys9. ç‚¹å‡» New SSH key10. ç²˜è´´å…¬é’¥å†…å®¹ï¼ˆCtrl+Vï¼‰11. ç»™å¯†é’¥èµ·ä¸ªåå­—ï¼Œæ¯”å¦‚æˆ‘çš„ç”µè„‘12. ç‚¹å‡»Add SSH key win10å¯åŠ¨redisæ‰¾åˆ°rediså®‰è£…ç›®å½•redis-server.exe redis.windows.conf å¯åŠ¨redisredis-cli.exe å¯åŠ¨rediså®¢æˆ·ç«¯redis-cli.exe -p 6379 æŒ‡å®šç«¯å£å¯åŠ¨rediså®¢æˆ·ç«¯redis-cli.exe -p 6379 -a 123456 æŒ‡å®šç«¯å£å’Œå¯†ç å¯åŠ¨rediså®¢æˆ·ç«¯redis-cli.exe -p 6379 -a 123456 -n 0 æŒ‡å®šç«¯å£å’Œå¯†ç å’Œæ•°æ®åº“å¯åŠ¨rediså®¢æˆ·ç«¯ æ›´æ”¹gitä»“åº“ä¸ºsshè¿æ¥:git remote set-url origin git@github.com:JakicDong/TecHub.git JAVAå¹¶å‘ç¼–ç¨‹ç¯‡1071 å­¦ä¹ ä¸­,æ­£åœ¨å®Œå–„ç¬”è®°. Rediså­¦ä¹ ç¬”è®°357 å­¦ä¹ ä¸­,æ­£åœ¨å®Œå–„ç¬”è®°. é¡¹ç›®è¿˜å‰©å¾ˆå¤šçš„crudçš„åŠŸèƒ½æ¥å£éœ€è¦å®Œæˆ.","tags":["åŸºç¡€","æ—¥è®°","leetcode","é¡¹ç›®"],"categories":["å­¦ä¹ æ—¥è®°","2025-09"]},{"title":"2025.8.30å­¦ä¹ æ—¥è®°","path":"/2025/08/30/å­¦ä¹ æ—¥è®°25å¹´8æœˆ/2025.8.30å­¦ä¹ ç¬”è®°/","content":"ä»Šæ—¥å­¦ä¹ å†…å®¹æœ€è¿‘æ¯å¤©åªåœ¨åšæ¯æ—¥ä¸€é¢˜. JAVAå¹¶å‘ç¼–ç¨‹ç¯‡1071 å­¦ä¹ ä¸­,æ­£åœ¨å®Œå–„ç¬”è®°. Rediså­¦ä¹ ç¬”è®°357 å­¦ä¹ ä¸­,æ­£åœ¨å®Œå–„ç¬”è®°. é¡¹ç›®è¿˜å‰©å¾ˆå¤šçš„crudçš„åŠŸèƒ½æ¥å£éœ€è¦å®Œæˆ.","tags":["åŸºç¡€","æ—¥è®°","leetcode","é¡¹ç›®"],"categories":["å­¦ä¹ æ—¥è®°","2025-08"]},{"title":"Rediså­¦ä¹ ç¬”è®°","path":"/2025/08/30/æ‚é¡¹ç¬”è®°/gitç§˜é’¥è¿‡æœŸå¤„ç†/","content":"é—®é¢˜å½“gitç§˜é’¥è¿‡æœŸæ—¶,ä¼šå¯¼è‡´æ— æ³•ä½¿ç”¨gitå‘½ä»¤,æ— æ³•è¿›è¡Œgitæ“ä½œ.æˆ‘ä½¿ç”¨çš„æ˜¯githubä»“åº“è¿›è¡Œä»£ç ç®¡ç†. è§£å†³æ–¹æ³• æ£€æŸ¥ç°æœ‰å¯†é’¥\tls -al ~/.ssh å¤‡ä»½æ—§å¯†é’¥(å¯é€‰)\tcp ~/.ssh/id_rsa* ~/ssh_backup/ ç”Ÿæˆæ–°å¯†é’¥\tssh-keygen -t rsa -b 4096 -C ä½ çš„é‚®ç®± å¯åŠ¨ SSH ä»£ç†\teval $(ssh-agent -s) æ·»åŠ æ–°å¯†é’¥åˆ°ä»£ç†\tssh-add ~/.ssh/id_rsa å¤åˆ¶å…¬é’¥\tcat ~/.ssh/id_rsa.pub GitHub æ·»åŠ å…¬é’¥\tç½‘é¡µæ“ä½œ æµ‹è¯•è¿æ¥ æ›´æ–°ä»“åº“è¿œç¨‹ URL\tgit remote set-url origin git@github.com:ç”¨æˆ·/ä»“åº“.git éªŒè¯æ“ä½œ\tgit push origin main nano ~.sshconfig é…ç½®æ–‡ä»¶æ·»åŠ  Host github.com Hostname ssh.github.com Port 443 User git IdentityFile ~/.ssh/id_rsa # å¦‚æœæ‚¨çš„ç§é’¥æ˜¯å…¶ä»–åç§°æˆ–è·¯å¾„ï¼Œè¯·ä¿®æ”¹æ­¤å¤„ï¼Œä¾‹å¦‚ ~/.ssh/id_ed25519 å°†ä»“åº“åœ°å€æ”¹ä¸ºsshåœ°å€ git remote set-url origin git@github.com:JakicDong/Myblog_posts.git","tags":["åŸºç¡€","Java"],"categories":["æ‚é¡¹ç¬”è®°"]},{"title":"2025.8.27å­¦ä¹ æ—¥è®°","path":"/2025/08/27/å­¦ä¹ æ—¥è®°25å¹´8æœˆ/2025.8.27å­¦ä¹ ç¬”è®°/","content":"ä»Šæ—¥å­¦ä¹ å†…å®¹æœ€è¿‘æ¯å¤©åªåœ¨åšæ¯æ—¥ä¸€é¢˜. JAVAå¹¶å‘ç¼–ç¨‹ç¯‡1071 å­¦ä¹ ä¸­,æ­£åœ¨å®Œå–„ç¬”è®°. Rediså­¦ä¹ ç¬”è®°357 å­¦ä¹ ä¸­,æ­£åœ¨å®Œå–„ç¬”è®°. é¡¹ç›®è¿˜å‰©å¾ˆå¤šçš„crudçš„åŠŸèƒ½æ¥å£éœ€è¦å®Œæˆ.","tags":["åŸºç¡€","æ—¥è®°","leetcode","é¡¹ç›®"],"categories":["å­¦ä¹ æ—¥è®°","2025-08"]},{"title":"2025.8.20å­¦ä¹ æ—¥è®°","path":"/2025/08/20/å­¦ä¹ æ—¥è®°25å¹´8æœˆ/2025.8.20å­¦ä¹ ç¬”è®°/","content":"ä»Šæ—¥å­¦ä¹ å†…å®¹æœ€è¿‘æ¯å¤©åªåœ¨åšæ¯æ—¥ä¸€é¢˜. ä¼‘æ¯çš„å·®ä¸å¤šäº†,ä»Šå¤©å¼€å§‹ç»§ç»­å­¦ä¹ . åŠ›æ‰£æ¯æ—¥ä¸€é¢˜ä¸€é“äºŒç»´DPé¢˜ç›®. JAVAå¹¶å‘ç¼–ç¨‹ç¯‡1071 å­¦ä¹ ä¸­,æ­£åœ¨å®Œå–„ç¬”è®°. Rediså­¦ä¹ ç¬”è®°357 å­¦ä¹ ä¸­,æ­£åœ¨å®Œå–„ç¬”è®°. é¡¹ç›®è¿˜å‰©å¾ˆå¤šçš„crudçš„åŠŸèƒ½æ¥å£éœ€è¦å®Œæˆ.","tags":["åŸºç¡€","æ—¥è®°","leetcode","é¡¹ç›®"],"categories":["å­¦ä¹ æ—¥è®°","2025-08"]},{"title":"2025.8.13å­¦ä¹ æ—¥è®°","path":"/2025/08/13/å­¦ä¹ æ—¥è®°25å¹´8æœˆ/2025.8.13å­¦ä¹ ç¬”è®°/","content":"ä»Šæ—¥å­¦ä¹ å†…å®¹ç»ˆäºæ”¾å‡äº†. åŠ›æ‰£æ¯æ—¥ä¸€é¢˜åˆ¤æ–­æ•°æ˜¯ä¸æ˜¯3çš„å¹‚,ç›´æ¥temp*3åˆ¤æ–­å³å¯. JAVAå¹¶å‘ç¼–ç¨‹ç¯‡971 å­¦ä¹ ä¸­,æ­£åœ¨å®Œå–„ç¬”è®°. Rediså­¦ä¹ ç¬”è®°357 å­¦ä¹ ä¸­,æ­£åœ¨å®Œå–„ç¬”è®°. é¡¹ç›®ç”Ÿæ´»ç¯‡å‡†å¤‡å»ç§¦çš‡å²›æ—…è¡Œ14-17å·","tags":["åŸºç¡€","æ—¥è®°","leetcode","é¡¹ç›®"],"categories":["å­¦ä¹ æ—¥è®°","2025-08"]},{"title":"2025.8.12å­¦ä¹ æ—¥è®°","path":"/2025/08/12/å­¦ä¹ æ—¥è®°25å¹´8æœˆ/2025.8.12å­¦ä¹ ç¬”è®°/","content":"ä»Šæ—¥å­¦ä¹ å†…å®¹3DGSç»§ç»­åšæ¯ç‚¹ä¿æŠ¤çš„å®éªŒ. åŠ›æ‰£æ¯æ—¥ä¸€é¢˜0-1èƒŒåŒ…é—®é¢˜ JAVAå¹¶å‘ç¼–ç¨‹ç¯‡971 å­¦ä¹ ä¸­,æ­£åœ¨å®Œå–„ç¬”è®°. Rediså­¦ä¹ ç¬”è®°357 å­¦ä¹ ä¸­,æ­£åœ¨å®Œå–„ç¬”è®°. é¡¹ç›®æ–°å¢æ–‡ç« çƒ­é—¨æ¨èåŠŸèƒ½ï¼Œæ”¯æŒæ ¹æ®ä½œè€…IDæŸ¥è¯¢çƒ­é—¨æ–‡ç« ï¼›æ–°å¢è¯„è®ºç›¸å…³åŠŸèƒ½ï¼ŒåŒ…æ‹¬è·å–çƒ­é—¨è¯„è®ºå’Œè¯„è®ºç‚¹èµæ•°ç»Ÿè®¡ï¼›å®Œå–„æ–‡ç« è¯¦æƒ…é¡µçš„ä¾§è¾¹æ ä¿¡æ¯å±•ç¤ºã€‚å¤ä¹ é¡¹ç›®.","tags":["åŸºç¡€","æ—¥è®°","leetcode","é¡¹ç›®"],"categories":["å­¦ä¹ æ—¥è®°","2025-08"]},{"title":"2025.8.11å­¦ä¹ æ—¥è®°","path":"/2025/08/11/å­¦ä¹ æ—¥è®°25å¹´8æœˆ/2025.8.11å­¦ä¹ ç¬”è®°/","content":"ä»Šæ—¥å­¦ä¹ å†…å®¹3DGSç»§ç»­åšæ¯ç‚¹ä¿æŠ¤çš„å®éªŒ. åŠ›æ‰£æ¯æ—¥ä¸€é¢˜è¿˜æ˜¯ä¸€é“å’Œ2çš„å¹‚ç›¸å…³çš„é¢˜ç›®. JAVAå¹¶å‘ç¼–ç¨‹ç¯‡971 å­¦ä¹ ä¸­,æ­£åœ¨å®Œå–„ç¬”è®°. Rediså­¦ä¹ ç¬”è®°357 å­¦ä¹ ä¸­,æ­£åœ¨å®Œå–„ç¬”è®°. é¡¹ç›®æ–°å¢æ–‡ç« é˜…è¯»æ‰©å±•æœåŠ¡å’Œæ–‡ç« è¯¦æƒ…é¡µçš„SEOæ ‡ç­¾åˆå§‹åŒ–åŠŸèƒ½ï¼Œå®Œå–„äº†æ–‡ç« é˜…è¯»æ§åˆ¶é€»è¾‘ï¼Œæ”¯æŒä¸åŒé˜…è¯»æ¨¡å¼çš„æ§åˆ¶ã€‚æ–°å¢æ“ä½œç±»å‹æšä¸¾ç±»OperateTypeEnumã€æ”¯ä»˜çŠ¶æ€æšä¸¾ç±»PayStatusEnumï¼Œä»¥åŠè‡ªå®šä¹‰æç¤ºæ¡†è§£æå™¨å’Œæ‰©å±•ç±»ï¼ŒåŒ…å«Markdownè½¬æ¢å™¨ã€JSONå·¥å…·ç±»ã€æ”¯ä»˜ç›¸å…³æœåŠ¡å’Œè¯„è®ºç›¸å…³æœåŠ¡çš„å®ç°ã€‚","tags":["åŸºç¡€","æ—¥è®°","leetcode","é¡¹ç›®"],"categories":["å­¦ä¹ æ—¥è®°","2025-08"]},{"title":"2025.8.9å­¦ä¹ æ—¥è®°","path":"/2025/08/09/å­¦ä¹ æ—¥è®°25å¹´8æœˆ/2025.8.9å­¦ä¹ ç¬”è®°/","content":"ä»Šæ—¥å­¦ä¹ å†…å®¹3DGSåšæ¯ç‚¹ä¿æŠ¤çš„å®éªŒ. åŠ›æ‰£æ¯æ—¥ä¸€é¢˜å¿«é€Ÿåˆ¤æ–­ä¸€ä¸ªæ•°æ˜¯ä¸æ˜¯2çš„å¹‚. return n 0 (n (n - 1)) == 0; JAVAå¹¶å‘ç¼–ç¨‹ç¯‡971 å­¦ä¹ ä¸­,æ­£åœ¨å®Œå–„ç¬”è®°.git config â€“global http.postBuffer 524288000 å¢åŠ ç¼“å†²åŒºå¤§å°æˆ‘éœ€è¦æµ‹è¯•ä¸€ä¸‹ é¡¹ç›®æ¢³ç†é¡¹ç›®.æ­£åœ¨å®ç°æ–‡ç« æ¥å£.æ–°å¢æ–‡ç« ç›¸å…³DTOå’Œè¯„è®ºç›¸å…³DTOç±»ï¼ŒåŒ…æ‹¬ArticleOtherDTOã€ArticlePayInfoDTOã€ColumnArticleFlipDTOã€CommentSaveReqã€BaseCommentDTOã€SubCommentDTOã€TopCommentDTOã€ArticleDetailVoåŠArticleViewControlleræ§åˆ¶å™¨ã€‚ ä»£ç éšæƒ³å½•æ—  ç”Ÿæ´»ç¯‡æ™šä¸Šå¥èº«æ™šä¸Šç»ƒçš„æ‰‹è‡‚,å¼ºåº¦ä¸­ç­‰åä¸Š.","tags":["åŸºç¡€","æ—¥è®°","leetcode","é¡¹ç›®"],"categories":["å­¦ä¹ æ—¥è®°","2025-08"]},{"title":"Javaå¹¶å‘ç¼–ç¨‹å­¦ä¹ ç¬”è®°","path":"/2025/08/08/Javaé—®ç­”ç¬”è®°/Javaå¹¶å‘ç¼–ç¨‹å­¦ä¹ ç¬”è®°/","content":"åŸºç¡€1.å¹¶è¡Œè·Ÿå¹¶å‘æœ‰ä»€ä¹ˆåŒºåˆ«ï¼Ÿ å¹¶è¡Œæ˜¯å¤šæ ¸ CPU ä¸Šçš„å¤šä»»åŠ¡å¤„ç†ï¼Œå¤šä¸ªä»»åŠ¡åœ¨åŒä¸€æ—¶é—´çœŸæ­£åœ°åŒæ—¶æ‰§è¡Œã€‚ å¹¶å‘æ˜¯å•æ ¸ CPU ä¸Šçš„å¤šä»»åŠ¡å¤„ç†ï¼Œå¤šä¸ªä»»åŠ¡åœ¨åŒä¸€æ—¶é—´æ®µå†…äº¤æ›¿æ‰§è¡Œï¼Œé€šè¿‡æ—¶é—´ç‰‡è½®è½¬å®ç°äº¤æ›¿æ‰§è¡Œï¼Œç”¨äºè§£å†³ IO å¯†é›†å‹ä»»åŠ¡çš„ç“¶é¢ˆã€‚å•çº¿ç¨‹å¤„ç†IOå¯†é›†å‹ä»»åŠ¡ï¼šæ—¶é—´è½´ï¼š|--IOç­‰å¾…--|--CPUå¤„ç†--|--IOç­‰å¾…--|--CPUå¤„ç†--|CPUåˆ©ç”¨ç‡ï¼š ç©ºé—² å¿™ç¢Œ ç©ºé—² å¿™ç¢Œ çº¿ç¨‹1ï¼š|--IOç­‰å¾…--|--CPUå¤„ç†--|çº¿ç¨‹2ï¼š |--IOç­‰å¾…--|--CPUå¤„ç†--|çº¿ç¨‹3ï¼š |--IOç­‰å¾…--|--CPUå¤„ç†--|CPUåˆ©ç”¨ç‡ï¼šå¿™ç¢Œ å¿™ç¢Œ å¿™ç¢Œ å¿™ç¢Œ å¿™ç¢Œ å¿™ç¢Œ ä½ æ˜¯å¦‚ä½•ç†è§£çº¿ç¨‹å®‰å…¨çš„ï¼Ÿæ¨èé˜…è¯»ï¼šå¤šçº¿ç¨‹å¸¦æ¥äº†å“ªäº›é—®é¢˜ï¼Ÿ å¦‚æœä¸€æ®µä»£ç å—æˆ–è€…ä¸€ä¸ªæ–¹æ³•è¢«å¤šä¸ªçº¿ç¨‹åŒæ—¶æ‰§è¡Œï¼Œè¿˜èƒ½å¤Ÿæ­£ç¡®åœ°å¤„ç†å…±äº«æ•°æ®ï¼Œé‚£ä¹ˆè¿™æ®µä»£ç å—æˆ–è€…è¿™ä¸ªæ–¹æ³•å°±æ˜¯çº¿ç¨‹å®‰å…¨çš„ã€‚ å¯ä»¥ä»ä¸‰ä¸ªè¦ç´ æ¥ç¡®ä¿çº¿ç¨‹å®‰å…¨ï¼š â‘ ã€åŸå­æ€§ï¼šä¸€ä¸ªæ“ä½œè¦ä¹ˆå®Œå…¨æ‰§è¡Œï¼Œè¦ä¹ˆå®Œå…¨ä¸æ‰§è¡Œï¼Œä¸ä¼šå‡ºç°ä¸­é—´çŠ¶æ€ã€‚ å¯ä»¥é€šè¿‡åŒæ­¥å…³é”®å­— synchronized æˆ–åŸå­æ“ä½œï¼Œå¦‚ AtomicInteger æ¥ä¿è¯åŸå­æ€§ã€‚ AtomicInteger count = new AtomicInteger(0);count.incrementAndGet(); // åŸå­æ“ä½œ â‘¡ã€å¯è§æ€§ï¼šå½“ä¸€ä¸ªçº¿ç¨‹ä¿®æ”¹äº†å…±äº«å˜é‡ï¼Œå…¶ä»–çº¿ç¨‹èƒ½å¤Ÿç«‹å³çœ‹åˆ°å˜åŒ–ã€‚ å¯ä»¥é€šè¿‡ volatile å…³é”®å­—æ¥ä¿è¯å¯è§æ€§ã€‚ private volatile String itwanger = æ²‰é»˜ç‹äºŒ; â‘¢ã€æœ‰åºæ€§ï¼šè¦ç¡®ä¿çº¿ç¨‹ä¸ä¼šå› ä¸ºæ­»é”ã€é¥¥é¥¿ã€æ´»é”ç­‰é—®é¢˜å¯¼è‡´æ— æ³•ç»§ç»­æ‰§è¡Œã€‚ 2.ğŸŒŸè¯´è¯´è¿›ç¨‹å’Œçº¿ç¨‹çš„åŒºåˆ«ï¼Ÿæ¨èé˜…è¯»:è¿›ç¨‹ä¸çº¿ç¨‹çš„åŒºåˆ«æ˜¯ä»€ä¹ˆï¼Ÿ è¿›ç¨‹è¯´ç®€å•ç‚¹å°±æ˜¯æˆ‘ä»¬åœ¨ç”µè„‘ä¸Šå¯åŠ¨çš„ä¸€ä¸ªä¸ªåº”ç”¨ã€‚å®ƒæ˜¯æ“ä½œç³»ç»Ÿåˆ†é…èµ„æºçš„æœ€å°å•ä½ã€‚ çº¿ç¨‹æ˜¯è¿›ç¨‹ä¸­çš„ç‹¬ç«‹æ‰§è¡Œå•å…ƒã€‚å¤šä¸ªçº¿ç¨‹å¯ä»¥å…±äº«åŒä¸€ä¸ªè¿›ç¨‹çš„èµ„æºï¼Œå¦‚å†…å­˜ï¼›æ¯ä¸ªçº¿ç¨‹éƒ½æœ‰è‡ªå·±ç‹¬ç«‹çš„æ ˆå’Œå¯„å­˜å™¨ã€‚ å¦‚ä½•ç†è§£åç¨‹ï¼Ÿåç¨‹è¢«è§†ä¸ºæ¯”çº¿ç¨‹æ›´è½»é‡çº§çš„å¹¶å‘å•å…ƒï¼Œå¯ä»¥åœ¨å•çº¿ç¨‹ä¸­å®ç°å¹¶å‘æ‰§è¡Œï¼Œç”±æˆ‘ä»¬å¼€å‘è€…æ˜¾å¼è°ƒåº¦ã€‚ åç¨‹æ˜¯åœ¨ç”¨æˆ·æ€è¿›è¡Œè°ƒåº¦çš„ï¼Œé¿å…äº†çº¿ç¨‹åˆ‡æ¢æ—¶çš„å†…æ ¸æ€å¼€é”€ã€‚ Java è‡ªèº«æ˜¯ä¸æ”¯æŒæºç¨‹çš„ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨ Quasarã€Kotlin ç­‰æ¡†æ¶æ¥å®ç°åç¨‹ã€‚ fun main() = runBlocking launch delay(1000L) println(World!) println(Hello,) çº¿ç¨‹é—´æ˜¯å¦‚ä½•è¿›è¡Œé€šä¿¡çš„ï¼ŸåŸåˆ™ä¸Šå¯ä»¥é€šè¿‡æ¶ˆæ¯ä¼ é€’å’Œå…±äº«å†…å­˜ä¸¤ç§æ–¹æ³•æ¥å®ç°ã€‚Java é‡‡ç”¨çš„æ˜¯å…±äº«å†…å­˜çš„å¹¶å‘æ¨¡å‹ã€‚ è¿™ä¸ªæ¨¡å‹è¢«ç§°ä¸º Java å†…å­˜æ¨¡å‹ï¼Œç®€å†™ä¸º JMMï¼Œå®ƒå†³å®šäº†ä¸€ä¸ªçº¿ç¨‹å¯¹å…±äº«å˜é‡çš„å†™å…¥ï¼Œä½•æ—¶å¯¹å¦å¤–ä¸€ä¸ªçº¿ç¨‹å¯è§ã€‚å½“ç„¶äº†ï¼Œæœ¬åœ°å†…å­˜æ˜¯ JMM çš„ä¸€ä¸ªæŠ½è±¡æ¦‚å¿µï¼Œå¹¶ä¸çœŸå®å­˜åœ¨ã€‚ ç”¨ä¸€å¥è¯æ¥æ¦‚æ‹¬å°±æ˜¯ï¼šå…±äº«å˜é‡å­˜å‚¨åœ¨ä¸»å†…å­˜ä¸­ï¼Œæ¯ä¸ªçº¿ç¨‹çš„ç§æœ‰æœ¬åœ°å†…å­˜ï¼Œå­˜å‚¨çš„æ˜¯è¿™ä¸ªå…±äº«å˜é‡çš„å‰¯æœ¬ã€‚ çº¿ç¨‹ A ä¸çº¿ç¨‹ B ä¹‹é—´å¦‚è¦é€šä¿¡ï¼Œéœ€è¦è¦ç»å† 2 ä¸ªæ­¥éª¤ï¼š çº¿ç¨‹ A æŠŠæœ¬åœ°å†…å­˜ A ä¸­çš„å…±äº«å˜é‡å‰¯æœ¬åˆ·æ–°åˆ°ä¸»å†…å­˜ä¸­ã€‚ çº¿ç¨‹ B åˆ°ä¸»å†…å­˜ä¸­è¯»å–çº¿ç¨‹ A åˆ·æ–°è¿‡çš„å…±äº«å˜é‡ï¼Œå†åŒæ­¥åˆ°è‡ªå·±çš„å…±äº«å˜é‡å‰¯æœ¬ä¸­ã€‚ 3.ğŸŒŸè¯´è¯´çº¿ç¨‹æœ‰å‡ ç§åˆ›å»ºæ–¹å¼ï¼Ÿæ¨èé˜…è¯»ï¼šå®¤å‹æ‰“äº†ä¸€æŠŠç‹è€…å°±å­¦ä¼šäº† Java å¤šçº¿ç¨‹ æœ‰ä¸‰ç§ï¼Œåˆ†åˆ«æ˜¯ç»§æ‰¿ Thread ç±»ã€å®ç° Runnable æ¥å£ã€å®ç° Callable æ¥å£ã€‚ ç¬¬ä¸€ç§éœ€è¦é‡å†™çˆ¶ç±» Thread çš„ run() æ–¹æ³•ï¼Œå¹¶ä¸”è°ƒç”¨ start() æ–¹æ³•å¯åŠ¨çº¿ç¨‹ã€‚ class ThreadTask extends Thread public void run() System.out.println(çœ‹å®ŒäºŒå“¥çš„ Java è¿›é˜¶ä¹‹è·¯ï¼Œä¸Šå²¸äº†!); public static void main(String[] args) ThreadTask task = new ThreadTask(); task.start(); è¿™ç§æ–¹æ³•çš„ç¼ºç‚¹æ˜¯ï¼Œå¦‚æœ ThreadTask å·²ç»ç»§æ‰¿äº†å¦å¤–ä¸€ä¸ªç±»ï¼Œå°±ä¸èƒ½å†ç»§æ‰¿ Thread ç±»äº†ï¼Œå› ä¸º Java ä¸æ”¯æŒå¤šé‡ç»§æ‰¿ã€‚ ç¬¬äºŒç§éœ€è¦é‡å†™ Runnable æ¥å£çš„ run() æ–¹æ³•ï¼Œå¹¶å°†å®ç°ç±»çš„å¯¹è±¡ä½œä¸ºå‚æ•°ä¼ é€’ç»™ Thread å¯¹è±¡çš„æ„é€ æ–¹æ³•ï¼Œæœ€åè°ƒç”¨ start() æ–¹æ³•å¯åŠ¨çº¿ç¨‹ã€‚ class RunnableTask implements Runnable public void run() System.out.println(çœ‹å®ŒäºŒå“¥çš„ Java è¿›é˜¶ä¹‹è·¯ï¼Œä¸Šå²¸äº†!); public static void main(String[] args) RunnableTask task = new RunnableTask(); Thread thread = new Thread(task); thread.start(); è¿™ç§æ–¹æ³•çš„ä¼˜ç‚¹æ˜¯å¯ä»¥é¿å… Java çš„å•ç»§æ‰¿é™åˆ¶ï¼Œå¹¶ä¸”æ›´ç¬¦åˆé¢å‘å¯¹è±¡çš„ç¼–ç¨‹æ€æƒ³ï¼Œå› ä¸º Runnable æ¥å£å°†ä»»åŠ¡ä»£ç å’Œçº¿ç¨‹æ§åˆ¶çš„ä»£ç è§£è€¦äº†ã€‚ ç¬¬ä¸‰ç§éœ€è¦é‡å†™ Callable æ¥å£çš„ call() æ–¹æ³•ï¼Œç„¶ååˆ›å»º FutureTask å¯¹è±¡ï¼Œå‚æ•°ä¸º Callable å®ç°ç±»çš„å¯¹è±¡ï¼›ç´§æ¥ç€åˆ›å»º Thread å¯¹è±¡ï¼Œå‚æ•°ä¸º FutureTask å¯¹è±¡ï¼Œæœ€åè°ƒç”¨ start() æ–¹æ³•å¯åŠ¨çº¿ç¨‹ã€‚ class CallableTask implements CallableString public String call() return çœ‹å®ŒäºŒå“¥çš„ Java è¿›é˜¶ä¹‹è·¯ï¼Œä¸Šå²¸äº†!; public static void main(String[] args) throws ExecutionException, InterruptedException CallableTask task = new CallableTask(); FutureTaskString futureTask = new FutureTask(task); Thread thread = new Thread(futureTask); thread.start(); System.out.println(futureTask.get()); è¿™ç§æ–¹æ³•çš„ä¼˜ç‚¹æ˜¯å¯ä»¥è·å–çº¿ç¨‹çš„æ‰§è¡Œç»“æœã€‚ ä¸€ä¸ª 8G å†…å­˜çš„ç³»ç»Ÿæœ€å¤šèƒ½åˆ›å»ºå¤šå°‘ä¸ªçº¿ç¨‹?æ¨èé˜…è¯»ï¼šæ·±å…¥ç†è§£ JVM çš„è¿è¡Œæ—¶æ•°æ®åŒº ç†è®ºä¸Šå¤§çº¦ 8000 ä¸ªã€‚ åˆ›å»ºçº¿ç¨‹çš„æ—¶å€™ï¼Œè‡³å°‘éœ€è¦åˆ†é…ä¸€ä¸ªè™šæ‹Ÿæœºæ ˆï¼Œåœ¨ 64 ä½æ“ä½œç³»ç»Ÿä¸­ï¼Œé»˜è®¤å¤§å°ä¸º 1Mï¼Œå› æ­¤ä¸€ä¸ªçº¿ç¨‹å¤§çº¦éœ€è¦ 1M çš„å†…å­˜ã€‚ ä½† JVMã€æ“ä½œç³»ç»Ÿæœ¬èº«çš„è¿è¡Œå°±è¦å ä¸€å®šçš„å†…å­˜ç©ºé—´ï¼Œæ‰€ä»¥å®é™…ä¸Šå¯ä»¥åˆ›å»ºçš„çº¿ç¨‹æ•°è¿œæ¯” 8000 å°‘ã€‚ è¯¦ç»†è§£é‡Šä¸€ä¸‹ã€‚ å¯ä»¥é€šè¿‡Â java -XX:+PrintFlagsFinal -version | grep ThreadStackSizeÂ å‘½ä»¤æŸ¥çœ‹ JVM æ ˆçš„é»˜è®¤å¤§å°ã€‚ å…¶ä¸­ ThreadStackSize çš„å•ä½æ˜¯ KBï¼Œä¹Ÿå°±æ˜¯è¯´é»˜è®¤çš„ JVM æ ˆå¤§å°æ˜¯ 1024 KBï¼Œä¹Ÿå°±æ˜¯ 1Mã€‚ å¯åŠ¨ä¸€ä¸ª Java ç¨‹åºï¼Œä½ èƒ½è¯´è¯´é‡Œé¢æœ‰å“ªäº›çº¿ç¨‹å—ï¼Ÿé¦–å…ˆæ˜¯ main çº¿ç¨‹ï¼Œè¿™æ˜¯ç¨‹åºæ‰§è¡Œçš„å…¥å£ã€‚ ç„¶åæ˜¯åƒåœ¾å›æ”¶çº¿ç¨‹ï¼Œå®ƒæ˜¯ä¸€ä¸ªåå°çº¿ç¨‹ï¼Œè´Ÿè´£å›æ”¶ä¸å†ä½¿ç”¨çš„å¯¹è±¡ã€‚ è¿˜æœ‰ç¼–è¯‘å™¨çº¿ç¨‹ï¼Œæ¯”å¦‚ JITï¼Œè´Ÿè´£æŠŠä¸€éƒ¨åˆ†çƒ­ç‚¹ä»£ç ç¼–è¯‘åæ”¾åˆ° codeCache ä¸­ã€‚ å¯ä»¥é€šè¿‡ä¸‹é¢çš„ä»£ç è¿›è¡Œæ£€æµ‹ï¼š class ThreadLister public static void main(String[] args) // è·å–æ‰€æœ‰çº¿ç¨‹çš„å †æ ˆè·Ÿè¸ª MapThread, StackTraceElement[] threads = Thread.getAllStackTraces(); for (Thread thread : threads.keySet()) System.out.println(Thread: + thread.getName() + (ID= + thread.getId() + )); ç»“æœå¦‚ä¸‹æ‰€ç¤ºï¼š Thread: Monitor Ctrl-Break (ID=5)Thread: Reference Handler (ID=2)Thread: main (ID=1)Thread: Signal Dispatcher (ID=4)Thread: Finalizer (ID=3) ç®€å•è§£é‡Šä¸‹ï¼š Thread: main (ID=1) - ä¸»çº¿ç¨‹ï¼ŒJava ç¨‹åºå¯åŠ¨æ—¶ç”± JVM åˆ›å»ºã€‚ Thread: Reference Handler (ID=2) - è¿™ä¸ªçº¿ç¨‹æ˜¯ç”¨æ¥å¤„ç†å¼•ç”¨å¯¹è±¡çš„ï¼Œå¦‚è½¯å¼•ç”¨ã€å¼±å¼•ç”¨å’Œè™šå¼•ç”¨ã€‚è´Ÿè´£æ¸…ç†è¢« JVM å›æ”¶çš„å¯¹è±¡ã€‚ Thread: Finalizer (ID=3) - ç»ˆç»“å™¨çº¿ç¨‹ï¼Œè´Ÿè´£è°ƒç”¨å¯¹è±¡çš„ finalize æ–¹æ³•ã€‚å¯¹è±¡åœ¨åƒåœ¾å›æ”¶å™¨æ ‡è®°ä¸ºå¯å›æ”¶ä¹‹å‰ï¼Œç”±è¯¥çº¿ç¨‹æ‰§è¡Œå…¶ finalize æ–¹æ³•ï¼Œç”¨äºæ‰§è¡Œç‰¹å®šçš„èµ„æºé‡Šæ”¾æ“ä½œã€‚ Thread: Signal Dispatcher (ID=4) - ä¿¡å·è°ƒåº¦çº¿ç¨‹ï¼Œå¤„ç†æ¥è‡ªæ“ä½œç³»ç»Ÿçš„ä¿¡å·ï¼Œå°†å®ƒä»¬è½¬å‘ç»™ JVM è¿›è¡Œè¿›ä¸€æ­¥å¤„ç†ï¼Œä¾‹å¦‚å“åº”ä¸­æ–­ã€åœæ­¢ç­‰ä¿¡å·ã€‚ Thread: Monitor Ctrl-Break (ID=5) - ç›‘è§†å™¨çº¿ç¨‹ï¼Œé€šå¸¸ç”±ä¸€äº›ç‰¹å®šçš„ IDE åˆ›å»ºï¼Œç”¨äºåœ¨å¼€å‘è¿‡ç¨‹ä¸­ç›‘æ§å’Œç®¡ç†ç¨‹åºæ‰§è¡Œæˆ–è€…å¤„ç†ä¸­æ–­ã€‚ 4.ğŸŒŸè°ƒç”¨ start æ–¹æ³•æ—¶ä¼šæ‰§è¡Œ run æ–¹æ³•ï¼Œé‚£æ€ä¹ˆä¸ç›´æ¥è°ƒç”¨ runæ–¹æ³•ï¼Ÿè°ƒç”¨ start() ä¼šåˆ›å»ºä¸€ä¸ªæ–°çš„çº¿ç¨‹ï¼Œå¹¶å¼‚æ­¥æ‰§è¡Œ run() æ–¹æ³•ä¸­çš„ä»£ç ã€‚ ç›´æ¥è°ƒç”¨ run() æ–¹æ³•åªæ˜¯ä¸€ä¸ªæ™®é€šçš„åŒæ­¥æ–¹æ³•è°ƒç”¨ï¼Œæ‰€æœ‰ä»£ç éƒ½åœ¨å½“å‰çº¿ç¨‹ä¸­æ‰§è¡Œï¼Œä¸ä¼šåˆ›å»ºæ–°çº¿ç¨‹ã€‚æ²¡æœ‰æ–°çš„çº¿ç¨‹åˆ›å»ºï¼Œä¹Ÿå°±è¾¾ä¸åˆ°å¤šçº¿ç¨‹å¹¶å‘çš„ç›®çš„ã€‚ é€šè¿‡æ•²ä»£ç ä½“éªŒä¸€ä¸‹ã€‚ class MyThread extends Thread public void run() System.out.println(Thread.currentThread().getName()); public static void main(String[] args) MyThread t1 = new MyThread(); t1.start(); // æ­£ç¡®çš„æ–¹å¼ï¼Œåˆ›å»ºä¸€ä¸ªæ–°çº¿ç¨‹ï¼Œå¹¶åœ¨æ–°çº¿ç¨‹ä¸­æ‰§è¡Œ run() t1.run(); // ä»…åœ¨ä¸»çº¿ç¨‹ä¸­æ‰§è¡Œ run()ï¼Œæ²¡æœ‰åˆ›å»ºæ–°çº¿ç¨‹ æ¥çœ‹è¾“å‡ºç»“æœï¼š mainThread-0 ä¹Ÿå°±æ˜¯è¯´ï¼Œè°ƒç”¨ start() æ–¹æ³•ä¼šé€šçŸ¥ JVMï¼Œå»è°ƒç”¨åº•å±‚çš„çº¿ç¨‹è°ƒåº¦æœºåˆ¶æ¥å¯åŠ¨æ–°çº¿ç¨‹ã€‚ è°ƒç”¨ start() åï¼Œçº¿ç¨‹è¿›å…¥å°±ç»ªçŠ¶æ€ï¼Œç­‰å¾…æ“ä½œç³»ç»Ÿè°ƒåº¦ï¼›ä¸€æ—¦è°ƒåº¦æ‰§è¡Œï¼Œçº¿ç¨‹ä¼šæ‰§è¡Œå…¶ run() æ–¹æ³•ä¸­çš„ä»£ç ã€‚ 5.çº¿ç¨‹æœ‰å“ªäº›å¸¸ç”¨çš„è°ƒåº¦æ–¹æ³•ï¼Ÿæ¯”å¦‚è¯´ start æ–¹æ³•ç”¨äºå¯åŠ¨çº¿ç¨‹å¹¶è®©æ“ä½œç³»ç»Ÿè°ƒåº¦æ‰§è¡Œï¼›sleep æ–¹æ³•ç”¨äºè®©å½“å‰çº¿ç¨‹ä¼‘çœ ä¸€æ®µæ—¶é—´ï¼›wait æ–¹æ³•ä¼šè®©å½“å‰çº¿ç¨‹ç­‰å¾…ï¼Œnotify ä¼šå”¤é†’ä¸€ä¸ªç­‰å¾…çš„çº¿ç¨‹ã€‚ è¯´è¯´waitæ–¹æ³•å’Œnotifyæ–¹æ³•ï¼Ÿå½“çº¿ç¨‹ A è°ƒç”¨å…±äº«å¯¹è±¡çš„ wait() æ–¹æ³•æ—¶ï¼Œçº¿ç¨‹ A ä¼šè¢«é˜»å¡æŒ‚èµ·ï¼Œç›´åˆ°ï¼š çº¿ç¨‹ B è°ƒç”¨äº†å…±äº«å¯¹è±¡çš„ notify() æ–¹æ³•æˆ–è€… notifyAll() æ–¹æ³•ï¼› å…¶ä»–çº¿ç¨‹è°ƒç”¨çº¿ç¨‹ A çš„ interrupt() æ–¹æ³•ï¼Œå¯¼è‡´çº¿ç¨‹ A æŠ›å‡º InterruptedException å¼‚å¸¸ã€‚ çº¿ç¨‹ A è°ƒç”¨å…±äº«å¯¹è±¡çš„ wait(timeout)æ–¹æ³•åï¼Œæ²¡æœ‰åœ¨æŒ‡å®šçš„ timeout æ—¶é—´å†…è¢«å…¶å®ƒçº¿ç¨‹å”¤é†’ï¼Œé‚£ä¹ˆè¿™ä¸ªæ–¹æ³•ä¼šå› ä¸ºè¶…æ—¶è€Œè¿”å›ã€‚ å½“çº¿ç¨‹ A è°ƒç”¨å…±äº«å¯¹è±¡çš„ notify() æ–¹æ³•åï¼Œä¼šå”¤é†’ä¸€ä¸ªåœ¨è¿™ä¸ªå…±äº«å¯¹è±¡ä¸Šè°ƒç”¨ wait ç³»åˆ—æ–¹æ³•è¢«æŒ‚èµ·çš„çº¿ç¨‹ã€‚ å…±äº«å¯¹è±¡ä¸Šå¯èƒ½ä¼šæœ‰å¤šä¸ªçº¿ç¨‹åœ¨ç­‰å¾…ï¼Œå…·ä½“å”¤é†’å“ªä¸ªçº¿ç¨‹æ˜¯éšæœºçš„ã€‚ å¦‚æœè°ƒç”¨çš„æ˜¯ notifyAll æ–¹æ³•ï¼Œä¼šå”¤é†’æ‰€æœ‰åœ¨è¿™ä¸ªå…±äº«å˜é‡ä¸Šè°ƒç”¨ wait ç³»åˆ—æ–¹æ³•è€Œè¢«æŒ‚èµ·çš„çº¿ç¨‹ã€‚ è¯´è¯´ sleep æ–¹æ³•ï¼Ÿå½“çº¿ç¨‹ A è°ƒç”¨äº† Thread çš„ sleep æ–¹æ³•åï¼Œçº¿ç¨‹ A ä¼šæš‚æ—¶è®©å‡ºæŒ‡å®šæ—¶é—´çš„æ‰§è¡Œæƒã€‚ æŒ‡å®šçš„ç¡çœ æ—¶é—´åˆ°äº†åè¯¥æ–¹æ³•ä¼šæ­£å¸¸è¿”å›ï¼Œæ¥ç€å‚ä¸ CPU è°ƒåº¦ï¼Œè·å–åˆ° CPU èµ„æºåå¯ä»¥ç»§ç»­æ‰§è¡Œã€‚ è¯´è¯´yieldæ–¹æ³•ï¼Ÿyield() æ–¹æ³•çš„ç›®çš„æ˜¯è®©å½“å‰çº¿ç¨‹è®©å‡º CPU ä½¿ç”¨æƒï¼Œå›åˆ°å°±ç»ªçŠ¶æ€ã€‚ä½†æ˜¯çº¿ç¨‹è°ƒåº¦å™¨å¯èƒ½ä¼šå¿½ç•¥ã€‚ è¯´è¯´interruptæ–¹æ³•ï¼Ÿæ¨èé˜…è¯»ï¼šinterruptæ–¹æ³• interrupt() æ–¹æ³•ç”¨äºé€šçŸ¥çº¿ç¨‹åœæ­¢ï¼Œä½†ä¸ä¼šç›´æ¥ç»ˆæ­¢çº¿ç¨‹ï¼Œéœ€è¦çº¿ç¨‹è‡ªè¡Œå¤„ç†ä¸­æ–­æ ‡å¿—ã€‚ å¸¸ä¸ isInterrupted() æˆ– Thread.interrupted() é…åˆä½¿ç”¨ã€‚ Thread thread = new Thread(() - while (!Thread.currentThread().isInterrupted()) System.out.println(Running); System.out.println(Interrupted););thread.start();thread.interrupt(); // ä¸­æ–­çº¿ç¨‹ è¯´è¯´ stop æ–¹æ³•ï¼Ÿstop æ–¹æ³•ç”¨æ¥å¼ºåˆ¶åœæ­¢çº¿ç¨‹ï¼Œç›®å‰å·²ç»å¤„äºåºŸå¼ƒçŠ¶æ€ï¼Œå› ä¸º stop æ–¹æ³•å¯èƒ½ä¼šåœ¨ä¸ä¸€è‡´çš„çŠ¶æ€ä¸‹é‡Šæ”¾é”ï¼Œç ´åå¯¹è±¡çš„ä¸€è‡´æ€§ã€‚ 6.ğŸŒŸçº¿ç¨‹æœ‰å‡ ç§çŠ¶æ€ï¼Ÿ6 ç§ã€‚ new ä»£è¡¨çº¿ç¨‹è¢«åˆ›å»ºä½†æœªå¯åŠ¨ï¼› runnable ä»£è¡¨çº¿ç¨‹å¤„äºå°±ç»ªæˆ–æ­£åœ¨è¿è¡ŒçŠ¶æ€ï¼Œç”±æ“ä½œç³»ç»Ÿè°ƒåº¦ï¼› blocked ä»£è¡¨çº¿ç¨‹è¢«é˜»å¡ï¼Œç­‰å¾…è·å–é”ï¼› waiting ä»£è¡¨çº¿ç¨‹ç­‰å¾…å…¶ä»–çº¿ç¨‹çš„é€šçŸ¥æˆ–ä¸­æ–­ï¼› timed_waiting ä»£è¡¨çº¿ç¨‹ä¼šç­‰å¾…ä¸€æ®µæ—¶é—´ï¼Œè¶…æ—¶åè‡ªåŠ¨æ¢å¤ï¼› terminated ä»£è¡¨çº¿ç¨‹æ‰§è¡Œå®Œæ¯•ï¼Œç”Ÿå‘½å‘¨æœŸç»“æŸã€‚ ä¹Ÿå°±æ˜¯è¯´ï¼Œçº¿ç¨‹çš„ç”Ÿå‘½å‘¨æœŸå¯ä»¥åˆ†ä¸ºäº”ä¸ªä¸»è¦é˜¶æ®µï¼šæ–°å»ºã€å°±ç»ªã€è¿è¡Œã€é˜»å¡å’Œç»ˆæ­¢ã€‚çº¿ç¨‹åœ¨è¿è¡Œè¿‡ç¨‹ä¸­ä¼šæ ¹æ®çŠ¶æ€çš„å˜åŒ–åœ¨è¿™äº›é˜¶æ®µä¹‹é—´åˆ‡æ¢ã€‚ class ThreadStateExample public static void main(String[] args) throws InterruptedException Thread thread = new Thread(() - try Thread.sleep(2000); // TIMED_WAITING synchronized (ThreadStateExample.class) ThreadStateExample.class.wait(); // WAITING catch (InterruptedException e) Thread.currentThread().interrupt(); ); System.out.println(State after creation: + thread.getState()); // NEW thread.start(); System.out.println(State after start: + thread.getState()); // RUNNABLE Thread.sleep(500); System.out.println(State while sleeping: + thread.getState()); // TIMED_WAITING synchronized (ThreadStateExample.class) ThreadStateExample.class.notify(); // å”¤é†’çº¿ç¨‹ thread.join(); System.out.println(State after termination: + thread.getState()); // TERMINATED ç”¨ä¸€ä¸ªè¡¨æ ¼æ¥åšä¸ªæ€»ç»“ï¼š å¦‚ä½•å¼ºåˆ¶ç»ˆæ­¢çº¿ç¨‹ï¼Ÿç¬¬ä¸€æ­¥ï¼Œè°ƒç”¨çº¿ç¨‹çš„ interrupt() æ–¹æ³•ï¼Œè¯·æ±‚ç»ˆæ­¢çº¿ç¨‹ã€‚ ç¬¬äºŒæ­¥ï¼Œåœ¨çº¿ç¨‹çš„ run() æ–¹æ³•ä¸­æ£€æŸ¥ä¸­æ–­çŠ¶æ€ï¼Œå¦‚æœçº¿ç¨‹è¢«ä¸­æ–­ï¼Œå°±é€€å‡ºçº¿ç¨‹ã€‚ class MyTask implements Runnable @Override public void run() while (!Thread.currentThread().isInterrupted()) try System.out.println(Running...); Thread.sleep(1000); // æ¨¡æ‹Ÿå·¥ä½œ catch (InterruptedException e) // æ•è·ä¸­æ–­å¼‚å¸¸åï¼Œé‡ç½®ä¸­æ–­çŠ¶æ€ Thread.currentThread().interrupt(); System.out.println(Thread interrupted, exiting...); break; public class Main public static void main(String[] args) throws InterruptedException Thread thread = new Thread(new MyTask()); thread.start(); Thread.sleep(3000); // ä¸»çº¿ç¨‹ç­‰å¾…3ç§’ thread.interrupt(); // è¯·æ±‚ç»ˆæ­¢çº¿ç¨‹ ä¸­æ–­ç»“æœï¼š 7.ä»€ä¹ˆæ˜¯çº¿ç¨‹ä¸Šä¸‹æ–‡åˆ‡æ¢ï¼Ÿçº¿ç¨‹ä¸Šä¸‹æ–‡åˆ‡æ¢æ˜¯æŒ‡ CPU ä»ä¸€ä¸ªçº¿ç¨‹åˆ‡æ¢åˆ°å¦ä¸€ä¸ªçº¿ç¨‹æ‰§è¡Œæ—¶çš„è¿‡ç¨‹ã€‚ åœ¨çº¿ç¨‹åˆ‡æ¢çš„è¿‡ç¨‹ä¸­ï¼ŒCPU éœ€è¦ä¿å­˜å½“å‰çº¿ç¨‹çš„æ‰§è¡ŒçŠ¶æ€ï¼Œå¹¶åŠ è½½ä¸‹ä¸€ä¸ªçº¿ç¨‹çš„ä¸Šä¸‹æ–‡ã€‚ ä¹‹æ‰€ä»¥è¦è¿™æ ·ï¼Œæ˜¯å› ä¸º CPU åœ¨åŒä¸€æ—¶åˆ»åªèƒ½æ‰§è¡Œä¸€ä¸ªçº¿ç¨‹ï¼Œä¸ºäº†å®ç°å¤šçº¿ç¨‹å¹¶å‘æ‰§è¡Œï¼Œéœ€è¦ä¸æ–­åœ°åœ¨å¤šä¸ªçº¿ç¨‹ä¹‹é—´åˆ‡æ¢ã€‚ ä¸ºäº†è®©ç”¨æˆ·æ„Ÿè§‰å¤šä¸ªçº¿ç¨‹æ˜¯åœ¨åŒæ—¶æ‰§è¡Œçš„ï¼Œ CPU èµ„æºçš„åˆ†é…é‡‡ç”¨äº†æ—¶é—´ç‰‡è½®è½¬çš„æ–¹å¼ï¼Œçº¿ç¨‹åœ¨æ—¶é—´ç‰‡å†…å ç”¨ CPU æ‰§è¡Œä»»åŠ¡ã€‚å½“çº¿ç¨‹ä½¿ç”¨å®Œæ—¶é—´ç‰‡åï¼Œå°±ä¼šè®©å‡º CPU è®©å…¶ä»–çº¿ç¨‹å ç”¨ã€‚ çº¿ç¨‹å¯ä»¥è¢«å¤šæ ¸è°ƒåº¦å—ï¼Ÿå¤šæ ¸å¤„ç†å™¨æä¾›äº†å¹¶è¡Œæ‰§è¡Œå¤šä¸ªçº¿ç¨‹çš„èƒ½åŠ›ã€‚æ¯ä¸ªæ ¸å¿ƒå¯ä»¥ç‹¬ç«‹æ‰§è¡Œä¸€ä¸ªæˆ–å¤šä¸ªçº¿ç¨‹ï¼Œæ“ä½œç³»ç»Ÿçš„ä»»åŠ¡è°ƒåº¦å™¨ä¼šæ ¹æ®ç­–ç•¥å’Œç®—æ³•ï¼Œå¦‚ä¼˜å…ˆçº§è°ƒåº¦ã€è½®è½¬è°ƒåº¦ç­‰ï¼Œå†³å®šå“ªä¸ªçº¿ç¨‹ä½•æ—¶åœ¨å“ªä¸ªæ ¸å¿ƒä¸Šè¿è¡Œã€‚ 8.å®ˆæŠ¤çº¿ç¨‹äº†è§£å—ï¼Ÿäº†è§£ï¼Œå®ˆæŠ¤çº¿ç¨‹æ˜¯ä¸€ç§ç‰¹æ®Šçš„çº¿ç¨‹ï¼Œå®ƒçš„ä½œç”¨æ˜¯ä¸ºå…¶ä»–çº¿ç¨‹æä¾›æœåŠ¡ã€‚ Java ä¸­çš„çº¿ç¨‹åˆ†ä¸ºä¸¤ç±»ï¼Œä¸€ç§æ˜¯å®ˆæŠ¤çº¿ç¨‹ï¼Œå¦å¤–ä¸€ç§æ˜¯ç”¨æˆ·çº¿ç¨‹ã€‚ JVM å¯åŠ¨æ—¶ä¼šè°ƒç”¨ main æ–¹æ³•ï¼Œmain æ–¹æ³•æ‰€åœ¨çš„çº¿ç¨‹å°±æ˜¯ä¸€ä¸ªç”¨æˆ·çº¿ç¨‹ã€‚åœ¨ JVM å†…éƒ¨ï¼ŒåŒæ—¶è¿˜å¯åŠ¨äº†å¾ˆå¤šå®ˆæŠ¤çº¿ç¨‹ï¼Œæ¯”å¦‚åƒåœ¾å›æ”¶çº¿ç¨‹ã€‚ å®ˆæŠ¤çº¿ç¨‹å’Œç”¨æˆ·çº¿ç¨‹æœ‰ä»€ä¹ˆåŒºåˆ«å‘¢ï¼ŸåŒºåˆ«ä¹‹ä¸€æ˜¯å½“æœ€åä¸€ä¸ªéå®ˆæŠ¤çº¿ç¨‹æŸæ—¶ï¼Œ JVM ä¼šæ­£å¸¸é€€å‡ºï¼Œä¸ç®¡å½“å‰æ˜¯å¦å­˜åœ¨å®ˆæŠ¤çº¿ç¨‹ï¼Œä¹Ÿå°±æ˜¯è¯´å®ˆæŠ¤çº¿ç¨‹æ˜¯å¦ç»“æŸå¹¶ä¸å½±å“ JVM é€€å‡ºã€‚ æ¢è€Œè¨€ä¹‹ï¼Œåªè¦æœ‰ä¸€ä¸ªç”¨æˆ·çº¿ç¨‹è¿˜æ²¡ç»“æŸï¼Œæ­£å¸¸æƒ…å†µä¸‹ JVM å°±ä¸ä¼šé€€å‡ºã€‚ 9.çº¿ç¨‹é—´æœ‰å“ªäº›é€šä¿¡æ–¹å¼ï¼Ÿçº¿ç¨‹ä¹‹é—´ä¼ é€’ä¿¡æ¯çš„æ–¹å¼æœ‰å¤šç§ï¼Œæ¯”å¦‚è¯´ä½¿ç”¨ volatile å’Œ synchronized å…³é”®å­—å…±äº«å¯¹è±¡ã€ä½¿ç”¨Â wait()Â å’ŒÂ notify()Â æ–¹æ³•å®ç°ç”Ÿäº§è€…-æ¶ˆè´¹è€…æ¨¡å¼ã€ä½¿ç”¨ Exchanger è¿›è¡Œæ•°æ®äº¤æ¢ã€ä½¿ç”¨ Condition å®ç°çº¿ç¨‹é—´çš„åè°ƒç­‰ã€‚ ç®€å•è¯´è¯´ volatile å’Œ synchronized çš„ä½¿ç”¨æ–¹å¼ï¼Ÿå¤šä¸ªçº¿ç¨‹å¯ä»¥é€šè¿‡ volatile å’Œ synchronized å…³é”®å­—è®¿é—®å’Œä¿®æ”¹åŒä¸€ä¸ªå¯¹è±¡ï¼Œä»è€Œå®ç°ä¿¡æ¯çš„ä¼ é€’ã€‚ å…³é”®å­— volatileÂ å¯ä»¥ç”¨æ¥ä¿®é¥°æˆå‘˜å˜é‡ï¼Œå‘ŠçŸ¥ç¨‹åºä»»ä½•å¯¹è¯¥å˜é‡çš„è®¿é—®å‡éœ€è¦ä»å…±äº«å†…å­˜ä¸­è·å–ï¼Œå¹¶åŒæ­¥åˆ·æ–°å›å…±äº«å†…å­˜ï¼Œä¿è¯æ‰€æœ‰çº¿ç¨‹å¯¹å˜é‡è®¿é—®çš„å¯è§æ€§ã€‚ å…³é”®å­— synchronizedÂ å¯ä»¥ä¿®é¥°æ–¹æ³•ï¼Œæˆ–è€…åŒæ­¥ä»£ç å—ï¼Œç¡®ä¿å¤šä¸ªçº¿ç¨‹åœ¨åŒä¸€ä¸ªæ—¶åˆ»åªæœ‰ä¸€ä¸ªçº¿ç¨‹åœ¨æ‰§è¡Œæ–¹æ³•æˆ–ä»£ç å—ã€‚ class SharedObject private String message; private boolean hasMessage = false; public synchronized void writeMessage(String message) while (hasMessage) try wait(); catch (InterruptedException e) Thread.currentThread().interrupt(); this.message = message; hasMessage = true; notifyAll(); public synchronized String readMessage() while (!hasMessage) try wait(); catch (InterruptedException e) Thread.currentThread().interrupt(); hasMessage = false; notifyAll(); return message; public class Main public static void main(String[] args) SharedObject sharedObject = new SharedObject(); Thread writer = new Thread(() - sharedObject.writeMessage(Hello from Writer!); ); Thread reader = new Thread(() - String message = sharedObject.readMessage(); System.out.println(Reader received: + message); ); writer.start(); reader.start(); wait() å’Œ notify() æ–¹æ³•çš„ä½¿ç”¨æ–¹å¼äº†è§£å—ï¼Ÿä¸€ä¸ªçº¿ç¨‹è°ƒç”¨å…±äº«å¯¹è±¡çš„ wait() æ–¹æ³•æ—¶ï¼Œå®ƒä¼šè¿›å…¥è¯¥å¯¹è±¡çš„ç­‰å¾…æ± ï¼Œé‡Šæ”¾å·²ç»æŒæœ‰çš„é”ï¼Œè¿›å…¥ç­‰å¾…çŠ¶æ€ã€‚ ä¸€ä¸ªçº¿ç¨‹è°ƒç”¨ notify() æ–¹æ³•æ—¶ï¼Œå®ƒä¼šå”¤é†’åœ¨è¯¥å¯¹è±¡ç­‰å¾…æ± ä¸­ç­‰å¾…çš„ä¸€ä¸ªçº¿ç¨‹ï¼Œä½¿å…¶è¿›å…¥é”æ± ï¼Œç­‰å¾…è·å–é”ã€‚ class MessageBox private String message; private boolean empty = true; public synchronized void produce(String message) while (!empty) try wait(); catch (InterruptedException e) Thread.currentThread().interrupt(); empty = false; this.message = message; notifyAll(); public synchronized String consume() while (empty) try wait(); catch (InterruptedException e) Thread.currentThread().interrupt(); empty = true; notifyAll(); return message; public class Main public static void main(String[] args) MessageBox box = new MessageBox(); Thread producer = new Thread(() - box.produce(Message from producer); ); Thread consumer = new Thread(() - String message = box.consume(); System.out.println(Consumer received: + message); ); producer.start(); consumer.start(); ConditionÂ ä¹Ÿæä¾›äº†ç±»ä¼¼çš„æ–¹æ³•ï¼Œawait()Â è´Ÿè´£é˜»å¡ã€signal()Â å’ŒÂ signalAll()Â è´Ÿè´£é€šçŸ¥ã€‚ é€šå¸¸ä¸é”Â ReentrantLockÂ ä¸€èµ·ä½¿ç”¨ï¼Œä¸ºçº¿ç¨‹æä¾›äº†ä¸€ç§ç­‰å¾…æŸä¸ªæ¡ä»¶æˆçœŸçš„æœºåˆ¶ï¼Œå¹¶å…è®¸å…¶ä»–çº¿ç¨‹åœ¨è¯¥æ¡ä»¶å˜åŒ–æ—¶é€šçŸ¥ç­‰å¾…çº¿ç¨‹ã€‚ Exchanger çš„ä½¿ç”¨æ–¹å¼äº†è§£å—ï¼ŸExchanger æ˜¯ä¸€ä¸ªåŒæ­¥ç‚¹ï¼Œå¯ä»¥åœ¨ä¸¤ä¸ªçº¿ç¨‹ä¹‹é—´äº¤æ¢æ•°æ®ã€‚ä¸€ä¸ªçº¿ç¨‹è°ƒç”¨Â exchange()Â æ–¹æ³•ï¼Œå°†æ•°æ®ä¼ é€’ç»™å¦ä¸€ä¸ªçº¿ç¨‹ï¼ŒåŒæ—¶æ¥æ”¶å¦ä¸€ä¸ªçº¿ç¨‹çš„æ•°æ®ã€‚ class Main public static void main(String[] args) ExchangerString exchanger = new Exchanger(); Thread thread1 = new Thread(() - try String message = Message from thread1; String response = exchanger.exchange(message); System.out.println(Thread1 received: + response); catch (InterruptedException e) Thread.currentThread().interrupt(); ); Thread thread2 = new Thread(() - try String message = Message from thread2; String response = exchanger.exchange(message); System.out.println(Thread2 received: + response); catch (InterruptedException e) Thread.currentThread().interrupt(); ); thread1.start(); thread2.start(); CompletableFuture çš„ä½¿ç”¨æ–¹å¼äº†è§£å—ï¼ŸCompletableFuture æ˜¯ Java 8 å¼•å…¥çš„ä¸€ä¸ªç±»ï¼Œæ”¯æŒå¼‚æ­¥ç¼–ç¨‹ï¼Œå…è®¸çº¿ç¨‹åœ¨å®Œæˆè®¡ç®—åå°†ç»“æœä¼ é€’ç»™å…¶ä»–çº¿ç¨‹ã€‚ class Main public static void main(String[] args) CompletableFutureString future = CompletableFuture.supplyAsync(() - // æ¨¡æ‹Ÿé•¿æ—¶é—´è®¡ç®— return Message from CompletableFuture; ); future.thenAccept(message - System.out.println(Received: + message); ); 10.ğŸŒŸè¯·è¯´è¯´ sleep å’Œ wait çš„åŒºåˆ«ï¼Ÿï¼ˆè¡¥å……ï¼‰sleep ä¼šè®©å½“å‰çº¿ç¨‹ä¼‘çœ ï¼Œä¸éœ€è¦è·å–å¯¹è±¡é”ï¼Œå±äº Thread ç±»çš„æ–¹æ³•ï¼›wait ä¼šè®©è·å¾—å¯¹è±¡é”çš„çº¿ç¨‹ç­‰å¾…ï¼Œè¦æå‰è·å¾—å¯¹è±¡é”ï¼Œå±äº Object ç±»çš„æ–¹æ³•ã€‚ â‘ ã€æ‰€å±ç±»ä¸åŒ sleep()Â æ–¹æ³•ä¸“å±äºÂ ThreadÂ ç±»ã€‚ wait()Â æ–¹æ³•ä¸“å±äºÂ ObjectÂ ç±»ã€‚ â‘¡ã€é”è¡Œä¸ºä¸åŒ å¦‚æœä¸€ä¸ªçº¿ç¨‹åœ¨æŒæœ‰æŸä¸ªå¯¹è±¡é”æ—¶è°ƒç”¨äº† sleep æ–¹æ³•ï¼Œå®ƒåœ¨ç¡çœ æœŸé—´ä»ç„¶ä¼šæŒæœ‰è¿™ä¸ªé”ã€‚ class SleepDoesNotReleaseLock private static final Object lock = new Object(); public static void main(String[] args) throws InterruptedException Thread sleepingThread = new Thread(() - synchronized (lock) System.out.println(Thread 1 ä¼šç»§ç»­æŒæœ‰é”ï¼Œå¹¶ä¸”è¿›å…¥ç¡çœ çŠ¶æ€); try Thread.sleep(5000); catch (InterruptedException e) e.printStackTrace(); System.out.println(Thread 1 é†’æ¥äº†ï¼Œå¹¶ä¸”é‡Šæ”¾äº†é”); ); Thread waitingThread = new Thread(() - synchronized (lock) System.out.println(Thread 2 è¿›å…¥åŒæ­¥ä»£ç å—); ); sleepingThread.start(); Thread.sleep(1000); waitingThread.start(); è¾“å‡ºç»“æœï¼š Thread 1 ä¼šç»§ç»­æŒæœ‰é”ï¼Œå¹¶ä¸”è¿›å…¥ç¡çœ çŠ¶æ€Thread 1 é†’æ¥äº†ï¼Œå¹¶ä¸”é‡Šæ”¾äº†é”Thread 2 è¿›å…¥åŒæ­¥ä»£ç å— ä»è¾“å‡ºä¸­æˆ‘ä»¬å¯ä»¥çœ‹åˆ°ï¼ŒwaitingThread å¿…é¡»ç­‰å¾… sleepingThread å®Œæˆç¡çœ åæ‰èƒ½è¿›å…¥åŒæ­¥ä»£ç å—ã€‚ è€Œå½“çº¿ç¨‹æ‰§è¡Œ wait æ–¹æ³•æ—¶ï¼Œå®ƒä¼šé‡Šæ”¾æŒæœ‰çš„å¯¹è±¡é”ï¼Œå› æ­¤å…¶ä»–çº¿ç¨‹ä¹Ÿæœ‰æœºä¼šè·å–è¯¥å¯¹è±¡çš„é”ã€‚ class WaitReleasesLock private static final Object lock = new Object(); public static void main(String[] args) throws InterruptedException Thread waitingThread = new Thread(() - synchronized (lock) try System.out.println(Thread 1 æŒæœ‰é”ï¼Œå‡†å¤‡ç­‰å¾… 5 ç§’); lock.wait(5000); System.out.println(Thread 1 é†’æ¥äº†ï¼Œå¹¶ä¸”é€€å‡ºåŒæ­¥ä»£ç å—); catch (InterruptedException e) e.printStackTrace(); ); Thread notifyingThread = new Thread(() - synchronized (lock) System.out.println(Thread 2 å°è¯•å”¤é†’ç­‰å¾…ä¸­çš„çº¿ç¨‹); lock.notify(); System.out.println(Thread 2 æ‰§è¡Œå®Œäº† notify); ); waitingThread.start(); Thread.sleep(1000); notifyingThread.start(); è¾“å‡ºç»“æœï¼š Thread 1 æŒæœ‰é”ï¼Œå‡†å¤‡ç­‰å¾… 5 ç§’Thread 2 å°è¯•å”¤é†’ç­‰å¾…ä¸­çš„çº¿ç¨‹Thread 2 æ‰§è¡Œå®Œäº† notifyThread 1 é†’æ¥äº†ï¼Œå¹¶ä¸”é€€å‡ºåŒæ­¥ä»£ç å— è¿™è¡¨æ˜ waitingThread åœ¨è°ƒç”¨ wait åç¡®å®é‡Šæ”¾äº†é”ã€‚ â‘¢ã€ä½¿ç”¨æ¡ä»¶ä¸åŒ sleep() æ–¹æ³•å¯ä»¥åœ¨ä»»ä½•åœ°æ–¹è¢«è°ƒç”¨ã€‚wait() æ–¹æ³•å¿…é¡»åœ¨åŒæ­¥ä»£ç å—æˆ–åŒæ­¥æ–¹æ³•ä¸­è¢«è°ƒç”¨ï¼Œè¿™æ˜¯å› ä¸ºè°ƒç”¨ wait() æ–¹æ³•çš„å‰ææ˜¯å½“å‰çº¿ç¨‹å¿…é¡»æŒæœ‰å¯¹è±¡çš„é”ã€‚å¦åˆ™ä¼šæŠ›å‡º IllegalMonitorStateException å¼‚å¸¸ã€‚ â‘£ã€å”¤é†’æ–¹å¼ä¸åŒ è°ƒç”¨ sleep æ–¹æ³•åï¼Œçº¿ç¨‹ä¼šè¿›å…¥ TIMED_WAITING çŠ¶æ€ï¼Œå³åœ¨æŒ‡å®šçš„æ—¶é—´å†…æš‚åœæ‰§è¡Œã€‚å½“æŒ‡å®šçš„æ—¶é—´ç»“æŸåï¼Œçº¿ç¨‹ä¼šè‡ªåŠ¨æ¢å¤åˆ° RUNNABLE çŠ¶æ€ï¼Œç­‰å¾… CPU è°ƒåº¦å†æ¬¡æ‰§è¡Œã€‚ è°ƒç”¨ wait æ–¹æ³•åï¼Œçº¿ç¨‹ä¼šè¿›å…¥ WAITING çŠ¶æ€ï¼Œç›´åˆ°æœ‰å…¶ä»–çº¿ç¨‹åœ¨åŒä¸€å¯¹è±¡ä¸Šè°ƒç”¨ notify æˆ– notifyAll æ–¹æ³•ï¼Œçº¿ç¨‹æ‰ä¼šä» WAITING çŠ¶æ€è½¬å˜ä¸º RUNNABLE çŠ¶æ€ï¼Œå‡†å¤‡å†æ¬¡è·å¾— CPU çš„æ‰§è¡Œæƒã€‚ æˆ‘ä»¬æ¥é€šè¿‡ä»£ç å†æ„Ÿå—ä¸€ä¸‹ sleep å’Œ wait åœ¨ç”¨æ³•ä¸Šçš„åŒºåˆ«ï¼Œå…ˆçœ‹ sleep çš„ç”¨æ³•ï¼š class SleepExample public static void main(String[] args) Thread thread = new Thread(() - System.out.println(çº¿ç¨‹å‡†å¤‡ä¼‘çœ  2 ç§’); try Thread.sleep(2000); // çº¿ç¨‹å°†ç¡çœ 2ç§’ catch (InterruptedException e) e.printStackTrace(); System.out.println(çº¿ç¨‹é†’æ¥äº†); ); thread.start(); å†æ¥çœ‹ wait() çš„ç”¨æ³•ï¼š class WaitExample public static void main(String[] args) final Object lock = new Object(); Thread thread = new Thread(() - synchronized (lock) try System.out.println(çº¿ç¨‹å‡†å¤‡ç­‰å¾… 2 ç§’); lock.wait(2000); // çº¿ç¨‹ä¼šç­‰å¾…2ç§’ï¼Œæˆ–è€…ç›´åˆ°å…¶ä»–çº¿ç¨‹è°ƒç”¨ lock.notify()/notifyAll() System.out.println(çº¿ç¨‹ç»“æŸç­‰å¾…); catch (InterruptedException e) e.printStackTrace(); ); thread.start();","tags":["åŸºç¡€","å¹¶å‘ç¼–ç¨‹"],"categories":["Javaé—®ç­”ç¬”è®°"]},{"title":"2025.8.8å­¦ä¹ æ—¥è®°","path":"/2025/08/08/å­¦ä¹ æ—¥è®°25å¹´8æœˆ/2025.8.8å­¦ä¹ ç¬”è®°/","content":"ä»Šæ—¥å­¦ä¹ å†…å®¹3DGS1.ç¼–å†™äº†ä¸€ä¸ªé¢‘ç‡èƒ½é‡æµ‹è¯•è„šæœ¬,è¾“å…¥å›¾åƒå¯ä»¥ç”Ÿæˆä¸åŒåˆ†è¾¨ç‡çš„é¢‘ç‡èƒ½é‡,å¯ä»¥ç”¨äºå®šé‡åˆ†æå›¾åƒç»“æ„. 2.å¯¹DashGSè¿›è¡Œæ”¹å†™: ç”±äº3DGSè®­ç»ƒæ—¶ä»…ä¾é å›¾åƒæ¢¯åº¦æ¥æ‹ŸåˆçœŸå€¼å›¾åƒ,è¿‡åº¦ä¾èµ–å½“å‰çš„çœŸå€¼å›¾åƒ,ä½¿å¾—ç©ºé—´ä¸­å‡ºç°å¾ˆå¤šæµ®ç‚¹.è€ŒåŸå§‹è¾“å…¥çš„colmapç‚¹ç›¸å¯¹3DGSè®­ç»ƒçš„ç‚¹åœ¨ç©ºé—´ä¸Šæ›´åŠ å¯é (ç”±å¤šè§†è§’ä¸‰è§’æµ‹é‡+å…¨å±€ä¼˜åŒ–å¾—æ¥),æ‰€ä»¥æˆ‘å¢åŠ åŸå§‹è¾“å…¥ç‚¹(æ¯ç‚¹)çš„å¤åˆ¶èƒ½åŠ›,é™åˆ¶3DGSè®­ç»ƒçš„å­ç‚¹çš„å¤åˆ¶èƒ½åŠ›. ç›®å‰çš„å®ç°æ–¹æ³•æ˜¯,DashGSçš„å¯†åº¦è°ƒåº¦å™¨ä¼šå¯¹é«˜æ–¯çƒå¢å€¼çš„æ•°é‡è¿›è¡Œé™åˆ¶,è€Œæˆ‘é€šè¿‡æ§åˆ¶æ¯ç‚¹å’Œå­ç‚¹çš„åˆ†é…æ¯”ä¾‹æ¥æ§åˆ¶äºŒè€…çš„å¤åˆ¶æ•°é‡,å‡è®¾æœ‰100ä¸ªç‚¹çš„å®¹é‡,ç•™ç»™æ¯ç‚¹70ä¸ªå®¹é‡,å‰©ä¸‹çš„ç»™å­ç‚¹,æ¥å®ç°å¯¹å¤åˆ¶ç‚¹æµå‘çš„æ§åˆ¶.åªåšäº†ä¸€ç»„å®éªŒ,å…·ä½“æ•ˆæœè¿˜éœ€è¦è¿›ä¸€æ­¥è¯„ä¼°.åŸç‰ˆDash:SSIM â†‘: 0.7548986PSNR â†‘: 24.0219326LPIPSâ†“: 0.3954713æ”¹ç‰ˆDash:SSIM â†‘: 0.7556131PSNR â†‘: 24.1246986LPIPSâ†“: 0.3952501 åŠ›æ‰£æ¯æ—¥ä¸€é¢˜JAVAå¹¶å‘ç¼–ç¨‹ç¯‡371 å­¦ä¹ ä¸­,å¹¶ä¸”æ­£åœ¨å®Œå–„ç¬”è®°. é¡¹ç›®ä»£ç éšæƒ³å½•ç”Ÿæ´»ç¯‡","tags":["åŸºç¡€","æ—¥è®°","leetcode","é¡¹ç›®"],"categories":["å­¦ä¹ æ—¥è®°","2025-08"]},{"title":"2025.8.7å­¦ä¹ æ—¥è®°","path":"/2025/08/07/å­¦ä¹ æ—¥è®°25å¹´8æœˆ/2025.8.7å­¦ä¹ ç¬”è®°/","content":"ä»Šæ—¥å­¦ä¹ å†…å®¹è®¢é˜…äº†cursorçš„proç‰ˆæœ¬,åŠŸèƒ½çœŸçš„å¼ºå¤§. 3DGSåŠ›æ‰£æ¯æ—¥ä¸€é¢˜è„‘ç­‹æ€¥è½¬å¼¯+DP javaé›†åˆæ¡†æ¶ç¯‡3030 å®Œæˆå­¦ä¹ ,å¹¶ä¸”è®°äº†ä¸€ç¯‡ç¬”è®°. é¡¹ç›®å®ç°å…¨å±€å¼‚å¸¸å¤„ç†æ¥å£. ä»£ç éšæƒ³å½•ç”Ÿæ´»ç¯‡æˆ˜åœ°6æ™šä¸Šç©äº†æˆ˜åœ°6bæµ‹.","tags":["åŸºç¡€","æ—¥è®°","leetcode","é¡¹ç›®"],"categories":["å­¦ä¹ æ—¥è®°","2025-08"]},{"title":"SSHè¿œç¨‹è°ƒç”¨å¼€å‘ç¯å¢ƒ","path":"/2025/08/06/3DGS/SSHè¿œç¨‹è°ƒç”¨å¼€å‘ç¯å¢ƒ/","content":"å‰è¨€ä¸ºäº†æ–¹ä¾¿è°ƒè¯•å’Œå¼€å‘,æˆ‘éœ€è¦ç”¨æˆ‘çš„Macç¬”è®°æœ¬è¿œç¨‹è°ƒç”¨Ubuntu20ä¸»æœº,æ¥è·‘Ubuntuä¸Šçš„ç¨‹åº.é‡‡å–çš„æ–¹æ¡ˆä½¿ç”¨è¿‡VSCodeçš„SSHè¿œç¨‹è¿æ¥æ¥è°ƒç”¨Ubuntuçš„ç¯å¢ƒ. ç¯å¢ƒä¸€å°Macç¬”è®°æœ¬,ä¸€å°Ubuntu20ä¸»æœº. é…ç½®ä¸€ã€å°å¼æœºï¼ˆUbuntuï¼‰åŸºç¡€é…ç½®â€‹â€‹ å¯ç”¨SSHæœåŠ¡ï¼ˆè‹¥æœªå®‰è£…ï¼‰ sudo apt updatesudo apt install openssh-server -ysudo systemctl enable --now sshsudo ufw allow 22 # å¦‚æœå¯ç”¨äº†é˜²ç«å¢™sudo ufw disable # å…³é—­é˜²ç«å¢™#sudo ufw status # æŸ¥çœ‹é˜²ç«å¢™çŠ¶æ€#sudo ufw enable # å¼€å¯é˜²ç«å¢™ æ£€æŸ¥SSHæœåŠ¡çŠ¶æ€ sudo systemctl status ssh åº”çœ‹åˆ°Active: active (running) è·å–æœ¬æœºIPï¼ˆç”¨äºåç»­è¿æ¥ï¼‰ ip a | grep inet | grep -v 127.0.0.1 è¾“å‡ºç¤ºä¾‹ï¼š192.168.1.100æˆ–è€…ä½¿ç”¨ifconfigå‘½ä»¤æŸ¥çœ‹. â€‹â€‹äºŒã€Macç«¯SSHå¯†é’¥é…ç½®â€‹â€‹ ç”Ÿæˆå¯†é’¥å¯¹ï¼ˆåœ¨Macç»ˆç«¯æ‰§è¡Œï¼‰ ssh-keygen -t ed25519 -C mac_to_ubuntu æŒ‰å›è½¦æ¥å—é»˜è®¤å­˜å‚¨è·¯å¾„ï¼š/Users/ä½ çš„ç”¨æˆ·å/.ssh/id_ed25519å»ºè®®è®¾ç½®å¯†ç çŸ­è¯­ï¼ˆå¯é€‰ä½†æ›´å®‰å…¨ï¼‰ æŸ¥çœ‹å…¬é’¥å†…å®¹ï¼ˆå¤åˆ¶åé¢è¦ç”¨ï¼‰ cat ~/.ssh/id_ed25519.pub è¾“å‡ºç¤ºä¾‹ï¼šssh-ed25519 AAAAC3Nz... mac_to_ubuntu å°†å…¬é’¥ä¸Šä¼ åˆ°å°å¼æœº ssh-copy-id -i ~/.ssh/id_ed25519.pub ä½ çš„ubuntuç”¨æˆ·å@å°å¼æœºIP ç¤ºä¾‹ï¼šssh-copy-id -i ~/.ssh/id_ed25519.pub user@192.168.1.100é¦–æ¬¡éœ€è¦è¾“å…¥Ubuntuå¯†ç ssh-copy-id -i ~/.ssh/id_ed25519 dong@192.168.3.27 æµ‹è¯•å…å¯†ç™»å½• ssh -i ~/.ssh/id_ed25519 ä½ çš„ubuntuç”¨æˆ·å@å°å¼æœºIP ssh -i ~/.ssh/id_ed25519 dong@192.168.3.27æˆåŠŸåº”ç›´æ¥è¿›å…¥Ubuntuç»ˆç«¯.é€€å‡ºç»ˆç«¯ä½¿ç”¨exitå‘½ä»¤. ä¸‰ã€VSCodeé…ç½® å®‰è£…å¿…è¦æ‰©å±•åœ¨VS Codeæ‰©å±•å¸‚åœºæœç´¢å®‰è£…ï¼šRemote - SSHPythonï¼ˆMicrosoftå®˜æ–¹æ‰©å±•ï¼‰ åˆ›å»ºSSHé…ç½®æ–‡ä»¶åœ¨Macçš„~/.ssh/configä¸­æ·»åŠ ï¼ˆæ²¡æœ‰åˆ™æ–°å»ºï¼‰ï¼šHost Ubuntu-Desktop HostName 192.168.3.27 User dong IdentityFile ~/.ssh/id_ed25519 IdentitiesOnly yes 3.ç‚¹å‡»å·¦ä¸‹è§’Remote-SSH: Connect to Host4.é€‰æ‹©Ubuntu-Desktopå³å¯å¼€å§‹å¿«ä¹çš„è¿œç¨‹è°ƒç”¨äº†!","tags":["è¿œç¨‹å¼€å‘"],"categories":["3DGS"]},{"title":"2025.8.6å­¦ä¹ æ—¥è®°","path":"/2025/08/06/å­¦ä¹ æ—¥è®°25å¹´8æœˆ/2025.8.6å­¦ä¹ ç¬”è®°/","content":"ä»Šæ—¥å­¦ä¹ å†…å®¹3DGSå®ç°è¿œç¨‹è°ƒç”¨.åšäº†DASHçš„æ³¨é‡Š. åŠ›æ‰£æ¯æ—¥ä¸€é¢˜çº¿æ®µæ ‘äºŒåˆ†çš„é¢˜ç›®,åšäº†çº¿æ®µæ ‘çš„ç¬”è®°. javaé›†åˆæ¡†æ¶ç¯‡1730 é¡¹ç›®å®ç°å…¨å±€å¼‚å¸¸å¤„ç†æ¥å£. ä»£ç éšæƒ³å½•ä¸‰é“DPé¢˜ç›®. ç”Ÿæ´»ç¯‡æ™šä¸Šå¥èº«èƒ¸,è‚©,è…¿,ä¸‰å¤´,å¼ºåº¦å¤§.","tags":["åŸºç¡€","æ—¥è®°","leetcode","é¡¹ç›®"],"categories":["å­¦ä¹ æ—¥è®°","2025-08"]},{"title":"Ubuntu20ä½¿ç”¨å¤šä¸ªç‰ˆæœ¬CUDA","path":"/2025/08/05/3DGS/Ubuntu20ä½¿ç”¨å¤šä¸ªç‰ˆæœ¬CUDA/","content":"1 å‰è¨€ç”±äºé¡¹ç›®éœ€è¦,éœ€è¦åœ¨ä¸åŒç‰ˆæœ¬CUDAä¹‹é—´åˆ‡æ¢,æ‰€ä»¥éœ€è¦å®‰è£…å¤šä¸ªç‰ˆæœ¬çš„CUDA. 2 ä¸‹è½½éœ€è¦çš„CUDAç‰ˆæœ¬å‰å¾€ CUDA çš„ä¸‹è½½å®˜ç½‘ï¼šhttps://developer.nvidia.com/cuda-toolkit-archive é€‰æ‹©è‡ªå·±éœ€è¦çš„ CUDA ç‰ˆæœ¬ï¼Œé€‰æ‹©å¯¹åº”çš„ç³»ç»Ÿè¿›è¡Œä¸‹è½½ï¼Œå»ºè®®é€‰æ‹© .run å½¢å¼çš„å®‰è£…å™¨ã€‚ä»¥ root æƒé™è¿è¡Œ .run å®‰è£…å™¨ï¼Œæ ¹æ®æç¤ºè¿›è¡Œå®‰è£…å³å¯ã€‚è¿‡ç¨‹ä¸­éœ€è¦æ³¨æ„å–æ¶ˆå‹¾é€‰æ˜¾å¡é©±åŠ¨ï¼Œä¸è¦é‡æ–°å®‰è£…é©±åŠ¨ï¼Œå› ä¸ºæˆ‘ä»¬ä¸Šä¸€æ­¥å·²ç»å®‰è£…è¿‡äº†ã€‚ 3 å®‰è£…å¯¹åº”çš„ cuDNN åº“å‰å¾€ cuDNN çš„ä¸‹è½½å®˜ç½‘ï¼šhttps://developer.nvidia.com/cudnn-archive æ³¨æ„é€‰æ‹©å’Œä¸Šä¸€æ­¥å®‰è£…çš„ CUDA ç‰ˆæœ¬é€‚é…çš„ cuDNN ç‰ˆæœ¬ï¼Œæˆ‘ä»¬éœ€è¦åˆ†åˆ«ç»™æ¯ä¸ªç‰ˆæœ¬çš„ CUDA å®‰è£…å¯¹åº”ç‰ˆæœ¬çš„ cuDNN åº“ã€‚å»ºè®®é€‰æ‹© .tar.xz å½¢å¼çš„å‹ç¼©åŒ…ã€‚ ä¸‹è½½å¥½åï¼Œä½¿ç”¨ tar -xvf xxx.tar.xz è§£å‹ cuDNN åº“ï¼Œç„¶åç›´æ¥æ‰§è¡Œä»¥ä¸‹æŒ‡ä»¤è¿›è¡Œå®‰è£…ï¼šï¼ˆæ³¨æ„åœ¨æ­£ç¡®ä½ç½®å¡«ä¸Šå¯¹åº”çš„ç‰ˆæœ¬å·ï¼Œä¾‹å¦‚ cuda-12.3ï¼‰ sudo cp cudnn-*-archive/include/cudnn*.h /usr/local/cuda-ç‰ˆæœ¬å·/includesudo cp -P cudnn-*-archive/lib/libcudnn* /usr/local/cuda-ç‰ˆæœ¬å·/lib64sudo chmod a+r /usr/local/cuda-ç‰ˆæœ¬å·/include/cudnn*.h /usr/local/cuda-ç‰ˆæœ¬å·/lib64/libcudnn* 4 é…ç½®åˆ‡æ¢è„šæœ¬æˆ‘ä»¬çš„åˆ‡æ¢æ–¹å¼åŸç†æ˜¯è½¯é“¾æ¥ã€‚æ¯ä¸ª CUDA ç‰ˆæœ¬å®‰è£…åï¼Œä¼šåœ¨ usrlocal åˆ›å»ºå¯¹åº”ç‰ˆæœ¬çš„æ–‡ä»¶å¤¹ï¼Œä¾‹å¦‚ cuda-12.3ï¼Œæˆ‘ä»¬å¯ä»¥åˆ›å»ºä¸€ä¸ªè½¯é“¾æ¥ usrlocalcudaï¼Œè®©è½¯é“¾æ¥æŒ‡å‘å¯¹åº”ç‰ˆæœ¬çš„ CUDAï¼Œæˆ‘ä»¬é€šè¿‡ä¿®æ”¹è½¯é“¾æ¥çš„æŒ‡å‘å°±èƒ½ä¿®æ”¹ CUDA ç‰ˆæœ¬äº†ã€‚ æˆ‘ä»¬é€šè¿‡æ–‡æœ¬ç¼–è¾‘å™¨æ‰“å¼€ç”¨æˆ·æ–‡ä»¶å¤¹ä¸‹çš„ .bashrcï¼Œè¿™é‡Œç”¨ vim ä¸ºä¾‹ï¼švim ~/.bashrc åœ¨è¯¥æ–‡ä»¶å°¾éƒ¨æ·»åŠ ä»¥ä¸‹å†…å®¹ï¼š export PATH=$PATH:/usr/local/cuda/binexport LD_LIBRARY_PATH=$LD_LIBRARY_PATH:/usr/local/cuda/lib64function switch_cuda if [[ $1 =~ ^[0-9]+\\.[0-9]+$ ]]; then sudo rm /usr/local/cuda sudo ln -s /usr/local/cuda-$1 /usr/local/cuda nvcc --version else echo invalid version fi æ³¨æ„ï¼Œå¦‚æœä½ çš„ .bashrc å†…å·²ç»æœ‰ç±»ä¼¼äºå‰ä¸¤è¡Œçš„å†…å®¹ï¼Œé‚£ä¹ˆéœ€è¦åˆ é™¤å®ƒï¼Œæ›¿æ¢ä¸ºæˆ‘çš„å†™æ³•ã€‚ æ·»åŠ åä¿å­˜è¯¥æ–‡ä»¶ï¼Œç„¶åä½¿ç”¨ source .bashrc åˆ·æ–°è¯¥æ–‡ä»¶ã€‚ 5 æµ‹è¯•å¤šç‰ˆæœ¬åˆ‡æ¢ä¸Šè¿°è„šæœ¬åœ¨ bash å†…æ³¨å†Œäº†ä¸€ä¸ªå‡½æ•°å« switch_cudaï¼Œé€šè¿‡è°ƒç”¨è¯¥å‡½æ•°å³å¯å¿«é€Ÿåˆ‡æ¢ CUDA ç‰ˆæœ¬ã€‚ç”¨æ³•ä¸ºï¼šswitch_cuda xx.x (ç‰ˆæœ¬å·) ä»¥ä¸‹æ˜¯åˆ‡æ¢çš„æ¼”ç¤ºï¼Œé¦–å…ˆå°† CUDA ç‰ˆæœ¬åˆ‡æ¢åˆ°äº† 11.6ï¼Œç„¶åå†åˆ‡å› 12.3ï¼š","tags":["3DGS"],"categories":["3DGS"]},{"title":"2025.8.5å­¦ä¹ æ—¥è®°","path":"/2025/08/05/å­¦ä¹ æ—¥è®°25å¹´8æœˆ/2025.8.5å­¦ä¹ ç¬”è®°/","content":"ä»Šæ—¥å­¦ä¹ å†…å®¹3DGSé…ç½®ç¯å¢ƒ,è®­ç»ƒäº†DashGaussian. åŠ›æ‰£æ¯æ—¥ä¸€é¢˜ä¸€é“ç®€å•çš„On2éå†é¢˜ç›®. javaé›†åˆæ¡†æ¶ç¯‡830 é¡¹ç›®å­¦ä¹ Thymeleafæ¸²æŸ“å¼•æ“,å†™äº†ä¸€ä¸ªæ¸²æŸ“å¼•æ“åŒ…è£…ç±». ä»£ç éšæƒ³å½•ä¸¤é“DPé¢˜ç›®. ç”Ÿæ´»ç¯‡æ™šä¸Šå¥èº«ç»ƒæ‰‹è‡‚,å¼ºåº¦ä¸­ç­‰.","tags":["åŸºç¡€","æ—¥è®°","leetcode","é¡¹ç›®"],"categories":["å­¦ä¹ æ—¥è®°","2025-08"]},{"title":"2025.8.4å­¦ä¹ æ—¥è®°","path":"/2025/08/04/å­¦ä¹ æ—¥è®°25å¹´8æœˆ/2025.8.4å­¦ä¹ ç¬”è®°/","content":"ä»Šæ—¥å­¦ä¹ å†…å®¹3DGSè·‘æ•°æ®,EffectiveGSç¯å¢ƒè¿˜æ˜¯ä¸è¡Œ.ç„¶åè·‘äº†TamingGSçš„ä»£ç ,å¹¶ä¸”æ¸²æŸ“äº†ä¸€ä¸‹. åŠ›æ‰£æ¯æ—¥ä¸€é¢˜ä¸€é“æ»‘åŠ¨çª—å£çš„é¢˜ç›®. javaé›†åˆæ¡†æ¶ç¯‡830 é¡¹ç›®å­¦ä¹ Thymeleafæ¸²æŸ“å¼•æ“.å¹¶ä¸”åšäº†ä¸€ç¯‡ç¬”è®°. ä»£ç éšæƒ³å½•ç”Ÿæ´»ç¯‡æ™šä¸Šå¥èº«ç»ƒèƒŒ,å¼ºåº¦åå¤§.","tags":["åŸºç¡€","æ—¥è®°","leetcode","é¡¹ç›®"],"categories":["å­¦ä¹ æ—¥è®°","2025-08"]},{"title":"Thymeleafæ¨¡ç‰ˆå¼•æ“","path":"/2025/08/04/é¡¹ç›®ç¬”è®°/Thymeleafæ¨¡ç‰ˆå¼•æ“/","content":"å‚è€ƒæ–‡ç« :æŠ€æœ¯æ´¾Thymeleafæ¨¡æ¿å¼•æ“ Thymeleafæ˜¯ä»€ä¹ˆThymeleaf æ˜¯ä¸€ä¸ªä¼˜ç§€çš„ã€é¢å‘ Java çš„ HTML é¡µé¢æ¨¡æ¿ï¼Œå…·æœ‰ä¸°å¯Œçš„æ ‡ç­¾è¯­è¨€å’Œå‡½æ•°ã€‚åœ¨ JSP è¢«æ·˜æ±°ä¹‹åï¼ŒThymeleaf å–è€Œä»£ä¹‹æˆä¸ºäº† Spring Boot æ¨èçš„æ¨¡æ¿å¼•æ“ã€‚ Thymeleaf åœ¨æœ‰ç½‘å’Œæ²¡ç½‘çš„ç¯å¢ƒä¸‹éƒ½å¯ä»¥æ­£å¸¸å·¥ä½œï¼Œæ—¢èƒ½è®©ç¾å·¥åœ¨æµè§ˆå™¨ä¸­æŸ¥çœ‹é¡µé¢çš„é™æ€æ•ˆæœï¼Œä¹Ÿèƒ½è®©ç¨‹åºå‘˜åœ¨æœåŠ¡å™¨æŸ¥çœ‹å¸¦æ•°æ®çš„åŠ¨æ€é¡µé¢æ•ˆæœã€‚ è¿™æ˜¯å› ä¸º Thymeleaf æ”¯æŒ HTML åŸå‹ï¼Œåœ¨ HTML æ ‡ç­¾é‡Œå¢åŠ é¢å¤–çš„å±æ€§æ¥è¾¾åˆ°æ¨¡æ¿+æ•°æ®çš„å±•ç¤ºæ–¹å¼ã€‚ æµè§ˆå™¨åœ¨è§£é‡Š HTML çš„æ—¶å€™ä¼šå¿½ç•¥æœªå®šä¹‰çš„æ ‡ç­¾å±æ€§ï¼Œæ‰€ä»¥ Thymeleaf å¯ä»¥é™æ€åœ°è¿è¡Œï¼›å½“æœ‰æ•°æ®è¿”å›é¡µé¢æ—¶ï¼ŒThymeleaf æ ‡ç­¾ä¼šåŠ¨æ€åœ°æ›¿æ¢é™æ€å†…å®¹ã€‚ ä¸‹é¢åˆ—ä¸¾ä¸€äº› Thymeleaf å¸¸ç”¨çš„è¡¨è¾¾å¼ã€æ ‡ç­¾å’Œå‡½æ•°ã€‚ å¸¸ç”¨è¡¨è¾¾å¼1ï¼‰å¸¸ç”¨è¡¨è¾¾å¼ $... å˜é‡è¡¨è¾¾å¼ *... é€‰æ‹©è¡¨è¾¾å¼ #... æ–‡å­—è¡¨è¾¾å¼ @... URL è¡¨è¾¾å¼ #maps å¯¹è±¡è¡¨è¾¾å¼2ï¼‰å¸¸ç”¨æ ‡ç­¾ th:action å®šä¹‰æœåŠ¡å™¨ç«¯æ§åˆ¶å™¨è·¯å¾„ã€‚ th:each å¾ªç¯è¯­å¥ th:field è¡¨å•å­—æ®µ th:href URL é“¾æ¥ th:id div æ ‡ç­¾ä¸­çš„ ID th:if æ¡ä»¶åˆ¤æ–­ th:include å¼•å…¥æ–‡ä»¶ th:fragment å®šä¹‰ä»£ç ç‰‡æ®µ th:object æ›¿æ¢å¯¹è±¡ th:src å›¾ç‰‡åœ°å€ th:text æ–‡æœ¬ th:value å±æ€§å€¼3ï¼‰å¸¸ç”¨å‡½æ•° #dates æ—¥æœŸå‡½æ•° #lists åˆ—è¡¨å‡½æ•° #arrays æ•°ç»„å‡½æ•° #strings å­—ç¬¦ä¸²å‡½æ•° #numbers æ•°å­—å‡½æ•° #calendars æ—¥å†å‡½æ•° #objects å¯¹è±¡å‡½æ•° #bools å¸ƒå°”å‡½æ•° æƒ³è¦æŸ¥çœ‹æ›´å¤š Thymeleaf è¡¨è¾¾å¼ã€æ ‡ç­¾ã€å‡½æ•°ç­‰å†…å®¹ï¼Œå¯ä»¥åˆ° Thymeleaf å®˜ç½‘ï¼š https://www.thymeleaf.org/ é¡¹ç›®å¦‚ä½•æ•´åˆThymeleafç¬¬ä¸€æ­¥ å¼•å…¥ä¾èµ–ç¬¬ä¸€æ­¥ï¼Œåœ¨ ui æ¨¡å— pom.xml æ–‡ä»¶ä¸­æ·»åŠ  Thymeleaf çš„ stater dependency groupIdorg.springframework.boot/groupId artifactIdspring-boot-starter-thymeleaf/artifactId/dependency ç¬¬äºŒæ­¥ é…ç½®Thymeleafç¬¬äºŒæ­¥ï¼Œåœ¨ web æ¨¡å— devapplication-web.yml æ–‡ä»¶ä¸­æ·»åŠ  Thymeleaf çš„é…ç½® spring: thymeleaf: mode: HTML encoding: UTF-8 servlet: content-type: text/html cache: false mode: æ¨¡æ¿æ¨¡å¼ï¼Œé€šå¸¸æƒ…å†µä¸‹è®¾ç½®ä¸º â€œHTMLâ€ã€‚ encoding: æ¨¡æ¿æ–‡ä»¶çš„å­—ç¬¦ç¼–ç ï¼Œé€šå¸¸è®¾ç½®ä¸º â€œUTF-8â€ã€‚ servlet.content-type: åœ¨ Servlet ç¯å¢ƒä¸­ï¼Œæ¨¡æ¿çš„ content typeã€‚ä¸€èˆ¬è®¾ç½®ä¸º â€œtexthtmlâ€ï¼Œä»£è¡¨ç”Ÿæˆçš„å†…å®¹æ˜¯ HTMLã€‚ cache: æ˜¯å¦ç¼“å­˜æ¨¡æ¿ã€‚åœ¨å¼€å‘ç¯å¢ƒä¸­ï¼Œé€šå¸¸è®¾ç½®ä¸º falseï¼Œè¿™æ ·æ¯æ¬¡ä¿®æ”¹æ¨¡æ¿æ–‡ä»¶åï¼Œä¸éœ€è¦é‡å¯åº”ç”¨å°±å¯ä»¥çœ‹åˆ°æ•ˆæœã€‚åœ¨ç”Ÿäº§ç¯å¢ƒä¸­ï¼Œé€šå¸¸è®¾ç½®ä¸º trueï¼Œä»¥æé«˜æ€§èƒ½ã€‚å¯å‚ç…§ prodapplication-web.yml ç¬¬ä¸‰æ­¥ ç¼–å†™æ§åˆ¶å™¨ç¬¬ä¸‰æ­¥ï¼Œæˆ‘ä»¬ç›´æ¥æ¥çœ‹é¦–é¡µå§ï¼Œåœ¨ IndexController ä¸­æ·»åŠ  index æ–¹æ³•ï¼Œå†…å®¹å¦‚ä¸‹ã€‚ @GetMapping(path = /, , /index)public String index(Model model, HttpServletRequest request) String activeTab = request.getParameter(category);//è·å–å½“å‰æ¿€æ´»çš„å†…å®¹åˆ†ç±» IndexVo vo = indexRecommendHelper.buildIndexVo(activeTab);//æ ¹æ®å½“å‰æ¿€æ´»çš„åˆ†ç±»è·å–é¦–é¡µæ•°æ® model.addAttribute(vo, vo); return views/home/index; æˆ‘å°è¯•å¤§ç™½è¯è®²ä¸€ä¸‹ä¸Šé¢ä»£ç æ¸²æŸ“æ¨¡æ¿çš„é€»è¾‘: å®¢æˆ·ç«¯å‘é€è¯·æ±‚åˆ°æœåŠ¡å™¨ä¼šè¢«controlleræ¥æ”¶åˆ°,ç„¶ååœ¨ä¸Šé¢è·å–åˆ°äº†æ•°æ®. ç„¶åå°†è¿™ä¸ªæ•°æ®æ·»åŠ åˆ°äº†Modelä¸­,æœ€åè¿”å›â€viewshomeindexâ€è§†å›¾. è¿™ä¸ªè§†å›¾ä¼šè¢«Thymeleafå¼•æ“è§£æ,ç„¶åå°†Modelä¸­çš„æ•°æ®å¡«å……åˆ°è§†å›¾ä¸­. æœ€åè¿”å›ç»™å®¢æˆ·ç«¯. å¾ˆå¥½ç†è§£ï¼Œå½“è®¿é—®é¦–é¡µçš„æ—¶å€™ï¼Œè¿”å› â€œviewshomeindexâ€ è§†å›¾ï¼Œè¯¥è§†å›¾æ˜¯ä¸€ä¸ª Thymeleaf é¡µé¢ã€‚ ä¸åŒçš„ControllerSpringMVCé‡Œé¢è¿”å›ç±»å‹çš„åŒºåˆ†ä¸»è¦åŸºäºä¸‹é¢: æ§åˆ¶å™¨ç±»å‹@Controller // é»˜è®¤è¿”å›è§†å›¾åç§°@RestController // = @Controller + @ResponseBodyï¼Œç›´æ¥è¿”å›JSON æ–¹æ³•çº§æ³¨è§£@GetMapping(/page)public String page(Model model) /* è¿”å›è§†å›¾ */ @ResponseBody@GetMapping(/api/data)public DataVo api() /* è¿”å›JSON */ å†…å®¹åå•†æœºåˆ¶GET /api/data.json // è¿”å›JSONGET /api/data.xml // è¿”å›XML å¸¸è§åº”ç”¨åœºæ™¯graph LRA[è¯·æ±‚ç±»å‹] -- Bå«.html/.ftlç­‰åç¼€B --|æ˜¯| C[è¿”å›è§†å›¾æ¨¡æ¿]B --|å¦| D[è¿”å›JSON] å®é™…å¼€å‘ä¸­å»ºè®®:å‰åç«¯åˆ†ç¦»é¡¹ç›®ç»Ÿä¸€ä½¿ç”¨@RestControlleræœåŠ¡ç«¯æ¸²æŸ“é¡µé¢ä½¿ç”¨@Controlleræ··åˆæ¨¡å¼å¯ä»¥é€šè¿‡produceså±æ€§æ˜ç¡®æŒ‡å®šï¼š @GetMapping(value = /api/data, produces = application/json)public DataVo api() /* è¿”å›JSON */ ç¬¬å››æ­¥ ç¼–å†™Thymeleafé¡µé¢ç¬¬å››æ­¥ï¼Œåœ¨ paicoding-ui æ¨¡å—ä¸‹æ–°å»º index.html æ–‡ä»¶ï¼ˆæ–‡ä»¶åå¯¹åº”æ§åˆ¶å™¨ä¸­ index æ–¹æ³•è¿”å›çš„å­—ç¬¦ä¸²ï¼‰. è¿™é‡Œåªæˆªä¸ªå›¾ï¼Œç®€å•è§£é‡Šä¸€ä¸‹é‡Œé¢ç”¨åˆ° Thymeleaf çš„å‡ ä¸ªå…³é”®ç‚¹ã€‚ html lang=zh xmlns:th=http://www.thymeleaf.org ä¸º Thymeleaf çš„å‘½åç©ºé—´ï¼Œé€šè¿‡å¼•å…¥å‘½åç©ºé—´å°±å¯ä»¥åœ¨ HTML æ–‡ä»¶ä¸­ä½¿ç”¨ Thymeleaf æ ‡ç­¾è¯­è¨€ï¼Œç”¨å…³é”®å­— â€œthâ€æ¥æ ‡æ³¨ã€‚ th:replace: ç”¨æŒ‡å®šçš„æ¨¡æ¿ç‰‡æ®µæ›¿æ¢å½“å‰çš„å…ƒç´ ã€‚æ¯”å¦‚ th:replace=components/layout/header :: head(~::title, ~, ~) å°±æ˜¯å°†å½“å‰çš„ div å…ƒç´ æ›¿æ¢ä¸º components/layout/header æ¨¡æ¿ä¸­çš„ head ç‰‡æ®µã€‚ th:text: è®¾ç½®å…ƒç´ çš„æ–‡æœ¬å†…å®¹ã€‚æ¯”å¦‚ th:text=$global.siteInfo.websiteName å°±æ˜¯å°†å½“å‰å…ƒç´ çš„æ–‡æœ¬å†…å®¹è®¾ç½®ä¸º global.siteInfo.websiteName çš„å€¼ã€‚ th:href: è®¾ç½®å…ƒç´ çš„ href å±æ€§ã€‚ç±»ä¼¼çš„è¿˜æœ‰ th:srcï¼Œç”¨äºè®¾ç½®å…ƒç´ çš„ src å±æ€§ã€‚ th:if: è®¾ç½®å…ƒç´ çš„æ¡ä»¶æ˜¾ç¤ºã€‚å¦‚æœè¡¨è¾¾å¼çš„å€¼ä¸º trueï¼Œåˆ™æ˜¾ç¤ºå…ƒç´ ï¼Œå¦åˆ™ä¸æ˜¾ç¤ºã€‚æ¯”å¦‚ th:if=$!#lists.isEmpty(vo.sideBarItems)ï¼Œå¦‚æœ vo.sideBarItems ä¸ä¸ºç©ºï¼Œå°±æ˜¾ç¤ºå½“å‰å…ƒç´ ã€‚ th:inline=javascript è¡¨ç¤ºä¸‹é¢çš„ script æ ‡ç­¾ä¸­åŒ…å« Thymeleaf è¡¨è¾¾å¼ï¼Œéœ€è¦è¿›è¡Œå¤„ç†ã€‚ ç¬¬äº”æ­¥ æµ‹è¯•ç¬¬äº”æ­¥ï¼Œå¯åŠ¨ä¸»ç±»ï¼Œåœ¨æµè§ˆå™¨åœ°å€æ é‡Œè¾“å…¥ http://127.0.0.1:8080/ è®¿é—®é¦–é¡µã€‚ Spring Boot æ˜¯å¦‚ä½•è‡ªåŠ¨è£…é… Thymeleaf çš„ï¼ŸSpring Boot çš„æ ¸å¿ƒåŠŸèƒ½å°±æ˜¯è‡ªåŠ¨é…ç½®ï¼Œè¿™åœ¨æ•´åˆ Thymeleaf æ—¶ä¹Ÿä¸ä¾‹å¤–ã€‚å½“æˆ‘ä»¬åœ¨é¡¹ç›®ä¾èµ–ä¸­åŠ å…¥ spring-boot-starter-thymeleaf åï¼ŒSpring Boot å°±ä¼šè‡ªåŠ¨é…ç½® Thymeleafã€‚è¿™åŒ…æ‹¬åˆ›å»º Thymeleaf çš„æ¨¡æ¿è§£æå™¨ã€æ¨¡æ¿å¼•æ“ï¼Œä»¥åŠè§†å›¾è§£æå™¨ã€‚ åœ¨ Spring Boot çš„è‡ªåŠ¨è£…é…æ¨¡å—ï¼ˆspring-boot-autoconfigureï¼‰ä¸­ï¼Œæœ‰ä¸€ä¸ªåä¸º ThymeleafAutoConfiguration çš„é…ç½®ç±»ï¼Œè¿™ä¸ªç±»è´Ÿè´£ Thymeleaf çš„è‡ªåŠ¨é…ç½®ã€‚ å¤§å®¶å¯ä»¥æ‰’å¼€ ThymeleafAutoConfiguration ç»†è‡´çœ‹ä¸€ä¸‹ï¼Œæˆ‘è¿™é‡Œå¸®å¤§å®¶æ¢³ç†å‡ ä¸ªç‚¹ï¼š â‘ ã€@EnableConfigurationProperties(ThymeleafProperties.class): å¯ç”¨ Thymeleaf çš„é…ç½®å±æ€§ç±» ThymeleafPropertiesï¼Œè¿™ä¸ªç±»å®šä¹‰äº† Thymeleaf çš„å„ç§é…ç½®é¡¹ï¼Œå¦‚æ¨¡æ¿çš„ä½ç½®ã€ç¼“å­˜ç­–ç•¥ç­‰ã€‚ å’Œæˆ‘ä»¬å‰é¢æåˆ°çš„ Thymeleaf é…ç½®é¡¹æ˜¯å‘¼åº”çš„ã€‚ â‘¡ã€@ConditionalOnClass({ TemplateMode.class, SpringTemplateEngine.class }): è¿™ä¸ªæ¡ä»¶æ³¨è§£è¡¨ç¤ºåªæœ‰å½“ç±»è·¯å¾„ä¸­å­˜åœ¨ TemplateMode ç±»å’Œ SpringTemplateEngine ç±»æ—¶ï¼Œæ‰ä¼šå¯ç”¨è¿™ä¸ªè‡ªåŠ¨é…ç½®ã€‚ TemplateMode æ˜¯ Thymeleaf çš„ç±»ã€‚ SpringTemplateEngine æ˜¯ Spring ä¸ Thymeleaf é›†æˆçš„ç±»ã€‚ æ‰€ä»¥ï¼Œè¿™ä¸ªé…ç½®ç±»çš„å¯åŠ¨æ¡ä»¶æ˜¯ Thymeleaf å’Œ Spring éƒ½å­˜åœ¨ã€‚ æ¨¡ç‰ˆè§£æå™¨åœ¨ ThymeleafAutoConfiguration ä¸­ï¼Œæœ‰ä¸€ä¸ªåä¸º DefaultTemplateResolverConfiguration çš„å†…éƒ¨ç±»ï¼Œè¿™ä¸ªç±»è´Ÿè´£åˆ›å»º Thymeleaf çš„æ¨¡æ¿è§£æå™¨ã€‚ Thymeleaf æ¨¡æ¿è§£æå™¨è´Ÿè´£è§£ææ¨¡æ¿æ–‡ä»¶ï¼Œå¹¶å°†æ¨¡æ¿æ–‡ä»¶è§£æä¸º Thymeleaf å¯ä»¥å¤„ç†çš„å†…éƒ¨ç»“æ„ã€‚DefaultTemplateResolverConfiguration æ¨¡æ¿è§£æå™¨å¯ä»¥å¤„ç†åœ¨ classpath:/templates/ ç›®å½•ä¸‹çš„ .html æ–‡ä»¶ã€‚ æ¨¡æ¿å¼•æ“æ¨¡æ¿å¼•æ“æ˜¯ Thymeleaf çš„æ ¸å¿ƒï¼Œå®ƒè´Ÿè´£æ‰§è¡Œæ¨¡æ¿çš„å¤„ç†å’Œæ¸²æŸ“ã€‚åœ¨å¤„ç†æ¨¡æ¿æ—¶ï¼Œæ¨¡æ¿å¼•æ“ä¼šä½¿ç”¨è¡¨è¾¾å¼æ‰§è¡Œå¼•æ“å¯¹ Thymeleaf è¡¨è¾¾å¼è¿›è¡Œæ±‚å€¼ï¼ŒåŒæ—¶è¿˜ä¼šæ‰§è¡Œæ‰€æœ‰å®šä¹‰çš„å¤„ç†å™¨ã€‚ åœ¨ Thymeleaf ä¸­ï¼Œæ¨¡æ¿å¼•æ“çš„æ ¸å¿ƒç±»æ˜¯ org.thymeleaf.TemplateEngineã€‚è¯¥ç±»è´Ÿè´£å¤„ç†æ¨¡æ¿ï¼Œå¹¶äº§ç”Ÿå¤„ç†ç»“æœã€‚SpringTemplateEngine æ˜¯ TemplateEngine çš„å­ç±»ï¼Œæ¯”å¦‚åœ¨ ThymeleafWebMvcConfiguration å’Œ ThymeleafWebFluxConfiguration ç±»ä¸­ï¼ŒSpringTemplateEngine å¯¹è±¡ä¼šè¢«æ³¨å…¥åˆ° ThymeleafViewResolver å’Œ ThymeleafReactiveViewResolver ä¸­ã€‚ TemplateEngineConfigurations.DefaultTemplateEngineConfiguration å’Œ TemplateEngineConfigurations.ReactiveTemplateEngineConfiguration é…ç½®ç±»è´Ÿè´£å…·ä½“çš„å¼•æ“é…ç½®ã€‚ è§†å›¾è§£æå™¨è§†å›¾è§£æå™¨çš„ä»»åŠ¡æ˜¯å°†æ§åˆ¶å™¨æ–¹æ³•è¿”å›çš„è§†å›¾åè§£æä¸ºå®é™…çš„è§†å›¾å¯¹è±¡ã€‚åœ¨ Spring Boot è‡ªåŠ¨é…ç½®çš„ Thymeleaf ä¸­ï¼Œè§†å›¾åå°±æ˜¯æ¨¡æ¿æ–‡ä»¶çš„åå­—ã€‚ä¾‹å¦‚ï¼Œè§†å›¾å â€œindexâ€ å¯¹åº”çš„æ¨¡æ¿æ–‡ä»¶æ˜¯ classpath:/templates/index.htmlã€‚ åœ¨ ThymeleafAutoConfiguration ä¸­ï¼Œæœ‰ä¸€ä¸ªåä¸º ThymeleafWebMvcConfiguration çš„å†…éƒ¨ç±»ï¼Œå®ƒå†…éƒ¨åˆæœ‰ä¸€ä¸ªå†…éƒ¨ç±» ThymeleafViewResolverConfigurationï¼Œè¿™ä¸ªç±»è´Ÿè´£åˆ›å»º Thymeleaf çš„è§†å›¾è§£æå™¨ã€‚ // é…ç½®ç±»æ³¨è§£ï¼ŒproxyBeanMethods=falseè¡¨ç¤ºä¸ä»£ç†@Beanæ–¹æ³•ï¼Œä¼˜åŒ–å¯åŠ¨æ€§èƒ½@Configuration(proxyBeanMethods = false)static class ThymeleafViewResolverConfiguration // å®šä¹‰Thymeleafè§†å›¾è§£æå™¨Bean @Bean // ä»…å½“å®¹å™¨ä¸­ä¸å­˜åœ¨åä¸ºthymeleafViewResolverçš„Beanæ—¶æ‰åˆ›å»º @ConditionalOnMissingBean(name = thymeleafViewResolver) ThymeleafViewResolver thymeleafViewResolver(ThymeleafProperties properties, SpringTemplateEngine templateEngine) ThymeleafViewResolver resolver = new ThymeleafViewResolver(); // è®¾ç½®æ¨¡æ¿å¼•æ“ resolver.setTemplateEngine(templateEngine); // ä»é…ç½®è·å–å­—ç¬¦ç¼–ç  resolver.setCharacterEncoding(properties.getEncoding().name()); // ç»„åˆå†…å®¹ç±»å‹å’Œå­—ç¬¦ç¼–ç  resolver.setContentType( appendCharset(properties.getServlet().getContentType(), resolver.getCharacterEncoding())); // è®¾ç½®æ˜¯å¦åœ¨æ¸²æŸ“è¿‡ç¨‹ä¸­äº§ç”Ÿéƒ¨åˆ†è¾“å‡º resolver.setProducePartialOutputWhileProcessing( properties.getServlet().isProducePartialOutputWhileProcessing()); // è®¾ç½®æ’é™¤çš„è§†å›¾åç§° resolver.setExcludedViewNames(properties.getExcludedViewNames()); // è®¾ç½®åŒ¹é…çš„è§†å›¾åç§° resolver.setViewNames(properties.getViewNames()); // è®¾ç½®è§£æå™¨é¡ºåº(ä½ä¼˜å…ˆçº§)ï¼Œä½œä¸ºåå¤‡è§£æå™¨ resolver.setOrder(Ordered.LOWEST_PRECEDENCE - 5); // æ˜¯å¦å¯ç”¨ç¼“å­˜ resolver.setCache(properties.isCache()); return resolver; ç®€å•æ€»ç»“ä¸€ä¸‹ï¼ŒSpring Booté€šè¿‡ThymeleafAutoConfigurationç±»æ¥è‡ªåŠ¨è£…é…Thymeleafã€‚è¯¥ç±»å®šä¹‰äº†è®¸å¤šBeanï¼ˆå¦‚SpringTemplateEngineï¼ŒThymeleafViewResolverç­‰ï¼‰ï¼Œå¹¶ä½¿ç”¨æ¡ä»¶æ³¨è§£ï¼ˆå¦‚@ConditionalOnClassï¼Œ@ConditionalOnMissingBeanç­‰ï¼‰æ¥å®ç°æ¡ä»¶è£…é…ã€‚ç”±äºä½¿ç”¨äº†@EnableConfigurationProperties(ThymeleafProperties.class)æ³¨è§£æ¥æ³¨å…¥å’Œè¯»å–Thymeleafç›¸å…³å±æ€§ï¼Œæ‰€ä»¥æˆ‘ä»¬å¯ä»¥åœ¨ application.yml ä¸­è‡ªå®šä¹‰ Thymeleaf çš„é…ç½®é¡¹ã€‚ å¦‚ä½•å°†åç«¯æ•°æ®è¿”å›ç»™ Thymeleaf å‘¢ï¼Ÿç†è§£äº† Thymeleaf çš„è‡ªåŠ¨è£…é…æœºåˆ¶åï¼Œæˆ‘ä»¬å†æ¥æ€è€ƒä¸€ä¸ªé—®é¢˜ï¼šå¦‚æœæˆ‘ä»¬æƒ³æŠŠåç«¯çš„æ•°æ®ä¼ å›ç»™ Thymeleafï¼Œè¯¥æ€ä¹ˆåŠå‘¢ï¼Ÿ å…¶å®ä¹Ÿç®€å•ï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡ Model çš„ addAttribute æ–¹æ³•æ¥å®Œæˆï¼Œæ¯”å¦‚è¯´ model.addAttribute(vo, vo);ã€‚ è¿™æ ·å°±èƒ½å°†æ•°æ®ä¼ å›ç»™ Thymeleaf äº†ã€‚ é‚£ Thymeleaf é¡µé¢ä¸­å¦‚ä½•å–å‡ºè¿™äº›æ•°æ®å‘¢ï¼Ÿåœ¨ HTML ä¸­ï¼Œå¯ä»¥é€šè¿‡ ${vo.xxxx} çš„æ–¹å¼ã€‚ div th:replace=views/home/navbar/index :: navbar($vo.categories)/div è¿™ä¸€è¡Œä»£ç è¡¨ç¤ºï¼Œç”¨æ¨¡æ¿æ–‡ä»¶viewshomenavbarindexä¸­å®šä¹‰çš„navbarå…ƒç´ ï¼ˆå¯èƒ½æ˜¯ä¸€ä¸ªHTMLçš„ç‰‡æ®µæˆ–æ•´ä¸ªå…ƒç´ ï¼‰æ›¿æ¢å½“å‰divæ ‡ç­¾ã€‚$vo.categoriesè¡¨ç¤ºä¼ é€’ç»™navbarå…ƒç´ çš„å‚æ•°ã€‚åœ¨æ¨¡æ¿æ–‡ä»¶viewshomenavbarindexä¸­ï¼Œè¿™ä¸ªå‚æ•°å¯ä»¥ä½¿ç”¨Thymeleafçš„è¡¨è¾¾å¼è®¿é—®ã€‚ åœ¨ JavaScript ä¸­ï¼Œå¯ä»¥é€šè¿‡ const archiveId = [[$vo.yyyy]] çš„æ–¹å¼ã€‚ script th:inline=javascript const archiveId = [[$vo.categoryId]] const category = [[$ vo.currentCategory ]] const params = category: category ? category : å…¨éƒ¨, page: 2 /script [[$vo.categoryId]]æ˜¯Thymeleafçš„å†…è”è¡¨è¾¾å¼ï¼Œè¿™è¡¨ç¤ºåœ¨æœåŠ¡å™¨ç«¯æ¸²æŸ“é¡µé¢æ—¶ï¼Œè¿™ä¸ªè¡¨è¾¾å¼ä¼šè¢«$vo.categoryIdçš„å€¼æ›¿ä»£ã€‚ é‚£å¦‚æœæ˜¯ä¸€äº›å…¬å…±çš„å±æ€§ï¼Œé’ˆå¯¹æ‰€æœ‰é¡µé¢çš„å…¨å±€ä¿¡æ¯ï¼Œè¯¥æ€ä¹ˆåŠå‘¢ï¼Ÿ æˆ‘ä»¬å¯ä»¥é€šè¿‡å…¨å±€æ‹¦æˆªå™¨çš„æ–¹å¼ï¼ŒGlobalViewInterceptor ä¸­çš„ postHandleï¼ˆè¿™ä¸ªæ–¹æ³•åœ¨è¯·æ±‚å¤„ç†å®Œæˆåï¼Œä½†åœ¨è§†å›¾æ¸²æŸ“ä¹‹å‰æ‰§è¡Œï¼‰æ¥å®Œæˆã€‚ é€šè¿‡ modelAndView.getModel().put(global, globalInitService.globalAttr()); æ¥å¾€è§†å›¾ä¸­å¢åŠ ä¸€äº›å…¨å±€ä¿¡æ¯ã€‚ æ¯”å¦‚è¯´æŠŠå¼€å‘ç¯å¢ƒã€æµ‹è¯•ç¯å¢ƒè¿˜æ˜¯ç”Ÿäº§ç¯å¢ƒæ”¾è¿›æ¥ï¼Œç„¶åé€šè¿‡ $global.env çš„æ–¹å¼è®¿é—®ã€‚ å°ç»“Spring Booté€šè¿‡è‡ªåŠ¨é…ç½®ï¼ˆAuto-configurationï¼‰å¯ä»¥è½»æ¾æ•´åˆäº†Thymeleafæ¨¡æ¿å¼•æ“ã€‚ åªéœ€è¦åœ¨é¡¹ç›®ä¸­æ·»åŠ Spring Boot Thymeleaf Starterä¾èµ–ï¼Œå°±èƒ½å¯ç”¨Thymeleafçš„è‡ªåŠ¨é…ç½®ï¼Œè¯¥è¿‡ç¨‹åœ¨ThymeleafAutoConfigurationç±»ä¸­å®ç°ã€‚ è‡ªåŠ¨é…ç½®ä¼šåˆ›å»ºå¿…è¦çš„SpringTemplateEngineï¼ŒThymeleafViewResolverç­‰Beanã€‚ åœ¨application.ymlä¸­ï¼Œå¯ä»¥å¯¹Thymeleafè¿›è¡Œä¸ªæ€§åŒ–é…ç½®ï¼Œå¦‚æ¨¡æ¿çš„å‰ç¼€å’Œåç¼€ï¼Œç¼“å­˜ç­–ç•¥ç­‰ã€‚ åœ¨Controllerå±‚ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨Modelå¯¹è±¡å°†æ•°æ®ä¼ é€’åˆ°Thymeleafä¸­ï¼Œå¹¶åœ¨æ¨¡æ¿ä¸­åˆ©ç”¨Thymeleafçš„å„ç§æ ‡ç­¾ï¼ˆå¦‚th:textï¼Œth:ifç­‰ï¼‰è¿›è¡Œæ•°æ®æ¸²æŸ“å’Œäº¤äº’é€»è¾‘å¤„ç†ã€‚ å¦‚æœéœ€è¦ä¸€äº›å…¨å±€ä¿¡æ¯ï¼Œåˆ™å¯ä»¥é€šè¿‡æ‹¦æˆªå™¨æ¥å®Œæˆã€‚ ä»¥ä¸Šï¼Œå°¤å…¶æ˜¯ Thymeleaf çš„è‡ªåŠ¨è£…é…å’Œå…¨å±€ä¿¡æ¯è¿™é‡Œå¯ä»¥å®æ“ä¸€ä¸‹ï¼Œä¼šå­¦åˆ°å¾ˆå¤šã€‚","tags":["é¡¹ç›®","æ¨¡æ¿å¼•æ“"],"categories":["é¡¹ç›®ç¬”è®°"]},{"title":"2025.8.2å­¦ä¹ æ—¥è®°","path":"/2025/08/02/å­¦ä¹ æ—¥è®°25å¹´8æœˆ/2025.8.2å­¦ä¹ ç¬”è®°/","content":"ä»Šæ—¥å­¦ä¹ å†…å®¹3DGSæ ‡æ³¨æ•°æ® åŠ›æ‰£æ¯æ—¥ä¸€é¢˜ä¸€é“å›°éš¾é¢˜. javaé›†åˆæ¡†æ¶ç¯‡130 é¡¹ç›®é‡æ–°æ¢³ç†äº†å¾®ä¿¡éªŒè¯ç ç™»å½•çš„é€»è¾‘,åŸºæœ¬å·²ç»æ¸…æ¥šäº†.é¦–å…ˆåœ¨TecHubç½‘é¡µç‚¹å‡»ç™»å½•æŒ‰é’®,å‰ç«¯ä¼šå‘é€subscribeè¯·æ±‚åˆ°åç«¯,æ­¤æ—¶å°±ä¼šåˆ›å»ºé•¿è¿æ¥,å¹¶ä¸”åœ¨åç«¯è¿›è¡Œç¼“å­˜,é€šè¿‡è®¾å¤‡å·è®°å½•é•¿è¿æ¥å’ŒéªŒè¯ç .ç„¶åå¦‚æœæ­¤æ—¶é€šè¿‡å¾®ä¿¡å‘é€éªŒè¯ç ä¹‹å,é¦–å…ˆä¼šé€šè¿‡å¾®ä¿¡å¹³å°å°†æ”¶åˆ°çš„æ¶ˆæ¯è½¬å‘åˆ°åç«¯callbackæ¥å£,ç„¶ååœ¨æ¥å£ä¸­å¯¹æ•°æ®è¿›è¡Œåˆ¤æ–­,å¦‚æœæ”¶åˆ°çš„æ¶ˆæ¯æ˜¯éªŒè¯ç å…³é”®å­—,ä¼šè¿›è¡Œåˆ¤æ–­,è¿™ä¸ªéªŒè¯ç æ˜¯å¦å¯¹åº”äº†æŸä¸ªé•¿è¿æ¥,å¦‚æœæœ‰çš„è¯å°±è¿›è¡Œç™»å½•æ“ä½œ. ä»£ç éšæƒ³å½•ç”Ÿæ´»ç¯‡","tags":["åŸºç¡€","æ—¥è®°","leetcode","é¡¹ç›®"],"categories":["å­¦ä¹ æ—¥è®°","2025-08"]},{"title":"Javaé›†åˆæ¡†æ¶å­¦ä¹ ç¬”è®°","path":"/2025/08/01/Javaé—®ç­”ç¬”è®°/Javaé›†åˆæ¡†æ¶å­¦ä¹ ç¬”è®°/","content":"å¼•è¨€1.ğŸŒŸè¯´è¯´æœ‰å“ªäº›å¸¸è§çš„é›†åˆæ¡†æ¶ï¼Ÿ æ¨èé˜…è¯»ï¼šäºŒå“¥çš„ Java è¿›é˜¶ä¹‹è·¯ï¼šJava é›†åˆæ¡†æ¶ æ¨èé˜…è¯»ï¼šé˜»å¡é˜Ÿåˆ— BlockingQueueã€‚ é›†åˆæ¡†æ¶å¯ä»¥åˆ†ä¸ºä¸¤æ¡å¤§çš„æ”¯çº¿ï¼š â‘ ã€ç¬¬ä¸€æ¡æ”¯çº¿ Collectionï¼Œä¸»è¦ç”± Listã€Setã€Queue ç»„æˆï¼š List ä»£è¡¨æœ‰åºã€å¯é‡å¤çš„é›†åˆï¼Œå…¸å‹ä»£è¡¨å°±æ˜¯å°è£…äº†åŠ¨æ€æ•°ç»„çš„Â ArrayListÂ å’Œå°è£…äº†é“¾è¡¨çš„Â LinkedListï¼› Set ä»£è¡¨æ— åºã€ä¸å¯é‡å¤çš„é›†åˆï¼Œå…¸å‹ä»£è¡¨å°±æ˜¯ HashSet å’Œ TreeSetï¼› Queue ä»£è¡¨é˜Ÿåˆ—ï¼Œå…¸å‹ä»£è¡¨å°±æ˜¯åŒç«¯é˜Ÿåˆ—Â ArrayDequeï¼Œä»¥åŠä¼˜å…ˆçº§é˜Ÿåˆ—Â PriorityQueueã€‚ â‘¡ã€ç¬¬äºŒæ¡æ”¯çº¿ Mapï¼Œä»£è¡¨é”®å€¼å¯¹çš„é›†åˆï¼Œå…¸å‹ä»£è¡¨å°±æ˜¯Â HashMapã€‚ å¦å¤–ä¸€ä¸ªå›ç­”ç‰ˆæœ¬ï¼š â‘ ã€Collection æ¥å£ï¼šæœ€åŸºæœ¬çš„é›†åˆæ¡†æ¶è¡¨ç¤ºæ–¹å¼ï¼Œæä¾›äº†æ·»åŠ ã€åˆ é™¤ã€æ¸…ç©ºç­‰åŸºæœ¬æ“ä½œï¼Œå®ƒä¸»è¦æœ‰ä¸‰ä¸ªå­æ¥å£ï¼š Listï¼šä¸€ä¸ªæœ‰åºçš„é›†åˆï¼Œå¯ä»¥åŒ…å«é‡å¤çš„å…ƒç´ ã€‚å®ç°ç±»åŒ…æ‹¬ ArrayListã€LinkedList ç­‰ã€‚ Setï¼šä¸€ä¸ªä¸åŒ…å«é‡å¤å…ƒç´ çš„é›†åˆã€‚å®ç°ç±»åŒ…æ‹¬ HashSetã€LinkedHashSetã€TreeSet ç­‰ã€‚ Queueï¼šä¸€ä¸ªç”¨äºä¿æŒå…ƒç´ é˜Ÿåˆ—çš„é›†åˆã€‚å®ç°ç±»åŒ…æ‹¬ PriorityQueueã€ArrayDeque ç­‰ã€‚ â‘¡ã€MapÂ æ¥å£ï¼šè¡¨ç¤ºé”®å€¼å¯¹çš„é›†åˆï¼Œä¸€ä¸ªé”®æ˜ å°„åˆ°ä¸€ä¸ªå€¼ã€‚é”®ä¸èƒ½é‡å¤ï¼Œæ¯ä¸ªé”®åªèƒ½å¯¹åº”ä¸€ä¸ªå€¼ã€‚Map æ¥å£çš„å®ç°ç±»åŒ…æ‹¬ HashMapã€LinkedHashMapã€TreeMap ç­‰ã€‚ é›†åˆæ¡†æ¶æœ‰å“ªå‡ ä¸ªå¸¸ç”¨å·¥å…·ç±»ï¼Ÿé›†åˆæ¡†æ¶ä½äº java.util åŒ…ä¸‹ï¼Œæä¾›äº†ä¸¤ä¸ªå¸¸ç”¨çš„å·¥å…·ç±»ï¼š Collectionsï¼šæä¾›äº†ä¸€äº›å¯¹é›†åˆè¿›è¡Œæ’åºã€äºŒåˆ†æŸ¥æ‰¾ã€åŒæ­¥çš„é™æ€æ–¹æ³•ã€‚ Arraysï¼šæä¾›äº†ä¸€äº›å¯¹æ•°ç»„è¿›è¡Œæ’åºã€æ‰“å°ã€å’Œ List è¿›è¡Œè½¬æ¢çš„é™æ€æ–¹æ³•ã€‚ ç®€å•ä»‹ç»ä¸€ä¸‹é˜Ÿåˆ—Java ä¸­çš„é˜Ÿåˆ—ä¸»è¦é€šè¿‡ Queue æ¥å£å’Œå¹¶å‘åŒ…ä¸‹çš„ BlockingQueue ä¸¤ä¸ªæ¥å£æ¥å®ç°ã€‚ ä¼˜å…ˆçº§é˜Ÿåˆ— PriorityQueue å®ç°äº† Queue æ¥å£ï¼Œæ˜¯ä¸€ä¸ªæ— ç•Œé˜Ÿåˆ—ï¼Œå®ƒçš„å…ƒç´ æŒ‰ç…§è‡ªç„¶é¡ºåºæ’åºæˆ–è€… Comparator æ¯”è¾ƒå™¨è¿›è¡Œæ’åºã€‚ åŒç«¯é˜Ÿåˆ— ArrayDeque ä¹Ÿå®ç°äº† Queue æ¥å£ï¼Œæ˜¯ä¸€ä¸ªåŸºäºæ•°ç»„çš„ï¼Œå¯ä»¥åœ¨ä¸¤ç«¯æ’å…¥å’Œåˆ é™¤å…ƒç´ çš„é˜Ÿåˆ—ã€‚ LinkedList å®ç°äº† Queue æ¥å£çš„å­ç±» Dequeï¼Œæ‰€ä»¥ä¹Ÿå¯ä»¥å½“åšåŒç«¯é˜Ÿåˆ—æ¥ä½¿ç”¨ã€‚ ç”¨è¿‡å“ªäº›é›†åˆç±»ï¼Œå®ƒä»¬çš„ä¼˜åŠ£ï¼Ÿæˆ‘å¸¸ç”¨çš„é›†åˆç±»æœ‰ ArrayListã€LinkedListã€HashMapã€LinkedHashMapã€‚ ArrayList å¯ä»¥çœ‹ä½œæ˜¯ä¸€ä¸ªåŠ¨æ€æ•°ç»„ï¼Œå¯ä»¥åœ¨éœ€è¦æ—¶åŠ¨æ€æ‰©å®¹æ•°ç»„çš„å®¹é‡ï¼Œåªä¸è¿‡éœ€è¦å¤åˆ¶å…ƒç´ åˆ°æ–°çš„æ•°ç»„ã€‚ä¼˜ç‚¹æ˜¯è®¿é—®é€Ÿåº¦å¿«ï¼Œå¯ä»¥é€šè¿‡ç´¢å¼•ç›´æ¥æŸ¥æ‰¾åˆ°å…ƒç´ ã€‚ç¼ºç‚¹æ˜¯æ’å…¥å’Œåˆ é™¤å…ƒç´ å¯èƒ½éœ€è¦ç§»åŠ¨æˆ–è€…å¤åˆ¶å…ƒç´ ã€‚ LinkedList æ˜¯ä¸€ä¸ªåŒå‘é“¾è¡¨ï¼Œé€‚åˆé¢‘ç¹çš„æ’å…¥å’Œåˆ é™¤æ“ä½œã€‚ä¼˜ç‚¹æ˜¯æ’å…¥å’Œåˆ é™¤å…ƒç´ çš„æ—¶å€™åªéœ€è¦æ”¹å˜èŠ‚ç‚¹çš„å‰åæŒ‡é’ˆï¼Œç¼ºç‚¹æ˜¯è®¿é—®å…ƒç´ æ—¶éœ€è¦éå†é“¾è¡¨ã€‚ HashMap æ˜¯ä¸€ä¸ªåŸºäºå“ˆå¸Œè¡¨çš„é”®å€¼å¯¹é›†åˆã€‚ä¼˜ç‚¹æ˜¯å¯ä»¥æ ¹æ®é”®çš„å“ˆå¸Œå€¼å¿«é€ŸæŸ¥æ‰¾åˆ°å€¼ï¼Œä½†æœ‰å¯èƒ½ä¼šå‘ç”Ÿå“ˆå¸Œå†²çªï¼Œå¹¶ä¸”ä¸ä¿ç•™é”®å€¼å¯¹çš„æ’å…¥é¡ºåºã€‚ LinkedHashMap åœ¨ HashMap çš„åŸºç¡€ä¸Šå¢åŠ äº†ä¸€ä¸ªåŒå‘é“¾è¡¨æ¥ä¿æŒé”®å€¼å¯¹çš„æ’å…¥é¡ºåºã€‚ é˜Ÿåˆ—å’Œæ ˆçš„åŒºåˆ«äº†è§£å—ï¼Ÿé˜Ÿåˆ—æ˜¯ä¸€ç§å…ˆè¿›å…ˆå‡ºï¼ˆFIFO, First-In-First-Outï¼‰çš„æ•°æ®ç»“æ„ï¼Œç¬¬ä¸€ä¸ªåŠ å…¥é˜Ÿåˆ—çš„å…ƒç´ ä¼šæˆä¸ºç¬¬ä¸€ä¸ªè¢«ç§»é™¤çš„å…ƒç´ ã€‚ æ ˆæ˜¯ä¸€ç§åè¿›å…ˆå‡ºï¼ˆLIFO, Last-In-First-Outï¼‰çš„æ•°æ®ç»“æ„ï¼Œæœ€åä¸€ä¸ªåŠ å…¥æ ˆçš„å…ƒç´ ä¼šæˆä¸ºç¬¬ä¸€ä¸ªè¢«ç§»é™¤çš„å…ƒç´ ã€‚ å“ªäº›æ˜¯çº¿ç¨‹å®‰å…¨çš„å®¹å™¨ï¼Ÿåƒ Vectorã€Hashtableã€ConcurrentHashMapã€CopyOnWriteArrayListã€ConcurrentLinkedQueueã€ArrayBlockingQueueã€LinkedBlockingQueue éƒ½æ˜¯çº¿ç¨‹å®‰å…¨çš„ã€‚ Collection ç»§æ‰¿äº†å“ªäº›æ¥å£ï¼ŸCollection ç»§æ‰¿äº† Iterable æ¥å£ï¼Œè¿™æ„å‘³ç€æ‰€æœ‰å®ç° Collection æ¥å£çš„ç±»éƒ½å¿…é¡»å®ç°Â iterator()Â æ–¹æ³•ï¼Œä¹‹åå°±å¯ä»¥ä½¿ç”¨å¢å¼ºå‹ for å¾ªç¯éå†é›†åˆä¸­çš„å…ƒç´ äº†ã€‚ ListList æ¨èé˜…è¯»æ–‡ç«  2.ğŸŒŸArrayList å’Œ LinkedList æœ‰ä»€ä¹ˆåŒºåˆ«ï¼Ÿæ¨èé˜…è¯»ï¼šäºŒå“¥çš„ Java è¿›é˜¶ä¹‹è·¯ï¼šArrayList å’Œ LinkedList ArrayList æ˜¯åŸºäºæ•°ç»„å®ç°çš„ï¼ŒLinkedList æ˜¯åŸºäºé“¾è¡¨å®ç°çš„ã€‚ ArrayList å’Œ LinkedList çš„ç”¨é€”æœ‰ä»€ä¹ˆä¸åŒï¼Ÿå¤šæ•°æƒ…å†µä¸‹ï¼ŒArrayList æ›´åˆ©äºæŸ¥æ‰¾ï¼ŒLinkedList æ›´åˆ©äºå¢åˆ ã€‚ â‘ ã€ç”±äº ArrayList æ˜¯åŸºäºæ•°ç»„å®ç°çš„ï¼Œæ‰€ä»¥ get(int index) å¯ä»¥ç›´æ¥é€šè¿‡æ•°ç»„ä¸‹æ ‡è·å–ï¼Œæ—¶é—´å¤æ‚åº¦æ˜¯ O(1)ï¼›LinkedList æ˜¯åŸºäºé“¾è¡¨å®ç°çš„ï¼Œget(int index) éœ€è¦éå†é“¾è¡¨ï¼Œæ—¶é—´å¤æ‚åº¦æ˜¯ O(n)ã€‚ å½“ç„¶ï¼Œget(E element) è¿™ç§æŸ¥æ‰¾ï¼Œä¸¤ç§é›†åˆéƒ½éœ€è¦éå†é€šè¿‡ equals æ¯”è¾ƒè·å–å…ƒç´ ï¼Œæ‰€ä»¥æ—¶é—´å¤æ‚åº¦éƒ½æ˜¯ O(n)ã€‚ â‘¡ã€ArrayList å¦‚æœå¢åˆ çš„æ˜¯æ•°ç»„çš„å°¾éƒ¨ï¼Œæ—¶é—´å¤æ‚åº¦æ˜¯ O(1)ï¼›å¦‚æœ add çš„æ—¶å€™æ¶‰åŠåˆ°æ‰©å®¹ï¼Œæ—¶é—´å¤æ‚åº¦ä¼šä¸Šå‡åˆ° O(n)ã€‚ ä½†å¦‚æœæ’å…¥çš„æ˜¯ä¸­é—´çš„ä½ç½®ï¼Œå°±éœ€è¦æŠŠæ’å…¥ä½ç½®åçš„å…ƒç´ å‘å‰æˆ–è€…å‘åç§»åŠ¨ï¼Œç”šè‡³è¿˜æœ‰å¯èƒ½è§¦å‘æ‰©å®¹ï¼Œæ•ˆç‡å°±ä¼šä½å¾ˆå¤šï¼Œå˜æˆ O(n)ã€‚ LinkedList å› ä¸ºæ˜¯é“¾è¡¨ç»“æ„ï¼Œæ’å…¥å’Œåˆ é™¤åªéœ€è¦æ”¹å˜å‰ç½®èŠ‚ç‚¹ã€åç½®èŠ‚ç‚¹å’Œæ’å…¥èŠ‚ç‚¹çš„å¼•ç”¨ï¼Œå› æ­¤ä¸éœ€è¦ç§»åŠ¨å…ƒç´ ã€‚ å¦‚æœæ˜¯åœ¨é“¾è¡¨çš„å¤´éƒ¨æ’å…¥æˆ–è€…åˆ é™¤ï¼Œæ—¶é—´å¤æ‚åº¦æ˜¯ O(1)ï¼›å¦‚æœæ˜¯åœ¨é“¾è¡¨çš„ä¸­é—´æ’å…¥æˆ–è€…åˆ é™¤ï¼Œæ—¶é—´å¤æ‚åº¦æ˜¯ O(n)ï¼Œå› ä¸ºéœ€è¦éå†é“¾è¡¨æ‰¾åˆ°æ’å…¥ä½ç½®ï¼›å¦‚æœæ˜¯åœ¨é“¾è¡¨çš„å°¾éƒ¨æ’å…¥æˆ–è€…åˆ é™¤ï¼Œæ—¶é—´å¤æ‚åº¦æ˜¯ O(1)ã€‚ ArrayList å’Œ LinkedList æ˜¯å¦æ”¯æŒéšæœºè®¿é—®ï¼Ÿâ‘ ã€ArrayList æ˜¯åŸºäºæ•°ç»„çš„ï¼Œä¹Ÿå®ç°äº† RandomAccess æ¥å£ï¼Œæ‰€ä»¥å®ƒæ”¯æŒéšæœºè®¿é—®ï¼Œå¯ä»¥é€šè¿‡ä¸‹æ ‡ç›´æ¥è·å–å…ƒç´ ã€‚ â‘¡ã€LinkedList æ˜¯åŸºäºé“¾è¡¨çš„ï¼Œæ‰€ä»¥å®ƒæ²¡æ³•æ ¹æ®ä¸‹æ ‡ç›´æ¥è·å–å…ƒç´ ï¼Œä¸æ”¯æŒéšæœºè®¿é—®ã€‚ ArrayList å’Œ LinkedList å†…å­˜å ç”¨æœ‰ä½•ä¸åŒï¼ŸArrayList æ˜¯åŸºäºæ•°ç»„çš„ï¼Œæ˜¯ä¸€å—è¿ç»­çš„å†…å­˜ç©ºé—´ï¼Œæ‰€ä»¥å®ƒçš„å†…å­˜å ç”¨æ˜¯æ¯”è¾ƒç´§å‡‘çš„ï¼›ä½†å¦‚æœæ¶‰åŠåˆ°æ‰©å®¹ï¼Œå°±ä¼šé‡æ–°åˆ†é…å†…å­˜ï¼Œç©ºé—´æ˜¯åŸæ¥çš„ 1.5 å€ã€‚ LinkedList æ˜¯åŸºäºé“¾è¡¨çš„ï¼Œæ¯ä¸ªèŠ‚ç‚¹éƒ½æœ‰ä¸€ä¸ªæŒ‡å‘ä¸‹ä¸€ä¸ªèŠ‚ç‚¹å’Œä¸Šä¸€ä¸ªèŠ‚ç‚¹çš„å¼•ç”¨ï¼Œäºæ˜¯æ¯ä¸ªèŠ‚ç‚¹å ç”¨çš„å†…å­˜ç©ºé—´æ¯” ArrayList ç¨å¾®å¤§ä¸€ç‚¹ã€‚ ArrayList å’Œ LinkedList çš„ä½¿ç”¨åœºæ™¯æœ‰ä»€ä¹ˆä¸åŒï¼ŸArrayList é€‚ç”¨äºï¼š éšæœºè®¿é—®é¢‘ç¹ï¼šéœ€è¦é¢‘ç¹é€šè¿‡ç´¢å¼•è®¿é—®å…ƒç´ çš„åœºæ™¯ã€‚ è¯»å–æ“ä½œè¿œå¤šäºå†™å…¥æ“ä½œï¼šå¦‚å­˜å‚¨ä¸ç»å¸¸æ”¹å˜çš„åˆ—è¡¨ã€‚ æœ«å°¾æ·»åŠ å…ƒç´ ï¼šéœ€è¦é¢‘ç¹åœ¨åˆ—è¡¨æœ«å°¾æ·»åŠ å…ƒç´ çš„åœºæ™¯ã€‚ LinkedList é€‚ç”¨äºï¼š é¢‘ç¹æ’å…¥å’Œåˆ é™¤ï¼šåœ¨åˆ—è¡¨ä¸­é—´é¢‘ç¹æ’å…¥å’Œåˆ é™¤å…ƒç´ çš„åœºæ™¯ã€‚ ä¸éœ€è¦å¿«é€Ÿéšæœºè®¿é—®ï¼šé¡ºåºè®¿é—®å¤šäºéšæœºè®¿é—®çš„åœºæ™¯ã€‚ é˜Ÿåˆ—å’Œæ ˆï¼šç”±äºå…¶åŒå‘é“¾è¡¨çš„ç‰¹æ€§ï¼ŒLinkedList å¯ä»¥å®ç°é˜Ÿåˆ—ï¼ˆFIFOï¼‰å’Œæ ˆï¼ˆLIFOï¼‰ã€‚ é“¾è¡¨å’Œæ•°ç»„æœ‰ä»€ä¹ˆåŒºåˆ«ï¼Ÿ æ•°ç»„åœ¨å†…å­˜ä¸­å ç”¨çš„æ˜¯ä¸€å—è¿ç»­çš„å­˜å‚¨ç©ºé—´ï¼Œå› æ­¤æˆ‘ä»¬å¯ä»¥é€šè¿‡æ•°ç»„ä¸‹æ ‡å¿«é€Ÿè®¿é—®ä»»æ„å…ƒç´ ã€‚æ•°ç»„åœ¨åˆ›å»ºæ—¶å¿…é¡»æŒ‡å®šå¤§å°ï¼Œä¸€æ—¦åˆ†é…å†…å­˜ï¼Œæ•°ç»„çš„å¤§å°å°±å›ºå®šäº†ã€‚ é“¾è¡¨çš„å…ƒç´ å­˜å‚¨åœ¨äºå†…å­˜ä¸­çš„ä»»æ„ä½ç½®ï¼Œæ¯ä¸ªèŠ‚ç‚¹é€šè¿‡æŒ‡é’ˆæŒ‡å‘ä¸‹ä¸€ä¸ªèŠ‚ç‚¹ã€‚ 3.ArrayList çš„æ‰©å®¹æœºåˆ¶äº†è§£å—ï¼Ÿäº†è§£ã€‚å½“å¾€ ArrayList ä¸­æ·»åŠ å…ƒç´ æ—¶ï¼Œä¼šå…ˆæ£€æŸ¥æ˜¯å¦éœ€è¦æ‰©å®¹ï¼Œå¦‚æœå½“å‰å®¹é‡+1 è¶…è¿‡æ•°ç»„é•¿åº¦ï¼Œå°±ä¼šè¿›è¡Œæ‰©å®¹ã€‚ æ‰©å®¹åçš„æ–°æ•°ç»„é•¿åº¦æ˜¯åŸæ¥çš„ 1.5 å€ï¼Œç„¶åå†æŠŠåŸæ•°ç»„çš„å€¼æ‹·è´åˆ°æ–°æ•°ç»„ä¸­ã€‚ private void grow(int minCapacity) // overflow-conscious code int oldCapacity = elementData.length; int newCapacity = oldCapacity + (oldCapacity 1); if (newCapacity - minCapacity 0) newCapacity = minCapacity; if (newCapacity - MAX_ARRAY_SIZE 0) newCapacity = hugeCapacity(minCapacity); // minCapacity is usually close to size, so this is a win: elementData = Arrays.copyOf(elementData, newCapacity); 4.ArrayList æ€ä¹ˆåºåˆ—åŒ–çš„çŸ¥é“å—ï¼Ÿåœ¨ ArrayList ä¸­ï¼ŒwriteObject æ–¹æ³•è¢«é‡å†™äº†ï¼Œç”¨äºè‡ªå®šä¹‰åºåˆ—åŒ–é€»è¾‘ï¼šåªåºåˆ—åŒ–æœ‰æ•ˆæ•°æ®ï¼Œå› ä¸º elementData æ•°ç»„çš„å®¹é‡ä¸€èˆ¬å¤§äºå®é™…çš„å…ƒç´ æ•°é‡ï¼Œå£°æ˜çš„æ—¶å€™ä¹ŸåŠ äº† transient å…³é”®å­—ã€‚ ä¸ºä»€ä¹ˆ ArrayList ä¸ç›´æ¥åºåˆ—åŒ–å…ƒç´ æ•°ç»„å‘¢ï¼Ÿå‡ºäºæ•ˆç‡çš„è€ƒè™‘ï¼Œæ•°ç»„å¯èƒ½é•¿åº¦ 100ï¼Œä½†å®é™…åªç”¨äº† 50ï¼Œå‰©ä¸‹çš„ 50 æ²¡ç”¨åˆ°ï¼Œä¹Ÿå°±ä¸éœ€è¦åºåˆ—åŒ–ã€‚ private void writeObject(java.io.ObjectOutputStream s) throws java.io.IOException // å°†å½“å‰ ArrayList çš„ç»“æ„è¿›è¡Œåºåˆ—åŒ– int expectedModCount = modCount; s.defaultWriteObject(); // åºåˆ—åŒ–é transient å­—æ®µ // åºåˆ—åŒ–æ•°ç»„çš„å¤§å° s.writeInt(size); // åºåˆ—åŒ–æ¯ä¸ªå…ƒç´  for (int i = 0; i size; i++) s.writeObject(elementData[i]); // æ£€æŸ¥æ˜¯å¦åœ¨åºåˆ—åŒ–æœŸé—´å‘ç”Ÿäº†å¹¶å‘ä¿®æ”¹ if (modCount != expectedModCount) throw new ConcurrentModificationException(); 5.å¿«é€Ÿå¤±è´¥fail-fastäº†è§£å—ï¼Ÿfailâ€”fast æ˜¯ Java é›†åˆçš„ä¸€ç§é”™è¯¯æ£€æµ‹æœºåˆ¶ã€‚ åœ¨ç”¨è¿­ä»£å™¨éå†é›†åˆå¯¹è±¡æ—¶ï¼Œå¦‚æœçº¿ç¨‹ A éå†è¿‡ç¨‹ä¸­ï¼Œçº¿ç¨‹ B å¯¹é›†åˆå¯¹è±¡çš„å†…å®¹è¿›è¡Œäº†ä¿®æ”¹ï¼Œå°±ä¼šæŠ›å‡º Concurrent Modification Exceptionã€‚ è¿­ä»£å™¨åœ¨éå†æ—¶ç›´æ¥è®¿é—®é›†åˆä¸­çš„å†…å®¹ï¼Œå¹¶ä¸”åœ¨éå†è¿‡ç¨‹ä¸­ä½¿ç”¨ä¸€ä¸ªÂ modCountÂ å˜é‡ã€‚é›†åˆåœ¨è¢«éå†æœŸé—´å¦‚æœå†…å®¹å‘ç”Ÿå˜åŒ–ï¼Œå°±ä¼šæ”¹å˜modCountçš„å€¼ã€‚æ¯å½“è¿­ä»£å™¨ä½¿ç”¨Â hashNext()/next()éå†ä¸‹ä¸€ä¸ªå…ƒç´ ä¹‹å‰ï¼Œéƒ½ä¼šæ£€æµ‹ modCount å˜é‡æ˜¯å¦ä¸º expectedmodCount å€¼ï¼Œæ˜¯çš„è¯å°±è¿”å›éå†ï¼›å¦åˆ™æŠ›å‡ºå¼‚å¸¸ï¼Œç»ˆæ­¢éå†ã€‚ å¼‚å¸¸çš„æŠ›å‡ºæ¡ä»¶æ˜¯æ£€æµ‹åˆ°Â modCountï¼=expectedmodCountÂ è¿™ä¸ªæ¡ä»¶ã€‚å¦‚æœé›†åˆå‘ç”Ÿå˜åŒ–æ—¶ä¿®æ”¹ modCount å€¼åˆšå¥½åˆè®¾ç½®ä¸ºäº† expectedmodCount å€¼ï¼Œåˆ™å¼‚å¸¸ä¸ä¼šæŠ›å‡ºã€‚å› æ­¤ï¼Œä¸èƒ½ä¾èµ–äºè¿™ä¸ªå¼‚å¸¸æ˜¯å¦æŠ›å‡ºè€Œè¿›è¡Œå¹¶å‘æ“ä½œçš„ç¼–ç¨‹ï¼Œè¿™ä¸ªå¼‚å¸¸åªå»ºè®®ç”¨äºæ£€æµ‹å¹¶å‘ä¿®æ”¹çš„ bugã€‚ java.util åŒ…ä¸‹çš„é›†åˆç±»éƒ½æ˜¯å¿«é€Ÿå¤±è´¥çš„ï¼Œä¸èƒ½åœ¨å¤šçº¿ç¨‹ä¸‹å‘ç”Ÿå¹¶å‘ä¿®æ”¹ï¼ˆè¿­ä»£è¿‡ç¨‹ä¸­è¢«ä¿®æ”¹ï¼‰ï¼Œæ¯”å¦‚ ArrayList ç±»ã€‚ ä»€ä¹ˆæ˜¯å®‰å…¨å¤±è´¥ï¼ˆfailâ€”safeï¼‰å‘¢ï¼Ÿé‡‡ç”¨å®‰å…¨å¤±è´¥æœºåˆ¶çš„é›†åˆå®¹å™¨ï¼Œåœ¨éå†æ—¶ä¸æ˜¯ç›´æ¥åœ¨é›†åˆå†…å®¹ä¸Šè®¿é—®çš„ï¼Œè€Œæ˜¯å…ˆå¤åˆ¶åŸæœ‰é›†åˆå†…å®¹ï¼Œåœ¨æ‹·è´çš„é›†åˆä¸Šè¿›è¡Œéå†ã€‚ åŸç†ï¼šç”±äºè¿­ä»£æ—¶æ˜¯å¯¹åŸé›†åˆçš„æ‹·è´è¿›è¡Œéå†ï¼Œæ‰€ä»¥åœ¨éå†è¿‡ç¨‹ä¸­å¯¹åŸé›†åˆæ‰€ä½œçš„ä¿®æ”¹å¹¶ä¸èƒ½è¢«è¿­ä»£å™¨æ£€æµ‹åˆ°ï¼Œæ‰€ä»¥ä¸ä¼šè§¦å‘ Concurrent Modification Exceptionã€‚ ç¼ºç‚¹ï¼šåŸºäºæ‹·è´å†…å®¹çš„ä¼˜ç‚¹æ˜¯é¿å…äº† Concurrent Modification Exceptionï¼Œä½†åŒæ ·åœ°ï¼Œè¿­ä»£å™¨å¹¶ä¸èƒ½è®¿é—®åˆ°ä¿®æ”¹åçš„å†…å®¹ï¼Œå³ï¼šè¿­ä»£å™¨éå†çš„æ˜¯å¼€å§‹éå†é‚£ä¸€åˆ»æ‹¿åˆ°çš„é›†åˆæ‹·è´ï¼Œåœ¨éå†æœŸé—´åŸé›†åˆå‘ç”Ÿçš„ä¿®æ”¹è¿­ä»£å™¨æ˜¯ä¸çŸ¥é“çš„ã€‚ åœºæ™¯ï¼šjava.util.concurrent åŒ…ä¸‹çš„å®¹å™¨éƒ½æ˜¯å®‰å…¨å¤±è´¥ï¼Œå¯ä»¥åœ¨å¤šçº¿ç¨‹ä¸‹å¹¶å‘ä½¿ç”¨ï¼Œå¹¶å‘ä¿®æ”¹ï¼Œæ¯”å¦‚ CopyOnWriteArrayList ç±»ã€‚ 6.æœ‰å“ªå‡ ç§å®ç° ArrayList çº¿ç¨‹å®‰å…¨çš„æ–¹æ³•ï¼Ÿå¸¸ç”¨çš„æœ‰ä¸¤ç§ã€‚ å¯ä»¥ä½¿ç”¨Â Collections.synchronizedList()Â æ–¹æ³•ï¼Œå®ƒå¯ä»¥è¿”å›ä¸€ä¸ªçº¿ç¨‹å®‰å…¨çš„ Listã€‚ SynchronizedList list = Collections.synchronizedList(new ArrayList()); å†…éƒ¨æ˜¯é€šè¿‡Â synchronized å…³é”®å­—åŠ é”æ¥å®ç°çš„ã€‚ ä¹Ÿå¯ä»¥ç›´æ¥ä½¿ç”¨Â CopyOnWriteArrayListï¼Œå®ƒæ˜¯çº¿ç¨‹å®‰å…¨çš„ ArrayListï¼Œéµå¾ªå†™æ—¶å¤åˆ¶çš„åŸåˆ™ï¼Œæ¯å½“å¯¹åˆ—è¡¨è¿›è¡Œä¿®æ”¹æ—¶ï¼Œéƒ½ä¼šåˆ›å»ºä¸€ä¸ªæ–°å‰¯æœ¬ï¼Œè¿™ä¸ªæ–°å‰¯æœ¬ä¼šæ›¿æ¢æ—§çš„åˆ—è¡¨ï¼Œè€Œå¯¹æ—§åˆ—è¡¨çš„æ‰€æœ‰è¯»å–æ“ä½œä»ç„¶åœ¨åŸæœ‰çš„åˆ—è¡¨ä¸Šè¿›è¡Œã€‚ CopyOnWriteArrayList list = new CopyOnWriteArrayList(); é€šä¿—çš„è®²ï¼ŒCopyOnWrite å°±æ˜¯å½“æˆ‘ä»¬å¾€ä¸€ä¸ªå®¹å™¨æ·»åŠ å…ƒç´ çš„æ—¶å€™ï¼Œä¸ç›´æ¥å¾€å®¹å™¨ä¸­æ·»åŠ ï¼Œè€Œæ˜¯å…ˆå¤åˆ¶å‡ºä¸€ä¸ªæ–°çš„å®¹å™¨ï¼Œç„¶ååœ¨æ–°çš„å®¹å™¨é‡Œæ·»åŠ å…ƒç´ ï¼Œæ·»åŠ å®Œä¹‹åï¼Œå†å°†åŸå®¹å™¨çš„å¼•ç”¨æŒ‡å‘æ–°çš„å®¹å™¨ã€‚å¤šä¸ªçº¿ç¨‹åœ¨è¯»çš„æ—¶å€™ï¼Œä¸éœ€è¦åŠ é”ï¼Œå› ä¸ºå½“å‰å®¹å™¨ä¸ä¼šæ·»åŠ ä»»ä½•å…ƒç´ ã€‚è¿™æ ·å°±å®ç°äº†çº¿ç¨‹å®‰å…¨ã€‚ ArrayList å’Œ Vector çš„åŒºåˆ«ï¼ŸVector å±äº JDK 1.0 æ—¶æœŸçš„é—ç•™ç±»ï¼Œä¸æ¨èä½¿ç”¨ï¼Œä»ç„¶ä¿ç•™ç€æ˜¯å› ä¸º Java å¸Œæœ›å‘åå…¼å®¹ã€‚ ArrayList æ˜¯åœ¨ JDK 1.2 æ—¶å¼•å…¥çš„ï¼Œç”¨äºæ›¿ä»£ Vector ä½œä¸ºä¸»è¦çš„éåŒæ­¥åŠ¨æ€æ•°ç»„å®ç°ã€‚å› ä¸º Vector æ‰€æœ‰çš„æ–¹æ³•éƒ½ä½¿ç”¨äº† synchronized å…³é”®å­—è¿›è¡ŒåŒæ­¥ï¼Œæ‰€ä»¥å•çº¿ç¨‹ç¯å¢ƒä¸‹æ•ˆç‡è¾ƒä½ã€‚ 7.CopyOnWriteArrayList äº†è§£å¤šå°‘ï¼ŸCopyOnWriteArrayList å°±æ˜¯çº¿ç¨‹å®‰å…¨ç‰ˆæœ¬çš„ ArrayListã€‚ CopyOnWriteâ€”â€”å†™æ—¶å¤åˆ¶ï¼Œå·²ç»æ˜ç¤ºäº†å®ƒçš„åŸç†ã€‚ CopyOnWriteArrayList é‡‡ç”¨äº†ä¸€ç§è¯»å†™åˆ†ç¦»çš„å¹¶å‘ç­–ç•¥ã€‚CopyOnWriteArrayList å®¹å™¨å…è®¸å¹¶å‘è¯»ï¼Œè¯»æ“ä½œæ˜¯æ— é”çš„ã€‚è‡³äºå†™æ“ä½œï¼Œæ¯”å¦‚è¯´å‘å®¹å™¨ä¸­æ·»åŠ ä¸€ä¸ªå…ƒç´ ï¼Œé¦–å…ˆå°†å½“å‰å®¹å™¨å¤åˆ¶ä¸€ä»½ï¼Œç„¶ååœ¨æ–°å‰¯æœ¬ä¸Šæ‰§è¡Œå†™æ“ä½œï¼Œç»“æŸä¹‹åå†å°†åŸå®¹å™¨çš„å¼•ç”¨æŒ‡å‘æ–°å®¹å™¨ã€‚ MapMap ä¸­æœ€é‡è¦çš„å°±æ˜¯ HashMap äº†ï¼Œé¢è¯•åŸºæœ¬è¢«é—®å‡ºåŒ…æµ†äº†ï¼Œä¸€å®šè¦å¥½å¥½å‡†å¤‡ã€‚ 8.ğŸŒŸèƒ½è¯´ä¸€ä¸‹ HashMap çš„åº•å±‚æ•°æ®ç»“æ„å—ï¼Ÿæ¨èé˜…è¯»ï¼šäºŒå“¥çš„ Java è¿›é˜¶ä¹‹è·¯ï¼šè¯¦è§£ HashMap JDK 8 ä¸­ HashMap çš„æ•°æ®ç»“æ„æ˜¯æ•°ç»„+é“¾è¡¨+çº¢é»‘æ ‘ã€‚ æ•°ç»„ç”¨æ¥å­˜å‚¨é”®å€¼å¯¹ï¼Œæ¯ä¸ªé”®å€¼å¯¹å¯ä»¥é€šè¿‡ç´¢å¼•ç›´æ¥æ‹¿åˆ°ï¼Œç´¢å¼•æ˜¯é€šè¿‡å¯¹é”®çš„å“ˆå¸Œå€¼è¿›è¡Œè¿›ä¸€æ­¥çš„ hash() å¤„ç†å¾—åˆ°çš„ã€‚ å½“å¤šä¸ªé”®ç»è¿‡å“ˆå¸Œå¤„ç†åå¾—åˆ°ç›¸åŒçš„ç´¢å¼•æ—¶ï¼Œéœ€è¦é€šè¿‡é“¾è¡¨æ¥è§£å†³å“ˆå¸Œå†²çªâ€”â€”å°†å…·æœ‰ç›¸åŒç´¢å¼•çš„é”®å€¼å¯¹é€šè¿‡é“¾è¡¨å­˜å‚¨èµ·æ¥ã€‚ ä¸è¿‡ï¼Œé“¾è¡¨è¿‡é•¿æ—¶ï¼ŒæŸ¥è¯¢æ•ˆç‡ä¼šæ¯”è¾ƒä½ï¼Œäºæ˜¯å½“é“¾è¡¨çš„é•¿åº¦è¶…è¿‡ 8 æ—¶ï¼ˆä¸”æ•°ç»„çš„é•¿åº¦å¤§äº 64ï¼‰ï¼Œé“¾è¡¨å°±ä¼šè½¬æ¢ä¸ºçº¢é»‘æ ‘ã€‚çº¢é»‘æ ‘çš„æŸ¥è¯¢æ•ˆç‡æ˜¯ O(logn)ï¼Œæ¯”é“¾è¡¨çš„ O(n) è¦å¿«ã€‚ hash() æ–¹æ³•çš„ç›®æ ‡æ˜¯å°½é‡å‡å°‘å“ˆå¸Œå†²çªï¼Œä¿è¯å…ƒç´ èƒ½å¤Ÿå‡åŒ€åœ°åˆ†å¸ƒåœ¨æ•°ç»„çš„æ¯ä¸ªä½ç½®ä¸Šã€‚ static final int hash(Object key) int h; return (key == null) ? 0 : (h = key.hashCode()) ^ (h 16); å¦‚æœé”®çš„å“ˆå¸Œå€¼å·²ç»åœ¨æ•°ç»„ä¸­å­˜åœ¨ï¼Œå…¶å¯¹åº”çš„å€¼å°†è¢«æ–°å€¼è¦†ç›–ã€‚ HashMap çš„åˆå§‹å®¹é‡æ˜¯ 16ï¼Œéšç€å…ƒç´ çš„ä¸æ–­æ·»åŠ ï¼ŒHashMap å°±éœ€è¦è¿›è¡Œæ‰©å®¹ï¼Œé˜ˆå€¼æ˜¯capacity * loadFactorï¼Œcapacity ä¸ºå®¹é‡ï¼ŒloadFactor ä¸ºè´Ÿè½½å› å­ï¼Œé»˜è®¤ä¸º 0.75ã€‚ æ‰©å®¹åçš„æ•°ç»„å¤§å°æ˜¯åŸæ¥çš„ 2 å€ï¼Œç„¶åæŠŠåŸæ¥çš„å…ƒç´ é‡æ–°è®¡ç®—å“ˆå¸Œå€¼ï¼Œæ”¾åˆ°æ–°çš„æ•°ç»„ä¸­ã€‚ 9.ä½ å¯¹çº¢é»‘æ ‘äº†è§£å¤šå°‘ï¼Ÿçº¢é»‘æ ‘æ˜¯ä¸€ç§è‡ªå¹³è¡¡çš„äºŒå‰æŸ¥æ‰¾æ ‘ï¼š æ¯ä¸ªèŠ‚ç‚¹è¦ä¹ˆæ˜¯çº¢è‰²ï¼Œè¦ä¹ˆæ˜¯é»‘è‰²ï¼› æ ¹èŠ‚ç‚¹æ°¸è¿œæ˜¯é»‘è‰²ï¼› æ‰€æœ‰çš„å¶å­èŠ‚ç‚¹éƒ½æ˜¯æ˜¯é»‘è‰²çš„ï¼ˆä¸‹å›¾ä¸­çš„ NULL èŠ‚ç‚¹ï¼‰ï¼› çº¢è‰²èŠ‚ç‚¹çš„å­èŠ‚ç‚¹ä¸€å®šæ˜¯é»‘è‰²çš„ï¼› ä»ä»»ä¸€èŠ‚ç‚¹åˆ°å…¶æ¯ä¸ªå¶å­çš„æ‰€æœ‰ç®€å•è·¯å¾„éƒ½åŒ…å«ç›¸åŒæ•°ç›®çš„é»‘è‰²èŠ‚ç‚¹ã€‚ çº¢é»‘æ ‘å£è¯€:å·¦æ ¹å³ , æ ¹å¶é»‘ .ä¸çº¢çº¢ , é»‘è·¯åŒ. ä¸ºä»€ä¹ˆä¸ç”¨äºŒå‰æ ‘ï¼ŸäºŒå‰æ ‘æ˜¯æœ€åŸºæœ¬çš„æ ‘ç»“æ„ï¼Œæ¯ä¸ªèŠ‚ç‚¹æœ€å¤šæœ‰ä¸¤ä¸ªå­èŠ‚ç‚¹ï¼Œä½†æ˜¯äºŒå‰æ ‘å®¹æ˜“å‡ºç°æç«¯æƒ…å†µï¼Œæ¯”å¦‚æ’å…¥çš„æ•°æ®æ˜¯æœ‰åºçš„ï¼Œé‚£ä¹ˆäºŒå‰æ ‘å°±ä¼šé€€åŒ–æˆé“¾è¡¨ï¼ŒæŸ¥è¯¢æ•ˆç‡å°±ä¼šå˜æˆ O(n)ã€‚ ä¸ºä»€ä¹ˆä¸ç”¨å¹³è¡¡äºŒå‰æ ‘ï¼Ÿå¹³è¡¡äºŒå‰æ ‘æ¯”çº¢é»‘æ ‘çš„è¦æ±‚æ›´é«˜ï¼Œæ¯ä¸ªèŠ‚ç‚¹çš„å·¦å³å­æ ‘çš„é«˜åº¦æœ€å¤šç›¸å·® 1ï¼Œè¿™ç§é«˜åº¦çš„å¹³è¡¡ä¿è¯äº†æä½³çš„æŸ¥æ‰¾æ•ˆç‡ï¼Œä½†åœ¨è¿›è¡Œæ’å…¥å’Œåˆ é™¤æ“ä½œæ—¶ï¼Œå¯èƒ½éœ€è¦é¢‘ç¹åœ°è¿›è¡Œæ—‹è½¬æ¥ç»´æŒæ ‘çš„å¹³è¡¡ï¼Œç»´æŠ¤æˆæœ¬æ›´é«˜ã€‚ ä¸ºä»€ä¹ˆç”¨çº¢é»‘æ ‘ï¼Ÿé“¾è¡¨çš„æŸ¥æ‰¾æ—¶é—´å¤æ‚åº¦æ˜¯Â O(n)ï¼Œå½“é“¾è¡¨é•¿åº¦è¾ƒé•¿æ—¶ï¼ŒæŸ¥æ‰¾æ€§èƒ½ä¼šä¸‹é™ã€‚çº¢é»‘æ ‘æ˜¯ä¸€ç§æŠ˜ä¸­çš„æ–¹æ¡ˆï¼ŒæŸ¥æ‰¾ã€æ’å…¥ã€åˆ é™¤çš„æ—¶é—´å¤æ‚åº¦éƒ½æ˜¯Â O(log n)ã€‚ 10.çº¢é»‘æ ‘æ€ä¹ˆä¿æŒå¹³è¡¡çš„ï¼Ÿæ—‹è½¬å’ŒæŸ“è‰²ã€‚ â‘ ã€é€šè¿‡å·¦æ—‹å’Œå³æ—‹æ¥è°ƒæ•´æ ‘çš„ç»“æ„ï¼Œé¿å…æŸä¸€ä¾§è¿‡æ·±ã€‚ â‘¡ã€æŸ“â¾Šï¼Œä¿®å¤çº¢é»‘è§„åˆ™ï¼Œä»è€Œä¿è¯æ ‘çš„é«˜åº¦ä¸ä¼šå¤±è¡¡ã€‚ 11.ğŸŒŸHashMap çš„ put æµç¨‹çŸ¥é“å—ï¼Ÿå“ˆå¸Œå¯»å€ â†’ å¤„ç†å“ˆå¸Œå†²çªï¼ˆé“¾è¡¨è¿˜æ˜¯çº¢é»‘æ ‘ï¼‰â†’ åˆ¤æ–­æ˜¯å¦éœ€è¦æ‰©å®¹ â†’ æ’å…¥è¦†ç›–èŠ‚ç‚¹ã€‚ è¯¦ç»†ç‰ˆï¼š ç¬¬ä¸€æ­¥ï¼Œé€šè¿‡ hash æ–¹æ³•è¿›ä¸€æ­¥æ‰°åŠ¨å“ˆå¸Œå€¼ï¼Œä»¥å‡å°‘å“ˆå¸Œå†²çªã€‚ static final int hash(Object key) int h; return (key == null) ? 0 : (h = key.hashCode()) ^ (h 16); ç¬¬äºŒæ­¥ï¼Œè¿›è¡Œç¬¬ä¸€æ¬¡çš„æ•°ç»„æ‰©å®¹ï¼›å¹¶ä½¿ç”¨å“ˆå¸Œå€¼å’Œæ•°ç»„é•¿åº¦è¿›è¡Œå–æ¨¡è¿ç®—ï¼Œç¡®å®šç´¢å¼•ä½ç½®ã€‚ if ((tab = table) == null || (n = tab.length) == 0) n = (tab = resize()).length;if ((p = tab[i = (n - 1) hash]) == null) tab[i] = newNode(hash, key, value, null); å¦‚æœå½“å‰ä½ç½®ä¸ºç©ºï¼Œç›´æ¥å°†é”®å€¼å¯¹æ’å…¥è¯¥ä½ç½®ï¼›å¦åˆ™åˆ¤æ–­å½“å‰ä½ç½®çš„ç¬¬ä¸€ä¸ªèŠ‚ç‚¹æ˜¯å¦ä¸æ–°èŠ‚ç‚¹çš„ key ç›¸åŒï¼Œå¦‚æœç›¸åŒç›´æ¥è¦†ç›– valueï¼Œå¦‚æœä¸åŒï¼Œè¯´æ˜å‘ç”Ÿå“ˆå¸Œå†²çªã€‚ å¦‚æœæ˜¯é“¾è¡¨ï¼Œå°†æ–°èŠ‚ç‚¹æ·»åŠ åˆ°é“¾è¡¨çš„å°¾éƒ¨ï¼›å¦‚æœé“¾è¡¨é•¿åº¦å¤§äºç­‰äº 8ï¼Œåˆ™å°†é“¾è¡¨è½¬æ¢ä¸ºçº¢é»‘æ ‘ã€‚ public V put(K key, V value) return putVal(hash(key), key, value, false, true);final V putVal(int hash, K key, V value, boolean onlyIfAbsent, boolean evict) NodeK,V[] tab; NodeK,V p; int n, i; // å¦‚æœ table ä¸ºç©ºï¼Œå…ˆè¿›è¡Œåˆå§‹åŒ– if ((tab = table) == null || (n = tab.length) == 0) n = (tab = resize()).length; // è®¡ç®—ç´¢å¼•ä½ç½®ï¼Œå¹¶æ‰¾åˆ°å¯¹åº”çš„æ¡¶ if ((p = tab[i = (n - 1) hash]) == null) tab[i] = newNode(hash, key, value, null); // å¦‚æœæ¡¶ä¸ºç©ºï¼Œç›´æ¥æ’å…¥ else NodeK,V e; K k; // æ£€æŸ¥ç¬¬ä¸€ä¸ªèŠ‚ç‚¹æ˜¯å¦åŒ¹é… if (p.hash == hash ((k = p.key) == key || (key != null key.equals(k)))) e = p; // è¦†ç›– // å¦‚æœæ˜¯æ ‘èŠ‚ç‚¹ï¼Œæ”¾å…¥æ ‘ä¸­ else if (p instanceof TreeNode) e = ((TreeNodeK,V)p).putTreeVal(this, tab, hash, key, value); // å¦‚æœæ˜¯é“¾è¡¨ï¼Œéå†æ’å…¥åˆ°å°¾éƒ¨ else for (int binCount = 0; ; ++binCount) if ((e = p.next) == null) p.next = newNode(hash, key, value, null); // å¦‚æœé“¾è¡¨é•¿åº¦è¾¾åˆ°é˜ˆå€¼ï¼Œè½¬æ¢ä¸ºçº¢é»‘æ ‘ if (binCount = TREEIFY_THRESHOLD - 1) treeifyBin(tab, hash); break; if (e.hash == hash ((k = e.key) == key || (key != null key.equals(k)))) break; // è¦†ç›– p = e; if (e != null) // å¦‚æœæ‰¾åˆ°åŒ¹é…çš„ keyï¼Œåˆ™è¦†ç›–æ—§å€¼ V oldValue = e.value; if (!onlyIfAbsent || oldValue == null) e.value = value; afterNodeAccess(e); return oldValue; ++modCount; // ä¿®æ”¹è®¡æ•°å™¨ if (++size threshold) resize(); // æ£€æŸ¥æ˜¯å¦éœ€è¦æ‰©å®¹ afterNodeInsertion(evict); return null; æ¯æ¬¡æ’å…¥æ–°å…ƒç´ åï¼Œæ£€æŸ¥æ˜¯å¦éœ€è¦æ‰©å®¹ï¼Œå¦‚æœå½“å‰å…ƒç´ ä¸ªæ•°å¤§äºé˜ˆå€¼ï¼ˆcapacity * loadFactorï¼‰ï¼Œåˆ™è¿›è¡Œæ‰©å®¹ï¼Œæ‰©å®¹åçš„æ•°ç»„å¤§å°æ˜¯åŸæ¥çš„ 2 å€ï¼›å¹¶ä¸”é‡æ–°è®¡ç®—æ¯ä¸ªèŠ‚ç‚¹çš„ç´¢å¼•ï¼Œè¿›è¡Œæ•°æ®é‡æ–°åˆ†å¸ƒã€‚ åªé‡å†™å…ƒç´ çš„ equals æ–¹æ³•æ²¡é‡å†™ hashCodeï¼Œput çš„æ—¶å€™ä¼šå‘ç”Ÿä»€ä¹ˆ?å¦‚æœåªé‡å†™ equals æ–¹æ³•ï¼Œæ²¡æœ‰é‡å†™ hashCode æ–¹æ³•ï¼Œé‚£ä¹ˆä¼šå¯¼è‡´ equals ç›¸ç­‰çš„ä¸¤ä¸ªå¯¹è±¡ï¼ŒhashCode ä¸ç›¸ç­‰ï¼Œè¿™æ ·çš„è¯ï¼Œä¸¤ä¸ªå¯¹è±¡ä¼šè¢« put åˆ°æ•°ç»„ä¸­ä¸åŒçš„ä½ç½®ï¼Œå¯¼è‡´ get çš„æ—¶å€™ï¼Œæ— æ³•è·å–åˆ°æ­£ç¡®çš„å€¼ã€‚ 12.HashMap æ€ä¹ˆæŸ¥æ‰¾å…ƒç´ çš„å‘¢ï¼Ÿé€šè¿‡å“ˆå¸Œå€¼å®šä½ç´¢å¼• â†’ å®šä½æ¡¶ â†’ æ£€æŸ¥ç¬¬ä¸€ä¸ªèŠ‚ç‚¹ â†’ éå†é“¾è¡¨æˆ–çº¢é»‘æ ‘æŸ¥æ‰¾ â†’ è¿”å›ç»“æœã€‚ 13.HashMap çš„ hash å‡½æ•°æ˜¯æ€ä¹ˆè®¾è®¡çš„?å…ˆæ‹¿åˆ° key çš„å“ˆå¸Œå€¼ï¼Œæ˜¯ä¸€ä¸ª 32 ä½çš„ int ç±»å‹æ•°å€¼ï¼Œç„¶åå†è®©å“ˆå¸Œå€¼çš„é«˜ 16 ä½å’Œä½ 16 ä½è¿›è¡Œå¼‚æˆ–æ“ä½œï¼Œè¿™æ ·èƒ½ä¿è¯å“ˆå¸Œåˆ†å¸ƒå‡åŒ€ã€‚ static final int hash(Object key) int h; // å¦‚æœ key ä¸º nullï¼Œè¿”å› 0ï¼›å¦åˆ™ï¼Œä½¿ç”¨ hashCode å¹¶è¿›è¡Œæ‰°åŠ¨ return (key == null) ? 0 : (h = key.hashCode()) ^ (h 16); 14.ä¸ºä»€ä¹ˆ hash å‡½æ•°èƒ½å‡å°‘å“ˆå¸Œå†²çªï¼Ÿå¿«é€Ÿå›ç­”ï¼šå“ˆå¸Œè¡¨çš„ç´¢å¼•æ˜¯é€šè¿‡ h (n-1) è®¡ç®—çš„ï¼Œn æ˜¯åº•å±‚æ•°ç»„çš„å®¹é‡ï¼›n-1 å’ŒæŸä¸ªå“ˆå¸Œå€¼åš è¿ç®—ï¼Œç›¸å½“äºæˆªå–äº†æœ€ä½çš„å››ä½ã€‚å¦‚æœæ•°ç»„çš„å®¹é‡å¾ˆå°ï¼Œåªå– h çš„ä½ä½å¾ˆå®¹æ˜“å¯¼è‡´å“ˆå¸Œå†²çªã€‚ é€šè¿‡å¼‚æˆ–æ“ä½œå°† h çš„é«˜ä½å¼•å…¥ä½ä½ï¼Œå¯ä»¥å¢åŠ å“ˆå¸Œå€¼çš„éšæœºæ€§ï¼Œä»è€Œå‡å°‘å“ˆå¸Œå†²çªã€‚ è§£é‡Šä¸€ä¸‹ã€‚ ä»¥åˆå§‹é•¿åº¦ 16 ä¸ºä¾‹ï¼Œ16-115ã€‚2 è¿›åˆ¶è¡¨ç¤ºæ˜¯0000 0000 0000 0000 0000 0000 0000 1111ã€‚åªå–æœ€å 4 ä½ç›¸ç­‰äºå“ˆå¸Œå€¼çš„é«˜ä½éƒ½ä¸¢å¼ƒäº†ã€‚ æ¯”å¦‚è¯´ 1111 1111 1111 1111 1111 1111 1111 1111ï¼Œå–æœ€å 4 ä½ï¼Œä¹Ÿå°±æ˜¯ 1111ã€‚ 1110 1111 1111 1111 1111 1111 1111 1111ï¼Œå–æœ€å 4 ä½ï¼Œä¹Ÿæ˜¯ 1111ã€‚ ä¸å°±å‘ç”Ÿå“ˆå¸Œå†²çªäº†å—ï¼Ÿ è¿™æ—¶å€™ hash å‡½æ•° (h = key.hashCode()) ^ (h 16) å°±æ´¾ä¸Šç”¨åœºäº†ã€‚ å°†å“ˆå¸Œå€¼æ— ç¬¦å·å³ç§» 16 ä½ï¼Œæ„å‘³ç€åŸå“ˆå¸Œå€¼çš„é«˜ 16 ä½è¢«ç§»åˆ°äº†ä½ 16 ä½çš„ä½ç½®ã€‚è¿™æ ·ï¼ŒåŸå§‹å“ˆå¸Œå€¼çš„é«˜ 16 ä½å’Œä½ 16 ä½å°±å¯ä»¥å‚ä¸åˆ°æœ€ç»ˆç”¨äºç´¢å¼•è®¡ç®—çš„ä½ä½ä¸­ã€‚ é€‰æ‹© 16 ä½æ˜¯å› ä¸ºå®ƒæ˜¯ 32 ä½æ•´æ•°çš„ä¸€åŠï¼Œè¿™æ ·å¤„ç†æ—¢è€ƒè™‘äº†é«˜ä½çš„ä¿¡æ¯ï¼Œåˆæ²¡æœ‰å®Œå…¨å¿½è§†ä½ä½åŸæœ¬çš„ä¿¡æ¯ï¼Œä»è€Œè¾¾åˆ°äº†ä¸€ç§å¾®å¦™çš„å¹³è¡¡çŠ¶æ€ã€‚ ä¸¾ä¸ªä¾‹å­ï¼ˆæ•°ç»„é•¿åº¦ä¸º 16ï¼‰ã€‚ ç¬¬ä¸€ä¸ªé”®å€¼å¯¹çš„é”®ï¼šh1 0001 0010 0011 0100 0101 0110 0111 1000 ç¬¬äºŒä¸ªé”®å€¼å¯¹çš„é”®ï¼šh2 0001 0010 0011 0101 0101 0110 0111 1000 å¦‚æœæ²¡æœ‰ hash å‡½æ•°ï¼Œç›´æ¥å–ä½ 4 ä½ï¼Œé‚£ä¹ˆ h1 å’Œ h2 çš„ä½ 4 ä½éƒ½æ˜¯ 1000ï¼Œä¹Ÿå°±æ˜¯è¯´ä¸¤ä¸ªé”®å€¼å¯¹éƒ½ä¼šæ”¾åœ¨æ•°ç»„çš„ç¬¬ 8 ä¸ªä½ç½®ã€‚ æ¥çœ‹ä¸€ä¸‹ hash å‡½æ•°çš„å¤„ç†è¿‡ç¨‹ã€‚ â‘ ã€å¯¹äºç¬¬ä¸€ä¸ªé”®h1çš„è®¡ç®—ï¼š åŸå§‹: 0001 0010 0011 0100 0101 0110 0111 1000å³ç§»: 0000 0000 0000 0000 0001 0010 0011 0100å¼‚æˆ–: ---------------------------------------ç»“æœ: 0001 0010 0011 0100 0100 0100 0100 1100 â‘¡ã€å¯¹äºç¬¬äºŒä¸ªé”®h2çš„è®¡ç®—ï¼š åŸå§‹: 0001 0010 0011 0101 0101 0110 0111 1000å³ç§»: 0000 0000 0000 0000 0001 0010 0011 0101å¼‚æˆ–: ---------------------------------------ç»“æœ: 0001 0010 0011 0101 0100 0100 0100 1101 é€šè¿‡ä¸Šè¿°è®¡ç®—ï¼Œæˆ‘ä»¬å¯ä»¥çœ‹åˆ°h1å’Œh2ç»è¿‡h ^ (h 16)æ“ä½œåå¾—åˆ°äº†ä¸åŒçš„ç»“æœã€‚ ç°åœ¨ï¼Œè€ƒè™‘æ•°ç»„é•¿åº¦ä¸º 16 æ—¶ï¼ˆéœ€è¦æœ€ä½ 4 ä½æ¥ç¡®å®šç´¢å¼•ï¼‰ï¼š å¯¹äºh1çš„æœ€ä½ 4 ä½æ˜¯1100ï¼ˆåè¿›åˆ¶ä¸­ä¸º 12ï¼‰å¯¹äºh2çš„æœ€ä½ 4 ä½æ˜¯1101ï¼ˆåè¿›åˆ¶ä¸­ä¸º 13ï¼‰è¿™æ ·ï¼Œh1å’Œh2å°±ä¼šè¢«åˆ†åˆ«æ”¾åœ¨æ•°ç»„çš„ç¬¬ 12 ä¸ªä½ç½®å’Œç¬¬ 13 ä¸ªä½ç½®ä¸Šï¼Œä»è€Œé¿å…äº†å“ˆå¸Œå†²çªã€‚ 15.ä¸ºä»€ä¹ˆ HashMap çš„å®¹é‡æ˜¯ 2 çš„å¹‚æ¬¡æ–¹ï¼Ÿæ˜¯ä¸ºäº†å¿«é€Ÿå®šä½å…ƒç´ åœ¨åº•å±‚æ•°ç»„ä¸­çš„ä¸‹æ ‡ã€‚ HashMap æ˜¯é€šè¿‡Â hash (n-1)Â æ¥å®šä½å…ƒç´ ä¸‹æ ‡çš„ï¼Œn ä¸ºæ•°ç»„çš„å¤§å°ï¼Œä¹Ÿå°±æ˜¯ HashMap åº•å±‚æ•°ç»„çš„å®¹é‡ã€‚ æ•°ç»„é•¿åº¦-1 æ­£å¥½ç›¸å½“äºä¸€ä¸ªâ€œä½ä½æ©ç â€â€”â€”æ©ç çš„ä½ä½æœ€å¥½å…¨æ˜¯ 1ï¼Œè¿™æ · è¿ç®—æ‰æœ‰æ„ä¹‰ï¼Œå¦åˆ™ç»“æœä¸€å®šæ˜¯ 0ã€‚ 2 å¹‚æ¬¡æ–¹åˆšå¥½æ˜¯å¶æ•°ï¼Œå¶æ•°-1 æ˜¯å¥‡æ•°ï¼Œå¥‡æ•°çš„äºŒè¿›åˆ¶æœ€åä¸€ä½æ˜¯ 1ï¼Œä¹Ÿå°±ä¿è¯äº†Â hash (length-1)Â çš„æœ€åä¸€ä½å¯èƒ½ä¸º 0ï¼Œä¹Ÿå¯èƒ½ä¸º 1ï¼ˆå–å†³äº hash çš„å€¼ï¼‰ï¼Œè¿™æ ·å¯ä»¥ä¿è¯å“ˆå¸Œå€¼çš„å‡åŒ€åˆ†å¸ƒã€‚ æ¢å¥è¯è¯´ï¼Œ æ“ä½œçš„ç»“æœå°±æ˜¯å°†å“ˆå¸Œå€¼çš„é«˜ä½å…¨éƒ¨å½’é›¶ï¼Œåªä¿ç•™ä½ä½å€¼ã€‚ ab çš„ç»“æœæ˜¯ï¼šaã€b ä¸­å¯¹åº”ä½åŒæ—¶ä¸º 1ï¼Œåˆ™ç»“æœä¸º 1ï¼Œå¦åˆ™ä¸º 0ã€‚ä¾‹å¦‚ 531ï¼Œ5 çš„äºŒè¿›åˆ¶æ˜¯ 0101ï¼Œ3 çš„äºŒè¿›åˆ¶æ˜¯ 0011ï¼Œ5300011ã€‚ å‡è®¾æŸå“ˆå¸Œå€¼çš„äºŒè¿›åˆ¶ä¸ºÂ 10100101 11000100 00100101ï¼Œç”¨å®ƒæ¥åš è¿ç®—ï¼Œæˆ‘ä»¬æ¥çœ‹ä¸€ä¸‹ç»“æœã€‚ å·²çŸ¥ HashMap çš„åˆå§‹é•¿åº¦ä¸º 16ï¼Œ16-115ï¼ŒäºŒè¿›åˆ¶æ˜¯Â 00000000 00000000 00001111ï¼ˆé«˜ä½ç”¨ 0 æ¥è¡¥é½ï¼‰ï¼š 10100101 11000100 00100101\t00000000 00000000 00001111---------------------------------- 00000000 00000000 00000101 å› ä¸º 15 çš„é«˜ä½å…¨éƒ¨æ˜¯ 0ï¼Œæ‰€ä»¥ è¿ç®—åçš„é«˜ä½ç»“æœè‚¯å®šä¹Ÿæ˜¯ 0ï¼Œåªå‰©ä¸‹ 4 ä¸ªä½ä½Â 0101ï¼Œä¹Ÿå°±æ˜¯åè¿›åˆ¶çš„ 5ã€‚ è¿™æ ·ï¼Œå“ˆå¸Œå€¼ä¸ºÂ 10100101 11000100 00100101Â çš„é”®å°±ä¼šæ”¾åœ¨æ•°ç»„çš„ç¬¬ 5 ä¸ªä½ç½®ä¸Šã€‚ å¯¹æ•°ç»„é•¿åº¦å–æ¨¡å®šä½æ•°ç»„ä¸‹æ ‡ï¼Œè¿™å—æœ‰æ²¡æœ‰ä¼˜åŒ–ç­–ç•¥ï¼Ÿå¿«é€Ÿå›ç­”ï¼šHashMap çš„ç­–ç•¥æ˜¯å°†å–æ¨¡è¿ç®—Â hash % table.lengthÂ ä¼˜åŒ–ä¸ºä½è¿ç®—Â hash (length - 1)ã€‚ å› ä¸ºå½“æ•°ç»„çš„é•¿åº¦æ˜¯ 2 çš„ N æ¬¡å¹‚æ—¶ï¼Œhash (length - 1) = hash % lengthã€‚ æ¯”å¦‚è¯´ 9 % 4 = 1ï¼Œ9 çš„äºŒè¿›åˆ¶æ˜¯ 1001ï¼Œ4 - 1 = 3ï¼Œ3 çš„äºŒè¿›åˆ¶æ˜¯ 0011ï¼Œ9 3 = 1001 0011 = 0001 = 1ã€‚ å†æ¯”å¦‚è¯´ 10 % 4 = 2ï¼Œ10 çš„äºŒè¿›åˆ¶æ˜¯ 1010ï¼Œ4 - 1 = 3ï¼Œ3 çš„äºŒè¿›åˆ¶æ˜¯ 0011ï¼Œ10 3 = 1010 0011 = 0010 = 2ã€‚ å½“æ•°ç»„çš„é•¿åº¦ä¸æ˜¯ 2 çš„ n æ¬¡æ–¹æ—¶ï¼Œhash % lengthÂ å’ŒÂ hash (length - 1)Â çš„ç»“æœå°±ä¸ä¸€è‡´äº†ã€‚ æ¯”å¦‚è¯´ 7 % 3 = 1ï¼Œ7 çš„äºŒè¿›åˆ¶æ˜¯ 0111ï¼Œ3 - 1 = 2ï¼Œ2 çš„äºŒè¿›åˆ¶æ˜¯ 0010ï¼Œ7 2 = 0111 0010 = 0010 = 2ã€‚ 1110 (hash = 14) 0111 (length - 1 = 7) ------------------------------ 0110 (ç»“æœ = 6) ä¿ç•™ 14 çš„æœ€ä½ 3 ä½ï¼Œé«˜ä½è¢«æ¸…é›¶ã€‚ ä»æ­¤ï¼Œä¸¤ä¸ªè¿ç®—Â hash % lengthÂ å’ŒÂ hash (length - 1)Â æœ‰äº†å®Œç¾çš„é—­ç¯ã€‚åœ¨è®¡ç®—æœºä¸­ï¼Œä½è¿ç®—çš„é€Ÿåº¦è¦è¿œé«˜äºå–ä½™è¿ç®—ï¼Œå› ä¸ºè®¡ç®—æœºæœ¬è´¨ä¸Šå°±æ˜¯äºŒè¿›åˆ¶å˜›ã€‚ è¯´è¯´ä»€ä¹ˆæ˜¯å–æ¨¡è¿ç®—ï¼Ÿåœ¨ Java ä¸­ï¼Œé€šå¸¸ä½¿ç”¨ % è¿ç®—ç¬¦æ¥è¡¨ç¤ºå–ä½™ï¼Œç”¨Â Math.floorMod()Â æ¥è¡¨ç¤ºå–æ¨¡ã€‚ å½“æ“ä½œæ•°éƒ½æ˜¯æ­£æ•°çš„è¯ï¼Œå–æ¨¡è¿ç®—å’Œå–ä½™è¿ç®—çš„ç»“æœæ˜¯ä¸€æ ·çš„ï¼›åªæœ‰æ“ä½œæ•°å‡ºç°è´Ÿæ•°çš„æƒ…å†µä¸‹ï¼Œç»“æœæ‰ä¼šä¸åŒã€‚ å–æ¨¡è¿ç®—çš„å•†å‘è´Ÿæ— ç©·é è¿‘ï¼›å–ä½™è¿ç®—çš„å•†å‘ 0 é è¿‘ã€‚è¿™æ˜¯å¯¼è‡´å®ƒä»¬ä¸¤ä¸ªåœ¨å¤„ç†æœ‰è´Ÿæ•°æƒ…å†µä¸‹ï¼Œç»“æœä¸åŒçš„æ ¹æœ¬åŸå› ã€‚ å½“æ•°ç»„çš„é•¿åº¦æ˜¯ 2 çš„ n æ¬¡å¹‚æ—¶ï¼Œå–æ¨¡è¿ç®—/å–ä½™è¿ç®—å¯ä»¥ç”¨ä½è¿ç®—æ¥ä»£æ›¿ï¼Œæ•ˆç‡æ›´é«˜ï¼Œæ¯•ç«Ÿè®¡ç®—æœºæœ¬èº«åªè®¤äºŒè¿›åˆ¶ã€‚ æ¯”å¦‚è¯´ï¼Œ7 å¯¹ 3 å–ä½™ï¼Œå’Œ 7 å¯¹ 3 å–æ¨¡ï¼Œç»“æœéƒ½æ˜¯ 1ã€‚å› ä¸ºä¸¤è€…éƒ½æ˜¯åŸºäºé™¤æ³•è¿ç®—çš„ï¼Œ7 3 çš„å•†æ˜¯ 2ï¼Œä½™æ•°æ˜¯ 1ã€‚ å¯¹äº HashMap æ¥è¯´ï¼Œå®ƒéœ€è¦é€šè¿‡Â hash % table.lengthÂ æ¥ç¡®å®šå…ƒç´ åœ¨æ•°ç»„ä¸­çš„ä½ç½®ã€‚ æ¯”å¦‚è¯´ï¼Œæ•°ç»„é•¿åº¦æ˜¯ 3ï¼Œhash æ˜¯ 7ï¼Œé‚£ä¹ˆ 7 % 3 çš„ç»“æœå°±æ˜¯ 1ï¼Œä¹Ÿå°±æ˜¯æ­¤æ—¶å¯ä»¥æŠŠå…ƒç´ æ”¾åœ¨ä¸‹æ ‡ä¸º 1 çš„ä½ç½®ã€‚ å½“ hash æ˜¯ 8ï¼Œ8 % 3 çš„ç»“æœå°±æ˜¯ 2ï¼Œä¹Ÿå°±æ˜¯å¯ä»¥æŠŠå…ƒç´ æ”¾åœ¨ä¸‹æ ‡ä¸º 2 çš„ä½ç½®ã€‚ å½“ hash æ˜¯ 9ï¼Œ9 % 3 çš„ç»“æœå°±æ˜¯ 0ï¼Œä¹Ÿå°±æ˜¯å¯ä»¥æŠŠå…ƒç´ æ”¾åœ¨ä¸‹æ ‡ä¸º 0 çš„ä½ç½®ä¸Šã€‚ æ˜¯ä¸æ˜¯å¾ˆå¥‡å¦™ï¼Œæ•°ç»„çš„å¤§å°ä¸º 3ï¼Œåˆšå¥½ 3 ä¸ªä½ç½®éƒ½åˆ©ç”¨ä¸Šäº†ã€‚ 16.å¦‚æœåˆå§‹åŒ– HashMapï¼Œä¼ ä¸€ä¸ª 17 çš„å®¹é‡ï¼Œå®ƒä¼šæ€ä¹ˆå¤„ç†ï¼ŸHashMap ä¼šå°†å®¹é‡è°ƒæ•´åˆ°å¤§äºç­‰äº 17 çš„æœ€å°çš„ 2 çš„å¹‚æ¬¡æ–¹ï¼Œä¹Ÿå°±æ˜¯ 32ã€‚ è¿™æ˜¯å› ä¸ºå“ˆå¸Œè¡¨çš„å¤§å°æœ€å¥½æ˜¯ 2 çš„ N æ¬¡å¹‚ï¼Œè¿™æ ·å¯ä»¥é€šè¿‡Â (n - 1) hashÂ é«˜æ•ˆè®¡ç®—å‡ºç´¢å¼•å€¼ã€‚ è§£é‡Šä¸€ä¸‹ã€‚ åœ¨ HashMap çš„åˆå§‹åŒ–æ„é€ æ–¹æ³•ä¸­ï¼Œæœ‰è¿™æ ·â¼€æ®µä»£ç ï¼š public HashMap(int initialCapacity, float loadFactor) ... this.loadFactor = loadFactor; this.threshold = tableSizeFor(initialCapacity); é˜€å€¼ threshold ä¼šé€šè¿‡â½…æ³•Â tableSizeFor()Â è¿›â¾è®¡ç®—ã€‚ static final int tableSizeFor(int cap) int n = cap - 1; n |= n 1; n |= n 2; n |= n 4; n |= n 8; n |= n 16; return (n 0) ? 1 : (n = MAXIMUM_CAPACITY) ? MAXIMUM_CAPACITY : n + 1; â‘ ã€int n = cap - 1;Â é¿å…åˆšå¥½æ˜¯ 2 çš„å¹‚æ¬¡æ–¹æ—¶ï¼Œå®¹é‡ç›´æ¥ç¿»å€ã€‚ â‘¡ã€æ¥ä¸‹æ¥é€šè¿‡ä¸æ–­å³ç§»ï¼ˆï¼‰å¹¶ä¸è‡ªèº«è¿›è¡Œæˆ–è¿ç®—ï¼ˆ|=ï¼‰ï¼Œå°† n çš„äºŒè¿›åˆ¶è¡¨ç¤ºä¸­çš„æ‰€æœ‰ä½ä½è®¾ç½®ä¸º 1ã€‚ n |= n 1;Â å°†æœ€é«˜ä½çš„ 1 æ‰©å±•åˆ°ä¸‹ä¸€ä½ã€‚ n |= n 2;Â æ‰©å±•åˆ°åä¸¤ä½ã€‚ ä¾æ­¤ç±»æ¨ï¼Œç›´åˆ°Â n |= n 16;ï¼Œæ‰©å±•åˆ°ååå…­ä½ï¼Œè¿™æ ·ä»æœ€é«˜ä½çš„ 1 åˆ°æœ€ä½ä½ï¼Œå°±éƒ½å˜æˆäº† 1ã€‚ â‘¢ã€å¦‚æœ n å°äº 0ï¼Œè¯´æ˜ cap æ˜¯è´Ÿæ•°ï¼Œç›´æ¥è¿”å› 1ã€‚ å¦‚æœ n å¤§äºæˆ–ç­‰äº MAXIMUM_CAPACITYï¼ˆé€šå¸¸æ˜¯1 30ï¼‰ï¼Œåˆ™è¿”å› MAXIMUM_CAPACITYã€‚ å¦åˆ™ï¼Œè¿”å› n + 1ï¼Œè¿™æ˜¯å› ä¸º n çš„æ‰€æœ‰ä½ä½éƒ½æ˜¯ 1ï¼Œæ‰€ä»¥ n + 1 å°±æ˜¯å¤§äº cap çš„æœ€å°çš„ 2 çš„å¹‚æ¬¡æ–¹ã€‚ åˆå§‹åŒ– HashMap çš„æ—¶å€™éœ€è¦ä¼ å…¥å®¹é‡å—ï¼Ÿå¦‚æœé¢„å…ˆçŸ¥é“ Map å°†å­˜å‚¨å¤§é‡é”®å€¼å¯¹ï¼Œæå‰æŒ‡å®šä¸€ä¸ªè¶³å¤Ÿå¤§çš„åˆå§‹å®¹é‡å¯ä»¥å‡å°‘å› æ‰©å®¹å¯¼è‡´çš„é‡å“ˆå¸Œæ“ä½œã€‚ å› ä¸ºæ¯æ¬¡æ‰©å®¹æ—¶ï¼ŒHashMap éœ€è¦å°†ç°æœ‰çš„å…ƒç´ æ’å…¥åˆ°æ–°çš„æ•°ç»„ä¸­ï¼Œè¿™ä¸ªè¿‡ç¨‹ç›¸å¯¹è€—æ—¶ï¼Œå°¤å…¶æ˜¯å½“ Map ä¸­å·²æœ‰å¤§é‡æ•°æ®æ—¶ã€‚ å½“ç„¶äº†ï¼Œè¿‡å¤§çš„åˆå§‹å®¹é‡ä¼šæµªè´¹å†…å­˜ï¼Œç‰¹åˆ«æ˜¯å½“å®é™…å­˜å‚¨çš„å…ƒç´ è¿œå°‘äºåˆå§‹å®¹é‡æ—¶ã€‚å¦‚æœä¸æŒ‡å®šåˆå§‹å®¹é‡ï¼ŒHashMap å°†ä½¿ç”¨é»˜è®¤çš„åˆå§‹å®¹é‡ 16ã€‚ 17.ä½ è¿˜çŸ¥é“å“ªäº›å“ˆå¸Œå‡½æ•°çš„æ„é€ æ–¹æ³•å‘¢ï¼Ÿâ‘ ã€é™¤ç•™å–ä½™æ³•ï¼šH(key)=key%p(p=N)ï¼Œå…³é”®å­—é™¤ä»¥ä¸€ä¸ªä¸å¤§äºå“ˆå¸Œè¡¨é•¿åº¦çš„æ­£æ•´æ•° pï¼Œæ‰€å¾—ä½™æ•°ä¸ºåœ°å€ï¼Œå½“ç„¶ HashMap é‡Œè¿›è¡Œäº†ä¼˜åŒ–æ”¹é€ ï¼Œæ•ˆç‡æ›´é«˜ï¼Œæ•£åˆ—ä¹Ÿæ›´å‡è¡¡ã€‚ é™¤æ­¤ä¹‹å¤–ï¼Œè¿˜æœ‰è¿™å‡ ç§å¸¸è§çš„å“ˆå¸Œå‡½æ•°æ„é€ æ–¹æ³•ï¼š â‘¡ã€ç›´æ¥å®šå€æ³•ï¼šç›´æ¥æ ¹æ®keyæ¥æ˜ å°„åˆ°å¯¹åº”çš„æ•°ç»„ä½ç½®ï¼Œä¾‹å¦‚ 1232 æ”¾åˆ°ä¸‹æ ‡ 1232 çš„ä½ç½®ã€‚ â‘¢ã€æ•°å­—åˆ†ææ³•ï¼šå–keyçš„æŸäº›æ•°å­—ï¼ˆä¾‹å¦‚åä½å’Œç™¾ä½ï¼‰ä½œä¸ºæ˜ å°„çš„ä½ç½® â‘£ã€å¹³æ–¹å–ä¸­æ³•ï¼šå–keyå¹³æ–¹çš„ä¸­é—´å‡ ä½ä½œä¸ºæ˜ å°„çš„ä½ç½® â‘¤ã€å°†keyåˆ†å‰²æˆä½æ•°ç›¸åŒçš„å‡ æ®µï¼Œç„¶åæŠŠå®ƒä»¬çš„å åŠ å’Œä½œä¸ºæ˜ å°„çš„ä½ç½®ã€‚ 18.è§£å†³å“ˆå¸Œå†²çªçš„æ–¹æ³•æœ‰å“ªäº›ï¼Ÿç®€ç‰ˆå›ç­”ï¼šæˆ‘çŸ¥é“çš„æœ‰ 3 ç§ï¼Œå†å“ˆå¸Œæ³•ã€å¼€æ”¾åœ°å€æ³•å’Œæ‹‰é“¾æ³•ã€‚ ä»€ä¹ˆæ˜¯å†å“ˆå¸Œæ³•ï¼Ÿå‡†å¤‡ä¸¤å¥—å“ˆå¸Œç®—æ³•ï¼Œå½“å‘ç”Ÿå“ˆå¸Œå†²çªçš„æ—¶å€™ï¼Œä½¿ç”¨å¦å¤–ä¸€ç§å“ˆå¸Œç®—æ³•ï¼Œç›´åˆ°æ‰¾åˆ°ç©ºæ§½ä¸ºæ­¢ã€‚å¯¹å“ˆå¸Œç®—æ³•çš„è®¾è®¡è¦æ±‚æ¯”è¾ƒé«˜ã€‚ ä»€ä¹ˆæ˜¯å¼€æ”¾åœ°å€æ³•ï¼Ÿé‡åˆ°å“ˆå¸Œå†²çªçš„æ—¶å€™ï¼Œå°±å»å¯»æ‰¾ä¸‹ä¸€ä¸ªç©ºçš„æ§½ã€‚æœ‰ 3 ç§æ–¹æ³•ï¼š ä»€ä¹ˆæ˜¯æ‹‰é“¾æ³•ï¼Ÿä¹Ÿå°±æ˜¯é“¾åœ°å€æ³•ï¼Œå½“å‘ç”Ÿå“ˆå¸Œå†²çªçš„æ—¶å€™ï¼Œä½¿ç”¨é“¾è¡¨å°†å†²çªçš„å…ƒç´ ä¸²èµ·æ¥ã€‚HashMap é‡‡ç”¨çš„æ­£æ˜¯æ‹‰é“¾æ³•ã€‚ æ€ä¹ˆåˆ¤æ–­ key ç›¸ç­‰å‘¢ï¼Ÿä¾èµ–äºkeyçš„equals()æ–¹æ³•å’ŒhashCode()æ–¹æ³•ã€‚ if (e.hash == hash ((k = e.key) == key || (key != null key.equals(k)))) â‘ ã€hashCode() ï¼šä½¿ç”¨keyçš„hashCode()æ–¹æ³•è®¡ç®—keyçš„å“ˆå¸Œç ã€‚ â‘¡ã€equals() ï¼šå½“ä¸¤ä¸ªkeyçš„å“ˆå¸Œç ç›¸åŒæ—¶ï¼ŒHashMapè¿˜ä¼šè°ƒç”¨keyçš„equals()æ–¹æ³•è¿›è¡Œç²¾ç¡®æ¯”è¾ƒã€‚åªæœ‰å½“equals()æ–¹æ³•è¿”å›trueæ—¶ï¼Œä¸¤ä¸ªkeyæ‰è¢«è®¤ä¸ºæ˜¯å®Œå…¨ç›¸åŒçš„ã€‚ å¦‚æœä¸¤ä¸ªkeyçš„å¼•ç”¨æŒ‡å‘äº†åŒä¸€ä¸ªå¯¹è±¡ï¼Œé‚£ä¹ˆå®ƒä»¬çš„hashCode()å’Œequals()æ–¹æ³•éƒ½ä¼šè¿”å›trueï¼Œæ‰€ä»¥åœ¨ equals åˆ¤æ–­ä¹‹å‰å¯ä»¥å…ˆä½¿ç”¨==è¿ç®—ç¬¦åˆ¤æ–­ä¸€æ¬¡ã€‚ 19.ä¸ºä»€ä¹ˆ HashMap é“¾è¡¨è½¬çº¢é»‘æ ‘çš„é˜ˆå€¼ä¸º 8 å‘¢ï¼Ÿæ ‘åŒ–å‘ç”Ÿåœ¨ table æ•°ç»„çš„é•¿åº¦å¤§äº 64ï¼Œä¸”é“¾è¡¨çš„é•¿åº¦å¤§äº 8 çš„æ—¶å€™ã€‚ ä¸ºä»€ä¹ˆæ˜¯ 8 å‘¢ï¼Ÿæºç çš„æ³¨é‡Šä¹Ÿç»™å‡ºäº†ç­”æ¡ˆã€‚ çº¢é»‘æ ‘èŠ‚ç‚¹çš„å¤§å°å¤§æ¦‚æ˜¯æ™®é€šèŠ‚ç‚¹å¤§å°çš„ä¸¤å€ï¼Œæ‰€ä»¥è½¬çº¢é»‘æ ‘ï¼Œç‰ºç‰²äº†ç©ºé—´æ¢æ—¶é—´ï¼Œæ›´å¤šçš„æ˜¯ä¸€ç§å…œåº•çš„ç­–ç•¥ï¼Œä¿è¯æç«¯æƒ…å†µä¸‹çš„æŸ¥æ‰¾æ•ˆç‡ã€‚ é˜ˆå€¼ä¸ºä»€ä¹ˆè¦é€‰ 8 å‘¢ï¼Ÿå’Œç»Ÿè®¡å­¦æœ‰å…³ã€‚ç†æƒ³æƒ…å†µä¸‹ï¼Œä½¿ç”¨éšæœºå“ˆå¸Œç ï¼Œé“¾è¡¨é‡Œçš„èŠ‚ç‚¹ç¬¦åˆæ³Šæ¾åˆ†å¸ƒï¼Œå‡ºç°èŠ‚ç‚¹ä¸ªæ•°çš„æ¦‚ç‡æ˜¯é€’å‡çš„ï¼ŒèŠ‚ç‚¹ä¸ªæ•°ä¸º 8 çš„æƒ…å†µï¼Œå‘ç”Ÿæ¦‚ç‡ä»…ä¸º0.00000006ã€‚ è‡³äºçº¢é»‘æ ‘è½¬å›é“¾è¡¨çš„é˜ˆå€¼ä¸ºä»€ä¹ˆæ˜¯ 6ï¼Œè€Œä¸æ˜¯ 8ï¼Ÿæ˜¯å› ä¸ºå¦‚æœè¿™ä¸ªé˜ˆå€¼ä¹Ÿè®¾ç½®æˆ 8ï¼Œå‡å¦‚å‘ç”Ÿç¢°æ’ï¼ŒèŠ‚ç‚¹å¢å‡åˆšå¥½åœ¨ 8 é™„è¿‘ï¼Œä¼šå‘ç”Ÿé“¾è¡¨å’Œçº¢é»‘æ ‘çš„ä¸æ–­è½¬æ¢ï¼Œå¯¼è‡´èµ„æºæµªè´¹ã€‚ 20.HashMapæ‰©å®¹å‘ç”Ÿåœ¨ä»€ä¹ˆæ—¶å€™å‘¢ï¼Ÿå½“é”®å€¼å¯¹æ•°é‡è¶…è¿‡é˜ˆå€¼ï¼Œä¹Ÿå°±æ˜¯å®¹é‡ * è´Ÿè½½å› å­æ—¶ã€‚ é»˜è®¤çš„è´Ÿè½½å› å­æ˜¯å¤šå°‘ï¼Ÿ0.75ã€‚ åˆå§‹å®¹é‡æ˜¯å¤šå°‘ï¼Ÿ16ã€‚ 1 å·¦ç§» 4 ä½ï¼Œ0000 0001 â†’ 0001 0000ï¼Œä¹Ÿå°±æ˜¯ 2 çš„ 4 æ¬¡æ–¹ã€‚ static final int DEFAULT_INITIAL_CAPACITY = 1 4; // aka 16 ä¸ºä»€ä¹ˆä½¿ç”¨ 1 4 è€Œä¸æ˜¯ç›´æ¥å†™ 16ï¼Ÿå†™ 1 4 ä¸»è¦æ˜¯ä¸ºäº†å¼ºè°ƒè¿™ä¸ªå€¼æ˜¯ 2 çš„å¹‚æ¬¡æ–¹ï¼Œè€Œä¸æ˜¯ä¸€ä¸ªå®Œå…¨éšæœºçš„é€‰æ‹©ã€‚ æ— è®º HashMap æ˜¯å¦æ‰©å®¹ï¼Œå…¶åº•å±‚çš„æ•°ç»„é•¿åº¦éƒ½åº”è¯¥æ˜¯ 2 çš„å¹‚æ¬¡æ–¹ï¼Œå› ä¸ºè¿™æ ·å¯ä»¥é€šè¿‡ä½è¿ç®—å¿«é€Ÿè®¡ç®—å‡ºå…ƒç´ çš„ç´¢å¼•ã€‚ ä¸ºä»€ä¹ˆé€‰æ‹© 0.75 ä½œä¸º HashMap çš„é»˜è®¤è´Ÿè½½å› å­å‘¢ï¼Ÿè¿™æ˜¯ä¸€ä¸ªç»éªŒå€¼ã€‚å¦‚æœè®¾ç½®å¾—å¤ªä½ï¼Œå¦‚ 0.5ï¼Œä¼šæµªè´¹ç©ºé—´ï¼›å¦‚æœè®¾ç½®å¾—å¤ªé«˜ï¼Œå¦‚ 0.9ï¼Œä¼šå¢åŠ å“ˆå¸Œå†²çªã€‚ 0.75 æ˜¯ JDK ä½œè€…ç»è¿‡å¤§é‡éªŒè¯åå¾—å‡ºçš„æœ€ä¼˜è§£ï¼Œèƒ½å¤Ÿæœ€å¤§é™åº¦å‡å°‘ rehash çš„æ¬¡æ•°ã€‚ 21.ğŸŒŸHashMapçš„æ‰©å®¹æœºåˆ¶äº†è§£å—ï¼Ÿæ‰©å®¹æ—¶ï¼ŒHashMap ä¼šåˆ›å»ºä¸€ä¸ªæ–°çš„æ•°ç»„ï¼Œå…¶å®¹é‡æ˜¯åŸæ¥çš„ä¸¤å€ã€‚ç„¶åéå†æ—§å“ˆå¸Œè¡¨ä¸­çš„å…ƒç´ ï¼Œå°†å…¶é‡æ–°åˆ†é…åˆ°æ–°çš„å“ˆå¸Œè¡¨ä¸­ã€‚ å¦‚æœå½“å‰æ¡¶ä¸­åªæœ‰ä¸€ä¸ªå…ƒç´ ï¼Œé‚£ä¹ˆç›´æ¥é€šè¿‡é”®çš„å“ˆå¸Œå€¼ä¸æ•°ç»„å¤§å°å–æ¨¡é”å®šæ–°çš„ç´¢å¼•ä½ç½®ï¼še.hash (newCap - 1)ã€‚ å¦‚æœå½“å‰æ¡¶æ˜¯çº¢é»‘æ ‘ï¼Œé‚£ä¹ˆä¼šè°ƒç”¨ split() æ–¹æ³•åˆ†è£‚æ ‘èŠ‚ç‚¹ï¼Œä»¥ä¿è¯æ ‘çš„å¹³è¡¡ã€‚ å¦‚æœå½“å‰æ¡¶æ˜¯é“¾è¡¨ï¼Œä¼šé€šè¿‡æ—§é”®çš„å“ˆå¸Œå€¼ä¸æ—§çš„æ•°ç»„å¤§å°å–æ¨¡ (e.hash oldCap) == 0 æ¥ä½œä¸ºåˆ¤æ–­æ¡ä»¶ï¼Œå¦‚æœæ¡ä»¶ä¸ºçœŸï¼Œå…ƒç´ ä¿ç•™åœ¨åŸç´¢å¼•çš„ä½ç½®ï¼›å¦åˆ™å…ƒç´ ç§»åŠ¨åˆ°åŸç´¢å¼• + æ—§æ•°ç»„å¤§å°çš„ä½ç½®ã€‚ JDK 7 æ‰©å®¹çš„æ—¶å€™æœ‰ä»€ä¹ˆé—®é¢˜ï¼ŸJDK 7 åœ¨æ‰©å®¹çš„æ—¶å€™ä½¿ç”¨å¤´æ’æ³•æ¥é‡æ–°æ’å…¥é“¾è¡¨èŠ‚ç‚¹ï¼Œè¿™æ ·ä¼šå¯¼è‡´é“¾è¡¨æ— æ³•ä¿æŒåŸæœ‰çš„é¡ºåºã€‚ è¯¦ç»†è§£é‡Šä¸€ä¸‹ã€‚ JDK 7 æ˜¯é€šè¿‡å“ˆå¸Œå€¼ä¸æ•°ç»„å¤§å°-1 è¿›è¡Œä¸è¿ç®—ç¡®å®šå…ƒç´ ä¸‹æ ‡çš„ã€‚ static int indexFor(int h, int length) return h (length-1); æˆ‘ä»¬æ¥å‡è®¾ï¼š æ•°ç»„ table çš„é•¿åº¦ä¸º 2 é”®çš„å“ˆå¸Œå€¼ä¸º 3ã€7ã€5 å–æ¨¡è¿ç®—åï¼Œé”®å‘ç”Ÿäº†å“ˆå¸Œå†²çªï¼Œå®ƒä»¬éƒ½éœ€è¦æ”¾åˆ° table[1] çš„æ¡¶ä¸Šã€‚é‚£ä¹ˆæ‰©å®¹å‰å°±æ˜¯è¿™ä¸ªæ ·å­ï¼š å‡è®¾è´Ÿè½½å› å­ loadFactor ä¸º 1ï¼Œä¹Ÿå°±æ˜¯å½“å…ƒç´ çš„ä¸ªæ•°å¤§äº table çš„é•¿åº¦æ—¶è¿›è¡Œæ‰©å®¹ã€‚ æ‰©å®¹åçš„æ•°ç»„å®¹é‡ä¸º 4ã€‚ key 3 å–æ¨¡ï¼ˆ3%4ï¼‰åæ˜¯ 3ï¼Œæ”¾åœ¨ table[3] ä¸Šã€‚ key 7 å–æ¨¡ï¼ˆ7%4ï¼‰åæ˜¯ 3ï¼Œæ”¾åœ¨ table[3] ä¸Šçš„é“¾è¡¨å¤´éƒ¨ã€‚ key 5 å–æ¨¡ï¼ˆ5%4ï¼‰åæ˜¯ 1ï¼Œæ”¾åœ¨ table[1] ä¸Šã€‚ å¯ä»¥çœ‹åˆ°ï¼Œç”±äº JDK é‡‡ç”¨çš„æ˜¯å¤´æ’æ³•ï¼Œ7 è·‘åˆ° 3 çš„å‰é¢äº†ï¼ŒåŸæ¥çš„é¡ºåºæ˜¯ 3ã€7ã€5ï¼Œ7 åœ¨ 3 çš„åé¢ã€‚ for (EntryK,V e : oldTable) while (null != e) EntryK,V next = e.next; int i = indexFor(e.hash, newCapacity); e.next = newTable[i]; newTable[i] = e; e = next; æœ€å¥½çš„æƒ…å†µå°±æ˜¯ï¼Œæ‰©å®¹åçš„ 7 è¿˜åœ¨ 3 çš„åé¢ï¼Œä¿æŒåŸæ¥çš„é¡ºåºã€‚ JDK 8 æ˜¯æ€ä¹ˆè§£å†³è¿™ä¸ªé—®é¢˜çš„ï¼ŸJDK 8 æ”¹ç”¨äº†å°¾æ’æ³•ï¼Œå¹¶ä¸”å½“ (e.hash oldCap) == 0 æ—¶ï¼Œå…ƒç´ ä¿ç•™åœ¨åŸç´¢å¼•çš„ä½ç½®ï¼›å¦åˆ™å…ƒç´ ç§»åŠ¨åˆ°åŸç´¢å¼• + æ—§æ•°ç»„å¤§å°çš„ä½ç½®ã€‚ NodeK,V loHead = null, loTail = null;NodeK,V hiHead = null, hiTail = null;NodeK,V next;do next = e.next; if ((e.hash oldCap) == 0) if (loTail == null) loHead = e; else loTail.next = e; loTail = e; else if (hiTail == null) hiHead = e; else hiTail.next = e; hiTail = e; while ((e = next) != null);if (loHead != null) newTab[j] = loHead;if (hiHead != null) newTab[j + oldCap] = hiHead; ç”±äºæ‰©å®¹æ—¶ï¼Œæ•°ç»„é•¿åº¦ä¼šç¿»å€ï¼Œä¾‹å¦‚ï¼š16 â†’ 32ï¼Œ å› æ­¤ï¼Œæ–°æ•°ç»„çš„ç´¢å¼•èŒƒå›´æ˜¯åŸç´¢å¼•èŒƒå›´çš„ä¸¤å€ã€‚ åŸç´¢å¼• index = (n - 1) hashï¼Œæ‰©å®¹åçš„æ–°ç´¢å¼•å°±æ˜¯ index = (2n - 1) hashã€‚ ä¹Ÿå°±æ˜¯è¯´ï¼Œå¦‚æœ (e.hash oldCap) == 0ï¼Œå…ƒç´ åœ¨æ–°æ•°ç»„ä¸­çš„ä½ç½®ä¸æ—§ä½ç½®ç›¸åŒï¼›å¦åˆ™ï¼Œå…ƒç´ åœ¨æ–°æ•°ç»„ä¸­çš„ä½ç½®æ˜¯æ—§ä½ç½® + æ—§æ•°ç»„å¤§å°ã€‚ è¿™æ ·å¯ä»¥é¿å…é‡æ–°è®¡ç®—æ‰€æœ‰å…ƒç´ çš„å“ˆå¸Œå€¼ï¼Œåªéœ€æ£€æŸ¥é«˜ä½çš„æŸä¸€ä½ï¼Œå°±å¯ä»¥å¿«é€Ÿç¡®å®šæ–°ä½ç½®ã€‚ æ‰©å®¹çš„æ—¶å€™æ¯ä¸ªèŠ‚ç‚¹éƒ½è¦è¿›è¡Œä½è¿ç®—å—ï¼Ÿä¸éœ€è¦ã€‚HashMap ä¼šé€šè¿‡ (e.hash oldCap) æ¥åˆ¤æ–­èŠ‚ç‚¹æ˜¯å¦éœ€è¦ç§»åŠ¨ï¼Œ0 çš„è¯ä¿ç•™åŸç´¢å¼•ï¼›1 æ‰éœ€è¦ç§»åŠ¨åˆ°æ–°ç´¢å¼•ï¼ˆåŸç´¢å¼• + oldCapï¼‰ã€‚ è¿™æ ·å°±é¿å…äº† hashCode çš„é‡æ–°è®¡ç®—ï¼Œå¤§å¤§æå‡äº†æ‰©å®¹çš„æ€§èƒ½ã€‚ æ‰€ä»¥ï¼Œå“ªæ€•æœ‰å‡ åä¸‡æ¡æ•°æ®ï¼Œå¯èƒ½åªæœ‰ä¸€åŠçš„æ•°æ®æ‰éœ€è¦ç§»åŠ¨åˆ°æ–°ä½ç½®ã€‚å¦å¤–ï¼Œä½è¿ç®—çš„è®¡ç®—é€Ÿåº¦éå¸¸å¿«ï¼Œå› æ­¤ï¼Œå°½ç®¡æ‰©å®¹æ“ä½œæ¶‰åŠåˆ°éå†æ•´ä¸ªå“ˆå¸Œè¡¨å¹¶å¯¹æ¯ä¸ªèŠ‚ç‚¹è¿›è¡Œåˆ¤æ–­ï¼Œä½†è¿™éƒ¨åˆ†æ“ä½œçš„è®¡ç®—æˆæœ¬æ˜¯ç›¸å¯¹è¾ƒä½çš„ã€‚ 22.JDK 8 å¯¹ HashMap åšäº†å“ªäº›ä¼˜åŒ–å‘¢ï¼Ÿâ‘ ã€åº•å±‚æ•°æ®ç»“æ„ç”±æ•°ç»„ + é“¾è¡¨æ”¹æˆäº†æ•°ç»„ + é“¾è¡¨æˆ–çº¢é»‘æ ‘çš„ç»“æ„ã€‚ å¦‚æœå¤šä¸ªé”®æ˜ å°„åˆ°äº†åŒä¸€ä¸ªå“ˆå¸Œå€¼ï¼Œé“¾è¡¨ä¼šå˜å¾—å¾ˆé•¿ï¼Œåœ¨æœ€åçš„æƒ…å†µä¸‹ï¼Œå½“æ‰€æœ‰çš„é”®éƒ½æ˜ å°„åˆ°åŒä¸€ä¸ªæ¡¶ä¸­æ—¶ï¼Œæ€§èƒ½ä¼šé€€åŒ–åˆ° O(n)ï¼Œè€Œçº¢é»‘æ ‘çš„æ—¶é—´å¤æ‚åº¦æ˜¯ O(logn)ã€‚ â‘¡ã€é“¾è¡¨çš„æ’å…¥æ–¹å¼ç”±å¤´æ’æ³•æ”¹ä¸ºäº†å°¾æ’æ³•ã€‚å¤´æ’æ³•åœ¨æ‰©å®¹åå®¹æ˜“æ”¹å˜åŸæ¥é“¾è¡¨çš„é¡ºåºã€‚ â‘¢ã€æ‰©å®¹çš„æ—¶æœºç”±æ’å…¥æ—¶åˆ¤æ–­æ”¹ä¸ºæ’å…¥ååˆ¤æ–­ï¼Œè¿™æ ·å¯ä»¥é¿å…åœ¨æ¯æ¬¡æ’å…¥æ—¶éƒ½è¿›è¡Œä¸å¿…è¦çš„æ‰©å®¹æ£€æŸ¥ï¼Œå› ä¸ºæœ‰å¯èƒ½æ’å…¥åä»ç„¶ä¸éœ€è¦æ‰©å®¹ã€‚ â‘£ã€å“ˆå¸Œæ‰°åŠ¨ç®—æ³•ä¹Ÿè¿›è¡Œäº†ä¼˜åŒ–ã€‚JDK 7 æ˜¯é€šè¿‡å¤šæ¬¡ç§»ä½å’Œå¼‚æˆ–è¿ç®—æ¥å®ç°çš„ã€‚ JDK 8 è®© hash å€¼çš„é«˜ 16 ä½å’Œä½ 16 ä½è¿›è¡Œäº†å¼‚æˆ–è¿ç®—ï¼Œè®©é«˜ä½çš„ä¿¡æ¯ä¹Ÿèƒ½å‚ä¸åˆ°ä½ä½çš„è®¡ç®—ä¸­ï¼Œè¿™æ ·å¯ä»¥æå¤§ç¨‹åº¦ä¸Šå‡å°‘å“ˆå¸Œç¢°æ’ã€‚ 23.ä½ èƒ½è‡ªå·±è®¾è®¡å®ç°ä¸€ä¸ª HashMap å—ï¼Ÿ(æ‰‹æ’•HashMap)å¯ä»¥ï¼Œæˆ‘å…ˆè¯´ä¸€ä¸‹æ•´ä½“çš„è®¾è®¡æ€è·¯ï¼š ç¬¬ä¸€æ­¥ï¼Œå®ç°ä¸€ä¸ª hash å‡½æ•°ï¼Œå¯¹é”®çš„ hashCode è¿›è¡Œæ‰°åŠ¨ã€‚ ç¬¬äºŒæ­¥ï¼Œå®ç°ä¸€ä¸ªæ‹‰é“¾æ³•çš„æ–¹æ³•æ¥è§£å†³å“ˆå¸Œå†²çªã€‚ ç¬¬ä¸‰æ­¥ï¼Œæ‰©å®¹åï¼Œé‡æ–°è®¡ç®—å“ˆå¸Œå€¼ï¼Œå°†å…ƒç´ æ”¾åˆ°æ–°çš„æ•°ç»„ä¸­ã€‚ å®Œæ•´ä»£ç ï¼š 24.ğŸŒŸHashMap æ˜¯çº¿ç¨‹å®‰å…¨çš„å—ï¼Ÿæ¨èé˜…è¯»ï¼šHashMap è¯¦è§£ HashMap ä¸æ˜¯çº¿ç¨‹å®‰å…¨çš„ï¼Œä¸»è¦æœ‰ä»¥ä¸‹å‡ ä¸ªé—®é¢˜ï¼š â‘ ã€å¤šçº¿ç¨‹ä¸‹æ‰©å®¹ä¼šæ­»å¾ªç¯ã€‚JDK7 ä¸­çš„ HashMap ä½¿ç”¨çš„æ˜¯å¤´æ’æ³•æ¥å¤„ç†é“¾è¡¨ï¼Œåœ¨å¤šçº¿ç¨‹ç¯å¢ƒä¸‹æ‰©å®¹ä¼šå‡ºç°ç¯å½¢é“¾è¡¨ï¼Œé€ æˆæ­»å¾ªç¯ã€‚ ä¸è¿‡ï¼ŒJDK 8 æ—¶é€šè¿‡å°¾æ’æ³•ä¿®å¤äº†è¿™ä¸ªé—®é¢˜ï¼Œæ‰©å®¹æ—¶ä¼šä¿æŒé“¾è¡¨åŸæ¥çš„é¡ºåºã€‚ â‘¡ã€å¤šçº¿ç¨‹åœ¨è¿›è¡Œ put å…ƒç´ çš„æ—¶å€™ï¼Œå¯èƒ½ä¼šå¯¼è‡´å…ƒç´ ä¸¢å¤±ã€‚å› ä¸ºè®¡ç®—å‡ºæ¥çš„ä½ç½®å¯èƒ½ä¼šè¢«å…¶ä»–çº¿ç¨‹è¦†ç›–æ‰ï¼Œæ¯”å¦‚è¯´ä¸€ä¸ªå¿åŸ put 3 çš„æ—¶å€™ï¼Œå¦å¤–ä¸€ä¸ªçº¿ç¨‹ put äº† 7ï¼Œå°±æŠŠ 3 ç»™å¼„ä¸¢äº†ã€‚ â‘¢ã€put å’Œ get å¹¶å‘æ—¶ï¼Œå¯èƒ½å¯¼è‡´ get ä¸º nullã€‚çº¿ç¨‹ 1 æ‰§è¡Œ put æ—¶ï¼Œå› ä¸ºå…ƒç´ ä¸ªæ•°è¶…å‡ºé˜ˆå€¼è€Œæ‰©å®¹ï¼Œçº¿ç¨‹ 2 æ­¤æ—¶æ‰§è¡Œ getï¼Œå°±æœ‰å¯èƒ½å‡ºç°è¿™ä¸ªé—®é¢˜ã€‚ å› ä¸ºçº¿ç¨‹ 1 æ‰§è¡Œå®Œ table newTab ä¹‹åï¼Œçº¿ç¨‹ 2 ä¸­çš„ table å·²ç»å‘ç”Ÿäº†æ”¹å˜ï¼Œæ¯”å¦‚è¯´ç´¢å¼• 3 çš„é”®å€¼å¯¹ç§»åŠ¨åˆ°äº†ç´¢å¼• 7 çš„ä½ç½®ï¼Œæ­¤æ—¶çº¿ç¨‹ 2 å» get ç´¢å¼• 3 çš„å…ƒç´ å°± get ä¸åˆ°äº†ã€‚ 25.ğŸŒŸæ€ä¹ˆè§£å†³ HashMap çº¿ç¨‹ä¸å®‰å…¨çš„é—®é¢˜å‘¢ï¼Ÿåœ¨æ—©æœŸçš„ JDK ç‰ˆæœ¬ä¸­ï¼Œå¯ä»¥ç”¨ Hashtable æ¥ä¿è¯çº¿ç¨‹å®‰å…¨ã€‚Hashtable åœ¨æ–¹æ³•ä¸ŠåŠ äº†Â synchronized å…³é”®å­—ã€‚ å¦å¤–ï¼Œå¯ä»¥é€šè¿‡ Collections.synchronizedMap æ–¹æ³•è¿”å›ä¸€ä¸ªçº¿ç¨‹å®‰å…¨çš„ Mapï¼Œå†…éƒ¨æ˜¯é€šè¿‡ synchronized å¯¹è±¡é”æ¥ä¿è¯çº¿ç¨‹å®‰å…¨çš„ï¼Œæ¯”åœ¨æ–¹æ³•ä¸Šç›´æ¥åŠ  synchronized å…³é”®å­—æ›´è½»é‡çº§ã€‚ æ›´ä¼˜é›…çš„è§£å†³æ–¹æ¡ˆæ˜¯ä½¿ç”¨å¹¶å‘å·¥å…·åŒ…ä¸‹çš„Â ConcurrentHashMapï¼Œä½¿ç”¨äº†CAS+Â synchronized å…³é”®å­—æ¥ä¿è¯çº¿ç¨‹å®‰å…¨ã€‚(åˆ†æ®µé”+CAS) 26.HashMap å†…éƒ¨èŠ‚ç‚¹æ˜¯æœ‰åºçš„å—ï¼Ÿæ— åºçš„ï¼Œæ ¹æ® hash å€¼éšæœºæ’å…¥ã€‚ 27.è®²è®² LinkedHashMap æ€ä¹ˆå®ç°æœ‰åºçš„ï¼ŸLinkedHashMap åœ¨ HashMap çš„åŸºç¡€ä¸Šç»´æŠ¤äº†ä¸€ä¸ªåŒå‘é“¾è¡¨ï¼Œé€šè¿‡ before å’Œ after æ ‡è¯†å‰ç½®èŠ‚ç‚¹å’Œåç½®èŠ‚ç‚¹ã€‚ ä»è€Œå®ç°æ’å…¥çš„é¡ºåºæˆ–è®¿é—®é¡ºåºã€‚ 28.è®²è®² TreeMap æ€ä¹ˆå®ç°æœ‰åºçš„ï¼ŸTreeMap é€šè¿‡ key çš„æ¯”è¾ƒå™¨æ¥å†³å®šå…ƒç´ çš„é¡ºåºï¼Œå¦‚æœæ²¡æœ‰æŒ‡å®šæ¯”è¾ƒå™¨ï¼Œé‚£ä¹ˆ key å¿…é¡»å®ç°Â Comparable æ¥å£ã€‚ TreeMap çš„åº•å±‚æ˜¯çº¢é»‘æ ‘ï¼Œçº¢é»‘æ ‘æ˜¯ä¸€ç§è‡ªå¹³è¡¡çš„äºŒå‰æŸ¥æ‰¾æ ‘ï¼Œæ¯ä¸ªèŠ‚ç‚¹éƒ½å¤§äºå…¶å·¦å­æ ‘ä¸­çš„ä»»ä½•èŠ‚ç‚¹ï¼Œå°äºå…¶å³å­èŠ‚ç‚¹æ ‘ç§çš„ä»»ä½•èŠ‚ç‚¹ã€‚ æ’å…¥æˆ–è€…åˆ é™¤å…ƒç´ æ—¶é€šè¿‡æ—‹è½¬å’ŒæŸ“è‰²æ¥ä¿æŒæ ‘çš„å¹³è¡¡ã€‚ æŸ¥æ‰¾çš„æ—¶å€™ä»æ ¹èŠ‚ç‚¹å¼€å§‹ï¼Œåˆ©ç”¨äºŒå‰æŸ¥æ‰¾æ ‘çš„ç‰¹ç‚¹ï¼Œé€æ­¥å‘å·¦å­æ ‘æˆ–è€…å³å­æ ‘é€’å½’æŸ¥æ‰¾ï¼Œç›´åˆ°æ‰¾åˆ°ç›®æ ‡å…ƒç´ ã€‚ 29.TreeMap å’Œ HashMap çš„åŒºåˆ«â‘ ã€HashMap æ˜¯åŸºäºæ•°ç»„+é“¾è¡¨+çº¢é»‘æ ‘å®ç°çš„ï¼Œput å…ƒç´ çš„æ—¶å€™ä¼šå…ˆè®¡ç®— key çš„å“ˆå¸Œå€¼ï¼Œç„¶åé€šè¿‡å“ˆå¸Œå€¼è®¡ç®—å‡ºå…ƒç´ åœ¨æ•°ç»„ä¸­çš„å­˜æ”¾ä¸‹æ ‡ï¼Œç„¶åå°†å…ƒç´ æ’å…¥åˆ°æŒ‡å®šçš„ä½ç½®ï¼Œå¦‚æœå‘ç”Ÿå“ˆå¸Œå†²çªï¼Œä¼šä½¿ç”¨é“¾è¡¨æ¥è§£å†³ï¼Œå¦‚æœé“¾è¡¨é•¿åº¦å¤§äº 8ï¼Œä¼šè½¬æ¢ä¸ºçº¢é»‘æ ‘ã€‚ â‘¡ã€TreeMap æ˜¯åŸºäºçº¢é»‘æ ‘å®ç°çš„ï¼Œput å…ƒç´ çš„æ—¶å€™ä¼šå…ˆåˆ¤æ–­æ ¹èŠ‚ç‚¹æ˜¯å¦ä¸ºç©ºï¼Œå¦‚æœä¸ºç©ºï¼Œç›´æ¥æ’å…¥åˆ°æ ¹èŠ‚ç‚¹ï¼Œå¦‚æœä¸ä¸ºç©ºï¼Œä¼šé€šè¿‡ key çš„æ¯”è¾ƒå™¨æ¥åˆ¤æ–­å…ƒç´ åº”è¯¥æ’å…¥åˆ°å·¦å­æ ‘è¿˜æ˜¯å³å­æ ‘ã€‚ åœ¨æ²¡æœ‰å‘ç”Ÿå“ˆå¸Œå†²çªçš„æƒ…å†µä¸‹ï¼ŒHashMap çš„æŸ¥æ‰¾æ•ˆç‡æ˜¯ O(1)ã€‚é€‚ç”¨äºæŸ¥æ‰¾æ“ä½œæ¯”è¾ƒé¢‘ç¹çš„åœºæ™¯ã€‚ TreeMap çš„æŸ¥æ‰¾æ•ˆç‡æ˜¯ O(logn)ã€‚å¹¶ä¸”ä¿è¯äº†å…ƒç´ çš„é¡ºåºï¼Œå› æ­¤é€‚ç”¨äºéœ€è¦å¤§é‡èŒƒå›´æŸ¥æ‰¾æˆ–è€…æœ‰åºéå†çš„åœºæ™¯ã€‚ Set30.è®²è®² HashSet çš„åº•å±‚å®ç°ï¼ŸHashSet æ˜¯ç”± HashMap å®ç°çš„ï¼Œåªä¸è¿‡å€¼ç”±ä¸€ä¸ªå›ºå®šçš„ Object å¯¹è±¡å¡«å……ï¼Œè€Œé”®ç”¨äºæ“ä½œã€‚ public class HashSetE extends AbstractSetE implements SetE, Cloneable, java.io.Serializable static final long serialVersionUID = -5024744406713321676L; private transient HashMapE,Object map; // Dummy value to associate with an Object in the backing Map private static final Object PRESENT = new Object(); // â€¦â€¦ å®é™…å¼€å‘ä¸­ï¼ŒHashSet å¹¶ä¸å¸¸ç”¨ï¼Œæ¯”å¦‚ï¼Œå¦‚æœæˆ‘ä»¬éœ€è¦æŒ‰ç…§é¡ºåºå­˜å‚¨ä¸€ç»„å…ƒç´ ï¼Œé‚£ä¹ˆ ArrayList å’Œ LinkedList æ›´é€‚åˆï¼›å¦‚æœæˆ‘ä»¬éœ€è¦å­˜å‚¨é”®å€¼å¯¹å¹¶æ ¹æ®é”®è¿›è¡ŒæŸ¥æ‰¾ï¼Œé‚£ä¹ˆ HashMap å¯èƒ½æ›´é€‚åˆã€‚ HashSet ä¸»è¦ç”¨äºå»é‡ï¼Œæ¯”å¦‚ï¼Œæˆ‘ä»¬éœ€è¦ç»Ÿè®¡ä¸€ç¯‡æ–‡ç« ä¸­æœ‰å¤šå°‘ä¸ªä¸é‡å¤çš„å•è¯ï¼Œå°±å¯ä»¥ä½¿ç”¨ HashSet æ¥å®ç°ã€‚ // åˆ›å»ºä¸€ä¸ª HashSet å¯¹è±¡HashSetString set = new HashSet();// æ·»åŠ å…ƒç´ set.add(æ²‰é»˜);set.add(ç‹äºŒ);set.add(é™ˆæ¸…æ‰¬);set.add(æ²‰é»˜);// è¾“å‡º HashSet çš„å…ƒç´ ä¸ªæ•°System.out.println(HashSet size: + set.size()); // output: 3// éå† HashSetfor (String s : set) System.out.println(s); HashSet ä¼šè‡ªåŠ¨å»é‡ï¼Œå› ä¸ºå®ƒæ˜¯ç”¨ HashMap å®ç°çš„ï¼ŒHashMap çš„é”®æ˜¯å”¯ä¸€çš„ï¼Œç›¸åŒé”®ä¼šè¦†ç›–æ‰åŸæ¥çš„é”®ï¼Œäºæ˜¯ç¬¬äºŒæ¬¡ add ä¸€ä¸ªç›¸åŒé”®çš„å…ƒç´ ä¼šç›´æ¥è¦†ç›–æ‰ç¬¬ä¸€æ¬¡çš„é”®ã€‚ HashSet å’Œ ArrayList çš„åŒºåˆ«ArrayList æ˜¯åŸºäºåŠ¨æ€æ•°ç»„å®ç°çš„ï¼ŒHashSet æ˜¯åŸºäº HashMap å®ç°çš„ã€‚ ArrayList å…è®¸é‡å¤å…ƒç´ å’Œ null å€¼ï¼Œå¯ä»¥æœ‰å¤šä¸ªç›¸åŒçš„å…ƒç´ ï¼›HashSet ä¿è¯æ¯ä¸ªå…ƒç´ å”¯ä¸€ï¼Œä¸å…è®¸é‡å¤å…ƒç´ ï¼ŒåŸºäºå…ƒç´ çš„ hashCode å’Œ equals æ–¹æ³•æ¥ç¡®å®šå…ƒç´ çš„å”¯ä¸€æ€§ã€‚ ArrayList ä¿æŒå…ƒç´ çš„æ’å…¥é¡ºåºï¼Œå¯ä»¥é€šè¿‡ç´¢å¼•è®¿é—®å…ƒç´ ï¼›HashSet ä¸ä¿è¯å…ƒç´ çš„é¡ºåºï¼Œå…ƒç´ çš„å­˜å‚¨é¡ºåºä¾èµ–äºå“ˆå¸Œç®—æ³•ï¼Œå¹¶ä¸”å¯èƒ½éšç€å…ƒç´ çš„æ·»åŠ æˆ–åˆ é™¤è€Œæ”¹å˜ã€‚ HashSet æ€ä¹ˆåˆ¤æ–­å…ƒç´ é‡å¤ï¼Œé‡å¤äº†æ˜¯å¦ putHashSet çš„ add æ–¹æ³•æ˜¯é€šè¿‡è°ƒç”¨ HashMap çš„ put æ–¹æ³•å®ç°çš„ï¼š public boolean add(E e) return map.put(e, PRESENT)==null; æ‰€ä»¥ HashSet åˆ¤æ–­å…ƒç´ é‡å¤çš„é€»è¾‘åº•å±‚ä¾ç„¶æ˜¯ HashMap çš„åº•å±‚é€»è¾‘ï¼š HashMap åœ¨æ’å…¥å…ƒç´ æ—¶ï¼Œé€šå¸¸éœ€è¦ä¸‰æ­¥ï¼š ç¬¬ä¸€æ­¥ï¼Œé€šè¿‡ hash æ–¹æ³•è®¡ç®— key çš„å“ˆå¸Œå€¼ã€‚ static final int hash(Object key) int h; return (key == null) ? 0 : (h = key.hashCode()) ^ (h 16); ç¬¬äºŒæ­¥ï¼Œæ•°ç»„è¿›è¡Œç¬¬ä¸€æ¬¡æ‰©å®¹ã€‚ if ((tab = table) == null || (n = tab.length) == 0) n = (tab = resize()).length; ç¬¬ä¸‰æ­¥ï¼Œæ ¹æ®å“ˆå¸Œå€¼è®¡ç®— key åœ¨æ•°ç»„ä¸­çš„ä¸‹æ ‡ï¼Œå¦‚æœå¯¹åº”ä¸‹æ ‡æ­£å¥½æ²¡æœ‰å­˜æ”¾æ•°æ®ï¼Œåˆ™ç›´æ¥æ’å…¥ã€‚ if ((p = tab[i = (n - 1) hash]) == null) tab[i] = newNode(hash, key, value, null); å¦‚æœå¯¹åº”ä¸‹æ ‡å·²ç»æœ‰æ•°æ®äº†ï¼Œå°±éœ€è¦åˆ¤æ–­æ˜¯å¦ä¸ºç›¸åŒçš„ keyï¼Œæ˜¯åˆ™è¦†ç›– valueï¼Œå¦åˆ™éœ€è¦åˆ¤æ–­æ˜¯å¦ä¸ºæ ‘èŠ‚ç‚¹ï¼Œæ˜¯åˆ™å‘æ ‘ä¸­æ’å…¥èŠ‚ç‚¹ï¼Œå¦åˆ™å‘é“¾è¡¨ä¸­æ’å…¥æ•°æ®ã€‚ else NodeK,V e; K k; if (p.hash == hash ((k = p.key) == key || (key != null key.equals(k)))) e = p; else if (p instanceof TreeNode) e = ((TreeNodeK,V)p).putTreeVal(this, tab, hash, key, value); else for (int binCount = 0; ; ++binCount) if ((e = p.next) == null) p.next = newNode(hash, key, value, null); if (binCount = TREEIFY_THRESHOLD - 1) // -1 for 1st treeifyBin(tab, hash); break; if (e.hash == hash ((k = e.key) == key || (key != null key.equals(k)))) break; p = e; ä¹Ÿå°±æ˜¯è¯´ï¼ŒHashSet é€šè¿‡å…ƒç´ çš„å“ˆå¸Œå€¼æ¥åˆ¤æ–­å…ƒç´ æ˜¯å¦é‡å¤ï¼Œå¦‚æœé‡å¤äº†ï¼Œä¼šè¦†ç›–åŸæ¥çš„å€¼ã€‚ if (e != null) // existing mapping for key V oldValue = e.value; if (!onlyIfAbsent || oldValue == null) e.value = value; afterNodeAccess(e); return oldValue;","tags":["åŸºç¡€","Java"],"categories":["Javaé—®ç­”ç¬”è®°"]},{"title":"2025.8.1å­¦ä¹ æ—¥è®°","path":"/2025/08/01/å­¦ä¹ æ—¥è®°25å¹´8æœˆ/2025.8.1å­¦ä¹ ç¬”è®°/","content":"ä»Šæ—¥å­¦ä¹ å†…å®¹3DGSæ ‡æ³¨æ•°æ® åŠ›æ‰£æ¯æ—¥ä¸€é¢˜ä¸€é“dpæ¨è¾‰ä¸‰è§’ç®€å•é¢˜.è¡¥ç­¾äº†ä¸‰å¤©çš„é¢˜. javaé›†åˆæ¡†æ¶ç¯‡130 é¡¹ç›®å®ç°äº†å¾®ä¿¡æ‰«ç è¾“å…¥éªŒè¯ç çš„ç™»å½•æ–¹å¼.æœåŠ¡å·çš„äºŒç»´ç : ä»£ç éšæƒ³å½•å…­é“dpé¢˜. ç”Ÿæ´»ç¯‡æ™šä¸Šå¥èº«","tags":["åŸºç¡€","æ—¥è®°","leetcode","é¡¹ç›®"],"categories":["å­¦ä¹ æ—¥è®°","2025-08"]},{"title":"2025.7.31å­¦ä¹ æ—¥è®°","path":"/2025/07/31/å­¦ä¹ æ—¥è®°25å¹´7æœˆ/2025.7.31å­¦ä¹ ç¬”è®°/","content":"ä»Šæ—¥å­¦ä¹ å†…å®¹3DGSåšæ˜å¤©æ±‡æŠ¥çš„PPT åŠ›æ‰£æ¯æ—¥ä¸€é¢˜ä¸€é“é€‰æˆ–ä¸é€‰çš„é¢˜ç›®. JavaSEå…«è‚¡5656 å®Œç»“ Rediså…«è‚¡057 é¡¹ç›®å®ç°äº†å¾®ä¿¡å…¬ä¼—å·å’ŒæœåŠ¡å™¨åç«¯çš„è¿æ¥,ç„¶åå¯ä»¥å®ç°è‡ªåŠ¨å›å¤. ä»£ç éšæƒ³å½•å…­é“dpé¢˜. ç”Ÿæ´»ç¯‡æ™šä¸Šå¥èº«ä¸»è¦æ˜¯ç»ƒè…¹,ç„¶ååšæ‹‰ä¼¸,å¼ºåº¦å¾ˆä½.","tags":["åŸºç¡€","æ—¥è®°","leetcode","é¡¹ç›®"],"categories":["å­¦ä¹ æ—¥è®°","2025-07"]},{"title":"2025.7.30å­¦ä¹ æ—¥è®°","path":"/2025/07/30/å­¦ä¹ æ—¥è®°25å¹´7æœˆ/2025.7.30å­¦ä¹ ç¬”è®°/","content":"ä»Šæ—¥å­¦ä¹ å†…å®¹3DGSåšæ˜å¤©æ±‡æŠ¥çš„PPT åŠ›æ‰£æ¯æ—¥ä¸€é¢˜ä¸€é“é€‰æˆ–ä¸é€‰çš„é¢˜ç›®. JavaSEå…«è‚¡3956 Rediså…«è‚¡057 ä»£ç éšæƒ³å½•ç”Ÿæ´»ç¯‡æ™šä¸Šå¥èº«ç»ƒèƒŒ,å¼ºåº¦é€‚ä¸­.","tags":["åŸºç¡€","æ—¥è®°","leetcode","é¡¹ç›®"],"categories":["å­¦ä¹ æ—¥è®°","2025-07"]},{"title":"Natappå†…ç½‘ç©¿é€ä½¿ç”¨","path":"/2025/07/30/é¡¹ç›®ç¬”è®°/Natapp/","content":"ç”±äºéœ€è¦ä½¿ç”¨å¾®ä¿¡æœåŠ¡å·æ¥è½¬å‘è¯·æ±‚,æ‰€ä»¥éœ€è¦å°†åç«¯çš„æ¥å£æš´éœ²å‡ºæ¥,ä½†åŸæœ¬åœ¨devæœ¬åœ°è¿›è¡Œå¼€å‘,æ‰€ä»¥å°±éœ€è¦ä½¿ç”¨å†…ç½‘ç©¿é€çš„æ–¹å¼æ¥å®ç°. Natappé¡¹ç›®åœ°å€ é¦–å…ˆè¿›è¡Œæ³¨å†Œ,ç„¶åä¸‹è½½å¯¹åº”çš„å®¢æˆ·ç«¯.æˆ‘ä¸‹è½½çš„æ˜¯Macçš„å®¢æˆ·ç«¯,ä¸‹è½½å®Œæˆå,cdåˆ°ä¸‹è½½(~Downloads)çš„ç›®å½•,æ‰§è¡Œä»¥ä¸‹å‘½ä»¤: chmod +x natapp ç„¶åé€šè¿‡ä»¥ä¸‹å‘½ä»¤å¯åŠ¨: ./natapp -authtoken=xxxx ç„¶ååœ¨ç•Œé¢ä¸­é…ç½®éš§é“,ç„¶åé€‰æ‹©å¥½æœ¬åœ°çš„ç«¯å£(å¯ä»¥å†æ¬¡æ›´æ”¹).ä½†æ˜¯é…ç½®å¥½å,è¿˜éœ€è¦ä¸€ä¸ªäºŒçº§åŸŸå,æ‰€ä»¥è¿˜éœ€è¦é…ç½®äºŒçº§åŸŸå.ç„¶åå¯åŠ¨åå¯ä»¥çœ‹åˆ°å¯ä»¥æ­£å¸¸è¿æ¥åˆ°åç«¯æœåŠ¡äº†.æˆ‘çš„åŸŸåæ˜¯:http://techub.natapp1.cchttps://natapp.cn/tunnel/lists","tags":["é¡¹ç›®","å†…ç½‘ç©¿é€"],"categories":["é¡¹ç›®ç¬”è®°"]},{"title":"2025.7.29å­¦ä¹ æ—¥è®°","path":"/2025/07/29/å­¦ä¹ æ—¥è®°25å¹´7æœˆ/2025.7.29å­¦ä¹ ç¬”è®°/","content":"ä»Šæ—¥å­¦ä¹ å†…å®¹ç»§ç»­åšæ±‡æŠ¥PPT,ä»Šå¤©çŠ¶æ€å¥½ä¸€äº›äº†. è¿™å‘¨æ±‡æŠ¥çš„CityGaussianâ€“å®æ—¶å¤§åœºæ™¯é«˜è´¨é‡çš„3DGSã€‚ æ–‡ç« æå‡ºçš„é—®é¢˜æ˜¯ï¼Œç›®å‰å¤§å¤šæ•°çš„3DGSéƒ½ä¸“æ³¨åœ¨å°å‹åœºæ™¯æˆ–è€…ç‰©ä½“çš„é‡å»ºä¸Šï¼Œç„¶è€Œå½“é‡å»ºçš„è§„æ¨¡å°ºåº¦å˜å¤§ä¹‹åï¼Œç°æœ‰çš„3DGSæ–¹æ³•ä¼šå‡ºç°æ˜¾å­˜çˆ†ç‚¸å¹¶ä¸”å¯¼è‡´æ¸²æŸ“æ—¶å¡é¡¿,æ€§èƒ½å‡ºç°éå¸¸ä¸¥é‡çš„ä¸‹é™ã€‚ æ‰€ä»¥è¿™ç¯‡æ–‡ç« é’ˆå¯¹ä¸Šè¿°é—®é¢˜æå‡ºäº†é’ˆå¯¹å¤§è§„æ¨¡åœºæ™¯çš„3dgsæ–¹æ³•ï¼Œæ–‡ç« çš„æ ¸å¿ƒæ€æƒ³æ˜¯æå‡ºäº†ä¸€ç§æœ‰æ•ˆçš„åˆ†æ²»ç­–ç•¥ï¼Œä»¥å¹¶è¡Œæ–¹å¼é‡å»ºå¤§è§„æ¨¡3DGSã€‚åˆ©ç”¨æ‰€æå‡ºçš„LoDç­–ç•¥ä¹Ÿå°±æ˜¯ç»†èŠ‚çš„åˆ†çº§å¤„ç†ï¼Œä»¥æœ€å°çš„è´¨é‡æŸå¤±å®ç°äº†ä¸åŒå°ºåº¦ä¸‹çš„å®æ—¶å¤§è§„æ¨¡åœºæ™¯æ¸²æŸ“ã€‚å¹¶ä¸”ç›®å‰åœ¨æµ‹è¯•ä¸­æ•ˆæœä¼˜äºç›®å‰æœ€å¥½çš„ç®—æ³•ã€‚ è¿™ä¸ªå°±æ˜¯è¿™ç¯‡æ–‡ç« è®­ç»ƒçš„æµç¨‹å›¾ï¼šCityGaussiané¦–å…ˆä¼šè®­ç»ƒä¸€ä¸ªä½åˆ†è¾¨ç‡çš„å…¨å±€å…ˆéªŒï¼Œä¹Ÿå°±æ˜¯å›¾ä¸­è“è‰²çš„ç‚¹äº‘ï¼Œä¸ºåç»­çš„åˆ†å—ä½œä¸ºä¸€ä¸ªåŸå§‹çš„ä¾æ®,ç„¶åå¯¹è¾¹ç•Œè¿›è¡Œçº¦æŸ.ç„¶åç¬¬äºŒæ­¥ï¼Œå°†æ•´ä¸ªåœºæ™¯åˆ†æˆå¤šä¸ªåŒºå—ï¼Œåˆ†å—å¤§å°æ ¹æ®æ˜¾å­˜å¤§å°åŠ¨æ€è°ƒæ•´ï¼Œå¹¶ä¸”å¯¹æ¯ä¸ªåˆ†å—è¿›è¡Œè´Ÿè½½å‡è¡¡ã€‚ç„¶åç¬¬ä¸‰æ­¥ï¼Œå¯¹æ•°æ®è¿›è¡ŒåŠ¨æ€åˆ†é…ï¼ŒåŒ…æ‹¬åŠ¨æ€è¾¹ç•Œ,å‰”é™¤å™ªå£°ç‚¹ç¬¬å››æ­¥æ˜¯æ¯ä¸ªåŒºå—è¿›è¡Œå¹¶è¡Œçš„è®­ç»ƒã€‚ç¬¬äº”æ­¥æ˜¯å°†æ‰€æœ‰åˆ†å—èåˆè¾“å‡ºã€‚ é¦–å…ˆè¿™ä¸ªå°±æ˜¯é¢„å…ˆè®­ç»ƒçš„ä½åˆ†è¾¨ç‡å…¨å±€å›¾,ç›´æ¥åˆ©ç”¨å…¨éƒ¨çš„è§‚æµ‹å›¾è®­ç»ƒcolmapç‚¹è¿›è¡Œ30000æ¬¡è¿­ä»£,ç„¶åç”Ÿæˆä¸€ä¸ªå…¨å±€å‡ ä½•åˆ†å¸ƒçš„ç²—ç•¥çš„æè¿°. ç„¶åå°±æ˜¯å¯¹è¾¹ç•Œè¿›è¡Œçº¦æŸ,å›¾ä¸­ç²‰è‰²æ¡†å¯¹åº”å•ä½ç«‹æ–¹ä½“çš„è¾¹ç•Œï¼Œå…¶å†…éƒ¨ç‚¹äº‘ä¸ºéœ€ç²¾ç»†åŒ–å¤„ç†çš„å‰æ™¯.ç„¶åæ ¹æ®å‰æ™¯çš„å°ºåº¦ç”Ÿæˆå•ä½ç«‹æ–¹ä½“,å°†ç«‹æ–¹ä½“å¤–çš„ç‚¹äº‘è¿›è¡Œéçº¿æ€§å‹ç¼©,æœ€ç»ˆä½¿å‰æ™¯çš„ç‚¹äº‘åˆ†å¸ƒåœ¨0åˆ°1çš„èŒƒå›´,è€Œå…¶ä»–ç‚¹äº‘åˆ™å‹ç¼©åœ¨1åˆ°2çš„èŒƒå›´.ç„¶åå°±å¾—åˆ°äº†å³ä¾§è¿›è¡Œè¾¹ç•Œçº¦æŸçš„å›¾. ç„¶åæ˜¯å¾®è°ƒé˜¶æ®µ,åœ¨è¿™æ—¶ä¼šæ ¹æ®å¦‚å›¾è¿™ä¸¤ä¸ªå…¬å¼,æ¥åˆ¤æ–­éœ€è¦æ¿€æ´»å“ªå‡ ä¸ªåŒºå—,å¯¹éœ€è¦æ¿€æ´»çš„åŒºå—è¿›è¡Œè®­ç»ƒ.B1ä»£è¡¨çš„æ˜¯é€šè¿‡è®¡ç®—ç§»é™¤è¯¥åŒºå—å‰åçš„SSIMæŒ‡æ ‡çš„å·®å¼‚ï¼Œåˆ¤æ–­è¯¥åŒºå—æ˜¯å¦æ˜¾è‘—å½±å“å½“å‰è§†è§’çš„æ¸²æŸ“è´¨é‡.ç„¶åB2ä»£è¡¨é€šè¿‡ç›¸æœºæ‰€åœ¨ä½ç½®,æ£€æŸ¥ç›¸æœºä½ç½®æ˜¯å¦ä½äºåŒºå—çš„é¢„è®¾3Dè¾¹ç•Œå†…. ç„¶åæ˜¯æ¸²æŸ“é˜¶æ®µ,ä¼šå°†åœºæ™¯è¿›è¡Œç»†èŠ‚åˆ†çº§,æ¯ä¸ªåŒºå—éƒ½ä¼šæœ‰ä¸‰ä¸ªä¸åŒç»†èŠ‚ç¨‹åº¦çš„å±‚çº§,å¯¹äºæ›´è¿‘çš„åŒºå—,ä½¿ç”¨æ›´åŠ ç»†è‡´çš„å±‚çº§,å¯¹äºæ›´é€‰çš„åŒºå—,é€‰æ‹©æ›´åŠ ç²—ç•¥çš„åŒºå—.å¹¶ä¸”ç”±äºæ¯ä¸ªåŒºå—çš„è¾¹ç•Œå¹¶ä¸æ˜¯å›ºå®šçš„,å¹¶ä¸”åœ¨è®­ç»ƒè¿‡ç¨‹ä¸­,ä¼šå‡ºç°ä¸€äº›å™ªç‚¹æˆä¸ºåŒºå—çš„è¾¹ç•Œ,æ‰€ä»¥ä¼šé€šè¿‡ä¸‹é¢çš„å…¬å¼æ¥å»é™¤è¿™äº›è¯¯å·®.è¿™ä¸ªMADä»£è¡¨ä¸­ä½æ•°ç»å¯¹åå·®,ç„¶åç¬¬äºŒè¡Œä¿®æ­£åæœ€å°è¾¹ç•Œ,å‰”é™¤è¿œä½äºæ­£å¸¸èŒƒå›´çš„å¼‚å¸¸å€¼.ç„¶åæœ€å¤§ä¸Šç•ŒåŒç†. ç„¶åè¿™æ˜¯æ¸²æŸ“çš„æ•ˆæœå›¾,å¯ä»¥çœ‹åˆ°åœ¨è¿™ç§å¤§åœºæ™¯ä¸‹,æœ¬æ–‡çš„æ–¹æ³•å®ç°äº†å¾ˆå¥½çš„æ¸²æŸ“æ•ˆæœ. å¯ä»¥çœ‹åˆ°åœ¨ä¸åŒæµ‹è¯•æ•°æ®ä¸‹,ç›¸æ¯”åŸç‰ˆ3DGS,æœ¬æ–‡çš„æ–¹æ³•çš„æ¸²æŸ“è´¨é‡éƒ½æœ‰äº†å¾ˆå¤§çš„æå‡. è¿™ä¸ªå›¾æ ‡ä»£è¡¨ä½¿ç”¨ä¸åŒçš„å±‚æ¬¡ç­–ç•¥ä¸‹,æ¸²æŸ“é€Ÿåº¦çš„å¯¹æ¯”.çº¢è‰²æŠ˜çº¿æ˜¯æœ¬æ–‡çš„å¤šå±‚çº§æ¸²æŸ“ç­–ç•¥,å¯ä»¥ä¿è¯è´¨é‡çš„åŒæ—¶ä¿æŒè¾ƒé«˜çš„æ¸²æŸ“é€Ÿåº¦. ä¸Šé¢çš„è¡¨æ˜¯æ–‡ç« åšçš„æ¶ˆèå®éªŒ,ç¬¬ä¸‰è¡Œæ˜¯ä¸ä½¿ç”¨è¾¹ç•Œæ”¶ç¼©çš„æƒ…å†µä¸‹,ç¬¬å››è¡Œæ˜¯æ²¡æœ‰å»é™¤è¾¹ç•Œå™ªå£°çš„æƒ…å†µ,è¿™ä¸¤ä¸ªéƒ¨åˆ†å¯¹è´¨é‡éƒ½æœ‰å½±å“.ä¸‹é¢çš„è¡¨æ ¼æ˜¯ä¸åŒçš„åˆ†å—ç­–ç•¥å¯¹æ¸²æŸ“è´¨é‡çš„å½±å“,å¯ä»¥çœ‹åˆ°åŒºå—è¶Šå¤§,è´¨é‡è¶Šé«˜,ä½†æ˜¯æ¸²æŸ“é€Ÿåº¦è¶Šæ…¢. 3DGSåšæ˜å¤©æ±‡æŠ¥çš„PPT åŠ›æ‰£æ¯æ—¥ä¸€é¢˜ä¸€é“é€‰æˆ–ä¸é€‰çš„é¢˜ç›®. JavaSEå…«è‚¡3956 Rediså…«è‚¡057 ä»£ç éšæƒ³å½•ç”Ÿæ´»ç¯‡","tags":["åŸºç¡€","æ—¥è®°","leetcode","é¡¹ç›®"],"categories":["å­¦ä¹ æ—¥è®°","2025-07"]},{"title":"2025.7.28å­¦ä¹ æ—¥è®°","path":"/2025/07/28/å­¦ä¹ æ—¥è®°25å¹´7æœˆ/2025.7.28å­¦ä¹ ç¬”è®°/","content":"ä»Šæ—¥å­¦ä¹ å†…å®¹3DGSåšæ˜å¤©æ±‡æŠ¥çš„PPT åŠ›æ‰£æ¯æ—¥ä¸€é¢˜dfsé€‰æˆ–ä¸é€‰ JavaSEå…«è‚¡3956 Rediså…«è‚¡057 ä»£ç éšæƒ³å½•ç”Ÿæ´»ç¯‡åè‚šå­äº†,ä»Šå¤©æ•ˆç‡å¾ˆä½,ä¼‘æ¯ä¸ºä¸»å§.","tags":["åŸºç¡€","æ—¥è®°","leetcode","é¡¹ç›®"],"categories":["å­¦ä¹ æ—¥è®°","2025-07"]},{"title":"2025.7.26å­¦ä¹ æ—¥è®°","path":"/2025/07/26/å­¦ä¹ æ—¥è®°25å¹´7æœˆ/2025.7.26å­¦ä¹ ç¬”è®°/","content":"ä»Šæ—¥å­¦ä¹ å†…å®¹3DGSåŠ›æ‰£æ¯æ—¥ä¸€é¢˜JavaSEå…«è‚¡3756 Rediså…«è‚¡057 é¡¹ç›®ç¯‡æ³¨å†Œäº†ä¸€ä¸ªå¾®ä¿¡æœåŠ¡å·,ç”¨äºæ‰«ç ç™»å½•. ä»£ç éšæƒ³å½•","tags":["åŸºç¡€","æ—¥è®°","leetcode","é¡¹ç›®"],"categories":["å­¦ä¹ æ—¥è®°","2025-07"]},{"title":"GoåŸºç¡€ç¬”è®°","path":"/2025/07/25/GoåŸºç¡€/GoåŸºç¡€ç¬”è®°/","content":"https://gobyexample-cn.github.io/","tags":["åŸºç¡€","Go"],"categories":["GoåŸºç¡€"]},{"title":"2025.7.25å­¦ä¹ æ—¥è®°","path":"/2025/07/25/å­¦ä¹ æ—¥è®°25å¹´7æœˆ/2025.7.25å­¦ä¹ ç¬”è®°/","content":"ä»Šæ—¥å­¦ä¹ å†…å®¹3DGSä»Šå¤©ä¸»è¦å­¦ä¹ CityGaussianV2è®ºæ–‡.CityGaussianV2ä¸»è¦æ˜¯åœ¨V1çš„åŸºç¡€ä¸Šè¿›è¡Œæ”¹è¿›.1.å‡ ä½•é‡å»ºå¼•æ“ å°†3Dæ¤­çƒå‹æ‰ä¸º2Dåœ†ç›˜ï¼ˆsurfelï¼‰æ–°å¢æ³•å‘é‡çº¦æŸï¼šå¼ºåˆ¶æ‰€æœ‰åœ†ç›˜æœå‘å»ºç­‘è¡¨é¢æ·±åº¦ä¸€è‡´æ€§æŸå¤±ï¼šç”¨Depth-Anything V2æä¾›çš„æ·±åº¦å›¾ç›‘ç£. 2.åŠ¨æ€è®­ç»ƒç³»ç»Ÿå®æ—¶ç›‘æµ‹é«˜æ–¯ç‚¹é•¿å®½æ¯”ï¼šÎ· min(su,sv)max(su,sv)å½“Î· 0.2æ—¶å†»ç»“è¯¥ç‚¹åˆ†è£‚èƒ½åŠ›æœ‰æ•ˆé˜²æ­¢â€èŠéº»ç²’â€ç°è±¡ 3.é«˜æ•ˆå‹ç¼©ç®¡çº¿ç‰¹å¾è’¸é¦ï¼šç›¸é‚»4ç‚¹èåˆä¸º1ç‚¹çƒå½¢è°æ³¢é™ç»´ï¼šSHç³»æ•°ä»48ç»´â†’27ç»´å‘é‡æ ‘å‹ç¼©ï¼šå»ºç«‹8192çº§è§†è§‰å­—å…¸ è¿™ç¯‡V2å±äºæ˜¯åœ¨V1åŸºç¡€ä¸Š,ä¸“é—¨å¯¹åŸå¸‚çº§åˆ«çš„å¤§è§„æ¨¡åœºæ™¯è¿›è¡Œçš„é’ˆå¯¹æ€§ä¼˜åŒ–,å¯¹äºå…¶ä»–åˆ«çš„åœºæ™¯ä¼°è®¡æ•ˆæœä¸ä¼šå¾ˆç†æƒ³,ä½†ä»–çš„å‹ç¼©æ–¹æ³•è¿˜æ˜¯å¯ä»¥å€Ÿé‰´ä¸€éƒ¨åˆ†çš„. åŠ›æ‰£æ¯æ—¥ä¸€é¢˜ä¸€é“ç®€å•é¢˜,éå†å³å¯. JavaSEå…«è‚¡3256 Rediså…«è‚¡057 é¡¹ç›®ç¯‡å­¦ä¹ æ‰«ç ç™»å½•æ–¹é¢çš„çŸ¥è¯†,ç„¶åä¸»è¦åœ¨é…ç½®ç¯å¢ƒ,ç„¶ååšäº†ä¸€ä¸ªæ‰«ç ç™»å½•çš„ç®€å•demo. ç®—æ³•åšäº†ä¸¤é“dpå›°éš¾é¢˜.æ•´ç†äº†çµç¥çš„é¢˜å•.","tags":["åŸºç¡€","æ—¥è®°","leetcode","é¡¹ç›®"],"categories":["å­¦ä¹ æ—¥è®°","2025-07"]},{"title":"çµèŒ¶å±±ç®—æ³•åŸºç¡€ç¬”è®°","path":"/2025/07/25/ç®—æ³•ç¬”è®°/çµèŒ¶å±±ç®—æ³•åŸºç¡€ç¬”è®°/","content":"è½¬è½½è‡ªå¤§ä½¬æ•´ç†çš„é¢˜å•,å¤ªå¼ºäº†ğŸ™Œ : çµèŒ¶å±±è‰¾åºœ åŸºç¡€ç®—æ³•ç²¾è®²Â·é¢˜ç›®æ±‡æ€»å¤§å®¶å¥½ï¼Œæˆ‘æ˜¯ çµèŒ¶å±±è‰¾åºœã€‚ æˆ‘åˆ¶ä½œäº†ä¸€ç³»åˆ—ç®—æ³•æ•™å­¦è§†é¢‘ï¼Œæ•´ç†æˆåˆé›†ã€åŸºç¡€ç®—æ³•ç²¾è®²ã€‘ã€‚ä»¥ä¸‹æ˜¯åˆé›†ä¸­çš„è§†é¢‘é“¾æ¥ã€é…å¥—é¢˜ç›®å’Œä»£ç ï¼Œä»£ç åŒ…å« PythonJavaC++Go ç­‰å¤šç§è¯­è¨€ã€‚ åˆ¶ä½œä¸æ˜“ï¼Œæ¬¢è¿ç‚¹èµï¼Œä¹Ÿæ¬¢è¿è½¬å‘ç»™ä½ çš„æœ‹å‹æˆ–åˆ·é¢˜ç¾¤ï¼ è§†é¢‘ç²¾è®² é¢˜ç›® ä»£ç  å¤‡æ³¨ ç›¸å‘åŒæŒ‡é’ˆ 1 167. ä¸¤æ•°ä¹‹å’Œ II - è¾“å…¥æœ‰åºæ•°ç»„ ä»£ç  15. ä¸‰æ•°ä¹‹å’Œ ä»£ç  åŒ…å«ä¸¤ä¸ªä¼˜åŒ– 2824. ç»Ÿè®¡å’Œå°äºç›®æ ‡çš„ä¸‹æ ‡å¯¹æ•°ç›® ä»£ç  *è¯¾åä½œä¸š 16. æœ€æ¥è¿‘çš„ä¸‰æ•°ä¹‹å’Œ ä»£ç  *è¯¾åä½œä¸š 18. å››æ•°ä¹‹å’Œ ä»£ç  *è¯¾åä½œä¸š 611. æœ‰æ•ˆä¸‰è§’å½¢çš„ä¸ªæ•° ä»£ç  *è¯¾åä½œä¸š ç›¸å‘åŒæŒ‡é’ˆ 2 11. ç››æœ€å¤šæ°´çš„å®¹å™¨ ä»£ç  42. æ¥é›¨æ°´ ä»£ç  é¢å¤–è®²äº†å‰åç¼€åˆ†è§£ 125. éªŒè¯å›æ–‡ä¸² ä»£ç  *è¯¾åä½œä¸š 2105. ç»™æ¤ç‰©æµ‡æ°´ II ä»£ç  *è¯¾åä½œä¸š æ»‘åŠ¨çª—å£ 209. é•¿åº¦æœ€å°çš„å­æ•°ç»„ ä»£ç  æœ€çŸ­ 3. æ— é‡å¤å­—ç¬¦çš„æœ€é•¿å­ä¸² ä»£ç  æœ€é•¿ 713. ä¹˜ç§¯å°äº K çš„å­æ•°ç»„ ä»£ç  æ–¹æ¡ˆæ•° 2958. æœ€å¤š K ä¸ªé‡å¤å…ƒç´ çš„æœ€é•¿å­æ•°ç»„ ä»£ç  *è¯¾åä½œä¸š 2730. æ‰¾åˆ°æœ€é•¿çš„åŠé‡å¤å­å­—ç¬¦ä¸² ä»£ç  *è¯¾åä½œä¸š 2779. æ•°ç»„çš„æœ€å¤§ç¾ä¸½å€¼ ä»£ç  *è¯¾åä½œä¸š 1004. æœ€å¤§è¿ç»­ 1 çš„ä¸ªæ•° III ä»£ç  *è¯¾åä½œä¸š 2962. ç»Ÿè®¡æœ€å¤§å…ƒç´ å‡ºç°è‡³å°‘ K æ¬¡çš„å­æ•°ç»„ ä»£ç  *è¯¾åä½œä¸š 2302. ç»Ÿè®¡å¾—åˆ†å°äº K çš„å­æ•°ç»„æ•°ç›® ä»£ç  *è¯¾åä½œä¸š 1658. å°† x å‡åˆ° 0 çš„æœ€å°æ“ä½œæ•° ä»£ç  *è¯¾åä½œä¸š 1234. æ›¿æ¢å­ä¸²å¾—åˆ°å¹³è¡¡å­—ç¬¦ä¸² ä»£ç  *è¯¾åä½œä¸š 76. æœ€å°è¦†ç›–å­ä¸² ä»£ç  *è¯¾åä½œä¸š äºŒåˆ†æŸ¥æ‰¾ 34. åœ¨æ’åºæ•°ç»„ä¸­æŸ¥æ‰¾å…ƒç´ çš„ç¬¬ä¸€ä¸ªå’Œæœ€åä¸€ä¸ªä½ç½® ä»£ç  ä¸‰ç§å†™æ³• 2529. æ­£æ•´æ•°å’Œè´Ÿæ•´æ•°çš„æœ€å¤§è®¡æ•° ä»£ç  *è¯¾åä½œä¸š 2300. å’’è¯­å’Œè¯æ°´çš„æˆåŠŸå¯¹æ•° ä»£ç  *è¯¾åä½œä¸š 2563. ç»Ÿè®¡å…¬å¹³æ•°å¯¹çš„æ•°ç›® ä»£ç  *è¯¾åä½œä¸š 2080. åŒºé—´å†…æŸ¥è¯¢æ•°å­—çš„é¢‘ç‡ ä»£ç  *è¯¾åä½œä¸š 275. H æŒ‡æ•° II ä»£ç  *è¯¾åä½œä¸š 875. çˆ±åƒé¦™è•‰çš„ç‚ç‚ ä»£ç  *è¯¾åä½œä¸š 2187. å®Œæˆæ—…é€”çš„æœ€å°‘æ—¶é—´ ä»£ç  *è¯¾åä½œä¸š 2861. æœ€å¤§åˆé‡‘æ•° ä»£ç  *è¯¾åä½œä¸š 2439. æœ€å°åŒ–æ•°ç»„ä¸­çš„æœ€å¤§å€¼ ä»£ç  *è¯¾åä½œä¸š 2517. ç¤¼ç›’çš„æœ€å¤§ç”œèœœåº¦ ä»£ç  *è¯¾åä½œä¸š äºŒåˆ†æŸ¥æ‰¾ - å˜å½¢ 162. å¯»æ‰¾å³°å€¼ ä»£ç  153. å¯»æ‰¾æ—‹è½¬æ’åºæ•°ç»„ä¸­çš„æœ€å°å€¼ ä»£ç  33. æœç´¢æ—‹è½¬æ’åºæ•°ç»„ ä»£ç  ä¸¤ç§æ–¹æ³• 74. æœç´¢äºŒç»´çŸ©é˜µ ä»£ç  *è¯¾åä½œä¸š 1901. å¯»æ‰¾å³°å€¼ II ä»£ç  *è¯¾åä½œä¸š 154. å¯»æ‰¾æ—‹è½¬æ’åºæ•°ç»„ä¸­çš„æœ€å°å€¼ II ä»£ç  *è¯¾åä½œä¸š é“¾è¡¨ - åè½¬ç³»åˆ— 206. åè½¬é“¾è¡¨ ä»£ç  92. åè½¬é“¾è¡¨ II ä»£ç  25. K ä¸ªä¸€ç»„ç¿»è½¬é“¾è¡¨ ä»£ç  24. ä¸¤ä¸¤äº¤æ¢é“¾è¡¨ä¸­çš„èŠ‚ç‚¹ ä»£ç  *è¯¾åä½œä¸š 445. ä¸¤æ•°ç›¸åŠ  II ä»£ç  *è¯¾åä½œä¸š 2816. ç¿»å€ä»¥é“¾è¡¨å½¢å¼è¡¨ç¤ºçš„æ•°å­— ä»£ç  *è¯¾åä½œä¸š é“¾è¡¨ - å¿«æ…¢æŒ‡é’ˆ 876. é“¾è¡¨çš„ä¸­é—´ç»“ç‚¹ ä»£ç  141. ç¯å½¢é“¾è¡¨ ä»£ç  142. ç¯å½¢é“¾è¡¨ II ä»£ç  143. é‡æ’é“¾è¡¨ ä»£ç  234. å›æ–‡é“¾è¡¨ ä»£ç  *è¯¾åä½œä¸š é“¾è¡¨ - åˆ é™¤ç³»åˆ— 237. åˆ é™¤é“¾è¡¨ä¸­çš„èŠ‚ç‚¹ ä»£ç  è„‘ç­‹æ€¥è½¬å¼¯ 19. åˆ é™¤é“¾è¡¨çš„å€’æ•°ç¬¬ N ä¸ªç»“ç‚¹ ä»£ç  å‰åæŒ‡é’ˆ 83. åˆ é™¤æ’åºé“¾è¡¨ä¸­çš„é‡å¤å…ƒç´  ä»£ç  82. åˆ é™¤æ’åºé“¾è¡¨ä¸­çš„é‡å¤å…ƒç´  II ä»£ç  203. ç§»é™¤é“¾è¡¨å…ƒç´  ä»£ç  *è¯¾åä½œä¸š 3217. ä»é“¾è¡¨ä¸­ç§»é™¤åœ¨æ•°ç»„ä¸­å­˜åœ¨çš„èŠ‚ç‚¹ ä»£ç  *è¯¾åä½œä¸š 2487. ä»é“¾è¡¨ä¸­ç§»é™¤èŠ‚ç‚¹ ä»£ç  *è¯¾åä½œä¸š äºŒå‰æ ‘ä¸é€’å½’ - æ·±å…¥ç†è§£ 104. äºŒå‰æ ‘çš„æœ€å¤§æ·±åº¦ ä»£ç  ä¸¤ç§æ–¹æ³• 111. äºŒå‰æ ‘çš„æœ€å°æ·±åº¦ ä»£ç  *è¯¾åä½œä¸š 112. è·¯å¾„æ€»å’Œ ä»£ç  *è¯¾åä½œä¸š 129. æ±‚æ ¹èŠ‚ç‚¹åˆ°å¶èŠ‚ç‚¹æ•°å­—ä¹‹å’Œ ä»£ç  *è¯¾åä½œä¸š 1448. ç»Ÿè®¡äºŒå‰æ ‘ä¸­å¥½èŠ‚ç‚¹çš„æ•°ç›® ä»£ç  *è¯¾åä½œä¸š 987. äºŒå‰æ ‘çš„å‚åºéå† ä»£ç  *è¯¾åä½œä¸š äºŒå‰æ ‘ä¸é€’å½’ - çµæ´»è¿ç”¨ 100. ç›¸åŒçš„æ ‘ ä»£ç  101. å¯¹ç§°äºŒå‰æ ‘ ä»£ç  110. å¹³è¡¡äºŒå‰æ ‘ ä»£ç  199. äºŒå‰æ ‘çš„å³è§†å›¾ ä»£ç  226. ç¿»è½¬äºŒå‰æ ‘ ä»£ç  *è¯¾åä½œä¸š 617. åˆå¹¶äºŒå‰æ ‘ ä»£ç  *è¯¾åä½œä¸š 1026. èŠ‚ç‚¹ä¸å…¶ç¥–å…ˆä¹‹é—´çš„æœ€å¤§å·®å€¼ ä»£ç  *è¯¾åä½œä¸š 1080. æ ¹åˆ°å¶è·¯å¾„ä¸Šçš„ä¸è¶³èŠ‚ç‚¹ ä»£ç  *è¯¾åä½œä¸š äºŒå‰æ ‘ä¸é€’å½’ - å‰åºä¸­åºååº 98. éªŒè¯äºŒå‰æœç´¢æ ‘ ä»£ç  ä¸‰ç§æ–¹æ³• 938. äºŒå‰æœç´¢æ ‘çš„èŒƒå›´å’Œ ä»£ç  *è¯¾åä½œä¸š 2476. äºŒå‰æœç´¢æ ‘æœ€è¿‘èŠ‚ç‚¹æŸ¥è¯¢ ä»£ç  *è¯¾åä½œä¸š 230. äºŒå‰æœç´¢æ ‘ä¸­ç¬¬ K å°çš„å…ƒç´  ä»£ç  *è¯¾åä½œä¸š 1373. äºŒå‰æœç´¢å­æ ‘çš„æœ€å¤§é”®å€¼å’Œ ä»£ç  *è¯¾åä½œä¸š 105. ä»å‰åºä¸ä¸­åºéå†åºåˆ—æ„é€ äºŒå‰æ ‘ ä»£ç  *è¯¾åä½œä¸š 106. ä»ä¸­åºä¸ååºéå†åºåˆ—æ„é€ äºŒå‰æ ‘ ä»£ç  *è¯¾åä½œä¸š 889. æ ¹æ®å‰åºå’Œååºéå†æ„é€ äºŒå‰æ ‘ ä»£ç  *è¯¾åä½œä¸š 1110. åˆ ç‚¹æˆæ— ä»£ç  *è¯¾åä½œä¸š äºŒå‰æ ‘ä¸é€’å½’ - æœ€è¿‘å…¬å…±ç¥–å…ˆ 236. äºŒå‰æ ‘çš„æœ€è¿‘å…¬å…±ç¥–å…ˆ ä»£ç  235. äºŒå‰æœç´¢æ ‘çš„æœ€è¿‘å…¬å…±ç¥–å…ˆ ä»£ç  1123. æœ€æ·±å¶èŠ‚ç‚¹çš„æœ€è¿‘å…¬å…±ç¥–å…ˆ ä»£ç  *è¯¾åä½œä¸š äºŒå‰æ ‘ - BFS 102. äºŒå‰æ ‘çš„å±‚åºéå† ä»£ç  ä¸¤ç§å†™æ³• 103. äºŒå‰æ ‘çš„é”¯é½¿å½¢å±‚åºéå† ä»£ç  ä¸¤ç§å†™æ³• 513. æ‰¾æ ‘å·¦ä¸‹è§’çš„å€¼ ä»£ç  107. äºŒå‰æ ‘çš„å±‚åºéå† II ä»£ç  *è¯¾åä½œä¸š 116. å¡«å……æ¯ä¸ªèŠ‚ç‚¹çš„ä¸‹ä¸€ä¸ªå³ä¾§èŠ‚ç‚¹æŒ‡é’ˆ ä»£ç  *è¯¾åä½œä¸š 117. å¡«å……æ¯ä¸ªèŠ‚ç‚¹çš„ä¸‹ä¸€ä¸ªå³ä¾§èŠ‚ç‚¹æŒ‡é’ˆ II ä»£ç  *è¯¾åä½œä¸š 2415. åè½¬äºŒå‰æ ‘çš„å¥‡æ•°å±‚ ä»£ç  *è¯¾åä½œä¸š 2641. äºŒå‰æ ‘çš„å ‚å…„å¼ŸèŠ‚ç‚¹ II ä»£ç  *è¯¾åä½œä¸š å›æº¯ - å­é›†å‹ 17. ç”µè¯å·ç çš„å­—æ¯ç»„åˆ ä»£ç  å¼•å…¥å›æº¯æ¦‚å¿µç”¨ 78. å­é›† ä»£ç  ä¸¤ç§å†™æ³• 131. åˆ†å‰²å›æ–‡ä¸² ä»£ç  ä¸¤ç§å†™æ³• 2698. æ±‚ä¸€ä¸ªæ•´æ•°çš„æƒ©ç½šæ•° ä»£ç  *è¯¾åä½œä¸š å›æº¯ - ç»„åˆå‹ä¸å‰ªæ 77. ç»„åˆ ä»£ç  ä¸¤ç§å†™æ³• 216. ç»„åˆæ€»å’Œ III ä»£ç  ä¸¤ç§å†™æ³• 22. æ‹¬å·ç”Ÿæˆ ä»£ç  ä¸¤ç§å†™æ³• 39. ç»„åˆæ€»å’Œ ä»£ç  *è¯¾åä½œä¸š 93. å¤åŸ IP åœ°å€ ä»£ç  *è¯¾åä½œä¸š å›æº¯ - æ’åˆ—å‹ 46. å…¨æ’åˆ— ä»£ç  ç²¾ç¡®è®¡ç®—æœç´¢æ ‘çš„èŠ‚ç‚¹ä¸ªæ•° 51. N çš‡å ä»£ç  52. N çš‡å II ä»£ç  2850. å°†çŸ³å¤´åˆ†æ•£åˆ°ç½‘æ ¼å›¾çš„æœ€å°‘ç§»åŠ¨æ¬¡æ•° ä»£ç  *è¯¾åä½œä¸š åŠ¨æ€è§„åˆ’ - ä»è®°å¿†åŒ–æœç´¢åˆ°é€’æ¨ 198. æ‰“å®¶åŠ«èˆ ä»£ç  åŒ…å«ç©ºé—´ä¼˜åŒ– 70. çˆ¬æ¥¼æ¢¯ ä»£ç  *è¯¾åä½œä¸š 746. ä½¿ç”¨æœ€å°èŠ±è´¹çˆ¬æ¥¼æ¢¯ ä»£ç  *è¯¾åä½œä¸š 377. ç»„åˆæ€»å’Œ â…£ ä»£ç  *è¯¾åä½œä¸š 2466. ç»Ÿè®¡æ„é€ å¥½å­—ç¬¦ä¸²çš„æ–¹æ¡ˆæ•° ä»£ç  *è¯¾åä½œä¸š 2266. ç»Ÿè®¡æ‰“å­—æ–¹æ¡ˆæ•° ä»£ç  *è¯¾åä½œä¸š 213. æ‰“å®¶åŠ«èˆ II ä»£ç  *è¯¾åä½œä¸š 64. æœ€å°è·¯å¾„å’Œ ä»£ç  *è¯¾åä½œä¸š 0-1 èƒŒåŒ… å®Œå…¨èƒŒåŒ… è‡³å¤šæ°å¥½è‡³å°‘ 494. ç›®æ ‡å’Œ ä»£ç  åŒ…å«ç©ºé—´ä¼˜åŒ– 322. é›¶é’±å…‘æ¢ ä»£ç  åŒ…å«ç©ºé—´ä¼˜åŒ– 2915. å’Œä¸ºç›®æ ‡å€¼çš„æœ€é•¿å­åºåˆ—çš„é•¿åº¦ ä»£ç  *è¯¾åä½œä¸š 416. åˆ†å‰²ç­‰å’Œå­é›† ä»£ç  *è¯¾åä½œä¸š 518. é›¶é’±å…‘æ¢ II ä»£ç  *è¯¾åä½œä¸š 279. å®Œå…¨å¹³æ–¹æ•° ä»£ç  *è¯¾åä½œä¸š æœ€é•¿å…¬å…±å­åºåˆ— LCS 1143. æœ€é•¿å…¬å…±å­åºåˆ— ä»£ç  åŒ…å«ç©ºé—´ä¼˜åŒ– 72. ç¼–è¾‘è·ç¦» ä»£ç  åŒ…å«ç©ºé—´ä¼˜åŒ– 97. äº¤é”™å­—ç¬¦ä¸² ä»£ç  *è¯¾åä½œä¸š 1092. æœ€çŸ­å…¬å…±è¶…åºåˆ— ä»£ç  *è¯¾åä½œä¸š æœ€é•¿é€’å¢å­åºåˆ— LIS 300. æœ€é•¿é€’å¢å­åºåˆ— ä»£ç  åŒ…æ‹¬è´ªå¿ƒäºŒåˆ† + $O(1)$ ç©ºé—´ 1671. å¾—åˆ°å±±å½¢æ•°ç»„çš„æœ€å°‘åˆ é™¤æ¬¡æ•° ä»£ç  *è¯¾åä½œä¸š 1626. æ— çŸ›ç›¾çš„æœ€ä½³çƒé˜Ÿ ä»£ç  *è¯¾åä½œä¸š çŠ¶æ€æœº DP - ä¹°å–è‚¡ç¥¨ç³»åˆ— 122. ä¹°å–è‚¡ç¥¨çš„æœ€ä½³æ—¶æœº II ä»£ç  309. ä¹°å–è‚¡ç¥¨çš„æœ€ä½³æ—¶æœºå«å†·å†»æœŸ ä»£ç  188. ä¹°å–è‚¡ç¥¨çš„æœ€ä½³æ—¶æœº IV ä»£ç  å˜å½¢ï¼šæ°å¥½è‡³å°‘ 714. ä¹°å–è‚¡ç¥¨çš„æœ€ä½³æ—¶æœºå«æ‰‹ç»­è´¹ ä»£ç  *è¯¾åä½œä¸š 2826. å°†ä¸‰ä¸ªç»„æ’åº ä»£ç  *è¯¾åä½œä¸š 2786. è®¿é—®æ•°ç»„ä¸­çš„ä½ç½®ä½¿åˆ†æ•°æœ€å¤§ ä»£ç  *è¯¾åä½œä¸š åŒºé—´ DP 516. æœ€é•¿å›æ–‡å­åºåˆ— ä»£ç  åŒ…å«ç©ºé—´ä¼˜åŒ– 1039. å¤šè¾¹å½¢ä¸‰è§’å‰–åˆ†çš„æœ€ä½å¾—åˆ† ä»£ç  3040. ç›¸åŒåˆ†æ•°çš„æœ€å¤§æ“ä½œæ•°ç›® II ä»£ç  *è¯¾åä½œä¸š 1547. åˆ‡æ£å­çš„æœ€å°æˆæœ¬ ä»£ç  *è¯¾åä½œä¸š 1771. ç”±å­åºåˆ—æ„é€ çš„æœ€é•¿å›æ–‡ä¸²çš„é•¿åº¦ ä»£ç  *è¯¾åä½œä¸š 1000. åˆå¹¶çŸ³å¤´çš„æœ€ä½æˆæœ¬ ä»£ç  *è¯¾åä½œä¸š æ ‘å½¢ DP - ç›´å¾„ç³»åˆ— 543. äºŒå‰æ ‘çš„ç›´å¾„ ä»£ç  124. äºŒå‰æ ‘ä¸­çš„æœ€å¤§è·¯å¾„å’Œ ä»£ç  2246. ç›¸é‚»å­—ç¬¦ä¸åŒçš„æœ€é•¿è·¯å¾„ ä»£ç  687. æœ€é•¿åŒå€¼è·¯å¾„ ä»£ç  *è¯¾åä½œä¸š 3203. åˆå¹¶ä¸¤æ£µæ ‘åçš„æœ€å°ç›´å¾„ ä»£ç  *è¯¾åä½œä¸š 1617. ç»Ÿè®¡å­æ ‘ä¸­åŸå¸‚ä¹‹é—´æœ€å¤§è·ç¦» ä»£ç  *è¯¾åä½œä¸š 2538. æœ€å¤§ä»·å€¼å’Œä¸æœ€å°ä»·å€¼å’Œçš„å·®å€¼ ä»£ç  *è¯¾åä½œä¸š æ ‘å½¢ DP - æœ€å¤§ç‹¬ç«‹é›† 337. æ‰“å®¶åŠ«èˆ III ä»£ç  1377. T ç§’åé’è›™çš„ä½ç½® ä»£ç  *è¯¾åä½œä¸š 2646. æœ€å°åŒ–æ—…è¡Œçš„ä»·æ ¼æ€»å’Œ ä»£ç  *è¯¾åä½œä¸š æ ‘å½¢ DP - æœ€å°æ”¯é…é›† 968. ç›‘æ§äºŒå‰æ ‘ ä»£ç  å•è°ƒæ ˆ 739. æ¯æ—¥æ¸©åº¦ ä»£ç  ä¸¤ç§å†™æ³• 42. æ¥é›¨æ°´ ä»£ç  496. ä¸‹ä¸€ä¸ªæ›´å¤§å…ƒç´  I ä»£ç  *è¯¾åä½œä¸š 503. ä¸‹ä¸€ä¸ªæ›´å¤§å…ƒç´  II ä»£ç  *è¯¾åä½œä¸š 901. è‚¡ç¥¨ä»·æ ¼è·¨åº¦ ä»£ç  *è¯¾åä½œä¸š 1019. é“¾è¡¨ä¸­çš„ä¸‹ä¸€ä¸ªæ›´å¤§èŠ‚ç‚¹ ä»£ç  *è¯¾åä½œä¸š 1944. é˜Ÿåˆ—ä¸­å¯ä»¥çœ‹åˆ°çš„äººæ•° ä»£ç  *è¯¾åä½œä¸š 84. æŸ±çŠ¶å›¾ä¸­æœ€å¤§çš„çŸ©å½¢ ä»£ç  *è¯¾åä½œä¸š 1793. å¥½å­æ•°ç»„çš„æœ€å¤§åˆ†æ•° ä»£ç  *è¯¾åä½œä¸š 85. æœ€å¤§çŸ©å½¢ ä»£ç  *è¯¾åä½œä¸š å•è°ƒé˜Ÿåˆ— 239. æ»‘åŠ¨çª—å£æœ€å¤§å€¼ ä»£ç  2398. é¢„ç®—å†…çš„æœ€å¤šæœºå™¨äººæ•°ç›® ä»£ç  *è¯¾åä½œä¸š 862. å’Œè‡³å°‘ä¸º K çš„æœ€çŸ­å­æ•°ç»„ ä»£ç  *è¯¾åä½œä¸š 1499. æ»¡è¶³ä¸ç­‰å¼çš„æœ€å¤§å€¼ ä»£ç  *è¯¾åä½œä¸š 1696. è·³è·ƒæ¸¸æˆ VI ä»£ç  *è¯¾åä½œä¸š 2944. è´­ä¹°æ°´æœéœ€è¦çš„æœ€å°‘é‡‘å¸æ•° ä»£ç  *è¯¾åä½œä¸š å…¶ä»–å°šæœªæ›´æ–°çš„ topic è¯·çœ‹ é¢˜è§£ç²¾é€‰ï¼ˆå·²åˆ†ç±»ï¼‰ ç®—æ³•é¢˜å•ğŸ”¥å¦‚ä½•ç§‘å­¦åˆ·é¢˜ï¼Ÿ æ»‘åŠ¨çª—å£ä¸åŒæŒ‡é’ˆï¼ˆå®šé•¿ä¸å®šé•¿å•åºåˆ—åŒåºåˆ—ä¸‰æŒ‡é’ˆåˆ†ç»„å¾ªç¯ï¼‰ äºŒåˆ†ç®—æ³•ï¼ˆäºŒåˆ†ç­”æ¡ˆæœ€å°åŒ–æœ€å¤§å€¼æœ€å¤§åŒ–æœ€å°å€¼ç¬¬Kå°ï¼‰ å•è°ƒæ ˆï¼ˆåŸºç¡€çŸ©å½¢é¢ç§¯è´¡çŒ®æ³•æœ€å°å­—å…¸åºï¼‰ ç½‘æ ¼å›¾ï¼ˆDFSBFSç»¼åˆåº”ç”¨ï¼‰ ä½è¿ç®—ï¼ˆåŸºç¡€æ€§è´¨æ‹†ä½è¯•å¡«æ’ç­‰å¼æ€ç»´ï¼‰ å›¾è®ºç®—æ³•ï¼ˆDFSBFSæ‹“æ‰‘æ’åºæœ€çŸ­è·¯æœ€å°ç”Ÿæˆæ ‘äºŒåˆ†å›¾åŸºç¯æ ‘æ¬§æ‹‰è·¯å¾„ï¼‰ ğŸ”¥åŠ¨æ€è§„åˆ’ï¼ˆå…¥é—¨èƒŒåŒ…çŠ¶æ€æœºåˆ’åˆ†åŒºé—´çŠ¶å‹æ•°ä½æ•°æ®ç»“æ„ä¼˜åŒ–æ ‘å½¢åšå¼ˆæ¦‚ç‡æœŸæœ›ï¼‰ å¸¸ç”¨æ•°æ®ç»“æ„ï¼ˆå‰ç¼€å’Œå·®åˆ†æ ˆé˜Ÿåˆ—å †å­—å…¸æ ‘å¹¶æŸ¥é›†æ ‘çŠ¶æ•°ç»„çº¿æ®µæ ‘ï¼‰ æ•°å­¦ç®—æ³•ï¼ˆæ•°è®ºç»„åˆæ¦‚ç‡æœŸæœ›åšå¼ˆè®¡ç®—å‡ ä½•éšæœºç®—æ³•ï¼‰ è´ªå¿ƒä¸æ€ç»´ï¼ˆåŸºæœ¬è´ªå¿ƒç­–ç•¥åæ‚”åŒºé—´å­—å…¸åºæ•°å­¦æ€ç»´è„‘ç­‹æ€¥è½¬å¼¯æ„é€ ï¼‰ é“¾è¡¨ã€äºŒå‰æ ‘ä¸å›æº¯ï¼ˆå‰åæŒ‡é’ˆå¿«æ…¢æŒ‡é’ˆDFSBFSç›´å¾„LCAä¸€èˆ¬æ ‘ï¼‰ å­—ç¬¦ä¸²ï¼ˆKMPZå‡½æ•°Manacherå­—ç¬¦ä¸²å“ˆå¸ŒACè‡ªåŠ¨æœºåç¼€æ•°ç»„å­åºåˆ—è‡ªåŠ¨æœºï¼‰ å‘¨èµ›æ€»ç»“ å¦‚ä½•ç§‘å­¦ä¸Šåˆ†ï¼ˆç§‘å­¦åˆ·é¢˜ï¼‰ ä»å‘¨èµ›ä¸­å­¦ç®—æ³• - 2023Â·ä¸‹ ä»å‘¨èµ›ä¸­å­¦ç®—æ³• - 2023Â·ä¸Š ä»å‘¨èµ›ä¸­å­¦ç®—æ³• - 2022Â·ä¸‹ ä»å‘¨èµ›ä¸­å­¦ç®—æ³• - 2022Â·ä¸Š å…¶ä»– ğŸ”¥ä»é›†åˆè®ºåˆ°ä½è¿ç®—ï¼Œå¸¸è§ä½è¿ç®—æŠ€å·§åˆ†ç±»æ€»ç»“ï¼ æ¨¡è¿ç®—çš„ä¸–ç•Œï¼šå½“åŠ å‡ä¹˜é™¤é‡ä¸Šå–æ¨¡ ã€ç®€å•é¢˜æ€æ‰‹ã€‘åˆ†ç»„å¾ªç¯ ã€å›¾è§£ã€‘ä¸€å¼ å›¾ç§’æ‡‚äºŒç»´å‰ç¼€å’Œ ç›¸å‘åŒæŒ‡é’ˆå°tips:å¯ä»¥é€šè¿‡è·å–çš„ä¿¡æ¯é‡æ¥è¡¡é‡ä¸€ä¸ªç®—æ³•çš„æ•ˆç‡. åŒæŒ‡é’ˆçš„ç²¾é«“:ç”¨O1çš„æ—¶é—´,è·å–åˆ°Onçš„ä¿¡æ¯.(å› ä¸ºæ¯æ¬¡ç§»åŠ¨éƒ½èƒ½å¤Ÿæ’é™¤å¤šä¸ªä¸å¯èƒ½çš„ç»„åˆ) 167. ä¸¤æ•°ä¹‹å’Œ II - è¾“å…¥æœ‰åºæ•°ç»„æ¯”å¦‚è¿™é“é¢˜ç›®æš´åŠ›åšæ³•æšä¸¾æ¯ä¸ªæ•°,ç„¶åå’Œtargetä½œæ¯”è¾ƒ,O1çš„æ—¶é—´å°±è·å–åˆ°äº†O1çš„ä¿¡æ¯.è€ŒåŒæŒ‡é’ˆçš„æ–¹æ³•å°†å‰©ä¸‹çš„æ•°å’Œæœ€å¤§çš„æ•°å¯¹æ¯”,O1çš„æ—¶é—´è·å–åˆ°äº†Onçš„ä¿¡æ¯. çº¿æ®µæ ‘ä»¥è¿™é“é¢˜ç›®æ°´æœæˆç¯®IIIä¸ºä¾‹,å…¥é—¨çº¿æ®µæ ‘. çº¿æ®µæ ‘å‘æ˜çš„åŠ¨æœºè™½ç„¶è¯´æ•°ç»„æ— åº,ä½†æ˜¯ä»ç„¶å¯ä»¥é€šè¿‡äºŒåˆ†çš„æ–¹å¼å¯»æ‰¾éœ€è¦çš„ä½ç½®,å¦‚æœå·¦åŠè¾¹æœ‰å°±æ’é™¤å³åŠè¾¹,å¦‚æœå·¦åŠè¾¹æ²¡æœ‰å°±æ’é™¤å·¦åŠè¾¹.å¹¶ä¸”æ¯æ¬¡äºŒåˆ†,éƒ½æ˜¯åŸé—®é¢˜ç›¸åŒçš„æ›´å°å­é—®é¢˜,ä¹Ÿå°±æ˜¯ç»§ç»­å¯»æ‰¾å·¦å³åŠè¾¹æœ€å¤§çš„å®¹å™¨. ä¸ºä»€ä¹ˆè¦è¿™ä¹ˆè®¾è®¡çº¿æ®µæ ‘é€šè¿‡çº¿æ®µæ ‘,å¯ä»¥ç»´æŠ¤æ‰€æœ‰éœ€è¦çš„æƒ…å†µçš„æ•°æ®.å¹¶ä¸”åœ¨æŸ¥æ‰¾å,éœ€è¦é‡æ–°ä¿®æ­£èŠ‚ç‚¹.æ‰€ä»¥éœ€è¦çš„æ“ä½œå°±æ˜¯:æ‰¾åˆ°æœ€å·¦è¾¹å¤§äºç­‰äºxçš„ä½ç½®;å°†è¯¥ä½ç½®æ”¹æˆ-1. çº¿æ®µæ ‘æ¨¡æ¿class SegmentTree private final int[] max; public SegmentTree(int[] a) int n = a.length; //maxæ˜¯â€‹â€‹å¤§äºæˆ–ç­‰äº nçš„æœ€å°çš„ 2 çš„å¹‚æ¬¡æ–¹â€‹â€‹ max = new int[2 (32 - Integer.numberOfLeadingZeros(n - 1))]; //å»ºç«‹çº¿æ®µæ ‘ build(a, 1, 0, n - 1); // æ‰¾åŒºé—´å†…çš„ç¬¬ä¸€ä¸ª = x çš„æ•°ï¼Œå¹¶æ›´æ–°ä¸º -1ï¼Œè¿”å›è¿™ä¸ªæ•°çš„ä¸‹æ ‡ï¼ˆæ²¡æœ‰åˆ™è¿”å› -1ï¼‰ //oä¸ºç¬¬å‡ ä¸ªä½ç½® lä¸ºå·¦ä¸‹æ ‡ rä¸ºå³ä¸‹æ ‡ xä¸ºç›®æ ‡æ•° public int findFirstAndUpdate(int o, int l, int r, int x) if (max[o] x) // åŒºé—´æ²¡æœ‰ = x çš„æ•° return -1; if (l == r) max[o] = -1; // æ›´æ–°ä¸º -1ï¼Œè¡¨ç¤ºä¸èƒ½æ”¾æ°´æœ return l; int m = (l + r) / 2; int i = findFirstAndUpdate(o * 2, l, m, x); // å…ˆé€’å½’å·¦å­æ ‘ if (i 0) // å·¦å­æ ‘æ²¡æ‰¾åˆ° i = findFirstAndUpdate(o * 2 + 1, m + 1, r, x); // å†é€’å½’å³å­æ ‘ maintain(o); return i; //åœ¨å›æº¯è¿‡ç¨‹æ›´æ–°èŠ‚ç‚¹ private void maintain(int o) max[o] = Math.max(max[o * 2], max[o * 2 + 1]); // åˆå§‹åŒ–çº¿æ®µæ ‘ private void build(int[] a, int o, int l, int r) if (l == r) max[o] = a[l]; return; int m = (l + r) / 2; build(a, o * 2, l, m); build(a, o * 2 + 1, m + 1, r); maintain(o); class Solution public int numOfUnplacedFruits(int[] fruits, int[] baskets) SegmentTree t = new SegmentTree(baskets); int n = baskets.length; int ans = 0; for (int x : fruits) if (t.findFirstAndUpdate(1, 0, n - 1, x) 0) ans++; return ans;","tags":["åŸºç¡€","leetcode","ç®—æ³•"],"categories":["ç®—æ³•ç¬”è®°"]},{"title":"å¾®ä¿¡æ‰«ç ç™»å½•","path":"/2025/07/25/é¡¹ç›®ç¬”è®°/å¾®ä¿¡æ‰«ç ç™»å½•/","content":"æ•´ä½“ä¸šåŠ¡æµç¨‹å…³ç³»å¦‚å›¾:","tags":["é¡¹ç›®","TecHub"],"categories":["é¡¹ç›®ç¬”è®°"]},{"title":"2025.7.24å­¦ä¹ æ—¥è®°","path":"/2025/07/24/å­¦ä¹ æ—¥è®°25å¹´7æœˆ/2025.7.24å­¦ä¹ ç¬”è®°/","content":"ä»Šæ—¥å­¦ä¹ å†…å®¹3DGSä»Šå¤©ä¸»è¦å­¦ä¹ CityGaussianV2è®ºæ–‡. åŠ›æ‰£æ¯æ—¥ä¸€é¢˜æ ‘çš„å›°éš¾é¢˜ç›®. JavaSEå…«è‚¡2356 Rediså…«è‚¡057 é¡¹ç›®ç¯‡ä»£ç éšæƒ³å½•ç”Ÿæ´»ç¯‡æ™šä¸Šå¥èº«ç»ƒèƒŒ,æ ¸å¿ƒ,è‚©,ä¸‰å¤´,å¼ºåº¦ä¸­ç­‰åä¸Š.","tags":["åŸºç¡€","æ—¥è®°","leetcode","é¡¹ç›®"],"categories":["å­¦ä¹ æ—¥è®°","2025-07"]},{"title":"2025.7.23å­¦ä¹ æ—¥è®°","path":"/2025/07/23/å­¦ä¹ æ—¥è®°25å¹´7æœˆ/2025.7.23å­¦ä¹ ç¬”è®°/","content":"ä»Šæ—¥å­¦ä¹ å†…å®¹3DGSä»Šå¤©ä¸»è¦å­¦ä¹ CityGaussiançš„ä»£ç . åŠ›æ‰£æ¯æ—¥ä¸€é¢˜ä¸€é“å †åŠ è´ªå¿ƒçš„ä¸­ç­‰é¢˜ç›®. JavaSEå…«è‚¡2356 Rediså…«è‚¡057 é¡¹ç›®ç¯‡ä»£ç éšæƒ³å½•ç”Ÿæ´»ç¯‡æ™šä¸Šå¥èº«ç»ƒèƒŒ,æ ¸å¿ƒ,è‚©,ä¸‰å¤´,å¼ºåº¦ä¸­ç­‰åä¸Š.","tags":["åŸºç¡€","æ—¥è®°","leetcode","é¡¹ç›®"],"categories":["å­¦ä¹ æ—¥è®°","2025-07"]},{"title":"Rediså­¦ä¹ ç¬”è®°","path":"/2025/07/22/Javaé—®ç­”ç¬”è®°/Rediså­¦ä¹ ç¬”è®°/","content":"åŸºç¡€1.ğŸŒŸè¯´è¯´ä»€ä¹ˆæ˜¯ Redis?Redis æ˜¯ä¸€ç§åŸºäºé”®å€¼å¯¹çš„ NoSQL æ•°æ®åº“ã€‚ å®ƒä¸»è¦çš„ç‰¹ç‚¹æ˜¯æŠŠæ•°æ®æ”¾åœ¨å†…å­˜å½“ä¸­ï¼Œç›¸æ¯”ç›´æ¥è®¿é—®ç£ç›˜çš„å…³ç³»å‹æ•°æ®åº“ï¼Œè¯»å†™é€Ÿåº¦ä¼šå¿«å¾ˆå¤šï¼ŒåŸºæœ¬ä¸Šèƒ½è¾¾åˆ°å¾®ç§’çº§çš„å“åº”ã€‚ æ‰€ä»¥åœ¨ä¸€äº›å¯¹æ€§èƒ½è¦æ±‚å¾ˆé«˜çš„åœºæ™¯ï¼Œæ¯”å¦‚ç¼“å­˜çƒ­ç‚¹æ•°æ®ã€é˜²æ­¢æ¥å£çˆ†åˆ·ï¼Œéƒ½ä¼šç”¨åˆ° Redisã€‚ ä¸ä»…å¦‚æ­¤ï¼ŒRedis è¿˜æ”¯æŒæŒä¹…åŒ–ï¼Œå¯ä»¥å°†å†…å­˜ä¸­çš„æ•°æ®å¼‚æ­¥è½ç›˜ï¼Œä»¥ä¾¿æœåŠ¡å®•æœºé‡å¯åèƒ½æ¢å¤æ•°æ®ã€‚ Redis å’Œ MySQL çš„åŒºåˆ«ï¼ŸRedis å±äºéå…³ç³»å‹æ•°æ®åº“ï¼Œæ•°æ®æ˜¯é€šè¿‡é”®å€¼å¯¹çš„å½¢å¼æ”¾åœ¨å†…å­˜å½“ä¸­çš„ï¼›MySQL å±äºå…³ç³»å‹æ•°æ®åº“ï¼Œæ•°æ®ä»¥è¡Œå’Œåˆ—çš„å½¢å¼å­˜å‚¨åœ¨ç£ç›˜å½“ä¸­ã€‚ å®é™…å¼€å‘ä¸­ï¼Œä¼šå°† MySQL ä½œä¸ºä¸»å­˜å‚¨ï¼ŒRedis ä½œä¸ºç¼“å­˜ï¼Œé€šè¿‡å…ˆæŸ¥ Redisï¼Œæœªå‘½ä¸­å†æŸ¥ MySQL å¹¶å†™å›Redis çš„æ–¹å¼æ¥æé«˜ç³»ç»Ÿçš„æ•´ä½“æ€§èƒ½ã€‚ TecHubé¡¹ç›®é‡Œå“ªé‡Œç”¨åˆ°äº† Redisï¼Ÿåœ¨TecHubå®æˆ˜é¡¹ç›®å½“ä¸­ï¼Œæœ‰å¾ˆå¤šåœ°æ–¹éƒ½ç”¨åˆ°äº† Redisï¼Œæ¯”å¦‚è¯´ç”¨æˆ·æ´»è·ƒæ’è¡Œæ¦œç”¨åˆ°äº† zsetï¼Œä½œè€…ç™½åå•ç”¨åˆ°äº† setã€‚è¿˜æœ‰ç”¨æˆ·ç™»å½•åçš„ Sessionã€ç«™ç‚¹åœ°å›¾ SiteMapï¼Œåˆ†åˆ«ç”¨åˆ°äº† Redis çš„å­—ç¬¦ä¸²å’Œå“ˆå¸Œè¡¨ä¸¤ç§æ•°æ®ç±»å‹ã€‚å…¶ä¸­æ¯”è¾ƒæœ‰æŒ‘æˆ˜æ€§çš„ä¸€ä¸ªåº”ç”¨æ˜¯ï¼Œé€šè¿‡ Lua è„šæœ¬å°è£… Redis çš„ setnex å‘½ä»¤æ¥å®ç°åˆ†å¸ƒå¼é”ï¼Œä»¥ä¿è¯åœ¨é«˜å¹¶å‘åœºæ™¯ä¸‹ï¼Œçƒ­ç‚¹æ–‡ç« åœ¨çŸ­æ—¶é—´å†…çš„é«˜é¢‘è®¿é—®ä¸ä¼šå‡»ç©¿ MySQLã€‚ éƒ¨ç½²è¿‡ Redis å—ï¼Ÿç¬¬ä¸€ç§å›ç­”ç‰ˆæœ¬ï¼š æˆ‘åªåœ¨æœ¬åœ°éƒ¨ç½²è¿‡å•æœºç‰ˆï¼Œä¸‹è½½ Redis çš„å®‰è£…åŒ…ï¼Œè§£å‹åè¿è¡ŒÂ redis-serverÂ å‘½ä»¤å³å¯ã€‚ ç¬¬äºŒç§å›ç­”ç‰ˆæœ¬ï¼š æˆ‘æœ‰åœ¨ç”Ÿäº§ç¯å¢ƒä¸­éƒ¨ç½²å•æœºç‰ˆ Redisï¼Œä»å®˜ç½‘ä¸‹è½½æºç åŒ…è§£å‹åæ‰§è¡ŒÂ make make installÂ ç¼–è¯‘å®‰è£…ã€‚ç„¶åç¼–è¾‘Â redis.confÂ æ–‡ä»¶ï¼Œå¼€å¯è¿œç¨‹è®¿é—®ã€è®¾ç½®å¯†ç ã€é™åˆ¶å†…å­˜ã€è®¾ç½®å†…å­˜è¿‡æœŸæ·˜æ±°ç­–ç•¥ã€å¼€å¯ AOF æŒä¹…åŒ–ç­‰ï¼š bind 0.0.0.0 # å…è®¸è¿œç¨‹è®¿é—®requirepass your_password # è®¾ç½®å¯†ç maxmemory 4gb # é™åˆ¶å†…å­˜ï¼Œé¿å… OOMmaxmemory-policy allkeys-lru # å†…å­˜æ·˜æ±°ç­–ç•¥appendonly yes # å¼€å¯ AOF æŒä¹…åŒ– ç¬¬ä¸‰ç§å›ç­”ç‰ˆæœ¬ï¼š æˆ‘æœ‰ä½¿ç”¨ Docker æ‹‰å– Redis é•œåƒåè¿›è¡Œå®¹å™¨åŒ–éƒ¨ç½²ã€‚ docker run -d --name redis -p 6379:6379 redis:7.0-alpine Redis çš„é«˜å¯ç”¨æ–¹æ¡ˆæœ‰éƒ¨ç½²è¿‡å—ï¼Ÿæœ‰éƒ¨ç½²è¿‡å“¨å…µæœºåˆ¶ï¼Œè¿™æ˜¯ä¸€ä¸ªç›¸å¯¹æˆç†Ÿçš„é«˜å¯ç”¨è§£å†³æ–¹æ¡ˆï¼Œæˆ‘ä»¬ç”Ÿäº§ç¯å¢ƒéƒ¨ç½²çš„æ˜¯ä¸€ä¸»ä¸¤ä»çš„ Redis å®ä¾‹ï¼Œå†åŠ ä¸Šä¸‰ä¸ª Sentinel èŠ‚ç‚¹ç›‘æ§å®ƒä»¬ã€‚Sentinel çš„é…ç½®ç›¸å¯¹ç®€å•ï¼Œä¸»è¦è®¾ç½®äº†æ•…éšœè½¬ç§»çš„åˆ¤å®šæ¡ä»¶å’Œè¶…æ—¶é˜ˆå€¼ã€‚ ä¸»èŠ‚ç‚¹é…ç½®ï¼š port 6379appendonly yes/code ä»èŠ‚ç‚¹é…ç½®ï¼š replicaof 192.168.1.10 6379/code å“¨å…µèŠ‚ç‚¹é…ç½®ï¼š sentinel monitor mymaster 192.168.1.10 6379 2sentinel down-after-milliseconds mymaster 5000sentinel failover-timeout mymaster 60000sentinel parallel-syncs mymaster 1 å½“ä¸»èŠ‚ç‚¹å‘ç”Ÿæ•…éšœæ—¶ï¼ŒSentinel èƒ½å¤Ÿè‡ªåŠ¨æ£€æµ‹å¹¶åå•†é€‰å‡ºæ–°çš„ä¸»èŠ‚ç‚¹ï¼Œè¿™ä¸ªè¿‡ç¨‹å¤§æ¦‚éœ€è¦ 10-15 ç§’ã€‚ å¦ä¸€ä¸ªå¤§å‹é¡¹ç›®ä¸­ï¼Œæˆ‘ä»¬ä½¿ç”¨äº† Redis Cluster é›†ç¾¤æ–¹æ¡ˆã€‚è¯¥é¡¹ç›®æ•°æ®é‡å¤§ä¸”å¢é•¿å¿«ï¼Œéœ€è¦æ°´å¹³æ‰©å±•èƒ½åŠ›ã€‚æˆ‘ä»¬éƒ¨ç½²äº† 6 ä¸ªä¸»èŠ‚ç‚¹ï¼Œæ¯ä¸ªä¸»èŠ‚ç‚¹é…å¤‡ä¸€ä¸ªä»èŠ‚ç‚¹ï¼Œå½¢æˆäº†ä¸€ä¸ª 3ä¸»3ä» çš„åˆå§‹é›†ç¾¤ã€‚Redis Cluster çš„è®¾ç½®æ¯”Sentinel å¤æ‚ä¸€äº›ï¼Œéœ€è¦æ­£ç¡®é…ç½®é›†ç¾¤èŠ‚ç‚¹é—´é€šä¿¡ã€åˆ†ç‰‡æ˜ å°„ç­‰ã€‚ redis-server redis-7000.confredis-server redis-7001.conf...# ä½¿ç”¨ redis-cli åˆ›å»ºé›†ç¾¤# Redis ä¼šè‡ªåŠ¨å°† key å“ˆå¸Œåˆ° 16384 ä¸ªæ§½ä½# ä¸»èŠ‚ç‚¹å‡åˆ†æ§½ä½ï¼Œä»èŠ‚ç‚¹è‡ªåŠ¨è·Ÿéšredis-cli --cluster create \\ 127.0.0.1:7000 127.0.0.1:7001 127.0.0.1:7002 \\ 127.0.0.1:7003 127.0.0.1:7004 127.0.0.1:7005 \\ --cluster-replicas 1 Redis Cluster æœ€å¤§çš„ä¼˜åŠ¿æ˜¯æ•°æ®è‡ªåŠ¨åˆ†ç‰‡ï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡ç®€å•åœ°å¢åŠ èŠ‚ç‚¹æ¥æ‰©å±•é›†ç¾¤å®¹é‡ã€‚æ­¤å¤–ï¼Œå®ƒçš„æ•…éšœè½¬ç§»ä¹Ÿå¾ˆå¿«ï¼Œé€šå¸¸åœ¨å‡ ç§’å†…å°±èƒ½å®Œæˆã€‚ å¯¹äºä¸€äº›è½»é‡çº§åº”ç”¨ï¼Œæˆ‘ä¹Ÿä½¿ç”¨è¿‡ä¸»ä»å¤åˆ¶åŠ æ‰‹åŠ¨æ•…éšœè½¬ç§»çš„æ–¹æ¡ˆã€‚ä¸»èŠ‚ç‚¹è´Ÿè´£è¯»å†™æ“ä½œï¼Œä»èŠ‚ç‚¹è´Ÿè´£è¯»æ“ä½œã€‚æ‰‹åŠ¨æ•…éšœè½¬ç§»æ—¶ï¼Œæˆ‘ä»¬ä¼šå…ˆå°†ä»èŠ‚ç‚¹æå‡ä¸ºä¸»èŠ‚ç‚¹ï¼Œç„¶åé‡æ–°é…ç½®å…¶ä»–ä»èŠ‚ç‚¹ã€‚ # 1\\. å–æ¶ˆä»èŠ‚ç‚¹èº«ä»½redis-cli -h slave-ip slaveof no one# 2\\. å°†å…¶ä»–ä»èŠ‚ç‚¹æŒ‡å‘æ–°çš„ä¸»èŠ‚ç‚¹redis-cli -h other-slave-ip slaveof new-master-ip port 2.Redis å¯ä»¥ç”¨æ¥å¹²ä»€ä¹ˆï¼ŸRedis å¯ä»¥ç”¨æ¥åšç¼“å­˜ï¼Œæ¯”å¦‚è¯´æŠŠé«˜é¢‘è®¿é—®çš„æ–‡ç« è¯¦æƒ…ã€å•†å“ä¿¡æ¯ã€ç”¨æˆ·ä¿¡æ¯æ”¾å…¥ Redis å½“ä¸­ï¼Œå¹¶é€šè¿‡è®¾ç½®è¿‡æœŸæ—¶é—´æ¥ä¿è¯æ•°æ®ä¸€è‡´æ€§ï¼Œè¿™æ ·å°±å¯ä»¥å‡è½»æ•°æ®åº“çš„è®¿é—®å‹åŠ›ã€‚ Redis çš„ Zset è¿˜å¯ä»¥ç”¨æ¥å®ç°ç§¯åˆ†æ¦œã€çƒ­æœæ¦œï¼Œé€šè¿‡ score å­—æ®µè¿›è¡Œæ’åºï¼Œç„¶åå–å‰ N ä¸ªå…ƒç´ ï¼Œå°±èƒ½å®ç° TOPN çš„æ¦œå•åŠŸèƒ½ã€‚ åˆ©ç”¨ Redis çš„ SETNX å‘½ä»¤æˆ–è€… Redisson è¿˜å¯ä»¥å®ç°åˆ†å¸ƒå¼é”ï¼Œç¡®ä¿åŒä¸€æ—¶é—´åªæœ‰ä¸€ä¸ªèŠ‚ç‚¹å¯ä»¥æŒæœ‰é”ï¼›ä¸ºäº†é˜²æ­¢å‡ºç°æ­»é”ï¼Œå¯ä»¥ç»™é”è®¾ç½®ä¸€ä¸ªè¶…æ—¶æ—¶é—´ï¼Œåˆ°æœŸåè‡ªåŠ¨é‡Šæ”¾ï¼›å¹¶ä¸”æœ€å¥½å¼€å¯ä¸€ä¸ªç›‘å¬çº¿ç¨‹ï¼Œå½“ä»»åŠ¡å°šæœªå®Œæˆæ—¶ç»™é”è‡ªåŠ¨ç»­æœŸã€‚ å¦‚æœæ˜¯ç§’æ€æ¥å£ï¼Œè¿˜å¯ä»¥ä½¿ç”¨ Lua è„šæœ¬æ¥å®ç°ä»¤ç‰Œæ¡¶ç®—æ³•ï¼Œé™åˆ¶æ¯ç§’åªèƒ½å¤„ç† N ä¸ªè¯·æ±‚ã€‚ -- KEYS[1]: ä»¤ç‰Œæ¡¶çš„key-- ARGV[1]: æ¡¶å®¹é‡-- ARGV[2]: ä»¤ç‰Œç”Ÿæˆé€Ÿç‡ï¼ˆæ¯ç§’ï¼‰-- ARGV[3]: å½“å‰æ—¶é—´æˆ³ï¼ˆç§’ï¼‰-- ä»Rediså“ˆå¸Œè¡¨ä¸­è·å–å½“å‰ä»¤ç‰Œæ¡¶çš„çŠ¶æ€local bucket = redis.call(HMGET, KEYS[1], tokens, timestamp)-- å½“å‰ä»¤ç‰Œæ•°ï¼ˆå¦‚æœä¸å­˜åœ¨åˆ™ä½¿ç”¨é»˜è®¤å®¹é‡ï¼‰local tokens = tonumber(bucket[1]) or ARGV[1]-- ä¸Šæ¬¡æ›´æ–°æ—¶é—´ï¼ˆå¦‚æœä¸å­˜åœ¨åˆ™ä½¿ç”¨å½“å‰æ—¶é—´ï¼‰local last_time = tonumber(bucket[2]) or ARGV[3]-- ä»å‚æ•°ä¸­è·å–é…ç½®å€¼local rate = tonumber(ARGV[2]) -- ä»¤ç‰Œç”Ÿæˆé€Ÿç‡ï¼ˆæ¯ç§’ï¼‰local capacity = tonumber(ARGV[1]) -- æ¡¶å®¹é‡local now = tonumber(ARGV[3]) -- å½“å‰æ—¶é—´æˆ³ï¼ˆç§’ï¼‰-- è®¡ç®—è·ç¦»ä¸Šæ¬¡æ›´æ–°ç»è¿‡çš„æ—¶é—´å·®local delta = math.max(0, now - last_time)-- è®¡ç®—åº”æ·»åŠ çš„ä»¤ç‰Œæ•°ï¼ˆé€Ÿç‡*æ—¶é—´å·®ï¼‰local add_tokens = delta * rate-- æ›´æ–°ä»¤ç‰Œæ•°ï¼ˆä¸è¶…è¿‡æ¡¶å®¹é‡ï¼‰tokens = math.min(capacity, tokens + add_tokens)-- è®°å½•æœ¬æ¬¡æ›´æ–°æ—¶é—´last_time = now-- é»˜è®¤ä¸å…è®¸é€šè¿‡ï¼ˆ0ï¼‰local allowed = 0-- å¦‚æœä»¤ç‰Œæ•°â‰¥1ï¼Œåˆ™æ¶ˆè€—ä¸€ä¸ªä»¤ç‰Œå¹¶å…è®¸é€šè¿‡ï¼ˆ1ï¼‰if tokens = 1 then tokens = tokens - 1 allowed = 1end-- æ›´æ–°Redisä¸­çš„ä»¤ç‰Œæ¡¶çŠ¶æ€redis.call(HMSET, KEYS[1], tokens, tokens, timestamp, last_time)-- è®¾ç½®é”®çš„è¿‡æœŸæ—¶é—´ï¼ˆé˜²æ­¢é•¿æœŸä¸ç”¨çš„é”®å ç”¨å†…å­˜ï¼‰redis.call(EXPIRE, KEYS[1], 3600) -- è¿‡æœŸæ—¶é—´å¯è‡ªå®šä¹‰-- è¿”å›æ˜¯å¦å…è®¸é€šè¿‡ï¼ˆ1=å…è®¸ï¼Œ0=æ‹’ç»ï¼‰return allowed åœ¨ Java ä¸­è°ƒç”¨ Lua è„šæœ¬ï¼š // ä»¤ç‰Œæ¡¶å‚æ•°int capacity = 10; // æ¡¶å®¹é‡int rate = 2; // æ¯ç§’2ä¸ªä»¤ç‰Œlong now = System.currentTimeMillis() / 1000;String key = token_bucket:user:123;// è°ƒç”¨ Lua è„šæœ¬ï¼Œè¿”å› 1 è¡¨ç¤ºé€šè¿‡ï¼Œ0 è¡¨ç¤ºè¢«é™æµLong allowed = (Long) redis.eval(luaScript, 1, key, String.valueOf(capacity), String.valueOf(rate), String.valueOf(now)); 3.ğŸŒŸRedisæœ‰å“ªäº›æ•°æ®ç±»å‹ï¼ŸRedis æ”¯æŒäº”ç§åŸºæœ¬æ•°æ®ç±»å‹ï¼Œåˆ†åˆ«æ˜¯å­—ç¬¦ä¸²ã€åˆ—è¡¨ã€å“ˆå¸Œã€é›†åˆå’Œæœ‰åºé›†åˆã€‚ è¿˜æœ‰ä¸‰ç§æ‰©å±•æ•°æ®ç±»å‹ï¼Œåˆ†åˆ«æ˜¯ç”¨äºä½çº§æ“ä½œçš„ Bitmapã€ç”¨äºåŸºæ•°ä¼°ç®—çš„ HyperLogLogã€æ”¯æŒå­˜å‚¨å’ŒæŸ¥è¯¢åœ°ç†åæ ‡çš„ GEOã€‚ è¯¦ç»†ä»‹ç»ä¸‹å­—ç¬¦ä¸²ï¼Ÿå­—ç¬¦ä¸²æ˜¯æœ€åŸºæœ¬çš„æ•°æ®ç±»å‹ï¼Œå¯ä»¥å­˜å‚¨æ–‡æœ¬ã€æ•°å­—æˆ–è€…äºŒè¿›åˆ¶æ•°æ®ï¼Œæœ€å¤§å®¹é‡æ˜¯ 512 MBã€‚ é€‚åˆç¼“å­˜å•ä¸ªå¯¹è±¡ï¼Œæ¯”å¦‚éªŒè¯ç ã€tokenã€è®¡æ•°å™¨ç­‰ã€‚ è¯¦ç»†ä»‹ç»ä¸‹åˆ—è¡¨ï¼Ÿåˆ—è¡¨æ˜¯ä¸€ä¸ªæœ‰åºçš„å…ƒç´ é›†åˆï¼Œæ”¯æŒä»å¤´éƒ¨æˆ–å°¾éƒ¨æ’å…¥åˆ é™¤å…ƒç´ ï¼Œå¸¸ç”¨äºæ¶ˆæ¯é˜Ÿåˆ—æˆ–ä»»åŠ¡åˆ—è¡¨ã€‚ è¯¦ç»†ä»‹ç»ä¸‹å“ˆå¸Œï¼Ÿå“ˆå¸Œæ˜¯ä¸€ä¸ªé”®å€¼å¯¹é›†åˆï¼Œé€‚åˆå­˜å‚¨å¯¹è±¡ï¼Œå¦‚å•†å“ä¿¡æ¯ã€ç”¨æˆ·ä¿¡æ¯ç­‰ã€‚æ¯”å¦‚è¯´ value = name: æ²‰é»˜ç‹äºŒ, age: 18ã€‚ è¯¦ç»†ä»‹ç»ä¸‹é›†åˆï¼Ÿé›†åˆæ˜¯æ— åºä¸”ä¸é‡å¤çš„ï¼Œæ”¯æŒäº¤é›†ã€å¹¶é›†æ“ä½œï¼ŒæŸ¥è¯¢æ•ˆç‡èƒ½è¾¾åˆ° O(1) çº§åˆ«ï¼Œä¸»è¦ç”¨äºå»é‡ã€æ ‡ç­¾ã€å…±åŒå¥½å‹ç­‰åœºæ™¯ã€‚ è¯¦ç»†ä»‹ç»ä¸‹æœ‰åºé›†åˆï¼Ÿæœ‰åºé›†åˆçš„å…ƒç´ æŒ‰åˆ†æ•°è¿›è¡Œæ’åºï¼Œæ”¯æŒèŒƒå›´æŸ¥è¯¢ï¼Œé€‚ç”¨äºæ’è¡Œæ¦œæˆ–ä¼˜å…ˆçº§é˜Ÿåˆ—ã€‚ è¯¦ç»†ä»‹ç»ä¸‹Bitmapï¼ŸBitmap å¯ä»¥æŠŠä¸€ç»„äºŒè¿›åˆ¶ä½ç´§å‡‘åœ°å­˜å‚¨åœ¨ä¸€å—è¿ç»­å†…å­˜ä¸­ï¼Œæ¯ä¸€ä½ä»£è¡¨ä¸€ä¸ªå¯¹è±¡çš„çŠ¶æ€ï¼Œæ¯”å¦‚æ˜¯å¦ç­¾åˆ°ã€æ˜¯å¦æ´»è·ƒç­‰ã€‚ æ¯”å¦‚ç”¨æˆ· 0 çš„å·²ç­¾åˆ° 1ã€ç”¨æˆ· 1 æœªç­¾åˆ° 0ã€ç”¨æˆ· 2 å·²ç­¾åˆ°ï¼ŒRedis å°±ä¼šæŠŠè¿™äº›çŠ¶æ€æ”¾è¿›ä¸€ä¸ªè¿ç»­çš„äºŒè¿›åˆ¶ä¸² 101ï¼Œ1 äº¿ç”¨æˆ·ç­¾åˆ°ä»…éœ€ 100,000,000 8 1024 â‰ˆ 12MB çš„ç©ºé—´ï¼ŒçœŸçš„çœåˆ°ç¦»è°±ã€‚ è¯¦ç»†ä»‹ç»ä¸‹HyperLogLogï¼ŸHyperLogLog æ˜¯ä¸€ç§ç”¨äºåŸºæ•°ç»Ÿè®¡çš„æ¦‚ç‡æ€§æ•°æ®ç»“æ„ï¼Œå¯ä»¥åœ¨ä»…æœ‰ 12KB çš„å†…å­˜ç©ºé—´ä¸‹ï¼Œç»Ÿè®¡æµ·é‡æ•°æ®é›†ä¸­ä¸é‡å¤å…ƒç´ çš„ä¸ªæ•°ï¼Œè¯¯å·®ç‡ä»… 0.81%ã€‚ åº•å±‚åŸºäº LogLog ç®—æ³•æ”¹è¿›ï¼Œå…ˆæŠŠæ¯ä¸ªå…ƒç´ å“ˆå¸Œæˆä¸€ä¸ªäºŒè¿›åˆ¶ä¸²ï¼Œç„¶åå–å‰ 14 ä½è¿›è¡Œåˆ†ç»„ï¼Œæ”¾åˆ° 16384 ä¸ªæ¡¶ä¸­ï¼Œè®°å½•æ¯ç»„æœ€å¤§çš„å‰å¯¼é›¶æ•°é‡ï¼Œæœ€åç”¨ä¸€ä¸ªè¿‘ä¼¼å…¬å¼æ¨ç®—å‡ºæ€»ä½“çš„åŸºæ•°ã€‚ å¯ä»¥å‘ç°ï¼Œå“ˆå¸Œå€¼è¶Šé•¿å‰å¯¼é›¶è¶Šå¤šï¼Œä¹Ÿå°±è¯´æ˜é›†åˆé‡Œçš„å…ƒç´ è¶Šå¤šã€‚ å¤§å‹ç½‘ç«™ UV ç»Ÿè®¡ç³»ç»Ÿç¤ºä¾‹ï¼š public class UVCounter private Jedis jedis; public void recordVisit(String date, String userId) String key = uv: + date; jedis.pfadd(key, userId); public long getUV(String date) return jedis.pfcount(uv: + date); public long getUVBetween(String startDate, String endDate) ListString keys = getDateKeys(startDate, endDate); return jedis.pfcount(keys.toArray(new String[0])); è¯¦ç»†ä»‹ç»ä¸‹GEOï¼ŸGEO ç”¨äºå­˜å‚¨å’ŒæŸ¥è¯¢åœ°ç†ä½ç½®ä¿¡æ¯ï¼Œå¯ä»¥ç”¨æ¥è®¡ç®—ä¸¤ç‚¹ä¹‹é—´çš„è·ç¦»ï¼ŒæŸ¥æ‰¾æŸä½ç½®åŠå¾„å†…çš„å…¶ä»–å…ƒç´ ã€‚ å¸¸è§çš„åº”ç”¨åœºæ™¯åŒ…æ‹¬ï¼šé™„è¿‘çš„äººæˆ–è€…å•†å®¶ã€è®¡ç®—å¤–å–å‘˜å’Œå•†å®¶çš„è·ç¦»ã€åˆ¤æ–­ç”¨æˆ·æ˜¯å¦è¿›å…¥æŸä¸ªåŒºåŸŸç­‰ã€‚ åº•å±‚åŸºäº ZSet å®ç°ï¼Œé€šè¿‡ Geohash ç®—æ³•æŠŠç»çº¬åº¦ç¼–ç æˆ scoreã€‚ æ¯”å¦‚è¯´æŸ¥è¯¢é™„è¿‘çš„å•†å®¶æ—¶ï¼ŒRedis ä¼šæ ¹æ®ä¸­å¿ƒç‚¹ç»çº¬åº¦åæ¨å¯èƒ½çš„ Geohash èŒƒå›´ï¼Œ åœ¨ ZSet ä¸ŠåšèŒƒå›´æŸ¥è¯¢ï¼Œæ‹¿åˆ°å€™é€‰ç‚¹åï¼Œç”¨ Haversine å…¬å¼ç²¾ç¡®è®¡ç®—çƒé¢è·ç¦»ï¼Œç­›é€‰å‡ºæœ€ç»ˆç¬¦åˆè¦æ±‚çš„ä½ç½®ã€‚ public class NearbyShopService private Jedis jedis; private static final String SHOP_KEY = shops:geo; // æ·»åŠ å•†é“º public void addShop(String shopId, double longitude, double latitude) jedis.geoadd(SHOP_KEY, longitude, latitude, shopId); // æŸ¥è¯¢é™„è¿‘çš„å•†é“º public ListGeoRadiusResponse getNearbyShops( double longitude, double latitude, double radiusKm) return jedis.georadius(SHOP_KEY, longitude, latitude, radiusKm, GeoUnit.KM, GeoRadiusParam.geoRadiusParam() .withCoord() .withDist() .sortAscending() .count(20)); // è®¡ç®—ä¸¤ä¸ªå•†é“ºä¹‹é—´çš„è·ç¦» public double getShopDistance(String shop1Id, String shop2Id) return jedis.geodist(SHOP_KEY, shop1Id, shop2Id, GeoUnit.KILOMETERS); ä¸ºä»€ä¹ˆä½¿ç”¨ hash ç±»å‹è€Œä¸ä½¿ç”¨ string ç±»å‹åºåˆ—åŒ–å­˜å‚¨ï¼Ÿä¸ºä»€ä¹ˆä½¿ç”¨ hash ç±»å‹è€Œä¸ä½¿ç”¨ string ç±»å‹åºåˆ—åŒ–å­˜å‚¨ï¼ŸHash å¯ä»¥åªè¯»å–æˆ–è€…ä¿®æ”¹æŸä¸€ä¸ªå­—æ®µï¼Œè€Œ String éœ€è¦ä¸€æ¬¡æ€§æŠŠæ•´ä¸ªå¯¹è±¡å–å‡ºæ¥ã€‚ æ¯”å¦‚è¯´æœ‰ä¸€ä¸ªç”¨æˆ·å¯¹è±¡ user {name: â€˜æ²‰é»˜ç‹äºŒâ€™, age: 18}ï¼Œå¦‚æœä½¿ç”¨ Hash å­˜å‚¨ï¼Œå¯ä»¥ç›´æ¥ä¿®æ”¹ age å­—æ®µï¼š redis.hset(user:1, age, 19); å¦‚æœä½¿ç”¨ String å­˜å‚¨ï¼Œéœ€è¦å…ˆå–å‡ºæ•´ä¸ªå¯¹è±¡ï¼Œä¿®æ”¹åå†å­˜å›å»ï¼š String userJson = redis.get(user:1);User user = JSON.parseObject(userJson, User.class);user.setAge(19);redis.set(user:1, JSON.toJSONString(user));","tags":["åŸºç¡€","Java"],"categories":["Javaé—®ç­”ç¬”è®°"]},{"title":"JavaSEå­¦ä¹ ç¬”è®°","path":"/2025/07/22/Javaé—®ç­”ç¬”è®°/JavaSEå­¦ä¹ ç¬”è®°/","content":"Java æ¦‚è¿°1.ğŸŒŸä»€ä¹ˆæ˜¯ Javaï¼ŸJava æ˜¯ä¸€é—¨é¢å‘å¯¹è±¡çš„ç¼–ç¨‹è¯­è¨€ï¼Œç”± Sun å…¬å¸çš„è©¹å§†æ–¯Â·é«˜æ–¯æ—å›¢é˜Ÿäº 1995 å¹´æ¨å‡ºã€‚å¸æ”¶äº† C++ è¯­è¨€ä¸­å¤§é‡çš„ä¼˜ç‚¹ï¼Œä½†åˆæŠ›å¼ƒäº† C++ ä¸­å®¹æ˜“å‡ºé”™çš„åœ°æ–¹ï¼Œå¦‚åƒåœ¾å›æ”¶ã€æŒ‡é’ˆã€‚ åŒæ—¶ï¼ŒJava åˆæ˜¯ä¸€é—¨å¹³å°æ— å…³çš„ç¼–ç¨‹è¯­è¨€ï¼Œå³ä¸€æ¬¡ç¼–è¯‘ï¼Œå¤„å¤„è¿è¡Œã€‚ åªéœ€è¦åœ¨å¯¹åº”çš„å¹³å°ä¸Šå®‰è£… JDKï¼Œå°±å¯ä»¥å®ç°è·¨å¹³å°ï¼Œåœ¨ Windowsã€macOSã€Linux æ“ä½œç³»ç»Ÿä¸Šè¿è¡Œã€‚ Java è¯­è¨€å’Œ C è¯­è¨€æœ‰å“ªäº›åŒºåˆ«ï¼ŸJava æ˜¯ä¸€ç§è·¨å¹³å°çš„ç¼–ç¨‹è¯­è¨€ï¼Œé€šè¿‡åœ¨ä¸åŒæ“ä½œç³»ç»Ÿä¸Šå®‰è£…å¯¹åº”ç‰ˆæœ¬çš„ JVM ä»¥å®ç°â€œä¸€æ¬¡ç¼–è¯‘ï¼Œå¤„å¤„è¿è¡Œâ€çš„ç›®çš„ã€‚è€Œ C è¯­è¨€éœ€è¦åœ¨ä¸åŒçš„æ“ä½œç³»ç»Ÿä¸Šé‡æ–°ç¼–è¯‘ã€‚ Java å®ç°äº†å†…å­˜çš„è‡ªåŠ¨ç®¡ç†ï¼Œè€Œ C è¯­è¨€éœ€è¦ä½¿ç”¨ malloc å’Œ free æ¥æ‰‹åŠ¨ç®¡ç†å†…å­˜ã€‚ 2.Java è¯­è¨€æœ‰å“ªäº›ç‰¹ç‚¹ï¼Ÿ Java è¯­è¨€çš„ç‰¹ç‚¹æœ‰ï¼š â‘ ã€é¢å‘å¯¹è±¡ï¼Œä¸»è¦æ˜¯å°è£…ï¼Œç»§æ‰¿ï¼Œå¤šæ€ã€‚ â‘¡ã€å¹³å°æ— å…³æ€§ï¼Œâ€œä¸€æ¬¡ç¼–å†™ï¼Œåˆ°å¤„è¿è¡Œâ€ï¼Œå› æ­¤é‡‡ç”¨ Java è¯­è¨€ç¼–å†™çš„ç¨‹åºå…·æœ‰å¾ˆå¥½çš„å¯ç§»æ¤æ€§ã€‚ â‘¢ã€æ”¯æŒå¤šçº¿ç¨‹ã€‚C++ è¯­è¨€æ²¡æœ‰å†…ç½®çš„å¤šçº¿ç¨‹æœºåˆ¶ï¼Œå› æ­¤å¿…é¡»è°ƒç”¨æ“ä½œç³»ç»Ÿçš„ API æ¥å®Œæˆå¤šçº¿ç¨‹ç¨‹åºè®¾è®¡ï¼Œè€Œ Java å´æä¾›äº†å°è£…å¥½å¤šçº¿ç¨‹æ”¯æŒï¼› â‘£ã€æ”¯æŒ JIT ç¼–è¯‘ï¼Œä¹Ÿå°±æ˜¯å³æ—¶ç¼–è¯‘å™¨ï¼Œå®ƒå¯ä»¥åœ¨ç¨‹åºè¿è¡Œæ—¶å°†å­—èŠ‚ç è½¬æ¢ä¸ºçƒ­ç‚¹æœºå™¨ç æ¥æé«˜ç¨‹åºçš„è¿è¡Œé€Ÿåº¦ã€‚ 3.JVMã€JDK å’Œ JRE æœ‰ä»€ä¹ˆåŒºåˆ«ï¼Ÿ JVMï¼šä¹Ÿå°±æ˜¯ Java è™šæ‹Ÿæœºï¼Œæ˜¯ Java å®ç°è·¨å¹³å°çš„å…³é”®æ‰€åœ¨ï¼Œä¸åŒçš„æ“ä½œç³»ç»Ÿæœ‰ä¸åŒçš„ JVM å®ç°ã€‚JVM è´Ÿè´£å°† Java å­—èŠ‚ç è½¬æ¢ä¸ºç‰¹å®šå¹³å°çš„æœºå™¨ç ï¼Œå¹¶æ‰§è¡Œã€‚ JREï¼šä¹Ÿå°±æ˜¯ Java è¿è¡Œæ—¶ç¯å¢ƒï¼ŒåŒ…å«äº†è¿è¡Œ Java ç¨‹åºæ‰€å¿…éœ€çš„åº“ï¼Œä»¥åŠ JVMã€‚ JDKï¼šä¸€å¥—å®Œæ•´çš„ Java SDKï¼ŒåŒ…æ‹¬ JREï¼Œç¼–è¯‘å™¨ javacã€Java æ–‡æ¡£ç”Ÿæˆå·¥å…· javadocã€Java å­—èŠ‚ç å·¥å…· javap ç­‰ã€‚ä¸ºå¼€å‘è€…æä¾›äº†å¼€å‘ã€ç¼–è¯‘ã€è°ƒè¯• Java ç¨‹åºçš„ä¸€æ•´å¥—ç¯å¢ƒã€‚ ç®€å•æ¥è¯´ï¼ŒJDK åŒ…å« JREï¼ŒJRE åŒ…å« JVMã€‚ 4.è¯´è¯´ä»€ä¹ˆæ˜¯è·¨å¹³å°ï¼ŸåŸç†æ˜¯ä»€ä¹ˆæ‰€è°“çš„è·¨å¹³å°ï¼Œæ˜¯æŒ‡ Java è¯­è¨€ç¼–å†™çš„ç¨‹åºï¼Œä¸€æ¬¡ç¼–è¯‘åï¼Œå¯ä»¥åœ¨å¤šä¸ªæ“ä½œç³»ç»Ÿä¸Šè¿è¡Œã€‚ åŸç†æ˜¯å¢åŠ äº†ä¸€ä¸ªä¸­é—´ä»¶ JVMï¼ŒJVM è´Ÿè´£å°† Javaå­—èŠ‚ç è½¬æ¢ä¸ºç‰¹å®šå¹³å°çš„æœºå™¨ç ï¼Œå¹¶æ‰§è¡Œã€‚ 5.ä»€ä¹ˆæ˜¯å­—èŠ‚ç ï¼Ÿé‡‡ç”¨å­—èŠ‚ç çš„å¥½å¤„æ˜¯ä»€ä¹ˆ?æ‰€è°“çš„å­—èŠ‚ç ï¼Œå°±æ˜¯ Java ç¨‹åºç»è¿‡ç¼–è¯‘åäº§ç”Ÿçš„ .class æ–‡ä»¶ã€‚ Java ç¨‹åºä»æºä»£ç åˆ°è¿è¡Œéœ€è¦ç»è¿‡ä¸‰æ­¥ï¼š ç¼–è¯‘ï¼šå°†æºä»£ç æ–‡ä»¶ .java ç¼–è¯‘æˆ JVM å¯ä»¥è¯†åˆ«çš„å­—èŠ‚ç æ–‡ä»¶ .class è§£é‡Šï¼šJVM æ‰§è¡Œå­—èŠ‚ç æ–‡ä»¶ï¼Œå°†å­—èŠ‚ç ç¿»è¯‘æˆæ“ä½œç³»ç»Ÿèƒ½è¯†åˆ«çš„æœºå™¨ç  æ‰§è¡Œï¼šæ“ä½œç³»ç»Ÿæ‰§è¡ŒäºŒè¿›åˆ¶çš„æœºå™¨ç  6.ä¸ºä»€ä¹ˆæœ‰äººè¯´ Java æ˜¯â€œç¼–è¯‘ä¸è§£é‡Šå¹¶å­˜â€çš„è¯­è¨€ï¼Ÿç¼–è¯‘å‹è¯­è¨€æ˜¯æŒ‡ç¼–è¯‘å™¨é’ˆå¯¹ç‰¹å®šçš„æ“ä½œç³»ç»Ÿï¼Œå°†æºä»£ç ä¸€æ¬¡æ€§ç¿»è¯‘æˆå¯è¢«è¯¥å¹³å°æ‰§è¡Œçš„æœºå™¨ç ã€‚ è§£é‡Šå‹è¯­è¨€æ˜¯æŒ‡è§£é‡Šå™¨å¯¹æºä»£ç è¿›è¡Œé€è¡Œè§£é‡Šï¼Œè§£é‡Šæˆç‰¹å®šå¹³å°çš„æœºå™¨ç å¹¶æ‰§è¡Œã€‚ ä¸¾ä¸ªä¾‹å­ï¼Œæˆ‘æƒ³è¯»ä¸€æœ¬å›½å¤–çš„å°è¯´ï¼Œæˆ‘æœ‰ä¸¤ç§é€‰æ‹©ï¼š æ‰¾ä¸ªç¿»è¯‘ï¼Œç­‰ç¿»è¯‘å°†å°è¯´å…¨éƒ¨éƒ½ç¿»è¯‘æˆæ±‰è¯­ï¼Œä¸€æ¬¡æ€§è¯»å®Œã€‚ æ‰¾ä¸ªç¿»è¯‘ï¼Œç¿»è¯‘ä¸€æ®µæˆ‘è¯»ä¸€æ®µï¼Œæ…¢æ…¢æŠŠä¹¦è¯»å®Œã€‚ ä¹‹æ‰€ä»¥æœ‰äººè¯´ Java æ˜¯â€œç¼–è¯‘ä¸è§£é‡Šå¹¶å­˜â€çš„è¯­è¨€ï¼Œæ˜¯å› ä¸º Java ç¨‹åºéœ€è¦å…ˆå°† Java æºä»£ç æ–‡ä»¶ç¼–è¯‘å­—èŠ‚ç æ–‡ä»¶ï¼Œå†è§£é‡Šæ‰§è¡Œã€‚ åŸºç¡€è¯­æ³•7.ğŸŒŸJava æœ‰å“ªäº›æ•°æ®ç±»å‹ï¼ŸJava çš„æ•°æ®ç±»å‹å¯ä»¥åˆ†ä¸ºä¸¤ç§ï¼šåŸºæœ¬æ•°æ®ç±»å‹å’Œå¼•ç”¨æ•°æ®ç±»å‹ã€‚ åŸºæœ¬æ•°æ®ç±»å‹æœ‰ï¼šâ‘ ã€æ•°å€¼å‹ æ•´æ•°ç±»å‹ï¼ˆbyteã€shortã€intã€longï¼‰ æµ®ç‚¹ç±»å‹ï¼ˆfloatã€doubleï¼‰ â‘¡ã€å­—ç¬¦å‹ï¼ˆcharï¼‰â‘¢ã€å¸ƒå°”å‹ï¼ˆbooleanï¼‰å®ƒä»¬çš„é»˜è®¤å€¼å’Œå ç”¨å¤§å°å¦‚ä¸‹æ‰€ç¤ºï¼š å¼•ç”¨æ•°æ®ç±»å‹æœ‰ï¼š ç±»ï¼ˆclassï¼‰ æ¥å£ï¼ˆinterfaceï¼‰ æ•°ç»„ï¼ˆ[]ï¼‰ boolean ç±»å‹å®é™…å ç”¨å‡ ä¸ªå­—èŠ‚ï¼Ÿæ¨èé˜…è¯»ï¼šJava è¿›é˜¶ä¹‹è·¯ï¼šåŸºæœ¬æ•°æ®ç±»å‹ç¯‡ è¿™è¦ä¾æ®å…·ä½“çš„ JVM å®ç°ç»†èŠ‚ã€‚Java è™šæ‹Ÿæœºè§„èŒƒä¸­ï¼Œå¹¶æ²¡æœ‰æ˜ç¡®è§„å®š boolean ç±»å‹çš„å¤§å°ï¼Œåªè§„å®šäº† boolean ç±»å‹çš„å–å€¼ true æˆ– falseã€‚ boolean: The boolean data type has only two possible values: true and false. Use this data type for simple flags that track truefalse conditions. This data type represents one bit of information, but its â€œsizeâ€ isnâ€™t something thatâ€™s precisely defined. æˆ‘æœ¬æœºçš„ 64 ä½ JDK ä¸­ï¼Œé€šè¿‡ JOL å·¥å…·æŸ¥çœ‹å•ç‹¬çš„ boolean ç±»å‹ï¼Œä»¥åŠ boolean æ•°ç»„ï¼Œæ‰€å ç”¨çš„ç©ºé—´éƒ½æ˜¯ 1 ä¸ªå­—èŠ‚ã€‚ ç»™Integeræœ€å¤§å€¼+1ï¼Œæ˜¯ä»€ä¹ˆç»“æœï¼Ÿå½“ç»™ Integer.MAX_VALUE åŠ  1 æ—¶ï¼Œä¼šå‘ç”Ÿæº¢å‡ºï¼Œå˜æˆ Integer.MIN_VALUEã€‚ int maxValue = Integer.MAX_VALUE;System.out.println(Integer.MAX_VALUE = + maxValue); // Integer.MAX_VALUE = 2147483647System.out.println(Integer.MAX_VALUE + 1 = + (maxValue + 1)); // Integer.MAX_VALUE + 1 = -2147483648// ç”¨äºŒè¿›åˆ¶æ¥è¡¨ç¤ºæœ€å¤§å€¼å’Œæœ€å°å€¼System.out.println(Integer.MAX_VALUE in binary: + Integer.toBinaryString(maxValue)); // Integer.MAX_VALUE in binary: 1111111111111111111111111111111System.out.println(Integer.MIN_VALUE in binary: + Integer.toBinaryString(Integer.MIN_VALUE)); // Integer.MIN_VALUE in binary: 10000000000000000000000000000000 è¿™æ˜¯å› ä¸º Java çš„æ•´æ•°ç±»å‹é‡‡ç”¨çš„æ˜¯äºŒè¿›åˆ¶è¡¥ç è¡¨ç¤ºæ³•ï¼Œæº¢å‡ºæ—¶å€¼ä¼šå˜æˆæœ€å°å€¼ã€‚ Integer.MAX_VALUE çš„äºŒè¿›åˆ¶è¡¨ç¤ºæ˜¯ 01111111 11111111 11111111 11111111ï¼ˆ32 ä½ï¼‰ã€‚ åŠ  1 åç»“æœå˜æˆ 10000000 00000000 00000000 00000000ï¼Œå³ -2147483648ï¼ˆInteger.MIN_VALUEï¼‰ã€‚ 8.è‡ªåŠ¨ç±»å‹è½¬æ¢ã€å¼ºåˆ¶ç±»å‹è½¬æ¢äº†è§£å—ï¼Ÿæ¨èé˜…è¯»ï¼šèŠèŠåŸºæœ¬æ•°æ®ç±»å‹çš„è½¬æ¢ å½“æŠŠä¸€ä¸ªèŒƒå›´è¾ƒå°çš„æ•°å€¼æˆ–å˜é‡èµ‹ç»™å¦å¤–ä¸€ä¸ªèŒƒå›´è¾ƒå¤§çš„å˜é‡æ—¶ï¼Œä¼šè¿›è¡Œè‡ªåŠ¨ç±»å‹è½¬æ¢ï¼›åä¹‹ï¼Œéœ€è¦å¼ºåˆ¶è½¬æ¢ã€‚ è¿™å°±å¥½åƒï¼Œå°æ¯é‡Œçš„æ°´å€’è¿›å¤§æ¯æ²¡é—®é¢˜ï¼Œä½†å¤§æ¯çš„æ°´å€’è¿›å°æ¯å°±å¯èƒ½ä¼šæº¢å‡ºã€‚ â‘ ã€float f=3.4ï¼Œå¯¹å—ï¼Ÿ ä¸æ­£ç¡®ã€‚3.4 é»˜è®¤æ˜¯åŒç²¾åº¦ï¼Œå°†åŒç²¾åº¦èµ‹å€¼ç»™æµ®ç‚¹å‹å±äºä¸‹è½¬å‹ï¼ˆdown-castingï¼Œä¹Ÿç§°çª„åŒ–ï¼‰ä¼šé€ æˆç²¾åº¦ä¸¢å¤±ï¼Œå› æ­¤éœ€è¦å¼ºåˆ¶ç±»å‹è½¬æ¢float f =(float)3.4;æˆ–è€…å†™æˆfloat f =3.4F â‘¡ã€short s1 = 1; s1 = s1 + 1ï¼›å¯¹å—ï¼Ÿshort s1 = 1; s1 += 1;å¯¹å—ï¼Ÿ short s1 = 1; s1 = s1 + 1;Â ä¼šç¼–è¯‘å‡ºé”™ï¼Œç”±äº 1 æ˜¯ int ç±»å‹ï¼Œå› æ­¤ s1+1 è¿ç®—ç»“æœä¹Ÿæ˜¯ int å‹ï¼Œéœ€è¦å¼ºåˆ¶è½¬æ¢ç±»å‹æ‰èƒ½èµ‹å€¼ç»™ short å‹ã€‚ è€ŒÂ short s1 = 1; s1 += 1;å¯ä»¥æ­£ç¡®ç¼–è¯‘ï¼Œå› ä¸ºÂ s1+= 1;ç›¸å½“äºÂ s1 = (short(s1 + 1);Â å…¶ä¸­æœ‰éšå«çš„å¼ºåˆ¶ç±»å‹è½¬æ¢ã€‚ 9.ä»€ä¹ˆæ˜¯è‡ªåŠ¨æ‹†ç®±è£…ç®±ï¼Ÿ è£…ç®±ï¼šå°†åŸºæœ¬æ•°æ®ç±»å‹è½¬æ¢ä¸ºåŒ…è£…ç±»å‹ï¼Œä¾‹å¦‚ int è½¬æ¢ä¸º Integerã€‚ æ‹†ç®±ï¼šå°†åŒ…è£…ç±»å‹è½¬æ¢ä¸ºåŸºæœ¬æ•°æ®ç±»å‹ã€‚ ä¸¾ä¾‹ï¼š Integer i = 10; //è£…ç®±int n = i; //æ‹†ç®± å†æ¢å¥è¯è¯´ï¼Œi æ˜¯ Integer ç±»å‹ï¼Œn æ˜¯ int ç±»å‹ï¼›å˜é‡ i æ˜¯åŒ…è£…å™¨ç±»ï¼Œå˜é‡ n æ˜¯åŸºæœ¬æ•°æ®ç±»å‹ã€‚ 10.å’Œæœ‰ä»€ä¹ˆåŒºåˆ«ï¼ŸÂ æ˜¯Â é€»è¾‘ä¸ã€‚ æ˜¯çŸ­è·¯ä¸è¿ç®—ã€‚é€»è¾‘ä¸è·ŸçŸ­è·¯ä¸çš„å·®åˆ«æ˜¯éå¸¸å¤§çš„ï¼Œè™½ç„¶äºŒè€…éƒ½è¦æ±‚è¿ç®—ç¬¦å·¦å³ä¸¤ç«¯çš„å¸ƒå°”å€¼éƒ½æ˜¯ trueï¼Œæ•´ä¸ªè¡¨è¾¾å¼çš„å€¼æ‰æ˜¯ trueã€‚ ä¹‹æ‰€ä»¥ç§°ä¸ºçŸ­è·¯è¿ç®—æ˜¯å› ä¸ºï¼Œå¦‚æœå·¦è¾¹çš„è¡¨è¾¾å¼çš„å€¼æ˜¯ falseï¼Œå³è¾¹çš„è¡¨è¾¾å¼ä¼šç›´æ¥çŸ­è·¯æ‰ï¼Œä¸ä¼šè¿›è¡Œè¿ç®—ã€‚ ä¾‹å¦‚åœ¨éªŒè¯ç”¨æˆ·ç™»å½•æ—¶åˆ¤å®šç”¨æˆ·åä¸æ˜¯ null è€Œä¸”ä¸æ˜¯ç©ºå­—ç¬¦ä¸²ï¼Œåº”å½“å†™ä¸ºusername != null !username.equals()ï¼ŒäºŒè€…çš„é¡ºåºä¸èƒ½äº¤æ¢ï¼Œæ›´ä¸èƒ½ç”¨ è¿ç®—ç¬¦ï¼Œå› ä¸ºç¬¬ä¸€ä¸ªæ¡ä»¶å¦‚æœä¸æˆç«‹ï¼Œæ ¹æœ¬ä¸èƒ½è¿›è¡Œå­—ç¬¦ä¸²çš„ equals æ¯”è¾ƒï¼Œä¼šæŠ›å‡ºÂ NullPointerException å¼‚å¸¸ã€‚ æ³¨æ„ï¼šé€»è¾‘æˆ–è¿ç®—ç¬¦ï¼ˆ|ï¼‰å’ŒçŸ­è·¯æˆ–è¿ç®—ç¬¦ï¼ˆ||ï¼‰çš„å·®åˆ«ä¹Ÿæ˜¯ç±»ä¼¼ã€‚ 11.switch è¯­å¥èƒ½å¦ç”¨åœ¨ bytelongString ç±»å‹ä¸Šï¼ŸJava 5 ä»¥å‰Â switch(expr)Â ä¸­ï¼Œexpr åªèƒ½æ˜¯ byteã€shortã€charã€intã€‚ ä» Java 5 å¼€å§‹ï¼ŒJava ä¸­å¼•å…¥äº†æšä¸¾ç±»å‹ï¼Œ expr ä¹Ÿå¯ä»¥æ˜¯ enum ç±»å‹ã€‚ ä» Java 7 å¼€å§‹ï¼Œexpr è¿˜å¯ä»¥æ˜¯å­—ç¬¦ä¸²ï¼Œä½†æ˜¯é•¿æ•´å‹åœ¨ç›®å‰æ‰€æœ‰çš„ç‰ˆæœ¬ä¸­éƒ½æ˜¯ä¸å¯ä»¥çš„ã€‚ 12.break,continue,return çš„åŒºåˆ«åŠä½œç”¨ï¼Ÿ break è·³å‡ºæ•´ä¸ªå¾ªç¯ï¼Œä¸å†æ‰§è¡Œå¾ªç¯(ç»“æŸå½“å‰çš„å¾ªç¯ä½“) continue è·³å‡ºæœ¬æ¬¡å¾ªç¯ï¼Œç»§ç»­æ‰§è¡Œä¸‹æ¬¡å¾ªç¯(ç»“æŸæ­£åœ¨æ‰§è¡Œçš„å¾ªç¯ è¿›å…¥ä¸‹ä¸€ä¸ªå¾ªç¯æ¡ä»¶) return ç¨‹åºè¿”å›ï¼Œä¸å†æ‰§è¡Œä¸‹é¢çš„ä»£ç (ç»“æŸå½“å‰çš„æ–¹æ³• ç›´æ¥è¿”å›) 13.ç”¨æ•ˆç‡æœ€é«˜çš„æ–¹æ³•è®¡ç®— 2 ä¹˜ä»¥ 8ï¼Ÿ2 3ã€‚ä½è¿ç®—ï¼Œæ•°å­—çš„äºŒè¿›åˆ¶ä½å·¦ç§»ä¸‰ä½ç›¸å½“äºä¹˜ä»¥ 2 çš„ä¸‰æ¬¡æ–¹ã€‚ 14.è¯´è¯´è‡ªå¢è‡ªå‡è¿ç®—ï¼Ÿåœ¨å†™ä»£ç çš„è¿‡ç¨‹ä¸­ï¼Œå¸¸è§çš„ä¸€ç§æƒ…å†µæ˜¯éœ€è¦æŸä¸ªæ•´æ•°ç±»å‹å˜é‡å¢åŠ  1 æˆ–å‡å°‘ 1ï¼ŒJava æä¾›äº†ä¸€ç§ç‰¹æ®Šçš„è¿ç®—ç¬¦ï¼Œç”¨äºè¿™ç§è¡¨è¾¾å¼ï¼Œå«åšè‡ªå¢è¿ç®—ç¬¦ï¼ˆ++ï¼‰å’Œè‡ªå‡è¿ç®—ç¬¦ï¼ˆâ€“ï¼‰ã€‚ ++å’Œâ€“è¿ç®—ç¬¦å¯ä»¥æ”¾åœ¨å˜é‡ä¹‹å‰ï¼Œä¹Ÿå¯ä»¥æ”¾åœ¨å˜é‡ä¹‹åã€‚ å½“è¿ç®—ç¬¦æ”¾åœ¨å˜é‡ä¹‹å‰æ—¶(å‰ç¼€)ï¼Œå…ˆè‡ªå¢å‡ï¼Œå†èµ‹å€¼ï¼›å½“è¿ç®—ç¬¦æ”¾åœ¨å˜é‡ä¹‹åæ—¶(åç¼€)ï¼Œå…ˆèµ‹å€¼ï¼Œå†è‡ªå¢å‡ã€‚ ä¾‹å¦‚ï¼Œå½“Â b = ++aÂ æ—¶ï¼Œå…ˆè‡ªå¢ï¼ˆè‡ªå·±å¢åŠ  1ï¼‰ï¼Œå†èµ‹å€¼ï¼ˆèµ‹å€¼ç»™ bï¼‰ï¼›å½“Â b = a++Â æ—¶ï¼Œå…ˆèµ‹å€¼(èµ‹å€¼ç»™ b)ï¼Œå†è‡ªå¢ï¼ˆè‡ªå·±å¢åŠ  1ï¼‰ã€‚ä¹Ÿå°±æ˜¯ï¼Œ++a è¾“å‡ºçš„æ˜¯ a+1 çš„å€¼ï¼Œa++è¾“å‡ºçš„æ˜¯ a å€¼ã€‚ ç”¨ä¸€å¥å£è¯€å°±æ˜¯ï¼šâ€œç¬¦å·åœ¨å‰å°±å…ˆåŠ å‡ï¼Œç¬¦å·åœ¨åå°±ååŠ å‡â€ã€‚ çœ‹ä¸€ä¸‹è¿™æ®µä»£ç è¿è¡Œç»“æœï¼Ÿint i = 1;i = i++;System.out.println(i); ç­”æ¡ˆæ˜¯ 1ã€‚æœ‰ç‚¹ç¦»è°±å¯¹ä¸å¯¹ã€‚ å¯¹äº JVM è€Œè¨€ï¼Œå®ƒå¯¹è‡ªå¢è¿ç®—çš„å¤„ç†ï¼Œæ˜¯ä¼šå…ˆå®šä¹‰ä¸€ä¸ªä¸´æ—¶å˜é‡æ¥æ¥æ”¶ i çš„å€¼ï¼Œç„¶åè¿›è¡Œè‡ªå¢è¿ç®—ï¼Œæœ€ååˆå°†ä¸´æ—¶å˜é‡èµ‹ç»™äº†å€¼ä¸º 2 çš„ iï¼Œæ‰€ä»¥æœ€åçš„ç»“æœä¸º 1ã€‚ ç›¸å½“äºè¿™æ ·çš„ä»£ç ï¼š int i = 1ï¼›int temp = i;i++ï¼›i = temp;System.out.println(i); è¿™æ®µä»£ç ä¼šè¾“å‡ºä»€ä¹ˆï¼Ÿint count = 0;for(int i = 0;i 100;i++) count = count++;System.out.println(count = +count); ç­”æ¡ˆæ˜¯ 0ã€‚ å’Œä¸Šé¢çš„é¢˜ç›®ä¸€æ ·çš„é“ç†ï¼ŒåŒæ ·æ˜¯ç”¨äº†ä¸´æ—¶å˜é‡ï¼Œcount å®é™…æ˜¯ç­‰äºä¸´æ—¶å˜é‡çš„å€¼ã€‚ int autoAdd(int count) int temp = count; count = count + 1; return temp; 15.float æ˜¯æ€ä¹ˆè¡¨ç¤ºå°æ•°çš„ï¼Ÿï¼ˆè¡¥å……ï¼‰æ¨èé˜…è¯»ï¼šè®¡ç®—æœºç³»ç»ŸåŸºç¡€ï¼ˆå››ï¼‰æµ®ç‚¹æ•° floatç±»å‹çš„å°æ•°åœ¨è®¡ç®—æœºä¸­æ˜¯é€šè¿‡ IEEE 754 æ ‡å‡†çš„å•ç²¾åº¦æµ®ç‚¹æ•°æ ¼å¼æ¥è¡¨ç¤ºçš„ã€‚ Sï¼šç¬¦å·ä½ï¼Œ0 ä»£è¡¨æ­£æ•°ï¼Œ1 ä»£è¡¨è´Ÿæ•°ï¼› Mï¼šå°¾æ•°éƒ¨åˆ†ï¼Œç”¨äºè¡¨ç¤ºæ•°å€¼çš„ç²¾åº¦ï¼›æ¯”å¦‚è¯´Â ï¼›1.25 å°±æ˜¯å°¾æ•°ï¼› Rï¼šåŸºæ•°ï¼Œåè¿›åˆ¶ä¸­çš„åŸºæ•°æ˜¯ 10ï¼ŒäºŒè¿›åˆ¶ä¸­çš„åŸºæ•°æ˜¯ 2ï¼› Eï¼šæŒ‡æ•°éƒ¨åˆ†ï¼Œä¾‹å¦‚ ä¸­çš„ -1 å°±æ˜¯æŒ‡æ•°ã€‚ è¿™ç§è¡¨ç¤ºæ–¹æ³•å¯ä»¥å°†éå¸¸å¤§æˆ–éå¸¸å°çš„æ•°å€¼ç”¨æœ‰é™çš„ä½æ•°è¡¨ç¤ºå‡ºæ¥ï¼Œä½†è¿™ä¹Ÿæ„å‘³ç€å¯èƒ½ä¼šæœ‰ç²¾åº¦ä¸Šçš„æŸå¤±ã€‚ å•ç²¾åº¦æµ®ç‚¹æ•°å ç”¨ 4 å­—èŠ‚ï¼ˆ32 ä½ï¼‰ï¼Œè¿™ 32 ä½è¢«åˆ†ä¸ºä¸‰ä¸ªéƒ¨åˆ†ï¼šç¬¦å·ä½ã€æŒ‡æ•°éƒ¨åˆ†å’Œå°¾æ•°éƒ¨åˆ†ã€‚ ç¬¦å·ä½ï¼ˆSign bitï¼‰ï¼š1 ä½ æŒ‡æ•°éƒ¨åˆ†ï¼ˆExponentï¼‰ï¼š10 ä½ å°¾æ•°éƒ¨åˆ†ï¼ˆMantissaï¼Œæˆ– Fractionï¼‰ï¼š21 ä½ æŒ‰ç…§è¿™ä¸ªè§„åˆ™ï¼Œå°†åè¿›åˆ¶æ•° 25.125 è½¬æ¢ä¸ºæµ®ç‚¹æ•°ï¼Œè½¬æ¢è¿‡ç¨‹æ˜¯è¿™æ ·çš„ï¼š æ•´æ•°éƒ¨åˆ†ï¼š25 è½¬æ¢ä¸ºäºŒè¿›åˆ¶æ˜¯ 11001ï¼› å°æ•°éƒ¨åˆ†ï¼š0.125 è½¬æ¢ä¸ºäºŒè¿›åˆ¶æ˜¯ 0.001ï¼› ç”¨äºŒè¿›åˆ¶ç§‘å­¦è®¡æ•°æ³•è¡¨ç¤ºï¼š25.125 ç¬¦å·ä½ S æ˜¯ 0ï¼Œè¡¨ç¤ºæ­£æ•°ï¼›æŒ‡æ•°éƒ¨åˆ† E æ˜¯ 4ï¼Œè½¬æ¢ä¸ºäºŒè¿›åˆ¶æ˜¯ 100ï¼›å°¾æ•°éƒ¨åˆ† M æ˜¯ 1.001001ã€‚ ä½¿ç”¨æµ®ç‚¹æ•°æ—¶éœ€è¦æ³¨æ„ï¼Œç”±äºç²¾åº¦çš„é™åˆ¶ï¼Œè¿›è¡Œæ•°å­¦è¿ç®—æ—¶å¯èƒ½ä¼šé‡åˆ°èˆå…¥è¯¯å·®ï¼Œç‰¹åˆ«æ˜¯è¿ç»­è¿ç®—ç´¯ç§¯è¯¯å·®å¯èƒ½ä¼šå˜å¾—æ˜¾è‘—ã€‚ å¯¹äºéœ€è¦é«˜ç²¾åº¦è®¡ç®—çš„åœºæ™¯ï¼ˆå¦‚é‡‘èè®¡ç®—ï¼‰ï¼Œå¯èƒ½éœ€è¦è€ƒè™‘ä½¿ç”¨BigDecimalç±»æ¥é¿å…è¿™ç§è¯¯å·®ã€‚ 16.è®²ä¸€ä¸‹æ•°æ®å‡†ç¡®æ€§é«˜æ˜¯æ€ä¹ˆä¿è¯çš„ï¼Ÿï¼ˆè¡¥å……ï¼‰åœ¨é‡‘èè®¡ç®—ä¸­ï¼Œä¿è¯æ•°æ®å‡†ç¡®æ€§æœ‰ä¸¤ç§æ–¹æ¡ˆï¼Œä¸€ç§ä½¿ç”¨Â BigDecimalï¼Œä¸€ç§å°†æµ®ç‚¹æ•°è½¬æ¢ä¸ºæ•´æ•° int è¿›è¡Œè®¡ç®—ã€‚ è‚¯å®šä¸èƒ½ä½¿ç”¨Â floatÂ å’ŒÂ doubleÂ ç±»å‹ï¼Œå®ƒä»¬æ— æ³•é¿å…æµ®ç‚¹æ•°è¿ç®—ä¸­å¸¸è§çš„ç²¾åº¦é—®é¢˜ï¼Œå› ä¸ºè¿™äº›æ•°æ®ç±»å‹é‡‡ç”¨äºŒè¿›åˆ¶æµ®ç‚¹æ•°æ¥è¡¨ç¤ºï¼Œæ— æ³•å‡†ç¡®åœ°è¡¨ç¤ºï¼Œä¾‹å¦‚Â 0.1ã€‚ BigDecimal num1 = new BigDecimal(0.1);BigDecimal num2 = new BigDecimal(0.2);BigDecimal sum = num1.add(num2);System.out.println(Sum of 0.1 and 0.2 using BigDecimal: + sum); // è¾“å‡º 0.3ï¼Œç²¾ç¡®è®¡ç®— åœ¨å¤„ç†å°é¢æ”¯ä»˜æˆ–è®¡ç®—æ—¶ï¼Œé€šè¿‡è½¬æ¢ä¸ºè¾ƒå°çš„è´§å¸å•ä½ï¼ˆå¦‚åˆ†ï¼‰ï¼Œè¿™æ ·ä¸ä»…æé«˜äº†è¿ç®—é€Ÿåº¦ï¼Œè¿˜ä¿è¯äº†è®¡ç®—çš„å‡†ç¡®æ€§ã€‚ int priceInCents = 199; // å•†å“ä»·æ ¼199åˆ†int quantity = 3;int totalInCents = priceInCents * quantity; // è®¡ç®—æ€»ä»·System.out.println(Total price in cents: + totalInCents); // è¾“å‡º597åˆ† é¢å‘å¯¹è±¡17.â¾¯å‘å¯¹è±¡å’Œâ¾¯å‘è¿‡ç¨‹çš„åŒºåˆ«?é¢å‘è¿‡ç¨‹æ˜¯ä»¥è¿‡ç¨‹ä¸ºæ ¸å¿ƒï¼Œé€šè¿‡å‡½æ•°å®Œæˆä»»åŠ¡ï¼Œç¨‹åºç»“æ„æ˜¯å‡½æ•°+æ­¥éª¤ç»„æˆçš„é¡ºåºæµç¨‹ã€‚ é¢å‘å¯¹è±¡æ˜¯ä»¥å¯¹è±¡ä¸ºæ ¸å¿ƒï¼Œé€šè¿‡å¯¹è±¡äº¤äº’å®Œæˆä»»åŠ¡ï¼Œç¨‹åºç»“æ„æ˜¯ç±»å’Œå¯¹è±¡ç»„æˆçš„æ¨¡å—åŒ–ç»“æ„ï¼Œä»£ç å¯ä»¥é€šè¿‡ç»§æ‰¿ã€ç»„åˆã€å¤šæ€ç­‰æ–¹å¼å¤ç”¨ã€‚ é¢å‘è¿‡ç¨‹å°±æ˜¯ç¼–å¹´ä½“,é¢å‘å¯¹è±¡å°±æ˜¯çºªä¼ ä½“. 18.ğŸŒŸé¢å‘å¯¹è±¡ç¼–ç¨‹æœ‰å“ªäº›ç‰¹æ€§ï¼Ÿæ¨èé˜…è¯»ï¼šæ·±å…¥ç†è§£ Java ä¸‰å¤§ç‰¹æ€§ é¢å‘å¯¹è±¡ç¼–ç¨‹æœ‰ä¸‰å¤§ç‰¹æ€§ï¼šå°è£…ã€ç»§æ‰¿ã€å¤šæ€ã€‚ å°è£…æ˜¯ä»€ä¹ˆï¼Ÿå°è£…æ˜¯æŒ‡å°†æ•°æ®ï¼ˆå±æ€§ï¼Œæˆ–è€…å«å­—æ®µï¼‰å’Œæ“ä½œæ•°æ®çš„æ–¹æ³•ï¼ˆè¡Œä¸ºï¼‰æ†ç»‘åœ¨ä¸€èµ·ï¼Œå½¢æˆä¸€ä¸ªç‹¬ç«‹çš„å¯¹è±¡ï¼ˆç±»çš„å®ä¾‹ï¼‰ã€‚ class Nvshen private String name; private int age; public void setName(String name) this.name = name; public String getName() return name; public void setAge(int age) this.age = age; å¯ä»¥çœ‹å¾—å‡ºï¼Œå¥³ç¥ç±»å¯¹å¤–æ²¡æœ‰æä¾› age çš„ getter æ–¹æ³•ï¼Œå› ä¸ºå¥³ç¥çš„å¹´é¾„è¦ä¿å¯†ã€‚ æ‰€ä»¥ï¼Œå°è£…æ˜¯æŠŠä¸€ä¸ªå¯¹è±¡çš„å±æ€§ç§æœ‰åŒ–ï¼ŒåŒæ—¶æä¾›ä¸€äº›å¯ä»¥è¢«å¤–ç•Œè®¿é—®çš„æ–¹æ³•ã€‚ ç»§æ‰¿æ˜¯ä»€ä¹ˆï¼Ÿç»§æ‰¿å…è®¸ä¸€ä¸ªç±»ï¼ˆå­ç±»ï¼‰ç»§æ‰¿ç°æœ‰ç±»ï¼ˆçˆ¶ç±»æˆ–è€…åŸºç±»ï¼‰çš„å±æ€§å’Œæ–¹æ³•ã€‚ä»¥æé«˜ä»£ç çš„å¤ç”¨æ€§ï¼Œå»ºç«‹ç±»ä¹‹é—´çš„å±‚æ¬¡å…³ç³»ã€‚ åŒæ—¶ï¼Œå­ç±»è¿˜å¯ä»¥é‡å†™æˆ–è€…æ‰©å±•ä»çˆ¶ç±»ç»§æ‰¿æ¥çš„å±æ€§å’Œæ–¹æ³•ï¼Œä»è€Œå®ç°å¤šæ€ã€‚ class Person protected String name; protected int age; public void eat() System.out.println(åƒé¥­); class Student extends Person private String school; public void study() System.out.println(å­¦ä¹ ); Student ç±»ç»§æ‰¿äº† Person ç±»çš„å±æ€§ï¼ˆnameã€ageï¼‰å’Œæ–¹æ³•ï¼ˆeatï¼‰ï¼ŒåŒæ—¶è¿˜æœ‰è‡ªå·±çš„å±æ€§ï¼ˆschoolï¼‰å’Œæ–¹æ³•ï¼ˆstudyï¼‰ã€‚ ä»€ä¹ˆæ˜¯å¤šæ€ï¼Ÿå¤šæ€å…è®¸ä¸åŒç±»çš„å¯¹è±¡å¯¹åŒä¸€æ¶ˆæ¯åšå‡ºå“åº”ï¼Œä½†è¡¨ç°å‡ºä¸åŒçš„è¡Œä¸ºï¼ˆå³æ–¹æ³•çš„å¤šæ ·æ€§ï¼‰ã€‚ å¤šæ€å…¶å®æ˜¯ä¸€ç§èƒ½åŠ›â€”â€”åŒä¸€ä¸ªè¡Œä¸ºå…·æœ‰ä¸åŒçš„è¡¨ç°å½¢å¼ï¼›æ¢å¥è¯è¯´å°±æ˜¯ï¼Œæ‰§è¡Œä¸€æ®µä»£ç ï¼ŒJava åœ¨è¿è¡Œæ—¶èƒ½æ ¹æ®å¯¹è±¡ç±»å‹çš„ä¸åŒäº§ç”Ÿä¸åŒçš„ç»“æœã€‚ å¤šæ€çš„å‰ç½®æ¡ä»¶æœ‰ä¸‰ä¸ªï¼š å­ç±»ç»§æ‰¿çˆ¶ç±» å­ç±»é‡å†™çˆ¶ç±»çš„æ–¹æ³• çˆ¶ç±»å¼•ç”¨æŒ‡å‘å­ç±»çš„å¯¹è±¡ //å­ç±»ç»§æ‰¿çˆ¶ç±»class Wangxiaoer extends Wanger public void write() // å­ç±»é‡å†™çˆ¶ç±»æ–¹æ³• System.out.println(è®°ä½ä»‡æ¨ï¼Œè¡¨æ˜æˆ‘ä»¬è¦å¥‹å‘å›¾å¼ºçš„å¿ƒæ™º); public static void main(String[] args) // çˆ¶ç±»å¼•ç”¨æŒ‡å‘å­ç±»å¯¹è±¡ Wanger wanger = new Wangxiaoer(); wanger.write(); class Wanger public void write() System.out.println(ç‹äºŒæ˜¯æ²™é›•); ä¸ºä»€ä¹ˆJavaé‡Œé¢è¦å¤šç»„åˆå°‘ç»§æ‰¿ï¼Ÿç»§æ‰¿é€‚åˆæè¿°â€œis-aâ€çš„å…³ç³»ï¼Œä½†ç»§æ‰¿å®¹æ˜“å¯¼è‡´ç±»ä¹‹é—´çš„å¼ºè€¦åˆï¼Œä¸€æ—¦çˆ¶ç±»å‘ç”Ÿæ”¹å˜ï¼Œå­ç±»ä¹Ÿè¦éšä¹‹æ”¹å˜ï¼Œè¿èƒŒäº†å¼€é—­åŸåˆ™ï¼ˆå°½é‡ä¸ä¿®æ”¹ç°æœ‰ä»£ç ï¼Œè€Œæ˜¯æ·»åŠ æ–°çš„ä»£ç æ¥å®ç°ï¼‰ã€‚ ç»„åˆé€‚åˆæè¿°â€œhas-aâ€æˆ–â€œcan-doâ€çš„å…³ç³»ï¼Œé€šè¿‡åœ¨ç±»ä¸­ç»„åˆå…¶ä»–ç±»ï¼Œèƒ½å¤Ÿæ›´çµæ´»åœ°æ‰©å±•åŠŸèƒ½ã€‚ç»„åˆé¿å…äº†å¤æ‚çš„ç±»ç»§æ‰¿ä½“ç³»ï¼ŒåŒæ—¶éµå¾ªäº†å¼€é—­åŸåˆ™å’Œæ¾è€¦åˆçš„è®¾è®¡åŸåˆ™ã€‚ ä¸¾ä¸ªä¾‹å­ï¼Œå‡è®¾æˆ‘ä»¬é‡‡ç”¨ç»§æ‰¿ï¼Œæ¯ç§å½¢çŠ¶å’Œæ ·å¼çš„ç»„åˆéƒ½ä¼šå¯¼è‡´ç±»çš„æ€¥å‰§å¢åŠ ï¼š // åŸºç±»class Shape public void draw() System.out.println(Drawing a shape); // åœ†å½¢class Circle extends Shape @Override public void draw() System.out.println(Drawing a circle); // å¸¦çº¢è‰²çš„åœ†å½¢class RedCircle extends Circle @Override public void draw() System.out.println(Drawing a red circle); // å¸¦ç»¿è‰²çš„åœ†å½¢class GreenCircle extends Circle @Override public void draw() System.out.println(Drawing a green circle); // ç±»ä¼¼çš„ï¼Œå¯¹äºçŸ©å½¢ä¹Ÿè¦åˆ›å»ºå¤šä¸ªç±»class Rectangle extends Shape @Override public void draw() System.out.println(Drawing a rectangle); class RedRectangle extends Rectangle @Override public void draw() System.out.println(Drawing a red rectangle); ç»„åˆæ¨¡å¼æ›´åŠ çµæ´»ï¼Œå¯ä»¥å°†å½¢çŠ¶å’Œé¢œè‰²åˆ†å¼€ï¼Œæ¾è€¦åˆã€‚ // å½¢çŠ¶æ¥å£interface Shape void draw();// é¢œè‰²æ¥å£interface Color void applyColor(); å½¢çŠ¶å¹²å½¢çŠ¶çš„äº‹æƒ…ã€‚ // åœ†å½¢çš„å®ç°class Circle implements Shape private Color color; // é€šè¿‡ç»„åˆçš„æ–¹å¼æŒæœ‰é¢œè‰²å¯¹è±¡ public Circle(Color color) this.color = color; @Override public void draw() System.out.print(Drawing a circle with ); color.applyColor(); // è°ƒç”¨é¢œè‰²çš„é€»è¾‘ // çŸ©å½¢çš„å®ç°class Rectangle implements Shape private Color color; public Rectangle(Color color) this.color = color; @Override public void draw() System.out.print(Drawing a rectangle with ); color.applyColor(); é¢œè‰²å¹²é¢œè‰²çš„äº‹æƒ…ã€‚ // çº¢è‰²çš„å®ç°class RedColor implements Color @Override public void applyColor() System.out.println(red color); // ç»¿è‰²çš„å®ç°class GreenColor implements Color @Override public void applyColor() System.out.println(green color); 19.å¤šæ€è§£å†³äº†ä»€ä¹ˆé—®é¢˜ï¼Ÿï¼ˆè¡¥å……ï¼‰å¤šæ€æŒ‡åŒä¸€ä¸ªæ¥å£æˆ–æ–¹æ³•åœ¨ä¸åŒçš„ç±»ä¸­æœ‰ä¸åŒçš„å®ç°ï¼Œæ¯”å¦‚è¯´åŠ¨æ€ç»‘å®šï¼Œçˆ¶ç±»å¼•ç”¨æŒ‡å‘å­ç±»å¯¹è±¡ï¼Œæ–¹æ³•çš„å…·ä½“è°ƒç”¨ä¼šå»¶è¿Ÿåˆ°è¿è¡Œæ—¶å†³å®šã€‚ ä¸¾ä¾‹ï¼Œç°åœ¨æœ‰ä¸€ä¸ªçˆ¶ç±» Wangerï¼Œä¸€ä¸ªå­ç±» Wangxiaoerï¼Œéƒ½æœ‰ä¸€ä¸ª write æ–¹æ³•ã€‚ç°åœ¨æœ‰ä¸€ä¸ªçˆ¶ç±» Wanger ç±»å‹çš„å˜é‡ wangerï¼Œå®ƒåœ¨æ‰§è¡Œ wanger.write() æ—¶ï¼Œç©¶ç«Ÿè°ƒç”¨çˆ¶ç±» Wanger çš„ write() æ–¹æ³•ï¼Œè¿˜æ˜¯å­ç±» Wangxiaoer çš„ write() æ–¹æ³•å‘¢ï¼Ÿ //å­ç±»ç»§æ‰¿çˆ¶ç±»class Wangxiaoer extends Wanger public void write() // å­ç±»è¦†ç›–çˆ¶ç±»æ–¹æ³• System.out.println(è®°ä½ä»‡æ¨ï¼Œè¡¨æ˜æˆ‘ä»¬è¦å¥‹å‘å›¾å¼ºçš„å¿ƒæ™º); public static void main(String[] args) // çˆ¶ç±»å¼•ç”¨æŒ‡å‘å­ç±»å¯¹è±¡ Wanger[] wangers = new Wanger(), new Wangxiaoer() ; for (Wanger wanger : wangers) // å¯¹è±¡æ˜¯ç‹äºŒçš„æ—¶å€™è¾“å‡ºï¼šå‹¿å¿˜å›½è€» // å¯¹è±¡æ˜¯ç‹å°äºŒçš„æ—¶å€™è¾“å‡ºï¼šè®°ä½ä»‡æ¨ï¼Œè¡¨æ˜æˆ‘ä»¬è¦å¥‹å‘å›¾å¼ºçš„å¿ƒæ™º wanger.write(); class Wanger public void write() System.out.println(å‹¿å¿˜å›½è€»); ç­”æ¡ˆæ˜¯åœ¨è¿è¡Œæ—¶æ ¹æ®å¯¹è±¡çš„ç±»å‹è¿›è¡ŒåæœŸç»‘å®šï¼Œç¼–è¯‘å™¨åœ¨ç¼–è¯‘é˜¶æ®µå¹¶ä¸çŸ¥é“å¯¹è±¡çš„ç±»å‹ï¼Œä½†æ˜¯ Java çš„æ–¹æ³•è°ƒç”¨æœºåˆ¶èƒ½æ‰¾åˆ°æ­£ç¡®çš„æ–¹æ³•ä½“ï¼Œç„¶åæ‰§è¡Œï¼Œå¾—åˆ°æ­£ç¡®çš„ç»“æœï¼Œè¿™å°±æ˜¯å¤šæ€çš„ä½œç”¨ã€‚ å¤šæ€çš„å®ç°åŸç†æ˜¯ä»€ä¹ˆï¼Ÿå¤šæ€é€šè¿‡åŠ¨æ€ç»‘å®šå®ç°ï¼ŒJava ä½¿ç”¨è™šæ–¹æ³•è¡¨å­˜å‚¨æ–¹æ³•æŒ‡é’ˆï¼Œæ–¹æ³•è°ƒç”¨æ—¶æ ¹æ®å¯¹è±¡å®é™…ç±»å‹ä»è™šæ–¹æ³•è¡¨æŸ¥æ‰¾å…·ä½“å®ç°ã€‚ 20.é‡è½½å’Œé‡å†™çš„åŒºåˆ«ï¼Ÿæ¨èé˜…è¯»ï¼šæ–¹æ³•é‡å†™ Override å’Œæ–¹æ³•é‡è½½ Overload æœ‰ä»€ä¹ˆåŒºåˆ«ï¼Ÿ å¦‚æœä¸€ä¸ªç±»æœ‰å¤šä¸ªåå­—ç›¸åŒä½†å‚æ•°ä¸ªæ•°ä¸åŒçš„æ–¹æ³•ï¼Œæˆ‘ä»¬é€šå¸¸ç§°è¿™äº›æ–¹æ³•ä¸ºæ–¹æ³•é‡è½½ï¼ˆoverloadï¼‰ã€‚å¦‚æœæ–¹æ³•çš„åŠŸèƒ½æ˜¯ä¸€æ ·çš„ï¼Œä½†å‚æ•°ä¸åŒï¼Œä½¿ç”¨ç›¸åŒçš„åå­—å¯ä»¥æé«˜ç¨‹åºçš„å¯è¯»æ€§ã€‚ å¦‚æœå­ç±»å…·æœ‰å’Œçˆ¶ç±»ä¸€æ ·çš„æ–¹æ³•ï¼ˆå‚æ•°ç›¸åŒã€è¿”å›ç±»å‹ç›¸åŒã€æ–¹æ³•åç›¸åŒï¼Œä½†æ–¹æ³•ä½“å¯èƒ½ä¸åŒï¼‰ï¼Œæˆ‘ä»¬ç§°ä¹‹ä¸ºæ–¹æ³•é‡å†™ï¼ˆoverrideï¼‰ã€‚æ–¹æ³•é‡å†™ç”¨äºæä¾›çˆ¶ç±»å·²ç»å£°æ˜çš„æ–¹æ³•çš„ç‰¹æ®Šå®ç°ï¼Œæ˜¯å®ç°å¤šæ€çš„åŸºç¡€æ¡ä»¶ã€‚ æ–¹æ³•é‡è½½å‘ç”Ÿåœ¨åŒä¸€ä¸ªç±»ä¸­ï¼ŒåŒåçš„æ–¹æ³•å¦‚æœæœ‰ä¸åŒçš„å‚æ•°ï¼ˆå‚æ•°ç±»å‹ä¸åŒã€å‚æ•°ä¸ªæ•°ä¸åŒæˆ–è€…äºŒè€…éƒ½ä¸åŒï¼‰ã€‚ æ–¹æ³•é‡å†™å‘ç”Ÿåœ¨å­ç±»ä¸çˆ¶ç±»ä¹‹é—´ï¼Œè¦æ±‚å­ç±»ä¸çˆ¶ç±»å…·æœ‰ç›¸åŒçš„è¿”å›ç±»å‹ï¼Œæ–¹æ³•åå’Œå‚æ•°åˆ—è¡¨ï¼Œå¹¶ä¸”ä¸èƒ½æ¯”çˆ¶ç±»çš„æ–¹æ³•å£°æ˜æ›´å¤šçš„å¼‚å¸¸ï¼Œéµå®ˆé‡Œæ°ä»£æ¢åŸåˆ™ã€‚ ä»€ä¹ˆæ˜¯é‡Œæ°ä»£æ¢åŸåˆ™ï¼Ÿé‡Œæ°ä»£æ¢åŸåˆ™ä¹Ÿè¢«ç§°ä¸ºææ°æ›¿æ¢åŸåˆ™ï¼ˆLiskov Substitution Principle, LSPï¼‰ï¼Œå…¶è§„å®šä»»ä½•çˆ¶ç±»å¯ä»¥å‡ºç°çš„åœ°æ–¹ï¼Œå­ç±»ä¹Ÿä¸€å®šå¯ä»¥å‡ºç°ã€‚ LSP æ˜¯ç»§æ‰¿å¤ç”¨çš„åŸºçŸ³ï¼Œåªæœ‰å½“å­ç±»å¯ä»¥æ›¿æ¢æ‰çˆ¶ç±»ï¼Œå¹¶ä¸”å•ä½åŠŸèƒ½ä¸å—åˆ°å½±å“æ—¶ï¼Œçˆ¶ç±»æ‰èƒ½çœŸæ­£è¢«å¤ç”¨ï¼Œè€Œå­ç±»ä¹Ÿèƒ½å¤Ÿåœ¨çˆ¶ç±»çš„åŸºç¡€ä¸Šå¢åŠ æ–°çš„è¡Œä¸ºã€‚ è¿™æ„å‘³ç€å­ç±»åœ¨æ‰©å±•çˆ¶ç±»æ—¶ï¼Œä¸åº”æ”¹å˜çˆ¶ç±»åŸæœ‰çš„è¡Œä¸ºã€‚ä¾‹å¦‚ï¼Œå¦‚æœæœ‰ä¸€ä¸ªæ–¹æ³•æ¥å—ä¸€ä¸ªçˆ¶ç±»å¯¹è±¡ä½œä¸ºå‚æ•°ï¼Œé‚£ä¹ˆä¼ å…¥è¯¥æ–¹æ³•çš„ä»»ä½•å­ç±»å¯¹è±¡ä¹Ÿåº”è¯¥èƒ½æ­£å¸¸å·¥ä½œã€‚ class Bird void fly() System.out.println(é¸Ÿæ­£åœ¨é£); class Duck extends Bird @Override void fly() System.out.println(é¸­å­æ­£åœ¨é£); class Ostrich extends Bird // Ostrichè¿åäº†LSPï¼Œå› ä¸ºé¸µé¸Ÿä¸ä¼šé£ï¼Œä½†å´ç»§æ‰¿äº†ä¼šé£çš„é¸Ÿç±» @Override void fly() throw new UnsupportedOperationException(é¸µé¸Ÿä¸ä¼šé£); åœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼ŒOstrichï¼ˆé¸µé¸Ÿï¼‰ç±»è¿åäº† LSP åŸåˆ™ï¼Œå› ä¸ºå®ƒæ”¹å˜äº†çˆ¶ç±» Bird çš„è¡Œä¸ºï¼ˆå³é£è¡Œï¼‰ã€‚è®¾è®¡æ—¶åº”è¯¥æ›´åŠ è°¨æ…åœ°ä½¿ç”¨ç»§æ‰¿å…³ç³»ï¼Œç¡®ä¿éµå®ˆ LSP åŸåˆ™ã€‚ é™¤äº†ææ°æ›¿æ¢åŸåˆ™å¤–ï¼Œè¿˜æœ‰å…¶ä»–å‡ ä¸ªé‡è¦çš„é¢å‘å¯¹è±¡è®¾è®¡åŸåˆ™ï¼Œå®ƒä»¬å…±åŒæ„æˆäº† SOLID åŸåˆ™ï¼Œåˆ†åˆ«æ˜¯ï¼š â‘ ã€å•ä¸€èŒè´£åŸåˆ™ï¼ˆSingle Responsibility Principle, SRPï¼‰ï¼ŒæŒ‡ä¸€ä¸ªç±»åº”è¯¥åªæœ‰ä¸€ä¸ªå¼•èµ·å®ƒå˜åŒ–çš„åŸå› ï¼Œå³ä¸€ä¸ªç±»åªè´Ÿè´£ä¸€é¡¹èŒè´£ã€‚è¿™æ ·åšçš„ç›®çš„æ˜¯ä½¿ç±»æ›´åŠ æ¸…æ™°ï¼Œæ›´å®¹æ˜“ç†è§£å’Œç»´æŠ¤ã€‚ â‘¡ã€å¼€é—­åŸåˆ™ï¼ˆOpen-Closed Principle, OCPï¼‰ï¼ŒæŒ‡è½¯ä»¶å®ä½“åº”è¯¥å¯¹æ‰©å±•å¼€æ”¾ï¼Œå¯¹ä¿®æ”¹å…³é—­ã€‚è¿™æ„å‘³ç€ä¸€ä¸ªç±»åº”è¯¥é€šè¿‡æ‰©å±•æ¥å®ç°æ–°çš„åŠŸèƒ½ï¼Œè€Œä¸æ˜¯é€šè¿‡ä¿®æ”¹å·²æœ‰çš„ä»£ç æ¥å®ç°ã€‚ ä¸¾ä¸ªä¾‹å­ï¼Œåœ¨ä¸éµå®ˆå¼€é—­åŸåˆ™çš„æƒ…å†µä¸‹ï¼Œæœ‰ä¸€ä¸ªéœ€è¦å¤„ç†ä¸åŒå½¢çŠ¶çš„ç»˜å›¾åŠŸèƒ½ç±»ã€‚ class ShapeDrawer public void draw(Shape shape) if (shape instanceof Circle) drawCircle((Circle) shape); else if (shape instanceof Rectangle) drawRectangle((Rectangle) shape); private void drawCircle(Circle circle) // ç”»åœ†å½¢ private void drawRectangle(Rectangle rectangle) // ç”»çŸ©å½¢ æ¯å¢åŠ ä¸€ç§å½¢çŠ¶ï¼Œå°±éœ€è¦ä¿®æ”¹ä¸€æ¬¡ draw æ–¹æ³•ï¼Œè¿™è¿åäº†å¼€é—­åŸåˆ™ã€‚æ­£ç¡®çš„åšæ³•æ˜¯é€šè¿‡ç»§æ‰¿å’Œå¤šæ€æ¥å®ç°æ–°çš„å½¢çŠ¶ç±»ï¼Œç„¶ååœ¨ ShapeDrawer ä¸­æ·»åŠ æ–°çš„ draw æ–¹æ³•ã€‚ // æŠ½è±¡çš„ Shape ç±»abstract class Shape public abstract void draw();// å…·ä½“çš„ Circle ç±»class Circle extends Shape @Override public void draw() // ç”»åœ†å½¢ // å…·ä½“çš„ Rectangle ç±»class Rectangle extends Shape @Override public void draw() // ç”»çŸ©å½¢ // ä½¿ç”¨å¼€é—­åŸåˆ™çš„ ShapeDrawer ç±»class ShapeDrawer public void draw(Shape shape) shape.draw(); // è°ƒç”¨å¤šæ€çš„ draw æ–¹æ³• â‘¢ã€æ¥å£éš”ç¦»åŸåˆ™ï¼ˆInterface Segregation Principle, ISPï¼‰ï¼ŒæŒ‡å®¢æˆ·ç«¯ä¸åº”è¯¥ä¾èµ–å®ƒä¸éœ€è¦çš„æ¥å£ã€‚è¿™æ„å‘³ç€è®¾è®¡æ¥å£æ—¶åº”è¯¥å°½é‡ç²¾ç®€ï¼Œä¸åº”è¯¥è®¾è®¡è‡ƒè‚¿åºå¤§çš„æ¥å£ã€‚ â‘£ã€ä¾èµ–å€’ç½®åŸåˆ™ï¼ˆDependency Inversion Principle, DIPï¼‰ï¼ŒæŒ‡é«˜å±‚æ¨¡å—ä¸åº”è¯¥ä¾èµ–ä½å±‚æ¨¡å—ï¼ŒäºŒè€…éƒ½åº”è¯¥ä¾èµ–å…¶æŠ½è±¡ï¼›æŠ½è±¡ä¸åº”è¯¥ä¾èµ–ç»†èŠ‚ï¼Œç»†èŠ‚åº”è¯¥ä¾èµ–æŠ½è±¡ã€‚è¿™æ„å‘³ç€è®¾è®¡æ—¶åº”è¯¥å°½é‡ä¾èµ–æ¥å£æˆ–æŠ½è±¡ç±»ï¼Œè€Œä¸æ˜¯å®ç°ç±»ã€‚ 21.è®¿é—®ä¿®é¥°ç¬¦ publicã€privateã€protectedã€ä»¥åŠé»˜è®¤æ—¶çš„åŒºåˆ«ï¼ŸJava ä¸­ï¼Œå¯ä»¥ä½¿ç”¨è®¿é—®æ§åˆ¶ç¬¦æ¥ä¿æŠ¤å¯¹ç±»ã€å˜é‡ã€æ–¹æ³•å’Œæ„é€ æ–¹æ³•çš„è®¿é—®ã€‚Java æ”¯æŒ 4 ç§ä¸åŒçš„è®¿é—®æƒé™ã€‚ defaultÂ ï¼ˆå³é»˜è®¤ï¼Œä»€ä¹ˆä¹Ÿä¸å†™ï¼‰: åœ¨åŒä¸€åŒ…å†…å¯è§ï¼Œä¸ä½¿ç”¨ä»»ä½•ä¿®é¥°ç¬¦ã€‚å¯ä»¥ä¿®é¥°åœ¨ç±»ã€æ¥å£ã€å˜é‡ã€æ–¹æ³•ã€‚ privateÂ : åœ¨åŒä¸€ç±»å†…å¯è§ã€‚å¯ä»¥ä¿®é¥°å˜é‡ã€æ–¹æ³•ã€‚æ³¨æ„ï¼šä¸èƒ½ä¿®é¥°ç±»ï¼ˆå¤–éƒ¨ç±»ï¼‰ publicÂ : å¯¹æ‰€æœ‰ç±»å¯è§ã€‚å¯ä»¥ä¿®é¥°ç±»ã€æ¥å£ã€å˜é‡ã€æ–¹æ³• protectedÂ : å¯¹åŒä¸€åŒ…å†…çš„ç±»å’Œæ‰€æœ‰å­ç±»å¯è§ã€‚å¯ä»¥ä¿®é¥°å˜é‡ã€æ–¹æ³•ã€‚æ³¨æ„ï¼šä¸èƒ½ä¿®é¥°ç±»ï¼ˆå¤–éƒ¨ç±»ï¼‰ã€‚ 22.this å…³é”®å­—æœ‰ä»€ä¹ˆä½œç”¨ï¼Ÿthis æ˜¯è‡ªèº«çš„ä¸€ä¸ªå¯¹è±¡ï¼Œä»£è¡¨å¯¹è±¡æœ¬èº«ï¼Œå¯ä»¥ç†è§£ä¸ºï¼šæŒ‡å‘å¯¹è±¡æœ¬èº«çš„ä¸€ä¸ªæŒ‡é’ˆã€‚ this çš„ç”¨æ³•åœ¨ Java ä¸­å¤§ä½“å¯ä»¥åˆ†ä¸º 3 ç§ï¼š æ™®é€šçš„ç›´æ¥å¼•ç”¨ï¼Œthis ç›¸å½“äºæ˜¯æŒ‡å‘å½“å‰å¯¹è±¡æœ¬èº« å½¢å‚ä¸æˆå‘˜å˜é‡åå­—é‡åï¼Œç”¨ this æ¥åŒºåˆ†ï¼š public Person(String name,int age) this.name=name; this.age=age; å¼•ç”¨æœ¬ç±»çš„æ„é€ æ–¹æ³• 23.ğŸŒŸæŠ½è±¡ç±»å’Œæ¥å£æœ‰ä»€ä¹ˆåŒºåˆ«ï¼Ÿä¸€ä¸ªç±»åªèƒ½ç»§æ‰¿ä¸€ä¸ªæŠ½è±¡ç±»ï¼›ä½†ä¸€ä¸ªç±»å¯ä»¥å®ç°å¤šä¸ªæ¥å£ã€‚æ‰€ä»¥æˆ‘ä»¬åœ¨æ–°å»ºçº¿ç¨‹ç±»çš„æ—¶å€™ä¸€èˆ¬æ¨èä½¿ç”¨å®ç° Runnable æ¥å£çš„æ–¹å¼ï¼Œè¿™æ ·çº¿ç¨‹ç±»è¿˜å¯ä»¥ç»§æ‰¿å…¶ä»–ç±»ï¼Œè€Œä¸å•å•æ˜¯ Thread ç±»ã€‚ æŠ½è±¡ç±»ç¬¦åˆ is-a çš„å…³ç³»ï¼Œè€Œæ¥å£æ›´åƒæ˜¯ has-a çš„å…³ç³»ï¼Œæ¯”å¦‚è¯´ä¸€ä¸ªç±»å¯ä»¥åºåˆ—åŒ–çš„æ—¶å€™ï¼Œå®ƒåªéœ€è¦å®ç° Serializable æ¥å£å°±å¯ä»¥äº†ï¼Œä¸éœ€è¦å»ç»§æ‰¿ä¸€ä¸ªåºåˆ—åŒ–ç±»ã€‚ æŠ½è±¡ç±»æ›´å¤šåœ°æ˜¯ç”¨æ¥ä¸ºå¤šä¸ªç›¸å…³çš„ç±»æä¾›ä¸€ä¸ªå…±åŒçš„åŸºç¡€æ¡†æ¶ï¼ŒåŒ…æ‹¬çŠ¶æ€çš„åˆå§‹åŒ–ï¼Œè€Œæ¥å£åˆ™æ˜¯å®šä¹‰ä¸€å¥—è¡Œä¸ºæ ‡å‡†ï¼Œè®©ä¸åŒçš„ç±»å¯ä»¥å®ç°åŒä¸€æ¥å£ï¼Œæä¾›è¡Œä¸ºçš„å¤šæ ·åŒ–å®ç°ã€‚ æŠ½è±¡ç±»å¯ä»¥å®šä¹‰æ„é€ æ–¹æ³•å—ï¼Ÿå¯ä»¥ï¼ŒæŠ½è±¡ç±»å¯ä»¥æœ‰æ„é€ æ–¹æ³•ã€‚ abstract class Animal protected String name; public Animal(String name) this.name = name; public abstract void makeSound();public class Dog extends Animal private int age; public Dog(String name, int age) super(name); // è°ƒç”¨æŠ½è±¡ç±»çš„æ„é€ å‡½æ•° this.age = age; @Override public void makeSound() System.out.println(name + says: Bark); æ¥å£å¯ä»¥å®šä¹‰æ„é€ æ–¹æ³•å—ï¼Ÿä¸èƒ½ï¼Œæ¥å£ä¸»è¦ç”¨äºå®šä¹‰ä¸€ç»„æ–¹æ³•è§„èŒƒï¼Œæ²¡æœ‰å…·ä½“çš„å®ç°ç»†èŠ‚ã€‚ Javaæ”¯æŒå¤šç»§æ‰¿å—ï¼ŸJava ä¸æ”¯æŒå¤šç»§æ‰¿ï¼Œä¸€ä¸ªç±»åªèƒ½ç»§æ‰¿ä¸€ä¸ªç±»ï¼Œå¤šç»§æ‰¿ä¼šå¼•å‘è±å½¢ç»§æ‰¿é—®é¢˜ã€‚ class A void show() System.out.println(A); class B extends A void show() System.out.println(B); class C extends A void show() System.out.println(C); // å¦‚æœ Java æ”¯æŒå¤šç»§æ‰¿class D extends B, C // è°ƒç”¨ show() æ–¹æ³•æ—¶ï¼ŒD åº”è¯¥è°ƒç”¨ B çš„ show() è¿˜æ˜¯ C çš„ show()ï¼Ÿ æ¥å£å¯ä»¥å¤šç»§æ‰¿å—ï¼Ÿæ¥å£å¯ä»¥å¤šç»§æ‰¿ï¼Œä¸€ä¸ªæ¥å£å¯ä»¥ç»§æ‰¿å¤šä¸ªæ¥å£ï¼Œä½¿ç”¨é€—å·åˆ†éš”ã€‚ interface InterfaceA void methodA();interface InterfaceB void methodB();interface InterfaceC extends InterfaceA, InterfaceB void methodC();class MyClass implements InterfaceC public void methodA() System.out.println(Method A); public void methodB() System.out.println(Method B); public void methodC() System.out.println(Method C); public static void main(String[] args) MyClass myClass = new MyClass(); myClass.methodA(); myClass.methodB(); myClass.methodC(); åœ¨ä¸Šé¢çš„ä¾‹å­ä¸­ï¼ŒInterfaceA å’Œ InterfaceB æ˜¯ä¸¤ä¸ªç‹¬ç«‹çš„æ¥å£ã€‚ InterfaceC ç»§æ‰¿äº† InterfaceA å’Œ InterfaceBï¼Œå¹¶ä¸”å®šä¹‰äº†è‡ªå·±çš„æ–¹æ³• methodCã€‚ MyClass å®ç°äº† InterfaceCï¼Œå› æ­¤éœ€è¦å®ç° InterfaceA å’Œ InterfaceB ä¸­çš„æ–¹æ³• methodA å’Œ methodBï¼Œä»¥åŠ InterfaceC ä¸­çš„æ–¹æ³• methodCã€‚ ç»§æ‰¿å’ŒæŠ½è±¡çš„åŒºåˆ«ï¼Ÿç»§æ‰¿æ˜¯ä¸€ç§å…è®¸å­ç±»ç»§æ‰¿çˆ¶ç±»å±æ€§å’Œæ–¹æ³•çš„æœºåˆ¶ã€‚é€šè¿‡ç»§æ‰¿ï¼Œå­ç±»å¯ä»¥é‡ç”¨çˆ¶ç±»çš„ä»£ç ã€‚ æŠ½è±¡æ˜¯ä¸€ç§éšè—å¤æ‚æ€§å’Œåªæ˜¾ç¤ºå¿…è¦éƒ¨åˆ†çš„æŠ€æœ¯ã€‚åœ¨é¢å‘å¯¹è±¡ç¼–ç¨‹ä¸­ï¼ŒæŠ½è±¡å¯ä»¥é€šè¿‡æŠ½è±¡ç±»å’Œæ¥å£å®ç°ã€‚ æŠ½è±¡ç±»å’Œæ™®é€šç±»çš„åŒºåˆ«ï¼ŸæŠ½è±¡ç±»ä½¿ç”¨ abstract å…³é”®å­—å®šä¹‰ï¼Œä¸èƒ½è¢«å®ä¾‹åŒ–ï¼Œåªèƒ½ä½œä¸ºå…¶ä»–ç±»çš„çˆ¶ç±»ã€‚æ™®é€šç±»æ²¡æœ‰ abstract å…³é”®å­—ï¼Œå¯ä»¥ç›´æ¥å®ä¾‹åŒ–ã€‚ æŠ½è±¡ç±»å¯ä»¥åŒ…å«æŠ½è±¡æ–¹æ³•å’ŒéæŠ½è±¡æ–¹æ³•ã€‚æŠ½è±¡æ–¹æ³•æ²¡æœ‰æ–¹æ³•ä½“ï¼Œå¿…é¡»ç”±å­ç±»å®ç°ã€‚æ™®é€šç±»åªèƒ½åŒ…å«éæŠ½è±¡æ–¹æ³•ã€‚ abstract class Animal // æŠ½è±¡æ–¹æ³• public abstract void makeSound(); // éæŠ½è±¡æ–¹æ³• public void eat() System.out.println(This animal is eating.); class Dog extends Animal // å®ç°æŠ½è±¡æ–¹æ³• @Override public void makeSound() System.out.println(Woof); public class Test public static void main(String[] args) Dog dog = new Dog(); dog.makeSound(); // è¾“å‡º Woof dog.eat(); // è¾“å‡º This animal is eating. æŠ½è±¡ç±»ä½¿ç”¨ abstract å…³é”®å­—å®šä¹‰ï¼Œä¸èƒ½è¢«å®ä¾‹åŒ–ï¼Œåªèƒ½ä½œä¸ºå…¶ä»–ç±»çš„çˆ¶ç±»ã€‚æ™®é€šç±»æ²¡æœ‰ abstract å…³é”®å­—ï¼Œå¯ä»¥ç›´æ¥å®ä¾‹åŒ–ã€‚ æŠ½è±¡ç±»å¯ä»¥åŒ…å«æŠ½è±¡æ–¹æ³•å’ŒéæŠ½è±¡æ–¹æ³•ã€‚æŠ½è±¡æ–¹æ³•æ²¡æœ‰æ–¹æ³•ä½“ï¼Œå¿…é¡»ç”±å­ç±»å®ç°ã€‚æ™®é€šç±»åªèƒ½åŒ…å«éæŠ½è±¡æ–¹æ³•ã€‚ abstract class Animal // æŠ½è±¡æ–¹æ³• public abstract void makeSound(); // éæŠ½è±¡æ–¹æ³• public void eat() System.out.println(This animal is eating.); class Dog extends Animal // å®ç°æŠ½è±¡æ–¹æ³• @Override public void makeSound() System.out.println(Woof); public class Test public static void main(String[] args) Dog dog = new Dog(); dog.makeSound(); // è¾“å‡º Woof dog.eat(); // è¾“å‡º This animal is eating. 24.æˆå‘˜å˜é‡ä¸å±€éƒ¨å˜é‡çš„åŒºåˆ«æœ‰å“ªäº›ï¼Ÿ ä»è¯­æ³•å½¢å¼ä¸Šçœ‹ï¼šæˆå‘˜å˜é‡æ˜¯å±äºç±»çš„ï¼Œâ½½å±€éƒ¨å˜é‡æ˜¯åœ¨â½…æ³•ä¸­å®šä¹‰çš„å˜é‡æˆ–æ˜¯â½…æ³•çš„å‚æ•°ï¼›æˆå‘˜å˜é‡å¯ä»¥è¢« public , private , static ç­‰ä¿®é¥°ç¬¦æ‰€ä¿®é¥°ï¼Œâ½½å±€éƒ¨å˜é‡ä¸èƒ½è¢«è®¿é—®æ§åˆ¶ä¿®é¥°ç¬¦åŠ static æ‰€ä¿®é¥°ï¼›ä½†æ˜¯ï¼Œæˆå‘˜å˜é‡å’Œå±€éƒ¨å˜é‡éƒ½èƒ½è¢« final æ‰€ä¿®é¥°ã€‚ ä»å˜é‡åœ¨å†…å­˜ä¸­çš„å­˜å‚¨â½…å¼æ¥çœ‹ï¼šå¦‚æœæˆå‘˜å˜é‡æ˜¯ä½¿â½¤ static ä¿®é¥°çš„ï¼Œé‚£ä¹ˆè¿™ä¸ªæˆå‘˜å˜é‡æ˜¯å±äºç±»çš„ï¼Œå¦‚æœæ²¡æœ‰ä½¿â½¤ static ä¿®é¥°ï¼Œè¿™ä¸ªæˆå‘˜å˜é‡æ˜¯å±äºå®ä¾‹çš„ã€‚å¯¹è±¡å­˜äºå †å†…å­˜ï¼Œå¦‚æœå±€éƒ¨å˜é‡ç±»å‹ä¸ºåŸºæœ¬æ•°æ®ç±»å‹ï¼Œé‚£ä¹ˆå­˜å‚¨åœ¨æ ˆå†…å­˜ï¼Œå¦‚æœä¸ºå¼•â½¤æ•°æ®ç±»å‹ï¼Œé‚£å­˜æ”¾çš„æ˜¯æŒ‡å‘å †å†…å­˜å¯¹è±¡çš„å¼•â½¤æˆ–è€…æ˜¯æŒ‡å‘å¸¸é‡æ± ä¸­çš„åœ°å€ã€‚ ä»å˜é‡åœ¨å†…å­˜ä¸­çš„â½£å­˜æ—¶é—´ä¸Šçœ‹ï¼šæˆå‘˜å˜é‡æ˜¯å¯¹è±¡çš„â¼€éƒ¨åˆ†ï¼Œå®ƒéšç€å¯¹è±¡çš„åˆ›å»ºâ½½å­˜åœ¨ï¼Œâ½½å±€éƒ¨å˜é‡éšç€â½…æ³•çš„è°ƒâ½¤â½½â¾ƒåŠ¨æ¶ˆå¤±ã€‚ æˆå‘˜å˜é‡å¦‚æœæ²¡æœ‰è¢«èµ‹åˆå€¼ï¼šåˆ™ä¼šâ¾ƒåŠ¨ä»¥ç±»å‹çš„é»˜è®¤å€¼â½½èµ‹å€¼ï¼ˆâ¼€ç§æƒ…å†µä¾‹å¤–:è¢« final ä¿®é¥°çš„æˆå‘˜å˜é‡ä¹Ÿå¿…é¡»æ˜¾å¼åœ°èµ‹å€¼ï¼‰ï¼Œâ½½å±€éƒ¨å˜é‡åˆ™ä¸ä¼šâ¾ƒåŠ¨èµ‹å€¼ã€‚ 25.static å…³é”®å­—äº†è§£å—ï¼Ÿæ¨èé˜…è¯»ï¼šè¯¦è§£ Java static å…³é”®å­—çš„ä½œç”¨ static å…³é”®å­—å¯ä»¥ç”¨æ¥ä¿®é¥°å˜é‡ã€æ–¹æ³•ã€ä»£ç å—å’Œå†…éƒ¨ç±»ï¼Œä»¥åŠå¯¼å…¥åŒ…ã€‚ é™æ€å˜é‡å’Œå®ä¾‹å˜é‡çš„åŒºåˆ«ï¼Ÿé™æ€å˜é‡:Â æ˜¯è¢« static ä¿®é¥°ç¬¦ä¿®é¥°çš„å˜é‡ï¼Œä¹Ÿç§°ä¸ºç±»å˜é‡ï¼Œå®ƒå±äºç±»ï¼Œä¸å±äºç±»çš„ä»»ä½•ä¸€ä¸ªå¯¹è±¡ï¼Œä¸€ä¸ªç±»ä¸ç®¡åˆ›å»ºå¤šå°‘ä¸ªå¯¹è±¡ï¼Œé™æ€å˜é‡åœ¨å†…å­˜ä¸­æœ‰ä¸”ä»…æœ‰ä¸€ä¸ªå‰¯æœ¬ã€‚ å®ä¾‹å˜é‡:Â å¿…é¡»ä¾å­˜äºæŸä¸€å®ä¾‹ï¼Œéœ€è¦å…ˆåˆ›å»ºå¯¹è±¡ç„¶åé€šè¿‡å¯¹è±¡æ‰èƒ½è®¿é—®åˆ°å®ƒã€‚é™æ€å˜é‡å¯ä»¥å®ç°è®©å¤šä¸ªå¯¹è±¡å…±äº«å†…å­˜ã€‚ é™æ€â½…æ³•å’Œå®ä¾‹â½…æ³•æœ‰ä½•ä¸åŒ?ç±»ä¼¼åœ°ã€‚ é™æ€æ–¹æ³•ï¼šstatic ä¿®é¥°çš„æ–¹æ³•ï¼Œä¹Ÿè¢«ç§°ä¸ºç±»æ–¹æ³•ã€‚åœ¨å¤–éƒ¨è°ƒâ½¤é™æ€â½…æ³•æ—¶ï¼Œå¯ä»¥ä½¿â½¤â€ç±»å.â½…æ³•åâ€œçš„â½…å¼ï¼Œä¹Ÿå¯ä»¥ä½¿â½¤â€å¯¹è±¡å.â½…æ³•åâ€œçš„â½…å¼ã€‚é™æ€æ–¹æ³•é‡Œä¸èƒ½è®¿é—®ç±»çš„éé™æ€æˆå‘˜å˜é‡å’Œæ–¹æ³•ã€‚ å®ä¾‹â½…æ³•ï¼šä¾å­˜äºç±»çš„å®ä¾‹ï¼Œéœ€è¦ä½¿ç”¨â€å¯¹è±¡å.â½…æ³•åâ€œçš„â½…å¼è°ƒç”¨ï¼›å¯ä»¥è®¿é—®ç±»çš„æ‰€æœ‰æˆå‘˜å˜é‡å’Œæ–¹æ³•ã€‚ 26.final å…³é”®å­—æœ‰ä»€ä¹ˆä½œç”¨ï¼Ÿâ‘ ã€å½“ final ä¿®é¥°ä¸€ä¸ªç±»æ—¶ï¼Œè¡¨æ˜è¿™ä¸ªç±»ä¸èƒ½è¢«ç»§æ‰¿ã€‚æ¯”å¦‚ï¼ŒString ç±»ã€Integer ç±»å’Œå…¶ä»–åŒ…è£…ç±»éƒ½æ˜¯ç”¨ final ä¿®é¥°çš„ã€‚ â‘¡ã€å½“ final ä¿®é¥°ä¸€ä¸ªæ–¹æ³•æ—¶ï¼Œè¡¨æ˜è¿™ä¸ªæ–¹æ³•ä¸èƒ½è¢«é‡å†™ï¼ˆOverrideï¼‰ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œå¦‚æœä¸€ä¸ªç±»ç»§æ‰¿äº†æŸä¸ªç±»ï¼Œå¹¶ä¸”æƒ³è¦æ”¹å˜çˆ¶ç±»ä¸­è¢« final ä¿®é¥°çš„æ–¹æ³•çš„è¡Œä¸ºï¼Œæ˜¯ä¸è¢«å…è®¸çš„ã€‚ â‘¢ã€å½“ final ä¿®é¥°ä¸€ä¸ªå˜é‡æ—¶ï¼Œè¡¨æ˜è¿™ä¸ªå˜é‡çš„å€¼ä¸€æ—¦è¢«åˆå§‹åŒ–å°±ä¸èƒ½è¢«ä¿®æ”¹ã€‚å¦‚æœæ˜¯åŸºæœ¬æ•°æ®ç±»å‹çš„å˜é‡ï¼Œå…¶æ•°å€¼ä¸€æ—¦åœ¨åˆå§‹åŒ–ä¹‹åå°±ä¸èƒ½æ›´æ”¹ï¼›å¦‚æœæ˜¯å¼•ç”¨ç±»å‹çš„å˜é‡ï¼Œåœ¨å¯¹å…¶åˆå§‹åŒ–ä¹‹åå°±ä¸èƒ½å†è®©å…¶æŒ‡å‘å¦ä¸€ä¸ªå¯¹è±¡ã€‚ ä½†æ˜¯å¼•ç”¨æŒ‡å‘çš„å¯¹è±¡å†…å®¹å¯ä»¥æ”¹å˜ã€‚ 27.finalã€finallyã€finalize çš„åŒºåˆ«ï¼Ÿâ‘ ã€final æ˜¯ä¸€ä¸ªä¿®é¥°ç¬¦ï¼Œå¯ä»¥ä¿®é¥°ç±»ã€æ–¹æ³•å’Œå˜é‡ã€‚å½“ final ä¿®é¥°ä¸€ä¸ªç±»æ—¶ï¼Œè¡¨æ˜è¿™ä¸ªç±»ä¸èƒ½è¢«ç»§æ‰¿ï¼›å½“ final ä¿®é¥°ä¸€ä¸ªæ–¹æ³•æ—¶ï¼Œè¡¨æ˜è¿™ä¸ªæ–¹æ³•ä¸èƒ½è¢«é‡å†™ï¼›å½“ final ä¿®é¥°ä¸€ä¸ªå˜é‡æ—¶ï¼Œè¡¨æ˜è¿™ä¸ªå˜é‡æ˜¯ä¸ªå¸¸é‡ï¼Œä¸€æ—¦èµ‹å€¼åï¼Œå°±ä¸èƒ½å†è¢«ä¿®æ”¹äº†ã€‚ â‘¡ã€finally æ˜¯ Java ä¸­å¼‚å¸¸å¤„ç†çš„ä¸€éƒ¨åˆ†ï¼Œç”¨æ¥åˆ›å»º try å—åé¢çš„ finally å—ã€‚æ— è®º try å—ä¸­çš„ä»£ç æ˜¯å¦æŠ›å‡ºå¼‚å¸¸ï¼Œfinally å—ä¸­çš„ä»£ç æ€»æ˜¯ä¼šè¢«æ‰§è¡Œã€‚é€šå¸¸ï¼Œfinally å—è¢«ç”¨æ¥é‡Šæ”¾èµ„æºï¼Œå¦‚å…³é—­æ–‡ä»¶ã€æ•°æ®åº“è¿æ¥ç­‰ã€‚ â‘¢ã€finalize æ˜¯Object ç±»çš„ä¸€ä¸ªæ–¹æ³•ï¼Œç”¨äºåœ¨åƒåœ¾å›æ”¶å™¨å°†å¯¹è±¡ä»å†…å­˜ä¸­æ¸…é™¤å‡ºå»ä¹‹å‰åšä¸€äº›å¿…è¦çš„æ¸…ç†å·¥ä½œã€‚ è¿™ä¸ªæ–¹æ³•åœ¨åƒåœ¾å›æ”¶å™¨å‡†å¤‡é‡Šæ”¾å¯¹è±¡å ç”¨çš„å†…å­˜ä¹‹å‰è¢«è‡ªåŠ¨è°ƒç”¨ã€‚æˆ‘ä»¬ä¸èƒ½æ˜¾å¼åœ°è°ƒç”¨ finalize æ–¹æ³•ï¼Œå› ä¸ºå®ƒæ€»æ˜¯ç”±åƒåœ¾å›æ”¶å™¨åœ¨é€‚å½“çš„æ—¶é—´è‡ªåŠ¨è°ƒç”¨ã€‚ 28.å’Œ equals çš„åŒºåˆ«ï¼Ÿåœ¨ Java ä¸­ï¼Œ==Â æ“ä½œç¬¦å’ŒÂ equals()Â æ–¹æ³•ç”¨äºæ¯”è¾ƒä¸¤ä¸ªå¯¹è±¡ï¼š â‘ ã€ï¼šç”¨äºæ¯”è¾ƒä¸¤ä¸ªå¯¹è±¡çš„å¼•ç”¨ï¼Œå³å®ƒä»¬æ˜¯å¦æŒ‡å‘åŒä¸€ä¸ªå¯¹è±¡å®ä¾‹ã€‚ å¦‚æœä¸¤ä¸ªå˜é‡å¼•ç”¨åŒä¸€ä¸ªå¯¹è±¡å®ä¾‹ï¼Œ==Â è¿”å›Â trueï¼Œå¦åˆ™è¿”å›Â falseã€‚ å¯¹äºåŸºæœ¬æ•°æ®ç±»å‹ï¼ˆå¦‚Â int,Â double,Â charÂ ç­‰ï¼‰ï¼Œ==Â æ¯”è¾ƒçš„æ˜¯å€¼æ˜¯å¦ç›¸ç­‰ã€‚ â‘¡ã€equals() æ–¹æ³•ï¼šç”¨äºæ¯”è¾ƒä¸¤ä¸ªå¯¹è±¡çš„å†…å®¹æ˜¯å¦ç›¸ç­‰ã€‚é»˜è®¤æƒ…å†µä¸‹ï¼Œequals()Â æ–¹æ³•çš„è¡Œä¸ºä¸Â ==Â ç›¸åŒï¼Œå³æ¯”è¾ƒå¯¹è±¡å¼•ç”¨ï¼Œå¦‚åœ¨è¶…ç±» Object ä¸­ï¼š public boolean equals(Object obj) return (this == obj); ç„¶è€Œï¼Œequals()Â æ–¹æ³•é€šå¸¸è¢«å„ç§ç±»é‡å†™ã€‚ä¾‹å¦‚ï¼ŒStringÂ ç±»é‡å†™äº†Â equals()Â æ–¹æ³•ï¼Œä»¥ä¾¿å®ƒå¯ä»¥æ¯”è¾ƒä¸¤ä¸ªå­—ç¬¦ä¸²çš„å­—ç¬¦å†…å®¹æ˜¯å¦å®Œå…¨ä¸€æ ·ã€‚ ä¸¾ä¸ªä¾‹å­ï¼š String a = new String(æ²‰é»˜ç‹äºŒ);String b = new String(æ²‰é»˜ç‹äºŒ);// ä½¿ç”¨ == æ¯”è¾ƒSystem.out.println(a == b); // è¾“å‡º falseï¼Œå› ä¸º a å’Œ b å¼•ç”¨ä¸åŒçš„å¯¹è±¡// ä½¿ç”¨ equals() æ¯”è¾ƒSystem.out.println(a.equals(b)); // è¾“å‡º trueï¼Œå› ä¸º a å’Œ b çš„å†…å®¹ç›¸åŒ 29.ğŸŒŸä¸ºä»€ä¹ˆé‡å†™ equals æ—¶å¿…é¡»é‡å†™ hashCode â½…æ³•ï¼Ÿå› ä¸ºåŸºäºå“ˆå¸Œçš„é›†åˆç±»ï¼ˆå¦‚ HashMapï¼‰éœ€è¦åŸºäºè¿™ä¸€ç‚¹æ¥æ­£ç¡®å­˜å‚¨å’ŒæŸ¥æ‰¾å¯¹è±¡ã€‚ å…·ä½“åœ°è¯´ï¼ŒHashMap é€šè¿‡å¯¹è±¡çš„å“ˆå¸Œç å°†å…¶å­˜å‚¨åœ¨ä¸åŒçš„â€œæ¡¶â€ä¸­ï¼Œå½“æŸ¥æ‰¾å¯¹è±¡æ—¶ï¼Œå®ƒéœ€è¦ä½¿ç”¨ key çš„å“ˆå¸Œç æ¥ç¡®å®šå¯¹è±¡åœ¨å“ªä¸ªæ¡¶ä¸­ï¼Œç„¶åå†é€šè¿‡Â equals()Â æ–¹æ³•æ‰¾åˆ°å¯¹åº”çš„å¯¹è±¡ã€‚ å¦‚æœé‡å†™äº†Â equals()æ–¹æ³•è€Œæ²¡æœ‰é‡å†™Â hashCode()æ–¹æ³•ï¼Œé‚£ä¹ˆè¢«è®¤ä¸ºç›¸ç­‰çš„å¯¹è±¡å¯èƒ½ä¼šæœ‰ä¸åŒçš„å“ˆå¸Œç ï¼Œä»è€Œå¯¼è‡´æ— æ³•åœ¨ HashMap ä¸­æ­£ç¡®å¤„ç†è¿™äº›å¯¹è±¡ã€‚ ä»€ä¹ˆæ˜¯ hashCode æ–¹æ³•ï¼ŸhashCode()Â æ–¹æ³•çš„ä½œâ½¤æ˜¯è·å–å“ˆå¸Œç ï¼Œå®ƒä¼šè¿”å›â¼€ä¸ª int æ•´æ•°ï¼Œå®šä¹‰åœ¨Â Object ç±»ä¸­ï¼Œ æ˜¯ä¸€ä¸ªæœ¬åœ°â½…æ³•ã€‚ public native int hashCode(); ä¸ºä»€ä¹ˆè¦æœ‰ hashCode æ–¹æ³•ï¼ŸhashCode æ–¹æ³•ä¸»è¦ç”¨æ¥è·å–å¯¹è±¡çš„å“ˆå¸Œç ï¼Œå“ˆå¸Œç æ˜¯ç”±å¯¹è±¡çš„å†…å­˜åœ°å€æˆ–è€…å¯¹è±¡çš„å±æ€§è®¡ç®—å‡ºæ¥çš„ï¼Œå®ƒæ˜¯â¼€ä¸ª int ç±»å‹çš„æ•´æ•°ï¼Œé€šå¸¸æ˜¯ä¸ä¼šé‡å¤çš„ï¼Œå› æ­¤å¯ä»¥ç”¨æ¥ä½œä¸ºé”®å€¼å¯¹çš„å»ºï¼Œä»¥æé«˜æŸ¥è¯¢æ•ˆç‡ã€‚ ä¾‹å¦‚Â HashMapÂ ä¸­çš„ key å°±æ˜¯é€šè¿‡ hashCode æ¥å®ç°çš„ï¼Œé€šè¿‡è°ƒç”¨ hashCode æ–¹æ³•è·å–é”®çš„å“ˆå¸Œç ï¼Œå¹¶å°†å…¶ä¸å³ç§» 16 ä½çš„å“ˆå¸Œç è¿›è¡Œå¼‚æˆ–è¿ç®—ã€‚ static final int hash(Object key) int h; return (key == null) ? 0 : (h = key.hashCode()) ^ (h 16); ä¸ºä»€ä¹ˆä¸¤ä¸ªå¯¹è±¡æœ‰ç›¸åŒçš„ hashcode å€¼ï¼Œå®ƒä»¬ä¹Ÿä¸â¼€å®šç›¸ç­‰ï¼Ÿè¿™ä¸»è¦æ˜¯ç”±äºå“ˆå¸Œç ï¼ˆhashCodeï¼‰çš„æœ¬è´¨å’Œç›®çš„æ‰€å†³å®šçš„ã€‚ å“ˆå¸Œç æ˜¯é€šè¿‡å“ˆå¸Œå‡½æ•°å°†å¯¹è±¡ä¸­æ˜ å°„æˆä¸€ä¸ªæ•´æ•°å€¼ï¼Œå…¶ä¸»è¦ç›®çš„æ˜¯åœ¨å“ˆå¸Œè¡¨ä¸­å¿«é€Ÿå®šä½å¯¹è±¡çš„å­˜å‚¨ä½ç½®ã€‚ ç”±äºå“ˆå¸Œå‡½æ•°å°†ä¸€ä¸ªè¾ƒå¤§çš„è¾“å…¥åŸŸæ˜ å°„åˆ°ä¸€ä¸ªè¾ƒå°çš„è¾“å‡ºåŸŸï¼Œä¸åŒçš„è¾“å…¥å€¼ï¼ˆå³ä¸åŒçš„å¯¹è±¡ï¼‰å¯èƒ½ä¼šäº§ç”Ÿç›¸åŒçš„è¾“å‡ºå€¼ï¼ˆå³ç›¸åŒçš„å“ˆå¸Œç ï¼‰ã€‚ è¿™ç§æƒ…å†µè¢«ç§°ä¸ºå“ˆå¸Œå†²çªã€‚å½“ä¸¤ä¸ªä¸ç›¸ç­‰çš„å¯¹è±¡å‘ç”Ÿå“ˆå¸Œå†²çªæ—¶ï¼Œå®ƒä»¬ä¼šæœ‰ç›¸åŒçš„ hashCodeã€‚ ä¸ºäº†è§£å†³å“ˆå¸Œå†²çªçš„é—®é¢˜ï¼Œå“ˆå¸Œè¡¨åœ¨å¤„ç†é”®æ—¶ï¼Œä¸ä»…ä¼šæ¯”è¾ƒé”®å¯¹è±¡çš„å“ˆå¸Œç ï¼Œè¿˜ä¼šä½¿ç”¨ equals æ–¹æ³•æ¥æ£€æŸ¥é”®å¯¹è±¡æ˜¯å¦çœŸæ­£ç›¸ç­‰ã€‚å¦‚æœä¸¤ä¸ªå¯¹è±¡çš„å“ˆå¸Œç ç›¸åŒï¼Œä½†é€šè¿‡ equals æ–¹æ³•æ¯”è¾ƒç»“æœä¸º falseï¼Œé‚£ä¹ˆè¿™ä¸¤ä¸ªå¯¹è±¡å°±ä¸è¢«è§†ä¸ºç›¸ç­‰ã€‚ if (p.hash == hash ((k = p.key) == key || (key != null key.equals(k)))) e = p; hashCode å’Œ equals æ–¹æ³•çš„å…³ç³»ï¼Ÿå¦‚æœä¸¤ä¸ªå¯¹è±¡é€šè¿‡ equals ç›¸ç­‰ï¼Œå®ƒä»¬çš„ hashCode å¿…é¡»ç›¸ç­‰ã€‚å¦åˆ™ä¼šå¯¼è‡´å“ˆå¸Œè¡¨ç±»æ•°æ®ç»“æ„ï¼ˆå¦‚ HashMapã€HashSetï¼‰çš„è¡Œä¸ºå¼‚å¸¸ã€‚ åœ¨å“ˆå¸Œè¡¨ä¸­ï¼Œå¦‚æœ equals ç›¸ç­‰ä½† hashCode ä¸ç›¸ç­‰ï¼Œå“ˆå¸Œè¡¨å¯èƒ½æ— æ³•æ­£ç¡®å¤„ç†è¿™äº›å¯¹è±¡ï¼Œå¯¼è‡´é‡å¤å…ƒç´ æˆ–é”®å€¼å†²çªç­‰é—®é¢˜ã€‚ 30.Java æ˜¯å€¼ä¼ é€’ï¼Œè¿˜æ˜¯å¼•ç”¨ä¼ é€’ï¼ŸJava æ˜¯å€¼ä¼ é€’ï¼Œä¸æ˜¯å¼•ç”¨ä¼ é€’ã€‚ å½“ä¸€ä¸ªå¯¹è±¡è¢«ä½œä¸ºå‚æ•°ä¼ é€’åˆ°æ–¹æ³•ä¸­æ—¶ï¼Œå‚æ•°çš„å€¼å°±æ˜¯è¯¥å¯¹è±¡çš„å¼•ç”¨ã€‚å¼•ç”¨çš„å€¼æ˜¯å¯¹è±¡åœ¨å †ä¸­çš„åœ°å€ã€‚ å¯¹è±¡æ˜¯å­˜å‚¨åœ¨å †ä¸­çš„ï¼Œæ‰€ä»¥ä¼ é€’å¯¹è±¡çš„æ—¶å€™ï¼Œå¯ä»¥ç†è§£ä¸ºæŠŠå˜é‡å­˜å‚¨çš„å¯¹è±¡åœ°å€ç»™ä¼ é€’è¿‡å»ã€‚ å¼•ç”¨ç±»å‹çš„å˜é‡æœ‰ä»€ä¹ˆç‰¹ç‚¹ï¼Ÿå¼•ç”¨ç±»å‹çš„å˜é‡å­˜å‚¨çš„æ˜¯å¯¹è±¡çš„åœ°å€ï¼Œè€Œä¸æ˜¯å¯¹è±¡æœ¬èº«ã€‚å› æ­¤ï¼Œå¼•ç”¨ç±»å‹çš„å˜é‡åœ¨ä¼ é€’æ—¶ï¼Œä¼ é€’çš„æ˜¯å¯¹è±¡çš„åœ°å€ï¼Œä¹Ÿå°±æ˜¯è¯´ï¼Œä¼ é€’çš„æ˜¯å¼•ç”¨çš„å€¼ã€‚ 31.è¯´è¯´æ·±æ‹·è´å’Œæµ…æ‹·è´çš„åŒºåˆ«?æ¨èé˜…è¯»ï¼šæ·±å…¥ç†è§£ Java æµ…æ‹·è´ä¸æ·±æ‹·è´ åœ¨ Java ä¸­ï¼Œæ·±æ‹·è´ï¼ˆDeep Copyï¼‰å’Œæµ…æ‹·è´ï¼ˆShallow Copyï¼‰æ˜¯ä¸¤ç§æ‹·è´å¯¹è±¡çš„æ–¹å¼ï¼Œå®ƒä»¬åœ¨æ‹·è´å¯¹è±¡çš„æ–¹å¼ä¸Šæœ‰å¾ˆå¤§ä¸åŒã€‚ æµ…æ‹·è´ä¼šåˆ›å»ºä¸€ä¸ªæ–°å¯¹è±¡ï¼Œä½†è¿™ä¸ªæ–°å¯¹è±¡çš„å±æ€§ï¼ˆå­—æ®µï¼‰å’ŒåŸå¯¹è±¡çš„å±æ€§å®Œå…¨ç›¸åŒã€‚å¦‚æœå±æ€§æ˜¯åŸºæœ¬æ•°æ®ç±»å‹ï¼Œæ‹·è´çš„æ˜¯åŸºæœ¬æ•°æ®ç±»å‹çš„å€¼ï¼›å¦‚æœå±æ€§æ˜¯å¼•ç”¨ç±»å‹ï¼Œæ‹·è´çš„æ˜¯å¼•ç”¨åœ°å€ï¼Œå› æ­¤æ–°æ—§å¯¹è±¡å…±äº«åŒä¸€ä¸ªå¼•ç”¨å¯¹è±¡ã€‚ æµ…æ‹·è´çš„å®ç°æ–¹å¼ä¸ºï¼šå®ç° Cloneable æ¥å£å¹¶é‡å†™ clone() æ–¹æ³•ã€‚ class Person implements Cloneable String name; int age; Address address; public Person(String name, int age, Address address) this.name = name; this.age = age; this.address = address; @Override protected Object clone() throws CloneNotSupportedException return super.clone(); class Address String city; public Address(String city) this.city = city; public class Main public static void main(String[] args) throws CloneNotSupportedException Address address = new Address(æ²³å—çœæ´›é˜³å¸‚); Person person1 = new Person(æ²‰é»˜ç‹äºŒ, 18, address); Person person2 = (Person) person1.clone(); System.out.println(person1.address == person2.address); // true æ·±æ‹·è´ä¹Ÿä¼šåˆ›å»ºä¸€ä¸ªæ–°å¯¹è±¡ï¼Œä½†ä¼šé€’å½’åœ°å¤åˆ¶æ‰€æœ‰çš„å¼•ç”¨å¯¹è±¡ï¼Œç¡®ä¿æ–°å¯¹è±¡å’ŒåŸå¯¹è±¡å®Œå…¨ç‹¬ç«‹ã€‚æ–°å¯¹è±¡ä¸åŸå¯¹è±¡çš„ä»»ä½•æ›´æ”¹éƒ½ä¸ä¼šç›¸äº’å½±å“ã€‚ æ·±æ‹·è´çš„å®ç°æ–¹å¼æœ‰ï¼šæ‰‹åŠ¨å¤åˆ¶æ‰€æœ‰çš„å¼•ç”¨å¯¹è±¡ï¼Œæˆ–è€…ä½¿ç”¨åºåˆ—åŒ–ä¸ååºåˆ—åŒ–ã€‚ â‘ ã€æ‰‹åŠ¨æ‹·è´ class Person String name; int age; Address address; public Person(String name, int age, Address address) this.name = name; this.age = age; this.address = address; public Person(Person person) this.name = person.name; this.age = person.age; this.address = new Address(person.address.city); class Address String city; public Address(String city) this.city = city; public class Main public static void main(String[] args) Address address = new Address(æ²³å—çœæ´›é˜³å¸‚); Person person1 = new Person(æ²‰é»˜ç‹äºŒ, 18, address); Person person2 = new Person(person1); System.out.println(person1.address == person2.address); // false â‘¡ã€åºåˆ—åŒ–ä¸ååºåˆ—åŒ– import java.io.*;class Person implements Serializable String name; int age; Address address; public Person(String name, int age, Address address) this.name = name; this.age = age; this.address = address; public Person deepClone() throws IOException, ClassNotFoundException ByteArrayOutputStream bos = new ByteArrayOutputStream(); ObjectOutputStream oos = new ObjectOutputStream(bos); oos.writeObject(this); ByteArrayInputStream bis = new ByteArrayInputStream(bos.toByteArray()); ObjectInputStream ois = new ObjectInputStream(bis); return (Person) ois.readObject(); class Address implements Serializable String city; public Address(String city) this.city = city; public class Main public static void main(String[] args) throws IOException, ClassNotFoundException Address address = new Address(æ²³å—çœæ´›é˜³å¸‚); Person person1 = new Person(æ²‰é»˜ç‹äºŒ, 18, address); Person person2 = person1.deepClone(); System.out.println(person1.address == person2.address); // false 32.Java åˆ›å»ºå¯¹è±¡æœ‰å“ªå‡ ç§æ–¹å¼ï¼Ÿ Java æœ‰å››ç§åˆ›å»ºå¯¹è±¡çš„æ–¹å¼ï¼š â‘ ã€new å…³é”®å­—åˆ›å»ºï¼Œè¿™æ˜¯æœ€å¸¸è§å’Œç›´æ¥çš„æ–¹å¼ï¼Œé€šè¿‡è°ƒç”¨ç±»çš„æ„é€ æ–¹æ³•æ¥åˆ›å»ºå¯¹è±¡ã€‚ Person person = new Person(); â‘¡ã€åå°„æœºåˆ¶åˆ›å»ºï¼Œåå°„æœºåˆ¶å…è®¸åœ¨è¿è¡Œæ—¶åˆ›å»ºå¯¹è±¡ï¼Œå¹¶ä¸”å¯ä»¥è®¿é—®ç±»çš„ç§æœ‰æˆå‘˜ï¼Œåœ¨æ¡†æ¶å’Œå·¥å…·ç±»ä¸­æ¯”è¾ƒå¸¸è§ã€‚ Class clazz = Class.forName(Person);Person person = (Person) clazz.newInstance();// æ–°æ–¹å¼ï¼ˆæ¨èï¼‰//Person p2 = Person.class.getDeclaredConstructor().newInstance();// è°ƒç”¨æœ‰å‚æ„é€ æ–¹æ³•//ConstructorPerson constructor = Person.class.getDeclaredConstructor(String.class, int.class);//Person p3 = constructor.newInstance(å¼ ä¸‰, 25); â‘¢ã€clone æ‹·è´åˆ›å»ºï¼Œé€šè¿‡ clone æ–¹æ³•åˆ›å»ºå¯¹è±¡ï¼Œéœ€è¦å®ç° Cloneable æ¥å£å¹¶é‡å†™ clone æ–¹æ³•ã€‚ Person person = new Person();Person person2 = (Person) person.clone(); â‘£ã€åºåˆ—åŒ–æœºåˆ¶åˆ›å»ºï¼Œé€šè¿‡åºåˆ—åŒ–å°†å¯¹è±¡è½¬æ¢ä¸ºå­—èŠ‚æµï¼Œå†é€šè¿‡ååºåˆ—åŒ–ä»å­—èŠ‚æµä¸­æ¢å¤å¯¹è±¡ã€‚éœ€è¦å®ç° Serializable æ¥å£ã€‚ Person person = new Person();ObjectOutputStream oos = new ObjectOutputStream(new FileOutputStream(person.txt));oos.writeObject(person);ObjectInputStream ois = new ObjectInputStream(new FileInputStream(person.txt));Person person2 = (Person) ois.readObject(); new å­ç±»çš„æ—¶å€™ï¼Œå­ç±»å’Œçˆ¶ç±»é™æ€ä»£ç å—ï¼Œæ„é€ æ–¹æ³•çš„æ‰§è¡Œé¡ºåºåœ¨ Java ä¸­ï¼Œå½“åˆ›å»ºä¸€ä¸ªå­ç±»å¯¹è±¡æ—¶ï¼Œå­ç±»å’Œçˆ¶ç±»çš„é™æ€ä»£ç å—ã€æ„é€ æ–¹æ³•çš„æ‰§è¡Œé¡ºåºéµå¾ªä¸€å®šçš„è§„åˆ™ã€‚è¿™äº›è§„åˆ™ä¸»è¦åŒ…æ‹¬ä»¥ä¸‹å‡ ä¸ªæ­¥éª¤ï¼š é¦–å…ˆæ‰§è¡Œçˆ¶ç±»çš„é™æ€ä»£ç å—ï¼ˆä»…åœ¨ç±»ç¬¬ä¸€æ¬¡åŠ è½½æ—¶æ‰§è¡Œï¼‰ã€‚ æ¥ç€æ‰§è¡Œå­ç±»çš„é™æ€ä»£ç å—ï¼ˆä»…åœ¨ç±»ç¬¬ä¸€æ¬¡åŠ è½½æ—¶æ‰§è¡Œï¼‰ã€‚ å†æ‰§è¡Œçˆ¶ç±»çš„æ„é€ æ–¹æ³•ã€‚ æœ€åæ‰§è¡Œå­ç±»çš„æ„é€ æ–¹æ³•ã€‚ ä¸‹é¢æ˜¯ä¸€ä¸ªè¯¦ç»†çš„ä»£ç ç¤ºä¾‹ï¼š class Parent // çˆ¶ç±»é™æ€ä»£ç å— static System.out.println(çˆ¶ç±»é™æ€ä»£ç å—); // çˆ¶ç±»æ„é€ æ–¹æ³• public Parent() System.out.println(çˆ¶ç±»æ„é€ æ–¹æ³•); class Child extends Parent // å­ç±»é™æ€ä»£ç å— static System.out.println(å­ç±»é™æ€ä»£ç å—); // å­ç±»æ„é€ æ–¹æ³• public Child() System.out.println(å­ç±»æ„é€ æ–¹æ³•); public class Main public static void main(String[] args) new Child(); æ‰§è¡Œä¸Šè¿°ä»£ç æ—¶ï¼Œè¾“å‡ºç»“æœå¦‚ä¸‹ï¼š çˆ¶ç±»é™æ€ä»£ç å—å­ç±»é™æ€ä»£ç å—çˆ¶ç±»æ„é€ æ–¹æ³•å­ç±»æ„é€ æ–¹æ³• é™æ€ä»£ç å—ï¼šåœ¨ç±»åŠ è½½æ—¶æ‰§è¡Œï¼Œä»…æ‰§è¡Œä¸€æ¬¡ï¼ŒæŒ‰çˆ¶ç±»-å­ç±»çš„é¡ºåºæ‰§è¡Œã€‚ æ„é€ æ–¹æ³•ï¼šåœ¨æ¯æ¬¡åˆ›å»ºå¯¹è±¡æ—¶æ‰§è¡Œï¼ŒæŒ‰çˆ¶ç±»-å­ç±»çš„é¡ºåºæ‰§è¡Œï¼Œå…ˆåˆå§‹åŒ–å—åæ„é€ æ–¹æ³•ã€‚ Stringç¯‡33.String æ˜¯ Java åŸºæœ¬æ•°æ®ç±»å‹å—ï¼Ÿå¯ä»¥è¢«ç»§æ‰¿å—ï¼Ÿä¸æ˜¯ï¼ŒStringÂ æ˜¯ä¸€ä¸ªç±»ï¼Œå±äºå¼•ç”¨æ•°æ®ç±»å‹ã€‚Java çš„åŸºæœ¬æ•°æ®ç±»å‹åŒ…æ‹¬å…«ç§ï¼šå››ç§æ•´å‹ï¼ˆbyteã€shortã€intã€longï¼‰ã€ä¸¤ç§æµ®ç‚¹å‹ï¼ˆfloatã€doubleï¼‰ã€ä¸€ç§å­—ç¬¦å‹ï¼ˆcharï¼‰å’Œä¸€ç§å¸ƒå°”å‹ï¼ˆbooleanï¼‰ã€‚ String ç±»å¯ä»¥ç»§æ‰¿å—ï¼Ÿä¸è¡Œã€‚String ç±»ä½¿ç”¨ final ä¿®é¥°ï¼Œæ˜¯æ‰€è°“çš„ä¸å¯å˜ç±»ï¼Œæ— æ³•è¢«ç»§æ‰¿ã€‚ String æœ‰å“ªäº›å¸¸ç”¨æ–¹æ³•ï¼Ÿæˆ‘å¸¸ç”¨çš„æœ‰ï¼š length()Â - è¿”å›å­—ç¬¦ä¸²çš„é•¿åº¦ã€‚ charAt(int index)Â - è¿”å›æŒ‡å®šä½ç½®çš„å­—ç¬¦ã€‚ substring(int beginIndex, int endIndex)Â - è¿”å›å­—ç¬¦ä¸²çš„ä¸€ä¸ªå­ä¸²ï¼Œä»Â beginIndexÂ åˆ°Â endIndex-1ã€‚ contains(CharSequence s)Â - æ£€æŸ¥å­—ç¬¦ä¸²æ˜¯å¦åŒ…å«æŒ‡å®šçš„å­—ç¬¦åºåˆ—ã€‚ equals(Object anotherObject)Â - æ¯”è¾ƒä¸¤ä¸ªå­—ç¬¦ä¸²çš„å†…å®¹æ˜¯å¦ç›¸ç­‰ã€‚ indexOf(int ch)Â å’ŒÂ indexOf(String str)Â - è¿”å›æŒ‡å®šå­—ç¬¦æˆ–å­—ç¬¦ä¸²é¦–æ¬¡å‡ºç°çš„ä½ç½®ã€‚ replace(char oldChar, char newChar)Â å’ŒÂ replace(CharSequence target, CharSequence replacement)Â - æ›¿æ¢å­—ç¬¦ä¸²ä¸­çš„å­—ç¬¦æˆ–å­—ç¬¦åºåˆ—ã€‚ trim()Â - å»é™¤å­—ç¬¦ä¸²ä¸¤ç«¯çš„ç©ºç™½å­—ç¬¦ã€‚ split(String regex)Â - æ ¹æ®ç»™å®šæ­£åˆ™è¡¨è¾¾å¼çš„åŒ¹é…æ‹†åˆ†æ­¤å­—ç¬¦ä¸²ã€‚ 34.ğŸŒŸString å’Œ StringBuilderã€StringBuffer çš„åŒºåˆ«ï¼Ÿæ¨èé˜…è¯»ï¼šStringBuffer å’Œ StringBuilder ä¸¤å…„å¼Ÿ Stringã€StringBuilderå’ŒStringBufferåœ¨ Java ä¸­éƒ½æ˜¯ç”¨äºå¤„ç†å­—ç¬¦ä¸²çš„ï¼Œå®ƒä»¬ä¹‹é—´çš„åŒºåˆ«æ˜¯ï¼ŒString æ˜¯ä¸å¯å˜çš„ï¼Œå¹³å¸¸å¼€å‘ç”¨å¾—æœ€å¤šï¼Œå½“é‡åˆ°å¤§é‡å­—ç¬¦ä¸²è¿æ¥æ—¶ï¼Œå°±ç”¨ StringBuilderï¼Œå®ƒä¸ä¼šç”Ÿæˆå¾ˆå¤šæ–°çš„å¯¹è±¡ï¼ŒStringBuffer å’Œ StringBuilder ç±»ä¼¼ï¼Œä½†æ¯ä¸ªæ–¹æ³•ä¸Šéƒ½åŠ äº† synchronized å…³é”®å­—ï¼Œæ‰€ä»¥æ˜¯çº¿ç¨‹å®‰å…¨çš„ã€‚ è¯·è¯´è¯´ String çš„ç‰¹ç‚¹ Stringç±»çš„å¯¹è±¡æ˜¯ä¸å¯å˜çš„ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œä¸€æ—¦ä¸€ä¸ªStringå¯¹è±¡è¢«åˆ›å»ºï¼Œå®ƒæ‰€åŒ…å«çš„å­—ç¬¦ä¸²å†…å®¹æ˜¯ä¸å¯æ”¹å˜çš„ã€‚ æ¯æ¬¡å¯¹Stringå¯¹è±¡è¿›è¡Œä¿®æ”¹æ“ä½œï¼ˆå¦‚æ‹¼æ¥ã€æ›¿æ¢ç­‰ï¼‰å®é™…ä¸Šéƒ½ä¼šç”Ÿæˆä¸€ä¸ªæ–°çš„Stringå¯¹è±¡ï¼Œè€Œä¸æ˜¯ä¿®æ”¹åŸæœ‰å¯¹è±¡ã€‚è¿™å¯èƒ½ä¼šå¯¼è‡´å†…å­˜å’Œæ€§èƒ½å¼€é”€ï¼Œå°¤å…¶æ˜¯åœ¨å¤§é‡å­—ç¬¦ä¸²æ“ä½œçš„æƒ…å†µä¸‹ã€‚ è¯·è¯´è¯´ StringBuilder çš„ç‰¹ç‚¹ StringBuilderæä¾›äº†ä¸€ç³»åˆ—çš„æ–¹æ³•æ¥è¿›è¡Œå­—ç¬¦ä¸²çš„å¢åˆ æ”¹æŸ¥æ“ä½œï¼Œè¿™äº›æ“ä½œéƒ½æ˜¯ç›´æ¥åœ¨åŸæœ‰å­—ç¬¦ä¸²å¯¹è±¡çš„åº•å±‚æ•°ç»„ä¸Šè¿›è¡Œçš„ï¼Œè€Œä¸æ˜¯ç”Ÿæˆæ–°çš„ String å¯¹è±¡ã€‚ StringBuilderä¸æ˜¯çº¿ç¨‹å®‰å…¨çš„ã€‚è¿™æ„å‘³ç€åœ¨æ²¡æœ‰å¤–éƒ¨åŒæ­¥çš„æƒ…å†µä¸‹ï¼Œå®ƒä¸é€‚ç”¨äºå¤šçº¿ç¨‹ç¯å¢ƒã€‚ ç›¸æ¯”äºStringï¼Œåœ¨è¿›è¡Œé¢‘ç¹çš„å­—ç¬¦ä¸²ä¿®æ”¹æ“ä½œæ—¶ï¼ŒStringBuilderèƒ½æä¾›æ›´å¥½çš„æ€§èƒ½ã€‚ Java ä¸­çš„å­—ç¬¦ä¸²è¿+æ“ä½œå…¶å®å°±æ˜¯é€šè¿‡StringBuilderå®ç°çš„ã€‚ è¯·è¯´è¯´ StringBuffer çš„ç‰¹ç‚¹StringBufferå’ŒStringBuilderç±»ä¼¼ï¼Œä½†StringBufferæ˜¯çº¿ç¨‹å®‰å…¨çš„ï¼Œæ–¹æ³•å‰é¢éƒ½åŠ äº†synchronizedå…³é”®å­—ã€‚ è¯·æ€»ç»“ä¸€ä¸‹ä½¿ç”¨åœºæ™¯ Stringï¼šé€‚ç”¨äºå­—ç¬¦ä¸²å†…å®¹ä¸ä¼šæ”¹å˜çš„åœºæ™¯ï¼Œæ¯”å¦‚è¯´ä½œä¸º HashMap çš„ keyã€‚ StringBuilderï¼šé€‚ç”¨äºå•çº¿ç¨‹ç¯å¢ƒä¸‹éœ€è¦é¢‘ç¹ä¿®æ”¹å­—ç¬¦ä¸²å†…å®¹çš„åœºæ™¯ï¼Œæ¯”å¦‚åœ¨å¾ªç¯ä¸­æ‹¼æ¥æˆ–ä¿®æ”¹å­—ç¬¦ä¸²ï¼Œæ˜¯ String çš„å®Œç¾æ›¿ä»£å“ã€‚ StringBufferï¼šç°åœ¨å·²ç»ä¸æ€ä¹ˆç”¨äº†ï¼Œå› ä¸ºä¸€èˆ¬ä¸ä¼šåœ¨å¤šçº¿ç¨‹åœºæ™¯ä¸‹å»é¢‘ç¹çš„ä¿®æ”¹å­—ç¬¦ä¸²å†…å®¹ã€‚ 35.String str1 new String(â€œabcâ€) å’Œ String str2 â€œabcâ€ çš„åŒºåˆ«ï¼Ÿç›´æ¥ä½¿ç”¨åŒå¼•å·ä¸ºå­—ç¬¦ä¸²å˜é‡èµ‹å€¼æ—¶ï¼ŒJava é¦–å…ˆä¼šæ£€æŸ¥å­—ç¬¦ä¸²å¸¸é‡æ± ä¸­æ˜¯å¦å·²ç»å­˜åœ¨ç›¸åŒå†…å®¹çš„å­—ç¬¦ä¸²ã€‚ å¦‚æœå­˜åœ¨ï¼ŒJava å°±ä¼šè®©æ–°çš„å˜é‡å¼•ç”¨æ± ä¸­çš„é‚£ä¸ªå­—ç¬¦ä¸²ï¼›å¦‚æœä¸å­˜åœ¨ï¼Œå®ƒä¼šåˆ›å»ºä¸€ä¸ªæ–°çš„å­—ç¬¦ä¸²ï¼Œæ”¾å…¥æ± ä¸­ï¼Œå¹¶è®©å˜é‡å¼•ç”¨å®ƒã€‚ ä½¿ç”¨Â new String(abc)Â çš„æ–¹å¼åˆ›å»ºå­—ç¬¦ä¸²æ—¶ï¼Œå®é™…åˆ†ä¸ºä¸¤æ­¥ï¼š ç¬¬ä¸€æ­¥ï¼Œå…ˆæ£€æŸ¥å­—ç¬¦ä¸²å­—é¢é‡ â€œabcâ€ æ˜¯å¦åœ¨å­—ç¬¦ä¸²å¸¸é‡æ± ä¸­ï¼Œå¦‚æœæ²¡æœ‰åˆ™åˆ›å»ºä¸€ä¸ªï¼›å¦‚æœå·²ç»å­˜åœ¨ï¼Œåˆ™å¼•ç”¨å®ƒã€‚ ç¬¬äºŒæ­¥ï¼Œåœ¨å †ä¸­å†åˆ›å»ºä¸€ä¸ªæ–°çš„å­—ç¬¦ä¸²å¯¹è±¡ï¼Œå¹¶å°†å…¶åˆå§‹åŒ–ä¸ºå­—ç¬¦ä¸²å¸¸é‡æ± ä¸­ â€œabcâ€ çš„ä¸€ä¸ªå‰¯æœ¬ã€‚ ä¹Ÿå°±æ˜¯è¯´ï¼š String s1 = æ²‰é»˜ç‹äºŒ;String s2 = æ²‰é»˜ç‹äºŒ;String s3 = new String(æ²‰é»˜ç‹äºŒ);System.out.println(s1 == s2); // è¾“å‡º trueï¼Œå› ä¸º s1 å’Œ s2 å¼•ç”¨çš„æ˜¯å­—ç¬¦ä¸²å¸¸é‡æ± ä¸­åŒä¸€ä¸ªå¯¹è±¡ã€‚System.out.println(s1 == s3); // è¾“å‡º falseï¼Œå› ä¸º s3 æ˜¯é€šè¿‡ new å…³é”®å­—æ˜¾å¼åˆ›å»ºçš„ï¼ŒæŒ‡å‘å †ä¸Šä¸åŒçš„å¯¹è±¡ã€‚ String s new String(â€œabcâ€)åˆ›å»ºäº†å‡ ä¸ªå¯¹è±¡ï¼Ÿå­—ç¬¦ä¸²å¸¸é‡æ± ä¸­å¦‚æœä¹‹å‰å·²ç»æœ‰ä¸€ä¸ªï¼Œåˆ™ä¸å†åˆ›å»ºæ–°çš„ï¼Œç›´æ¥å¼•ç”¨ï¼›å¦‚æœæ²¡æœ‰ï¼Œåˆ™åˆ›å»ºä¸€ä¸ªã€‚ å †ä¸­è‚¯å®šæœ‰ä¸€ä¸ªï¼Œå› ä¸ºåªè¦ä½¿ç”¨äº† new å…³é”®å­—ï¼Œè‚¯å®šä¼šåœ¨å †ä¸­åˆ›å»ºä¸€ä¸ªã€‚ 36.String æ˜¯ä¸å¯å˜ç±»å—ï¼Ÿå­—ç¬¦ä¸²æ‹¼æ¥æ˜¯å¦‚ä½•å®ç°çš„ï¼ŸString æ˜¯ä¸å¯å˜çš„ï¼Œè¿™æ„å‘³ç€ä¸€æ—¦ä¸€ä¸ª String å¯¹è±¡è¢«åˆ›å»ºï¼Œå…¶å­˜å‚¨çš„æ–‡æœ¬å†…å®¹å°±ä¸èƒ½è¢«æ”¹å˜ã€‚è¿™æ˜¯å› ä¸ºï¼š â‘ ã€ä¸å¯å˜æ€§ä½¿å¾— String å¯¹è±¡åœ¨ä½¿ç”¨ä¸­æ›´åŠ å®‰å…¨ã€‚å› ä¸ºå­—ç¬¦ä¸²ç»å¸¸ç”¨ä½œå‚æ•°ä¼ é€’ç»™å…¶ä»– Java æ–¹æ³•ï¼Œä¾‹å¦‚ç½‘ç»œè¿æ¥ã€æ‰“å¼€æ–‡ä»¶ç­‰ã€‚ å¦‚æœ String æ˜¯å¯å˜çš„ï¼Œè¿™äº›æ–¹æ³•è°ƒç”¨çš„å‚æ•°å€¼å°±å¯èƒ½åœ¨ä¸çŸ¥ä¸è§‰ä¸­è¢«æ”¹å˜ï¼Œä»è€Œå¯¼è‡´ç½‘ç»œè¿æ¥è¢«ç¯¡æ”¹ã€æ–‡ä»¶è¢«è«åå…¶å¦™åœ°ä¿®æ”¹ç­‰é—®é¢˜ã€‚ â‘¡ã€ä¸å¯å˜çš„å¯¹è±¡å› ä¸ºçŠ¶æ€ä¸ä¼šæ”¹å˜ï¼Œæ‰€ä»¥æ›´å®¹æ˜“è¿›è¡Œç¼“å­˜å’Œé‡ç”¨ã€‚å­—ç¬¦ä¸²å¸¸é‡æ± çš„å‡ºç°æ­£æ˜¯åŸºäºè¿™ä¸ªåŸå› ã€‚ å½“ä»£ç ä¸­å‡ºç°ç›¸åŒçš„å­—ç¬¦ä¸²å­—é¢é‡æ—¶ï¼ŒJVM ä¼šç¡®ä¿æ‰€æœ‰çš„å¼•ç”¨éƒ½æŒ‡å‘å¸¸é‡æ± ä¸­çš„åŒä¸€ä¸ªå¯¹è±¡ï¼Œä»è€ŒèŠ‚çº¦å†…å­˜ã€‚ â‘¢ã€å› ä¸º String çš„å†…å®¹ä¸ä¼šæ”¹å˜ï¼Œæ‰€ä»¥å®ƒçš„å“ˆå¸Œå€¼ä¹Ÿå°±å›ºå®šä¸å˜ã€‚è¿™ä½¿å¾— String å¯¹è±¡ç‰¹åˆ«é€‚åˆä½œä¸º HashMap æˆ– HashSet ç­‰é›†åˆçš„é”®ï¼Œå› ä¸ºè®¡ç®—å“ˆå¸Œå€¼åªéœ€è¦è¿›è¡Œä¸€æ¬¡ï¼Œæé«˜äº†å“ˆå¸Œè¡¨æ“ä½œçš„æ•ˆç‡ã€‚ å­—ç¬¦ä¸²æ‹¼æ¥æ˜¯å¦‚ä½•å®ç°çš„ï¼Ÿå› ä¸º String æ˜¯ä¸å¯å˜çš„ï¼Œå› æ­¤é€šè¿‡â€œ+â€æ“ä½œç¬¦è¿›è¡Œçš„å­—ç¬¦ä¸²æ‹¼æ¥ï¼Œä¼šç”Ÿæˆæ–°çš„å­—ç¬¦ä¸²å¯¹è±¡ã€‚ ä¾‹å¦‚ï¼š String a = hello ;String b = world!;String ab = a + b; a å’Œ b æ˜¯é€šè¿‡åŒå¼•å·å®šä¹‰çš„ï¼Œæ‰€ä»¥ä¼šåœ¨å­—ç¬¦ä¸²å¸¸é‡æ± ä¸­ï¼Œè€Œ ab æ˜¯é€šè¿‡â€œ+â€æ“ä½œç¬¦æ‹¼æ¥çš„ï¼Œæ‰€ä»¥ä¼šåœ¨å †ä¸­ç”Ÿæˆä¸€ä¸ªæ–°çš„å¯¹è±¡ã€‚ Java 8 æ—¶ï¼ŒJDK å¯¹â€œ+â€å·çš„å­—ç¬¦ä¸²æ‹¼æ¥è¿›è¡Œäº†ä¼˜åŒ–ï¼ŒJava ä¼šåœ¨ç¼–è¯‘æœŸåŸºäº StringBuilder çš„ append æ–¹æ³•è¿›è¡Œæ‹¼æ¥ã€‚ ä¸‹é¢æ˜¯é€šè¿‡ javap -verbose å‘½ä»¤åç¼–è¯‘åçš„å­—èŠ‚ç ï¼Œèƒ½æ¸…æ¥šçš„çœ‹åˆ° StringBuilder çš„åˆ›å»ºå’Œ append æ–¹æ³•çš„è°ƒç”¨ã€‚ //è¡¨ç¤ºè¿™ä¸ªæ–¹æ³•éœ€è¦ä¸¤ä¸ªæ“ä½œæ•°æ ˆæ·±åº¦ 4ä¸ªå±€éƒ¨å˜é‡æ§½ å‚æ•°æ•°é‡ä¸º1stack=2, locals=4, args_size=1 //ä»å¸¸é‡æ± åŠ è½½#2ä½ç½®çš„å¸¸é‡helloåˆ°æ ˆé¡¶ 0: ldc #2 // String hello //å°†æ ˆé¡¶çš„å€¼å­˜å‚¨åˆ°å±€éƒ¨å˜é‡è¡¨slot 1(å¯¹åº”å˜é‡a) 2: astore_1 //ä»å¸¸é‡æ± åŠ è½½#3ä½ç½®çš„å¸¸é‡(world!)åˆ°æ ˆé¡¶ 3: ldc #3 // String world! //å°†æ ˆé¡¶å€¼å­˜å‚¨åˆ°å±€éƒ¨å˜é‡è¡¨slot 2(å¯¹åº”å˜é‡b) 5: astore_2 //åˆ›å»ºStringBuilderå¯¹è±¡ 6: new #4 // class java/lang/StringBuilder //å¤åˆ¶æ ˆé¡¶å€¼(æ–°åˆ›å»ºçš„StringBuilderå¯¹è±¡) 9: dup //è°ƒç”¨StringBuilderçš„æ„é€ æ–¹æ³• 10: invokespecial #5 // Method java/lang/StringBuilder.init:()V //åŠ è½½å±€éƒ¨å˜é‡slot 1çš„å€¼(å˜é‡a)åˆ°æ ˆé¡¶ 13: aload_1 //è°ƒç”¨StringBuilder.append()æ–¹æ³•æ‹¼æ¥ç¬¬ä¸€ä¸ªå­—ç¬¦ä¸² 14: invokevirtual #6 // Method java/lang/StringBuilder.append:(Ljava/lang/String;)Ljava/lang/StringBuilder; //åŠ è½½å±€éƒ¨å˜é‡slot 2çš„å€¼(å˜é‡b)åˆ°æ ˆé¡¶ 17: aload_2 //å†æ¬¡è°ƒç”¨StringBuilder.append()æ–¹æ³•æ‹¼æ¥ç¬¬äºŒä¸ªå­—ç¬¦ä¸² 18: invokevirtual #6 // Method java/lang/StringBuilder.append:(Ljava/lang/String;)Ljava/lang/StringBuilder; //è°ƒç”¨StringBuilder.toString()æ–¹æ³•ç”Ÿæˆæœ€ç»ˆå­—ç¬¦ä¸² 21: invokevirtual #7 // Method java/lang/StringBuilder.toString:()Ljava/lang/String; //å°†ç»“æœå­˜å‚¨åˆ°å±€éƒ¨å˜é‡slot 3(å¯¹åº”å˜é‡ab) 24: astore_3 //æ–¹æ³•è¿”å› 25: return ä¹Ÿå°±æ˜¯è¯´ï¼Œä¸Šé¢çš„ä»£ç ç›¸å½“äºï¼š String a = hello ;String b = world!;StringBuilder sb = new StringBuilder();sb.append(a);sb.append(b);String ab = sb.toString(); å› æ­¤ï¼Œå¦‚æœç¬¼ç»Ÿåœ°è®²ï¼Œé€šè¿‡åŠ å·æ‹¼æ¥å­—ç¬¦ä¸²æ—¶ä¼šåˆ›å»ºå¤šä¸ª String å¯¹è±¡æ˜¯ä¸å‡†ç¡®çš„ã€‚å› ä¸ºåŠ å·æ‹¼æ¥åœ¨ç¼–è¯‘æœŸè¿˜ä¼šåˆ›å»ºä¸€ä¸ª StringBuilder å¯¹è±¡ï¼Œæœ€ç»ˆè°ƒç”¨Â toString()Â æ–¹æ³•çš„æ—¶å€™å†è¿”å›ä¸€ä¸ªæ–°çš„ String å¯¹è±¡ã€‚ @Overridepublic String toString() // Create a copy, dont share the array return new String(value, 0, count); é‚£é™¤äº†ä½¿ç”¨Â +Â å·æ¥æ‹¼æ¥å­—ç¬¦ä¸²ï¼Œè¿˜æœ‰Â StringBuilder.append()ã€String.join()Â ç­‰æ–¹å¼ã€‚ æ¨èé˜…è¯»ï¼šå¦‚ä½•æ‹¼æ¥å­—ç¬¦ä¸²ï¼Ÿ å¦‚ä½•ä¿è¯ String ä¸å¯å˜ï¼Ÿç¬¬ä¸€ï¼ŒString ç±»å†…éƒ¨ä½¿ç”¨ä¸€ä¸ªç§æœ‰çš„å­—ç¬¦æ•°ç»„æ¥å­˜å‚¨å­—ç¬¦ä¸²æ•°æ®ã€‚è¿™ä¸ªå­—ç¬¦æ•°ç»„åœ¨åˆ›å»ºå­—ç¬¦ä¸²æ—¶è¢«åˆå§‹åŒ–ï¼Œä¹‹åä¸å…è®¸è¢«æ”¹å˜ã€‚ private final char value[]; ç¬¬äºŒï¼ŒString ç±»æ²¡æœ‰æä¾›ä»»ä½•å¯ä»¥ä¿®æ”¹å…¶å†…å®¹çš„å…¬å…±æ–¹æ³•ï¼Œåƒ concat è¿™äº›çœ‹ä¼¼ä¿®æ”¹å­—ç¬¦ä¸²çš„æ“ä½œï¼Œå®é™…ä¸Šéƒ½æ˜¯è¿”å›ä¸€ä¸ªæ–°åˆ›å»ºçš„å­—ç¬¦ä¸²å¯¹è±¡ï¼Œè€ŒåŸå§‹å­—ç¬¦ä¸²å¯¹è±¡ä¿æŒä¸å˜ã€‚ public String concat(String str) if (str.isEmpty()) return this; int len = value.length; int otherLen = str.length(); char buf[] = Arrays.copyOf(value, len + otherLen); str.getChars(buf, len); return new String(buf, true); ç¬¬ä¸‰ï¼ŒString ç±»æœ¬èº«è¢«å£°æ˜ä¸º finalï¼Œè¿™æ„å‘³ç€å®ƒä¸èƒ½è¢«ç»§æ‰¿ã€‚è¿™é˜²æ­¢äº†å­ç±»å¯èƒ½é€šè¿‡æ·»åŠ ä¿®æ”¹æ–¹æ³•æ¥æ”¹å˜å­—ç¬¦ä¸²å†…å®¹çš„å¯èƒ½æ€§ã€‚ public final class String 37.intern æ–¹æ³•æœ‰ä»€ä¹ˆä½œç”¨ï¼ŸJDK æºç é‡Œå·²ç»å¯¹è¿™ä¸ªæ–¹æ³•è¿›è¡Œäº†è¯´æ˜ï¼š * p* When the intern method is invoked, if the pool already contains a* string equal to this @code String object as determined by* the @link #equals(Object) method, then the string from the pool is* returned. Otherwise, this @code String object is added to the* pool and a reference to this @code String object is returned.* p æ„æ€ä¹Ÿå¾ˆå¥½æ‡‚ï¼š å¦‚æœå½“å‰å­—ç¬¦ä¸²å†…å®¹å­˜åœ¨äºå­—ç¬¦ä¸²å¸¸é‡æ± ï¼ˆå³ equals()æ–¹æ³•ä¸º trueï¼Œä¹Ÿå°±æ˜¯å†…å®¹ä¸€æ ·ï¼‰ï¼Œç›´æ¥è¿”å›å­—ç¬¦ä¸²å¸¸é‡æ± ä¸­çš„å­—ç¬¦ä¸² å¦åˆ™ï¼Œå°†æ­¤ String å¯¹è±¡æ·»åŠ åˆ°æ± ä¸­ï¼Œå¹¶è¿”å› String å¯¹è±¡çš„å¼•ç”¨ Integerç¯‡38.åˆ¤æ–­å‡ ä¸ªIntegerå¯¹è±¡æ˜¯å¦ç›¸ç­‰Integer a 127ï¼ŒInteger b 127ï¼›Integer c 128ï¼ŒInteger d 128ï¼›ç›¸ç­‰å—? æ¨èé˜…è¯»ï¼šIntegerCache æ¨èé˜…è¯»ï¼šæ·±å…¥æµ…å‡º Java æ‹†ç®±ä¸è£…ç®± a å’Œ b ç›¸ç­‰ï¼Œc å’Œ d ä¸ç›¸ç­‰ã€‚ è¿™ä¸ªé—®é¢˜æ¶‰åŠåˆ° Java çš„è‡ªåŠ¨è£…ç®±æœºåˆ¶ä»¥åŠIntegerç±»çš„ç¼“å­˜æœºåˆ¶ã€‚ å¯¹äºç¬¬ä¸€å¯¹ï¼š Integer a = 127;Integer b = 127; aå’Œbæ˜¯ç›¸ç­‰çš„ã€‚è¿™æ˜¯å› ä¸º Java åœ¨è‡ªåŠ¨è£…ç®±è¿‡ç¨‹ä¸­ï¼Œä¼šä½¿ç”¨Integer.valueOf()æ–¹æ³•æ¥åˆ›å»ºIntegerå¯¹è±¡ã€‚ Integer.valueOf()æ–¹æ³•ä¼šé’ˆå¯¹æ•°å€¼åœ¨-128 åˆ° 127 ä¹‹é—´çš„Integerå¯¹è±¡ä½¿ç”¨ç¼“å­˜ã€‚å› æ­¤ï¼Œaå’Œbå®é™…ä¸Šå¼•ç”¨äº†å¸¸é‡æ± ä¸­ç›¸åŒçš„Integerå¯¹è±¡ã€‚ å¯¹äºç¬¬äºŒå¯¹ï¼š Integer c = 128;Integer d = 128; cå’Œdä¸ç›¸ç­‰ã€‚è¿™æ˜¯å› ä¸º 128 è¶…å‡ºäº†Integerç¼“å­˜çš„èŒƒå›´(-128 åˆ° 127)ã€‚ å› æ­¤ï¼Œè‡ªåŠ¨è£…ç®±è¿‡ç¨‹ä¼šä¸ºcå’Œdåˆ›å»ºä¸¤ä¸ªä¸åŒçš„Integerå¯¹è±¡ï¼Œå®ƒä»¬æœ‰ä¸åŒçš„å¼•ç”¨åœ°å€ã€‚ å¯ä»¥é€šè¿‡==è¿ç®—ç¬¦æ¥æ£€æŸ¥å®ƒä»¬æ˜¯å¦ç›¸ç­‰ï¼š System.out.println(a == b); // è¾“å‡ºtrueSystem.out.println(c == d); // è¾“å‡ºfalse è¦æ¯”è¾ƒIntegerå¯¹è±¡çš„æ•°å€¼æ˜¯å¦ç›¸ç­‰ï¼Œåº”è¯¥ä½¿ç”¨equalsæ–¹æ³•ï¼Œè€Œä¸æ˜¯==è¿ç®—ç¬¦ï¼š System.out.println(a.equals(b)); // è¾“å‡ºtrueSystem.out.println(c.equals(d)); // è¾“å‡ºtrue ä½¿ç”¨equalsæ–¹æ³•æ—¶ï¼Œcå’Œdçš„æ¯”è¾ƒç»“æœä¸ºtrueï¼Œå› ä¸ºequalsæ¯”è¾ƒçš„æ˜¯å¯¹è±¡çš„æ•°å€¼ï¼Œè€Œä¸æ˜¯å¼•ç”¨åœ°å€ã€‚ ä»€ä¹ˆæ˜¯ Integer ç¼“å­˜ï¼Ÿå°±æ‹¿ Integer çš„ç¼“å­˜åƒæ¥è¯´å§ã€‚æ ¹æ®å®è·µå‘ç°ï¼Œå¤§éƒ¨åˆ†çš„æ•°æ®æ“ä½œéƒ½é›†ä¸­åœ¨å€¼æ¯”è¾ƒå°çš„èŒƒå›´ï¼Œå› æ­¤ Integer æäº†ä¸ªç¼“å­˜æ± ï¼Œé»˜è®¤èŒƒå›´æ˜¯ -128 åˆ° 127ã€‚ å½“æˆ‘ä»¬ä½¿ç”¨è‡ªåŠ¨è£…ç®±æ¥åˆ›å»ºè¿™ä¸ªèŒƒå›´å†…çš„ Integer å¯¹è±¡æ—¶ï¼ŒJava ä¼šç›´æ¥ä»ç¼“å­˜ä¸­è¿”å›ä¸€ä¸ªå·²å­˜åœ¨çš„å¯¹è±¡ï¼Œè€Œä¸æ˜¯æ¯æ¬¡éƒ½åˆ›å»ºä¸€ä¸ªæ–°çš„å¯¹è±¡ã€‚è¿™æ„å‘³ç€ï¼Œå¯¹äºè¿™ä¸ªå€¼èŒƒå›´å†…çš„æ‰€æœ‰ Integer å¯¹è±¡ï¼Œå®ƒä»¬å®é™…ä¸Šæ˜¯å¼•ç”¨ç›¸åŒçš„å¯¹è±¡å®ä¾‹ã€‚ Integer ç¼“å­˜çš„ä¸»è¦ç›®çš„æ˜¯ä¼˜åŒ–æ€§èƒ½å’Œå†…å­˜ä½¿ç”¨ã€‚å¯¹äºå°æ•´æ•°çš„é¢‘ç¹æ“ä½œï¼Œä½¿ç”¨ç¼“å­˜å¯ä»¥æ˜¾è‘—å‡å°‘å¯¹è±¡åˆ›å»ºçš„æ•°é‡ã€‚ å¯ä»¥åœ¨è¿è¡Œçš„æ—¶å€™æ·»åŠ  -Djava.lang.Integer.IntegerCache.high=1000 æ¥è°ƒæ•´ç¼“å­˜æ± çš„æœ€å¤§å€¼ã€‚ å¼•ç”¨æ˜¯ Integer ç±»å‹ï¼Œ å³ä¾§æ˜¯ int åŸºæœ¬ç±»å‹æ—¶ï¼Œä¼šè¿›è¡Œè‡ªåŠ¨è£…ç®±ï¼Œè°ƒç”¨çš„å…¶å®æ˜¯ Integer.valueOf()æ–¹æ³•ï¼Œå®ƒä¼šè°ƒç”¨ IntegerCacheã€‚ public static Integer valueOf(int i) if (i = IntegerCache.low i = IntegerCache.high) return IntegerCache.cache[i + (-IntegerCache.low)]; return new Integer(i); IntegerCache æ˜¯ä¸€ä¸ªé™æ€å†…éƒ¨ç±»ï¼Œåœ¨é™æ€ä»£ç å—ä¸­ä¼šåˆå§‹åŒ–å¥½ç¼“å­˜çš„å€¼ã€‚ private static class IntegerCache â€¦â€¦ static //åˆ›å»ºIntegerå¯¹è±¡å­˜å‚¨ for(int k = 0; k cache.length; k++) cache[k] = new Integer(j++); â€¦â€¦ new Integer(10) new Integer(10) ç›¸ç­‰å—åœ¨ Java ä¸­ï¼Œä½¿ç”¨new Integer(10) == new Integer(10)è¿›è¡Œæ¯”è¾ƒæ—¶ï¼Œç»“æœæ˜¯ falseã€‚ è¿™æ˜¯å› ä¸º new å…³é”®å­—ä¼šåœ¨å †ï¼ˆHeapï¼‰ä¸Šä¸ºæ¯ä¸ª Integer å¯¹è±¡åˆ†é…æ–°çš„å†…å­˜ç©ºé—´ï¼Œæ‰€ä»¥è¿™é‡Œåˆ›å»ºäº†ä¸¤ä¸ªä¸åŒçš„ Integer å¯¹è±¡ï¼Œå®ƒä»¬æœ‰ä¸åŒçš„å†…å­˜åœ°å€ã€‚ å½“ä½¿ç”¨==è¿ç®—ç¬¦æ¯”è¾ƒè¿™ä¸¤ä¸ªå¯¹è±¡æ—¶ï¼Œå®é™…ä¸Šæ¯”è¾ƒçš„æ˜¯å®ƒä»¬çš„å†…å­˜åœ°å€ï¼Œè€Œä¸æ˜¯å®ƒä»¬çš„å€¼ï¼Œå› æ­¤å³ä½¿ä¸¤ä¸ªå¯¹è±¡ä»£è¡¨ç›¸åŒçš„æ•°å€¼ï¼ˆ10ï¼‰ï¼Œç»“æœä¹Ÿæ˜¯ falseã€‚ 39.String æ€ä¹ˆè½¬æˆ Integer çš„ï¼ŸåŸç†ï¼ŸString è½¬æˆ Integerï¼Œä¸»è¦æœ‰ä¸¤ä¸ªæ–¹æ³•ï¼š Integer.parseInt(String s)Integer.valueOf(String s)ä¸ç®¡å“ªä¸€ç§ï¼Œæœ€ç»ˆè¿˜æ˜¯ä¼šè°ƒç”¨ Integer ç±»å†…ä¸­çš„parseInt(String s, int radix)æ–¹æ³•ã€‚ æŠ›å»ä¸€äº›è¾¹ç•Œä¹‹ç±»çš„çœ‹çœ‹æ ¸å¿ƒä»£ç ï¼š public static int parseInt(String s, int radix) throws NumberFormatException int result = 0; //æ˜¯å¦æ˜¯è´Ÿæ•° boolean negative = false; //charå­—ç¬¦æ•°ç»„ä¸‹æ ‡å’Œé•¿åº¦ int i = 0, len = s.length(); â€¦â€¦ int digit; //åˆ¤æ–­å­—ç¬¦é•¿åº¦æ˜¯å¦å¤§äº0ï¼Œå¦åˆ™æŠ›å‡ºå¼‚å¸¸ if (len 0) â€¦â€¦ while (i len) // Accumulating negatively avoids surprises near MAX_VALUE //è¿”å›æŒ‡å®šåŸºæ•°ä¸­å­—ç¬¦è¡¨ç¤ºçš„æ•°å€¼ã€‚ï¼ˆæ­¤å¤„æ˜¯åè¿›åˆ¶æ•°å€¼ï¼‰ digit = Character.digit(s.charAt(i++),radix); //è¿›åˆ¶ä½ä¹˜ä»¥æ•°å€¼ result *= radix; result -= digit; //æ ¹æ®ä¸Šé¢å¾—åˆ°çš„æ˜¯å¦è´Ÿæ•°ï¼Œè¿”å›ç›¸åº”çš„å€¼ return negative ? result : -result; å»æ‰ææè”“è”“ï¼ˆå½“ç„¶è¿™äº›ææè”“è”“å¯ä»¥å»çœ‹çœ‹ï¼Œæºç  cover äº†å¾ˆå¤šæƒ…å†µï¼‰ï¼Œå…¶å®å‰©ä¸‹çš„å°±æ˜¯ä¸€ä¸ªç®€å•çš„å­—ç¬¦ä¸²éå†è®¡ç®—ï¼Œä¸è¿‡è®¡ç®—æ–¹å¼æœ‰ç‚¹åå¸¸è§„ï¼Œæ˜¯ç”¨è´Ÿçš„å€¼ç´¯å‡ã€‚ Object40.Object ç±»çš„å¸¸è§æ–¹æ³•ï¼Ÿåœ¨ Java ä¸­ï¼Œç»å¸¸æåˆ°ä¸€ä¸ªè¯â€œä¸‡ç‰©çš†å¯¹è±¡â€ï¼Œå…¶ä¸­çš„â€œä¸‡ç‰©â€æŒ‡çš„æ˜¯ Java ä¸­çš„æ‰€æœ‰ç±»ï¼Œè€Œè¿™äº›ç±»éƒ½æ˜¯ Object ç±»çš„å­ç±»ã€‚ Object ä¸»è¦æä¾›äº† 11 ä¸ªæ–¹æ³•ï¼Œå¤§è‡´å¯ä»¥åˆ†ä¸ºå…­ç±»ï¼š å¯¹è±¡æ¯”è¾ƒï¼šâ‘ ã€public native int hashCode()Â ï¼šnative æ–¹æ³•ï¼Œç”¨äºè¿”å›å¯¹è±¡çš„å“ˆå¸Œç ã€‚ public native int hashCode(); æŒ‰ç…§çº¦å®šï¼Œç›¸ç­‰çš„å¯¹è±¡å¿…é¡»å…·æœ‰ç›¸ç­‰çš„å“ˆå¸Œç ã€‚å¦‚æœé‡å†™äº† equals æ–¹æ³•ï¼Œå°±åº”è¯¥é‡å†™ hashCode æ–¹æ³•ã€‚å¯ä»¥ä½¿ç”¨Â Objects.hash()Â æ–¹æ³•æ¥ç”Ÿæˆå“ˆå¸Œç ã€‚ public int hashCode() return Objects.hash(name, age); â‘¡ã€public boolean equals(Object obj)ï¼šç”¨äºæ¯”è¾ƒ 2 ä¸ªå¯¹è±¡çš„å†…å­˜åœ°å€æ˜¯å¦ç›¸ç­‰ã€‚ public boolean equals(Object obj) return (this == obj); å¦‚æœæ¯”è¾ƒçš„æ˜¯ä¸¤ä¸ªå¯¹è±¡çš„å€¼æ˜¯å¦ç›¸ç­‰ï¼Œå°±è¦é‡å†™è¯¥æ–¹æ³•ï¼Œæ¯”å¦‚Â String ç±»ã€Integer ç±»ç­‰éƒ½é‡å†™äº†è¯¥æ–¹æ³•ã€‚ä¸¾ä¸ªä¾‹å­ï¼Œå‡å¦‚æœ‰ä¸€ä¸ª Person ç±»ï¼Œæˆ‘ä»¬è®¤ä¸ºåªè¦å¹´é¾„å’Œåå­—ç›¸åŒï¼Œå°±æ˜¯åŒä¸€ä¸ªäººï¼Œé‚£ä¹ˆå°±å¯ä»¥è¿™æ ·é‡å†™ equals æ–¹æ³•ï¼š class Person1 private String name; private int age; // çœç•¥ gettter å’Œ setter æ–¹æ³• public boolean equals(Object obj) if (this == obj) return true; if (obj instanceof Person1) Person1 p = (Person1) obj; return this.name.equals(p.getName()) this.age == p.getAge(); return false; å¯¹è±¡æ‹·è´ï¼šprotected native Object clone() throws CloneNotSupportedExceptionï¼šnative æ–¹æ³•ï¼Œè¿”å›æ­¤å¯¹è±¡çš„ä¸€ä¸ªå‰¯æœ¬ã€‚é»˜è®¤å®ç°åªåšæµ…æ‹·è´ï¼Œä¸”ç±»å¿…é¡»å®ç° Cloneable æ¥å£ã€‚ Object æœ¬èº«æ²¡æœ‰å®ç° Cloneable æ¥å£ï¼Œæ‰€ä»¥åœ¨ä¸é‡å†™ clone æ–¹æ³•çš„æƒ…å†µä¸‹ç›´æ¥ç›´æ¥è°ƒç”¨è¯¥æ–¹æ³•ä¼šå‘ç”Ÿ CloneNotSupportedException å¼‚å¸¸ã€‚ å¯¹è±¡è½¬å­—ç¬¦ä¸²ï¼špublic String toString()ï¼šè¿”å›å¯¹è±¡çš„å­—ç¬¦ä¸²è¡¨ç¤ºã€‚é»˜è®¤å®ç°è¿”å›ç±»å@å“ˆå¸Œç çš„åå…­è¿›åˆ¶è¡¨ç¤ºï¼Œä½†é€šå¸¸ä¼šè¢«é‡å†™ä»¥è¿”å›æ›´æœ‰æ„ä¹‰çš„ä¿¡æ¯ã€‚ public String toString() return getClass().getName() + @ + Integer.toHexString(hashCode()); æ¯”å¦‚è¯´ä¸€ä¸ª Person ç±»ï¼Œæˆ‘ä»¬å¯ä»¥é‡å†™ toString æ–¹æ³•ï¼Œè¿”å›ä¸€ä¸ªæœ‰æ„ä¹‰çš„å­—ç¬¦ä¸²ï¼š public String toString() return Person + name= + name + \\ + , age= + age + ; å½“ç„¶äº†ï¼Œè¿™é¡¹å·¥ä½œä¹Ÿå¯ä»¥ç›´æ¥äº¤ç»™ IDEï¼Œæ¯”å¦‚ IntelliJ IDEAï¼Œç›´æ¥å³é”®é€‰æ‹© Generateï¼Œç„¶åé€‰æ‹© toString æ–¹æ³•ï¼Œå°±ä¼šè‡ªåŠ¨ç”Ÿæˆä¸€ä¸ª toString æ–¹æ³•ã€‚ ä¹Ÿå¯ä»¥äº¤ç»™Â Lombokï¼Œä½¿ç”¨ @Data æ³¨è§£ï¼Œå®ƒä¼šè‡ªåŠ¨ç”Ÿæˆ toString æ–¹æ³•ã€‚ æ•°ç»„ä¹Ÿæ˜¯ä¸€ä¸ªå¯¹è±¡ï¼Œæ‰€ä»¥é€šå¸¸æˆ‘ä»¬æ‰“å°æ•°ç»„çš„æ—¶å€™ï¼Œä¼šçœ‹åˆ°è¯¸å¦‚Â [I@1b6d3586Â è¿™æ ·çš„å­—ç¬¦ä¸²ï¼Œè¿™ä¸ªå°±æ˜¯ int æ•°ç»„çš„å“ˆå¸Œç ã€‚ å¤šçº¿ç¨‹è°ƒåº¦ï¼šæ¯ä¸ªå¯¹è±¡éƒ½å¯ä»¥è°ƒç”¨ Object çš„ wait/notify æ–¹æ³•æ¥å®ç°ç­‰å¾…é€šçŸ¥æœºåˆ¶ã€‚æˆ‘ä»¬æ¥å†™ä¸€ä¸ªä¾‹å­ï¼š public class WaitNotifyDemo public static void main(String[] args) Object lock = new Object(); new Thread(() - synchronized (lock) System.out.println(çº¿ç¨‹1ï¼šæˆ‘è¦ç­‰å¾…); try lock.wait(); catch (InterruptedException e) e.printStackTrace(); System.out.println(çº¿ç¨‹1ï¼šæˆ‘è¢«å”¤é†’äº†); ).start(); new Thread(() - synchronized (lock) System.out.println(çº¿ç¨‹2ï¼šæˆ‘è¦å”¤é†’); lock.notify(); System.out.println(çº¿ç¨‹2ï¼šæˆ‘å·²ç»å”¤é†’äº†); ).start(); è§£é‡Šä¸€ä¸‹ï¼š çº¿ç¨‹ 1 å…ˆæ‰§è¡Œï¼Œå®ƒè°ƒç”¨äº†Â lock.wait()Â æ–¹æ³•ï¼Œç„¶åè¿›å…¥äº†ç­‰å¾…çŠ¶æ€ã€‚ çº¿ç¨‹ 2 åæ‰§è¡Œï¼Œå®ƒè°ƒç”¨äº†Â lock.notify()Â æ–¹æ³•ï¼Œç„¶åçº¿ç¨‹ 1 è¢«å”¤é†’äº†ã€‚ â‘ ã€public final void wait() throws InterruptedExceptionï¼šè°ƒç”¨è¯¥æ–¹æ³•ä¼šå¯¼è‡´å½“å‰çº¿ç¨‹ç­‰å¾…ï¼Œç›´åˆ°å¦ä¸€ä¸ªçº¿ç¨‹è°ƒç”¨æ­¤å¯¹è±¡çš„notify()æ–¹æ³•æˆ–notifyAll()æ–¹æ³•ã€‚ â‘¡ã€public final native void notify()ï¼šå”¤é†’åœ¨æ­¤å¯¹è±¡ç›‘è§†å™¨ä¸Šç­‰å¾…çš„å•ä¸ªçº¿ç¨‹ã€‚å¦‚æœæœ‰å¤šä¸ªçº¿ç¨‹ç­‰å¾…ï¼Œé€‰æ‹©ä¸€ä¸ªçº¿ç¨‹è¢«å”¤é†’ã€‚ â‘¢ã€public final native void notifyAll()ï¼šå”¤é†’åœ¨æ­¤å¯¹è±¡ç›‘è§†å™¨ä¸Šç­‰å¾…çš„æ‰€æœ‰çº¿ç¨‹ã€‚ â‘£ã€public final native void wait(long timeout) throws InterruptedExceptionï¼šç­‰å¾… timeout æ¯«ç§’ï¼Œå¦‚æœåœ¨ timeout æ¯«ç§’å†…æ²¡æœ‰è¢«å”¤é†’ï¼Œä¼šè‡ªåŠ¨å”¤é†’ã€‚ â‘¥ã€public final void wait(long timeout, int nanos) throws InterruptedExceptionï¼šæ›´åŠ ç²¾ç¡®äº†ï¼Œç­‰å¾… timeout æ¯«ç§’å’Œ nanos çº³ç§’ï¼Œå¦‚æœåœ¨ timeout æ¯«ç§’å’Œ nanos çº³ç§’å†…æ²¡æœ‰è¢«å”¤é†’ï¼Œä¼šè‡ªåŠ¨å”¤é†’ã€‚ åå°„ï¼šæ¨èé˜…è¯»ï¼šäºŒå“¥çš„ Java è¿›é˜¶ä¹‹è·¯ï¼šæŒæ¡ Java åå°„ public final native Class? getClass()ï¼šç”¨äºè·å–å¯¹è±¡çš„ç±»ä¿¡æ¯ï¼Œå¦‚ç±»åã€‚æ¯”å¦‚è¯´ï¼š public class GetClassDemo public static void main(String[] args) Person p = new Person(); Class? extends Person aClass = p.getClass(); System.out.println(aClass.getName()); è¾“å‡ºç»“æœï¼š com.itwanger.Person åƒåœ¾å›æ”¶ï¼šprotected void finalize() throws Throwableï¼šå½“åƒåœ¾å›æ”¶å™¨å†³å®šå›æ”¶å¯¹è±¡å ç”¨çš„å†…å­˜æ—¶è°ƒç”¨æ­¤æ–¹æ³•ã€‚ç”¨äºæ¸…ç†èµ„æºï¼Œä½† Java ä¸æ¨èä½¿ç”¨ï¼Œå› ä¸ºå®ƒä¸å¯é¢„æµ‹ä¸”å®¹æ˜“å¯¼è‡´é—®é¢˜ï¼ŒJava 9 å¼€å§‹å·²è¢«å¼ƒç”¨ã€‚ å¼‚å¸¸å¤„ç†41.ğŸŒŸJava ä¸­å¼‚å¸¸å¤„ç†ä½“ç³»?æ¨èé˜…è¯»ï¼šä¸€æ–‡å½»åº•ææ‡‚ Java å¼‚å¸¸å¤„ç† Java ä¸­çš„å¼‚å¸¸å¤„ç†æœºåˆ¶ç”¨äºå¤„ç†ç¨‹åºè¿è¡Œè¿‡ç¨‹ä¸­å¯èƒ½å‘ç”Ÿçš„å„ç§å¼‚å¸¸æƒ…å†µï¼Œé€šå¸¸é€šè¿‡ try-catch-finally è¯­å¥å’Œ throw å…³é”®å­—æ¥å®ç°ã€‚ ThrowableÂ æ˜¯ Java è¯­è¨€ä¸­æ‰€æœ‰é”™è¯¯å’Œå¼‚å¸¸çš„åŸºç±»ã€‚å®ƒæœ‰ä¸¤ä¸ªä¸»è¦çš„å­ç±»ï¼šError å’Œ Exceptionï¼Œè¿™ä¸¤ä¸ªç±»åˆ†åˆ«ä»£è¡¨äº† Java å¼‚å¸¸å¤„ç†ä½“ç³»ä¸­çš„ä¸¤ä¸ªåˆ†æ”¯ã€‚ Error ç±»ä»£è¡¨é‚£äº›ä¸¥é‡çš„é”™è¯¯ï¼Œè¿™ç±»é”™è¯¯é€šå¸¸æ˜¯ç¨‹åºæ— æ³•å¤„ç†çš„ã€‚æ¯”å¦‚ï¼ŒOutOfMemoryError è¡¨ç¤ºå†…å­˜ä¸è¶³ï¼ŒStackOverflowError è¡¨ç¤ºæ ˆæº¢å‡ºã€‚è¿™äº›é”™è¯¯é€šå¸¸ä¸ JVM çš„è¿è¡ŒçŠ¶æ€æœ‰å…³ï¼Œä¸€æ—¦å‘ç”Ÿï¼Œåº”ç”¨ç¨‹åºé€šå¸¸æ— æ³•æ¢å¤ã€‚ Exception ç±»ä»£è¡¨ç¨‹åºå¯ä»¥å¤„ç†çš„å¼‚å¸¸ã€‚å®ƒåˆ†ä¸ºä¸¤å¤§ç±»ï¼šç¼–è¯‘æ—¶å¼‚å¸¸ï¼ˆChecked Exceptionï¼‰å’Œè¿è¡Œæ—¶å¼‚å¸¸ï¼ˆRuntime Exceptionï¼‰ã€‚ â‘ ã€ç¼–è¯‘æ—¶å¼‚å¸¸ï¼ˆChecked Exceptionï¼‰ï¼šè¿™ç±»å¼‚å¸¸åœ¨ç¼–è¯‘æ—¶å¿…é¡»è¢«æ˜¾å¼å¤„ç†ï¼ˆæ•è·æˆ–å£°æ˜æŠ›å‡ºï¼‰ã€‚ å¦‚æœæ–¹æ³•å¯èƒ½æŠ›å‡ºæŸç§ç¼–è¯‘æ—¶å¼‚å¸¸ï¼Œä½†æ²¡æœ‰æ•è·å®ƒï¼ˆtry-catchï¼‰æˆ–æ²¡æœ‰åœ¨æ–¹æ³•å£°æ˜ä¸­ç”¨ throws å­å¥å£°æ˜å®ƒï¼Œé‚£ä¹ˆç¼–è¯‘å°†ä¸ä¼šé€šè¿‡ã€‚ä¾‹å¦‚ï¼šIOExceptionã€SQLException ç­‰ã€‚ â‘¡ã€è¿è¡Œæ—¶å¼‚å¸¸ï¼ˆRuntime Exceptionï¼‰ï¼šè¿™ç±»å¼‚å¸¸åœ¨è¿è¡Œæ—¶æŠ›å‡ºï¼Œå®ƒä»¬éƒ½æ˜¯ RuntimeException çš„å­ç±»ã€‚å¯¹äºè¿è¡Œæ—¶å¼‚å¸¸ï¼ŒJava ç¼–è¯‘å™¨ä¸è¦æ±‚å¿…é¡»å¤„ç†å®ƒä»¬ï¼ˆå³ä¸éœ€è¦æ•è·ä¹Ÿä¸éœ€è¦å£°æ˜æŠ›å‡ºï¼‰ã€‚ è¿è¡Œæ—¶å¼‚å¸¸é€šå¸¸æ˜¯ç”±ç¨‹åºé€»è¾‘é”™è¯¯å¯¼è‡´çš„ï¼Œå¦‚NullPointerExceptionã€IndexOutOfBoundsException ç­‰ã€‚ 42.å¼‚å¸¸çš„å¤„ç†æ–¹å¼ï¼Ÿ â‘ ã€é‡åˆ°å¼‚å¸¸æ—¶å¯ä»¥ä¸å¤„ç†ï¼Œç›´æ¥é€šè¿‡throw å’Œ throws æŠ›å‡ºå¼‚å¸¸ï¼Œäº¤ç»™ä¸Šå±‚è°ƒç”¨è€…å¤„ç†ã€‚ throws å…³é”®å­—ç”¨äºå£°æ˜å¯èƒ½ä¼šæŠ›å‡ºçš„å¼‚å¸¸ï¼Œè€Œ throw å…³é”®å­—ç”¨äºæŠ›å‡ºå¼‚å¸¸ã€‚ public void test() throws Exception throw new Exception(æŠ›å‡ºå¼‚å¸¸); â‘¡ã€ä½¿ç”¨ try-catch æ•è·å¼‚å¸¸ï¼Œå¤„ç†å¼‚å¸¸ã€‚ try //åŒ…å«å¯èƒ½ä¼šå‡ºç°å¼‚å¸¸çš„ä»£ç ä»¥åŠå£°æ˜å¼‚å¸¸çš„æ–¹æ³•catch(Exception e) //æ•è·å¼‚å¸¸å¹¶è¿›è¡Œå¤„ç†finally //å¯é€‰ï¼Œå¿…æ‰§è¡Œçš„ä»£ç  catchå’Œfinallyçš„å¼‚å¸¸å¯ä»¥åŒæ—¶æŠ›å‡ºå—ï¼Ÿå¦‚æœ catch å—æŠ›å‡ºä¸€ä¸ªå¼‚å¸¸ï¼Œè€Œ finally å—ä¸­ä¹ŸæŠ›å‡ºå¼‚å¸¸ï¼Œé‚£ä¹ˆæœ€ç»ˆæŠ›å‡ºçš„å°†æ˜¯ finally å—ä¸­çš„å¼‚å¸¸ã€‚catch å—ä¸­çš„å¼‚å¸¸ä¼šè¢«ä¸¢å¼ƒï¼Œè€Œ finally å—ä¸­çš„å¼‚å¸¸ä¼šè¦†ç›–å¹¶å‘ä¸Šä¼ é€’ã€‚ public class Example public static void main(String[] args) try throw new Exception(Exception in try); catch (Exception e) throw new RuntimeException(Exception in catch); finally throw new IllegalArgumentException(Exception in finally); try å—é¦–å…ˆæŠ›å‡ºä¸€ä¸ª Exceptionã€‚ æ§åˆ¶æµè¿›å…¥ catch å—ï¼Œcatch å—ä¸­åˆæŠ›å‡ºäº†ä¸€ä¸ª RuntimeExceptionã€‚ ä½†æ˜¯åœ¨ finally å—ä¸­ï¼ŒæŠ›å‡ºäº†ä¸€ä¸ª IllegalArgumentExceptionï¼Œæœ€ç»ˆç¨‹åºæŠ›å‡ºçš„å¼‚å¸¸æ˜¯ finally å—ä¸­çš„ IllegalArgumentExceptionã€‚ è™½ç„¶ catch å’Œ finally ä¸­çš„å¼‚å¸¸ä¸èƒ½åŒæ—¶æŠ›å‡ºï¼Œä½†å¯ä»¥æ‰‹åŠ¨æ•è· finally å—ä¸­çš„å¼‚å¸¸ï¼Œå¹¶å°† catch å—ä¸­çš„å¼‚å¸¸ä¿ç•™ä¸‹æ¥ï¼Œé¿å…è¢«è¦†ç›–ã€‚å¸¸è§çš„åšæ³•æ˜¯ä½¿ç”¨ä¸€ä¸ªå˜é‡ä¸´æ—¶å­˜å‚¨ catch ä¸­çš„å¼‚å¸¸ï¼Œç„¶ååœ¨ finally ä¸­å¤„ç†è¯¥å¼‚å¸¸ï¼š public class Example public static void main(String[] args) Exception catchException = null; try throw new Exception(Exception in try); catch (Exception e) catchException = e; throw new RuntimeException(Exception in catch); finally try throw new IllegalArgumentException(Exception in finally); catch (IllegalArgumentException e) if (catchException != null) System.out.println(Catch exception: + catchException.getMessage()); System.out.println(Finally exception: + e.getMessage()); 43.ä¸‰é“ç»å…¸å¼‚å¸¸å¤„ç†ä»£ç é¢˜é¢˜ç›® 1public class TryDemo public static void main(String[] args) System.out.println(test()); public static int test() try return 1; catch (Exception e) return 2; finally System.out.print(3); åœ¨test()æ–¹æ³•ä¸­ï¼Œé¦–å…ˆæœ‰ä¸€ä¸ªtryå—ï¼Œæ¥ç€æ˜¯ä¸€ä¸ªcatchå—ï¼ˆç”¨äºæ•è·å¼‚å¸¸ï¼‰ï¼Œæœ€åæ˜¯ä¸€ä¸ªfinallyå—ï¼ˆæ— è®ºæ˜¯å¦æ•è·åˆ°å¼‚å¸¸ï¼Œfinallyå—æ€»ä¼šæ‰§è¡Œï¼‰ã€‚ â‘ ã€tryå—ä¸­åŒ…å«ä¸€æ¡return 1;è¯­å¥ã€‚æ­£å¸¸æƒ…å†µä¸‹ï¼Œå¦‚æœtryå—ä¸­çš„ä»£ç èƒ½å¤Ÿé¡ºåˆ©æ‰§è¡Œï¼Œé‚£ä¹ˆæ–¹æ³•å°†è¿”å›æ•°å­—1ã€‚åœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼Œtryå—ä¸­æ²¡æœ‰ä»»ä½•å¯èƒ½æŠ›å‡ºå¼‚å¸¸çš„æ“ä½œï¼Œå› æ­¤å®ƒä¼šæ­£å¸¸æ‰§è¡Œå®Œæ¯•ï¼Œå¹¶å‡†å¤‡è¿”å›1ã€‚ â‘¡ã€ç”±äºtryå—ä¸­æ²¡æœ‰å¼‚å¸¸å‘ç”Ÿï¼Œæ‰€ä»¥catchå—ä¸­çš„ä»£ç ä¸ä¼šæ‰§è¡Œã€‚ â‘¢ã€æ— è®ºå‰é¢çš„ä»£ç æ˜¯å¦å‘ç”Ÿå¼‚å¸¸ï¼Œfinallyå—æ€»æ˜¯ä¼šæ‰§è¡Œã€‚åœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼Œfinallyå—åŒ…å«ä¸€æ¡System.out.print(3);è¯­å¥ï¼Œæ„å‘³ç€åœ¨æ–¹æ³•ç»“æŸå‰ï¼Œä¼šåœ¨æ§åˆ¶å°æ‰“å°å‡º3ã€‚ å½“æ‰§è¡Œmainæ–¹æ³•æ—¶ï¼Œæ§åˆ¶å°çš„è¾“å‡ºå°†ä¼šæ˜¯ï¼š è¿™æ˜¯å› ä¸ºfinallyå—ç¡®ä¿äº†å®ƒåŒ…å«çš„System.out.print(3);ä¼šæ‰§è¡Œå¹¶æ‰“å°3ï¼Œéšåtest()æ–¹æ³•è¿”å›tryå—ä¸­çš„å€¼1ï¼Œæœ€ç»ˆç»“æœå°±æ˜¯31ã€‚ é¢˜ç›® 2public class TryDemo public static void main(String[] args) System.out.println(test1()); public static int test1() try return 2; finally return 3; æ‰§è¡Œç»“æœï¼š3ã€‚ try è¿”å›å‰å…ˆæ‰§è¡Œ finallyï¼Œç»“æœ finally é‡Œä¸æŒ‰å¥—è·¯å‡ºç‰Œï¼Œç›´æ¥ return äº†ï¼Œè‡ªç„¶ä¹Ÿå°±èµ°ä¸åˆ° try é‡Œé¢çš„ return äº†ã€‚ æ³¨æ„ï¼šfinally é‡Œé¢ä½¿ç”¨ return ä»…å­˜åœ¨äºé¢è¯•é¢˜ä¸­ï¼Œå®é™…å¼€å‘è¿™ä¹ˆå†™è¦æŒ¨åŠçš„ï¼ˆğŸ˜‚ï¼‰ã€‚ é¢˜ç›® 3public class TryDemo public static void main(String[] args) System.out.println(test1()); public static int test1() int i = 0; try i = 2; return i; finally i = 3; æ‰§è¡Œç»“æœï¼š2ã€‚ å¤§å®¶å¯èƒ½ä¼šä»¥ä¸ºç»“æœåº”è¯¥æ˜¯ 3ï¼Œå› ä¸ºåœ¨ return å‰ä¼šæ‰§è¡Œ finallyï¼Œè€Œ i åœ¨ finally ä¸­è¢«ä¿®æ”¹ä¸º 3 äº†ï¼Œé‚£æœ€ç»ˆè¿”å› i ä¸æ˜¯åº”è¯¥ä¸º 3 å—ï¼Ÿ ä½†å…¶å®ï¼Œåœ¨æ‰§è¡Œ finally ä¹‹å‰ï¼ŒJVM ä¼šå…ˆå°† i çš„ç»“æœæš‚å­˜èµ·æ¥ï¼Œç„¶å finally æ‰§è¡Œå®Œæ¯•åï¼Œä¼šè¿”å›ä¹‹å‰æš‚å­˜çš„ç»“æœï¼Œè€Œä¸æ˜¯è¿”å› iï¼Œæ‰€ä»¥å³ä½¿ i å·²ç»è¢«ä¿®æ”¹ä¸º 3ï¼Œæœ€ç»ˆè¿”å›çš„è¿˜æ˜¯ä¹‹å‰æš‚å­˜èµ·æ¥çš„ç»“æœ 2ã€‚ IO44.Java ä¸­ IO æµåˆ†ä¸ºå‡ ç§?Java IO æµçš„åˆ’åˆ†å¯ä»¥æ ¹æ®å¤šä¸ªç»´åº¦è¿›è¡Œï¼ŒåŒ…æ‹¬æ•°æ®æµçš„æ–¹å‘ï¼ˆè¾“å…¥æˆ–è¾“å‡ºï¼‰ã€å¤„ç†çš„æ•°æ®å•ä½ï¼ˆå­—èŠ‚æˆ–å­—ç¬¦ï¼‰ã€æµçš„åŠŸèƒ½ä»¥åŠæµæ˜¯å¦æ”¯æŒéšæœºè®¿é—®ç­‰ã€‚ æŒ‰ç…§æ•°æ®æµæ–¹å‘å¦‚ä½•åˆ’åˆ†ï¼Ÿ è¾“å…¥æµï¼ˆInput Streamï¼‰ï¼šä»æºï¼ˆå¦‚æ–‡ä»¶ã€ç½‘ç»œç­‰ï¼‰è¯»å–æ•°æ®åˆ°ç¨‹åºã€‚ è¾“å‡ºæµï¼ˆOutput Streamï¼‰ï¼šå°†æ•°æ®ä»ç¨‹åºå†™å‡ºåˆ°ç›®çš„åœ°ï¼ˆå¦‚æ–‡ä»¶ã€ç½‘ç»œã€æ§åˆ¶å°ç­‰ï¼‰ã€‚ æŒ‰å¤„ç†æ•°æ®å•ä½å¦‚ä½•åˆ’åˆ†ï¼Ÿ å­—èŠ‚æµï¼ˆByte Streamsï¼‰ï¼šä»¥å­—èŠ‚ä¸ºå•ä½è¯»å†™æ•°æ®ï¼Œä¸»è¦ç”¨äºå¤„ç†äºŒè¿›åˆ¶æ•°æ®ï¼Œå¦‚éŸ³é¢‘ã€å›¾åƒæ–‡ä»¶ç­‰ã€‚ å­—ç¬¦æµï¼ˆCharacter Streamsï¼‰ï¼šä»¥å­—ç¬¦ä¸ºå•ä½è¯»å†™æ•°æ®ï¼Œä¸»è¦ç”¨äºå¤„ç†æ–‡æœ¬æ•°æ®ã€‚ æŒ‰åŠŸèƒ½å¦‚ä½•åˆ’åˆ†ï¼Ÿ èŠ‚ç‚¹æµï¼ˆNode Streamsï¼‰ï¼šç›´æ¥ä¸æ•°æ®æºæˆ–ç›®çš„åœ°ç›¸è¿ï¼Œå¦‚ FileInputStreamã€FileOutputStreamã€‚ å¤„ç†æµï¼ˆProcessing Streamsï¼‰ï¼šå¯¹ä¸€ä¸ªå·²å­˜åœ¨çš„æµè¿›è¡ŒåŒ…è£…ï¼Œå¦‚ç¼“å†²æµ BufferedInputStreamã€BufferedOutputStreamã€‚ ç®¡é“æµï¼ˆPiped Streamsï¼‰ï¼šç”¨äºçº¿ç¨‹ä¹‹é—´çš„æ•°æ®ä¼ è¾“ï¼Œå¦‚ PipedInputStreamã€PipedOutputStreamã€‚ IO æµç”¨åˆ°äº†ä»€ä¹ˆè®¾è®¡æ¨¡å¼ï¼Ÿå…¶å®ï¼ŒJava çš„ IO æµä½“ç³»è¿˜ç”¨åˆ°äº†ä¸€ä¸ªè®¾è®¡æ¨¡å¼â€”â€”è£…é¥°å™¨æ¨¡å¼ã€‚ Java ç¼“å†²åŒºæº¢å‡ºï¼Œå¦‚ä½•é¢„é˜²Java ç¼“å†²åŒºæº¢å‡ºä¸»è¦æ˜¯ç”±äºå‘ç¼“å†²åŒºå†™å…¥çš„æ•°æ®è¶…è¿‡å…¶èƒ½å¤Ÿå­˜å‚¨çš„æ•°æ®é‡ã€‚å¯ä»¥é‡‡ç”¨è¿™äº›æªæ–½æ¥é¿å…ï¼š â‘ ã€åˆç†è®¾ç½®ç¼“å†²åŒºå¤§å°ï¼šåœ¨åˆ›å»ºç¼“å†²åŒºæ—¶ï¼Œåº”æ ¹æ®å®é™…éœ€æ±‚åˆç†è®¾ç½®ç¼“å†²åŒºçš„å¤§å°ï¼Œé¿å…åˆ›å»ºè¿‡å¤§æˆ–è¿‡å°çš„ç¼“å†²åŒºã€‚ â‘¡ã€æ§åˆ¶å†™å…¥æ•°æ®é‡ï¼šåœ¨å‘ç¼“å†²åŒºå†™å…¥æ•°æ®æ—¶ï¼Œåº”è¯¥æ§åˆ¶å†™å…¥çš„æ•°æ®é‡ï¼Œç¡®ä¿ä¸ä¼šè¶…è¿‡ç¼“å†²åŒºçš„å®¹é‡ã€‚Java çš„ ByteBuffer ç±»æä¾›äº†remaining()æ–¹æ³•ï¼Œå¯ä»¥è·å–ç¼“å†²åŒºä¸­å‰©ä½™çš„å¯å†™å…¥æ•°æ®é‡ã€‚ import java.nio.ByteBuffer;public class ByteBufferExample public static void main(String[] args) // æ¨¡æ‹Ÿæ¥æ”¶åˆ°çš„æ•°æ® byte[] receivedData = 1, 2, 3, 4, 5; int bufferSize = 1024; // è®¾ç½®ä¸€ä¸ªåˆç†çš„ç¼“å†²åŒºå¤§å° // åˆ›å»ºByteBuffer ByteBuffer buffer = ByteBuffer.allocate(bufferSize); // å†™å…¥æ•°æ®ä¹‹å‰æ£€æŸ¥å®¹é‡æ˜¯å¦è¶³å¤Ÿ if (buffer.remaining() = receivedData.length) buffer.put(receivedData); else System.out.println(Not enough space in buffer to write data.); // å‡†å¤‡è¯»å–æ•°æ®ï¼šå°†limitè®¾ç½®ä¸ºå½“å‰ä½ç½®ï¼Œpositionè®¾å›0 buffer.flip(); // è¯»å–æ•°æ® while (buffer.hasRemaining()) byte data = buffer.get(); System.out.println(Read data: + data); // æ¸…ç©ºç¼“å†²åŒºä»¥ä¾¿å†æ¬¡ä½¿ç”¨ buffer.clear(); 45.æ—¢ç„¶æœ‰äº†å­—èŠ‚æµ,ä¸ºä»€ä¹ˆè¿˜è¦æœ‰å­—ç¬¦æµ?å…¶å®å­—ç¬¦æµæ˜¯ç”± Java è™šæ‹Ÿæœºå°†å­—èŠ‚è½¬æ¢å¾—åˆ°çš„ï¼Œé—®é¢˜å°±å‡ºåœ¨è¿™ä¸ªè¿‡ç¨‹è¿˜æ¯”è¾ƒè€—æ—¶ï¼Œå¹¶ä¸”ï¼Œå¦‚æœæˆ‘ä»¬ä¸çŸ¥é“ç¼–ç ç±»å‹å°±å¾ˆå®¹æ˜“å‡ºç°ä¹±ç é—®é¢˜ã€‚ æ‰€ä»¥ï¼Œ IO æµå°±å¹²è„†æä¾›äº†ä¸€ä¸ªç›´æ¥æ“ä½œå­—ç¬¦çš„æ¥å£ï¼Œæ–¹ä¾¿æˆ‘ä»¬å¹³æ—¶å¯¹å­—ç¬¦è¿›è¡Œæµæ“ä½œã€‚å¦‚æœéŸ³é¢‘æ–‡ä»¶ã€å›¾ç‰‡ç­‰åª’ä½“æ–‡ä»¶ç”¨å­—èŠ‚æµæ¯”è¾ƒå¥½ï¼Œå¦‚æœæ¶‰åŠåˆ°å­—ç¬¦çš„è¯ä½¿ç”¨å­—ç¬¦æµæ¯”è¾ƒå¥½ã€‚ æ–‡æœ¬å­˜å‚¨æ˜¯å­—èŠ‚æµè¿˜æ˜¯å­—ç¬¦æµï¼Œè§†é¢‘æ–‡ä»¶å‘¢ï¼Ÿåœ¨è®¡ç®—æœºä¸­ï¼Œæ–‡æœ¬å’Œè§†é¢‘éƒ½æ˜¯æŒ‰ç…§å­—èŠ‚å­˜å‚¨çš„ï¼Œåªæ˜¯å¦‚æœæ˜¯æ–‡æœ¬æ–‡ä»¶çš„è¯ï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡å­—ç¬¦æµçš„å½¢å¼å»è¯»å–ï¼Œè¿™æ ·æ›´æ–¹é¢çš„æˆ‘ä»¬è¿›è¡Œç›´æ¥å¤„ç†ã€‚ æ¯”å¦‚è¯´æˆ‘ä»¬éœ€è¦åœ¨ä¸€ä¸ªå¤§æ–‡æœ¬æ–‡ä»¶ä¸­æŸ¥æ‰¾æŸä¸ªå­—ç¬¦ä¸²ï¼Œå¯ä»¥ç›´æ¥é€šè¿‡å­—ç¬¦æµæ¥è¯»å–åˆ¤æ–­ã€‚ å¤„ç†è§†é¢‘æ–‡ä»¶æ—¶ï¼Œé€šå¸¸ä½¿ç”¨å­—èŠ‚æµï¼ˆå¦‚ Java ä¸­çš„FileInputStreamã€FileOutputStreamï¼‰æ¥è¯»å–æˆ–å†™å…¥æ•°æ®ï¼Œå¹¶ä¸”ä¼šå°½é‡ä½¿ç”¨ç¼“å†²æµï¼ˆå¦‚BufferedInputStreamã€BufferedOutputStreamï¼‰æ¥æé«˜è¯»å†™æ•ˆç‡ã€‚ åœ¨æŠ€æœ¯æ´¾å®æˆ˜é¡¹ç›®é¡¹ç›®ä¸­ï¼Œå¯¹äºæ–‡æœ¬ï¼Œæ¯”å¦‚è¯´æ–‡ç« å’Œæ•™ç¨‹å†…å®¹ï¼Œæ˜¯ç›´æ¥å­˜å‚¨åœ¨æ•°æ®åº“ä¸­çš„ï¼Œè€Œå¯¹äºè§†é¢‘å’Œå›¾ç‰‡ç­‰å¤§æ–‡ä»¶ï¼Œæ˜¯å­˜å‚¨åœ¨ OSS ä¸­çš„ã€‚ å› æ­¤ï¼Œæ— è®ºæ˜¯æ–‡æœ¬æ–‡ä»¶è¿˜æ˜¯è§†é¢‘æ–‡ä»¶ï¼Œå®ƒä»¬åœ¨ç‰©ç†å­˜å‚¨å±‚é¢éƒ½æ˜¯ä»¥å­—èŠ‚æµçš„å½¢å¼å­˜åœ¨ã€‚åŒºåˆ«åœ¨äºï¼Œæˆ‘ä»¬å¦‚ä½•é€šè¿‡ Java ä»£ç æ¥è§£é‡Šå’Œå¤„ç†è¿™äº›å­—èŠ‚æµï¼šä½œä¸ºç¼–ç åçš„å­—ç¬¦è¿˜æ˜¯ä½œä¸ºäºŒè¿›åˆ¶æ•°æ®ã€‚ 46.ğŸŒŸBIOã€NIOã€AIO ä¹‹é—´çš„åŒºåˆ«ï¼Ÿæ¨èé˜…è¯»ï¼šJava NIO æ¯”ä¼ ç»Ÿ IO å¼ºåœ¨å“ªé‡Œï¼Ÿ Java å¸¸è§çš„ IO æ¨¡å‹æœ‰ä¸‰ç§ï¼šBIOã€NIO å’Œ AIOã€‚ BIOï¼šé‡‡ç”¨é˜»å¡å¼ IO æ¨¡å‹ï¼Œçº¿ç¨‹åœ¨æ‰§è¡Œ IO æ“ä½œæ—¶è¢«é˜»å¡ï¼Œæ— æ³•å¤„ç†å…¶ä»–ä»»åŠ¡ï¼Œé€‚ç”¨äºè¿æ¥æ•°è¾ƒå°‘çš„åœºæ™¯ã€‚ NIOï¼šé‡‡ç”¨éé˜»å¡ I/O æ¨¡å‹ï¼Œçº¿ç¨‹åœ¨ç­‰å¾… IO æ—¶å¯æ‰§è¡Œå…¶ä»–ä»»åŠ¡ï¼Œé€šè¿‡ Selector ç›‘æ§å¤šä¸ª Channel ä¸Šçš„äº‹ä»¶ï¼Œé€‚ç”¨äºè¿æ¥æ•°å¤šä½†è¿æ¥æ—¶é—´çŸ­çš„åœºæ™¯ã€‚ AIOï¼šä½¿ç”¨å¼‚æ­¥ I/O æ¨¡å‹ï¼Œçº¿ç¨‹å‘èµ· IO è¯·æ±‚åç«‹å³è¿”å›ï¼Œå½“ IO æ“ä½œå®Œæˆæ—¶é€šè¿‡å›è°ƒå‡½æ•°é€šçŸ¥çº¿ç¨‹ï¼Œé€‚ç”¨äºè¿æ¥æ•°å¤šä¸”è¿æ¥æ—¶é—´é•¿çš„åœºæ™¯ã€‚ ç®€å•è¯´ä¸€ä¸‹ BIOï¼ŸBIOï¼Œä¹Ÿå°±æ˜¯ä¼ ç»Ÿçš„ IOï¼ŒåŸºäºå­—èŠ‚æµæˆ–å­—ç¬¦æµï¼ˆå¦‚ FileInputStreamã€BufferedReader ç­‰ï¼‰è¿›è¡Œæ–‡ä»¶è¯»å†™ï¼ŒåŸºäº Socket å’Œ ServerSocket è¿›è¡Œç½‘ç»œé€šä¿¡ã€‚ å¯¹äºæ¯ä¸ªè¿æ¥ï¼Œéƒ½éœ€è¦åˆ›å»ºä¸€ä¸ªç‹¬ç«‹çš„çº¿ç¨‹æ¥å¤„ç†è¯»å†™æ“ä½œã€‚ ç®€å•è¯´ä¸‹ NIOï¼ŸNIOï¼ŒJDK 1.4 æ—¶å¼•å…¥ï¼Œæ”¾åœ¨ java.nio åŒ…ä¸‹ï¼Œæä¾›äº† Channelã€Bufferã€Selector ç­‰æ–°çš„æŠ½è±¡ï¼ŒåŸºäº RandomAccessFileã€FileChannelã€ByteBuffer è¿›è¡Œæ–‡ä»¶è¯»å†™ï¼ŒåŸºäº SocketChannel å’Œ ServerSocketChannel è¿›è¡Œç½‘ç»œé€šä¿¡ã€‚ å®é™…ä¸Šï¼Œâ€œæ—§â€çš„ IO åŒ…å·²ç»ä½¿ç”¨ NIO é‡æ–°å®ç°è¿‡ï¼Œæ‰€ä»¥åœ¨è¿›è¡Œæ–‡ä»¶è¯»å†™æ—¶ï¼ŒNIO å¹¶æ— æ³•ä½“ç°å‡ºæ¯” BIO æ›´å¯é çš„æ€§èƒ½ã€‚ NIO çš„é­…åŠ›ä¸»è¦ä½“ç°åœ¨ç½‘ç»œç¼–ç¨‹ä¸­ï¼ŒæœåŠ¡å™¨å¯ä»¥ç”¨ä¸€ä¸ªçº¿ç¨‹å¤„ç†å¤šä¸ªå®¢æˆ·ç«¯è¿æ¥ï¼Œé€šè¿‡ Selector ç›‘å¬å¤šä¸ª Channel æ¥å®ç°å¤šè·¯å¤ç”¨ï¼Œæå¤§åœ°æé«˜äº†ç½‘ç»œç¼–ç¨‹çš„æ€§èƒ½ã€‚ ç¼“å†²åŒº Buffer ä¹Ÿèƒ½æå¤§æå‡ä¸€æ¬¡ IO æ“ä½œçš„æ•ˆç‡ã€‚ ç®€å•è¯´ä¸‹ AIOï¼ŸAIO æ˜¯ Java 7 å¼•å…¥çš„ï¼Œæ”¾åœ¨ java.nio.channels åŒ…ä¸‹ï¼Œæä¾›äº† AsynchronousFileChannelã€AsynchronousSocketChannel ç­‰å¼‚æ­¥ Channelã€‚ å®ƒå¼•å…¥äº†å¼‚æ­¥é€šé“çš„æ¦‚å¿µï¼Œä½¿å¾— IO æ“ä½œå¯ä»¥å¼‚æ­¥è¿›è¡Œã€‚è¿™æ„å‘³ç€çº¿ç¨‹å‘èµ·ä¸€ä¸ªè¯»å†™æ“ä½œåä¸å¿…ç­‰å¾…å…¶å®Œæˆï¼Œå¯ä»¥ç«‹å³è¿›è¡Œå…¶ä»–ä»»åŠ¡ï¼Œå¹¶ä¸”å½“è¯»å†™æ“ä½œçœŸæ­£å®Œæˆæ—¶ï¼Œçº¿ç¨‹ä¼šè¢«å¼‚æ­¥åœ°é€šçŸ¥ã€‚ AsynchronousFileChannel fileChannel = AsynchronousFileChannel.open(Paths.get(test.txt), StandardOpenOption.READ);ByteBuffer buffer = ByteBuffer.allocate(1024);FutureInteger result = fileChannel.read(buffer, 0);while (!result.isDone()) // do something åºåˆ—åŒ–47.ä»€ä¹ˆæ˜¯åºåˆ—åŒ–ï¼Ÿä»€ä¹ˆæ˜¯ååºåˆ—åŒ–ï¼Ÿåºåˆ—åŒ–ï¼ˆSerializationï¼‰æ˜¯æŒ‡å°†å¯¹è±¡è½¬æ¢ä¸ºå­—èŠ‚æµçš„è¿‡ç¨‹ï¼Œä»¥ä¾¿èƒ½å¤Ÿå°†è¯¥å¯¹è±¡ä¿å­˜åˆ°æ–‡ä»¶ã€æ•°æ®åº“ï¼Œæˆ–è€…è¿›è¡Œç½‘ç»œä¼ è¾“ã€‚ ååºåˆ—åŒ–ï¼ˆDeserializationï¼‰å°±æ˜¯å°†å­—èŠ‚æµè½¬æ¢å›å¯¹è±¡çš„è¿‡ç¨‹ï¼Œä»¥ä¾¿æ„å»ºåŸå§‹å¯¹è±¡ã€‚ Serializable æ¥å£æœ‰ä»€ä¹ˆç”¨ï¼ŸSerializableæ¥å£ç”¨äºæ ‡è®°ä¸€ä¸ªç±»å¯ä»¥è¢«åºåˆ—åŒ–ã€‚ public class Person implements Serializable private String name; private int age; // çœç•¥ getter å’Œ setter æ–¹æ³• serialVersionUID æœ‰ä»€ä¹ˆç”¨ï¼ŸserialVersionUID æ˜¯ Java åºåˆ—åŒ–æœºåˆ¶ä¸­ç”¨äºæ ‡è¯†ç±»ç‰ˆæœ¬çš„å”¯ä¸€æ ‡è¯†ç¬¦ã€‚å®ƒçš„ä½œç”¨æ˜¯ç¡®ä¿åœ¨åºåˆ—åŒ–å’Œååºåˆ—åŒ–è¿‡ç¨‹ä¸­ï¼Œç±»çš„ç‰ˆæœ¬æ˜¯å…¼å®¹çš„ã€‚ import java.io.Serializable;public class MyClass implements Serializable private static final long serialVersionUID = 1L; private String name; private int age; // getters and setters serialVersionUID è¢«è®¾ç½®ä¸º 1L æ˜¯ä¸€ç§æ¯”è¾ƒçœäº‹çš„åšæ³•ï¼Œä¹Ÿå¯ä»¥ä½¿ç”¨ Intellij IDEA è¿›è¡Œè‡ªåŠ¨ç”Ÿæˆã€‚ ä½†åªè¦ serialVersionUID åœ¨åºåˆ—åŒ–å’Œååºåˆ—åŒ–è¿‡ç¨‹ä¸­ä¿æŒä¸€è‡´ï¼Œå°±ä¸ä¼šå‡ºç°é—®é¢˜ã€‚ å¦‚æœä¸æ˜¾å¼å£°æ˜ serialVersionUIDï¼ŒJava è¿è¡Œæ—¶ä¼šæ ¹æ®ç±»çš„è¯¦ç»†ä¿¡æ¯è‡ªåŠ¨ç”Ÿæˆä¸€ä¸ª serialVersionUIDã€‚é‚£ä¹ˆå½“ç±»çš„ç»“æ„å‘ç”Ÿå˜åŒ–æ—¶ï¼Œè‡ªåŠ¨ç”Ÿæˆçš„ serialVersionUID å°±ä¼šå‘ç”Ÿå˜åŒ–ï¼Œå¯¼è‡´ååºåˆ—åŒ–å¤±è´¥ã€‚ Java åºåˆ—åŒ–ä¸åŒ…å«é™æ€å˜é‡å—ï¼Ÿæ˜¯çš„ï¼Œåºåˆ—åŒ–æœºåˆ¶åªä¼šä¿å­˜å¯¹è±¡çš„çŠ¶æ€ï¼Œè€Œé™æ€å˜é‡å±äºç±»çš„çŠ¶æ€ï¼Œä¸å±äºå¯¹è±¡çš„çŠ¶æ€ã€‚ å¦‚æœæœ‰äº›å˜é‡ä¸æƒ³åºåˆ—åŒ–ï¼Œæ€ä¹ˆåŠï¼Ÿå¯ä»¥ä½¿ç”¨transientå…³é”®å­—ä¿®é¥°ä¸æƒ³åºåˆ—åŒ–çš„å˜é‡ã€‚ public class Person implements Serializable private String name; private transient int age; // çœç•¥ getter å’Œ setter æ–¹æ³• èƒ½è§£é‡Šä¸€ä¸‹åºåˆ—åŒ–çš„è¿‡ç¨‹å’Œä½œç”¨å—ï¼Ÿåºåˆ—åŒ–è¿‡ç¨‹é€šå¸¸æ¶‰åŠåˆ°ä»¥ä¸‹å‡ ä¸ªæ­¥éª¤ï¼š ç¬¬ä¸€æ­¥ï¼Œå®ç° Serializable æ¥å£ã€‚ public class Person implements Serializable private String name; private int age; // çœç•¥æ„é€ æ–¹æ³•ã€getterså’Œsetters ç¬¬äºŒæ­¥ï¼Œä½¿ç”¨ ObjectOutputStream æ¥å°†å¯¹è±¡å†™å…¥åˆ°è¾“å‡ºæµä¸­ã€‚ ObjectOutputStream out = new ObjectOutputStream(new FileOutputStream(person.ser)); ç¬¬ä¸‰æ­¥ï¼Œè°ƒç”¨ ObjectOutputStream çš„ writeObject æ–¹æ³•ï¼Œå°†å¯¹è±¡åºåˆ—åŒ–å¹¶å†™å…¥åˆ°è¾“å‡ºæµä¸­ã€‚ Person person = new Person(æ²‰é»˜ç‹äºŒ, 18);out.writeObject(person); 48.è¯´è¯´æœ‰å‡ ç§åºåˆ—åŒ–æ–¹å¼ï¼ŸJava åºåˆ—åŒ–æ–¹å¼æœ‰å¾ˆå¤šï¼Œå¸¸è§çš„æœ‰ä¸‰ç§ï¼š Java å¯¹è±¡åºåˆ—åŒ– ï¼šJava åŸç”Ÿåºåˆ—åŒ–æ–¹æ³•å³é€šè¿‡ Java åŸç”Ÿæµ(InputStream å’Œ OutputStream ä¹‹é—´çš„è½¬åŒ–)çš„æ–¹å¼è¿›è¡Œè½¬åŒ–ï¼Œä¸€èˆ¬æ˜¯å¯¹è±¡è¾“å‡ºæµÂ ObjectOutputStreamå’Œå¯¹è±¡è¾“å…¥æµObjectInputStreamã€‚ Json åºåˆ—åŒ–ï¼šè¿™ä¸ªå¯èƒ½æ˜¯æˆ‘ä»¬æœ€å¸¸ç”¨çš„åºåˆ—åŒ–æ–¹å¼ï¼ŒJson åºåˆ—åŒ–çš„é€‰æ‹©å¾ˆå¤šï¼Œä¸€èˆ¬ä¼šä½¿ç”¨ jackson åŒ…ï¼Œé€šè¿‡ ObjectMapper ç±»æ¥è¿›è¡Œä¸€äº›æ“ä½œï¼Œæ¯”å¦‚å°†å¯¹è±¡è½¬åŒ–ä¸º byte æ•°ç»„æˆ–è€…å°† json ä¸²è½¬åŒ–ä¸ºå¯¹è±¡ã€‚ ProtoBuff åºåˆ—åŒ–ï¼šProtocolBuffer æ˜¯ä¸€ç§è½»ä¾¿é«˜æ•ˆçš„ç»“æ„åŒ–æ•°æ®å­˜å‚¨æ ¼å¼ï¼ŒProtoBuff åºåˆ—åŒ–å¯¹è±¡å¯ä»¥å¾ˆå¤§ç¨‹åº¦ä¸Šå°†å…¶å‹ç¼©ï¼Œå¯ä»¥å¤§å¤§å‡å°‘æ•°æ®ä¼ è¾“å¤§å°ï¼Œæé«˜ç³»ç»Ÿæ€§èƒ½ã€‚ ç½‘ç»œç¼–ç¨‹49.äº†è§£è¿‡Socketç½‘ç»œå¥—æ¥å­—å—ï¼Ÿï¼ˆè¡¥å……ï¼‰æ¨èé˜…è¯»ï¼šJava Socketï¼šé£é¸½ä¼ ä¹¦çš„ç½‘ç»œå¥—æ¥å­— Socket æ˜¯ç½‘ç»œé€šä¿¡çš„åŸºç¡€ï¼Œè¡¨ç¤ºä¸¤å°è®¾å¤‡ä¹‹é—´é€šä¿¡çš„ä¸€ä¸ªç«¯ç‚¹ã€‚Socket é€šå¸¸ç”¨äºå»ºç«‹ TCP æˆ– UDP è¿æ¥ï¼Œå®ç°è¿›ç¨‹é—´çš„ç½‘ç»œé€šä¿¡ã€‚ ä¸€ä¸ªç®€å•çš„ TCP å®¢æˆ·ç«¯ï¼š class TcpClient public static void main(String[] args) throws IOException Socket socket = new Socket(127.0.0.1, 8080); // è¿æ¥æœåŠ¡å™¨ BufferedReader in = new BufferedReader(new InputStreamReader(socket.getInputStream())); PrintWriter out = new PrintWriter(socket.getOutputStream(), true); out.println(Hello, Server!); // å‘é€æ¶ˆæ¯ System.out.println(Server response: + in.readLine()); // æ¥æ”¶æœåŠ¡å™¨å“åº” socket.close(); TCP æœåŠ¡ç«¯ï¼š class TcpServer public static void main(String[] args) throws IOException ServerSocket serverSocket = new ServerSocket(8080); // åˆ›å»ºæœåŠ¡å™¨ç«¯Socket System.out.println(Server started, waiting for connection...); Socket socket = serverSocket.accept(); // ç­‰å¾…å®¢æˆ·ç«¯è¿æ¥ System.out.println(Client connected: + socket.getInetAddress()); BufferedReader in = new BufferedReader(new InputStreamReader(socket.getInputStream())); PrintWriter out = new PrintWriter(socket.getOutputStream(), true); String message; while ((message = in.readLine()) != null) System.out.println(Received: + message); out.println(Echo: + message); // å›é€æ¶ˆæ¯ socket.close(); serverSocket.close(); RPCæ¡†æ¶äº†è§£å—ï¼ŸRPCæ˜¯ä¸€ç§åè®®ï¼Œå…è®¸ç¨‹åºè°ƒç”¨ä½äºè¿œç¨‹æœåŠ¡å™¨ä¸Šçš„æ–¹æ³•ï¼Œå°±åƒè°ƒç”¨æœ¬åœ°æ–¹æ³•ä¸€æ ·ã€‚RPC é€šå¸¸åŸºäº Socket é€šä¿¡å®ç°ã€‚ RPCï¼ŒRemote Procedure Callï¼Œè¿œç¨‹è¿‡ç¨‹è°ƒç”¨ RPC æ¡†æ¶æ”¯æŒé«˜æ•ˆçš„åºåˆ—åŒ–ï¼ˆå¦‚ Protocol Buffersï¼‰å’Œé€šä¿¡åè®®ï¼ˆå¦‚ HTTP2ï¼‰ï¼Œå±è”½äº†åº•å±‚ç½‘ç»œé€šä¿¡çš„ç»†èŠ‚ï¼Œå¼€å‘è€…åªéœ€å…³æ³¨ä¸šåŠ¡é€»è¾‘å³å¯ã€‚ å¸¸è§çš„ RPC æ¡†æ¶åŒ…æ‹¬ï¼š gRPCï¼šåŸºäº HTTP2 å’Œ Protocol Buffersã€‚ Dubboï¼šé˜¿é‡Œå¼€æºçš„åˆ†å¸ƒå¼ RPC æ¡†æ¶ï¼Œé€‚åˆå¾®æœåŠ¡åœºæ™¯ã€‚ Spring Cloud OpenFeignï¼šåŸºäº REST çš„è½»é‡çº§ RPC æ¡†æ¶ã€‚ Thriftï¼šApache çš„è·¨è¯­è¨€ RPC æ¡†æ¶ï¼Œæ”¯æŒå¤šè¯­è¨€ä»£ç ç”Ÿæˆã€‚ æ³›å‹50.Java æ³›å‹äº†è§£ä¹ˆï¼Ÿæ¨èé˜…è¯»ï¼šæ‰‹å†™Javaæ³›å‹ï¼Œå½»åº•æŒæ¡å®ƒ æ³›å‹ä¸»è¦ç”¨äºæé«˜ä»£ç çš„ç±»å‹å®‰å…¨ï¼Œå®ƒå…è®¸åœ¨å®šä¹‰ç±»ã€æ¥å£å’Œæ–¹æ³•æ—¶ä½¿ç”¨ç±»å‹å‚æ•°ï¼Œè¿™æ ·å¯ä»¥åœ¨ç¼–è¯‘æ—¶æ£€æŸ¥ç±»å‹ä¸€è‡´æ€§ï¼Œé¿å…ä¸å¿…è¦çš„ç±»å‹è½¬æ¢å’Œç±»å‹é”™è¯¯ã€‚ æ²¡æœ‰æ³›å‹çš„æ—¶å€™ï¼Œåƒ List è¿™æ ·çš„é›†åˆç±»å­˜å‚¨çš„æ˜¯ Object ç±»å‹ï¼Œå¯¼è‡´ä»é›†åˆä¸­è¯»å–æ•°æ®æ—¶ï¼Œå¿…é¡»è¿›è¡Œå¼ºåˆ¶ç±»å‹è½¬æ¢ï¼Œå¦åˆ™ä¼šå¼•å‘ ClassCastExceptionã€‚ List list = new ArrayList();list.add(hello);String str = (String) list.get(0); // å¿…é¡»å¼ºåˆ¶ç±»å‹è½¬æ¢ æ³›å‹ä¸€èˆ¬æœ‰ä¸‰ç§ä½¿ç”¨æ–¹å¼:æ³›å‹ç±»ã€æ³›å‹æ¥å£ã€æ³›å‹æ–¹æ³•ã€‚ 1.æ³›å‹ç±»ï¼š //æ­¤å¤„Tå¯ä»¥éšä¾¿å†™ä¸ºä»»æ„æ ‡è¯†ï¼Œå¸¸è§çš„å¦‚Tã€Eã€Kã€Vç­‰å½¢å¼çš„å‚æ•°å¸¸ç”¨äºè¡¨ç¤ºæ³›å‹//åœ¨å®ä¾‹åŒ–æ³›å‹ç±»æ—¶ï¼Œå¿…é¡»æŒ‡å®šTçš„å…·ä½“ç±»å‹public class GenericT private T key; public Generic(T key) this.key = key; public T getKey() return key; å¦‚ä½•å®ä¾‹åŒ–æ³›å‹ç±»ï¼š GenericInteger genericInteger = new GenericInteger(123456); 2.æ³›å‹æ¥å£ ï¼š public interface GeneratorT public T method(); å®ç°æ³›å‹æ¥å£ï¼ŒæŒ‡å®šç±»å‹ï¼š class GeneratorImplT implements GeneratorString @Override public String method() return hello; 3.æ³›å‹æ–¹æ³• ï¼š public static E void printArray( E[] inputArray ) for ( E element : inputArray ) System.out.printf( %s , element ); System.out.println(); ä½¿ç”¨ï¼š // åˆ›å»ºä¸åŒç±»å‹æ•°ç»„ï¼š Integer, Double å’Œ CharacterInteger[] intArray = 1, 2, 3 ;String[] stringArray = Hello, World ;printArray( intArray );printArray( stringArray ); æ³›å‹å¸¸ç”¨çš„é€šé…ç¬¦æœ‰å“ªäº›ï¼Ÿå¸¸ç”¨çš„é€šé…ç¬¦ä¸ºï¼š Tï¼ŒEï¼ŒKï¼ŒVï¼Œï¼Ÿ ï¼Ÿ è¡¨ç¤ºä¸ç¡®å®šçš„ java ç±»å‹ T (type) è¡¨ç¤ºå…·ä½“çš„ä¸€ä¸ª java ç±»å‹ K V (key value) åˆ†åˆ«ä»£è¡¨ java é”®å€¼ä¸­çš„ Key Value E (element) ä»£è¡¨ Element ä»€ä¹ˆæ˜¯æ³›å‹æ“¦é™¤ï¼Ÿæ‰€è°“çš„æ³›å‹æ“¦é™¤ï¼Œå®˜æ–¹åå«â€œç±»å‹æ“¦é™¤â€ã€‚ Java çš„æ³›å‹æ˜¯ä¼ªæ³›å‹ï¼Œè¿™æ˜¯å› ä¸º Java åœ¨ç¼–è¯‘æœŸé—´ï¼Œæ‰€æœ‰çš„ç±»å‹ä¿¡æ¯éƒ½ä¼šè¢«æ“¦æ‰ã€‚ ä¹Ÿå°±æ˜¯è¯´ï¼Œåœ¨è¿è¡Œçš„æ—¶å€™æ˜¯æ²¡æœ‰æ³›å‹çš„ã€‚ ä¾‹å¦‚è¿™æ®µä»£ç ï¼Œå¾€ä¸€ç¾¤çŒ«é‡Œæ”¾æ¡ç‹—ï¼š LinkedListCat cats = new LinkedListCat();LinkedList list = cats; // æ³¨æ„æˆ‘åœ¨è¿™é‡ŒæŠŠèŒƒå‹å»æ‰äº†ï¼Œä½†æ˜¯listå’Œcatsæ˜¯åŒä¸€ä¸ªé“¾è¡¨ï¼list.add(new Dog()); // å®Œå…¨æ²¡é—®é¢˜ï¼ å› ä¸º Java çš„èŒƒå‹åªå­˜åœ¨äºæºç é‡Œï¼Œç¼–è¯‘çš„æ—¶å€™ç»™ä½ é™æ€åœ°æ£€æŸ¥ä¸€ä¸‹èŒƒå‹ç±»å‹æ˜¯å¦æ­£ç¡®ï¼Œè€Œåˆ°äº†è¿è¡Œæ—¶å°±ä¸æ£€æŸ¥äº†ã€‚ä¸Šé¢è¿™æ®µä»£ç åœ¨ JREï¼ˆJavaè¿è¡Œç¯å¢ƒï¼‰çœ‹æ¥å’Œä¸‹é¢è¿™æ®µæ²¡åŒºåˆ«ï¼š LinkedList cats = new LinkedList(); // æ³¨æ„ï¼šæ²¡æœ‰èŒƒå‹ï¼LinkedList list = cats;list.add(new Dog()); ä¸ºä»€ä¹ˆè¦ç±»å‹æ“¦é™¤å‘¢ï¼Ÿä¸»è¦æ˜¯ä¸ºäº†å‘ä¸‹å…¼å®¹ï¼Œå› ä¸º JDK5 ä¹‹å‰æ˜¯æ²¡æœ‰æ³›å‹çš„ï¼Œä¸ºäº†è®© JVM ä¿æŒå‘ä¸‹å…¼å®¹ï¼Œå°±å‡ºäº†ç±»å‹æ“¦é™¤è¿™ä¸ªç­–ç•¥ã€‚ æ³¨è§£51.è¯´ä¸€ä¸‹ä½ å¯¹æ³¨è§£çš„ç†è§£ï¼ŸJava æ³¨è§£æœ¬è´¨ä¸Šæ˜¯ä¸€ä¸ªæ ‡è®°ï¼Œå¯ä»¥ç†è§£æˆç”Ÿæ´»ä¸­çš„ä¸€ä¸ªäººçš„ä¸€äº›å°è£…æ‰®ï¼Œæ¯”å¦‚æˆ´ä»€ä¹ˆä»€ä¹ˆå¸½å­ï¼Œæˆ´ä»€ä¹ˆçœ¼é•œã€‚ æ³¨è§£å¯ä»¥æ ‡è®°åœ¨ç±»ä¸Šã€æ–¹æ³•ä¸Šã€å±æ€§ä¸Šç­‰ï¼Œæ ‡è®°è‡ªèº«ä¹Ÿå¯ä»¥è®¾ç½®ä¸€äº›å€¼ï¼Œæ¯”å¦‚å¸½å­é¢œè‰²æ˜¯ç»¿è‰²ã€‚ æœ‰äº†æ ‡è®°ä¹‹åï¼Œæˆ‘ä»¬å°±å¯ä»¥åœ¨ç¼–è¯‘æˆ–è€…è¿è¡Œé˜¶æ®µå»è¯†åˆ«è¿™äº›æ ‡è®°ï¼Œç„¶åæä¸€äº›äº‹æƒ…ï¼Œè¿™å°±æ˜¯æ³¨è§£çš„ç”¨å¤„ã€‚ ä¾‹å¦‚æˆ‘ä»¬å¸¸è§çš„ AOPï¼Œä½¿ç”¨æ³¨è§£ä½œä¸ºåˆ‡ç‚¹å°±æ˜¯è¿è¡ŒæœŸæ³¨è§£çš„åº”ç”¨ï¼›æ¯”å¦‚ lombokï¼Œå°±æ˜¯æ³¨è§£åœ¨ç¼–è¯‘æœŸçš„è¿è¡Œã€‚ æ³¨è§£ç”Ÿå‘½å‘¨æœŸæœ‰ä¸‰å¤§ç±»ï¼Œåˆ†åˆ«æ˜¯ï¼š RetentionPolicy.SOURCEï¼šç»™ç¼–è¯‘å™¨ç”¨çš„ï¼Œä¸ä¼šå†™å…¥ class æ–‡ä»¶ RetentionPolicy.CLASSï¼šä¼šå†™å…¥ class æ–‡ä»¶ï¼Œåœ¨ç±»åŠ è½½é˜¶æ®µä¸¢å¼ƒï¼Œä¹Ÿå°±æ˜¯è¿è¡Œçš„æ—¶å€™å°±æ²¡è¿™ä¸ªä¿¡æ¯äº† RetentionPolicy.RUNTIMEï¼šä¼šå†™å…¥ class æ–‡ä»¶ï¼Œæ°¸ä¹…ä¿å­˜ï¼Œå¯ä»¥é€šè¿‡åå°„è·å–æ³¨è§£ä¿¡æ¯ æ‰€ä»¥æˆ‘ä¸Šæ–‡å†™çš„æ˜¯è§£æçš„æ—¶å€™ï¼Œæ²¡å†™å…·ä½“æ˜¯è§£æå•¥ï¼Œå› ä¸ºä¸åŒçš„ç”Ÿå‘½å‘¨æœŸçš„è§£æåŠ¨ä½œæ˜¯ä¸åŒçš„ã€‚ åƒå¸¸è§çš„ï¼š å°±æ˜¯ç»™ç¼–è¯‘å™¨ç”¨çš„ï¼Œç¼–è¯‘å™¨ç¼–è¯‘çš„æ—¶å€™æ£€æŸ¥æ²¡é—®é¢˜å°± over äº†ï¼Œclass æ–‡ä»¶é‡Œé¢ä¸ä¼šæœ‰ Override è¿™ä¸ªæ ‡è®°ã€‚ å†æ¯”å¦‚ Spring å¸¸è§çš„ Autowired ï¼Œå°±æ˜¯ RUNTIME çš„ï¼Œæ‰€ä»¥åœ¨è¿è¡Œçš„æ—¶å€™å¯ä»¥é€šè¿‡åå°„å¾—åˆ°æ³¨è§£çš„ä¿¡æ¯ï¼Œè¿˜èƒ½æ‹¿åˆ°æ ‡è®°çš„å€¼ required ã€‚ åå°„52.ğŸŒŸä»€ä¹ˆæ˜¯åå°„ï¼Ÿåº”ç”¨ï¼ŸåŸç†ï¼Ÿåå°„å…è®¸ Java åœ¨è¿è¡Œæ—¶æ£€æŸ¥å’Œæ“ä½œç±»çš„æ–¹æ³•å’Œå­—æ®µã€‚é€šè¿‡åå°„ï¼Œå¯ä»¥åŠ¨æ€åœ°è·å–ç±»çš„å­—æ®µã€æ–¹æ³•ã€æ„é€ æ–¹æ³•ç­‰ä¿¡æ¯ï¼Œå¹¶åœ¨è¿è¡Œæ—¶è°ƒç”¨æ–¹æ³•æˆ–è®¿é—®å­—æ®µã€‚ æ¯”å¦‚åˆ›å»ºä¸€ä¸ªå¯¹è±¡æ˜¯é€šè¿‡ new å…³é”®å­—æ¥å®ç°çš„ï¼š Person person = new Person(); Person ç±»çš„ä¿¡æ¯åœ¨ç¼–è¯‘æ—¶å°±ç¡®å®šäº†ï¼Œé‚£å‡å¦‚åœ¨ç¼–è¯‘æœŸæ— æ³•ç¡®å®šç±»çš„ä¿¡æ¯ï¼Œä½†åˆæƒ³åœ¨è¿è¡Œæ—¶è·å–ç±»çš„ä¿¡æ¯ã€åˆ›å»ºç±»çš„å®ä¾‹ã€è°ƒç”¨ç±»çš„æ–¹æ³•ï¼Œè¿™æ—¶å€™å°±è¦ç”¨åˆ°åå°„ã€‚ åå°„åŠŸèƒ½ä¸»è¦é€šè¿‡ java.lang.Class ç±»åŠ java.lang.reflect åŒ…ä¸­çš„ç±»å¦‚ Method, Field, Constructor ç­‰æ¥å®ç°ã€‚ æ¯”å¦‚è¯´æˆ‘ä»¬å¯ä»¥è£…æ¥åŠ¨æ€åŠ è½½ç±»å¹¶åˆ›å»ºå¯¹è±¡ï¼š String className = java.util.Date;Class? cls = Class.forName(className);Object obj = cls.newInstance();System.out.println(obj.getClass().getName()); æ¯”å¦‚è¯´æˆ‘ä»¬å¯ä»¥è¿™æ ·æ¥è®¿é—®å­—æ®µå’Œæ–¹æ³•ï¼š // åŠ è½½å¹¶å®ä¾‹åŒ–ç±»Class? cls = Class.forName(java.util.Date);Object obj = cls.newInstance();// è·å–å¹¶è°ƒç”¨æ–¹æ³•Method method = cls.getMethod(getTime);Object result = method.invoke(obj);System.out.println(Time: + result);// è®¿é—®å­—æ®µField field = cls.getDeclaredField(fastTime);field.setAccessible(true); // å¯¹äºç§æœ‰å­—æ®µéœ€è¦è¿™æ ·åšSystem.out.println(fastTime: + field.getLong(obj)); åå°„æœ‰å“ªäº›åº”ç”¨åœºæ™¯ï¼Ÿâ‘ ã€Spring æ¡†æ¶å°±å¤§é‡ä½¿ç”¨äº†åå°„æ¥åŠ¨æ€åŠ è½½å’Œç®¡ç† Beanã€‚ Class? clazz = Class.forName(com.example.MyClass);Object instance = clazz.newInstance(); â‘¡ã€Java çš„åŠ¨æ€ä»£ç†ï¼ˆDynamic Proxyï¼‰æœºåˆ¶å°±ä½¿ç”¨äº†åå°„æ¥åˆ›å»ºä»£ç†ç±»ã€‚ä»£ç†ç±»å¯ä»¥åœ¨è¿è¡Œæ—¶åŠ¨æ€å¤„ç†æ–¹æ³•è°ƒç”¨ï¼Œè¿™åœ¨å®ç° AOP å’Œæ‹¦æˆªå™¨æ—¶éå¸¸æœ‰ç”¨ã€‚ //åˆ›å»ºä¸€ä¸ªå¤„ç†å™¨å®ä¾‹,è´Ÿè´£å®é™…æ–¹æ³•çš„è°ƒç”¨é€»è¾‘InvocationHandler handler = new MyInvocationHandler();MyInterface proxyInstance = (MyInterface) Proxy.newProxyInstance( MyInterface.class.getClassLoader(), new Class?[] MyInterface.class , handler); â‘¢ã€JUnit å’Œ TestNG ç­‰æµ‹è¯•æ¡†æ¶ä½¿ç”¨åå°„æœºåˆ¶æ¥å‘ç°å’Œæ‰§è¡Œæµ‹è¯•æ–¹æ³•ã€‚åå°„å…è®¸æ¡†æ¶æ‰«æç±»ï¼ŒæŸ¥æ‰¾å¸¦æœ‰ç‰¹å®šæ³¨è§£ï¼ˆå¦‚ @Testï¼‰çš„æ–¹æ³•ï¼Œå¹¶åœ¨è¿è¡Œæ—¶è°ƒç”¨å®ƒä»¬ã€‚ Method testMethod = testClass.getMethod(testSomething);testMethod.invoke(testInstance); åå°„çš„åŸç†æ˜¯ä»€ä¹ˆï¼ŸJava ç¨‹åºçš„æ‰§è¡Œåˆ†ä¸ºç¼–è¯‘å’Œè¿è¡Œä¸¤æ­¥ï¼Œç¼–è¯‘ä¹‹åä¼šç”Ÿæˆå­—èŠ‚ç (.class)æ–‡ä»¶ï¼ŒJVM è¿›è¡Œç±»åŠ è½½çš„æ—¶å€™ï¼Œä¼šåŠ è½½å­—èŠ‚ç æ–‡ä»¶ï¼Œå°†ç±»å‹ç›¸å…³çš„æ‰€æœ‰ä¿¡æ¯åŠ è½½è¿›æ–¹æ³•åŒºï¼Œåå°„å°±æ˜¯å»è·å–è¿™äº›ä¿¡æ¯ï¼Œç„¶åè¿›è¡Œå„ç§æ“ä½œã€‚ JDK1.8æ–°ç‰¹æ€§JDK å·²ç»å‡ºåˆ° 17 äº†ï¼Œä½†æ˜¯ä½ è¿­ä»£ä½ çš„ç‰ˆæœ¬ï¼Œæˆ‘ç”¨æˆ‘çš„ 8ã€‚JDK1.8 çš„ä¸€äº›æ–°ç‰¹æ€§ï¼Œå½“ç„¶ç°åœ¨ä¹Ÿä¸æ–°äº†ï¼Œå…¶å®åœ¨å·¥ä½œä¸­å·²ç»å¾ˆå¸¸ç”¨äº†ã€‚ 53.JDK 1.8 éƒ½æœ‰å“ªäº›æ–°ç‰¹æ€§ï¼ŸJDK 1.8 æ–°å¢äº†ä¸å°‘æ–°çš„ç‰¹æ€§ï¼Œå¦‚ Lambda è¡¨è¾¾å¼ã€æ¥å£é»˜è®¤æ–¹æ³•ã€Stream APIã€æ—¥æœŸæ—¶é—´ APIã€Optional ç±»ç­‰ã€‚ â‘ ã€Java 8 å…è®¸åœ¨æ¥å£ä¸­æ·»åŠ é»˜è®¤æ–¹æ³•å’Œé™æ€æ–¹æ³•ã€‚ public interface MyInterface default void myDefaultMethod() System.out.println(My default method); static void myStaticMethod() System.out.println(My static method); â‘¡ã€Lambda è¡¨è¾¾å¼æè¿°äº†ä¸€ä¸ªä»£ç å—ï¼ˆæˆ–è€…å«åŒ¿åæ–¹æ³•ï¼‰ï¼Œå¯ä»¥å°†å…¶ä½œä¸ºå‚æ•°ä¼ é€’ç»™æ„é€ æ–¹æ³•æˆ–è€…æ™®é€šæ–¹æ³•ä»¥ä¾¿åç»­æ‰§è¡Œã€‚ public class LamadaTest public static void main(String[] args) new Thread(() - System.out.println(æ²‰é»˜ç‹äºŒ)).start(); ã€ŠEffective Javaã€‹çš„ä½œè€… Josh Bloch å»ºè®®ä½¿ç”¨ Lambda è¡¨è¾¾å¼æ—¶ï¼Œæœ€å¥½ä¸è¦è¶…è¿‡ 3 è¡Œã€‚å¦åˆ™ä»£ç å¯è¯»æ€§ä¼šå˜å¾—å¾ˆå·®ã€‚ â‘¢ã€Stream æ˜¯å¯¹ Java é›†åˆæ¡†æ¶çš„å¢å¼ºï¼Œå®ƒæä¾›äº†ä¸€ç§é«˜æ•ˆä¸”æ˜“äºä½¿ç”¨çš„æ•°æ®å¤„ç†æ–¹å¼ã€‚ ListString list = new ArrayList();list.add(ä¸­å›½åŠ æ²¹);list.add(ä¸–ç•ŒåŠ æ²¹);list.add(ä¸–ç•ŒåŠ æ²¹);long count = list.stream().distinct().count();System.out.println(count); â‘£ã€Java 8 å¼•å…¥äº†ä¸€ä¸ªå…¨æ–°çš„æ—¥æœŸå’Œæ—¶é—´ APIï¼Œä½äºjava.timeåŒ…ä¸­ã€‚è¿™ä¸ªæ–°çš„ API çº æ­£äº†æ—§ç‰ˆjava.util.Dateç±»ä¸­çš„è®¸å¤šç¼ºé™·ã€‚ LocalDate today = LocalDate.now();System.out.println(Todays Local date : + today);LocalTime time = LocalTime.now();System.out.println(Local time : + time);LocalDateTime now = LocalDateTime.now();System.out.println(Current DateTime : + now); â‘¤ã€å¼•å…¥ Optional æ˜¯ä¸ºäº†å‡å°‘ç©ºæŒ‡é’ˆå¼‚å¸¸ã€‚ OptionalString optional = Optional.of(æ²‰é»˜ç‹äºŒ);optional.isPresent(); // trueoptional.get(); // æ²‰é»˜ç‹äºŒoptional.orElse(æ²‰é»˜ç‹ä¸‰); // bamoptional.ifPresent((s) - System.out.println(s.charAt(0))); // æ²‰ 54.Lambda è¡¨è¾¾å¼äº†è§£å¤šå°‘ï¼ŸLambda è¡¨è¾¾å¼ä¸»è¦ç”¨äºæä¾›ä¸€ç§ç®€æ´çš„æ–¹å¼æ¥è¡¨ç¤ºåŒ¿åæ–¹æ³•ï¼Œä½¿ Java å…·å¤‡äº†å‡½æ•°å¼ç¼–ç¨‹çš„ç‰¹æ€§ã€‚ æ¯”å¦‚è¯´æˆ‘ä»¬å¯ä»¥ä½¿ç”¨ Lambda è¡¨è¾¾å¼æ¥ç®€åŒ–çº¿ç¨‹çš„åˆ›å»ºï¼š new Thread(() - System.out.println(Hello World)).start(); è¿™æ¯”ä»¥å‰çš„åŒ¿åå†…éƒ¨ç±»è¦ç®€æ´å¾ˆå¤šã€‚ æ‰€è°“çš„å‡½æ•°å¼ç¼–ç¨‹ï¼Œå°±æ˜¯æŠŠå‡½æ•°ä½œä¸ºå‚æ•°ä¼ é€’ç»™æ–¹æ³•ï¼Œæˆ–è€…ä½œä¸ºæ–¹æ³•çš„ç»“æœè¿”å›ã€‚æ¯”å¦‚è¯´æˆ‘ä»¬å¯ä»¥é…åˆ Stream æµè¿›è¡Œæ•°æ®è¿‡æ»¤ï¼š ListInteger numbers = Arrays.asList(1, 2, 3, 4, 5, 6);ListInteger evenNumbers = numbers.stream() .filter(n - n % 2 == 0) .collect(Collectors.toList()); å…¶ä¸­ n - n % 2 == 0 å°±æ˜¯ä¸€ä¸ª Lambda è¡¨è¾¾å¼ã€‚è¡¨ç¤ºä¼ å…¥ä¸€ä¸ªå‚æ•° nï¼Œè¿”å› n % 2 == 0 çš„ç»“æœã€‚ Java8 æœ‰å“ªäº›å†…ç½®å‡½æ•°å¼æ¥å£ï¼ŸJDK 1.8 API åŒ…å«äº†å¾ˆå¤šå†…ç½®çš„å‡½æ•°å¼æ¥å£ã€‚å…¶ä¸­å°±åŒ…æ‹¬æˆ‘ä»¬åœ¨è€ç‰ˆæœ¬ä¸­ç»å¸¸è§åˆ°çš„ Comparator å’Œ Runnableï¼ŒJava 8 ä¸ºä»–ä»¬éƒ½æ·»åŠ äº† @FunctionalInterface æ³¨è§£ï¼Œä»¥ç”¨æ¥æ”¯æŒ Lambda è¡¨è¾¾å¼ã€‚ é™¤äº†è¿™ä¸¤ä¸ªä¹‹å¤–ï¼Œè¿˜æœ‰ Callableã€Predicateã€Functionã€Supplierã€Consumer ç­‰ç­‰ã€‚ 55.Optional äº†è§£å—ï¼ŸOptionalæ˜¯ç”¨äºé˜²èŒƒNullPointerExceptionã€‚ å¯ä»¥å°† Optional çœ‹åšæ˜¯åŒ…è£…å¯¹è±¡ï¼ˆå¯èƒ½æ˜¯ null, ä¹Ÿæœ‰å¯èƒ½é nullï¼‰çš„å®¹å™¨ã€‚å½“æˆ‘ä»¬å®šä¹‰äº† ä¸€ä¸ªæ–¹æ³•ï¼Œè¿™ä¸ªæ–¹æ³•è¿”å›çš„å¯¹è±¡å¯èƒ½æ˜¯ç©ºï¼Œä¹Ÿæœ‰å¯èƒ½éç©ºçš„æ—¶å€™ï¼Œæˆ‘ä»¬å°±å¯ä»¥è€ƒè™‘ç”¨ Optional æ¥åŒ…è£…å®ƒï¼Œè¿™ä¹Ÿæ˜¯åœ¨ Java 8 è¢«æ¨èä½¿ç”¨çš„åšæ³•ã€‚ OptionalString optional = Optional.of(bam);optional.isPresent(); // trueoptional.get(); // bamoptional.orElse(fallback); // bamoptional.ifPresent((s) - System.out.println(s.charAt(0))); // b 56.Stream æµç”¨è¿‡å—ï¼ŸStream æµï¼Œç®€å•æ¥è¯´ï¼Œä½¿ç”¨ java.util.Stream å¯¹ä¸€ä¸ªåŒ…å«ä¸€ä¸ªæˆ–å¤šä¸ªå…ƒç´ çš„é›†åˆåšå„ç§æ“ä½œã€‚è¿™äº›æ“ä½œå¯èƒ½æ˜¯ ä¸­é—´æ“ä½œ äº¦æˆ–æ˜¯ ç»ˆç«¯æ“ä½œã€‚ ç»ˆç«¯æ“ä½œä¼šè¿”å›ä¸€ä¸ªç»“æœï¼Œè€Œä¸­é—´æ“ä½œä¼šè¿”å›ä¸€ä¸ª Stream æµã€‚ Stream æµä¸€èˆ¬ç”¨äºé›†åˆï¼Œæˆ‘ä»¬å¯¹ä¸€ä¸ªé›†åˆåšå‡ ä¸ªå¸¸è§æ“ä½œï¼š ListString stringCollection = new ArrayList();stringCollection.add(ddd2);stringCollection.add(aaa2);stringCollection.add(bbb1);stringCollection.add(aaa1);stringCollection.add(bbb3);stringCollection.add(ccc);stringCollection.add(bbb2);stringCollection.add(ddd1);Filter è¿‡æ»¤stringCollection .stream() .filter((s) - s.startsWith(a)) .forEach(System.out::println);// aaa2, aaa1 Sorted æ’åº stringCollection .stream() .sorted() .filter((s) - s.startsWith(a)) .forEach(System.out::println);// aaa1, aaa2 Map è½¬æ¢ stringCollection .stream() .map(String::toUpperCase) .sorted((a, b) - b.compareTo(a)) .forEach(System.out::println);// DDD2, DDD1, CCC, BBB3, BBB2, AAA2, AAA1 Match åŒ¹é… // éªŒè¯ list ä¸­ string æ˜¯å¦æœ‰ä»¥ a å¼€å¤´çš„, åŒ¹é…åˆ°ç¬¬ä¸€ä¸ªï¼Œå³è¿”å› trueboolean anyStartsWithA = stringCollection .stream() .anyMatch((s) - s.startsWith(a));System.out.println(anyStartsWithA); // true// éªŒè¯ list ä¸­ string æ˜¯å¦éƒ½æ˜¯ä»¥ a å¼€å¤´çš„boolean allStartsWithA = stringCollection .stream() .allMatch((s) - s.startsWith(a));System.out.println(allStartsWithA); // false// éªŒè¯ list ä¸­ string æ˜¯å¦éƒ½ä¸æ˜¯ä»¥ z å¼€å¤´çš„,boolean noneStartsWithZ = stringCollection .stream() .noneMatch((s) - s.startsWith(z));System.out.println(noneStartsWithZ); // true Count è®¡æ•°count æ˜¯ä¸€ä¸ªç»ˆç«¯æ“ä½œï¼Œå®ƒèƒ½å¤Ÿç»Ÿè®¡ stream æµä¸­çš„å…ƒç´ æ€»æ•°ï¼Œè¿”å›å€¼æ˜¯ long ç±»å‹ã€‚ // å…ˆå¯¹ list ä¸­å­—ç¬¦ä¸²å¼€å¤´ä¸º b è¿›è¡Œè¿‡æ»¤ï¼Œè®©åç»Ÿè®¡æ•°é‡long startsWithB = stringCollection .stream() .filter((s) - s.startsWith(b)) .count();System.out.println(startsWithB); // 3 ReduceReduce ä¸­æ–‡ç¿»è¯‘ä¸ºï¼šå‡å°‘ã€ç¼©å°ã€‚é€šè¿‡å…¥å‚çš„ Functionï¼Œæˆ‘ä»¬èƒ½å¤Ÿå°† list å½’çº¦æˆä¸€ä¸ªå€¼ã€‚å®ƒçš„è¿”å›ç±»å‹æ˜¯ Optional ç±»å‹ã€‚ OptionalString reduced = stringCollection .stream() .sorted() .reduce((s1, s2) - s1 + # + s2);reduced.ifPresent(System.out::println);// aaa1#aaa2#bbb1#bbb2#bbb3#ccc#ddd1#ddd2 ä»¥ä¸Šæ˜¯å¸¸è§çš„å‡ ç§æµå¼æ“ä½œï¼Œè¿˜æœ‰å…¶å®ƒçš„ä¸€äº›æµå¼æ“ä½œï¼Œå¯ä»¥å¸®åŠ©æˆ‘ä»¬æ›´ä¾¿æ·åœ°å¤„ç†é›†åˆæ•°æ®ã€‚","tags":["åŸºç¡€","Java"],"categories":["Javaé—®ç­”ç¬”è®°"]},{"title":"2025.7.22å­¦ä¹ æ—¥è®°","path":"/2025/07/22/å­¦ä¹ æ—¥è®°25å¹´7æœˆ/2025.7.22å­¦ä¹ ç¬”è®°/","content":"ä»Šæ—¥å­¦ä¹ å†…å®¹3DGSç¼–å†™æµ‹è¯•è„šæœ¬. åŠ›æ‰£æ¯æ—¥ä¸€é¢˜ä¸€é“å“ˆå¸Œè¡¨çš„ä¸­ç­‰é¢˜ç›®,æ¯”è¾ƒç®€å•çš„. JavaSEå…«è‚¡1556 é¡¹ç›®ç¯‡å†æ¬¡æ¢³ç†äº†ä¸€éé¡¹ç›®çš„reqinfoè¿‡æ»¤å™¨,æŠŠæ•´ä¸ªé¡¹ç›®çš„è¿‡æ»¤å™¨,æ‹¦æˆªå™¨é€»è¾‘æ¢³ç†æ˜ç™½äº†. ä»£ç éšæƒ³å½•ä¸€é“dpé¢˜,å¤ä¹ äº†KMP. ç”Ÿæ´»ç¯‡æ™šä¸Šå¥èº«ç»ƒèƒŒ,æ ¸å¿ƒ,è‚©,ä¸‰å¤´,å¼ºåº¦ä¸­ç­‰åä¸Š.","tags":["åŸºç¡€","æ—¥è®°","leetcode","é¡¹ç›®"],"categories":["å­¦ä¹ æ—¥è®°","2025-07"]},{"title":"2025.7.21å­¦ä¹ æ—¥è®°","path":"/2025/07/21/å­¦ä¹ æ—¥è®°25å¹´7æœˆ/2025.7.21å­¦ä¹ ç¬”è®°/","content":"ä»Šæ—¥å­¦ä¹ å†…å®¹3DGSç¼–å†™æµ‹è¯•è„šæœ¬. é¡¹ç›®ç¯‡è¦åœ¨devç¯å¢ƒä¸‹çš„è¯,éœ€è¦å…³é—­devtools,-Dspring.devtools.restart.enabled=false. å…³äºspringåˆå§‹åŒ–çš„ä¸€äº›æ€»ç»“: @ConfigurationProperties é…ç½®ç±»æœ€æ—©è¢«åŠ è½½ï¼Œå¦‚æ‚¨çš„MailConfigæ­¤æ—¶æ‰€æœ‰é…ç½®å±æ€§å·²å°±ç»ª Logback åˆå§‹åŒ–åŠ è½½logback-spring.xmlåˆ›å»ºæ‰€æœ‰Appenderï¼ˆåŒ…æ‹¬æ‚¨çš„AlarmUtilï¼‰Spring Bean åˆå§‹åŒ– å¸¸è§„@Componentå’Œ@Beanæ­¤æ—¶AlarmUtilå¯èƒ½å·²ç»ç¼“å­˜äº†æœªåˆå§‹åŒ–çš„çŠ¶æ€ åŠ›æ‰£æ¯æ—¥ä¸€é¢˜ä¸€é“ç®€å•é¢˜,éå†å³å¯. ä»£ç éšæƒ³å½•ä¸ªäººåšå®¢ä¼˜åŒ–äº†ä¸€ä¸‹ä¸ªäººåšå®¢çš„èƒŒæ™¯å’Œæ‰“å¡å¢™çš„é€»è¾‘. ç”Ÿæ´»ç¯‡æ™šä¸Šå¥èº«ä¸»è¦æ˜¯æ ¸å¿ƒæŠ—æ—‹è½¬è®­ç»ƒ,å¼ºåº¦é€‚ä¸­.","tags":["åŸºç¡€","æ—¥è®°","leetcode","é¡¹ç›®","åšå®¢"],"categories":["å­¦ä¹ æ—¥è®°","2025-07"]},{"title":"2025.7.20å­¦ä¹ æ—¥è®°","path":"/2025/07/20/å­¦ä¹ æ—¥è®°25å¹´7æœˆ/2025.7.20å­¦ä¹ ç¬”è®°/","content":"ä»Šæ—¥å­¦ä¹ å†…å®¹3DGSåŠ›æ‰£æ¯æ—¥ä¸€é¢˜:ä¸€é“å›°éš¾é¢˜. ç”Ÿæ´»ç¯‡ä¸Šåˆè¸¢çƒé¢ çƒ çŸ­ä¼  é•¿ä¼  åœçƒ.","tags":["åŸºç¡€","æ—¥è®°","leetcode","é¡¹ç›®","åšå®¢"],"categories":["å­¦ä¹ æ—¥è®°","2025-07"]},{"title":"2025.7.19å­¦ä¹ æ—¥è®°","path":"/2025/07/19/å­¦ä¹ æ—¥è®°25å¹´7æœˆ/2025.7.19å­¦ä¹ ç¬”è®°/","content":"ä»Šæ—¥å­¦ä¹ å†…å®¹3DGSåŠ›æ‰£æ¯æ—¥ä¸€é¢˜:ä¸­ç­‰é¢˜. ä¸Šåˆå­¦ä¹ è®¡ç®—æœºç½‘ç»œå­¦ä¹ è®¡ç®—æœºç½‘ç»œåŸºç¡€å®Œæˆ 6262. ä¸ªäººåšå®¢ä¼˜åŒ–äº†ä¸€ä¸‹ä¸ªäººåšå®¢çš„èƒŒæ™¯å’Œæ‰“å¡å¢™çš„é€»è¾‘. ç”Ÿæ´»ç¯‡","tags":["åŸºç¡€","æ—¥è®°","leetcode","é¡¹ç›®","åšå®¢"],"categories":["å­¦ä¹ æ—¥è®°","2025-07"]},{"title":"2025.7.18å­¦ä¹ æ—¥è®°","path":"/2025/07/18/å­¦ä¹ æ—¥è®°25å¹´7æœˆ/2025.7.18å­¦ä¹ ç¬”è®°/","content":"ä»Šæ—¥å­¦ä¹ å†…å®¹3DGSåŠ›æ‰£æ¯æ—¥ä¸€é¢˜:ä¸€é“å›°éš¾é¢˜,ç”¨çš„å‰ç¼€å’ŒåŠ å †ä¼˜åŒ–. ä¸Šåˆå­¦ä¹ è®¡ç®—æœºç½‘ç»œè®°äº†ç¬”è®° 5262 ä¸ªäººåšå®¢æ·»åŠ äº†å¿ƒå¿ƒå¿µå¿µçš„æ‰“å¡å¢™æ¨¡å—,åŒ…æ‹¬ä¾§è¾¹æ çš„æ‰“å¡æ—¥å†è¿˜æœ‰check-inå¹´åº¦æ‰“å¡ç•Œé¢,æ•°æ®æ¥æºæ˜¯å½’æ¡£ç¬”è®°çš„æ—¥æœŸ.ç„¶åä¼˜åŒ–çš„åšå®¢çš„æ ·å¼å’ŒèƒŒæ™¯. ç”Ÿæ´»ç¯‡æ—©ä¸Šè¸¢çƒé¢ çƒ çŸ­ä¼  é•¿ä¼  åœçƒ.","tags":["åŸºç¡€","æ—¥è®°","leetcode","é¡¹ç›®","åšå®¢"],"categories":["å­¦ä¹ æ—¥è®°","2025-07"]},{"title":"2025.7.17å­¦ä¹ æ—¥è®°","path":"/2025/07/17/å­¦ä¹ æ—¥è®°25å¹´7æœˆ/2025.7.17å­¦ä¹ ç¬”è®°/","content":"ä»Šæ—¥å­¦ä¹ å†…å®¹3DGSåŠ›æ‰£æ¯æ—¥ä¸€é¢˜:ä¸€é“ä¸­ç­‰çš„åŠ¨æ€è§„åˆ’é¢˜,æ˜¨å¤©é¢˜ç›®çš„è¿›é˜¶ç‰ˆæœ¬. ä¸Šåˆå­¦ä¹ è®¡ç®—æœºç½‘ç»œè®°äº†ç¬”è®° 4362 ä»£ç éšæƒ³å½•å¤ä¹ äº†ä¸¤é“å®Œå…¨èƒŒåŒ…. é¡¹ç›®ç›¸å…³å®Œæˆäº†ReqInfoçš„æ‹¦æˆªå™¨.git rm -r â€“cached .git rm â€“cached techub-websrcmainresourcesapplication-email.ymlä¸‹æ¬¡æ‰§è¡Œè¿™ä¸ª,åˆ«å…¨éƒ¨æ¸…é™¤äº† ç”Ÿæ´»ç¯‡æ™šä¸Šå¥èº«ä¸»è¦ç»ƒæ ¸å¿ƒè¿˜æœ‰èƒŒ.","tags":["åŸºç¡€","æ—¥è®°","leetcode","é¡¹ç›®"],"categories":["å­¦ä¹ æ—¥è®°","2025-07"]},{"title":"2025.7.16å­¦ä¹ æ—¥è®°","path":"/2025/07/16/å­¦ä¹ æ—¥è®°25å¹´7æœˆ/2025.7.16å­¦ä¹ ç¬”è®°/","content":"ä»Šæ—¥å­¦ä¹ å†…å®¹3DGSåŠ›æ‰£æ¯æ—¥ä¸€é¢˜:ä¸€é“ä¸­ç­‰çš„åŠ¨æ€è§„åˆ’é¢˜. ä¸Šåˆå­¦ä¹ è®¡ç®—æœºç½‘ç»œè®°äº†ç¬”è®° 3562 ä»£ç éšæƒ³å½•å®Œæˆäº†01èƒŒåŒ…çš„é¢˜,çœ‹äº†å®Œå…¨èƒŒåŒ…çš„è®²ä¹‰. é¡¹ç›®ç›¸å…³å®Œæˆäº†ReqInfoçš„æ‹¦æˆªå™¨.","tags":["æ—¥è®°","leetcode","é¡¹ç›®"],"categories":["å­¦ä¹ æ—¥è®°","2025-07"]},{"title":"2025.7.15å­¦ä¹ æ—¥è®°","path":"/2025/07/15/å­¦ä¹ æ—¥è®°25å¹´7æœˆ/2025.7.15å­¦ä¹ ç¬”è®°/","content":"ä»Šæ—¥å­¦ä¹ å†…å®¹3DGSåŠ›æ‰£æ¯æ—¥ä¸€é¢˜:ä¸€é“ç®€å•é¢˜. ä¸Šåˆå­¦ä¹ è®¡ç®—æœºç½‘ç»œè®°äº†ç¬”è®° 2662 ä»£ç éšæƒ³å½•å®Œæˆäº†01èƒŒåŒ…çš„é¢˜,çœ‹äº†å®Œå…¨èƒŒåŒ…çš„è®²ä¹‰. é¡¹ç›®ç›¸å…³å®Œæˆäº†ReqInfoçš„æ‹¦æˆªå™¨. ç”Ÿæ´»æ™šä¸Šå¥èº«ä¸»è¦ç»ƒå¾—èƒ¸å’Œè‚©,å¼ºåº¦é«˜.","tags":["æ—¥è®°","leetcode","é¡¹ç›®"],"categories":["å­¦ä¹ æ—¥è®°","2025-07"]},{"title":"è®¡ç®—æœºç½‘ç»œå­¦ä¹ ç¬”è®°","path":"/2025/07/14/Javaé—®ç­”ç¬”è®°/è®¡ç®—æœºç½‘ç»œå­¦ä¹ ç¬”è®°/","content":"åŸºç¡€1.è®¡ç®—æœºç½‘ç»œä½“ç³»çš„ç»“æ„è®¡ç®—æœºç½‘ç»œä½“ç³»ç»“æ„é€šè¿‡å°†å¤æ‚çš„ç½‘ç»œé€šä¿¡åˆ†è§£æˆä¸åŒçš„å±‚æ¬¡ï¼Œæ¥æ ‡å‡†åŒ–äº¤äº’çš„è¿‡ç¨‹ã€‚å¸¸è§çš„æ¨¡å‹åŒ…æ‹¬ OSI ä¸ƒå±‚æ¨¡å‹ã€TCP/IP å››å±‚æ¨¡å‹å’Œäº”å±‚ä½“ç³»ç»“æ„ã€‚ OSI æ˜¯ç†è®ºä¸Šçš„ç½‘ç»œé€šä¿¡æ¨¡å‹ï¼ŒTCPIP æ˜¯å®é™…åº”ç”¨å±‚é¢ä¸Šçš„ç½‘ç»œé€šä¿¡æ¨¡å‹ï¼Œäº”å±‚ç»“æ„æ˜¯ä¸ºäº†æ–¹ä¾¿ç†è§£å’Œè®°å¿†ã€‚ è¯´è¯´ OSI ä¸ƒå±‚æ¨¡å‹ï¼ŸOSIï¼ˆOpen System Interconnectionï¼‰ä¸ƒå±‚å‚è€ƒæ¨¡å‹æ˜¯ä¸€ä¸ªç½‘ç»œæ¶æ„æ¨¡å‹ï¼Œç”±å›½é™…æ ‡å‡†åŒ–ç»„ç»‡ï¼ˆISOï¼‰æå‡ºï¼Œç”¨äºæè¿°å’Œæ ‡å‡†åŒ–å„ç§è®¡ç®—æœºç½‘ç»œçš„åŠŸèƒ½å’Œè¿‡ç¨‹ã€‚è¿™ä¸ƒå±‚ä»é«˜åˆ°ä½åˆ†åˆ«æ˜¯ï¼š åº”ç”¨å±‚ï¼šæœ€é è¿‘ç”¨æˆ·çš„å±‚ï¼Œè´Ÿè´£å¤„ç†ç‰¹å®šçš„åº”ç”¨ç¨‹åºç»†èŠ‚ã€‚è¿™ä¸€å±‚æä¾›äº†ç½‘ç»œæœåŠ¡ä¸ç”¨æˆ·åº”ç”¨è½¯ä»¶ä¹‹é—´çš„æ¥å£ã€‚ ä¾‹å¦‚ï¼ŒWeb æµè§ˆå™¨ã€FTP å®¢æˆ·ç«¯å’ŒæœåŠ¡å™¨ã€ç”µå­é‚®ä»¶å®¢æˆ·ç«¯ç­‰ã€‚ è¡¨ç¤ºå±‚ï¼šç¡®ä¿ä»ä¸€ä¸ªç³»ç»Ÿå‘é€çš„ä¿¡æ¯å¯ä»¥è¢«å¦ä¸€ä¸ªç³»ç»Ÿçš„åº”ç”¨å±‚è¯»å–ã€‚å®ƒè´Ÿè´£æ•°æ®çš„è½¬æ¢ã€å‹ç¼©å’ŒåŠ å¯†ã€‚ ä¾‹å¦‚ï¼Œç¡®ä¿æ•°æ®ä»ä¸€ç§ç¼–ç æ ¼å¼è½¬æ¢ä¸ºå¦ä¸€ç§ï¼Œå¦‚ ASCII åˆ° EBCDICã€‚ ä¼šè¯å±‚ï¼šç®¡ç†ç”¨æˆ·çš„ä¼šè¯ï¼Œæ§åˆ¶ç½‘ç»œä¸Šä¸¤èŠ‚ç‚¹é—´çš„å¯¹è¯å’Œæ•°æ®äº¤æ¢çš„ç®¡ç†ã€‚å®ƒè´Ÿè´£å»ºç«‹ã€ç»´æŠ¤å’Œç»ˆæ­¢ä¼šè¯ã€‚ ä¾‹å¦‚ï¼Œå»ºç«‹ä¸€ä¸ªä¼šè¯ä»¤ç‰Œï¼Œä»¥ä¾¿åœ¨ç½‘ç»œä¸Šçš„ä¸¤ä¸ªèŠ‚ç‚¹ä¹‹é—´ä¼ é€’ã€‚ ä¼ è¾“å±‚ï¼šæä¾›ç«¯åˆ°ç«¯çš„é€šä¿¡æœåŠ¡ï¼Œä¿è¯æ•°æ®çš„å®Œæ•´æ€§å’Œæ­£ç¡®é¡ºåºã€‚è¿™ä¸€å±‚åŒ…æ‹¬ TCP å’Œ UDP ç­‰ã€‚ ç½‘ç»œå±‚ï¼šè´Ÿè´£åœ¨å¤šä¸ªç½‘ç»œä¹‹é—´è¿›è¡Œæ•°æ®ä¼ è¾“ï¼Œç¡®ä¿æ•°æ®èƒ½å¤Ÿåœ¨å¤æ‚çš„ç½‘ç»œç»“æ„ä¸­æ‰¾åˆ°ä»æºåˆ°ç›®çš„åœ°çš„æœ€ä½³è·¯å¾„ã€‚è¿™å±‚ä½¿ç”¨çš„æ˜¯ IPï¼ˆInternet Protocolï¼‰åè®®ã€‚ æ•°æ®é“¾è·¯å±‚ï¼šåœ¨ç‰©ç†è¿æ¥ä¸­æä¾›å¯é çš„ä¼ è¾“ï¼Œè´Ÿè´£å»ºç«‹å’Œç»´æŠ¤ä¸¤ä¸ªç›¸é‚»èŠ‚ç‚¹é—´çš„é“¾è·¯ã€‚åŒ…æ‹¬å¸§åŒæ­¥ã€MACï¼ˆåª’ä½“è®¿é—®æ§åˆ¶ï¼‰ã€‚ ç‰©ç†å±‚ï¼šè´Ÿè´£åœ¨ç‰©ç†åª’ä»‹ä¸Šå®ç°åŸå§‹çš„æ•°æ®ä¼ è¾“ï¼Œæ¯”å¦‚ç”µç¼†ã€å…‰çº¤å’Œæ— çº¿ä¿¡å·ä¼ è¾“ã€‚æ¶‰åŠçš„å†…å®¹åŒ…æ‹¬ç”µå‹ã€æ¥å£ã€é’ˆè„šã€ç”µç¼†çš„è§„æ ¼å’Œä¼ è¾“é€Ÿç‡ç­‰ã€‚ è¯´è¯´ TCPIP å››å±‚æ¨¡å‹ï¼ŸTCPIP å››å±‚æ¨¡å‹æ˜¯äº’è”ç½‘é€šä¿¡çš„æ ¸å¿ƒï¼Œå®šä¹‰äº†ä¸€ç³»åˆ—åè®®å’Œæ ‡å‡†ï¼Œç¡®ä¿è®¾å¤‡é—´å¯ä»¥å¯é åœ°è¿›è¡Œæ•°æ®ä¼ è¾“ã€‚ â‘ ã€åº”ç”¨å±‚ï¼ˆApplication Layerï¼‰ï¼šç›´æ¥é¢å‘ç”¨æˆ·å’Œåº”ç”¨ç¨‹åºï¼Œæä¾›å„ç§ç½‘ç»œæœåŠ¡ã€‚å®ƒåŒ…å«äº†ç”¨äºç‰¹å®šåº”ç”¨çš„åè®®å’ŒæœåŠ¡ï¼Œå¦‚ HTTPï¼ˆHyperText Transfer Protocolï¼‰ã€FTPï¼ˆFile Transfer Protocolï¼‰ã€SMTPï¼ˆSimple Mail Transfer Protocolï¼‰ç­‰ã€‚ ç¤ºä¾‹ï¼šå½“åœ¨æµè§ˆå™¨ä¸­è¾“å…¥ä¸€ä¸ª URL å¹¶è®¿é—®ä¸€ä¸ªç½‘é¡µæ—¶ï¼Œæµè§ˆå™¨ä½¿ç”¨ HTTP åè®®ä» Web æœåŠ¡å™¨è¯·æ±‚é¡µé¢å†…å®¹ã€‚ â‘¡ã€ä¼ è¾“å±‚ï¼ˆTransport Layerï¼‰ï¼šæä¾›ç«¯åˆ°ç«¯çš„é€šä¿¡æœåŠ¡ï¼Œç¡®ä¿æ•°æ®å¯é ä¼ è¾“ã€‚å®ƒè´Ÿè´£åˆ†æ®µæ•°æ®ã€æµé‡æ§åˆ¶ã€é”™è¯¯æ£€æµ‹å’Œçº æ­£ã€‚å¸¸è§çš„ä¼ è¾“å±‚åè®®æœ‰ TCP å’Œ UDPã€‚ ç¤ºä¾‹ï¼šå½“å‘é€ä¸€å°ç”µå­é‚®ä»¶æ—¶ï¼ŒTCP åè®®ç¡®ä¿é‚®ä»¶ä»ä½ çš„å®¢æˆ·ç«¯å¯é åœ°ä¼ è¾“åˆ°é‚®ä»¶æœåŠ¡å™¨ã€‚ â‘¢ã€ç½‘é™…å±‚ï¼šæˆ–è€…å«ç½‘ç»œå±‚ï¼ˆInternet Layerï¼‰ï¼Œè´Ÿè´£åœ¨ä¸åŒç½‘ç»œä¹‹é—´è·¯ç”±æ•°æ®åŒ…ï¼Œæä¾›é€»è¾‘åœ°å€ï¼ˆIP åœ°å€ï¼‰å’Œç½‘ç»œå¯»å€åŠŸèƒ½ã€‚ç”¨äºå¤„ç†æ•°æ®åŒ…çš„åˆ†ç»„ã€è½¬å‘å’Œè·¯ç”±é€‰æ‹©ï¼Œç¡®ä¿æ•°æ®å¯ä»¥ä»æºç«¯ä¼ è¾“åˆ°ç›®æ ‡ç«¯ã€‚ å¸¸è§åè®®ï¼šIPv4ã€IPv6ã€ICMPï¼ˆInternet Control Message Protocolï¼‰ã€‚ ç¤ºä¾‹ï¼šå½“è®¿é—®ä¸€ä¸ªç½‘ç«™æ—¶ï¼Œç½‘ç»œå±‚åè®®ï¼ˆå¦‚ IPv4ï¼‰å°†ä½ çš„è¯·æ±‚ä»ä½ çš„è®¡ç®—æœºé€šè¿‡å¤šä¸ªè·¯ç”±å™¨ä¼ è¾“åˆ°ç›®æ ‡æœåŠ¡å™¨ã€‚ â‘£ã€ç½‘ç»œæ¥å£å±‚ï¼ˆNetwork Access Layerï¼‰ï¼šæˆ–è€…å«é“¾è·¯å±‚ï¼ˆLink Layerï¼‰ï¼Œè´Ÿè´£å°†æ•°å­—ä¿¡å·åœ¨ç‰©ç†é€šé“ï¼ˆç½‘çº¿ï¼‰ä¸­å‡†ç¡®ä¼ è¾“ï¼Œå®šä¹‰äº†å¦‚ä½•åœ¨å•ä¸€ç½‘ç»œé“¾è·¯ä¸Šä¼ è¾“æ•°æ®ï¼Œå¦‚ä½•å¤„ç†æ•°æ®å¸§çš„å‘é€å’Œæ¥æ”¶ï¼ŒåŒ…æ‹¬ç‰©ç†åœ°å€ï¼ˆMAC åœ°å€ï¼‰çš„è§£æã€‚ å¸¸è§åè®®ï¼šä»¥å¤ªç½‘ï¼ˆEthernetï¼‰ã€Wi-Fiã€‚ ç¤ºä¾‹ï¼šåœ¨ä¸€ä¸ªå±€åŸŸç½‘ï¼ˆLANï¼‰ä¸­ï¼Œè®¡ç®—æœºé€šè¿‡ä»¥å¤ªç½‘è¿æ¥äº¤æ¢æœºï¼Œé“¾è·¯å±‚åè®®è´Ÿè´£æ•°æ®å¸§åœ¨ç½‘ç»œè®¾å¤‡é—´çš„ä¼ è¾“ã€‚ è¯´è¯´äº”å±‚ä½“ç³»ç»“æ„ï¼Ÿæ˜¯å¯¹ OSI å’Œ TCPIP çš„æŠ˜è¡·ï¼Œå®ƒä¿ç•™äº† TCPIP çš„å®ç”¨æ€§ï¼ŒåŒæ—¶æä¾›äº†æ¯”å››å±‚æ¨¡å‹æ›´ç»†è‡´çš„åˆ†å±‚ï¼Œä¾¿äºæ•™å­¦å’Œç†è§£ç½‘ç»œçš„å„ä¸ªæ–¹é¢ã€‚ åº”ç”¨å±‚ï¼šä½œä¸ºç½‘ç»œæœåŠ¡å’Œæœ€ç»ˆç”¨æˆ·ä¹‹é—´çš„æ¥å£ã€‚å®ƒæä¾›äº†ä¸€ç³»åˆ—ä¾›åº”ç”¨ç¨‹åºä½¿ç”¨çš„åè®®ï¼Œå¦‚ HTTPï¼ˆç½‘é¡µï¼‰ã€FTPï¼ˆæ–‡ä»¶ä¼ è¾“ï¼‰ã€SMTPï¼ˆé‚®ä»¶ä¼ è¾“ï¼‰ç­‰ã€‚ä½¿ç”¨æˆ·çš„åº”ç”¨ç¨‹åºå¯ä»¥è®¿é—®ç½‘ç»œæœåŠ¡ã€‚ ä¼ è¾“å±‚ï¼šæä¾›è¿›ç¨‹åˆ°è¿›ç¨‹çš„é€šä¿¡ç®¡ç†ï¼Œè¿™ä¸€å±‚ç¡®ä¿æ•°æ®æŒ‰é¡ºåºã€æ— é”™è¯¯åœ°ä¼ è¾“ã€‚ä¸»è¦åè®®åŒ…æ‹¬ TCP å’Œ UDPã€‚ ç½‘ç»œå±‚ï¼šè´Ÿè´£æ•°æ®åŒ…ä»æºåˆ°ç›®çš„åœ°çš„ä¼ è¾“å’Œè·¯ç”±é€‰æ‹©ï¼ŒåŒ…æ‹¬è·¨è¶Šå¤šä¸ªç½‘ç»œï¼ˆå³äº’è”ç½‘ï¼‰ã€‚å®ƒä½¿ç”¨é€»è¾‘åœ°å€ï¼ˆå¦‚ IP åœ°å€ï¼‰æ¥å”¯ä¸€æ ‡è¯†è®¾å¤‡ã€‚è·¯ç”±å™¨æ˜¯ç½‘ç»œå±‚è®¾å¤‡ã€‚ æ•°æ®é“¾è·¯å±‚ï¼šç¡®ä¿ä»ä¸€ä¸ªèŠ‚ç‚¹åˆ°å¦ä¸€ä¸ªèŠ‚ç‚¹çš„å¯é ã€æœ‰æ•ˆçš„æ•°æ®ä¼ è¾“ã€‚äº¤æ¢æœºã€ç½‘æ¡¥æ˜¯æ•°æ®é“¾è·¯å±‚è®¾å¤‡ã€‚ ç‰©ç†å±‚ï¼šç”µç¼†ã€å…‰çº¤ã€æ— çº¿ç”µé¢‘è°±ã€ç½‘ç»œé€‚é…å™¨ç­‰ã€‚ TCPä¸‰æ¬¡æ¡æ‰‹å››æ¬¡æŒ¥æ‰‹å·¥ä½œåœ¨å“ªä¸€å±‚ï¼Ÿä¸‰æ¬¡æ¡æ‰‹å’Œå››æ¬¡æŒ¥æ‰‹éƒ½æ˜¯å·¥ä½œåœ¨ä¼ è¾“å±‚ã€‚ä¼ è¾“å±‚ï¼ˆTransport Layerï¼‰æ˜¯ OSI æ¨¡å‹çš„ç¬¬å››å±‚ï¼Œè´Ÿè´£æä¾›ç«¯åˆ°ç«¯çš„é€šä¿¡æœåŠ¡ï¼ŒåŒ…æ‹¬æ•°æ®ä¼ è¾“çš„å»ºç«‹ã€ç»´æŠ¤å’Œç»ˆæ­¢ã€‚ TCP ä½œä¸ºä¸€ç§é¢å‘è¿æ¥çš„åè®®ï¼Œé€šè¿‡ä¸‰æ¬¡æ¡æ‰‹å»ºç«‹è¿æ¥ï¼Œé€šè¿‡å››æ¬¡æŒ¥æ‰‹ç»ˆæ­¢è¿æ¥ï¼Œç¡®ä¿æ•°æ®ä¼ è¾“çš„å¯é æ€§å’Œå®Œæ•´æ€§ã€‚ è®²ä¸€ä¸‹è®¡ç®—æœºç½‘ç»œï¼Ÿè®¡ç®—æœºç½‘ç»œæ˜¯æŒ‡å°†å¤šå°è®¡ç®—æœºé€šè¿‡é€šä¿¡è®¾å¤‡äº’è”èµ·æ¥ï¼Œå®ç°èµ„æºå…±äº«å’Œä¿¡æ¯ä¼ é€’çš„ç³»ç»Ÿã€‚ 2.è¯´ä¸€ä¸‹æ¯ä¸€å±‚å¯¹åº”çš„ç½‘ç»œåè®®æœ‰å“ªäº›ï¼Ÿä¸€å¼ è¡¨æ ¼æ€»ç»“å¸¸è§ç½‘ç»œåè®®ï¼š 3.é‚£ä¹ˆæ•°æ®åœ¨å„å±‚ä¹‹é—´æ˜¯æ€ä¹ˆä¼ è¾“çš„å‘¢ï¼Ÿå¯¹äºå‘é€æ–¹è€Œè¨€ï¼Œä»ä¸Šå±‚åˆ°ä¸‹å±‚å±‚å±‚åŒ…è£…ï¼Œå¯¹äºæ¥æ”¶æ–¹è€Œè¨€ï¼Œä»ä¸‹å±‚åˆ°ä¸Šå±‚ï¼Œå±‚å±‚è§£å¼€åŒ…è£…ã€‚ å‘é€æ–¹çš„åº”ç”¨è¿›ç¨‹å‘æ¥æ”¶æ–¹çš„åº”ç”¨è¿›ç¨‹ä¼ é€æ•°æ® AP å…ˆå°†æ•°æ®äº¤ç»™æœ¬ä¸»æœºçš„åº”ç”¨å±‚ï¼Œåº”ç”¨å±‚åŠ ä¸Šæœ¬å±‚çš„æ§åˆ¶ä¿¡æ¯ H5 å°±å˜æˆäº†ä¸‹ä¸€å±‚çš„æ•°æ®å•å…ƒ ä¼ è¾“å±‚æ”¶åˆ°è¿™ä¸ªæ•°æ®å•å…ƒåï¼ŒåŠ ä¸Šæœ¬å±‚çš„æ§åˆ¶ä¿¡æ¯ H4ï¼Œå†äº¤ç»™ç½‘ç»œå±‚ï¼Œæˆä¸ºç½‘ç»œå±‚çš„æ•°æ®å•å…ƒ åˆ°äº†æ•°æ®é“¾è·¯å±‚ï¼Œæ§åˆ¶ä¿¡æ¯è¢«åˆ†æˆä¸¤éƒ¨åˆ†ï¼Œåˆ†åˆ«åŠ åˆ°æœ¬å±‚æ•°æ®å•å…ƒçš„é¦–éƒ¨ï¼ˆH2ï¼‰å’Œå°¾éƒ¨ï¼ˆT2ï¼‰ æœ€åçš„ç‰©ç†å±‚ï¼Œè¿›è¡Œæ¯”ç‰¹æµçš„ä¼ è¾“ è¿™ä¸ªè¿‡ç¨‹ç±»ä¼¼å†™ä¿¡ï¼Œå†™ä¸€å°ä¿¡ï¼Œæ¯åˆ°ä¸€å±‚ï¼Œå°±åŠ ä¸€ä¸ªä¿¡å°ï¼Œå†™ä¸€äº›åœ°å€çš„ä¿¡æ¯ã€‚åˆ°äº†ç›®çš„åœ°ä¹‹åï¼Œåˆä¸€å±‚å±‚è§£å°ï¼Œä¼ å‘ä¸‹ä¸€ä¸ªç›®çš„åœ°ã€‚ ç½‘ç»œç»¼åˆ4.ä»æµè§ˆå™¨åœ°å€æ è¾“å…¥ url åˆ°æ˜¾ç¤ºç½‘é¡µçš„è¿‡ç¨‹äº†è§£å—ï¼Ÿè¿™ä¸ªè¿‡ç¨‹åŒ…æ‹¬å¤šä¸ªæ­¥éª¤ï¼Œæ¶µç›–äº† DNS è§£æã€TCP è¿æ¥ã€å‘é€ HTTP è¯·æ±‚ã€æœåŠ¡å™¨å¤„ç†è¯·æ±‚å¹¶è¿”å› HTTP å“åº”ã€æµè§ˆå™¨å¤„ç†å“åº”å¹¶æ¸²æŸ“é¡µé¢ç­‰å¤šä¸ªç¯èŠ‚ã€‚ DNS è§£æï¼šæµè§ˆå™¨ä¼šå‘èµ·ä¸€ä¸ª DNS è¯·æ±‚åˆ° DNS æœåŠ¡å™¨ï¼Œå°†åŸŸåè§£æä¸ºæœåŠ¡å™¨çš„ IP åœ°å€ã€‚ TCP è¿æ¥ï¼šæµè§ˆå™¨é€šè¿‡è§£æå¾—åˆ°çš„ IP åœ°å€ä¸æœåŠ¡å™¨å»ºç«‹ TCP è¿æ¥ã€‚è¿™ä¸€æ­¥æ¶‰åŠåˆ° TCP çš„ä¸‰æ¬¡æ¡æ‰‹ï¼Œç”¨äºç¡®ä¿åŒæ–¹éƒ½å·²ç»å‡†å¤‡å¥½è¿›è¡Œæ•°æ®ä¼ è¾“äº†ã€‚ å‘é€ HTTP è¯·æ±‚ï¼šæµè§ˆå™¨æ„å»º HTTP è¯·æ±‚ï¼ŒåŒ…æ‹¬è¯·æ±‚è¡Œã€è¯·æ±‚å¤´å’Œè¯·æ±‚ä½“ï¼›ç„¶åå°†è¯·æ±‚å‘é€åˆ°æœåŠ¡å™¨ã€‚ æœåŠ¡å™¨å¤„ç†è¯·æ±‚ï¼šæœåŠ¡å™¨æ¥æ”¶åˆ° HTTP è¯·æ±‚åï¼Œæ ¹æ®è¯·æ±‚çš„èµ„æºè·¯å¾„ï¼Œç»è¿‡åç«¯å¤„ç†ï¼Œç”Ÿæˆ HTTP å“åº”æ¶ˆæ¯ï¼›å“åº”æ¶ˆæ¯åŒ…æ‹¬çŠ¶æ€è¡Œã€å“åº”å¤´å’Œå“åº”ä½“ã€‚ æµè§ˆå™¨æ¥æ”¶ HTTP å“åº”ï¼šæµè§ˆå™¨æ¥æ”¶åˆ°æœåŠ¡å™¨è¿”å›çš„ HTTP å“åº”æ•°æ®åï¼Œå¼€å§‹è§£æå“åº”ä½“ä¸­çš„ HTML å†…å®¹ï¼›ç„¶åæ„å»º DOM æ ‘ã€è§£æ CSS å’Œ JavaScript æ–‡ä»¶ç­‰ï¼Œæœ€ç»ˆæ¸²æŸ“é¡µé¢ã€‚ æ–­å¼€è¿æ¥ï¼šTCP å››æ¬¡æŒ¥æ‰‹ï¼Œè¿æ¥ç»“æŸã€‚ æˆ‘ä»¬ä»¥è¾“å…¥ www.baidu.com ä¸ºä¾‹ï¼š å„ä¸ªè¿‡ç¨‹éƒ½ä½¿ç”¨äº†å“ªäº›åè®®ï¼Ÿ 5.è¯´è¯´ DNS çš„è§£æè¿‡ç¨‹ï¼ŸDNS çš„å…¨ç§°æ˜¯ Domain Name Systemï¼Œä¹Ÿå°±æ˜¯åŸŸåè§£æç³»ç»Ÿï¼Œå®ƒå¯ä»¥å°†åŸŸåæ˜ å°„åˆ°å¯¹åº”çš„ IP åœ°å€ä¸Šï¼Œæ¯”å¦‚è¯´æˆ‘ä»¬è®¿é—® www.javabetter.cnï¼Œå®é™…ä¸Šè®¿é—®çš„æ˜¯æˆ‘åœ¨é˜¿é‡Œäº‘ä¸Šä¸€å°ä¸ç‰ˆæœåŠ¡å™¨ï¼Œå®ƒçš„ IP åœ°å€æ˜¯ xxx.xxx.xxx.xxxã€‚ å½“ç„¶äº†ï¼Œä¹Ÿå¯ä»¥é€šè¿‡ IP åœ°å€ç›´æ¥è®¿é—®æœåŠ¡å™¨ï¼Œä½†ä¸æ–¹ä¾¿è®°å¿†ï¼Œæ‰€ä»¥å°±æœ‰äº†åŸŸåç³»ç»Ÿã€‚ä¸€ä¸ªå¥½çš„åŸŸåå¯ä»¥å–å¥½å¤šå¥½å¤šé’±ï¼Œåƒ javabetter.cn è¿™ä¸ªåŸŸåï¼Œä¸€å¹´éœ€è¦ 39 å—é’±ã€‚ åŸŸååˆ° IP ä¹‹é—´çš„æ˜ å°„ï¼Œå°±éœ€è¦ DNS æ¥å®Œæˆã€‚ æˆ‘æ¥è¯´è¯´ DNS çš„è§£æè¿‡ç¨‹å§ï¼š å‡è®¾æˆ‘ä»¬åœ¨æµè§ˆå™¨åœ°å€æ é‡Œé”®å…¥äº† paicoding.comï¼š æµè§ˆå™¨ä¼šé¦–å…ˆæ£€æŸ¥è‡ªå·±çš„ç¼“å­˜ä¸­æ˜¯å¦æœ‰è¿™ä¸ªåŸŸåå¯¹åº”çš„ IP åœ°å€ï¼Œå¦‚æœæœ‰ï¼Œç›´æ¥è¿”å›ï¼›å¦‚æœæ²¡æœ‰ï¼Œè¿›å…¥ä¸‹ä¸€æ­¥ã€‚ æ£€æŸ¥æœ¬åœ° DNS ç¼“å­˜æ˜¯å¦æœ‰è¯¥åŸŸåçš„è®°å½•ã€‚å¦‚æœæ²¡æœ‰ï¼Œå‘æ ¹åŸŸåæœåŠ¡å™¨å‘é€è¯·æ±‚ï¼Œæ ¹åŸŸåæœåŠ¡å™¨å°†è¯·æ±‚æŒ‡å‘æ›´å…·ä½“çš„æœåŠ¡ï¼Œå¦‚ com é¡¶çº§åŸŸåæœåŠ¡å™¨ã€‚ é¡¶çº§åŸŸåæœåŠ¡å™¨å†å°†è¯·æ±‚æŒ‡å‘æƒé™åŸŸåæœåŠ¡å™¨ï¼Œé€šå¸¸ç”±åŸŸåæ³¨å†Œæœºæ„ç›´æ¥ç®¡ç†ï¼Œpaicoding.comæ˜¯åœ¨é˜¿é‡Œäº‘ä¸Šæ³¨å†Œçš„ï¼Œæ‰€ä»¥é˜¿é‡Œäº‘ä¼šæä¾›å¯¹åº”çš„ DNS è§£ææœåŠ¡ï¼Œå°†åŸŸåå’Œé˜¿é‡Œäº‘æœåŠ¡å™¨ç»‘å®šèµ·æ¥ã€‚ æœ€ç»ˆï¼Œæµè§ˆå™¨ä½¿ç”¨è·å¾—çš„ IP åœ°å€å‘èµ·ä¸€ä¸ª HTTP è¯·æ±‚åˆ°ç›®æ ‡æœåŠ¡å™¨ï¼Œç„¶åè¯¥æœåŠ¡å™¨è¿”å›æ‰€è¯·æ±‚çš„ç½‘é¡µå†…å®¹ã€‚ 6.è¯´è¯´ WebSocket ä¸ Socket çš„åŒºåˆ«ï¼Ÿ Socket å…¶å®å°±æ˜¯ç­‰äºÂ IP åœ°å€ + ç«¯å£ + åè®®ã€‚ å…·ä½“æ¥è¯´ï¼ŒSocket æ˜¯ä¸€å¥—æ ‡å‡†ï¼Œå®ƒå®Œæˆäº†å¯¹ TCPIP çš„é«˜åº¦å°è£…ï¼Œå±è”½ç½‘ç»œç»†èŠ‚ï¼Œä»¥æ–¹ä¾¿å¼€å‘è€…æ›´å¥½åœ°è¿›è¡Œç½‘ç»œç¼–ç¨‹ã€‚ WebSocket æ˜¯ä¸€ä¸ªæŒä¹…åŒ–çš„åè®®ï¼Œå®ƒæ˜¯ä¼´éš H5 è€Œå‡ºçš„åè®®ï¼Œç”¨æ¥è§£å†³Â http ä¸æ”¯æŒæŒä¹…åŒ–è¿æ¥çš„é—®é¢˜ã€‚ Socket ä¸€ä¸ªæ˜¯ç½‘ç¼–ç¼–ç¨‹çš„æ ‡å‡†æ¥å£ï¼Œè€Œ WebSocket åˆ™æ˜¯åº”ç”¨å±‚é€šä¿¡åè®®ã€‚ 7.è¯´ä¸€ä¸‹ä½ äº†è§£çš„ç«¯å£åŠå¯¹åº”çš„æœåŠ¡ï¼Ÿ 8.å¹³å¸¸æœ‰æŠ“åŒ…å—ï¼ˆè¡¥å……ï¼‰ï¼Ÿæˆ‘å¹³å¸¸ä½¿ç”¨æœ€å¤šçš„å°±æ˜¯ chrome æµè§ˆå™¨è‡ªå¸¦çš„ network é¢æ¿äº†ï¼Œå¯ä»¥çœ‹åˆ°è¯·æ±‚çš„æ—¶é—´ã€è¯·æ±‚çš„ä¿¡æ¯ï¼Œä»¥åŠå“åº”ä¿¡æ¯ã€‚ æ›´ä¸“ä¸šçš„è¿˜æœ‰ fidderã€wireshark ç­‰å·¥å…·ã€‚ HTTP8.è¯´è¯´ HTTP å¸¸ç”¨çš„çŠ¶æ€ç åŠå…¶å«ä¹‰ï¼ŸHTTP çŠ¶æ€ç ç”¨äºè¡¨ç¤ºæœåŠ¡å™¨å¯¹è¯·æ±‚çš„å¤„ç†ç»“æœï¼Œå¯ä»¥åˆ†ä¸º 5 ç§ï¼š 1xx æœåŠ¡å™¨æ”¶åˆ°è¯·æ±‚ï¼Œéœ€è¦è¿›ä¸€æ­¥æ“ä½œï¼Œä¾‹å¦‚ 100 Continueã€‚ 2xx è¯·æ±‚æˆåŠŸå¤„ç†ï¼Œä¾‹å¦‚ 200 OKã€‚ 3xx é‡å®šå‘ï¼šéœ€è¦è¿›ä¸€æ­¥æ“ä½œä»¥å®Œæˆè¯·æ±‚ï¼›ä¾‹å¦‚ 304 Not Modified è¡¨ç¤ºèµ„æºæœªä¿®æ”¹ï¼Œå®¢æˆ·ç«¯å¯ä»¥ä½¿ç”¨ç¼“å­˜ã€‚ 4xx å®¢æˆ·ç«¯é”™è¯¯ï¼šè¯·æ±‚æœ‰é—®é¢˜ï¼Œä¾‹å¦‚ 404 Not Found è¡¨ç¤ºèµ„æºä¸å­˜åœ¨ã€‚ 5xx æœåŠ¡å™¨é”™è¯¯ï¼Œä¾‹å¦‚500 Internal Server Error è¡¨ç¤ºæœåŠ¡å™¨å†…éƒ¨é”™è¯¯ã€‚ è¯´ä¸€ä¸‹ 301 å’Œ 302 çš„åŒºåˆ«ï¼Ÿ 301ï¼šæ°¸ä¹…æ€§ç§»åŠ¨ï¼Œè¯·æ±‚çš„èµ„æºå·²è¢«æ°¸ä¹…ç§»åŠ¨åˆ°æ–°ä½ç½®ã€‚æœåŠ¡å™¨è¿”å›æ­¤å“åº”æ—¶ï¼Œä¼šè¿”å›æ–°çš„èµ„æºåœ°å€ã€‚ 302ï¼šä¸´æ—¶æ€§æ€§ç§»åŠ¨ï¼ŒæœåŠ¡å™¨ä»å¦å¤–çš„åœ°å€å“åº”èµ„æºï¼Œä½†æ˜¯å®¢æˆ·ç«¯è¿˜åº”è¯¥ä½¿ç”¨è¿™ä¸ªåœ°å€ã€‚ ç”¨ä¸€ä¸ªæ¯”å–»ï¼Œ301 å°±æ˜¯å«äººçš„æ–°å£ç»“è¡£ï¼Œ302 å°±æ˜¯æœ‰ç”·æœ‹å‹çš„é•¿æ³½é›…ç¾ã€‚ 9.HTTP æœ‰å“ªäº›è¯·æ±‚æ–¹å¼ï¼ŸHTTP åè®®å®šä¹‰äº†å¤šç§è¯·æ±‚æ–¹å¼ï¼Œç”¨ä»¥æŒ‡ç¤ºè¯·æ±‚çš„ç›®çš„ã€‚å¸¸è§çš„è¯·æ±‚æ–¹å¼æœ‰ GETã€POSTã€DELETEã€PUTã€‚ GETï¼šè¯·æ±‚æ£€ç´¢æŒ‡å®šçš„èµ„æºã€‚åº”è¯¥åªç”¨äºè·å–æ•°æ®ï¼Œå¹¶ä¸”æ˜¯å¹‚ç­‰çš„ï¼Œå³å¤šæ¬¡æ‰§è¡Œç›¸åŒçš„ GET è¯·æ±‚åº”è¯¥è¿”å›ç›¸åŒçš„ç»“æœï¼Œå¹¶ä¸”ä¸ä¼šæ”¹å˜èµ„æºçš„çŠ¶æ€ã€‚ POSTï¼šå‘æŒ‡å®šèµ„æºæäº¤æ•°æ®ï¼Œè¯·æ±‚æœåŠ¡å™¨è¿›è¡Œå¤„ç†ï¼ˆå¦‚æäº¤è¡¨å•æˆ–ä¸Šä¼ æ–‡ä»¶ï¼‰ã€‚æ•°æ®è¢«åŒ…å«åœ¨è¯·æ±‚ä½“ä¸­ã€‚å¯èƒ½ä¼šåˆ›å»ºæ–°çš„èµ„æºæˆ–ä¿®æ”¹ç°æœ‰èµ„æºã€‚ DELETEï¼šåˆ é™¤æŒ‡å®šçš„èµ„æºã€‚ PUTï¼šç”¨äºæ›¿æ¢æŒ‡å®šçš„èµ„æºã€‚å¦‚æœæŒ‡å®šçš„èµ„æºä¸å­˜åœ¨ï¼Œåˆ›å»ºä¸€ä¸ªæ–°èµ„æºã€‚ HEADï¼šç±»ä¼¼äº GET è¯·æ±‚ï¼Œåªä¸è¿‡è¿”å›çš„å“åº”ä¸­æ²¡æœ‰å…·ä½“çš„å†…å®¹ï¼Œç”¨äºè·å–æŠ¥å¤´ã€‚å¯ä»¥ç”¨äºæ£€æŸ¥èµ„æºæ˜¯å¦å­˜åœ¨ï¼ŒéªŒè¯èµ„æºçš„æ›´æ–°æ—¶é—´ç­‰ã€‚ OPTIONSï¼šç”¨äºè·å–æœåŠ¡å™¨æ”¯æŒçš„ HTTP è¯·æ±‚æ–¹æ³•ã€‚é€šå¸¸ç”¨äºè·¨åŸŸè¯·æ±‚ä¸­çš„é¢„æ£€è¯·æ±‚ï¼ˆCORSï¼‰ã€‚ TRACEï¼šå›æ˜¾æœåŠ¡å™¨æ”¶åˆ°çš„è¯·æ±‚ï¼Œä¸»è¦ç”¨äºæµ‹è¯•æˆ–è¯Šæ–­ã€‚ä½†ç”±äºå®‰å…¨é£é™©ï¼ˆå¯èƒ½æš´éœ²æ•æ„Ÿä¿¡æ¯ï¼‰ï¼Œå¾ˆå¤šæœåŠ¡å™¨ä¼šç¦ç”¨ TRACE è¯·æ±‚ã€‚ CONNECTï¼šå»ºç«‹ä¸€ä¸ªåˆ°ç›®æ ‡èµ„æºçš„éš§é“ï¼ˆé€šå¸¸ç”¨äº SSLTLS ä»£ç†ï¼‰ï¼Œç”¨äºåœ¨å®¢æˆ·ç«¯å’ŒæœåŠ¡å™¨ä¹‹é—´è¿›è¡ŒåŠ å¯†çš„éš§é“ä¼ è¾“ã€‚ HTTP çš„ GET æ–¹æ³•å¯ä»¥å®ç°å†™æ“ä½œå—?å¯ä»¥æ˜¯å¯ä»¥ï¼Œä½†æ˜¯ä¸æ¨èã€‚ ä½¿ç”¨ GET æ‰§è¡Œå†™æ“ä½œå¯èƒ½å¯¼è‡´ä¸¥é‡çš„å®‰å…¨é—®é¢˜ï¼Œå¦‚è·¨ç«™è¯·æ±‚ä¼ªé€ ï¼ˆCSRFï¼‰ã€‚å®é™…å¼€å‘ä¸­ï¼Œä¹Ÿåº”è¯¥æœç»ä½¿ç”¨ GET æ–¹æ³•æ‰§è¡Œå†™æ“ä½œã€‚é€šè¿‡åœ¨é¡¹ç›®æ¥å£ä¸Šæ˜ç¡®æŒ‡å‡ºéœ€è¦çš„è¯·æ±‚æ–¹å¼. å®¢æˆ·ç«¯ä¸€æ—¦ä½¿ç”¨é”™è¯¯âï¼Œå°†ä¼šæ”¶åˆ°ä¸€ä¸ª 405 Method Not Allowed çš„å“åº”ã€‚ ä»€ä¹ˆæ˜¯å¹‚ç­‰ï¼Ÿå¹‚ç­‰æ–¹æ³•äº†è§£å“ªäº›ï¼Ÿå¹‚ç­‰ï¼ˆIdempotenceï¼‰æ˜¯ä¸€ä¸ªæ•°å­¦æ¦‚å¿µï¼Œç”¨äºæè¿°æŸäº›æ“ä½œçš„ç‰¹æ€§ï¼Œå³æ— è®ºæ“ä½œæ‰§è¡Œå¤šå°‘æ¬¡ï¼Œç»“æœéƒ½æ˜¯ç›¸åŒçš„ã€‚æ¢å¥è¯è¯´ï¼Œå¹‚ç­‰æ“ä½œå¯ä»¥é‡å¤æ‰§è¡Œè€Œä¸ä¼šæ”¹å˜ç³»ç»ŸçŠ¶æ€ã€‚ å¦‚æœä¸€ä¸ªæ“ä½œæ˜¯å¹‚ç­‰çš„ï¼Œé‚£ä¹ˆå¯¹åŒä¸€èµ„æºæ‰§è¡Œè¯¥æ“ä½œä¸€æ¬¡å’Œæ‰§è¡Œå¤šæ¬¡çš„æ•ˆæœç›¸åŒã€‚ åœ¨æ­£ç¡®å®ç°çš„æ¡ä»¶ä¸‹ï¼ŒGETã€HEADã€PUTå’Œ DELETE ç­‰æ–¹æ³•éƒ½æ˜¯å¹‚ç­‰çš„ï¼Œè€Œ POST æ–¹æ³•ä¸æ˜¯ã€‚ ä¾‹å¦‚ï¼ŒGET /pageX HTTP/1.1Â å¹‚ç­‰çš„ã€‚è¿ç»­è°ƒç”¨å¤šæ¬¡ï¼Œå®¢æˆ·ç«¯æ¥æ”¶åˆ°çš„ç»“æœéƒ½æ˜¯ä¸€æ ·çš„ï¼š GET /pageX HTTP/1.1GET /pageX HTTP/1.1GET /pageX HTTP/1.1 DELETE /idX/delete HTTP/1.1Â æ˜¯å¹‚ç­‰çš„ï¼Œå³ä¾¿æ˜¯ä¸åŒè¯·æ±‚ä¹‹é—´æ¥æ”¶åˆ°çš„çŠ¶æ€ç ä¸ä¸€æ ·ï¼š DELETE /idX/delete HTTP/1.1 - Returns 200 if idX existsDELETE /idX/delete HTTP/1.1 - Returns 404 as it just got deletedDELETE /idX/delete HTTP/1.1 - Returns 404 10.è¯´â¼€ä¸‹ GET å’Œ POST çš„åŒºåˆ«ï¼Ÿ GET è¯·æ±‚ä¸»è¦ç”¨äºè·å–æ•°æ®ï¼Œå‚æ•°é™„åŠ åœ¨ URL ä¸­ï¼Œå­˜åœ¨é•¿åº¦é™åˆ¶ï¼Œä¸”å®¹æ˜“è¢«æµè§ˆå™¨ç¼“å­˜ï¼Œæœ‰å®‰å…¨é£é™©ï¼›POST è¯·æ±‚ç”¨äºæäº¤æ•°æ®ï¼Œå‚æ•°æ”¾åœ¨è¯·æ±‚ä½“ä¸­ï¼Œé€‚åˆæäº¤å¤§é‡æˆ–æ•æ„Ÿçš„æ•°æ®ã€‚ å¦å¤–ï¼ŒGET è¯·æ±‚æ˜¯å¹‚ç­‰çš„ï¼Œå¤šæ¬¡è¯·æ±‚ä¸ä¼šæ”¹å˜æœåŠ¡å™¨çŠ¶æ€ï¼›è€Œ POST è¯·æ±‚ä¸æ˜¯å¹‚ç­‰çš„ï¼Œå¯èƒ½å¯¹æœåŠ¡å™¨æ•°æ®æœ‰å½±å“ã€‚ 11.GET çš„é•¿åº¦é™åˆ¶æ˜¯å¤šå°‘ï¼ŸHTTP ä¸­çš„ GET æ–¹æ³•æ˜¯é€šè¿‡ URL ä¼ é€’æ•°æ®çš„ï¼Œä½†æ˜¯ URL æœ¬èº«å…¶å®å¹¶æ²¡æœ‰å¯¹æ•°æ®çš„é•¿åº¦è¿›è¡Œé™åˆ¶ï¼ŒçœŸæ­£é™åˆ¶ GET é•¿åº¦çš„æ˜¯æµè§ˆå™¨ã€‚ ä¾‹å¦‚ IE æµè§ˆå™¨å¯¹ URL çš„æœ€å¤§é™åˆ¶æ˜¯ 2000 å¤šä¸ªå­—ç¬¦ï¼Œå¤§æ¦‚ 2kb å·¦å³ï¼Œåƒ Chromeã€Firefox ç­‰æµè§ˆå™¨æ”¯æŒçš„ URL å­—ç¬¦æ•°æ›´å¤šï¼Œå…¶ä¸­ FireFox ä¸­ URL çš„æœ€å¤§é•¿åº¦é™åˆ¶æ˜¯ 65536 ä¸ªå­—ç¬¦ï¼ŒChrome åˆ™æ˜¯ 8182 ä¸ªå­—ç¬¦ã€‚ è¿™ä¸ªé•¿åº¦é™åˆ¶ä¹Ÿä¸æ˜¯é’ˆå¯¹æ•°æ®éƒ¨åˆ†ï¼Œè€Œæ˜¯é’ˆå¯¹æ•´ä¸ª URLã€‚ 12.HTTP è¯·æ±‚çš„è¿‡ç¨‹ä¸åŸç†ï¼ŸHTTP æ˜¯åŸºäº TCP/IP åè®®çš„åº”ç”¨å±‚åè®®ï¼Œå®ƒä½¿ç”¨ TCP ä½œä¸ºä¼ è¾“å±‚åè®®ï¼Œé€šè¿‡å»ºç«‹ TCP è¿æ¥æ¥ä¼ è¾“æ•°æ®ã€‚HTTP éµå¾ªæ ‡å‡†çš„å®¢æˆ·ç«¯-æœåŠ¡å™¨æ¨¡å‹ï¼Œå®¢æˆ·ç«¯æ‰“å¼€è¿æ¥å‘å‡ºè¯·æ±‚ï¼Œç„¶åç­‰å¾…æœåŠ¡å™¨è¿”å›çš„å“åº”ã€‚ åœ¨æµè§ˆå™¨è¾“å…¥ URL åï¼Œæµè§ˆå™¨é¦–å…ˆä¼šé€šè¿‡ DNS è§£æè·å–åˆ°æœåŠ¡å™¨çš„ IP åœ°å€ï¼Œç„¶åä¸æœåŠ¡å™¨å»ºç«‹ TCP è¿æ¥ã€‚ TCP è¿æ¥å»ºç«‹åï¼Œæµè§ˆå™¨ä¼šå‘æœåŠ¡å™¨å‘é€ HTTP è¯·æ±‚ã€‚ æœåŠ¡å™¨æ”¶åˆ°è¯·æ±‚åï¼Œä¼šæ ¹æ®è¯·æ±‚çš„ä¿¡æ¯å¤„ç†è¯·æ±‚ã€‚ å¤„ç†å®Œè¯·æ±‚åï¼ŒæœåŠ¡å™¨ä¼šè¿”å›ä¸€ä¸ª HTTP å“åº”ç»™æµè§ˆå™¨ã€‚ æµè§ˆå™¨æ”¶åˆ°å“åº”åï¼Œä¼šæ ¹æ®å“åº”çš„ä¿¡æ¯æ¸²æŸ“é¡µé¢ã€‚ç„¶åï¼Œæµè§ˆå™¨å’ŒæœåŠ¡å™¨æ–­å¼€ TCP è¿æ¥ã€‚ å®¢æˆ·ç«¯å‘é€ä¸€ä¸ªè¯·æ±‚åˆ°æœåŠ¡å™¨ï¼ŒæœåŠ¡å™¨å¤„ç†è¯·æ±‚å¹¶è¿”å›ä¸€ä¸ªå“åº”ã€‚è¿™ä¸ªè¿‡ç¨‹æ˜¯åŒæ­¥çš„ï¼Œä¹Ÿå°±æ˜¯è¯´ï¼Œå®¢æˆ·ç«¯åœ¨å‘é€è¯·æ±‚åå¿…é¡»ç­‰å¾…æœåŠ¡å™¨çš„å“åº”ã€‚åœ¨ç­‰å¾…å“åº”çš„è¿‡ç¨‹ä¸­ï¼Œå®¢æˆ·ç«¯ä¸ä¼šå‘é€å…¶ä»–è¯·æ±‚ã€‚ æ€ä¹ˆåˆ©ç”¨å¤šçº¿ç¨‹æ¥ä¸‹è½½ä¸€ä¸ªæ•°æ®å‘¢ï¼Ÿå¯ä»¥é‡‡å–åˆ†å—ä¸‹è½½çš„ç­–ç•¥ã€‚é¦–å…ˆï¼Œé€šè¿‡ HEAD è¯·æ±‚è·å–æ–‡ä»¶çš„æ€»å¤§å°ã€‚ç„¶åæ ¹æ®æ–‡ä»¶å¤§å°å’Œçº¿ç¨‹æ•°ï¼Œå°†æ–‡ä»¶è¿›è¡Œåˆ‡å‰²ã€‚æ¯ä¸ªçº¿ç¨‹è´Ÿè´£ä¸‹è½½ä¸€ä¸ªç‰¹å®šèŒƒå›´çš„æ•°æ®ã€‚ å¯ä»¥é€šè¿‡è®¾ç½® HTTP è¯·æ±‚å¤´çš„ Range å­—æ®µæŒ‡å®šä¸‹è½½çš„å­—èŠ‚åŒºé—´ã€‚ä¾‹å¦‚ï¼ŒRange: bytes0-1023 è¡¨ç¤ºä¸‹è½½æ–‡ä»¶çš„å‰ 1024 å­—èŠ‚ã€‚ æœ€åå¯åŠ¨å¤šçº¿ç¨‹ä¸‹è½½ã€‚ ä»£ç ç‰‡æ®µ 1ï¼šè·å–æ–‡ä»¶å¤§å° URL url = new URL(https://javabetter.cn/file.zip);HttpURLConnection connection = (HttpURLConnection) url.openConnection();connection.setRequestMethod(HEAD);int fileSize = connection.getContentLength(); // è·å–æ–‡ä»¶å¤§å°connection.disconnect(); ä»£ç ç‰‡æ®µ 2ï¼šä¸‹è½½æ–‡ä»¶ public void downloadChunk(String url, int start, int end, String outputPath) try URL fileUrl = new URL(url); HttpURLConnection connection = (HttpURLConnection) fileUrl.openConnection(); connection.setRequestProperty(Range, bytes= + start + - + end); InputStream inputStream = connection.getInputStream(); RandomAccessFile file = new RandomAccessFile(outputPath, rw); file.seek(start); // å®šä½åˆ°æ–‡ä»¶çš„ç›¸åº”ä½ç½® byte[] buffer = new byte[1024]; int bytesRead; while ((bytesRead = inputStream.read(buffer)) != -1) file.write(buffer, 0, bytesRead); file.close(); inputStream.close(); connection.disconnect(); catch (IOException e) e.printStackTrace(); ä»£ç ç‰‡æ®µ 3ï¼šå¯åŠ¨å¤šçº¿ç¨‹ä¸‹è½½ int numThreads = 4;int fileSize = 100000000; // å‡è®¾æ–‡ä»¶å¤§å°ä¸º 100MBint chunkSize = fileSize / numThreads;String url = https://javabetter.cn/file.zip;String outputPath = path/to/local/file.zip;ExecutorService executor = Executors.newFixedThreadPool(numThreads);for (int i = 0; i numThreads; i++) int start = i * chunkSize; int end = (i == numThreads - 1) ? fileSize - 1 : (start + chunkSize - 1); executor.execute(() - downloadChunk(url, start, end, outputPath));executor.shutdown(); å¦‚æœåªè¦ä¸‹è½½æ•°æ®çš„å‰åä¸ªå­—èŠ‚å‘¢ï¼Ÿåªéœ€è¦è®¾ç½® Range å­—æ®µä¸º Range: bytes0-9 å³å¯ã€‚ 13.è¯´ä¸€ä¸‹ HTTP çš„æŠ¥æ–‡ç»“æ„ï¼ŸHTTP çš„æŠ¥æ–‡ç»“æ„åˆ†ä¸ºï¼šè¯·æ±‚æŠ¥æ–‡å’Œå“åº”æŠ¥æ–‡ã€‚ä¸¤è€…åœ¨ç»“æ„ä¸Šå¾ˆç›¸ä¼¼ï¼Œéƒ½åŒ…å«äº†èµ·å§‹è¡Œã€å¤´éƒ¨å’Œæ¶ˆæ¯æ­£æ–‡ã€‚ è¯´ä¸‹ HTTP çš„è¯·æ±‚æŠ¥æ–‡ç»“æ„ï¼Ÿè¯·æ±‚æŠ¥æ–‡ç”±è¯·æ±‚è¡Œã€è¯·æ±‚å¤´éƒ¨ã€ç©ºè¡Œå’Œæ¶ˆæ¯æ­£æ–‡ç»„æˆã€‚å¦‚ä¸‹æ‰€ç¤ºï¼š GETÂ /index.htmlÂ HTTP/1.1Host:Â www.javabetter.cnAccept:Â text/htmlUser-Agent:Â Mozilla/5.0Â (WindowsÂ NTÂ 10.0;Â Win64;Â x64)Â AppleWebKit/537.36Â (KHTML,Â likeÂ Gecko)Â Chrome/58.0.3029.110Â Safari/537.3 â‘ ã€è¯·æ±‚è¡ŒåŒ…æ‹¬è¯·æ±‚æ–¹æ³•ã€è¯·æ±‚ URL å’Œ HTTP åè®®çš„ç‰ˆæœ¬ã€‚ä¾‹å¦‚ï¼šGET /index.html HTTP/1.1ã€‚ â‘¡ã€è¯·æ±‚å¤´éƒ¨åŒ…å«è¯·æ±‚çš„é™„åŠ ä¿¡æ¯ï¼Œå¦‚å®¢æˆ·ç«¯æƒ³è¦æ¥æ”¶çš„å†…å®¹ç±»å‹ã€æµè§ˆå™¨ç±»å‹ç­‰ã€‚ä¾‹å¦‚ï¼š Host: www.javabetter.cnï¼Œè¡¨ç¤ºè¯·æ±‚çš„ä¸»æœºåï¼ˆåŸŸåï¼‰ Accept:Â text/htmlï¼Œè¡¨ç¤ºå®¢æˆ·ç«¯å¯ä»¥æ¥æ”¶çš„åª’ä½“ç±»å‹ User-Agent: Mozilla/5.0ï¼Œè¡¨ç¤ºå®¢æˆ·ç«¯çš„æµè§ˆå™¨ç±»å‹ Rangeï¼šç”¨äºæŒ‡å®šè¯·æ±‚å†…å®¹çš„èŒƒå›´ï¼Œå¦‚æ–­ç‚¹ç»­ä¼ æ—¶è¡¨ç¤ºè¯·æ±‚çš„å­—èŠ‚èŒƒå›´ã€‚ â‘¢ã€è¯·æ±‚å¤´éƒ¨å’Œæ¶ˆæ¯æ­£æ–‡ä¹‹é—´æœ‰ä¸€ä¸ªç©ºè¡Œï¼Œè¡¨ç¤ºè¯·æ±‚å¤´éƒ¨ç»“æŸã€‚ â‘£ã€æ¶ˆæ¯æ­£æ–‡æ˜¯å¯é€‰çš„ï¼Œå¦‚ POST è¯·æ±‚ä¸­çš„è¡¨å•æ•°æ®ï¼›GET è¯·æ±‚ä¸­æ²¡æœ‰æ¶ˆæ¯æ­£æ–‡ã€‚ è¯´ä¸‹ HTTP å“åº”æŠ¥æ–‡ç»“æ„ï¼ŸHTTP/1.0Â 200Â OKContent-Type:Â text/plainContent-Length:Â 137582Expires:Â Thu,Â 05Â DecÂ 1997Â 16:00:00Â GMTLast-Modified:Â Wed,Â 5Â AugustÂ 1996Â 15:55:28Â GMTServer:Â ApacheÂ 0.84html bodyJakicDong/body/html â‘ ã€çŠ¶æ€è¡ŒåŒ…æ‹¬ HTTP åè®®çš„ç‰ˆæœ¬ã€çŠ¶æ€ç ï¼ˆå¦‚ 200ã€404ï¼‰å’ŒçŠ¶æ€æ¶ˆæ¯ï¼ˆå¦‚ OKã€NotFoundï¼‰ã€‚ä¾‹å¦‚ï¼šHTTP/1.0 200 OKã€‚ â‘¡ã€å“åº”å¤´éƒ¨åŒ…å«å“åº”çš„é™„åŠ ä¿¡æ¯ï¼Œå¦‚æœåŠ¡å™¨ç±»å‹ã€å†…å®¹ç±»å‹ã€å†…å®¹é•¿åº¦ç­‰ã€‚ä¹Ÿæ˜¯é”®å€¼å¯¹ï¼Œä¾‹å¦‚ï¼š Content-Type: text/plainï¼Œè¡¨ç¤ºå“åº”çš„å†…å®¹ç±»å‹ Content-Length: 137582ï¼Œè¡¨ç¤ºå“åº”çš„å†…å®¹é•¿åº¦ Expires: Thu, 05 Dec 1997 16:00:00 GMTï¼Œè¡¨ç¤ºèµ„æºçš„è¿‡æœŸæ—¶é—´ Last-Modified: Wed, 5 August 1996 15:55:28 GMTï¼Œè¡¨ç¤ºèµ„æºçš„æœ€åä¿®æ”¹æ—¶é—´ Server: Apache 0.84ï¼Œè¡¨ç¤ºæœåŠ¡å™¨ç±»å‹ â‘¢ã€ç©ºè¡Œè¡¨ç¤ºå“åº”å¤´éƒ¨ç»“æŸã€‚ â‘£ã€æ¶ˆæ¯æ­£æ–‡ï¼ˆå¯é€‰ï¼‰å“åº”çš„å…·ä½“å†…å®¹ï¼Œå¦‚ HTML é¡µé¢ã€‚ä¸æ˜¯æ‰€æœ‰çš„å“åº”éƒ½æœ‰æ¶ˆæ¯æ­£æ–‡ï¼Œå¦‚ 204 No Content çŠ¶æ€ç çš„å“åº”ã€‚ 14.URI å’Œ URL æœ‰ä»€ä¹ˆåŒºåˆ«? URIï¼Œç»Ÿä¸€èµ„æºæ ‡è¯†ç¬¦(Uniform Resource Identifierï¼Œ URI)ï¼Œæ ‡è¯†çš„æ˜¯ Web ä¸Šæ¯ä¸€ç§å¯ç”¨çš„èµ„æºï¼Œå¦‚ HTML æ–‡æ¡£ã€å›¾åƒã€è§†é¢‘ç‰‡æ®µã€ç¨‹åºç­‰éƒ½æ˜¯ç”±ä¸€ä¸ª URI è¿›è¡Œæ ‡è¯†çš„ã€‚ URLï¼Œç»Ÿä¸€èµ„æºå®šä½ç¬¦ï¼ˆUniform Resource Locationï¼‰ï¼Œå®ƒæ˜¯ URI çš„ä¸€ç§å­é›†ï¼Œä¸»è¦ä½œç”¨æ˜¯æä¾›èµ„æºçš„è·¯å¾„ã€‚ å®ƒä»¬çš„ä¸»è¦åŒºåˆ«åœ¨äºï¼ŒURL é™¤äº†æä¾›äº†èµ„æºçš„æ ‡è¯†ï¼Œè¿˜æä¾›äº†èµ„æºè®¿é—®çš„æ–¹å¼ã€‚è¿™ä¹ˆæ¯”å–»ï¼ŒURI åƒæ˜¯èº«ä»½è¯ï¼Œå¯ä»¥å”¯ä¸€æ ‡è¯†ä¸€ä¸ªäººï¼Œè€Œ URL æ›´åƒä¸€ä¸ªä½å€ï¼Œå¯ä»¥é€šè¿‡ URL æ‰¾åˆ°è¿™ä¸ªäººâ€”â€”äººç±»ä½å€åè®®:åœ°çƒä¸­å›½åŒ—äº¬å¸‚æµ·æ·€åŒºxx èŒä¸šæŠ€æœ¯å­¦é™¢14 å·å®¿èˆæ¥¼525 å·å¯å¼ ä¸‰.ç”·ã€‚ 15.è¯´ä¸‹ HTTP1.0ï¼Œ1.1ï¼Œ2.0 çš„åŒºåˆ«ï¼ŸHTTP1.0 é»˜è®¤æ˜¯çŸ­è¿æ¥ï¼ŒHTTP 1.1 é»˜è®¤æ˜¯é•¿è¿æ¥ï¼ŒHTTP 2.0 é‡‡ç”¨çš„å¤šè·¯å¤ç”¨ã€‚ è¯´ä¸‹ HTTP1.0 æ— çŠ¶æ€åè®®ï¼šHTTP 1.0 æ˜¯æ— çŠ¶æ€çš„ï¼Œæ¯ä¸ªè¯·æ±‚ä¹‹é—´ç›¸äº’ç‹¬ç«‹ï¼ŒæœåŠ¡å™¨ä¸ä¿å­˜ä»»ä½•è¯·æ±‚çš„çŠ¶æ€ä¿¡æ¯ã€‚ éæŒä¹…è¿æ¥ï¼šé»˜è®¤æƒ…å†µä¸‹ï¼Œæ¯ä¸ª HTTP è¯·æ±‚å“åº”å¯¹ä¹‹åï¼Œè¿æ¥ä¼šè¢«å…³é—­ï¼Œå±äºçŸ­è¿æ¥ã€‚è¿™æ„å‘³ç€å¯¹äºåŒä¸€ä¸ªç½‘ç«™çš„æ¯ä¸ªèµ„æºè¯·æ±‚ï¼Œå¦‚ HTML é¡µé¢ä¸Šçš„å›¾ç‰‡å’Œè„šæœ¬ï¼Œéƒ½éœ€è¦å»ºç«‹ä¸€ä¸ªæ–°çš„ TCP è¿æ¥ã€‚å¯ä»¥è®¾ç½®Connection: keep-aliveÂ å¼ºåˆ¶å¼€å¯é•¿è¿æ¥ã€‚ è¯´ä¸‹ HTTP1.1 æŒä¹…è¿æ¥ï¼šHTTP 1.1 å¼•å…¥äº†æŒä¹…è¿æ¥ï¼ˆä¹Ÿç§°ä¸º HTTP keep-aliveï¼‰ï¼Œé»˜è®¤æƒ…å†µä¸‹ä¸ä¼šç«‹å³å…³é—­è¿æ¥ï¼Œå¯ä»¥åœ¨ä¸€ä¸ªè¿æ¥ä¸Šå‘é€å¤šä¸ªè¯·æ±‚å’Œå“åº”ã€‚æå¤§å‡è½»äº† TCP è¿æ¥çš„å¼€é”€ã€‚ æµæ°´çº¿å¤„ç†ï¼šHTTP 1.1 æ”¯æŒå®¢æˆ·ç«¯åœ¨å‰ä¸€ä¸ªè¯·æ±‚çš„å“åº”åˆ°è¾¾ä¹‹å‰å‘é€ä¸‹ä¸€ä¸ªè¯·æ±‚ï¼Œä»¥æé«˜ä¼ è¾“æ•ˆç‡ã€‚ è¯´ä¸‹ HTTP2.0 äºŒè¿›åˆ¶åè®®ï¼šHTTP 2.0 ä½¿ç”¨äºŒè¿›åˆ¶è€Œä¸æ˜¯æ–‡æœ¬æ ¼å¼æ¥ä¼ è¾“æ•°æ®ï¼Œè§£ææ›´åŠ é«˜æ•ˆã€‚ å¤šè·¯å¤ç”¨ï¼šä¸€ä¸ª TCP è¿æ¥ä¸Šå¯ä»¥åŒæ—¶è¿›è¡Œå¤šä¸ª HTTP è¯·æ±‚å“åº”ï¼Œè§£å†³äº† HTTP 1.x çš„é˜Ÿå¤´é˜»å¡é—®é¢˜ã€‚ å¤´éƒ¨å‹ç¼©ï¼šHTTP åè®®ä¸å¸¦çŠ¶æ€ï¼Œæ‰€ä»¥æ¯æ¬¡è¯·æ±‚éƒ½å¿…é¡»é™„ä¸Šæ‰€æœ‰ä¿¡æ¯ã€‚HTTP 2.0 å¼•å…¥äº†å¤´éƒ¨å‹ç¼©æœºåˆ¶ï¼Œå¯ä»¥ä½¿ç”¨ gzip æˆ– compress å‹ç¼©åå†å‘é€ï¼Œå‡å°‘äº†å†—ä½™å¤´éƒ¨ä¿¡æ¯çš„å¸¦å®½æ¶ˆè€—ã€‚ æœåŠ¡ç«¯æ¨é€ï¼šæœåŠ¡å™¨å¯ä»¥ä¸»åŠ¨å‘å®¢æˆ·ç«¯æ¨é€èµ„æºï¼Œè€Œä¸éœ€è¦å®¢æˆ·ç«¯æ˜ç¡®è¯·æ±‚ã€‚ 16.HTTP3 äº†è§£å—ï¼ŸHTTP/2.0 åŸºäº TCP åè®®ï¼Œè€Œ HTTP/3.0 åˆ™åŸºäº QUIC åè®®ï¼ŒQuick UDP Connectionsï¼Œç›´è¯‘ä¸ºå¿«é€Ÿ UDP ç½‘ç»œè¿æ¥ã€‚ åŸºäº TCP çš„ HTTP2.0ï¼Œå°½ç®¡ä»é€»è¾‘ä¸Šæ¥è¯´ï¼Œä¸åŒçš„æµä¹‹é—´ç›¸äº’ç‹¬ç«‹ï¼Œä¸ä¼šç›¸äº’å½±å“ï¼Œä½†åœ¨å®é™…ä¼ è¾“çš„è¿‡ç¨‹ä¸­ï¼Œæ•°æ®è¿˜æ˜¯è¦ä¸€å¸§ä¸€å¸§çš„å‘é€å’Œæ¥æ”¶ï¼Œä¸€æ—¦æŸä¸€ä¸ªæµçš„æ•°æ®æœ‰ä¸¢åŒ…ï¼Œä»ç„¶ä¼šé˜»å¡åœ¨å®ƒä¹‹åä¼ è¾“çš„æµæ•°æ®ã€‚ è€ŒåŸºäº UDP çš„ QUIC åè®®å¯ä»¥æ›´å½»åº•åœ°è§£å†³è¿™æ ·çš„é—®é¢˜ï¼Œè®©ä¸åŒçš„æµä¹‹é—´çœŸæ­£çš„å®ç°ç›¸äº’ç‹¬ç«‹ä¼ è¾“ï¼Œäº’ä¸å¹²æ‰°ã€‚ åŒæ—¶ï¼ŒQUIC åè®®åœ¨ä¼ è¾“çš„è¿‡ç¨‹ä¸­å°±å®Œæˆäº† TLS åŠ å¯†æ¡æ‰‹ï¼Œæ›´ç›´æ¥äº†ã€‚ ç›®å‰ä½¿ç”¨æœ€å¹¿æ³›çš„æ˜¯å“ªä¸ªHTTPç‰ˆæœ¬ï¼Ÿåº”è¯¥æ˜¯ HTTP2ï¼Œåœ¨ 2022 å¹´ 1 æœˆè¾¾åˆ°å³°å€¼ï¼Œå æ‰€æœ‰ç½‘ç«™çš„ 46.9%ã€‚ ç»Ÿè®¡ç½‘ç«™ï¼šw3techs 17.HTTP é•¿è¿æ¥äº†è§£å—ï¼Ÿåœ¨ HTTP ä¸­ï¼Œé•¿è¿æ¥æ˜¯æŒ‡å®¢æˆ·ç«¯å’ŒæœåŠ¡å™¨ä¹‹é—´åœ¨ä¸€æ¬¡ HTTP é€šä¿¡å®Œæˆåï¼Œä¸ä¼šç«‹å³æ–­å¼€ï¼Œè€Œæ˜¯ä¿ç•™è¿æ¥ä»¥ä¾›åç»­è¯·æ±‚å¤ç”¨ã€‚è¿™ç§æœºåˆ¶å¯ä»¥å‡å°‘äº†é¢‘ç¹å»ºç«‹å’Œå…³é—­è¿æ¥çš„å¼€é”€ å¦‚ä½•è®¾ç½®é•¿è¿æ¥ï¼Ÿå¯ä»¥é€šè¿‡ Connection: keep-alive å®ç°ã€‚åœ¨ HTTP/1.1 ä¸­ï¼Œé•¿è¿æ¥æ˜¯é»˜è®¤å¼€å¯çš„ã€‚ åœ¨ä»€ä¹ˆæ—¶å€™ä¼šè¶…æ—¶å‘¢ï¼Ÿ HTTP ä¸€èˆ¬ä¼šæœ‰ httpd å®ˆæŠ¤è¿›ç¨‹ï¼Œé‡Œé¢å¯ä»¥è®¾ç½® keep-alive timeoutï¼Œå½“ tcp è¿æ¥é—²ç½®è¶…è¿‡è¿™ä¸ªæ—¶é—´å°±ä¼šå…³é—­ï¼Œä¹Ÿå¯ä»¥åœ¨ HTTP çš„ header é‡Œé¢è®¾ç½®è¶…æ—¶æ—¶é—´ TCP çš„ keep-alive åŒ…å«ä¸‰ä¸ªå‚æ•°ï¼Œæ”¯æŒåœ¨ç³»ç»Ÿå†…æ ¸çš„ net.ipv4 é‡Œé¢è®¾ç½®ï¼›å½“ TCP è¿æ¥ä¹‹åï¼Œé—²ç½®äº† tcp_keepalive_timeï¼Œåˆ™ä¼šå‘ç”Ÿä¾¦æµ‹åŒ…ï¼Œå¦‚æœæ²¡æœ‰æ”¶åˆ°å¯¹æ–¹çš„ ACKï¼Œé‚£ä¹ˆä¼šæ¯éš” tcp_keepalive_intvl å†å‘ä¸€æ¬¡ï¼Œç›´åˆ°å‘é€äº† tcp_keepalive_probesï¼Œå°±ä¼šä¸¢å¼ƒè¯¥è¿æ¥ã€‚ 1. tcp_keepalive_intvl = 152. tcp_keepalive_probes = 53. tcp_keepalive_time = 1800 18.è¯´è¯´ HTTP ä¸ HTTPS æœ‰å“ªäº›åŒºåˆ«ï¼ŸHTTPS æ˜¯ HTTP çš„å¢å¼ºç‰ˆï¼Œåœ¨ HTTP çš„åŸºç¡€ä¸ŠåŠ å…¥äº† SSL/TLS åè®®ï¼Œç¡®ä¿æ•°æ®åœ¨ä¼ è¾“è¿‡ç¨‹ä¸­æ˜¯åŠ å¯†çš„ã€‚ HTTP çš„é»˜è®¤ç«¯â¼å·æ˜¯ 80ï¼ŒURL ä»¥http://å¼€å¤´ï¼›HTTPS çš„é»˜è®¤ç«¯â¼å·æ˜¯ 443ï¼ŒURL ä»¥https://å¼€å¤´ã€‚ 19.ä¸ºä»€ä¹ˆè¦ç”¨ HTTPSï¼ŸHTTP æ˜¯æ˜æ–‡ä¼ è¾“çš„ï¼Œå­˜åœ¨æ•°æ®çªƒå¬ã€æ•°æ®ç¯¡æ”¹å’Œèº«ä»½ä¼ªé€ ç­‰é—®é¢˜ã€‚è€Œ HTTPS é€šè¿‡å¼•å…¥ SSL/TLSï¼Œè§£å†³äº†è¿™äº›é—®é¢˜ã€‚ SSL/TLS åœ¨åŠ å¯†è¿‡ç¨‹ä¸­æ¶‰åŠåˆ°äº†ä¸¤ç§ç±»å‹çš„åŠ å¯†æ–¹æ³•ï¼š éå¯¹ç§°åŠ å¯†ï¼šæœåŠ¡å™¨å‘å®¢æˆ·ç«¯å‘é€å…¬é’¥ï¼Œç„¶åå®¢æˆ·ç«¯ç”¨å…¬é’¥åŠ å¯†è‡ªå·±çš„éšæœºå¯†é’¥ï¼Œä¹Ÿå°±æ˜¯ä¼šè¯å¯†é’¥ï¼Œå‘é€ç»™æœåŠ¡å™¨ï¼ŒæœåŠ¡å™¨ç”¨ç§é’¥è§£å¯†ï¼Œå¾—åˆ°ä¼šè¯å¯†é’¥ã€‚ å¯¹ç§°åŠ å¯†ï¼šåŒæ–¹ç”¨ä¼šè¯å¯†é’¥åŠ å¯†é€šä¿¡å†…å®¹ã€‚ å®¢æˆ·ç«¯ä¼šé€šè¿‡æ•°å­—è¯ä¹¦æ¥éªŒè¯æœåŠ¡å™¨çš„èº«ä»½ï¼Œæ•°å­—è¯ä¹¦ç”± CA ç­¾å‘ï¼ŒåŒ…å«äº†æœåŠ¡å™¨çš„å…¬é’¥ã€è¯ä¹¦çš„é¢å‘æœºæ„ã€è¯ä¹¦çš„æœ‰æ•ˆæœŸç­‰ã€‚ 20.HTTPSæ˜¯æ€ä¹ˆå»ºç«‹è¿æ¥çš„ï¼Ÿ HTTPS çš„è¿æ¥å»ºç«‹åœ¨ SSL/TLS æ¡æ‰‹ä¹‹ä¸Šï¼Œå…¶è¿‡ç¨‹å¯ä»¥åˆ†ä¸ºä¸¤ä¸ªé˜¶æ®µï¼šæ¡æ‰‹é˜¶æ®µå’Œæ•°æ®ä¼ è¾“é˜¶æ®µã€‚ â‘ ã€å®¢æˆ·ç«¯å‘æœåŠ¡å™¨å‘èµ·è¯·æ±‚ â‘¡ã€æœåŠ¡å™¨æ¥æ”¶åˆ°è¯·æ±‚åï¼Œè¿”å›è‡ªå·±çš„æ•°å­—è¯ä¹¦ï¼ŒåŒ…å«äº†å…¬é’¥ã€é¢å‘æœºæ„ç­‰ä¿¡æ¯ã€‚ â‘¢ã€å®¢æˆ·ç«¯æ”¶åˆ°æœåŠ¡å™¨çš„è¯ä¹¦åï¼ŒéªŒè¯è¯ä¹¦çš„åˆæ³•æ€§ï¼Œå¦‚æœåˆæ³•ï¼Œä¼šç”Ÿæˆä¸€ä¸ªéšæœºç ï¼Œç„¶åç”¨æœåŠ¡å™¨çš„å…¬é’¥åŠ å¯†è¿™ä¸ªéšæœºç ï¼Œå‘é€ç»™æœåŠ¡å™¨ã€‚ â‘£ã€æœåŠ¡å™¨æ”¶åˆ°ä¼šè¯å¯†é’¥åï¼Œç”¨ç§é’¥è§£å¯†ï¼Œå¾—åˆ°ä¼šè¯å¯†é’¥ã€‚ â‘¤ã€å®¢æˆ·ç«¯å’ŒæœåŠ¡å™¨é€šè¿‡ä¼šè¯å¯†ç å¯¹é€šä¿¡å†…å®¹è¿›è¡ŒåŠ å¯†ï¼Œç„¶åä¼ è¾“ã€‚ å¦‚æœé€šä¿¡å†…å®¹è¢«æˆªå–ï¼Œä½†ç”±äºæ²¡æœ‰ä¼šè¯å¯†é’¥ï¼Œæ‰€ä»¥æ— æ³•è§£å¯†ã€‚å½“é€šä¿¡ç»“æŸåï¼Œè¿æ¥ä¼šè¢«å…³é—­ï¼Œä¼šè¯å¯†é’¥ä¹Ÿä¼šè¢«é”€æ¯ï¼Œä¸‹æ¬¡é€šä¿¡ä¼šé‡æ–°ç”Ÿæˆä¸€ä¸ªä¼šè¯å¯†é’¥ã€‚ HTTPS ä¼šåŠ å¯† URL å—ï¼ŸHTTPS é€šè¿‡ SSL/TLS åè®®ç¡®ä¿äº†å®¢æˆ·ç«¯ä¸æœåŠ¡å™¨ä¹‹é—´äº¤æ¢çš„æ•°æ®è¢«åŠ å¯†ï¼Œè¿™åŒ…æ‹¬ HTTP å¤´éƒ¨å’Œæ­£æ–‡ã€‚ è€Œ URL æ˜¯ HTTP å¤´éƒ¨çš„ä¸€éƒ¨åˆ†ï¼Œå› æ­¤è¿™éƒ¨åˆ†ä¿¡æ¯ä¹Ÿæ˜¯åŠ å¯†çš„ã€‚ ä½†å› ä¸ºæ¶‰åŠåˆ° SSL æ¡æ‰‹çš„è¿‡ç¨‹ï¼Œæ‰€ä»¥åŸŸåä¿¡æ¯ä¼šè¢«æš´éœ²å‡ºæ¥ï¼Œéœ€è¦æ³¨æ„ã€‚ å¦å¤–ï¼Œå®Œæ•´çš„ URL å¯èƒ½åœ¨ Web æœåŠ¡å™¨çš„æ—¥å¿—ä¸­è®°å½•ï¼Œè¿™äº›æ—¥å¿—å¯èƒ½æ˜¯æ˜æ–‡çš„ã€‚è¿˜æœ‰ï¼ŒURL åœ¨æµè§ˆå™¨å†å²è®°å½•ä¸­ä¹Ÿæ˜¯å¯è§çš„ã€‚ å› æ­¤ï¼Œæ•æ„Ÿä¿¡æ¯æ°¸è¿œä¸åº”è¯¥é€šè¿‡ URL ä¼ é€’ï¼Œå³ä½¿æ˜¯åœ¨ä½¿ç”¨ HTTPS çš„æƒ…å†µä¸‹ã€‚ ä»€ä¹ˆæ˜¯ä¸­é—´äººæ”»å‡»ï¼Ÿä¸­é—´äººæ”»å‡»ï¼ˆMan-in-the-Middle, MITMï¼‰æ˜¯ä¸€ç§å¸¸è§çš„ç½‘ç»œå®‰å…¨å¨èƒï¼Œæ”»å‡»è€…å¯ä»¥åœ¨é€šä¿¡çš„ä¸¤ç«¯æ’å…¥è‡ªå·±ï¼Œä»¥çªƒå–é€šä¿¡åŒæ–¹çš„ä¿¡æ¯ã€‚ åœ¨å¾ˆå¤šç”µå½±ä¸­ï¼Œéƒ½ä¼šå­˜åœ¨è¿™æ ·çš„åœºæ™¯ï¼šä¸»è§’é€šè¿‡æŸç§æ–¹å¼ï¼Œå°†è‡ªå·±ä¼ªè£…æˆä¸­é—´äººï¼Œç„¶åçªƒå–é€šä¿¡åŒæ–¹çš„ä¿¡æ¯ï¼Œé˜¿æ±¤å“¥çš„ç¢Ÿä¸­è°ä¸­å°±æœ‰å¾ˆå¤šç±»ä¼¼çš„æ‰‹ç¬”ã€‚ ä¸­é—´äººæ”»å‡»æ˜¯ä¸€ä¸ªç¼ºä¹ç›¸äº’è®¤è¯çš„æ”»å‡»ï¼Œå› æ­¤å¤§å¤šæ•°åŠ å¯†åè®®éƒ½ä¼šä¸“é—¨åŠ å…¥ä¸€äº›ç‰¹æ®Šçš„è®¤è¯æ–¹æ³•ï¼Œä»¥é˜²æ­¢ä¸­é—´äººæ”»å‡»ã€‚åƒ SSL åè®®ï¼Œå°±æ˜¯é€šè¿‡éªŒè¯æœåŠ¡å™¨çš„æ•°å­—è¯ä¹¦ï¼Œæ˜¯å¦ç”± CAï¼ˆæƒå¨çš„å—ä¿¡ä»»çš„æ•°å­—è¯ä¹¦è®¤è¯æœºæ„ï¼‰ç­¾å‘ï¼Œæ¥é˜²æ­¢ä¸­é—´äººæ”»å‡»çš„ã€‚ HTTPSæ€ä¹ˆä¿è¯å»ºç«‹çš„ä¿¡é“æ˜¯å®‰å…¨çš„ï¼Ÿä¸»è¦é€šè¿‡ SSLTLS åè®®çš„å¤šå±‚æ¬¡å®‰å…¨æœºåˆ¶ï¼Œé¦–å…ˆåœ¨æ¡æ‰‹é˜¶æ®µï¼Œå®¢æˆ·ç«¯å’ŒæœåŠ¡å™¨ä½¿ç”¨å¾—æ˜¯éå¯¹ç§°åŠ å¯†ï¼Œç”Ÿæˆçš„ä¼šè¯å¯†é’¥åªæœ‰æœåŠ¡å™¨çš„ç§é’¥æ‰èƒ½è§£å¯†ï¼Œè€Œç§é’¥åªæœ‰æœåŠ¡å™¨æŒæœ‰ã€‚ åœ¨æ•°æ®ä¼ è¾“é˜¶æ®µï¼Œå³ä½¿æ”»å‡»è€…æ‹¦æˆªäº†é€šä¿¡æ•°æ®ï¼Œæ²¡æœ‰ä¼šè¯å¯†é’¥ä¹Ÿæ— æ³•è§£å¯†ã€‚ HTTPS èƒ½æŠ“åŒ…å—ï¼Ÿå¯ä»¥ï¼ŒHTTPS å¯ä»¥æŠ“åŒ…ï¼Œä½†å› ä¸ºé€šä¿¡å†…å®¹æ˜¯åŠ å¯†çš„ï¼Œéœ€è¦è§£å¯†åæ‰èƒ½æŸ¥çœ‹ã€‚ å…¶åŸç†æ˜¯é€šè¿‡ä¸€ä¸ªä¸­é—´äººï¼Œä¼ªé€ æœåŠ¡å™¨è¯ä¹¦ï¼Œå¹¶å–å¾—å®¢æˆ·ç«¯çš„ä¿¡ä»»ï¼Œç„¶åå°†å®¢æˆ·ç«¯çš„è¯·æ±‚è½¬å‘ç»™æœåŠ¡å™¨ï¼Œå°†æœåŠ¡å™¨çš„å“åº”è½¬å‘ç»™å®¢æˆ·ç«¯ï¼Œå®Œæˆä¸­é—´äººæ”»å‡»ã€‚ å¸¸ç”¨çš„æŠ“åŒ…å·¥å…·æœ‰ Wiresharkã€Fiddlerã€Charles ç­‰ã€‚ 21.å®¢æˆ·ç«¯æ€ä¹ˆå»æ ¡éªŒè¯ä¹¦çš„åˆæ³•æ€§ï¼Ÿæ¨èé˜…è¯»ï¼šHTTPS æ¡æ‰‹è¿‡ç¨‹ä¸­ï¼Œå®¢æˆ·ç«¯å¦‚ä½•éªŒè¯è¯ä¹¦çš„åˆæ³•æ€§ é¦–å…ˆï¼Œæ‰€æœ‰çš„è¯ä¹¦éƒ½æ˜¯ç”± CA æœºæ„ç­¾å‘çš„ï¼ŒCA æœºæ„æ˜¯ä¸€ä¸ªå—ä¿¡ä»»çš„ç¬¬ä¸‰æ–¹æœºæ„ï¼Œå®ƒä¼šå¯¹è¯ä¹¦çš„ç”³è¯·è€…è¿›è¡Œèº«ä»½éªŒè¯ï¼Œç„¶åç­¾å‘è¯ä¹¦ã€‚ CA å°±åƒæ˜¯ç½‘ç»œä¸–ç•Œçš„å…¬å®‰å±€ï¼Œå…·æœ‰æé«˜çš„å¯ä¿¡åº¦ã€‚ CA ç­¾å‘è¯ä¹¦çš„è¿‡ç¨‹æ˜¯éå¸¸ä¸¥æ ¼çš„ï¼š é¦–å…ˆï¼ŒCA ä¼šæŠŠæŒæœ‰è€…çš„å…¬é’¥ã€â½¤é€”ã€é¢å‘è€…ã€æœ‰æ•ˆæ—¶é—´ç­‰ä¿¡æ¯æ‰“æˆâ¼€ä¸ªåŒ…ï¼Œç„¶åå¯¹è¿™äº›ä¿¡æ¯è¿›â¾ Hash è®¡ç®—ï¼Œå¾—åˆ°â¼€ä¸ª Hash å€¼ï¼› ç„¶å CA ä¼šä½¿â½¤â¾ƒâ¼°çš„ç§é’¥å°†è¯¥ Hash å€¼åŠ å¯†ï¼Œâ½£æˆ Certificate Signatureï¼› æœ€åå°† Certificate Signature æ·»åŠ åœ¨â½‚ä»¶è¯ä¹¦ä¸Šï¼Œå½¢æˆæ•°å­—è¯ä¹¦ã€‚ 22.å¦‚ä½•ç†è§£ HTTP åè®®æ˜¯æ— çŠ¶æ€çš„ï¼ŸHTTP åè®®æ˜¯æ— çŠ¶æ€çš„ï¼Œè¿™æ„å‘³ç€æ¯ä¸ª HTTP è¯·æ±‚éƒ½æ˜¯ç‹¬ç«‹çš„ï¼ŒæœåŠ¡å™¨ä¸ä¼šä¿ç•™ä»»ä½•å…³äºå®¢æˆ·ç«¯è¯·æ±‚çš„å†å²ä¿¡æ¯ã€‚ æ¢å¥è¯è¯´ï¼Œæˆ‘å®¶å¤§é—¨å¸¸æ‰“å¼€ï¼Œæ˜¯äººæ˜¯ç¥éƒ½æ¬¢è¿ï¼Œæˆ‘ä¸åœ¨ä¹ï¼Œåªè¦ç»™é’±ï¼Œå“¦ä¸ï¼ŒæŒ‰è§„çŸ©ï¼Œä¸€åˆ‡å¥½åŠã€‚ æ¯ä¸ª HTTP è¯·æ±‚éƒ½åŒ…å«äº†æ‰€å¿…é¡»çš„ä¿¡æ¯ï¼ŒæœåŠ¡å™¨åœ¨å¤„ç†å½“å‰è¯·æ±‚æ—¶ï¼Œä¸ä¾èµ–äºä¹‹å‰çš„ä»»ä½•è¯·æ±‚ä¿¡æ¯ã€‚ æœåŠ¡å™¨ä¸ä¼šè®°å½•ä»»ä½•å®¢æˆ·ç«¯è¯·æ±‚çš„çŠ¶æ€ï¼Œæ¯æ¬¡è¯·æ±‚éƒ½åƒæ˜¯ç¬¬ä¸€æ¬¡ä¸æœåŠ¡å™¨é€šä¿¡ã€‚ ç”±äº HTTP æ˜¯æ— çŠ¶æ€çš„ï¼Œåƒç”¨æˆ·çš„è´­ç‰©è½¦çŠ¶æ€å°±å¿…é¡»é€šè¿‡å…¶ä»–æ–¹å¼æ¥ä¿æŒï¼Œå¦‚åœ¨æ¯æ¬¡è¯·æ±‚ä¸­ä¼ é€’ç”¨æˆ·çš„ IDï¼Œæˆ–è€…ä½¿ç”¨ Cookie åœ¨å®¢æˆ·ç«¯ä¿å­˜è´­ç‰©è½¦çŠ¶æ€ã€‚ é‚£æœ‰ä»€ä¹ˆåŠæ³•è®°å½•çŠ¶æ€å‘¢ï¼Ÿ Cookiesï¼šæœåŠ¡å™¨é€šè¿‡ Set-Cookie å“åº”å¤´å°†çŠ¶æ€ä¿¡æ¯å­˜å‚¨åœ¨å®¢æˆ·ç«¯ï¼Œå®¢æˆ·ç«¯åœ¨åç»­è¯·æ±‚ä¸­å‘é€è¯¥ Cookie ä»¥ç»´æŒçŠ¶æ€ã€‚ Sessionï¼šæœåŠ¡å™¨ç”Ÿæˆä¸€ä¸ªå”¯ä¸€çš„ä¼šè¯ IDï¼Œå­˜å‚¨åœ¨ Cookie ä¸­ï¼Œå¹¶åœ¨æœåŠ¡å™¨ç«¯ç»´æŠ¤ä¸è¯¥ä¼šè¯ ID å…³è”çš„çŠ¶æ€ä¿¡æ¯ã€‚ Tokenï¼šä½¿ç”¨ JWTï¼ˆJSON Web Tokenï¼‰ç­‰æœºåˆ¶åœ¨å®¢æˆ·ç«¯å­˜å‚¨çŠ¶æ€ä¿¡æ¯ï¼Œå®¢æˆ·ç«¯åœ¨æ¯æ¬¡è¯·æ±‚ä¸­å‘é€è¯¥ Tokenã€‚ 23.è¯´è¯´ Session å’Œ Cookie æœ‰ä»€ä¹ˆè”ç³»å’ŒåŒºåˆ«?å…ˆæ¥çœ‹çœ‹ä»€ä¹ˆæ˜¯ Session å’Œ Cookie ï¼š Cookie æ˜¯ä¿å­˜åœ¨å®¢æˆ·ç«¯çš„ä¸€å°å—æ–‡æœ¬ä¸²çš„æ•°æ®ã€‚å®¢æˆ·ç«¯å‘æœåŠ¡å™¨å‘èµ·è¯·æ±‚æ—¶ï¼ŒæœåŠ¡ç«¯ä¼šå‘å®¢æˆ·ç«¯å‘é€ä¸€ä¸ª Cookieï¼Œå®¢æˆ·ç«¯å°±æŠŠ Cookie ä¿å­˜èµ·æ¥ã€‚åœ¨å®¢æˆ·ç«¯ä¸‹æ¬¡å‘åŒä¸€æœåŠ¡å™¨å†å‘èµ·è¯·æ±‚æ—¶ï¼ŒCookie è¢«æºå¸¦å‘é€åˆ°æœåŠ¡å™¨ã€‚æœåŠ¡ç«¯å¯ä»¥æ ¹æ®è¿™ä¸ª Cookie åˆ¤æ–­ç”¨æˆ·çš„èº«ä»½å’ŒçŠ¶æ€ã€‚ Session æŒ‡çš„å°±æ˜¯æœåŠ¡å™¨å’Œå®¢æˆ·ç«¯ä¸€æ¬¡ä¼šè¯çš„è¿‡ç¨‹ã€‚å®ƒæ˜¯å¦ä¸€ç§è®°å½•å®¢æˆ·çŠ¶æ€çš„æœºåˆ¶ã€‚ä¸åŒçš„æ˜¯ cookie ä¿å­˜åœ¨å®¢æˆ·ç«¯æµè§ˆå™¨ä¸­ï¼Œè€Œ session ä¿å­˜åœ¨æœåŠ¡å™¨ä¸Šã€‚å®¢æˆ·ç«¯æµè§ˆå™¨è®¿é—®æœåŠ¡å™¨çš„æ—¶å€™ï¼ŒæœåŠ¡å™¨æŠŠå®¢æˆ·ç«¯ä¿¡æ¯ä»¥æŸç§å½¢å¼è®°å½•åœ¨æœåŠ¡å™¨ä¸Šï¼Œè¿™å°±æ˜¯ sessionã€‚å®¢æˆ·ç«¯æµè§ˆå™¨å†æ¬¡è®¿é—®æ—¶åªéœ€è¦ä»è¯¥ session ä¸­æŸ¥æ‰¾ç”¨æˆ·çš„çŠ¶æ€ã€‚ Session å’Œ Cookie åˆ°åº•æœ‰ä»€ä¹ˆä¸åŒå‘¢ï¼Ÿ å­˜å‚¨ä½ç½®ä¸ä¸€æ ·ï¼ŒCookie ä¿å­˜åœ¨å®¢æˆ·ç«¯ï¼ŒSession ä¿å­˜åœ¨æœåŠ¡å™¨ç«¯ã€‚ å­˜å‚¨æ•°æ®ç±»å‹ä¸ä¸€æ ·ï¼ŒCookie åªèƒ½ä¿å­˜ ASCIIï¼ŒSession å¯ä»¥å­˜ä»»æ„æ•°æ®ç±»å‹ï¼Œä¸€èˆ¬æƒ…å†µä¸‹æˆ‘ä»¬å¯ä»¥åœ¨ Session ä¸­ä¿æŒä¸€äº›å¸¸ç”¨å˜é‡ä¿¡æ¯ï¼Œæ¯”å¦‚è¯´ UserId ç­‰ã€‚ æœ‰æ•ˆæœŸä¸åŒï¼ŒCookie å¯è®¾ç½®ä¸ºé•¿æ—¶é—´ä¿æŒï¼Œæ¯”å¦‚æˆ‘ä»¬ç»å¸¸ä½¿ç”¨çš„é»˜è®¤ç™»å½•åŠŸèƒ½ï¼ŒSession ä¸€èˆ¬æœ‰æ•ˆæ—¶é—´è¾ƒçŸ­ï¼Œå®¢æˆ·ç«¯å…³é—­æˆ–è€… Session è¶…æ—¶éƒ½ä¼šå¤±æ•ˆã€‚ éšç§ç­–ç•¥ä¸åŒï¼ŒCookie å­˜å‚¨åœ¨å®¢æˆ·ç«¯ï¼Œæ¯”è¾ƒå®¹æ˜“é­åˆ°ä¸æ³•è·å–ï¼Œæ—©æœŸæœ‰äººå°†ç”¨æˆ·çš„ç™»å½•åå’Œå¯†ç å­˜å‚¨åœ¨ Cookie ä¸­å¯¼è‡´ä¿¡æ¯è¢«çªƒå–ï¼›Session å­˜å‚¨åœ¨æœåŠ¡ç«¯ï¼Œå®‰å…¨æ€§ç›¸å¯¹ Cookie è¦å¥½ä¸€äº›ã€‚ å­˜å‚¨å¤§å°ä¸åŒï¼Œ å•ä¸ª Cookie ä¿å­˜çš„æ•°æ®ä¸èƒ½è¶…è¿‡ 4Kï¼ŒSession å¯å­˜å‚¨æ•°æ®è¿œé«˜äº Cookieã€‚ Session å’Œ Cookie æœ‰ä»€ä¹ˆå…³è”å‘¢ï¼Ÿ å¯ä»¥ä½¿ç”¨ Cookie è®°å½• Session çš„æ ‡è¯†ã€‚ ç”¨æˆ·ç¬¬ä¸€æ¬¡è¯·æ±‚æœåŠ¡å™¨æ—¶ï¼ŒæœåŠ¡å™¨æ ¹æ®ç”¨æˆ·æäº¤çš„ä¿¡æ¯ï¼Œåˆ›å»ºå¯¹åº”çš„ Sessionï¼Œè¯·æ±‚è¿”å›æ—¶å°†æ­¤ Session çš„å”¯ä¸€æ ‡è¯†ä¿¡æ¯ SessionID è¿”å›ç»™æµè§ˆå™¨ï¼Œæµè§ˆå™¨æ¥æ”¶åˆ°æœåŠ¡å™¨è¿”å›çš„ SessionID ä¿¡æ¯åï¼Œä¼šå°†æ­¤ä¿¡æ¯å­˜å…¥ Cookie ä¸­ï¼ŒåŒæ—¶ Cookie è®°å½•æ­¤ SessionID æ˜¯å±äºå“ªä¸ªåŸŸåã€‚ å½“ç”¨æˆ·ç¬¬äºŒæ¬¡è®¿é—®æœåŠ¡å™¨æ—¶ï¼Œè¯·æ±‚ä¼šè‡ªåŠ¨åˆ¤æ–­æ­¤åŸŸåä¸‹æ˜¯å¦å­˜åœ¨ Cookie ä¿¡æ¯ï¼Œå¦‚æœå­˜åœ¨ï¼Œåˆ™è‡ªåŠ¨å°† Cookie ä¿¡æ¯ä¹Ÿå‘é€ç»™æœåŠ¡ç«¯ï¼ŒæœåŠ¡ç«¯ä¼šä» Cookie ä¸­è·å– SessionIDï¼Œå†æ ¹æ® SessionID æŸ¥æ‰¾å¯¹åº”çš„ Session ä¿¡æ¯ï¼Œå¦‚æœæ²¡æœ‰æ‰¾åˆ°ï¼Œè¯´æ˜ç”¨æˆ·æ²¡æœ‰ç™»å½•æˆ–è€…ç™»å½•å¤±æ•ˆï¼Œå¦‚æœæ‰¾åˆ° Session è¯æ˜ç”¨æˆ·å·²ç»ç™»å½•å¯æ‰§è¡Œåé¢æ“ä½œã€‚ åˆ†å¸ƒå¼ç¯å¢ƒä¸‹ Session æ€ä¹ˆå¤„ç†å‘¢ï¼Ÿ åˆ†å¸ƒå¼ç¯å¢ƒä¸‹ï¼Œå®¢æˆ·ç«¯è¯·æ±‚ç»è¿‡è´Ÿè½½å‡è¡¡ï¼Œå¯èƒ½ä¼šåˆ†é…åˆ°ä¸åŒçš„æœåŠ¡å™¨ä¸Šï¼Œå‡å¦‚ä¸€ä¸ªç”¨æˆ·çš„è¯·æ±‚ä¸¤æ¬¡æ²¡æœ‰è½åˆ°åŒä¸€å°æœåŠ¡å™¨ä¸Šï¼Œé‚£ä¹ˆåœ¨æ–°çš„æœåŠ¡å™¨ä¸Šå°±æ²¡æœ‰è®°å½•ç”¨æˆ·çŠ¶æ€çš„ Sessionã€‚ è¿™æ—¶å€™æ€ä¹ˆåŠå‘¢ï¼Ÿ å¯ä»¥ä½¿ç”¨ Redis ç­‰åˆ†å¸ƒå¼ç¼“å­˜æ¥å­˜å‚¨ Sessionï¼Œåœ¨å¤šå°æœåŠ¡å™¨ä¹‹é—´å…±äº«ã€‚ å®¢æˆ·ç«¯æ— æ³•ä½¿ç”¨ Cookie æ€ä¹ˆåŠï¼Ÿ æœ‰å¯èƒ½å®¢æˆ·ç«¯æ— æ³•ä½¿ç”¨ Cookieï¼Œæ¯”å¦‚æµè§ˆå™¨ç¦ç”¨ Cookieï¼Œæˆ–è€…å®¢æˆ·ç«¯æ˜¯å®‰å“ã€IOS ç­‰ç­‰ã€‚ è¿™æ—¶å€™æ€ä¹ˆåŠï¼ŸSessionID æ€ä¹ˆå­˜ï¼Ÿæ€ä¹ˆä¼ ç»™æœåŠ¡ç«¯å‘¢ï¼Ÿ é¦–å…ˆæ˜¯ SessionID çš„å­˜å‚¨ï¼Œå¯ä»¥ä½¿ç”¨å®¢æˆ·ç«¯çš„æœ¬åœ°å­˜å‚¨ï¼Œæ¯”å¦‚æµè§ˆå™¨çš„ sessionStorageã€‚ æ¥ä¸‹æ¥æ€ä¹ˆä¼ å‘¢ï¼Ÿ æ‹¼æ¥åˆ° URL é‡Œï¼šç›´æ¥æŠŠ SessionID ä½œä¸º URL çš„è¯·æ±‚å‚æ•° æ”¾åˆ°è¯·æ±‚å¤´é‡Œï¼šæŠŠ SessionID æ”¾åˆ°è¯·æ±‚çš„ Header é‡Œï¼Œæ¯”è¾ƒå¸¸ç”¨ã€‚ TCP24.è¯¦ç»†è¯´ä¸€ä¸‹ TCP çš„ä¸‰æ¬¡æ¡æ‰‹æœºåˆ¶TCPï¼ˆä¼ è¾“æ§åˆ¶åè®®ï¼‰çš„ä¸‰æ¬¡æ¡æ‰‹æœºåˆ¶æ˜¯ä¸€ç§ç”¨äºåœ¨ä¸¤ä¸ª TCP ä¸»æœºä¹‹é—´å»ºç«‹ä¸€ä¸ªå¯é è¿æ¥çš„è¿‡ç¨‹ã€‚è¿™ä¸ªæœºåˆ¶ç¡®ä¿äº†ä¸¤ç«¯çš„é€šä¿¡æ˜¯åŒæ­¥çš„ï¼Œå¹¶ä¸”åœ¨æ•°æ®ä¼ è¾“å¼€å§‹å‰ï¼ŒåŒæ–¹éƒ½å‡†å¤‡å¥½äº†è¿›è¡Œé€šä¿¡ã€‚ â‘ ã€ç¬¬ä¸€æ¬¡æ¡æ‰‹ï¼šSYNï¼ˆæœ€å¼€å§‹éƒ½æ˜¯ CLOSEï¼Œä¹‹åæœåŠ¡å™¨è¿›å…¥ LISTENï¼‰ å‘èµ·è¿æ¥ï¼šå®¢æˆ·ç«¯å‘é€ä¸€ä¸ª TCP æŠ¥æ–‡æ®µåˆ°æœåŠ¡å™¨ã€‚è¿™ä¸ªæŠ¥æ–‡æ®µçš„å¤´éƒ¨ä¸­ï¼ŒSYN ä½è¢«è®¾ç½®ä¸º 1ï¼Œè¡¨æ˜è¿™æ˜¯ä¸€ä¸ªè¿æ¥è¯·æ±‚ã€‚åŒæ—¶ï¼Œå®¢æˆ·ç«¯ä¼šéšæœºé€‰æ‹©ä¸€ä¸ªåºåˆ—å·ï¼ˆSequence Numberï¼‰ï¼Œå‡è®¾ä¸º xï¼Œå‘é€ç»™æœåŠ¡å™¨ã€‚ ç›®çš„ï¼šå®¢æˆ·ç«¯é€šçŸ¥æœåŠ¡å™¨å®ƒå¸Œæœ›å»ºç«‹è¿æ¥ï¼Œå¹¶å‘ŠçŸ¥æœåŠ¡å™¨è‡ªå·±çš„åˆå§‹åºåˆ—å·ã€‚ çŠ¶æ€ï¼šå®¢æˆ·ç«¯è¿›å…¥ SYN_SENT çŠ¶æ€ã€‚ â‘¡ã€ç¬¬äºŒæ¬¡æ¡æ‰‹ï¼šSYN + ACK ç¡®è®¤å¹¶åº”ç­”ï¼šæœåŠ¡å™¨æ”¶åˆ°å®¢æˆ·ç«¯çš„è¿æ¥è¯·æ±‚åï¼Œå¦‚æœåŒæ„å»ºç«‹è¿æ¥ï¼Œå®ƒä¼šå‘é€ä¸€ä¸ªåº”ç­” TCP æŠ¥æ–‡æ®µç»™å®¢æˆ·ç«¯ã€‚åœ¨è¿™ä¸ªæŠ¥æ–‡æ®µä¸­ï¼ŒSYN ä½å’Œ ACK ä½éƒ½è¢«è®¾ç½®ä¸º 1ã€‚æœåŠ¡å™¨ä¹Ÿä¼šé€‰æ‹©è‡ªå·±çš„ä¸€ä¸ªéšæœºåºåˆ—å·ï¼Œå‡è®¾ä¸º yï¼Œå¹¶å°†å®¢æˆ·ç«¯çš„åºåˆ—å·åŠ  1ï¼ˆå³ x+1ï¼‰ä½œä¸ºç¡®è®¤å·ï¼ˆAcknowledgment Numberï¼‰ï¼Œå‘é€ç»™å®¢æˆ·ç«¯ã€‚ ç›®çš„ï¼šæœåŠ¡å™¨å‘Šè¯‰å®¢æˆ·ç«¯ï¼Œå®ƒçš„è¿æ¥è¯·æ±‚è¢«æ¥å—äº†ï¼Œå¹¶é€šçŸ¥å®¢æˆ·ç«¯è‡ªå·±çš„åˆå§‹åºåˆ—å·ã€‚ çŠ¶æ€ï¼šæœåŠ¡å™¨è¿›å…¥ SYN_RCVD çŠ¶æ€ã€‚ â‘¢ã€ç¬¬ä¸‰æ¬¡æ¡æ‰‹ï¼šACK æœ€ç»ˆç¡®è®¤ï¼šå®¢æˆ·ç«¯æ”¶åˆ°æœåŠ¡å™¨çš„åº”ç­”åï¼Œè¿˜éœ€è¦å‘æœåŠ¡å™¨å‘é€ä¸€ä¸ªç¡®è®¤ã€‚è¿™ä¸ª TCP æŠ¥æ–‡æ®µçš„ ACK ä½è¢«è®¾ç½®ä¸º 1ï¼Œç¡®è®¤å·è¢«è®¾ç½®ä¸ºæœåŠ¡å™¨åºåˆ—å·åŠ  1ï¼ˆå³ y+1ï¼‰ï¼Œè€Œè‡ªå·±çš„åºåˆ—å·æ˜¯ x+1ã€‚ ç›®çš„ï¼šå®¢æˆ·ç«¯ç¡®è®¤æ”¶åˆ°äº†æœåŠ¡å™¨çš„åŒæ­¥åº”ç­”ï¼Œå®Œæˆä¸‰æ¬¡æ¡æ‰‹ï¼Œå»ºç«‹è¿æ¥ã€‚ çŠ¶æ€ï¼šå®¢æˆ·ç«¯è¿›å…¥ ESTABLISHED çŠ¶æ€ï¼Œå½“æœåŠ¡å™¨æ¥æ”¶åˆ°è¿™ä¸ªåŒ…æ—¶ï¼Œä¹Ÿè¿›å…¥ ESTABLISHED çŠ¶æ€ ç”¨å¤§ç™½è¯è®² TCP ä¸‰æ¬¡æ¡æ‰‹å°±æ˜¯ï¼š ä¸‰åå¹´å‰çš„å†œæ‘ï¼Œç”µè¯è¿˜æ²¡æœ‰æ™®åŠï¼Œæ‰€ä»¥ï¼Œé€šä¿¡åŸºæœ¬é å¼ã€‚ è€å¼ å’Œè€ç‹æ˜¯é‚»å±…ï¼Œè¿™å¤©è€å¼ ä¸‹åœ°äº†ï¼Œç»“æœå®¶é‡Œæœ‰äº‹ï¼Œçƒ­å¿ƒçš„é‚»å±…è€ç‹èµ¶ç´§è·‘åˆ°æ‘å£ï¼Œå¼€å§‹å«å”¤è€ç‹ã€‚ è€ç‹ï¼šè€å¼ å”‰ï¼æˆ‘æ˜¯è€ç‹ï¼Œä½ èƒ½å¬å¾—åˆ°å—ï¼Ÿ è€å¼ ä¸€å¬ï¼Œæ˜¯è€ç‹çš„å£°éŸ³ï¼šè€ç‹è€ç‹ï¼Œæˆ‘æ˜¯è€å¼ ï¼Œæˆ‘èƒ½å¬å¾—åˆ°ï¼Œä½ èƒ½å¬å¾—åˆ°å—ï¼Ÿ è€ç‹ä¸€å¬ï¼Œå—¯ï¼Œæ²¡é”™ï¼Œæ˜¯è€å¼ ï¼šè€å¼ ï¼Œæˆ‘å¬åˆ°äº†ï¼Œæˆ‘æœ‰äº‹è¦è·Ÿä½ è¯´ã€‚ â€œä½ è€å©†è¦ç”Ÿäº†ï¼Œèµ¶ç´§å›å»å§ï¼â€ è€å¼ é£é£ç«ç«åœ°èµ¶å›å®¶ï¼Œè€å©†é¡ºåˆ©åœ°ç”Ÿäº†ä¸ªå¸¦æŠŠçš„å¤§èƒ–å°å­ã€‚æ¡æ‰‹çš„æ•…äº‹å……æ»¡äº†å¹¸ç¦å’Œç¾æ»¡ã€‚ å¯ä»¥å†ä¸¾ä¸€ä¸ªä¾‹å­è¯´æ˜ TCP ä¸‰æ¬¡æ¡æ‰‹å—ï¼Ÿå½“ç„¶å¯ä»¥ï¼Œä½ ï¼ˆå®¢æˆ·ç«¯ï¼‰åœ¨ä¸€ä¸ªæ‹¥æŒ¤çš„èšä¼šä¸Šé‡åˆ°äº†ä½ æƒ³äº¤è°ˆçš„ç¾å¥³ï¼ˆæœåŠ¡å™¨ï¼‰ã€‚å› ä¸ºå‘¨å›´å¾ˆåµï¼Œä½ ä»¬éœ€è¦ç¡®è®¤å¯¹æ–¹éƒ½å‡†å¤‡å¥½äº¤æµï¼Œå¹¶æ¸…æ¥šåœ°å¬åˆ°å¯¹æ–¹è¯´çš„æ¯ä¸€å¥è¯ã€‚ â‘ ã€ç¬¬ä¸€æ¬¡æ¡æ‰‹ï¼šæ‰“æ‹›å‘¼ ä½ èµ°å‘é‚£ä¸ªç¾å¥³ï¼Œå¤§å£°è¯´ï¼šâ€œå˜¿ï¼Œæˆ‘æ˜¯å°äºŒï¼Œæˆ‘ä»¬å¯ä»¥èŠèŠå—ï¼Ÿâ€ï¼ˆä½ å‘é€äº†ä¸€ä¸ªè¿æ¥è¯·æ±‚ï¼Œå‘Šè¯‰æœåŠ¡å™¨ä½ æƒ³æ·±å…¥äº¤æµï¼Œå¹¶æä¾›äº†ä½ çš„å¾®ä¿¡å·xï¼Œä¹Ÿå°±æ˜¯ä½ ä»¬äº¤è°ˆçš„èµ·ç‚¹ï¼‰ â‘¡ã€ç¬¬äºŒæ¬¡æ¡æ‰‹ï¼šå¯¹æ–¹å›åº” ç¾å¥³ä¸€çœ‹ä½ æŒºå¸…æŒºæœ‰æ°”è´¨ï¼Œå›ç­”è¯´ï¼šâ€œå—¨ï¼Œæˆ‘æ˜¯å°é’ï¼Œå¯ä»¥èŠèŠã€‚â€ï¼ˆæœåŠ¡å™¨æ¥å—ä½ çš„è¯·æ±‚ï¼ŒåŒæ ·æ„¿æ„æ·±å…¥äº¤æµï¼Œå‘Šè¯‰ä½ å®ƒçš„å¾®ä¿¡å·yï¼Œå¹¶ç¡®è®¤äº†ä½ çš„å¾®ä¿¡å·x+1ï¼Œè¡¨ç¤ºå®ƒå‡†å¤‡å¥½äº†ï¼‰ â‘¢ã€ç¬¬ä¸‰æ¬¡æ¡æ‰‹ï¼šç¡®è®¤å‡†å¤‡å°±ç»ª ä½ å¬åˆ°ç¾å¥³çš„å›ç­”åï¼Œå¯¹å¥¹è¯´ï¼šâ€œå¤ªå¥½äº†ï¼Œæˆ‘ä»¬ä»¥åå°±å¾®ä¿¡ä¸ŠèŠå§ã€‚â€ï¼ˆä½ ç¡®è®¤äº†ç¾å¥³çš„å›ç­”ï¼Œä¹Ÿå‘Šè¯‰å¥¹ä½ å‡†å¤‡å¥½å¼€å§‹äº†ï¼Œé€šè¿‡å‘é€ç¡®è®¤å·y+1ï¼‰ â‘£ã€èŠå¤©å¼€å§‹ è¿™æ—¶å€™ï¼Œä½ ä»¬ä¸¤ä¸ªå°±ç¡®è®¤å½¼æ­¤éƒ½å‡†å¤‡å¥½æ·±å…¥äº¤æµäº†ï¼Œå¯ä»¥å¼€å§‹ä½ ä»¬çš„å¯¹è¯äº†ã€‚ è¯´è¯´ SYN çš„æ¦‚å¿µï¼ŸSYN æ˜¯ TCP åè®®ä¸­ç”¨æ¥å»ºç«‹è¿æ¥çš„ä¸€ä¸ªæ ‡å¿—ä½ï¼Œå…¨ç§°ä¸º Synchronize Sequence Numbersï¼Œä¹Ÿå°±æ˜¯åŒæ­¥åºåˆ—ç¼–å·ã€‚ SYN ä¸ä»…ç¡®ä¿äº†åºåˆ—å·çš„åŒæ­¥ï¼Œä½¿å¾—åç»­çš„æ•°æ®èƒ½å¤Ÿæœ‰åºä¼ è¾“ï¼Œè¿˜èƒ½é˜²æ­¢æ—§çš„æŠ¥æ–‡æ®µè¢«è¯¯è®¤ä¸ºæ˜¯æ–°è¿æ¥ã€‚ 25.TCP æ¡æ‰‹ä¸ºä»€ä¹ˆæ˜¯ä¸‰æ¬¡ï¼Œä¸ºä»€ä¹ˆä¸èƒ½æ˜¯ä¸¤æ¬¡ï¼Ÿä¸èƒ½æ˜¯å››æ¬¡ï¼Ÿä½¿ç”¨ä¸‰æ¬¡æ¡æ‰‹å¯ä»¥å»ºç«‹ä¸€ä¸ªå¯é çš„è¿æ¥ã€‚è¿™ä¸€è¿‡ç¨‹çš„ç›®çš„æ˜¯ç¡®ä¿åŒæ–¹éƒ½çŸ¥é“å¯¹æ–¹å·²å‡†å¤‡å¥½è¿›è¡Œé€šä¿¡ï¼Œå¹¶åŒæ­¥åŒæ–¹çš„åºåˆ—å·ï¼Œä»è€Œä¿æŒæ•°æ®åŒ…çš„é¡ºåºå’Œå®Œæ•´æ€§ã€‚ ä¸ºä»€ä¹ˆ TCP æ¡æ‰‹ä¸èƒ½æ˜¯ä¸¤æ¬¡ï¼Ÿ ä¸ºäº†é˜²æ­¢æœåŠ¡å™¨ä¸€ç›´ç­‰ï¼Œç­‰åˆ°é»„èŠ±èœéƒ½å‡‰äº†ã€‚ ä¸ºäº†é˜²æ­¢å®¢æˆ·ç«¯å·²ç»å¤±æ•ˆçš„è¿æ¥è¯·æ±‚çªç„¶åˆä¼ é€åˆ°äº†æœåŠ¡å™¨ã€‚ è¦çŸ¥é“ï¼Œç½‘ç»œä¼ è¾“æ˜¯æœ‰å»¶æ—¶çš„ï¼ˆè¦é€šè¿‡ç½‘ç»œå…‰çº¤ã€WIFIã€å«æ˜Ÿä¿¡å·ä¼ è¾“ç­‰ï¼‰ã€‚ å‡å¦‚è¯´å®¢æˆ·ç«¯å‘èµ·äº† SYN1 çš„ç¬¬ä¸€æ¬¡æ¡æ‰‹ã€‚æœåŠ¡å™¨ä¹ŸåŠæ—¶å›å¤äº† SYN2 å’Œ ACK1 çš„ç¬¬äºŒæ¬¡æ¡æ‰‹ï¼Œä½†æ˜¯è¿™ä¸ª ACK1 çš„ç¡®è®¤æŠ¥æ–‡æ®µå› ä¸ºæŸäº›åŸå› åœ¨ä¼ è¾“è¿‡ç¨‹ä¸­ä¸¢å¤±äº†ã€‚ å¦‚æœæ²¡æœ‰ç¬¬ä¸‰æ¬¡æ¡æ‰‹å‘Šè¯‰æœåŠ¡å™¨ï¼Œå®¢æˆ·ç«¯æ”¶åˆ°äº†æœåŠ¡å™¨çš„å›åº”ï¼Œé‚£æœåŠ¡å™¨æ˜¯ä¸çŸ¥é“å®¢æˆ·ç«¯æœ‰æ²¡æœ‰æ¥æ”¶åˆ°çš„ã€‚ äºæ˜¯æœåŠ¡å™¨å°±ä¸€ç›´å¹²å·´å·´åœ°å¼€ç€ç«¯å£åœ¨ç­‰ç€å®¢æˆ·ç«¯å‘æ¶ˆæ¯å‘¢ï¼Œä½†å…¶å®å®¢æˆ·ç«¯å¹¶æ²¡æœ‰æ”¶åˆ°æœåŠ¡å™¨çš„å›åº”ï¼Œå¿ƒç°æ„å†·åœ°è·‘äº†ã€‚ è¿˜æœ‰ä¸€ç§æƒ…å†µæ˜¯ï¼Œä¸€ä¸ªæ—§çš„ã€å»¶è¿Ÿçš„è¿æ¥è¯·æ±‚ï¼ˆSYN1ï¼‰è¢«æœåŠ¡å™¨æ¥å—ï¼Œå¯¼è‡´æœåŠ¡å™¨é”™è¯¯åœ°å¼€å¯ä¸€ä¸ªä¸å†éœ€è¦çš„è¿æ¥ã€‚ ä¸¾ä¸ªä¾‹å­ï¼šå‡è®¾ä½ ï¼ˆå®¢æˆ·ç«¯ï¼‰ç»™ä½ çš„æœ‹å‹ï¼ˆæœåŠ¡å™¨ï¼‰å‘é€äº†ä¸€ä¸ªé‚®ä»¶ï¼ˆè¿æ¥è¯·æ±‚ï¼‰ã€‚å› ä¸ºæŸäº›åŸå› ï¼Œè¿™å°é‚®ä»¶è¿Ÿè¿Ÿæ²¡æœ‰åˆ°è¾¾æœ‹å‹é‚£é‡Œï¼Œå¯èƒ½æ˜¯å› ä¸ºé‚®å±€çš„å»¶è¯¯ã€‚äºæ˜¯ä½ å†³å®šå†å‘ä¸€å°æ–°çš„é‚®ä»¶ã€‚æœ‹å‹æ”¶åˆ°äº†ç¬¬äºŒå°é‚®ä»¶ï¼Œä½ ä»¬æˆåŠŸåœ°å»ºç«‹äº†è¿æ¥å¹¶å¼€å§‹é€šä¿¡ã€‚ ä½†æ˜¯ï¼Œè¿‡äº†å¾ˆä¹…ï¼Œé‚£å°å»¶è¯¯çš„æ—§é‚®ä»¶çªç„¶ä¹Ÿåˆ°äº†ä½ æœ‹å‹é‚£é‡Œã€‚å¦‚æœæ²¡æœ‰ä¸€ç§æœºåˆ¶æ¥è¯†åˆ«å’Œå¤„ç†è¿™ç§å»¶è¯¯çš„é‚®ä»¶ï¼Œä½ çš„æœ‹å‹å¯èƒ½ä¼šä»¥ä¸ºè¿™æ˜¯ä¸€ä¸ªæ–°çš„è¿æ¥è¯·æ±‚ï¼Œå¹¶å°è¯•å“åº”å®ƒï¼Œä½†å…¶å®ä½ å·²ç»é‡æ–°å‘äº†è¯·æ±‚ï¼ŒåŸæ¥çš„ä¸éœ€è¦äº†ã€‚è¿™å°±å¯¼è‡´äº†ä¸å¿…è¦çš„æ··ä¹±å’Œèµ„æºæµªè´¹ã€‚ æ‰€ä»¥æˆ‘ä»¬éœ€è¦â€œä¸‰æ¬¡æ¡æ‰‹â€æ¥ç¡®è®¤è¿™ä¸ªè¿‡ç¨‹ï¼š ç¬¬ä¸€æ¬¡æ¡æ‰‹ï¼šå®¢æˆ·ç«¯å‘é€ SYN åŒ…ï¼ˆè¿æ¥è¯·æ±‚ï¼‰ç»™æœåŠ¡å™¨ï¼Œå¦‚æœè¿™ä¸ªåŒ…å»¶è¿Ÿäº†ï¼Œå®¢æˆ·ç«¯ä¸ä¼šä¸€ç›´ç­‰å¾…ï¼Œå®ƒå¯èƒ½ä¼šé‡è¯•å¹¶å‘é€ä¸€ä¸ªæ–°çš„è¿æ¥è¯·æ±‚ã€‚ç¬¬äºŒæ¬¡æ¡æ‰‹ï¼šæœåŠ¡å™¨æ”¶åˆ° SYN åŒ…åï¼Œå‘é€ä¸€ä¸ª SYN-ACK åŒ…ï¼ˆç¡®è®¤æ¥æ”¶åˆ°è¿æ¥è¯·æ±‚ï¼‰å›å®¢æˆ·ç«¯ã€‚ç¬¬ä¸‰æ¬¡æ¡æ‰‹ï¼šå®¢æˆ·ç«¯æ”¶åˆ° SYN-ACK åŒ…åï¼Œå†å‘é€ä¸€ä¸ª ACK åŒ…ç»™æœåŠ¡å™¨ï¼Œç¡®è®¤æ”¶åˆ°äº†æœåŠ¡å™¨çš„å“åº”ã€‚ ä¸ºä»€ä¹ˆä¸æ˜¯å››æ¬¡ï¼Ÿä¸‰æ¬¡æ¡æ‰‹å·²ç»è¶³å¤Ÿåˆ›å»ºå¯é çš„è¿æ¥äº†ï¼Œæ²¡æœ‰å¿…è¦å†å¤šä¸€æ¬¡æ¡æ‰‹ã€‚ ä»€ä¹ˆæ˜¯æ³›æ´ªæ”»å‡»ï¼Ÿæ³›æ´ªæ”»å‡»ï¼ˆSYN Flood Attackï¼‰æ˜¯ä¸€ç§å¸¸è§çš„ DoSï¼ˆæ‹’ç»æœåŠ¡ï¼‰æ”»å‡»ï¼Œæ”»å‡»è€…ä¼šå‘é€å¤§é‡çš„ä¼ªé€ çš„ TCP è¿æ¥è¯·æ±‚ï¼Œå¯¼è‡´æœåŠ¡å™¨èµ„æºè€—å°½ï¼Œæ— æ³•å¤„ç†æ­£å¸¸çš„è¿æ¥è¯·æ±‚ã€‚ åŠè¿æ¥æœåŠ¡æ‹’ç»ï¼Œä¹Ÿç§°ä¸º SYN æ´ªæ³›æ”»å‡»æˆ– SYN Floodã€‚ æ‰€è°“çš„åŠè¿æ¥å°±æ˜¯æŒ‡åœ¨ TCP çš„ä¸‰æ¬¡æ¡æ‰‹è¿‡ç¨‹ä¸­ï¼Œå½“æœåŠ¡å™¨æ¥æ”¶åˆ°æ¥è‡ªå®¢æˆ·ç«¯çš„ç¬¬ä¸€ä¸ª SYN åŒ…åï¼Œå®ƒä¼šå›å¤ä¸€ä¸ª SYN-ACK åŒ…ï¼Œæ­¤æ—¶è¿æ¥å¤„äºâ€œåŠå¼€â€çŠ¶æ€ï¼Œå› ä¸ºè¿æ¥çš„å»ºç«‹è¿˜éœ€è¦å®¢æˆ·ç«¯å‘é€æœ€åä¸€ä¸ª ACK åŒ…ã€‚ åœ¨æ”¶åˆ°æœ€åçš„ ACK åŒ…ä¹‹å‰ï¼ŒæœåŠ¡å™¨ä¼šä¸ºè¿™ä¸ªå°šæœªå®Œæˆçš„è¿æ¥åˆ†é…ä¸€å®šçš„èµ„æºï¼Œå¹¶åœ¨å®ƒçš„é˜Ÿåˆ—ä¸­ä¿ç•™è¿™ä¸ªè¿æ¥çš„ä½ç½®ã€‚ å¦‚æœè®©ä½ é‡æ–°è®¾è®¡ï¼Œæ€ä¹ˆè®¾è®¡ï¼Ÿå¦‚æœé‡æ–°è®¾è®¡ TCP çš„è¿æ¥å»ºç«‹è¿‡ç¨‹ï¼Œå¯ä»¥è€ƒè™‘å¼•å…¥ SYN cookiesï¼Œè¿™ç§æŠ€æœ¯é€šè¿‡åœ¨ SYN-ACK å“åº”ä¸­ç¼–ç è¿æ¥ä¿¡æ¯ï¼Œä»è€Œåœ¨ä¸å ç”¨å¤§é‡èµ„æºçš„æƒ…å†µä¸‹éªŒè¯å®¢æˆ·ç«¯ã€‚ 26.ä¸‰æ¬¡æ¡æ‰‹ä¸­æ¯ä¸€æ¬¡æ²¡æ”¶åˆ°æŠ¥æ–‡ä¼šå‘ç”Ÿä»€ä¹ˆæƒ…å†µï¼Ÿ ç¬¬ä¸€æ¬¡æ¡æ‰‹æœåŠ¡ç«¯æœªæ”¶åˆ° SYN æŠ¥æ–‡ æœåŠ¡ç«¯ä¸ä¼šè¿›è¡Œä»»ä½•çš„åŠ¨ä½œï¼Œè€Œå®¢æˆ·ç«¯ç”±äºä¸€æ®µæ—¶é—´å†…æ²¡æœ‰æ”¶åˆ°æœåŠ¡ç«¯å‘æ¥çš„ç¡®è®¤æŠ¥æ–‡ï¼Œç­‰å¾…ä¸€æ®µæ—¶é—´åä¼šé‡æ–°å‘é€ SYN æŠ¥æ–‡ï¼Œå¦‚æœä»ç„¶æ²¡æœ‰å›åº”ï¼Œä¼šé‡å¤è¿™ä¸ªè¿‡ç¨‹ï¼Œç›´åˆ°å‘é€æ¬¡æ•°è¶…è¿‡æœ€å¤§é‡ä¼ æ¬¡æ•°é™åˆ¶ï¼Œå°±ä¼šè¿”å›è¿æ¥å»ºç«‹å¤±è´¥ã€‚ ç¬¬äºŒæ¬¡æ¡æ‰‹å®¢æˆ·ç«¯æœªæ”¶åˆ°æœåŠ¡ç«¯å“åº”çš„ ACK æŠ¥æ–‡ å®¢æˆ·ç«¯ä¼šç»§ç»­é‡ä¼ ï¼Œç›´åˆ°æ¬¡æ•°é™åˆ¶ï¼›è€ŒæœåŠ¡ç«¯æ­¤æ—¶ä¼šé˜»å¡åœ¨ accept()å¤„ï¼Œç­‰å¾…å®¢æˆ·ç«¯å‘é€ ACK æŠ¥æ–‡ ç¬¬ä¸‰æ¬¡æ¡æ‰‹æœåŠ¡ç«¯ä¸ºæ”¶åˆ°å®¢æˆ·ç«¯å‘é€è¿‡æ¥çš„ ACK æŠ¥æ–‡ æœåŠ¡ç«¯åŒæ ·ä¼šé‡‡ç”¨ç±»ä¼¼å®¢æˆ·ç«¯çš„è¶…æ—¶é‡ä¼ æœºåˆ¶ï¼Œå¦‚æœé‡è¯•æ¬¡æ•°è¶…è¿‡é™åˆ¶ï¼Œåˆ™ accept()è°ƒç”¨è¿”å›-1ï¼ŒæœåŠ¡ç«¯å»ºç«‹è¿æ¥å¤±è´¥ï¼›è€Œæ­¤æ—¶å®¢æˆ·ç«¯è®¤ä¸ºè‡ªå·±å·²ç»å»ºç«‹è¿æ¥æˆåŠŸï¼Œå› æ­¤å¼€å§‹å‘æœåŠ¡ç«¯å‘é€æ•°æ®ï¼Œä½†æ˜¯æœåŠ¡ç«¯çš„ accept()ç³»ç»Ÿè°ƒç”¨å·²ç»è¿”å›ï¼Œæ­¤æ—¶ä¸åœ¨ç›‘å¬çŠ¶æ€ï¼Œå› æ­¤æœåŠ¡ç«¯æ¥æ”¶åˆ°å®¢æˆ·ç«¯å‘é€æ¥çš„æ•°æ®æ—¶ä¼šå‘é€ RST æŠ¥æ–‡ç»™å®¢æˆ·ç«¯ï¼Œæ¶ˆé™¤å®¢æˆ·ç«¯å•æ–¹é¢å»ºç«‹è¿æ¥çš„çŠ¶æ€ã€‚ 27.ç¬¬äºŒæ¬¡æ¡æ‰‹ä¼ å›äº† ACKï¼Œä¸ºä»€ä¹ˆè¿˜è¦ä¼ å› SYNï¼ŸACK æ˜¯ä¸ºäº†å‘Šè¯‰å®¢æˆ·ç«¯ä¼ æ¥çš„æ•°æ®å·²ç»æ¥æ”¶æ— è¯¯ã€‚ è€Œä¼ å› SYN æ˜¯ä¸ºäº†å‘Šè¯‰å®¢æˆ·ç«¯ï¼ŒæœåŠ¡ç«¯å“åº”çš„ç¡®å®æ˜¯å®¢æˆ·ç«¯å‘é€çš„æŠ¥æ–‡ã€‚ 28.ç¬¬ 3 æ¬¡æ¡æ‰‹å¯ä»¥æºå¸¦æ•°æ®å—ï¼Ÿç¬¬ 3 æ¬¡æ¡æ‰‹æ˜¯å¯ä»¥æºå¸¦æ•°æ®çš„ã€‚ æ­¤æ—¶å®¢æˆ·ç«¯å·²ç»å¤„äº ESTABLISHED çŠ¶æ€ã€‚å¯¹äºå®¢æˆ·ç«¯æ¥è¯´ï¼Œå®ƒå·²ç»å»ºç«‹è¿æ¥æˆåŠŸï¼Œå¹¶ä¸”ç¡®è®¤æœåŠ¡ç«¯çš„æ¥æ”¶å’Œå‘é€èƒ½åŠ›æ˜¯æ­£å¸¸çš„ã€‚ ç¬¬ä¸€æ¬¡æ¡æ‰‹ä¸èƒ½æºå¸¦æ•°æ®æ˜¯å‡ºäºå®‰å…¨çš„è€ƒè™‘ï¼Œå› ä¸ºå¦‚æœå…è®¸æºå¸¦æ•°æ®ï¼Œæ”»å‡»è€…æ¯æ¬¡åœ¨ SYN æŠ¥æ–‡ä¸­æºå¸¦å¤§é‡æ•°æ®ï¼Œå°±ä¼šå¯¼è‡´æœåŠ¡ç«¯æ¶ˆè€—æ›´å¤šçš„æ—¶é—´å’Œç©ºé—´å»å¤„ç†è¿™äº›æŠ¥æ–‡ï¼Œä¼šé€ æˆ CPU å’Œå†…å­˜çš„æ¶ˆè€—ã€‚ 29.äº†è§£ TCP åŠè¿æ¥çŠ¶æ€å—ï¼ŸTCP åŠè¿æ¥æŒ‡çš„æ˜¯åœ¨ TCP ä¸‰æ¬¡æ¡æ‰‹è¿‡ç¨‹ä¸­ï¼ŒæœåŠ¡å™¨æ¥æ”¶åˆ°äº†å®¢æˆ·ç«¯çš„ SYN åŒ…ï¼Œä½†è¿˜æ²¡æœ‰å®Œæˆç¬¬ä¸‰æ¬¡æ¡æ‰‹ï¼Œæ­¤æ—¶çš„è¿æ¥å¤„äºä¸€ç§æœªå®Œå…¨å»ºç«‹çš„çŠ¶æ€ã€‚ å¦‚æœæœåŠ¡å™¨å›å¤äº† SYN-ACKï¼Œä½†å®¢æˆ·ç«¯è¿˜æ²¡æœ‰å›å¤ ACKï¼Œè¯¥è¿æ¥å°†ä¸€ç›´ä¿ç•™åœ¨åŠè¿æ¥é˜Ÿåˆ—ä¸­ï¼Œç›´åˆ°è¶…æ—¶æˆ–è¢«æ‹’ç»ã€‚ è¯´è¯´åŠè¿æ¥é˜Ÿåˆ—ï¼ŸTCP è¿›å…¥ä¸‰æ¬¡æ¡æ‰‹å‰ï¼ŒæœåŠ¡ç«¯ä¼šä» CLOSED çŠ¶æ€å˜ä¸º LISTEN çŠ¶æ€, åŒæ—¶åœ¨å†…éƒ¨åˆ›å»ºäº†ä¸¤ä¸ªé˜Ÿåˆ—ï¼šåŠè¿æ¥é˜Ÿåˆ—ï¼ˆSYN é˜Ÿåˆ—ï¼‰å’Œå…¨è¿æ¥é˜Ÿåˆ—ï¼ˆACCEPT é˜Ÿåˆ—ï¼‰ã€‚ é¡¾åæ€ä¹‰ï¼ŒåŠè¿æ¥é˜Ÿåˆ—å­˜æ”¾çš„æ˜¯ä¸‰æ¬¡æ¡æ‰‹æœªå®Œæˆçš„è¿æ¥ï¼Œå…¨è¿æ¥é˜Ÿåˆ—å­˜æ”¾çš„æ˜¯å®Œæˆä¸‰æ¬¡æ¡æ‰‹çš„è¿æ¥ã€‚ TCP ä¸‰æ¬¡æ¡æ‰‹æ—¶ï¼Œå®¢æˆ·ç«¯å‘é€ SYN åˆ°æœåŠ¡ç«¯ï¼ŒæœåŠ¡ç«¯æ”¶åˆ°ä¹‹åï¼Œä¾¿å›å¤ ACK å’Œ SYNï¼ŒçŠ¶æ€ç”± LISTEN å˜ä¸º SYN_RCVDï¼Œæ­¤æ—¶è¿™ä¸ªè¿æ¥å°±è¢«æ¨å…¥äº† SYN é˜Ÿåˆ—ï¼Œå³åŠè¿æ¥é˜Ÿåˆ—ã€‚ å½“å®¢æˆ·ç«¯å›å¤ ACK, æœåŠ¡ç«¯æ¥æ”¶åï¼Œä¸‰æ¬¡æ¡æ‰‹å°±å®Œæˆäº†ã€‚è¿™æ—¶è¿æ¥ä¼šç­‰å¾…è¢«å…·ä½“çš„åº”ç”¨å–èµ°ï¼Œåœ¨è¢«å–èµ°ä¹‹å‰ï¼Œå®ƒè¢«æ¨å…¥ ACCEPT é˜Ÿåˆ—ï¼Œå³å…¨è¿æ¥é˜Ÿåˆ—ã€‚ ä»€ä¹ˆæ˜¯ SYN Flood ï¼ŸSYN Flood æ˜¯ä¸€ç§å…¸å‹çš„ DDos æ”»å‡»ï¼Œå®ƒåœ¨çŸ­æ—¶é—´å†…ï¼Œä¼ªé€ ä¸å­˜åœ¨çš„ IP åœ°å€, å‘æœåŠ¡å™¨å‘é€å¤§é‡ SYN æŠ¥æ–‡ã€‚å½“æœåŠ¡å™¨å›å¤ SYN+ACK æŠ¥æ–‡åï¼Œä¸ä¼šæ”¶åˆ° ACK å›åº”æŠ¥æ–‡ï¼Œé‚£ä¹ˆ SYN é˜Ÿåˆ—é‡Œçš„è¿æ¥æ—§ä¸ä¼šå‡ºå¯¹é˜Ÿï¼Œä¹…â½½ä¹…ä¹‹å°±ä¼šå æ»¡æœåŠ¡ç«¯çš„ SYN æ¥æ”¶é˜Ÿåˆ—ï¼ˆåŠè¿æ¥é˜Ÿåˆ—ï¼‰ï¼Œä½¿å¾—æœåŠ¡å™¨ä¸èƒ½ä¸ºæ­£å¸¸â½¤æˆ·æœåŠ¡ã€‚ é‚£æœ‰ä»€ä¹ˆåº”å¯¹æ–¹æ¡ˆå‘¢ï¼Ÿä¸»è¦æœ‰ syn cookie å’Œ SYN Proxy é˜²ç«å¢™ç­‰ã€‚ syn cookieï¼šåœ¨æ”¶åˆ° SYN åŒ…åï¼ŒæœåŠ¡å™¨æ ¹æ®ä¸€å®šçš„æ–¹æ³•ï¼Œä»¥æ•°æ®åŒ…çš„æºåœ°å€ã€ç«¯å£ç­‰ä¿¡æ¯ä¸ºå‚æ•°è®¡ç®—å‡ºä¸€ä¸ª cookie å€¼ä½œä¸ºè‡ªå·±çš„ SYNACK åŒ…çš„åºåˆ—å·ï¼Œå›å¤ SYN+ACK åï¼ŒæœåŠ¡å™¨å¹¶ä¸ç«‹å³åˆ†é…èµ„æºè¿›è¡Œå¤„ç†ï¼Œç­‰æ”¶åˆ°å‘é€æ–¹çš„ ACK åŒ…åï¼Œé‡æ–°æ ¹æ®æ•°æ®åŒ…çš„æºåœ°å€ã€ç«¯å£è®¡ç®—è¯¥åŒ…ä¸­çš„ç¡®è®¤åºåˆ—å·æ˜¯å¦æ­£ç¡®ï¼Œå¦‚æœæ­£ç¡®åˆ™å»ºç«‹è¿æ¥ï¼Œå¦åˆ™ä¸¢å¼ƒè¯¥åŒ…ã€‚ SYN Proxy é˜²ç«å¢™ï¼šæœåŠ¡å™¨é˜²ç«å¢™ä¼šå¯¹æ”¶åˆ°çš„æ¯ä¸€ä¸ª SYN æŠ¥æ–‡è¿›è¡Œä»£ç†å’Œå›åº”ï¼Œå¹¶ä¿æŒåŠè¿æ¥ã€‚ç­‰å‘é€æ–¹å°† ACK åŒ…è¿”å›åï¼Œå†é‡æ–°æ„é€  SYN åŒ…å‘åˆ°æœåŠ¡å™¨ï¼Œå»ºç«‹çœŸæ­£çš„ TCP è¿æ¥ã€‚ 30.è¯´è¯´ TCP å››æ¬¡æŒ¥æ‰‹çš„è¿‡ç¨‹ï¼ŸTCP è¿æ¥çš„æ–­å¼€è¿‡ç¨‹è¢«å½¢è±¡åœ°æ¦‚æ‹¬ä¸ºå››æ¬¡æŒ¥æ‰‹ã€‚ ç¬¬ä¸€æ¬¡æŒ¥æ‰‹ï¼šå®¢æˆ·ç«¯å‘æœåŠ¡å™¨å‘é€ä¸€ä¸ª FIN ç»“æŸæŠ¥æ–‡ï¼Œè¡¨ç¤ºå®¢æˆ·ç«¯æ²¡æœ‰æ•°æ®è¦å‘é€äº†ï¼Œä½†ä»ç„¶å¯ä»¥æ¥æ”¶æ•°æ®ã€‚å®¢æˆ·ç«¯è¿›å…¥ FIN-WAIT-1 çŠ¶æ€ã€‚ ç¬¬äºŒæ¬¡æŒ¥æ‰‹ï¼šæœåŠ¡å™¨æ¥æ”¶åˆ° FIN æŠ¥æ–‡åï¼Œå‘å®¢æˆ·ç«¯å‘é€ä¸€ä¸ª ACK æŠ¥æ–‡ï¼Œç¡®è®¤å·²æ¥æ”¶åˆ°å®¢æˆ·ç«¯çš„ FIN è¯·æ±‚ã€‚æœåŠ¡å™¨è¿›å…¥ CLOSE-WAIT çŠ¶æ€ï¼Œå®¢æˆ·ç«¯è¿›å…¥ FIN-WAIT-2 çŠ¶æ€ã€‚ ç¬¬ä¸‰æ¬¡æŒ¥æ‰‹ï¼šæœåŠ¡å™¨å‘å®¢æˆ·ç«¯å‘é€ä¸€ä¸ª FIN æŠ¥æ–‡ï¼Œè¡¨ç¤ºæœåŠ¡å™¨ä¹Ÿæ²¡æœ‰æ•°æ®è¦å‘é€äº†ã€‚æœåŠ¡å™¨è¿›å…¥ LAST-ACK çŠ¶æ€ã€‚ ç¬¬å››æ¬¡æŒ¥æ‰‹ï¼šå®¢æˆ·ç«¯æ¥æ”¶åˆ° FIN æŠ¥æ–‡åï¼Œå‘æœåŠ¡å™¨å‘é€ä¸€ä¸ª ACK æŠ¥æ–‡ï¼Œç¡®è®¤å·²æ¥æ”¶åˆ°æœåŠ¡å™¨çš„ FIN è¯·æ±‚ã€‚å®¢æˆ·ç«¯è¿›å…¥ TIME-WAIT çŠ¶æ€ï¼Œç­‰å¾…ä¸€æ®µæ—¶é—´ä»¥ç¡®ä¿æœåŠ¡å™¨æ¥æ”¶åˆ° ACK æŠ¥æ–‡ã€‚æœåŠ¡å™¨æ¥æ”¶åˆ° ACK æŠ¥æ–‡åè¿›å…¥ CLOSED çŠ¶æ€ã€‚å®¢æˆ·ç«¯åœ¨ç­‰å¾…ä¸€æ®µæ—¶é—´åä¹Ÿè¿›å…¥ CLOSED çŠ¶æ€ã€‚ 31.TCP æŒ¥æ‰‹ä¸ºä»€ä¹ˆéœ€è¦å››æ¬¡å‘¢ï¼Ÿå› ä¸º TCP æ˜¯å…¨åŒå·¥é€šä¿¡åè®®ï¼Œæ•°æ®çš„å‘é€å’Œæ¥æ”¶éœ€è¦ä¸¤æ¬¡ä¸€æ¥ä¸€å›ï¼Œä¹Ÿå°±æ˜¯å››æ¬¡ï¼Œæ¥ç¡®ä¿åŒæ–¹éƒ½èƒ½æ­£ç¡®å…³é—­è¿æ¥ã€‚ ç¬¬ä¸€æ¬¡æŒ¥æ‰‹ï¼šå®¢æˆ·ç«¯è¡¨ç¤ºæ•°æ®å‘é€å®Œæˆäº†ï¼Œå‡†å¤‡å…³é—­ï¼Œä½ ç¡®è®¤ä¸€ä¸‹ã€‚ ç¬¬äºŒæ¬¡æŒ¥æ‰‹ï¼šæœåŠ¡ç«¯å›è¯è¯´ okï¼Œæˆ‘é©¬ä¸Šå¤„ç†å®Œæ•°æ®ï¼Œç¨ç­‰ã€‚ ç¬¬ä¸‰æ¬¡æŒ¥æ‰‹ï¼šæœåŠ¡ç«¯è¡¨ç¤ºå¤„ç†å®Œäº†ï¼Œå¯ä»¥å…³é—­äº†ã€‚ ç¬¬å››æ¬¡æŒ¥æ‰‹ï¼šå®¢æˆ·ç«¯è¯´å¥½ï¼Œè¿›å…¥ TIME_WAIT çŠ¶æ€ï¼Œç¡®ä¿æœåŠ¡ç«¯å…³é—­è¿æ¥åï¼Œè‡ªå·±å†å…³é—­è¿æ¥ã€‚ 32.TCP å››æ¬¡æŒ¥æ‰‹è¿‡ç¨‹ä¸­ï¼Œä¸ºä»€ä¹ˆéœ€è¦ç­‰å¾… 2MSL, æ‰è¿›å…¥ CLOSED å…³é—­çŠ¶æ€ï¼Ÿ ä¸ºä»€ä¹ˆéœ€è¦ç­‰å¾…ï¼Ÿ 1. ä¸ºäº†ä¿è¯å®¢æˆ·ç«¯å‘é€çš„æœ€åä¸€ä¸ª ACK æŠ¥æ–‡æ®µèƒ½å¤Ÿåˆ°è¾¾æœåŠ¡ç«¯ã€‚Â è¿™ä¸ª ACK æŠ¥æ–‡æ®µæœ‰å¯èƒ½ä¸¢å¤±ï¼Œå› è€Œä½¿å¤„åœ¨Â LAST-ACKÂ çŠ¶æ€çš„æœåŠ¡ç«¯å°±æ”¶ä¸åˆ°å¯¹å·²å‘é€çš„Â FIN + ACKÂ æŠ¥æ–‡æ®µçš„ç¡®è®¤ã€‚æœåŠ¡ç«¯ä¼šè¶…æ—¶é‡ä¼ è¿™ä¸ª FIN+ACK æŠ¥æ–‡æ®µï¼Œè€Œå®¢æˆ·ç«¯å°±èƒ½åœ¨ 2MSL æ—¶é—´å†…ï¼ˆè¶…æ—¶ + 1MSL ä¼ è¾“ï¼‰æ”¶åˆ°è¿™ä¸ªé‡ä¼ çš„ FIN+ACK æŠ¥æ–‡æ®µã€‚æ¥ç€å®¢æˆ·ç«¯é‡ä¼ ä¸€æ¬¡ç¡®è®¤ï¼Œé‡æ–°å¯åŠ¨ 2MSL è®¡æ—¶å™¨ã€‚æœ€åï¼Œå®¢æˆ·ç«¯å’ŒæœåŠ¡å™¨éƒ½æ­£å¸¸è¿›å…¥åˆ°Â CLOSEDÂ çŠ¶æ€ã€‚ 2. é˜²æ­¢å·²å¤±æ•ˆçš„è¿æ¥è¯·æ±‚æŠ¥æ–‡æ®µå‡ºç°åœ¨æœ¬è¿æ¥ä¸­ã€‚å®¢æˆ·ç«¯åœ¨å‘é€å®Œæœ€åä¸€ä¸ª ACK æŠ¥æ–‡æ®µåï¼Œå†ç»è¿‡æ—¶é—´ 2MSLï¼Œå°±å¯ä»¥ä½¿æœ¬è¿æ¥æŒç»­çš„æ—¶é—´å†…æ‰€äº§ç”Ÿçš„æ‰€æœ‰æŠ¥æ–‡æ®µéƒ½ä»ç½‘ç»œä¸­æ¶ˆå¤±ã€‚è¿™æ ·å°±å¯ä»¥ä½¿ä¸‹ä¸€ä¸ªè¿æ¥ä¸­ä¸ä¼šå‡ºç°è¿™ç§æ—§çš„è¿æ¥è¯·æ±‚æŠ¥æ–‡æ®µã€‚ ä¸ºä»€ä¹ˆç­‰å¾…çš„æ—¶é—´æ˜¯ 2MSLï¼Ÿ MSL æ˜¯ Maximum Segment Lifetimeï¼ŒæŠ¥â½‚æœ€â¼¤â½£å­˜æ—¶é—´ï¼Œå®ƒæ˜¯ä»»ä½•æŠ¥â½‚åœ¨â½¹ç»œä¸Šå­˜åœ¨çš„æœ€â»“æ—¶é—´ï¼Œè¶…è¿‡è¿™ä¸ªæ—¶é—´æŠ¥â½‚å°†è¢«ä¸¢å¼ƒã€‚ TIME_WAIT ç­‰å¾… 2 å€çš„ MSLï¼Œâ½è¾ƒåˆç†çš„è§£é‡Šæ˜¯ï¼šâ½¹ç»œä¸­å¯èƒ½å­˜åœ¨æ¥â¾ƒå‘é€â½…çš„æ•°æ®åŒ…ï¼Œå½“è¿™äº›å‘é€â½…çš„æ•°æ®åŒ…è¢«æ¥æ”¶â½…å¤„ç†åâ¼œä¼šå‘å¯¹â½…å‘é€å“åº”ï¼Œæ‰€ä»¥â¼€æ¥â¼€å›éœ€è¦ç­‰å¾…Â 2Â å€çš„æ—¶é—´ã€‚ â½å¦‚å¦‚æœè¢«åŠ¨å…³é—­â½…æ²¡æœ‰æ”¶åˆ°æ–­å¼€è¿æ¥çš„æœ€åçš„ ACK æŠ¥â½‚ï¼Œå°±ä¼šè§¦å‘è¶…æ—¶é‡å‘ Fin æŠ¥â½‚ï¼Œå¦â¼€â½…æ¥æ”¶åˆ° FIN åï¼Œä¼šé‡å‘ ACK ç»™è¢«åŠ¨å…³é—­â½…ï¼Œ â¼€æ¥â¼€å»æ­£å¥½ 2 ä¸ª MSLã€‚ 33.ä¿æ´»è®¡æ—¶å™¨æœ‰ä»€ä¹ˆç”¨ï¼Ÿé™¤æ—¶é—´ç­‰å¾…è®¡æ—¶å™¨å¤–ï¼ŒTCP è¿˜æœ‰ä¸€ä¸ªä¿æ´»è®¡æ—¶å™¨ï¼ˆkeepalive timerï¼‰ã€‚ è®¾æƒ³è¿™æ ·çš„åœºæ™¯ï¼šå®¢æˆ·å·²ä¸»åŠ¨ä¸æœåŠ¡å™¨å»ºç«‹äº† TCP è¿æ¥ã€‚ä½†åæ¥å®¢æˆ·ç«¯çš„ä¸»æœºçªç„¶å‘ç”Ÿæ•…éšœã€‚æ˜¾ç„¶ï¼ŒæœåŠ¡å™¨ä»¥åå°±ä¸èƒ½å†æ”¶åˆ°å®¢æˆ·ç«¯å‘æ¥çš„æ•°æ®ã€‚å› æ­¤ï¼Œåº”å½“æœ‰æªæ–½ä½¿æœåŠ¡å™¨ä¸è¦å†ç™½ç™½ç­‰å¾…ä¸‹å»ã€‚è¿™å°±éœ€è¦ä½¿ç”¨ä¿æ´»è®¡æ—¶å™¨äº†ã€‚ æœåŠ¡å™¨æ¯æ”¶åˆ°ä¸€æ¬¡å®¢æˆ·ç«¯çš„æ•°æ®ï¼Œå°±é‡æ–°è®¾ç½®ä¿æ´»è®¡æ—¶å™¨ï¼Œæ—¶é—´çš„è®¾ç½®é€šå¸¸æ˜¯ä¸¤ä¸ªå°æ—¶ã€‚è‹¥ä¸¤ä¸ªå°æ—¶éƒ½æ²¡æœ‰æ”¶åˆ°å®¢æˆ·ç«¯çš„æ•°æ®ï¼ŒæœåŠ¡ç«¯å°±å‘é€ä¸€ä¸ªæ¢æµ‹æŠ¥æ–‡æ®µï¼Œä»¥ååˆ™æ¯éš” 75 ç§’é’Ÿå‘é€ä¸€æ¬¡ã€‚è‹¥è¿ç»­å‘é€ 10 ä¸ªæ¢æµ‹æŠ¥æ–‡æ®µåä»ç„¶æ— å®¢æˆ·ç«¯çš„å“åº”ï¼ŒæœåŠ¡ç«¯å°±è®¤ä¸ºå®¢æˆ·ç«¯å‡ºäº†æ•…éšœï¼Œæ¥ç€å°±å…³é—­è¿™ä¸ªè¿æ¥ã€‚ 34.CLOSE-WAIT å’Œ TIME-WAIT çš„çŠ¶æ€å’Œæ„ä¹‰ï¼ŸCLOSE-WAIT çŠ¶æ€æœ‰ä»€ä¹ˆæ„ä¹‰ï¼ŸæœåŠ¡ç«¯æ”¶åˆ°å®¢æˆ·ç«¯å…³é—­è¿æ¥çš„è¯·æ±‚å¹¶ç¡®è®¤ä¹‹åï¼Œå°±ä¼šè¿›å…¥ CLOSE-WAIT çŠ¶æ€ã€‚æ­¤æ—¶æœåŠ¡ç«¯å¯èƒ½è¿˜æœ‰ä¸€äº›æ•°æ®æ²¡æœ‰ä¼ è¾“å®Œæˆï¼Œå› æ­¤ä¸èƒ½ç«‹å³å…³é—­è¿æ¥ï¼Œè€Œ CLOSE-WAIT çŠ¶æ€å°±æ˜¯ä¸ºäº†ä¿è¯æœåŠ¡ç«¯åœ¨å…³é—­è¿æ¥ä¹‹å‰å°†å¾…å‘é€çš„æ•°æ®å¤„ç†å®Œã€‚ TIME-WAIT æœ‰ä»€ä¹ˆæ„ä¹‰ï¼ŸTIME-WAIT å‘ç”Ÿåœ¨ç¬¬å››æ¬¡æŒ¥æ‰‹ï¼Œå½“å®¢æˆ·ç«¯åœ¨å‘é€ ACK ç¡®è®¤å¯¹æ–¹çš„ FIN æŠ¥æ–‡åï¼Œä¼šè¿›å…¥ TIME_WAIT çŠ¶æ€ã€‚ å®ƒå­˜åœ¨çš„æ„ä¹‰ä¸»è¦æœ‰ä¸¤ä¸ªï¼š åœ¨ TIME_WAIT çŠ¶æ€ä¸­ï¼Œå®¢æˆ·ç«¯å¯ä»¥é‡æ–°å‘é€ ACK ç¡®ä¿å¯¹æ–¹æ­£å¸¸å…³é—­è¿æ¥ã€‚ åœ¨ TIME_WAIT æŒç»­çš„ 2MSL æ—¶é—´åï¼Œç¡®ä¿æ—§æ•°æ®åŒ…å®Œå…¨æ¶ˆå¤±ï¼Œé¿å…å®ƒä»¬å¹²æ‰°æœªæ¥å»ºç«‹çš„æ–°è¿æ¥ã€‚ è¡¥å……ï¼šMSLï¼ˆMaximum Segment Lifetimeï¼‰ï¼šTCP æŠ¥æ–‡æ®µåœ¨ç½‘ç»œä¸­çš„æœ€å¤§å­˜æ´»æ—¶é—´ï¼Œé€šå¸¸ä¸º 30 ç§’åˆ° 2 åˆ†é’Ÿ 35.TIME_WAIT çŠ¶æ€è¿‡å¤šä¼šå¯¼è‡´ä»€ä¹ˆé—®é¢˜ï¼Ÿæ€ä¹ˆè§£å†³ï¼Ÿ TIME_WAIT çŠ¶æ€è¿‡å¤šä¼šå¯¼è‡´ä»€ä¹ˆé—®é¢˜? å¦‚æœæœåŠ¡å™¨æœ‰å¤„äº TIME-WAIT çŠ¶æ€çš„ TCPï¼Œåˆ™è¯´æ˜æ˜¯ç”±æœåŠ¡å™¨â½…ä¸»åŠ¨å‘èµ·çš„æ–­å¼€è¯·æ±‚ã€‚ è¿‡å¤šçš„ TIME-WAIT çŠ¶æ€ä¸»è¦çš„å±å®³æœ‰ä¸¤ç§ï¼š ç¬¬â¼€æ˜¯å†…å­˜èµ„æºå â½¤ï¼› ç¬¬â¼†æ˜¯å¯¹ç«¯â¼èµ„æºçš„å â½¤ï¼Œâ¼€ä¸ª TCP è¿æ¥â¾„å°‘æ¶ˆè€—â¼€ä¸ªæœ¬åœ°ç«¯â¼ï¼› æ€ä¹ˆè§£å†³ TIME_WAIT çŠ¶æ€è¿‡å¤šï¼Ÿ æœåŠ¡å™¨å¯ä»¥è®¾ç½® SO_REUSEADDR å¥—æ¥å­—æ¥é€šçŸ¥å†…æ ¸ï¼Œå¦‚æœç«¯å£è¢«å ç”¨ï¼Œä½†æ˜¯ TCP è¿æ¥ä½äº TIME_WAIT çŠ¶æ€æ—¶å¯ä»¥é‡ç”¨ç«¯å£ã€‚ è¿˜å¯ä»¥ä½¿ç”¨é•¿è¿æ¥çš„æ–¹å¼æ¥å‡å°‘ TCP çš„è¿æ¥å’Œæ–­å¼€ï¼Œåœ¨é•¿è¿æ¥çš„ä¸šåŠ¡é‡Œå¾€å¾€ä¸éœ€è¦è€ƒè™‘ TIME_WAIT çŠ¶æ€ã€‚ 36.è¯´è¯´ TCP æŠ¥æ–‡å¤´éƒ¨çš„æ ¼å¼ï¼Ÿä¸€ä¸ª TCP æŠ¥æ–‡æ®µä¸»è¦ç”±æŠ¥æ–‡æ®µå¤´éƒ¨ï¼ˆHeaderï¼‰å’Œæ•°æ®ä¸¤éƒ¨åˆ†ç»„æˆã€‚å¤´éƒ¨åŒ…å«äº†ç¡®ä¿æ•°æ®å¯é ä¼ è¾“æ‰€éœ€çš„å„ç§æ§åˆ¶ä¿¡æ¯ï¼Œæ¯”å¦‚è¯´åºåˆ—å·ã€ç¡®è®¤å·ã€çª—å£å¤§å°ç­‰ã€‚ æºç«¯å£å·ï¼ˆSource Portï¼‰ï¼š16 ä½ï¼ˆ2 ä¸ªå­—èŠ‚ï¼‰ï¼Œç”¨äºæ ‡è¯†å‘é€ç«¯çš„åº”ç”¨ç¨‹åºã€‚ ç›®æ ‡ç«¯å£å·ï¼ˆDestination Portï¼‰ï¼šä¹Ÿæ˜¯ 16 ä½ï¼Œç”¨äºæ ‡è¯†æ¥æ”¶ç«¯çš„åº”ç”¨ç¨‹åºã€‚ åºåˆ—å·ï¼ˆSequence Numberï¼‰ï¼š32 ä½ï¼Œç”¨äºæ ‡è¯†ä» TCP å‘é€è€…å‘é€çš„æ•°æ®å­—èŠ‚æµä¸­çš„ç¬¬ä¸€ä¸ªå­—èŠ‚çš„é¡ºåºå·ã€‚ç¡®ä¿æ•°æ®æŒ‰é¡ºåºæ¥æ”¶ã€‚ ç¡®è®¤å·ï¼ˆAcknowledgment Numberï¼‰ï¼š32 ä½ï¼Œå¦‚æœ ACK æ ‡å¿—è¢«è®¾ç½®ï¼Œåˆ™è¯¥å­—æ®µåŒ…å«å‘é€ç¡®è®¤çš„åºåˆ—å·ï¼Œå³æ¥æ”¶ TCP å¸Œæœ›æ”¶åˆ°çš„ä¸‹ä¸€ä¸ªåºåˆ—å·ã€‚ æ•°æ®åç§»ï¼ˆData Offsetï¼‰ï¼š4 ä½ï¼Œè¡¨ç¤º TCP æŠ¥æ–‡å¤´éƒ¨çš„é•¿åº¦ï¼Œç”¨äºæŒ‡ç¤ºæ•°æ®å¼€å§‹çš„ä½ç½®ã€‚ ä¿ç•™ï¼ˆReservedï¼‰ï¼š6 ä½ï¼Œä¸ºå°†æ¥ä½¿ç”¨é¢„ç•™ï¼Œç›®å‰å¿…é¡»ç½®ä¸º 0ã€‚ æ§åˆ¶ä½ï¼ˆFlagsï¼‰ï¼šå…± 6 ä½ï¼ŒåŒ…æ‹¬ URGï¼ˆç´§æ€¥æŒ‡é’ˆå­—æ®µæ˜¯å¦æœ‰æ•ˆï¼‰ã€ACKï¼ˆç¡®è®¤å­—æ®µæ˜¯å¦æœ‰æ•ˆï¼‰ã€PSHï¼ˆæç¤ºæ¥æ”¶ç«¯åº”è¯¥å°½å¿«å°†è¿™ä¸ªæŠ¥æ–‡æ®µäº¤ç»™åº”ç”¨å±‚ï¼‰ã€RSTï¼ˆé‡ç½®è¿æ¥ï¼‰ã€SYNï¼ˆåŒæ­¥åºå·ï¼Œç”¨äºå»ºç«‹è¿æ¥ï¼‰ã€FINï¼ˆç»“æŸå‘é€æ•°æ®ï¼‰ã€‚ çª—å£å¤§å°ï¼ˆWindowï¼‰ï¼š16 ä½ï¼Œç”¨äºæµé‡æ§åˆ¶ï¼Œè¡¨ç¤ºæ¥æ”¶ç«¯è¿˜èƒ½æ¥æ”¶çš„æ•°æ®çš„å­—èŠ‚æ•°ï¼ˆåŸºäºæ¥æ”¶ç¼“å†²åŒºçš„å¤§å°ï¼‰ã€‚ æ ¡éªŒå’Œï¼ˆChecksumï¼‰ï¼š16 ä½ï¼Œè¦†ç›–æ•´ä¸ª TCP æŠ¥æ–‡æ®µï¼ˆåŒ…æ‹¬ TCP å¤´éƒ¨ã€æ•°æ®å’Œä¸€ä¸ªä¼ªå¤´éƒ¨ï¼‰çš„æ ¡éªŒå’Œï¼Œç”¨äºæ£€æµ‹æ•°æ®åœ¨ä¼ è¾“è¿‡ç¨‹ä¸­çš„ä»»ä½•å˜åŒ–ã€‚ ç´§æ€¥æŒ‡é’ˆï¼ˆUrgent Pointerï¼‰ï¼š16 ä½ï¼Œåªæœ‰å½“ URG æ§åˆ¶ä½è¢«è®¾ç½®æ—¶æ‰æœ‰æ•ˆï¼ŒæŒ‡å‡ºåœ¨æŠ¥æ–‡æ®µä¸­æœ‰ç´§æ€¥æ•°æ®çš„ä½ç½®ã€‚ 37.TCP ä¸ºä»€ä¹ˆå¯é ï¼ŸTCP é¦–å…ˆé€šè¿‡ä¸‰æ¬¡æ¡æ‰‹å’Œå››æ¬¡æŒ¥æ‰‹æ¥ä¿è¯è¿æ¥çš„å¯é æ€§ï¼Œç„¶åé€šè¿‡æ ¡éªŒå’Œã€åºåˆ—å·ã€ç¡®è®¤åº”ç­”ã€è¶…æ—¶é‡ä¼ ã€æ»‘åŠ¨çª—å£ç­‰æœºåˆ¶æ¥ä¿è¯æ•°æ®çš„å¯é ä¼ è¾“ã€‚ æ¨èé˜…è¯»ï¼šTCP æ ¡éªŒå’Œè®¡ç®—æ–¹æ³• â‘ ã€æ ¡éªŒå’Œï¼šTCP æŠ¥æ–‡æ®µåŒ…æ‹¬ä¸€ä¸ªæ ¡éªŒå’Œå­—æ®µï¼Œç”¨äºæ£€æµ‹æŠ¥æ–‡æ®µåœ¨ä¼ è¾“è¿‡ç¨‹ä¸­çš„å˜åŒ–ã€‚å¦‚æœæ¥æ”¶æ–¹æ£€æµ‹åˆ°æ ¡éªŒå’Œé”™è¯¯ï¼Œå°±ä¼šä¸¢å¼ƒè¿™ä¸ªæŠ¥æ–‡æ®µã€‚ â‘¡ã€åºåˆ—å·ç¡®è®¤æœºåˆ¶ï¼šTCP å°†æ•°æ®åˆ†æˆå¤šä¸ªå°æ®µï¼Œæ¯æ®µæ•°æ®éƒ½æœ‰å”¯ä¸€çš„åºåˆ—å·ï¼Œä»¥ç¡®ä¿æ•°æ®åŒ…çš„é¡ºåºä¼ è¾“å’Œå®Œæ•´æ€§ã€‚åŒæ—¶ï¼Œå‘é€æ–¹å¦‚æœæ²¡æœ‰æ”¶åˆ°æ¥æ”¶æ–¹çš„ç¡®è®¤åº”ç­”ï¼Œä¼šé‡ä¼ æ•°æ®ã€‚ â‘¢ã€æµé‡æ§åˆ¶ï¼šæ¥æ”¶æ–¹ä¼šå‘é€çª—å£å¤§å°å‘Šè¯‰å‘é€æ–¹å®ƒçš„æ¥æ”¶èƒ½åŠ›ã€‚å‘é€æ–¹ä¼šæ ¹æ®çª—å£å¤§å°è°ƒæ•´å‘é€é€Ÿåº¦ï¼Œé¿å…ç½‘ç»œæ‹¥å¡ã€‚ â‘£ã€è¶…æ—¶é‡ä¼ ï¼šå¦‚æœå‘é€æ–¹å‘é€çš„æ•°æ®åŒ…è¶…è¿‡äº†æœ€å¤§ç”Ÿå­˜æ—¶é—´ï¼Œæ¥æ”¶æ–¹è¿˜æ²¡æœ‰æ”¶åˆ°ï¼Œå‘é€æ–¹ä¼šé‡ä¼ æ•°æ®åŒ…ä»¥ä¿è¯ä¸¢å¤±æ•°æ®é‡æ–°ä¼ è¾“ã€‚ â‘¤ã€æ‹¥å¡æ§åˆ¶ï¼šTCP ä¼šé‡‡ç”¨æ…¢å¯åŠ¨çš„ç­–ç•¥ï¼Œä¸€å¼€å§‹å‘çš„å°‘ï¼Œç„¶åé€æ­¥å¢åŠ ï¼Œå½“æ£€æµ‹åˆ°ç½‘ç»œæ‹¥å¡æ—¶ï¼Œä¼šé™ä½å‘é€é€Ÿç‡ã€‚åœ¨ç½‘ç»œæ‹¥å¡ç¼“è§£åï¼Œä¼ è¾“é€Ÿç‡ä¹Ÿä¼šè‡ªåŠ¨æ¢å¤ã€‚ 38.è¯´è¯´ TCP çš„æµé‡æ§åˆ¶ï¼ŸTCP æä¾›äº†ä¸€ç§æœºåˆ¶ï¼Œå¯ä»¥è®©å‘é€ç«¯æ ¹æ®æ¥æ”¶ç«¯çš„å®é™…æ¥æ”¶èƒ½åŠ›æ§åˆ¶å‘é€çš„æ•°æ®é‡ï¼Œè¿™å°±æ˜¯æµé‡æ§åˆ¶ã€‚TCP é€šè¿‡æ»‘åŠ¨çª—å£æ¥æ§åˆ¶æµé‡ï¼Œæˆ‘ä»¬çœ‹ä¸‹ç®€è¦æµç¨‹ï¼š é¦–å…ˆåŒæ–¹ä¸‰æ¬¡æ¡æ‰‹ï¼Œåˆå§‹åŒ–å„è‡ªçš„çª—å£å¤§å°ï¼Œå‡ä¸º 400 ä¸ªå­—èŠ‚ã€‚ å‡å¦‚å½“å‰å‘é€æ–¹ç»™æ¥æ”¶æ–¹å‘é€äº† 200 ä¸ªå­—èŠ‚ï¼Œé‚£ä¹ˆï¼Œå‘é€æ–¹çš„SND.NXTä¼šå³ç§» 200 ä¸ªå­—èŠ‚ï¼Œä¹Ÿå°±æ˜¯è¯´å½“å‰çš„å¯ç”¨çª—å£å‡å°‘äº† 200 ä¸ªå­—èŠ‚ã€‚ æ¥å—æ–¹æ”¶åˆ°åï¼Œæ”¾åˆ°ç¼“å†²é˜Ÿåˆ—é‡Œé¢ï¼ŒREV.WND 400-200200 å­—èŠ‚ï¼Œæ‰€ä»¥ win200 å­—èŠ‚è¿”å›ç»™å‘é€æ–¹ã€‚æ¥æ”¶æ–¹ä¼šåœ¨ ACK çš„æŠ¥æ–‡é¦–éƒ¨å¸¦ä¸Šç¼©å°åçš„æ»‘åŠ¨çª—å£ 200 å­—èŠ‚ å‘é€æ–¹åˆå‘é€ 200 å­—èŠ‚è¿‡æ¥ï¼Œ200 å­—èŠ‚åˆ°è¾¾ï¼Œç»§ç»­æ”¾åˆ°ç¼“å†²é˜Ÿåˆ—ã€‚ä¸è¿‡è¿™æ—¶å€™ï¼Œç”±äºå¤§é‡è´Ÿè½½çš„åŸå› ï¼Œæ¥å—æ–¹å¤„ç†ä¸äº†è¿™ä¹ˆå¤šå­—èŠ‚ï¼Œåªèƒ½å¤„ç† 100 å­—èŠ‚ï¼Œå‰©ä½™çš„ 100 å­—èŠ‚ç»§ç»­æ”¾åˆ°ç¼“å†²é˜Ÿåˆ—ã€‚è¿™æ—¶å€™ï¼ŒREV.WND 400-200-100100 å­—èŠ‚ï¼Œå³ win100 è¿”å›å‘é€æ–¹ã€‚ å‘é€æ–¹ç»§ç»­å‘é€ 100 å­—èŠ‚è¿‡æ¥ï¼Œè¿™æ—¶å€™ï¼Œæ¥æ”¶çª—å£ win å˜ä¸º 0ã€‚ å‘é€æ–¹åœæ­¢å‘é€ï¼Œå¼€å¯ä¸€ä¸ªå®šæ—¶ä»»åŠ¡ï¼Œæ¯éš”ä¸€æ®µæ—¶é—´ï¼Œå°±å»è¯¢é—®æ¥å—æ–¹ï¼Œç›´åˆ° win å¤§äº 0ï¼Œæ‰ç»§ç»­å¼€å§‹å‘é€ã€‚ 39.è¯¦ç»†è¯´è¯´ TCP çš„æ»‘åŠ¨çª—å£ï¼ŸTCP å‘é€ä¸€ä¸ªæ•°æ®ï¼Œå¦‚æœéœ€è¦æ”¶åˆ°ç¡®è®¤åº”ç­”ï¼Œæ‰ä¼šå‘é€ä¸‹ä¸€ä¸ªæ•°æ®ã€‚è¿™æ ·çš„è¯å°±ä¼šæœ‰ä¸ªç¼ºç‚¹ï¼šæ•ˆç‡ä¼šæ¯”è¾ƒä½ã€‚ â€œç”¨ä¸€ä¸ªæ¯”å–»ï¼Œæˆ‘ä»¬åœ¨å¾®ä¿¡ä¸ŠèŠå¤©ï¼Œä½ æ‰“å®Œä¸€å¥è¯ï¼Œæˆ‘å›å¤ä¸€å¥ä¹‹åï¼Œä½ æ‰èƒ½æ‰“ä¸‹ä¸€å¥ã€‚å‡å¦‚æˆ‘æ²¡æœ‰åŠæ—¶å›å¤å‘¢ï¼Ÿä½ æ˜¯æŠŠè¯æ†‹ç€ä¸è¯´å—ï¼Ÿç„¶åå‚»å‚»ç­‰åˆ°æˆ‘å›å¤ä¹‹åå†æ¥ç€å‘ä¸‹ä¸€å¥ï¼Ÿâ€ ä¸ºäº†è§£å†³è¿™ä¸ªé—®é¢˜ï¼ŒTCP å¼•å…¥äº†çª—å£ï¼Œå®ƒæ˜¯æ“ä½œç³»ç»Ÿå¼€è¾Ÿçš„ä¸€ä¸ªç¼“å­˜ç©ºé—´ã€‚çª—å£å¤§å°å€¼è¡¨ç¤ºæ— éœ€ç­‰å¾…ç¡®è®¤åº”ç­”ï¼Œè€Œå¯ä»¥ç»§ç»­å‘é€æ•°æ®çš„æœ€å¤§å€¼ã€‚ TCP å¤´éƒ¨æœ‰ä¸ªå­—æ®µå« winï¼Œä¹Ÿå³é‚£ä¸ªÂ 16 ä½çš„çª—å£å¤§å°ï¼Œå®ƒå‘Šè¯‰å¯¹æ–¹æœ¬ç«¯çš„ TCP æ¥æ”¶ç¼“å†²åŒºè¿˜èƒ½å®¹çº³å¤šå°‘å­—èŠ‚çš„æ•°æ®ï¼Œè¿™æ ·å¯¹æ–¹å°±å¯ä»¥æ§åˆ¶å‘é€æ•°æ®çš„é€Ÿåº¦ï¼Œä»è€Œè¾¾åˆ°æµé‡æ§åˆ¶çš„ç›®çš„ã€‚ â€œé€šä¿—ç‚¹è®²ï¼Œå°±æ˜¯æ¥å—æ–¹æ¯æ¬¡æ”¶åˆ°æ•°æ®åŒ…ï¼Œåœ¨å‘é€ç¡®è®¤æŠ¥æ–‡çš„æ—¶å€™ï¼ŒåŒæ—¶å‘Šè¯‰å‘é€æ–¹ï¼Œè‡ªå·±çš„ç¼“å­˜åŒºè¿˜æœ‰å¤šå°‘ç©ºä½™ç©ºé—´ï¼Œç¼“å†²åŒºçš„ç©ºä½™ç©ºé—´ï¼Œæˆ‘ä»¬å°±ç§°ä¹‹ä¸ºæ¥å—çª—å£å¤§å°ã€‚è¿™å°±æ˜¯ winã€‚â€ TCP æ»‘åŠ¨çª—å£åˆ†ä¸ºä¸¤ç§: å‘é€çª—å£å’Œæ¥æ”¶çª—å£ã€‚å‘é€ç«¯çš„æ»‘åŠ¨çª—å£åŒ…å«å››å¤§éƒ¨åˆ†ï¼Œå¦‚ä¸‹ï¼š å·²å‘é€ä¸”å·²æ”¶åˆ° ACK ç¡®è®¤ å·²å‘é€ä½†æœªæ”¶åˆ° ACK ç¡®è®¤ æœªå‘é€ä½†å¯ä»¥å‘é€ æœªå‘é€ä¹Ÿä¸å¯ä»¥å‘é€ æ·±è“è‰²æ¡†é‡Œå°±æ˜¯å‘é€çª—å£ã€‚ SND.WND: è¡¨ç¤ºå‘é€çª—å£çš„å¤§å°, ä¸Šå›¾è™šçº¿æ¡†çš„æ ¼å­æ•°æ˜¯ 10 ä¸ªï¼Œå³å‘é€çª—å£å¤§å°æ˜¯ 10ã€‚ SND.NXTï¼šä¸‹ä¸€ä¸ªå‘é€çš„ä½ç½®ï¼Œå®ƒæŒ‡å‘æœªå‘é€ä½†å¯ä»¥å‘é€çš„ç¬¬ä¸€ä¸ªå­—èŠ‚çš„åºåˆ—å·ã€‚ SND.UNA: ä¸€ä¸ªç»å¯¹æŒ‡é’ˆï¼Œå®ƒæŒ‡å‘çš„æ˜¯å·²å‘é€ä½†æœªç¡®è®¤çš„ç¬¬ä¸€ä¸ªå­—èŠ‚çš„åºåˆ—å·ã€‚ æ¥æ”¶æ–¹çš„æ»‘åŠ¨çª—å£åŒ…å«ä¸‰å¤§éƒ¨åˆ†ï¼Œå¦‚ä¸‹ï¼š å·²æˆåŠŸæ¥æ”¶å¹¶ç¡®è®¤ æœªæ”¶åˆ°æ•°æ®ä½†å¯ä»¥æ¥æ”¶ æœªæ”¶åˆ°æ•°æ®å¹¶ä¸å¯ä»¥æ¥æ”¶çš„æ•°æ® è“è‰²æ¡†å†…ï¼Œå°±æ˜¯æ¥æ”¶çª—å£ã€‚ REV.WND: è¡¨ç¤ºæ¥æ”¶çª—å£çš„å¤§å°, ä¸Šå›¾è™šçº¿æ¡†çš„æ ¼å­å°±æ˜¯ 9 ä¸ªã€‚ REV.NXT: ä¸‹ä¸€ä¸ªæ¥æ”¶çš„ä½ç½®ï¼Œå®ƒæŒ‡å‘æœªæ”¶åˆ°ä½†å¯ä»¥æ¥æ”¶çš„ç¬¬ä¸€ä¸ªå­—èŠ‚çš„åºåˆ—å·ã€‚ 40.äº†è§£ Nagle ç®—æ³•å’Œå»¶è¿Ÿç¡®è®¤å—ï¼Ÿ Nagle ç®—æ³•å’Œå»¶è¿Ÿç¡®è®¤æ˜¯å¹²ä»€ä¹ˆçš„ï¼Ÿ å½“æˆ‘ä»¬ TCP æŠ¥â½‚çš„æ‰¿è½½çš„æ•°æ®â¾®å¸¸â¼©çš„æ—¶å€™ï¼Œä¾‹å¦‚â¼ä¸ªå­—èŠ‚ï¼Œé‚£ä¹ˆæ•´ä¸ªâ½¹ç»œçš„æ•ˆç‡æ˜¯å¾ˆä½çš„ï¼Œå› ä¸ºæ¯ä¸ª TCP æŠ¥â½‚ä¸­éƒ½ä¼šæœ‰ 20 ä¸ªå­—èŠ‚çš„ TCP å¤´éƒ¨ï¼Œä¹Ÿä¼šæœ‰ 20 ä¸ªå­—èŠ‚çš„ IP å¤´éƒ¨ï¼Œâ½½æ•°æ®åªæœ‰â¼ä¸ªå­—èŠ‚ï¼Œæ‰€ä»¥åœ¨æ•´ä¸ªæŠ¥â½‚ä¸­æœ‰æ•ˆæ•°æ®å æœ‰çš„æ¯”ä¾‹å°±ä¼šâ¾®å¸¸ä½ã€‚ è¿™å°±å¥½åƒå¿«é€’å‘˜å¼€ç€â¼¤è´§â»‹é€â¼€ä¸ªâ¼©åŒ…è£¹â¼€æ ·æµªè´¹ã€‚ é‚£ä¹ˆå°±å‡ºç°äº†å¸¸â»…çš„ä¸¤ç§ç­–ç•¥ï¼Œæ¥å‡å°‘â¼©æŠ¥â½‚çš„ä¼ è¾“ï¼Œåˆ†åˆ«æ˜¯ï¼š Nagle ç®—æ³• å»¶è¿Ÿç¡®è®¤ Nagle ç®—æ³• Nagle ç®—æ³•ï¼šä»»æ„æ—¶åˆ»ï¼Œæœ€å¤šåªèƒ½æœ‰ä¸€ä¸ªæœªè¢«ç¡®è®¤çš„å°æ®µã€‚æ‰€è°“ â€œå°æ®µâ€ï¼ŒæŒ‡çš„æ˜¯å°äº MSS å°ºå¯¸çš„æ•°æ®å—ï¼Œæ‰€è°“ â€œæœªè¢«ç¡®è®¤â€ï¼Œæ˜¯æŒ‡ä¸€ä¸ªæ•°æ®å—å‘é€å‡ºå»åï¼Œæ²¡æœ‰æ”¶åˆ°å¯¹æ–¹å‘é€çš„ ACK ç¡®è®¤è¯¥æ•°æ®å·²æ”¶åˆ°ã€‚ Nagle ç®—æ³•çš„ç­–ç•¥ï¼š æ²¡æœ‰å·²å‘é€æœªç¡®è®¤æŠ¥â½‚æ—¶ï¼Œâ½´åˆ»å‘é€æ•°æ®ã€‚ å­˜åœ¨æœªç¡®è®¤æŠ¥â½‚æ—¶ï¼Œç›´åˆ°ã€Œæ²¡æœ‰å·²å‘é€æœªç¡®è®¤æŠ¥â½‚ã€æˆ–ã€Œæ•°æ®â»“åº¦è¾¾åˆ° MSS â¼¤â¼©ã€æ—¶ï¼Œå†å‘é€æ•°æ®ã€‚ åªè¦æ²¡æ»¡â¾œä¸Šâ¾¯æ¡ä»¶ä¸­çš„â¼€æ¡ï¼Œå‘é€â½…â¼€ç›´åœ¨å›¤ç§¯æ•°æ®ï¼Œç›´åˆ°æ»¡â¾œä¸Šâ¾¯çš„å‘é€æ¡ä»¶ã€‚ å»¶è¿Ÿç¡®è®¤ äº‹å®ä¸Šå½“æ²¡æœ‰æºå¸¦æ•°æ®çš„ ACKï¼Œå®ƒçš„â½¹ç»œæ•ˆç‡ä¹Ÿæ˜¯å¾ˆä½çš„ï¼Œå› ä¸ºå®ƒä¹Ÿæœ‰ 40 ä¸ªå­—èŠ‚çš„ IP å¤´ å’Œ TCP å¤´ï¼Œä½†å´æ²¡æœ‰æºå¸¦æ•°æ®æŠ¥â½‚ã€‚ ä¸ºäº†è§£å†³ ACK ä¼ è¾“æ•ˆç‡ä½é—®é¢˜ï¼Œæ‰€ä»¥å°±è¡â½£å‡ºäº†Â TCPÂ å»¶è¿Ÿç¡®è®¤ã€‚ TCP å»¶è¿Ÿç¡®è®¤çš„ç­–ç•¥ï¼š å½“æœ‰å“åº”æ•°æ®è¦å‘é€æ—¶ï¼ŒACK ä¼šéšç€å“åº”æ•°æ®â¼€èµ·â½´åˆ»å‘é€ç»™å¯¹â½… å½“æ²¡æœ‰å“åº”æ•°æ®è¦å‘é€æ—¶ï¼ŒACK å°†ä¼šå»¶è¿Ÿâ¼€æ®µæ—¶é—´ï¼Œä»¥ç­‰å¾…æ˜¯å¦æœ‰å“åº”æ•°æ®å¯ä»¥â¼€èµ·å‘é€ å¦‚æœåœ¨å»¶è¿Ÿç­‰å¾…å‘é€ ACK æœŸé—´ï¼Œå¯¹â½…çš„ç¬¬â¼†ä¸ªæ•°æ®æŠ¥â½‚â¼œåˆ°è¾¾äº†ï¼Œè¿™æ—¶å°±ä¼šâ½´åˆ»å‘é€ ACK ä¸€èˆ¬æƒ…å†µä¸‹ï¼ŒNagle ç®—æ³•å’Œå»¶è¿Ÿç¡®è®¤ä¸èƒ½ä¸€èµ·ä½¿ç”¨ï¼ŒNagle ç®—æ³•æ„å‘³ç€å»¶è¿Ÿå‘ï¼Œå»¶è¿Ÿç¡®è®¤æ„å‘³ç€å»¶è¿Ÿæ¥æ”¶ï¼Œä¸¤ä¸ªå‡‘åœ¨ä¸€èµ·å°±ä¼šé€ æˆæ›´å¤§çš„å»¶è¿Ÿï¼Œä¼šäº§ç”Ÿæ€§èƒ½é—®é¢˜ã€‚ 41.è¯´è¯´ TCP çš„æ‹¥å¡æ§åˆ¶ï¼Ÿä»€ä¹ˆæ˜¯æ‹¥å¡æ§åˆ¶ï¼Ÿæµé‡æ§åˆ¶æ˜¯ä¸ºäº†é¿å…å‘é€â½…çš„æ•°æ®å¡«æ»¡æ¥æ”¶â½…çš„ç¼“å­˜ï¼Œä½†å¹¶ä¸èƒ½æ§åˆ¶æ•´ä¸ªâ½¹ç»œã€‚ â¼€èˆ¬æ¥è¯´ï¼Œè®¡ç®—æœºâ½¹ç»œä¼šå¤„åœ¨â¼€ä¸ªå…±äº«çš„ç¯å¢ƒã€‚å› æ­¤ä¹Ÿæœ‰å¯èƒ½ä¼šå› ä¸ºå…¶ä»–ä¸»æœºä¹‹é—´çš„é€šä¿¡ä½¿å¾—â½¹ç»œæ‹¥å µã€‚ å½“â½¹ç»œå‡ºç°æ‹¥å µæ—¶ï¼Œå¦‚æœç»§ç»­å‘é€â¼¤é‡æ•°æ®åŒ…ï¼Œå¯èƒ½ä¼šå¯¼è‡´æ•°æ®åŒ…å»¶æ—¶ã€ä¸¢å¤±ç­‰ï¼Œè¿™æ—¶Â TCPÂ å°±ä¼šé‡ä¼ æ•°æ®ï¼Œä½†é‡ä¼ ä¼šå¢åŠ â½¹ç»œè´Ÿæ‹…ï¼Œäºæ˜¯ä¼šå¯¼è‡´æ›´â¼¤çš„å»¶è¿Ÿä»¥åŠæ›´å¤šçš„ä¸¢åŒ…ï¼Œå°±è¿›â¼Šäº†æ¶æ€§å¾ªç¯â€¦. æ‰€ä»¥ï¼ŒTCP è¢«è®¾è®¡æˆäº†â¼€ä¸ªéå¸¸â½†ç§çš„åè®®ï¼Œå½“â½¹ç»œå‘é€æ‹¥å¡æ—¶ï¼ŒTCP ä¼šâ¾ƒæˆ‘ç‰ºç‰²ï¼Œé™ä½å‘é€çš„æ•°æ®æµã€‚ æ‹¥å¡æ§åˆ¶çš„â½¬çš„å°±æ˜¯é¿å…å‘é€â½…çš„æ•°æ®å¡«æ»¡æ•´ä¸ªâ½¹ç»œã€‚ å°±åƒæ˜¯ä¸€ä¸ªæ°´ç®¡ï¼Œä¸èƒ½è®©å¤ªå¤šçš„æ°´ï¼ˆæ•°æ®æµï¼‰æµå…¥æ°´ç®¡ï¼Œå¦‚æœè¶…è¿‡æ°´ç®¡çš„æ‰¿å—èƒ½åŠ›ï¼Œæ°´ç®¡ä¼šè¢«æ’‘çˆ†ï¼ˆä¸¢åŒ…ï¼‰ã€‚ å‘é€æ–¹ä¼šç»´æŠ¤ä¸€ä¸ªæ‹¥å¡çª—å£ cwndÂ çš„å˜é‡ï¼Œè°ƒèŠ‚æ‰€è¦å‘é€æ•°æ®çš„é‡ã€‚ ä»€ä¹ˆæ˜¯æ‹¥å¡çª—â¼ï¼Ÿå’Œå‘é€çª—â¼æœ‰ä»€ä¹ˆå…³ç³»å‘¢ï¼Ÿæ‹¥å¡çª—â¼Â cwndæ˜¯å‘é€â½…ç»´æŠ¤çš„â¼€ä¸ªçš„çŠ¶æ€å˜é‡ï¼Œå®ƒä¼šæ ¹æ®â½¹ç»œçš„æ‹¥å¡ç¨‹åº¦åŠ¨æ€å˜åŒ–çš„ã€‚ å‘é€çª—â¼ swnd å’Œæ¥æ”¶çª—â¼ rwnd æ˜¯çº¦ç­‰äºçš„å…³ç³»ï¼Œé‚£ä¹ˆç”±äºåŠ â¼Šäº†æ‹¥å¡çª—â¼çš„æ¦‚å¿µåï¼Œæ­¤æ—¶å‘é€çª—â¼çš„å€¼æ˜¯ swnd = min(cwnd, rwnd)ï¼Œä¹Ÿå°±æ˜¯æ‹¥å¡çª—â¼å’Œæ¥æ”¶çª—â¼ä¸­çš„æœ€â¼©å€¼ã€‚ æ‹¥å¡çª—â¼ cwnd å˜åŒ–çš„è§„åˆ™ï¼š åªè¦â½¹ç»œä¸­æ²¡æœ‰å‡ºç°æ‹¥å¡ï¼Œ cwnd å°±ä¼šå¢â¼¤ï¼› ä½†â½¹ç»œä¸­å‡ºç°äº†æ‹¥å¡ï¼Œ cwnd å°±å‡å°‘ï¼› æ‹¥å¡æ§åˆ¶æœ‰å“ªäº›å¸¸ç”¨ç®—æ³•ï¼Ÿæ‹¥å¡æ§åˆ¶ä¸»è¦æœ‰è¿™å‡ ç§å¸¸ç”¨ç®—æ³•ï¼š æ…¢å¯åŠ¨ æ‹¥å¡é¿å… æ‹¥å¡å‘ç”Ÿ å¿«é€Ÿæ¢å¤ â‘ ã€æ…¢å¯åŠ¨ç®—æ³• æ…¢å¯åŠ¨ç®—æ³•ï¼Œæ…¢æ…¢å¯åŠ¨ã€‚ å®ƒè¡¨ç¤º TCP å»ºç«‹è¿æ¥å®Œæˆåï¼Œä¸€å¼€å§‹ä¸è¦å‘é€å¤§é‡çš„æ•°æ®ï¼Œè€Œæ˜¯å…ˆæ¢æµ‹ä¸€ä¸‹ç½‘ç»œçš„æ‹¥å¡ç¨‹åº¦ã€‚ç”±å°åˆ°å¤§é€æ¸å¢åŠ æ‹¥å¡çª—å£çš„å¤§å°ï¼Œå¦‚æœæ²¡æœ‰å‡ºç°ä¸¢åŒ…ï¼Œæ¯æ”¶åˆ°ä¸€ä¸ª ACKï¼Œå°±å°†æ‹¥å¡çª—å£ cwnd å¤§å°å°±åŠ  1ï¼ˆå•ä½æ˜¯ MSSï¼‰ã€‚æ¯è½®æ¬¡å‘é€çª—å£å¢åŠ ä¸€å€ï¼Œå‘ˆæŒ‡æ•°å¢é•¿ï¼Œå¦‚æœå‡ºç°ä¸¢åŒ…ï¼Œæ‹¥å¡çª—å£å°±å‡åŠï¼Œè¿›å…¥æ‹¥å¡é¿å…é˜¶æ®µã€‚ ä¸¾ä¸ªä¾‹å­ï¼š è¿æ¥å»ºâ½´å®Œæˆåï¼Œâ¼€å¼€å§‹åˆå§‹åŒ– cwnd 1 ï¼Œè¡¨ç¤ºå¯ä»¥ä¼ â¼€ä¸ª MSS â¼¤â¼©çš„æ•°æ®ã€‚ å½“æ”¶åˆ°â¼€ä¸ª ACK ç¡®è®¤åº”ç­”åï¼Œcwnd å¢åŠ  1ï¼Œäºæ˜¯â¼€æ¬¡èƒ½å¤Ÿå‘é€ 2 ä¸ª å½“æ”¶åˆ° 2 ä¸ªçš„ ACK ç¡®è®¤åº”ç­”åï¼Œ cwnd å¢åŠ  2ï¼Œäºæ˜¯å°±å¯ä»¥â½ä¹‹å‰å¤šå‘ 2 ä¸ªï¼Œæ‰€ä»¥è¿™â¼€æ¬¡èƒ½å¤Ÿå‘é€ 4 ä¸ª å½“è¿™ 4 ä¸ªçš„ ACK ç¡®è®¤åˆ°æ¥çš„æ—¶å€™ï¼Œæ¯ä¸ªç¡®è®¤ cwnd å¢åŠ  1ï¼Œ 4 ä¸ªç¡®è®¤ cwnd å¢åŠ  4ï¼Œäºæ˜¯å°±å¯ä»¥â½ä¹‹å‰å¤šå‘ 4 ä¸ªï¼Œæ‰€ä»¥è¿™â¼€æ¬¡èƒ½å¤Ÿå‘é€ 8 ä¸ªã€‚ å‘åŒ…çš„ä¸ªæ•°æ˜¯æŒ‡æ•°æ€§çš„å¢â»“ã€‚ ä¸ºäº†é˜²æ­¢ cwnd å¢é•¿è¿‡å¤§å¼•èµ·ç½‘ç»œæ‹¥å¡ï¼Œè¿˜éœ€è®¾ç½®ä¸€ä¸ªæ…¢å¯åŠ¨é˜€å€¼ ssthreshï¼ˆslow start thresholdï¼‰çŠ¶æ€å˜é‡ã€‚å½“cwndåˆ°è¾¾è¯¥é˜€å€¼åï¼Œå°±å¥½åƒæ°´ç®¡è¢«å…³å°äº†æ°´é¾™å¤´ä¸€æ ·ï¼Œå‡å°‘æ‹¥å¡çŠ¶æ€ã€‚å³å½“ cwnd ssthresh æ—¶ï¼Œè¿›å…¥äº†æ‹¥å¡é¿å…ç®—æ³•ã€‚ â‘¡ã€æ‹¥å¡é¿å…ç®—æ³•ä¸€èˆ¬æ¥è¯´ï¼Œæ…¢å¯åŠ¨é˜€å€¼ ssthresh æ˜¯ 65535 å­—èŠ‚ï¼Œcwndåˆ°è¾¾æ…¢å¯åŠ¨é˜€å€¼å æ¯æ”¶åˆ°ä¸€ä¸ª ACK æ—¶ï¼Œcwnd cwnd + 1cwnd å½“æ¯è¿‡ä¸€ä¸ª RTT æ—¶ï¼Œcwnd cwnd + 1 æ˜¾ç„¶è¿™æ˜¯ä¸€ä¸ªçº¿æ€§ä¸Šå‡çš„ç®—æ³•ï¼Œé¿å…è¿‡å¿«å¯¼è‡´ç½‘ç»œæ‹¥å¡é—®é¢˜ã€‚æ¥ç€ä¸Šé¢æ…¢å¯åŠ¨çš„ä¾‹å­ï¼Œå‡å®š ssthresh ä¸º 8 ï¼š å½“ 8 ä¸ª ACK åº”ç­”ç¡®è®¤åˆ°æ¥æ—¶ï¼Œæ¯ä¸ªç¡®è®¤å¢åŠ  18ï¼Œ8 ä¸ª ACK ç¡®è®¤ cwnd â¼€å…±å¢åŠ  1ï¼Œäºæ˜¯è¿™â¼€æ¬¡èƒ½å¤Ÿå‘é€ 9 ä¸ª MSS â¼¤â¼©çš„æ•°æ®ï¼Œå˜æˆäº†çº¿æ€§å¢â»“ã€‚ â‘¢ã€æ‹¥å¡å‘ç”Ÿ å½“ç½‘ç»œæ‹¥å¡å‘ç”Ÿä¸¢åŒ…æ—¶ï¼Œä¼šæœ‰ä¸¤ç§æƒ…å†µï¼š RTO è¶…æ—¶é‡ä¼  å¿«é€Ÿé‡ä¼  å¦‚æœæ˜¯å‘ç”Ÿäº†Â RTO è¶…æ—¶é‡ä¼ ï¼Œå°±ä¼šä½¿ç”¨æ‹¥å¡å‘ç”Ÿç®—æ³• æ…¢å¯åŠ¨é˜€å€¼ sshthresh cwnd 2 cwnd é‡ç½®ä¸º 1 è¿›å…¥æ–°çš„æ…¢å¯åŠ¨è¿‡ç¨‹ è¿™ç§æ–¹å¼å°±åƒæ˜¯é£™è½¦çš„æ—¶å€™æ€¥åˆ¹è½¦ï¼Œè¿˜é£é€Ÿå€’è½¦ï¼Œè¿™ã€‚ã€‚ã€‚ å…¶å®è¿˜æœ‰æ›´å¥½çš„å¤„ç†æ–¹å¼ï¼Œå°±æ˜¯å¿«é€Ÿé‡ä¼ ã€‚å‘é€æ–¹æ”¶åˆ° 3 ä¸ªè¿ç»­é‡å¤çš„ ACK æ—¶ï¼Œå°±ä¼šå¿«é€Ÿåœ°é‡ä¼ ï¼Œä¸å¿…ç­‰å¾… RTO è¶…æ—¶å†é‡ä¼ ã€‚ å‘â½£å¿«é€Ÿé‡ä¼ çš„æ‹¥å¡å‘â½£ç®—æ³•ï¼š æ‹¥å¡çª—å£å¤§å° cwnd = cwnd/2æ…¢å¯åŠ¨é˜€å€¼ ssthresh = cwndè¿›å…¥å¿«é€Ÿæ¢å¤ç®—æ³• â‘£ã€å¿«é€Ÿæ¢å¤ å¿«é€Ÿé‡ä¼ å’Œå¿«é€Ÿæ¢å¤ç®—æ³•ä¸€èˆ¬åŒæ—¶ä½¿ç”¨ã€‚å¿«é€Ÿæ¢å¤ç®—æ³•è®¤ä¸ºï¼Œè¿˜æœ‰ 3 ä¸ªé‡å¤ ACK æ”¶åˆ°ï¼Œè¯´æ˜ç½‘ç»œä¹Ÿæ²¡é‚£ä¹ˆç³Ÿç³•ï¼Œæ‰€ä»¥æ²¡æœ‰å¿…è¦åƒ RTO è¶…æ—¶é‚£ä¹ˆå¼ºçƒˆã€‚ æ­£å¦‚å‰é¢æ‰€è¯´ï¼Œè¿›å…¥å¿«é€Ÿæ¢å¤ä¹‹å‰ï¼Œcwnd å’Œ sshthresh å·²è¢«æ›´æ–°ï¼š cwnd cwnd 2 sshthresh cwnd ç„¶åï¼Œè¿›â¼Šå¿«é€Ÿæ¢å¤ç®—æ³•å¦‚ä¸‹ï¼š cwnd sshthresh + 3 é‡ä¼ é‡å¤çš„é‚£å‡ ä¸ª ACKï¼ˆå³ä¸¢å¤±çš„é‚£å‡ ä¸ªæ•°æ®åŒ…ï¼‰ å¦‚æœå†æ”¶åˆ°é‡å¤çš„ ACKï¼Œé‚£ä¹ˆ cwnd cwnd +1 å¦‚æœæ”¶åˆ°æ–°æ•°æ®çš„ ACK å, cwnd sshthreshã€‚å› ä¸ºæ”¶åˆ°æ–°æ•°æ®çš„ ACKï¼Œè¡¨æ˜æ¢å¤è¿‡ç¨‹å·²ç»ç»“æŸï¼Œå¯ä»¥å†æ¬¡è¿›å…¥äº†æ‹¥å¡é¿å…çš„ç®—æ³•äº†ã€‚ 42.è¯´è¯´ TCP çš„é‡ä¼ æœºåˆ¶ï¼Ÿè¶…æ—¶é‡ä¼ æœºåˆ¶æ˜¯ TCP çš„æ ¸å¿ƒä¹‹ä¸€ï¼Œå®ƒèƒ½ç¡®ä¿åœ¨ç½‘ç»œä¼ è¾“ä¸­å¦‚æœæŸäº›æ•°æ®åŒ…ä¸¢å¤±æˆ–æ²¡æœ‰åŠæ—¶åˆ°è¾¾çš„è¯ï¼ŒTCP èƒ½å¤Ÿé‡æ–°å‘é€è¿™äº›æ•°æ®åŒ…ï¼Œä»¥ä¿è¯æ•°æ®å®Œæ•´æ€§ã€‚ å…¶åŸç†æ˜¯åœ¨å‘é€æŸä¸ªæ•°æ®åå¼€å¯ä¸€ä¸ªè®¡æ—¶å™¨ï¼Œå¦‚æœåœ¨ä¸€å®šæ—¶é—´å†…æ²¡æœ‰å¾—åˆ°å‘é€æ•°æ®æŠ¥çš„ ACK æŠ¥æ–‡ï¼Œå°±é‡æ–°å‘é€æ•°æ®ï¼Œç›´åˆ°å‘é€æˆåŠŸä¸ºæ­¢ã€‚ é‡ä¼ åŒ…æ‹¬è¶…æ—¶é‡ä¼ ã€å¿«é€Ÿé‡ä¼ ã€å¸¦é€‰æ‹©ç¡®è®¤çš„é‡ä¼ ï¼ˆSACKï¼‰å’Œé‡å¤ SACK å››ç§ã€‚ è¶…æ—¶æ—¶é—´åº”è¯¥è®¾ç½®ä¸ºå¤šå°‘å‘¢ï¼ŸTCP ä¸­çš„é‡ä¼ è¶…æ—¶æ—¶é—´ï¼ˆRTOï¼ŒRetransmission Timeoutï¼‰ä¸æ˜¯ä¸€ä¸ªå›ºå®šçš„å€¼ï¼Œè€Œæ˜¯åŠ¨æ€è®¡ç®—çš„ï¼Œç›®çš„æ˜¯ä¸ºäº†é€‚åº”ä¸åŒçš„ç½‘ç»œæ¡ä»¶ã€‚ RTO æœ‰ä¸ªæ ‡å‡†æ–¹æ³•çš„è®¡ç®—å…¬å¼ï¼Œå«Â Jacobson Karels ç®—æ³•ã€‚ â‘ ã€è®¡ç®— SRTTï¼ˆSmoothed RTTï¼Œå¹³æ»‘å¾€è¿”æ—¶é—´ï¼‰ï¼Œä»¥é¿å…å•æ¬¡æµ‹é‡ä¸­çš„æŠ–åŠ¨å½±å“é‡ä¼ æ—¶é—´ã€‚ SRTTÂ =Â (1Â -Â Î±)Â *Â SRTTÂ +Â Î±Â *Â RTT å…¶ä¸­ï¼ŒÎ± æ˜¯ä¸€ä¸ªå¸¸é‡ï¼Œé€šå¸¸å–å€¼ä¸º 0.125ï¼ˆå³18ï¼‰ï¼Œè¡¨ç¤ºæ–°æµ‹é‡å€¼å¯¹å¹³æ»‘RTTçš„å½±å“æ¯”ä¾‹ã€‚ RTTï¼Œä¹Ÿå°±æ˜¯ Round-Trip Timeï¼Œå¾€è¿”æ—¶é—´ï¼Œå³æ•°æ®åŒ…ä»å‘é€åˆ°æ¥æ”¶åˆ°ç¡®è®¤çš„æ—¶é—´ã€‚TCP ä¼šå¯¹æ¯ä¸ªæ•°æ®åŒ…çš„ RTT è¿›è¡Œæµ‹é‡ï¼Œå¹¶ä¸æ–­æ›´æ–°è¿™ä¸ªå€¼ã€‚ â‘¡ã€è®¡ç®— RTTVAR (RTT Variationï¼Œè¡¨ç¤ºRTTçš„å˜åŒ–é‡ï¼Œç”¨äºè¡¡é‡RTTçš„æ³¢åŠ¨) RTTVARÂ =Â (1Â -Â Î²)Â *Â RTTVARÂ +Â Î²Â *Â (|RTTÂ -Â SRTT|) Î² é€šå¸¸å–å€¼ä¸º 0.25ï¼ˆå³14ï¼‰ï¼Œè¡¨ç¤ºå¯¹RTTVARæ›´æ–°çš„æƒé‡ã€‚ â‘¢ã€æœ€åï¼Œå¾—å‡ºæœ€ç»ˆçš„ RTO RTOÂ =Â SRTTÂ +Â max(G, 4 x RTTVAR) G æ˜¯ä¸€ä¸ªå°çš„å¸¸é‡åç§»é‡ï¼Œç”¨æ¥é˜²æ­¢RTOè¿‡å°ã€‚ä¸€èˆ¬æ¥è¯´ï¼ŒG çš„å€¼é€šå¸¸æ˜¯1æ¯«ç§’ã€‚ ä¸€èˆ¬æ¥è¯´ï¼ŒRTO ç•¥å¾®å¤§äº RTTï¼Œæ•ˆæœæ˜¯æœ€ä½³çš„ã€‚ å¦‚æœ RTO è®¾ç½®å¾ˆå¤§ï¼Œå¯èƒ½ç­‰äº†å¾ˆä¹…éƒ½æ²¡æœ‰é‡å‘ã€‚ å¦‚æœ RTO è®¾ç½®å¾ˆå°ï¼Œé‚£å¾ˆå¯èƒ½æ•°æ®è¿˜æ²¡æœ‰ä¸¢å¤±ï¼Œå°±å¼€å§‹é‡å‘äº†ã€‚ è¶…æ—¶é‡ä¼ ä¸æ˜¯ååˆ†å®Œç¾çš„é‡ä¼ æ–¹æ¡ˆï¼Œå®ƒæœ‰è¿™äº›ç¼ºç‚¹ï¼š å½“æŠ¥æ–‡ä¸¢å¤±æ—¶ï¼Œéœ€è¦ç­‰å¾…ä¸€å®šçš„è¶…æ—¶å‘¨æœŸï¼Œæ‰å¼€å§‹é‡ä¼ ã€‚ å½“æŠ¥æ–‡ä¸¢å¤±æ—¶ï¼Œåœ¨ç­‰å¾…è¶…æ—¶çš„è¿‡ç¨‹ä¸­ï¼Œå¯èƒ½ä¼šå‡ºç°è¿™ç§æƒ…å†µï¼šåé¢çš„æŠ¥æ–‡å·²ç»è¢«æ¥æ”¶ç«¯æ¥æ”¶äº†ä½†å´è¿Ÿè¿Ÿå¾—ä¸åˆ°ç¡®è®¤ï¼Œå‘é€ç«¯ä¼šè®¤ä¸ºä¹Ÿä¸¢å¤±äº†ï¼Œä»è€Œå¼•èµ·ä¸å¿…è¦çš„é‡ä¼ ã€‚ å¹¶ä¸”ï¼Œå¯¹äº TCP æ¥è¯´ï¼Œå¦‚æœå‘ç”Ÿä¸€æ¬¡è¶…æ—¶é‡ä¼ ï¼Œä¸‹æ¬¡çš„æ—¶é—´é—´éš”å°±ä¼šåŠ å€ã€‚ ä»€ä¹ˆæ˜¯å¿«é€Ÿé‡ä¼ ï¼ŸTCP è¿˜æœ‰å¦å¤–â¼€ç§å¿«é€Ÿé‡ä¼ ï¼ˆFast Retransmitï¼‰æœºåˆ¶ï¼Œå®ƒä¸ä»¥æ—¶é—´ä¸ºé©±åŠ¨ï¼Œâ½½æ˜¯ä»¥æ•°æ®é©±åŠ¨é‡ä¼ ã€‚ å®ƒä¸ä»¥æ—¶é—´é©±åŠ¨ï¼Œè€Œæ˜¯ä»¥æ•°æ®é©±åŠ¨ã€‚å®ƒæ˜¯åŸºäºæ¥æ”¶ç«¯çš„åé¦ˆä¿¡æ¯æ¥å¼•å‘é‡ä¼ çš„ã€‚ å¯ä»¥ç”¨å®ƒæ¥è§£å†³è¶…æ—¶é‡å‘çš„æ—¶é—´ç­‰å¾…é—®é¢˜ï¼Œå¿«é€Ÿé‡ä¼ æµç¨‹å¦‚ä¸‹ï¼š åœ¨ä¸Šå›¾ï¼Œå‘é€â½…å‘å‡ºäº† 1ï¼Œ2ï¼Œ3ï¼Œ4ï¼Œ5 ä»½æ•°æ®ï¼š ç¬¬â¼€ä»½ Seq1 å…ˆé€åˆ°äº†ï¼Œäºæ˜¯å°± Ack å› 2ï¼› ç»“æœ Seq2 å› ä¸ºæŸäº›åŸå› æ²¡æ”¶åˆ°ï¼ŒSeq3 åˆ°è¾¾äº†ï¼Œäºæ˜¯è¿˜æ˜¯ Ack å› 2ï¼› åâ¾¯çš„ Seq4 å’Œ Seq5 éƒ½åˆ°äº†ï¼Œä½†è¿˜æ˜¯ Ack å› 2ï¼Œå› ä¸º Seq2 è¿˜æ˜¯æ²¡æœ‰æ”¶åˆ°ï¼› å‘é€ç«¯æ”¶åˆ°äº†ä¸‰ä¸ªÂ Ack 2Â çš„ç¡®è®¤ï¼ŒçŸ¥é“äº†Â Seq2Â è¿˜æ²¡æœ‰æ”¶åˆ°ï¼Œå°±ä¼šåœ¨å®šæ—¶å™¨è¿‡æœŸä¹‹å‰ï¼Œé‡ä¼ ä¸¢å¤±çš„Â Seq2ã€‚ æœ€åï¼Œæ”¶åˆ°äº† Seq2ï¼Œæ­¤æ—¶å› ä¸º Seq3ï¼ŒSeq4ï¼ŒSeq5 éƒ½æ”¶åˆ°äº†ï¼Œäºæ˜¯ Ack å› 6 ã€‚ å¿«é€Ÿé‡ä¼ æœºåˆ¶åªè§£å†³äº†â¼€ä¸ªé—®é¢˜ï¼Œå°±æ˜¯è¶…æ—¶æ—¶é—´çš„é—®é¢˜ï¼Œä½†æ˜¯å®ƒä¾ç„¶â¾¯ä¸´ç€å¦å¤–â¼€ä¸ªé—®é¢˜ã€‚å°±æ˜¯é‡ä¼ çš„æ—¶å€™ï¼Œæ˜¯é‡ä¼ ä¹‹å‰çš„â¼€ä¸ªï¼Œè¿˜æ˜¯é‡ä¼ æ‰€æœ‰çš„é—®é¢˜ã€‚ â½å¦‚å¯¹äºä¸Šâ¾¯çš„ä¾‹â¼¦ï¼Œæ˜¯é‡ä¼  Seq2 å‘¢ï¼Ÿè¿˜æ˜¯é‡ä¼  Seq2ã€Seq3ã€Seq4ã€Seq5 å‘¢ï¼Ÿå› ä¸ºå‘é€ç«¯å¹¶ä¸æ¸…æ¥šè¿™è¿ç»­çš„ä¸‰ä¸ª Ack 2 æ˜¯è°ä¼ å›æ¥çš„ã€‚ æ ¹æ® TCP ä¸åŒçš„å®ç°ï¼Œä»¥ä¸Šä¸¤ç§æƒ…å†µéƒ½æ˜¯æœ‰å¯èƒ½çš„ã€‚å¯â»…ï¼Œè¿™æ˜¯â¼€æŠŠåŒåˆƒå‰‘ã€‚ ä¸ºäº†è§£å†³ä¸çŸ¥é“è¯¥é‡ä¼ å“ªäº› TCP æŠ¥â½‚ï¼Œäºæ˜¯å°±æœ‰ SACK â½…æ³•ã€‚ ä»€ä¹ˆæ˜¯å¸¦é€‰æ‹©ç¡®è®¤çš„é‡ä¼ (SACK)ä¸ºäº†è§£å†³åº”è¯¥é‡ä¼ å¤šå°‘ä¸ªåŒ…çš„é—®é¢˜? TCP æä¾›äº†å¸¦é€‰æ‹©ç¡®è®¤çš„é‡ä¼ ï¼ˆå³ SACKï¼ŒSelective Acknowledgmentï¼‰ã€‚ SACK æœºåˆ¶å°±æ˜¯ï¼Œåœ¨å¿«é€Ÿé‡ä¼ çš„åŸºç¡€ä¸Šï¼Œæ¥æ”¶æ–¹è¿”å›æœ€è¿‘æ”¶åˆ°æŠ¥æ–‡æ®µçš„åºåˆ—å·èŒƒå›´ï¼Œè¿™æ ·å‘é€æ–¹å°±çŸ¥é“æ¥æ”¶æ–¹å“ªäº›æ•°æ®åŒ…æ˜¯æ²¡æ”¶åˆ°çš„ã€‚è¿™æ ·å°±å¾ˆæ¸…æ¥šåº”è¯¥é‡ä¼ å“ªäº›æ•°æ®åŒ…ã€‚ å¦‚ä¸Šå›¾ä¸­ï¼Œå‘é€â½…æ”¶åˆ°äº†ä¸‰æ¬¡åŒæ ·çš„ ACK ç¡®è®¤æŠ¥â½‚ï¼Œäºæ˜¯å°±ä¼šè§¦å‘å¿«é€Ÿé‡å‘æœºåˆ¶ï¼Œé€šè¿‡ SACK ä¿¡æ¯å‘ç°åªæœ‰ 200~299 è¿™æ®µæ•°æ®ä¸¢å¤±ï¼Œåˆ™é‡å‘æ—¶ï¼Œå°±åªé€‰æ‹©äº†è¿™ä¸ª TCP æ®µè¿›â¾é‡å‘ã€‚ ä»€ä¹ˆæ˜¯é‡å¤ SACKï¼ˆD-SACKï¼‰D-SACKï¼Œè‹±æ–‡æ˜¯ Duplicate SACKï¼Œæ˜¯åœ¨ SACK çš„åŸºç¡€ä¸Šåšäº†ä¸€äº›æ‰©å±•ï¼Œä¸»è¦ç”¨æ¥å‘Šè¯‰å‘é€æ–¹ï¼Œæœ‰å“ªäº›æ•°æ®åŒ…ï¼Œè‡ªå·±é‡å¤æ¥å—äº†ã€‚ DSACK çš„ç›®çš„æ˜¯å¸®åŠ©å‘é€æ–¹åˆ¤æ–­ï¼Œæ˜¯å¦å‘ç”Ÿäº†åŒ…å¤±åºã€ACK ä¸¢å¤±ã€åŒ…é‡å¤æˆ–ä¼ªé‡ä¼ ã€‚è®© TCP å¯ä»¥æ›´å¥½çš„åšç½‘ç»œæµæ§ã€‚ ä¾‹å¦‚ ACK ä¸¢åŒ…å¯¼è‡´çš„æ•°æ®åŒ…é‡å¤ï¼š æ¥æ”¶â½…å‘ç»™å‘é€â½…çš„ä¸¤ä¸ª ACK ç¡®è®¤åº”ç­”éƒ½ä¸¢å¤±äº†ï¼Œæ‰€ä»¥å‘é€â½…è¶…æ—¶åï¼Œé‡ä¼ ç¬¬â¼€ä¸ªæ•°æ®åŒ…ï¼ˆ3000 ~3499ï¼‰ äºæ˜¯æ¥æ”¶â½…å‘ç°æ•°æ®æ˜¯é‡å¤æ”¶åˆ°çš„ï¼Œäºæ˜¯å›äº†â¼€ä¸ª SACK 30003500ï¼Œå‘Šè¯‰ã€Œå‘é€â½…ã€ 30003500 çš„æ•°æ®æ—©å·²è¢«æ¥æ”¶äº†ï¼Œå› ä¸º ACK éƒ½åˆ°äº† 4000 äº†ï¼Œå·²ç»æ„å‘³ç€ 4000 ä¹‹å‰çš„æ‰€æœ‰æ•°æ®éƒ½å·²æ”¶åˆ°ï¼Œæ‰€ä»¥è¿™ä¸ª SACK å°±ä»£è¡¨ç€ D-SACK ã€‚è¿™æ ·å‘é€â½…å°±çŸ¥é“äº†ï¼Œæ•°æ®æ²¡æœ‰ä¸¢ï¼Œæ˜¯æ¥æ”¶â½…çš„ ACK ç¡®è®¤æŠ¥â½‚ä¸¢äº†ã€‚ 43.è¯´è¯´ TCP çš„ç²˜åŒ…å’Œæ‹†åŒ…ï¼ŸTCP çš„ç²˜åŒ…å’Œæ‹†åŒ…æ›´å¤šçš„æ˜¯ä¸šåŠ¡ä¸Šçš„æ¦‚å¿µï¼ ä»€ä¹ˆæ˜¯ TCP ç²˜åŒ…å’Œæ‹†åŒ…ï¼Ÿ TCP æ˜¯é¢å‘æµï¼Œæ²¡æœ‰ç•Œé™çš„ä¸€ä¸²æ•°æ®ã€‚TCP åº•å±‚å¹¶ä¸äº†è§£ä¸Šå±‚ä¸šåŠ¡æ•°æ®çš„å…·ä½“å«ä¹‰ï¼Œå®ƒä¼šæ ¹æ® TCP ç¼“å†²åŒºçš„å®é™…æƒ…å†µè¿›è¡ŒåŒ…çš„åˆ’åˆ†ï¼Œæ‰€ä»¥åœ¨ä¸šåŠ¡ä¸Šè®¤ä¸ºï¼Œä¸€ä¸ªå®Œæ•´çš„åŒ…å¯èƒ½ä¼šè¢« TCP æ‹†åˆ†æˆå¤šä¸ªåŒ…è¿›è¡Œå‘é€ï¼Œä¹Ÿæœ‰å¯èƒ½æŠŠå¤šä¸ªå°çš„åŒ…å°è£…æˆä¸€ä¸ªå¤§çš„æ•°æ®åŒ…å‘é€ï¼Œè¿™å°±æ˜¯æ‰€è°“çš„ TCP ç²˜åŒ…å’Œæ‹†åŒ…é—®é¢˜ã€‚ ä¸ºä»€ä¹ˆä¼šäº§ç”Ÿç²˜åŒ…å’Œæ‹†åŒ…å‘¢? è¦å‘é€çš„æ•°æ®å°äº TCP å‘é€ç¼“å†²åŒºçš„å¤§å°ï¼ŒTCP å°†å¤šæ¬¡å†™å…¥ç¼“å†²åŒºçš„æ•°æ®ä¸€æ¬¡å‘é€å‡ºå»ï¼Œå°†ä¼šå‘ç”Ÿç²˜åŒ…ï¼› æ¥æ”¶æ•°æ®ç«¯çš„åº”ç”¨å±‚æ²¡æœ‰åŠæ—¶è¯»å–æ¥æ”¶ç¼“å†²åŒºä¸­çš„æ•°æ®ï¼Œå°†å‘ç”Ÿç²˜åŒ…ï¼› è¦å‘é€çš„æ•°æ®å¤§äº TCP å‘é€ç¼“å†²åŒºå‰©ä½™ç©ºé—´å¤§å°ï¼Œå°†ä¼šå‘ç”Ÿæ‹†åŒ…ï¼› å¾…å‘é€æ•°æ®å¤§äº MSSï¼ˆæœ€å¤§æŠ¥æ–‡é•¿åº¦ï¼‰ï¼ŒTCP åœ¨ä¼ è¾“å‰å°†è¿›è¡Œæ‹†åŒ…ã€‚å³ TCP æŠ¥æ–‡é•¿åº¦ - TCP å¤´éƒ¨é•¿åº¦ MSSã€‚ é‚£æ€ä¹ˆè§£å†³å‘¢ï¼Ÿ å‘é€ç«¯å°†æ¯ä¸ªæ•°æ®åŒ…å°è£…ä¸ºå›ºå®šé•¿åº¦ åœ¨æ•°æ®å°¾éƒ¨å¢åŠ ç‰¹æ®Šå­—ç¬¦è¿›è¡Œåˆ†å‰² å°†æ•°æ®åˆ†ä¸ºä¸¤éƒ¨åˆ†ï¼Œä¸€éƒ¨åˆ†æ˜¯å¤´éƒ¨ï¼Œä¸€éƒ¨åˆ†æ˜¯å†…å®¹ä½“ï¼›å…¶ä¸­å¤´éƒ¨ç»“æ„å¤§å°å›ºå®šï¼Œä¸”æœ‰ä¸€ä¸ªå­—æ®µå£°æ˜å†…å®¹ä½“çš„å¤§å°ã€‚ 63.ä¸€ä¸ªTCPè¿æ¥å¯ä»¥å‘é€å¤šå°‘æ¬¡HTTPè¯·æ±‚?ï¼ˆè¡¥å……ï¼‰ä¸€ä¸ª TCP è¿æ¥å¯ä»¥å‘é€å¤šå°‘æ¬¡ HTTP è¯·æ±‚ï¼Œå–å†³äº HTTP åè®®çš„ç‰ˆæœ¬ã€‚ åœ¨ HTTP1.0 ä¸­ï¼Œæ¯ä¸ª HTTP è¯·æ±‚-å“åº”ä½¿ç”¨ä¸€ä¸ªå•ç‹¬çš„ TCP è¿æ¥ã€‚è¿™æ„å‘³ç€æ¯æ¬¡å‘é€ HTTP è¯·æ±‚éƒ½éœ€è¦å»ºç«‹ä¸€ä¸ªæ–°çš„ TCP è¿æ¥ã€‚ HTTP/1.1 å¼•å…¥äº†æŒä¹…è¿æ¥ï¼ˆPersistent Connectionï¼‰ï¼Œé»˜è®¤æƒ…å†µä¸‹å…è®¸åœ¨ä¸€ä¸ª TCP è¿æ¥ä¸Šå‘é€å¤šä¸ª HTTP è¯·æ±‚ã€‚ é€šè¿‡ä½¿ç”¨Â Connection: keep-aliveÂ å¤´éƒ¨å®ç°ï¼Œä¿æŒè¿æ¥æ‰“å¼€çŠ¶æ€ï¼Œç›´åˆ°æ˜ç¡®å…³é—­ä¸ºæ­¢ã€‚è¿™æå¤§åœ°æé«˜äº†æ•ˆç‡ï¼Œå› ä¸ºæ— éœ€ä¸ºæ¯ä¸ªè¯·æ±‚éƒ½å»ºç«‹æ–°çš„è¿æ¥ã€‚ æ­¤å¤–ï¼ŒHTTP/1.1 æ”¯æŒè¯·æ±‚ç®¡é“åŒ–ï¼ˆPipeliningï¼‰ï¼Œå…è®¸å®¢æˆ·ç«¯åœ¨æ”¶åˆ°å‰ä¸€ä¸ªå“åº”ä¹‹å‰å‘é€å¤šä¸ªè¯·æ±‚ã€‚ HTTP2 è¿›ä¸€æ­¥ä¼˜åŒ–äº†è¿æ¥å¤ç”¨ï¼Œå…è®¸åœ¨å•ä¸ª TCP è¿æ¥ä¸ŠåŒæ—¶å‘é€å¤šä¸ªè¯·æ±‚å’Œå“åº”ï¼Œè¿™äº›è¯·æ±‚å’Œå“åº”è¢«åˆ†å‰²æˆå¸§å¹¶é€šè¿‡æµä¼ è¾“ã€‚HTTP2 çš„å¤šè·¯å¤ç”¨ï¼ˆMultiplexingï¼‰æœºåˆ¶æ˜¾è‘—æé«˜äº†å¹¶å‘æ€§èƒ½å’Œèµ„æºåˆ©ç”¨æ•ˆç‡ã€‚ UDP44.è¯´è¯´ TCP å’Œ UDP çš„åŒºåˆ«ï¼ŸTCP æ˜¯é¢å‘è¿æ¥çš„ï¼Œè€Œ UDP æ˜¯æ— è¿æ¥çš„ã€‚ TCP å°±åƒæ˜¯æ‰“ç”µè¯ä¸€å¯¹ä¸€ç§èŠï¼ŒUDP å°±åƒæ˜¯æ‹¿ä¸ªå¤§å–‡å­åœ¨å¹¿æ’­ã€‚ åœ¨æ•°æ®ä¼ è¾“å¼€å§‹ä¹‹å‰ï¼ŒTCP éœ€è¦å…ˆå»ºç«‹è¿æ¥ï¼Œæ•°æ®ä¼ è¾“å®Œæˆåï¼Œå†æ–­å¼€è¿æ¥ã€‚è¿™ä¸ªè¿‡ç¨‹é€šå¸¸è¢«ç§°ä¸ºâ€œä¸‰æ¬¡æ¡æ‰‹â€ã€â€œå››æ¬¡æŒ¥æ‰‹â€ã€‚ UDP æ˜¯æ— è¿æ¥çš„ï¼Œå‘é€æ•°æ®ä¹‹å‰ä¸éœ€è¦å»ºç«‹è¿æ¥ï¼Œå‘é€å®Œæ¯•ä¹Ÿä¸éœ€è¦æ–­å¼€ï¼Œæ•°æ®ä»¥æ•°æ®æŠ¥å½¢å¼å‘é€ã€‚ æ¢å¥è¯è¯´ï¼šTCP æ˜¯å¯é çš„ï¼Œå®ƒé€šè¿‡ç¡®è®¤æœºåˆ¶ã€é‡å‘æœºåˆ¶ç­‰æ¥ä¿è¯æ•°æ®çš„å¯é ä¼ è¾“ã€‚è€Œ UDP æ˜¯ä¸å¯é çš„ï¼Œæ•°æ®åŒ…å¯èƒ½ä¼šä¸¢å¤±ã€é‡å¤ã€ä¹±åºã€‚ è¯´è¯´ TCP å’Œ UDP çš„åº”ç”¨åœºæ™¯ï¼Ÿ TCPï¼šÂ é€‚ç”¨äºé‚£äº›å¯¹æ•°æ®å‡†ç¡®æ€§è¦æ±‚é«˜äºæ•°æ®ä¼ è¾“é€Ÿåº¦çš„åœºåˆã€‚ä¾‹å¦‚ï¼šç½‘é¡µæµè§ˆã€ç”µå­é‚®ä»¶ã€æ–‡ä»¶ä¼ è¾“ï¼ˆFTPï¼‰ã€è¿œç¨‹æ§åˆ¶ã€æ•°æ®åº“é“¾æ¥ã€‚ UDPï¼šÂ é€‚ç”¨äºå¯¹é€Ÿåº¦è¦æ±‚é«˜ã€å¯ä»¥å®¹å¿ä¸€å®šæ•°æ®ä¸¢å¤±çš„åœºåˆã€‚ä¾‹å¦‚ï¼šQQ èŠå¤©ã€åœ¨çº¿è§†é¢‘ã€ç½‘ç»œè¯­éŸ³ç”µè¯ã€å¹¿æ’­é€šä¿¡ã€‚å®¹å¿ä¸€å®šçš„æ•°æ®ä¸¢å¤±ã€‚ ä½ ä¼šå¦‚ä½•è®¾è®¡ QQ ä¸­çš„ç½‘ç»œåè®®ï¼Ÿé¦–å…ˆï¼Œæˆ‘ä»¬è¦å®ç°ç™»å½•åŠŸèƒ½ï¼Œè¿™æ˜¯ä½¿ç”¨ QQ çš„ç¬¬ä¸€æ­¥ï¼Œä¸ºäº†ä¿è¯è´¦å·å’Œå¯†ç çš„å®‰å…¨æ€§ï¼Œæˆ‘ä»¬å¯ä»¥é€‰æ‹© TCP + SSL/TLS åè®®æ¥è¿›è¡Œç™»å½•ã€‚ å› ä¸º TCP åè®®æ˜¯ä¸€ç§å¯é çš„ä¼ è¾“åè®®ï¼Œèƒ½å¤Ÿä¿è¯æ•°æ®çš„å®Œæ•´æ€§ï¼Œè€Œ SSL/TLS èƒ½å¤Ÿå¯¹é€šä¿¡è¿›è¡ŒåŠ å¯†ï¼Œä¿è¯æ•°æ®çš„å®‰å…¨æ€§ã€‚ æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬éœ€è¦è€ƒè™‘æ¶ˆæ¯ä¼ é€’çš„å®æ—¶æ€§ï¼Œå¦‚è¯­éŸ³è§†é¢‘é€šè¯ç­‰ï¼Œè¿™æ—¶å€™æˆ‘ä»¬å¯ä»¥é€‰æ‹© UDP åè®®ã€‚UDP çš„ä¼ è¾“é€Ÿåº¦æ›´å¿«ï¼Œå¯¹äºå®æ—¶æ€§æœåŠ¡æ¥è¯´ï¼Œé€Ÿåº¦æ˜¯æœ€é‡è¦çš„ã€‚ å¦‚ä½•ä¿è¯æ¶ˆæ¯çš„ä¸ä¸¢å¤±ï¼Ÿå¯¹äº TCP åè®®æ¥è¯´ï¼Œå¦‚æœæ•°æ®åŒ…åœ¨ä¼ è¾“è¿‡ç¨‹ä¸­ä¸¢å¤±ï¼ŒTCP åè®®ä¼šè‡ªåŠ¨è¿›è¡Œé‡ä¼ ã€‚ è€Œå¯¹äº UDP åè®®æ¥è¯´ï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡åº”ç”¨å±‚çš„é‡ä¼ æœºåˆ¶æ¥ä¿è¯æ¶ˆæ¯çš„ä¸ä¸¢å¤±ã€‚å½“æ¥æ”¶æ–¹æ”¶åˆ°æ¶ˆæ¯åï¼Œè¿”å›ä¸€ä¸ªç¡®è®¤ä¿¡æ¯ç»™å‘é€æ–¹ï¼Œå¦‚æœå‘é€æ–¹åœ¨ä¸€å®šæ—¶é—´å†…æ²¡æœ‰æ”¶åˆ°ç¡®è®¤ä¿¡æ¯ï¼Œå°±é‡æ–°å‘é€æ¶ˆæ¯ã€‚ åŒæ—¶ï¼Œæ¯ä¸ªæ¶ˆæ¯éƒ½é™„å¸¦ä¸€ä¸ªå”¯ä¸€çš„åºåˆ—å·ï¼Œæ¥æ”¶æ–¹æ ¹æ®åºåˆ—å·åˆ¤æ–­æ˜¯å¦æœ‰æ¶ˆæ¯ä¸¢å¤±ï¼Œå¦‚æœå‘ç°åºåˆ—å·ä¸è¿ç»­ï¼Œå°±å¯ä»¥è¦æ±‚å‘é€æ–¹é‡æ–°å‘é€ã€‚è¿™æ ·è¿˜å¯ä»¥é˜²æ­¢æ¶ˆæ¯é‡å¤ã€‚ å½“ç„¶äº†ï¼Œæ¶ˆæ¯æŒä¹…åŒ–ä¹Ÿå¾ˆé‡è¦ï¼Œå¯ä»¥å°†æ¶ˆæ¯ä¿å­˜åœ¨æœåŠ¡å™¨æˆ–è€…æœ¬åœ°çš„æ•°æ®åº“ä¸­ï¼Œå³ä½¿åœ¨ç½‘ç»œä¸­æ–­æˆ–è€…å…¶ä»–å¼‚å¸¸æƒ…å†µä¸‹ï¼Œä¹Ÿèƒ½ä»æ•°æ®åº“ä¸­æ¢å¤æ¶ˆæ¯ã€‚ 45.ä¸ºä»€ä¹ˆ QQ é‡‡ç”¨ UDP åè®®ï¼ŸPSï¼šè¿™æ˜¯å¤šå¹´å‰çš„è€é¢˜äº†ï¼Œæ‹‰å‡ºæ¥æ€€æ€€æ—§ã€‚ é¦–å…ˆï¼ŒQQ å¹¶ä¸æ˜¯å®Œå…¨åŸºäº UDP å®ç°ã€‚æ¯”å¦‚åœ¨ä½¿ç”¨ QQ è¿›è¡Œæ–‡ä»¶ä¼ è¾“ç­‰æ´»åŠ¨çš„æ—¶å€™ï¼Œå°±ä¼šä½¿ç”¨ TCP ä½œä¸ºå¯é ä¼ è¾“çš„ä¿è¯ã€‚ ä½¿ç”¨ UDP è¿›è¡Œäº¤äº’é€šä¿¡çš„å¥½å¤„åœ¨äºï¼Œå»¶è¿Ÿè¾ƒçŸ­ï¼Œå¯¹æ•°æ®ä¸¢å¤±çš„å¤„ç†æ¯”è¾ƒç®€å•ã€‚åŒæ—¶ï¼ŒTCP æ˜¯ä¸€ä¸ªå…¨åŒå·¥åè®®ï¼Œéœ€è¦å»ºç«‹è¿æ¥ï¼Œæ‰€ä»¥ç½‘ç»œå¼€é”€ä¹Ÿä¼šç›¸å¯¹å¤§ã€‚ å¦‚æœä½¿ç”¨ QQ è¯­éŸ³å’Œ QQ è§†é¢‘çš„è¯ï¼ŒUDP çš„ä¼˜åŠ¿å°±æ›´ä¸ºçªå‡ºäº†ï¼Œé¦–å…ˆå»¶è¿Ÿè¾ƒå°ã€‚æœ€é‡è¦çš„ä¸€ç‚¹æ˜¯ä¸å¯é ä¼ è¾“ï¼Œè¿™æ„å‘³ç€å¦‚æœæ•°æ®ä¸¢å¤±çš„è¯ï¼Œä¸ä¼šæœ‰é‡ä¼ ã€‚å› ä¸ºç”¨æˆ·ä¸€èˆ¬æ¥è¯´å¯ä»¥æ¥å—å›¾åƒç¨å¾®æ¨¡ç³Šä¸€ç‚¹ï¼Œå£°éŸ³ç¨å¾®ä¸æ¸…æ™°ä¸€ç‚¹ï¼Œä½†æ˜¯å¦‚æœåœ¨å‡ ç§’é’Ÿä»¥åå†å‡ºç°ä¹‹å‰ä¸¢å¤±çš„ç”»é¢å’Œå£°éŸ³ï¼Œè¿™ææ€•æ˜¯å¾ˆéš¾æ¥å—çš„ã€‚ ç”±äº QQ çš„æœåŠ¡å™¨è®¾è®¡å®¹é‡æ˜¯æµ·é‡çº§çš„åº”ç”¨ï¼Œä¸€å°æœåŠ¡å™¨è¦åŒæ—¶å®¹çº³åå‡ ä¸‡çš„å¹¶å‘è¿æ¥ï¼Œå› æ­¤æœåŠ¡å™¨ç«¯åªæœ‰é‡‡ç”¨ UDP åè®®ä¸å®¢æˆ·ç«¯è¿›è¡Œé€šè®¯æ‰èƒ½ä¿è¯è¿™ç§è¶…å¤§è§„æ¨¡çš„æœåŠ¡ ç®€å•æ€»ç»“ä¸€ä¸‹ï¼šUDP åè®®æ˜¯æ— è¿æ¥æ–¹å¼çš„åè®®ï¼Œå®ƒçš„æ•ˆç‡é«˜ï¼Œé€Ÿåº¦å¿«ï¼Œå èµ„æºå°‘ï¼Œå¯¹æœåŠ¡å™¨çš„å‹åŠ›æ¯”è¾ƒå°ã€‚ä½†æ˜¯å…¶ä¼ è¾“æœºåˆ¶ä¸ºä¸å¯é ä¼ é€ï¼Œå¿…é¡»ä¾é è¾…åŠ©çš„ç®—æ³•æ¥å®Œæˆä¼ è¾“æ§åˆ¶ã€‚QQ é‡‡ç”¨çš„é€šä¿¡åè®®ä»¥ UDP ä¸ºä¸»ï¼Œè¾…ä»¥ TCP åè®®ã€‚ 46.UDP åè®®ä¸ºä»€ä¹ˆä¸å¯é ï¼ŸUDP åœ¨ä¼ è¾“æ•°æ®ä¹‹å‰ä¸éœ€è¦å…ˆå»ºç«‹è¿æ¥ï¼Œè¿œåœ°ä¸»æœºçš„è¿è¾“å±‚åœ¨æ¥æ”¶åˆ° UDP æŠ¥æ–‡åï¼Œä¸éœ€è¦ç¡®è®¤ï¼Œæä¾›ä¸å¯é äº¤ä»˜ã€‚æ€»ç»“å°±ä»¥ä¸‹å››ç‚¹ï¼š ä¸ä¿è¯æ¶ˆæ¯äº¤ä»˜ï¼šä¸ç¡®è®¤ï¼Œä¸é‡ä¼ ï¼Œæ— è¶…æ—¶ ä¸ä¿è¯äº¤ä»˜é¡ºåºï¼šä¸è®¾ç½®åŒ…åºå·ï¼Œä¸é‡æ’ï¼Œä¸ä¼šå‘ç”Ÿé˜Ÿé¦–é˜»å¡ ä¸è·Ÿè¸ªè¿æ¥çŠ¶æ€ï¼šä¸å¿…å»ºç«‹è¿æ¥æˆ–é‡å¯çŠ¶æ€æœº ä¸è¿›è¡Œæ‹¥å¡æ§åˆ¶ï¼šä¸å†…ç½®å®¢æˆ·ç«¯æˆ–ç½‘ç»œåé¦ˆæœºåˆ¶ 47.DNS ä¸ºä»€ä¹ˆè¦ç”¨ UDP?æ›´å‡†ç¡®åœ°è¯´ï¼ŒDNS æ—¢ä½¿ç”¨ TCP åˆä½¿ç”¨ UDPã€‚ å½“è¿›è¡ŒåŒºåŸŸä¼ é€ï¼ˆä¸»åŸŸåæœåŠ¡å™¨å‘è¾…åŠ©åŸŸåæœåŠ¡å™¨ä¼ é€å˜åŒ–çš„é‚£éƒ¨åˆ†æ•°æ®ï¼‰æ—¶ä¼šä½¿ç”¨ TCPï¼Œå› ä¸ºæ•°æ®åŒæ­¥ä¼ é€çš„æ•°æ®é‡æ¯”ä¸€ä¸ªè¯·æ±‚å’Œåº”ç­”çš„æ•°æ®é‡è¦å¤šï¼Œè€Œ TCP å…è®¸çš„æŠ¥æ–‡é•¿åº¦æ›´é•¿ï¼Œå› æ­¤ä¸ºäº†ä¿è¯æ•°æ®çš„æ­£ç¡®æ€§ï¼Œä¼šä½¿ç”¨åŸºäºå¯é è¿æ¥çš„ TCPã€‚ å½“å®¢æˆ·ç«¯æƒ³ DNS æœåŠ¡å™¨æŸ¥è¯¢åŸŸåï¼ˆåŸŸåè§£æï¼‰çš„æ—¶å€™ï¼Œä¸€èˆ¬è¿”å›çš„å†…å®¹ä¸ä¼šè¶…è¿‡ UDP æŠ¥æ–‡çš„æœ€å¤§é•¿åº¦ï¼Œå³ 512 å­—èŠ‚ï¼Œç”¨ UDP ä¼ è¾“æ—¶ï¼Œä¸éœ€è¦åˆ›å»ºè¿æ¥ï¼Œä»è€Œå¤§å¤§æé«˜äº†å“åº”é€Ÿåº¦ï¼Œä½†è¿™è¦æ±‚åŸŸåè§£ææœåŠ¡å™¨å’ŒåŸŸåæœåŠ¡å™¨éƒ½å¿…é¡»è‡ªå·±å¤„ç†è¶…æ—¶å’Œé‡ä¼ ä»è€Œä¿è¯å¯é æ€§ã€‚ IP48.IP åè®®çš„å®šä¹‰å’Œä½œç”¨ï¼ŸIP åè®®ï¼ˆInternet Protocolï¼‰ç”¨äºåœ¨è®¡ç®—æœºç½‘ç»œä¹‹é—´ä¼ è¾“æ•°æ®åŒ…ï¼Œå®ƒå®šä¹‰äº†æ•°æ®åŒ…çš„æ ¼å¼å’Œå¤„ç†è§„åˆ™ï¼Œç¡®ä¿æ•°æ®èƒ½å¤Ÿä»ä¸€ä¸ªè®¾å¤‡ä¼ è¾“åˆ°å¦ä¸€ä¸ªè®¾å¤‡ï¼Œå¯èƒ½è·¨è¶Šå¤šä¸ªä¸­é—´ç½‘ç»œè®¾å¤‡ï¼ˆå¦‚è·¯ç”±å™¨ï¼‰ã€‚ IP åè®®æœ‰å“ªäº›ä½œç”¨ï¼Ÿâ‘ ã€å¯»å€ï¼šæ¯ä¸ªè¿æ¥åˆ°ç½‘ç»œçš„è®¾å¤‡éƒ½æœ‰ä¸€ä¸ªå”¯ä¸€çš„ IP åœ°å€ã€‚IP åè®®ä½¿ç”¨è¿™äº›åœ°å€æ¥æ ‡è¯†æ•°æ®åŒ…çš„æºåœ°å€å’Œç›®çš„åœ°å€ï¼Œç¡®ä¿æ•°æ®åŒ…èƒ½å¤Ÿå‡†ç¡®åœ°ä¼ è¾“åˆ°ç›®æ ‡è®¾å¤‡ã€‚ â‘¡ã€è·¯ç”±ï¼šIP åè®®è´Ÿè´£å†³å®šæ•°æ®åŒ…åœ¨ç½‘ç»œä¼ è¾“ä¸­çš„è·¯å¾„ã€‚æ¯”å¦‚è¯´è·¯ç”±å™¨ä½¿ç”¨è·¯ç”±è¡¨å’Œ IP åœ°å€ä¿¡æ¯æ¥ç¡®å®šæ•°æ®åŒ…çš„æœ€ä½³ä¼ è¾“è·¯å¾„ã€‚ â‘¢ã€åˆ†ç‰‡å’Œé‡ç»„ï¼šå½“æ•°æ®åŒ…è¿‡å¤§æ— æ³•åœ¨æŸä¸ªç½‘ç»œä¸Šä¼ è¾“æ—¶ï¼ŒIP åè®®ä¼šå°†æ•°æ®åŒ…åˆ†æˆæ›´å°çš„ç‰‡æ®µè¿›è¡Œä¼ è¾“ã€‚æ¥æ”¶ç«¯ä¼šæ ¹æ®å¤´éƒ¨ä¿¡æ¯å°†è¿™äº›ç‰‡æ®µé‡æ–°ç»„è£…æˆå®Œæ•´çš„æ•°æ®åŒ…ã€‚ ä¸¾ä¸€ä¸ªå®é™…çš„ä¾‹å­æ¥è¯´æ˜ï¼Ÿå‡è®¾æœ‰ä¸¤ä¸ªè®¾å¤‡ A å’Œ B é€šè¿‡äº’è”ç½‘é€šä¿¡ï¼ŒA çš„ IP åœ°å€æ˜¯ 192.168.1.1ï¼ŒB çš„ IP åœ°å€æ˜¯ 203.0.113.5ã€‚æ•°æ®åŒ…çš„ä¼ è¾“è¿‡ç¨‹å¦‚ä¸‹ï¼š â‘ ã€è®¾å¤‡ A å‘é€æ•°æ®åŒ…ï¼š è®¾å¤‡ A åˆ›å»ºä¸€ä¸ª IP æ•°æ®åŒ…ï¼Œè®¾ç½®æºåœ°å€ä¸º 192.168.1.1ï¼Œç›®çš„åœ°å€ä¸º 203.0.113.5ï¼Œå°†è¦ä¼ è¾“çš„æ•°æ®æ”¾å…¥æ•°æ®éƒ¨åˆ†ã€‚ æ•°æ®åŒ…å°è£…åï¼Œé€šè¿‡æœ¬åœ°ç½‘ç»œå‘é€åˆ°è·¯ç”±å™¨ã€‚ â‘¡ã€è·¯ç”±å™¨è½¬å‘æ•°æ®åŒ…ï¼š è·¯ç”±å™¨æ ¹æ®è·¯ç”±è¡¨æŸ¥æ‰¾ç›®çš„åœ°å€ 203.0.113.5ï¼Œç¡®å®šæ•°æ®åŒ…çš„ä¼ è¾“è·¯å¾„ã€‚ æ•°æ®åŒ…å¯èƒ½ç»è¿‡å¤šä¸ªä¸­é—´è·¯ç”±å™¨ï¼Œæ¯ä¸ªè·¯ç”±å™¨éƒ½æ ¹æ®è·¯ç”±è¡¨é€‰æ‹©ä¸‹ä¸€è·³ï¼Œæœ€ç»ˆåˆ°è¾¾ç›®æ ‡è®¾å¤‡çš„ç½‘ç»œã€‚ â‘¢ã€è®¾å¤‡ B æ¥æ”¶æ•°æ®åŒ…ï¼š è®¾å¤‡ B æ¥æ”¶æ•°æ®åŒ…ï¼Œè¯»å– IP å¤´éƒ¨ä¿¡æ¯ï¼ŒéªŒè¯æ•°æ®åŒ…çš„å®Œæ•´æ€§ã€‚ å¹¶æ•°æ®éƒ¨åˆ†å–å‡ºï¼Œäº¤ç»™ä¸Šå±‚åè®®å¤„ç†ï¼ˆå¦‚ TCP æˆ– UDPï¼‰ã€‚ 49.IP åœ°å€æœ‰å“ªäº›åˆ†ç±»ï¼Ÿä¸€ä¸ª IP åœ°å€åœ¨è¿™ä¸ªäº’è”ç½‘èŒƒå›´å†…æ˜¯å”¯ä¸€çš„ï¼Œä¸€èˆ¬å¯ä»¥è¿™ä¹ˆè®¤ä¸ºï¼ŒIP åœ°å€ = ç½‘ç»œå·ï¼Œä¸»æœºå·ã€‚ ç½‘ç»œå·ï¼šå®ƒæ ‡å¿—ä¸»æœºæ‰€è¿æ¥çš„ç½‘ç»œåœ°å€è¡¨ç¤ºå±äºäº’è”ç½‘çš„å“ªä¸€ä¸ªç½‘ç»œã€‚ ä¸»æœºå·ï¼šå®ƒæ ‡å¿—ä¸»æœºåœ°å€è¡¨ç¤ºå…¶å±äºè¯¥ç½‘ç»œä¸­çš„å“ªä¸€å°ä¸»æœºã€‚ IP åœ°å€åˆ†ä¸º Aï¼ŒBï¼ŒCï¼ŒDï¼ŒE äº”å¤§ç±»ï¼š A ç±»åœ°å€ (1~126)ï¼šä»¥ 0 å¼€å¤´ï¼Œç½‘ç»œå·å å‰ 8 ä½ï¼Œä¸»æœºå·å åé¢ 24 ä½ã€‚ B ç±»åœ°å€ (128~191)ï¼šä»¥ 10 å¼€å¤´ï¼Œç½‘ç»œå·å å‰ 16 ä½ï¼Œä¸»æœºå·å åé¢ 16 ä½ã€‚ C ç±»åœ°å€ (192~223)ï¼šä»¥ 110 å¼€å¤´ï¼Œç½‘ç»œå·å å‰ 24 ä½ï¼Œä¸»æœºå·å åé¢ 8 ä½ã€‚ D ç±»åœ°å€ (224~239)ï¼šä»¥ 1110 å¼€å¤´ï¼Œä¿ç•™ä¸ºå¤šæ’­åœ°å€ã€‚ E ç±»åœ°å€ (240~255)ï¼šä»¥ 1111 å¼€å¤´ï¼Œä¿ç•™ä½ä¸ºå°†æ¥ä½¿ç”¨ 50.åŸŸåå’Œ IP çš„å…³ç³»ï¼Ÿä¸€ä¸ª IP å¯ä»¥å¯¹åº”å¤šä¸ªåŸŸåå—ï¼Ÿ IP åœ°å€åœ¨åŒä¸€ä¸ªç½‘ç»œä¸­æ˜¯å”¯ä¸€çš„ï¼Œç”¨æ¥æ ‡è¯†æ¯ä¸€ä¸ªç½‘ç»œä¸Šçš„è®¾å¤‡ï¼Œå…¶ç›¸å½“äºä¸€ä¸ªäººçš„èº«ä»½è¯å· åŸŸååœ¨åŒä¸€ä¸ªç½‘ç»œä¸­ä¹Ÿæ˜¯å”¯ä¸€çš„ï¼Œå°±åƒæ˜¯ä¸€ä¸ªäººçš„åå­—ã€ç»°å· å‡å¦‚ä½ æœ‰å¤šä¸ªä¸ç”¨çš„ç»°å·ï¼Œä½ çš„æœ‹å‹å¯ä»¥ç”¨å…¶ä¸­ä»»ä½•ä¸€ä¸ªç»°å·å«ä½ ï¼Œä½†ä½ çš„èº«ä»½è¯å·ç å´æ˜¯å”¯ä¸€çš„ã€‚ä½†åŒæ—¶ä½ çš„ç»°å·ä¹Ÿå¯èƒ½å’Œåˆ«äººé‡å¤ï¼Œå‡å¦‚ä½ ä¸åœ¨ï¼Œæœ‰äººå«ä½ çš„ç»°å·ï¼Œå…¶å®ƒäººå¯èƒ½å°±ç­”åº”äº†ã€‚ ä¸€ä¸ªåŸŸåå¯ä»¥å¯¹åº”å¤šä¸ª IPï¼Œä½†è¿™ç§æƒ…å†µ DNS åšè´Ÿè½½å‡è¡¡çš„ï¼Œåœ¨ç”¨æˆ·è®¿é—®è¿‡ç¨‹ä¸­ï¼Œä¸€ä¸ªåŸŸååªèƒ½å¯¹åº”ä¸€ä¸ª IPã€‚ è€Œä¸€ä¸ª IP å´å¯ä»¥å¯¹åº”å¤šä¸ªåŸŸåï¼Œæ˜¯ä¸€å¯¹å¤šçš„å…³ç³»ã€‚ 51.IPV4 åœ°å€ä¸å¤Ÿå¦‚ä½•è§£å†³ï¼Ÿæˆ‘ä»¬çŸ¥é“ï¼ŒIP åœ°å€æœ‰ 32 ä½ï¼Œå¯ä»¥æ ‡è®° 2 çš„ 32 æ¬¡æ–¹ä¸ªåœ°å€ï¼Œå¬èµ·æ¥å¾ˆå¤šï¼Œä½†æ˜¯å…¨çƒçš„ç½‘ç»œè®¾å¤‡æ•°é‡å·²ç»è¿œè¿œè¶…è¿‡è¿™ä¸ªæ•°å­—ï¼Œæ‰€ä»¥ IPV4 åœ°å€å·²ç»ä¸å¤Ÿç”¨äº†ï¼Œé‚£æ€ä¹ˆè§£å†³å‘¢ï¼Ÿ DHCPï¼šåŠ¨æ€ä¸»æœºé…ç½®åè®®ï¼ŒåŠ¨æ€åˆ†é… IP åœ°å€ï¼Œåªç»™æ¥å…¥ç½‘ç»œçš„è®¾å¤‡åˆ†é… IP åœ°å€ï¼Œå› æ­¤åŒä¸€ä¸ª MAC åœ°å€çš„è®¾å¤‡ï¼Œæ¯æ¬¡æ¥å…¥äº’è”ç½‘æ—¶ï¼Œå¾—åˆ°çš„ IP åœ°å€ä¸ä¸€å®šæ˜¯ç›¸åŒçš„ï¼Œè¯¥åè®®ä½¿å¾—ç©ºé—²çš„ IP åœ°å€å¯ä»¥å¾—åˆ°å……åˆ†åˆ©ç”¨ã€‚ CIDRï¼šæ— ç±»åˆ«åŸŸé—´è·¯ç”±ã€‚CIDR æ¶ˆé™¤äº†ä¼ ç»Ÿçš„ A ç±»ã€B ç±»ã€C ç±»åœ°å€ä»¥åŠåˆ’åˆ†å­ç½‘çš„æ¦‚å¿µï¼Œå› è€Œæ›´åŠ æœ‰æ•ˆåœ°åˆ†é… IPv4 çš„åœ°å€ç©ºé—´ï¼Œä½†æ— æ³•ä»æ ¹æœ¬ä¸Šè§£å†³åœ°å€è€—å°½çš„é—®é¢˜ã€‚ NATï¼šç½‘ç»œåœ°å€è½¬æ¢åè®®ï¼Œæˆ‘ä»¬çŸ¥é“å±äºä¸åŒå±€åŸŸç½‘çš„ä¸»æœºå¯ä»¥ä½¿ç”¨ç›¸åŒçš„ IP åœ°å€ï¼Œä»è€Œä¸€å®šç¨‹åº¦ä¸Šç¼“è§£äº† IP èµ„æºæ¯ç«­çš„é—®é¢˜ï¼Œç„¶è€Œä¸»æœºåœ¨å±€åŸŸç½‘ä¸­ä½¿ç”¨çš„ IP åœ°å€æ˜¯ä¸èƒ½åœ¨å…¬ç½‘ä¸­ä½¿ç”¨çš„ï¼Œå½“å±€åŸŸç½‘ä¸»æœºæƒ³è¦ä¸å…¬ç½‘ä¸»æœºè¿›è¡Œé€šä¿¡æ—¶ï¼ŒNAT æ–¹æ³•å¯ä»¥å°†è¯¥ä¸»æœº IP åœ°å€è½¬æ¢ä¸ºå…¨çƒ IP åœ°å€ã€‚è¯¥åè®®èƒ½å¤Ÿæœ‰æ•ˆè§£å†³ IP åœ°å€ä¸è¶³çš„é—®é¢˜ã€‚ IPv6ï¼šä½œä¸ºæ¥æ›¿ IPv4 çš„ä¸‹ä¸€ä»£äº’è”ç½‘åè®®ï¼Œå…¶å¯ä»¥å®ç° 2 çš„ 128 æ¬¡æ–¹ä¸ªåœ°å€ï¼Œè€Œè¿™ä¸ªæ•°é‡çº§ï¼Œå³ä½¿ç»™åœ°çƒä¸Šæ¯ä¸€ç²’æ²™å­éƒ½åˆ†é…ä¸€ä¸ª IP åœ°å€ä¹Ÿå¤Ÿç”¨ï¼Œè¯¥åè®®èƒ½å¤Ÿä»æ ¹æœ¬ä¸Šè§£å†³ IPv4 åœ°å€ä¸å¤Ÿç”¨çš„é—®é¢˜ã€‚ 52.è¯´ä¸‹ ARP åè®®çš„å·¥ä½œè¿‡ç¨‹ï¼ŸARPï¼ˆAddress Resolution Protocolï¼Œåœ°å€è§£æåè®®ï¼‰æ˜¯ç½‘ç»œé€šä¿¡ä¸­çš„ä¸€ç§åè®®ï¼Œä¸»è¦ç›®çš„æ˜¯å°†ç½‘ç»œå±‚çš„ IP åœ°å€è§£æä¸ºé“¾è·¯å±‚çš„ MAC åœ°å€ã€‚ â‘ ã€ARP è¯·æ±‚ å½“ä¸»æœº A è¦å‘é€æ•°æ®ç»™ä¸»æœº B æ—¶ï¼Œé¦–å…ˆä¼šåœ¨è‡ªå·±çš„ ARP ç¼“å­˜ä¸­æŸ¥æ‰¾ä¸»æœº B çš„ MAC åœ°å€ã€‚ å¦‚æœæ²¡æœ‰æ‰¾åˆ°ï¼Œä¸»æœº A ä¼šå‘ç½‘ç»œä¸­å¹¿æ’­ä¸€ä¸ª ARP è¯·æ±‚æ•°æ®åŒ…ï¼Œè¯·æ±‚ç½‘ç»œä¸­çš„æ‰€æœ‰ä¸»æœºå‘Šè¯‰å®ƒä»¬çš„ MAC åœ°å€ï¼›è¿™ä¸ªè¯·æ±‚åŒ…å«äº†è¯·æ±‚è®¾å¤‡å’Œç›®æ ‡è®¾å¤‡çš„ IP å’Œ MAC åœ°å€ã€‚ â‘¡ã€ARP åº”ç­” ç½‘ç»œä¸­çš„æ‰€æœ‰ä¸»æœºéƒ½ä¼šæ”¶åˆ°è¿™ä¸ª ARP è¯·æ±‚ï¼Œä½†åªæœ‰ä¸»æœº B ä¼šå›å¤ ARP åº”ç­”ï¼Œå‘Šè¯‰ä¸»æœº A è‡ªå·±çš„ MAC åœ°å€ã€‚ å¹¶ä¸”ä¸»æœº B ä¼šå°†ä¸»æœº A çš„ IP å’Œ MAC åœ°å€æ˜ å°„å…³ç³»ç¼“å­˜åˆ°è‡ªå·±çš„ ARP ç¼“å­˜ä¸­ï¼Œä»¥ä¾¿ä¸‹æ¬¡é€šä¿¡æ—¶ç›´æ¥ä½¿ç”¨ã€‚ â‘¢ã€æ›´æ–° ARP ç¼“å­˜ ä¸»æœº A æ”¶åˆ°ä¸»æœº B çš„ ARP åº”ç­”åï¼Œä¹Ÿä¼šå°†ä¸»æœº B çš„ IP å’Œ MAC åœ°å€æ˜ å°„å…³ç³»ç¼“å­˜åˆ°è‡ªå·±çš„ ARP ç¼“å­˜ä¸­ã€‚ 53.ä¸ºä»€ä¹ˆæ—¢æœ‰ IP åœ°å€ï¼Œåˆæœ‰ MAC åœ°å€ï¼Ÿ MAC åœ°å€å’Œ IP åœ°å€éƒ½æœ‰ä»€ä¹ˆä½œç”¨ï¼Ÿ MAC åœ°å€æ˜¯æ•°æ®é“¾è·¯å±‚å’Œç‰©ç†å±‚ä½¿ç”¨çš„åœ°å€ï¼Œæ˜¯å†™åœ¨ç½‘å¡ä¸Šçš„ç‰©ç†åœ°å€ï¼Œç”¨æ¥å®šä¹‰ç½‘ç»œè®¾å¤‡çš„ä½ç½®ï¼Œä¸å¯å˜æ›´ã€‚ IP åœ°å€æ˜¯ç½‘ç»œå±‚å’Œä»¥ä¸Šå„å±‚ä½¿ç”¨çš„åœ°å€ï¼Œæ˜¯ä¸€ç§é€»è¾‘åœ°å€ã€‚IP åœ°å€ç”¨æ¥åŒºåˆ«ç½‘ç»œä¸Šçš„è®¡ç®—æœºã€‚ ä¸ºä»€ä¹ˆæœ‰äº† MAC åœ°å€è¿˜éœ€è¦ IP åœ°å€ï¼Ÿ å¦‚æœæˆ‘ä»¬åªä½¿ç”¨ MAC åœ°å€è¿›è¡Œå¯»å€çš„è¯ï¼Œæˆ‘ä»¬éœ€è¦è·¯ç”±å™¨è®°ä½æ¯ä¸ª MAC åœ°å€å±äºå“ªä¸ªå­ç½‘ï¼Œä¸ç„¶ä¸€æ¬¡è·¯ç”±å™¨æ”¶åˆ°æ•°æ®åŒ…éƒ½è¦æ»¡ä¸–ç•Œå¯»æ‰¾ç›®çš„ MAC åœ°å€ã€‚è€Œæˆ‘ä»¬çŸ¥é“ MAC åœ°å€çš„é•¿åº¦ä¸º 48 ä½ï¼Œä¹Ÿå°±æ˜¯æœ€å¤šå…±æœ‰ 2 çš„ 48 æ¬¡æ–¹ä¸ª MAC åœ°å€ï¼Œè¿™å°±æ„å‘³ç€æ¯ä¸ªè·¯ç”±å™¨éœ€è¦ 256T çš„å†…å­˜ï¼Œæ˜¾ç„¶æ˜¯ä¸ç°å®çš„ã€‚ å’Œ MAC åœ°å€ä¸åŒï¼ŒIP åœ°å€æ˜¯å’Œåœ°åŸŸç›¸å…³çš„ï¼Œåœ¨ä¸€ä¸ªå­ç½‘ä¸­çš„è®¾å¤‡ï¼Œæˆ‘ä»¬ç»™å…¶åˆ†é…çš„ IP åœ°å€å‰ç¼€éƒ½æ˜¯ä¸€æ ·çš„ï¼Œè¿™æ ·è·¯ç”±å™¨å°±èƒ½æ ¹æ® IP åœ°å€çš„å‰ç¼€çŸ¥é“è¿™ä¸ªè®¾å¤‡å±äºå“ªä¸ªå­ç½‘ï¼Œå‰©ä¸‹çš„å¯»å€å°±äº¤ç»™å­ç½‘å†…éƒ¨å®ç°ï¼Œä»è€Œå¤§å¤§å‡å°‘äº†è·¯ç”±å™¨æ‰€éœ€è¦çš„å†…å­˜ã€‚ ä¸ºä»€ä¹ˆæœ‰äº† IP åœ°å€è¿˜éœ€è¦ MAC åœ°å€ï¼Ÿ åªæœ‰å½“è®¾å¤‡è¿å…¥ç½‘ç»œæ—¶ï¼Œæ‰èƒ½æ ¹æ®ä»–è¿›å…¥äº†å“ªä¸ªå­ç½‘æ¥ä¸ºå…¶åˆ†é… IP åœ°å€ï¼Œåœ¨è®¾å¤‡è¿˜æ²¡æœ‰ IP åœ°å€çš„æ—¶å€™ï¼Œæˆ–è€…åœ¨åˆ†é… IP çš„è¿‡ç¨‹ä¸­ã€‚æˆ‘ä»¬éœ€è¦ MAC åœ°å€æ¥åŒºåˆ†ä¸åŒçš„è®¾å¤‡ã€‚ IP åœ°å€å¯ä»¥æ¯”ä½œä¸ºåœ°å€ï¼ŒMAC åœ°å€ä¸ºæ”¶ä»¶äººï¼Œåœ¨ä¸€æ¬¡é€šä¿¡è¿‡ç¨‹ä¸­ï¼Œä¸¤è€…æ˜¯ç¼ºä¸€ä¸å¯çš„ã€‚ 54.ICMP åè®®çš„åŠŸèƒ½ï¼ŸICMPï¼ˆInternet Control Message Protocolï¼‰ ï¼Œç½‘é™…æ§åˆ¶æŠ¥æ–‡åè®®ã€‚ ICMP åè®®æ˜¯ä¸€ç§é¢å‘æ— è¿æ¥çš„åè®®ï¼Œç”¨äºä¼ è¾“å‡ºé”™æŠ¥å‘Šæ§åˆ¶ä¿¡æ¯ã€‚ å®ƒæ˜¯ä¸€ä¸ªéå¸¸é‡è¦çš„åè®®ï¼Œå®ƒå¯¹äºç½‘ç»œå®‰å…¨å…·æœ‰æå…¶é‡è¦çš„æ„ä¹‰ã€‚å®ƒå±äºç½‘ç»œå±‚åè®®ï¼Œä¸»è¦ç”¨äºåœ¨ä¸»æœºä¸è·¯ç”±å™¨ä¹‹é—´ä¼ é€’æ§åˆ¶ä¿¡æ¯ï¼ŒåŒ…æ‹¬æŠ¥å‘Šé”™è¯¯ã€äº¤æ¢å—é™æ§åˆ¶å’ŒçŠ¶æ€ä¿¡æ¯ç­‰ã€‚ å½“é‡åˆ° IP æ•°æ®æ— æ³•è®¿é—®ç›®æ ‡ã€IP è·¯ç”±å™¨æ— æ³•æŒ‰å½“å‰çš„ä¼ è¾“é€Ÿç‡è½¬å‘æ•°æ®åŒ…ç­‰æƒ…å†µæ—¶ï¼Œä¼šè‡ªåŠ¨å‘é€ ICMP æ¶ˆæ¯ã€‚ æ¯”å¦‚æˆ‘ä»¬æ—¥å¸¸ä½¿ç”¨å¾—æ¯”è¾ƒå¤šçš„Â pingï¼Œå°±æ˜¯åŸºäº ICMP çš„ã€‚ 55.è¯´ä¸‹ ping çš„åŸç†ï¼Ÿpingï¼ŒPacket Internet Groperï¼Œä¸€ä¸ªç½‘ç»œå·¥å…·ï¼Œä¸»è¦ç”¨æ¥æµ‹è¯•ç½‘ç»œè¿æ¥çš„å¯è¾¾æ€§å’Œå»¶è¿Ÿã€‚ Ping çš„è¿‡ç¨‹ä¸»è¦åŸºäº ICMPï¼ˆInternet Control Message Protocolï¼Œäº’è”ç½‘æ§åˆ¶æ¶ˆæ¯åè®®ï¼‰å®ç°ï¼Œå…¶åŸºæœ¬è¿‡ç¨‹åŒ…æ‹¬ï¼š â‘ ã€å½“æ‰§è¡Œ Ping å‘½ä»¤ï¼Œå¦‚ping javabetter.cnï¼ŒPing é¦–å…ˆè§£æåŸŸåè·å– IP åœ°å€ï¼Œç„¶åå‘ç›®æ ‡ IP å‘é€ä¸€ä¸ª ICMP Echo Request æ¶ˆæ¯ã€‚ â‘¡ã€å½“ç›®æ ‡ IP æ”¶åˆ° ICMP Echo Request æ¶ˆæ¯åï¼Œå®ƒä¼šç”Ÿæˆä¸€ä¸ª ICMP Echo Reply æ¶ˆæ¯å¹¶è¿”å›ï¼Œå³ Ping å“åº”æ¶ˆæ¯ã€‚ â‘¢ã€å‘èµ· Ping å‘½ä»¤çš„è®¾å¤‡æ¥æ”¶åˆ° ICMP Echo Reply æ¶ˆæ¯åï¼Œè®¡ç®—å¹¶æ˜¾ç¤ºä»å‘é€ Echo Request åˆ°æ¥æ”¶åˆ° Echo Replyçš„æ—¶é—´ï¼ˆé€šå¸¸ç§°ä¸ºå¾€è¿”æ—¶é—´ RTTï¼ŒRound-Trip Timeï¼‰ï¼Œä»¥åŠå¯èƒ½çš„ä¸¢åŒ…æƒ…å†µã€‚ Ping é€šå¸¸ä¼šå‘é€å¤šä¸ªè¯·æ±‚ï¼Œä»¥ä¾¿æä¾›å¹³å‡å“åº”æ—¶é—´å’Œä¸¢åŒ…ç‡ç­‰ä¿¡æ¯ï¼Œä»¥ä¾¿æˆ‘ä»¬äº†è§£ç½‘ç»œè¿æ¥çš„è´¨é‡ã€‚ ç½‘ç»œå®‰å…¨56.è¯´è¯´æœ‰å“ªäº›å®‰å…¨æ”»å‡»ï¼Ÿç½‘ç»œå®‰å…¨æ”»å‡»ä¸»è¦åˆ†ä¸ºä¸¤ç§ç±»å‹ï¼Œè¢«åŠ¨æ”»å‡»å’Œä¸»åŠ¨æ”»å‡»ï¼š è¢«åŠ¨æ”»å‡»ï¼šæ˜¯æŒ‡æ”»å‡»è€…ä»ç½‘ç»œä¸Šçªƒå¬ä»–äººçš„é€šä¿¡å†…å®¹ï¼Œé€šå¸¸æŠŠè¿™ç±»æ”»å‡»ç§°ä¸ºæˆªè·ï¼Œè¢«åŠ¨æ”»å‡»ä¸»è¦æœ‰ä¸¤ç§å½¢å¼ï¼šæ¶ˆæ¯å†…å®¹æ³„éœ²æ”»å‡»å’Œæµé‡åˆ†ææ”»å‡»ã€‚ç”±äºæ”»å‡»è€…æ²¡æœ‰ä¿®æ”¹æ•°æ®ï¼Œä½¿å¾—è¿™ç§æ”»å‡»å¾ˆéš¾è¢«æ£€æµ‹åˆ°ã€‚ ä¸»åŠ¨æ”»å‡»ï¼šç›´æ¥å¯¹ç°æœ‰çš„æ•°æ®å’ŒæœåŠ¡é€ æˆå½±å“ï¼Œå¸¸è§çš„ä¸»åŠ¨æ”»å‡»ç±»å‹æœ‰ï¼š ç¯¡æ”¹ï¼šæ”»å‡»è€…æ•…æ„ç¯¡æ”¹ç½‘ç»œä¸Šé€çš„æŠ¥æ–‡ï¼Œç”šè‡³æŠŠå®Œå…¨ä¼ªé€ çš„æŠ¥æ–‡ä¼ é€ç»™æ¥æ”¶æ–¹ã€‚ æ¶æ„ç¨‹åºï¼šæ¶æ„ç¨‹åºç§ç±»ç¹å¤šï¼ŒåŒ…æ‹¬è®¡ç®—æœºç—…æ¯’ã€è®¡ç®—æœºè •è™«ã€ç‰¹æ´›ä¼Šæœ¨é©¬ã€åé—¨å…¥ä¾µã€æµæ°“è½¯ä»¶ç­‰ç­‰ã€‚ æ‹’ç»æœåŠ¡ Dosï¼šæ”»å‡»è€…å‘æœåŠ¡å™¨ä¸åœåœ°å‘é€åˆ†ç»„ï¼Œä½¿æœåŠ¡å™¨æ— æ³•æä¾›æ­£å¸¸æœåŠ¡ã€‚ 57.DNS åŠ«æŒäº†è§£å—ï¼ŸDNS åŠ«æŒå³åŸŸååŠ«æŒï¼Œæ˜¯é€šè¿‡å°†åŸåŸŸåå¯¹åº”çš„ IP åœ°å€è¿›è¡Œæ›¿æ¢ï¼Œä»è€Œä½¿ç”¨æˆ·è®¿é—®åˆ°é”™è¯¯çš„ç½‘ç«™ï¼Œæˆ–è€…ä½¿ç”¨æˆ·æ— æ³•æ­£å¸¸è®¿é—®ç½‘ç«™çš„ä¸€ç§æ”»å‡»æ–¹å¼ã€‚ åŸŸååŠ«æŒå¾€å¾€åªèƒ½åœ¨ç‰¹å®šçš„ç½‘ç»œèŒƒå›´å†…è¿›è¡Œï¼ŒèŒƒå›´å¤–çš„ DNS æœåŠ¡å™¨èƒ½å¤Ÿè¿”å›æ­£å¸¸çš„ IP åœ°å€ã€‚æ”»å‡»è€…å¯ä»¥å†’å……åŸåŸŸåæ‰€å±æœºæ„ï¼Œé€šè¿‡ç”µå­é‚®ä»¶çš„æ–¹å¼ä¿®æ”¹ç»„ç»‡æœºæ„çš„åŸŸåæ³¨å†Œä¿¡æ¯ï¼Œæˆ–è€…å°†åŸŸåè½¬è®©ç»™å…¶å®ƒä¸»æŒï¼Œå¹¶å°†æ–°çš„åŸŸåä¿¡æ¯ä¿å­˜åœ¨æ‰€æŒ‡å®šçš„ DNS æœåŠ¡å™¨ä¸­ï¼Œä»è€Œä½¿ç”¨æˆ·æ— æ³•å¯¹åŸåŸŸåæ¥è¿›è¡Œè§£æä»¥è®¿é—®ç›®æ ‡åœ°å€ã€‚ DNS åŠ«æŒçš„æ­¥éª¤æ˜¯ä»€ä¹ˆæ ·çš„ï¼Ÿ è·å–è¦åŠ«æŒçš„åŸŸåä¿¡æ¯ï¼šæ”»å‡»è€…ä¼šé¦–å…ˆè®¿é—®åŸŸåæŸ¥è¯¢è¦åŠ«æŒçš„ç«™ç‚¹çš„åŸŸåä¿¡æ¯ã€‚ æ§åˆ¶åŸŸåå“åº”çš„ E-Mail è´¦å·ï¼šåœ¨è·å–åˆ°åŸŸåä¿¡æ¯åï¼Œæ”»å‡»è€…é€šè¿‡æš´åŠ›ç ´è§£æˆ–è€…ä¸“é—¨çš„æ–¹æ³•ç ´è§£å…¬å¸æ³¨å†ŒåŸŸåæ—¶ä½¿ç”¨çš„ E-mail è´¦å·æ‰€å¯¹åº”çš„å¯†ç ï¼Œæ›´é«˜çº§çš„æ”»å‡»è€…ç”šè‡³èƒ½å¤Ÿç›´æ¥å¯¹ E-Mail è¿›è¡Œä¿¡æ¯çªƒå–ã€‚ ä¿®æ”¹æ³¨å†Œä¿¡æ¯ï¼šå½“æ”»å‡»è€…ç ´è§£äº† E-Mail åï¼Œä¼šåˆ©ç”¨ç›¸å…³çš„æ›´æ”¹åŠŸèƒ½ä¿®æ”¹è¯¥åŸŸåçš„æ³¨å†Œä¿¡æ¯ï¼ŒåŒ…æ‹¬åŸŸåæ‹¥æœ‰è€…ä¿¡æ¯ï¼ŒDNS æœåŠ¡å™¨ä¿¡æ¯ç­‰ã€‚ ä½¿ç”¨ E-Mail æ”¶å‘ç¡®è®¤å‡½ï¼šåœ¨ä¿®æ”¹å®Œæ³¨å†Œä¿¡æ¯åï¼Œæ”»å‡»è€… E-Mail åœ¨çœŸæ­£æ‹¥æœ‰è€…ä¹‹å‰æ”¶åˆ°ä¿®æ”¹åŸŸåæ³¨å†Œä¿¡æ¯çš„ç›¸å…³ç¡®è®¤ä¿¡æ¯ï¼Œå¹¶å›å¤ç¡®è®¤ä¿®æ”¹æ–‡ä»¶ï¼Œå¾…ç½‘ç»œå…¬å¸æ¢å¤å·²æˆåŠŸä¿®æ”¹ä¿¡ä»¶åï¼Œæ”»å‡»è€…ä¾¿æˆåŠŸå®Œæˆ DNS åŠ«æŒã€‚ æ€ä¹ˆåº”å¯¹ DNS åŠ«æŒï¼Ÿ ç›´æ¥é€šè¿‡ IP åœ°å€è®¿é—®ç½‘ç«™ï¼Œé¿å¼€ DNS åŠ«æŒ ç”±äºåŸŸååŠ«æŒå¾€å¾€åªèƒ½åœ¨ç‰¹å®šçš„ç½‘ç»œèŒƒå›´å†…è¿›è¡Œï¼Œå› æ­¤ä¸€äº›é«˜çº§ç”¨æˆ·å¯ä»¥é€šè¿‡ç½‘ç»œè®¾ç½®è®© DNS æŒ‡å‘æ­£å¸¸çš„åŸŸåæœåŠ¡å™¨ä»¥å®ç°å¯¹ç›®æ ‡ç½‘å€çš„æ­£å¸¸è®¿é—®ï¼Œä¾‹å¦‚è®¡ç®—æœºé¦–é€‰ DNS æœåŠ¡å™¨çš„åœ°å€å›ºå®šä¸º 8.8.8.8ã€‚ 58.ä»€ä¹ˆæ˜¯ CSRF æ”»å‡»ï¼Ÿå¦‚ä½•é¿å…ï¼Ÿ ä»€ä¹ˆæ˜¯ CSRF æ”»å‡»ï¼Ÿ CSRFï¼Œè·¨ç«™è¯·æ±‚ä¼ªé€ ï¼ˆè‹±æ–‡å…¨ç§°æ˜¯ Cross-site request forgeryï¼‰ï¼Œæ˜¯ä¸€ç§æŒŸæŒç”¨æˆ·åœ¨å½“å‰å·²ç™»å½•çš„ Web åº”ç”¨ç¨‹åºä¸Šæ‰§è¡Œéæœ¬æ„çš„æ“ä½œçš„æ”»å‡»æ–¹æ³•ã€‚ CSRF æ˜¯å¦‚ä½•æ”»å‡»çš„å‘¢ï¼Ÿ æ¥çœ‹ä¸€ä¸ªä¾‹å­ï¼š ç”¨æˆ·ç™»é™†é“¶è¡Œï¼Œæ²¡æœ‰é€€å‡ºï¼Œæµè§ˆå™¨åŒ…å«äº† ç”¨æˆ· åœ¨é“¶è¡Œçš„èº«ä»½è®¤è¯ä¿¡æ¯ã€‚ æ”»å‡»è€…å°†ä¼ªé€ çš„è½¬è´¦è¯·æ±‚ï¼ŒåŒ…å«åœ¨åœ¨å¸–å­ ç”¨æˆ·åœ¨é“¶è¡Œç½‘ç«™ä¿æŒç™»é™†çš„æƒ…å†µä¸‹ï¼Œæµè§ˆå¸–å­ å°†ä¼ªé€ çš„è½¬è´¦è¯·æ±‚è¿åŒèº«ä»½è®¤è¯ä¿¡æ¯ï¼Œå‘é€åˆ°é“¶è¡Œç½‘ç«™ é“¶è¡Œç½‘ç«™çœ‹åˆ°èº«ä»½è®¤è¯ä¿¡æ¯ï¼Œä»¥ä¸ºå°±æ˜¯ ç”¨æˆ·çš„åˆæ³•æ“ä½œï¼Œæœ€åé€ æˆç”¨æˆ·èµ„é‡‘æŸå¤±ã€‚ æ€ä¹ˆåº”å¯¹ CSRF æ”»å‡»å‘¢ï¼Ÿ æ£€æŸ¥ Referer å­—æ®µ HTTP å¤´ä¸­çš„ Referer å­—æ®µè®°å½•äº†è¯¥ HTTP è¯·æ±‚çš„æ¥æºåœ°å€ã€‚åœ¨é€šå¸¸æƒ…å†µä¸‹ï¼Œè®¿é—®ä¸€ä¸ªå®‰å…¨å—é™é¡µé¢çš„è¯·æ±‚æ¥è‡ªäºåŒä¸€ä¸ªç½‘ç«™ï¼Œè€Œå¦‚æœé»‘å®¢è¦å¯¹å…¶å®æ–½ CSRF æ”»å‡»ï¼Œä»–ä¸€èˆ¬åªèƒ½åœ¨ä»–è‡ªå·±çš„ç½‘ç«™æ„é€ è¯·æ±‚ã€‚å› æ­¤ï¼Œå¯ä»¥é€šè¿‡éªŒè¯ Referer å€¼æ¥é˜²å¾¡ CSRF æ”»å‡»ã€‚ æ·»åŠ æ ¡éªŒ token ä»¥åœ¨ HTTP è¯·æ±‚ä¸­ä»¥å‚æ•°çš„å½¢å¼åŠ å…¥ä¸€ä¸ªéšæœºäº§ç”Ÿçš„ tokenï¼Œå¹¶åœ¨æœåŠ¡å™¨ç«¯å»ºç«‹ä¸€ä¸ªæ‹¦æˆªå™¨æ¥éªŒè¯è¿™ä¸ª tokenï¼Œå¦‚æœè¯·æ±‚ä¸­æ²¡æœ‰ token æˆ–è€… token å†…å®¹ä¸æ­£ç¡®ï¼Œåˆ™è®¤ä¸ºå¯èƒ½æ˜¯ CSRF æ”»å‡»è€Œæ‹’ç»è¯¥è¯·æ±‚ã€‚ æ•æ„Ÿæ“ä½œå¤šé‡æ ¡éªŒ å¯¹ä¸€äº›æ•æ„Ÿçš„æ“ä½œï¼Œé™¤äº†éœ€è¦æ ¡éªŒç”¨æˆ·çš„è®¤è¯ä¿¡æ¯ï¼Œè¿˜å¯ä»¥é€šè¿‡é‚®ç®±ç¡®è®¤ã€éªŒè¯ç ç¡®è®¤è¿™æ ·çš„æ–¹å¼å¤šé‡æ ¡éªŒã€‚ 59.ä»€ä¹ˆæ˜¯ DoSã€DDoSã€DRDoS æ”»å‡»ï¼Ÿ DOS: (Denial of Service), ç¿»è¯‘è¿‡æ¥å°±æ˜¯æ‹’ç»æœåŠ¡, ä¸€åˆ‡èƒ½å¼•èµ·æ‹’ç» è¡Œä¸ºçš„æ”»å‡»éƒ½è¢«ç§°ä¸º DOS æ”»å‡»ã€‚æœ€å¸¸è§çš„ DoS æ”»å‡»å°±æœ‰è®¡ç®—æœºç½‘ç»œå®½å¸¦æ”»å‡»ã€è¿é€šæ€§æ”»å‡»ã€‚ DDoS: (Distributed Denial of Service)ï¼Œç¿»è¯‘è¿‡æ¥æ˜¯åˆ†å¸ƒå¼æ‹’ç»æœåŠ¡ã€‚æ˜¯æŒ‡å¤„äºä¸åŒä½ç½®çš„å¤šä¸ªæ”»å‡»è€…åŒæ—¶å‘ä¸€ä¸ªæˆ–å‡ ä¸ªç›®æ ‡å‘åŠ¨æ”»å‡»ï¼Œæˆ–è€…ä¸€ä¸ªæ”»å‡»è€…æ§åˆ¶äº†ä½äºä¸åŒä½ç½®çš„å¤šå°æœºå™¨ï¼Œå¹¶åˆ©ç”¨è¿™äº›æœºå™¨å¯¹å—å®³è€…åŒæ—¶å®æ–½æ”»å‡»ã€‚ ä¸»è¦å½¢å¼æœ‰æµé‡æ”»å‡»å’Œèµ„æºè€—å°½æ”»å‡»ï¼Œå¸¸è§çš„ DDoS æ”»å‡»æœ‰ï¼šSYN Floodã€Ping of Deathã€ACK Floodã€UDP FloodÂ ç­‰ã€‚ DRDoS: (Distributed Reflection Denial of Service)ï¼Œä¸­æ–‡æ˜¯åˆ†å¸ƒå¼åå°„æ‹’ç»æœåŠ¡ï¼Œè¯¥æ–¹å¼é çš„æ˜¯å‘é€å¤§é‡å¸¦æœ‰è¢«å®³è€… IP åœ°å€çš„æ•°æ®åŒ…ç»™æ”»å‡»ä¸»æœºï¼Œç„¶åæ”»å‡»ä¸»æœºå¯¹ IP åœ°å€æºåšå‡ºå¤§é‡å›åº”ï¼Œä»è€Œå½¢æˆæ‹’ç»æœåŠ¡æ”»å‡»ã€‚ å¦‚ä½•é˜²èŒƒ DDoS? é’ˆå¯¹ DDoS ä¸­çš„æµé‡æ”»å‡»ï¼Œæœ€ç›´æ¥çš„æ–¹æ³•æ˜¯å¢åŠ å¸¦å®½ï¼Œç†è®ºä¸Šåªè¦å¸¦å®½å¤§äºæ”»å‡»æµé‡å°±å¯ä»¥äº†ï¼Œä½†æ˜¯è¿™ç§æ–¹æ³•æˆæœ¬éå¸¸é«˜ã€‚åœ¨æœ‰å……è¶³å¸¦å®½çš„å‰æä¸‹ï¼Œæˆ‘ä»¬åº”è¯¥å°½é‡æå‡è·¯ç”±å™¨ã€ç½‘å¡ã€äº¤æ¢æœºç­‰ç¡¬ä»¶è®¾æ–½çš„é…ç½®ã€‚ é’ˆå¯¹èµ„æºè€—å°½æ”»å‡»ï¼Œæˆ‘ä»¬å¯ä»¥å‡çº§ä¸»æœºæœåŠ¡å™¨ç¡¬ä»¶ï¼Œåœ¨ç½‘ç»œå¸¦å®½å¾—åˆ°ä¿è¯çš„å‰æä¸‹ï¼Œä½¿å¾—æœåŠ¡å™¨èƒ½å¤Ÿæœ‰æ•ˆå¯¹æŠ—æµ·é‡çš„ SYN æ”»å‡»åŒ…ã€‚æˆ‘ä»¬ä¹Ÿå¯ä»¥å®‰è£…ä¸“ä¸šçš„æŠ— DDoS é˜²ç«å¢™ï¼Œä»è€Œå¯¹æŠ— SYN Flood ç­‰æµé‡å‹æ”»å‡»ã€‚ç“·ç¢—ï¼Œè´Ÿè½½å‡è¡¡ï¼ŒCDN ç­‰æŠ€æœ¯éƒ½èƒ½æœ‰æ•ˆå¯¹æŠ— DDos æ”»å‡»ã€‚ 60.ä»€ä¹ˆæ˜¯ XSS æ”»å‡»ï¼Œå¦‚ä½•é¿å…?XSS æ”»å‡»ä¹Ÿæ˜¯æ¯”è¾ƒå¸¸è§ï¼ŒXSSï¼Œå«è·¨ç«™è„šæœ¬æ”»å‡»ï¼ˆCross-Site Scriptingï¼‰ï¼Œå› ä¸ºä¼šä¸å±‚å æ ·å¼è¡¨ (Cascading Style Sheets, CSS) çš„ç¼©å†™æ··æ·†ï¼Œå› æ­¤æœ‰äººå°†è·¨ç«™è„šæœ¬æ”»å‡»ç¼©å†™ä¸º XSSã€‚å®ƒæŒ‡çš„æ˜¯æ¶æ„æ”»å‡»è€…å¾€ Web é¡µé¢é‡Œæ’å…¥æ¶æ„ html ä»£ç ï¼Œå½“ç”¨æˆ·æµè§ˆç½‘é¡µçš„æ—¶å€™ï¼ŒåµŒå…¥å…¶ä¸­ Web é‡Œé¢çš„ html ä»£ç ä¼šè¢«æ‰§è¡Œï¼Œä»è€Œè¾¾åˆ°æ¶æ„æ”»å‡»ç”¨æˆ·çš„ç‰¹æ®Šç›®çš„ã€‚ XSS æ”»å‡»ä¸€èˆ¬åˆ†ä¸‰ç§ç±»å‹ï¼šå­˜å‚¨å‹ ã€åå°„å‹ ã€DOM å‹ XSS XSS æ˜¯å¦‚ä½•æ”»å‡»çš„å‘¢ï¼Ÿ ç®€å•è¯´ï¼ŒXSS çš„æ”»å‡»æ–¹å¼å°±æ˜¯æƒ³åŠæ³•â€œæ•™å”†â€ç”¨æˆ·çš„æµè§ˆå™¨å»æ‰§è¡Œä¸€äº›è¿™ä¸ªç½‘é¡µä¸­åŸæœ¬ä¸å­˜åœ¨çš„å‰ç«¯ä»£ç ã€‚ æ‹¿åå°„å‹ä¸¾ä¸ªä¾‹å­å§ï¼Œæµç¨‹å›¾å¦‚ä¸‹ï¼š æ”»å‡»è€…æ„é€ å‡ºç‰¹æ®Šçš„ URLï¼Œå…¶ä¸­åŒ…å«æ¶æ„ä»£ç ã€‚ ç”¨æˆ·æ‰“å¼€å¸¦æœ‰æ¶æ„ä»£ç çš„ URL æ—¶ï¼Œè®¿é—®æ­£å¸¸ç½‘ç«™æœåŠ¡å™¨ ç½‘ç«™æœåŠ¡ç«¯å°†æ¶æ„ä»£ç ä» URL ä¸­å–å‡ºï¼Œæ‹¼æ¥åœ¨ HTML ä¸­è¿”å›ç»™æµè§ˆå™¨ã€‚ ç”¨æˆ·æµè§ˆå™¨æ¥æ”¶åˆ°å“åº”åè§£ææ‰§è¡Œï¼Œæ··åœ¨å…¶ä¸­çš„æ¶æ„ä»£ç ä¹Ÿè¢«æ‰§è¡Œï¼Œè¯·æ±‚æ¶æ„æœåŠ¡å™¨ï¼Œå‘é€ç”¨æˆ·æ•°æ® æ”»å‡»è€…å°±å¯ä»¥çªƒå–ç”¨æˆ·çš„æ•°æ®ï¼Œä»¥æ­¤å†’å……ç”¨æˆ·çš„è¡Œä¸ºï¼Œè°ƒç”¨ç›®æ ‡ç½‘ç«™æ¥å£æ‰§è¡Œæ”»å‡»è€…æŒ‡å®šçš„æ“ä½œã€‚ å¦‚ä½•åº”å¯¹ XSS æ”»å‡»ï¼Ÿ å¯¹è¾“å…¥è¿›è¡Œè¿‡æ»¤ï¼Œè¿‡æ»¤æ ‡ç­¾ç­‰ï¼Œåªå…è®¸åˆæ³•å€¼ã€‚ HTML è½¬ä¹‰ å¯¹äºé“¾æ¥è·³è½¬ï¼Œå¦‚a href=xxxÂ ç­‰ï¼Œè¦æ ¡éªŒå†…å®¹ï¼Œç¦æ­¢ä»¥ script å¼€å¤´çš„éæ³•é“¾æ¥ã€‚ é™åˆ¶è¾“å…¥é•¿åº¦ 61.å¯¹ç§°åŠ å¯†ä¸éå¯¹ç§°åŠ å¯†æœ‰ä»€ä¹ˆåŒºåˆ«ï¼Ÿå¯¹ç§°åŠ å¯†ï¼šæŒ‡åŠ å¯†å’Œè§£å¯†ä½¿ç”¨åŒä¸€å¯†é’¥ï¼Œä¼˜ç‚¹æ˜¯è¿ç®—é€Ÿåº¦è¾ƒå¿«ï¼Œç¼ºç‚¹æ˜¯å¦‚ä½•å®‰å…¨å°†å¯†é’¥ä¼ è¾“ç»™å¦ä¸€æ–¹ã€‚å¸¸è§çš„å¯¹ç§°åŠ å¯†ç®—æ³•æœ‰ï¼šDESã€AES ç­‰ã€‚ éå¯¹ç§°åŠ å¯†ï¼šæŒ‡çš„æ˜¯åŠ å¯†å’Œè§£å¯†ä½¿ç”¨ä¸åŒçš„å¯†é’¥ï¼ˆå³å…¬é’¥å’Œç§é’¥ï¼‰ã€‚å…¬é’¥ä¸ç§é’¥æ˜¯æˆå¯¹å­˜åœ¨çš„ï¼Œå¦‚æœç”¨å…¬é’¥å¯¹æ•°æ®è¿›è¡ŒåŠ å¯†ï¼Œåªæœ‰å¯¹åº”çš„ç§é’¥æ‰èƒ½è§£å¯†ã€‚å¸¸è§çš„éå¯¹ç§°åŠ å¯†ç®—æ³•æœ‰ RSAã€‚ 62.RSA å’Œ AES ç®—æ³•æœ‰ä»€ä¹ˆåŒºåˆ«ï¼Ÿ RSA é‡‡ç”¨éå¯¹ç§°åŠ å¯†çš„æ–¹å¼ï¼Œé‡‡ç”¨å…¬é’¥è¿›è¡ŒåŠ å¯†ï¼Œç§é’¥è§£å¯†çš„å½¢å¼ã€‚å…¶ç§é’¥é•¿åº¦ä¸€èˆ¬è¾ƒé•¿ï¼Œç”±äºéœ€è¦å¤§æ•°çš„ä¹˜å¹‚æ±‚æ¨¡ç­‰è¿ç®—ï¼Œå…¶è¿ç®—é€Ÿåº¦è¾ƒæ…¢ï¼Œä¸åˆé€‚å¤§é‡æ•°æ®æ–‡ä»¶åŠ å¯†ã€‚ AES é‡‡ç”¨å¯¹ç§°åŠ å¯†çš„æ–¹å¼ï¼Œå…¶ç§˜é’¥é•¿åº¦æœ€é•¿åªæœ‰ 256 ä¸ªæ¯”ç‰¹ï¼ŒåŠ å¯†å’Œè§£å¯†é€Ÿåº¦è¾ƒå¿«ï¼Œæ˜“äºç¡¬ä»¶å®ç°ã€‚ç”±äºæ˜¯å¯¹ç§°åŠ å¯†ï¼Œé€šä¿¡åŒæ–¹åœ¨è¿›è¡Œæ•°æ®ä¼ è¾“å‰éœ€è¦è·çŸ¥åŠ å¯†å¯†é’¥ã€‚","tags":["åŸºç¡€","è®¡ç®—æœºç½‘ç»œ"],"categories":["Javaé—®ç­”ç¬”è®°"]},{"title":"2025.7.14å­¦ä¹ æ—¥è®°","path":"/2025/07/14/å­¦ä¹ æ—¥è®°25å¹´7æœˆ/2025.7.14å­¦ä¹ ç¬”è®°/","content":"ä»Šæ—¥å­¦ä¹ å†…å®¹3DGSåŠ›æ‰£æ¯æ—¥ä¸€é¢˜:ä¸€é“ç®€å•çš„éå†é“¾è¡¨çš„é¢˜ç›®. ä¸Šåˆå­¦ä¹ è®¡ç®—æœºç½‘ç»œè®°äº†ç¬”è®° 1262 ä»£ç éšæƒ³å½•å®Œæˆäº†01èƒŒåŒ…çš„é¢˜,çœ‹äº†å®Œå…¨èƒŒåŒ…çš„è®²ä¹‰ é¡¹ç›®ç›¸å…³å®ç°äº†æ•°æ®åå°æ¥å£. ç”Ÿæ´»ç¯‡æ™šä¸Šå¥èº«ä»Šå¤©ä¸»è¦ç»ƒçš„æ ¸å¿ƒ,æ ¸å¿ƒæŠ—æ—‹è®­ç»ƒå’Œæ ¸å¿ƒæŠ—å±ˆè®­ç»ƒ,å¼ºåº¦éå¸¸é«˜,é¡ºå¸¦ç»ƒäº†ä¸€ç»„è‚©å’Œä¸€ç»„å¼•ä½“.","tags":["æ—¥è®°","leetcode","é¡¹ç›®"],"categories":["å­¦ä¹ æ—¥è®°","2025-07"]},{"title":"ç¨‹åºå‘˜å…»ç”ŸæŒ‡å—","path":"/2025/07/14/æ‚é¡¹ç¬”è®°/ç¨‹åºå‘˜å…»ç”ŸæŒ‡å—/","content":"ç¨‹åºå‘˜å…»ç”ŸæŒ‡å— ç¨‹åºå‘˜å…»ç”ŸæŒ‡å— 1. æœ¯è¯­ 2. ç›®æ ‡ 3. å…³é”®ç»“æœ 4. åˆ†æ 5. è¡ŒåŠ¨ 6. è¯æ® 6.1. è¾“å…¥ 6.1.1. å›ºä½“ 6.1.2. æ¶²ä½“ 6.1.3. æ°”ä½“ 6.1.4. å…‰ç…§ 6.1.5. è¯ç‰© 6.2. è¾“å‡º 6.2.1. æŒ¥æ‹è¿åŠ¨ 6.2.2. å‰§çƒˆè¿åŠ¨ 6.2.3. èµ°è·¯ 6.2.4. åˆ·ç‰™ 6.2.5. æ³¡æ¾¡ 6.2.6. åšå®¶åŠ¡ï¼ˆè€å¹´ç”·æ€§ï¼‰ 6.2.7. ç¡çœ  6.2.8. ä¹…å 6.3. ä¸Šä¸‹æ–‡ 6.3.1. æƒ…ç»ª 6.3.2. è´«å¯Œ 6.3.3. ä½“é‡ 6.3.4. æ–°å†  1. æœ¯è¯­ ACM: All-Cause Mortality å…¨å› æ­»äº¡ç‡ 2. ç›®æ ‡ ç¨³å¥çš„æ´»å¾—æ›´ä¹… èŠ±æ›´å°‘æ—¶é—´å·¥ä½œï¼šè§MetaGPT 3. å…³é”®ç»“æœ é™ä½66.67%å…¨å› æ­»äº¡ç‡ å¢åŠ ~20å¹´é¢„æœŸå¯¿å‘½ ç»´æŒå¤šå·´èƒºäºä¸­è½´ 4. åˆ†æ ä¸»è¦å‚è€ƒï¼šå¯¹ACMçš„å­¦æœ¯æ–‡çŒ®ç›¸å¯¹è¾ƒå¤šï¼Œå¯ä»¥ä½œä¸ºä¸»è¦å‚è€ƒ å¢åŠ å¯¿å‘½ä¸ACMå…³ç³»éçº¿æ€§ï¼šæ˜¾ç„¶å¢åŠ å¯¿å‘½ä¸ACMå…³ç³»æ˜¯éçº¿æ€§å‡½æ•°ï¼Œè¿™é‡Œå‡è®¾ Î”LifeSpan=(1/(1+Î”ACM)-1)*10ï¼ˆÎ”ACMä¸ºACMå˜åŒ–å€¼ï¼›å…¬å¼æ¬¢è¿ä¼˜åŒ–ï¼‰ å˜é‡æ— æ³•ç®€å•å åŠ ï¼šæ˜¾ç„¶å„ä¸ªå˜é‡ä¹‹é—´å¹¶ä¸ç¬¦åˆç‹¬ç«‹åŒåˆ†å¸ƒå‡è®¾ï¼Œå˜é‡ä¹‹é—´çš„å®é™…å½±å“ä¹Ÿå¹¶ä¸æ˜ç¡® å­˜åœ¨çŸ›ç›¾è§‚ç‚¹ï¼šæ‰€æœ‰çš„è¯æ®éƒ½æœ‰æ–‡çŒ®ç ”ç©¶å¯¹åº”ï¼Œä½†æ³¨æ„åˆ°ï¼šæœ‰äº›æ–‡çŒ®ä¹‹é—´æœ‰æ˜¾è‘—çŸ›ç›¾çš„è§‚ç‚¹ï¼ˆå¦‚å¯¹äºç¢³æ°´æ‘„å…¥æ¯”ä¾‹çš„çŸ›ç›¾ï¼‰ï¼›æœ‰äº›æ–‡çŒ®å­˜åœ¨è¾ƒå¤§äº‰è®®ï¼ˆå¦‚è®¤ä¸º22ç‚¹å‰ç¡è§‰ä¼šæå‡43%å…¨å› æ­»äº¡ç‡ï¼‰ ç ”ç©¶ä»…è¡¨è¾¾ç›¸å…³ï¼šæ‰€æœ‰æ–‡çŒ®è¡¨æ˜çš„æ›´å¤šæ˜¯ç›¸å…³è€Œéå› æœï¼Œåœ¨é˜…è¯»æ—¶è¦è€ƒè™‘æ–‡çŒ®æ˜¯å¦å……åˆ†è¯æ˜äº†å› æœ â€”â€” å¦‚æŸæ–‡çŒ®è¡¨æ˜äº†æ—¥å‡7000æ­¥çš„äººæœ‰æ˜¾è‘—ä½çš„å…¨å› æ­»äº¡ç‡ã€‚ä½†æ­¥æ•°å°‘çš„äººå¯èƒ½åŒ…å«æ›´å¤šé•¿æœŸç—…æ‚£ï¼Œå¦‚æœæ²¡æœ‰åˆç†çš„æ’é™¤è¿™å—æ•°æ®ï¼Œé‚£æ­¤æ–‡çŒ®è°ƒæŸ¥å¤±çœŸ 5. è¡ŒåŠ¨ è¾“å…¥ å›ºä½“ï¼šåƒç™½è‚‰ï¼ˆ-11%~-3% ACMï¼‰ã€è”¬æœä¸ºä¸»ï¼ˆ-26%~-17% ACMï¼‰ï¼Œå¤šåƒè¾£ï¼ˆ-23% ACMï¼‰ï¼Œå¤šåƒåšæœï¼ˆ-27%~-4% ACMï¼‰ï¼Œä¸­é‡ç¢³æ°´ã€å¤šåƒæ¤ç‰©è›‹ç™½ï¼ˆ-10% ACMï¼‰ï¼Œå°‘åƒè¶…åŠ å·¥é£Ÿç‰©ï¼ˆ-62%~-18%ï¼‰ æ¶²ä½“ï¼šå–å’–å•¡ï¼ˆ-22%~-12% ACMï¼‰ï¼Œå–ç‰›å¥¶ï¼ˆ-17%~-10% ACMï¼‰ï¼Œå–èŒ¶ï¼ˆ-15%~-8% ACMï¼‰ï¼Œå°‘å–æˆ–ä¸å–ç”œå‘³é¥®æ–™ï¼ˆå¦åˆ™æ¯å¤©ä¸€æ¯+7% ACMï¼Œ+å¤šå·´èƒºï¼‰ï¼Œæˆ’é…’ï¼ˆå¦åˆ™+~50% ACMï¼Œæ— ä¸Šé™ï¼‰ æ°”ä½“ï¼šä¸å¸çƒŸï¼ˆå¦åˆ™+50% ACMï¼Œ-12\\-11å¹´å¯¿å‘½ï¼‰ å…‰ç…§ï¼šæ™’å¤ªé˜³ï¼ˆ-~40% ACMï¼‰ è¯ç‰©ï¼šäºŒç”²åŒèƒï¼ˆç³–å°¿ç—…äººç›¸æ¯”æ­£å¸¸äººå¯ä»¥+3å¹´ï¼‰ã€å¤åˆç»´ç”Ÿç´ ï¼ˆ-8%ç™Œç—‡é£é™©ï¼‰ã€äºšç²¾èƒºï¼ˆ-60%~-30% ACMï¼‰ã€è‘¡è„ç³–èƒºï¼ˆ-39% ACMï¼‰ è¾“å‡º è¿åŠ¨ï¼šæ¯å‘¨3æ¬¡45åˆ†é’ŸæŒ¥æ‹è¿åŠ¨ï¼ˆ-47% ACMï¼‰ æ—¥å¸¸ï¼šåˆ·ç‰™ï¼ˆ-25% ACMï¼‰ ç¡çœ ï¼šæ¯å¤©ç¡7å°æ—¶å…¨å› æ­»äº¡ç‡æœ€ä½ï¼›ä¸”22-24ç‚¹é—´æœ€å¥½ï¼Œæ—©ç¡+43% ACMï¼Œæ™šç¡+15% ACMï¼ˆå­˜åœ¨äº‰è®®ï¼‰ ä¸Šä¸‹æ–‡ ä½“é‡ï¼šå‡è‚¥ï¼ˆ-54% ACMï¼‰ 6. è¯æ®6.1. è¾“å…¥6.1.1. å›ºä½“ ç™½è‚‰ JAMAå­åˆŠï¼šé£Ÿç”¨çº¢è‚‰å’ŒåŠ å·¥è‚‰ç±»ä¼šå¢åŠ å¿ƒè„ç—…å’Œæ­»äº¡é£é™©ï¼é±¼è‚‰å’Œå®¶ç¦½è‚‰åˆ™ä¸ä¼š å‡ºå¤„ï¼šAssociations of Processed Meat, Unprocessed Red Meat, Poultry, or Fish Intake With Incident Cardiovascular Disease and All-Cause Mortality å¢åŠ çº¢è‚‰æ‘„å…¥ä¸æ­»äº¡é£é™©ç›¸å…³ã€‚å…«å¹´å†…å¹³å‡æ¯å¤©å¢åŠ è‡³å°‘åŠä»½çº¢è‚‰æ‘„å…¥ï¼ˆåŠä»½çº¢è‚‰ç›¸å½“äº14gåŠ å·¥çº¢è‚‰æˆ–40géåŠ å·¥çº¢è‚‰ï¼‰çš„è°ƒæŸ¥å¯¹è±¡ï¼Œåœ¨æ¥ä¸‹æ¥å…«å¹´å†…å…¨å› æ­»äº¡é£é™©å¢åŠ 10ï¼…ï¼ˆHR, 1.10; 95%CI, 1.04-1.17ï¼‰ï¼›æ¯å‘¨åƒä¸¤ä»½çº¢è‚‰æˆ–åŠ å·¥è‚‰ç±»ï¼ˆä½†ä¸åŒ…æ‹¬å®¶ç¦½æˆ–é±¼ç±»ï¼‰ä¼šä½¿å…¨å› æ­»äº¡é£é™©å¢åŠ 3% çº¢è‚‰å’Œç™½è‚‰æœ€å¤§çš„åŒºåˆ«æ˜¯ä»€ä¹ˆï¼Ÿä¸ºå•¥è¦è¿™ä¹ˆåˆ†å‘¢ï¼Ÿ è”¬æœ æ¯å¹´54ä¸‡äººæ­»äº¡ï¼Œç«Ÿæ˜¯å› ä¸ºæ°´æœåƒå¾—å°‘ï¼ï¼Ÿè¿™å·²æˆåå¤§æ­»äº¡å› ç´ ä¹‹ä¸€ï¼ å‡ºå¤„ï¼šEstimated Global, Regional, and National Cardiovascular Disease Burdens Related to Fruit and Vegetable Consumption: An Analysis from the Global Dietary Database (FS01-01-19) æ¯å¤©æ‘„å…¥200å…‹æ–°é²œæ°´æœå¯ä½¿æ­»äº¡ç‡é™ä½17%ï¼Œç³–å°¿ç—…å¤§è¡€ç®¡å¹¶å‘ç—‡ï¼ˆå¦‚ä¸­é£ã€ç¼ºè¡€æ€§å¿ƒè„ç—…ç­‰ï¼‰é£é™©é™ä½13%ï¼ŒåŠç³–å°¿ç—…å°è¡€ç®¡å¹¶å‘ç—‡ï¼ˆå¦‚ç³–å°¿ç—…è‚¾ç—…ã€ç³–å°¿ç—…çœ¼ç—…ã€ç³–å°¿ç—…è¶³ç—…ç­‰ï¼‰é£é™©é™ä½28% ã€Šè‡ªç„¶ã€‹å­åˆŠï¼šæ¯å¤©äºŒä¸¤è¥¿å…°èŠ±ï¼Œå¥åº·é•¿å¯¿éƒ½æœ‰å•¦ï¼åˆ†æè¿‘6ä¸‡äºº23å¹´çš„æ•°æ®å‘ç°ï¼Œåƒå«é»„é…®ç±»é£Ÿç‰©ä¸æ­»äº¡é£é™©é™ä½20%ç›¸å…³ä¸¨ä¸´åºŠå¤§å‘ç° å‡ºå¤„ï¼šFlavonoid intake is associated with lower mortality in the Danish Diet Cancer and Health Cohort åƒå«é»„é…®ç±»é£Ÿç‰©ä¸æ­»äº¡é£é™©é™ä½20%ç›¸å…³ Bondonnoåšå£«è¯´é“â€œåƒä¸åŒè”¬èœã€æ°´æœè¡¥å……ï¼Œä¸åŒç§ç±»çš„é»„é…®ç±»åŒ–åˆç‰©æ˜¯å¾ˆé‡è¦çš„ï¼Œè¿™å¾ˆå®¹æ˜“é€šè¿‡é¥®é£Ÿå®ç°ï¼šä¸€æ¯èŒ¶ã€ä¸€ä¸ªè‹¹æœã€ä¸€ä¸ªæ©˜å­ã€100å…‹è“è“ï¼Œæˆ–100å…‹è¥¿å…°èŠ±ï¼Œå°±èƒ½æä¾›å„ç§é»„é…®ç±»åŒ–åˆç‰©ï¼Œå¹¶ä¸”æ€»å«é‡è¶…è¿‡500æ¯«å…‹ã€‚ è¾£æ¤’ è¾£æ¤’æˆæ­»äº¡å…‹æ˜Ÿï¼Ÿæ®è°ƒç ”ï¼Œå¸¸åƒè¾£æ‚£ç—…æ­»äº¡é£é™©å¯é™ä½61% å‡ºå¤„1ï¼šChili pepper consumption and mortality in Italian adults å‡ºå¤„2ï¼šThe Association of Hot Red Chili Pepper Consumption and Mortality: A Large Population-Based Cohort Study 2017å¹´Plos One çš„å¦ä¸€é¡¹æ¥è‡ªç¾å›½çš„ç ”ç©¶ä»¥16179åï¼Œå¹´é¾„åœ¨18å²ä»¥ä¸Šçš„äººç¾¤ä¸ºå¯¹è±¡ï¼Œå¹¶å¯¹å…¶è¿›è¡Œäº†é«˜è¾¾19å¹´çš„éšè®¿ï¼Œå‘ç°åœ¨4946ä¾‹æ­»äº¡æ‚£è€…ä¸­ï¼Œé£Ÿç”¨è¾£æ¤’çš„å‚ä¸è€…çš„å…¨å› æ­»äº¡ç‡ä¸º21.6ï¼…ï¼Œè€Œæœªé£Ÿç”¨è¾£æ¤’çš„å‚ä¸è€…çš„å…¨å› æ­»äº¡ç‡ä¸º33.6ï¼…ã€‚ç›¸è¾ƒäºä¸åƒè¾£æˆ–å¾ˆå°‘åƒï¼ˆå°‘äºæ¯å‘¨ä¸¤æ¬¡ï¼‰çš„äººç¾¤ï¼Œæ¯å‘¨åƒè¾£ï¼4æ¬¡çš„äººç¾¤æ€»æ­»äº¡é£é™©é™ä½23%ï¼Œå¿ƒè¡€ç®¡æ­»äº¡é£é™©é™ä½34%ã€‚ é¸¡è›‹ æ¯å¤©å¤šåƒåŠä¸ªè›‹ï¼Œå¢åŠ 7%çš„å…¨å› å’Œå¿ƒè¡€ç®¡æ­»äº¡é£é™©ï¼Ÿ å‡ºå¤„ï¼šNIH-AARPå·¥ä½œä¸»é¡µã€Egg and cholesterol consumption and mortality from cardiovascular and different causes in the United States: A population-based cohort study æ¯å¤©å¤šåƒåŠä¸ªè›‹ï¼Œå¢åŠ 7%çš„å…¨å› å’Œå¿ƒè¡€ç®¡æ­»äº¡é£é™©ï¼Ÿåœ¨å‡è®¾æ€§æ›¿ä»£åˆ†æä¸­ï¼Œç ”ç©¶è€…å‘ç°ï¼Œç”¨ç­‰é‡çš„è›‹æ¸…é¸¡è›‹æ›¿ä»£ç‰©ã€å®¶ç¦½ã€é±¼ã€ä¹³åˆ¶å“ã€åšæœå’Œè±†ç±»åˆ†åˆ«æ›¿ä»£åŠåªå…¨è›‹ï¼ˆ25å…‹å¤©ï¼‰å¯ä»¥é™ä½6%ã€8%ã€9%ã€7%ã€13%å’Œ10%çš„å…¨å› æ­»äº¡ç‡ã€‚*é¸¡è›‹ åšæœ å“ˆä½›20å¹´ç ”ç©¶ï¼šåƒæ ¸æ¡ƒçš„äººæ›´é•¿å¯¿ï¼Œæ˜¾è‘—å‡å°‘å…¨å› æ­»äº¡ï¼Œå»¶é•¿å¯¿å‘½ å‡ºå¤„ï¼šAssociation of Walnut Consumption with Total and Cause-Specific Mortality and Life Expectancy in US Adults é€šè¿‡åˆ†æå‘ç°ï¼Œç»å¸¸é£Ÿç”¨æ ¸æ¡ƒå¯ä»¥å»¶é•¿å¯¿å‘½ï¼Œé™ä½å¿ƒè¡€ç®¡ç–¾ç—…æ­»äº¡é£é™©ã€‚æ¯”èµ·ä¸åƒæ ¸æ¡ƒï¼Œæ¯å‘¨é£Ÿç”¨æ ¸æ¡ƒ5ä»½ä»¥ä¸Šï¼ˆ1ä»½28å…‹ï¼‰çš„å¥åº·é¢„æœŸå¯¿å‘½å»¶é•¿1.3å²ï¼Œå…¨å› æ­»äº¡é£é™©é™ä½14%ï¼Œå¿ƒè¡€ç®¡ç–¾ç—…æ­»äº¡ç‡é™ä½25%ã€‚ ç ”ç©¶ï¼šæ¯æ—¥é£Ÿç”Ÿåšæœï¼Œæ­»äº¡ç‡é™20% å‡ºå¤„1ï¼šAssociation of nut consumption with total and cause-specific mortality å‡ºå¤„2ï¼šAPG_Health--Nutrition-Research-Brochure_DEC-19-18 ç ”ç©¶äººå‘˜å‘ç°ï¼Œæ¯å‘¨åƒæ ‘åšæœä½äº1ç›å¸ä»½é‡çš„äººï¼Œæ­»äº¡ç‡é™ä½7ï¼…ã€‚è€Œæ¯å‘¨åƒäº†1ç›å¸ä»½é‡çš„äººï¼Œå‡å°‘11ï¼…çš„æ­»äº¡ç‡ï¼›æ¯å‘¨åƒ2ä»½é‡çš„äººï¼Œå‡ä½13ï¼…ï¼›æ¯å‘¨5è‡³6ä»½é‡è€…ï¼Œå‡å°‘äº†15ï¼…ï¼›ä¸€å‘¨7ä»½ä»¥ä¸Šçš„äººï¼Œæ­»äº¡ç‡åˆ™å‡å°‘20ï¼…ã€‚ å¦å¤–ä¸¤ç¯‡å‘è¡¨åœ¨ã€Šå…¬å…±ç§‘å­¦å›¾ä¹¦é¦†åœ¨çº¿æœŸåˆŠã€‹(Public Library of Science Online Journal)å’Œã€Šç”Ÿç‰©åŒ»å­¦ä¸­å¿ƒã€‹(BioMed Central)ä¸Šçš„åŒ»å­¦é¢„ç§‘ç ”ç©¶è®ºæ–‡ï¼Œå±•ç¤ºäº†è¯•éªŒå¼€å§‹æ—¶çš„æ¨ªæ–­é¢æ•°æ®ã€‚è¿™ä¸¤é¡¹ç ”ç©¶éƒ½è¯„ä¼°äº†7,216åå¯¹è±¡ï¼Œä»¥åŠä»–ä»¬é£Ÿç”¨åšæœçš„é¢‘ç‡å’Œæ•°é‡ä¹‹é—´çš„å…³ç³»ã€‚é‚£äº›æ¯å‘¨é£Ÿç”¨ä¸‰ä»½ä»¥ä¸Šåšæœ(åŒ…æ‹¬å¼€å¿ƒæœ)çš„ç ”ç©¶å¯¹è±¡çš„æ­»äº¡ç‡é™ä½39%ã€‚ é’ ï¼ˆå­˜æœ‰å¤§é‡äº‰è®®ï¼‰ Eur Heart Jï¼šé’ æ‘„å…¥é‡ä¸é¢„æœŸå¯¿å‘½ã€å…¨å› æ­»äº¡ç‡çš„å…³ç³» å‡ºå¤„ï¼šMesserli F H, Hofstetter L, Syrogiannouli L, et al. Sodium intake, life expectancy, and all-cause mortality[J]. European heart journal, 2021, 42(21): 2103-2112. åœ¨è¯¥åˆ†ææ‰€åŒ…å«çš„181ä¸ªå›½å®¶ä¸­ï¼Œç ”ç©¶äººå‘˜å‘ç°é’ æ‘„å…¥é‡ä¸å‡ºç”Ÿæ—¶çš„å¥åº·é¢„æœŸå¯¿å‘½ï¼ˆÎ²2.6å¹´å…‹æ¯æ—¥é’ æ‘„å…¥é‡ï¼ŒR20.66ï¼ŒP0.001ï¼‰å’Œ60å²æ—¶çš„å¥åº·é¢„æœŸå¯¿å‘½ï¼ˆÎ²0.3å¹´å…‹æ¯æ—¥é’ æ‘„å…¥é‡ï¼ŒR20.60ï¼ŒP0.048ï¼‰ä¹‹é—´å­˜åœ¨æ­£ç›¸å…³å…³ç³»ï¼Œä½†ä¸éä¼ æŸ“æ€§ç–¾ç—…æ­»äº¡ï¼ˆÎ²17æ¬¡äº‹ä»¶å…‹æ¯æ—¥é’ æ‘„å…¥é‡ï¼ŒR20.43ï¼ŒP0.100ï¼‰æ— å…³ã€‚ç›¸åï¼Œå…¨å› æ­»äº¡ç‡ä¸é’ æ‘„å…¥é‡æˆè´Ÿç›¸å…³ï¼ˆÎ²âˆ’131æ¬¡äº‹ä»¶å…‹æ¯æ—¥é’ æ‘„å…¥é‡ï¼ŒR20.60ï¼ŒP0.001ï¼‰ã€‚åœ¨ä»…é™äº46ä¸ªæ”¶å…¥æœ€é«˜å›½å®¶çš„æ•æ„Ÿæ€§åˆ†æä¸­ï¼Œé’ æ‘„å…¥é‡ä¸å‡ºç”Ÿæ—¶çš„å¥åº·é¢„æœŸå¯¿å‘½å‘ˆæ­£ç›¸å…³ï¼ˆÎ²3.4å¹´å…‹æ¯æ—¥é’ æ‘„å…¥é‡ï¼ŒR20.53ï¼ŒP0.001ï¼‰ï¼Œè€Œä¸å…¨å› æ­»äº¡ç‡ï¼ˆÎ²âˆ’168æ¬¡äº‹ä»¶å…‹æ¯æ—¥é’ æ‘„å…¥é‡ï¼ŒR20.50ï¼ŒP0.001ï¼‰å‘ˆè´Ÿç›¸å…³ã€‚ è¯¥ï¼ˆå¤§èŒƒå›´ï¼‰ç ”ç©¶è®¤ä¸ºæ›´å¤šçš„é’ æ‘„å…¥ä¸æ˜¾è‘—æ›´ä½çš„å…¨å› æ­»äº¡ç‡æœ‰å…³ é’ˆå¯¹è¯¥è®ºæ–‡çš„å»¶ä¼¸è§£è¯»å’Œè®¨è®ºï¼šA Fresh Foray in the Salt Wars: Life Expectancy Higher With Greater Sodium Intake NEJMLancetï¼šä¸è¦åƒå¤ªå¤šç›ï¼Œä¸­å›½é¥®é£Ÿæ‰€è‡´å¿ƒè¡€ç®¡ç—…å’Œç™Œç—‡æ­»äº¡å…¨çƒç¬¬ä¸€ï¼Œåƒä½é’ ç›å¯é™ä½å…¨å› æ­»äº¡ç‡ ä½†ä¹Ÿæœ‰å¤šé¡¹ç ”ç©¶è®¤ä¸ºç”¨ä½é’ ç›å¯ä»¥é™ä½ä¸€ç³»åˆ—ç–¾ç—…çš„å‘ç”Ÿæ¦‚ç‡ï¼Œå¯¹å…¨å› æ­»äº¡ç‡çš„å‡å°‘æœ‰ç§¯æå½±å“ ç¢³æ°´ï¼ˆå­˜æœ‰å¤§é‡äº‰è®®ï¼‰ ä½ç¢³ç”Ÿé…®é¥®é£Ÿï¼ˆå››ï¼‰ç¢³æ°´åŒ–åˆç‰©ä¸é•¿æœŸæ­»äº¡ç‡ å‡ºå¤„ï¼šThe Lancet Public Health - Dietary carbohydrate intake and mortality: a prospective cohort study and meta-analysis ç¢³æ°´è¶Šä½ï¼Œå¯¿å‘½è¶ŠçŸ­ï¼›ç¢³æ°´è¶Šé«˜ï¼Œå¯¿å‘½ä¹Ÿè½»å¾®ç¼©çŸ­ï¼›ç¢³æ°´50%å·¦å³ï¼ˆå…¶å®æŒ‰ç…§ä¸€èˆ¬çš„è¯´æ³•ï¼Œè¿™ä¹Ÿç®—é«˜ç¢³æ°´ï¼‰æ˜¯æœ€é•¿å¯¿å‘½åŒºé—´ æœ€å¼ºè¥å…»æ­é…ï¼BMJï¼šè¿™ä¹ˆåƒï¼Œå¿ƒè¡€ç®¡ç–¾ç—…å’Œæ­»äº¡é£é™©æ›´ä½ æ§Ÿæ¦” å¦‚ä½•çœ‹å¾…æ§Ÿæ¦”åš¼å‡ºæ¥çš„ç™Œç—‡ï¼Ÿæ§Ÿæ¦”è‡´ç™Œé£é™©ç©¶ç«Ÿæœ‰å¤šå¤§ï¼Ÿ - ä¸é¦™åŒ»ç”Ÿçš„å›ç­” - çŸ¥ä¹ å‡ºå¤„ï¼šChewing Betel Quid and the Risk of Metabolic Disease, Cardiovascular Disease, and All-Cause Mortality: A Meta-Analysis(https://journals.plos.org/plosone/article?id=10.1371/journal.pone.0070679) åš¼æ§Ÿæ¦”ä¼šå¢åŠ 21%çš„å…¨å› æ­»äº¡ç‡ çƒ­é‡é™åˆ¶ æ€ä¹ˆçœ‹å¾…BBCã€Šè¿›é£Ÿã€æ–­é£Ÿä¸é•¿å¯¿ã€‹ï¼Ÿ é™åˆ¶å¡è·¯é‡ŒåŠ¨ç‰©å®éªŒï¼šCRï¼ˆçƒ­é‡é™åˆ¶ï¼Œå³å°‘åƒï¼‰å»¶è¿Ÿäº†æ’æ²³çŒ´çš„å¤šç§ç–¾ç—…å‘ç—…å’Œæ­»äº¡ç‡ï¼Œä¸CRåŠ¨ç‰©ç›¸æ¯”ï¼Œæ­£å¸¸å–‚å…»çš„çŒ´å­çš„å„ç§ç–¾ç—…æ‚£ç—…é£é™©å¢åŠ 2.9å€ï¼Œæ­»äº¡é£é™©å¢åŠ 3.0å€ã€‚ ç»¼åˆ æœ€å¼ºè¥å…»æ­é…ï¼BMJï¼šè¿™ä¹ˆåƒï¼Œå¿ƒè¡€ç®¡ç–¾ç—…å’Œæ­»äº¡é£é™©æ›´ä½ Associations of fat and carbohydrate intake with cardiovascular disease and mortality: prospective cohort study of UK Biobank participants é€šè¿‡å¯¹è¿™äº›å‚ä¸è€…çš„æ•°æ®è¿›è¡Œåˆ†æï¼Œç ”ç©¶äººå‘˜å‘ç°ç¢³æ°´åŒ–åˆç‰©ï¼ˆç³–ã€æ·€ç²‰å’Œçº¤ç»´ï¼‰å’Œè›‹ç™½è´¨çš„æ‘„å…¥ä¸å…¨å› æ­»äº¡ç‡å‘ˆéçº¿æ€§å…³ç³»ï¼Œè€Œè„‚è‚ªåˆ™ä¸å…¨å› æ­»äº¡ç‡å‘ˆçº¿æ€§ç›¸å…³ã€‚å…¶ä¸­ï¼Œè¾ƒé«˜çš„ç³–åˆ†æ‘„å…¥ä¸å…¨å› æ­»äº¡é£é™©å’Œæ‚£å¿ƒè¡€ç®¡ç–¾ç—…çš„é£é™©è¾ƒé«˜å‡æœ‰å…³è”ï¼Œè€Œè¾ƒé«˜çš„é¥±å’Œè„‚è‚ªé…¸æ‘„å…¥ä¸å…¨å› æ­»äº¡é£é™©è¾ƒé«˜æœ‰å…³ã€‚ å›¾1ï¼šå„ç§è¥å…»å…ƒç´ ä¸å…¨å› æ­»äº¡ä¹‹é—´çš„å…³ç³» å›¾2ï¼šå„ç§è¥å…»å…ƒç´ ä¸å¿ƒè¡€ç®¡ç–¾ç—…ä¹‹é—´çš„å…³ç³» è¿›ä¸€æ­¥ç ”ç©¶è¡¨æ˜ï¼Œåœ¨æ‰€æœ‰çš„é¥®é£Ÿæ¨¡å¼ä¸­ï¼Œå…¨å› æ­»äº¡ç‡é£é™©æœ€ä½çš„é¥®é£Ÿæ–¹å¼ä¸ºï¼š10-30gé«˜çº¤ç»´ã€14-30%è›‹ç™½è´¨ã€10-25%å•ä¸é¥±å’Œè„‚è‚ªé…¸ã€5%-7%å¤šä¸é¥±å’Œè„‚è‚ªé…¸ä»¥åŠ20%-30%æ·€ç²‰æ‘„å…¥ã€‚ æœ€ä¼˜èƒ½é‡æ¥æºé…æ¯”ï¼š24%æ·€ç²‰ï¼Œ15%-17%è›‹ç™½è´¨ï¼Œ15%å•ä¸é¥±å’Œè„‚è‚ªé…¸ï¼Œ15%ç³–ï¼Œ6%é¥±å’Œè„‚è‚ªé…¸ï¼Œ6%å¤šä¸é¥±å’Œè„‚è‚ªé…¸ï¼Œ30g+é«˜çº¤ç»´ BMJ | å¸¸åƒè–¯ç‰‡æ±‰å ¡å·§å…‹åŠ›ç­‰é£Ÿå“ï¼Œå¹³å‡æ­»äº¡å¹´é¾„ä»…ä»…ä¸º58å²ï¼Œæ­»äº¡é£é™©å‰§å¢ Rico-CampÃ  A, MartÃ­nez-GonzÃ¡lez M A, Alvarez-Alvarez I, et al. Association between consumption of ultra-processed foods and all cause mortality: SUN prospective cohort study[J]. bmj, 2019, 365. Srour B, Fezeu L K, Kesse-Guyot E, et al. Ultra-processed food intake and risk of cardiovascular disease: prospective cohort study (NutriNet-SantÃ©)[J]. bmj, 2019, 365. Lawrence M A, Baker P I. Ultra-processed food and adverse health outcomes[J]. bmj, 2019, 365. 6.1.2. æ¶²ä½“ ç‰›å¥¶ ã€ŠæŸ³å¶åˆ€ã€‹è°ƒç ”21ä¸ªå›½å®¶13ä¸‡äººï¼šæ¯å¤©1æ–¤ç‰›å¥¶æˆ–é…¸å¥¶ï¼Œå¿ƒè¡€ç®¡æ­»äº¡é£é™©ä¸‹é™23% å‡ºå¤„ï¼šAssociation of dairy intake with cardiovascular disease and mortality in 21 countries from five continents (PURE): a prospective cohort study ä¸ä¸é£Ÿç”¨ä¹³åˆ¶å“çš„äººç›¸æ¯”ï¼Œæ¯å¤©æ‘„å…¥ä¸¤ä»½ä¹³åˆ¶å“ï¼ˆä¸€ä»½æŒ‡244å…‹ç‰›å¥¶é…¸å¥¶ï¼Œ15å…‹å¥¶é…ªæˆ–5å…‹é»„æ²¹ï¼‰çš„äººï¼Œ**å…¨å› æ­»äº¡é£é™©ä¸‹é™äº†17%**ï¼Œå¿ƒè¡€ç®¡æ­»äº¡é£é™©ä¸‹é™23%ï¼Œä¸­é£é£é™©ä¸‹é™33% èŒ¶ 10ä¸‡ä¸­å›½äººéšè®¿7å¹´å‘ç°ï¼Œæ¯å‘¨å–ä¸‰æ¬¡èŒ¶ä¸å…¨å› æ­»äº¡é£é™©é™ä½15%ï¼Œé¢„æœŸå¯¿å‘½å¢åŠ 1.26å¹´ç›¸å…³ å‡ºå¤„ï¼šTea consumption and the risk of atherosclerotic cardiovascular disease and all-cause mortality: The China-PAR project ä¸­å›½æˆå¹´äººé¥®èŒ¶ä¸æ­»äº¡é£é™©çš„å‰ç»æ€§å…³è”ç ”ç©¶ çº³å…¥åˆ†æçš„438 443ä¾‹ç ”ç©¶å¯¹è±¡éšè®¿11.1å¹´å…±å‘ç”Ÿæ­»äº¡34 661ä¾‹ã€‚ä¸ä»ä¸é¥®èŒ¶è€…ç›¸æ¯”ï¼Œå½“å‰éæ¯æ—¥é¥®èŒ¶è€…å’Œæ¯æ—¥é¥®èŒ¶è€…å…¨å› æ­»äº¡HRå€¼ï¼ˆ95%CIï¼‰ä¾æ¬¡ä¸º0.89ï¼ˆ0.86-0.91ï¼‰å’Œ0.92ï¼ˆ0.88-0.95ï¼‰ã€‚åˆ†æ€§åˆ«åˆ†ææ˜¾ç¤ºï¼Œé¥®èŒ¶å¯¹å…¨å› æ­»äº¡é£é™©çš„ä¿æŠ¤ä½œç”¨ä¸»è¦è§äºç”·æ€§ï¼ˆäº¤äº’P0.05ï¼‰ æ— ç³–ï¼ˆç”œå‘³ï¼‰é¥®æ–™ ã€Œæ— ç³–é¥®æ–™ä½¿æ­»äº¡é£é™©å¢åŠ  26 %ã€ï¼Œæ˜¯çœŸçš„å—ï¼Ÿ ç›¸æ¯”äºè½¯é¥®æ–™æ‘„å…¥é‡ï¼œ1æ¯æœˆçš„å‚ä¸è€…ï¼Œæ··åˆè½¯é¥®æ–™æ‘„å…¥â‰¥1æ¯å¤©çš„å‚ä¸è€…æ­»äº¡é£é™©å¢åŠ 18%ï¼Œè€Œæ‘„å…¥å«ç³–è½¯é¥®æ–™æˆ–æ— ç³–è½¯é¥®æ–™ä¼šä»¤æ­»äº¡é£é™©åˆ†åˆ«å¢åŠ 11%å’Œ27%ã€‚ Association Between Soft Drink Consumption and Mortality in 10 European Countries æœ‰ç³–é¥®æ–™ å¯ä¹å’Œå¥¶èŒ¶ï¼Œå¢åŠ å…¨å› æ­»äº¡ç‡é«˜è¾¾62%ï¼æœæ±é™ä½å…ç–«åŠ›ï¼Œå½±å“è‚ä»£è°¢ï¼å«ç³–é¥®æ–™é‚£äº›äº‹ æ¯å¤©1æ¯å«ç³–é¥®æ–™å¢åŠ 7%å…¨å› æ­»äº¡ç‡ï¼Œ2æ¯21% åœ¨34å¹´çš„éšè®¿ä¸­ï¼Œç ”ç©¶äººå‘˜å‘ç°ï¼Œç›¸æ¯”é‚£äº›ä¸€ä¸ªæœˆå–1æ¯æˆ–è€…æ›´å°‘å«ç³–é¥®æ–™çš„äººï¼Œæ¯å¤©å–2æ¯çš„äººæ€»ä½“æ­»äº¡é£é™©å‡é«˜äº†21%ï¼Œå¿ƒè¡€ç®¡ç–¾ç—…æ­»äº¡é£é™©å‡é«˜äº†31%ï¼Œç™Œç—‡æ­»äº¡é£é™©ä¸Šå‡äº†16%ã€‚ åªè¦æ¯å¤©å¤šå–ä¸€æ¯å«ç³–é¥®æ–™ï¼Œæ€»ä½“æ­»äº¡é£é™©å°†å¢åŠ 7%ï¼Œå¿ƒè¡€ç®¡ç–¾ç—…çš„é£é™©å°†å¢åŠ 10%ï¼Œç™Œç—‡ç›¸å…³çš„æ­»äº¡é£é™©å°†16%ã€‚ å‘è¡¨åœ¨å›½é™…é¡¶çº§æœŸåˆŠã€ŠBMJã€‹ä¸Šçš„ä¸€ç¯‡è®ºæ–‡å°±è¯æ˜äº†å«ç³–é¥®æ–™ä¼šåœ¨å¢åŠ æ‚£ç™Œé£é™©ï¼Œå½“ç„¶è¿™ç¯‡æ–‡ç« éªŒè¯çš„ä¸ä»…ä»…æ˜¯æœæ±ï¼Œå¥¶èŒ¶ä¹Ÿæœ‰ä»½â€”â€”å’Œå«ç³–é¥®æ–™ç›¸å…³çš„æ€»ä½“æ‚£ç™Œé£é™©è¦é«˜å‡ºé€šå¸¸å€¼18%ï¼Œ100%çš„é²œæ¦¨æœæ±ä¹Ÿä¼šä½¿å¾—æ•´ä½“çš„æ‚£ç™Œé£é™©ä¸Šå‡12%ã€‚ æœæ± JAMAå­åˆŠï¼š100%çº¯æœæ±å¯èƒ½æ¯”å«ç³–é¥®æ–™æ›´å±é™© æ¯å¤©å¤šæ‘„å…¥ä¸€ä»½12ç›å¸çš„å«ç³–é¥®æ–™ï¼Œå…¨å› æ­»äº¡ç‡é£é™©å¢åŠ 11%ï¼› æ¯å¤©å¤šæ‘„å…¥ä¸€ä»½12ç›å¸çš„æœæ±ï¼Œå…¨å› æ­»äº¡ç‡é£é™©å¢åŠ 24%ã€‚ å’–å•¡ é‡ç£…ï¼å¤šç¯‡ç ”ç©¶è¯å®å–å’–å•¡ä¸äººç¾¤å…¨å› æ­»äº¡ç‡é™ä½ç›´æ¥ç›¸å…³ ç§‘æ™® | å–å’–å•¡åˆå¤šäº†ä¸€ä¸ªæ–°ç†ç”±ï¼šé™ä½æ­»äº¡ç‡ï¼ åœ°ä¸­æµ·æˆå¹´äººå’–å•¡æ¶ˆè€—é‡åŠå…¨å› ï¼Œå¿ƒè¡€ç®¡ç–¾ç—…å’Œç™Œç—‡çš„æ­»äº¡ç‡ åœ¨æœ€è¿‘çš„èŸèƒåˆ†æä¸­ï¼Œè¯¥ç ”ç©¶åŒ…æ‹¬æ¥è‡ªä¸åŒå›½å®¶çš„40é¡¹ç ”ç©¶å’Œ3,852,651åå—è¯•è€…ã€‚åœ¨è¿™é¡¹èŸèƒåˆ†ææ˜¾ç¤ºï¼Œå’–å•¡æ‘„å…¥é‡ä¸å„ç§åŸå› çš„æ­»äº¡ç‡ï¼ŒCVDå’Œç™Œç—‡æ­»äº¡ç‡ä¹‹é—´å­˜åœ¨éçº¿æ€§å…³ç³»ï¼Œæ¯å¤©æ‘„å…¥ä¸¤æ¯å’–å•¡çš„ç™Œç—‡æ­»äº¡ç‡æœ€ä½(RR 0.96)ï¼ŒCVDæœ€ä½çš„æ­»äº¡ç‡ï¼Œæ¯å¤©2.5æ¯(RR 0.83)ï¼Œå…¨å¤©æœ€ä½æ­»äº¡ç‡ä¸ºæ¯å¤©3.5æ¯(RR 0.85)ï¼Œå¹¶ä¸”éšç€å’–å•¡æ¶ˆè´¹é‡çš„å¢åŠ ï¼Œæ­»äº¡ç‡æ²¡æœ‰è¿›ä¸€æ­¥é™ä½æˆ–å¢åŠ  äºšç²¾èƒº Scienceï¼šç§‘å­¦èƒŒä¹¦ï¼ä»ç²¾æ¶²ä¸­å‘ç°çš„äºšç²¾èƒºï¼Œç«Ÿç„¶æœ‰ç€æŠ—è¡°è€ã€æŠ—ç™Œã€ä¿æŠ¤å¿ƒè¡€ç®¡å’Œç¥ç»ã€æ”¹å–„è‚¥èƒ–å’Œ2å‹ç³–å°¿ç—…ç­‰é€†å¤©ç¥æ•ˆ é¥®é£Ÿä¸­äºšç²¾èƒºæ‘„å…¥é‡é«˜ä¼šé™ä½æ­»äº¡ç‡ 6.1.3. æ°”ä½“ å¸çƒŸ å³ä½¿æ˜¯ä½å¼ºåº¦å¸çƒŸï¼Œä¹Ÿå¢åŠ æ­»äº¡é£é™©ï¼ ç ”ç©¶å‘ç°ï¼šåœ¨42 416åç”·æ€§å’Œ86 735åå¥³æ€§ï¼ˆå¹´é¾„åœ¨35-89å²ä¹‹é—´ï¼Œä»¥å‰æ²¡æœ‰æ‚£ç—…ï¼‰ä¸­ï¼Œ18 985åç”·æ€§ï¼ˆ45%ï¼‰å’Œ18 072åå¥³æ€§ï¼ˆ21%ï¼‰ç›®å‰å¸çƒŸï¼Œå…¶ä¸­33%çš„ç”·æ€§å¸çƒŸè€…å’Œ39%çš„å¥³æ€§å¸çƒŸè€…å¹¶ä¸æ¯å¤©å¸çƒŸã€‚8866åç”·æ€§ï¼ˆ21%ï¼‰å’Œ53 912åå¥³æ€§ï¼ˆ62%ï¼‰ä»ä¸å¸çƒŸã€‚åœ¨éšè®¿æœŸé—´ï¼Œä¸ä»ä¸å¸çƒŸç›¸æ¯”ï¼Œæ¯å¤©10æ”¯çƒŸæˆ–æ¯å¤©â‰¥10æ”¯çƒŸçš„å…¨å› æ­»äº¡ç‡å±é™©æ¯”åˆ†åˆ«ä¸º1.17ï¼ˆ95%ç½®ä¿¡åŒºé—´1.10-1.25ï¼‰å’Œ1.54ï¼ˆ1.42-1.67ï¼‰ã€‚æ— è®ºå¹´é¾„æˆ–æ€§åˆ«ï¼Œå±é™©æ¯”ç›¸ä¼¼ã€‚ä¸æ¯æ—¥å¸çƒŸå…³ç³»æœ€å¯†åˆ‡çš„ç–¾ç—…æ˜¯å‘¼å¸é“ç™Œç—‡ã€æ…¢æ€§é˜»å¡æ€§è‚ºç—…å’Œèƒƒè‚ é“åŠè¡€ç®¡ç–¾ç—…ã€‚åœ¨æ‹›å‹Ÿæ—¶å·²ç»æˆ’çƒŸçš„äººçš„æ­»äº¡ç‡ä½äºç°åœ¨æ¯å¤©å¸çƒŸè€…ã€‚ å¸çƒŸè€…å¹³å‡å‡å°‘å¯¿å‘½11-12å¹´ å¸çƒŸè®©äººè¿‡ç˜¾æ˜¯ä»€ä¹ˆåŸç†ï¼Ÿæœ‰èŠ‚åˆ¶çš„å¸çƒŸä¾æ—§æœ‰å®³å—ï¼Ÿ 6.1.4. å…‰ç…§ æ™’å¤ªé˜³ æ™’å¤ªé˜³å’Œæ­»äº¡ç‡çš„å…³ç³»ï¼Œå¦‚ä½•ç§‘å­¦ï¼Œå®‰å…¨çš„æ™’å¤ªé˜³ï¼Ÿ ä¸¹éº¦ä¸€é¡¹é•¿è¾¾26å¹´çš„ç ”ç©¶å‘ç°ï¼Œå¤šæ™’å¤ªé˜³èƒ½æ˜¾è‘—å»¶é•¿å¯¿å‘½ï¼Œå³ä½¿æ˜¯ç”±äºè¿‡åº¦æš´æ™’è¯±å‘çš®è‚¤ç™Œçš„æ‚£è€…ï¼Œå¹³å‡å¯¿å‘½ä¹Ÿæ¯”æ™®é€šäººé•¿äº†6å²ã€‚ 6.1.5. è¯ç‰© NMN äºŒç”²åŒèƒ â€œèƒâ€å¹å¿…çœ‹ ä¸¨æˆ‘å°±æ˜¯ç¥è¯â€”â€”äºŒç”²åŒèƒ äºŒç”²åŒèƒä¸ä»…åœ¨å¤šç§è‚¿ç˜¤ã€å¿ƒè¡€ç®¡ç–¾ç—…åŠç³–å°¿ç—…ä¸­å‘æŒ¥ä¿æŠ¤ä½œç”¨ï¼Œè€Œä¸”åœ¨è‚¥èƒ–ã€è‚ç—…ã€è‚¾ç—…åŠè¡°è€æ–¹é¢ä¹Ÿå¤§æ”¾å¼‚å½©ã€‚ äºŒç”²åŒèƒ2020æœ€å€¼å¾—äº†è§£çš„â€œåƒç“œâ€å¤§æ–°é—»â€”â€”æŠ¤èƒƒã€å¥è„‘ã€æŠ—è¡°ã€é˜²ç™Œè¿˜æ˜¯è‡´ç™Œï¼Ÿ äºŒç”²åŒèƒçœŸçš„é‚£ä¹ˆç¥å—ï¼Ÿç¾ç ”ç©¶ï¼šçˆ¶äº²æœç”¨äºŒç”²åŒèƒæˆ–è‡´å­å¥³æœ‰ç¼ºé™· ä¸è‰¯ååº” ä½œä¸ºä¸€ç§ä½¿ç”¨è¿‘ç™¾å¹´çš„è¯ç‰©ï¼ŒäºŒç”²åŒèƒçš„ä¸è‰¯ååº”å·²ç»éå¸¸æ˜ç¡®ï¼Œå¸¸è§çš„æœ‰ï¼šç»´ç”Ÿç´ B12ç¼ºä¹ï¼ˆ7%-17.4%ï¼‰ï¼Œèƒƒè‚ é“ä¸è‰¯ååº”ï¼ˆæœ€é«˜53%ï¼‰ï¼Œç–²å€¦ï¼ˆ9%ï¼‰ï¼Œå¤´ç—›ï¼ˆ6%ï¼‰ï¼›ä¸¥é‡ä½†ä¸å¸¸è§çš„ä¸è‰¯ååº”åŒ…æ‹¬ä¹³é…¸é…¸ä¸­æ¯’ã€è‚æŸä¼¤ï¼›ä¹Ÿæœ‰ç ”ç©¶è¡¨æ˜å¯èƒ½å¯¹èƒå„¿è‡´ç•¸ å¤åˆç»´ç”Ÿç´  æœç”¨å¤åˆç»´ç”Ÿç´ å¯é™ä½ç™Œç—‡å±é™©8%ï¼Œå…¶ä»–æ•ˆæœå¹¶ä¸æ˜¾è‘— è‘¡è„ç³–èƒº ç¥å¥‡ï¼æ°¨ç³–é™ä½å¿ƒè¡€ç®¡æ­»äº¡ç‡65%ï¼Œä¸å®šæœŸè¿åŠ¨æ•ˆæœç›¸å½“ ç¾å›½è¥¿å¼—å‰å°¼äºšå¤§å­¦æœ€æ–°ç ”ç©¶å‘ç° æ°¨ç³–ï¼ˆè½¯éª¨ç´ ï¼‰ å¯ä»¥é™ä½å¿ƒè¡€ç®¡æ­»äº¡ç‡65%ï¼Œé™ä½æ€»ä½“æ­»äº¡ç‡39%ï¼Œæ•ˆæœä¸åšæŒå®šæœŸè¿åŠ¨ç›¸å¯¹ è¯¥ç ”ç©¶ä½¿ç”¨1999å¹´è‡³2010å¹´ï¼Œ16,686åæˆå¹´äººçš„å›½å®¶å¥åº·å’Œè¥å…»æ£€æŸ¥(NHANES)æ•°æ®ï¼Œå‚ä¸è€…çš„ä¸­ä½è¿½è¸ªæ—¶é—´ä¸º107ä¸ªæœˆï¼Œè€Œå…¶ä¸­æœ‰648ä½å‚ä¸è€…å®šæœŸä¸”æ¯æœç”¨æ—¥500-1000æ¯«å…‹çš„è‘¡è„ç³–èƒºè½¯éª¨ç´ ä¸€å¹´ä»¥ä¸Šã€‚ äºšç²¾èƒº Scienceï¼šç§‘å­¦èƒŒä¹¦ï¼ä»ç²¾æ¶²ä¸­å‘ç°çš„äºšç²¾èƒºï¼Œç«Ÿç„¶æœ‰ç€æŠ—è¡°è€ã€æŠ—ç™Œã€ä¿æŠ¤å¿ƒè¡€ç®¡å’Œç¥ç»ã€æ”¹å–„è‚¥èƒ–å’Œ2å‹ç³–å°¿ç—…ç­‰é€†å¤©ç¥æ•ˆ äºšç²¾èƒºæ˜¯æœ€å®¹æ˜“ä»äººä½“è‚ é“å¸æ”¶çš„å¤šèƒºã€‚è®¸å¤šçš„é£Ÿç‰©ä¸­éƒ½å«æœ‰å¤§é‡çš„äºšç²¾èƒºï¼Œä¾‹å¦‚æ–°é²œçš„é’æ¤’ã€å°éº¦èƒšèŠ½ã€èŠ±æ¤°èœã€è¥¿å…°èŠ±ã€è˜‘è‡å’Œå„ç§å¥¶é…ªï¼Œå°¤å…¶åœ¨çº³è±†ç­‰å¤§è±†åˆ¶å“ã€é¦™è‡å’Œæ¦´è²ä¸­å«é‡æ›´é«˜ã€‚åœ¨æœ¬å®éªŒä¸­ï¼Œç ”ç©¶äººå‘˜é€‰æ‹©äº†829ä½å¹´é¾„åœ¨45-84å²ä¹‹é—´çš„å‚ä¸è€…è¿›è¡Œäº†ä¸ºæœŸ20å¹´çš„éšè®¿ï¼Œåˆ†æäº†é¥®é£Ÿä¸­äºšç²¾èƒºæ‘„å…¥é‡ä¸äººç±»æ­»äº¡ç‡ä¹‹é—´çš„æ½œåœ¨å…³è”ã€‚ ç ”ç©¶å‘ç°ï¼Œå¥³æ€§çš„äºšç²¾èƒºæ‘„å…¥é‡é«˜äºç”·æ€§ï¼Œå¹¶ä¸”æ‘„å…¥é‡éƒ½ä¼šéšç€å¹´é¾„çš„å¢é•¿è€Œä¸‹é™ã€‚äºšç²¾èƒºçš„ä¸»è¦æ¥æºæ˜¯å…¨è°·ç‰©ï¼ˆå 13.4%ï¼‰ã€è‹¹æœå’Œæ¢¨ï¼ˆå 13.3%ï¼‰ã€æ²™æ‹‰ï¼ˆå 9.8%ï¼‰ã€èŠ½èœï¼ˆå 7.3%ï¼‰å’Œé©¬é“ƒè–¯ï¼ˆå 6.4%ï¼‰ã€‚ç ”ç©¶æ ¹æ®äºšç²¾èƒºæ‘„å…¥é‡å°†äººç¾¤åˆ†ä¸ºä¸‰ç»„ï¼Œä½æ‘„å…¥é‡ç»„ï¼ˆ62.2 Âµmol dï¼‰ã€ä¸­æ‘„å…¥é‡ç»„ï¼ˆ62.2â€“79.8 Âµmol dï¼‰å’Œé«˜æ‘„å…¥é‡ç»„ï¼ˆ 79.8 Âµmol dï¼‰ã€‚éšè®¿æœŸé—´å…±è®°å½•äº†341ä¾‹æ­»äº¡ï¼Œå…¶ä¸­è¡€ç®¡ç–¾ç—…137ä¾‹ï¼Œç™Œç—‡94ä¾‹ï¼Œå…¶ä»–åŸå› 110ä¾‹ã€‚ç»è®¡ç®—ä½ä¸­é«˜ä¸‰ç»„çš„ç²—ç•¥æ­»äº¡ç‡åˆ†åˆ«ä¸º40.5%ã€23.7%å’Œ15.1%ï¼Œè¿™äº›æ•°æ®è¡¨æ˜äºšç²¾èƒºæ‘„å…¥é‡ä¸å…¨å› æ­»äº¡ç‡ä¹‹é—´çš„è´Ÿç›¸å…³å…³ç³»æ˜¾è‘—ã€‚éšç€é€æ­¥å¯¹å¹´é¾„ã€æ€§åˆ«å’Œçƒ­é‡çš„æ¯”ä¾‹è¿›è¡Œè°ƒæ•´ï¼Œè¿™ç§ç›¸å…³å…³ç³»ä¾ç„¶æ˜¾è‘—ã€‚ ç»¼åˆ ã€Šè‡ªç„¶ã€‹å­åˆŠæ·±åº¦ç»¼è¿°ï¼šå¦‚ä½•å¼€å‘æŠ—è¡°è€è¯ 6.2. è¾“å‡º6.2.1. æŒ¥æ‹è¿åŠ¨ å“ªç§è¿åŠ¨æ€§ä»·æ¯”æœ€é«˜ï¼Ÿæƒå¨åŒ»å­¦æ‚å¿—â€œæŸ³å¶åˆ€â€ç»™å‡ºç­”æ¡ˆäº† ä¸€å‘¨ä¸‰æ¬¡ï¼Œæ¯æ¬¡45-60åˆ†é’Ÿï¼ŒæŒ¥æ‹è¿åŠ¨ï¼Œé™ä½~47%å…¨å› æ­»äº¡ç‡ ç¾½æ¯›çƒã€ä¹’ä¹“çƒã€ç½‘çƒç­‰éƒ½ç®—æŒ¥æ‹è¿åŠ¨ï¼Œä½†ç”±äºè¥¿åŒ–ç ”ç©¶èƒŒæ™¯ï¼Œå¯èƒ½æŒ‡ç½‘çƒæ›´å¤šã€‚è¿™éšå¼çš„è¡¨è¾¾äº†å…¨èº«é”»ç‚¼æ›´ä¸ºé‡è¦ 6.2.2. å‰§çƒˆè¿åŠ¨ æ–°ç ”ç©¶ï¼šæ¯å¤©å‰§çƒˆè¿åŠ¨8åˆ†é’Ÿï¼Œå¯é™ä½å…¨å› æ­»äº¡å’Œå¿ƒè„ç—…é£é™© æ¯å‘¨15-20åˆ†é’Ÿçš„å‰§çƒˆè¿åŠ¨ï¼Œé™ä½16-40%çš„å…¨å› æ­»äº¡ç‡ï¼Œå‰§çƒˆè¿åŠ¨æ—¶é—´è¾¾åˆ°50-57åˆ†é’Ÿå‘¨ï¼Œå¯ä»¥è¿›ä¸€æ­¥é™ä½å…¨å› æ­»äº¡ç‡ã€‚è¿™äº›å‘ç°è¡¨æ˜ï¼Œé€šè¿‡åœ¨ä¸€å‘¨çš„çŸ­æ—¶é—´å†…ç´¯ç§¯ç›¸å¯¹å°‘é‡çš„å‰§çƒˆè¿åŠ¨å¯ä»¥é™ä½å¥åº·é£é™©ã€‚ 6.2.3. èµ°è·¯ èµ°è·¯é™ä½å…¨å› æ­»äº¡ç‡è¶…è¿‡50%ï¼æ¯å¤©èµ°å¤šå°‘æ­¥æœ€åˆé€‚ï¼Ÿã€ŠJAMAã€‹å­åˆŠè¶…10å¹´ç ”ç©¶å‘Šè¯‰ä½ ç­”æ¡ˆ æ³¨1ï¼šè¿™é¡¹ç ”ç©¶å‚ä¸è€…çš„å¹³å‡å¹´é¾„ä¸º45.2å² æ³¨2ï¼šå¹³å‡æ­¥æ•°çš„å¤šå°‘ä¸èŒä¸šæœ‰å…³ï¼Œæ­¤é¡¹ç ”ç©¶ä»…è¡¨æ˜ç›¸å…³æ€§ï¼Œè¿˜æ²¡æœ‰æ›´æ·±åº¦çš„å› æœåˆ†æ 6.2.4. åˆ·ç‰™ 50ä¸‡å›½äººç ”ç©¶è¯å®ï¼šä¸å¥½å¥½åˆ·ç‰™ï¼Œè‡´ç™Œï¼è¡€ç®¡ç–¾ç—…ä¹Ÿä¼šå¢å¤šï¼ ç»å¸¸ä¸åˆ·ç‰™çš„äººï¼šç™Œç—‡ã€æ…¢æ€§é˜»å¡æ€§è‚ºç—…åŠè‚ç¡¬åŒ–é£é™©åˆ†åˆ«å¢åŠ äº†9%ã€12%å’Œ25%ï¼Œè¿‡æ—©æ­»äº¡é£é™©å¢åŠ 25%ã€‚ 6.2.5. æ³¡æ¾¡ å®šæœŸæ´—æ¾¡é™ä½å¿ƒè¡€ç®¡ç–¾ç—…å‘ä½œé£é™© ä¸æ¯å‘¨ä¸€è‡³ä¸¤æ¬¡æ³¡æ¾¡æˆ–æ ¹æœ¬ä¸æ³¡æ¾¡ç›¸æ¯”ï¼Œæ¯å¤©æ´—çƒ­æ°´æ¾¡å¯ä»¥é™ä½28%çš„å¿ƒè¡€ç®¡ç–¾ç—…æ€»é£é™©ï¼Œé™ä½26%çš„ä¸­é£æ€»é£é™©ï¼Œè„‘å‡ºè¡€é£é™©ä¸‹é™46%ã€‚è€Œæµ´ç¼¸æµ´çš„é¢‘ç‡ä¸å¿ƒæºæ€§çŒæ­»çš„é£é™©å¢åŠ æ— å…³ã€‚ 6.2.6. åšå®¶åŠ¡ï¼ˆè€å¹´ç”·æ€§ï¼‰ Housework Reduces All-Cause and Cancer Mortality in Chinese Men 72å²ä¹‹åç”·æ€§æ¯å‘¨åšé‡å‹å®¶åŠ¡å¯ä»¥å‡å°‘29%å¹³å‡æ­»äº¡ç‡ é‡å‹å®¶åŠ¡ï¼šå¸å°˜ã€æ“¦åœ°æ¿ã€æ‹–åœ°ã€æ“¦æ´—çª—æˆ·ã€æ´—è½¦ã€æ¬åŠ¨å®¶å…·ã€æ¬ç…¤æ°”ç½ç­‰ç­‰ã€‚ è½»å‹å®¶åŠ¡ï¼šæ¸ç°å°˜ã€æ´—ç¢—ã€æ‰‹æ´—è¡£æœã€ç†¨çƒ«ã€æ™¾è¡£æœã€åšé¥­ã€ä¹°æ—¥ç”¨å“ç­‰ç­‰ã€‚ 6.2.7. ç¡çœ  è¶…30ä¸‡äºšæ´²äººæ•°æ®ï¼šæ¯å¤©ç¡å‡ ä¸ªå°æ—¶æœ€æœ‰ç›Šé•¿å¯¿ï¼Ÿ åœ¨ç”·æ€§ä¸­ï¼Œä¸ç¡çœ æ—¶é•¿ä¸º7å°æ—¶ç›¸æ¯”ï¼šç¡çœ æŒç»­æ—¶é—´â‰¥10å°æ—¶ä¸å…¨å› æ­»äº¡é£é™©å¢åŠ 34%ç›¸å…³ï¼› åœ¨å¥³æ€§ä¸­ï¼Œä¸ç¡çœ æŒç»­æ—¶é—´7å°æ—¶ç›¸æ¯”ï¼šç¡çœ æŒç»­æ—¶é—´â‰¥10å°æ—¶ä¸å…¨å› æ­»äº¡é£é™©å¢åŠ 48%ç›¸å…³ï¼› é¢ è¦†è®¤çŸ¥ï¼åŠ æ‹¿å¤§ç ”ç©¶å‘ç°ï¼šæ—©ç¡æ¯”ç†¬å¤œæˆ–è®¸æ›´ä¼¤èº«ï¼Œå‡ ç‚¹ç¡æ‰å¥½ï¼Ÿ å…¶ä¸­ä¸€ä¸ªç»“è®ºä¸ºï¼Œå°±å¯æ—¶é—´ä¸å…¨å› æ­»äº¡ç‡çš„å…³è”æ€§å¼ºï¼Œè¿‡æ—©ç¡è§‰å’Œè¿‡æ™šç¡è§‰éƒ½ä¼šå½±å“å¥åº·ï¼Œä½†æ˜¯æ—©ç¡å¢åŠ çš„å…¨å› æ­»äº¡ç‡æ¯”æ™šç¡å¢åŠ çš„æ­»äº¡ç‡é«˜ï¼Œæ—©ç¡å¢åŠ äº†43%çš„æ­»äº¡é£é™©ï¼Œè€Œæ™šç¡å¢åŠ äº†15%çš„æ­»äº¡é£é™©ã€‚ è¿™é¡¹è°ƒæŸ¥ç ”ç©¶ï¼Œè¿˜å­˜åœ¨å¾ˆå¤šå±€é™æ€§ï¼Œæ¯”å¦‚æ²¡æœ‰ç›´æ¥è¯æ˜å°±å¯æ—¶é—´ä¸æ­»äº¡çš„å…³ç³»ï¼Œä»…ä»…è¯´æ˜ç›¸å…³æ€§ï¼Œé€šè¿‡å‚ä¸äººç¾¤è‡ªæˆ‘æŠ¥å‘Šç»Ÿè®¡ç¡çœ æ—¶é—´ï¼Œæ•°æ®ä¸å¤Ÿå®¢è§‚ 6.2.8. ä¹…å ä¸­å›½å±…æ°‘è†³é£ŸæŒ‡å—ç§‘å­¦ç ”ç©¶æŠ¥å‘Šï¼ˆ2021å¹´ï¼‰ ä¹…åå’Œçœ‹ç”µè§†æ—¶é—´ä¸å…¨å› æ­»äº¡ã€å¿ƒè¡€ç®¡ç–¾ç—…ã€ç™Œç—‡å’Œ2å‹ç³–å°¿ç—…å‘ç—…é«˜é£é™©ç›¸å…³ï¼Œæ˜¯ç‹¬ç«‹é£é™©å› ç´ ã€‚ä¹…åæ—¶é—´æ¯å¤©æ¯å¢åŠ 1å°æ—¶ï¼Œå¿ƒè¡€ç®¡ç–¾ç—…å‘ç”Ÿé£é™©å¢åŠ 4%ï¼Œç™Œç—‡å¢åŠ 1%ï¼Œå…¨å› æ­»äº¡é£é™©å¢åŠ 3%ã€‚å…¨å› æ­»äº¡å’ŒCVDæ­»äº¡é£é™©å¢åŠ çš„ä¹…åæ—¶é—´é˜ˆå€¼æ˜¯6~8hdï¼Œçœ‹ç”µè§†æ—¶é—´é˜ˆå€¼æ˜¯3~4hdã€‚ ä¸–å«ç»„ç»‡å…³äºèº«ä½“æ´»åŠ¨å’Œä¹…åè¡Œä¸ºçš„æŒ‡å— 6.3. ä¸Šä¸‹æ–‡6.3.1. æƒ…ç»ª æ‚²è§‚æƒ…ç»ªä¸æ›´é«˜çš„å…¨å› æ­»äº¡ç‡å’Œå¿ƒè¡€ç®¡ç–¾ç—…æ­»äº¡ç‡æœ‰å…³ï¼Œä½†ä¹è§‚æƒ…ç»ªå¹¶ä¸èƒ½èµ·åˆ°ä¿æŠ¤ä½œç”¨ Pessimism is associated with greater all-cause and cardiovascular mortality, but optimism is not protective åœ¨1993-1995å¹´é—´ï¼Œä¸€é¡¹é’ˆå¯¹50å²ä»¥ä¸Šæ¾³å¤§åˆ©äºšäººå¥åº·çš„åŒèƒèƒç ”ç©¶ä¸­åŒ…æ‹¬äº†ç”Ÿæ´»å–å‘æµ‹è¯•ï¼ˆLOTï¼‰ï¼Œå…¶ä¸­åŒ…å«ä¹è§‚å’Œæ‚²è§‚çš„é¡¹ç›®ã€‚å¹³å‡20å¹´åï¼Œå‚ä¸è€…ä¸æ¥è‡ªæ¾³å¤§åˆ©äºšå›½å®¶æ­»äº¡æŒ‡æ•°çš„æ­»äº¡ä¿¡æ¯ç›¸åŒ¹é…ã€‚åœ¨2,978åå…·æœ‰å¾ˆå¤šå¯ç”¨åˆ†æ•°çš„å‚ä¸è€…ä¸­ï¼Œæœ‰1,068äººæ­»äº¡ã€‚ç”Ÿå­˜åˆ†ææµ‹è¯•äº†å„ç§ä¹è§‚å› ç´ å’Œæ‚²è§‚æƒ…ç»ªåˆ†æ•°ä¸ä»»ä½•åŸå› ï¼Œç™Œç—‡ï¼Œå¿ƒè¡€ç®¡ç–¾ç—…æˆ–å…¶ä»–å·²çŸ¥åŸå› çš„æ­»äº¡ç‡ä¹‹é—´çš„å…³è”ã€‚å¹´é¾„è°ƒæ•´åçš„æ‚²è§‚é‡è¡¨ä¸Šçš„æ ¸å¿ƒä¸å…¨å› å’Œå¿ƒè¡€ç®¡ç–¾ç—…æ­»äº¡ç‡ç›¸å…³ï¼ˆæ¯1ä¸ªæ ‡å‡†å·®å•ä½çš„å±é™©æ¯”ï¼Œ95ï¼…ç½®ä¿¡åŒºé—´å’Œpå€¼1.134ã€1.065â€“1.207ã€8.85Ã—10 â€“5å’Œ1.196ã€1.045â€“1.368ã€0.0093 ï¼‰ï¼Œä½†ä¸ä¼šå› ç™Œç—‡æ­»äº¡ã€‚ä¹è§‚å¾—åˆ†ä¸æ‚²è§‚å¾—åˆ†ä¹‹é—´çš„ç›¸å…³æ€§å¾ˆå¼±ï¼ˆå¹´é¾„è°ƒæ•´åçš„ç­‰çº§ç›¸å…³ç³»æ•° âˆ’ 0.176ï¼‰ï¼Œä½†ä¸æ€»æ­»äº¡ç‡æˆ–ç‰¹å®šåŸå› æ­»äº¡ç‡æ²¡æœ‰æ˜¾ç€ç›¸å…³æ€§ã€‚åå‘å› æœå…³ç³»ï¼ˆå¼•èµ·æ‚²è§‚æƒ…ç»ªçš„ç–¾ç—…ï¼‰æ˜¯ä¸å¯èƒ½çš„ï¼Œå› ä¸ºåœ¨é‚£ç§æƒ…å†µä¸‹ï¼Œå¿ƒè¡€ç®¡ç–¾ç—…å’Œç™Œç—‡éƒ½ä¼šå¯¼è‡´æ‚²è§‚æƒ…ç»ªã€‚ 6.3.2. è´«å¯Œ JAMAå­åˆŠï¼šè´«å¯Œå·®è·çœŸèƒ½å½±å“å¯¿å‘½ï¼Ÿè¿™å¯èƒ½æ˜¯çœŸçš„ï¼ è¯¥ç ”ç©¶ä½¿ç”¨1994-1996å¹´ç¬¬ä¸€æ¬¡æ”¶é›†çš„æ•°æ®ï¼Œå¹¶é€šè¿‡ç”Ÿå­˜æ¨¡å‹æ¥åˆ†æå‡€èµ„äº§å’Œé•¿å¯¿ä¹‹é—´çš„å…³è”ã€‚ç»“æœæ˜¾ç¤ºï¼Œå…±æ”¶çº³5414 åå‚ä¸è€…ï¼Œå¹³å‡å¹´é¾„ä¸º 46.7å²ï¼ŒåŒ…æ‹¬ 2766 åå¥³æ€§ã€‚è¾ƒé«˜çš„å‡€èµ„äº§ä¸è¾ƒä½çš„æ­»äº¡é£é™©ç›¸å…³ã€‚ç‰¹åˆ«æ˜¯åœ¨å…„å¼Ÿå§å¦¹å’ŒåŒèƒèƒä¸­ï¼ˆn 2490ï¼‰ï¼Œåœ¨è¾ƒé«˜çš„å‡€èµ„äº§å’Œè¾ƒä½çš„æ­»äº¡ç‡ä¹‹é—´è§‚å¯Ÿåˆ°ç±»ä¼¼çš„å…³è”ï¼Œè¡¨æ˜æ‹¥æœ‰æ›´å¤šè´¢å¯Œçš„å…„å¼Ÿå§å¦¹æˆ–åŒèƒèƒæ¯”æ‹¥æœ‰æ›´å°‘è´¢å¯Œçš„å…„å¼Ÿå§å¦¹åŒèƒèƒæ´»å¾—æ›´ä¹…ã€‚ 6.3.3. ä½“é‡ JAMAå­åˆŠï¼šå‡è‚¥è¦è¶æ—©ï¼Œæ‰èƒ½æœ‰æ•ˆé™ä½æ­»äº¡ç‡é£é™© å¯¹ä½“é‡å‡è½»çš„æ­»äº¡ç‡é£é™©è¯„ä¼°å‘ç°ï¼Œä½“é‡ä»è‚¥èƒ–å‡è½»åˆ°è¶…é‡çš„æˆå¹´äººä¸ç¨³å®šè‚¥èƒ–äººç¾¤ç›¸æ¯”ï¼Œå…¨å› æ­»äº¡ç‡é™ä½äº†54ï¼…ï¼ˆå±é™©æ¯”ä¸º0.46ï¼‰ï¼Œç„¶è€Œä»æˆå¹´åˆæœŸçš„è¶…é‡å‡è½»åˆ°ä¸­å¹´ä»¥å‰çš„æ­£å¸¸ä½“é‡çš„äººç¾¤çš„æ­»äº¡ç‡é£é™©å¹¶æœªé™ä½ï¼ˆé£é™©æ¯”ä¸º1.12ï¼‰ã€‚ 6.3.4. æ–°å†  Magnitude, demographics and dynamics of the effect of the first wave of the COVID-19 pandemic on all-cause mortality in 21 industrialized countries ç›®å‰æ¥çœ‹ï¼Œæ–°å† æ­»äº¡ç‡ï¼ˆç¾å›½ï¼‰åœ¨1.5%å·¦å³ï¼Œäººå‡é¢„æœŸå¯¿å‘½å‡å°‘äº†2å¹´ å¦‚ä½•çœ‹å¾…ç¾å›½CDCå®£ç§°æ–°å† æ­»äº¡äººæ•°è¢«é«˜ä¼°ï¼Ÿ NVSS deaths","tags":["æ‚é¡¹"],"categories":["æ‚é¡¹ç¬”è®°"]},{"title":"ä½¿ç”¨Postshotè®­ç»ƒ3DGSæ¨¡å‹æµç¨‹","path":"/2025/07/12/3DGS/ä½¿ç”¨Postshotè®­ç»ƒ3DGSæµç¨‹/","content":"1ä½¿ç”¨å‘½ä»¤.txt cd d D:sysDesktopWorkplacegsrosbagrosbag_test D:sysDesktopWorkplacegs70123all_2025-07-12-15-25-10.bag 2ä½¿ç”¨è„šæœ¬å»ç•¸å˜ 3æŠŠæ–‡ä»¶å¤¹æ‹–åˆ°Postshoté‡Œé¢è®­ç»ƒ","tags":["3DGS","å…¬å¸"],"categories":["3DGS"]},{"title":"2025.7.12å­¦ä¹ æ—¥è®°","path":"/2025/07/12/å­¦ä¹ æ—¥è®°25å¹´7æœˆ/2025.7.12å­¦ä¹ ç¬”è®°/","content":"ä»Šæ—¥å­¦ä¹ å†…å®¹3DGSåŠ›æ‰£æ¯æ—¥ä¸€é¢˜:ä¸€é“å›°éš¾dp. ä»£ç éšæƒ³å½•é¡¹ç›®ç›¸å…³å®ç°è·¨åŸŸæ–¹æ³•,è®°äº†ä¸€ç¯‡ç¬”è®°","tags":["æ—¥è®°","leetcode","é¡¹ç›®"],"categories":["å­¦ä¹ æ—¥è®°","2025-07"]},{"title":"2025.7.11å­¦ä¹ æ—¥è®°","path":"/2025/07/11/å­¦ä¹ æ—¥è®°25å¹´7æœˆ/2025.7.11å­¦ä¹ ç¬”è®°/","content":"ä»Šæ—¥å­¦ä¹ å†…å®¹3DGSä»Šå¤©ä¸»è¦ç ”ç©¶äº†åŸç‰ˆ3DGSå’Œâ€‹â€‹DASH-GSâ€‹çš„ä»£ç ï¼Œé‡ç‚¹çœ‹äº†å®ƒä»¬çš„æ¶æ„è®¾è®¡å’Œä¼˜åŒ–æµç¨‹ã€‚â€‹â€‹ä¸»è¦å­¦ä¹ äº†é«˜æ–¯å‚æ•°çš„ç®¡ç†ã€æŠ•å½±å˜æ¢å’Œæ¸²æŸ“éƒ¨åˆ†çš„å®ç°ï¼Œæ„Ÿè§‰å¹¶è¡Œè®¡ç®—è®¾è®¡å¾ˆå·§å¦™ã€‚â€‹â€‹å¯¹æ¯”äº†ä¸€ä¸‹DASH-GSâ€‹â€‹ä¼˜åŒ–ç‚¹ï¼Œä¸»è¦è¿˜æ˜¯åœ¨åŠ¨æ€é«˜æ–¯æ•°é‡åˆ†é…å’Œç¨€ç–åŒ–å¤„ç†ä¸Šåšäº†æ”¹è¿›ã€‚ åŠ›æ‰£æ¯æ—¥ä¸€é¢˜:æ­£éš¾åˆ™åçš„é¢˜ç›®,æ±‚ç©ºä½,é‚£å°±æ±‚æ‰€æœ‰çš„å ç”¨çš„é•¿åº¦. ä»£ç éšæƒ³å½•ä¸¤é“01èƒŒåŒ… é¡¹ç›®ç›¸å…³å¾®ä¿¡ç™»å½•helper ç”Ÿæ´»æ™šä¸Šå¥èº«èƒ¸,è‚©,äºŒå¤´,ä¸‰å¤´,å¼ºåº¦ä¸­ç­‰åä¸Š.","tags":["æ—¥è®°","leetcode","é¡¹ç›®"],"categories":["å­¦ä¹ æ—¥è®°","2025-07"]},{"title":"2025.7.10å­¦ä¹ æ—¥è®°","path":"/2025/07/10/å­¦ä¹ æ—¥è®°25å¹´7æœˆ/2025.7.10å­¦ä¹ ç¬”è®°/","content":"ä»Šæ—¥å­¦ä¹ å†…å®¹3DGSåŠ›æ‰£æ¯æ—¥ä¸€é¢˜:æ˜¨å¤©çš„é¢˜çš„æ”¹ç‰ˆ,éœ€è¦æšä¸¾å‰ä¸‰å¤§çš„ç©ºä½,ç„¶åéå†æ‰€æœ‰ç©ºä½åˆ¤æ–­æ˜¯å¦èƒ½å¤Ÿé€šè¿‡å°†æ¡Œå­ç§»åˆ°ç©ºä½æ¥åˆ¤æ–­æœ€å¤§è¿ç»­ç©ºä½. ä»£ç éšæƒ³å½•é¡¹ç›®ç›¸å…³å®ç°æ³¨å†Œæ¥å£å’Œç™»å½•æ¥å£,ç›®å‰ç™»å½•æ—¶äºŒç»´ç ä¼šä¸€ç›´åˆ·æ–°,éœ€è¦å®ç°ä¸€ä¸‹æ¥å£. ç”Ÿæ´»æ™šä¸Šå¥èº«ç»ƒèƒŒå’Œè…¿,å¼ºåº¦ä½,ä¸»è¦æ¢å¤ä¸ºä¸».","tags":["æ—¥è®°","leetcode","é¡¹ç›®"],"categories":["å­¦ä¹ æ—¥è®°","2025-07"]},{"title":"MybatisPlusç¬”è®°","path":"/2025/07/09/åŸºç¡€ç¬”è®°/MybatisPlusç¬”è®°/","content":"ç®€ä»‹MyBatis-Plus ï¼ˆç®€ç§° MPï¼‰æ˜¯ä¸€ä¸ª MyBatis çš„å¢å¼ºå·¥å…·ï¼Œåœ¨ MyBatis çš„åŸºç¡€ä¸Šåªåšå¢å¼ºä¸åšæ”¹å˜ï¼Œä¸ºç®€åŒ–å¼€å‘ã€æé«˜æ•ˆç‡è€Œç”Ÿã€‚ 1å¿«é€Ÿå…¥é—¨1.1 åŸºæœ¬æ­¥éª¤å¼•å…¥mybatis-plus-boot-starterä¾èµ–: dependency groupIdcom.baomidou/groupId artifactIdmybatis-plus-boot-starter/artifactId versionæœ€æ–°ç‰ˆæœ¬/version/dependency å®šä¹‰Mapperæ¥å£å¹¶ç»§æ‰¿BaseMapper: public interface UserMapper extends BaseMapperUser 1.2 å®šä¹‰Mapperä¸ºäº†ç®€åŒ–å•è¡¨CRUDï¼ŒMybatisPlusæä¾›äº†ä¸€ä¸ªåŸºç¡€çš„BaseMapperæ¥å£ï¼Œå…¶ä¸­å·²ç»å®ç°äº†å•è¡¨çš„CRUDï¼šå› æ­¤æˆ‘ä»¬è‡ªå®šä¹‰çš„Mapperåªè¦ç»§æ‰¿äº†è¿™ä¸ªBaseMapperï¼Œå°±æ— éœ€è‡ªå·±å®ç°å•è¡¨CRUDäº†ã€‚ 2 å¸¸è§æ³¨è§£MybatisPlusä¸­æ¯”è¾ƒå¸¸ç”¨çš„å‡ ä¸ªæ³¨è§£å¦‚ä¸‹: @TableName: ç”¨äºæŒ‡å®šè¡¨å @Tabled: ç”¨äºæŒ‡å®šè¡¨ä¸­çš„ä¸»é”®å­—æ®µä¿¡æ¯ @TableField: ç”¨äºæŒ‡å®šè¡¨ä¸­çš„æ™®é€šå­—æ®µä¿¡æ¯ @TableName(sys_user)public class User @TableId(id,type=IdType.AUTO) private Long id; @TableField(nickname) private String name; private Integer age; private String email; 2.1 @TableNameTableNameæ³¨è§£é™¤äº†æŒ‡å®šè¡¨åä»¥å¤–ï¼Œè¿˜å¯ä»¥æŒ‡å®šå¾ˆå¤šå…¶å®ƒå±æ€§ï¼š 2.2 @TableIdTableIdæ³¨è§£æ”¯æŒä¸¤ä¸ªå±æ€§ï¼š IdTypeæ”¯æŒçš„ç±»å‹æœ‰ï¼š è¿™é‡Œæ¯”è¾ƒå¸¸è§çš„æœ‰ä¸‰ç§ï¼š AUTOï¼š åˆ©ç”¨æ•°æ®åº“çš„idè‡ªå¢é•¿ INPUTï¼š æ‰‹åŠ¨ç”Ÿæˆid ASSIGN_IDï¼š é›ªèŠ±ç®—æ³•ç”ŸæˆLongç±»å‹çš„å…¨å±€å”¯ä¸€idï¼Œè¿™æ˜¯é»˜è®¤çš„IDç­–ç•¥ 2.3 @TableFieldä¸€èˆ¬æƒ…å†µä¸‹æˆ‘ä»¬å¹¶ä¸éœ€è¦ç»™å­—æ®µæ·»åŠ @TableFieldæ³¨è§£ï¼Œä¸€äº›ç‰¹æ®Šæƒ…å†µé™¤å¤–ï¼š æˆå‘˜å˜é‡åä¸æ•°æ®åº“å­—æ®µåä¸ä¸€è‡´ æˆå‘˜å˜é‡æ˜¯ä»¥isXXXå‘½åï¼ŒæŒ‰ç…§JavaBeançš„è§„èŒƒï¼ŒMybatisPlusè¯†åˆ«å­—æ®µæ—¶ä¼šæŠŠiså»é™¤ï¼Œè¿™å°±å¯¼è‡´ä¸æ•°æ®åº“ä¸ç¬¦ã€‚ æˆå‘˜å˜é‡åä¸æ•°æ®åº“ä¸€è‡´ï¼Œä½†æ˜¯ä¸æ•°æ®åº“çš„å…³é”®å­—å†²çªã€‚ä½¿ç”¨@TableFieldæ³¨è§£ç»™å­—æ®µåæ·»åŠ è½¬ä¹‰å­—ç¬¦ï¼š`` æ”¯æŒçš„å…¶å®ƒå±æ€§å¦‚ä¸‹ï¼š 3 å¸¸è§é…ç½®å¤§å¤šæ•°çš„é…ç½®éƒ½æœ‰é»˜è®¤å€¼ï¼Œå› æ­¤æˆ‘ä»¬éƒ½æ— éœ€é…ç½®ã€‚ä½†è¿˜æœ‰ä¸€äº›æ˜¯æ²¡æœ‰é»˜è®¤å€¼çš„ï¼Œä¾‹å¦‚: å®ä½“ç±»çš„åˆ«åæ‰«æåŒ… å…¨å±€idç±»å‹ mybatis-plus: type-aliases-package: com.itheima.mp.domain.po global-config: db-config: id-type: auto # å…¨å±€idç±»å‹ä¸ºè‡ªå¢é•¿ éœ€è¦æ³¨æ„çš„æ˜¯ï¼ŒMyBatisPlusä¹Ÿæ”¯æŒæ‰‹å†™SQLçš„ï¼Œè€Œmapperæ–‡ä»¶çš„è¯»å–åœ°å€å¯ä»¥è‡ªå·±é…ç½®ï¼š mybatis-plus: mapper-locations: classpath*:/mapper/**/*.xml # Mapper.xmlæ–‡ä»¶åœ°å€ï¼Œå½“å‰è¿™ä¸ªæ˜¯é»˜è®¤å€¼ã€‚ 4 æ ¸å¿ƒåŠŸèƒ½4.1 æ¡ä»¶æ„é€ å™¨é™¤äº†æ–°å¢ä»¥å¤–ï¼Œä¿®æ”¹ã€åˆ é™¤ã€æŸ¥è¯¢çš„SQLè¯­å¥éƒ½éœ€è¦æŒ‡å®šwhereæ¡ä»¶ã€‚å› æ­¤BaseMapperä¸­æä¾›çš„ç›¸å…³æ–¹æ³•é™¤äº†ä»¥idä½œä¸ºwhereæ¡ä»¶ä»¥å¤–ï¼Œè¿˜æ”¯æŒæ›´åŠ å¤æ‚çš„whereæ¡ä»¶ã€‚ å‚æ•°ä¸­çš„Wrapperå°±æ˜¯æ¡ä»¶æ„é€ çš„æŠ½è±¡ç±»ï¼Œå…¶ä¸‹æœ‰å¾ˆå¤šé»˜è®¤å®ç°ï¼Œç»§æ‰¿å…³ç³»å¦‚å›¾ï¼š Wrapperçš„å­ç±»AbstractWrapperæä¾›äº†whereä¸­åŒ…å«çš„æ‰€æœ‰æ¡ä»¶æ„é€ æ–¹æ³•ï¼š 4.1.1 QueryWrapperQueryWrapperåœ¨AbstractWrapperçš„åŸºç¡€ä¸Šæ‹“å±•äº†ä¸€ä¸ªselectæ–¹æ³•ï¼Œå…è®¸æŒ‡å®šæŸ¥è¯¢å­—æ®µï¼š æ— è®ºæ˜¯ä¿®æ”¹ã€åˆ é™¤ã€æŸ¥è¯¢ï¼Œéƒ½å¯ä»¥ä½¿ç”¨QueryWrapperæ¥æ„å»ºæŸ¥è¯¢æ¡ä»¶ã€‚æ¥ä¸‹æ¥çœ‹ä¸€ä¸ªä¾‹å­ï¼š @Testvoid testQueryWrapper() // 1.æ„å»ºæŸ¥è¯¢æ¡ä»¶ where name like %o% AND balance = 1000 QueryWrapperUser wrapper = new QueryWrapperUser() .select(id, username, info, balance) .like(username, o) .ge(balance, 1000); // 2.æŸ¥è¯¢æ•°æ® ListUser users = userMapper.selectList(wrapper); users.forEach(System.out::println); 4.1.2 UpdateWrapperUpdateWrapperåœ¨AbstractWrapperçš„åŸºç¡€ä¸Šæ‹“å±•äº†ä¸€ä¸ªsetæ–¹æ³•ï¼Œå…è®¸æŒ‡å®šSQLä¸­çš„SETéƒ¨åˆ†ï¼š åŸºäºBaseMapperä¸­çš„updateæ–¹æ³•æ›´æ–°æ—¶åªèƒ½ç›´æ¥èµ‹å€¼ï¼Œå¯¹äºä¸€äº›å¤æ‚çš„éœ€æ±‚å°±éš¾ä»¥å®ç°ã€‚ä¾‹å¦‚ï¼šæ›´æ–°idä¸º1,2,4çš„ç”¨æˆ·çš„ä½™é¢ï¼Œæ‰£200ï¼Œå¯¹åº”çš„SQLåº”è¯¥æ˜¯ï¼š UPDATE user SET balance = balance - 200 WHERE id in (1, 2, 4) SETçš„èµ‹å€¼ç»“æœæ˜¯åŸºäºå­—æ®µç°æœ‰å€¼çš„ï¼Œè¿™ä¸ªæ—¶å€™å°±è¦åˆ©ç”¨UpdateWrapperä¸­çš„setSqlåŠŸèƒ½äº†ï¼š @Testvoid testUpdateWrapper() ListLong ids = List.of(1L, 2L, 4L); // 1.ç”ŸæˆSQL UpdateWrapperUser wrapper = new UpdateWrapperUser() .setSql(balance = balance - 200) // SET balance = balance - 200 .in(id, ids); // WHERE id in (1, 2, 4) // 2.æ›´æ–°ï¼Œæ³¨æ„ç¬¬ä¸€ä¸ªå‚æ•°å¯ä»¥ç»™nullï¼Œä¹Ÿå°±æ˜¯ä¸å¡«æ›´æ–°å­—æ®µå’Œæ•°æ®ï¼Œ // è€Œæ˜¯åŸºäºUpdateWrapperä¸­çš„setSQLæ¥æ›´æ–° userMapper.update(null, wrapper); 4.1.3 4.1.3.LambdaQueryWrapperæ— è®ºæ˜¯QueryWrapperè¿˜æ˜¯UpdateWrapperåœ¨æ„é€ æ¡ä»¶çš„æ—¶å€™éƒ½éœ€è¦å†™æ­»å­—æ®µåç§°ï¼Œä¼šå‡ºç°å­—ç¬¦ä¸²é­”æ³•å€¼ã€‚è¿™åœ¨ç¼–ç¨‹è§„èŒƒä¸­æ˜¾ç„¶æ˜¯ä¸æ¨èçš„ã€‚é‚£æ€ä¹ˆæ ·æ‰èƒ½ä¸å†™å­—æ®µåï¼Œåˆèƒ½çŸ¥é“å­—æ®µåå‘¢ï¼Ÿ å…¶ä¸­ä¸€ç§åŠæ³•æ˜¯åŸºäºå˜é‡çš„gettteræ–¹æ³•ç»“åˆåå°„æŠ€æœ¯ã€‚å› æ­¤æˆ‘ä»¬åªè¦å°†æ¡ä»¶å¯¹åº”çš„å­—æ®µçš„getteræ–¹æ³•ä¼ é€’ç»™MybatisPlusï¼Œå®ƒå°±èƒ½è®¡ç®—å‡ºå¯¹åº”çš„å˜é‡åäº†ã€‚è€Œä¼ é€’æ–¹æ³•å¯ä»¥ä½¿ç”¨JDK8ä¸­çš„æ–¹æ³•å¼•ç”¨å’ŒLambdaè¡¨è¾¾å¼ã€‚å› æ­¤MybatisPlusåˆæä¾›äº†ä¸€å¥—åŸºäºLambdaçš„Wrapperï¼ŒåŒ…å«ä¸¤ä¸ªï¼š LambdaQueryWrapper LambdaUpdateWrapperåˆ†åˆ«å¯¹åº”QueryWrapperå’ŒUpdateWrapperå…¶ä½¿ç”¨æ–¹å¼å¦‚ä¸‹ï¼š @Testvoid testLambdaQueryWrapper() // 1.æ„å»ºæ¡ä»¶ WHERE username LIKE %o% AND balance = 1000 QueryWrapperUser wrapper = new QueryWrapper(); wrapper.lambda() .select(User::getId, User::getUsername, User::getInfo, User::getBalance) .like(User::getUsername, o) .ge(User::getBalance, 1000); // 2.æŸ¥è¯¢ ListUser users = userMapper.selectList(wrapper); users.forEach(System.out::println); 4.2 è‡ªå®šä¹‰SQLMybatisPlusæä¾›äº†è‡ªå®šä¹‰SQLåŠŸèƒ½ï¼Œå¯ä»¥è®©æˆ‘ä»¬åˆ©ç”¨Wrapperç”ŸæˆæŸ¥è¯¢æ¡ä»¶ï¼Œå†ç»“åˆMapper.xmlç¼–å†™SQL @Testvoid testCustomWrapper() // 1.å‡†å¤‡è‡ªå®šä¹‰æŸ¥è¯¢æ¡ä»¶ ListLong ids = List.of(1L, 2L, 4L); QueryWrapperUser wrapper = new QueryWrapperUser().in(id, ids); // 2.è°ƒç”¨mapperçš„è‡ªå®šä¹‰æ–¹æ³•ï¼Œç›´æ¥ä¼ é€’Wrapper userMapper.deductBalanceByIds(200, wrapper); ç„¶ååœ¨UserMapperä¸­è‡ªå®šä¹‰SQLï¼š package com.itheima.mp.mapper;import com.baomidou.mybatisplus.core.mapper.BaseMapper;import com.itheima.mp.domain.po.User;import org.apache.ibatis.annotations.Param;import org.apache.ibatis.annotations.Update;import org.apache.ibatis.annotations.Param;public interface UserMapper extends BaseMapperUser @Select(UPDATE user SET balance = balance - #money $ew.customSqlSegment) void deductBalanceByIds(@Param(money) int money, @Param(ew) QueryWrapperUser wrapper); 5 Serviceæ¥å£MybatisPlusä¸ä»…æä¾›äº†BaseMapperï¼Œè¿˜æä¾›äº†é€šç”¨çš„Serviceæ¥å£åŠé»˜è®¤å®ç°ï¼Œå°è£…äº†ä¸€äº›å¸¸ç”¨çš„serviceæ¨¡æ¿æ–¹æ³•ã€‚é€šç”¨æ¥å£ä¸ºIServiceï¼Œé»˜è®¤å®ç°ä¸ºServiceImplï¼Œå…¶ä¸­å°è£…çš„æ–¹æ³•å¯ä»¥åˆ†ä¸ºä»¥ä¸‹å‡ ç±»ï¼š saveï¼šæ–°å¢ removeï¼šåˆ é™¤ updateï¼šæ›´æ–° getï¼šæŸ¥è¯¢å•ä¸ªç»“æœ listï¼šæŸ¥è¯¢é›†åˆç»“æœ countï¼šè®¡æ•° pageï¼šåˆ†é¡µæŸ¥è¯¢ 5.1 CRUDæˆ‘ä»¬å…ˆä¿©çœ‹ä¸‹åŸºæœ¬çš„CRUDæ¥å£ã€‚æ–°å¢ï¼š saveæ˜¯æ–°å¢å•ä¸ªå…ƒç´  saveBatchæ˜¯æ‰¹é‡æ–°å¢ saveOrUpdateæ˜¯æ ¹æ®idåˆ¤æ–­ï¼Œå¦‚æœæ•°æ®å­˜åœ¨å°±æ›´æ–°ï¼Œä¸å­˜åœ¨åˆ™æ–°å¢ saveOrUpdateBatchæ˜¯æ‰¹é‡çš„æ–°å¢æˆ–ä¿®æ”¹ åˆ é™¤: removeByIdï¼šæ ¹æ®idåˆ é™¤ removeByIdsï¼šæ ¹æ®idæ‰¹é‡åˆ é™¤ removeByMapï¼šæ ¹æ®Mapä¸­çš„é”®å€¼å¯¹ä¸ºæ¡ä»¶åˆ é™¤ remove(Wrapper)ï¼šæ ¹æ®Wrapperæ¡ä»¶åˆ é™¤ Get: List:","tags":["åŸºç¡€","MybatisPlus"],"categories":["åŸºç¡€ç¬”è®°"]},{"title":"è·¨åŸŸæ”¯æŒç¬”è®°","path":"/2025/07/09/åŸºç¡€ç¬”è®°/è·¨åŸŸæ”¯æŒç¬”è®°/","content":"JAVAåç«¯è§£å†³è·¨åŸŸé—®é¢˜çš„å‡ ç§æ–¹æ³•å‰åç«¯åˆ†ç¦»å¤§åŠ¿æ‰€è¶‹ï¼Œè·¨åŸŸé—®é¢˜æ›´æ˜¯è€ç”Ÿå¸¸è°ˆï¼Œéšä¾¿ç”¨æ ‡é¢˜å»googleæˆ–ç™¾åº¦ä¸€ä¸‹ï¼Œèƒ½æœå‡ºä¸€å¤§ç‰‡è§£å†³æ–¹æ¡ˆï¼Œé‚£ä¹ˆä¸ºå•¥åˆè¦å†™ä¸€éå‘¢ï¼Œä¸æ€¥å¾€ä¸‹çœ‹ã€‚ é—®é¢˜èƒŒæ™¯Same Origin Policyï¼Œè¯‘ä¸ºâ€œåŒæºç­–ç•¥â€SOPã€‚å®ƒæ˜¯å¯¹äºå®¢æˆ·ç«¯è„šæœ¬ï¼ˆå°¤å…¶æ˜¯JavaScriptï¼‰çš„é‡è¦å®‰å…¨åº¦é‡æ ‡å‡†ï¼Œå…¶ç›®çš„åœ¨äºé˜²æ­¢æŸä¸ªæ–‡æ¡£æˆ–è€…è„šæœ¬ä»å¤šä¸ªä¸åŒâ€œoriginâ€ï¼ˆæºï¼‰è£…è½½ã€‚å®ƒè®¤ä¸ºè‡ªä»»ä½•ç«™ç‚¹è£…è½½çš„ä¿¡èµ–å†…å®¹æ˜¯ä¸å®‰å…¨çš„ã€‚ å½“è¢«æµè§ˆå™¨åŠä¿¡åŠç–‘çš„è„šæœ¬è¿è¡Œåœ¨æ²™ç®±æ—¶ï¼Œå®ƒä»¬åº”è¯¥åªè¢«å…è®¸è®¿é—®æ¥è‡ªåŒä¸€ç«™ç‚¹çš„èµ„æºï¼Œè€Œä¸æ˜¯é‚£äº›æ¥è‡ªå…¶å®ƒç«™ç‚¹å¯èƒ½æ€€æœ‰æ¶æ„çš„èµ„æºã€‚ æ³¨ï¼šå…·æœ‰ç›¸åŒçš„Originï¼Œä¹Ÿå³æ˜¯æ‹¥æœ‰ç›¸åŒçš„åè®®ã€ä¸»æœºåœ°å€ä»¥åŠç«¯å£ã€‚ä¸€æ—¦è¿™ä¸‰é¡¹æ•°æ®ä¸­æœ‰ä¸€é¡¹ä¸åŒï¼Œé‚£ä¹ˆè¯¥èµ„æºå°±å°†è¢«è®¤ä¸ºæ˜¯ä»ä¸åŒçš„Originå¾—æ¥çš„ï¼Œè¿›è€Œä¸è¢«å…è®¸è®¿é—®ã€‚ CORSå°±æ˜¯ä¸ºäº†è§£å†³SOPé—®é¢˜è€Œç”Ÿçš„ï¼Œå½“ç„¶CORSä¸æ˜¯å”¯ä¸€çš„è§£å†³æ–¹æ¡ˆï¼Œä¸è¿‡è¿™é‡Œä¸èµ˜è¿°å…¶ä»–è§£å†³åŠæ³•äº†ã€‚ CORSç®€ä»‹CORSæ˜¯ä¸€ä¸ªW3Cæ ‡å‡†ï¼Œå…¨ç§°æ˜¯â€è·¨åŸŸèµ„æºå…±äº«â€ï¼ˆCross-origin resource sharingï¼‰ã€‚å®ƒå…è®¸æµè§ˆå™¨å‘è·¨æº(åè®® + åŸŸå + ç«¯å£)æœåŠ¡å™¨ï¼Œå‘å‡ºXMLHttpRequestè¯·æ±‚ï¼Œä»è€Œå…‹æœäº†AJAXåªèƒ½åŒæºä½¿ç”¨çš„é™åˆ¶ã€‚CORSéœ€è¦æµè§ˆå™¨å’ŒæœåŠ¡å™¨åŒæ—¶æ”¯æŒã€‚å®ƒçš„é€šä¿¡è¿‡ç¨‹ï¼Œéƒ½æ˜¯æµè§ˆå™¨è‡ªåŠ¨å®Œæˆï¼Œä¸éœ€è¦ç”¨æˆ·å‚ä¸ã€‚ å¯¹äºå¼€å‘è€…æ¥è¯´ï¼ŒCORSé€šä¿¡ä¸åŒæºçš„AJAXFetché€šä¿¡æ²¡æœ‰å·®åˆ«ï¼Œä»£ç å®Œå…¨ä¸€æ ·ã€‚æµè§ˆå™¨ä¸€æ—¦å‘ç°è¯·æ±‚è·¨æºï¼Œå°±ä¼šè‡ªåŠ¨æ·»åŠ ä¸€äº›é™„åŠ çš„å¤´ä¿¡æ¯ï¼Œæœ‰æ—¶è¿˜ä¼šå¤šå‡ºä¸€æ¬¡é™„åŠ çš„è¯·æ±‚ï¼Œä½†ç”¨æˆ·ä¸ä¼šæœ‰æ„Ÿè§‰ã€‚å› æ­¤ï¼Œå®ç°CORSé€šä¿¡çš„å…³é”®æ˜¯æœåŠ¡å™¨ã€‚åªè¦æœåŠ¡å™¨å®ç°äº†CORSæ¥å£ï¼Œå°±å¯ä»¥è·¨æºé€šä¿¡ã€‚ æµè§ˆå™¨å°†CORSè¯·æ±‚åˆ†æˆä¸¤ç±»ï¼šç®€å•è¯·æ±‚ï¼ˆsimple requestï¼‰å’Œéç®€å•è¯·æ±‚ï¼ˆnot-so-simple requestï¼‰ã€‚ æµè§ˆå™¨å‘å‡ºCORSç®€å•è¯·æ±‚ï¼Œåªéœ€è¦åœ¨å¤´ä¿¡æ¯ä¹‹ä¸­å¢åŠ ä¸€ä¸ªOriginå­—æ®µã€‚ æµè§ˆå™¨å‘å‡ºCORSéç®€å•è¯·æ±‚ï¼Œä¼šåœ¨æ­£å¼é€šä¿¡ä¹‹å‰ï¼Œå¢åŠ ä¸€æ¬¡OPTIONSæŸ¥è¯¢è¯·æ±‚ï¼Œç§°ä¸ºâ€é¢„æ£€â€è¯·æ±‚ï¼ˆpreflightï¼‰ã€‚æµè§ˆå™¨å…ˆè¯¢é—®æœåŠ¡å™¨ï¼Œå½“å‰ç½‘é¡µæ‰€åœ¨çš„åŸŸåæ˜¯å¦åœ¨æœåŠ¡å™¨çš„è®¸å¯åå•ä¹‹ä¸­ï¼Œä»¥åŠå¯ä»¥ä½¿ç”¨å“ªäº›HTTPåŠ¨è¯å’Œå¤´ä¿¡æ¯å­—æ®µã€‚åªæœ‰å¾—åˆ°è‚¯å®šç­”å¤ï¼Œæµè§ˆå™¨æ‰ä¼šå‘å‡ºæ­£å¼çš„XMLHttpRequestè¯·æ±‚ï¼Œå¦åˆ™å°±æŠ¥é”™ã€‚ ç®€å•è¯·æ±‚å°±æ˜¯HEADã€GETã€POSTè¯·æ±‚ï¼Œå¹¶ä¸”HTTPçš„å¤´ä¿¡æ¯ä¸è¶…å‡ºä»¥ä¸‹å‡ ç§å­—æ®µ Acceptã€Accept-Languageã€Content-Languageã€Last-Event-IDã€Content-Typeæ³¨ï¼šContent-Typeï¼šåªé™äºä¸‰ä¸ªå€¼application/x-www-form-urlencodedã€multipart/form-dataã€text/plainåä¹‹ï¼Œå°±æ˜¯éç®€å•è¯·æ±‚ã€‚ å…¶å®å®ç°CORSå¾ˆç®€å•ï¼Œå°±æ˜¯åœ¨æœåŠ¡ç«¯åŠ ä¸€äº›å“åº”å¤´ï¼Œå¹¶ä¸”è¿™æ ·åšå¯¹å‰ç«¯æ¥è¯´æ˜¯æ— æ„ŸçŸ¥çš„ï¼Œå¾ˆæ–¹ä¾¿ã€‚ åä¹‹ï¼Œå°±æ˜¯éç®€å•è¯·æ±‚ã€‚ å…¶å®å®ç°CORSå¾ˆç®€å•ï¼Œå°±æ˜¯åœ¨æœåŠ¡ç«¯åŠ ä¸€äº›å“åº”å¤´ï¼Œå¹¶ä¸”è¿™æ ·åšå¯¹å‰ç«¯æ¥è¯´æ˜¯æ— æ„ŸçŸ¥çš„ï¼Œå¾ˆæ–¹ä¾¿ã€‚ è¯¦è§£å“åº”å¤´ Access-Control-Allow-Origin è¯¥å­—æ®µå¿…å¡«ã€‚å®ƒçš„å€¼è¦ä¹ˆæ˜¯è¯·æ±‚æ—¶Originå­—æ®µçš„å…·ä½“å€¼ï¼Œè¦ä¹ˆæ˜¯ä¸€ä¸ª*ï¼Œè¡¨ç¤ºæ¥å—ä»»æ„åŸŸåçš„è¯·æ±‚ã€‚ Access-Control-Allow-Methods è¯¥å­—æ®µå¿…å¡«ã€‚å®ƒçš„å€¼æ˜¯é€—å·åˆ†éš”çš„ä¸€ä¸ªå…·ä½“çš„å­—ç¬¦ä¸²æˆ–è€…*ï¼Œè¡¨æ˜æœåŠ¡å™¨æ”¯æŒçš„æ‰€æœ‰è·¨åŸŸè¯·æ±‚çš„æ–¹æ³•ã€‚æ³¨æ„ï¼Œè¿”å›çš„æ˜¯æ‰€æœ‰æ”¯æŒçš„æ–¹æ³•ï¼Œè€Œä¸å•æ˜¯æµè§ˆå™¨è¯·æ±‚çš„é‚£ä¸ªæ–¹æ³•ã€‚è¿™æ˜¯ä¸ºäº†é¿å…å¤šæ¬¡â€é¢„æ£€â€è¯·æ±‚ã€‚ Access-Control-Expose-Headers è¯¥å­—æ®µå¯é€‰ã€‚CORSè¯·æ±‚æ—¶ï¼ŒXMLHttpRequestå¯¹è±¡çš„getResponseHeader()æ–¹æ³•åªèƒ½æ‹¿åˆ°6ä¸ªåŸºæœ¬å­—æ®µï¼šCache-Controlã€Content-Languageã€Content-Typeã€Expiresã€Last-Modifiedã€Pragmaã€‚å¦‚æœæƒ³æ‹¿åˆ°å…¶ä»–å­—æ®µï¼Œå°±å¿…é¡»åœ¨Access-Control-Expose-Headersé‡Œé¢æŒ‡å®šã€‚ Access-Control-Allow-Credentials è¯¥å­—æ®µå¯é€‰ã€‚å®ƒçš„å€¼æ˜¯ä¸€ä¸ªå¸ƒå°”å€¼ï¼Œè¡¨ç¤ºæ˜¯å¦å…è®¸å‘é€Cookie.é»˜è®¤æƒ…å†µä¸‹ï¼Œä¸å‘ç”ŸCookieï¼Œå³ï¼šfalseã€‚å¯¹æœåŠ¡å™¨æœ‰ç‰¹æ®Šè¦æ±‚çš„è¯·æ±‚ï¼Œæ¯”å¦‚è¯·æ±‚æ–¹æ³•æ˜¯PUTæˆ–DELETEï¼Œæˆ–è€…Content-Typeå­—æ®µçš„ç±»å‹æ˜¯applicationjsonï¼Œè¿™ä¸ªå€¼åªèƒ½è®¾ä¸ºtrueã€‚å¦‚æœæœåŠ¡å™¨ä¸è¦æµè§ˆå™¨å‘é€Cookieï¼Œåˆ é™¤è¯¥å­—æ®µå³å¯ã€‚ Access-Control-Max-Age è¯¥å­—æ®µå¯é€‰ï¼Œç”¨æ¥æŒ‡å®šæœ¬æ¬¡é¢„æ£€è¯·æ±‚çš„æœ‰æ•ˆæœŸï¼Œå•ä½ä¸ºç§’ã€‚åœ¨æœ‰æ•ˆæœŸé—´ï¼Œä¸ç”¨å‘å‡ºå¦ä¸€æ¡é¢„æ£€è¯·æ±‚ã€‚ é¡ºä¾¿æä¸€ä¸‹ï¼Œå¦‚æœåœ¨å¼€å‘ä¸­ï¼Œå‘ç°æ¯æ¬¡å‘èµ·è¯·æ±‚éƒ½æ˜¯ä¸¤æ¡ï¼Œä¸€æ¬¡OPTIONSï¼Œä¸€æ¬¡æ­£å¸¸è¯·æ±‚ï¼Œæ³¨æ„æ˜¯æ¯æ¬¡ï¼Œé‚£ä¹ˆå°±éœ€è¦é…ç½®Access-Control-Max-Ageï¼Œé¿å…æ¯æ¬¡éƒ½å‘å‡ºé¢„æ£€è¯·æ±‚ã€‚ è§£å†³æ–¹æ³•ç¬¬ä¸€ç§åŠæ³•import org.springframework.context.annotation.Configuration;import org.springframework.web.servlet.config.annotation.CorsRegistry;import org.springframework.web.servlet.config.annotation.WebMvcConfigurer;@Configurationpublic class CorsConfig implements WebMvcConfigurer @Override public void addCorsMappings(CorsRegistry registry) registry.addMapping(/**) .allowedOrigins(*) .allowedMethods(GET, HEAD, POST, PUT, DELETE, OPTIONS) .allowCredentials(true) .maxAge(3600) .allowedHeaders(*); è¿™ç§æ–¹å¼æ˜¯å…¨å±€é…ç½®çš„ï¼Œç½‘ä¸Šä¹Ÿå¤§éƒ½æ˜¯è¿™ç§è§£å†³åŠæ³•ï¼Œä½†æ˜¯å¾ˆå¤šéƒ½æ˜¯åŸºäºæ—§çš„springç‰ˆæœ¬ï¼Œæ¯”å¦‚ WebMvcConfigurerAdapter åœ¨spring5.0å·²ç»è¢«æ ‡è®°ä¸ºDeprecatedï¼Œç‚¹å¼€æºç å¯ä»¥çœ‹åˆ°ï¼š /** * An implementation of @link WebMvcConfigurer with empty methods allowing * subclasses to override only the methods theyre interested in. * * @author Rossen Stoyanchev * @since 3.1 * @deprecated as of 5.0 @link WebMvcConfigurer has default methods (made * possible by a Java 8 baseline) and can be implemented directly without the * need for this adapter */@Deprecatedpublic abstract class WebMvcConfigurerAdapter implements WebMvcConfigurer åƒè¿™ç§è¿‡æ—¶çš„ç±»æˆ–è€…æ–¹æ³•ï¼Œspringçš„ä½œè€…ä»¬ä¸€å®šä¼šåœ¨æ³¨è§£ä¸Šé¢è¯´æ˜åŸå› ï¼Œå¹¶å‘Šè¯‰ä½ æ–°çš„è¯¥ç”¨å“ªä¸ªï¼Œè¿™æ˜¯éå¸¸ä¼˜ç§€çš„ç¼–ç ä¹ æƒ¯ï¼Œç‚¹èµï¼ spring5æœ€ä½æ”¯æŒåˆ°jdk1.8ï¼Œæ‰€ä»¥æ³¨é‡Šä¸­æ˜ç¡®è¡¨æ˜ï¼Œä½ å¯ä»¥ç›´æ¥å®ç°WebMvcConfigureræ¥å£ï¼Œæ— éœ€å†ç”¨è¿™ä¸ªé€‚é…å™¨ï¼Œå› ä¸ºjdk1.8æ”¯æŒæ¥å£ä¸­å­˜åœ¨default-methodã€‚ Spring Boot åŸºç¡€å°±ä¸ä»‹ç»äº†ï¼Œçœ‹ä¸‹è¿™ä¸ªæ•™ç¨‹å¤ªå…¨äº†ï¼š https://github.com/javastacks/spring-boot-best-practice ç¬¬äºŒç§åŠæ³•import org.springframework.context.annotation.Configuration;import javax.servlet.*;import javax.servlet.annotation.WebFilter;import javax.servlet.http.HttpServletResponse;import java.io.IOException;@WebFilter(filterName = CorsFilter )@Configurationpublic class CorsFilter implements Filter @Override public void doFilter(ServletRequest req, ServletResponse res, FilterChain chain) throws IOException, ServletException HttpServletResponse response = (HttpServletResponse) res; response.setHeader(Access-Control-Allow-Origin,*); response.setHeader(Access-Control-Allow-Credentials, true); response.setHeader(Access-Control-Allow-Methods, POST, GET, PATCH, DELETE, PUT); response.setHeader(Access-Control-Max-Age, 3600); response.setHeader(Access-Control-Allow-Headers, Origin, X-Requested-With, Content-Type, Accept); chain.doFilter(req, res); è¿™ç§åŠæ³•ï¼Œæ˜¯åŸºäºè¿‡æ»¤å™¨çš„æ–¹å¼ï¼Œæ–¹å¼ç®€å•æ˜äº†ï¼Œå°±æ˜¯åœ¨responseä¸­å†™å…¥è¿™äº›å“åº”å¤´ï¼Œå¥½å¤šæ–‡ç« éƒ½æ˜¯ç¬¬ä¸€ç§å’Œç¬¬äºŒç§æ–¹å¼éƒ½å«ä½ é…ç½®ï¼Œå…¶å®è¿™æ˜¯æ²¡æœ‰å¿…è¦çš„ï¼Œåªéœ€è¦ä¸€ç§å³å¯ã€‚ è¿™é‡Œä¹Ÿåæ§½ä¸€ä¸‹ï¼Œå¤§å®¶ä¸æ±‚ç”šè§£çš„ç²¾ç¥ã€‚ ç¬¬ä¸‰ç§åŠæ³•public class GoodsController @CrossOrigin(origins = http://localhost:4000)@GetMapping(goods-url)public Response queryGoodsWithGoodsUrl(@RequestParam String goodsUrl) throws Exception æ²¡é”™å°±æ˜¯@CrossOriginæ³¨è§£ï¼Œç‚¹å¼€æ³¨è§£ @Target( ElementType.METHOD, ElementType.TYPE )@Retention(RetentionPolicy.RUNTIME)@Documentedpublic @interface CrossOrigin ä»å…ƒæ³¨è§£@Targetå¯ä»¥çœ‹å‡ºï¼Œæ³¨è§£å¯ä»¥æ”¾åœ¨methodã€classç­‰ä¸Šé¢ï¼Œç±»ä¼¼RequestMappingï¼Œä¹Ÿå°±æ˜¯è¯´ï¼Œæ•´ä¸ªcontrollerä¸‹é¢çš„æ–¹æ³•å¯ä»¥éƒ½å—æ§åˆ¶ï¼Œä¹Ÿå¯ä»¥å•ä¸ªæ–¹æ³•å—æ§åˆ¶ã€‚ ä¹Ÿå¯ä»¥å¾—çŸ¥ï¼Œè¿™ä¸ªæ˜¯æœ€å°ç²’åº¦çš„corsæ§åˆ¶åŠæ³•äº†ï¼Œç²¾ç¡®åˆ°å•ä¸ªè¯·æ±‚çº§åˆ«ã€‚ ä»¥ä¸Šä¸‰ç§æ–¹æ³•éƒ½å¯ä»¥è§£å†³é—®é¢˜ï¼Œæœ€å¸¸ç”¨çš„åº”è¯¥æ˜¯ç¬¬ä¸€ç§ã€ç¬¬äºŒç§ï¼Œæ§åˆ¶åœ¨è‡ªå®¶å‡ ä¸ªåŸŸåèŒƒå›´ä¸‹è¶³ä»¥ï¼Œä¸€èˆ¬æ²¡å¿…è¦æå¾—å¤ªç»†ã€‚ è¿™ä¸‰ç§é…ç½®æ–¹å¼éƒ½ç”¨äº†çš„è¯ï¼Œè°ç”Ÿæ•ˆå‘¢ï¼Œç±»ä¼¼cssä¸­æ ·å¼ï¼Œå°±è¿‘åŸåˆ™ï¼Œæ‡‚äº†å§ã€‚","tags":["åŸºç¡€","è·¨åŸŸæ”¯æŒ"],"categories":["åŸºç¡€ç¬”è®°"]},{"title":"2025.7.9å­¦ä¹ æ—¥è®°","path":"/2025/07/09/å­¦ä¹ æ—¥è®°25å¹´7æœˆ/2025.7.9å­¦ä¹ ç¬”è®°/","content":"ä»Šæ—¥å­¦ä¹ å†…å®¹3DGSåŠ›æ‰£æ¯æ—¥ä¸€é¢˜:ä»Šå¤©çš„æ¯æ—¥æ˜¯ä¸€ä¸ªæœ€å¤§ç§»åŠ¨kæ¬¡ä¼šè®®,ä½¿å¾—æœ€å¤§è¿ç»­ç©ºé—²æ—¶é—´æœ€é•¿.æŠ½è±¡æˆåŠŸ,å’Œçµç¥çš„é¢˜è§£åšçš„ä¸€æ ·.è½¬æ¢æˆäº†å¯¹n+1ä¸ªç©ºé—²æ—¶é—´åŒºé—´æ»‘çª—æ±‚å®šé•¿æ»‘çª—çš„æœ€å¤§å’Œ. ä»£ç éšæƒ³å½•é¡¹ç›®ç›¸å…³å®ç°æ³¨å†Œæ¥å£ ç”Ÿæ´»æ™šä¸Šå¥èº«ç»ƒçš„èƒ¸ ä¸‰å¤´ æ ¸å¿ƒ ,å¼ºåº¦é€‚ä¸­.","tags":["æ—¥è®°","leetcode","é¡¹ç›®"],"categories":["å­¦ä¹ æ—¥è®°","2025-07"]},{"title":"2025.7.8å­¦ä¹ æ—¥è®°","path":"/2025/07/08/å­¦ä¹ æ—¥è®°25å¹´7æœˆ/2025.7.8å­¦ä¹ ç¬”è®°/","content":"ä»Šæ—¥å­¦ä¹ å†…å®¹3DGSåŠ›æ‰£æ¯æ—¥ä¸€é¢˜:ä¸€ä¸ªdpï¼‹äºŒåˆ†çš„å›°éš¾é¢˜. ä»£ç éšæƒ³å½•åšäº†ä¸€ä¸ªNçš‡å. é¡¹ç›®ç›¸å…³çœ‹äº†ä¸¤ç¯‡é¡¹ç›®åšå®¢,ç„¶åå‡†å¤‡æ˜å¤©å¼€å§‹å†™æ—¥å¿—è¿‡æ»¤å™¨å’Œç”¨æˆ·åå¯†ç ç™»å½•æ¥å£. ç”Ÿæ´»æ—©ä¸Šè¸¢çƒé¢ çƒ é•¿ä¼  çŸ­ä¼  æ™šä¸Šå¥èº«ç»ƒçš„èƒŒ äºŒå¤´ æ ¸å¿ƒ,å¼ºåº¦åå¤§.æ‹‰ä¼¸è…¿éƒ¨ä¸ºä¸».","tags":["æ—¥è®°","leetcode","é¡¹ç›®"],"categories":["å­¦ä¹ æ—¥è®°","2025-07"]},{"title":"2025.7.7å­¦ä¹ æ—¥è®°","path":"/2025/07/07/å­¦ä¹ æ—¥è®°25å¹´7æœˆ/2025.7.7å­¦ä¹ ç¬”è®°/","content":"ä»Šæ—¥å­¦ä¹ å†…å®¹3DGSéƒ¨ç½²CityGaussian,å­¦ä¹ äº†ä¸€ä¸‹CityGaussianè®ºæ–‡,è¿™ç¯‡æ–‡ç« é€šè¿‡ä¼˜åŒ–åŸç‰ˆ3DGSå¯†åº¦æ§åˆ¶æ¨¡å—,é˜²æ­¢è®­ç»ƒæ—¶é«˜æ–¯æ•°é‡çˆ†ç‚¸æ€§å¢é•¿,å°†åŸç‰ˆ3DGSå­˜å‚¨å‹ç¼©10å€ï¼Œè®­ç»ƒé€Ÿåº¦æå‡25%ï¼Œå†…å­˜å‡åŠ,æ¸²æŸ“æ•ˆæœå’ŒåŸç‰ˆæ¥è¿‘. é¡¹ç›®å†æ¬¡æ¢³ç†äº†å…¨å±€è§†å›¾çš„æ¡†æ¶.æ˜å¤©å‡†å¤‡å®ç°éªŒæƒå’Œç™»å½•ç›¸å…³çš„åŠŸèƒ½. åŠ›æ‰£æ¯æ—¥ä¸€é¢˜:ä»Šå¤©çš„æ¯æ—¥æ˜¯ä¸€ä¸ªè´ªå¿ƒåŠ ä¼˜å…ˆé˜Ÿåˆ—çš„æ–¹æ³•. ä»£ç éšæƒ³å½•ä¸‰é“é¢˜ ç”Ÿæ´»å¥èº«ä¸»è¦ç»ƒèƒ¸ è‚© ä¸‰å¤´ ,å¼ºåº¦åå¤§","tags":["æ—¥è®°","leetcode","é¡¹ç›®"],"categories":["å­¦ä¹ æ—¥è®°","2025-07"]},{"title":"2025.7.5å­¦ä¹ æ—¥è®°","path":"/2025/07/05/å­¦ä¹ æ—¥è®°25å¹´7æœˆ/2025.7.5å­¦ä¹ ç¬”è®°/","content":"ä»Šæ—¥å­¦ä¹ å†…å®¹3DGSDifix3Dæ–¹æ³•ç›¸å½“äºåœ¨3DGSæ¸²æŸ“è„šæœ¬render.pyæ‰§è¡Œè·å¾—2Dæ¸²æŸ“å›¾åƒå,å†å¯¹2Dæ¸²æŸ“å›¾åƒä½¿ç”¨å•æ­¥æ‰©æ•£æ¨¡å‹,å¯¹2Dæ¸²æŸ“å›¾è¿›è¡Œå¤„ç†.æ‰€ä»¥è¿™ç§æ–¹å¼æ— æ³•åšåˆ°åƒåŸç‰ˆ3DGSä¸€æ ·å¯¹3Dæ¨¡å‹çš„å®æ—¶æ¸²æŸ“.å› ä¸ºå…¶æœ¬è´¨æ˜¯å¯¹2Då›¾åƒè¿›è¡Œå»å™ª,è€Œä¸æ˜¯å¯¹3Dç©ºé—´ä¸­ç¦»æ•£çš„é«˜æ–¯çƒè¿›è¡Œå‰”é™¤.è€Œ3DGSå®æ—¶æ¸²æŸ“çš„åŸºç¡€å°±æ˜¯render.pyçš„å¿«é€Ÿæ¸²æŸ“. é¡¹ç›®åŠ›æ‰£æ¯æ—¥ä¸€é¢˜:ç®€å•é¢˜,éå†æ±‚å‡ºç°æ¬¡æ•°å³å¯.","tags":["æ—¥è®°","leetcode","é¡¹ç›®"],"categories":["å­¦ä¹ æ—¥è®°","2025-07"]},{"title":"2025.7.4å­¦ä¹ æ—¥è®°","path":"/2025/07/04/å­¦ä¹ æ—¥è®°25å¹´7æœˆ/2025.7.4å­¦ä¹ ç¬”è®°/","content":"ä»Šæ—¥å­¦ä¹ å†…å®¹3DGSçœ‹äº†difix3Dè®ºæ–‡,ç›¸å½“äºåŠ äº†ä¸€ä¸ªå•æ­¥æ‰©æ•£æ¨¡å‹. é¡¹ç›®æŠŠå…¨å±€é…ç½®æ˜¾ç¤ºæ‹¦æˆªå™¨å®ç°äº†,ç›®å‰é¡¹ç›®å¯ä»¥æ­£å¸¸æ˜¾ç¤ºä¸»é¡µä¿¡æ¯.å®ç°ä¸»é¡µæ˜¾ç¤ºçš„è¿‡ç¨‹åŸºæœ¬ä¸ŠæŠŠé¡¹ç›®æ¡†æ¶ç»™æ­å®Œäº†. åŠ›æ‰£æ¯æ—¥ä¸€é¢˜:æ˜¨å¤©æ¯æ—¥çš„å›°éš¾ç‰ˆæœ¬. é¡¹ç›®","tags":["æ—¥è®°","leetcode","é¡¹ç›®"],"categories":["å­¦ä¹ æ—¥è®°","2025-07"]},{"title":"2025.7.3å­¦ä¹ æ—¥è®°","path":"/2025/07/03/å­¦ä¹ æ—¥è®°25å¹´7æœˆ/2025.7.3å­¦ä¹ ç¬”è®°/","content":"ä»Šæ—¥å­¦ä¹ å†…å®¹3DGSçœ‹äº†difix3Dè®ºæ–‡,ç›¸å½“äºåŠ äº†ä¸€ä¸ªå•æ­¥æ‰©æ•£æ¨¡å‹. é¡¹ç›®åšäº†ä¸€å¤©çš„é¡¹ç›®,å®Œå–„ä¸»é¡µçš„è¿‡ç¨‹åŸºæœ¬æŠŠå¤§éƒ¨åˆ†çš„æ¥å£éƒ½å®ç°äº†. åŠ›æ‰£æ¯æ—¥ä¸€é¢˜:äºŒè¿›åˆ¶æœ‰å…³çš„. é¡¹ç›®","tags":["æ—¥è®°","leetcode","é¡¹ç›®"],"categories":["å­¦ä¹ æ—¥è®°","2025-07"]},{"title":"2025.7.1å­¦ä¹ æ—¥è®°","path":"/2025/07/01/å­¦ä¹ æ—¥è®°25å¹´7æœˆ/2025.7.1å­¦ä¹ ç¬”è®°/","content":"ä»Šæ—¥å­¦ä¹ å†…å®¹3DGSéƒ¨ç½²CF-3DGSé¡¹ç›®,é˜…è¯»è®ºæ–‡.è¿™ç¯‡è®ºæ–‡é€šè¿‡â€‹â€‹å±€éƒ¨-å…¨å±€è”åˆä¼˜åŒ–â€‹â€‹ç›´æ¥ä¼°è®¡ç›¸æœºä½å§¿ï¼Œçœå»SfMé¢„å¤„ç†æ­¥éª¤,å…·ä½“æ•ˆæœéœ€è¦å®éªŒéªŒè¯.éƒ¨ç½²ç¯å¢ƒè¿‡ç¨‹é‡åˆ°ä¸€äº›ä¾èµ–é—®é¢˜. åŠ›æ‰£æ¯æ—¥ä¸€é¢˜:ä»Šå¤©çš„æ¯æ—¥ä¸€ä¸ªç®€å•çš„éå†å³å¯åšå‡º. é¡¹ç›®åšäº†åŠå¤©ä¹‹åè§‰å¾—vue3å¹¶ä¸é€‚åˆè¿™ä¸ªåšå®¢é¡¹ç›®,æ‰€ä»¥åˆæ¢å›åˆ°äº†Thymeleafä½œä¸ºå‰ç«¯çš„æ–¹æ¡ˆ.ä½†æ˜¯å¯¹äºé¡¹ç›®çš„ç†è§£æˆ‘è§‰å¾—æ˜¯æœ‰éå¸¸å¤§çš„è¿›æ­¥çš„.ç›®å‰é‡æ–°åˆ›å»ºäº†ä¸€ä¸ªTechubé¡¹ç›®,ç„¶ååŸºæœ¬ç†è§£äº†Thymeleafçš„å‰ç«¯æ¡†æ¶.","tags":["æ—¥è®°","leetcode","é¡¹ç›®"],"categories":["å­¦ä¹ æ—¥è®°","2025-07"]},{"title":"2025.6.30å­¦ä¹ æ—¥è®°","path":"/2025/06/30/å­¦ä¹ æ—¥è®°25å¹´6æœˆ/2025.6.30å­¦ä¹ ç¬”è®°/","content":"ä»Šæ—¥å­¦ä¹ å†…å®¹3DGSå­¦ä¹ taming-gsè®ºæ–‡. åŠ›æ‰£æ¯æ—¥ä¸€é¢˜:æ¯æ—¥æ˜¯ä¸€ä¸ªç®€å•çš„å“ˆå¸Œé¢˜. é¡¹ç›®ä»Šå¤©å¼€å‘äº†ä¸€ä¸ªè¿”å›å…¨æ–‡åˆ†ç±»çš„æ¥å£.è™½ç„¶çœ‹èµ·æ¥åªå¼€å‘ä¸€ä¸ªæ¥å£,ä½†æ˜¯ä¿è¯å¼€å‘è§„èŒƒçš„è¯,å±äºç‰µä¸€å‘åŠ¨å…¨èº«çš„æ„Ÿè§‰,å†™ä¸€ä¸ªå†…å®¹éœ€è¦å†™å¥½å¯¹åº”çš„DO DTO,ç„¶åæœ€å¥½æŠŠæ‰€æœ‰çš„å¸¸é‡ä¹‹ç±»çš„å†™æˆæ›´åŠ ç›´è§‚åœ°æšä¸¾ç±». ä¸ªäººåšå®¢æ™šä¸ŠæŠŠä¸ªäººåšå®¢çš„åˆ†ç±»å’Œä¸“æ åŠŸèƒ½åŠ è¿›å»äº†,è¿™å›çœ‹èµ·æ¥ä½œç”¨éå¸¸å®Œå–„. æ•´ç†ç®—æ³•ç¬”è®°æŠŠåˆ·é¢˜ç®—æ³•ç¬”è®°é‡æ–°é‡æ„äº†ä¸€ä¸‹,ä¿ç•™é‡è¦çš„æ ‡é¢˜. ç”Ÿæ´»è®°å½•æ™šä¸Šå¥èº«ä»Šå¤©ç»ƒçš„èƒ¸ è‚© æ ¸å¿ƒ ,å¼ºåº¦é€‚ä¸­.","tags":["3DGS","æ—¥è®°","leetcode","é¡¹ç›®","åšå®¢"],"categories":["å­¦ä¹ æ—¥è®°","2025-06"]},{"title":"2025.6.29å­¦ä¹ æ—¥è®°","path":"/2025/06/29/å­¦ä¹ æ—¥è®°25å¹´6æœˆ/2025.6.29å­¦ä¹ ç¬”è®°/","content":"åŠ›æ‰£æ¯æ—¥ä¸€é¢˜:ä»Šå¤©çš„æ¯æ—¥ä¸€ä¸ªæ»‘çª—,è¿˜æ˜¯æ¯”è¾ƒå¥½æƒ³çš„. åŠ›æ‰£å‘¨èµ›å…¨å›æ¥äº†,è¿™å‘¨å‘¨èµ›åšäº†ä¸‰é“é¢˜,è€Œä¸”ç¬¬ä¸‰é“æ˜¯æœ€è¿‘ç»ƒçš„å›æº¯,è™½ç„¶è¶…æ—¶äº†,dfsæ”¹å†™æˆdpå°±è¿‡äº†. ç”Ÿæ´»è®°å½•æ—©ä¸Šè¸¢çƒmd,æˆ‘çš„çƒè¸¢è‰ä¸›é‡Œäº†.","tags":["æ—¥è®°","leetcode"],"categories":["å­¦ä¹ æ—¥è®°","2025-06"]},{"title":"2025.6.28å­¦ä¹ æ—¥è®°","path":"/2025/06/28/å­¦ä¹ æ—¥è®°25å¹´6æœˆ/2025.6.28å­¦ä¹ ç¬”è®°/","content":"ä»Šæ—¥å­¦ä¹ å†…å®¹3DGSå¯¹è®­ç»ƒçš„æ¨¡å‹è¿›è¡Œäº†æ±‡æ€»ã€‚dashæ–¹æ³•çš„è®­ç»ƒé€Ÿåº¦æ˜¯æœ€å¿«çš„ï¼ŒåŒæ—¶æ¸²æŸ“è´¨é‡å’ŒåŸç‰ˆæ¯”ç•¥æœ‰æå‡ï¼›mipæ–¹æ³•æ¸²æŸ“è´¨é‡å¾—åˆ†æœ€é«˜ï¼Œä½†å…¶å—è§†è§’å±€é™æ€§å½±å“æœ€ä¸¥é‡ï¼Œæ¸²æŸ“è§†è§’å’Œè¾“å…¥è§†è§’å·®çš„ç¨å¾®å¤šä¸€äº›å°±ä¼šçœ‹åˆ°ç©ºé—´ä¸­å¾ˆå¤šä¸¥é‡çš„é¬¼å½±ã€‚ åŠ›æ‰£æ¯æ—¥ä¸€é¢˜:springç¯‡springç¯‡å­¦ä¹ å®Œä¸€é,è®°äº†ä¸€ç¯‡ç¬”è®°. é¡¹ç›®è¢«ä¾èµ–é¡¹æäº†ä¸€ä¸‹åˆ,å‘ç°é…ç½®å­æ¨¡å—åå¹¶ä¸ä¼šè‡ªå·±æ‰«æå­æ¨¡å—çš„åŒ…,éœ€è¦å…ˆé…ç½®ä¸€ä¸ªAutoConfigç±»,ç„¶åé€šè¿‡é…ç½®AutoConfigé…ç½®å­æ¨¡å—çš„åŒ…è·¯å¾„,æ‰èƒ½è¢«æ‰«æåˆ°.ä¸è¿‡è¿˜æ˜¯æ„Ÿè§‰ä¸ä»0å¼€å§‹,è¿™äº›é—®é¢˜éƒ½ä¸ä¼šé‡åˆ°,è¿˜æ˜¯æœ‰ç”¨çš„,å°è±¡éå¸¸æ·±åˆ». Unityå¼€å‘å¯¹å¸¦çƒçš„bugè¿›ä¸€æ­¥ä¼˜åŒ–. æ™šä¸Šå­¦ä»£ç éšæƒ³å½•ç”Ÿæ´»è®°å½•steamå¤ä¿ƒä¹°äº†ä¸€å †æ¸¸æˆ","tags":["3DGS","spring","æ—¥è®°","leetcode","é¡¹ç›®","æ¸¸æˆå¼€å‘"],"categories":["å­¦ä¹ æ—¥è®°","2025-06"]},{"title":"2025.6.27å­¦ä¹ æ—¥è®°","path":"/2025/06/27/å­¦ä¹ æ—¥è®°25å¹´6æœˆ/2025.6.27å­¦ä¹ ç¬”è®°/","content":"ä»Šæ—¥å­¦ä¹ å†…å®¹3DGSå¯¹è®­ç»ƒçš„æ¨¡å‹è¿›è¡Œäº†æ±‡æ€»ã€‚dashæ–¹æ³•çš„è®­ç»ƒé€Ÿåº¦æ˜¯æœ€å¿«çš„ï¼ŒåŒæ—¶æ¸²æŸ“è´¨é‡å’ŒåŸç‰ˆæ¯”ç•¥æœ‰æå‡ï¼›mipæ–¹æ³•æ¸²æŸ“è´¨é‡å¾—åˆ†æœ€é«˜ï¼Œä½†å…¶å—è§†è§’å±€é™æ€§å½±å“æœ€ä¸¥é‡ï¼Œæ¸²æŸ“è§†è§’å’Œè¾“å…¥è§†è§’å·®çš„ç¨å¾®å¤šä¸€äº›å°±ä¼šçœ‹åˆ°ç©ºé—´ä¸­å¾ˆå¤šä¸¥é‡çš„é¬¼å½±ã€‚ åŠ›æ‰£æ¯æ—¥ä¸€é¢˜:é¡¹ç›®æ·»åŠ äº†è‡ªåŠ¨åˆå§‹åŒ–æ•°æ®åº“æ¨¡å—,ä½¿ç”¨liquibaseæ¥ç®¡ç†æ•°æ®åº“sqlçš„å˜æ›´,å¹¶ä¸”åœ¨ä¸å¼€å¯liquibaseçš„æƒ…å†µä¹Ÿåšäº†è€ƒè™‘.æ„Ÿè§‰è¿˜æ˜¯ä»é¡¹ç›®é‡Œé¢å­¦æ¯”è¾ƒæ·±åˆ»,å…‰çœ‹æ–‡æ¡£è®°ä¸ä½. Unityå¼€å‘æŠŠå¸¦çƒçš„é€»è¾‘é‡æ„äº†,é€šè¿‡åˆ‡æ¢å¸¦çƒäººçš„å›¾å±‚æ¥å®ç°å¸¦çƒ,å…ˆåœ¨çœ‹èµ·æ¥éå¸¸å®Œç¾,ç„¶åæŠŠä¹‹å‰çš„è¸¢çƒé€»è¾‘ä¹ŸåŠ ä¸Šäº†,çœ‹èµ·æ¥å¾ˆä¸é”™. æ™šä¸Šå­¦ä»£ç éšæƒ³å½•åšäº†ä¸‰é“å›æº¯ ç”Ÿæ´»è®°å½•æ™šä¸Šå¥èº«ç»ƒçš„èƒŒ è‚©è†€ äºŒå¤´ ä¸‰å¤´ å¼ºåº¦æ¯”è¾ƒå¤§.","tags":["3DGS","æ—¥è®°","leetcode","é¡¹ç›®","æ¸¸æˆå¼€å‘"],"categories":["å­¦ä¹ æ—¥è®°","2025-06"]},{"title":"2025.6.26å­¦ä¹ æ—¥è®°","path":"/2025/06/26/å­¦ä¹ æ—¥è®°25å¹´6æœˆ/2025.6.26å­¦ä¹ ç¬”è®°/","content":"ä»Šæ—¥å­¦ä¹ å†…å®¹3DGSç®€å•è·‘è·‘ä»£ç ,æ–°éƒ¨ç½²äº†mip-gs åŠ›æ‰£æ¯æ—¥ä¸€é¢˜:ä»Šå¤©çš„æ¯æ—¥å’ŒäºŒè¿›åˆ¶æœ‰å…³çš„ä¸€ä¸ªè„‘ç­‹æ€¥è½¬å¼¯. Mysqlå­¦ä¹ 54 é¡¹ç›®æ•´ç†é¡¹ç›®ç»“æ„,åˆ›å»ºå­æ¨¡å—. Unityå¼€å‘æ—©ä¸ŠæŠŠçƒè·Ÿéšçš„é€»è¾‘é‡æ„äº†ä¸€ä¸‹,æ‰“ç®—çš„å®ç°æ–¹æ¡ˆæ˜¯é€šè¿‡åˆ‡æ¢å›¾å±‚,ä½¿å¾—å¸¦çƒçƒå‘˜å’Œçƒæ²¡æœ‰ç¢°æ’,ä½†æ˜¯èƒ½ä¿æŒçƒçš„ç‰©ç†. ç”Ÿæ´»è®°å½•æ™šä¸Šå›å­¦æ ¡èšé¤å’Œçƒé˜Ÿå“¥ä»¬åƒç«é”…ç©é˜¿ç“¦éš†.","tags":["3DGS","æ—¥è®°","leetcode","é¡¹ç›®","æ¸¸æˆå¼€å‘"],"categories":["å­¦ä¹ æ—¥è®°","2025-06"]},{"title":"2025.6.25å­¦ä¹ æ—¥è®°","path":"/2025/06/25/å­¦ä¹ æ—¥è®°25å¹´6æœˆ/2025.6.25å­¦ä¹ ç¬”è®°/","content":"ä»Šæ—¥å­¦ä¹ å†…å®¹3DGSç®€å•è·‘è·‘ä»£ç ,æ–°éƒ¨ç½²äº†mip-gs åŠ›æ‰£æ¯æ—¥ä¸€é¢˜:äºŒåˆ†åŠ äºŒåˆ†çš„å›°éš¾é¢˜.å·²ç»åˆ·äº†800é“é¢˜ç›®äº†. Mysqlå­¦ä¹ 52 - 54 é¡¹ç›®ä»Šå¤©å‡†å¤‡é‡æ–°å†™é¡¹ç›®TecHubä½œä¸ºæˆ‘çš„ä¸»åŠ›é¡¹ç›®. Unityå¼€å‘æ—©ä¸Šæ–°å»ºäº†ä¸€ä¸ªæ–°é¡¹ç›®ä¹‹å,è‡ªåŠ¨è¡¥å…¨å°±ç¥å¥‡çš„å¥½äº†,ä¼°è®¡æ˜¯æ–°å»ºé¡¹ç›®ä¹‹åè‡ªåŠ¨ä¸‹è½½äº†ä¾èµ–åŒ….æ™šä¸ŠæŠŠäººç‰©ç§»åŠ¨æ§åˆ¶é€»è¾‘é‡æ„äº†. æ™šä¸Šå­¦ä»£ç éšæƒ³å½•æ™šä¸Šåˆ·äº†ä¸¤é“å›æº¯é¢˜ ç”Ÿæ´»è®°å½•æ™šä¸Šå¥èº«ç»ƒçš„èƒ¸è‚© è†€å’ŒäºŒå¤´,å¼ºåº¦æ¯”è¾ƒé«˜.","tags":["3DGS","æ—¥è®°","leetcode","é¡¹ç›®","æ¸¸æˆå¼€å‘"],"categories":["å­¦ä¹ æ—¥è®°","2025-06"]},{"title":"TecHubé¡¹ç›®ç¬”è®°","path":"/2025/06/25/é¡¹ç›®ç¬”è®°/TecHubé¡¹ç›®ç¬”è®°/","content":"TecHubé¡¹ç›®ç¬”è®°å¤§æ¦‚ä¼šä»¥ä¸€ä¸ªæ—¶é—´çº¿çš„æ–¹å¼,ä»0å¼€å§‹æ­å»ºé¡¹ç›®. è´´ä¸€ä¸ªå¤åˆ¶ /** * @author JakicDong * @time 2025.6.25 * @description å¯åŠ¨ç±» * @version 1.0.0 */ é¡¹ç›®ä»‹ç»ä»¥Spring3æ¡†æ¶ä¸ºåŸºç¡€,VUE3ä½œä¸ºå‰ç«¯ é…ç½®æœ¬åœ°Gitä»“åº“å’ŒGitHubè¿œç¨‹ä»“åº“IDEAä¸­å»ºç«‹é¡¹ç›®æ ¹ç›®å½•æœ¬åœ°ä»“åº“,æ–‡ä»¶å˜çº¢è¯´æ˜é…ç½®æˆåŠŸ,ç„¶åæäº¤ä¸€æ¬¡.é…ç½®è¿œç¨‹ä»“åº“,å…ˆåœ¨IDEAä¸­ç™»å½•GitHubè´¦å·,ç„¶åGitHubå»ºç«‹è¿œç¨‹ä»“åº“ç„¶ååœ¨IDEAä¸­é…ç½®è¿œç¨‹ä»“åº“åœ°å€.git remote add origin git@github.com:xxx/xxx,git(originåé¢æ›¿æ¢æˆä½ åˆšå¤åˆ¶çš„ä¸œè¥¿) git push -u origin master (è§£é‡Š:è¯¥è„šæœ¬å°†æœ¬åœ°çš„master æ¨åˆ°åˆšæ‰è®¾ç½®çš„githubè¿œç¨‹ä»“åº“ä¸­)å¦‚æœæ²¡æœ‰é…è¿‡å…¬é’¥çš„è¯å¯èƒ½ä¼šæŠ¥é”™,é…ç½®ä¸€ä¸ªå…¬é’¥å³å¯.ç„¶åå°±å¯ä»¥æ„‰å¿«çš„è¿›è¡Œè¿œç¨‹ç‰ˆæœ¬æ§åˆ¶äº†. å­æ¨¡å—åˆ›å»ºéœ€è¦æ³¨æ„å­æ¨¡å—å’Œçˆ¶æ¨¡å—pomæ–‡ä»¶çš„æ ¼å¼.å­æ¨¡å—: parent groupIdcom.github.JakicDong.TecHub/groupId artifactIdTecHub/artifactId version1.0-SNAPSHOT/version/parent çˆ¶æ¨¡å— parent groupIdorg.springframework.boot/groupId artifactIdspring-boot-starter-parent/artifactId version3.0.9/version relativePath/ !-- lookup parent from repository --/parent è¿™ä¸ªé¡¹ç›®ç”¨çš„å°±æ˜¯spring3,æ‰€ä»¥çˆ¶æ¨¡å—ç»§æ‰¿ä¸€ä¸ªspring3çš„æ¡†æ¶. å…¥å£ @SpringBootApplicationpublic class TecHubApplication { è¿™æ˜¯ä¸€ä¸ªå…¥å£ç±» å†æ¬¡æµ‹è¯•} å¯¼å…¥äº†ä¾èµ–é¡¹ è¿›åº¦å°†é¡¹ç›®ç»“æ„è¿›è¡Œå®Œæ•´çš„æ¢³ç†è‡ªåŠ¨åŠ è½½åˆå§‹åŒ–comgithubJakicDongTecHubconfiginitForumDataSourceInitializer.java è¿™ä¸€éƒ¨åˆ†åŒ…æ‹¬å¾ˆå¤šçš„çŸ¥è¯†ç‚¹,liquibaseæ¥ç®¡ç†æ›´æ”¹sql,xmlè§£æ,jdbcè¿æ¥æ•°æ®åº“ç­‰ç­‰,ç„¶åå®ç°äº†ä¸€ä¸ªåœ¨æ²¡æœ‰liquibaseçš„æƒ…å†µä¸‹çš„ä¸€ä¸ªåˆå§‹åŒ–å™¨. å®ç°äº†åˆ†ç±»æ¥å£çš„liståŠŸèƒ½å®ç°ç”¨æˆ·åå¯†ç ç™»å½•æ–¹å¼å®ç°Reqinfoå…¨å±€æ‹¦æˆªå™¨HTTP Request â†“Filter#doFilter() â†“â”€â”€â†’ Interceptor#preHandle() â†“Controller Method â†“Interceptor#postHandle() â†“Filter#doFilter()å‰©ä½™ä»£ç  å…¨å±€å¼‚å¸¸å¤„ç†ForumExceptionHandleré€šè¿‡å®ç°ExceptionHandleræ¥å£,å®ç°å¼‚å¸¸å¤„ç†. ä½†æ˜¯æ³¨æ„,è¿™ä¸ªå¼‚å¸¸å¤„ç†åªä¼šå¤„ç†æ¥å£ä¸­æŠ›å‡ºçš„å¼‚å¸¸,ä¸ä¼šå¤„ç†æ²¡æœ‰æ¥å£å¤„ç†çš„è¯·æ±‚.","tags":["é¡¹ç›®","TecHub"],"categories":["é¡¹ç›®ç¬”è®°"]},{"title":"2025.6.24å­¦ä¹ æ—¥è®°","path":"/2025/06/24/å­¦ä¹ æ—¥è®°25å¹´6æœˆ/2025.6.24å­¦ä¹ ç¬”è®°/","content":"ä»Šæ—¥å­¦ä¹ å†…å®¹3DGSå®éªŒå®¤æ±‡æŠ¥,åšæ±‡æŠ¥PPT. ä¸‹è½½mip-splattingå·¥ç¨‹,è¯¥é¡¹ç›®å¼•å…¥äº†3Då¹³æ»‘æ»¤æ³¢å™¨å’ŒäºŒç»´Mipæ»¤æ³¢å™¨,é€šè¿‡é™åˆ¶3Dè¡¨ç¤ºçš„é¢‘ç‡æ¥æ¶ˆé™¤é«˜é¢‘ä¼ªå½±,äºŒä½Mipæ»¤æ³¢å™¨é€šè¿‡æ¨¡æ‹Ÿç‰©ç†æˆåƒè¿‡ç¨‹çš„ç›’å¼æ»¤æ³¢å™¨æ¥ç¼“è§£æ··å æ•ˆåº”å’Œæ‹“å±•é—®é¢˜.ä½¿å¾—Mip-splattingå¯ä»¥åœ¨å„ç§é‡‡æ ·é¢‘ç‡ä¸‹å®ç°æ— ä¼ªå½±çš„æ¸²æŸ“. åŠ›æ‰£æ¯æ—¥ä¸€é¢˜:ä¸€ä¸ªç®€å•æ»‘çª—é—®é¢˜. Mysqlå­¦ä¹ 48 - 52ç´¢å¼•ç¯‡å­¦ä¹ å®Œæ¯• Springå­¦ä¹ 22 - 30 ä»Šå¤©å®éªŒå®¤æ±‡æŠ¥é¡¹ç›®å®‰è£…VUE3æ¡†æ¶sudo npm install webpack -gsudo npm install -g @vue/clivue ui å¯ä»¥çœ‹åˆ°VUEçš„uiç•Œé¢ è£…äº†spring3æ¡†æ¶çš„paicoding. Unityæ—¶éš”å…­ä¸ªæœˆ,æŠŠæˆ‘ä¹‹å‰åšçš„2Dè¶³çƒæ¸¸æˆdemoéƒ¨ç½²åœ¨macä¸Šäº†,ç»§ç»­å¼€å‘. æ™šä¸Šå­¦ä»£ç éšæƒ³å½•é‡æ–°æ•´ç†ä¸€ä¸‹ç®—æ³•ç¬”è®°. ç”Ÿæ´»è®°å½•æ™šä¸Šå¥èº«ç»ƒçš„èƒŒå’Œä¸‰å¤´,å¼ºåº¦æ¯”è¾ƒä½.","tags":["3DGS","spring","æ—¥è®°","leetcode","é¡¹ç›®","æ¸¸æˆå¼€å‘"],"categories":["å­¦ä¹ æ—¥è®°","2025-06"]},{"title":"Unityæ¸¸æˆå¼€å‘ç¬”è®°","path":"/2025/06/24/æ¸¸æˆå¼€å‘/Unituå¼€å‘ç¬”è®°/","content":"æ ¸å¿ƒç»„ä»¶åœ¨Unityä¸­ï¼Œæ ¸å¿ƒç»„ä»¶ä¹‹é—´çš„å…³ç³»å’Œè®¿é—®æ–¹å¼å¯ä»¥è¿™æ ·æ¢³ç†ï¼š åŸºç¡€ç»„ä»¶å…³ç³»å›¾ GameObject (æ¸¸æˆå¯¹è±¡)â”‚â”œâ”€â”€ Transform (å˜æ¢ç»„ä»¶) - æ§åˆ¶ä½ç½®æ—‹è½¬ç¼©æ”¾â”œâ”€â”€ Collider2D (ç¢°æ’ä½“) - ç‰©ç†äº¤äº’åŸºç¡€â”œâ”€â”€ Rigidbody2D (åˆšä½“) - ç‰©ç†æ¨¡æ‹Ÿâ””â”€â”€ MonoBehaviour (è„šæœ¬) - è‡ªå®šä¹‰é€»è¾‘ å…³é”®ç»„ä»¶è®¿é—®æ–¹å¼ (1) Transform // è·å–è‡ªèº«TransformTransform selfTF = GetComponentTransform(); // è®¿é—®å±æ€§Vector3 position = selfTF.position;Quaternion rotation = selfTF.rotation;Vector3 scale = selfTF.localScale;// ä¿®æ”¹å±æ€§selfTF.position = new Vector3(1, 0, 0);selfTF.Rotate(0, 90, 0); (2) GameObject // è·å–å½“å‰å¯¹è±¡GameObject selfGO = gameObject; // é€šè¿‡åç§°æŸ¥æ‰¾å­å¯¹è±¡Transform childTF = transform.Find(foot);// æ¿€æ´»çŠ¶æ€æ§åˆ¶gameObject.SetActive(false); (3) Collider2D Apply// è·å–ç¢°æ’ä½“Collider2D collider = GetComponentCollider2D();// å¯ç”¨/ç¦ç”¨collider.enabled = false;// è§¦å‘æ£€æµ‹ (éœ€æŒ‚è½½è„šæœ¬)void OnTriggerEnter2D(Collider2D other) if(other.CompareTag(Player)) ... ç»„ä»¶é—´ç›¸äº’è°ƒç”¨æ–¹å¼1ï¼šç›´æ¥è·å–ç»„ä»¶ Apply// è·å–åŒä¸€ç‰©ä½“ä¸Šçš„ç»„ä»¶Rigidbody2D rb = GetComponentRigidbody2D();// è·å–å…¶ä»–ç‰©ä½“çš„ç»„ä»¶ï¼ˆéœ€å…ˆè·å–GameObjectï¼‰GameObject player = GameObject.Find(Player);charactor_move_v script = player.GetComponentcharactor_move_v(); æ–¹å¼2ï¼šé€šè¿‡å…¬å¼€å¼•ç”¨ Apply// åœ¨Inspectoré¢æ¿æ‹–æ‹½èµ‹å€¼public Transform targetTF;void Start() Vector3 pos = targetTF.position; æ–¹å¼3ï¼šçˆ¶å­å±‚çº§è®¿é—® // è·å–çˆ¶å¯¹è±¡Transform parent = transform.parent;// è·å–å­å¯¹è±¡Transform child = transform.GetChild(0); ä½ çš„ä»£ç ä¸­çš„å…¸å‹è°ƒç”¨æ¡ˆä¾‹ Apply// è·å–Rigidbody2Dç»„ä»¶ï¼ˆç‰©ç†æ¨¡æ‹Ÿï¼‰private Rigidbody2D rb;void Start() rb = GetComponentRigidbody2D();// é€šè¿‡æ ‡ç­¾æŸ¥æ‰¾å¯¹è±¡if(other.CompareTag(FollowBox)) ...// è®¿é—®å…¶ä»–è„šæœ¬å±æ€§float power = currentPlayer.GetComponentcharactor_move_v().kick_power;// ä¿®æ”¹ç¢°æ’ä½“çŠ¶æ€playerCollider.enabled = false; æœ€ä½³å®è·µå»ºè®®ç¼“å­˜å¼•ç”¨ï¼šåœ¨Start()ä¸­è·å–å¸¸ç”¨ç»„ä»¶ï¼Œé¿å…é‡å¤è°ƒç”¨GetComponentåˆ†å±‚æŸ¥æ‰¾ï¼šä½¿ç”¨transform.Find(â€œè·¯å¾„å­å¯¹è±¡â€)æŒ‰è·¯å¾„æŸ¥æ‰¾ç©ºå€¼æ£€æŸ¥ï¼šå¯¹GetComponentç»“æœåšnullæ£€æŸ¥æ€§èƒ½ä¼˜åŒ–ï¼šé¿å…åœ¨Updateä¸­é¢‘ç¹æŸ¥æ‰¾å¯¹è±¡è¿™ç§ç»„ä»¶ç³»ç»Ÿæ„æˆäº†Unityçš„â€ç»„åˆä¼˜äºç»§æ‰¿â€æ¶æ„ï¼Œé€šè¿‡çµæ´»çš„ç»„åˆå®ç°å¤æ‚æ¸¸æˆé€»è¾‘ã€‚ å¤šç‰ˆæœ¬.NETåˆ‡æ¢dotnet â€“list-sdks æŸ¥çœ‹å·²å®‰è£…çš„.NETç‰ˆæœ¬","tags":["æ¸¸æˆå¼€å‘"],"categories":["æ¸¸æˆå¼€å‘"]},{"title":"æ¸¸æˆå¼€å‘-2Dè¶³çƒDemo","path":"/2025/06/24/æ¸¸æˆå¼€å‘/æ¸¸æˆå¼€å‘-2Dè¶³çƒDemo/","content":"æ¸¸æˆä»‹ç»2Dè¶³çƒDemo(todo:æƒ³ä¸ªå¥½åå­—),æ˜¯ä¸€ä¸ªåŸºäºUnityçš„2.5Dæ¨ªç‰ˆè¶³çƒæ¸¸æˆ.ç©å®¶æ“çºµè§’è‰²åœ¨çƒåœºä¸Šå’ŒAIè¿›è¡Œå¯¹æˆ˜. æ ¸å¿ƒç©æ³•çˆ½æ„Ÿåè¶³çš„å°„é—¨,å’Œå®ˆé—¨å‘˜çš„åšå¼ˆ.è¿›æ”»æ—¶,é€‰æ‹©è¿œå°„æˆ–è¿‡äººæˆ–è€…ä¼ çƒç»™é˜Ÿå‹;é˜²å®ˆæ—¶,é€‰æ‹©ä¿å®ˆçš„é˜²å®ˆè¿˜æ˜¯å¤§èƒ†æ–­çƒ. ç”»é£åå‘åƒç´ é£æ ¼. TODO LISTä¼˜å…ˆçº§ 1 åˆ° 10 ,è¶Šå°ä¼˜å…ˆçº§è¶Šé«˜ 3 ä¼˜åŒ–å°„é—¨BUG3 ä¼˜åŒ–å®ˆé—¨å‘˜é€»è¾‘3 è®¾è®¡å¯¹æ‰‹çƒå‘˜çŠ¶æ€æœº3 ä¼˜åŒ–ç¢°æ’ç®±5 æ·»åŠ æ›´å¤šæ ·å¼çš„è§’è‰²ç¾æœ¯ç±» 9 å®ç°è§’è‰²æ¢è£…åŠŸèƒ½5 æ·»åŠ ç•Œé¢5 æ·»åŠ UI6 éŸ³ä¹è®¾è®¡ä¸€äº›éŸ³ä¹ å®Œæˆæ¸…å•é‡æ„è§’è‰²ç§»åŠ¨é€»è¾‘1 ä¼˜åŒ–å¸¦çƒé€»è¾‘ç°åœ¨çš„å¸¦çƒé€»è¾‘å¾ˆåˆç†","tags":["æ¸¸æˆå¼€å‘","2Dè¶³çƒDemo"],"categories":["æ¸¸æˆå¼€å‘"]},{"title":"æŠ€æœ¯æ´¾é¡¹ç›®ç¯å¢ƒé—®é¢˜","path":"/2025/06/24/é¡¹ç›®ç¬”è®°/æŠ€æœ¯æ´¾ç¯å¢ƒé—®é¢˜/","content":"é‡æ„æˆspring3 æ”¯æŒjdk17 Macçš„jdkå¤šç‰ˆæœ¬åˆ‡æ¢cd LibraryJavaJavaVirtualMachinesls -al æŸ¥çœ‹ä¸€ä¸‹éƒ½æœ‰å“ªäº›ç‰ˆæœ¬çš„jdk # è¾“å…¥cd ~# æ‰“å¼€ç¯å¢ƒå˜é‡é…ç½®æ–‡ä»¶code .bash_profile# æŠ¥é”™ï¼š.bash_profile does not exist.# ç¬¬ä¸€æ¬¡é…ç½®ç¯å¢ƒå˜é‡ï¼Œå…ˆåˆ›å»ºæ–‡ä»¶touch .bash_profile# å†æ¬¡æ‰§è¡Œæ‰“å¼€ç¯å¢ƒå˜é‡é…ç½®æ–‡ä»¶code .bash_profile # å¤åˆ¶å¦‚ä¸‹å†…å®¹ç²˜è´´åˆ°.bash_profileä¸­ï¼Œ# å› ä¸ºæˆ‘æ˜¯å®‰è£…äº†ä¸‰ä¸ªï¼Œæ‰€ä»¥é…ç½®äº†ä¸‰ä¸ªç‰ˆæœ¬# ä½ è‡ªå·±æ˜¯å®‰è£…äº†å‡ ä¸ªç‰ˆæœ¬å°±é…ç½®å‡ ä¸ªexport JAVA_8_HOME=$(/usr/libexec/java_home -v1.8)export JAVA_11_HOME=$(/usr/libexec/java_home -v11)export JAVA_17_HOME=$(/usr/libexec/java_home -v17)alias java8=export JAVA_HOME=$JAVA_8_HOMEalias java11=export JAVA_HOME=$JAVA_11_HOMEalias java17=export JAVA_HOME=$JAVA_17_HOMEexport JAVA_HOME=$JAVA_11_HOME# è®°å¾—ä¿å­˜ï¼Œå¯ä»¥ç”¨å¿«æ·é”® cmd + s # é…ç½®æ–‡ä»¶ç«‹å³ç”Ÿæ•ˆsource .bash_profile# æŸ¥çœ‹ JAVA_HOME ç›®å½•echo $JAVA_HOME# æŸ¥çœ‹ JDK ç‰ˆæœ¬ä¿¡æ¯java -version #åˆ‡æ¢åˆ°JDK8ï¼šjava8 # æŸ¥çœ‹ JDK ç‰ˆæœ¬ä¿¡æ¯java -version#åˆ‡æ¢åˆ°JDK11ï¼šjava11# æŸ¥çœ‹ JDK ç‰ˆæœ¬ä¿¡æ¯java -version#åˆ‡æ¢åˆ°JDK17ï¼šjava17# æŸ¥çœ‹ JDK ç‰ˆæœ¬ä¿¡æ¯java -version æ›´æ”¹Mavenç‰ˆæœ¬è·¯å¾„ä½ç½®: /Users/mac/tools/apache-maven-3.8.9 sudo code ~/.bash_profile export MAVEN_HOMEâ€Usersmactoolsapache-maven-3.8.9â€export PATHâ€$MAVEN_HOMEbin:$PATHâ€ å®‰è£…å®Œmavenåæ›´æ”¹ä»“åº“é•œåƒåœ°å€å³å¯,æ›´æ”¹ä¸ºäº†é˜¿é‡Œäº‘ adminæ¨¡å—ç«¯å£é—®é¢˜paicoding-adminvite.config.tsä¿®æ”¹ä»£ç†ç«¯å£å³å¯","tags":["é¡¹ç›®","æŠ€æœ¯æ´¾"],"categories":["é¡¹ç›®ç¬”è®°"]},{"title":"2025.6.23å­¦ä¹ æ—¥è®°","path":"/2025/06/23/å­¦ä¹ æ—¥è®°25å¹´6æœˆ/2025.6.23å­¦ä¹ ç¬”è®°/","content":"ä»Šæ—¥å­¦ä¹ å†…å®¹æ‚è°ˆä¸Šå‘¨æœ«æ—¶éš”å¿«ä¸€å¹´é‡æ–°åšäº†ä¸€æ¬¡å‘¨èµ›,ç¬¬ä¸€é¢˜æ‰‹é€Ÿè¿˜æ˜¯å¯ä»¥çš„,ç¬¬äºŒé¢˜å’Œç¬¬ä¸‰é¢˜ä¸¤é“ä¸­ç­‰æœ‰ç‚¹åƒåŠ›,ç¬¬äºŒé¢˜æ˜¯å®Œå…¨èƒŒåŒ…ç›¸å…³çš„é¢˜ç›®,åŠ¨æ€è§„åˆ’é¢˜ç›®ä¸€ç›´æœ‰ç‚¹è‹¦æ‰‹,éœ€è¦ç‹ ç‹ åŠ å¼ºä¸€æ³¢.ç¬¬ä¸‰é¢˜å›¾è®ºè™½ç„¶æƒ³åˆ°äº†æ€è·¯,ä½†æ˜¯å›¾è®ºå…·ä½“ç»†èŠ‚æ²¡å®ç°å®Œå…¨,åšçš„å¤ªå°‘äº†.æ„Ÿè§‰ç®—æ³•é‡åˆ°ç“¶é¢ˆäº†,ä½åˆ†é¢˜åŸºæœ¬å¯ä»¥åšå‡ºä½†æ˜¯å¤æ‚çš„é¢˜ç›®å·®ç‚¹æ„æ€,ç°åœ¨1750åˆ†,æ¥ä¸‹æ¥ä¸€ä¸ªæœˆå‡†å¤‡é‡å¿ƒæ”¾åœ¨ç®—æ³•ä¸Š. 3DGSä»Šå¤©ç”¨é™ˆæ˜Šå¸ˆå…„çš„æ•°æ®è·‘äº†åŸç‰ˆå’ŒDashGaussianè¿›è¡Œæµ‹è¯•ï¼Œå‘ç°æ•´ä½“æ¸²æŸ“è´¨é‡éƒ½æ¯”è¾ƒä½ï¼Œæ¸²æŸ“7000æ¬¡ï¼ŒPSNRéƒ½åªæœ‰20å¤šï¼Œä½¿ç”¨viewerå·¥å…·è§‚å¯Ÿåå‘ç°ä¸»è¦æ˜¯è‰ä¸›å¤„ç‚¹äº‘æ•°é‡è¿‡å°‘ã€‚ä¸ªäººç†è§£å¯èƒ½æ˜¯åœ¨è®­ç»ƒè¿‡ç¨‹ä¸­ï¼Œè‰ä¸›éƒ¨åˆ†çº¹ç†è¿‡äºå¤æ‚ï¼Œå¯¼è‡´å±€éƒ¨æ¢¯åº¦å‡å€¼ç›¸æŠµæ¶ˆæ— æ³•è§¦å‘3DGSçš„è‡ªåŠ¨å¢æ®–æ¨¡å—ï¼Œå¯¼è‡´é«˜æ–¯æ— æ³•æ‹Ÿåˆè‰ä¸›è¿‡äºå¤æ‚çš„çº¹ç†ï¼Œä½¿å¾—æ•´ä½“æ¸²æŸ“è´¨é‡ä¸‹é™ã€‚ åŠ›æ‰£æ¯æ—¥ä¸€é¢˜:ä»Šå¤©çš„æ¯æ—¥æ˜¯å…³äºå›æ–‡ä¸²çš„å›°éš¾é¢˜. Mysqlå­¦ä¹ 41 - 47 Springå­¦ä¹ 17 - 21 åšæ˜å¤©å®éªŒå®¤æ±‡æŠ¥çš„PPTå‡†å¤‡è®²Dashé«˜æ–¯è®ºæ–‡. æ±‡æŠ¥å†…å®¹ æœ¬å‘¨æ±‡æŠ¥çš„æ–‡ç« æ˜¯DashGaussian,ä¸»è¦æ˜¯å¯¹åŸç‰ˆ3DGSçš„è®­ç»ƒé€Ÿåº¦è¿›è¡Œäº†å¤§å¹…åº¦çš„ä¼˜åŒ–.ç”šè‡³å¯ä»¥å°†è®­ç»ƒæ—¶é—´å‹ç¼©åˆ°200ç§’. è¿™ç¯‡æ–‡ç« å‘ç°,é«˜æ–¯è®­ç»ƒçš„é€Ÿåº¦ä¸»è¦å°±å—ä¸¤ä¸ªå› ç´ çš„å½±å“,ä¸€ä¸ªæ˜¯çœŸå€¼å›¾åƒçš„åˆ†è¾¨ç‡,è¿˜æœ‰å°±æ˜¯é«˜æ–¯çƒçš„æ•°é‡.è€ŒDashGaussiané€šè¿‡åŠ¨æ€çš„è°ƒèŠ‚è¿™ä¸¤ä¸ªå› ç´ ,ä½¿å¾—è®­ç»ƒé€Ÿåº¦å¾—åˆ°å¤§å¹…åº¦çš„æé«˜çš„åŒæ—¶,æ¸²æŸ“è´¨é‡åŸºæœ¬ä¿æŒä¸€è‡´. è¿™ç¯‡æ–‡ç« å‘ç°,åŸºæœ¬90%çš„è®­ç»ƒæ—¶é—´åŸºæœ¬éƒ½åœ¨å‰å‘æ¸²æŸ“,åå‘ä¼ æ’­å’Œé«˜æ–¯çƒå‚æ•°æ›´æ–°ä¸Š;å¹¶ä¸”é«˜åˆ†è¾¨ç‡çš„å›¾åƒåœ¨æ¸²æŸ“å‰æœŸå­˜åœ¨æµªè´¹çš„ç°è±¡.åæœŸçš„ä¼˜åŒ–ä¼šæœ‰éå¸¸å¤§çš„è¾¹é™…æ•ˆåº”é€’å‡.åœ¨å³ä¸Šè§’çš„è¡¨æ ¼å¯ä»¥çœ‹åˆ°,åŸç‰ˆ3DGSçš„å›¾åƒåˆ†è¾¨ç‡æ˜¯ä¸€è‡´çš„,ä½†æ˜¯DashGaussiançš„å›¾åƒåˆ†è¾¨ç‡æ˜¯éšæ—¶é—´åŠ¨æ€ä¸Šå‡çš„.è¿™æ ·çš„è¯å¯ä»¥å‡å°‘åœ¨è®­ç»ƒåˆæœŸä½¿ç”¨é«˜åˆ†è¾¨ç‡å›¾åƒçš„æµªè´¹.ç¬¬äºŒä¸ªå›¾æ ‡å¯ä»¥çœ‹åˆ°,åŸç‰ˆ3DGSçš„é«˜æ–¯çƒæ•°é‡éšç€è¿­ä»£,ä¼šä»¥ä¸€ä¸ªä¸Šå‡¸çš„å½¢çŠ¶å¿«é€Ÿè¾¾åˆ°æ•°é‡ä¸Šé™,å¯¼è‡´è®­ç»ƒè¿›ç¨‹å˜æ…¢,è€ŒDashé«˜æ–¯ä¼šåœ¨å‰æœŸæŠ‘åˆ¶é«˜æ–¯çƒçš„å¢æ®–,é«˜æ–¯çƒæ•°é‡ä»¥ä¸€ä¸ªä¸‹å‡¹çš„å½¢çŠ¶ä¸Šå‡,å¯ä»¥å¤§å¹…åº¦å¢åŠ è®­ç»ƒé€Ÿåº¦.è¿™ä¸ªå›¾æ˜¯è¿™ç¯‡æ–‡ç« çš„ç»“æ„å›¾.ä»–çš„æ ¸å¿ƒå°±æ˜¯å¼•å…¥äº†å¯¹å›¾åƒåˆ†è¾¨ç‡å’Œé«˜æ–¯çƒæ•°é‡çš„åŠ¨æ€è°ƒèŠ‚æœºåˆ¶. ç„¶åå°±æ˜¯ä¸€ä¸ªå…³é”®çš„é—®é¢˜å°±æ˜¯é€šè¿‡ä»€ä¹ˆæœºåˆ¶æ¥å†³å®šåˆ†è¾¨ç‡çš„åŠ¨æ€å˜åŒ–çš„.è¿™ç¯‡æ–‡ç« å¼•å…¥äº†é¢‘ç‡å…¬å¼æ¥è¡¨ç¤º,è¿™ä¸ªå…¬å¼æ˜¯å¯¹æ¯å¼ è®­ç»ƒçš„è§†å›¾åšå‚…é‡Œå¶å˜æ¢,å¾—åˆ°å®ƒçš„é¢‘ç‡è¡¨ç¤ºFn,ç„¶åè®¡ç®—æ‰€æœ‰é¢‘ç‡åˆ†é‡çš„L2èŒƒæ•°å¹³å‡å€¼,è¿™ä¸ªå€¼ä½œä¸ºé¢‘ç‡èƒ½é‡,é«˜é¢‘åŒºåŸŸä¹Ÿå°±æ˜¯ç»†èŠ‚éƒ¨åˆ†æ•°å€¼æ›´å¤§,ä½é¢‘(ä¹Ÿå°±æ˜¯å¹³æ»‘éƒ¨åˆ†)æ•°å€¼å°.å°†é«˜æ–¯çƒè®­ç»ƒçš„è¿‡ç¨‹æ¯”æˆä»ä½é¢‘åˆ°é«˜é¢‘çš„è¿‡ç¨‹,åˆæœŸä½åˆ†è¾¨ç‡æ—¶å…ˆå¯¹ç‰©ä½“è½®å»“å’Œé¢œè‰²è¿›è¡Œæ‹Ÿåˆ,åæœŸé«˜åˆ†è¾¨ç‡éƒ¨åˆ†å¯¹çº¹ç†å’Œç»†èŠ‚è¿›è¡Œæ‹Ÿåˆ. ç„¶åå°±æ˜¯æ–‡ç« å®šä¹‰çš„åˆ†è¾¨ç‡è°ƒåº¦å™¨,ä¼šé¢„å…ˆè®¡ç®—å„ä¸ªåˆ†è¾¨ç‡çš„é¢‘ç‡èƒ½é‡,ç„¶åè®¡ç®—sr.ç„¶åå½“è®­ç»ƒæ­¥æ•°è¾¾åˆ°srååˆ‡æ¢åˆ°æ›´é«˜åˆ†è¾¨ç‡.è¿™éƒ¨åˆ†æ˜¯å¯¹åˆ†è¾¨ç‡çš„æ§åˆ¶ ç„¶åæ˜¯å¯¹é«˜æ–¯çƒæ•°é‡çš„æ§åˆ¶:è¿™ä¸ªæ˜¯è®¾è®¡çš„å¢é•¿æ›²çº¿,å®ƒçš„ç‰¹ç‚¹æ˜¯æ˜¯ä¸€ä¸ªå‡¹å‡½æ•°,åœ¨å‰æœŸå¢é•¿æ…¢,åœ¨ä¸­æœŸéšç€åˆ†è¾¨ç‡æå‡åŠ é€Ÿ.ç¬¬äºŒä¸ªå…¬å¼ä»£è¡¨é«˜æ–¯çƒæœ€ç»ˆæ•°é‡ä¸Šé™ä¼šæ ¹æ®å½“å‰æ–°å¢é«˜æ–¯çƒæ•°é‡æ¥åŠ¨æ€çš„é¢„æµ‹.è¿™éƒ¨åˆ†å°±æ˜¯å¯¹é«˜æ–¯çƒæ•°é‡çš„æ§åˆ¶. è¿™æ˜¯åœ¨ä¸åŒæ•°æ®é›†ä¸Šè¿›è¡Œçš„å®éªŒå¯ä»¥çœ‹åˆ°è®­ç»ƒæ—¶é—´éƒ¨åˆ†å’Œå…¶ä»–ç›¸æ¯”,æœ‰äº†éå¸¸å¤§çš„æå‡,å¹¶ä¸”æ¸²æŸ“è´¨é‡åœ¨å‡ ä¸ªæŒ‡æ ‡ç•¥æœ‰æå‡. å¯ä»¥çœ‹åˆ°åœ¨ä¸åŒæ•°æ®é›†å’Œæ–¹æ³•ä¸‹,åŠ å…¥æ–‡ç« çš„æ–¹æ³•åè®­ç»ƒé€Ÿåº¦éƒ½æœ‰æ˜æ˜¾çš„åŠ å¿«,å¹¶ä¸”è®­ç»ƒè´¨é‡ä¹Ÿæœ‰ä¸€å®šå¢å¼º. å·¦å›¾å¯ä»¥çœ‹åˆ°éšè¿­ä»£é€æ¸å˜å¤§çš„å›¾åƒåˆ†è¾¨ç‡,ä¸­é—´å›¾å®ç°éƒ¨åˆ†å¯ä»¥çœ‹åˆ°æœ¬æ–‡æ–¹æ³•ä¸‹,é«˜æ–¯çƒæ•°é‡æ›²çº¿å‘ˆä¸‹å‡¹çŠ¶æ€,å³å›¾å¯ä»¥çœ‹åˆ°è®­ç»ƒè€—æ—¶æœ€å¤§çš„ä¸‰ä¸ªéƒ¨åˆ†è€—æ—¶éƒ½åˆ†åˆ«æœ‰äº†ä¸åŒç¨‹åº¦çš„ä¸‹é™. è¿™æ˜¯æ–‡ç« åšçš„æ¶ˆèå®éªŒå¯ä»¥ä¸¤ä¸ªæ¨¡å—å¯¹æ¸²æŸ“é€Ÿåº¦å’Œè´¨é‡å‡æœ‰ä¸€å®šçš„æå‡. æ™šä¸Šå­¦ä»£ç éšæƒ³å½•æŠŠäºŒå‰æ ‘çš„é¢˜åšå®Œäº†,æŠŠç®—æ³•ç¬”è®°äºŒå‰æ ‘éƒ¨åˆ†æ”¶ä¸ªå°¾. ç”Ÿæ´»è®°å½•æ—©è®­è¸¢çƒé¢ çƒ çŸ­ä¼  é€†è¶³ æ™šä¸Šå¥èº«ç»ƒç»ƒèƒ¸å’Œä¸‰å¤´,å¼ºåº¦æ¯”è¾ƒä½.","tags":["3DGS","spring","æ—¥è®°","leetcode"],"categories":["å­¦ä¹ æ—¥è®°","2025-06"]},{"title":"2025.6.22å­¦ä¹ æ—¥è®°","path":"/2025/06/22/å­¦ä¹ æ—¥è®°25å¹´6æœˆ/2025.6.22å­¦ä¹ ç¬”è®°/","content":"ä»Šæ—¥å­¦ä¹ å†…å®¹åŠ›æ‰£æ¯æ—¥ä¸€é¢˜:ç®€å•çš„å­—ç¬¦ä¸²æ“ä½œ. åŠ›æ‰£å‘¨èµ›å›å½’å‘¨èµ›,å‡†å¤‡å†æ¬¡å¼€å§‹ä¸€æ®µæ—¶é—´çš„æ¯”èµ›,ä»Šå¤©2 3 é¢˜ç­”é¢˜æ€è·¯éƒ½æœ‰,å°±å·®ä¸€ç‚¹ç‚¹,å›¾è®ºå’ŒåŠ¨æ€è§„åˆ’è¿˜éœ€è¦åŠ å¼º. ç”Ÿæ´»è®°å½•æ™šä¸Šå¥èº«ç»ƒèƒŒå’ŒäºŒå¤´","tags":["æ—¥è®°","leetcode"],"categories":["å­¦ä¹ æ—¥è®°","2025-06"]},{"title":"2025.6.21å­¦ä¹ æ—¥è®°","path":"/2025/06/21/å­¦ä¹ æ—¥è®°25å¹´6æœˆ/2025.6.21å­¦ä¹ ç¬”è®°/","content":"ä»Šæ—¥å­¦ä¹ å†…å®¹åŠ›æ‰£æ¯æ—¥ä¸€é¢˜:ä»Šå¤©çš„æ¯æ—¥æ˜¯ä¸€ä¸ªå“ˆå¸Œè®¡æ•°ï¼‹æ’åºï¼‹è´ªå¿ƒçš„ä¸­ç­‰é¢˜,æ¯”è¾ƒç®€å•. Mysqlå­¦ä¹ 37-41 Bæ ‘å­¦ä¹ è®°äº†ä¸€ç¯‡ç¬”è®°. æ™šä¸Šå­¦ä»£ç éšæƒ³å½•ç”Ÿæ´»è®°å½•æ™šä¸Šå¥èº«ç»ƒèƒŒå’ŒäºŒå¤´","tags":["spring","æ—¥è®°","leetcode","mysql","äºŒå‰æ ‘"],"categories":["å­¦ä¹ æ—¥è®°","2025-06"]},{"title":"ä¸€æ¬¡æ€§ææ‡‚Bæ ‘","path":"/2025/06/21/ç®—æ³•ç¬”è®°/ä¸€æ¬¡æ€§ææ‡‚Bæ ‘/","content":"å¯è§†åŒ–ç½‘ç«™ç®—æ³•å¯è§†åŒ–ç½‘ç«™ B-Treeçš„å¼•å…¥ä»ç£ç›˜æŸ¥æ‰¾æ•°æ®æ•ˆç‡ä½çš„åŸå›  è¯»å†™æ•°æ®è¶Šå¤§é€Ÿåº¦è¶Šæ…¢ è¯»å†™æ¬¡æ•°è¶Šå¤šé€Ÿåº¦è¶Šæ…¢ è®¾è®¡æ–‡ä»¶æŸ¥æ‰¾ç³»ç»Ÿç´¢å¼•å¯ä»¥æä¾›æ›´å¿«çš„æŸ¥è¯¢. å“ˆå¸Œè¡¨ä¼˜ç‚¹:ç­‰å€¼æŸ¥è¯¢æ¯”è¾ƒå¿«ç¼ºç‚¹: hashå†²çªå,æ•°æ®æ•£åˆ—ä¸å‡åŒ€,äº§ç”Ÿå¤§é‡çº¿æ€§æŸ¥è¯¢,æ•ˆç‡ä½ ç­‰å€¼æŸ¥è¯¢å¯ä»¥,ä½†æ˜¯é‡åˆ°èŒƒå›´æŸ¥è¯¢,éœ€è¦éå†,hashä¸åˆé€‚ æ ‘æ ‘çš„ç§ç±»æ ‘ äºŒå‰æ ‘ BSTäºŒå‰æŸ¥æ‰¾æ ‘ AVLå¹³è¡¡äºŒå‰æ ‘ çº¢é»‘æ ‘ Bæ ‘ B+æ ‘ äºŒå‰æ’åºæ ‘ BSTæ’å…¥æ•°æ®çš„æ—¶å€™å¾—æœ‰åº,å¿…é¡»ä¿è¯: è‹¥å·¦å­æ ‘ä¸ä¸ºç©º,åˆ™å·¦å­æ ‘çš„æ‰€æœ‰èŠ‚ç‚¹çš„å€¼å°äºæ ¹èŠ‚ç‚¹çš„å€¼ è‹¥å³å­æ ‘ä¸ä¸ºç©º,åˆ™å³å­æ ‘çš„æ‰€æœ‰èŠ‚ç‚¹çš„å€¼å¤§äºæ ¹èŠ‚ç‚¹çš„å€¼ é—®é¢˜:ä¼šé€€åŒ–ä¸ºé“¾è¡¨,æŸ¥è¯¢æ•ˆç‡é™ä½ä¸ºO(n). å¹³è¡¡äºŒå‰æ ‘ AVLæ’å…¥æ•°æ®çš„æ—¶å€™ä¿æŒäºŒå‰æ’åºæ ‘å¹³è¡¡å·¦å­æ ‘å’Œå³å­æ ‘çš„é«˜åº¦å·®ä¸èƒ½è¶…è¿‡1. é—®é¢˜:ç”¨æ’å…¥çš„æˆæœ¬æ¥å¼¥è¡¥æŸ¥è¯¢çš„æˆæœ¬,æ’å…¥æ•ˆç‡é™ä½ä¸ºO(logn),ä½†æ˜¯æŸ¥è¯¢æ•ˆç‡è¿˜æ˜¯O(logn).ä¸€æ—¦å‡ºç°æ’å…¥æ“ä½œæ¯”æŸ¥è¯¢æ“ä½œå¤šçš„æƒ…å†µå°±ä¸åˆé€‚äº†. çº¢é»‘æ ‘æœ€é•¿å­æ ‘ä¸è¶…è¿‡æœ€çŸ­å­æ ‘çš„2å€. æ€§è´¨1 :æ ¹èŠ‚ç‚¹æ˜¯é»‘è‰²çš„. æ€§è´¨2 :æ¯ä¸ªçº¢è‰²çš„èŠ‚ç‚¹çš„ä¸¤ä¸ªå­èŠ‚ç‚¹éƒ½æ˜¯é»‘è‰².(ä»æ¯ä¸ªå¶å­åˆ°æ ¹çš„æ‰€æœ‰è·¯å¾„ä¸Šä¸èƒ½æœ‰ä¸¤ä¸ªè¿ç»­çš„çº¢è‰²èŠ‚ç‚¹) æ€§è´¨3 :ä»ä»»ä¸€èŠ‚ç‚¹åˆ°å…¶æ¯ä¸ªå¶å­çš„æ‰€æœ‰è·¯å¾„éƒ½åŒ…å«ç›¸åŒæ•°ç›®çš„é»‘è‰²èŠ‚ç‚¹. ç›¸å½“äºä¸è®©AVLåšå¤§é‡çš„æ—‹è½¬æ“ä½œ.çº¢é»‘æ ‘å£è¯€:å·¦æ ¹å³ , æ ¹å¶é»‘ . ä¸çº¢çº¢ , é»‘è·¯åŒ. é—®é¢˜: å½“æ•°æ®ç‰¹åˆ«å¤šçš„æ—¶å€™,æ ‘çš„æ·±åº¦ä¼šå¾ˆå¤§,å°±æ„å‘³ç€IOçš„æ¬¡æ•°ä¼šå˜å¤š,å½±å“è¯»å–çš„æ•ˆç‡. Bæ ‘Bæ ‘å°±æ˜¯ä¸€ä¸ªæœ‰åºçš„å¤šè·¯æŸ¥è¯¢æ ‘. æ»¡è¶³ä¸‹åˆ—è¦æ±‚çš„må‰æ ‘: ä¹¦ä¸­æ¯ä¸ªèŠ‚ç‚¹åªå¤šæœ‰mä¸ªå­©å­èŠ‚ç‚¹(è‡³å¤šæœ‰m-1ä¸ªå…³é”®å­—) æ¯ä¸ªèŠ‚èŠ‚ç‚¹çš„ç»“æ„ä¸º:nä»£è¡¨è¿™ä¸ªèŠ‚ç‚¹æœ‰å‡ ä¸ªå…³é”®å­—.P0ç¬¬ä¸€ä¸ªå­æ ‘çš„åœ°å€.k1å…³é”®å­— ä¾‹å­:m4çš„4é˜¶Bæ ‘é˜¶æ•°ä»£è¡¨å•ä¸ªèŠ‚ç‚¹æœ€å¤šæœ‰çš„å­èŠ‚ç‚¹æ•°é‡","tags":["åŸºç¡€","ç®—æ³•","Bæ ‘"],"categories":["ç®—æ³•ç¬”è®°"]},{"title":"2025.6.20å­¦ä¹ æ—¥è®°","path":"/2025/06/20/å­¦ä¹ æ—¥è®°25å¹´6æœˆ/2025.6.20å­¦ä¹ ç¬”è®°/","content":"ä»Šæ—¥å­¦ä¹ å†…å®¹3DGSæ¢äº†å†…å­˜æ¡,å¯èƒ½ä¼šå¯¹è®­ç»ƒé€Ÿåº¦æœ‰å½±å“.é‡æ–°è®­ç»ƒDashGaussian,ä¿®æ”¹äº†ä¸€ä¸‹è®­ç»ƒçš„ä»£ç ,å°†é¢„å…ˆå­˜å…¥cudaçš„ä»£ç æ”¹æˆå…ˆå­˜å…¥å†…å­˜,ä½¿ç”¨æ—¶å†åŠ¨æ€å­˜å…¥cuda.è™½ç„¶ä¼šå˜æ…¢,ä½†æ˜¯å¯ä»¥è®©æ˜¾å­˜å ç”¨å‡å°‘.ä¸‹åˆç”¨R8è®¾å¤‡å¤–å‡ºé‡‡é›†æ•°æ®.ç»§ç»­å­¦ä¹ Dashè®ºæ–‡. åŠ›æ‰£æ¯æ—¥ä¸€é¢˜:ä¸Šä¸‹å·¦å³ç§»åŠ¨,èƒ½ä¿®æ”¹kæ¬¡ç§»åŠ¨æ–¹å‘,æ±‚æœ€å¤§æ›¼å“ˆé¡¿è·ç¦».æ¯”è¾ƒç®€å•,éšç€ç§»åŠ¨æ›´æ–°ç­”æ¡ˆå³å¯. Mysqlå­¦ä¹ ç´¢å¼•éƒ¨åˆ†å­¦ä¹ äº†å‡ æ¡. Springå­¦ä¹ å­¦äº†å‡ æ¡,å¹¶ä¸”è®°äº†ç¬”è®°. é¡¹ç›®æ–‡æ¡£å­¦ä¹ å¼‚å¸¸å¤„ç†éƒ¨åˆ†,å­¦ä¹ äº†ä¸€ä¸‹. æ™šä¸Šå­¦ä»£ç éšæƒ³å½•åšäº†å‡ ä¸ªé€’å½’å’Œå›æº¯çš„äºŒå‰æ ‘é¢˜.æŠŠMorriséå†äºŒå‰æ ‘åˆå¤ä¹ äº†ä¸€é,ååºéå†æ¯”è¾ƒæœ‰æ„æ€,æ˜¯åœ¨å‘å³çš„å‰åºéå†ç»“æœä¸Š,ç¿»è½¬ä¸€ä¸‹. ç”Ÿæ´»è®°å½•æ™šä¸Šå¥èº«ç»ƒè‚©,èƒ¸,ä¸‰å¤´é€’å‡ç»„.","tags":["3DGS","spring","æ—¥è®°","leetcode","é¡¹ç›®","mysql","äºŒå‰æ ‘","Morriséå†"],"categories":["å­¦ä¹ æ—¥è®°","2025-06"]},{"title":"2025.6.19å­¦ä¹ æ—¥è®°","path":"/2025/06/19/å­¦ä¹ æ—¥è®°25å¹´6æœˆ/2025.6.19å­¦ä¹ ç¬”è®°/","content":"ä»Šæ—¥å­¦ä¹ å†…å®¹3DGSå­¦ä¹ äº†DashGaussianè®ºæ–‡,æ ¸å¿ƒç›®çš„å°±æ˜¯åœ¨å°½å¯èƒ½ä¿æŒæ¸²æŸ“è´¨é‡çš„åŒæ—¶,åŠ é€Ÿé«˜æ–¯è®­ç»ƒé€Ÿåº¦.æ–‡ç« æå‡ºåœ¨è®­ç»ƒåˆå§‹é˜¶æ®µ,é«˜æ–¯çƒæ˜¯ç›¸å¯¹æ¯”è¾ƒç¨€ç–çš„,æ­¤æ—¶æ²¡æœ‰å¿…è¦ä½¿ç”¨é«˜åˆ†è¾¨ç‡å›¾åƒè¿›è¡Œè®­ç»ƒ,æ‰€ä»¥åœ¨è®­ç»ƒåˆæœŸä½¿ç”¨ä½åˆ†è¾¨ç‡å›¾åƒè®­ç»ƒ,ç„¶åé€šè¿‡è®¡ç®—ä½åˆ†è¾¨ç‡å’Œé«˜åˆ†è¾¨ç‡æ¸²æŸ“çš„åˆ†æ•°,æ¥åˆ¤æ–­æ˜¯å¦éœ€è¦åˆ‡æ¢æ›´é«˜åˆ†è¾¨ç‡.ç„¶ååœ¨é«˜æ–¯çƒè‡´å¯†åŒ–ç­–ç•¥ä¸Š,æ–‡ç« æå‡ºçš„æ–¹æ³•æ˜¯åœ¨è®­ç»ƒå‰æœŸ,æŠ‘åˆ¶é«˜æ–¯çƒçš„å¢æ®–,ç„¶ååœ¨è®­ç»ƒä¸­åæœŸå†é¼“åŠ±é«˜æ–¯çƒçš„å¢æ®–.å› ä¸ºé«˜æ–¯è®­ç»ƒçš„é€Ÿåº¦ä¸»è¦å°±å–å†³äºé«˜æ–¯çƒçš„æ•°é‡,è€Œé«˜æ–¯çƒæ•°é‡è¾¾åˆ°ä¸€å®šæ•°ç›®å,è®­ç»ƒæ•ˆæœå˜åŒ–å¾ˆå°,ä½†è®­ç»ƒé€Ÿåº¦ä¼šå˜å¾—éå¸¸æ…¢.æ‰€ä»¥ä½¿é«˜æ–¯çƒæ•°é‡éšæ—¶é—´ä¸Šå‡æ›²çº¿å‘ˆä¸‹å‡¹çš„å½¢çŠ¶æ˜¯æœ€å…¼é¡¾è®­ç»ƒé€Ÿåº¦å’Œè´¨é‡çš„. åŠ›æ‰£æ¯æ—¥ä¸€é¢˜:åˆæ˜¯ä¸€ä¸ªæ’åºï¼‹è´ªå¿ƒçš„ä¸­ç­‰é¢˜,æ¯”è¾ƒç®€å•. Mysqlå­¦ä¹ ä¼˜åŒ–ç¯‡å­¦å®Œäº†,æ˜å¤©å¼€å§‹ç´¢å¼•ç¯‡å­¦ä¹ . Springå­¦ä¹ å­¦äº†å››æ¡,å¹¶ä¸”è®°äº†ç¬”è®°. é¡¹ç›®æ–‡æ¡£å­¦ä¹ å›¾ç‰‡ä¸Šä¼ éƒ¨åˆ†.MapStruct,ä¸€ä¸ªç”¨äºè½¬æ¢å¯¹è±¡çš„å·¥å…·. æ™šä¸Šå­¦ä»£ç éšæƒ³å½•åšäº†å‡ é“äºŒå‰æ ‘é¢˜.å­¦ä¹ äº†ä¸€ä¸ªMorriséå†æ–¹å¼,è¿™ç§æ–¹å¼å¯ä»¥åœ¨O(1)çš„ç©ºé—´å¤æ‚åº¦ä¸‹å®ŒæˆäºŒå‰æ ‘çš„éå†,å¹¶ä¸”ä¸éœ€è¦ä½¿ç”¨æ ˆæ¥å­˜å‚¨èŠ‚ç‚¹.è´´ä¸€ä¸ªè‡ªå·±ç”»çš„ä¼ªä»£ç : ç”Ÿæ´»è®°å½•æ™šä¸Šå¥èº«ç»ƒè‚©,é£é¸Ÿè¶…çº§ç»„å››ç»„.","tags":["3DGS","spring","æ—¥è®°","leetcode","é¡¹ç›®","mysql","äºŒå‰æ ‘","Morriséå†"],"categories":["å­¦ä¹ æ—¥è®°","2025-06"]},{"title":"2025.6.18å­¦ä¹ æ—¥è®°","path":"/2025/06/18/å­¦ä¹ æ—¥è®°25å¹´6æœˆ/2025.6.18å­¦ä¹ ç¬”è®°/","content":"ä»Šæ—¥å­¦ä¹ å†…å®¹3DGSè®­ç»ƒDashGaussian.æ˜¨å¤©DashGaussianè®­ç»ƒè¿‡ç¨‹ä¼šå‡ºç°æŠ¥é”™,æ’æŸ¥åå‘ç°æ˜¯å­æ¨¡å—ç‰ˆæœ¬é—®é¢˜å¯¼è‡´,é‡æ–°å®‰è£…å­æ¨¡å—åæ¶ˆé™¤æŠ¥é”™.å¹¶ä¸”åœ¨æ˜¨å¤©çš„è®­ç»ƒè¿‡ç¨‹ä¸­,åœ¨å¯¹äºå¤æ‚çš„åœºæ™¯ä¼šå‡ºç°çˆ†æ˜¾å­˜çš„é—®é¢˜:é€šè¿‡ä¿®æ”¹scenecameras.pyä¸­å›¾ç‰‡é¢„å…ˆåŠ è½½åˆ°æ˜¾å­˜çš„é€»è¾‘,æŠŠå›¾ç‰‡åŠ è½½åˆ°å†…å­˜,è§£å†³äº†çˆ†æ˜¾å­˜çš„é—®é¢˜,è™½ç„¶ä¼šå› IOæ—¶é—´å¢åŠ ,è®­ç»ƒå˜æ…¢,ä½†æ˜¯å¯ä»¥æ¥å—. åŠ›æ‰£æ¯æ—¥ä¸€é¢˜:æ’åºåŠ è´ªå¿ƒçš„ä¸­ç­‰é¢˜. äºŒå‰æ ‘é€šè¿‡ä¸­åºå’Œååºæ„é€ äºŒå‰æ ‘.é€šè¿‡å¯¹ä¸­åºåšä¸€ä¸ªç´¢å¼•,æ‰¾åˆ°å·¦å³æ ‘çš„åˆ†å‰²ä½ç½®,ç„¶åé€’å½’. class Solution MapInteger,Integer in_idx = new HashMap(); public TreeNode buildTree(int[] inorder, int[] postorder) for(int i=0 ; iinorder.length ; ++i) in_idx.put(inorder[i],i); int n = inorder.length; return dfs(inorder,postorder,0,n-1,0,n-1); private TreeNode dfs(int[] inorder,int[] postorder , int beg_in , int end_in,int beg_pos , int end_pos) //å…¨éƒ¨é—­åŒºé—´ if(beg_in end_in ||beg_pos end_pos )return null; int rootIndex = in_idx.get(postorder[end_pos]); TreeNode root = new TreeNode(inorder[rootIndex]); int lenOfLeft = rootIndex - beg_in;//å·¦å­æ ‘ä¸ªæ•° int n=inorder.length; root.left = dfs(inorder,postorder,beg_in,beg_in+lenOfLeft-1,beg_pos,beg_pos+lenOfLeft-1); root.right = dfs(inorder,postorder,rootIndex+1,end_in,beg_pos+lenOfLeft,end_pos-1); return root; é€šè¿‡å‰åºå’Œååºæ„é€ äºŒå‰æ ‘.å¯¹åº”äºŒå‰æ ‘ä¸å”¯ä¸€,æ‰¾å‰åºæ ¹èŠ‚ç‚¹çš„ä¸‹ä¸€ä¸ªä½ç½®åœ¨ååºä¸­çš„ä½ç½®,ç„¶åæ‰¾å·¦å³å­æ ‘,å‰©ä¸‹åšæ³•å·®ä¸å¤šäº†. Mysqlå­¦ä¹ Springå­¦ä¹ æ™šä¸Šå­¦ä»£ç éšæƒ³å½•ç”Ÿæ´»è®°å½•æ™šä¸Šå¥èº«ä»Šå¤©ç»ƒçš„åä¾§é“¾ èƒŒ æ‰‹è‡‚","tags":["3DGS","spring","æ—¥è®°","leetcode","mysql","äºŒå‰æ ‘"],"categories":["å­¦ä¹ æ—¥è®°","2025-06"]},{"title":"2025.6.17å­¦ä¹ æ—¥è®°","path":"/2025/06/17/å­¦ä¹ æ—¥è®°25å¹´6æœˆ/2025.6.17å­¦ä¹ ç¬”è®°/","content":"ä»Šæ—¥å­¦ä¹ å†…å®¹3DGSåœ¨Ubuntuç³»ç»Ÿä¸Šéƒ¨ç½²äº†DashGaussiané¡¹ç›®.å­¦ä¹ DashGaussiané¡¹ç›®çš„æ”¹è¿›ç‚¹.ç”¨DashGaussianè®­ç»ƒä¸­. åŠ›æ‰£æ¯æ—¥ä¸€é¢˜:ä¸€é“å¾ˆæœ‰æ„æ€çš„æ•°å­¦é¢˜.æ­£é—®é¢˜æ¯”è¾ƒå¤æ‚,ä½†æ˜¯åè¿‡æ¥æƒ³åˆ†å‰²æˆä¸ºå¤šå°‘å—å°±å¾ˆç®€å•äº†.https://leetcode.cn/problems/count-the-number-of-arrays-with-k-matching-adjacent-elements?envType=daily-questionenvId=2025-06-17è¿™é“é¢˜åšå®Œä¹‹å,åšäº†çµç¥æ¨¡è¿ç®—çš„ç¬”è®°,å¤ä¹ äº†ä¸€ä¸‹å¿«é€Ÿå¹‚.æ±‚ç»„åˆæ•°çš„è¯,å…ˆæ±‚n! ç„¶åä»åå‘å‰æ±‚1n!. Mysqlå­¦ä¹ å¼€å§‹å­¦ä¹ SQLä¼˜åŒ–ç¯‡,æ…¢sqlä¼˜åŒ–. Springå­¦ä¹ ç®€å•å­¦äº†å‡ æ¡beanç›¸å…³çš„. æ™šä¸Šå­¦ä»£ç éšæƒ³å½•äºŒå‰æ ‘ä¸‰å››é“é¢˜. ç”Ÿæ´»è®°å½•æ—©ä¸Šè¸¢çƒä»Šæ—©ä¸ƒç‚¹è®­ç»ƒä¸€ä¼šå„¿.é¢ çƒ,é€†è¶³,çŸ­ä¼ .å³è†å†…ä¾§è¿˜æ˜¯æœ‰ç‚¹ä¸èˆ’æœ,éœ€è¦å…»ä¸€å…».","tags":["3DGS","spring","æ—¥è®°","leetcode","mysql","æ¨¡è¿ç®—","å¿«é€Ÿå¹‚"],"categories":["å­¦ä¹ æ—¥è®°","2025-06"]},{"title":"2025.6.16å­¦ä¹ æ—¥è®°","path":"/2025/06/16/å­¦ä¹ æ—¥è®°25å¹´6æœˆ/2025.6.16å­¦ä¹ ç¬”è®°/","content":"ä»Šæ—¥å­¦ä¹ å†…å®¹3DGS:ä»Šæ—¥å·¥ä½œæ€»ç»“é…ç¯å¢ƒ.DashGaussiané¡¹ç›®éƒ¨ç½²åœ¨Winç³»ç»Ÿæœ‰é—®é¢˜,æ‰€ä»¥è£…äº†ä¸€ä¸ªubuntuåŒç³»ç»Ÿ.é…ç½®ubuntuç¯å¢ƒ,åŸºæœ¬ç¯å¢ƒå·²é…ç½®å®Œæˆ. æ˜æ—¥å·¥ä½œè®¡åˆ’åœ¨Ubuntuç³»ç»Ÿä¸Šéƒ¨ç½²DashGaussiané¡¹ç›®.å°è¯•è¿è¡Œä¸€ä¸‹. åŠ›æ‰£æ¯æ—¥ä¸€é¢˜:ç»´æŠ¤æœ€å°å€¼éå†çš„ç®€å•é¢˜. Mysqlå­¦ä¹ å­¦å®Œäº†æ—¥å¿—ç¯‡ é¡¹ç›®å­¦ä¹ çœ‹äº†ä¸‰å››ç¯‡æ–‡æ¡£. æ™šä¸Šå­¦ä»£ç éšæƒ³å½•äºŒå‰æ ‘ä¸‰å››é“é¢˜. ç”Ÿæ´»è®°å½•æ™šä¸Šå¥èº«æ™šä¸Šå¥èº« åä¾§é“¾","tags":["3DGS","æ—¥è®°","leetcode","é¡¹ç›®","mysql"],"categories":["å­¦ä¹ æ—¥è®°","2025-06"]},{"title":"2025.6.14å­¦ä¹ æ—¥è®°","path":"/2025/06/14/å­¦ä¹ æ—¥è®°25å¹´6æœˆ/2025.6.14å­¦ä¹ ç¬”è®°/","content":"ä»Šæ—¥å­¦ä¹ å†…å®¹ä»Šå¤©ä¸€ç›´åœ¨é…ç¯å¢ƒâ€¦â€¦â€¦â€¦â€¦. 3DGS:ä»Šæ—¥å·¥ä½œæ€»ç»“é…ç½®Effect3DGSç¯å¢ƒï¼Œå®‰è£…å­æ¨¡å—æ—¶å‡ºç°å®‰è£…æŠ¥é”™: é…ç½®Effect3DGSç¯å¢ƒæ—¶,å­æ¨¡å—ä¸€ç›´æ— æ³•å®‰è£…æˆåŠŸ.å°è¯•é‡æ–°é…ç½®äº†å¤šä¸ªcondaç¯å¢ƒæ¥å®‰è£…å­æ¨¡å—,ä½†é‡æ–°å®‰è£…å…¶ä»–ä¾èµ–å,å®‰è£…å­æ¨¡å—diff-gaussian-rasterizationä»ç„¶æŠ¥é”™.Effect3DGSé¡¹ç›®æ²¡æœ‰ç¯å¢ƒä¾èµ–æ–‡ä»¶,ä¹Ÿæ²¡åœ¨githubä¸Šè´´å‡º,åªèƒ½å…ˆæš‚æ—¶æç½®.çœ‹äº†ä¸€äº›å…¶ä»–çš„3DGSé¡¹ç›® æ˜æ—¥å·¥ä½œè®¡åˆ’å‡†å¤‡éƒ¨ç½²DashGaussiané¡¹ç›®:3DGSè®­ç»ƒåŠ é€Ÿæ–¹æ³•. åŠ›æ‰£æ¯æ—¥ä¸€é¢˜:äºŒåˆ†ç­”æ¡ˆ+è´ªå¿ƒ+ç›¸é‚»ç›¸å‡è®¡æ•° Springå­¦ä¹ åšäº†ä¸€ä¸ªå·¥å‚ æ™šä¸Šå­¦ä»£ç éšæƒ³å½•ç”Ÿæ´»è®°å½•","tags":["3DGS","spring","æ—¥è®°","leetcode","mysql"],"categories":["å­¦ä¹ æ—¥è®°","2025-06"]},{"title":"2025.6.13å­¦ä¹ æ—¥è®°","path":"/2025/06/13/å­¦ä¹ æ—¥è®°25å¹´6æœˆ/2025.6.13å­¦ä¹ ç¬”è®°/","content":"ä»Šæ—¥å­¦ä¹ å†…å®¹3DGS:ä»Šæ—¥å·¥ä½œæ€»ç»“åœ¨drjohnsonæ•°æ®é›†ä¸playroomæ•°æ®é›†è·‘å®Œäº†åŸç‰ˆ3DGS.å‘ç°viewerä¸­çš„å¸§ç‡æ˜¾ç¤ºå¹¶ä¸å‡†ç¡®,å­˜åœ¨é”å¸§ç‡ä¸Šé™å’Œæ³¢åŠ¨çš„æƒ…å†µ,è°ƒè¯•äº†ä¸€ä¸ªæµ‹é‡3DGSçš„FPSçš„è„šæœ¬,å¯ä»¥å‡†ç¡®æµ‹å‡º3DGSæ¸²æŸ“å¸§ç‡.é…ç½®Effect3DGSç¯å¢ƒï¼Œå°è¯•è¿è¡Œå‡ºç°ä¸€äº›ç‰ˆæœ¬ä¾èµ–é—®é¢˜ã€‚ æ˜æ—¥å·¥ä½œè®¡åˆ’éƒ¨ç½²EfficientGSç¯å¢ƒ,ç”¨æ”¹è¿›æ–¹æ³•è·‘æ•°æ®é›†. åŠ›æ‰£æ¯æ—¥ä¸€é¢˜:äºŒåˆ†ç­”æ¡ˆ+è´ªå¿ƒ+ç›¸é‚»ç›¸å‡è®¡æ•° çœ‹mysqlçœ‹åˆ°29æ¡,æ—¥å¿—ç¯‡å»¶ä¼¸å‡ºå»çœ‹å¤šäº†,çœ‹åˆ°ä¸‹åˆå››ç‚¹åŠ. Springå­¦ä¹ æ™šä¸Šå­¦ä»£ç éšæƒ³å½•ç”Ÿæ´»è®°å½•æ™šä¸Šå¥èº«ä»Šå¤©ä¸»è¦ç»ƒçš„èƒŒ.","tags":["3DGS","spring","æ—¥è®°","leetcode","mysql"],"categories":["å­¦ä¹ æ—¥è®°","2025-06"]},{"title":"Springå­¦ä¹ ç¬”è®°","path":"/2025/06/12/Javaé—®ç­”ç¬”è®°/Springå­¦ä¹ ç¬”è®°/","content":"åŸºç¡€1.Spring æ˜¯ä»€ä¹ˆï¼Ÿç‰¹æ€§ï¼Ÿæœ‰å“ªäº›æ¨¡å—ï¼Ÿä¸€å¥è¯æ¦‚æ‹¬ï¼šSpring æ˜¯ä¸€ä¸ªè½»é‡çº§ã€éå…¥ä¾µå¼çš„æ§åˆ¶åè½¬ (IoC)å’Œé¢å‘åˆ‡é¢ (AOP) çš„æ¡†æ¶ã€‚ 2003 å¹´ï¼Œä¸€ä¸ªéŸ³ä¹å®¶ Rod Johnson å†³å®šå‘å±•ä¸€ä¸ªè½»é‡çº§çš„ Java å¼€å‘æ¡†æ¶ï¼ŒSpringä½œä¸º Java æˆ˜åœºçš„é¾™éª‘å…µæ¸æ¸å´›èµ·ï¼Œå¹¶æ·˜æ±°äº†EJBè¿™ä¸ªä¼ ç»Ÿçš„é‡è£…éª‘å…µã€‚ åˆ°äº†ç°åœ¨ï¼Œä¼ä¸šçº§å¼€å‘çš„æ ‡é…åŸºæœ¬å°±æ˜¯ Spring5+ Spring Boot 2 + JDK 8 Spring æœ‰å“ªäº›ç‰¹æ€§å‘¢ï¼Ÿ 1. IoC å’Œ DI çš„æ”¯æŒSpring çš„æ ¸å¿ƒå°±æ˜¯ä¸€ä¸ªå¤§çš„å·¥å‚å®¹å™¨ï¼Œå¯ä»¥ç»´æŠ¤æ‰€æœ‰å¯¹è±¡çš„åˆ›å»ºå’Œä¾èµ–å…³ç³»ï¼ŒSpring å·¥å‚ç”¨äºç”Ÿæˆ Beanï¼Œå¹¶ä¸”ç®¡ç† Bean çš„ç”Ÿå‘½å‘¨æœŸï¼Œå®ç°é«˜å†…èšä½è€¦åˆçš„è®¾è®¡ç†å¿µã€‚ 2. AOP ç¼–ç¨‹çš„æ”¯æŒSpring æä¾›äº†é¢å‘åˆ‡é¢ç¼–ç¨‹ï¼Œå¯ä»¥æ–¹ä¾¿çš„å®ç°å¯¹ç¨‹åºè¿›è¡Œæƒé™æ‹¦æˆªã€è¿è¡Œç›‘æ§ç­‰åˆ‡é¢åŠŸèƒ½ã€‚ 3. å£°æ˜å¼äº‹åŠ¡çš„æ”¯æŒæ”¯æŒé€šè¿‡é…ç½®å°±æ¥å®Œæˆå¯¹äº‹åŠ¡çš„ç®¡ç†ï¼Œè€Œä¸éœ€è¦é€šè¿‡ç¡¬ç¼–ç çš„æ–¹å¼ï¼Œä»¥å‰é‡å¤çš„ä¸€äº›äº‹åŠ¡æäº¤ã€å›æ»šçš„ JDBC ä»£ç ï¼Œéƒ½å¯ä»¥ä¸ç”¨è‡ªå·±å†™äº†ã€‚ 4. å¿«æ·æµ‹è¯•çš„æ”¯æŒSpring å¯¹ Junit æä¾›æ”¯æŒï¼Œå¯ä»¥é€šè¿‡æ³¨è§£å¿«æ·åœ°æµ‹è¯• Spring ç¨‹åºã€‚ 5. å¿«é€Ÿé›†æˆåŠŸèƒ½æ–¹ä¾¿é›†æˆå„ç§ä¼˜ç§€æ¡†æ¶ï¼ŒSpring ä¸æ’æ–¥å„ç§ä¼˜ç§€çš„å¼€æºæ¡†æ¶ï¼Œå…¶å†…éƒ¨æä¾›äº†å¯¹å„ç§ä¼˜ç§€æ¡†æ¶ï¼ˆå¦‚ï¼šStrutsã€Hibernateã€MyBatisã€Quartz ç­‰ï¼‰çš„ç›´æ¥æ”¯æŒã€‚ 6. å¤æ‚ API æ¨¡æ¿å°è£…Spring å¯¹ JavaEE å¼€å‘ä¸­éå¸¸éš¾ç”¨çš„ä¸€äº› APIï¼ˆJDBCã€JavaMailã€è¿œç¨‹è°ƒç”¨ç­‰ï¼‰éƒ½æä¾›äº†æ¨¡æ¿åŒ–çš„å°è£…ï¼Œè¿™äº›å°è£… API çš„æä¾›ä½¿å¾—åº”ç”¨éš¾åº¦å¤§å¤§é™ä½ã€‚ ç®€å•è¯´ä¸€ä¸‹ä»€ä¹ˆæ˜¯AOP å’Œ IoCï¼ŸAOPï¼šé¢å‘åˆ‡é¢ç¼–ç¨‹ï¼Œæ˜¯ä¸€ç§ç¼–ç¨‹èŒƒå¼ï¼Œå®ƒçš„ä¸»è¦ä½œç”¨æ˜¯å°†é‚£äº›ä¸æ ¸å¿ƒä¸šåŠ¡é€»è¾‘æ— å…³ï¼Œä½†æ˜¯å¯¹å¤šä¸ªå¯¹è±¡äº§ç”Ÿå½±å“çš„å…¬å…±è¡Œä¸ºå°è£…èµ·æ¥ï¼Œå¦‚æ—¥å¿—è®°å½•ã€æ€§èƒ½ç»Ÿè®¡ã€äº‹åŠ¡ç­‰ã€‚IoCï¼šæ§åˆ¶åè½¬ï¼Œæ˜¯ä¸€ç§è®¾è®¡æ€æƒ³ï¼Œå®ƒçš„ä¸»è¦ä½œç”¨æ˜¯å°†å¯¹è±¡çš„åˆ›å»ºå’Œå¯¹è±¡ä¹‹é—´çš„è°ƒç”¨è¿‡ç¨‹äº¤ç»™ Spring å®¹å™¨æ¥ç®¡ç†ã€‚ Springæºç çœ‹è¿‡å—ï¼Ÿçœ‹è¿‡ä¸€äº›ï¼Œä¸»è¦å°±æ˜¯é’ˆå¯¹ Spring å¾ªç¯ä¾èµ–ã€Bean å£°æ˜å‘¨æœŸã€AOPã€äº‹åŠ¡ã€IOC è¿™äº”éƒ¨åˆ†ã€‚è¯¦æƒ…çœ‹ç¬”è®°,Springæºç ç¬”è®°. 2.Spring æœ‰å“ªäº›æ¨¡å—å‘¢ï¼ŸSpring æ¡†æ¶æ˜¯åˆ†æ¨¡å—å­˜åœ¨ï¼Œé™¤äº†æœ€æ ¸å¿ƒçš„Spring Core Containeræ˜¯å¿…è¦æ¨¡å—ä¹‹å¤–ï¼Œå…¶ä»–æ¨¡å—éƒ½æ˜¯å¯é€‰ï¼Œå¤§çº¦æœ‰ 20 å¤šä¸ªæ¨¡å—ã€‚ æœ€ä¸»è¦çš„ä¸ƒå¤§æ¨¡å—ï¼š Spring Coreï¼šSpring æ ¸å¿ƒï¼Œå®ƒæ˜¯æ¡†æ¶æœ€åŸºç¡€çš„éƒ¨åˆ†ï¼Œæä¾› IoC å’Œä¾èµ–æ³¨å…¥ DI ç‰¹æ€§ã€‚ Spring Contextï¼šSpring ä¸Šä¸‹æ–‡å®¹å™¨ï¼Œå®ƒæ˜¯ BeanFactory åŠŸèƒ½åŠ å¼ºçš„ä¸€ä¸ªå­æ¥å£ã€‚ Spring Webï¼šå®ƒæä¾› Web åº”ç”¨å¼€å‘çš„æ”¯æŒã€‚ Spring MVCï¼šå®ƒé’ˆå¯¹ Web åº”ç”¨ä¸­ MVC æ€æƒ³çš„å®ç°ã€‚ Spring DAOï¼šæä¾›å¯¹ JDBC æŠ½è±¡å±‚ï¼Œç®€åŒ–äº† JDBC ç¼–ç ï¼ŒåŒæ—¶ï¼Œç¼–ç æ›´å…·æœ‰å¥å£®æ€§ã€‚ Spring ORMï¼šå®ƒæ”¯æŒç”¨äºæµè¡Œçš„ ORM æ¡†æ¶çš„æ•´åˆï¼Œæ¯”å¦‚ï¼šSpring + Hibernateã€Spring + iBatisã€Spring + JDO çš„æ•´åˆç­‰ã€‚ Spring AOPï¼šå³é¢å‘åˆ‡é¢ç¼–ç¨‹ï¼Œå®ƒæä¾›äº†ä¸ AOP è”ç›Ÿå…¼å®¹çš„ç¼–ç¨‹å®ç°ã€‚ 3.Spring æœ‰å“ªäº›å¸¸ç”¨æ³¨è§£å‘¢ï¼ŸSpring æä¾›äº†å¤§é‡çš„æ³¨è§£æ¥ç®€åŒ– Java åº”ç”¨çš„å¼€å‘å’Œé…ç½®ï¼Œä¸»è¦ç”¨äº Web å¼€å‘ã€å¾€å®¹å™¨æ³¨å…¥ Beanã€AOPã€äº‹åŠ¡æ§åˆ¶ç­‰ã€‚ Web å¼€å‘æ–¹é¢æœ‰å“ªäº›æ³¨è§£å‘¢ï¼Ÿâ‘ ã€@Controllerï¼šç”¨äºæ ‡æ³¨æ§åˆ¶å±‚ç»„ä»¶ã€‚â‘¡ã€@RestControllerï¼šæ˜¯@Controller å’Œ @ResponseBody çš„ç»“åˆä½“ï¼Œè¿”å› JSON æ•°æ®æ—¶ä½¿ç”¨ã€‚â‘¢ã€@RequestMappingï¼šç”¨äºæ˜ å°„è¯·æ±‚ URL åˆ°å…·ä½“çš„æ–¹æ³•ä¸Šï¼Œè¿˜å¯ä»¥ç»†åˆ†ä¸ºï¼š@GetMappingï¼šåªèƒ½ç”¨äºå¤„ç† GET è¯·æ±‚@PostMappingï¼šåªèƒ½ç”¨äºå¤„ç† POST è¯·æ±‚@DeleteMappingï¼šåªèƒ½ç”¨äºå¤„ç† DELETE è¯·æ±‚â‘£ã€@ResponseBodyï¼šç›´æ¥å°†è¿”å›çš„æ•°æ®æ”¾å…¥ HTTP å“åº”æ­£æ–‡ä¸­ï¼Œä¸€èˆ¬ç”¨äºè¿”å› JSON æ•°æ®ã€‚â‘¤ã€@RequestBodyï¼šè¡¨ç¤ºä¸€ä¸ªæ–¹æ³•å‚æ•°åº”è¯¥ç»‘å®šåˆ° Web è¯·æ±‚ä½“ã€‚â‘¥ã€@PathVariableï¼šç”¨äºæ¥æ”¶è·¯å¾„å‚æ•°ï¼Œæ¯”å¦‚ @RequestMapping(â€œhello{name}â€)ï¼Œè¿™é‡Œçš„ name å°±æ˜¯è·¯å¾„å‚æ•°ã€‚â‘¦ã€@RequestParamï¼šç”¨äºæ¥æ”¶è¯·æ±‚å‚æ•°ã€‚æ¯”å¦‚ @RequestParam(name â€œkeyâ€) String keyï¼Œè¿™é‡Œçš„ key å°±æ˜¯è¯·æ±‚å‚æ•°ã€‚ å®¹å™¨ç±»æ³¨è§£æœ‰å“ªäº›å‘¢ï¼Ÿ@Componentï¼šæ ‡è¯†ä¸€ä¸ªç±»ä¸º Spring ç»„ä»¶ï¼Œä½¿å…¶èƒ½å¤Ÿè¢« Spring å®¹å™¨è‡ªåŠ¨æ‰«æå’Œç®¡ç†ã€‚@Serviceï¼šæ ‡è¯†ä¸€ä¸ªä¸šåŠ¡é€»è¾‘ç»„ä»¶ï¼ˆæœåŠ¡å±‚ï¼‰ã€‚æ¯”å¦‚ @Service(â€œuserServiceâ€)ï¼Œè¿™é‡Œçš„ userService å°±æ˜¯ Bean çš„åç§°ã€‚@Repositoryï¼šæ ‡è¯†ä¸€ä¸ªæ•°æ®è®¿é—®ç»„ä»¶ï¼ˆæŒä¹…å±‚ï¼‰ã€‚@Autowiredï¼šæŒ‰ç±»å‹è‡ªåŠ¨æ³¨å…¥ä¾èµ–ã€‚@Configurationï¼šç”¨äºå®šä¹‰é…ç½®ç±»ï¼Œå¯æ›¿æ¢ XML é…ç½®æ–‡ä»¶ã€‚@Valueï¼šç”¨äºå°† Spring Boot ä¸­ application.properties é…ç½®çš„å±æ€§å€¼èµ‹å€¼ç»™å˜é‡ã€‚ AOP æ–¹é¢æœ‰å“ªäº›æ³¨è§£å‘¢ï¼Ÿ@Aspect ç”¨äºå£°æ˜ä¸€ä¸ªåˆ‡é¢ï¼Œå¯ä»¥é…åˆå…¶ä»–æ³¨è§£ä¸€èµ·ä½¿ç”¨ï¼Œæ¯”å¦‚ï¼š@Afterï¼šåœ¨æ–¹æ³•æ‰§è¡Œä¹‹åæ‰§è¡Œã€‚@Beforeï¼šåœ¨æ–¹æ³•æ‰§è¡Œä¹‹å‰æ‰§è¡Œã€‚@Aroundï¼šæ–¹æ³•å‰åå‡æ‰§è¡Œã€‚@PointCutï¼šå®šä¹‰åˆ‡ç‚¹ï¼ŒæŒ‡å®šéœ€è¦æ‹¦æˆªçš„æ–¹æ³•ã€‚äº‹åŠ¡æ³¨è§£æœ‰å“ªäº›ï¼Ÿä¸»è¦å°±æ˜¯ @Transactionalï¼Œç”¨äºå£°æ˜ä¸€ä¸ªæ–¹æ³•éœ€è¦äº‹åŠ¡æ”¯æŒã€‚ 4.Spring ä¸­åº”ç”¨äº†å“ªäº›è®¾è®¡æ¨¡å¼å‘¢ï¼ŸSpring æ¡†æ¶ä¸­ç”¨äº†è›®å¤šè®¾è®¡æ¨¡å¼çš„ï¼š â‘ ã€æ¯”å¦‚è¯´å·¥å‚æ¨¡å¼ç”¨äº BeanFactory å’Œ ApplicationContextï¼Œå®ç° Bean çš„åˆ›å»ºå’Œç®¡ç†ã€‚ ApplicationContext context = new ClassPathXmlApplicationContext(applicationContext.xml);MyBean myBean = context.getBean(MyBean.class); â‘¡ã€æ¯”å¦‚è¯´å•ä¾‹æ¨¡å¼ï¼Œè¿™æ ·å¯ä»¥ä¿è¯ Bean çš„å”¯ä¸€æ€§ï¼Œå‡å°‘ç³»ç»Ÿå¼€é”€ã€‚ ApplicationContext context = new AnnotationConfigApplicationContext(AppConfig.class);MyService myService1 = context.getBean(MyService.class);MyService myService2 = context.getBean(MyService.class);// This will print true because both references point to the same instanceSystem.out.println(myService1 == myService2); â‘¢ã€æ¯”å¦‚è¯´ AOP ä½¿ç”¨äº†ä»£ç†æ¨¡å¼æ¥å®ç°æ¨ªåˆ‡å…³æ³¨ç‚¹ï¼ˆå¦‚äº‹åŠ¡ç®¡ç†ã€æ—¥å¿—è®°å½•ã€æƒé™æ§åˆ¶ç­‰ï¼‰ã€‚ @Transactionalpublic void myTransactionalMethod() // æ–¹æ³•å®ç° Springå¦‚ä½•å®ç°å•ä¾‹æ¨¡å¼ï¼ŸSpring é€šè¿‡ IOC å®¹å™¨(æ§åˆ¶åè½¬)å®ç°å•ä¾‹æ¨¡å¼ï¼Œå…·ä½“æ­¥éª¤æ˜¯ï¼š å•ä¾‹ Bean åœ¨å®¹å™¨åˆå§‹åŒ–æ—¶åˆ›å»ºå¹¶ä½¿ç”¨ DefaultSingletonBeanRegistry æä¾›çš„ singletonObjectsè¿›è¡Œç¼“å­˜ã€‚ // å•ä¾‹ç¼“å­˜private final MapString, Object singletonObjects = new ConcurrentHashMap();public Object getSingleton(String beanName) return this.singletonObjects.get(beanName);protected void addSingleton(String beanName, Object singletonObject) this.singletonObjects.put(beanName, singletonObject); åœ¨è¯·æ±‚ Bean æ—¶ï¼ŒSpring ä¼šå…ˆä»ç¼“å­˜ä¸­è·å–ã€‚ 39.Spring å®¹å™¨ã€Web å®¹å™¨ä¹‹é—´çš„åŒºåˆ«ï¼Ÿï¼ˆè¡¥å……ï¼‰Spring å®¹å™¨æ˜¯ Spring æ¡†æ¶çš„æ ¸å¿ƒéƒ¨åˆ†ï¼Œè´Ÿè´£ç®¡ç†åº”ç”¨ç¨‹åºä¸­çš„å¯¹è±¡ç”Ÿå‘½å‘¨æœŸå’Œä¾èµ–æ³¨å…¥ã€‚Web å®¹å™¨ï¼ˆä¹Ÿç§° Servlet å®¹å™¨ï¼‰ï¼Œæ˜¯ç”¨äºè¿è¡Œ Java Web åº”ç”¨ç¨‹åºçš„æœåŠ¡å™¨ç¯å¢ƒï¼Œæ”¯æŒ Servletã€JSP ç­‰ Web ç»„ä»¶ã€‚å¸¸è§çš„ Web å®¹å™¨åŒ…æ‹¬ Apache Tomcatã€Jettyç­‰ã€‚Spring MVC æ˜¯ Spring æ¡†æ¶çš„ä¸€éƒ¨åˆ†ï¼Œä¸“é—¨ç”¨äºå¤„ç† Web è¯·æ±‚ï¼ŒåŸºäº MVCï¼ˆModel-View-Controllerï¼‰è®¾è®¡æ¨¡å¼ã€‚ IoC5.è¯´ä¸€è¯´ä»€ä¹ˆæ˜¯ IoCã€DIï¼Ÿæ‰€è°“çš„IoCï¼Œå°±æ˜¯ç”±å®¹å™¨æ¥æ§åˆ¶å¯¹è±¡çš„ç”Ÿå‘½å‘¨æœŸå’Œå¯¹è±¡ä¹‹é—´çš„å…³ç³»ã€‚æ§åˆ¶å¯¹è±¡ç”Ÿå‘½å‘¨æœŸçš„ä¸å†æ˜¯å¼•ç”¨å®ƒçš„å¯¹è±¡ï¼Œè€Œæ˜¯å®¹å™¨ï¼Œè¿™å°±å«æ§åˆ¶åè½¬ï¼ˆInversion of Controlï¼‰ã€‚ æ²¡æœ‰ IoC ä¹‹å‰ï¼š æˆ‘éœ€è¦ä¸€ä¸ªå¥³æœ‹å‹ï¼Œåˆšå¥½å¤§è¡—ä¸Šçªç„¶çœ‹åˆ°äº†ä¸€ä¸ªå°å§å§ï¼Œäººå¾ˆå¥½çœ‹ï¼Œäºæ˜¯æˆ‘å°±è‡ªå·±ä¸»åŠ¨ä¸Šå»æ­è®ªï¼Œè¦å¥¹çš„å¾®ä¿¡å·ï¼Œæ‰¾æœºä¼šèŠå¤©å…³å¿ƒå¥¹ï¼Œç„¶åçº¦å¥¹å‡ºæ¥åƒé¥­ï¼Œæ‰“å¬å¥¹çš„çˆ±å¥½ï¼Œä¸‰è§‚ã€‚ã€‚ã€‚ æœ‰äº† IoC ä¹‹åï¼š æˆ‘éœ€è¦ä¸€ä¸ªå¥³æœ‹å‹ï¼Œäºæ˜¯æˆ‘å°±å»æ‰¾å©šä»‹æ‰€ï¼Œå‘Šè¯‰å©šä»‹æ‰€ï¼Œæˆ‘éœ€è¦ä¸€ä¸ªé•¿çš„åƒèµµéœ²æ€çš„ï¼Œä¼šæ‰“ Dota2 çš„ï¼Œäºæ˜¯å©šä»‹æ‰€åœ¨å®ƒçš„äººæ‰åº“é‡Œå¼€å§‹æ‰¾ï¼Œæ‰¾ä¸åˆ°å®ƒå°±ç›´æ¥è¯´æ²¡æœ‰ï¼Œæ‰¾åˆ°å®ƒå°±ç›´æ¥ä»‹ç»ç»™æˆ‘ã€‚ å©šä»‹æ‰€å°±ç›¸å½“äºä¸€ä¸ª IoC å®¹å™¨ï¼Œæˆ‘å°±æ˜¯ä¸€ä¸ªå¯¹è±¡ï¼Œæˆ‘éœ€è¦çš„å¥³æœ‹å‹å°±æ˜¯å¦ä¸€ä¸ªå¯¹è±¡ï¼Œæˆ‘ä¸ç”¨å…³å¿ƒå¥³æœ‹å‹æ˜¯æ€ä¹ˆæ¥çš„ï¼Œæˆ‘åªéœ€è¦å‘Šè¯‰å©šä»‹æ‰€æˆ‘éœ€è¦ä»€ä¹ˆæ ·çš„å¥³æœ‹å‹ï¼Œå©šä»‹æ‰€å°±å¸®æˆ‘å»æ‰¾ã€‚ Spring å€¡å¯¼çš„å¼€å‘æ–¹å¼å°±æ˜¯è¿™æ ·ï¼Œæ‰€æœ‰ç±»çš„åˆ›å»ºå’Œé”€æ¯éƒ½é€šè¿‡ Spring å®¹å™¨æ¥ï¼Œä¸å†æ˜¯å¼€å‘è€…å» newï¼Œå» nullï¼Œè¿™æ ·å°±å®ç°äº†å¯¹è±¡çš„è§£è€¦ã€‚ äºæ˜¯ï¼Œå¯¹äºæŸä¸ªå¯¹è±¡æ¥è¯´ï¼Œä»¥å‰æ˜¯å®ƒæ§åˆ¶å®ƒä¾èµ–çš„å¯¹è±¡ï¼Œç°åœ¨æ˜¯æ‰€æœ‰å¯¹è±¡éƒ½è¢« Spring æ§åˆ¶ã€‚ è¯´è¯´ä»€ä¹ˆæ˜¯DI?IOC æ˜¯ä¸€ç§æ€æƒ³ï¼ŒDI æ˜¯å®ç° IOC çš„å…·ä½“æ–¹å¼ï¼Œæ¯”å¦‚è¯´åˆ©ç”¨æ³¨å…¥æœºåˆ¶ï¼ˆå¦‚æ„é€ å™¨æ³¨å…¥ã€Setter æ³¨å…¥ï¼‰å°†ä¾èµ–ä¼ é€’ç»™ç›®æ ‡å¯¹è±¡ã€‚ 2004 å¹´ï¼ŒMartin Fowler åœ¨ä»–çš„æ–‡ç« ã€Šæ§åˆ¶åè½¬å®¹å™¨ä¾èµ–æ³¨å…¥æ¨¡å¼ã€‹é¦–æ¬¡æå‡ºäº† DIï¼ˆä¾èµ–æ³¨å…¥ï¼ŒDependency Injectionï¼‰ è¿™ä¸ªåè¯ã€‚ æ‰“ä¸ªæ¯”æ–¹ï¼Œä½ ç°åœ¨æƒ³åƒéŸ­èœé¦…çš„é¥ºå­ï¼Œè¿™æ—¶å€™å°±æœ‰äººç”¨é’ˆç®¡å¾€ä½ åƒçš„é¥ºå­é‡Œæ³¨å…¥éŸ­èœé¸¡è›‹é¦…ã€‚å°±å¥½åƒ A ç±»éœ€è¦ B ç±»ï¼Œä»¥å‰æ˜¯ A ç±»è‡ªå·± new ä¸€ä¸ª B ç±»ï¼Œç°åœ¨æ˜¯æœ‰äººæŠŠ B ç±»æ³¨å…¥åˆ° A ç±»é‡Œã€‚ ä¸ºä»€ä¹ˆè¦ä½¿ç”¨ IoC å‘¢ï¼Ÿåœ¨å¹³æ—¶çš„ Java å¼€å‘ä¸­ï¼Œå¦‚æœæˆ‘ä»¬è¦å®ç°æŸä¸€ä¸ªåŠŸèƒ½ï¼Œå¯èƒ½è‡³å°‘éœ€è¦ä¸¤ä¸ªä»¥ä¸Šçš„å¯¹è±¡æ¥ååŠ©å®Œæˆï¼Œåœ¨æ²¡æœ‰ Spring ä¹‹å‰ï¼Œæ¯ä¸ªå¯¹è±¡åœ¨éœ€è¦å®ƒçš„åˆä½œå¯¹è±¡æ—¶ï¼Œéœ€è¦è‡ªå·± new ä¸€ä¸ªï¼Œæ¯”å¦‚è¯´ A è¦ä½¿ç”¨ Bï¼ŒA å°±å¯¹ B äº§ç”Ÿäº†ä¾èµ–ï¼Œä¹Ÿå°±æ˜¯ A å’Œ B ä¹‹é—´å­˜åœ¨äº†ä¸€ç§è€¦åˆå…³ç³»ã€‚ æœ‰äº† Spring ä¹‹åï¼Œå°±ä¸ä¸€æ ·äº†ï¼Œåˆ›å»º B çš„å·¥ä½œäº¤ç»™äº† Spring æ¥å®Œæˆï¼ŒSpring åˆ›å»ºå¥½äº† B å¯¹è±¡åå°±æ”¾åˆ°å®¹å™¨ä¸­ï¼ŒA å‘Šè¯‰ Spring æˆ‘éœ€è¦ Bï¼ŒSpring å°±ä»å®¹å™¨ä¸­å–å‡º B äº¤ç»™ A æ¥ä½¿ç”¨ã€‚ è‡³äº B æ˜¯æ€ä¹ˆæ¥çš„ï¼ŒA å°±ä¸å†å…³å¿ƒäº†ï¼ŒSpring å®¹å™¨æƒ³é€šè¿‡ newnew åˆ›å»º B è¿˜æ˜¯ new åˆ›å»º Bï¼Œæ— æ‰€è°“ã€‚ è¿™å°±æ˜¯ IoC çš„å¥½å¤„ï¼Œå®ƒé™ä½äº†å¯¹è±¡ä¹‹é—´çš„è€¦åˆåº¦ï¼Œä½¿å¾—ç¨‹åºæ›´åŠ çµæ´»ï¼Œæ›´åŠ æ˜“äºç»´æŠ¤ã€‚ 6.èƒ½ç®€å•è¯´ä¸€ä¸‹ Spring IoC çš„å®ç°æœºåˆ¶å—ï¼ŸSpring çš„ IoC æœ¬è´¨å°±æ˜¯ä¸€ä¸ªå¤§å·¥å‚ï¼Œæˆ‘ä»¬æƒ³æƒ³ä¸€ä¸ªå·¥å‚æ˜¯æ€ä¹ˆè¿è¡Œçš„å‘¢ï¼Ÿ ç”Ÿäº§äº§å“ï¼šä¸€ä¸ªå·¥å‚æœ€æ ¸å¿ƒçš„åŠŸèƒ½å°±æ˜¯ç”Ÿäº§äº§å“ã€‚åœ¨ Spring é‡Œï¼Œä¸ç”¨ Bean è‡ªå·±æ¥å®ä¾‹åŒ–ï¼Œè€Œæ˜¯äº¤ç»™ Springï¼Œåº”è¯¥æ€ä¹ˆå®ç°å‘¢ï¼Ÿâ€”â€”ç­”æ¡ˆæ¯«æ— ç–‘é—®ï¼Œåå°„ã€‚é‚£ä¹ˆè¿™ä¸ªå‚å­çš„ç”Ÿäº§ç®¡ç†æ˜¯æ€ä¹ˆåšçš„ï¼Ÿä½ åº”è¯¥ä¹ŸçŸ¥é“â€”â€”å·¥å‚æ¨¡å¼ã€‚ åº“å­˜äº§å“ï¼šå·¥å‚ä¸€èˆ¬éƒ½æ˜¯æœ‰åº“æˆ¿çš„ï¼Œç”¨æ¥åº“å­˜äº§å“ï¼Œæ¯•ç«Ÿç”Ÿäº§çš„äº§å“ä¸èƒ½ç«‹é©¬å°±æ‹‰èµ°ã€‚Spring æˆ‘ä»¬éƒ½çŸ¥é“æ˜¯ä¸€ä¸ªå®¹å™¨ï¼Œè¿™ä¸ªå®¹å™¨é‡Œå­˜çš„å°±æ˜¯å¯¹è±¡ï¼Œä¸èƒ½æ¯æ¬¡æ¥å–å¯¹è±¡ï¼Œéƒ½å¾—ç°åœºæ¥åå°„åˆ›å»ºå¯¹è±¡ï¼Œå¾—æŠŠåˆ›å»ºå‡ºçš„å¯¹è±¡å­˜èµ·æ¥ã€‚ è®¢å•å¤„ç†ï¼šè¿˜æœ‰æœ€é‡è¦çš„ä¸€ç‚¹ï¼Œå·¥å‚æ ¹æ®ä»€ä¹ˆæ¥æä¾›äº§å“å‘¢ï¼Ÿè®¢å•ã€‚è¿™äº›è®¢å•å¯èƒ½äº”èŠ±å…«é—¨ï¼Œæœ‰çº¿ä¸Šç­¾ç­¾çš„ã€æœ‰åˆ°å·¥å‚ç­¾çš„ã€è¿˜æœ‰å·¥å‚é”€å”®ä¸Šé—¨ç­¾çš„â€¦â€¦æœ€åç»è¿‡å¤„ç†ï¼ŒæŒ‡å¯¼å·¥å‚çš„å‡ºè´§ã€‚åœ¨ Spring é‡Œï¼Œä¹Ÿæœ‰è¿™æ ·çš„è®¢å•ï¼Œå®ƒå°±æ˜¯æˆ‘ä»¬ bean çš„å®šä¹‰å’Œä¾èµ–å…³ç³»ï¼Œå¯ä»¥æ˜¯ xml å½¢å¼ï¼Œä¹Ÿå¯ä»¥æ˜¯æˆ‘ä»¬æœ€ç†Ÿæ‚‰çš„æ³¨è§£å½¢å¼ã€‚ æˆ‘ä»¬ç®€å•åœ°å®ç°ä¸€ä¸ª mini ç‰ˆçš„ Spring IoCï¼š 7.è¯´è¯´ BeanFactory å’Œ ApplicantContext?å¯ä»¥è¿™ä¹ˆæ¯”å–»ï¼ŒBeanFactory æ˜¯ Spring çš„â€œå¿ƒè„â€ï¼Œè€Œ ApplicantContext æ˜¯ Spring çš„å®Œæ•´â€œèº«èº¯â€ã€‚ BeanFactory ä¸»è¦è´Ÿè´£é…ç½®ã€åˆ›å»ºå’Œç®¡ç† beanï¼Œä¸º Spring æä¾›äº†åŸºæœ¬çš„ä¾èµ–æ³¨å…¥ï¼ˆDIï¼‰æ”¯æŒã€‚ApplicationContext æ˜¯ BeanFactory çš„å­æ¥å£ï¼Œåœ¨ BeanFactory çš„åŸºç¡€ä¸Šæ·»åŠ äº†ä¼ä¸šçº§çš„åŠŸèƒ½æ”¯æŒã€‚ è¯¦ç»†è¯´è¯´ BeanFactoryBeanFactory ä½äºæ•´ä¸ª Spring IoC å®¹å™¨çš„é¡¶ç«¯ï¼ŒApplicationContext ç®—æ˜¯ BeanFactory çš„å­æ¥å£ã€‚ å®ƒæœ€ä¸»è¦çš„æ–¹æ³•å°±æ˜¯ getBean()ï¼Œè¿™ä¸ªæ–¹æ³•è´Ÿè´£ä»å®¹å™¨ä¸­è¿”å›ç‰¹å®šåç§°æˆ–è€…ç±»å‹çš„ Bean å®ä¾‹ã€‚ æ¥çœ‹ä¸€ä¸ª XMLBeanFactoryï¼ˆå·²è¿‡æ—¶ï¼‰ è·å– bean çš„ä¾‹å­ï¼š class HelloWorldApp public static void main(String[] args) BeanFactory factory = new XmlBeanFactory (new ClassPathResource(beans.xml)); HelloWorld obj = (HelloWorld) factory.getBean(itwanger); obj.getMessage(); è¯·è¯¦ç»†è¯´è¯´ ApplicationContextApplicationContext ç»§æ‰¿äº† HierachicalBeanFactory å’Œ ListableBeanFactory æ¥å£ï¼Œç®—æ˜¯ BeanFactory çš„è‡ªåŠ¨æŒ¡ç‰ˆæœ¬ï¼Œæ˜¯ Spring åº”ç”¨çš„é»˜è®¤æ–¹å¼ã€‚ ApplicationContext ä¼šåœ¨å¯åŠ¨æ—¶é¢„å…ˆåˆ›å»ºå’Œé…ç½®æ‰€æœ‰çš„å•ä¾‹ beanï¼Œå¹¶æ”¯æŒå¦‚ JDBCã€ORM æ¡†æ¶çš„é›†æˆï¼Œå†…ç½®é¢å‘åˆ‡é¢ç¼–ç¨‹ï¼ˆAOPï¼‰çš„æ”¯æŒï¼Œå¯ä»¥é…ç½®å£°æ˜å¼äº‹åŠ¡ç®¡ç†ç­‰ã€‚ è¿™æ˜¯ ApplicationContext çš„ä½¿ç”¨ä¾‹å­ï¼š class MainApp public static void main(String[] args) // ä½¿ç”¨ AppConfig é…ç½®ç±»åˆå§‹åŒ– ApplicationContext ApplicationContext context = new AnnotationConfigApplicationContext(AppConfig.class); // ä» ApplicationContext è·å– messageService çš„ bean MessageService service = context.getBean(MessageService.class); // ä½¿ç”¨ bean service.printMessage(); é€šè¿‡ AnnotationConfigApplicationContext ç±»ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨ Java é…ç½®ç±»æ¥åˆå§‹åŒ– ApplicationContextï¼Œè¿™æ ·å°±å¯ä»¥ä½¿ç”¨ Java ä»£ç æ¥é…ç½® Spring å®¹å™¨ã€‚ @Configuration@ComponentScan(basePackages = com.github.paicoding.forum.test.javabetter.spring1) // æ›¿æ¢ä¸ºä½ çš„åŒ…åpublic class AppConfig 8.ä½ çŸ¥é“ Spring å®¹å™¨å¯åŠ¨é˜¶æ®µä¼šå¹²ä»€ä¹ˆå—ï¼ŸSpring çš„ IoC å®¹å™¨å·¥ä½œçš„è¿‡ç¨‹ï¼Œå¯ä»¥åˆ’åˆ†ä¸ºä¸¤ä¸ªé˜¶æ®µï¼šå®¹å™¨å¯åŠ¨é˜¶æ®µå’ŒBean å®ä¾‹åŒ–é˜¶æ®µã€‚å…¶ä¸­å®¹å™¨å¯åŠ¨é˜¶æ®µä¸»è¦åšçš„å·¥ä½œæ˜¯åŠ è½½å’Œè§£æé…ç½®æ–‡ä»¶ï¼Œä¿å­˜åˆ°å¯¹åº”çš„ Bean å®šä¹‰ä¸­ã€‚ å®¹å™¨å¯åŠ¨å¼€å§‹ï¼Œé¦–å…ˆä¼šé€šè¿‡æŸç§é€”å¾„åŠ è½½ Configuration MetaDataï¼Œåœ¨å¤§éƒ¨åˆ†æƒ…å†µä¸‹ï¼Œå®¹å™¨éœ€è¦ä¾èµ–æŸäº›å·¥å…·ç±»ï¼ˆBeanDefinitionReaderï¼‰å¯¹åŠ è½½çš„ Configuration MetaData è¿›è¡Œè§£æå’Œåˆ†æï¼Œå¹¶å°†åˆ†æåçš„ä¿¡æ¯ç»„ä¸ºç›¸åº”çš„ BeanDefinitionã€‚ æœ€åæŠŠè¿™äº›ä¿å­˜äº† Bean å®šä¹‰å¿…è¦ä¿¡æ¯çš„ BeanDefinitionï¼Œæ³¨å†Œåˆ°ç›¸åº”çš„ BeanDefinitionRegistryï¼Œè¿™æ ·å®¹å™¨å¯åŠ¨å°±å®Œæˆäº†ã€‚ è¯´è¯´ Spring çš„ Bean å®ä¾‹åŒ–æ–¹å¼Spring æä¾›äº† 4 ç§ä¸åŒçš„æ–¹å¼æ¥å®ä¾‹åŒ– Beanï¼Œä»¥æ»¡è¶³ä¸åŒåœºæ™¯ä¸‹çš„éœ€æ±‚ã€‚ è¯´è¯´æ„é€ æ–¹æ³•çš„æ–¹å¼åœ¨ç±»ä¸Šä½¿ç”¨@Componentï¼ˆæˆ–@Serviceã€@Repository ç­‰ç‰¹å®šäºåœºæ™¯çš„æ³¨è§£ï¼‰æ ‡æ³¨ç±»ï¼Œç„¶åé€šè¿‡æ„é€ æ–¹æ³•æ³¨å…¥ä¾èµ–ã€‚ @Componentpublic class ExampleBean private DependencyBean dependency; @Autowired public ExampleBean(DependencyBean dependency) this.dependency = dependency; è¯´è¯´é™æ€å·¥å‚çš„æ–¹å¼åœ¨è¿™ç§æ–¹å¼ä¸­ï¼ŒBean æ˜¯ç”±ä¸€ä¸ªé™æ€æ–¹æ³•åˆ›å»ºçš„ï¼Œè€Œä¸æ˜¯ç›´æ¥é€šè¿‡æ„é€ æ–¹æ³•ã€‚ public class ClientService private static ClientService clientService = new ClientService(); private ClientService() public static ClientService createInstance() return clientService; è¯´è¯´å®ä¾‹å·¥å‚æ–¹æ³•å®ä¾‹åŒ–çš„æ–¹å¼ä¸é™æ€å·¥å‚æ–¹æ³•ç›¸æ¯”ï¼Œå®ä¾‹å·¥å‚æ–¹æ³•ä¾èµ–äºæŸä¸ªç±»çš„å®ä¾‹æ¥åˆ›å»º Beanã€‚è¿™é€šå¸¸ç”¨åœ¨éœ€è¦é€šè¿‡å·¥å‚å¯¹è±¡çš„éé™æ€æ–¹æ³•æ¥åˆ›å»º Bean çš„åœºæ™¯ã€‚ public class ServiceLocator public ClientService createClientServiceInstance() return new ClientService(); è¯´è¯´ FactoryBean æ¥å£å®ä¾‹åŒ–æ–¹å¼FactoryBean æ˜¯ä¸€ä¸ªç‰¹æ®Šçš„ Bean ç±»å‹ï¼Œå¯ä»¥åœ¨ Spring å®¹å™¨ä¸­è¿”å›å…¶ä»–å¯¹è±¡çš„å®ä¾‹ã€‚é€šè¿‡å®ç° FactoryBean æ¥å£ï¼Œå¯ä»¥è‡ªå®šä¹‰å®ä¾‹åŒ–é€»è¾‘ï¼Œè¿™å¯¹äºæ„å»ºå¤æ‚çš„åˆå§‹åŒ–é€»è¾‘éå¸¸æœ‰ç”¨ã€‚ public class ToolFactoryBean implements FactoryBeanTool private int factoryId; private int toolId; @Override public Tool getObject() throws Exception return new Tool(toolId); @Override public Class? getObjectType() return Tool.class; @Override public boolean isSingleton() return true; // setter and getter methods for factoryId and toolId 9.ä½ æ˜¯æ€ä¹ˆç†è§£ Bean çš„ï¼ŸBean æ˜¯æŒ‡ç”± Spring å®¹å™¨ç®¡ç†çš„å¯¹è±¡ï¼Œå®ƒçš„ç”Ÿå‘½å‘¨æœŸç”±å®¹å™¨æ§åˆ¶ï¼ŒåŒ…æ‹¬åˆ›å»ºã€åˆå§‹åŒ–ã€ä½¿ç”¨å’Œé”€æ¯ã€‚ä»¥é€šè¿‡ä¸‰ç§æ–¹å¼å£°æ˜ï¼šæ³¨è§£æ–¹å¼ã€XML é…ç½®ã€Java é…ç½®ã€‚ â‘ ã€ä½¿ç”¨ @Componentã€@Serviceã€@Repositoryã€@Controller ç­‰æ³¨è§£å®šä¹‰ï¼Œä¸»æµã€‚ â‘¡ã€åŸºäº XML é…ç½®ï¼ŒSpring Boot é¡¹ç›®å·²ç»ä¸æ€ä¹ˆç”¨äº†ã€‚ â‘¢ã€ä½¿ç”¨ Java é…ç½®ç±»åˆ›å»º Beanï¼š @Configurationpublic class AppConfig @Bean public UserService userService() return new UserService(); @Component å’Œ @Bean çš„åŒºåˆ«@Component æ˜¯ Spring æä¾›çš„ä¸€ä¸ªç±»çº§åˆ«æ³¨è§£ï¼Œç”± Spring è‡ªåŠ¨æ‰«æå¹¶æ³¨å†Œåˆ° Spring å®¹å™¨ä¸­ã€‚@Bean æ˜¯ä¸€ä¸ªæ–¹æ³•çº§åˆ«çš„æ³¨è§£ï¼Œç”¨äºæ˜¾å¼åœ°å£°æ˜ä¸€ä¸ª Beanï¼Œå½“æˆ‘ä»¬éœ€è¦ç¬¬ä¸‰æ–¹åº“æˆ–è€…æ— æ³•ä½¿ç”¨ @Component æ³¨è§£ç±»æ—¶ï¼Œå¯ä»¥ä½¿ç”¨ @Bean æ¥å°†å…¶å®ä¾‹æ³¨å†Œåˆ°å®¹å™¨ä¸­ã€‚ 10.èƒ½è¯´ä¸€ä¸‹ Bean çš„ç”Ÿå‘½å‘¨æœŸå—ï¼Ÿæ¨èé˜…è¯»:https://mp.weixin.qq.com/s/zb6eA3Se0gQoqL8PylCPLw Beançš„ç”Ÿå‘½å‘¨æœŸå¤§è‡´åˆ†ä¸ºäº”ä¸ªé˜¶æ®µï¼š å®ä¾‹åŒ–ï¼šSpring é¦–å…ˆä½¿ç”¨æ„é€ æ–¹æ³•æˆ–è€…å·¥å‚æ–¹æ³•åˆ›å»ºä¸€ä¸ª Bean çš„å®ä¾‹ã€‚åœ¨è¿™ä¸ªé˜¶æ®µï¼ŒBean åªæ˜¯ä¸€ä¸ªç©ºçš„ Java å¯¹è±¡ï¼Œè¿˜æœªè®¾ç½®ä»»ä½•å±æ€§ã€‚ å±æ€§èµ‹å€¼ï¼šSpring å°†é…ç½®æ–‡ä»¶ä¸­çš„å±æ€§å€¼æˆ–ä¾èµ–çš„ Bean æ³¨å…¥åˆ°è¯¥ Bean ä¸­ã€‚è¿™ä¸ªè¿‡ç¨‹ç§°ä¸ºä¾èµ–æ³¨å…¥ï¼Œç¡®ä¿ Bean æ‰€éœ€çš„æ‰€æœ‰ä¾èµ–éƒ½è¢«æ³¨å…¥ã€‚ åˆå§‹åŒ–ï¼šSpring è°ƒç”¨ afterPropertiesSet æ–¹æ³•ï¼Œæˆ–é€šè¿‡é…ç½®æ–‡ä»¶æŒ‡å®šçš„ init-method æ–¹æ³•ï¼Œå®Œæˆåˆå§‹åŒ–ã€‚ ä½¿ç”¨ä¸­ï¼šBean å‡†å¤‡å¥½å¯ä»¥ä½¿ç”¨äº†ã€‚ é”€æ¯ï¼šåœ¨å®¹å™¨å…³é—­æ—¶ï¼ŒSpring ä¼šè°ƒç”¨ destroy æ–¹æ³•ï¼Œå®Œæˆ Bean çš„æ¸…ç†å·¥ä½œã€‚ å¯ä»¥ä»æºç è§’åº¦è®²ä¸€ä¸‹å—ï¼Ÿ å®ä¾‹åŒ–ï¼šSpring å®¹å™¨æ ¹æ® Bean çš„å®šä¹‰åˆ›å»º Bean çš„å®ä¾‹ï¼Œç›¸å½“äºæ‰§è¡Œæ„é€ æ–¹æ³•ï¼Œä¹Ÿå°±æ˜¯ new ä¸€ä¸ªå¯¹è±¡ã€‚ å±æ€§èµ‹å€¼ï¼šç›¸å½“äºæ‰§è¡Œ setter æ–¹æ³•ä¸ºå­—æ®µèµ‹å€¼ã€‚ åˆå§‹åŒ–ï¼šåˆå§‹åŒ–é˜¶æ®µå…è®¸æ‰§è¡Œè‡ªå®šä¹‰çš„é€»è¾‘ï¼Œæ¯”å¦‚è®¾ç½®æŸäº›å¿…è¦çš„å±æ€§å€¼ã€å¼€å¯èµ„æºã€æ‰§è¡Œé¢„åŠ è½½æ“ä½œç­‰ï¼Œä»¥ç¡®ä¿ Bean åœ¨ä½¿ç”¨ä¹‹å‰æ˜¯å®Œå…¨é…ç½®å¥½çš„ã€‚ é”€æ¯ï¼šç›¸å½“äºæ‰§è¡Œ nullï¼Œé‡Šæ”¾èµ„æºã€‚å¯ä»¥åœ¨æºç  AbstractAutowireCapableBeanFactory ä¸­çš„ doCreateBean æ–¹æ³•ä¸­ï¼Œçœ‹åˆ° Bean çš„å‰ä¸‰ä¸ªç”Ÿå‘½å‘¨æœŸï¼šprotected Object doCreateBean(String beanName, RootBeanDefinition mbd, @Nullable Object[] args) throws BeanCreationException BeanWrapper instanceWrapper = null; if (mbd.isSingleton()) instanceWrapper = (BeanWrapper)this.factoryBeanInstanceCache.remove(beanName); if (instanceWrapper == null) // å®ä¾‹åŒ–é˜¶æ®µ instanceWrapper = this.createBeanInstance(beanName, mbd, args); ... Object exposedObject = bean; try // å±æ€§èµ‹å€¼é˜¶æ®µ this.populateBean(beanName, mbd, instanceWrapper); // åˆå§‹åŒ–é˜¶æ®µ exposedObject = this.initializeBean(beanName, exposedObject, mbd); catch (Throwable var18) ... ... æºç ä½ç½®,å¦‚ä¸‹å›¾: è‡³äºé”€æ¯ï¼Œæ˜¯åœ¨å®¹å™¨å…³é—­çš„æ—¶å€™è°ƒç”¨çš„ï¼Œè¯¦è§ ConfigurableApplicationContext çš„ close æ–¹æ³•ã€‚ è¯·åœ¨ä¸€ä¸ªå·²æœ‰çš„ Spring Boot é¡¹ç›®ä¸­é€šè¿‡å•å…ƒæµ‹è¯•çš„å½¢å¼æ¥å±•ç¤º Spring Bean çš„ç”Ÿå‘½å‘¨æœŸï¼Ÿç¬¬ä¸€æ­¥ï¼Œåˆ›å»ºä¸€ä¸ª LifecycleDemoBean ç±»ï¼š public class LifecycleDemoBean implements InitializingBean, DisposableBean // ä½¿ç”¨@Valueæ³¨è§£æ³¨å…¥å±æ€§å€¼ï¼Œè¿™é‡Œæ¼”ç¤ºäº†å¦‚ä½•ä»é…ç½®æ–‡ä»¶ä¸­è¯»å–å€¼ // å¦‚æœé…ç½®æ–‡ä»¶ä¸­æ²¡æœ‰å®šä¹‰lifecycle.demo.bean.nameï¼Œåˆ™ä½¿ç”¨é»˜è®¤å€¼default name @Value($lifecycle.demo.bean.name:default name) private String name; // æ„é€ æ–¹æ³•ï¼šåœ¨Beanå®ä¾‹åŒ–æ—¶è°ƒç”¨ public LifecycleDemoBean() System.out.println(LifecycleDemoBean: å®ä¾‹åŒ–); // å±æ€§èµ‹å€¼ï¼šSpringé€šè¿‡åå°„è°ƒç”¨setteræ–¹æ³•ä¸ºBeançš„å±æ€§æ³¨å…¥å€¼ public void setName(String name) System.out.println(LifecycleDemoBean: å±æ€§èµ‹å€¼); this.name = name; // ä½¿ç”¨@PostConstructæ³¨è§£çš„æ–¹æ³•ï¼šåœ¨Beançš„å±æ€§èµ‹å€¼å®Œæˆåè°ƒç”¨ï¼Œç”¨äºæ‰§è¡Œåˆå§‹åŒ–é€»è¾‘ @PostConstruct public void postConstruct() System.out.println(LifecycleDemoBean: @PostConstructï¼ˆåˆå§‹åŒ–ï¼‰); // å®ç°InitializingBeanæ¥å£ï¼šafterPropertiesSetæ–¹æ³•åœ¨@PostConstructæ³¨è§£çš„æ–¹æ³•ä¹‹åè°ƒç”¨ // ç”¨äºæ‰§è¡Œæ›´å¤šçš„åˆå§‹åŒ–é€»è¾‘ @Override public void afterPropertiesSet() throws Exception System.out.println(LifecycleDemoBean: afterPropertiesSetï¼ˆInitializingBeanï¼‰); // è‡ªå®šä¹‰åˆå§‹åŒ–æ–¹æ³•ï¼šåœ¨XMLé…ç½®æˆ–Javaé…ç½®ä¸­æŒ‡å®šï¼Œæ‰§è¡Œç‰¹å®šçš„åˆå§‹åŒ–é€»è¾‘ public void customInit() System.out.println(LifecycleDemoBean: customInitï¼ˆè‡ªå®šä¹‰åˆå§‹åŒ–æ–¹æ³•ï¼‰); // ä½¿ç”¨@PreDestroyæ³¨è§£çš„æ–¹æ³•ï¼šåœ¨å®¹å™¨é”€æ¯Beanä¹‹å‰è°ƒç”¨ï¼Œç”¨äºæ‰§è¡Œæ¸…ç†å·¥ä½œ @PreDestroy public void preDestroy() System.out.println(LifecycleDemoBean: @PreDestroyï¼ˆé”€æ¯å‰ï¼‰); // å®ç°DisposableBeanæ¥å£ï¼šdestroyæ–¹æ³•åœ¨@PreDestroyæ³¨è§£çš„æ–¹æ³•ä¹‹åè°ƒç”¨ // ç”¨äºæ‰§è¡Œæ¸…ç†èµ„æºç­‰é”€æ¯é€»è¾‘ @Override public void destroy() throws Exception System.out.println(LifecycleDemoBean: destroyï¼ˆDisposableBeanï¼‰); // è‡ªå®šä¹‰é”€æ¯æ–¹æ³•ï¼šåœ¨XMLé…ç½®æˆ–Javaé…ç½®ä¸­æŒ‡å®šï¼Œæ‰§è¡Œç‰¹å®šçš„æ¸…ç†é€»è¾‘ public void customDestroy() System.out.println(LifecycleDemoBean: customDestroyï¼ˆè‡ªå®šä¹‰é”€æ¯æ–¹æ³•ï¼‰); â‘ ã€å®ä¾‹åŒ– å®ä¾‹åŒ–æ˜¯åˆ›å»º Bean å®ä¾‹çš„è¿‡ç¨‹ï¼Œå³åœ¨å†…å­˜ä¸­ä¸º Bean å¯¹è±¡åˆ†é…ç©ºé—´ã€‚è¿™ä¸€æ­¥æ˜¯é€šè¿‡è°ƒç”¨ Bean çš„æ„é€ æ–¹æ³•å®Œæˆçš„ã€‚ public LifecycleDemoBean() System.out.println(LifecycleDemoBean: å®ä¾‹åŒ–); åœ¨è¿™é‡Œï¼Œå½“ Spring åˆ›å»º LifecycleDemoBean çš„å®ä¾‹æ—¶ï¼Œä¼šè°ƒç”¨å…¶æ— å‚æ•°çš„æ„é€ æ–¹æ³•ï¼Œè¿™ä¸ªè¿‡ç¨‹å°±æ˜¯å®ä¾‹åŒ–ã€‚ â‘¡ã€å±æ€§èµ‹å€¼ åœ¨å®ä¾‹åŒ–ä¹‹åï¼ŒSpring å°†æ ¹æ® Bean å®šä¹‰ä¸­çš„é…ç½®ä¿¡æ¯ï¼Œé€šè¿‡åå°„æœºåˆ¶ä¸º Bean çš„å±æ€§èµ‹å€¼ã€‚ @Value($lifecycle.demo.bean.name:default name)private String name;public void setName(String name) System.out.println(LifecycleDemoBean: å±æ€§èµ‹å€¼); this.name = name; @Valueæ³¨è§£å’Œ setter æ–¹æ³•ä½“ç°äº†å±æ€§èµ‹å€¼çš„è¿‡ç¨‹ã€‚@Valueæ³¨è§£è®© Spring æ³¨å…¥é…ç½®å€¼ï¼ˆæˆ–é»˜è®¤å€¼ï¼‰ï¼Œsetter æ–¹æ³•åˆ™æ˜¯å±æ€§èµ‹å€¼çš„å…·ä½“æ“ä½œã€‚ â‘¢ã€åˆå§‹åŒ– åˆå§‹åŒ–é˜¶æ®µå…è®¸æ‰§è¡Œè‡ªå®šä¹‰çš„åˆå§‹åŒ–é€»è¾‘ï¼Œæ¯”å¦‚æ£€æŸ¥å¿…è¦çš„å±æ€§æ˜¯å¦å·²ç»è®¾ç½®ã€å¼€å¯èµ„æºç­‰ã€‚Spring æä¾›äº†å¤šç§æ–¹å¼æ¥é…ç½®åˆå§‹åŒ–é€»è¾‘ã€‚ 1ã€ä½¿ç”¨ @PostConstruct æ³¨è§£çš„æ–¹æ³• @PostConstructpublic void postConstruct() System.out.println(LifecycleDemoBean: @PostConstructï¼ˆåˆå§‹åŒ–ï¼‰);@PostConstructæ³¨è§£çš„æ–¹æ³•åœ¨ Bean çš„æ‰€æœ‰å±æ€§éƒ½è¢«èµ‹å€¼åï¼Œä¸”ç”¨æˆ·è‡ªå®šä¹‰çš„åˆå§‹åŒ–æ–¹æ³•ä¹‹å‰è°ƒç”¨ã€‚ 2ã€å®ç° InitializingBean æ¥å£çš„ afterPropertiesSet æ–¹æ³• @Overridepublic void afterPropertiesSet() throws Exception System.out.println(LifecycleDemoBean: afterPropertiesSetï¼ˆInitializingBeanï¼‰); afterPropertiesSet æ–¹æ³•æä¾›äº†å¦ä¸€ç§åˆå§‹åŒ– Bean çš„æ–¹å¼ï¼Œä¹Ÿæ˜¯åœ¨æ‰€æœ‰å±æ€§èµ‹å€¼åè°ƒç”¨ã€‚ 3ã€è‡ªå®šä¹‰åˆå§‹åŒ–æ–¹æ³• public void customInit() System.out.println(LifecycleDemoBean: customInitï¼ˆè‡ªå®šä¹‰åˆå§‹åŒ–æ–¹æ³•ï¼‰); éœ€è¦åœ¨é…ç½®ç±»ä¸­æŒ‡å®šåˆå§‹åŒ–æ–¹æ³•ï¼š @Bean(initMethod = customInit)public LifecycleDemoBean lifecycleDemoBean() return new LifecycleDemoBean(); â‘£ã€é”€æ¯ é”€æ¯é˜¶æ®µå…è®¸æ‰§è¡Œè‡ªå®šä¹‰çš„é”€æ¯é€»è¾‘ï¼Œæ¯”å¦‚é‡Šæ”¾èµ„æºã€‚ç±»ä¼¼äºåˆå§‹åŒ–é˜¶æ®µï¼ŒSpring ä¹Ÿæä¾›äº†å¤šç§æ–¹å¼æ¥é…ç½®é”€æ¯é€»è¾‘ã€‚ 1ã€ä½¿ç”¨ @PreDestroy æ³¨è§£çš„æ–¹æ³• @PreDestroypublic void preDestroy() System.out.println(LifecycleDemoBean: @PreDestroyï¼ˆé”€æ¯å‰ï¼‰); @PreDestroyæ³¨è§£çš„æ–¹æ³•åœ¨ Bean è¢«é”€æ¯å‰è°ƒç”¨ã€‚ 2ã€å®ç° DisposableBean æ¥å£çš„ destroy æ–¹æ³• @Overridepublic void destroy() throws Exception System.out.println(LifecycleDemoBean: destroyï¼ˆDisposableBeanï¼‰); destroy æ–¹æ³•æä¾›äº†å¦ä¸€ç§é”€æ¯ Bean çš„æ–¹å¼ï¼Œä¹Ÿæ˜¯åœ¨ Bean è¢«é”€æ¯å‰è°ƒç”¨ã€‚ 3ã€è‡ªå®šä¹‰é”€æ¯æ–¹æ³• public void customDestroy() System.out.println(LifecycleDemoBean: customDestroyï¼ˆè‡ªå®šä¹‰é”€æ¯æ–¹æ³•ï¼‰); éœ€è¦åœ¨é…ç½®ç±»ä¸­æŒ‡å®šé”€æ¯æ–¹æ³•ï¼š @Bean(destroyMethod = customDestroy)public LifecycleDemoBean lifecycleDemoBean() return new LifecycleDemoBean(); ç¬¬äºŒæ­¥ï¼Œæ³¨å†Œ Bean å¹¶æŒ‡å®šè‡ªå®šä¹‰åˆå§‹åŒ–æ–¹æ³•å’Œé”€æ¯æ–¹æ³•ï¼š @Configurationpublic class LifecycleDemoConfig @Bean(initMethod = customInit, destroyMethod = customDestroy) public LifecycleDemoBean lifecycleDemoBean() return new LifecycleDemoBean(); ç¬¬ä¸‰æ­¥ï¼Œç¼–å†™å•å…ƒæµ‹è¯•ï¼š @SpringBootTestpublic class LifecycleDemoTest @Autowired private ApplicationContext context; @Test public void testBeanLifecycle() System.out.println(è·å–LifecycleDemoBeanå®ä¾‹...); LifecycleDemoBean bean = context.getBean(LifecycleDemoBean.class); è¿è¡Œå•å…ƒæµ‹è¯•ï¼ŒæŸ¥çœ‹æ§åˆ¶å°è¾“å‡ºï¼š LifecycleDemoBean: å®ä¾‹åŒ–LifecycleDemoBean: @PostConstructï¼ˆåˆå§‹åŒ–ï¼‰LifecycleDemoBean: afterPropertiesSetï¼ˆInitializingBeanï¼‰LifecycleDemoBean: customInitï¼ˆè‡ªå®šä¹‰åˆå§‹åŒ–æ–¹æ³•ï¼‰è·å–LifecycleDemoBeanå®ä¾‹...LifecycleDemoBean: @PreDestroyï¼ˆé”€æ¯å‰ï¼‰LifecycleDemoBean: destroyï¼ˆDisposableBeanï¼‰LifecycleDemoBean: customDestroyï¼ˆè‡ªå®šä¹‰é”€æ¯æ–¹æ³•ï¼‰ Aware ç±»å‹çš„æ¥å£æœ‰ä»€ä¹ˆä½œç”¨ï¼Ÿé€šè¿‡å®ç° Aware æ¥å£ï¼ŒBean å¯ä»¥è·å– Spring å®¹å™¨çš„ç›¸å…³ä¿¡æ¯ï¼Œå¦‚ BeanFactoryã€ApplicationContext ç­‰ã€‚å¸¸è§ Aware æ¥å£æœ‰ï¼š å¦‚æœé…ç½®äº† init-method å’Œ destroy-methodï¼ŒSpring ä¼šåœ¨ä»€ä¹ˆæ—¶å€™è°ƒç”¨å…¶é…ç½®çš„æ–¹æ³•ï¼Ÿinit-method åœ¨ Bean åˆå§‹åŒ–é˜¶æ®µè°ƒç”¨ï¼Œä¾èµ–æ³¨å…¥å®Œæˆåä¸” postProcessBeforeInitialization è°ƒç”¨ä¹‹åæ‰§è¡Œã€‚destroy-method åœ¨ Bean é”€æ¯é˜¶æ®µè°ƒç”¨ï¼Œå®¹å™¨å…³é—­æ—¶è°ƒç”¨ã€‚ 11.ä¸ºä»€ä¹ˆ IDEA ä¸æ¨èä½¿ç”¨ @Autowired æ³¨è§£æ³¨å…¥ Beanï¼Ÿå½“ä½¿ç”¨ @Autowired æ³¨è§£æ³¨å…¥ Bean æ—¶ï¼ŒIDEA ä¼šæç¤ºâ€œField injection is not recommendedâ€ã€‚ è¿™æ˜¯å› ä¸ºå­—æ®µæ³¨å…¥çš„æ–¹å¼ï¼š ä¸èƒ½åƒæ„é€ æ–¹æ³•é‚£æ ·ä½¿ç”¨ final æ³¨å…¥ä¸å¯å˜å¯¹è±¡ éšè—äº†ä¾èµ–å…³ç³»ï¼Œè°ƒç”¨è€…å¯ä»¥çœ‹åˆ°æ„é€ æ–¹æ³•æ³¨å…¥æˆ–è€… setter æ³¨å…¥ï¼Œä½†æ— æ³•çœ‹åˆ°ç§æœ‰å­—æ®µçš„æ³¨å…¥ åœ¨ Spring 4.3 åŠæ›´é«˜ç‰ˆæœ¬ä¸­ï¼Œå¦‚æœä¸€ä¸ªç±»åªæœ‰ä¸€ä¸ªæ„é€ æ–¹æ³•ï¼ŒSpring ä¼šè‡ªåŠ¨ä½¿ç”¨è¯¥æ„é€ æ–¹æ³•è¿›è¡Œä¾èµ–æ³¨å…¥ï¼Œæ— éœ€ä½¿ç”¨ @Autowired æ³¨è§£ã€‚ @Autowired å’Œ @Resource æ³¨è§£çš„åŒºåˆ«ï¼Ÿ @Autowired æ˜¯ Spring æä¾›çš„æ³¨è§£ï¼ŒæŒ‰ç±»å‹ï¼ˆbyTypeï¼‰æ³¨å…¥ã€‚ @Resource æ˜¯ Java EE æä¾›çš„æ³¨è§£ï¼ŒæŒ‰åç§°ï¼ˆbyNameï¼‰æ³¨å…¥ã€‚ è™½ç„¶ IDEA ä¸æ¨èä½¿ç”¨ @Autowiredï¼Œä½†å¯¹ @Resource æ³¨è§£å´æ²¡æœ‰ä»»ä½•æç¤ºã€‚è¿™æ˜¯å› ä¸º @Resource å±äº Java EE æ ‡å‡†çš„æ³¨è§£ï¼Œå¦‚æœä½¿ç”¨å…¶ä»– IOC å®¹å™¨è€Œä¸æ˜¯ Spring ä¹Ÿæ˜¯å¯ä»¥å…¼å®¹çš„ã€‚ æåˆ°äº†byTypeï¼Œå¦‚æœä¸¤ä¸ªç±»å‹ä¸€è‡´çš„å‘ç”Ÿäº†å†²çªï¼Œåº”è¯¥æ€ä¹ˆå¤„ç†å½“å®¹å™¨ä¸­å­˜åœ¨å¤šä¸ªç›¸åŒç±»å‹çš„ beanï¼Œç¼–è¯‘å™¨ä¼šæç¤º Could not autowire. There is more than one bean of UserRepository2 type. @Componentpublic class UserRepository21 implements UserRepository2 @Componentpublic class UserRepository22 implements UserRepository2 @Componentpublic class UserService2 @Autowired private UserRepository2 userRepository; // å†²çª è¿™æ—¶å€™ï¼Œå°±å¯ä»¥é…åˆ @Qualifier æ³¨è§£æ¥æŒ‡å®šå…·ä½“çš„ bean åç§°ï¼š @Component(userRepository21)public class UserRepository21 implements UserRepository2 @Component(userRepository22)public class UserRepository22 implements UserRepository2 @Autowired@Qualifier(userRepository22)private UserRepository2 userRepository22; æˆ–è€…ä½¿ç”¨ @Resource æ³¨è§£æŒ‰åç§°è¿›è¡Œæ³¨å…¥ï¼ŒæŒ‡å®š name å±æ€§ã€‚ @Resource(name = userRepository21)private UserRepository2 userRepository21; 12.Spring æœ‰å“ªäº›è‡ªåŠ¨è£…é…çš„æ–¹å¼ï¼Ÿä»€ä¹ˆæ˜¯è‡ªåŠ¨è£…é…ï¼Ÿ Spring IoC å®¹å™¨çŸ¥é“æ‰€æœ‰ Bean çš„é…ç½®ä¿¡æ¯ï¼Œæ­¤å¤–ï¼Œé€šè¿‡ Java åå°„æœºåˆ¶è¿˜å¯ä»¥è·çŸ¥å®ç°ç±»çš„ç»“æ„ä¿¡æ¯ï¼Œå¦‚æ„é€ æ–¹æ³•çš„ç»“æ„ã€å±æ€§ç­‰ä¿¡æ¯ã€‚æŒæ¡æ‰€æœ‰ Bean çš„è¿™äº›ä¿¡æ¯åï¼ŒSpring IoC å®¹å™¨å°±å¯ä»¥æŒ‰ç…§æŸç§è§„åˆ™å¯¹å®¹å™¨ä¸­çš„ Bean è¿›è¡Œè‡ªåŠ¨è£…é…ï¼Œè€Œæ— é¡»é€šè¿‡æ˜¾å¼çš„æ–¹å¼è¿›è¡Œä¾èµ–é…ç½®ã€‚ Spring æä¾›çš„è¿™ç§æ–¹å¼ï¼Œå¯ä»¥æŒ‰ç…§æŸäº›è§„åˆ™è¿›è¡Œ Bean çš„è‡ªåŠ¨è£…é…ï¼Œbeanå…ƒç´ æä¾›äº†ä¸€ä¸ªæŒ‡å®šè‡ªåŠ¨è£…é…ç±»å‹çš„å±æ€§ï¼šautowire=è‡ªåŠ¨è£…é…ç±»å‹ Spring æä¾›äº†å“ªå‡ ç§è‡ªåŠ¨è£…é…ç±»å‹ï¼Ÿ Spring æä¾›äº† 4 ç§è‡ªåŠ¨è£…é…ç±»å‹ï¼š byNameï¼šæ ¹æ®åç§°è¿›è¡Œè‡ªåŠ¨åŒ¹é…ï¼Œå‡è®¾ Boss æœ‰ä¸€ä¸ªåä¸º car çš„å±æ€§ï¼Œå¦‚æœå®¹å™¨ä¸­åˆšå¥½æœ‰ä¸€ä¸ªåä¸º car çš„ beanï¼ŒSpring å°±ä¼šè‡ªåŠ¨å°†å…¶è£…é…ç»™ Boss çš„ car å±æ€§ byTypeï¼šæ ¹æ®ç±»å‹è¿›è¡Œè‡ªåŠ¨åŒ¹é…ï¼Œå‡è®¾ Boss æœ‰ä¸€ä¸ª Car ç±»å‹çš„å±æ€§ï¼Œå¦‚æœå®¹å™¨ä¸­åˆšå¥½æœ‰ä¸€ä¸ª Car ç±»å‹çš„ Beanï¼ŒSpring å°±ä¼šè‡ªåŠ¨å°†å…¶è£…é…ç»™ Boss è¿™ä¸ªå±æ€§ constructorï¼šä¸ byType ç±»ä¼¼ï¼Œ åªä¸è¿‡å®ƒæ˜¯é’ˆå¯¹æ„é€ å‡½æ•°æ³¨å…¥è€Œè¨€çš„ã€‚å¦‚æœ Boss æœ‰ä¸€ä¸ªæ„é€ å‡½æ•°ï¼Œæ„é€ å‡½æ•°åŒ…å«ä¸€ä¸ª Car ç±»å‹çš„å…¥å‚ï¼Œå¦‚æœå®¹å™¨ä¸­æœ‰ä¸€ä¸ª Car ç±»å‹çš„ Beanï¼Œåˆ™ Spring å°†è‡ªåŠ¨æŠŠè¿™ä¸ª Bean ä½œä¸º Boss æ„é€ å‡½æ•°çš„å…¥å‚ï¼›å¦‚æœå®¹å™¨ä¸­æ²¡æœ‰æ‰¾åˆ°å’Œæ„é€ å‡½æ•°å…¥å‚åŒ¹é…ç±»å‹çš„ Beanï¼Œåˆ™ Spring å°†æŠ›å‡ºå¼‚å¸¸ã€‚ autodetectï¼šæ ¹æ® Bean çš„è‡ªçœæœºåˆ¶å†³å®šé‡‡ç”¨ byType è¿˜æ˜¯ constructor è¿›è¡Œè‡ªåŠ¨è£…é…ï¼Œå¦‚æœ Bean æä¾›äº†é»˜è®¤çš„æ„é€ å‡½æ•°ï¼Œåˆ™é‡‡ç”¨ byTypeï¼Œå¦åˆ™é‡‡ç”¨ constructorã€‚ 13.Bean çš„ä½œç”¨åŸŸæœ‰å“ªäº›?åœ¨ Spring ä¸­ï¼ŒBean é»˜è®¤æ˜¯å•ä¾‹çš„ï¼Œå³åœ¨æ•´ä¸ª Spring å®¹å™¨ä¸­ï¼Œæ¯ä¸ª Bean åªæœ‰ä¸€ä¸ªå®ä¾‹ã€‚å¯ä»¥é€šè¿‡åœ¨é…ç½®ä¸­æŒ‡å®š scope å±æ€§ï¼Œå°† Bean æ”¹ä¸ºå¤šä¾‹ï¼ˆPrototypeï¼‰æ¨¡å¼ï¼Œè¿™æ ·æ¯æ¬¡è·å–çš„éƒ½æ˜¯æ–°çš„å®ä¾‹ã€‚ @Bean@Scope(prototype) // æ¯æ¬¡è·å–éƒ½æ˜¯æ–°çš„å®ä¾‹public MyBean myBean() return new MyBean(); é™¤äº†å•ä¾‹å’Œå¤šä¾‹ï¼ŒSpring è¿˜æ”¯æŒå…¶ä»–ä½œç”¨åŸŸï¼Œå¦‚è¯·æ±‚ä½œç”¨åŸŸï¼ˆRequestï¼‰ã€ä¼šè¯ä½œç”¨åŸŸï¼ˆSessionï¼‰ç­‰ï¼Œé€‚åˆ Web åº”ç”¨ä¸­ç‰¹å®šçš„ä½¿ç”¨åœºæ™¯ã€‚ requestï¼šæ¯ä¸€æ¬¡ HTTP è¯·æ±‚éƒ½ä¼šäº§ç”Ÿä¸€ä¸ªæ–°çš„ Beanï¼Œè¯¥ Bean ä»…åœ¨å½“å‰ HTTP Request å†…æœ‰æ•ˆã€‚ sessionï¼šåŒä¸€ä¸ª Session å…±äº«ä¸€ä¸ª Beanï¼Œä¸åŒçš„ Session ä½¿ç”¨ä¸åŒçš„ Beanã€‚ globalSessionï¼šåŒä¸€ä¸ªå…¨å±€ Session å…±äº«ä¸€ä¸ª Beanï¼Œåªç”¨äºåŸºäº Protlet çš„ Web åº”ç”¨ï¼ŒSpring5 ä¸­å·²ç»ç§»é™¤ã€‚ 14.Spring ä¸­çš„å•ä¾‹ Bean ä¼šå­˜åœ¨çº¿ç¨‹å®‰å…¨é—®é¢˜å—ï¼ŸSpring Bean çš„é»˜è®¤ä½œç”¨åŸŸæ˜¯å•ä¾‹ï¼ˆSingletonï¼‰ï¼Œè¿™æ„å‘³ç€ Spring å®¹å™¨ä¸­åªä¼šå­˜åœ¨ä¸€ä¸ª Bean å®ä¾‹ï¼Œå¹¶ä¸”è¯¥å®ä¾‹ä¼šè¢«å¤šä¸ªçº¿ç¨‹å…±äº«ã€‚ å¦‚æœå•ä¾‹ Bean æ˜¯æ— çŠ¶æ€çš„ï¼Œä¹Ÿå°±æ˜¯æ²¡æœ‰æˆå‘˜å˜é‡ï¼Œé‚£ä¹ˆè¿™ä¸ªå•ä¾‹ Bean æ˜¯çº¿ç¨‹å®‰å…¨çš„ã€‚æ¯”å¦‚ Spring MVC ä¸­çš„ Controllerã€Serviceã€Dao ç­‰ï¼ŒåŸºæœ¬ä¸Šéƒ½æ˜¯æ— çŠ¶æ€çš„ã€‚ ä½†å¦‚æœ Bean çš„å†…éƒ¨çŠ¶æ€æ˜¯å¯å˜çš„ï¼Œä¸”æ²¡æœ‰è¿›è¡Œé€‚å½“çš„åŒæ­¥å¤„ç†ï¼Œå°±å¯èƒ½å‡ºç°çº¿ç¨‹å®‰å…¨é—®é¢˜ã€‚ å•ä¾‹ Bean çº¿ç¨‹å®‰å…¨é—®é¢˜æ€ä¹ˆè§£å†³å‘¢ï¼Ÿç¬¬ä¸€ï¼Œä½¿ç”¨å±€éƒ¨å˜é‡ã€‚å±€éƒ¨å˜é‡æ˜¯çº¿ç¨‹å®‰å…¨çš„ï¼Œå› ä¸ºæ¯ä¸ªçº¿ç¨‹éƒ½æœ‰è‡ªå·±çš„å±€éƒ¨å˜é‡å‰¯æœ¬ã€‚å°½é‡ä½¿ç”¨å±€éƒ¨å˜é‡è€Œä¸æ˜¯å…±äº«çš„æˆå‘˜å˜é‡ã€‚ public class MyService public void process() int localVar = 0; // ä½¿ç”¨å±€éƒ¨å˜é‡è¿›è¡Œæ“ä½œ ç¬¬äºŒï¼Œå°½é‡ä½¿ç”¨æ— çŠ¶æ€çš„ Beanï¼Œå³ä¸åœ¨ Bean ä¸­ä¿å­˜ä»»ä½•å¯å˜çš„çŠ¶æ€ä¿¡æ¯ã€‚ public class MyStatelessService public void process() // æ— çŠ¶æ€å¤„ç† ç¬¬ä¸‰ï¼ŒåŒæ­¥è®¿é—®ã€‚å¦‚æœ Bean ä¸­ç¡®å®éœ€è¦ä¿å­˜å¯å˜çŠ¶æ€ï¼Œå¯ä»¥é€šè¿‡ synchronized å…³é”®å­—æˆ–è€… Lock æ¥å£æ¥ä¿è¯çº¿ç¨‹å®‰å…¨ã€‚ public class MyService private int sharedVar; public synchronized void increment() sharedVar++; æˆ–è€…å°† Bean ä¸­çš„æˆå‘˜å˜é‡ä¿å­˜åˆ° ThreadLocal ä¸­ï¼ŒThreadLocal å¯ä»¥ä¿è¯å¤šçº¿ç¨‹ç¯å¢ƒä¸‹å˜é‡çš„éš”ç¦»ã€‚ public class MyService private ThreadLocalInteger localVar = ThreadLocal.withInitial(() - 0); public void process() localVar.set(localVar.get() + 1); å†æˆ–è€…ä½¿ç”¨çº¿ç¨‹å®‰å…¨çš„å·¥å…·ç±»ï¼Œæ¯”å¦‚è¯´ AtomicIntegerã€ConcurrentHashMapã€CopyOnWriteArrayList ç­‰ã€‚ public class MyService private ConcurrentHashMapString, String map = new ConcurrentHashMap(); public void putValue(String key, String value) map.put(key, value); ç¬¬å››ï¼Œå°† Bean å®šä¹‰ä¸ºåŸå‹ä½œç”¨åŸŸï¼ˆPrototypeï¼‰ã€‚åŸå‹ä½œç”¨åŸŸçš„ Bean æ¯æ¬¡è¯·æ±‚éƒ½ä¼šåˆ›å»ºä¸€ä¸ªæ–°çš„å®ä¾‹ï¼Œå› æ­¤ä¸å­˜åœ¨çº¿ç¨‹å®‰å…¨é—®é¢˜ã€‚ @Component@Scope(prototype)public class MyService // å®ä¾‹å˜é‡ 15.è¯´è¯´å¾ªç¯ä¾èµ–?A ä¾èµ– Bï¼ŒB ä¾èµ– Aï¼Œæˆ–è€… C ä¾èµ– Cï¼Œå°±æˆäº†å¾ªç¯ä¾èµ–ã€‚ å¾ªç¯ä¾èµ–åªå‘ç”Ÿåœ¨ Singleton ä½œç”¨åŸŸçš„ Bean ä¹‹é—´ï¼Œå› ä¸ºå¦‚æœæ˜¯ Prototype ä½œç”¨åŸŸçš„ Beanï¼ŒSpring ä¼šç›´æ¥æŠ›å‡ºå¼‚å¸¸ã€‚ åŸå› å¾ˆç®€å•ï¼ŒAB å¾ªç¯ä¾èµ–ï¼ŒA å®ä¾‹åŒ–çš„æ—¶å€™ï¼Œå‘ç°ä¾èµ– Bï¼Œåˆ›å»º B å®ä¾‹ï¼Œåˆ›å»º B çš„æ—¶å€™å‘ç°éœ€è¦ Aï¼Œåˆ›å»º A1 å®ä¾‹â€¦â€¦æ— é™å¥—å¨ƒã€‚ã€‚ã€‚ã€‚ æˆ‘ä»¬æ¥çœ‹ä¸€ä¸ªå®ä¾‹ï¼Œå…ˆæ˜¯ PrototypeBeanAï¼š @Component@Scope(prototype)public class PrototypeBeanA private final PrototypeBeanB prototypeBeanB; @Autowired public PrototypeBeanA(PrototypeBeanB prototypeBeanB) this.prototypeBeanB = prototypeBeanB; ç„¶åæ˜¯ PrototypeBeanBï¼š @Component@Scope(prototype)public class PrototypeBeanB private final PrototypeBeanA prototypeBeanA; @Autowired public PrototypeBeanB(PrototypeBeanA prototypeBeanA) this.prototypeBeanA = prototypeBeanA; å†ç„¶åæ˜¯æµ‹è¯•ï¼š @SpringBootApplicationpublic class DemoApplication public static void main(String[] args) SpringApplication.run(DemoApplication.class, args); @Bean CommandLineRunner commandLineRunner(ApplicationContext ctx) return args - // å°è¯•è·å–PrototypeBeanAçš„å®ä¾‹ PrototypeBeanA beanA = ctx.getBean(PrototypeBeanA.class); ; Spring å¯ä»¥è§£å†³å“ªäº›æƒ…å†µçš„å¾ªç¯ä¾èµ–ï¼Ÿçœ‹çœ‹è¿™å‡ ç§æƒ…å½¢ï¼ˆAB å¾ªç¯ä¾èµ–ï¼‰ï¼š ä¹Ÿå°±æ˜¯è¯´ï¼š AB å‡é‡‡ç”¨æ„é€ å™¨æ³¨å…¥ï¼Œä¸æ”¯æŒ AB å‡é‡‡ç”¨ setter æ³¨å…¥ï¼Œæ”¯æŒ AB å‡é‡‡ç”¨å±æ€§è‡ªåŠ¨æ³¨å…¥ï¼Œæ”¯æŒ A ä¸­æ³¨å…¥çš„ B ä¸º setter æ³¨å…¥ï¼ŒB ä¸­æ³¨å…¥çš„ A ä¸ºæ„é€ å™¨æ³¨å…¥ï¼Œæ”¯æŒ B ä¸­æ³¨å…¥çš„ A ä¸º setter æ³¨å…¥ï¼ŒA ä¸­æ³¨å…¥çš„ B ä¸ºæ„é€ å™¨æ³¨å…¥ï¼Œä¸æ”¯æŒç¬¬å››ç§å¯ä»¥ï¼Œç¬¬äº”ç§ä¸å¯ä»¥çš„åŸå› æ˜¯ Spring åœ¨åˆ›å»º Bean æ—¶é»˜è®¤ä¼šæ ¹æ®è‡ªç„¶æ’åºè¿›è¡Œåˆ›å»ºï¼Œæ‰€ä»¥ A ä¼šå…ˆäº B è¿›è¡Œåˆ›å»ºã€‚ ç®€å•æ€»ç»“ä¸‹ï¼Œå½“å¾ªç¯ä¾èµ–çš„å®ä¾‹éƒ½é‡‡ç”¨ setter æ–¹æ³•æ³¨å…¥æ—¶ï¼ŒSpring æ”¯æŒï¼Œéƒ½é‡‡ç”¨æ„é€ å™¨æ³¨å…¥çš„æ—¶å€™ï¼Œä¸æ”¯æŒï¼›æ„é€ å™¨æ³¨å…¥å’Œ setter æ³¨å…¥åŒæ—¶å­˜åœ¨çš„æ—¶å€™ï¼Œçœ‹å¤©ï¼ˆğŸ˜‚ï¼‰ã€‚ 16.Spring æ€ä¹ˆè§£å†³å¾ªç¯ä¾èµ–å‘¢ï¼ŸSpring é€šè¿‡ä¸‰çº§ç¼“å­˜æœºåˆ¶æ¥è§£å†³å¾ªç¯ä¾èµ–ï¼š ä¸€çº§ç¼“å­˜ï¼šå­˜æ”¾å®Œå…¨åˆå§‹åŒ–å¥½çš„å•ä¾‹ Beanã€‚ äºŒçº§ç¼“å­˜ï¼šå­˜æ”¾æ­£åœ¨åˆ›å»ºä½†æœªå®Œå…¨åˆå§‹åŒ–çš„ Bean å®ä¾‹ã€‚ ä¸‰çº§ç¼“å­˜ï¼šå­˜æ”¾ Bean å·¥å‚å¯¹è±¡ï¼Œç”¨äºæå‰æš´éœ² Beanã€‚ ä¸‰çº§ç¼“å­˜è§£å†³å¾ªç¯ä¾èµ–çš„è¿‡ç¨‹æ˜¯ä»€ä¹ˆæ ·çš„ï¼Ÿ å®ä¾‹åŒ– Bean æ—¶ï¼Œå°†å…¶æ—©æœŸå¼•ç”¨æ”¾å…¥ä¸‰çº§ç¼“å­˜ã€‚ å…¶ä»–ä¾èµ–è¯¥ Bean çš„å¯¹è±¡ï¼Œå¯ä»¥ä»ç¼“å­˜ä¸­è·å–å…¶å¼•ç”¨ã€‚ åˆå§‹åŒ–å®Œæˆåï¼Œå°† Bean ç§»å…¥ä¸€çº§ç¼“å­˜ã€‚ å‡å¦‚ Aã€B ä¸¤ä¸ªç±»å‘ç”Ÿå¾ªç¯ä¾èµ–. A å®ä¾‹çš„åˆå§‹åŒ–è¿‡ç¨‹ï¼šâ‘ ã€åˆ›å»º A å®ä¾‹ï¼Œå®ä¾‹åŒ–çš„æ—¶å€™æŠŠ A çš„å¯¹è±¡â¼¯â¼šæ”¾â¼Šä¸‰çº§ç¼“å­˜ï¼Œè¡¨ç¤º A å¼€å§‹å®ä¾‹åŒ–äº†ï¼Œè™½ç„¶è¿™ä¸ªå¯¹è±¡è¿˜ä¸å®Œæ•´ï¼Œä½†æ˜¯å…ˆæ›å…‰å‡ºæ¥è®©å¤§å®¶çŸ¥é“ã€‚â‘¡ã€A æ³¨â¼Šå±æ€§æ—¶ï¼Œå‘ç°ä¾èµ– Bï¼Œæ­¤æ—¶ B è¿˜æ²¡æœ‰è¢«åˆ›å»ºå‡ºæ¥ï¼Œæ‰€ä»¥å»å®ä¾‹åŒ– Bã€‚ â‘¢ã€åŒæ ·ï¼ŒB æ³¨â¼Šå±æ€§æ—¶å‘ç°ä¾èµ– Aï¼Œå®ƒå°±ä»ç¼“å­˜é‡Œæ‰¾ A å¯¹è±¡ã€‚ä¾æ¬¡ä»â¼€çº§åˆ°ä¸‰çº§ç¼“å­˜æŸ¥è¯¢ Aã€‚ å‘ç°å¯ä»¥ä»ä¸‰çº§ç¼“å­˜ä¸­é€šè¿‡å¯¹è±¡â¼¯â¼šæ‹¿åˆ° Aï¼Œè™½ç„¶ A ä¸å¤ªå®Œå–„ï¼Œä½†æ˜¯å­˜åœ¨ï¼Œå°±æŠŠ A æ”¾â¼Šâ¼†çº§ç¼“å­˜ï¼ŒåŒæ—¶åˆ é™¤ä¸‰çº§ç¼“å­˜ä¸­çš„ Aï¼Œæ­¤æ—¶ï¼ŒB å·²ç»å®ä¾‹åŒ–å¹¶ä¸”åˆå§‹åŒ–å®Œæˆäº†ï¼ŒæŠŠ B æ”¾å…¥â¼€çº§ç¼“å­˜ã€‚ â‘£ã€æ¥ç€ A ç»§ç»­å±æ€§èµ‹å€¼ï¼Œé¡ºåˆ©ä»â¼€çº§ç¼“å­˜æ‹¿åˆ°å®ä¾‹åŒ–ä¸”åˆå§‹åŒ–å®Œæˆçš„ B å¯¹è±¡ï¼ŒA å¯¹è±¡åˆ›å»ºä¹Ÿå®Œæˆï¼Œåˆ é™¤â¼†çº§ç¼“å­˜ä¸­çš„ Aï¼ŒåŒæ—¶æŠŠ A æ”¾â¼Šâ¼€çº§ç¼“å­˜ â‘¤ã€æœ€åï¼Œâ¼€çº§ç¼“å­˜ä¸­ä¿å­˜ç€å®ä¾‹åŒ–ã€åˆå§‹åŒ–éƒ½å®Œæˆçš„ Aã€B å¯¹è±¡ã€‚ 17.ä¸ºä»€ä¹ˆè¦ä¸‰çº§ç¼“å­˜ï¼Ÿâ¼†çº§ä¸â¾å—ï¼Ÿä¸è¡Œï¼Œä¸»è¦æ˜¯ä¸ºäº† â½£æˆä»£ç†å¯¹è±¡ã€‚å¦‚æœæ˜¯æ²¡æœ‰ä»£ç†çš„æƒ…å†µä¸‹ï¼Œä½¿ç”¨äºŒçº§ç¼“å­˜è§£å†³å¾ªç¯ä¾èµ–ä¹Ÿæ˜¯ OK çš„ã€‚ä½†æ˜¯å¦‚æœå­˜åœ¨ä»£ç†ï¼Œä¸‰çº§æ²¡æœ‰é—®é¢˜ï¼ŒäºŒçº§å°±ä¸è¡Œäº†ã€‚ å› ä¸ºä¸‰çº§ç¼“å­˜ä¸­æ”¾çš„æ˜¯â½£æˆå…·ä½“å¯¹è±¡çš„åŒ¿åå†…éƒ¨ç±»ï¼Œè·å– Object çš„æ—¶å€™ï¼Œå®ƒå¯ä»¥â½£æˆä»£ç†å¯¹è±¡ï¼Œä¹Ÿå¯ä»¥è¿”å›æ™®é€šå¯¹è±¡ã€‚ä½¿â½¤ä¸‰çº§ç¼“å­˜ä¸»è¦æ˜¯ä¸ºäº†ä¿è¯ä¸ç®¡ä»€ä¹ˆæ—¶å€™ä½¿â½¤çš„éƒ½æ˜¯â¼€ä¸ªå¯¹è±¡ã€‚ å‡è®¾åªæœ‰â¼†çº§ç¼“å­˜çš„æƒ…å†µï¼Œå¾€â¼†çº§ç¼“å­˜ä¸­æ”¾çš„æ˜¾ç¤ºâ¼€ä¸ªæ™®é€šçš„ Bean å¯¹è±¡ï¼ŒBean åˆå§‹åŒ–è¿‡ç¨‹ä¸­ï¼Œé€šè¿‡ BeanPostProcessor å»â½£æˆä»£ç†å¯¹è±¡ä¹‹åï¼Œè¦†ç›–æ‰â¼†çº§ç¼“å­˜ä¸­çš„æ™®é€š Bean å¯¹è±¡ï¼Œé‚£ä¹ˆå¯èƒ½å°±å¯¼è‡´å–åˆ°çš„ Bean å¯¹è±¡ä¸ä¸€è‡´äº†ã€‚ å¦‚æœç¼ºå°‘ç¬¬äºŒçº§ç¼“å­˜ä¼šæœ‰ä»€ä¹ˆé—®é¢˜ï¼Ÿå¦‚æœæ²¡æœ‰äºŒçº§ç¼“å­˜ï¼ŒSpring æ— æ³•åœ¨æœªå®Œæˆåˆå§‹åŒ–çš„æƒ…å†µä¸‹æš´éœ² Beanã€‚ä¼šå¯¼è‡´ä»£ç† Bean çš„å¾ªç¯ä¾èµ–é—®é¢˜ï¼Œå› ä¸ºæŸäº›ä»£ç†é€»è¾‘æ— æ³•åœ¨ä¸‰çº§ç¼“å­˜ä¸­æå‰æš´éœ²ã€‚æœ€ç»ˆå¯èƒ½æŠ›å‡º BeanCurrentlyInCreationExceptionã€‚ 18.@Autowired çš„å®ç°åŸç†ï¼Ÿå®ç°@Autowired çš„å…³é”®æ˜¯ï¼šAutowiredAnnotationBeanPostProcessor åœ¨ Bean çš„åˆå§‹åŒ–é˜¶æ®µï¼Œä¼šé€šè¿‡ Bean åç½®å¤„ç†å™¨æ¥è¿›è¡Œä¸€äº›å‰ç½®å’Œåç½®çš„å¤„ç†ã€‚ å®ç°@Autowired çš„åŠŸèƒ½ï¼Œä¹Ÿæ˜¯é€šè¿‡åç½®å¤„ç†å™¨æ¥å®Œæˆçš„ã€‚è¿™ä¸ªåç½®å¤„ç†å™¨å°±æ˜¯ AutowiredAnnotationBeanPostProcessorã€‚ Spring åœ¨åˆ›å»º bean çš„è¿‡ç¨‹ä¸­ï¼Œæœ€ç»ˆä¼šè°ƒç”¨åˆ° doCreateBean()æ–¹æ³•ï¼Œåœ¨ doCreateBean()æ–¹æ³•ä¸­ä¼šè°ƒç”¨ populateBean()æ–¹æ³•ï¼Œæ¥ä¸º bean è¿›è¡Œå±æ€§å¡«å……ï¼Œå®Œæˆè‡ªåŠ¨è£…é…ç­‰å·¥ä½œã€‚ åœ¨ populateBean()æ–¹æ³•ä¸­ä¸€å…±è°ƒç”¨äº†ä¸¤æ¬¡åç½®å¤„ç†å™¨ï¼Œç¬¬ä¸€æ¬¡æ˜¯ä¸ºäº†åˆ¤æ–­æ˜¯å¦éœ€è¦å±æ€§å¡«å……ï¼Œå¦‚æœä¸éœ€è¦è¿›è¡Œå±æ€§å¡«å……ï¼Œé‚£ä¹ˆå°±ä¼šç›´æ¥è¿›è¡Œ returnï¼Œå¦‚æœéœ€è¦è¿›è¡Œå±æ€§å¡«å……ï¼Œé‚£ä¹ˆæ–¹æ³•å°±ä¼šç»§ç»­å‘ä¸‹æ‰§è¡Œï¼Œåé¢ä¼šè¿›è¡Œç¬¬äºŒæ¬¡åç½®å¤„ç†å™¨çš„è°ƒç”¨ï¼Œè¿™ä¸ªæ—¶å€™ï¼Œå°±ä¼šè°ƒç”¨åˆ° AutowiredAnnotationBeanPostProcessor çš„ postProcessPropertyValues()æ–¹æ³•ï¼Œåœ¨è¯¥æ–¹æ³•ä¸­å°±ä¼šè¿›è¡Œ@Autowired æ³¨è§£çš„è§£æï¼Œç„¶åå®ç°è‡ªåŠ¨è£…é…ã€‚ /*** å±æ€§èµ‹å€¼**/protected void populateBean(String beanName, RootBeanDefinition mbd, @Nullable BeanWrapper bw) //â€¦â€¦â€¦â€¦ if (hasInstAwareBpps) if (pvs == null) pvs = mbd.getPropertyValues(); PropertyValues pvsToUse; for(Iterator var9 = this.getBeanPostProcessorCache().instantiationAware.iterator(); var9.hasNext(); pvs = pvsToUse) InstantiationAwareBeanPostProcessor bp = (InstantiationAwareBeanPostProcessor)var9.next(); pvsToUse = bp.postProcessProperties((PropertyValues)pvs, bw.getWrappedInstance(), beanName); if (pvsToUse == null) if (filteredPds == null) filteredPds = this.filterPropertyDescriptorsForDependencyCheck(bw, mbd.allowCaching); //æ‰§è¡Œåå¤„ç†å™¨ï¼Œå¡«å……å±æ€§ï¼Œå®Œæˆè‡ªåŠ¨è£…é… //è°ƒç”¨InstantiationAwareBeanPostProcessorçš„postProcessPropertyValues()æ–¹æ³• pvsToUse = bp.postProcessPropertyValues((PropertyValues)pvs, filteredPds, bw.getWrappedInstance(), beanName); if (pvsToUse == null) return; //â€¦â€¦â€¦â€¦ postProcessorPropertyValues()æ–¹æ³•çš„æºç å¦‚ä¸‹ï¼Œåœ¨è¯¥æ–¹æ³•ä¸­ï¼Œä¼šå…ˆè°ƒç”¨ findAutowiringMetadata()æ–¹æ³•è§£æå‡º bean ä¸­å¸¦æœ‰@Autowired æ³¨è§£ã€@Inject å’Œ@Value æ³¨è§£çš„å±æ€§å’Œæ–¹æ³•ã€‚ç„¶åè°ƒç”¨ metadata.inject()æ–¹æ³•ï¼Œè¿›è¡Œå±æ€§å¡«å……ã€‚ public PropertyValues postProcessProperties(PropertyValues pvs, Object bean, String beanName) //@Autowiredæ³¨è§£ã€@Injectå’Œ@Valueæ³¨è§£çš„å±æ€§å’Œæ–¹æ³• InjectionMetadata metadata = this.findAutowiringMetadata(beanName, bean.getClass(), pvs); try //å±æ€§å¡«å…… metadata.inject(bean, beanName, pvs); return pvs; catch (BeanCreationException var6) throw var6; catch (Throwable var7) throw new BeanCreationException(beanName, Injection of autowired dependencies failed, var7); AOP19.è¯´è¯´ä»€ä¹ˆæ˜¯ AOPï¼ŸAOPï¼Œä¹Ÿå°±æ˜¯é¢å‘åˆ‡é¢ç¼–ç¨‹ï¼Œç®€å•ç‚¹è¯´ï¼ŒAOP å°±æ˜¯æŠŠä¸€äº›ä¸šåŠ¡é€»è¾‘ä¸­çš„ç›¸åŒä»£ç æŠ½å–åˆ°ä¸€ä¸ªç‹¬ç«‹çš„æ¨¡å—ä¸­ï¼Œè®©ä¸šåŠ¡é€»è¾‘æ›´åŠ æ¸…çˆ½ã€‚ ä¸¾ä¸ªä¾‹å­ï¼Œå‡å¦‚æˆ‘ä»¬ç°åœ¨éœ€è¦åœ¨ä¸šåŠ¡ä»£ç å¼€å§‹å‰è¿›è¡Œå‚æ•°æ ¡éªŒï¼Œåœ¨ç»“æŸåæ‰“å°æ—¥å¿—ï¼Œè¯¥æ€ä¹ˆåŠå‘¢ï¼Ÿ æˆ‘ä»¬å¯ä»¥æŠŠæ—¥å¿—è®°å½•å’Œæ•°æ®æ ¡éªŒè¿™ä¸¤ä¸ªåŠŸèƒ½æŠ½å–å‡ºæ¥ï¼Œå½¢æˆä¸€ä¸ªåˆ‡é¢ï¼Œç„¶ååœ¨ä¸šåŠ¡ä»£ç ä¸­å¼•å…¥è¿™ä¸ªåˆ‡é¢ï¼Œè¿™æ ·å°±å¯ä»¥å®ç°ä¸šåŠ¡é€»è¾‘å’Œé€šç”¨é€»è¾‘çš„åˆ†ç¦»ã€‚ ä¸šåŠ¡ä»£ç ä¸å†å…³å¿ƒè¿™äº›é€šç”¨é€»è¾‘ï¼Œåªéœ€è¦å…³å¿ƒè‡ªå·±çš„ä¸šåŠ¡å®ç°ï¼Œè¿™æ ·å°±å®ç°äº†ä¸šåŠ¡é€»è¾‘å’Œé€šç”¨é€»è¾‘çš„åˆ†ç¦»ã€‚ AOP æœ‰å“ªäº›æ ¸å¿ƒæ¦‚å¿µï¼Ÿ åˆ‡é¢ï¼ˆAspectï¼‰ï¼šç±»æ˜¯å¯¹ç‰©ä½“ç‰¹å¾çš„æŠ½è±¡ï¼Œåˆ‡é¢å°±æ˜¯å¯¹æ¨ªåˆ‡å…³æ³¨ç‚¹çš„æŠ½è±¡ è¿æ¥ç‚¹ï¼ˆJoin Pointï¼‰ï¼šè¢«æ‹¦æˆªåˆ°çš„ç‚¹ï¼Œå› ä¸º Spring åªæ”¯æŒæ–¹æ³•ç±»å‹çš„è¿æ¥ç‚¹ï¼Œæ‰€ä»¥åœ¨ Spring ä¸­ï¼Œè¿æ¥ç‚¹æŒ‡çš„æ˜¯è¢«æ‹¦æˆªåˆ°çš„æ–¹æ³•ï¼Œå®é™…ä¸Šè¿æ¥ç‚¹è¿˜å¯ä»¥æ˜¯å­—æ®µæˆ–è€…æ„é€ æ–¹æ³• åˆ‡ç‚¹ï¼ˆPointcutï¼‰ï¼šå¯¹è¿æ¥ç‚¹è¿›è¡Œæ‹¦æˆªçš„å®šä½ é€šçŸ¥ï¼ˆAdviceï¼‰ï¼šæŒ‡æ‹¦æˆªåˆ°è¿æ¥ç‚¹ä¹‹åè¦æ‰§è¡Œçš„ä»£ç ï¼Œä¹Ÿå¯ä»¥ç§°ä½œå¢å¼º ç›®æ ‡å¯¹è±¡ ï¼ˆTargetï¼‰ï¼šä»£ç†çš„ç›®æ ‡å¯¹è±¡ å¼•ä»‹ï¼ˆintroductionï¼‰ï¼šä¸€ç§ç‰¹æ®Šçš„å¢å¼ºï¼Œå¯ä»¥åŠ¨æ€åœ°ä¸ºç±»æ·»åŠ ä¸€äº›å±æ€§å’Œæ–¹æ³• ç»‡å…¥ï¼ˆWeabingï¼‰ï¼šç»‡å…¥æ˜¯å°†å¢å¼ºæ·»åŠ åˆ°ç›®æ ‡ç±»çš„å…·ä½“è¿æ¥ç‚¹ä¸Šçš„è¿‡ç¨‹ã€‚ ç»‡å…¥æœ‰å“ªå‡ ç§æ–¹å¼ï¼Ÿâ‘ ã€ç¼–è¯‘æœŸç»‡å…¥ï¼šåˆ‡é¢åœ¨ç›®æ ‡ç±»ç¼–è¯‘æ—¶è¢«ç»‡å…¥ã€‚ â‘¡ã€ç±»åŠ è½½æœŸç»‡å…¥ï¼šåˆ‡é¢åœ¨ç›®æ ‡ç±»åŠ è½½åˆ° JVM æ—¶è¢«ç»‡å…¥ã€‚éœ€è¦ç‰¹æ®Šçš„ç±»åŠ è½½å™¨ï¼Œå®ƒå¯ä»¥åœ¨ç›®æ ‡ç±»è¢«å¼•å…¥åº”ç”¨ä¹‹å‰å¢å¼ºè¯¥ç›®æ ‡ç±»çš„å­—èŠ‚ç ã€‚ â‘¢ã€è¿è¡ŒæœŸç»‡å…¥ï¼šåˆ‡é¢åœ¨åº”ç”¨è¿è¡Œçš„æŸä¸ªæ—¶åˆ»è¢«ç»‡å…¥ã€‚ä¸€èˆ¬æƒ…å†µä¸‹ï¼Œåœ¨ç»‡å…¥åˆ‡é¢æ—¶ï¼ŒAOP å®¹å™¨ä¼šä¸ºç›®æ ‡å¯¹è±¡åŠ¨æ€åœ°åˆ›å»ºä¸€ä¸ªä»£ç†å¯¹è±¡ã€‚ Spring AOP é‡‡ç”¨è¿è¡ŒæœŸç»‡å…¥ï¼Œè€Œ AspectJ å¯ä»¥åœ¨ç¼–è¯‘æœŸç»‡å…¥å’Œç±»åŠ è½½æ—¶ç»‡å…¥ã€‚ AspectJ æ˜¯ä»€ä¹ˆï¼ŸAspectJ æ˜¯ä¸€ä¸ª AOP æ¡†æ¶ï¼Œå®ƒå¯ä»¥åšå¾ˆå¤š Spring AOP å¹²ä¸äº†çš„äº‹æƒ…ï¼Œæ¯”å¦‚è¯´æ”¯æŒç¼–è¯‘æ—¶ã€ç¼–è¯‘åå’Œç±»åŠ è½½æ—¶ç»‡å…¥åˆ‡é¢ã€‚å¹¶ä¸”æä¾›æ›´å¤æ‚çš„åˆ‡ç‚¹è¡¨è¾¾å¼å’Œé€šçŸ¥ç±»å‹ã€‚ ä¸‹é¢æ˜¯ä¸€ä¸ªç®€å•çš„ AspectJ ç¤ºä¾‹ï¼š // å®šä¹‰ä¸€ä¸ªåˆ‡é¢@Aspectpublic class LoggingAspect // å®šä¹‰ä¸€ä¸ªåˆ‡ç‚¹ï¼ŒåŒ¹é… com.example åŒ…ä¸‹çš„æ‰€æœ‰æ–¹æ³• @Pointcut(execution(* com.example..*(..))) private void selectAll() // å®šä¹‰ä¸€ä¸ªå‰ç½®é€šçŸ¥ï¼Œåœ¨åŒ¹é…çš„æ–¹æ³•æ‰§è¡Œä¹‹å‰æ‰§è¡Œ @Before(selectAll()) public void beforeAdvice() System.out.println(A method is about to be executed.); AOP æœ‰å“ªäº›ç¯ç»•æ–¹å¼ï¼ŸAOP ä¸€èˆ¬æœ‰ 5 ç§ç¯ç»•æ–¹å¼ï¼š å‰ç½®é€šçŸ¥ (@Before) è¿”å›é€šçŸ¥ (@AfterReturning) å¼‚å¸¸é€šçŸ¥ (@AfterThrowing) åç½®é€šçŸ¥ (@After) ç¯ç»•é€šçŸ¥ (@Around) å¤šä¸ªåˆ‡é¢çš„æƒ…å†µä¸‹ï¼Œå¯ä»¥é€šè¿‡ @Order æŒ‡å®šå…ˆåé¡ºåºï¼Œæ•°å­—è¶Šå°ï¼Œä¼˜å…ˆçº§è¶Šé«˜ã€‚ä»£ç ç¤ºä¾‹å¦‚ä¸‹ï¼š @Aspect@Componentpublic class WebLogAspect private final static Logger logger = LoggerFactory.getLogger(WebLogAspect.class); @Pointcut(@annotation(cn.fighter3.spring.aop_demo.WebLog)) public void webLog() @Before(webLog()) public void doBefore(JoinPoint joinPoint) throws Throwable // å¼€å§‹æ‰“å°è¯·æ±‚æ—¥å¿— ServletRequestAttributes attributes = (ServletRequestAttributes) RequestContextHolder.getRequestAttributes(); HttpServletRequest request = attributes.getRequest(); // æ‰“å°è¯·æ±‚ç›¸å…³å‚æ•° logger.info(========================================== Start ==========================================); // æ‰“å°è¯·æ±‚ url logger.info(URL : , request.getRequestURL().toString()); // æ‰“å° Http method logger.info(HTTP Method : , request.getMethod()); // æ‰“å°è°ƒç”¨ controller çš„å…¨è·¯å¾„ä»¥åŠæ‰§è¡Œæ–¹æ³• logger.info(Class Method : ., joinPoint.getSignature().getDeclaringTypeName(), joinPoint.getSignature().getName()); // æ‰“å°è¯·æ±‚çš„ IP logger.info(IP : , request.getRemoteAddr()); // æ‰“å°è¯·æ±‚å…¥å‚ logger.info(Request Args : ,new ObjectMapper().writeValueAsString(joinPoint.getArgs())); @After(webLog()) public void doAfter() throws Throwable // ç»“æŸåæ‰“ä¸ªåˆ†éš”çº¿ï¼Œæ–¹ä¾¿æŸ¥çœ‹ logger.info(=========================================== End ===========================================); @Around(webLog()) public Object doAround(ProceedingJoinPoint proceedingJoinPoint) throws Throwable //å¼€å§‹æ—¶é—´ long startTime = System.currentTimeMillis(); Object result = proceedingJoinPoint.proceed(); // æ‰“å°å‡ºå‚ logger.info(Response Args : , new ObjectMapper().writeValueAsString(result)); // æ‰§è¡Œè€—æ—¶ logger.info(Time-Consuming : ms, System.currentTimeMillis() - startTime); return result; Spring AOP å‘ç”Ÿåœ¨ä»€ä¹ˆæ—¶å€™ï¼ŸSpring AOP åŸºäºè¿è¡Œæ—¶ä»£ç†æœºåˆ¶ï¼Œè¿™æ„å‘³ç€ Spring AOP æ˜¯åœ¨è¿è¡Œæ—¶é€šè¿‡åŠ¨æ€ä»£ç†ç”Ÿæˆçš„ï¼Œè€Œä¸æ˜¯åœ¨ç¼–è¯‘æ—¶æˆ–ç±»åŠ è½½æ—¶ç”Ÿæˆçš„ã€‚ åœ¨ Spring å®¹å™¨åˆå§‹åŒ– Bean çš„è¿‡ç¨‹ä¸­ï¼ŒSpring AOP ä¼šæ£€æŸ¥ Bean æ˜¯å¦éœ€è¦åº”ç”¨åˆ‡é¢ã€‚å¦‚æœéœ€è¦ï¼ŒSpring ä¼šä¸ºè¯¥ Bean åˆ›å»ºä¸€ä¸ªä»£ç†å¯¹è±¡ï¼Œå¹¶åœ¨ä»£ç†å¯¹è±¡ä¸­ç»‡å…¥åˆ‡é¢é€»è¾‘ã€‚è¿™ä¸€è¿‡ç¨‹å‘ç”Ÿåœ¨ Spring å®¹å™¨çš„åå¤„ç†å™¨ï¼ˆBeanPostProcessorï¼‰é˜¶æ®µã€‚ ç®€å•æ€»ç»“ä¸€ä¸‹ AOPAOPï¼Œä¹Ÿå°±æ˜¯é¢å‘åˆ‡é¢ç¼–ç¨‹ï¼Œæ˜¯ä¸€ç§ç¼–ç¨‹èŒƒå¼ï¼Œæ—¨åœ¨æé«˜ä»£ç çš„æ¨¡å—åŒ–ã€‚æ¯”å¦‚è¯´å¯ä»¥å°†æ—¥å¿—è®°å½•ã€äº‹åŠ¡ç®¡ç†ç­‰åˆ†ç¦»å‡ºæ¥ï¼Œæ¥æé«˜ä»£ç çš„å¯é‡ç”¨æ€§ã€‚ AOP çš„æ ¸å¿ƒæ¦‚å¿µåŒ…æ‹¬åˆ‡é¢ï¼ˆAspectï¼‰ã€è¿æ¥ç‚¹ï¼ˆJoin Pointï¼‰ã€é€šçŸ¥ï¼ˆAdviceï¼‰ã€åˆ‡ç‚¹ï¼ˆPointcutï¼‰å’Œç»‡å…¥ï¼ˆWeavingï¼‰ç­‰ã€‚ â‘  åƒæ—¥å¿—æ‰“å°ã€äº‹åŠ¡ç®¡ç†ç­‰éƒ½å¯ä»¥æŠ½ç¦»ä¸ºåˆ‡é¢ï¼Œå¯ä»¥å£°æ˜åœ¨ç±»çš„æ–¹æ³•ä¸Šã€‚åƒ @Transactional æ³¨è§£ï¼Œå°±æ˜¯ä¸€ä¸ªå…¸å‹çš„ AOP åº”ç”¨ï¼Œå®ƒå°±æ˜¯é€šè¿‡ AOP æ¥å®ç°äº‹åŠ¡ç®¡ç†çš„ã€‚æˆ‘ä»¬åªéœ€è¦åœ¨æ–¹æ³•ä¸Šæ·»åŠ  @Transactional æ³¨è§£ï¼ŒSpring å°±ä¼šåœ¨æ–¹æ³•æ‰§è¡Œå‰åæ·»åŠ äº‹åŠ¡ç®¡ç†çš„é€»è¾‘ã€‚ â‘¡ Spring AOP æ˜¯åŸºäºä»£ç†çš„ï¼Œå®ƒé»˜è®¤ä½¿ç”¨ JDK åŠ¨æ€ä»£ç†å’Œ CGLIB ä»£ç†æ¥å®ç° AOPã€‚ â‘¢ Spring AOP çš„ç»‡å…¥æ–¹å¼æ˜¯è¿è¡Œæ—¶ç»‡å…¥ï¼Œè€Œ AspectJ æ”¯æŒç¼–è¯‘æ—¶ç»‡å…¥ã€ç±»åŠ è½½æ—¶ç»‡å…¥ã€‚ AOPå’Œ OOP çš„å…³ç³»ï¼ŸAOP å’Œ OOP æ˜¯äº’è¡¥çš„ç¼–ç¨‹æ€æƒ³ï¼š OOP é€šè¿‡ç±»å’Œå¯¹è±¡å°è£…æ•°æ®å’Œè¡Œä¸ºï¼Œä¸“æ³¨äºæ ¸å¿ƒä¸šåŠ¡é€»è¾‘ã€‚ AOP æä¾›äº†è§£å†³æ¨ªåˆ‡å…³æ³¨ç‚¹ï¼ˆå¦‚æ—¥å¿—ã€æƒé™ã€äº‹åŠ¡ç­‰ï¼‰çš„æœºåˆ¶ï¼Œå°†è¿™äº›é€»è¾‘é›†ä¸­ç®¡ç†ã€‚ 20.AOPçš„ä½¿ç”¨åœºæ™¯æœ‰å“ªäº›ï¼ŸAOP çš„ä½¿ç”¨åœºæ™¯æœ‰å¾ˆå¤šï¼Œæ¯”å¦‚è¯´æ—¥å¿—è®°å½•ã€äº‹åŠ¡ç®¡ç†ã€æƒé™æ§åˆ¶ã€æ€§èƒ½ç›‘æ§ç­‰ã€‚æˆ‘ä»¬åœ¨æŠ€æœ¯æ´¾å®æˆ˜é¡¹ç›®ä¸­ä¸»è¦åˆ©ç”¨ AOP æ¥æ‰“å°æ¥å£çš„å…¥å‚å’Œå‡ºå‚æ—¥å¿—ã€æ‰§è¡Œæ—¶é—´ï¼Œæ–¹ä¾¿åæœŸ bug æº¯æºå’Œæ€§èƒ½è°ƒä¼˜ã€‚ ç¬¬ä¸€æ­¥ï¼Œè‡ªå®šä¹‰æ³¨è§£ä½œä¸ºåˆ‡ç‚¹ @Target(ElementType.METHOD, ElementType.TYPE)@Retention(RetentionPolicy.RUNTIME)@Documentedpublic @interface MdcDot String bizCode() default ; ç¬¬äºŒæ­¥ï¼Œé…ç½® AOP åˆ‡é¢ï¼š@Aspectï¼šæ ‡è¯†åˆ‡é¢@Pointcutï¼šè®¾ç½®åˆ‡ç‚¹ï¼Œè¿™é‡Œä»¥è‡ªå®šä¹‰æ³¨è§£ä¸ºåˆ‡ç‚¹@Aroundï¼šç¯ç»•åˆ‡ç‚¹ï¼Œæ‰“å°æ–¹æ³•ç­¾åå’Œæ‰§è¡Œæ—¶é—´ ç¬¬ä¸‰æ­¥ï¼Œåœ¨ä½¿ç”¨çš„åœ°æ–¹åŠ ä¸Šè‡ªå®šä¹‰æ³¨è§£ ç¬¬å››æ­¥ï¼Œå½“æ¥å£è¢«è°ƒç”¨æ—¶ï¼Œå°±å¯ä»¥çœ‹åˆ°å¯¹åº”çš„æ‰§è¡Œæ—¥å¿—ã€‚ 21.è¯´è¯´ JDK åŠ¨æ€ä»£ç†å’Œ CGLIB ä»£ç†ï¼ŸAOP æ˜¯é€šè¿‡åŠ¨æ€ä»£ç†å®ç°çš„ï¼Œä»£ç†æ–¹å¼æœ‰ä¸¤ç§ï¼šJDK åŠ¨æ€ä»£ç†å’Œ CGLIB ä»£ç†ã€‚ â‘ ã€JDK åŠ¨æ€ä»£ç†æ˜¯åŸºäºæ¥å£çš„ä»£ç†ï¼Œåªèƒ½ä»£ç†å®ç°äº†æ¥å£çš„ç±»ã€‚ ä½¿ç”¨ JDK åŠ¨æ€ä»£ç†æ—¶ï¼ŒSpring AOP ä¼šåˆ›å»ºä¸€ä¸ªä»£ç†å¯¹è±¡ï¼Œè¯¥ä»£ç†å¯¹è±¡å®ç°äº†ç›®æ ‡å¯¹è±¡æ‰€å®ç°çš„æ¥å£ï¼Œå¹¶åœ¨æ–¹æ³•è°ƒç”¨å‰åæ’å…¥æ¨ªåˆ‡é€»è¾‘ã€‚ ä¼˜ç‚¹ï¼šåªéœ€ä¾èµ– JDK è‡ªå¸¦çš„ java.lang.reflect.Proxy ç±»ï¼Œä¸éœ€è¦é¢å¤–çš„åº“ï¼›ç¼ºç‚¹ï¼šåªèƒ½ä»£ç†æ¥å£ï¼Œä¸èƒ½ä»£ç†ç±»æœ¬èº«ã€‚ ç¤ºä¾‹ä»£ç ï¼š public interface Service void perform();public class ServiceImpl implements Service public void perform() System.out.println(Performing service...); public class ServiceInvocationHandler implements InvocationHandler private Object target; public ServiceInvocationHandler(Object target) this.target = target; @Override public Object invoke(Object proxy, Method method, Object[] args) throws Throwable System.out.println(Before method); Object result = method.invoke(target, args); System.out.println(After method); return result; public class Main public static void main(String[] args) Service service = new ServiceImpl(); Service proxy = (Service) Proxy.newProxyInstance( service.getClass().getClassLoader(), service.getClass().getInterfaces(), new ServiceInvocationHandler(service) ); proxy.perform(); â‘¡ã€CGLIB åŠ¨æ€ä»£ç†æ˜¯åŸºäºç»§æ‰¿çš„ä»£ç†ï¼Œå¯ä»¥ä»£ç†æ²¡æœ‰å®ç°æ¥å£çš„ç±»ã€‚ ä½¿ç”¨ CGLIB åŠ¨æ€ä»£ç†æ—¶ï¼ŒSpring AOP ä¼šç”Ÿæˆç›®æ ‡ç±»çš„å­ç±»ï¼Œå¹¶åœ¨æ–¹æ³•è°ƒç”¨å‰åæ’å…¥æ¨ªåˆ‡é€»è¾‘ã€‚ ä¼˜ç‚¹ï¼šå¯ä»¥ä»£ç†æ²¡æœ‰å®ç°æ¥å£çš„ç±»ï¼Œçµæ´»æ€§æ›´é«˜ï¼›ç¼ºç‚¹ï¼šéœ€è¦ä¾èµ– CGLIB åº“ï¼Œåˆ›å»ºä»£ç†å¯¹è±¡çš„å¼€é”€ç›¸å¯¹è¾ƒå¤§ã€‚ public class Service public void perform() System.out.println(Performing service...); public class ServiceInterceptor implements MethodInterceptor @Override public Object intercept(Object obj, Method method, Object[] args, MethodProxy proxy) throws Throwable System.out.println(Before method); Object result = proxy.invokeSuper(obj, args); System.out.println(After method); return result; public class Main public static void main(String[] args) Enhancer enhancer = new Enhancer(); enhancer.setSuperclass(Service.class); enhancer.setCallback(new ServiceInterceptor()); Service proxy = (Service) enhancer.create(); proxy.perform(); é€‰æ‹© CGLIB è¿˜æ˜¯ JDK åŠ¨æ€ä»£ç†ï¼Ÿå¦‚æœç›®æ ‡å¯¹è±¡æ²¡æœ‰å®ç°ä»»ä½•æ¥å£ï¼Œåˆ™åªèƒ½ä½¿ç”¨ CGLIB ä»£ç†ã€‚å¦‚æœç›®æ ‡å¯¹è±¡å®ç°äº†æ¥å£ï¼Œé€šå¸¸é¦–é€‰ JDK åŠ¨æ€ä»£ç†ã€‚è™½ç„¶ CGLIB åœ¨ä»£ç†ç±»çš„ç”Ÿæˆè¿‡ç¨‹ä¸­å¯èƒ½æ¶ˆè€—æ›´å¤šèµ„æºï¼Œä½†åœ¨è¿è¡Œæ—¶å…·æœ‰è¾ƒé«˜çš„æ€§èƒ½ã€‚å¯¹äºæ€§èƒ½æ•æ„Ÿä¸”ä»£ç†å¯¹è±¡åˆ›å»ºé¢‘ç‡ä¸é«˜çš„åœºæ™¯ï¼Œå¯ä»¥è€ƒè™‘ä½¿ç”¨ CGLIBã€‚JDK åŠ¨æ€ä»£ç†æ˜¯ Java åŸç”Ÿæ”¯æŒçš„ï¼Œä¸éœ€è¦é¢å¤–å¼•å…¥åº“ã€‚è€Œ CGLIB éœ€è¦å°† CGLIB åº“ä½œä¸ºä¾èµ–åŠ å…¥é¡¹ç›®ä¸­ã€‚ ä½ ä¼šç”¨ JDK åŠ¨æ€ä»£ç†å’Œ CGLIB å—ï¼Ÿå‡è®¾æˆ‘ä»¬æœ‰è¿™æ ·ä¸€ä¸ªå°åœºæ™¯ï¼Œå®¢æœä¸­è½¬ï¼Œè§£å†³ç”¨æˆ·é—®é¢˜ï¼š â‘ ã€JDK åŠ¨æ€ä»£ç†å®ç°ï¼š ç¬¬ä¸€æ­¥ï¼Œåˆ›å»ºæ¥å£public interface ISolver void solve(); ç¬¬äºŒæ­¥ï¼Œå®ç°å¯¹åº”æ¥å£ public class Solver implements ISolver @Override public void solve() System.out.println(ç–¯ç‹‚æ‰å¤´å‘è§£å†³é—®é¢˜â€¦â€¦); ç¬¬ä¸‰æ­¥ï¼ŒåŠ¨æ€ä»£ç†å·¥å‚:ProxyFactoryï¼Œç›´æ¥ç”¨åå°„æ–¹å¼ç”Ÿæˆä¸€ä¸ªç›®æ ‡å¯¹è±¡çš„ä»£ç†ï¼Œè¿™é‡Œç”¨äº†ä¸€ä¸ªåŒ¿åå†…éƒ¨ç±»æ–¹å¼é‡å†™ InvocationHandler æ–¹æ³•ã€‚public class ProxyFactory // ç»´æŠ¤ä¸€ä¸ªç›®æ ‡å¯¹è±¡ private Object target; public ProxyFactory(Object target) this.target = target; // ä¸ºç›®æ ‡å¯¹è±¡ç”Ÿæˆä»£ç†å¯¹è±¡ public Object getProxyInstance() return Proxy.newProxyInstance(target.getClass().getClassLoader(), target.getClass().getInterfaces(), new InvocationHandler() @Override public Object invoke(Object proxy, Method method, Object[] args) throws Throwable System.out.println(è¯·é—®æœ‰ä»€ä¹ˆå¯ä»¥å¸®åˆ°æ‚¨ï¼Ÿ); // è°ƒç”¨ç›®æ ‡å¯¹è±¡æ–¹æ³• Object returnValue = method.invoke(target, args); System.out.println(é—®é¢˜å·²ç»è§£å†³å•¦ï¼); return null; ); ç¬¬å››æ­¥ï¼Œå®¢æˆ·ç«¯ï¼šClientï¼Œç”Ÿæˆä¸€ä¸ªä»£ç†å¯¹è±¡å®ä¾‹ï¼Œé€šè¿‡ä»£ç†å¯¹è±¡è°ƒç”¨ç›®æ ‡å¯¹è±¡æ–¹æ³•public class Client public static void main(String[] args) //ç›®æ ‡å¯¹è±¡:ç¨‹åºå‘˜ ISolver developer = new Solver(); //ä»£ç†ï¼šå®¢æœå°å§å§ ISolver csProxy = (ISolver) new ProxyFactory(developer).getProxyInstance(); //ç›®æ ‡æ–¹æ³•ï¼šè§£å†³é—®é¢˜ csProxy.solve(); â‘¡ã€CGLIB åŠ¨æ€ä»£ç†å®ç°ï¼š ç¬¬ä¸€æ­¥ï¼šå®šä¹‰ç›®æ ‡ç±»ï¼ˆSolverï¼‰ï¼Œç›®æ ‡ç±» Solver å®šä¹‰äº†ä¸€ä¸ª solve æ–¹æ³•ï¼Œæ¨¡æ‹Ÿäº†è§£å†³é—®é¢˜çš„è¡Œä¸ºã€‚ç›®æ ‡ç±»ä¸éœ€è¦å®ç°ä»»ä½•æ¥å£ï¼Œè¿™ä¸ JDK åŠ¨æ€ä»£ç†çš„è¦æ±‚ä¸åŒã€‚ public class Solver public void solve() System.out.println(ç–¯ç‹‚æ‰å¤´å‘è§£å†³é—®é¢˜â€¦â€¦); ç¬¬äºŒæ­¥ï¼šåŠ¨æ€ä»£ç†å·¥å‚ï¼ˆProxyFactoryï¼‰ï¼ŒProxyFactory ç±»å®ç°äº† MethodInterceptor æ¥å£ï¼Œè¿™æ˜¯ CGLIB æä¾›çš„ä¸€ä¸ªæ–¹æ³•æ‹¦æˆªæ¥å£ï¼Œç”¨äºå®šä¹‰æ–¹æ³•çš„æ‹¦æˆªé€»è¾‘ã€‚public class ProxyFactory implements MethodInterceptor //ç»´æŠ¤ä¸€ä¸ªç›®æ ‡å¯¹è±¡ private Object target; public ProxyFactory(Object target) this.target = target; //ä¸ºç›®æ ‡å¯¹è±¡ç”Ÿæˆä»£ç†å¯¹è±¡ public Object getProxyInstance() //å·¥å…·ç±» Enhancer en = new Enhancer(); //è®¾ç½®çˆ¶ç±» en.setSuperclass(target.getClass()); //è®¾ç½®å›è°ƒå‡½æ•° en.setCallback(this); //åˆ›å»ºå­ç±»å¯¹è±¡ä»£ç† return en.create(); @Override public Object intercept(Object obj, Method method, Object[] args, MethodProxy proxy) throws Throwable System.out.println(è¯·é—®æœ‰ä»€ä¹ˆå¯ä»¥å¸®åˆ°æ‚¨ï¼Ÿ); // æ‰§è¡Œç›®æ ‡å¯¹è±¡çš„æ–¹æ³• Object returnValue = method.invoke(target, args); System.out.println(é—®é¢˜å·²ç»è§£å†³å•¦ï¼); return null; ProxyFactory æ¥æ”¶ä¸€ä¸ª Object ç±»å‹çš„ targetï¼Œå³ç›®æ ‡å¯¹è±¡çš„å®ä¾‹ã€‚ ä½¿ç”¨ CGLIB çš„ Enhancer ç±»æ¥ç”Ÿæˆç›®æ ‡ç±»çš„å­ç±»ï¼ˆä»£ç†å¯¹è±¡ï¼‰ã€‚é€šè¿‡ setSuperclass è®¾ç½®ä»£ç†å¯¹è±¡çš„çˆ¶ç±»ä¸ºç›®æ ‡å¯¹è±¡çš„ç±»ï¼ŒsetCallback è®¾ç½®æ–¹æ³•æ‹¦æˆªå™¨ä¸ºå½“å‰å¯¹è±¡ï¼ˆthisï¼‰ï¼Œæœ€åè°ƒç”¨ create æ–¹æ³•ç”Ÿæˆå¹¶è¿”å›ä»£ç†å¯¹è±¡ã€‚ é‡å†™ MethodInterceptor æ¥å£çš„ intercept æ–¹æ³•ä»¥æä¾›æ–¹æ³•æ‹¦æˆªé€»è¾‘ã€‚åœ¨ç›®æ ‡æ–¹æ³•æ‰§è¡Œå‰åæ·»åŠ è‡ªå®šä¹‰é€»è¾‘ï¼Œç„¶åé€šè¿‡ method.invoke è°ƒç”¨ç›®æ ‡å¯¹è±¡çš„æ–¹æ³•ã€‚ ç¬¬ä¸‰æ­¥ï¼šå®¢æˆ·ç«¯ä½¿ç”¨ä»£ç†ï¼Œé¦–å…ˆåˆ›å»ºç›®æ ‡å¯¹è±¡ï¼ˆSolver çš„å®ä¾‹ï¼‰ï¼Œç„¶åä½¿ç”¨ ProxyFactory åˆ›å»ºè¯¥ç›®æ ‡å¯¹è±¡çš„ä»£ç†ã€‚é€šè¿‡ä»£ç†å¯¹è±¡è°ƒç”¨ solve æ–¹æ³•æ—¶ï¼Œä¼šå…ˆæ‰§è¡Œ intercept æ–¹æ³•ä¸­å®šä¹‰çš„é€»è¾‘ï¼Œç„¶åæ‰§è¡Œç›®æ ‡æ–¹æ³•ï¼Œæœ€åå†æ‰§è¡Œ intercept æ–¹æ³•ä¸­çš„åç»­é€»è¾‘ã€‚public class Client public static void main(String[] args) //ç›®æ ‡å¯¹è±¡:ç¨‹åºå‘˜ Solver developer = new Solver(); //ä»£ç†ï¼šå®¢æœå°å§å§ Solver csProxy = (Solver) new ProxyFactory(developer).getProxyInstance(); //ç›®æ ‡æ–¹æ³•ï¼šè§£å†³é—®é¢˜ csProxy.solve(); 22.è¯´è¯´ Spring AOP å’Œ AspectJ AOP åŒºåˆ«?Spring AOP å±äºè¿è¡Œæ—¶å¢å¼ºï¼Œä¸»è¦å…·æœ‰å¦‚ä¸‹ç‰¹ç‚¹ï¼š åŸºäºåŠ¨æ€ä»£ç†æ¥å®ç°ï¼Œé»˜è®¤å¦‚æœä½¿ç”¨æ¥å£çš„ï¼Œç”¨ JDK æä¾›çš„åŠ¨æ€ä»£ç†å®ç°ï¼Œå¦‚æœæ˜¯æ–¹æ³•åˆ™ä½¿ç”¨ CGLIB å®ç° Spring AOP éœ€è¦ä¾èµ– IoC å®¹å™¨æ¥ç®¡ç†ï¼Œå¹¶ä¸”åªèƒ½ä½œç”¨äº Spring å®¹å™¨ï¼Œä½¿ç”¨çº¯ Java ä»£ç å®ç° åœ¨æ€§èƒ½ä¸Šï¼Œç”±äº Spring AOP æ˜¯åŸºäºåŠ¨æ€ä»£ç†æ¥å®ç°çš„ï¼Œåœ¨å®¹å™¨å¯åŠ¨æ—¶éœ€è¦ç”Ÿæˆä»£ç†å®ä¾‹ï¼Œåœ¨æ–¹æ³•è°ƒç”¨ä¸Šä¹Ÿä¼šå¢åŠ æ ˆçš„æ·±åº¦ï¼Œä½¿å¾— Spring AOP çš„æ€§èƒ½ä¸å¦‚ AspectJ çš„é‚£ä¹ˆå¥½ã€‚ Spring AOP è‡´åŠ›äºè§£å†³ä¼ä¸šçº§å¼€å‘ä¸­æœ€æ™®éçš„ AOP(æ–¹æ³•ç»‡å…¥)ã€‚ AspectJ æ˜¯ä¸€ä¸ªæ˜“ç”¨çš„åŠŸèƒ½å¼ºå¤§çš„ AOP æ¡†æ¶ï¼Œå±äºç¼–è¯‘æ—¶å¢å¼ºï¼Œ å¯ä»¥å•ç‹¬ä½¿ç”¨ï¼Œä¹Ÿå¯ä»¥æ•´åˆåˆ°å…¶å®ƒæ¡†æ¶ä¸­ï¼Œæ˜¯ AOP ç¼–ç¨‹çš„å®Œå…¨è§£å†³æ–¹æ¡ˆã€‚AspectJ éœ€è¦ç”¨åˆ°å•ç‹¬çš„ç¼–è¯‘å™¨ ajcã€‚ AspectJ å±äºé™æ€ç»‡å…¥ï¼Œé€šè¿‡ä¿®æ”¹ä»£ç æ¥å®ç°ï¼Œåœ¨å®é™…è¿è¡Œä¹‹å‰å°±å®Œæˆäº†ç»‡å…¥ï¼Œæ‰€ä»¥è¯´å®ƒç”Ÿæˆçš„ç±»æ˜¯æ²¡æœ‰é¢å¤–è¿è¡Œæ—¶å¼€é”€çš„ï¼Œä¸€èˆ¬æœ‰å¦‚ä¸‹å‡ ä¸ªç»‡å…¥çš„æ—¶æœºï¼š ç¼–è¯‘æœŸç»‡å…¥ï¼ˆCompile-time weavingï¼‰ï¼šå¦‚ç±» A ä½¿ç”¨ AspectJ æ·»åŠ äº†ä¸€ä¸ªå±æ€§ï¼Œç±» B å¼•ç”¨äº†å®ƒï¼Œè¿™ä¸ªåœºæ™¯å°±éœ€è¦ç¼–è¯‘æœŸçš„æ—¶å€™å°±è¿›è¡Œç»‡å…¥ï¼Œå¦åˆ™æ²¡æ³•ç¼–è¯‘ç±» Bã€‚ ç¼–è¯‘åç»‡å…¥ï¼ˆPost-compile weavingï¼‰ï¼šä¹Ÿå°±æ˜¯å·²ç»ç”Ÿæˆäº† .class æ–‡ä»¶ï¼Œæˆ–å·²ç»æ‰“æˆ jar åŒ…äº†ï¼Œè¿™ç§æƒ…å†µæˆ‘ä»¬éœ€è¦å¢å¼ºå¤„ç†çš„è¯ï¼Œå°±è¦ç”¨åˆ°ç¼–è¯‘åç»‡å…¥ã€‚ ç±»åŠ è½½åç»‡å…¥ï¼ˆLoad-time weavingï¼‰ï¼šæŒ‡çš„æ˜¯åœ¨åŠ è½½ç±»çš„æ—¶å€™è¿›è¡Œç»‡å…¥ï¼Œè¦å®ç°è¿™ä¸ªæ—¶æœŸçš„ç»‡å…¥ï¼Œæœ‰å‡ ç§å¸¸è§çš„æ–¹æ³• æ•´ä½“å¯¹æ¯”å¦‚ä¸‹ï¼š 40.è¯´è¯´ AOP å’Œåå°„çš„åŒºåˆ«ï¼Ÿï¼ˆè¡¥å……ï¼‰åå°„ï¼šç”¨äºæ£€æŸ¥å’Œæ“ä½œç±»çš„æ–¹æ³•å’Œå­—æ®µï¼ŒåŠ¨æ€è°ƒç”¨æ–¹æ³•æˆ–è®¿é—®å­—æ®µã€‚åå°„æ˜¯ Java æä¾›çš„å†…ç½®æœºåˆ¶ï¼Œç›´æ¥æ“ä½œç±»å¯¹è±¡ã€‚åŠ¨æ€ä»£ç†ï¼šé€šè¿‡ç”Ÿæˆä»£ç†ç±»æ¥æ‹¦æˆªæ–¹æ³•è°ƒç”¨ï¼Œé€šå¸¸ç”¨äº AOP å®ç°ã€‚åŠ¨æ€ä»£ç†ä½¿ç”¨åå°„æ¥è°ƒç”¨è¢«ä»£ç†çš„æ–¹æ³•ã€‚ äº‹åŠ¡Spring äº‹åŠ¡çš„æœ¬è´¨å…¶å®å°±æ˜¯æ•°æ®åº“å¯¹äº‹åŠ¡çš„æ”¯æŒï¼Œæ²¡æœ‰æ•°æ®åº“çš„äº‹åŠ¡æ”¯æŒï¼ŒSpring æ˜¯æ— æ³•æä¾›äº‹åŠ¡åŠŸèƒ½çš„ã€‚Spring åªæä¾›ç»Ÿä¸€äº‹åŠ¡ç®¡ç†æ¥å£ï¼Œå…·ä½“å®ç°éƒ½æ˜¯ç”±å„æ•°æ®åº“è‡ªå·±å®ç°ï¼Œæ•°æ®åº“äº‹åŠ¡çš„æäº¤å’Œå›æ»šæ˜¯é€šè¿‡æ•°æ®åº“è‡ªå·±çš„äº‹åŠ¡æœºåˆ¶å®ç°ã€‚ 23.Spring äº‹åŠ¡çš„ç§ç±»ï¼Ÿåœ¨ Spring ä¸­ï¼Œäº‹åŠ¡ç®¡ç†å¯ä»¥åˆ†ä¸ºä¸¤å¤§ç±»ï¼šå£°æ˜å¼äº‹åŠ¡ç®¡ç†å’Œç¼–ç¨‹å¼äº‹åŠ¡ç®¡ç†ã€‚ ä»‹ç»ä¸€ä¸‹ç¼–ç¨‹å¼äº‹åŠ¡ç®¡ç†ï¼Ÿç¼–ç¨‹å¼äº‹åŠ¡å¯ä»¥ä½¿ç”¨ TransactionTemplate å’Œ PlatformTransactionManager æ¥å®ç°ï¼Œéœ€è¦æ˜¾å¼æ‰§è¡Œäº‹åŠ¡ã€‚å…è®¸æˆ‘ä»¬åœ¨ä»£ç ä¸­ç›´æ¥æ§åˆ¶äº‹åŠ¡çš„è¾¹ç•Œï¼Œé€šè¿‡ç¼–ç¨‹æ–¹å¼æ˜ç¡®æŒ‡å®šäº‹åŠ¡çš„å¼€å§‹ã€æäº¤å’Œå›æ»šã€‚ public class AccountService private TransactionTemplate transactionTemplate; public void setTransactionTemplate(TransactionTemplate transactionTemplate) this.transactionTemplate = transactionTemplate; public void transfer(final String out, final String in, final Double money) transactionTemplate.execute(new TransactionCallbackWithoutResult() @Override protected void doInTransactionWithoutResult(TransactionStatus status) // è½¬å‡º accountDao.outMoney(out, money); // è½¬å…¥ accountDao.inMoney(in, money); ); åœ¨ä¸Šé¢çš„ä»£ç ä¸­ï¼Œæˆ‘ä»¬ä½¿ç”¨äº† TransactionTemplate æ¥å®ç°ç¼–ç¨‹å¼äº‹åŠ¡ï¼Œé€šè¿‡ execute æ–¹æ³•æ¥æ‰§è¡Œäº‹åŠ¡ï¼Œè¿™æ ·å°±å¯ä»¥åœ¨æ–¹æ³•å†…éƒ¨å®ç°äº‹åŠ¡çš„æ§åˆ¶ã€‚ ä»‹ç»ä¸€ä¸‹å£°æ˜å¼äº‹åŠ¡ç®¡ç†ï¼Ÿå£°æ˜å¼äº‹åŠ¡æ˜¯å»ºç«‹åœ¨ AOP ä¹‹ä¸Šçš„ã€‚å…¶æœ¬è´¨æ˜¯é€šè¿‡ AOP åŠŸèƒ½ï¼Œå¯¹æ–¹æ³•å‰åè¿›è¡Œæ‹¦æˆªï¼Œå°†äº‹åŠ¡å¤„ç†çš„åŠŸèƒ½ç¼–ç»‡åˆ°æ‹¦æˆªçš„æ–¹æ³•ä¸­ï¼Œä¹Ÿå°±æ˜¯åœ¨ç›®æ ‡æ–¹æ³•å¼€å§‹ä¹‹å‰å¯åŠ¨ä¸€ä¸ªäº‹åŠ¡ï¼Œåœ¨ç›®æ ‡æ–¹æ³•æ‰§è¡Œå®Œä¹‹åæ ¹æ®æ‰§è¡Œæƒ…å†µæäº¤æˆ–è€…å›æ»šäº‹åŠ¡ã€‚ ç›¸æ¯”è¾ƒç¼–ç¨‹å¼äº‹åŠ¡ï¼Œä¼˜ç‚¹æ˜¯ä¸éœ€è¦åœ¨ä¸šåŠ¡é€»è¾‘ä»£ç ä¸­æºæ‚äº‹åŠ¡ç®¡ç†çš„ä»£ç ï¼ŒSpring æ¨èé€šè¿‡ @Transactional æ³¨è§£çš„æ–¹å¼æ¥å®ç°å£°æ˜å¼äº‹åŠ¡ç®¡ç†ï¼Œä¹Ÿæ˜¯æ—¥å¸¸å¼€å‘ä¸­æœ€å¸¸ç”¨çš„ã€‚ ä¸è¶³çš„åœ°æ–¹æ˜¯ï¼Œå£°æ˜å¼äº‹åŠ¡ç®¡ç†æœ€ç»†ç²’åº¦åªèƒ½ä½œç”¨åˆ°æ–¹æ³•çº§åˆ«ï¼Œæ— æ³•åƒç¼–ç¨‹å¼äº‹åŠ¡é‚£æ ·å¯ä»¥ä½œç”¨åˆ°ä»£ç å—çº§åˆ«ã€‚ è¯´è¯´ä¸¤è€…çš„åŒºåˆ«ï¼Ÿ ç¼–ç¨‹å¼äº‹åŠ¡ç®¡ç†ï¼šéœ€è¦åœ¨ä»£ç ä¸­æ˜¾å¼è°ƒç”¨äº‹åŠ¡ç®¡ç†çš„ API æ¥æ§åˆ¶äº‹åŠ¡çš„è¾¹ç•Œï¼Œæ¯”è¾ƒçµæ´»ï¼Œä½†æ˜¯ä»£ç ä¾µå…¥æ€§è¾ƒå¼ºï¼Œä¸å¤Ÿä¼˜é›…ã€‚ å£°æ˜å¼äº‹åŠ¡ç®¡ç†ï¼šè¿™ç§æ–¹å¼ä½¿ç”¨ Spring çš„ AOP æ¥å£°æ˜äº‹åŠ¡ï¼Œå°†äº‹åŠ¡ç®¡ç†ä»£ç ä»ä¸šåŠ¡ä»£ç ä¸­åˆ†ç¦»å‡ºæ¥ã€‚ä¼˜ç‚¹æ˜¯ä»£ç ç®€æ´ï¼Œæ˜“äºç»´æŠ¤ã€‚ä½†ç¼ºç‚¹æ˜¯ä¸å¤Ÿçµæ´»ï¼Œåªèƒ½åœ¨é¢„å®šä¹‰çš„æ–¹æ³•ä¸Šä½¿ç”¨äº‹åŠ¡ã€‚ 24.è¯´è¯´ Spring çš„äº‹åŠ¡éš”ç¦»çº§åˆ«ï¼Ÿäº‹åŠ¡çš„éš”ç¦»çº§åˆ«å®šä¹‰äº†ä¸€ä¸ªäº‹åŠ¡å¯èƒ½å—å…¶ä»–å¹¶å‘äº‹åŠ¡å½±å“çš„ç¨‹åº¦ã€‚SQL æ ‡å‡†å®šä¹‰äº†å››ä¸ªéš”ç¦»çº§åˆ«ï¼ŒSpring éƒ½æ”¯æŒï¼Œå¹¶ä¸”æä¾›äº†å¯¹åº”çš„æœºåˆ¶æ¥é…ç½®å®ƒä»¬ï¼Œå®šä¹‰åœ¨ TransactionDefinition æ¥å£ä¸­ã€‚ â‘ ã€ISOLATION_DEFAULTï¼šä½¿ç”¨æ•°æ®åº“é»˜è®¤çš„éš”ç¦»çº§åˆ«ï¼ˆä½ ä»¬çˆ±å’‹å’‹æ»´ ğŸ˜ï¼‰ï¼ŒMySQL é»˜è®¤çš„æ˜¯å¯é‡å¤è¯»ï¼ŒOracle é»˜è®¤çš„è¯»å·²æäº¤ã€‚ â‘¡ã€ISOLATION_READ_UNCOMMITTEDï¼šè¯»æœªæäº¤ï¼Œå…è®¸äº‹åŠ¡è¯»å–æœªè¢«å…¶ä»–äº‹åŠ¡æäº¤çš„æ›´æ”¹ã€‚è¿™æ˜¯éš”ç¦»çº§åˆ«æœ€ä½çš„è®¾ç½®ï¼Œå¯èƒ½ä¼šå¯¼è‡´â€œè„è¯»â€é—®é¢˜ã€‚ â‘¢ã€ISOLATION_READ_COMMITTEDï¼šè¯»å·²æäº¤ï¼Œç¡®ä¿äº‹åŠ¡åªèƒ½è¯»å–å·²ç»è¢«å…¶ä»–äº‹åŠ¡æäº¤çš„æ›´æ”¹ã€‚è¿™å¯ä»¥é˜²æ­¢â€œè„è¯»â€ï¼Œä½†ä»ç„¶å¯èƒ½å‘ç”Ÿâ€œä¸å¯é‡å¤è¯»â€å’Œâ€œå¹»è¯»â€é—®é¢˜ã€‚ â‘£ã€ISOLATION_REPEATABLE_READï¼šå¯é‡å¤è¯»ï¼Œç¡®ä¿äº‹åŠ¡å¯ä»¥å¤šæ¬¡ä»ä¸€ä¸ªå­—æ®µä¸­è¯»å–ç›¸åŒçš„å€¼ï¼Œå³åœ¨è¿™ä¸ªäº‹åŠ¡å†…ï¼Œå…¶ä»–äº‹åŠ¡æ— æ³•æ›´æ”¹è¿™ä¸ªå­—æ®µï¼Œä»è€Œé¿å…äº†â€œä¸å¯é‡å¤è¯»â€ï¼Œä½†ä»å¯èƒ½å‘ç”Ÿâ€œå¹»è¯»â€é—®é¢˜ã€‚ â‘¤ã€ISOLATION_SERIALIZABLEï¼šä¸²è¡ŒåŒ–ï¼Œè¿™æ˜¯æœ€é«˜çš„éš”ç¦»çº§åˆ«ï¼Œå®ƒå®Œå…¨éš”ç¦»äº†äº‹åŠ¡ï¼Œç¡®ä¿äº‹åŠ¡åºåˆ—åŒ–æ‰§è¡Œï¼Œä»¥æ­¤æ¥é¿å…â€œè„è¯»â€ã€â€œä¸å¯é‡å¤è¯»â€å’Œâ€œå¹»è¯»â€é—®é¢˜ï¼Œä½†æ€§èƒ½å½±å“ä¹Ÿæœ€å¤§ã€‚ 25.Spring çš„äº‹åŠ¡ä¼ æ’­æœºåˆ¶ï¼Ÿäº‹åŠ¡çš„ä¼ æ’­æœºåˆ¶å®šä¹‰äº†æ–¹æ³•åœ¨è¢«å¦ä¸€ä¸ªäº‹åŠ¡æ–¹æ³•è°ƒç”¨æ—¶çš„äº‹åŠ¡è¡Œä¸ºï¼Œè¿™äº›è¡Œä¸ºå®šä¹‰äº†äº‹åŠ¡çš„è¾¹ç•Œå’Œäº‹åŠ¡ä¸Šä¸‹æ–‡å¦‚ä½•åœ¨æ–¹æ³•è°ƒç”¨é“¾ä¸­ä¼ æ’­ã€‚ Spring çš„é»˜è®¤ä¼ æ’­è¡Œä¸ºæ˜¯ PROPAGATION_REQUIREDï¼Œå³å¦‚æœå½“å‰å­˜åœ¨äº‹åŠ¡ï¼Œåˆ™åŠ å…¥è¯¥äº‹åŠ¡ï¼›å¦‚æœå½“å‰æ²¡æœ‰äº‹åŠ¡ï¼Œåˆ™åˆ›å»ºä¸€ä¸ªæ–°çš„äº‹åŠ¡ã€‚ äº‹åŠ¡ä¼ æ’­æœºåˆ¶æ˜¯ä½¿ç”¨ ThreadLocal å®ç°çš„ï¼Œæ‰€ä»¥ï¼Œå¦‚æœè°ƒç”¨çš„æ–¹æ³•æ˜¯åœ¨æ–°çº¿ç¨‹ä¸­ï¼Œäº‹åŠ¡ä¼ æ’­ä¼šå¤±æ•ˆã€‚ @Transactionalpublic void parentMethod() new Thread(() - childMethod()).start();public void childMethod() // è¿™é‡Œçš„æ“ä½œå°†ä¸ä¼šåœ¨ parentMethod çš„äº‹åŠ¡èŒƒå›´å†…æ‰§è¡Œ Spring é»˜è®¤çš„äº‹åŠ¡ä¼ æ’­è¡Œä¸ºæ˜¯ PROPAFATION_REQUIREDï¼Œå³å¦‚æœå¤šä¸ªÂ ServiceX#methodX()Â éƒ½å·¥ä½œåœ¨äº‹åŠ¡ç¯å¢ƒä¸‹ï¼Œä¸”ç¨‹åºä¸­å­˜åœ¨è¿™æ ·çš„è°ƒç”¨é“¾Â Service1#method1()-Service2#method2()-Service3#method3()ï¼Œé‚£ä¹ˆè¿™ 3 ä¸ªæœåŠ¡ç±»çš„ 3 ä¸ªæ–¹æ³•éƒ½é€šè¿‡ Spring çš„äº‹åŠ¡ä¼ æ’­æœºåˆ¶å·¥ä½œåœ¨åŒä¸€ä¸ªäº‹åŠ¡ä¸­ã€‚ protected å’Œ private åŠ äº‹åŠ¡ä¼šç”Ÿæ•ˆå—åœ¨ Spring ä¸­ï¼Œåªæœ‰é€šè¿‡ Spring å®¹å™¨çš„ AOP ä»£ç†è°ƒç”¨çš„å…¬å¼€æ–¹æ³•ï¼ˆpublic methodï¼‰ä¸Šçš„@Transactionalæ³¨è§£æ‰ä¼šç”Ÿæ•ˆã€‚ å¦‚æœåœ¨ protectedã€private æ–¹æ³•ä¸Šä½¿ç”¨@Transactionalï¼Œè¿™äº›äº‹åŠ¡æ³¨è§£å°†ä¸ä¼šç”Ÿæ•ˆï¼ŒåŸå› ï¼šSpring é»˜è®¤ä½¿ç”¨åŸºäº JDK çš„åŠ¨æ€ä»£ç†ï¼ˆå½“æ¥å£å­˜åœ¨æ—¶ï¼‰æˆ–åŸºäº CGLIB çš„ä»£ç†ï¼ˆå½“åªæœ‰ç±»æ—¶ï¼‰æ¥å®ç°äº‹åŠ¡ã€‚è¿™ä¸¤ç§ä»£ç†æœºåˆ¶éƒ½åªèƒ½ä»£ç†å…¬å¼€çš„æ–¹æ³•ã€‚ 26.å£°æ˜å¼äº‹åŠ¡å®ç°åŸç†äº†è§£å—ï¼ŸSpring çš„å£°æ˜å¼äº‹åŠ¡ç®¡ç†æ˜¯é€šè¿‡ AOPï¼ˆé¢å‘åˆ‡é¢ç¼–ç¨‹ï¼‰å’Œä»£ç†æœºåˆ¶å®ç°çš„ã€‚ ç¬¬ä¸€æ­¥ï¼Œåœ¨ Bean åˆå§‹åŒ–é˜¶æ®µåˆ›å»ºä»£ç†å¯¹è±¡ï¼š Spring å®¹å™¨åœ¨åˆå§‹åŒ–å•ä¾‹ Bean çš„æ—¶å€™ï¼Œä¼šéå†æ‰€æœ‰çš„ BeanPostProcessor å®ç°ç±»ï¼Œå¹¶æ‰§è¡Œå…¶ postProcessAfterInitialization æ–¹æ³•ã€‚ åœ¨æ‰§è¡Œ postProcessAfterInitialization æ–¹æ³•æ—¶ä¼šéå†å®¹å™¨ä¸­æ‰€æœ‰çš„åˆ‡é¢ï¼ŒæŸ¥æ‰¾ä¸å½“å‰ Bean åŒ¹é…çš„åˆ‡é¢ï¼Œè¿™é‡Œä¼šè·å–äº‹åŠ¡çš„å±æ€§åˆ‡é¢ï¼Œä¹Ÿå°±æ˜¯Â @TransactionalÂ æ³¨è§£åŠå…¶å±æ€§å€¼ã€‚ ç„¶åæ ¹æ®å¾—åˆ°çš„åˆ‡é¢åˆ›å»ºä¸€ä¸ªä»£ç†å¯¹è±¡ï¼Œé»˜è®¤ä½¿ç”¨ JDK åŠ¨æ€ä»£ç†åˆ›å»ºä»£ç†ï¼Œå¦‚æœç›®æ ‡ç±»æ˜¯æ¥å£ï¼Œåˆ™ä½¿ç”¨ JDK åŠ¨æ€ä»£ç†ï¼Œå¦åˆ™ä½¿ç”¨ Cglibã€‚ ç¬¬äºŒæ­¥ï¼Œåœ¨æ‰§è¡Œç›®æ ‡æ–¹æ³•æ—¶è¿›è¡Œäº‹åŠ¡å¢å¼ºæ“ä½œï¼š å½“é€šè¿‡ä»£ç†å¯¹è±¡è°ƒç”¨ Bean æ–¹æ³•çš„æ—¶å€™ï¼Œä¼šè§¦å‘å¯¹åº”çš„ AOP å¢å¼ºæ‹¦æˆªå™¨ï¼Œå£°æ˜å¼äº‹åŠ¡æ˜¯ä¸€ç§ç¯ç»•å¢å¼ºï¼Œå¯¹åº”æ¥å£ä¸ºMethodInterceptorï¼Œäº‹åŠ¡å¢å¼ºå¯¹è¯¥æ¥å£çš„å®ç°ä¸ºTransactionInterceptorï¼Œç±»å›¾å¦‚ä¸‹ï¼š äº‹åŠ¡æ‹¦æˆªå™¨TransactionInterceptoråœ¨invokeæ–¹æ³•ä¸­ï¼Œé€šè¿‡è°ƒç”¨çˆ¶ç±»TransactionAspectSupportçš„invokeWithinTransactionæ–¹æ³•è¿›è¡Œäº‹åŠ¡å¤„ç†ï¼ŒåŒ…æ‹¬å¼€å¯äº‹åŠ¡ã€äº‹åŠ¡æäº¤ã€å¼‚å¸¸å›æ»šç­‰ã€‚ 27.å£°æ˜å¼äº‹åŠ¡åœ¨å“ªäº›æƒ…å†µä¸‹ä¼šå¤±æ•ˆï¼Ÿ 1ã€@Transactional åº”ç”¨åœ¨é public ä¿®é¥°çš„æ–¹æ³•ä¸Š å¦‚æœ Transactional æ³¨è§£åº”ç”¨åœ¨é public ä¿®é¥°çš„æ–¹æ³•ä¸Šï¼ŒTransactional å°†ä¼šå¤±æ•ˆã€‚ æ˜¯å› ä¸ºåœ¨ Spring AOP ä»£ç†æ—¶ï¼ŒTransactionInterceptor ï¼ˆäº‹åŠ¡æ‹¦æˆªå™¨ï¼‰åœ¨ç›®æ ‡æ–¹æ³•æ‰§è¡Œå‰åè¿›è¡Œæ‹¦æˆªï¼ŒDynamicAdvisedInterceptorï¼ˆCglibAopProxy çš„å†…éƒ¨ç±»ï¼‰çš„ intercept æ–¹æ³•æˆ– JdkDynamicAopProxy çš„ invoke æ–¹æ³•ä¼šé—´æ¥è°ƒç”¨ AbstractFallbackTransactionAttributeSource çš„ computeTransactionAttributeæ–¹æ³•ï¼Œè·å– Transactional æ³¨è§£çš„äº‹åŠ¡é…ç½®ä¿¡æ¯ã€‚ protected TransactionAttribute computeTransactionAttribute(Method method, Class? targetClass) // Dont allow no-public methods as required. if (allowPublicMethodsOnly() !Modifier.isPublic(method.getModifiers())) return null; æ­¤æ–¹æ³•ä¼šæ£€æŸ¥ç›®æ ‡æ–¹æ³•çš„ä¿®é¥°ç¬¦æ˜¯å¦ä¸º publicï¼Œä¸æ˜¯ public åˆ™ä¸ä¼šè·å– @Transactional çš„å±æ€§é…ç½®ä¿¡æ¯ã€‚ 2ã€@Transactional æ³¨è§£å±æ€§ propagation è®¾ç½®é”™è¯¯ TransactionDefinition.PROPAGATION_SUPPORTSï¼šå¦‚æœå½“å‰å­˜åœ¨äº‹åŠ¡ï¼Œåˆ™åŠ å…¥è¯¥äº‹åŠ¡ï¼›å¦‚æœå½“å‰æ²¡æœ‰äº‹åŠ¡ï¼Œåˆ™ä»¥éäº‹åŠ¡æ–¹å¼æ‰§è¡Œï¼›é”™è¯¯ä½¿ç”¨åœºæ™¯ï¼šåœ¨ä¸šåŠ¡é€»è¾‘å¿…é¡»è¿è¡Œåœ¨äº‹åŠ¡ç¯å¢ƒä¸‹ä»¥ç¡®ä¿æ•°æ®ä¸€è‡´æ€§çš„æƒ…å†µä¸‹ä½¿ç”¨ SUPPORTSã€‚ TransactionDefinition.PROPAGATION_NOT_SUPPORTEDï¼šæ€»æ˜¯ä»¥éäº‹åŠ¡æ–¹å¼æ‰§è¡Œï¼Œå¦‚æœå½“å‰å­˜åœ¨äº‹åŠ¡ï¼Œåˆ™æŒ‚èµ·è¯¥äº‹åŠ¡ã€‚é”™è¯¯ä½¿ç”¨åœºæ™¯ï¼šåœ¨éœ€è¦äº‹åŠ¡æ”¯æŒçš„æ“ä½œä¸­ä½¿ç”¨ NOT_SUPPORTEDã€‚ TransactionDefinition.PROPAGATION_NEVERï¼šæ€»æ˜¯ä»¥éäº‹åŠ¡æ–¹å¼æ‰§è¡Œï¼Œå¦‚æœå½“å‰å­˜åœ¨äº‹åŠ¡ï¼Œåˆ™æŠ›å‡ºå¼‚å¸¸ã€‚é”™è¯¯ä½¿ç”¨åœºæ™¯ï¼šåœ¨åº”è¯¥åœ¨äº‹åŠ¡ç¯å¢ƒä¸‹æ‰§è¡Œçš„æ“ä½œä¸­ä½¿ç”¨ NEVERã€‚ 3ã€@Transactional æ³¨è§£å±æ€§ rollbackFor è®¾ç½®é”™è¯¯ rollbackFor ç”¨æ¥æŒ‡å®šèƒ½å¤Ÿè§¦å‘äº‹åŠ¡å›æ»šçš„å¼‚å¸¸ç±»å‹ã€‚Spring é»˜è®¤æŠ›å‡ºæœªæ£€æŸ¥ unchecked å¼‚å¸¸ï¼ˆç»§æ‰¿è‡ª RuntimeException çš„å¼‚å¸¸ï¼‰æˆ–è€… Error æ‰å›æ»šäº‹åŠ¡ï¼Œå…¶ä»–å¼‚å¸¸ä¸ä¼šè§¦å‘å›æ»šäº‹åŠ¡ã€‚ // å¸Œæœ›è‡ªå®šä¹‰çš„å¼‚å¸¸å¯ä»¥è¿›è¡Œå›æ»š@Transactional(propagation= Propagation.REQUIRED,rollbackFor= MyException.class) è‹¥åœ¨ç›®æ ‡æ–¹æ³•ä¸­æŠ›å‡ºçš„å¼‚å¸¸æ˜¯ rollbackFor æŒ‡å®šçš„å¼‚å¸¸çš„å­ç±»ï¼Œäº‹åŠ¡åŒæ ·ä¼šå›æ»šã€‚ 4ã€åŒä¸€ä¸ªç±»ä¸­æ–¹æ³•è°ƒç”¨ï¼Œå¯¼è‡´@Transactional å¤±æ•ˆ å¼€å‘ä¸­é¿å…ä¸äº†ä¼šå¯¹åŒä¸€ä¸ªç±»é‡Œé¢çš„æ–¹æ³•è°ƒç”¨ï¼Œæ¯”å¦‚æœ‰ä¸€ä¸ªç±» Testï¼Œå®ƒçš„ä¸€ä¸ªæ–¹æ³• Aï¼ŒA è°ƒç”¨æœ¬ç±»çš„æ–¹æ³• Bï¼ˆä¸è®ºæ–¹æ³• B æ˜¯ç”¨ public è¿˜æ˜¯ private ä¿®é¥°ï¼‰ï¼Œä½†æ–¹æ³• A æ²¡æœ‰å£°æ˜æ³¨è§£äº‹åŠ¡ï¼Œè€Œ B æ–¹æ³•æœ‰ã€‚ åˆ™å¤–éƒ¨è°ƒç”¨æ–¹æ³• A ä¹‹åï¼Œæ–¹æ³• B çš„äº‹åŠ¡æ˜¯ä¸ä¼šèµ·ä½œç”¨çš„ã€‚è¿™ä¹Ÿæ˜¯ç»å¸¸çŠ¯é”™è¯¯çš„ä¸€ä¸ªåœ°æ–¹ã€‚ é‚£ä¸ºå•¥ä¼šå‡ºç°è¿™ç§æƒ…å†µå‘¢ï¼Ÿå…¶å®è¿˜æ˜¯ç”± Spring AOP ä»£ç†é€ æˆçš„ï¼Œå› ä¸ºåªæœ‰äº‹åŠ¡æ–¹æ³•è¢«å½“å‰ç±»ä»¥å¤–çš„ä»£ç è°ƒç”¨æ—¶ï¼Œæ‰ä¼šç”± Spring ç”Ÿæˆçš„ä»£ç†å¯¹è±¡æ¥ç®¡ç†ã€‚ //@Transactional@GetMapping(/test)private Integer A() throws Exception CityInfoDict cityInfoDict = new CityInfoDict(); cityInfoDict.setCityName(2); /** * B æ’å…¥å­—æ®µä¸º 3çš„æ•°æ® */ this.insertB(); /** * A æ’å…¥å­—æ®µä¸º 2çš„æ•°æ® */ int insert = cityInfoDictMapper.insert(cityInfoDict); return insert;@Transactional()public Integer insertB() throws Exception CityInfoDict cityInfoDict = new CityInfoDict(); cityInfoDict.setCityName(3); cityInfoDict.setParentCityId(3); return cityInfoDictMapper.insert(cityInfoDict); è¿™ç§æƒ…å†µæ˜¯æœ€å¸¸è§çš„ä¸€ç§@Transactional æ³¨è§£å¤±æ•ˆåœºæ™¯ã€‚ @Transactionalprivate Integer A() throws Exception int insert = 0; try CityInfoDict cityInfoDict = new CityInfoDict(); cityInfoDict.setCityName(2); cityInfoDict.setParentCityId(2); /** * A æ’å…¥å­—æ®µä¸º 2çš„æ•°æ® */ insert = cityInfoDictMapper.insert(cityInfoDict); /** * B æ’å…¥å­—æ®µä¸º 3çš„æ•°æ® */ b.insertB(); catch (Exception e) e.printStackTrace(); å¦‚æœ B æ–¹æ³•å†…éƒ¨æŠ›äº†å¼‚å¸¸ï¼Œè€Œ A æ–¹æ³•æ­¤æ—¶ try catch äº† B æ–¹æ³•çš„å¼‚å¸¸ï¼Œé‚£è¿™ä¸ªäº‹åŠ¡å°±ä¸èƒ½æ­£å¸¸å›æ»šäº†ï¼Œä¼šæŠ›å‡ºå¼‚å¸¸ï¼š org.springframework.transaction.UnexpectedRollbackException: Transaction rolled back because it has been marked as rollback-only MVC28.Spring MVC çš„æ ¸å¿ƒç»„ä»¶ï¼Ÿ DispatcherServletï¼šå‰ç½®æ§åˆ¶å™¨ï¼Œæ˜¯æ•´ä¸ªæµç¨‹æ§åˆ¶çš„æ ¸å¿ƒï¼Œæ§åˆ¶å…¶ä»–ç»„ä»¶çš„æ‰§è¡Œï¼Œè¿›è¡Œç»Ÿä¸€è°ƒåº¦ï¼Œé™ä½ç»„ä»¶ä¹‹é—´çš„è€¦åˆæ€§ï¼Œç›¸å½“äºæ€»æŒ‡æŒ¥ã€‚ Handlerï¼šå¤„ç†å™¨ï¼Œå®Œæˆå…·ä½“çš„ä¸šåŠ¡é€»è¾‘ï¼Œç›¸å½“äº Servlet æˆ– Actionã€‚ HandlerMappingï¼šDispatcherServlet æ¥æ”¶åˆ°è¯·æ±‚ä¹‹åï¼Œé€šè¿‡ HandlerMapping å°†ä¸åŒçš„è¯·æ±‚æ˜ å°„åˆ°ä¸åŒçš„ Handlerã€‚ HandlerInterceptorï¼šå¤„ç†å™¨æ‹¦æˆªå™¨ï¼Œæ˜¯ä¸€ä¸ªæ¥å£ï¼Œå¦‚æœéœ€è¦å®Œæˆä¸€äº›æ‹¦æˆªå¤„ç†ï¼Œå¯ä»¥å®ç°è¯¥æ¥å£ã€‚ HandlerExecutionChainï¼šå¤„ç†å™¨æ‰§è¡Œé“¾ï¼ŒåŒ…æ‹¬ä¸¤éƒ¨åˆ†å†…å®¹ï¼šHandler å’Œ HandlerInterceptorï¼ˆç³»ç»Ÿä¼šæœ‰ä¸€ä¸ªé»˜è®¤çš„ HandlerInterceptorï¼Œå¦‚æœéœ€è¦é¢å¤–è®¾ç½®æ‹¦æˆªï¼Œå¯ä»¥æ·»åŠ æ‹¦æˆªå™¨ï¼‰ã€‚ HandlerAdapterï¼šå¤„ç†å™¨é€‚é…å™¨ï¼ŒHandler æ‰§è¡Œä¸šåŠ¡æ–¹æ³•ä¹‹å‰ï¼Œéœ€è¦è¿›è¡Œä¸€ç³»åˆ—çš„æ“ä½œï¼ŒåŒ…æ‹¬è¡¨å•æ•°æ®çš„éªŒè¯ã€æ•°æ®ç±»å‹çš„è½¬æ¢ã€å°†è¡¨å•æ•°æ®å°è£…åˆ° JavaBean ç­‰ï¼Œè¿™äº›æ“ä½œéƒ½æ˜¯ç”± HandlerApater æ¥å®Œæˆï¼Œå¼€å‘è€…åªéœ€å°†æ³¨æ„åŠ›é›†ä¸­ä¸šåŠ¡é€»è¾‘çš„å¤„ç†ä¸Šï¼ŒDispatcherServlet é€šè¿‡ HandlerAdapter æ‰§è¡Œä¸åŒçš„ Handlerã€‚ ModelAndViewï¼šè£…è½½äº†æ¨¡å‹æ•°æ®å’Œè§†å›¾ä¿¡æ¯ï¼Œä½œä¸º Handler çš„å¤„ç†ç»“æœï¼Œè¿”å›ç»™ DispatcherServletã€‚ ViewResolverï¼šè§†å›¾è§£æå™¨ï¼ŒDispatcheServlet é€šè¿‡å®ƒå°†é€»è¾‘è§†å›¾è§£æä¸ºç‰©ç†è§†å›¾ï¼Œæœ€ç»ˆå°†æ¸²æŸ“ç»“æœå“åº”ç»™å®¢æˆ·ç«¯ã€‚ 29.Spring MVC çš„å·¥ä½œæµç¨‹ï¼Ÿé¦–å…ˆï¼Œå®¢æˆ·ç«¯å‘é€è¯·æ±‚ï¼ŒDispatcherServlet æ‹¦æˆªå¹¶é€šè¿‡ HandlerMapping æ‰¾åˆ°å¯¹åº”çš„æ§åˆ¶å™¨ã€‚ DispatcherServlet ä½¿ç”¨ HandlerAdapter è°ƒç”¨æ§åˆ¶å™¨æ–¹æ³•ï¼Œæ‰§è¡Œå…·ä½“çš„ä¸šåŠ¡é€»è¾‘ï¼Œè¿”å›ä¸€ä¸ª ModelAndView å¯¹è±¡ã€‚ ç„¶å DispatcherServlet é€šè¿‡ ViewResolver è§£æè§†å›¾ã€‚ æœ€åï¼ŒDispatcherServlet æ¸²æŸ“è§†å›¾å¹¶å°†å“åº”è¿”å›ç»™å®¢æˆ·ç«¯ã€‚ â‘ ã€å‘èµ·è¯·æ±‚ï¼šå®¢æˆ·ç«¯é€šè¿‡ HTTP åè®®å‘æœåŠ¡å™¨å‘èµ·è¯·æ±‚ã€‚ â‘¡ã€å‰ç«¯æ§åˆ¶å™¨ï¼šè¿™ä¸ªè¯·æ±‚ä¼šå…ˆåˆ°å‰ç«¯æ§åˆ¶å™¨ DispatcherServletï¼Œå®ƒæ˜¯æ•´ä¸ªæµç¨‹çš„å…¥å£ç‚¹ï¼Œè´Ÿè´£æ¥æ”¶è¯·æ±‚å¹¶å°†å…¶åˆ†å‘ç»™ç›¸åº”çš„å¤„ç†å™¨ã€‚ â‘¢ã€å¤„ç†å™¨æ˜ å°„ï¼šDispatcherServlet è°ƒç”¨ HandlerMapping æ¥ç¡®å®šå“ªä¸ª Controller åº”è¯¥å¤„ç†è¿™ä¸ªè¯·æ±‚ã€‚é€šå¸¸ä¼šæ ¹æ®è¯·æ±‚çš„ URL æ¥ç¡®å®šã€‚ â‘£ã€å¤„ç†å™¨é€‚é…å™¨ï¼šä¸€æ—¦æ‰¾åˆ°ç›®æ ‡ Controllerï¼ŒDispatcherServlet ä¼šä½¿ç”¨ HandlerAdapter æ¥è°ƒç”¨ Controller çš„å¤„ç†æ–¹æ³•ã€‚ â‘¤ã€æ‰§è¡Œå¤„ç†å™¨ï¼šController å¤„ç†è¯·æ±‚ï¼Œå¤„ç†å®Œåè¿”å›ä¸€ä¸ª ModelAndView å¯¹è±¡ï¼Œå…¶ä¸­åŒ…å«æ¨¡å‹æ•°æ®å’Œé€»è¾‘è§†å›¾åã€‚ â‘¥ã€è§†å›¾è§£æå™¨ï¼šDispatcherServlet æ¥æ”¶åˆ° ModelAndView åï¼Œä¼šä½¿ç”¨ ViewResolver æ¥è§£æè§†å›¾åç§°ï¼Œæ‰¾åˆ°å…·ä½“çš„è§†å›¾é¡µé¢ã€‚ â‘¦ã€æ¸²æŸ“è§†å›¾ï¼šè§†å›¾ä½¿ç”¨æ¨¡å‹æ•°æ®æ¸²æŸ“é¡µé¢ï¼Œç”Ÿæˆæœ€ç»ˆçš„é¡µé¢å†…å®¹ã€‚ â‘§ã€å“åº”ç»“æœï¼šDispatcherServlet å°†è§†å›¾ç»“æœè¿”å›ç»™å®¢æˆ·ç«¯ã€‚ Spring MVCÂ è™½ç„¶æ•´ä½“æµç¨‹å¤æ‚ï¼Œä½†æ˜¯å®é™…å¼€å‘ä¸­å¾ˆç®€å•ï¼Œå¤§éƒ¨åˆ†çš„ç»„ä»¶ä¸éœ€è¦æˆ‘ä»¬å¼€å‘äººå‘˜åˆ›å»ºå’Œç®¡ç†ï¼ŒçœŸæ­£éœ€è¦å¤„ç†çš„åªæœ‰Â ControllerÂ ã€ViewÂ ã€Modelã€‚ åœ¨å‰åç«¯åˆ†ç¦»çš„æƒ…å†µä¸‹ï¼Œæ­¥éª¤ â‘¥ã€â‘¦ã€â‘§ ä¼šç•¥æœ‰ä¸åŒï¼Œåç«¯é€šå¸¸åªéœ€è¦å¤„ç†æ•°æ®ï¼Œå¹¶å°† JSON æ ¼å¼çš„æ•°æ®è¿”å›ç»™å‰ç«¯å°±å¯ä»¥äº†ï¼Œè€Œä¸æ˜¯è¿”å›å®Œæ•´çš„è§†å›¾é¡µé¢ã€‚ è¿™ä¸ª Handler æ˜¯ä»€ä¹ˆä¸œè¥¿å•Šï¼Ÿä¸ºä»€ä¹ˆè¿˜éœ€è¦ HandlerAdapterHandler ä¸€èˆ¬å°±æ˜¯æŒ‡ Controllerï¼ŒController æ˜¯ Spring MVC çš„æ ¸å¿ƒç»„ä»¶ï¼Œè´Ÿè´£å¤„ç†è¯·æ±‚ï¼Œè¿”å›å“åº”ã€‚ Spring MVC å…è®¸ä½¿ç”¨å¤šç§ç±»å‹çš„å¤„ç†å™¨ã€‚ä¸ä»…ä»…æ˜¯æ ‡å‡†çš„@Controlleræ³¨è§£çš„ç±»ï¼Œè¿˜å¯ä»¥æ˜¯å®ç°äº†ç‰¹å®šæ¥å£çš„å…¶ä»–ç±»ï¼ˆå¦‚ HttpRequestHandler æˆ– SimpleControllerHandlerAdapter ç­‰ï¼‰ã€‚è¿™äº›å¤„ç†å™¨å¯èƒ½æœ‰ä¸åŒçš„æ–¹æ³•ç­¾åå’Œäº¤äº’æ–¹å¼ã€‚ HandlerAdapter çš„ä¸»è¦èŒè´£å°±æ˜¯è°ƒç”¨ Handler çš„æ–¹æ³•æ¥å¤„ç†è¯·æ±‚ï¼Œå¹¶ä¸”é€‚é…ä¸åŒç±»å‹çš„å¤„ç†å™¨ã€‚HandlerAdapter ç¡®ä¿ DispatcherServlet å¯ä»¥ä»¥ç»Ÿä¸€çš„æ–¹å¼è°ƒç”¨ä¸åŒç±»å‹çš„å¤„ç†å™¨ï¼Œæ— éœ€å…³å¿ƒå…·ä½“çš„æ‰§è¡Œç»†èŠ‚ã€‚ 30.SpringMVC Restful é£æ ¼çš„æ¥å£çš„æµç¨‹æ˜¯ä»€ä¹ˆæ ·çš„å‘¢ï¼ŸPS:è¿™æ˜¯ä¸€é“å…¨æ–°çš„å…«è‚¡ï¼Œæ¯•ç«Ÿ ModelAndView è¿™ç§æ–¹å¼åº”è¯¥æ²¡äººç”¨äº†å§ï¼Ÿç°åœ¨éƒ½æ˜¯å‰åç«¯åˆ†ç¦»æ¥å£ï¼Œå…«è‚¡ä¹Ÿè¯¥æ›´æ–°æ¢ä»£äº†ã€‚æˆ‘ä»¬éƒ½çŸ¥é“ Restful æ¥å£ï¼Œå“åº”æ ¼å¼æ˜¯ jsonï¼Œè¿™å°±ç”¨åˆ°äº†ä¸€ä¸ªå¸¸ç”¨æ³¨è§£ï¼š@ResponseBody @GetMapping(/user)@ResponseBodypublic User user() return new User(1,å¼ ä¸‰); åŠ å…¥äº†è¿™ä¸ªæ³¨è§£åï¼Œæ•´ä½“çš„æµç¨‹ä¸Šå’Œä½¿ç”¨ ModelAndView å¤§ä½“ä¸Šç›¸åŒï¼Œä½†æ˜¯ç»†èŠ‚ä¸Šæœ‰ä¸€äº›ä¸åŒï¼š 1. å®¢æˆ·ç«¯å‘æœåŠ¡ç«¯å‘é€ä¸€æ¬¡è¯·æ±‚ï¼Œè¿™ä¸ªè¯·æ±‚ä¼šå…ˆåˆ°å‰ç«¯æ§åˆ¶å™¨ DispatcherServlet 2. DispatcherServlet æ¥æ”¶åˆ°è¯·æ±‚åä¼šè°ƒç”¨ HandlerMapping å¤„ç†å™¨æ˜ å°„å™¨ã€‚ç”±æ­¤å¾—çŸ¥ï¼Œè¯¥è¯·æ±‚è¯¥ç”±å“ªä¸ª Controller æ¥å¤„ç† 3. DispatcherServlet è°ƒç”¨ HandlerAdapter å¤„ç†å™¨é€‚é…å™¨ï¼Œå‘Šè¯‰å¤„ç†å™¨é€‚é…å™¨åº”è¯¥è¦å»æ‰§è¡Œå“ªä¸ª Controller 4. Controller è¢«å°è£…æˆäº† ServletInvocableHandlerMethodï¼ŒHandlerAdapter å¤„ç†å™¨é€‚é…å™¨å»æ‰§è¡Œ invokeAndHandle æ–¹æ³•ï¼Œå®Œæˆå¯¹ Controller çš„è¯·æ±‚å¤„ç† 5. HandlerAdapter æ‰§è¡Œå®Œå¯¹ Controller çš„è¯·æ±‚ï¼Œä¼šè°ƒç”¨ HandlerMethodReturnValueHandler å»å¤„ç†è¿”å›å€¼ï¼Œä¸»è¦çš„è¿‡ç¨‹ï¼š 5.1. è°ƒç”¨ RequestResponseBodyMethodProcessorï¼Œåˆ›å»º ServletServerHttpResponseï¼ˆSpring å¯¹åŸç”Ÿ ServerHttpResponse çš„å°è£…ï¼‰å®ä¾‹ 5.2.ä½¿ç”¨ HttpMessageConverter çš„ write æ–¹æ³•ï¼Œå°†è¿”å›å€¼å†™å…¥ ServletServerHttpResponse çš„ OutputStream è¾“å‡ºæµä¸­ 5.3.åœ¨å†™å…¥çš„è¿‡ç¨‹ä¸­ï¼Œä¼šä½¿ç”¨ JsonGeneratorï¼ˆé»˜è®¤ä½¿ç”¨ Jackson æ¡†æ¶ï¼‰å¯¹è¿”å›å€¼è¿›è¡Œ Json åºåˆ—åŒ– 6. æ‰§è¡Œå®Œè¯·æ±‚åï¼Œè¿”å›çš„ ModealAndView ä¸º nullï¼ŒServletServerHttpResponse é‡Œä¹Ÿå·²ç»å†™å…¥äº†å“åº”ï¼Œæ‰€ä»¥ä¸ç”¨å…³å¿ƒ View çš„å¤„ç† SpringBoot31.ä»‹ç»ä¸€ä¸‹ SpringBootï¼Œæœ‰å“ªäº›ä¼˜ç‚¹ï¼ŸSpring Boot æä¾›äº†ä¸€å¥—é»˜è®¤é…ç½®ï¼Œå®ƒé€šè¿‡çº¦å®šå¤§äºé…ç½®çš„ç†å¿µï¼Œæ¥å¸®åŠ©æˆ‘ä»¬å¿«é€Ÿæ­å»º Spring é¡¹ç›®éª¨æ¶ã€‚ ä»¥å‰çš„ Spring å¼€å‘éœ€è¦é…ç½®å¤§é‡çš„ xml æ–‡ä»¶ï¼Œå¹¶ä¸”éœ€è¦å¼•å…¥å¤§é‡çš„ç¬¬ä¸‰æ–¹ jar åŒ…ï¼Œè¿˜éœ€è¦æ‰‹åŠ¨æ”¾åˆ° classpath ä¸‹ã€‚ç°åœ¨åªéœ€è¦å¼•å…¥ä¸€ä¸ª Starterï¼Œæˆ–è€…ä¸€ä¸ªæ³¨è§£ï¼Œå°±å¯ä»¥è½»æ¾æå®šã€‚ Spring Boot çš„ä¼˜ç‚¹éå¸¸å¤šï¼Œæ¯”å¦‚è¯´ï¼š Spring Boot å†…åµŒäº† Tomcatã€Jettyã€Undertow ç­‰å®¹å™¨ï¼Œç›´æ¥è¿è¡Œ jar åŒ…å°±å¯ä»¥å¯åŠ¨é¡¹ç›®ã€‚ Spring Boot å†…ç½®äº† Starter å’Œè‡ªåŠ¨è£…é…ï¼Œé¿å…ç¹ççš„æ‰‹åŠ¨é…ç½®ã€‚ä¾‹å¦‚ï¼Œå¦‚æœé¡¹ç›®ä¸­æ·»åŠ äº† spring-boot-starter-webï¼ŒSpring Boot ä¼šè‡ªåŠ¨é…ç½® Tomcat å’Œ Spring MVCã€‚ Spring Boot å†…ç½®äº† Actuator å’Œ DevToolsï¼Œä¾¿äºè°ƒè¯•å’Œç›‘æ§ã€‚ Spring Bootå¸¸ç”¨æ³¨è§£æœ‰å“ªäº›ï¼Ÿ @SpringBootApplicationï¼šSpring Boot åº”ç”¨çš„å…¥å£ï¼Œç”¨åœ¨å¯åŠ¨ç±»ä¸Šã€‚ è¿˜æœ‰ä¸€äº› Spring æ¡†æ¶æœ¬èº«çš„æ³¨è§£ï¼Œæ¯”å¦‚Â @Componentã€**@RestControllerã€@Serviceã€@ConfigurationPropertiesã€@Transactional**Â ç­‰ã€‚ 32.SpringBoot è‡ªåŠ¨é…ç½®åŸç†äº†è§£å—ï¼Ÿåœ¨ Spring ä¸­ï¼Œè‡ªåŠ¨è£…é…æ˜¯æŒ‡å®¹å™¨åˆ©ç”¨åå°„æŠ€æœ¯ï¼Œæ ¹æ® Bean çš„ç±»å‹ã€åç§°ç­‰è‡ªåŠ¨æ³¨å…¥æ‰€éœ€çš„ä¾èµ–ã€‚ åœ¨ Spring Boot ä¸­ï¼Œå¼€å¯è‡ªåŠ¨è£…é…çš„æ³¨è§£æ˜¯@EnableAutoConfigurationã€‚ Spring Boot ä¸ºäº†è¿›ä¸€æ­¥ç®€åŒ–ï¼Œç›´æ¥é€šè¿‡ @SpringBootApplication æ³¨è§£ä¸€æ­¥æå®šï¼Œè¯¥æ³¨è§£åŒ…å«äº† @EnableAutoConfiguration æ³¨è§£ã€‚ main ç±»å¯åŠ¨çš„æ—¶å€™ï¼ŒSpring Boot ä¼šé€šè¿‡åº•å±‚çš„AutoConfigurationImportSelector ç±»åŠ è½½è‡ªåŠ¨è£…é…ç±»ã€‚ @AutoConfigurationPackage //å°†mainåŒçº§çš„åŒ…ä¸‹çš„æ‰€æœ‰ç»„ä»¶æ³¨å†Œåˆ°å®¹å™¨ä¸­@Import(AutoConfigurationImportSelector.class) //åŠ è½½è‡ªåŠ¨è£…é…ç±» xxxAutoconfigurationpublic @interface EnableAutoConfiguration String ENABLED_OVERRIDE_PROPERTY = spring.boot.enableautoconfiguration; Class?[] exclude() default ; String[] excludeName() default ; AutoConfigurationImportSelectorå®ç°äº†ImportSelectoræ¥å£ï¼Œè¯¥æ¥å£çš„ä½œç”¨æ˜¯æ”¶é›†éœ€è¦å¯¼å…¥çš„é…ç½®ç±»ï¼Œé…åˆ @Import() å°†ç›¸åº”çš„ç±»å¯¼å…¥åˆ° Spring å®¹å™¨ä¸­ã€‚ è·å–æ³¨å…¥ç±»çš„æ–¹æ³•æ˜¯ selectImports()ï¼Œå®ƒå®é™…è°ƒç”¨çš„æ˜¯getAutoConfigurationEntry()ï¼Œè¿™ä¸ªæ–¹æ³•æ˜¯è·å–è‡ªåŠ¨è£…é…ç±»çš„å…³é”®ã€‚ protected AutoConfigurationEntry getAutoConfigurationEntry(AnnotationMetadata annotationMetadata) // æ£€æŸ¥è‡ªåŠ¨é…ç½®æ˜¯å¦å¯ç”¨ã€‚å¦‚æœ@ConditionalOnClassç­‰æ¡ä»¶æ³¨è§£ä½¿å¾—è‡ªåŠ¨é…ç½®ä¸é€‚ç”¨äºå½“å‰ç¯å¢ƒï¼Œåˆ™è¿”å›ä¸€ä¸ªç©ºçš„é…ç½®æ¡ç›®ã€‚ if (!isEnabled(annotationMetadata)) return EMPTY_ENTRY; // è·å–å¯åŠ¨ç±»ä¸Šçš„@EnableAutoConfigurationæ³¨è§£çš„å±æ€§ï¼Œè¿™å¯èƒ½åŒ…æ‹¬å¯¹ç‰¹å®šè‡ªåŠ¨é…ç½®ç±»çš„æ’é™¤ã€‚ AnnotationAttributes attributes = getAttributes(annotationMetadata); // ä»spring.factoriesä¸­è·å–æ‰€æœ‰å€™é€‰çš„è‡ªåŠ¨é…ç½®ç±»ã€‚è¿™æ˜¯é€šè¿‡åŠ è½½META-INF/spring.factoriesæ–‡ä»¶ä¸­å¯¹åº”çš„æ¡ç›®æ¥å®ç°çš„ã€‚ ListString configurations = getCandidateConfigurations(annotationMetadata, attributes); // ç§»é™¤é…ç½®åˆ—è¡¨ä¸­çš„é‡å¤é¡¹ï¼Œç¡®ä¿æ¯ä¸ªè‡ªåŠ¨é…ç½®ç±»åªè¢«è€ƒè™‘ä¸€æ¬¡ã€‚ configurations = removeDuplicates(configurations); // æ ¹æ®æ³¨è§£å±æ€§è§£æå‡ºéœ€è¦æ’é™¤çš„è‡ªåŠ¨é…ç½®ç±»ã€‚ SetString exclusions = getExclusions(annotationMetadata, attributes); // æ£€æŸ¥æ’é™¤çš„ç±»æ˜¯å¦å­˜åœ¨äºå€™é€‰é…ç½®ä¸­ï¼Œå¦‚æœå­˜åœ¨ï¼Œåˆ™æŠ›å‡ºå¼‚å¸¸ã€‚ checkExcludedClasses(configurations, exclusions); // ä»å€™é€‰é…ç½®ä¸­ç§»é™¤æ’é™¤çš„ç±»ã€‚ configurations.removeAll(exclusions); // åº”ç”¨è¿‡æ»¤å™¨è¿›ä¸€æ­¥ç­›é€‰è‡ªåŠ¨é…ç½®ç±»ã€‚è¿‡æ»¤å™¨å¯èƒ½åŸºäºæ¡ä»¶æ³¨è§£å¦‚@ConditionalOnBeanç­‰æ¥æ’é™¤ç‰¹å®šçš„é…ç½®ç±»ã€‚ configurations = getConfigurationClassFilter().filter(configurations); // è§¦å‘è‡ªåŠ¨é…ç½®å¯¼å…¥äº‹ä»¶ï¼Œå…è®¸ç›‘å¬å™¨å¯¹è‡ªåŠ¨é…ç½®è¿‡ç¨‹è¿›è¡Œå¹²é¢„ã€‚ fireAutoConfigurationImportEvents(configurations, exclusions); // åˆ›å»ºå¹¶è¿”å›ä¸€ä¸ªåŒ…å«æœ€ç»ˆç¡®å®šçš„è‡ªåŠ¨é…ç½®ç±»å’Œæ’é™¤çš„é…ç½®ç±»çš„AutoConfigurationEntryå¯¹è±¡ã€‚ return new AutoConfigurationEntry(configurations, exclusions); æ€»ç»“ï¼šSpring Boot çš„è‡ªåŠ¨è£…é…åŸç†ä¾èµ–äº Spring æ¡†æ¶çš„ä¾èµ–æ³¨å…¥å’Œæ¡ä»¶æ³¨å†Œï¼Œé€šè¿‡è¿™ç§æ–¹å¼ï¼ŒSpring Boot èƒ½å¤Ÿæ™ºèƒ½åœ°é…ç½® beanï¼Œå¹¶ä¸”åªæœ‰å½“è¿™äº› bean å®é™…éœ€è¦æ—¶æ‰ä¼šè¢«åˆ›å»ºå’Œé…ç½®ã€‚ 33.å¦‚ä½•è‡ªå®šä¹‰ä¸€ä¸ª SpringBoot Starter?åˆ›å»ºä¸€ä¸ªè‡ªå®šä¹‰çš„ Spring Boot Starterï¼Œéœ€è¦è¿™å‡ æ­¥ï¼š ç¬¬ä¸€æ­¥ï¼Œåˆ›å»ºä¸€ä¸ªæ–°çš„ Maven é¡¹ç›®ï¼Œä¾‹å¦‚å‘½åä¸º my-spring-boot-starterã€‚åœ¨ pom.xml æ–‡ä»¶ä¸­æ·»åŠ å¿…è¦çš„ä¾èµ–å’Œé…ç½®ï¼š properties spring.boot.version2.3.1.RELEASE/spring.boot.version/propertiesdependencies dependency groupIdorg.springframework.boot/groupId artifactIdspring-boot-autoconfigure/artifactId version$spring.boot.version/version /dependency dependency groupIdorg.springframework.boot/groupId artifactIdspring-boot-starter/artifactId version$spring.boot.version/version /dependency/dependencies ç¬¬äºŒæ­¥ï¼Œåœ¨ srcmainjava ä¸‹åˆ›å»ºä¸€ä¸ªè‡ªåŠ¨é…ç½®ç±»ï¼Œæ¯”å¦‚ MyServiceAutoConfiguration.javaï¼šï¼ˆé€šå¸¸æ˜¯ autoconfigure åŒ…ä¸‹ï¼‰ã€‚ @Configuration@EnableConfigurationProperties(MyStarterProperties.class)public class MyServiceAutoConfiguration @Bean @ConditionalOnMissingBean public MyService myService(MyStarterProperties properties) return new MyService(properties.getMessage()); ç¬¬ä¸‰æ­¥ï¼Œåˆ›å»ºä¸€ä¸ªé…ç½®å±æ€§ç±» MyStarterProperties.javaï¼š @ConfigurationProperties(prefix = mystarter)public class MyStarterProperties private String message = äºŒå“¥çš„ Java è¿›é˜¶ä¹‹è·¯ä¸é”™å•Š!; public String getMessage() return message; public void setMessage(String message) this.message = message; ç¬¬å››æ­¥ï¼Œåˆ›å»ºä¸€ä¸ªç®€å•çš„æœåŠ¡ç±» MyService.javaï¼š public class MyService private final String message; public MyService(String message) this.message = message; public String getMessage() return message; ç¬¬äº”æ­¥ï¼Œé…ç½® spring.factoriesï¼Œåœ¨ srcmainresourcesMETA-INF ç›®å½•ä¸‹åˆ›å»º spring.factories æ–‡ä»¶ï¼Œå¹¶æ·»åŠ ï¼šorg.springframework.boot.autoconfigure.EnableAutoConfiguration=\\com.itwanger.mystarter.autoconfigure.MyServiceAutoConfiguration ç¬¬å…­æ­¥ï¼Œä½¿ç”¨ Maven æ‰“åŒ…è¿™ä¸ªé¡¹ç›®ï¼šmvn clean install ç¬¬ä¸ƒæ­¥ï¼Œåœ¨å…¶ä»–çš„ Spring Boot é¡¹ç›®ä¸­ï¼Œé€šè¿‡ Maven æ¥æ·»åŠ è¿™ä¸ªè‡ªå®šä¹‰çš„ Starter ä¾èµ–ï¼Œå¹¶é€šè¿‡ application.properties é…ç½®æ¬¢è¿æ¶ˆæ¯ï¼šmystarter.message=javabetter.cn ç„¶åå°±å¯ä»¥åœ¨ Spring Boot é¡¹ç›®ä¸­æ³¨å…¥ MyStarterProperties æ¥ä½¿ç”¨å®ƒã€‚ -å¯åŠ¨é¡¹ç›®ï¼Œç„¶ååœ¨æµè§ˆå™¨ä¸­è¾“å…¥ localhost:8081helloï¼Œå°±å¯ä»¥çœ‹åˆ°æ¬¢è¿æ¶ˆæ¯äº†ã€‚ Spring Boot Starter çš„åŸç†äº†è§£å—ï¼ŸSpring Boot Starter ä¸»è¦é€šè¿‡èµ·æ­¥ä¾èµ–å’Œè‡ªåŠ¨é…ç½®æœºåˆ¶æ¥ç®€åŒ–é¡¹ç›®çš„æ„å»ºå’Œé…ç½®è¿‡ç¨‹ã€‚ èµ·æ­¥ä¾èµ–æ˜¯ Spring Boot æä¾›çš„ä¸€ç»„é¢„å®šä¹‰ä¾èµ–é¡¹ï¼Œå®ƒä»¬å°†ä¸€ç»„ç›¸å…³çš„åº“å’Œæ¨¡å—æ‰“åŒ…åœ¨ä¸€èµ·ã€‚æ¯”å¦‚ spring-boot-starter-web å°±åŒ…å«äº† Spring MVCã€Tomcat å’Œ Jackson ç­‰ä¾èµ–ã€‚ è‡ªåŠ¨é…ç½®æœºåˆ¶æ˜¯ Spring Boot çš„æ ¸å¿ƒç‰¹æ€§ï¼Œé€šè¿‡è‡ªåŠ¨æ‰«æç±»è·¯å¾„ä¸‹çš„ç±»ã€èµ„æºæ–‡ä»¶å’Œé…ç½®æ–‡ä»¶ï¼Œè‡ªåŠ¨åˆ›å»ºå’Œé…ç½®åº”ç”¨ç¨‹åºæ‰€éœ€çš„ Bean å’Œç»„ä»¶ã€‚ æ¯”å¦‚æœ‰äº† spring-boot-starter-webï¼Œæˆ‘ä»¬å¼€å‘è€…å°±ä¸éœ€è¦å†æ‰‹åŠ¨é…ç½® Tomcatã€Spring MVC ç­‰ï¼ŒSpring Boot ä¼šè‡ªåŠ¨å¸®æˆ‘ä»¬å®Œæˆè¿™äº›å·¥ä½œã€‚ 34.Spring Boot å¯åŠ¨åŸç†äº†è§£å—ï¼ŸSpring Boot çš„å¯åŠ¨ç”± SpringApplication ç±»è´Ÿè´£ï¼š ç¬¬ä¸€æ­¥ï¼Œåˆ›å»º SpringApplication å®ä¾‹ï¼Œè´Ÿè´£åº”ç”¨çš„å¯åŠ¨å’Œåˆå§‹åŒ–ï¼› ç¬¬äºŒæ­¥ï¼Œä» application.yml ä¸­åŠ è½½é…ç½®æ–‡ä»¶å’Œç¯å¢ƒå˜é‡ï¼› ç¬¬ä¸‰æ­¥ï¼Œåˆ›å»ºä¸Šä¸‹æ–‡ç¯å¢ƒ ApplicationContextï¼Œå¹¶åŠ è½½ Beanï¼Œå®Œæˆä¾èµ–æ³¨å…¥ï¼› ç¬¬å››æ­¥ï¼Œå¯åŠ¨å†…åµŒçš„ Web å®¹å™¨ã€‚ ç¬¬äº”æ­¥ï¼Œå‘å¸ƒå¯åŠ¨å®Œæˆäº‹ä»¶ ApplicationReadyEventï¼Œå¹¶è°ƒç”¨ ApplicationRunner çš„ run æ–¹æ³•å®Œæˆå¯åŠ¨åçš„é€»è¾‘ã€‚ å…³é”®çš„ä»£ç é€»è¾‘å¦‚ä¸‹ï¼š public ConfigurableApplicationContext run(String... args) // 1. åˆ›å»ºå¯åŠ¨æ—¶çš„ç›‘å¬å™¨å¹¶è§¦å‘å¯åŠ¨äº‹ä»¶ SpringApplicationRunListeners listeners = getRunListeners(args); listeners.starting(); // 2. å‡†å¤‡è¿è¡Œç¯å¢ƒ ConfigurableEnvironment environment = prepareEnvironment(listeners); configureIgnoreBeanInfo(environment); // 3. åˆ›å»ºä¸Šä¸‹æ–‡ ConfigurableApplicationContext context = createApplicationContext(); try // 4. å‡†å¤‡ä¸Šä¸‹æ–‡ prepareContext(context, environment, listeners, args); // 5. åˆ·æ–°ä¸Šä¸‹æ–‡ï¼Œå®Œæˆ Bean åˆå§‹åŒ–å’Œè£…é… refreshContext(context); // 6. è°ƒç”¨è¿è¡Œå™¨ afterRefresh(context, args); // 7. è§¦å‘å¯åŠ¨å®Œæˆäº‹ä»¶ listeners.started(context); catch (Exception ex) handleRunFailure(context, ex, listeners); return context; ä»¥TecHubå®æˆ˜é¡¹ç›®ä¸ºä¾‹ã€‚åœ¨å¯åŠ¨ç±» QuickForumApplication ä¸­ï¼Œmain æ–¹æ³•ä¼šè°ƒç”¨ SpringApplication.run() å¯åŠ¨é¡¹ç›®ã€‚ è¯¥æ–¹æ³•è´Ÿè´£ Spring åº”ç”¨çš„ä¸Šä¸‹æ–‡ç¯å¢ƒï¼ˆApplicationContextï¼‰å‡†å¤‡ï¼ŒåŒ…æ‹¬ï¼š æ‰«æé…ç½®æ–‡ä»¶ï¼Œæ·»åŠ ä¾èµ–é¡¹ åˆå§‹åŒ–å’ŒåŠ è½½ Bean å®šä¹‰ å¯åŠ¨å†…åµŒçš„ Web å®¹å™¨ç­‰ å‘å¸ƒå¯åŠ¨å®Œæˆäº‹ä»¶ äº†è§£@SpringBootApplication æ³¨è§£å—ï¼Ÿ@SpringBootApplicationæ˜¯ Spring Boot çš„æ ¸å¿ƒæ³¨è§£ï¼Œç»å¸¸ç”¨äºä¸»ç±»ä¸Šï¼Œä½œä¸ºé¡¹ç›®å¯åŠ¨å…¥å£çš„æ ‡è¯†ã€‚å®ƒæ˜¯ä¸€ä¸ªç»„åˆæ³¨è§£ï¼š @SpringBootConfigurationï¼šç»§æ‰¿è‡ª @Configurationï¼Œæ ‡æ³¨è¯¥ç±»æ˜¯ä¸€ä¸ªé…ç½®ç±»ï¼Œç›¸å½“äºä¸€ä¸ª Spring é…ç½®æ–‡ä»¶ã€‚ @EnableAutoConfigurationï¼šå‘Šè¯‰ Spring Boot æ ¹æ® pom.xml ä¸­æ·»åŠ çš„ä¾èµ–è‡ªåŠ¨é…ç½®é¡¹ç›®ã€‚ä¾‹å¦‚ï¼Œå¦‚æœ spring-boot-starter-web ä¾èµ–è¢«æ·»åŠ åˆ°é¡¹ç›®ä¸­ï¼ŒSpring Boot ä¼šè‡ªåŠ¨é…ç½® Tomcat å’Œ Spring MVCã€‚ @ComponentScanï¼šæ‰«æå½“å‰åŒ…åŠå…¶å­åŒ…ä¸‹è¢«@Componentã€@Serviceã€@Controllerã€@Repository æ³¨è§£æ ‡è®°çš„ç±»ï¼Œå¹¶æ³¨å†Œä¸º Spring Beanã€‚@SpringBootApplicationpublic class Application public static void main(String[] args) SpringApplication.run(Application.class, args); ä¸ºä»€ä¹ˆ Spring Boot åœ¨å¯åŠ¨çš„æ—¶å€™èƒ½å¤Ÿæ‰¾åˆ° main æ–¹æ³•ä¸Šçš„@SpringBootApplication æ³¨è§£ï¼ŸSpring Boot åœ¨å¯åŠ¨æ—¶èƒ½å¤Ÿæ‰¾åˆ°ä¸»ç±»ä¸Šçš„@SpringBootApplicationæ³¨è§£ï¼Œæ˜¯å› ä¸ºå®ƒåˆ©ç”¨äº† Java çš„åå°„æœºåˆ¶å’Œç±»åŠ è½½æœºåˆ¶ï¼Œç»“åˆ Spring æ¡†æ¶å†…éƒ¨çš„ä¸€ç³»åˆ—å¤„ç†æµç¨‹ã€‚ å½“è¿è¡Œä¸€ä¸ª Spring Boot ç¨‹åºæ—¶ï¼Œé€šå¸¸ä¼šè°ƒç”¨ä¸»ç±»ä¸­çš„mainæ–¹æ³•ï¼Œè¿™ä¸ªæ–¹æ³•ä¼šæ‰§è¡ŒSpringApplication.run()ï¼Œæ¯”å¦‚ï¼š @SpringBootApplicationpublic class MyApplication public static void main(String[] args) SpringApplication.run(MyApplication.class, args); SpringApplication.run(Class? primarySource, String... args)æ–¹æ³•æ¥æ”¶ä¸¤ä¸ªå‚æ•°ï¼šç¬¬ä¸€ä¸ªæ˜¯ä¸»åº”ç”¨ç±»ï¼ˆå³åŒ…å«mainæ–¹æ³•çš„ç±»ï¼‰ï¼Œç¬¬äºŒä¸ªæ˜¯å‘½ä»¤è¡Œå‚æ•°ã€‚primarySourceå‚æ•°æä¾›äº†ä¸€ä¸ªèµ·ç‚¹ï¼ŒSpring Boot é€šè¿‡å®ƒæ¥åŠ è½½åº”ç”¨ä¸Šä¸‹æ–‡ã€‚ Spring Boot åˆ©ç”¨ Java åå°„æœºåˆ¶æ¥è¯»å–ä¼ é€’ç»™runæ–¹æ³•çš„ç±»ï¼ˆMyApplication.classï¼‰ã€‚å®ƒä¼šæ£€æŸ¥è¿™ä¸ªç±»ä¸Šçš„æ³¨è§£ï¼ŒåŒ…æ‹¬@SpringBootApplicationã€‚ Spring Boot é»˜è®¤çš„åŒ…æ‰«æè·¯å¾„æ˜¯ä»€ä¹ˆï¼ŸSpring Boot çš„é»˜è®¤åŒ…æ‰«æè·¯å¾„æ˜¯ä»¥å¯åŠ¨ç±» @SpringBootApplication æ³¨è§£æ‰€åœ¨çš„åŒ…ä¸ºæ ¹ç›®å½•çš„ï¼Œå³é»˜è®¤æƒ…å†µä¸‹ï¼ŒSpring Boot ä¼šæ‰«æå¯åŠ¨ç±»æ‰€åœ¨åŒ…åŠå…¶å­åŒ…ä¸‹çš„æ‰€æœ‰ç»„ä»¶ã€‚ æ¯”å¦‚è¯´åœ¨æŠ€æœ¯æ´¾å®æˆ˜é¡¹ç›®ä¸­ï¼Œå¯åŠ¨ç±»QuickForumApplicationæ‰€åœ¨çš„åŒ…æ˜¯com.github.paicoding.forum.webï¼Œé‚£ä¹ˆ Spring Boot é»˜è®¤ä¼šæ‰«æcom.github.paicoding.forum.webåŒ…åŠå…¶å­åŒ…ä¸‹çš„æ‰€æœ‰ç»„ä»¶ã€‚ @SpringBootApplication æ˜¯ä¸€ä¸ªç»„åˆæ³¨è§£ï¼Œå®ƒé‡Œé¢çš„@ComponentScanæ³¨è§£å¯ä»¥æŒ‡å®šè¦æ‰«æçš„åŒ…è·¯å¾„ï¼Œé»˜è®¤æ‰«æå¯åŠ¨ç±»æ‰€åœ¨åŒ…åŠå…¶å­åŒ…ä¸‹çš„æ‰€æœ‰ç»„ä»¶ã€‚ @ComponentScan(excludeFilters = @Filter(type = FilterType.CUSTOM, classes = TypeExcludeFilter.class), @Filter(type = FilterType.CUSTOM, classes = AutoConfigurationExcludeFilter.class) )public @interface SpringBootApplication æ¯”å¦‚è¯´å¸¦æœ‰ @Componentã€@Serviceã€@Controllerã€@Repository ç­‰æ³¨è§£çš„ç±»éƒ½ä¼šè¢« Spring Boot æ‰«æåˆ°ï¼Œå¹¶æ³¨å†Œåˆ° Spring å®¹å™¨ä¸­ã€‚ å¦‚æœéœ€è¦è‡ªå®šä¹‰åŒ…æ‰«æè·¯å¾„ï¼Œå¯ä»¥åœ¨@SpringBootApplicationæ³¨è§£ä¸Šæ·»åŠ @ComponentScanæ³¨è§£ï¼ŒæŒ‡å®šè¦æ‰«æçš„åŒ…è·¯å¾„ã€‚ @SpringBootApplication@ComponentScan(basePackages = com.github.paicoding.forum)public class QuickForumApplication public static void main(String[] args) SpringApplication.run(QuickForumApplication.class, args); è¿™ç§æ–¹å¼ä¼šè¦†ç›–é»˜è®¤çš„åŒ…æ‰«æè·¯å¾„ï¼Œåªæ‰«æcom.github.paicoding.forumåŒ…åŠå…¶å­åŒ…ä¸‹çš„æ‰€æœ‰ç»„ä»¶ã€‚ 36.SpringBoot å’Œ SpringMVC çš„åŒºåˆ«ï¼Ÿï¼ˆè¡¥å……ï¼‰Spring MVC æ˜¯åŸºäº Spring æ¡†æ¶çš„ä¸€ä¸ªæ¨¡å—ï¼Œæä¾›äº†ä¸€ç§ Model-View-Controllerï¼ˆæ¨¡å‹-è§†å›¾-æ§åˆ¶å™¨ï¼‰çš„å¼€å‘æ¨¡å¼ã€‚ Spring Boot æ—¨åœ¨ç®€åŒ– Spring åº”ç”¨çš„é…ç½®å’Œéƒ¨ç½²è¿‡ç¨‹ï¼Œæä¾›äº†å¤§é‡çš„è‡ªåŠ¨é…ç½®é€‰é¡¹ï¼Œä»¥åŠè¿è¡Œæ—¶ç¯å¢ƒçš„å†…åµŒ Web æœåŠ¡å™¨ï¼Œè¿™æ ·å°±å¯ä»¥æ›´å¿«é€Ÿåœ°å¼€å‘ä¸€ä¸ª SpringMVC çš„ Web é¡¹ç›®ã€‚ 38.Spring Boot å’Œ Spring æœ‰ä»€ä¹ˆåŒºåˆ«ï¼Ÿï¼ˆè¡¥å……ï¼‰Spring Boot æ˜¯ Spring Framework çš„ä¸€ä¸ªæ‰©å±•ï¼Œæä¾›äº†ä¸€å¥—å¿«é€Ÿé…ç½®å’Œå¼€å‘çš„æœºåˆ¶ï¼Œå¯ä»¥å¸®åŠ©æˆ‘ä»¬å¿«é€Ÿæ­å»º Spring é¡¹ç›®çš„éª¨æ¶ï¼Œæé«˜ç”Ÿäº§æ•ˆç‡ã€‚ ç‰¹æ€§: Spring Cloud35.å¯¹ SpringCloud äº†è§£å¤šå°‘ï¼ŸSpring Cloud æ˜¯ä¸€ä¸ªåŸºäº Spring Bootï¼Œæä¾›æ„å»ºåˆ†å¸ƒå¼ç³»ç»Ÿå’Œå¾®æœåŠ¡æ¶æ„çš„å·¥å…·é›†ã€‚ç”¨äºè§£å†³åˆ†å¸ƒå¼ç³»ç»Ÿä¸­çš„ä¸€äº›å¸¸è§é—®é¢˜ï¼Œå¦‚é…ç½®ç®¡ç†ã€æœåŠ¡å‘ç°ã€è´Ÿè½½å‡è¡¡ç­‰ç­‰ã€‚ ä»€ä¹ˆæ˜¯å¾®æœåŠ¡ï¼Ÿ 2014 å¹´ Martin Fowler æå‡ºçš„ä¸€ç§æ–°çš„æ¶æ„å½¢å¼ã€‚å¾®æœåŠ¡æ¶æ„æ˜¯ä¸€ç§æ¶æ„æ¨¡å¼ï¼Œæå€¡å°†å•ä¸€åº”ç”¨ç¨‹åºåˆ’åˆ†æˆä¸€ç»„å°çš„æœåŠ¡ï¼ŒæœåŠ¡ä¹‹é—´ç›¸äº’åè°ƒï¼Œäº’ç›¸é…åˆï¼Œä¸ºç”¨æˆ·æä¾›æœ€ç»ˆä»·å€¼ã€‚æ¯ä¸ªæœåŠ¡è¿è¡Œåœ¨å…¶ç‹¬ç«‹çš„è¿›ç¨‹ä¸­ï¼ŒæœåŠ¡ä¸æœåŠ¡ä¹‹é—´é‡‡ç”¨è½»é‡çº§çš„é€šä¿¡æœºåˆ¶(å¦‚ HTTP æˆ– Dubbo)äº’ç›¸åä½œï¼Œæ¯ä¸ªæœåŠ¡éƒ½å›´ç»•ç€å…·ä½“çš„ä¸šåŠ¡è¿›è¡Œæ„å»ºï¼Œå¹¶ä¸”èƒ½å¤Ÿè¢«ç‹¬ç«‹çš„éƒ¨ç½²åˆ°ç”Ÿäº§ç¯å¢ƒä¸­ï¼Œå¦å¤–ï¼Œåº”å°½é‡é¿å…ç»Ÿä¸€çš„ï¼Œé›†ä¸­å¼çš„æœåŠ¡ç®¡ç†æœºåˆ¶ï¼Œå¯¹å…·ä½“çš„ä¸€ä¸ªæœåŠ¡è€Œè¨€ï¼Œåº”æ ¹æ®ä¸šåŠ¡ä¸Šä¸‹æ–‡ï¼Œé€‰æ‹©åˆé€‚çš„è¯­è¨€ã€å·¥å…·(å¦‚ Maven)å¯¹å…¶è¿›è¡Œæ„å»ºã€‚ å¾®æœåŠ¡åŒ–çš„æ ¸å¿ƒå°±æ˜¯å°†ä¼ ç»Ÿçš„ä¸€ç«™å¼åº”ç”¨ï¼Œæ ¹æ®ä¸šåŠ¡æ‹†åˆ†æˆä¸€ä¸ªä¸€ä¸ªçš„æœåŠ¡ï¼Œå½»åº•åœ°å»è€¦åˆï¼Œæ¯ä¸€ä¸ªå¾®æœåŠ¡æä¾›å•ä¸ªä¸šåŠ¡åŠŸèƒ½çš„æœåŠ¡ï¼Œä¸€ä¸ªæœåŠ¡åšä¸€ä»¶äº‹æƒ…ï¼Œä»æŠ€æœ¯è§’åº¦çœ‹å°±æ˜¯ä¸€ç§å°è€Œç‹¬ç«‹çš„å¤„ç†è¿‡ç¨‹ï¼Œç±»ä¼¼è¿›ç¨‹çš„æ¦‚å¿µï¼Œèƒ½å¤Ÿè‡ªè¡Œå•ç‹¬å¯åŠ¨æˆ–é”€æ¯ï¼Œæ‹¥æœ‰è‡ªå·±ç‹¬ç«‹çš„æ•°æ®åº“ã€‚ å¾®æœåŠ¡æ¶æ„ä¸»è¦è¦è§£å†³å“ªäº›é—®é¢˜ï¼Ÿ æœåŠ¡å¾ˆå¤šï¼Œå®¢æˆ·ç«¯æ€ä¹ˆè®¿é—®ï¼Œå¦‚ä½•æä¾›å¯¹å¤–ç½‘å…³? è¿™ä¹ˆå¤šæœåŠ¡ï¼ŒæœåŠ¡ä¹‹é—´å¦‚ä½•é€šä¿¡? HTTP è¿˜æ˜¯ RPC? è¿™ä¹ˆå¤šæœåŠ¡ï¼Œå¦‚ä½•æ²»ç†? æœåŠ¡çš„æ³¨å†Œå’Œå‘ç°ã€‚ æœåŠ¡æŒ‚äº†æ€ä¹ˆåŠï¼Ÿç†”æ–­æœºåˆ¶ã€‚ æœ‰å“ªäº›ä¸»æµå¾®æœåŠ¡æ¡†æ¶ï¼Ÿ Spring Cloud Netflix Spring Cloud Alibaba SpringBoot + Dubbo + ZooKeeper SpringCloud æœ‰å“ªäº›æ ¸å¿ƒç»„ä»¶ï¼Ÿ è¡¥å……37.SpringTask äº†è§£å—ï¼ŸSpringTask æ˜¯ Spring æ¡†æ¶æä¾›çš„ä¸€ä¸ªè½»é‡çº§çš„ä»»åŠ¡è°ƒåº¦æ¡†æ¶ï¼Œå®ƒå…è®¸æˆ‘ä»¬å¼€å‘è€…é€šè¿‡ç®€å•çš„æ³¨è§£æ¥é…ç½®å’Œç®¡ç†å®šæ—¶ä»»åŠ¡ã€‚ â‘ ã€@Scheduledï¼šæœ€å¸¸ç”¨çš„æ³¨è§£ï¼Œç”¨äºæ ‡è®°æ–¹æ³•ä¸ºè®¡åˆ’ä»»åŠ¡çš„æ‰§è¡Œç‚¹ã€‚æŠ€æœ¯æ´¾å®æˆ˜é¡¹ç›®ä¸­ï¼Œå°±ä½¿ç”¨è¯¥æ³¨è§£æ¥å®šæ—¶åˆ·æ–° sitemap.xmlï¼š @Scheduled(cron = 0 15 5 * * ?)public void autoRefreshCache() log.info(å¼€å§‹åˆ·æ–°sitemap.xmlçš„urlåœ°å€ï¼Œé¿å…å‡ºç°æ•°æ®ä¸ä¸€è‡´é—®é¢˜!); refreshSitemap(); log.info(åˆ·æ–°å®Œæˆï¼); @Scheduled æ³¨è§£æ”¯æŒå¤šç§è°ƒåº¦é€‰é¡¹ï¼Œå¦‚ fixedRateã€fixedDelay å’Œ cron è¡¨è¾¾å¼ã€‚ â‘¡ã€@EnableSchedulingï¼šç”¨äºå¼€å¯å®šæ—¶ä»»åŠ¡çš„æ”¯æŒã€‚ ç”¨SpringTaskèµ„æºå ç”¨å¤ªé«˜ï¼Œæœ‰ä»€ä¹ˆå…¶ä»–çš„æ–¹å¼è§£å†³ï¼Ÿï¼ˆè¡¥å……ï¼‰ ç¬¬ä¸€ï¼Œä½¿ç”¨æ¶ˆæ¯é˜Ÿåˆ—ï¼Œå¦‚ RabbitMQã€Kafkaã€RocketMQ ç­‰ï¼Œå°†ä»»åŠ¡æ”¾åˆ°æ¶ˆæ¯é˜Ÿåˆ—ä¸­ï¼Œç„¶åç”±æ¶ˆè´¹è€…å¼‚æ­¥å¤„ç†è¿™äº›ä»»åŠ¡ã€‚ â‘ ã€åœ¨è®¢å•åˆ›å»ºæ—¶ï¼Œå°†è®¢å•è¶…æ—¶æ£€æŸ¥ä»»åŠ¡æ”¾å…¥æ¶ˆæ¯é˜Ÿåˆ—ï¼Œå¹¶è®¾ç½®å»¶è¿Ÿæ—¶é—´ï¼ˆå³è®¢å•è¶…æ—¶æ—¶é—´ï¼‰ã€‚ @Servicepublic class OrderService @Autowired private RabbitTemplate rabbitTemplate; public void createOrder(Order order) // åˆ›å»ºè®¢å•é€»è¾‘ // ... // å‘é€å»¶è¿Ÿæ¶ˆæ¯ rabbitTemplate.convertAndSend(orderExchange, orderTimeoutQueue, order, message - message.getMessageProperties().setExpiration(600000); // è®¾ç½®å»¶è¿Ÿæ—¶é—´ï¼ˆ10åˆ†é’Ÿï¼‰ return message; ); â‘¡ã€ä½¿ç”¨æ¶ˆè´¹è€…ä»é˜Ÿåˆ—ä¸­æ¶ˆè´¹æ¶ˆæ¯ï¼Œå½“æ¶ˆè´¹åˆ°è¶…æ—¶ä»»åŠ¡æ—¶ï¼Œæ‰§è¡Œè®¢å•è¶…æ—¶å¤„ç†é€»è¾‘ã€‚ @Servicepublic class OrderTimeoutConsumer @RabbitListener(queues = orderTimeoutQueue) public void handleOrderTimeout(Order order) // å¤„ç†è®¢å•è¶…æ—¶é€»è¾‘ // ... ç¬¬äºŒï¼Œä½¿ç”¨æ•°æ®åº“è°ƒåº¦å™¨ï¼ˆå¦‚ Quartzï¼‰ã€‚ â‘ ã€åˆ›å»ºä¸€ä¸ª Quartz ä»»åŠ¡ç±»ï¼Œå¤„ç†è®¢å•è¶…æ—¶é€»è¾‘ã€‚ public class OrderTimeoutJob implements Job @Override public void execute(JobExecutionContext context) throws JobExecutionException // è·å–è®¢å•ä¿¡æ¯ Order order = (Order) context.getJobDetail().getJobDataMap().get(order); // å¤„ç†è®¢å•è¶…æ—¶é€»è¾‘ // ... â‘¡ã€åœ¨è®¢å•åˆ›å»ºæ—¶ï¼Œè°ƒåº¦ä¸€ä¸ª Quartz ä»»åŠ¡ï¼Œè®¾ç½®ä»»åŠ¡çš„è§¦å‘æ—¶é—´ä¸ºè®¢å•è¶…æ—¶æ—¶é—´ã€‚ @Servicepublic class OrderService @Autowired private Scheduler scheduler; public void createOrder(Order order) // åˆ›å»ºè®¢å•é€»è¾‘ // ... // è°ƒåº¦ Quartz ä»»åŠ¡ JobDetail jobDetail = JobBuilder.newJob(OrderTimeoutJob.class) .usingJobData(order, order) .build(); Trigger trigger = TriggerBuilder.newTrigger() .startAt(new Date(System.currentTimeMillis() + 600000)) // è®¾ç½®è§¦å‘æ—¶é—´ï¼ˆ10åˆ†é’Ÿåï¼‰ .build(); try scheduler.scheduleJob(jobDetail, trigger); catch (SchedulerException e) e.printStackTrace(); 41.Spring Cache äº†è§£å—ï¼ŸSpring Cache æ˜¯ Spring æ¡†æ¶æä¾›çš„ä¸€ä¸ªç¼“å­˜æŠ½è±¡ï¼Œå®ƒé€šè¿‡ç»Ÿä¸€çš„æ¥å£æ¥æ”¯æŒå¤šç§ç¼“å­˜å®ç°ï¼ˆå¦‚ Redisã€Caffeine ç­‰ï¼‰ã€‚ å®ƒé€šè¿‡æ³¨è§£ï¼ˆå¦‚ @Cacheableã€@CachePutã€@CacheEvictï¼‰æ¥å®ç°ç¼“å­˜ç®¡ç†ï¼Œæå¤§ç®€åŒ–äº†ä»£ç å®ç°ã€‚ @Cacheableï¼šç¼“å­˜æ–¹æ³•çš„è¿”å›å€¼ã€‚ @CachePutï¼šç”¨äºæ›´æ–°ç¼“å­˜ï¼Œæ¯æ¬¡è°ƒç”¨æ–¹æ³•éƒ½ä¼šå°†ç»“æœé‡æ–°å†™å…¥ç¼“å­˜ã€‚ @CacheEvictï¼šç”¨äºåˆ é™¤ç¼“å­˜ã€‚ä½¿ç”¨ç¤ºä¾‹ï¼š Spring Cache å’Œ Redis æœ‰ä»€ä¹ˆåŒºåˆ«ï¼Ÿ Spring Cache æ˜¯ Spring æ¡†æ¶æä¾›çš„ä¸€ä¸ªç¼“å­˜æŠ½è±¡ï¼Œå®ƒé€šè¿‡æ³¨è§£æ¥å®ç°ç¼“å­˜ç®¡ç†ï¼Œæ”¯æŒå¤šç§ç¼“å­˜å®ç°ï¼ˆå¦‚ Redisã€Caffeine ç­‰ï¼‰ã€‚ Redis æ˜¯ä¸€ä¸ªåˆ†å¸ƒå¼çš„ç¼“å­˜ä¸­é—´ä»¶ï¼Œæ”¯æŒå¤šç§æ•°æ®ç±»å‹ï¼ˆå¦‚ Stringã€Hashã€Listã€Setã€ZSetï¼‰ï¼Œè¿˜æ”¯æŒæŒä¹…åŒ–ã€é›†ç¾¤ã€ä¸»ä»å¤åˆ¶ç­‰ã€‚ Spring Cache é€‚åˆç”¨äºå•æœºã€è½»é‡çº§å’ŒçŸ­æ—¶ç¼“å­˜åœºæ™¯ï¼Œèƒ½å¤Ÿé€šè¿‡æ³¨è§£è½»æ¾æ§åˆ¶ç¼“å­˜ç®¡ç†ã€‚ Redis æ˜¯ä¸€ç§åˆ†å¸ƒå¼ç¼“å­˜è§£å†³æ–¹æ¡ˆï¼Œæ”¯æŒå¤šç§æ•°æ®ç»“æ„å’Œé«˜å¹¶å‘è®¿é—®ï¼Œé€‚åˆåˆ†å¸ƒå¼ç³»ç»Ÿå’Œé«˜å¹¶å‘åœºæ™¯ï¼Œå¯ä»¥æä¾›æ•°æ®æŒä¹…åŒ–å’Œå¤šç§æ·˜æ±°ç­–ç•¥ã€‚ åœ¨å®é™…å¼€å‘ä¸­ï¼ŒSpring Cache å’Œ Redis å¯ä»¥ç»“åˆä½¿ç”¨ï¼ŒSpring Cache æä¾›ç®¡ç†ç¼“å­˜çš„æ³¨è§£ï¼Œè€Œ Redis åˆ™ä½œä¸ºåˆ†å¸ƒå¼ç¼“å­˜çš„å®ç°ï¼Œæä¾›å…±äº«ç¼“å­˜æ”¯æŒã€‚ æœ‰äº† Redis ä¸ºä»€ä¹ˆè¿˜éœ€è¦ Spring Cacheï¼Ÿè™½ç„¶ Redis éå¸¸å¼ºå¤§ï¼Œä½† Spring Cache æä¾›äº†ä¸€å±‚ç¼“å­˜æŠ½è±¡ï¼Œç®€åŒ–äº†ç¼“å­˜çš„ç®¡ç†ã€‚æˆ‘ä»¬å¯ä»¥ç›´æ¥åœ¨æ–¹æ³•ä¸Šé€šè¿‡æ³¨è§£æ¥å®ç°ç¼“å­˜é€»è¾‘ï¼Œå‡å°‘äº†æ‰‹åŠ¨æ“ä½œ Redis çš„ä»£ç é‡ã€‚ Spring Cache è¿˜èƒ½çµæ´»åˆ‡æ¢åº•å±‚ç¼“å­˜å®ç°ã€‚æ­¤å¤–ï¼ŒSpring Cache æ”¯æŒäº‹åŠ¡æ€§ç¼“å­˜å’Œæ¡ä»¶ç¼“å­˜ï¼Œä¾¿äºåœ¨å¤æ‚åœºæ™¯ä¸­ç¡®ä¿æ•°æ®ä¸€è‡´æ€§ã€‚ è¯´è¯´Spring Cache çš„åº•å±‚åŸç†ï¼ŸSpring Cache æ˜¯åŸºäº AOP å’Œç¼“å­˜æŠ½è±¡å±‚å®ç°çš„ã€‚å®ƒé€šè¿‡ AOP æ‹¦æˆªè¢« @Cacheableã€@CachePut å’Œ @CacheEvict æ³¨è§£çš„æ–¹æ³•ï¼Œåœ¨æ–¹æ³•è°ƒç”¨å‰åè‡ªåŠ¨æ‰§è¡Œç¼“å­˜é€»è¾‘ã€‚ å…¶æä¾›çš„ CacheManager å’Œ Cache ç­‰æ¥å£ï¼Œä¸ä¾èµ–å…·ä½“çš„ç¼“å­˜å®ç°ï¼Œå› æ­¤å¯ä»¥çµæ´»åœ°é›†æˆ Redisã€Caffeine ç­‰å¤šç§ç¼“å­˜ã€‚ ConcurrentMapCacheManagerï¼šåŸºäº Java ConcurrentMap çš„æœ¬åœ°ç¼“å­˜å®ç°ã€‚ RedisCacheManagerï¼šåŸºäº Redis çš„åˆ†å¸ƒå¼ç¼“å­˜å®ç°ã€‚ CaffeineCacheManagerï¼šåŸºäº Caffeine çš„ç¼“å­˜å®ç°ã€‚","tags":["åŸºç¡€","spring"],"categories":["Javaé—®ç­”ç¬”è®°"]},{"title":"2025.6.12å­¦ä¹ æ—¥è®°","path":"/2025/06/12/å­¦ä¹ æ—¥è®°25å¹´6æœˆ/2025.6.12å­¦ä¹ ç¬”è®°/","content":"ä»Šæ—¥å­¦ä¹ å†…å®¹3DGS:ä»Šæ—¥å·¥ä½œæ€»ç»“ä»Šå¤©å¯¹å¼€æºæ•°æ®é›†train,truck,drjohnsonè¿›è¡Œè®­ç»ƒå’Œæµ‹è¯•.ç»“æœä¸»è¦ç”¨äºä¹‹åè·‘ä¸åŒæ”¹è¿›ç‰ˆæœ¬3DGSçš„å‚è€ƒã€‚ç»“æœåœ¨é£ä¹¦æ–‡æ¡£ä¸­åœ¨è®­ç»ƒdrjohnsonæ•°æ®é›†è¿‡ç¨‹ä¸­,è®­ç»ƒé€Ÿåº¦æ˜æ˜¾å˜æ…¢.åˆ†æåŸå› ï¼šå¯èƒ½æ˜¯drjohnsonæ•°æ®é›†ä¸­ï¼Œå›¾åƒåˆ†è¾¨ç‡ç›¸æ¯”trainå’Œtruckæ•°æ®é›†æ›´é«˜,ç‚¹äº‘æ•°é‡æ›´å¤§ï¼Œå¹¶ä¸”åœ¨train.pyè®­ç»ƒè¿‡ç¨‹ä¸­ï¼Œé«˜æ–¯çƒå…‹éš†æ›´åŠ æ¿€è¿›ï¼Œå¯¼è‡´æ˜¾å­˜äº¤æ¢æ›´åŠ é¢‘ç¹ï¼ŒIOæ—¶é—´å˜é•¿æˆ–è€…ç¼“å­˜ç¢ç‰‡åŒ–ï¼Œå¯¼è‡´è®­ç»ƒæ—¶é—´æˆå€å¢åŠ ã€‚ æ˜æ—¥å·¥ä½œè®¡åˆ’ç»§ç»­å°†drjohnsonæ•°æ®é›†ä¸playroomæ•°æ®é›†è¿›è¡Œè®­ç»ƒå’Œæµ‹è¯•ä½œä¸ºå‚è€ƒ.éƒ¨ç½²EfficientGSæ–¹æ³•è¿›è¡Œæµ‹è¯•,è¯¥æ–¹æ³•ä¸»è¦é’ˆå¯¹å®¤å¤–å¤§åœºæ™¯,å¯¹åŸç‰ˆ3DGSè¿›è¡Œæ€§èƒ½ä¼˜åŒ–. åŠ›æ‰£æ¯æ—¥ä¸€é¢˜:å¾ªç¯æ•°ç»„ç®€å•é¢˜. ä¸Šåˆçœ‹mysqlçœ‹åˆ°24é¢˜. ä¸‹åˆçœ‹é¡¹ç›®çœ‹äº†ä¸€ç¯‡Servletçš„æ–‡ç« . Springå­¦ä¹ å†™äº†å››æ¡,å¼€ä¸ªå¤´. æ™šä¸Šå­¦ä»£ç éšæƒ³å½•ç»§ç»­äºŒå‰æ ‘. åšäº†ä¸€é“æ•°ç»„æ¨¡æ‹Ÿç¯å½¢é“¾è¡¨æ‰¾å…¥å£çš„é¢˜,æŒºæœ‰æ„æ€çš„. https://leetcode.cn/problems/find-the-duplicate-number ç”Ÿæ´»è®°å½•æ™šä¸Šå¥èº«ä»Šå¤©ä¸»è¦ç»ƒçš„èƒŒ.","tags":["3DGS","spring","æ—¥è®°","leetcode","mysql"],"categories":["å­¦ä¹ æ—¥è®°","2025-06"]},{"title":"3DGS-Ubuntuç¯å¢ƒ.md","path":"/2025/06/11/3DGS/3DGS-Ubuntuç¯å¢ƒ/","content":"ç¯å¢ƒ:Ubuntu20.04å’ŒWin11åŒç³»ç»ŸCUDA11.8Anacoda3 å®‰è£…clash for linux å¿«æ·å‘½ä»¤ clashtun on off anaconda:source conda activate è™šæ‹Ÿç¯å¢ƒå","tags":["3DGS","å…¬å¸"],"categories":["3DGS"]},{"title":"3DGSå­¦ä¹ ç¬”è®°","path":"/2025/06/11/3DGS/3DGSå­¦ä¹ ç¬”è®°/","content":"ç¯å¢ƒé…ç½®https://www.youtube.com/watch?v=UXtuigy_wYc youtubeå¤ç°è§†é¢‘https://github.com/graphdeco-inria/gaussian-splatting 3DGSçš„githubæºç åœ°å€https://dl.acm.org/doi/10.1145/3592433 è®ºæ–‡åœ°å€https://arxiv.org/abs/2308.04079 ä¸‹è½½ä¾èµ–å’Œç¯å¢ƒè§†é¢‘è€å“¥çš„githubåœ°å€https://github.com/jonstephens85/gaussian-splatting-Windows ä¸‹è½½git(è·³è¿‡)æµ‹è¯•æ˜¯å¦ä¸‹è½½git â€“version ä¸‹è½½anaconda(è·³è¿‡)ä¸‹è½½CUDA :nvcc â€“versionæµ‹è¯•ç‰ˆæœ¬nvidia-smiç¡®å®šç”µè„‘æœ€é«˜æ”¯æŒçš„CUDAç‰ˆæœ¬ ,æˆ‘çš„æœ€é«˜æ”¯æŒ12.8 å‡†å¤‡ä¸‹è½½CUDA 11.8ç‰ˆæœ¬å®‰è£…vs2019å®˜æ–¹ä¸‹è½½åœ°å€ï¼šhttps://visualstudio.microsoft.com/zh-hans/vs/older-downloads/ ä¸‹è½½colmapå‡†å¤‡ç¼–è¯‘æ‰“å¼€anaconda prompt D: åˆ‡æ¢Dç›˜D:\\user\\desktop\\workplace\\3DGS\\userdesktopworkplace3DGS è¦å°† Anaconda åˆ›å»ºçš„è™šæ‹Ÿç¯å¢ƒè®¾ç½®åœ¨ D ç›˜ï¼Œå¯ä»¥æŒ‰ç…§ä»¥ä¸‹æ­¥éª¤æ“ä½œï¼š ä¿®æ”¹ Anaconda é…ç½®é¦–å…ˆï¼Œéœ€è¦ä¿®æ”¹ Anaconda çš„é…ç½®ï¼Œä½¿å…¶å°†ç¯å¢ƒåˆ›å»ºåœ¨æŒ‡å®šè·¯å¾„ã€‚åœ¨ Anaconda Prompt ä¸­æ‰§è¡Œä»¥ä¸‹å‘½ä»¤ï¼šconda config â€“add envs_dirs D:\\Anaconda\\envsï¼ˆå¦‚æœéœ€è¦ï¼Œå°† D:\\Anaconda\\envs æ›¿æ¢ä¸ºä½ æƒ³è¦çš„è·¯å¾„ï¼‰ ç¡®ä¿è·¯å¾„å­˜åœ¨ç¡®ä¿ä½ æŒ‡å®šçš„è·¯å¾„å·²ç»å­˜åœ¨ã€‚å¦‚æœä¸å­˜åœ¨ï¼Œè¯·æ‰‹åŠ¨åˆ›å»ºè¯¥æ–‡ä»¶å¤¹ã€‚ åˆ›å»ºè™šæ‹Ÿç¯å¢ƒç°åœ¨ä½ å°±å¯ä»¥åˆ›å»ºè™šæ‹Ÿç¯å¢ƒï¼Œæ–°çš„ç¯å¢ƒå°†è¢«åˆ›å»ºåœ¨ D ç›˜çš„æŒ‡å®šè·¯å¾„ä¸‹ï¼šconda create â€“name env_name python3.x æ£€æŸ¥ç¯å¢ƒä½ç½®å¯ä»¥ä½¿ç”¨ä»¥ä¸‹å‘½ä»¤æŸ¥çœ‹è™šæ‹Ÿç¯å¢ƒçš„ä½ç½®ï¼šconda info â€“envsç»è¿‡ä»¥ä¸Šæ­¥éª¤åï¼Œä½ çš„è™šæ‹Ÿç¯å¢ƒå°†ä¼šåœ¨ D ç›˜åˆ›å»ºã€‚conda create -n gaussian_splatting python3.7conda activate gaussian_splattingconda install -c conda-forge vs2019_win-64pip install torch1.13.1+cu117 torchvision0.14.1+cu117 torchaudio0.13.1 â€“extra-index-url https://download.pytorch.org/whl/cu117pip install submodulesdiff-gaussian-rasterizationpip install submodulessimple-knnpip install submodulesfused-ssim è®­ç»ƒ3dgsçš„è¿è¡Œè®­ç»ƒä¸‹è¿°æ‰€æœ‰å‘½ä»¤éƒ½æ˜¯åœ¨ç»ˆç«¯é‡Œè¿è¡Œçš„ï¼Œè¿è¡Œæ—¶ä¿æŒæ˜¯ä»gaussian-splattingç›®å½•ä¸‹å¼€å§‹è¾“å…¥çš„ã€‚çœæµç‰ˆæœ¬:conda activate gaussian_splattingd:cd D:\\sys\\Desktop\\Workplace\\3DGSæ–°çš„è·¯å¾„è®­ç»ƒ:python train.py -s data_train -m data_train/output (å‚æ•°ä¸ºè¾“å‡ºåœ°å€)python render.py -m data_train/outputæŠŠtrainæ–‡ä»¶å¤¹çš„methodå¤åˆ¶åˆ°testæ–‡ä»¶å¤¹python metrics.py -m data_train/output 1.è§†é¢‘æˆªå–å¸§è¿™é‡Œå¯ä»¥ç”¨è‡ªå·±æ‰‹æœºæ‹æ‘„çš„ä¸€æ®µè§†é¢‘ï¼Œä¸€ä¸¤åˆ†é’Ÿå³å¯ï¼Œå¯ä»¥å‚è€ƒä¸€ä¸‹ä½œè€…çš„è®­ç»ƒæ—¶é—´ï¼Œä½œè€…ç”¨è‡ªå·±çš„ç¬”è®°æœ¬ï¼ˆ4060 8Gï¼‰ï¼Œå¤§æ¦‚è®­ç»ƒäº†ä¸¤ä¸ªå°æ—¶å·¦å³ï¼Œè·‘å®Œäº†æ‰€æœ‰çš„è¿­ä»£ã€‚ åœ¨gaussian-splattingç›®å½•ä¸‹æ–°å»ºä¸€ä¸ªdataæ–‡ä»¶å¤¹ï¼Œå°†ä½ æ‹æ‘„çš„è§†é¢‘ç§»åŠ¨åˆ°è¯¥dataæ–‡ä»¶å¤¹ä¸‹ï¼Œå¹¶å°†ä½ çš„è§†é¢‘æ”¹åä¸ºinputï¼Œåç¼€.mp4ä¸ç”¨æ”¹ã€‚ç„¶ååœ¨dataæ–‡ä»¶å¤¹é‡Œå†å»ºä¸€ä¸ªä¸è§†é¢‘åŒåçš„æ–‡ä»¶å¤¹ï¼Œåå­—ä¹Ÿæ˜¯inputã€‚ç„¶åå°±å¯ä»¥è¾“å…¥å‘½ä»¤å•¦ï¼ˆç»ˆç«¯é‡Œä»gaussian-splattingdataç›®å½•ä¸‹å¼€å§‹è¾“å…¥ï¼‰ cd data ffmpeg -i input.mp4 -vf setpts=0.2*PTS input\\input_%04d.jpg #æ¨èè¿è¡Œè¿™ä¸ªæŒ‡ä»¤ ffmpeg -i input.mp4 -vf setpts=0.2*PTS,fps=1 input\\input_%04d.jpg #å¦‚æœéœ€è¦è°ƒæ•´æŠ½å¸§é¢‘ç‡å¯ä»¥å‚è€ƒè¿™ä¸ªæŒ‡ä»¤ã€‚é€‰æ‹©ä¸€ä¸ªè¿è¡Œå³å¯ è¿™é‡Œç®€å•çš„è¯´ä¸€ä¸‹å„ä¸ªå‚æ•°çš„å«ä¹‰ã€‚setpts0.2*PTS å°†è§†é¢‘æ’­æ”¾é€Ÿåº¦åŠ å¿«åˆ°åŸæ¥çš„ 5 å€ã€‚è¿™æ„å‘³ç€åŸè§†é¢‘çš„æ¯ç§’å¸§æ•°å¢åŠ åˆ° 5 å€ã€‚å¦‚æœåŸå§‹è§†é¢‘æ˜¯ 30 FPSï¼ŒåŠ é€Ÿåçš„è§†é¢‘å°†ä»¥ 150 FPS æ’­æ”¾ã€‚å°½ç®¡è§†é¢‘æ’­æ”¾é€Ÿåº¦åŠ å¿«äº†ï¼Œffmpeg fps1 ä¼šä»¥æ¯ç§’ä¸€å¸§çš„é¢‘ç‡æå–å›¾ç‰‡ã€‚ è¿™æ ·å°±å¯ä»¥æŠŠä½ çš„è§†é¢‘æˆªå–ä¸ºå¸§å¹¶ä¿å­˜åœ¨inputæ–‡ä»¶å¤¹é‡Œï¼Œåœ¨inputæ–‡ä»¶å¤¹é‡Œåº”è¯¥å¯ä»¥çœ‹åˆ°è®¸å¤šå¼ ç…§ç‰‡ã€‚ 2.äº§ç”Ÿç‚¹äº‘åœ¨ç»ˆç«¯gaussian-splattingç›®å½•ä¸‹è¾“å…¥cd ..python convert.py -s data è¿™ä¸ªå°±æ˜¯åˆ©ç”¨å®‰è£…çš„colmapäº§ç”Ÿç‚¹äº‘ï¼Œä¼šèŠ±è´¹ä¸€äº›æ—¶é—´ï¼Œç­‰å¾…å®Œæˆå³å¯ã€‚ 3.æŸ¥çœ‹ç‚¹äº‘ç»ˆç«¯é‡Œè¾“å…¥ colmap è°ƒå‡ºæ¥colmapåï¼Œé€‰æ‹©file-import modelç„¶åé€‰æ‹©gaussian-splattingdatasparse0æ–‡ä»¶å¤¹ï¼Œé€‰æ‹©ç¡®å®šï¼Œå³å¯æ‰“å¼€ç”Ÿæˆçš„ç‚¹äº‘ï¼Œé‡åˆ°å¼¹çª—Ã—æ‰å³å¯ã€‚å¯ä»¥çœ‹åˆ°ç”Ÿæˆçš„ç‚¹äº‘è¿˜æœ‰ç›¸æœºè·¯å¾„ã€‚ 4.å¼€å§‹è®­ç»ƒåŒæ ·ï¼Œåœ¨ç»ˆç«¯é‡Œgaussian-splattingç›®å½•ä¸‹ï¼Œè¾“å…¥ python train.py -s data -m dataoutput (å‚æ•°ä¸ºè¾“å‡ºåœ°å€)python train.py -s data -m dataimages æˆåŠŸå¼€å§‹ä¼šå‡ºç°å¦‚ä¸‹å›¾æ‰€ç¤ºç„¶åè€å¿ƒç­‰å¾…è®­ç»ƒå®Œæˆä»¥åå³å¯ã€‚ 5.æŸ¥çœ‹ç»“æœåŒæ ·ï¼Œåœ¨ç»ˆç«¯é‡Œgaussian-splattingç›®å½•ä¸‹ï¼Œè¾“å…¥ .\\viewers\\bin\\SIBR_gaussianViewer_app -m dataoutput å³å¯æ‰“å¼€viewerçª—å£ï¼Œå¯ä»¥æŠŠä½ çš„åœºæ™¯æ‹–å¤§ï¼Œä¸‹é¢æ˜¯ä¸€äº›å¿«æ·æŒ‰é”® w uio asd jkl å°±æ˜¯å¯ä»¥æ§åˆ¶è§†è§’çš„å˜åŒ–ï¼Œå¤§å®¶è‡ªå·±æŒ‰ä¸€ä¸‹å°±çŸ¥é“æ˜¯å¹²å•¥çš„äº†ï¼Œè¿™é‡Œå°±ä¸ä¸€ä¸€åˆ—ä¸¾å¯¹åº”çš„åŠŸèƒ½äº†ï¼ˆä½œè€…å·²ç»ç´¯äº†ï¼‰ï¼Œæ³¨æ„åˆ‡æ¢è¾“å…¥æ³•ä¸ºè‹±æ–‡è¾“å…¥ã€‚ è‡³æ­¤ï¼Œå°±å…¨éƒ¨ç»“æŸå•¦ï¼Œå®Œç»“æ’’èŠ±ï¼ 1 . convert.pyå°†inputæ•°æ®é›†è½¬æ¢æˆä¸ºç‚¹äº‘é€šè¿‡sfmç®—æ³•å°†è¾“å…¥çš„å›¾ç‰‡é›†è½¬æ¢æˆç‚¹äº‘,è¿™ç§æ–¹å¼çš„å…·ä½“æµç¨‹å¦‚ä¸‹: ç‰¹å¾æå–ï¼šä»è¾“å…¥çš„å›¾åƒé›†ä¸­ï¼Œå¯¹æ¯ä¸€å¼ å›¾åƒæå–ç‰¹å¾ç‚¹åŠå…¶æè¿°å­ï¼Œå¸¸ç”¨çš„ç‰¹å¾æå–ç®—æ³•æœ‰ SIFTã€SURFã€ORB ç­‰ã€‚ å…¨å±€ç‰¹å¾åŒ¹é…ï¼šåœ¨æ‰€æœ‰å›¾åƒçš„ç‰¹å¾ç‚¹ä¹‹é—´è¿›è¡ŒåŒ¹é…ï¼Œæ‰¾å‡ºä¸åŒå›¾åƒä¸­è¡¨ç¤ºåŒä¸€ç‰©ç†ç‚¹çš„ç‰¹å¾ç‚¹å¯¹ã€‚ç”±äºæ˜¯å…¨å±€åŒ¹é…ï¼Œå¯èƒ½ä¼šå¤„ç†å¤§é‡çš„ç‰¹å¾ç‚¹å¯¹ï¼Œè®¡ç®—é‡è¾ƒå¤§ã€‚ ç›¸æœºä½å§¿ä¼°è®¡ï¼šæ ¹æ®åŒ¹é…çš„ç‰¹å¾ç‚¹å¯¹ï¼Œä½¿ç”¨è¯¸å¦‚å¯¹æå‡ ä½•ã€PnP ç­‰ç®—æ³•æ¥ä¼°è®¡ç›¸æœºçš„ç›¸å¯¹ä½å§¿ã€‚ ä¸‰è§’æµ‹é‡ï¼šåˆ©ç”¨å·²çŸ¥çš„ç›¸æœºä½å§¿å’ŒåŒ¹é…çš„ç‰¹å¾ç‚¹ï¼Œé€šè¿‡ä¸‰è§’æµ‹é‡è®¡ç®—å‡ºä¸‰ç»´ç‚¹çš„åæ ‡ï¼Œä»è€Œç”Ÿæˆç‚¹äº‘ã€‚ å…¨å±€ä¼˜åŒ–ï¼šä½¿ç”¨æŸè°ƒæ•´ï¼ˆBundle Adjustmentï¼‰ç­‰æ–¹æ³•å¯¹ç›¸æœºä½å§¿å’Œä¸‰ç»´ç‚¹çš„åæ ‡è¿›è¡Œå…¨å±€ä¼˜åŒ–ï¼Œæé«˜ç‚¹äº‘çš„ç²¾åº¦ã€‚SfM ä¾§é‡äºå¯¹é™æ€å›¾åƒé›†è¿›è¡Œå…¨å±€å¤„ç†ï¼Œé€šè¿‡å…¨å±€ä¼˜åŒ–æ¥ç”Ÿæˆé«˜ç²¾åº¦çš„ç‚¹äº‘,SfMç›¸æ¯”ORBæ–¹æ³• æ›´ä¾§é‡äºç¦»çº¿çš„é«˜ç²¾åº¦ä¸‰ç»´é‡å»º. æ¸²æŸ“è¾å°„åœºçš„å‡ ç§æ–¹æ³•å»ºç«‹äº†æœ€è¿‘çš„æ•°æ®é›†ã€‚é©å‘½æ€§åœ°åˆæˆäº†ç”¨å¤šå¼ ç…§ç‰‡æˆ–è§†é¢‘æ•è·çš„åœºæ™¯ã€‚ç„¶è€Œï¼Œå®ç°é«˜è§†è§‰è´¨é‡ä»ç„¶éœ€è¦è®­ç»ƒå’Œæ¸²æŸ“æˆæœ¬é«˜æ˜‚çš„ç¥ç»ç½‘ç»œï¼Œè€Œæœ€è¿‘æ›´å¿«çš„æ–¹æ³•ä¸å¯é¿å…åœ°è¦ç‰ºç‰²é€Ÿåº¦æ¥æ¢å–è´¨é‡ã€‚å¯¹äºæ— ç•Œå’Œå®Œæ•´çš„åœºæ™¯(è€Œä¸æ˜¯å­¤ç«‹çš„å¯¹è±¡)å’Œ1080påˆ†è¾¨ç‡çš„æ¸²æŸ“ï¼Œç›®å‰æ²¡æœ‰ä¸€ç§æ–¹æ³•å¯ä»¥å®ç°å®æ—¶æ˜¾ç¤ºé€Ÿç‡ã€‚æˆ‘ä»¬ä»‹ç»äº†ä¸‰ä¸ªå…³é”®è¦ç´ ï¼Œä½¿æˆ‘ä»¬èƒ½å¤Ÿåœ¨ä¿æŒæœ‰ç«äº‰åŠ›çš„è®­ç»ƒæ—¶é—´çš„åŒæ—¶å®ç°æœ€å…ˆè¿›çš„è§†è§‰è´¨é‡ï¼Œå¹¶ä¸”é‡è¦çš„æ˜¯å…è®¸åœ¨1080påˆ†è¾¨ç‡ä¸‹å®ç°é«˜è´¨é‡çš„å®æ—¶(â‰¥30 fps)æ–°è§†å›¾åˆæˆã€‚é¦–å…ˆï¼Œä»ç›¸æœºæ ¡å‡†è¿‡ç¨‹ä¸­äº§ç”Ÿçš„ç¨€ç–ç‚¹å¼€å§‹ï¼Œæˆ‘ä»¬ç”¨3Dé«˜æ–¯åˆ†å¸ƒè¡¨ç¤ºåœºæ™¯ï¼Œè¯¥åˆ†å¸ƒä¿ç•™äº†ç”¨äºåœºæ™¯ä¼˜åŒ–çš„è¿ç»­ä½“è¾å°„åœºçš„ç†æƒ³å±æ€§ï¼ŒåŒæ—¶é¿å…äº†åœ¨ç©ºç™½ç©ºé—´ä¸­ä¸å¿…è¦çš„è®¡ç®—;å…¶æ¬¡ï¼Œæˆ‘ä»¬å¯¹3Dé«˜æ–¯åˆ†å¸ƒè¿›è¡Œäº¤é”™ä¼˜åŒ–å¯†åº¦æ§åˆ¶ï¼Œç‰¹åˆ«æ˜¯ä¼˜åŒ–å„å‘å¼‚æ€§åæ–¹å·®ä»¥å®ç°åœºæ™¯çš„å‡†ç¡®è¡¨ç¤º;ç¬¬ä¸‰ï¼Œæˆ‘ä»¬å¼€å‘äº†ä¸€ç§æ”¯æŒå„å‘å¼‚æ€§å–·æº…çš„å¿«é€Ÿå¯è§†æ€§æ„ŸçŸ¥æ¸²æŸ“ç®—æ³•ï¼Œæ—¢åŠ é€Ÿäº†è®­ç»ƒï¼Œåˆå…è®¸å®æ—¶æ¸²æŸ“ã€‚æˆ‘ä»¬å±•ç¤ºäº†æœ€å…ˆè¿›çš„è§†è§‰è´¨é‡å’Œå®æ—¶æ€§ 3dgsæµç¨‹3DGSæµç¨‹ï¼šï¼ˆ1ï¼‰é€šè¿‡colmapç­‰å·¥å…·ä»å¤šè§†è§’å›¾åƒè·å–SfMç‚¹äº‘ï¼ˆSfMæ˜¯ä¸€ç§ä¸‰ç»´é‡å»ºç®—æ³•ï¼Œé€šè¿‡ä¸¤ä¸ªæˆ–å¤šä¸ªåœºæ™¯å›¾ç‰‡æ¢å¤ç›¸æœºä½å§¿ï¼Œå¹¶é‡å»ºä¸‰ç»´åæ ‡ç‚¹ï¼‰ï¼Œå¯¹ SfM ç‚¹äº‘è¿›è¡Œäº†åˆå§‹åŒ–ã€‚ ï¼ˆ2ï¼‰ç‚¹äº‘ä¸­çš„æ¯ä¸€ä¸ªç‚¹ä»£è¡¨ç€ä¸€ä¸ªä¸‰ç»´çš„é«˜æ–¯åˆ†å¸ƒï¼Œé™¤äº†ç‚¹çš„ä½ç½®ï¼ˆå‡å€¼ï¼‰å¤–ï¼Œè¿˜æœ‰åæ–¹å·®ã€ä¸é€æ˜åº¦ã€é¢œè‰²ï¼ˆçƒè°å‡½æ•°ï¼‰â€“3D é«˜æ–¯çƒäº‘ã€‚ ï¼ˆ3ï¼‰å°†è¿™äº›æ¤­çƒä½“æ²¿ç€ç‰¹å®šè§’åº¦æŠ•å½±åˆ°å¯¹åº”ä½å§¿æ‰€åœ¨å¹³é¢ï¼ˆSplattingï¼‰ã€‚ä¸€ä¸ªæ¤­çƒä½“æŠ•å½±åˆ°å¹³é¢ä¼šå¾—åˆ°ä¸€ä¸ªæ¤­åœ†ï¼›ç„¶åé€šè¿‡è®¡ç®—å¾…æ±‚è§£åƒç´ å’Œæ¤­åœ†ä¸­å¿ƒçš„è·ç¦»ï¼Œæˆ‘ä»¬å¾—åˆ°ä¸é€æ˜åº¦ï¼ˆç¦»çš„è¿‘ï¼Œè¯´æ˜è¶Šä¸é€æ˜ï¼‰ï¼›æ¯ä¸ªæ¤­çƒåˆä»£è¡¨å„è‡ªçš„é¢œè‰²ï¼Œè¿›è¡Œalpha compostingæ¥åˆæˆé¢œè‰²ï¼Œç„¶åå¿«é€Ÿçš„å¯¹æ‰€æœ‰åƒç´ åšâ€œå¯å¾®å…‰æ …åŒ–â€ï¼Œæ¸²æŸ“å¾—åˆ°å›¾åƒã€‚ ï¼ˆ4ï¼‰å¾—åˆ°æ¸²æŸ“å›¾åƒImageåï¼Œå†ä¸gtå›¾åƒæ¯”è¾ƒï¼Œå¾—åˆ°æŸå¤±lossï¼Œå¹¶æ²¿è“è‰²ç®­å¤´åå‘ä¼ æ’­ï¼Œéšæœºæ¢¯åº¦ä¸‹é™ï¼›å‘ä¸‹é€å…¥è‡ªé€‚åº”å¯†åº¦æ§åˆ¶ä¸­ï¼ˆå¢å¯†æˆ–ä¿®å‰ªï¼‰ï¼Œæ›´æ–°ç‚¹äº‘ä¼˜åŒ–ã€‚ ä»£ç è¿è¡Œæµç¨‹1.Runningpython train.py -s ç¤ºä¾‹ï¼š python train.py -s data360_extra_scenestreehill è¿è¡Œå®Œåœ¨outputä¸‹å¾—åˆ°ç›¸åº”çš„æ–‡ä»¶å¤¹outputtreehillï¼Œ å°†å¾—åˆ°çš„ç»“æœè·¯å¾„æ·»åŠ è‡³SIBR_viewer.pyï¼ˆmodel_path râ€™D:\\gaussian-splatting\\output\\treehillâ€™ï¼‰ï¼Œè¿è¡Œå³å¯è·å¾—å¯è§†åŒ–ã€‚ densify_and_pruneæ“ä½œä¼šæ”¹å˜é«˜æ–¯æ•°é‡ã€‚ç»“åˆåœ¨ä¸€èµ·ï¼Œå…è®¸æ¨¡å‹æ ¹æ®å½“å‰ä¸¤ä¸ªçš„è®­ç»ƒçŠ¶æ€åŠ¨æ€åœ°è°ƒæ•´é«˜æ–¯çš„æ•°é‡ï¼Œä»è€Œå®ç°æ›´å¥½çš„è¡¨ç¤ºèƒ½åŠ›å’Œè®¡ç®—æ•ˆç‡ã€‚å› æ­¤ï¼Œåœ¨è¿™ä¸ªè¿‡ç¨‹ä¸­ï¼Œé«˜æ–¯çš„æ•°é‡ä¼šå˜åŒ–ï¼Œæ‰€ä»¥éœ€è¦åœ¨æ‰§è¡Œåæ‰“å°å‡ºå½“å‰çš„é«˜æ–¯æ•°é‡ã€‚åœ¨è®­ç»ƒçš„æ—¶å€™æ·»åŠ é«˜æ–¯æ•°é‡æ‰“å°ï¼š print(fâ€Iteration {iteration}: Number of Gaussians after densification and pruning: {gaussians.get_xyz.shape[0]}â€) 2. Evaluationpython train.py -s â€“eval # Train with traintest splitpython render.py -m # Generate renderingspython metrics.py -m # Compute error metrics on renderings è®­ç»ƒæ¨¡å‹-æ¸²æŸ“å›¾åƒ-è®¡ç®—æŒ‡æ ‡ ç¤ºä¾‹ï¼šEvaluationè¿è¡Œï¼Œè¾“å…¥å‘½ä»¤è¡Œ(python train.py -s + æ•°æ®é›†çš„è·¯å¾„) python train.py -s data360_extra_scenestreehill â€“evalpython render.py -m outputtreehillpython metrics.py -m outputtreehill 2. Processing your own ScenesæŒ‰ç…§README.meè¿›è¡Œï¼Œé€‰æ‹©çš„mill19building-pixsfmè¿›è¡Œç®€å•æµ‹è¯• å›¾åƒç›®å½•ç»“æ„ï¼š location|---input |---image 0 |---image 1 |---...python convert.py -s location [--resize] #If not resizing, ImageMagick is not neededç¤ºä¾‹ï¼šdata/mill19/building-pixsfm|---input |---image 0 |---image 1 |---... ç„¶åè¿è¡Œï¼š python convert.py -s datamill19building-pixsfm ä¸¤å¥ä»£ç ä¼˜åŒ–3DGSæ˜¾å­˜é—®é¢˜åšå®éªŒçš„æ—¶å€™å‘ç°ï¼Œå¯¹äºåŒä¸€ä¸ªåœºæ™¯ï¼Œå›¾ç‰‡è¶Šå¤šæ˜¾å­˜å ç”¨è¶Šå¤§ã€‚ä½†æ˜¯è®­ç»ƒçš„æ—¶å€™æ˜¯ä¸€å¼ å›¾ç‰‡åšä¸€æ¬¡æ¢¯åº¦ä¸‹é™ï¼Œè¯´æ˜batch_sizeä¸€ç›´æ˜¯1ã€‚é‚£æ•°æ®é›†å˜å¤§ï¼Œbatch_sizeä¸å˜çš„æƒ…å†µä¸‹ï¼Œæ˜¾å­˜å ç”¨å´å˜å¤§äº†ï¼Œè¿™æ˜æ˜¾å¾ˆä¸åˆç†ã€‚å½“è®­ç»ƒçš„å›¾ç‰‡æ¯”è¾ƒå¤šçš„æ—¶å€™ï¼Œæ˜¾å­˜å°±ä¸å¤Ÿäº†ã€‚ å›¾ç‰‡è¶Šå¤šï¼Œæ˜¾å­˜å ç”¨è¶Šå¤§ï¼Œè¿™å°±æš—ç¤ºäº†3DGSæºç é‡Œä¸€å®šæ˜¯è®­ç»ƒå‰é¢„å…ˆå°†æ‰€æœ‰çš„å›¾ç‰‡éƒ½åŠ è½½æ˜¾å­˜ä¸­çš„ã€‚äº‹å®ä¹Ÿç¡®å®å¦‚æ­¤ï¼Œåœ¨è®­ç»ƒå‰çš„é¢„å¤„ç†ä¸­ï¼Œä¸ºæ¯å¼ å›¾ç‰‡éƒ½æ„é€ äº†ä¸€ä¸ªå¯¹åº”çš„Cameraå¯¹è±¡ï¼ŒCameraçš„åˆå§‹åŒ–å‡½æ•°ä¸­å°±å°†å›¾ç‰‡åŠ è½½åˆ°äº†æ˜¾å­˜ä¸­ï¼Œå¦‚ä¸‹ã€‚ æºç scenecameras.pyä¸­39è¡Œï¼Œä¿®æ”¹å‰self.original_image image.clamp(0.0, 1.0).to(self.data_device) ä¿®æ”¹åself.original_image image.clamp(0.0, 1.0)è¿™ä¼˜åŒ–å¾ˆç®€å•ï¼Œä¸è¦æå‰è½½å…¥æ˜¾å­˜å°±å¥½äº†ï¼Œç›´æ¥æŠŠâ€œ.to(self.data_device)â€åˆ æ‰ã€‚è®­ç»ƒçš„æ—¶å€™ï¼Œå…·ä½“è®­ç»ƒå“ªå¼ å›¾ç‰‡ï¼Œè½½å…¥å“ªå¼ å›¾ç‰‡å°±å¥½äº†ã€‚è¿™ä¸ªåœ¨3DGSæºç ä¸­ï¼Œå·²ç»åšäº†ï¼Œå¦‚ä¸‹ã€‚ç»è¿‡æ‰€è¿°çš„ä»£ç ä¿®æ”¹åï¼Œç¡®å®æ˜¾å­˜å‡å°‘äº†ï¼Œä½†æ˜¯è®­ç»ƒé€Ÿåº¦å˜æ…¢äº†ã€‚å› ä¸ºç›¸æ¯”ä¿®æ”¹å‰ï¼Œå¤šå‡ºæ¥çš„è€—æ—¶åœ¨æ¯æ¬¡è®­ç»ƒè¿­ä»£ä¸­éƒ½æœ‰ä¸€æ¬¡å›¾ç‰‡åŠ è½½åˆ°æ˜¾å­˜ä¸­çš„æ“ä½œã€‚åœ¨cudaä¸­å°†æ•°æ®ä»å†…å­˜è½½å…¥æ˜¾å­˜æ˜¯å¯ä»¥å¼‚æ­¥è¿›è¡Œçš„ï¼Œpytorchä¹Ÿæä¾›äº†æ¥å£ï¼Œæ‰€ä»¥å¯¹ä»£ç åšå‡ºä»¥ä¸‹ä¿®æ”¹ã€‚ æºç train.pyä¸­90è¡Œï¼Œä¿®æ”¹å‰gt_image viewpoint_cam.original_image.cuda() ä¿®æ”¹åï¼Œéœ€ç§»åŠ¨åˆ°render_pkg render(â€¦)ä¹‹å‰gt_image viewpoint_cam.original_image.cuda(non_blockingTrue)ä¸è¿‡ä»…ä»…åªæ˜¯å°†è½½å…¥æ–¹å¼è®¾ç½®ä¸ºnon_blockingè¿˜ä¸å¤Ÿï¼Œå› ä¸ºå¯èƒ½åœ¨è¦ä½¿ç”¨gt_imageä¹‹å‰å…¶è¿˜æ²¡æœ‰å®Œæˆè½½å…¥æ˜¾å­˜çš„æ“ä½œï¼Œæ­¤æ—¶ä¹Ÿä¼šå‘ç”Ÿé˜»å¡ã€‚æ‰€ä»¥éœ€è¦å°†è¿™å¥ä»£ç å¾€å‰æ”¾ï¼Œå¯ä»¥æ”¾åˆ°â€œrender_pkg render(viewpoint_cam, gaussians, pipe, bg)â€è¿™å¥ä¹‹å‰ã€‚è¿™æ ·å°±å‡ ä¹ä¸ä¼šå½±å“è®­ç»ƒé€Ÿåº¦ã€‚","tags":["3DGS","å…¬å¸"],"categories":["3DGS"]},{"title":"2025.6.11å­¦ä¹ æ—¥è®°","path":"/2025/06/11/å­¦ä¹ æ—¥è®°25å¹´6æœˆ/2025.6.11å­¦ä¹ ç¬”è®°/","content":"ä»Šæ—¥å­¦ä¹ å†…å®¹3DGS:ä»Šæ—¥å·¥ä½œæ€»ç»“:â€‹ä¸€. ä»£ç è¿è¡Œä¸ç»“æ„æ¢³ç†â€‹â€‹:å­¦ä¹ äº†åŸç‰ˆ3DGSçš„é¡¹ç›®ç»“æ„å’Œè®­ç»ƒæµç¨‹: train.py : è®­ç»ƒè„šæœ¬,ä¸»è¦è´Ÿè´£å¯¹é«˜æ–¯çƒå‚æ•°è¿›è¡Œè®­ç»ƒ. render.py : æ¸²æŸ“è„šæœ¬,ç”¨äºå°†è®­ç»ƒå¾—åˆ°çš„é«˜æ–¯çƒå‚æ•°æ¸²æŸ“æˆå›¾åƒ. metrics.py : è¯„ä¼°è„šæœ¬,å¯¹æ¯”çœŸå€¼å›¾åƒå’Œæ¸²æŸ“å›¾åƒ,ç”¨äºè¯„ä¼°æ¸²æŸ“ç»“æœçš„è´¨é‡. äºŒ.è®­ç»ƒç»“æœ:ç«è½¦æ•°æ®é›†301å¼ å›¾åƒ. train.py :ITER 7000:L1æŸå¤± : 0.06603520661592484PSNR :20.096060180664065è®­ç»ƒæ—¶é—´ : 13åˆ†30ç§’ITER 30000:L1æŸå¤± : 0.038734884932637215PSNR : 24.450721740722656sè®­ç»ƒæ—¶é—´:77åˆ†25ç§’ render.py : metrics.py :SSIM: 0.87444342PSNR: 25.8431702LPIPS: 0.1703709 â€‹â€‹æ˜æ—¥å·¥ä½œè®¡åˆ’:â€‹â€‹ä»Šå¤©å¯¹ç«è½¦çš„æ•°æ®é›†è¿›è¡Œäº†å®éªŒ,æ˜å¤©å‡†å¤‡å¼€å§‹å¯¹å…¶ä»–æ•°æ®é›†è¿›è¡Œå®éªŒ,å¾—å‡ºä¸€ç»„åŸç‰ˆ3DGSçš„è®­ç»ƒç»“æœä½œä¸ºå‚è€ƒ,æ–¹ä¾¿å¯¹åç»­3DGSæ”¹è¿›ç®—æ³•è¿›è¡Œå®éªŒå¯¹æ¯”. ä¸‹åˆå›å­¦æ ¡å¼€ä¼šæ¥ç€æ™šä¸Šç»§ç»­åšåŠ›æ‰£äºŒå‰æ ‘ç¯‡æ˜æ—¥è®¡åˆ’3dgsæ˜å¤©å°½é‡è®©æ—¶é—´ä¸€ç›´åœ¨è·‘ä»£ç ,ç„¶åæˆ‘å¯ä»¥å­¦java. mysqlå­¦ä¹ åŠ›æ‰£é¡¹ç›®æ–‡æ¡£ç”Ÿæ´»è®°å½•1. æ—©ä¸Šè¶³çƒè®­ç»ƒæ—©ä¸Š7ç‚¹,é¢ çƒçŸ­ä¼ è®­ç»ƒ.","tags":["3DGS","æ—¥è®°"],"categories":["å­¦ä¹ æ—¥è®°","2025-06"]},{"title":"nvmæ›´æ”¹nodeç‰ˆæœ¬","path":"/2025/06/11/æ‚é¡¹ç¬”è®°/nvmæ›´æ”¹nodeç‰ˆæœ¬/","content":"å®‰è£…brewé¦–å…ˆå®‰è£… Brewã€‚è¿™ä¸ªå°±ä¸è¯¦ç»†è¯´äº† æ²¡æœ‰çš„è¯è‡ªå·±å»æœä¸€ä¸‹ ç¬¬ä¸€æ­¥ï¼šè¿›è¡Œnvm å®‰è£…æ“ä½œbrew install nvm æ‰§è¡Œåï¼š== Pouring nvm-0.39.1_1.all.bottle.tar.gz== CaveatsPlease note that upstream has asked us to make explicit managingnvm via Homebrew is unsupported by them and you should check anyproblems against the standard nvm install method prior to reporting.You should create NVMs working directory if it doesnt exist: // è¿™é‡Œå°±æ˜¯æç¤ºä½ åˆ›å»ºä¸€ä¸ª nvmæ–‡ä»¶ mkdir ~/.nvmAdd the following to ~/.zshrc or your desired shellconfiguration file: // è¿™é‡Œå°±æ˜¯æƒ³è®©ä½ è¿›è¡Œä¸€äº›é…ç½® export NVM_DIR=$HOME/.nvm [ -s /opt/homebrew/opt/nvm/nvm.sh ] \\. /opt/homebrew/opt/nvm/nvm.sh # This loads nvm [ -s /opt/homebrew/opt/nvm/etc/bash_completion.d/nvm ] \\. /opt/homebrew/opt/nvm/etc/bash_completion.d/nvm # This loads nvm bash_completionYou can set $NVM_DIR to any location, but leaving it unchanged from/opt/homebrew/opt/nvm will destroy any nvm-installed Node installationsupon upgrade/reinstall.Type `nvm help` for further information.== SummaryğŸº /opt/homebrew/Cellar/nvm/0.39.1_1: 9 files, 184KB æ‰§è¡Œ nvm â€“versionnvm --version //å‡ºç°é—®é¢˜ã€‚å»è¿›è¡Œé…ç½® zsh: command not found: nvm ç¬¬äºŒæ­¥ï¼šnvmé…ç½®1.vim ~/.bash_profileç‚¹å‡» i è¿›è¡Œæ’å…¥æ“ä½œ æ’å…¥ä¸‹é¢é…ç½® export NVM_DIR=~/.nvmsource $(brew --prefix nvm)/nvm.sh æ’å…¥å®Œæˆå ç‚¹å‡»Esc ç„¶å ä½¿ç”¨ :wq. ä¿å­˜å¹¶é€€å‡º æ‰§è¡Œï¼šsource ~/.bash_profile å¦‚æœå‡ºé—®é¢˜å…ˆä¸ç®¡æ¥ç€å¾€ä¸‹èµ° 2.vim ~/.zshrcç‚¹å‡» i è¿›è¡Œæ’å…¥æ“ä½œ æ’å…¥ä¸‹é¢é…ç½® export NVM_DIR=~/.nvmsource $(brew --prefix nvm)/nvm.sh æ’å…¥å®Œæˆå ç‚¹å‡»Esc ç„¶å ä½¿ç”¨ :wq. ä¿å­˜å¹¶é€€å‡º æ‰§è¡Œï¼šsource ~/.zshrc 3.vim ~/.profileç‚¹å‡» i è¿›è¡Œæ’å…¥æ“ä½œ æ’å…¥ä¸‹é¢é…ç½® export NVM_DIR=~/.nvmsource $(brew --prefix nvm)/nvm.sh æ’å…¥å®Œæˆå ç‚¹å‡»Esc ç„¶å ä½¿ç”¨ :wq. ä¿å­˜å¹¶é€€å‡º æ‰§è¡Œï¼šsource ~/.profile æœ€åå¼€å§‹è¿›è¡Œæµ‹è¯•æ‰§è¡Œï¼šnvm --version æ˜¾ç¤ºç‰ˆæœ¬å·å°±è¯´æ˜é…ç½®æˆåŠŸï¼š0.39.1 é€šè¿‡nvm è¿›è¡Œnode ç‰ˆæœ¬æ§åˆ¶ ç‰ˆæœ¬å·æ ¹æ®è‡ªå·±çš„éœ€æ±‚å®šä¹‰ nvm install 12.6.0 æŸ¥çœ‹ç‰ˆæœ¬ï¼šnode -v nvm å¸¸ç”¨å‘½ä»¤ï¼šä»¥ä¸‹ç”¨8.9.2ç‰ˆæœ¬ä¸ºä¾‹nvm ls ï¼šæ‰“å°å‡ºæ‰€æœ‰çš„ç‰ˆæœ¬ install stableï¼šå®‰è£…æœ€ç¨³å®šçš„ç‰ˆæœ¬nvm install v8.9.2 ï¼š å®‰è£…nodeçš„8.9.2çš„ç‰ˆæœ¬ï¼ˆåˆ é™¤ç”¨uninstallï¼‰nvm current ï¼šå½“å‰ä½¿ç”¨çš„nodeç‰ˆæœ¬nvm use v8.9.2 ï¼šå°†nodeæ”¹ä¸º8.9.2ç‰ˆæœ¬nvm alias default 0.12.7ï¼šè®¾ç½®é»˜è®¤ node ç‰ˆæœ¬ä¸º 0.12.7nvm alias default ï¼šè®¾ç½®ç³»ç»Ÿé»˜è®¤çš„nodeç‰ˆæœ¬nvm alias ï¼šç»™ä¸åŒçš„ç‰ˆæœ¬å·æ·»åŠ åˆ«ånvm unalias ï¼š åˆ é™¤å·²å®šä¹‰çš„åˆ«ånvm reinstall-packages ï¼šåœ¨å½“å‰ç‰ˆæœ¬nodeç¯å¢ƒä¸‹ï¼Œé‡æ–°å…¨å±€å®‰è£…æŒ‡å®šç‰ˆæœ¬å·çš„npmåŒ…npm install -g mz-fisï¼šå®‰è£… mz-fis æ¨¡å—è‡³å…¨å±€ç›®å½•ï¼Œå®‰è£…çš„è·¯å¾„ï¼š/Users/ä½ çš„ç”¨æˆ·å/.nvm/versions/node/v0.12.7/lib/mz-fisnvm use 4ï¼šåˆ‡æ¢è‡³ 4.2.2 ç‰ˆæœ¬ï¼ˆæ”¯æŒæ¨¡ç³ŠæŸ¥è¯¢ï¼‰npm install -g react-native-cliï¼šå®‰è£… react-native-cli æ¨¡å—è‡³å…¨å±€ç›®å½•ï¼Œå®‰è£…çš„è·¯å¾„ï¼š/Users/ä½ çš„ç”¨æˆ·å/.nvm/versions/node/v4.2.2/lib/react-native-cli node npm ç‰ˆæœ¬å¯¹ç…§é“¾æ¥: ç‰ˆæœ¬å¯¹ç…§ æœ«å°¾ npm é™çº§æ‰§è¡Œï¼šsudo npm install npm@6.9.0 -g é—®é¢˜æ˜¯ä¸å¯æ§çš„ å¦‚æœæœªèƒ½è§£å†³ä½ çš„é—®é¢˜ å°±ç¥ä½ é¡ºåˆ©","tags":["nvm","node"],"categories":["æ‚é¡¹ç¬”è®°"]},{"title":"Javaé›†åˆæ¡†æ¶ç¬”è®°","path":"/2025/06/10/åŸºç¡€ç¬”è®°/Javaé›†åˆæ¡†æ¶ç¬”è®°/","content":"æ¡†æ¶å›¾å…ˆè´´ä¸€ä¸ªJavaé›†åˆæ¡†æ¶å›¾ å¯ä»¥çœ‹å‡º,é›†åˆä¸»è¦åˆ†æˆä¸¤å¤§éƒ¨åˆ†: Collection:ä¸»è¦ç”± Listã€Setã€Queue ç»„æˆï¼ŒList ä»£è¡¨æœ‰åºã€å¯å¤çš„é›†åˆï¼Œå…¸å‹ä»£è¡¨å°±æ˜¯å°è£…äº†åŠ¨æ€æ•°ç»„çš„ ArrayList å’Œå°è£…äº†é“¾è¡¨çš„ LinkedListï¼›Set ä»£è¡¨â½†åºã€ä¸å¯å¤çš„é›†åˆï¼Œå…¸å‹ä»£è¡¨å°±æ˜¯ HashSet å’Œ TreeSetï¼›Queue ä»£è¡¨é˜Ÿåˆ—ï¼Œå…¸å‹ä»£è¡¨å°±æ˜¯åŒç«¯é˜Ÿåˆ—ArrayDequeï¼Œä»¥åŠä¼˜å…ˆçº§é˜Ÿåˆ— PriorityQueueã€‚ Map:ä»£è¡¨é”®å€¼å¯¹çš„é›†åˆï¼Œå…¸å‹ä»£è¡¨å°±æ˜¯ HashMapã€‚ CollectionListList çš„ç‰¹ç‚¹æ˜¯å­˜å–æœ‰åºï¼Œå¯ä»¥å­˜æ”¾å¤çš„å…ƒç´ ï¼Œå¯ä»¥â½¤ä¸‹æ ‡å¯¹å…ƒç´ è¿›â¾æ“ä½œã€‚ ArrayListArrayListçš„å¢åˆ æ”¹æŸ¥: // åˆ›å»ºâ¼€ä¸ªé›†åˆArrayListString list = new ArrayListString();// æ·»åŠ å…ƒç´ list.add(ç‹â¼†);list.add(æ²‰é»˜);list.add(é™ˆæ¸…æ‰¬);// éå†é›†åˆ for å¾ªç¯for (int i = 0; i list.size(); i++) String s = list.get(i); System.out.println(s);// éå†é›†åˆ for eachfor (String s : list) stem.out.println(s);// åˆ é™¤å…ƒç´ list.remove(1);// éå†é›†åˆfor (String s : list) System.out.println(s);// ä¿®æ”¹å…ƒç´ list.set(1,ç‹â¼†ç‹—);// éå†é›†åˆfor (String s : list) System.out.println(s);","tags":["åŸºç¡€","Java","é›†åˆ"],"categories":["åŸºç¡€ç¬”è®°"]},{"title":"Mysqlå­¦ä¹ ç¬”è®°","path":"/2025/06/10/Javaé—®ç­”ç¬”è®°/Mysqlå­¦ä¹ ç¬”è®°/","content":"MysqlåŸºç¡€ğŸŒŸ0.ä»€ä¹ˆæ˜¯MYSQLMySQL æ˜¯â¼€ä¸ªå¼€æºçš„å…³ç³»å‹æ•°æ®åº“ï¼Œç°åœ¨â¾ªå±äº Oracle å…¬å¸ã€‚ åˆ é™¤åˆ›å»ºä¸€å¼ è¡¨DROP TABLE åˆ é™¤è¡¨CREATE TABLE åˆ›å»ºè¡¨åˆ›å»ºè¡¨çš„æ—¶å€™ï¼Œå¯ä»¥é€šè¿‡ PRIMARY KEY è®¾å®šä¸»é”®ã€‚ CREATE TABLE users ( id INT AUTO_INCREMENT, name VARCHAR(100) NOT NULL, email VARCHAR(100), PRIMARY KEY (id)); å†™ä¸€ä¸ªå‡åºé™åºçš„SQLè¯­å¥å¯ä»¥ä½¿ç”¨ORDER BYå­—å¥å¯¹æŸ¥è¯¢ç»“æœè¿›è¡Œæ’åº.é»˜è®¤æƒ…å†µä¸‹æ˜¯å‡åºæ’åº.å¦‚éœ€è¦é™åº,ä½¿ç”¨å…³é”®å­—DESCä¾‹å­: SELECT id, name, salaryFROM employeesORDER BY salary DESC; å¦‚è‹¥å¯¹å¤šä¸ªå­—æ®µè¿›è¡Œæ’åº: SELECT id, name, salaryFROM employeesORDER BY salary DESC, name ASC; ä¼˜å…ˆçº§ä»å·¦åˆ°å³,ç›¸å½“äºå…ˆæŒ‰å·¥èµ„é™åº,å·¥èµ„ç›¸åŒå†æŒ‰ç…§å§“åå‡åº. MYSQLå‡ºç°æ€§èƒ½å·®çš„åŸå› å¯èƒ½æ˜¯ SQL æŸ¥è¯¢ä½¿â½¤äº†å…¨è¡¨æ‰«æï¼Œä¹Ÿå¯èƒ½æ˜¯æŸ¥è¯¢è¯­å¥è¿‡äºå¤æ‚ï¼Œå¦‚å¤šè¡¨JOINæˆ–åµŒå¥—â¼¦æŸ¥è¯¢ã€‚ä¹Ÿæœ‰å¯èƒ½æ˜¯å•è¡¨æ•°æ®é‡è¿‡â¼¤ã€‚ é€šå¸¸æƒ…å†µä¸‹,å¢åŠ ç´¢å¼•å°±å¯ä»¥è§£å†³å¤§éƒ¨åˆ†çš„æ€§èƒ½é—®é¢˜.å¯¹äºçƒ­ç‚¹æ•°æ®,å¢åŠ redisç¼“å­˜,å‡è½»å¯¹æ•°æ®åº“çš„å‹åŠ›. 1.ä¸¤å¼ è¡¨æ€ä¹ˆè¿›è¡Œè¿æ¥å¯ä»¥é€šè¿‡å†…è¿æ¥inner joinã€å¤–è¿æ¥ outer join ã€äº¤å‰è¿æ¥ cross join ç­‰æ–¹å¼æ¥è¿›è¡Œè¿æ¥. ä»€ä¹ˆæ˜¯å†…è¿æ¥å†…è¿æ¥â½¤äºè¿”å›ä¸¤ä¸ªè¡¨ä¸­æœ‰åŒ¹é…å…³ç³»çš„â¾ã€‚å‡è®¾æœ‰ä¸¤å¼ è¡¨ï¼Œâ½¤æˆ·è¡¨å’Œè®¢å•è¡¨ï¼Œæƒ³æŸ¥è¯¢æœ‰è®¢å•çš„â½¤æˆ·ï¼Œå°±å¯ä»¥ä½¿â½¤å†…è¿æ¥ users INNER JOIN ordersï¼ŒæŒ‰ç…§â½¤æˆ· ID å…³è”å°±â¾äº†ã€‚ SELECT users.name, orders.order_idFROM usersINNER JOIN orders ON users.id = orders.user_id; ä¸¤è¡¨åŒ¹é…çš„è¡Œæ‰ä¼šè¾“å‡º. ä»€ä¹ˆæ˜¯å¤–è¿æ¥å’Œå†…è¿æ¥ä¸åŒï¼Œå¤–è¿æ¥ä¸ä»…è¿”å›ä¸¤ä¸ªè¡¨ä¸­åŒ¹é…çš„â¾ï¼Œè¿˜è¿”å›æ²¡æœ‰åŒ¹é…çš„â¾ï¼Œâ½¤ null æ¥å¡«å……ã€‚å¤–è¿æ¥â¼œåˆ†ä¸ºå·¦å¤–è¿æ¥ left join å’Œå³å¤–è¿æ¥ right joinã€‚ left join ä¼šä¿ç•™å·¦è¡¨ä¸­ç¬¦åˆæ¡ä»¶çš„æ‰€æœ‰è®°å½•ï¼Œå¦‚æœå³è¡¨ä¸­æœ‰åŒ¹é…çš„è®°å½•ï¼Œå°±è¿”å›åŒ¹é…çš„è®°å½•ï¼Œå¦åˆ™å°±â½¤null å¡«å……ï¼Œå¸¸â½¤äºæŸè¡¨ä¸­æœ‰ï¼Œä½†å¦å¤–â¼€å¼ è¡¨ä¸­å¯èƒ½æ²¡æœ‰çš„æ•°æ®çš„æŸ¥è¯¢åœºæ™¯ã€‚å‡è®¾è¦æŸ¥è¯¢æ‰€æœ‰â½¤æˆ·åŠä»–ä»¬çš„è®¢å•ï¼Œå³ä½¿â½¤æˆ·æ²¡æœ‰ä¸‹å•ï¼Œå°±å¯ä»¥ä½¿â½¤å·¦è¿æ¥ï¼š SELECT users.id, users.name, orders.order_idFROM usersLEFT JOIN orders ON users.id = orders.user_id; (è¿™é‡Œé¢å·¦è¡¨å°±æ˜¯users,usersæ‰€æœ‰è¡Œéƒ½ä¼šè¾“å‡º) å³è¿æ¥å°±æ˜¯å·¦è¿æ¥çš„é•œåƒï¼Œright join ä¼šä¿ç•™å³è¡¨ä¸­ç¬¦åˆæ¡ä»¶çš„æ‰€æœ‰è®°å½•ï¼Œå¦‚æœå·¦è¡¨ä¸­æœ‰åŒ¹é…çš„è®°å½•ï¼Œå°±è¿”å›åŒ¹é…çš„è®°å½•ï¼Œå¦åˆ™å°±â½¤ null å¡«å……ã€‚ ä»€ä¹ˆæ˜¯äº¤å‰è¿æ¥äº¤å‰è¿æ¥ä¼šè¿”å›ä¸¤å¼ è¡¨çš„ç¬›å¡å°”ç§¯ï¼Œä¹Ÿå°±æ˜¯å°†å·¦è¡¨çš„æ¯â¼€â¾ä¸å³è¡¨çš„æ¯â¼€â¾è¿›â¾ç»„åˆï¼Œè¿”å›çš„â¾æ•°æ˜¯ä¸¤å¼ è¡¨â¾æ•°çš„ä¹˜ç§¯ã€‚å‡è®¾æœ‰ A è¡¨å’Œ B è¡¨ï¼ŒA è¡¨æœ‰ 2 â¾æ•°æ®ï¼ŒB è¡¨æœ‰ 3 â¾æ•°æ®ï¼Œé‚£ä¹ˆäº¤å‰è¿æ¥çš„ç»“æœå°±æ˜¯ 2 * 3 6 â¾ã€‚ç¬›å¡å°”ç§¯æ˜¯æ•°å­¦ä¸­çš„â¼€ä¸ªæ¦‚å¿µï¼Œä¾‹å¦‚é›†åˆ A{a,b}ï¼Œé›†åˆ B{0,1,2} ï¼Œé‚£ä¹ˆ A x B {a,0,a,1,a,2,b,0,b,1,b,2,}ã€‚ SELECT A.id, B.idFROM ACROSS JOIN B; 2.å†…è¿æ¥ å·¦è¿æ¥ å³è¿æ¥æœ‰ä»€ä¹ˆåŒºåˆ«å·¦è¿æ¥ FROM è¡¨a join è¡¨b ç›¸å½“äº aåœ¨å·¦ båœ¨å³MySQL çš„è¿æ¥ä¸»è¦åˆ†ä¸ºå†…è¿æ¥å’Œå¤–è¿æ¥ï¼Œå¤–è¿æ¥â¼œå¯ä»¥åˆ†ä¸ºå·¦è¿æ¥å’Œå³è¿æ¥ã€‚ å†…è¿æ¥ç›¸å½“äºæ‰¾ä¸¤è¡¨çš„äº¤é›†.å·¦è¿æ¥å’Œå³è¿æ¥å¯ä»¥â½¤æ¥æ‰¾å‡ºä¸¤ä¸ªè¡¨ä¸­ä¸åŒçš„è®°å½•ï¼Œç›¸å½“äºä¸¤ä¸ªæ•°æ®é›†çš„å¹¶é›†ã€‚ä¸¤è€…çš„åŒºåˆ«æ˜¯ï¼Œå·¦è¿æ¥ä¼šä¿ç•™å·¦è¡¨ä¸­ç¬¦åˆæ¡ä»¶çš„æ‰€æœ‰è®°å½•ï¼Œå³è¿æ¥åˆ™åˆšå¥½ç›¸åã€‚ ä¾‹å­:æœ‰ä¸‰å¼ è¡¨ï¼Œâ¼€å¼ â½‚ç« è¡¨ articleï¼Œä¸»è¦å­˜â½‚ç« æ ‡é¢˜ title.â¼€å¼ â½‚ç« è¯¦æƒ…è¡¨ article_detailï¼Œä¸»è¦å­˜â½‚ç« çš„å†…å®¹ content.â¼€å¼ â½‚ç« è¯„è®ºè¡¨ commentï¼Œä¸»è¦å­˜è¯„è®º content.ä¸‰ä¸ªè¡¨é€šè¿‡â½‚ç«  idå…³è”ã€‚å†…è¿æ¥:è¿”å›è‡³å°‘æœ‰è¯„è®ºçš„æ–‡ç« æ ‡é¢˜å’Œè¯„è®ºå†…å®¹ SELECT LEFT(a.title, 20) AS ArticleTitle, LEFT(c.content, 20) AS CommentContent //è¿”å›LEFTå·¦æ•°å‰20å­—ç¬¦ ASä¸ºåˆ—æˆ–è¡¨èµ·ä¸´æ—¶åˆ«åFROM article a //articleèµ·åˆ«å aINNER JOIN comment c ON a.id = c.article_id //å†…è¿æ¥ idç›¸åŒ èµ·åˆ«åcLIMIT 2; //åªè¿”å›ä¸¤æ¡ å·¦è¿æ¥:è¿”å›æ‰€æœ‰â½‚ç« çš„æ ‡é¢˜å’Œâ½‚ç« è¯„è®ºï¼Œå³ä½¿æŸäº›â½‚ç« æ²¡æœ‰è¯„è®ºï¼ˆå¡«å……ä¸º NULLï¼‰ã€‚ SELECT LEFT(a.title, 20) AS ArticleTitle, LEFT(c.content, 20) ASCommentContentFROM article aLEFT JOIN comment c ON a.id = c.article_idLIMIT 2; å³è¿æ¥:è°ƒæ¢äº†ä½ç½® SELECT LEFT(a.title, 20) AS ArticleTitle, LEFT(c.content, 20) ASCommentContentFROM comment cRIGHT JOIN article a ON a.id = c.article_idLIMIT 2; 3.æ•°æ®åº“çš„ä¸‰å¤§èŒƒå¼ - ç¬¬â¼€èŒƒå¼:ç¡®ä¿è¡¨çš„æ¯â¼€åˆ—éƒ½æ˜¯ä¸å¯åˆ†å‰²çš„åŸºæœ¬æ•°æ®å•å…ƒ.â½å¦‚è¯´â½¤æˆ·åœ°å€ï¼Œåº”è¯¥æ‹†åˆ†æˆçœã€å¸‚ã€åŒºã€è¯¦ç»†åœ°å€ç­‰ 4 ä¸ªå­—æ®µã€‚ç›¸å½“äºä¿æŒåˆ—çš„åŸå­æ€§. - ç¬¬â¼†èŒƒå¼:è¦æ±‚è¡¨ä¸­çš„æ¯â¼€åˆ—éƒ½å’Œä¸»é”®ç›´æ¥ç›¸å…³ã€‚â½å¦‚åœ¨è®¢å•è¡¨ä¸­ï¼Œå•†å“åç§°ã€å•ä½ã€å•†å“ä»·æ ¼ç­‰å­—æ®µåº”è¯¥æ‹†åˆ†åˆ°å•†å“è¡¨ä¸­ã€‚ç„¶åå†åˆ›å»ºä¸€ä¸ªè®¢å•å•†å“å…³è”è¡¨.ä¸èƒ½å‡ºç°éƒ¨åˆ†ä¾èµ–çš„æƒ…å†µ.ç›¸å½“äºè®©è§£å†³å¤åˆä¸»é”®çš„éƒ¨åˆ†ä¾èµ–é—®é¢˜.è®¢å•æ˜ç»†(è®¢å•ID, äº§å“ID, äº§å“åç§°, æ•°é‡)â†‘ å¤åˆä¸»é”®æ˜¯(è®¢å•ID, äº§å“ID)ï¼Œä½†â€äº§å“åç§°â€åªä¾èµ–â€äº§å“IDâ€ï¼ˆéƒ¨åˆ†ä¾èµ–ï¼‰ä¿®æ”¹ä¸º:è®¢å•æ˜ç»†(è®¢å•ID, äº§å“ID, æ•°é‡)äº§å“(äº§å“ID, äº§å“åç§°) - ç¬¬ä¸‰èŒƒå¼:â¾®ä¸»é”®åˆ—åº”è¯¥åªä¾èµ–äºä¸»é”®åˆ—ã€‚â½å¦‚è¯´åœ¨è®¾è®¡è®¢å•ä¿¡æ¯è¡¨çš„æ—¶å€™ï¼Œå¯ä»¥æŠŠå®¢æˆ·åç§°ã€æ‰€å±å…¬å¸ã€è”ç³»â½…å¼ç­‰ä¿¡æ¯æ‹†åˆ†åˆ°å®¢æˆ·ä¿¡æ¯è¡¨ä¸­ï¼Œç„¶ååœ¨è®¢å•ä¿¡æ¯è¡¨ä¸­â½¤å®¢æˆ·ç¼–å·è¿›â¾å…³è”ã€‚**ç›¸å½“äºæ¶ˆé™¤ä¼ é€’ä¾èµ–.**å°†â€‹â€‹ä¼ é€’ä¾èµ–â€‹â€‹çš„å­—æ®µï¼ˆAâ†’Bâ†’Cï¼Œå…¶ä¸­Aæ˜¯ä¸»é”®ï¼‰æ‹†åˆ†åˆ°æ–°è¡¨ä¸­ã€‚å­¦ç”Ÿ(å­¦å·, å§“å, å®¿èˆå·, å®¿èˆè´¹ç”¨)â†‘ â€œå®¿èˆè´¹ç”¨â€ä¾èµ–â€å®¿èˆå·â€ï¼Œè€Œâ€å®¿èˆå·â€ä¾èµ–â€å­¦å·â€ï¼ˆä¼ é€’ä¾èµ–ï¼‰ä¿®æ”¹ä¸º:å­¦ç”Ÿ(å­¦å·, å§“å, å®¿èˆå·)å®¿èˆ(å®¿èˆå·, å®¿èˆè´¹ç”¨) å»ºè¡¨æ—¶éœ€è¦è€ƒè™‘å“ªäº›é—®é¢˜â¾¸å…ˆéœ€è¦è€ƒè™‘è¡¨æ˜¯å¦ç¬¦åˆæ•°æ®åº“çš„ä¸‰â¼¤èŒƒå¼ï¼Œç¡®ä¿å­—æ®µä¸å¯å†åˆ†ï¼Œæ¶ˆé™¤â¾®ä¸»é”®ä¾èµ–ï¼Œç¡®ä¿å­—æ®µä»…ä¾èµ–äºä¸»é”®ç­‰ã€‚ç„¶ååœ¨é€‰æ‹©å­—æ®µç±»å‹æ—¶ï¼Œåº”è¯¥å°½é‡é€‰æ‹©åˆé€‚çš„æ•°æ®ç±»å‹ã€‚åœ¨å­—ç¬¦é›†ä¸Šï¼Œå°½é‡é€‰æ‹© utf8mb4ï¼Œè¿™æ ·ä¸ä»…å¯ä»¥â½€æŒä¸­â½‚å’Œè‹±â½‚ï¼Œè¿˜å¯ä»¥â½€æŒè¡¨æƒ…ç¬¦å·ç­‰ã€‚å½“æ•°æ®é‡è¾ƒâ¼¤æ—¶ï¼Œâ½å¦‚ä¸Šåƒä¸‡â¾æ•°æ®ï¼Œéœ€è¦è€ƒè™‘åˆ†è¡¨ã€‚â½å¦‚è®¢å•è¡¨ï¼Œå¯ä»¥é‡‡â½¤â½”å¹³åˆ†è¡¨çš„â½…å¼æ¥åˆ†æ•£å•è¡¨å­˜å‚¨å‹â¼’ã€‚ æ°´å¹³åˆ†è¡¨(æŒ‰è¡Œæ‹†åˆ†):æ°´å¹³åˆ†è¡¨æ˜¯å°†â€‹â€‹åŒä¸€å¼ è¡¨ä¸­çš„æ•°æ®æŒ‰è¡Œæ‹†åˆ†åˆ°å¤šä¸ªç»“æ„ç›¸åŒçš„è¡¨ä¸­ æŒ‰ç…§idèŒƒå›´åˆ†è¡¨ æŒ‰ç…§æ—¶é—´èŒƒå›´åˆ†è¡¨ æŒ‰ç…§hashåˆ†è¡¨ æŒ‰ç…§åœ°åŸŸåˆ†è¡¨ å‚ç›´åˆ†è¡¨(æŒ‰åˆ—æ‹†åˆ†):ä¸åŒåˆ†è¡¨åŒ…å«ä¸åŒå­—æ®µ,è¡¨å­—æ®µè¿‡å¤šæˆ–å†·çƒ­æ•°æ®åˆ†ç¦»æ—¶ä½¿ç”¨. 4.varchar ä¸ char çš„åŒºåˆ«latin1 å­—ç¬¦é›†ï¼Œä¸”åˆ—å±æ€§å®šä¹‰ä¸º NOT NULLã€‚ varchar æ˜¯å¯å˜â»“åº¦çš„å­—ç¬¦ç±»å‹ï¼ŒåŸåˆ™ä¸Šæœ€å¤šå¯ä»¥å®¹çº³ 65535 ä¸ªå­—ç¬¦ï¼Œä½†è€ƒè™‘å­—ç¬¦é›†ï¼Œä»¥åŠMySQL éœ€è¦ 1 åˆ° 2 ä¸ªå­—èŠ‚æ¥è¡¨ç¤ºå­—ç¬¦ä¸²â»“åº¦ï¼Œæ‰€ä»¥å®é™…ä¸Šæœ€â¼¤å¯ä»¥è®¾ç½®åˆ° 65533ã€‚char æ˜¯å›ºå®šâ»“åº¦çš„å­—ç¬¦ç±»å‹ï¼Œå½“å®šä¹‰â¼€ä¸ª CHAR(10) å­—æ®µæ—¶ï¼Œä¸ç®¡å®é™…å­˜å‚¨çš„å­—ç¬¦â»“åº¦æ˜¯å¤šå°‘ï¼Œéƒ½åªä¼šå â½¤ 10 ä¸ªå­—ç¬¦çš„ç©ºé—´ã€‚å¦‚æœæ’â¼Šçš„æ•°æ®â¼©äº 10 ä¸ªå­—ç¬¦ï¼Œå‰©ä½™çš„éƒ¨åˆ†ä¼šâ½¤ç©ºæ ¼å¡«å……ã€‚ varcharåœ¨è¾“å…¥è¿‡é•¿æ—¶ä¹Ÿä¼šæˆªæ–­. 5.blob å’Œ text æœ‰ä»€ä¹ˆåŒºåˆ«blob â½¤äºå­˜å‚¨â¼†è¿›åˆ¶æ•°æ®ï¼Œâ½å¦‚å›¾â½šã€â¾³é¢‘ã€è§†é¢‘ã€â½‚ä»¶ç­‰ï¼›ä½†å®é™…å¼€å‘ä¸­ï¼Œæˆ‘ä»¬éƒ½ä¼šæŠŠè¿™äº›â½‚ä»¶å­˜å‚¨åˆ° OSS æˆ–è€…â½‚ä»¶æœåŠ¡å™¨ä¸Šï¼Œç„¶ååœ¨æ•°æ®åº“ä¸­å­˜å‚¨â½‚ä»¶çš„ URLã€‚ text â½¤äºå­˜å‚¨â½‚æœ¬æ•°æ®ï¼Œâ½å¦‚â½‚ç« ã€è¯„è®ºã€â½‡å¿—ç­‰ã€‚ 6.DATETIME å’Œ TIMESTAMP æœ‰ä»€ä¹ˆåŒºåˆ«DATETIME ç›´æ¥å­˜å‚¨â½‡æœŸå’Œæ—¶é—´çš„å®Œæ•´å€¼ï¼Œä¸æ—¶åŒºâ½†å…³ã€‚TIMESTAMP å­˜å‚¨çš„æ˜¯ Unix æ—¶é—´æˆ³ï¼Œ1970-01-01 00:00:01 UTC ä»¥æ¥çš„ç§’æ•°ï¼Œå—æ—¶åŒºå½±å“ã€‚ å¦å¤–ï¼ŒDATETIME çš„é»˜è®¤å€¼ä¸º nullï¼Œå â½¤ 8 ä¸ªå­—èŠ‚ï¼›TIMESTAMP çš„é»˜è®¤å€¼ä¸ºå½“å‰æ—¶é—´â€”â€”CURRENT_TIMESTAMPï¼Œå  4 ä¸ªå­—èŠ‚ï¼Œå®é™…å¼€å‘ä¸­æ›´å¸¸â½¤ï¼Œå› ä¸ºå¯ä»¥â¾ƒåŠ¨æ›´æ–°ã€‚ 7. in å’Œ exists çš„åŒºåˆ«å½“ä½¿â½¤ IN æ—¶ï¼ŒMySQL ä¼šâ¾¸å…ˆæ‰§â¾â¼¦æŸ¥è¯¢ï¼Œç„¶åå°†â¼¦æŸ¥è¯¢çš„ç»“æœé›†â½¤äºå¤–éƒ¨æŸ¥è¯¢çš„æ¡ä»¶ã€‚è¿™æ„å‘³ç€â¼¦æŸ¥è¯¢çš„ç»“æœé›†éœ€è¦å…¨éƒ¨åŠ è½½åˆ°å†…å­˜ä¸­ã€‚ â½½ EXISTS ä¼šå¯¹å¤–éƒ¨æŸ¥è¯¢çš„æ¯â¼€â¾ï¼Œæ‰§â¾â¼€æ¬¡â¼¦æŸ¥è¯¢ã€‚å¦‚æœâ¼¦æŸ¥è¯¢è¿”å›ä»»ä½•â¾ï¼Œåˆ™EXISTSæ¡ä»¶ä¸ºçœŸã€‚EXISTS å…³æ³¨çš„æ˜¯â¼¦æŸ¥è¯¢æ˜¯å¦è¿”å›â¾ï¼Œâ½½ä¸æ˜¯è¿”å›çš„å…·ä½“å€¼ã€‚ -- IN çš„ä¸´æ—¶è¡¨å¯èƒ½æˆä¸ºæ€§èƒ½ç“¶é¢ˆSELECT * FROM usersWHERE id IN (SELECT user_id FROM orders WHERE amount 100);//æŸ¥è¯¢æ‰€æœ‰ä¸‹è¿‡å•ç¬”è®¢å•é‡‘é¢è¶…è¿‡100çš„ç”¨æˆ·ï¼ˆå®Œæ•´ä¿¡æ¯ï¼‰-- EXISTS å¯ä»¥åˆ©â½¤å…³è”ç´¢å¼•SELECT * FROM users uWHERE EXISTS (SELECT 1 FROM orders oWHERE o.user_id = u.id AND o.amount 100); IN é€‚â½¤äºâ¼¦æŸ¥è¯¢ç»“æœé›†è¾ƒâ¼©çš„æƒ…å†µã€‚å¦‚æœâ¼¦æŸ¥è¯¢è¿”å›â¼¤é‡æ•°æ®,INçš„æŸ¥è¯¢æ•ˆç‡ä¼šä¸‹é™,å› ä¸ºä»–ä¼šæŠŠæ•´ä¸ªç»“æœå­˜åˆ°å†…å­˜å½“ä¸­. â½½ EXISTS é€‚â½¤äºâ¼¦æŸ¥è¯¢ç»“æœé›†å¯èƒ½å¾ˆâ¼¤çš„æƒ…å†µã€‚ç”±äº EXISTS åªéœ€è¦åˆ¤æ–­â¼¦æŸ¥è¯¢æ˜¯å¦è¿”å›â¾ï¼Œâ½½ä¸éœ€è¦åŠ è½½æ•´ä¸ªç»“æœé›†ï¼Œå› æ­¤åœ¨æŸäº›æƒ…å†µä¸‹æ€§èƒ½æ›´å¥½ï¼Œç‰¹åˆ«æ˜¯å½“â¼¦æŸ¥è¯¢å¯ä»¥ä½¿â½¤ç´¢å¼•æ—¶ã€‚ NULLå€¼INçš„è¿”å›ç»“æœä¸­å¦‚æœæœ‰NULLå€¼,å¯èƒ½ä¼šå‡ºç°æ„æ–™å¤–çš„æƒ…å†µ:æ¯”å¦‚WHERE column IN ((subquery))ï¼Œå¦‚æœsubqueryä¸ºNULL,è¿™ä¸ªæ¡ä»¶æ°¸è¿œä¸ä¼šä¸ºçœŸ,é™¤écolumnä¹Ÿä¸ºNULL. EXISTSå¦‚æœæœ‰NULLå€¼çš„è¯,å› ä¸ºEXISTSåªå…³å¿ƒæ˜¯å¦æœ‰â¾,æ‰€ä»¥ä¸ä¼šå‡ºç°NULLå€¼çš„å½±å“. 8.è®°å½•è´§å¸â½¤ä»€ä¹ˆç±»å‹â½è¾ƒå¥½?å¦‚æœæ˜¯ç”µå•†ã€äº¤æ˜“ã€è´¦å•ç­‰æ¶‰åŠè´§å¸çš„åœºæ™¯ï¼Œå»ºè®®ä½¿â½¤ DECIMAL ç±»å‹ï¼Œå› ä¸º DECIMAL ç±»å‹æ˜¯ç²¾ç¡®æ•°å€¼ç±»å‹ï¼Œä¸ä¼šå‡ºç°æµ®ç‚¹æ•°è®¡ç®—è¯¯å·®ã€‚ å¦‚æœæ˜¯é“¶â¾,æ¶‰åŠåˆ°â½€ä»˜çš„åœºæ™¯ï¼Œå»ºè®®ä½¿â½¤ BIGINT ç±»å‹ã€‚å¯ä»¥å°†è´§å¸â¾¦é¢ä¹˜ä»¥â¼€ä¸ªå›ºå®šå› â¼¦ï¼Œâ½å¦‚ 100ï¼Œè¡¨ç¤ºä»¥â€œåˆ†â€ä¸ºå•ä½ï¼Œç„¶åå­˜å‚¨ä¸º BIGINT ã€‚è¿™ç§â½…å¼æ—¢é¿å…äº†æµ®ç‚¹æ•°é—®é¢˜ï¼ŒåŒæ—¶ä¹Ÿæä¾›äº†ä¸é”™çš„æ€§èƒ½ã€‚ä½†åœ¨å±•ç¤ºçš„æ—¶å€™éœ€è¦é™¤ä»¥ç›¸åº”çš„å› â¼¦ã€‚ ä¸ºä»€ä¹ˆä¸æ¨èä½¿â½¤ FLOAT æˆ– DOUBLEï¼Ÿå› ä¸º FLOAT å’Œ DOUBLE éƒ½æ˜¯æµ®ç‚¹æ•°ç±»å‹ï¼Œä¼šå­˜åœ¨ç²¾åº¦é—®é¢˜ã€‚åœ¨è®¸å¤šç¼–ç¨‹è¯­â¾”ä¸­ï¼Œ 0.1 + 0.2 çš„ç»“æœä¼šæ˜¯ç±»ä¼¼ 0.30000000000000004 çš„å€¼ï¼Œâ½½ä¸æ˜¯é¢„æœŸçš„ 0.3 ã€‚ 9.å¦‚ä½•å­˜å‚¨emoji?å› ä¸º emojiæ˜¯ 4 ä¸ªå­—èŠ‚çš„ UTF-8 å­—ç¬¦ï¼Œâ½½ MySQL çš„ utf8 å­—ç¬¦é›†åªâ½€æŒæœ€å¤š 3 ä¸ªå­—èŠ‚çš„ UTF-8 å­—ç¬¦ï¼Œæ‰€ä»¥åœ¨ MySQL ä¸­å­˜å‚¨ emoji æ—¶ï¼Œéœ€è¦ä½¿â½¤ utf8mb4 å­—ç¬¦é›†ã€‚ MySQL 8.0 å·²ç»é»˜è®¤â½€æŒ utf8mb4 å­—ç¬¦é›†ï¼Œå¯ä»¥é€šè¿‡ SHOW VARIABLES WHERE Variable_name LIKE character\\_set\\_% OR Variable_name LIKE collation%; æŸ¥çœ‹ã€‚ 10.dropã€delete ä¸ truncate çš„åŒºåˆ«ï¼Ÿ DROP æ˜¯ç‰©ç†åˆ é™¤ï¼Œâ½¤æ¥åˆ é™¤æ•´å¼ è¡¨ï¼ŒåŒ…æ‹¬è¡¨ç»“æ„ï¼Œä¸”ä¸èƒ½å›æ»šã€‚ DELETE â½€æŒâ¾çº§åˆ é™¤ï¼Œå¯ä»¥å¸¦ WHERE æ¡ä»¶ï¼Œå¯ä»¥å›æ»šã€‚ TRUNCATE â½¤äºæ¸…ç©ºè¡¨ä¸­çš„æ‰€æœ‰æ•°æ®ï¼Œä½†ä¼šä¿ç•™è¡¨ç»“æ„ï¼Œä¸èƒ½å›æ»šã€‚ 11.UNION ä¸ UNION ALL çš„åŒºåˆ«ï¼ŸUNION ä¼šâ¾ƒåŠ¨å»é™¤åˆå¹¶åç»“æœé›†ä¸­çš„é‡å¤â¾ã€‚UNION ALL ä¸ä¼šå»é‡ï¼Œä¼šå°†æ‰€æœ‰ç»“æœé›†åˆå¹¶èµ·æ¥ã€‚ 12.count(1)ã€count(*) ä¸ count(åˆ—å) çš„åŒºåˆ«ï¼Ÿåœ¨InnoDBå¼•æ“é‡Œé¢,count(1)å’Œcount(*)æ²¡æœ‰ä»»ä½•åŒºåˆ«,éƒ½ç”¨æ¥ç»Ÿè®¡æ‰€æœ‰è¡Œ,åŒ…æ‹¬NULL.å¦‚æœæœ‰ç´¢å¼•,é‚£ä¹ˆcount(1)å’Œcount(*)éƒ½ä¼šèµ°ç´¢å¼•,è€Œcount(åˆ—å)ä¼šèµ°ä¸»é”®ç´¢å¼•. COUNT(åˆ—å) åªç»Ÿè®¡åˆ—åä¸ä¸º NULL çš„â¾æ•°ã€‚ 13.SQL æŸ¥è¯¢è¯­å¥çš„æ‰§â¾é¡ºåºäº†è§£å—ï¼Ÿäº†è§£,å…ˆæ‰§è¡ŒFROMç¡®å®šä¸»è¡¨,ï¼Œå†æ‰§â¾JOINè¿æ¥ï¼Œç„¶å WHERE è¿›â¾è¿‡æ»¤ï¼Œæ¥ç€ GROUP BY è¿›â¾åˆ†ç»„ï¼ŒHAVING è¿‡æ»¤èšåˆç»“æœï¼ŒSELECT é€‰æ‹©æœ€ç»ˆåˆ—ï¼ŒORDER BY æ’åºï¼Œæœ€å LIMIT é™åˆ¶è¿”å›â¾æ•°ã€‚ WHERE å…ˆæ‰§â¾æ˜¯ä¸ºäº†å‡å°‘æ•°æ®é‡ï¼ŒHAVING åªèƒ½è¿‡æ»¤èšåˆæ•°æ®ï¼ŒORDER BY å¿…é¡»åœ¨SELECT ä¹‹åæ’åºæœ€ç»ˆç»“æœï¼ŒLIMIT æœ€åæ‰§â¾ä»¥å‡å°‘æ•°æ®ä¼ è¾“ã€‚ è¿™ä¸ªæ‰§â¾é¡ºåºä¸ç¼–å†™ SQL è¯­å¥çš„é¡ºåºä¸åŒï¼Œè¿™ä¹Ÿæ˜¯ä¸ºä»€ä¹ˆæœ‰æ—¶å€™åœ¨ SELECT â¼¦å¥ä¸­å®šä¹‰çš„åˆ«åä¸èƒ½åœ¨ WHERE â¼¦å¥ä¸­ä½¿â½¤å¾—åŸå› ï¼Œå› ä¸º WHERE æ˜¯åœ¨ SELECT ä¹‹å‰æ‰§â¾çš„ã€‚ LIMIT ä¸ºä»€ä¹ˆåœ¨æœ€åæ‰§â¾ï¼Ÿå› ä¸º LIMIT æ˜¯åœ¨æœ€ç»ˆç»“æœé›†ä¸Šæ‰§â¾çš„ï¼Œå¦‚æœåœ¨ WHERE ä¹‹å‰æ‰§â¾ LIMITï¼Œé‚£ä¹ˆå°±ä¼šå…ˆè¿”å›æ‰€æœ‰â¾ï¼Œç„¶åå†è¿›â¾ LIMIT é™åˆ¶ï¼Œè¿™æ ·ä¼šå¢åŠ æ•°æ®ä¼ è¾“çš„å¼€é”€ã€‚ ORDER BY ä¸ºä»€ä¹ˆåœ¨ SELECT ä¹‹åæ‰§â¾ï¼Ÿå› ä¸ºæ’åºéœ€è¦åŸºäºæœ€ç»ˆè¿”å›çš„åˆ—ï¼Œå¦‚æœ ORDER BY æ—©äº SELECT æ‰§â¾ï¼Œè®¡ç®— ç±»çš„èšåˆå‡½æ•°å°±ä¼šå‡ºé—®é¢˜ã€‚æ¯”å¦‚è¯´å¦‚æœè¦æŒ‰ç…§æ‰€é€‰çš„å¹³å‡å€¼æ’åº,order byå…ˆæ‰§è¡Œ,è¿˜æ²¡æœ‰è®¡ç®—å¹³å‡å€¼. 14.ä»‹ç»â¼€ä¸‹ MySQL çš„å¸¸â½¤å‘½ä»¤MySQL çš„å¸¸â½¤å‘½ä»¤ä¸»è¦åŒ…æ‹¬æ•°æ®åº“æ“ä½œå‘½ä»¤ã€è¡¨æ“ä½œå‘½ä»¤ã€â¾æ•°æ® CRUD å‘½ä»¤ã€ç´¢å¼•å’Œçº¦æŸçš„åˆ›å»ºä¿®æ”¹å‘½ä»¤ã€â½¤æˆ·å’Œæƒé™ç®¡ç†çš„å‘½ä»¤ã€äº‹åŠ¡æ§åˆ¶çš„å‘½ä»¤ç­‰ã€‚ -- æ•°æ®åº“æ“ä½œCREATE DATABASE db_name; -- åˆ›å»ºæ•°æ®åº“DROP DATABASE db_name; -- åˆ é™¤æ•°æ®åº“SHOW DATABASES; -- æŸ¥çœ‹æ‰€æœ‰æ•°æ®åº“USE db_name; -- åˆ‡æ¢æ•°æ®åº“-- è¡¨æ“ä½œCREATE TABLE table_name ( -- åˆ›å»ºè¡¨ id INT PRIMARY KEY AUTO_INCREMENT, name VARCHAR(50) NOT NULL);DROP TABLE table_name; -- åˆ é™¤è¡¨ALTER TABLE table_name ADD COLUMN col_name INT; -- æ·»åŠ åˆ—ALTER TABLE table_name DROP COLUMN col_name; -- åˆ é™¤åˆ—SHOW TABLES; -- æŸ¥çœ‹æ‰€æœ‰è¡¨DESC table_name; -- æŸ¥çœ‹è¡¨ç»“æ„-- æ•°æ®CRUDINSERT INTO table_name VALUES (1, test); -- æ’å…¥æ•°æ®SELECT * FROM table_name; -- æŸ¥è¯¢æ•°æ®UPDATE table_name SET name=new WHERE id=1;-- æ›´æ–°æ•°æ®DELETE FROM table_name WHERE id=1; -- åˆ é™¤æ•°æ®-- ç´¢å¼•å’Œçº¦æŸCREATE INDEX idx_name ON table_name(col); -- åˆ›å»ºç´¢å¼•ALTER TABLE table_name ADD PRIMARY KEY(id); -- æ·»åŠ ä¸»é”®ALTER TABLE table_name ADD UNIQUE(col_name); -- æ·»åŠ å”¯ä¸€çº¦æŸALTER TABLE table_name ADD FOREIGN KEY(col) REFERENCES other_table(col); -- å¤–é”®-- ç”¨æˆ·æƒé™CREATE USER user@host IDENTIFIED BY pwd; -- åˆ›å»ºç”¨æˆ·GRANT ALL ON db_name.* TO user@host; -- æˆæƒREVOKE ALL ON db_name.* FROM user@host; -- æ’¤é”€æƒé™DROP USER user@host; -- åˆ é™¤ç”¨æˆ·-- äº‹åŠ¡æ§åˆ¶START TRANSACTION; -- å¼€å§‹äº‹åŠ¡COMMIT; -- æäº¤äº‹åŠ¡ROLLBACK; -- å›æ»šäº‹åŠ¡SET autocommit=0; -- å…³é—­è‡ªåŠ¨æäº¤ è¯´è¯´æ•°æ®åº“æ“ä½œå‘½ä»¤?CREATE DATABASE database_name; â½¤äºåˆ›å»ºæ•°æ®åº“;USE database_name;â½¤äºæ˜¾ç¤ºæ‰€æœ‰æ•°æ®åº“;DROP DATABASE database_name;â½¤äºåˆ é™¤æ•°æ®åº“;SHOW DATABASES; æ¢æ•°æ®åº“ã€‚ è¯´è¯´è¡¨æ“ä½œå‘½ä»¤ï¼ŸCREATE TABLE table_name (åˆ—å1 æ•°æ®ç±»å‹1, åˆ—å2 æ•°æ®ç±»å‹2,...); ç”¨äºåˆ›å»ºè¡¨ï¼›DROP TABLE table_name; ç”¨äºåˆ é™¤è¡¨ï¼›SHOW TABLES; ç”¨äºæ˜¾ç¤ºæ‰€æœ‰è¡¨ï¼›DESCRIBE table_name; ç”¨äºæŸ¥çœ‹è¡¨ç»“æ„ï¼›ALTER TABLE table_name ADD column_name datatype; ç”¨äºä¿®æ”¹è¡¨ã€‚ è¯´è¯´è¡Œæ•°æ®çš„ CRUD å‘½ä»¤ï¼ŸINSERT INTO table_name (column1, column2, ...) VALUES (value1, value2, ...); ç”¨äºæ’å…¥æ•°æ®ï¼›SELECT column_names FROM table_name WHERE condition; ç”¨äºæŸ¥è¯¢æ•°æ®ï¼›UPDATE table_name SET column1 = value1, column2 = value2 WHERE condition; ç”¨äºæ›´æ–°æ•°æ®ï¼›DELETE FROM table_name WHERE condition; ç”¨äºåˆ é™¤æ•°æ®ã€‚ è¯´è¯´ç´¢å¼•å’Œçº¦æŸçš„åˆ›å»ºä¿®æ”¹å‘½ä»¤ï¼ŸCREATE INDEX index_name ON table_name (column_name); ç”¨äºåˆ›å»ºç´¢å¼•ï¼›ALTER TABLE table_name ADD PRIMARY KEY (column_name); ç”¨äºæ·»åŠ ä¸»é”®ï¼›ALTER TABLE table_name ADD CONSTRAINT fk_name FOREIGN KEY (column_name) REFERENCES parent_table (parent_column_name); ç”¨äºæ·»åŠ å¤–é”®ã€‚ è¯´è¯´ç”¨æˆ·å’Œæƒé™ç®¡ç†çš„å‘½ä»¤ï¼ŸCREATE USER username@host IDENTIFIED BY password; ç”¨äºåˆ›å»ºç”¨æˆ·ï¼›GRANT ALL PRIVILEGES ON database_name.table_name TO username@host; ç”¨äºæˆäºˆæƒé™ï¼›REVOKE ALL PRIVILEGES ON database_name.table_name FROM username@host; ç”¨äºæ’¤é”€æƒé™ï¼›DROP USER username@host; ç”¨äºåˆ é™¤ç”¨æˆ·ã€‚ è¯´è¯´äº‹åŠ¡æ§åˆ¶çš„å‘½ä»¤ï¼ŸSTART TRANSACTION; ç”¨äºå¼€å§‹äº‹åŠ¡ï¼›COMMIT; ç”¨äºæäº¤äº‹åŠ¡ï¼›ROLLBACK; ç”¨äºå›æ»šäº‹åŠ¡ã€‚ 15.MySQL bin ç›®å½•ä¸‹çš„å¯æ‰§è¡Œæ–‡ä»¶äº†è§£å—MySQL çš„ bin ç›®å½•ä¸‹æœ‰å¾ˆå¤šå¯æ‰§è¡Œæ–‡ä»¶ï¼Œä¸»è¦ç”¨äºç®¡ç† MySQL æœåŠ¡å™¨ã€æ•°æ®åº“ã€è¡¨ã€æ•°æ®ç­‰ã€‚æ¯”å¦‚è¯´ï¼šmysqlï¼šç”¨äºè¿æ¥ MySQL æœåŠ¡å™¨mysqldumpï¼šç”¨äºæ•°æ®åº“å¤‡ä»½ï¼Œå¯¹æ•°æ®å¤‡ä»½ã€è¿ç§»æˆ–æ¢å¤æ—¶éå¸¸æœ‰ç”¨mysqladminï¼šç”¨æ¥æ‰§è¡Œä¸€äº›ç®¡ç†æ“ä½œï¼Œæ¯”å¦‚è¯´åˆ›å»ºæ•°æ®åº“ã€åˆ é™¤æ•°æ®åº“ã€æŸ¥çœ‹ MySQL æœåŠ¡å™¨çš„çŠ¶æ€ç­‰ã€‚mysqlcheckï¼šç”¨äºæ£€æŸ¥ã€ä¿®å¤ã€åˆ†æå’Œä¼˜åŒ–æ•°æ®åº“è¡¨ï¼Œå¯¹æ•°æ®åº“çš„ç»´æŠ¤å’Œæ€§èƒ½ä¼˜åŒ–éå¸¸æœ‰ç”¨ã€‚mysqlimportï¼šç”¨äºä»æ–‡æœ¬æ–‡ä»¶ä¸­å¯¼å…¥æ•°æ®åˆ°æ•°æ®åº“è¡¨ä¸­ï¼Œé€‚åˆæ‰¹é‡æ•°æ®å¯¼å…¥ã€‚mysqlshowï¼šç”¨äºæ˜¾ç¤º MySQL æ•°æ®åº“æœåŠ¡å™¨ä¸­çš„æ•°æ®åº“ã€è¡¨ã€åˆ—ç­‰ä¿¡æ¯ã€‚mysqlbinlogï¼šç”¨äºæŸ¥çœ‹ MySQL äºŒè¿›åˆ¶æ—¥å¿—æ–‡ä»¶çš„å†…å®¹ï¼Œå¯ä»¥ç”¨äºæ¢å¤æ•°æ®ã€æŸ¥çœ‹æ•°æ®å˜æ›´ç­‰ã€‚ 16.MySQL ç¬¬ 3-10 æ¡è®°å½•æ€ä¹ˆæŸ¥ï¼Ÿå¯ä»¥ä½¿ç”¨ limit è¯­å¥ï¼Œç»“åˆåç§»é‡å’Œè¡Œæ•°æ¥å®ç°ã€‚ SELECT * FROM table_name LIMIT 2, 8; limit è¯­å¥ç”¨äºé™åˆ¶æŸ¥è¯¢ç»“æœçš„æ•°é‡ï¼Œåç§»é‡è¡¨ç¤ºä»å“ªæ¡è®°å½•å¼€å§‹ï¼Œè¡Œæ•°è¡¨ç¤ºè¿”å›çš„è®°å½•æ•°é‡ã€‚2ï¼šåç§»é‡ï¼Œè¡¨ç¤ºè·³è¿‡å‰ä¸¤æ¡è®°å½•ï¼Œä»ç¬¬ä¸‰æ¡è®°å½•å¼€å§‹ã€‚8ï¼šè¡Œæ•°ï¼Œè¡¨ç¤ºä»åç§»é‡å¼€å§‹ï¼Œè¿”å› 8 æ¡è®°å½•ã€‚åç§»é‡æ˜¯ä» 0 å¼€å§‹çš„ï¼Œå³ç¬¬ä¸€æ¡è®°å½•çš„åç§»é‡æ˜¯ 0ï¼›å¦‚æœæƒ³ä»ç¬¬ 3 æ¡è®°å½•å¼€å§‹ï¼Œåç§»é‡å°±åº”è¯¥æ˜¯ 2ã€‚ 17.ç”¨è¿‡å“ªäº› MySQL å‡½æ•°ï¼Ÿç”¨è¿‡æŒºå¤šçš„ï¼Œæ¯”å¦‚è¯´å¤„ç†å­—ç¬¦ä¸²çš„å‡½æ•°ï¼šCONCAT(): ç”¨äºè¿æ¥ä¸¤ä¸ªæˆ–å¤šä¸ªå­—ç¬¦ä¸²ã€‚LENGTH(): ç”¨äºè¿”å›å­—ç¬¦ä¸²çš„é•¿åº¦ã€‚SUBSTRING(): ä»å­—ç¬¦ä¸²ä¸­æå–å­å­—ç¬¦ä¸²ã€‚REPLACE(): æ›¿æ¢å­—ç¬¦ä¸²ä¸­çš„æŸéƒ¨åˆ†ã€‚TRIM(): å»é™¤å­—ç¬¦ä¸²ä¸¤ä¾§çš„ç©ºæ ¼æˆ–å…¶ä»–æŒ‡å®šå­—ç¬¦ã€‚ å¤„ç†æ•°å­—çš„å‡½æ•°ï¼šABS(): è¿”å›ä¸€ä¸ªæ•°çš„ç»å¯¹å€¼ã€‚ROUND(): å››èˆäº”å…¥åˆ°æŒ‡å®šçš„å°æ•°ä½æ•°ã€‚MOD(): è¿”å›é™¤æ³•æ“ä½œçš„ä½™æ•°ã€‚ æ—¥æœŸå’Œæ—¶é—´å¤„ç†å‡½æ•°ï¼šNOW(): è¿”å›å½“å‰çš„æ—¥æœŸå’Œæ—¶é—´ã€‚CURDATE(): è¿”å›å½“å‰çš„æ—¥æœŸã€‚ æ±‡æ€»å‡½æ•°ï¼šSUM(): è®¡ç®—æ•°å€¼åˆ—çš„æ€»å’Œã€‚AVG(): è®¡ç®—æ•°å€¼åˆ—çš„å¹³å‡å€¼ã€‚COUNT(): è®¡ç®—æŸåˆ—çš„è¡Œæ•°ã€‚ é€»è¾‘å‡½æ•°ï¼šIF(): å¦‚æœæ¡ä»¶ä¸ºçœŸï¼Œåˆ™è¿”å›ä¸€ä¸ªå€¼ï¼›å¦åˆ™è¿”å›å¦ä¸€ä¸ªå€¼ã€‚CASE: æ ¹æ®ä¸€ç³»åˆ—æ¡ä»¶è¿”å›å€¼ã€‚ 18.è¯´è¯´ SQL çš„éšå¼æ•°æ®ç±»å‹è½¬æ¢ï¼Ÿå½“ä¸€ä¸ªæ•´æ•°å’Œä¸€ä¸ªæµ®ç‚¹æ•°ç›¸åŠ æ—¶ï¼Œæ•´æ•°ä¼šè¢«è½¬æ¢ä¸ºæµ®ç‚¹æ•°ã€‚SELECT 1 + 1.0; â€“ ç»“æœä¸º 2.0å½“ä¸€ä¸ªå­—ç¬¦ä¸²å’Œä¸€ä¸ªæ•´æ•°ç›¸åŠ æ—¶ï¼Œå­—ç¬¦ä¸²ä¼šè¢«è½¬æ¢ä¸ºæ•´æ•°ã€‚SELECT 1 + 1; â€“ ç»“æœä¸º 2éšå¼è½¬æ¢ä¼šå¯¼è‡´æ„æƒ³ä¸åˆ°çš„ç»“æœï¼Œæœ€å¥½é€šè¿‡æ˜¾å¼è½¬æ¢æ¥è§„é¿ã€‚SELECT CAST(1 AS SIGNED INTEGER) + 1; â€“ ç»“æœä¸º 2 19. è¯´è¯´ SQL çš„è¯­æ³•æ ‘è§£æï¼ŸSQL è¯­æ³•æ ‘è§£ææ˜¯å°† SQL æŸ¥è¯¢è¯­å¥è½¬æ¢æˆæŠ½è±¡è¯­æ³•æ ‘ â€”â€” AST çš„è¿‡ç¨‹ï¼Œæ˜¯æ•°æ®åº“å¼•æ“å¤„ç†æŸ¥è¯¢çš„ç¬¬ä¸€æ­¥ï¼Œä¹Ÿæ˜¯é˜²æ­¢ SQL æ³¨å…¥çš„é‡è¦æ‰‹æ®µã€‚é€šå¸¸åˆ†ä¸º 3 ä¸ªé˜¶æ®µã€‚ ç¬¬ä¸€ä¸ªé˜¶æ®µï¼Œè¯æ³•åˆ†æï¼šæ‹†è§£ SQL è¯­å¥ï¼Œè¯†åˆ«å…³é”®å­—ã€è¡¨åã€åˆ—åç­‰ã€‚ â€”startâ€”æ¯”å¦‚è¯´ï¼šSELECT id, name FROM users WHERE age 18;å°†ä¼šè¢«æ‹†è§£ä¸ºï¼š[SELECT] [id] [,] [name] [FROM] [users] [WHERE] [age] [] [18] [;]â€”endâ€” ç¬¬äºŒä¸ªé˜¶æ®µï¼Œè¯­æ³•åˆ†æï¼šæ£€æŸ¥ SQL æ˜¯å¦ç¬¦åˆè¯­æ³•è§„åˆ™ï¼Œå¹¶æ„å»ºæŠ½è±¡è¯­æ³•æ ‘ã€‚ â€”startâ€”æ¯”å¦‚è¯´ä¸Šé¢çš„è¯­å¥ä¼šè¢«æ„å»ºæˆå¦‚ä¸‹çš„è¯­æ³•æ ‘ï¼š SELECT / \\ Columns FROM / \\ | id name users | WHERE | age 18æˆ–è€…è¿™æ ·è¡¨ç¤ºï¼šSELECT â”œâ”€â”€ COLUMNS: id, name â”œâ”€â”€ FROM: users â”œâ”€â”€ WHERE â”‚ â”œâ”€â”€ CONDITION: age 18â€”endâ€” ç¬¬ä¸‰ä¸ªé˜¶æ®µï¼Œè¯­ä¹‰åˆ†æï¼šæ£€æŸ¥è¡¨ã€åˆ—æ˜¯å¦å­˜åœ¨ï¼Œè¿›è¡Œæƒé™éªŒè¯ç­‰ã€‚ â€”startâ€”æ¯”å¦‚è¯´æ‰§è¡Œï¼šSELECT id, name FROM users WHERE age â€˜eighteenâ€™;ä¼šæŠ¥é”™ï¼šERROR: Column â€˜ageâ€™ is INT, but â€˜eighteenâ€™ is STRING.â€”endâ€” æ•°æ®åº“æ¶æ„20.è¯´è¯´ MySQL çš„åŸºç¡€æ¶æ„ï¼ŸMySQL é‡‡ç”¨åˆ†å±‚æ¶æ„ï¼Œä¸»è¦åŒ…æ‹¬è¿æ¥å±‚ã€æœåŠ¡å±‚ã€å’Œå­˜å‚¨å¼•æ“å±‚ã€‚â‘ ã€è¿æ¥å±‚ä¸»è¦è´Ÿè´£å®¢æˆ·ç«¯è¿æ¥çš„ç®¡ç†ï¼ŒåŒ…æ‹¬éªŒè¯ç”¨æˆ·èº«ä»½ã€æƒé™æ ¡éªŒã€è¿æ¥ç®¡ç†ç­‰ã€‚å¯ä»¥é€šè¿‡æ•°æ®åº“è¿æ¥æ± æ¥æå‡è¿æ¥çš„å¤„ç†æ•ˆç‡ã€‚â‘¡ã€æœåŠ¡å±‚æ˜¯ MySQL çš„æ ¸å¿ƒï¼Œä¸»è¦è´Ÿè´£æŸ¥è¯¢è§£æã€ä¼˜åŒ–ã€æ‰§è¡Œç­‰æ“ä½œã€‚åœ¨è¿™ä¸€å±‚ï¼ŒSQL è¯­å¥ä¼šç»è¿‡è§£æã€ä¼˜åŒ–å™¨ä¼˜åŒ–ï¼Œç„¶åè½¬å‘åˆ°å­˜å‚¨å¼•æ“æ‰§è¡Œï¼Œå¹¶è¿”å›ç»“æœã€‚è¿™ä¸€å±‚åŒ…å«æŸ¥è¯¢è§£æå™¨ã€ä¼˜åŒ–å™¨ã€æ‰§è¡Œè®¡åˆ’ç”Ÿæˆå™¨ã€æ—¥å¿—æ¨¡å—ç­‰ã€‚â‘¢ã€å­˜å‚¨å¼•æ“å±‚è´Ÿè´£æ•°æ®çš„å®é™…å­˜å‚¨å’Œæå–ã€‚MySQL æ”¯æŒå¤šç§å­˜å‚¨å¼•æ“ï¼Œå¦‚ InnoDBã€MyISAMã€Memory ç­‰ã€‚binlogå†™å…¥åœ¨å“ªä¸€å±‚ï¼Ÿbinlog åœ¨æœåŠ¡å±‚ï¼Œè´Ÿè´£è®°å½• SQL è¯­å¥çš„å˜åŒ–ã€‚å®ƒè®°å½•äº†æ‰€æœ‰å¯¹æ•°æ®åº“è¿›è¡Œæ›´æ”¹çš„æ“ä½œï¼Œç”¨äºæ•°æ®æ¢å¤ã€ä¸»ä»å¤åˆ¶ç­‰ã€‚ 21.ä¸€æ¡æŸ¥è¯¢è¯­å¥SELECTæ˜¯å¦‚ä½•æ‰§è¡Œçš„ï¼Ÿå½“æˆ‘ä»¬æ‰§è¡Œä¸€æ¡ SELECT è¯­å¥æ—¶ï¼ŒMySQL å¹¶ä¸ä¼šç›´æ¥å»ç£ç›˜è¯»å–æ•°æ®ï¼Œè€Œæ˜¯ç»è¿‡ 6 ä¸ªæ­¥éª¤æ¥è§£æã€ä¼˜åŒ–ã€æ‰§è¡Œï¼Œç„¶åå†è¿”å›ç»“æœã€‚ç¬¬ä¸€æ­¥ï¼Œå®¢æˆ·ç«¯å‘é€ SQL æŸ¥è¯¢è¯­å¥åˆ° MySQL æœåŠ¡å™¨ã€‚ ç¬¬äºŒæ­¥ï¼ŒMySQL æœåŠ¡å™¨çš„è¿æ¥å™¨å¼€å§‹å¤„ç†è¿™ä¸ªè¯·æ±‚ï¼Œè·Ÿå®¢æˆ·ç«¯å»ºç«‹è¿æ¥ã€è·å–æƒé™ã€ç®¡ç†è¿æ¥ã€‚ ç¬¬ä¸‰æ­¥ï¼Œè§£æå™¨å¯¹ SQL è¯­å¥è¿›è¡Œè§£æï¼Œæ£€æŸ¥è¯­å¥æ˜¯å¦ç¬¦åˆ SQL è¯­æ³•è§„åˆ™ï¼Œç¡®ä¿æ•°æ®åº“ã€è¡¨å’Œåˆ—éƒ½æ˜¯å­˜åœ¨çš„ï¼Œå¹¶å¤„ç† SQL è¯­å¥ä¸­çš„åç§°è§£æå’Œæƒé™éªŒè¯ã€‚ ç¬¬å››æ­¥ï¼Œä¼˜åŒ–å™¨è´Ÿè´£ç¡®å®š SQL è¯­å¥çš„æ‰§è¡Œè®¡åˆ’ï¼Œè¿™åŒ…æ‹¬é€‰æ‹©ä½¿ç”¨å“ªäº›ç´¢å¼•ï¼Œä»¥åŠå†³å®šè¡¨ä¹‹é—´çš„è¿æ¥é¡ºåºç­‰ã€‚ ç¬¬äº”æ­¥ï¼Œæ‰§è¡Œå™¨ä¼šè°ƒç”¨å­˜å‚¨å¼•æ“çš„ APIæ¥è¿›è¡Œæ•°æ®çš„è¯»å†™ã€‚ ç¬¬å…­æ­¥ï¼Œå­˜å‚¨å¼•æ“è´Ÿè´£æŸ¥è¯¢æ•°æ®ï¼Œå¹¶å°†æ‰§è¡Œç»“æœè¿”å›ç»™å®¢æˆ·ç«¯ã€‚å®¢æˆ·ç«¯æ¥æ”¶åˆ°æŸ¥è¯¢ç»“æœï¼Œå®Œæˆè¿™æ¬¡æŸ¥è¯¢è¯·æ±‚ã€‚ 22.ä¸€æ¡æ›´æ–°è¯­å¥UPDATEæ˜¯å¦‚ä½•æ‰§è¡Œçš„ï¼Ÿundo log å›æ»šæ—¥å¿—: ç”¨äºäº‹åŠ¡çš„å›æ»šæ“ä½œ.redo log é‡åšæ—¥å¿—: ç”¨äºå®ç°äº‹åŠ¡çš„æŒä¹…æ€§,ä¿æŒæ•°æ®ä¸€è‡´æ€§.æ€»çš„æ¥è¯´ï¼Œä¸€æ¡ UPDATE è¯­å¥çš„æ‰§è¡Œè¿‡ç¨‹åŒ…æ‹¬è¯»å–æ•°æ®é¡µã€åŠ é”è§£é”ã€äº‹åŠ¡æäº¤ã€æ—¥å¿—è®°å½•ç­‰å¤šä¸ªæ­¥éª¤ã€‚æ‹¿ update test set a=1 where id=2 ä¸¾ä¾‹æ¥è¯´ï¼šåœ¨äº‹åŠ¡å¼€å§‹å‰ï¼ŒMySQL éœ€è¦è®°å½•undo logï¼Œç”¨äºäº‹åŠ¡å›æ»šã€‚ æ“ä½œ id æ—§å€¼ æ–°å€¼ update 2 N 1 é™¤äº†è®°å½• undo logï¼Œå­˜å‚¨å¼•æ“è¿˜ä¼šå°†æ›´æ–°æ“ä½œå†™å…¥ redo logï¼ŒçŠ¶æ€æ ‡è®°ä¸º prepareï¼Œå¹¶ç¡®ä¿ redo log æŒä¹…åŒ–åˆ°ç£ç›˜ã€‚è¿™ä¸€æ­¥å¯ä»¥ä¿è¯å³ä½¿ç³»ç»Ÿå´©æºƒï¼Œæ•°æ®ä¹Ÿèƒ½é€šè¿‡ redo log æ¢å¤åˆ°ä¸€è‡´çŠ¶æ€ã€‚ å†™å®Œredo log åï¼ŒMySQL ä¼šè·å–è¡Œé”ï¼Œå°† a çš„å€¼ä¿®æ”¹ä¸º 1ï¼Œæ ‡è®°ä¸ºè„é¡µï¼Œæ­¤æ—¶æ•°æ®ä»ç„¶åœ¨å†…å­˜çš„ buffer pool ä¸­ï¼Œä¸ä¼šç«‹å³å†™å…¥ç£ç›˜ã€‚åå°çº¿ç¨‹ä¼šåœ¨é€‚å½“çš„æ—¶å€™å°†è„é¡µåˆ·ç›˜ï¼Œä»¥æé«˜æ€§èƒ½ã€‚ æœ€åæäº¤äº‹åŠ¡ï¼Œredo log ä¸­çš„è®°å½•è¢«æ ‡è®°ä¸º committedï¼Œè¡Œé”é‡Šæ”¾ã€‚ å¦‚æœ MySQL å¼€å¯äº† binlogï¼Œè¿˜ä¼šå°†æ›´æ–°æ“ä½œè®°å½•åˆ° binlog ä¸­ï¼Œä¸»è¦ç”¨äºä¸»ä»å¤åˆ¶ã€‚ ä»¥åŠæ•°æ®æ¢å¤ï¼Œå¯ä»¥ç»“åˆ redo log è¿›è¡Œç‚¹å¯¹ç‚¹çš„æ¢å¤ã€‚binlog çš„å†™å…¥é€šå¸¸å‘ç”Ÿåœ¨äº‹åŠ¡æäº¤æ—¶ï¼Œä¸ redo log å…±åŒæ„æˆâ€œä¸¤é˜¶æ®µæäº¤â€ï¼Œç¡®ä¿ä¸¤è€…çš„ä¸€è‡´æ€§ã€‚ æ³¨æ„ï¼Œredo log çš„å†™å…¥æœ‰ä¸¤ä¸ªé˜¶æ®µçš„æäº¤ï¼Œä¸€æ˜¯ binlog å†™å…¥ä¹‹å‰prepare çŠ¶æ€çš„å†™å…¥ï¼ŒäºŒæ˜¯binlogå†™å…¥ä¹‹å commit çŠ¶æ€çš„å†™å…¥ã€‚ 23.è¯´è¯´ MySQL çš„æ®µåŒºé¡µè¡ŒMySQL æ˜¯ä»¥è¡¨çš„å½¢å¼å­˜å‚¨æ•°æ®çš„ï¼Œè€Œè¡¨ç©ºé—´çš„ç»“æ„åˆ™ç”±æ®µã€åŒºã€é¡µã€è¡Œç»„æˆã€‚ â‘ ã€æ®µï¼šè¡¨ç©ºé—´ç”±å¤šä¸ªæ®µç»„æˆï¼Œå¸¸è§çš„æ®µæœ‰æ•°æ®æ®µã€ç´¢å¼•æ®µã€å›æ»šæ®µç­‰ã€‚åˆ›å»ºç´¢å¼•æ—¶ä¼šåˆ›å»ºä¸¤ä¸ªæ®µï¼Œæ•°æ®æ®µå’Œç´¢å¼•æ®µï¼Œæ•°æ®æ®µç”¨æ¥å­˜å‚¨å¶å­èŠ‚ç‚¹ä¸­çš„æ•°æ®ï¼›ç´¢å¼•æ®µç”¨æ¥å­˜å‚¨éå¶å­èŠ‚ç‚¹çš„æ•°æ®ã€‚å›æ»šæ®µåŒ…å«äº†äº‹åŠ¡æ‰§è¡Œè¿‡ç¨‹ä¸­ç”¨äºæ•°æ®å›æ»šçš„æ—§æ•°æ®ã€‚ â‘¡ã€åŒºï¼šæ®µç”±ä¸€ä¸ªæˆ–å¤šä¸ªåŒºç»„æˆï¼ŒåŒºæ˜¯ä¸€ç»„è¿ç»­çš„é¡µï¼Œé€šå¸¸åŒ…å« 64 ä¸ªè¿ç»­çš„é¡µï¼Œä¹Ÿå°±æ˜¯ 1M çš„æ•°æ®ã€‚ä½¿ç”¨åŒºè€Œéå•ç‹¬çš„é¡µè¿›è¡Œæ•°æ®åˆ†é…å¯ä»¥ä¼˜åŒ–ç£ç›˜æ“ä½œï¼Œå‡å°‘ç£ç›˜å¯»é“æ—¶é—´ï¼Œç‰¹åˆ«æ˜¯åœ¨å¤§é‡æ•°æ®è¿›è¡Œè¯»å†™æ—¶ã€‚ â‘¢ã€é¡µï¼šé¡µæ˜¯ InnoDB å­˜å‚¨æ•°æ®çš„åŸºæœ¬å•å…ƒï¼Œæ ‡å‡†å¤§å°ä¸º 16 KBï¼Œç´¢å¼•æ ‘ä¸Šçš„ä¸€ä¸ªèŠ‚ç‚¹å°±æ˜¯ä¸€ä¸ªé¡µã€‚ä¹Ÿå°±æ„å‘³ç€æ•°æ®åº“æ¯æ¬¡è¯»å†™éƒ½æ˜¯ä»¥ 16 KB ä¸ºå•ä½çš„ï¼Œä¸€æ¬¡æœ€å°‘ä»ç£ç›˜ä¸­è¯»å– 16KB çš„æ•°æ®åˆ°å†…å­˜ï¼Œä¸€æ¬¡æœ€å°‘å†™å…¥ 16KB çš„æ•°æ®åˆ°ç£ç›˜ã€‚ â‘£ã€è¡Œï¼šInnoDB é‡‡ç”¨è¡Œå­˜å‚¨æ–¹å¼ï¼Œæ„å‘³ç€æ•°æ®æŒ‰ç…§è¡Œè¿›è¡Œç»„ç»‡å’Œç®¡ç†ï¼Œè¡Œæ•°æ®å¯èƒ½æœ‰å¤šä¸ªæ ¼å¼ï¼Œæ¯”å¦‚è¯´ COMPACTã€REDUNDANTã€DYNAMIC ç­‰ã€‚MySQL 8.0 é»˜è®¤çš„è¡Œæ ¼å¼æ˜¯ DYNAMICï¼Œç”±COMPACT æ¼”å˜è€Œæ¥ï¼Œæ„å‘³ç€è¿™äº›æ•°æ®å¦‚æœè¶…è¿‡äº†é¡µå†…è”å­˜å‚¨çš„é™åˆ¶ï¼Œåˆ™ä¼šè¢«å­˜å‚¨åœ¨æº¢å‡ºé¡µä¸­ã€‚å¯ä»¥é€šè¿‡ show table status like â€˜%article%â€™ æŸ¥çœ‹è¡Œæ ¼å¼ã€‚ äº†è§£ MySQLçš„æ•°æ®è¡Œã€è¡Œæº¢å‡ºæœºåˆ¶å—ï¼ŸInnoDBä»ç£ç›˜ä¸­è¯»å–æ•°æ®çš„æœ€å°å•ä½æ˜¯æ•°æ®é¡µã€‚ ä¸€ è¡Œæœ‰å“ªäº›æ ¼å¼Mysqlçš„æ•°æ®è¡Œæœ‰ä¸¤ç§æ ¼å¼:Compactæ ¼å¼å’ŒRedundantæ ¼å¼ã€‚Compactæ˜¯ä¸€ç§ç´§å‡‘çš„è¡Œæ ¼å¼ï¼Œè®¾è®¡çš„åˆè¡·å°±æ˜¯ä¸ºäº†è®©ä¸€ä¸ªæ•°æ®é¡µä¸­å¯ä»¥å­˜æ”¾æ›´å¤šçš„æ•°æ®è¡Œã€‚ ä½ å“ä¸€å“ï¼Œè®©ä¸€ä¸ªæ•°æ®é¡µä¸­å¯ä»¥å­˜æ”¾æ›´å¤šçš„æ•°æ®è¡Œæ˜¯ä¸€ä¸ªå¤šä¹ˆæ¿€åŠ¨äººå¿ƒçš„äº‹ï¼ŒMySQLä»¥æ•°æ®é¡µä¸ºå•ä½ä»ç£ç›˜ä¸­è¯»æ•°æ®ï¼Œå¦‚æœèƒ½åšåˆ°è®©ä¸€ä¸ªæ•°æ®é¡µä¸­æœ‰æ›´å¤šçš„è¡Œï¼Œé‚£å²‚ä¸æ˜¯ä½¿ç”¨çš„ç©ºé—´å˜å°‘äº†ï¼Œä¸”æ•´ä½“çš„æ•ˆç‡ç›´çº¿é£™å‡ï¼Ÿ å®˜ç½‘ä»‹ç»ï¼šCompactèƒ½æ¯”Redundantæ ¼å¼èŠ‚çº¦20%çš„å­˜å‚¨ã€‚ Compactä»MySQL5.0å¼•å…¥ï¼ŒMySQL5.1ä¹‹åï¼Œè¡Œæ ¼å¼é»˜è®¤è®¾ç½®æˆ Compact ã€‚æ‰€ä»¥æœ¬æ–‡æè¿°çš„ä¹Ÿæ˜¯Compactæ ¼å¼ã€‚ äºŒã€ç´§å‡‘çš„è¡Œæ ¼å¼é•¿å•¥æ ·ï¼Ÿè¡¨ä¸­æœ‰çš„åˆ—å…è®¸ä¸ºnullï¼Œæœ‰çš„åˆ—æ˜¯å˜é•¿çš„varcharç±»å‹ã€‚é‚£Compactè¡Œæ ¼å¼æ˜¯å¦‚ä½•ç»„ç»‡æè¿°è¿™äº›ä¿¡æ¯çš„å‘¢ï¼Ÿå¦‚ä¸‹å›¾ï¼š æ¯éƒ¨åˆ†åŒ…å«çš„æ•°æ®å¯èƒ½è¦æ¯”æˆ‘ä¸Šé¢æ ‡æ³¨çš„1ã€2ã€3è¿˜è¦å¤šã€‚ ä¸ºäº†ç»™å¤§å®¶æ›´ç›´è§‚çš„æ„Ÿå—å’Œç†è§£æˆ‘åªæ˜¯æŒ‘äº†ä¸€éƒ¨åˆ†å±•ç¤ºç»™å¤§å®¶çœ‹ã€‚ ä¸‰ã€MySQLå•è¡Œèƒ½å­˜å¤šå¤§ä½“é‡çš„æ•°æ®ï¼Ÿåœ¨MySQLçš„è®¾å®šä¸­ï¼Œå•è¡Œæ•°æ®æœ€å¤§èƒ½å­˜å‚¨65535byteçš„æ•°æ®ï¼ˆæ³¨æ„æ˜¯byteï¼Œè€Œä¸æ˜¯å­—ç¬¦ï¼‰MySQLä¸å…è®¸åˆ›å»ºä¸€ä¸ªé•¿åº¦ä¸º65535byteçš„åˆ—ï¼Œå› ä¸ºæ•°æ®é¡µä¸­æ¯ä¸€è¡Œä¸­éƒ½æœ‰æˆ‘ä»¬ä¸Šå›¾æåˆ°çš„éšè—åˆ—ã€‚æ‰€ä»¥å°†varcharçš„é•¿åº¦é™ä½åˆ°65532byteå³å¯æˆåŠŸåˆ›å»ºè¯¥è¡¨. æ‰€ä»¥å¦‚æœä½ å°†charsetæ¢æˆutf8è¿™ç§ç¼–ç æ ¼å¼ï¼Œé‚£varchar(N)ä¸­çš„Nå…¶å®æŒ‡çš„Nä¸ªå­—ç¬¦ï¼Œè€Œä¸æ˜¯Nä¸ªbyteã€‚å‡å¦‚encodeutf8æ—¶ä¸‰ä¸ªbyteè¡¨ç¤ºä¸€ä¸ªå­—ç¬¦ã€‚é‚£ä¹ˆ65535 3 21845ä¸ªå­—ç¬¦ã€‚ å››ã€Compactæ ¼å¼æ˜¯å¦‚ä½•åšåˆ°ç´§å‡‘çš„ï¼ŸMySQLæ¯æ¬¡è¿›è¡Œéšæœºçš„IOè¯»é»˜è®¤æƒ…å†µä¸‹ï¼Œæ•°æ®é¡µçš„å¤§å°ä¸º16KBã€‚æ•°æ®é¡µä¸­å­˜å‚¨ç€æ•°è¡Œã€‚é‚£å°±æ„å‘³ç€ä¸€ä¸ªæ•°æ®é¡µä¸­èƒ½å­˜å‚¨è¶Šå¤šçš„æ•°æ®è¡Œï¼ŒMySQLæ•´ä½“çš„è¿›è¡Œçš„IOæ¬¡æ•°å°±è¶Šå°‘ï¼Ÿæ€§èƒ½å°±è¶Šå¿«ï¼ŸCompactæ ¼å¼çš„å®ç°æ€è·¯æ˜¯ï¼šå½“åˆ—çš„ç±»å‹ä¸ºVARCHARã€ VARBINARYã€ BLOBã€TEXTæ—¶ï¼Œè¯¥åˆ—è¶…è¿‡768byteçš„æ•°æ®æ”¾åˆ°å…¶ä»–æ•°æ®é¡µä¸­å»ã€‚å¦‚ä¸‹å›¾ï¼šMySQLè¿™æ ·åšï¼Œæœ‰æ•ˆçš„é˜²æ­¢äº†å•ä¸ªvarcharåˆ—æˆ–è€…Textåˆ—å¤ªå¤§å¯¼è‡´å•ä¸ªæ•°æ®é¡µä¸­å­˜æ”¾çš„è¡Œè®°å½•è¿‡å°‘è€Œè®©IOé£™å‡çš„çª˜å¢ƒä¸”å å†…å­˜çš„ã€‚ äº”ã€ä»€ä¹ˆæ˜¯è¡Œæº¢å‡ºï¼Ÿå¦‚æœæ•°æ®é¡µé»˜è®¤å¤§å°ä¸º16KBï¼Œæ¢ç®—æˆbyteï¼š 16*1024 16384 byteé‚£ä½ æœ‰æ²¡æœ‰å‘ç°ï¼Œå•é¡µèƒ½å­˜å‚¨çš„16384byteå’Œå•è¡Œæœ€å¤§èƒ½å­˜å‚¨çš„ 65535byte å·®äº†å¥½å‡ å€å‘¢ ä¹Ÿå°±æ˜¯è¯´ï¼Œå‡å¦‚ä½ è¦å­˜å‚¨çš„æ•°æ®è¡Œå¾ˆå¤§è¶…è¿‡äº†65532byteé‚£ä¹ˆä½ æ˜¯å†™å…¥ä¸è¿›å»çš„ã€‚å‡å¦‚ä½ è¦å­˜å‚¨çš„å•è¡Œæ•°æ®å°äº65535byteä½†æ˜¯å¤§äº16384byteï¼Œè¿™æ—¶ä½ å¯ä»¥æˆåŠŸinsertï¼Œä½†æ˜¯ä¸€ä¸ªæ•°æ®é¡µåˆå­˜å‚¨ä¸äº†ä½ æ’å…¥çš„æ•°æ®ã€‚è¿™æ—¶è‚¯å®šä¼šè¡Œæº¢å‡ºï¼ å…¶å®åœ¨MySQLçš„è®¾å®šä¸­ï¼Œå‘ç”Ÿè¡Œæº¢å‡ºå¹¶ä¸æ˜¯è¾¾åˆ°16384byteè¾¹ç¼˜æ‰ä¼šå‘ç”Ÿã€‚å¯¹äºvarcharã€textç­‰ç±»å‹çš„è¡Œã€‚å½“è¿™ç§åˆ—å­˜å‚¨çš„é•¿åº¦è¾¾åˆ°å‡ ç™¾byteæ—¶å°±ä¼šå‘ç”Ÿè¡Œæº¢ã€‚ å…­ã€è¡Œ å¦‚ä½•æº¢å‡ºï¼Ÿè¿˜æ˜¯çœ‹è¿™å¼ å›¾ï¼šåœ¨MySQLè®¾å®šä¸­ï¼Œå½“varcharåˆ—é•¿åº¦è¾¾åˆ°768byteåï¼Œä¼šå°†è¯¥åˆ—çš„å‰768byteå½“ä½œå½“ä½œprefixå­˜æ”¾åœ¨è¡Œä¸­ï¼Œå¤šå‡ºæ¥çš„æ•°æ®æº¢å‡ºå­˜æ”¾åˆ°æº¢å‡ºé¡µä¸­ï¼Œç„¶åé€šè¿‡ä¸€ä¸ªåç§»é‡æŒ‡é’ˆå°†ä¸¤è€…å…³è”èµ·æ¥ï¼Œè¿™å°±æ˜¯è¡Œæº¢å‡ºæœºåˆ¶ã€‚ ä¸ƒã€æ€è€ƒä¸€ä¸ªé—®é¢˜ä¸çŸ¥é“ä½ æœ‰æ²¡æœ‰æƒ³è¿‡è¿™æ ·ä¸€ä¸ªé—®é¢˜ï¼šé¦–å…ˆä½ è‚¯å®šçŸ¥é“ï¼ŒMySQLä½¿ç”¨çš„æ˜¯B+Treeçš„èšç°‡ç´¢å¼•ï¼Œåœ¨è¿™æ£µB+Treeä¸­éå¶å­èŠ‚ç‚¹æ˜¯åªå­˜ç´¢å¼•ä¸å­˜æ•°æ®ï¼Œå¶å­èŠ‚ç‚¹ä¸­å­˜å‚¨ç€çœŸå®çš„æ•°æ®ã€‚åŒæ—¶å¶å­ç»“ç‚¹æŒ‡å‘æ•°æ®é¡µã€‚é‚£å½“å•è¡Œå­˜ä¸ä¸‹çš„æ—¶å€™ï¼Œä¸ºå•¥ä¸å­˜å‚¨åœ¨ä¸¤ä¸ªæ•°æ®é¡µä¸­å‘¢ï¼Ÿå°±åƒä¸‹å›¾è¿™æ ·ï½ã€‚å•ä¸ªèŠ‚ç‚¹å­˜å‚¨ä¸‹ï¼Œæˆ‘ç”¨å¤šä¸ªèŠ‚ç‚¹å­˜æ€»è¡Œå§ï¼è¯´ä¸å®šè¿™æ ·æˆ‘çš„B+Teeè¿˜èƒ½å˜å¤§é•¿é«˜ï¼ˆè¿™å…¶å®æ˜¯é”™è¯¯çš„æƒ³æ³•ï¼‰è¿™ä¸ªé”™è¯¯çš„æè¿°å¯¹åº”çš„è„‘å›¾å¦‚ä¸‹ï¼š é‚£MySQLä¸è¿™æ ·åšçš„åŸå› å¦‚ä¸‹ï¼šMySQLæƒ³è®©ä¸€ä¸ªæ•°æ®é¡µä¸­èƒ½å­˜æ”¾æ›´å¤šçš„æ•°æ®è¡Œï¼Œè‡³å°‘ä¹Ÿå¾—è¦å­˜æ”¾ä¸¤è¡Œæ•°æ®ã€‚å¦åˆ™å°±å¤±å»äº†B+Treeçš„æ„ä¹‰ã€‚B+Treeä¹Ÿé€€åŒ–æˆä¸€ä¸ªä½æ•ˆçš„é“¾è¡¨ã€‚ä½ å¯ä»¥å“ä¸€ä¸‹è¿™å¥è“è‰²çš„è¯ï¼Œä»–è¯´çš„æ¯ä¸ªæ•°æ®é¡µè‡³å°‘è¦å­˜æ”¾ä¸¤è¡Œæ•°æ®çš„æ„æ€ä¸æ˜¯è¯´ æ•°æ®é¡µä¸èƒ½åªå­˜ä¸€è¡Œã€‚ä½ ç¡®ç¡®å®å®å¯ä»¥åªå¾€é‡Œé¢å†™ä¸€è¡Œæ•°æ®ï¼Œç„¶åå»åƒä¸ªé¥­ï¼Œå¹²ç‚¹åˆ«çš„ã€‚ä¸€ç›´è®©è¿™ä¸ªæ•°æ®é¡µä¸­åªæœ‰ä¸€è¡Œæ•°æ®ã€‚ è¿™å¥è¯çš„æ„æ€æ˜¯ï¼Œå½“ä½ å¾€è¿™ä¸ªæ•°æ®é¡µä¸­å†™å…¥ä¸€è¡Œæ•°æ®æ—¶ï¼Œå³ä½¿å®ƒå¾ˆå¤§å°†è¾¾åˆ°äº†æ•°æ®é¡µçš„æé™ï¼Œä½†æ˜¯é€šè¿‡è¡Œæº¢å‡ºæœºåˆ¶ã€‚ä¾ç„¶èƒ½ä¿è¯ä½ çš„ä¸‹ä¸€æ¡æ•°æ®è¿˜èƒ½å†™å…¥åˆ°è¿™ä¸ªæ•°æ®é¡µä¸­ã€‚ å­˜å‚¨å¼•æ“24.MySQL æœ‰å“ªäº›å¸¸è§å­˜å‚¨å¼•æ“ï¼ŸMySQL æ”¯æŒå¤šç§å­˜å‚¨å¼•æ“ï¼Œå¸¸è§çš„æœ‰ MyISAMã€InnoDBã€MEMORY ç­‰ã€‚â€”è¿™éƒ¨åˆ†æ˜¯å¸®åŠ©ç†è§£ startï¼Œé¢è¯•ä¸­å¯ä¸èƒŒâ€”æˆ‘æ¥åšä¸€ä¸ªè¡¨æ ¼å¯¹æ¯”ï¼šâ€”è¿™éƒ¨åˆ†æ˜¯å¸®åŠ©ç†è§£ endï¼Œé¢è¯•ä¸­å¯ä¸èƒŒâ€”é™¤æ­¤ä¹‹å¤–ï¼Œæˆ‘è¿˜äº†è§£åˆ°ï¼šâ‘ ã€MySQL 5.5 ä¹‹å‰ï¼Œé»˜è®¤å­˜å‚¨å¼•æ“æ˜¯ MyISAMï¼Œ5.5 ä¹‹åæ˜¯ InnoDBã€‚â‘¡ã€InnoDB æ”¯æŒçš„å“ˆå¸Œç´¢å¼•æ˜¯è‡ªé€‚åº”çš„ï¼Œä¸èƒ½äººä¸ºå¹²é¢„ã€‚â‘¢ã€InnoDB ä» MySQL 5.6 å¼€å§‹ï¼Œæ”¯æŒå…¨æ–‡ç´¢å¼•ã€‚â‘£ã€InnoDB çš„æœ€å°è¡¨ç©ºé—´ç•¥å°äº 10Mï¼Œæœ€å¤§è¡¨ç©ºé—´å–å†³äºé¡µé¢å¤§å°ã€‚å¦‚ä½•åˆ‡æ¢ MySQL çš„æ•°æ®å¼•æ“ï¼Ÿå¯ä»¥é€šè¿‡ alter table è¯­å¥æ¥åˆ‡æ¢ MySQL çš„æ•°æ®å¼•æ“ã€‚ALTER TABLE your_table_name ENGINE=InnoDB;ä¸è¿‡ä¸å»ºè®®ï¼Œåº”è¯¥æå‰è®¾è®¡å¥½åˆ°åº•ç”¨å“ªä¸€ç§å­˜å‚¨å¼•æ“ã€‚ 25.å­˜å‚¨å¼•æ“åº”è¯¥æ€ä¹ˆé€‰æ‹©ï¼Ÿå¤§å¤šæ•°æƒ…å†µä¸‹ï¼Œä½¿ç”¨é»˜è®¤çš„ InnoDB å°±å¯ä»¥äº†ï¼ŒInnoDB å¯ä»¥æä¾›äº‹åŠ¡ã€è¡Œçº§é”ã€å¤–é”®ã€B+ æ ‘ç´¢å¼•ç­‰èƒ½åŠ›ã€‚MyISAM é€‚åˆè¯»å¤šå†™å°‘çš„åœºæ™¯ã€‚MEMORY é€‚åˆä¸´æ—¶è¡¨ï¼Œæ•°æ®é‡ä¸å¤§çš„æƒ…å†µã€‚å› ä¸ºæ•°æ®éƒ½å­˜æ”¾åœ¨å†…å­˜ï¼Œæ‰€ä»¥é€Ÿåº¦éå¸¸å¿«ã€‚ 26.InnoDB å’Œ MyISAM ä¸»è¦æœ‰ä»€ä¹ˆåŒºåˆ«ï¼ŸInnoDB å’Œ MyISAM çš„æœ€å¤§åŒºåˆ«åœ¨äºäº‹åŠ¡æ”¯æŒå’Œé”æœºåˆ¶ã€‚InnoDB æ”¯æŒäº‹åŠ¡ã€è¡Œçº§é”ï¼Œé€‚åˆå¤§å¤šæ•°ä¸šåŠ¡ç³»ç»Ÿï¼›è€Œ MyISAM ä¸æ”¯æŒäº‹åŠ¡ï¼Œç”¨çš„æ˜¯è¡¨é”ï¼ŒæŸ¥è¯¢å¿«ä½†å†™å…¥æ€§èƒ½å·®ï¼Œé€‚åˆè¯»å¤šå†™å°‘çš„åœºæ™¯ã€‚ å¦å¤–ï¼Œä»å­˜å‚¨ç»“æ„ä¸Šæ¥è¯´ï¼ŒMyISAM ç”¨ä¸‰ç§æ ¼å¼çš„æ–‡ä»¶æ¥å­˜å‚¨ï¼Œ.frm æ–‡ä»¶å­˜å‚¨è¡¨çš„å®šä¹‰ï¼›.MYD å­˜å‚¨æ•°æ®ï¼›.MYI å­˜å‚¨ç´¢å¼•ï¼›è€Œ InnoDB ç”¨ä¸¤ç§æ ¼å¼çš„æ–‡ä»¶æ¥å­˜å‚¨ï¼Œ.frm æ–‡ä»¶å­˜å‚¨è¡¨çš„å®šä¹‰ï¼›.ibd å­˜å‚¨æ•°æ®å’Œç´¢å¼•ã€‚ ä»ç´¢å¼•ç±»å‹ä¸Šæ¥è¯´ï¼ŒMyISAM ä¸ºéèšç°‡ç´¢å¼•ï¼Œç´¢å¼•å’Œæ•°æ®åˆ†å¼€å­˜å‚¨ï¼Œç´¢å¼•ä¿å­˜çš„æ˜¯æ•°æ®æ–‡ä»¶çš„æŒ‡é’ˆã€‚ InnoDB ä¸ºèšç°‡ç´¢å¼•ï¼Œç´¢å¼•å’Œæ•°æ®ä¸åˆ†å¼€ã€‚ æ›´ç»†å¾®çš„å±‚é¢ä¸Šæ¥è®²ï¼ŒMyISAM ä¸æ”¯æŒå¤–é”®ï¼Œå¯ä»¥æ²¡æœ‰ä¸»é”®ï¼Œè¡¨çš„å…·ä½“è¡Œæ•°å­˜å‚¨åœ¨è¡¨çš„å±æ€§ä¸­ï¼ŒæŸ¥è¯¢æ—¶å¯ä»¥ç›´æ¥è¿”å›ï¼›InnoDB æ”¯æŒå¤–é”®ï¼Œå¿…é¡»æœ‰ä¸»é”®ï¼Œå…·ä½“è¡Œæ•°éœ€è¦æ‰«ææ•´ä¸ªè¡¨æ‰èƒ½è¿”å›ï¼Œæœ‰ç´¢å¼•çš„æƒ…å†µä¸‹ä¼šæ‰«æç´¢å¼•ã€‚ InnoDBçš„å†…å­˜ç»“æ„äº†è§£å—ï¼ŸInnoDB çš„å†…å­˜åŒºåŸŸä¸»è¦æœ‰ä¸¤å—ï¼Œbuffer pool å’Œ log bufferã€‚ buffer pool ç”¨äºç¼“å­˜æ•°æ®é¡µå’Œç´¢å¼•é¡µï¼Œæå‡è¯»å†™æ€§èƒ½ï¼›log buffer ç”¨äºç¼“å­˜ redo logï¼Œæå‡å†™å…¥æ€§èƒ½ã€‚InnoDBå¼•æ“æ¡†æ¶å›¾å¦‚ä¸‹: æ•°æ®é¡µçš„ç»“æ„äº†è§£è¿‡å—InnoDB çš„æ•°æ®é¡µç”± 7 éƒ¨åˆ†ç»„æˆï¼Œå…¶ä¸­æ–‡ä»¶å¤´ã€é¡µå¤´å’Œæ–‡ä»¶å°¾çš„å¤§å°æ˜¯å›ºå®šçš„ï¼Œåˆ†åˆ«ä¸º 38ã€56 å’Œ 8 ä¸ªå­—èŠ‚ï¼Œç”¨æ¥æ ‡è®°è¯¥é¡µçš„ä¸€äº›ä¿¡æ¯ã€‚è¡Œè®°å½•ã€ç©ºé—²ç©ºé—´å’Œé¡µç›®å½•çš„å¤§å°æ˜¯åŠ¨æ€çš„ï¼Œä¸ºå®é™…çš„è¡Œè®°å½•å­˜å‚¨ç©ºé—´ã€‚ çœŸå®çš„è®°å½•ä¼šæŒ‰ç…§æŒ‡å®šçš„è¡Œæ ¼å¼å­˜å‚¨åˆ° User Records ä¸­ã€‚ æ¯ä¸ªæ•°æ®é¡µçš„ File Header éƒ½æœ‰ä¸€ä¸ªä¸Šä¸€é¡µå’Œä¸‹ä¸€é¡µçš„ç¼–å·ï¼Œæ‰€æœ‰çš„æ•°æ®é¡µä¼šå½¢æˆä¸€ä¸ªåŒå‘é“¾è¡¨ã€‚ åœ¨ InnoDB ä¸­ï¼Œé»˜è®¤çš„é¡µå¤§å°æ˜¯ 16KBã€‚å¯ä»¥é€šè¿‡ show variables like innodb_page_size; æŸ¥çœ‹ã€‚ 27. InnoDB çš„ Buffer Pooläº†è§£å—ï¼ŸBuffer Pool æ˜¯ InnoDB å­˜å‚¨å¼•æ“ä¸­çš„ä¸€ä¸ªå†…å­˜ç¼“å†²åŒºï¼Œå®ƒä¼šå°†ç»å¸¸ä½¿ç”¨çš„æ•°æ®é¡µã€ç´¢å¼•é¡µåŠ è½½è¿›å†…å­˜ï¼Œè¯»çš„æ—¶å€™å…ˆæŸ¥è¯¢ Buffer Poolï¼Œå¦‚æœå‘½ä¸­å°±ä¸ç”¨è®¿é—®ç£ç›˜äº†ã€‚ å¦‚æœæ²¡æœ‰å‘½ä¸­ï¼Œå°±ä»ç£ç›˜è¯»å–ï¼Œå¹¶åŠ è½½åˆ° Buffer Poolï¼Œæ­¤æ—¶å¯èƒ½ä¼šè§¦å‘é¡µæ·˜æ±°ï¼Œå°†ä¸å¸¸ç”¨çš„é¡µç§»å‡º Buffer Poolã€‚ å†™æ“ä½œæ—¶ä¸ä¼šç›´æ¥å†™å…¥ç£ç›˜ï¼Œè€Œæ˜¯å…ˆä¿®æ”¹å†…å­˜ä¸­çš„é¡µï¼Œæ­¤æ—¶é¡µè¢«æ ‡è®°ä¸ºè„é¡µï¼Œåå°çº¿ç¨‹ä¼šå®šæœŸå°†è„é¡µåˆ·æ–°åˆ°ç£ç›˜ã€‚ Buffer Pool å¯ä»¥æ˜¾è‘—å‡å°‘ç£ç›˜çš„è¯»å†™æ¬¡æ•°ï¼Œä»è€Œæå‡ MySQL çš„è¯»å†™æ€§èƒ½ã€‚ Buffer Pool çš„é»˜è®¤å¤§å°æ˜¯å¤šå°‘ï¼Ÿæœ¬æœºä¸Š InnoDB çš„ Buffer Pool é»˜è®¤å¤§å°æ˜¯ 128MBã€‚ SHOW VARIABLES LIKE innodb_buffer_pool_size; å¦å¤–ï¼Œåœ¨å…·æœ‰ 1GB-4GB RAM çš„ç³»ç»Ÿä¸Šï¼Œé»˜è®¤å€¼ä¸ºç³»ç»Ÿ RAM çš„ 25%ï¼›åœ¨å…·æœ‰è¶…è¿‡ 4GB RAM çš„ç³»ç»Ÿä¸Šï¼Œé»˜è®¤å€¼ä¸ºç³»ç»Ÿ RAM çš„ 50%ï¼Œä½†ä¸è¶…è¿‡ 4GBã€‚ InnoDB å¯¹ LRU ç®—æ³•çš„ä¼˜åŒ–äº†è§£å—ï¼ŸLRU (least resently used)ï¼šè¿‘æœŸæœ€å°‘ä½¿ç”¨ LFU (least freqently used)ï¼šé¢‘æ•°æœ€å°‘ä½¿ç”¨ äº†è§£ï¼ŒInnoDB å¯¹ LRU ç®—æ³•è¿›è¡Œäº†æ”¹è‰¯ï¼Œæœ€è¿‘è®¿é—®çš„æ•°æ®å¹¶ä¸ç›´æ¥æ”¾åˆ° LRU é“¾è¡¨çš„å¤´éƒ¨ï¼Œè€Œæ˜¯æ”¾åœ¨ä¸€ä¸ªå« midpoiont çš„ä½ç½®ã€‚é»˜è®¤æƒ…å†µä¸‹ï¼Œmidpoint ä½äº LRU åˆ—è¡¨çš„ 58 å¤„ã€‚ æ¯”å¦‚ Buffer Pool æœ‰ 100 é¡µï¼Œæ–°é¡µæ’å…¥çš„ä½ç½®å¤§æ¦‚æ˜¯åœ¨ç¬¬ 80 é¡µï¼›å½“é¡µæ•°æ®è¢«é¢‘ç¹è®¿é—®åï¼Œå†å°†å…¶ç§»åŠ¨åˆ° young åŒºï¼Œè¿™æ ·åšçš„å¥½å¤„æ˜¯çƒ­ç‚¹é¡µèƒ½é•¿æ—¶é—´ä¿ç•™åœ¨å†…å­˜ä¸­ï¼Œä¸å®¹æ˜“è¢«æŒ¤å‡ºå»ã€‚ â€”-è¿™éƒ¨åˆ†æ˜¯å¸®åŠ©ç†è§£ startï¼Œé¢è¯•ä¸­å¯ä¸èƒŒâ€”- å¯ä»¥é€šè¿‡ innodb_old_blocks_pct å‚æ•°æ¥è°ƒæ•´ Buffer Pool ä¸­ old å’Œ young åŒºçš„æ¯”ä¾‹ï¼›é€šè¿‡ innodb_old_blocks_time å‚æ•°æ¥è°ƒæ•´é¡µåœ¨ young åŒºçš„åœç•™æ—¶é—´ã€‚ é»˜è®¤æƒ…å†µä¸‹ï¼ŒLRU é“¾è¡¨ä¸­ old åŒºå  37%ï¼›åŒä¸€é¡µå†æ¬¡è®¿é—®æå‡çš„æœ€å°æ—¶é—´é—´éš”æ˜¯ 1000 æ¯«ç§’ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œå¦‚æœæŸé¡µåœ¨ 1 ç§’å†…è¢«å¤šæ¬¡è®¿é—®ï¼Œåªä¼šè®¡ç®—ä¸€æ¬¡ï¼Œä¸ä¼šç«‹åˆ»å‡çº§ä¸ºçƒ­ç‚¹é¡µï¼Œé˜²æ­¢çŸ­æ—¶é—´æ‰¹é‡è®¿é—®å¯¼è‡´ç¼“å­˜æ±¡æŸ“ã€‚ â€”-è¿™éƒ¨åˆ†æ˜¯å¸®åŠ©ç†è§£ endï¼Œé¢è¯•ä¸­å¯ä¸èƒŒâ€”- æ—¥å¿—28.MySQL æ—¥å¿—æ–‡ä»¶æœ‰å“ªäº›ï¼Ÿæœ‰ 6 å¤§ç±»ï¼Œå…¶ä¸­é”™è¯¯æ—¥å¿—ç”¨äºé—®é¢˜è¯Šæ–­ï¼Œæ…¢æŸ¥è¯¢æ—¥å¿—ç”¨äº SQL æ€§èƒ½åˆ†æï¼Œgeneral log ç”¨äºè®°å½•æ‰€æœ‰çš„ SQL è¯­å¥ï¼Œbinlog ç”¨äºä¸»ä»å¤åˆ¶å’Œæ•°æ®æ¢å¤ï¼Œredo log ç”¨äºä¿è¯äº‹åŠ¡æŒä¹…æ€§ï¼Œundo log ç”¨äºäº‹åŠ¡å›æ»šå’Œ MVCCã€‚ â€”-è¿™éƒ¨åˆ†æ˜¯å¸®åŠ©ç†è§£ startï¼Œé¢è¯•ä¸­å¯ä¸èƒŒâ€”- â‘ ã€é”™è¯¯æ—¥å¿—ï¼ˆError Logï¼‰ï¼šè®°å½• MySQL æœåŠ¡å™¨å¯åŠ¨ã€è¿è¡Œæˆ–åœæ­¢æ—¶å‡ºç°çš„é—®é¢˜ã€‚â‘¡ã€æ…¢æŸ¥è¯¢æ—¥å¿—ï¼ˆSlow Query Logï¼‰ï¼šè®°å½•æ‰§è¡Œæ—¶é—´è¶…è¿‡ long_query_time å€¼çš„æ‰€æœ‰ SQL è¯­å¥ã€‚è¿™ä¸ªæ—¶é—´å€¼æ˜¯å¯é…ç½®çš„ï¼Œé»˜è®¤æƒ…å†µä¸‹ï¼Œæ…¢æŸ¥è¯¢æ—¥å¿—åŠŸèƒ½æ˜¯å…³é—­çš„ã€‚â‘¢ã€ä¸€èˆ¬æŸ¥è¯¢æ—¥å¿—ï¼ˆGeneral Query Logï¼‰ï¼šè®°å½• MySQL æœåŠ¡å™¨çš„å¯åŠ¨å…³é—­ä¿¡æ¯ï¼Œå®¢æˆ·ç«¯çš„è¿æ¥ä¿¡æ¯ï¼Œä»¥åŠæ›´æ–°ã€æŸ¥è¯¢çš„ SQL è¯­å¥ç­‰ã€‚â‘£ã€äºŒè¿›åˆ¶æ—¥å¿—ï¼ˆBinary Logï¼‰ï¼šè®°å½•æ‰€æœ‰ä¿®æ”¹æ•°æ®åº“çŠ¶æ€çš„ SQL è¯­å¥ï¼Œä»¥åŠæ¯ä¸ªè¯­å¥çš„æ‰§è¡Œæ—¶é—´ï¼Œå¦‚ INSERTã€UPDATEã€DELETE ç­‰ï¼Œä½†ä¸åŒ…æ‹¬ SELECT å’Œ SHOW è¿™ç±»çš„æ“ä½œã€‚â‘¤ã€é‡åšæ—¥å¿—ï¼ˆRedo Logï¼‰ï¼šè®°å½•å¯¹äº InnoDB è¡¨çš„æ¯ä¸ªå†™æ“ä½œï¼Œä¸æ˜¯ SQL çº§åˆ«çš„ï¼Œè€Œæ˜¯ç‰©ç†çº§åˆ«çš„ï¼Œä¸»è¦ç”¨äºå´©æºƒæ¢å¤ã€‚â‘¥ã€å›æ»šæ—¥å¿—ï¼ˆUndo Logï¼Œæˆ–è€…å«äº‹åŠ¡æ—¥å¿—ï¼‰ï¼šè®°å½•æ•°æ®è¢«ä¿®æ”¹å‰çš„å€¼ï¼Œç”¨äºäº‹åŠ¡çš„å›æ»šã€‚ â€”-è¿™éƒ¨åˆ†æ˜¯å¸®åŠ©ç†è§£ endï¼Œé¢è¯•ä¸­å¯ä¸èƒŒâ€”- è¯·é‡ç‚¹è¯´è¯´ binlogï¼Ÿbinlog æ˜¯ä¸€ç§ç‰©ç†æ—¥å¿—ï¼Œä¼šåœ¨ç£ç›˜ä¸Šè®°å½•æ•°æ®åº“çš„æ‰€æœ‰ä¿®æ”¹æ“ä½œã€‚å¦‚æœè¯¯åˆ äº†æ•°æ®ï¼Œå°±å¯ä»¥ä½¿ç”¨ binlog è¿›è¡Œå›é€€åˆ°è¯¯åˆ ä¹‹å‰çš„çŠ¶æ€ã€‚ # æ­¥éª¤1ï¼šæ¢å¤å…¨é‡å¤‡ä»½mysql -u root -p full_backup.sql# æ­¥éª¤2ï¼šåº”ç”¨Binlogåˆ°æŒ‡å®šæ—¶é—´ç‚¹mysqlbinlog --start-datetime=2025-03-13 14:00:00 --stop-datetime=2025-03-13 15:00:00 binlog.000001 | mysql -u root -p å¦‚æœè¦æ­å»ºä¸»ä»å¤åˆ¶ï¼Œå°±å¯ä»¥è®©ä»åº“å®šæ—¶è¯»å–ä¸»åº“çš„ binlogã€‚MySQL æä¾›äº†ä¸‰ç§æ ¼å¼çš„ binlogï¼šStatementã€Row å’Œ Mixedï¼Œåˆ†åˆ«å¯¹åº” SQL è¯­å¥çº§åˆ«ã€è¡Œçº§åˆ«å’Œæ··åˆçº§åˆ«ï¼Œé»˜è®¤ä¸ºè¡Œçº§åˆ«ã€‚ä»åç¼€åä¸Šæ¥çœ‹ï¼Œbinlog æ–‡ä»¶åˆ†ä¸ºä¸¤ç±»ï¼šä»¥ .index ç»“å°¾çš„ç´¢å¼•æ–‡ä»¶ï¼Œä»¥ .00000* ç»“å°¾çš„äºŒè¿›åˆ¶æ—¥å¿—æ–‡ä»¶ã€‚binlog é»˜è®¤æ˜¯æ²¡æœ‰å¯ç”¨çš„ã€‚ ç”Ÿäº§ç¯å¢ƒä¸­æ˜¯ä¸€å®šè¦å¯ç”¨çš„ï¼Œå¯ä»¥é€šè¿‡åœ¨ my.cnf æ–‡ä»¶ä¸­é…ç½® log_bin å‚æ•°ï¼Œä»¥å¯ç”¨ binlogã€‚ log_bin = mysql-bin #å¼€å¯binlog#mysql-bin.*æ—¥å¿—æ–‡ä»¶æœ€å¤§å­—èŠ‚ï¼ˆå•ä½ï¼šå­—èŠ‚ï¼‰#è®¾ç½®æœ€å¤§100MBmax_binlog_size=104857600#è®¾ç½®äº†åªä¿ç•™7å¤©BINLOGï¼ˆå•ä½ï¼šå¤©ï¼‰expire_logs_days = 7#binlogæ—¥å¿—åªè®°å½•æŒ‡å®šåº“çš„æ›´æ–°#binlog-do-db=db_name#binlogæ—¥å¿—ä¸è®°å½•æŒ‡å®šåº“çš„æ›´æ–°#binlog-ignore-db=db_name#å†™ç¼“å†²å¤šå°‘æ¬¡ï¼Œåˆ·ä¸€æ¬¡ç£ç›˜ï¼Œé»˜è®¤0sync_binlog=0 binlog çš„é…ç½®å‚æ•°éƒ½äº†è§£å“ªäº›ï¼Ÿlog_bin = mysql-bin ç”¨äºå¯ç”¨ binlogï¼Œè¿™æ ·å°±å¯ä»¥åœ¨ MySQL çš„æ•°æ®ç›®å½•ä¸­æ‰¾åˆ° db-bin.000001ã€db-bin.000002 ç­‰æ—¥å¿—æ–‡ä»¶ã€‚max_binlog_size=104857600 ç”¨äºè®¾ç½®æ¯ä¸ª binlog æ–‡ä»¶çš„å¤§å°ï¼Œä¸å»ºè®®è®¾ç½®å¤ªå¤§ï¼Œç½‘ç»œä¼ é€èµ·æ¥æ¯”è¾ƒéº»çƒ¦ã€‚å½“ binlog æ–‡ä»¶è¾¾åˆ° max_binlog_size æ—¶ï¼ŒMySQL ä¼šå…³é—­å½“å‰æ–‡ä»¶å¹¶åˆ›å»ºä¸€ä¸ªæ–°çš„ binlog æ–‡ä»¶ã€‚expire_logs_days = 7 ç”¨äºè®¾ç½® binlog æ–‡ä»¶çš„è‡ªåŠ¨è¿‡æœŸæ—¶é—´ä¸º 7 å¤©ã€‚è¿‡æœŸçš„ binlog æ–‡ä»¶ä¼šè¢«è‡ªåŠ¨åˆ é™¤ã€‚é˜²æ­¢é•¿æ—¶é—´ç´¯ç§¯çš„ binlog æ–‡ä»¶å ç”¨è¿‡å¤šå­˜å‚¨ç©ºé—´ï¼Œæ‰€ä»¥è¿™ä¸ªé…ç½®å¾ˆé‡è¦ã€‚binlog-do-db=db_nameï¼ŒæŒ‡å®šå“ªäº›æ•°æ®åº“è¡¨çš„æ›´æ–°åº”è¯¥è¢«è®°å½•ã€‚binlog-ignore-db=db_nameï¼ŒæŒ‡å®šå¿½ç•¥å“ªäº›æ•°æ®åº“è¡¨çš„æ›´æ–°ã€‚sync_binlog=0ï¼Œè®¾ç½®æ¯å¤šå°‘æ¬¡ binlog å†™æ“ä½œä¼šè§¦å‘ä¸€æ¬¡ç£ç›˜åŒæ­¥æ“ä½œã€‚é»˜è®¤å€¼ä¸º 0ï¼Œè¡¨ç¤º MySQL ä¸ä¼šä¸»åŠ¨è§¦å‘åŒæ­¥æ“ä½œï¼Œè€Œæ˜¯ä¾èµ–æ“ä½œç³»ç»Ÿçš„ç£ç›˜ç¼“å­˜ç­–ç•¥ã€‚å³å½“æ‰§è¡Œå†™æ“ä½œæ—¶ï¼Œæ•°æ®ä¼šå…ˆå†™å…¥ç¼“å­˜ï¼Œå½“ç¼“å­˜åŒºæ»¡äº†å†ç”±æ“ä½œç³»ç»Ÿå°†æ•°æ®ä¸€æ¬¡æ€§åˆ·å…¥ç£ç›˜ã€‚å¦‚æœè®¾ç½®ä¸º 1ï¼Œè¡¨ç¤ºæ¯æ¬¡ binlog å†™æ“ä½œåéƒ½ä¼šåŒæ­¥åˆ°ç£ç›˜ï¼Œè™½ç„¶å¯ä»¥ä¿è¯æ•°æ®èƒ½å¤ŸåŠæ—¶å†™å…¥ç£ç›˜ï¼Œä½†ä¼šé™ä½æ€§èƒ½ã€‚å¯ä»¥é€šè¿‡ show variables like %log_bin%; æŸ¥çœ‹ binlog æ˜¯å¦å¼€å¯ã€‚ æœ‰äº†binlogä¸ºä»€ä¹ˆè¿˜è¦undolog redologï¼Ÿbinlog å±äº Server å±‚ï¼Œä¸å­˜å‚¨å¼•æ“æ— å…³ï¼Œæ— æ³•ç›´æ¥æ“ä½œç‰©ç†æ•°æ®é¡µã€‚è€Œ redo log å’Œ undo log æ˜¯ InnoDB å­˜å‚¨å¼•æ“å®ç° ACIDçš„åŸºçŸ³ã€‚â€”â€”â€”â€”â€“psâ€”â€”â€”â€”-ACID: **åŸå­æ€§(Atomicity)**ï¼šäº‹åŠ¡æ˜¯ä¸€ä¸ªä¸å¯åˆ†å‰²çš„å·¥ä½œå•ä½ï¼Œäº‹åŠ¡ä¸­çš„æ“ä½œè¦ä¹ˆå…¨éƒ¨æˆåŠŸï¼Œè¦ä¹ˆå…¨éƒ¨å¤±è´¥å›æ»šé€šè¿‡undo logå®ç°ï¼Œè®°å½•äº‹åŠ¡å¼€å§‹å‰çš„çŠ¶æ€ï¼Œç”¨äºå›æ»š **ä¸€è‡´æ€§(Consistency)**ï¼šäº‹åŠ¡æ‰§è¡Œå‰åï¼Œæ•°æ®åº“ä»ä¸€ä¸ªä¸€è‡´çŠ¶æ€è½¬å˜ä¸ºå¦ä¸€ä¸ªä¸€è‡´çŠ¶æ€é€šè¿‡å…¶ä»–ä¸‰ä¸ªç‰¹æ€§(AID)å…±åŒä¿è¯ **éš”ç¦»æ€§(Isolation)**ï¼šå¤šä¸ªå¹¶å‘äº‹åŠ¡æ‰§è¡Œæ—¶ï¼Œä¸€ä¸ªäº‹åŠ¡çš„æ‰§è¡Œä¸åº”å½±å“å…¶ä»–äº‹åŠ¡é€šè¿‡é”æœºåˆ¶å’ŒMVCC(å¤šç‰ˆæœ¬å¹¶å‘æ§åˆ¶)å®ç° **æŒä¹…æ€§(Durability)**ï¼šäº‹åŠ¡ä¸€æ—¦æäº¤ï¼Œå…¶ç»“æœå°±æ˜¯æ°¸ä¹…æ€§çš„é€šè¿‡redo logå®ç°ï¼Œå³ä½¿ç³»ç»Ÿå´©æºƒä¹Ÿèƒ½æ¢å¤æ•°æ® â€”â€”â€”â€”â€“psâ€”â€”â€”â€”- binlog å…³æ³¨çš„æ˜¯é€»è¾‘å˜æ›´çš„å…¨å±€è®°å½•ï¼›redo log ç”¨äºç¡®ä¿ç‰©ç†å˜æ›´çš„æŒä¹…æ€§ï¼Œç¡®ä¿äº‹åŠ¡æœ€ç»ˆèƒ½å¤Ÿåˆ·ç›˜æˆåŠŸï¼›undo log æ˜¯é€»è¾‘é€†å‘æ“ä½œæ—¥å¿—ï¼Œè®°å½•çš„æ˜¯æ—§å€¼ï¼Œæ–¹ä¾¿æ¢å¤åˆ°äº‹åŠ¡å¼€å§‹å‰çš„çŠ¶æ€ã€‚ å¦å¤–ä¸€ç§å›ç­”æ–¹å¼ã€‚ binlog ä¼šè®°å½•æ•´ä¸ª SQL æˆ–è¡Œå˜åŒ–ï¼›redo log æ˜¯ä¸ºäº†æ¢å¤å·²æäº¤ä½†æœªåˆ·ç›˜çš„æ•°æ®ï¼Œundo log æ˜¯ä¸ºäº†æ’¤é”€æœªæäº¤çš„äº‹åŠ¡ã€‚ ä»¥ä¸€æ¬¡äº‹åŠ¡æ›´æ–°ä¸ºä¾‹ï¼š # å¼€å¯äº‹åŠ¡BEGIN;# æ›´æ–°æ•°æ®UPDATE users SET age = age + 1 WHERE id = 1;# æäº¤äº‹åŠ¡COMMIT; äº‹åŠ¡å¼€å§‹çš„æ—¶å€™ä¼šç”Ÿæˆ undo logï¼Œè®°å½•æ›´æ–°å‰çš„æ•°æ®ï¼Œæ¯”å¦‚åŸå€¼æ˜¯ 18ï¼š undo log: id=1, age=18 ä¿®æ”¹æ•°æ®çš„æ—¶å€™ï¼Œä¼šå°†æ•°æ®å†™å…¥åˆ° redo logã€‚ æ¯”å¦‚æ•°æ®é¡µ page_id=123 ä¸Šï¼Œid1 çš„ç”¨æˆ·è¢«æ›´æ–°ä¸º age26ï¼š redo log (prepare): page_id=123, offset=0x40, before=18, after=26 ç­‰äº‹åŠ¡æäº¤çš„æ—¶å€™ï¼Œredo log åˆ·ç›˜ï¼Œbinlog åˆ·ç›˜ã€‚ binlog å†™å®Œä¹‹åï¼Œredo log çš„çŠ¶æ€ä¼šå˜ä¸º commitï¼š redo log (commit): page_id=123, offset=0x40, before=18, after=26 binlog å¦‚æœæ˜¯ Statement æ ¼å¼ï¼Œä¼šè®°å½•ä¸€æ¡ SQL è¯­å¥ï¼š UPDATE users SET age age + 1 WHERE id 1;binlog å¦‚æœæ˜¯ Row æ ¼å¼ï¼Œä¼šè®°å½•ï¼š è¡¨ï¼šusersbefore: id=1, age=18after: id=1, age=26 éšåï¼Œåå°çº¿ç¨‹ä¼šå°† redo log ä¸­çš„å˜æ›´å¼‚æ­¥åˆ·æ–°åˆ°ç£ç›˜ã€‚ è¯¦ç»†æ¢ç©¶ä¸€ä¸‹binlog(é•¿æ–‡è­¦å‘Šâš ï¸):MySQL çš„ Binlog æ—¥å¿—æ˜¯ä¸€ç§äºŒè¿›åˆ¶æ ¼å¼çš„æ—¥å¿—ï¼ŒBinlog è®°å½•æ‰€æœ‰çš„ DDL å’Œ DML è¯­å¥(é™¤äº†æ•°æ®æŸ¥è¯¢è¯­å¥SELECTã€SHOWç­‰)ï¼Œä»¥ Event çš„å½¢å¼è®°å½•ï¼ŒåŒæ—¶è®°å½•è¯­å¥æ‰§è¡Œæ—¶é—´ã€‚ Binlog çš„ä¸»è¦ä½œç”¨æœ‰ä¸¤ä¸ªï¼š1. æ•°æ®æ¢å¤:å› ä¸º Binlog è¯¦ç»†è®°å½•äº†æ‰€æœ‰ä¿®æ”¹æ•°æ®çš„ SQLï¼Œå½“æŸä¸€æ—¶åˆ»çš„æ•°æ®è¯¯æ“ä½œè€Œå¯¼è‡´å‡ºé—®é¢˜ï¼Œæˆ–è€…æ•°æ®åº“å®•æœºæ•°æ®ä¸¢å¤±ï¼Œé‚£ä¹ˆå¯ä»¥æ ¹æ® Binlog æ¥å›æ”¾å†å²æ•°æ®ã€‚2. ä¸»ä»å¤åˆ¶:æƒ³è¦åšå¤šæœºå¤‡ä»½çš„ä¸šåŠ¡ï¼Œå¯ä»¥å»ç›‘å¬å½“å‰å†™åº“çš„ Binlog æ—¥å¿—ï¼ŒåŒæ­¥å†™åº“çš„æ‰€æœ‰æ›´æ”¹ã€‚ Binlog åŒ…æ‹¬ä¸¤ç±»æ–‡ä»¶ï¼šäºŒè¿›åˆ¶æ—¥å¿—ç´¢å¼•æ–‡ä»¶(.index)ï¼šè®°å½•æ‰€æœ‰çš„äºŒè¿›åˆ¶æ–‡ä»¶ã€‚äºŒè¿›åˆ¶æ—¥å¿—æ–‡ä»¶(.00000*)ï¼šè®°å½•æ‰€æœ‰ DDL å’Œ DML è¯­å¥äº‹ä»¶ã€‚ Binlog æ—¥å¿—åŠŸèƒ½é»˜è®¤æ˜¯å¼€å¯çš„ï¼Œçº¿ä¸Šæƒ…å†µä¸‹ Binlog æ—¥å¿—çš„å¢é•¿é€Ÿåº¦æ˜¯å¾ˆå¿«çš„ï¼Œåœ¨ MySQL çš„é…ç½®æ–‡ä»¶ my.cnf ä¸­æä¾›ä¸€äº›å‚æ•°æ¥å¯¹ Binlog è¿›è¡Œè®¾ç½®ã€‚ #è®¾ç½®æ­¤å‚æ•°è¡¨ç¤ºå¯ç”¨binlogåŠŸèƒ½ï¼Œå¹¶åˆ¶å®šäºŒè¿›åˆ¶æ—¥å¿—çš„å­˜å‚¨ç›®å½•log-bin=/home/mysql/binlog/#mysql-bin.*æ—¥å¿—æ–‡ä»¶æœ€å¤§å­—èŠ‚ï¼ˆå•ä½ï¼šå­—èŠ‚ï¼‰#è®¾ç½®æœ€å¤§100MBmax_binlog_size=104857600#è®¾ç½®äº†åªä¿ç•™7å¤©BINLOGï¼ˆå•ä½ï¼šå¤©ï¼‰expire_logs_days = 7#binlogæ—¥å¿—åªè®°å½•æŒ‡å®šåº“çš„æ›´æ–°#binlog-do-db=db_name#binlogæ—¥å¿—ä¸è®°å½•æŒ‡å®šåº“çš„æ›´æ–°#binlog-ignore-db=db_name#å†™ç¼“å†²å¤šå°‘æ¬¡ï¼Œåˆ·ä¸€æ¬¡ç£ç›˜ï¼Œé»˜è®¤0sync_binlog=0 éœ€è¦æ³¨æ„çš„æ˜¯ï¼šmax_binlog_size ï¼šBinlog æœ€å¤§å’Œé»˜è®¤å€¼æ˜¯ 1Gï¼Œè¯¥è®¾ç½®å¹¶ä¸èƒ½ä¸¥æ ¼æ§åˆ¶ Binlog çš„å¤§å°ï¼Œå°¤å…¶æ˜¯ Binlog æ¯”è¾ƒé è¿‘æœ€å¤§å€¼è€Œåˆé‡åˆ°ä¸€ä¸ªæ¯”è¾ƒå¤§äº‹åŠ¡æ—¶ï¼Œä¸ºäº†ä¿è¯äº‹åŠ¡çš„å®Œæ•´æ€§ä¸å¯èƒ½åšåˆ‡æ¢æ—¥å¿—çš„åŠ¨ä½œï¼Œåªèƒ½å°†è¯¥äº‹åŠ¡çš„æ‰€æœ‰ SQL éƒ½è®°å½•è¿›å½“å‰æ—¥å¿—ç›´åˆ°äº‹åŠ¡ç»“æŸã€‚æ‰€ä»¥çœŸå®æ–‡ä»¶æœ‰æ—¶å€™ä¼šå¤§äº max_binlog_size è®¾å®šå€¼ã€‚expire_logs_days ï¼šBinlog è¿‡æœŸåˆ é™¤ä¸æ˜¯æœåŠ¡å®šæ—¶æ‰§è¡Œï¼Œæ˜¯éœ€è¦å€ŸåŠ©äº‹ä»¶è§¦å‘æ‰æ‰§è¡Œï¼Œäº‹ä»¶åŒ…æ‹¬ï¼š æœåŠ¡å™¨é‡å¯ æœåŠ¡å™¨è¢«æ›´æ–° æ—¥å¿—è¾¾åˆ°äº†æœ€å¤§æ—¥å¿—é•¿åº¦ max_binlog_size æ—¥å¿—è¢«åˆ·æ–° äºŒè¿›åˆ¶æ—¥å¿—ç”±é…ç½®æ–‡ä»¶çš„ log-bin é€‰é¡¹è´Ÿè´£å¯ç”¨ï¼ŒMySQL æœåŠ¡å™¨å°†åœ¨æ•°æ®æ ¹ç›®å½•åˆ›å»ºä¸¤ä¸ªæ–°æ–‡ä»¶mysql-bin.000001 å’Œ mysql-bin.indexï¼Œè‹¥é…ç½®é€‰é¡¹æ²¡æœ‰ç»™å‡ºæ–‡ä»¶åï¼ŒMySQL å°†ä½¿ç”¨ä¸»æœºåç§°å‘½åè¿™ä¸¤ä¸ªæ–‡ä»¶ï¼Œå…¶ä¸­ .index æ–‡ä»¶åŒ…å«ä¸€ä»½å…¨ä½“æ—¥å¿—æ–‡ä»¶çš„æ¸…å•ã€‚ sync_binlogï¼šè¿™ä¸ªå‚æ•°å†³å®šäº† Binlog æ—¥å¿—çš„æ›´æ–°é¢‘ç‡ã€‚é»˜è®¤ 0 ï¼Œè¡¨ç¤ºè¯¥æ“ä½œç”±æ“ä½œç³»ç»Ÿæ ¹æ®è‡ªèº«è´Ÿè½½è‡ªè¡Œå†³å®šå¤šä¹…å†™ä¸€æ¬¡ç£ç›˜ã€‚ sync_binlog = 1 è¡¨ç¤ºæ¯ä¸€æ¡äº‹åŠ¡æäº¤éƒ½ä¼šç«‹åˆ»å†™ç›˜ã€‚sync_binlog=n è¡¨ç¤º n ä¸ªäº‹åŠ¡æäº¤æ‰ä¼šå†™ç›˜ã€‚ æ ¹æ® MySQL æ–‡æ¡£ï¼Œå†™ Binlog çš„æ—¶æœºæ˜¯ï¼šSQL transaction æ‰§è¡Œå®Œï¼Œä½†ä»»ä½•ç›¸å…³çš„ Locks è¿˜æœªé‡Šæ”¾æˆ–äº‹åŠ¡è¿˜æœªæœ€ç»ˆ commit å‰ã€‚è¿™æ ·ä¿è¯äº† Binlog è®°å½•çš„æ“ä½œæ—¶åºä¸æ•°æ®åº“å®é™…çš„æ•°æ®å˜æ›´é¡ºåºä¸€è‡´ã€‚ æ£€æŸ¥ Binlog æ–‡ä»¶æ˜¯å¦å·²å¼€å¯ï¼š mysql show variables like %log_bin%;+---------------------------------+------------------------------------+| Variable_name | Value |+---------------------------------+------------------------------------+| log_bin | ON || log_bin_basename | /usr/local/mysql/data/binlog || log_bin_index | /usr/local/mysql/data/binlog.index || log_bin_trust_function_creators | OFF || log_bin_use_v1_row_events | OFF || sql_log_bin | ON |+---------------------------------+------------------------------------+6 rows in set (0.00 sec) MySQL ä¼šæŠŠç”¨æˆ·å¯¹æ‰€æœ‰æ•°æ®åº“çš„å†…å®¹å’Œç»“æ„çš„ä¿®æ”¹æƒ…å†µè®°å…¥ mysql-bin.n æ–‡ä»¶ï¼Œè€Œä¸ä¼šè®°å½• SELECT å’Œæ²¡æœ‰å®é™…æ›´æ–°çš„ UPDATE è¯­å¥ã€‚ å¦‚æœä½ ä¸çŸ¥é“ç°åœ¨æœ‰å“ªäº› Binlog æ–‡ä»¶ï¼Œå¯ä»¥ä½¿ç”¨å¦‚ä¸‹å‘½ä»¤ï¼š show binary logs; #æŸ¥çœ‹binlogåˆ—è¡¨show master status; #æŸ¥çœ‹æœ€æ–°çš„binlogmysql show binary logs;+------------------+-----------+-----------+| Log_name | File_size | Encrypted |+------------------+-----------+-----------+| mysql-bin.000001 | 179 | No || mysql-bin.000002 | 156 | No |+------------------+-----------+-----------+2 rows in set (0.00 sec) Binlog æ–‡ä»¶æ˜¯äºŒè¿›åˆ¶æ–‡ä»¶ï¼Œå¼ºè¡Œæ‰“å¼€çœ‹åˆ°çš„å¿…ç„¶æ˜¯ä¹±ç ï¼ŒMySQL æä¾›äº†å‘½ä»¤è¡Œçš„æ–¹å¼æ¥å±•ç¤º Binlog æ—¥å¿—ï¼š mysqlbinlog mysql-bin.000002 | more mysqlbinlog å‘½ä»¤å³å¯æŸ¥çœ‹ã€‚è™½ç„¶çœ‹èµ·æ¥å‡Œä¹±å…¶å®ä¹Ÿæœ‰è¿¹å¯å¾ªã€‚Binlog é€šè¿‡äº‹ä»¶çš„æ–¹å¼æ¥ç®¡ç†æ—¥å¿—ä¿¡æ¯ï¼Œå¯ä»¥é€šè¿‡ show binlog events in çš„è¯­æ³•æ¥æŸ¥çœ‹å½“å‰ Binlog æ–‡ä»¶å¯¹åº”çš„è¯¦ç»†äº‹ä»¶ä¿¡æ¯ã€‚ mysql show binlog events in mysql-bin.000001;+------------------+-----+----------------+-----------+-------------+-----------------------------------+| Log_name | Pos | Event_type | Server_id | End_log_pos | Info |+------------------+-----+----------------+-----------+-------------+-----------------------------------+| mysql-bin.000001 | 4 | Format_desc | 1 | 125 | Server ver: 8.0.21, Binlog ver: 4 || mysql-bin.000001 | 125 | Previous_gtids | 1 | 156 | || mysql-bin.000001 | 156 | Stop | 1 | 179 | |+------------------+-----+----------------+-----------+-------------+-----------------------------------+3 rows in set (0.01 sec) è¿™æ˜¯ä¸€ä»½æ²¡æœ‰ä»»ä½•å†™å…¥æ•°æ®çš„ Binlog æ—¥å¿—æ–‡ä»¶ã€‚Binlog çš„ç‰ˆæœ¬æ˜¯V4ï¼Œå¯ä»¥çœ‹åˆ°æ—¥å¿—çš„ç»“æŸæ—¶é—´ä¸º Stopã€‚å‡ºç° Stop event æœ‰ä¸¤ç§æƒ…å†µï¼š æ˜¯ master shut down çš„æ—¶å€™ä¼šåœ¨ Binlog æ–‡ä»¶ç»“å°¾å‡ºç° æ˜¯å¤‡æœºåœ¨å…³é—­çš„æ—¶å€™ä¼šå†™å…¥ relay log ç»“å°¾ï¼Œæˆ–è€…æ‰§è¡Œ RESET SLAVE å‘½ä»¤æ‰§è¡Œ æœ¬æ–‡å‡ºç°çš„åŸå› æ˜¯æˆ‘æœ‰æ‰‹åŠ¨åœæ­¢è¿‡ MySQL æœåŠ¡ã€‚ä¸€èˆ¬æ¥è¯´ä¸€ä»½æ­£å¸¸çš„ Binlog æ—¥å¿—æ–‡ä»¶ä¼šä»¥ Rotate event ç»“æŸã€‚å½“ Binlog æ–‡ä»¶è¶…è¿‡æŒ‡å®šå¤§å°ï¼ŒRotate event ä¼šå†™åœ¨æ–‡ä»¶æœ€åï¼ŒæŒ‡å‘ä¸‹ä¸€ä¸ª Binlog æ–‡ä»¶ã€‚æˆ‘ä»¬æ¥çœ‹çœ‹æœ‰è¿‡æ•°æ®æ“ä½œçš„ Binlog æ—¥å¿—æ–‡ä»¶æ˜¯ä»€ä¹ˆæ ·å­çš„ã€‚ mysql show binlog events in mysql-bin.000002;+------------------+-----+----------------+-----------+-------------+-----------------------------------+| Log_name | Pos | Event_type | Server_id | End_log_pos | Info |+------------------+-----+----------------+-----------+-------------+-----------------------------------+| mysql-bin.000002 | 4 | Format_desc | 1 | 125 | Server ver: 8.0.21, Binlog ver: 4 || mysql-bin.000002 | 125 | Previous_gtids | 1 | 156 | |+------------------+-----+----------------+-----------+-------------+-----------------------------------+2 rows in set (0.00 sec) ä¸Šé¢æ˜¯æ²¡æœ‰ä»»ä½•æ•°æ®æ“ä½œä¸”æ²¡æœ‰è¢«æˆªæ–­çš„ Binlogã€‚æ¥ä¸‹æ¥æˆ‘ä»¬æ’å…¥ä¸€æ¡æ•°æ®ï¼Œå†çœ‹çœ‹ Binlog äº‹ä»¶ã€‚ mysql show binlog events in mysql-bin.000002;+------------------+-----+----------------+-----------+-------------+-------------------------------------------------------------------------+| Log_name | Pos | Event_type | Server_id | End_log_pos | Info |+------------------+-----+----------------+-----------+-------------+-------------------------------------------------------------------------+| mysql-bin.000002 | 4 | Format_desc | 1 | 125 | Server ver: 8.0.21, Binlog ver: 4 || mysql-bin.000002 | 125 | Previous_gtids | 1 | 156 | || mysql-bin.000002 | 156 | Anonymous_Gtid | 1 | 235 | SET @@SESSION.GTID_NEXT= ANONYMOUS || mysql-bin.000002 | 235 | Query | 1 | 323 | BEGIN || mysql-bin.000002 | 323 | Intvar | 1 | 355 | INSERT_ID=13 || mysql-bin.000002 | 355 | Query | 1 | 494 | use `test_db`; INSERT INTO `test_db`.`test_db`(`name`) VALUES (xdfdf) || mysql-bin.000002 | 494 | Xid | 1 | 525 | COMMIT /* xid=192 */ |+------------------+-----+----------------+-----------+-------------+-------------------------------------------------------------------------+7 rows in set (0.00 sec) è¿™æ˜¯åŠ å…¥ä¸€æ¡æ•°æ®ä¹‹åçš„ Binlog äº‹ä»¶ã€‚ æˆ‘ä»¬å¯¹ event æŸ¥è¯¢çš„æ•°æ®è¡Œå…³é”®å­—æ®µæ¥è§£é‡Šä¸€ä¸‹ï¼š Posï¼šå½“å‰äº‹ä»¶çš„å¼€å§‹ä½ç½®ï¼Œæ¯ä¸ªäº‹ä»¶éƒ½å ç”¨å›ºå®šçš„å­—èŠ‚å¤§å°ï¼Œç»“æŸä½ç½®(End_log_position)å‡å»Posï¼Œå°±æ˜¯è¿™ä¸ªäº‹ä»¶å ç”¨çš„å­—èŠ‚æ•°ã€‚ä¸Šé¢çš„æ—¥å¿—ä¸­æˆ‘ä»¬èƒ½çœ‹åˆ°ï¼Œç¬¬ä¸€ä¸ªäº‹ä»¶ä½ç½®å¹¶ä¸æ˜¯ä» 0 å¼€å§‹ï¼Œè€Œæ˜¯ä» 4ã€‚MySQL é€šè¿‡æ–‡ä»¶ä¸­çš„å‰ 4 ä¸ªå­—èŠ‚ï¼Œæ¥åˆ¤æ–­è¿™æ˜¯ä¸æ˜¯ä¸€ä¸ª Binlog æ–‡ä»¶ã€‚è¿™ç§æ–¹å¼å¾ˆå¸¸è§ï¼Œå¾ˆå¤šæ ¼å¼çš„æ–‡ä»¶ï¼Œå¦‚ pdfã€docã€jpgç­‰ï¼Œéƒ½ä¼šé€šå¸¸å‰å‡ ä¸ªç‰¹å®šå­—ç¬¦åˆ¤æ–­æ˜¯å¦æ˜¯åˆæ³•æ–‡ä»¶ã€‚ Event_typeï¼šè¡¨ç¤ºäº‹ä»¶çš„ç±»å‹ Server_idï¼šè¡¨ç¤ºäº§ç”Ÿè¿™ä¸ªäº‹ä»¶çš„ MySQL server_idï¼Œé€šè¿‡è®¾ç½® my.cnf ä¸­çš„ server-id é€‰é¡¹è¿›è¡Œé…ç½® End_log_positionï¼šä¸‹ä¸€ä¸ªäº‹ä»¶çš„å¼€å§‹ä½ç½® Infoï¼šåŒ…å«äº‹ä»¶çš„å…·ä½“ä¿¡æ¯ Binlog æ—¥å¿—æ ¼å¼:é’ˆå¯¹ä¸åŒçš„ä½¿ç”¨åœºæ™¯ï¼ŒBinlog ä¹Ÿæä¾›äº†å¯å®šåˆ¶åŒ–çš„æœåŠ¡ï¼Œæä¾›äº†ä¸‰ç§æ¨¡å¼æ¥æä¾›ä¸åŒè¯¦ç»†ç¨‹åº¦çš„æ—¥å¿—å†…å®¹ã€‚ Statement æ¨¡å¼ï¼šåŸºäº SQL è¯­å¥çš„å¤åˆ¶(statement-based replication-SBR) Row æ¨¡å¼ï¼šåŸºäºè¡Œçš„å¤åˆ¶(row-based replication-RBR) Mixed æ¨¡å¼ï¼šæ··åˆæ¨¡å¼å¤åˆ¶(mixed-based replication-MBR) Statement æ¨¡å¼ä¿å­˜æ¯ä¸€æ¡ä¿®æ”¹æ•°æ®çš„SQLã€‚è¯¥æ¨¡å¼åªä¿å­˜ä¸€æ¡æ™®é€šçš„SQLè¯­å¥ï¼Œä¸æ¶‰åŠåˆ°æ‰§è¡Œçš„ä¸Šä¸‹æ–‡ä¿¡æ¯ã€‚å› ä¸ºæ¯å° MySQL æ•°æ®åº“çš„æœ¬åœ°ç¯å¢ƒå¯èƒ½ä¸ä¸€æ ·ï¼Œé‚£ä¹ˆå¯¹äºä¾èµ–åˆ°æœ¬åœ°ç¯å¢ƒçš„å‡½æ•°æˆ–è€…ä¸Šä¸‹æ–‡å¤„ç†çš„é€»è¾‘ SQL å»å¤„ç†çš„æ—¶å€™å¯èƒ½åŒæ ·çš„è¯­å¥åœ¨ä¸åŒçš„æœºå™¨ä¸Šæ‰§è¡Œå‡ºæ¥çš„æ•ˆæœä¸ä¸€è‡´ã€‚æ¯”å¦‚åƒ sleep()å‡½æ•°ï¼Œlast_insert_id()å‡½æ•°ï¼Œç­‰ç­‰ï¼Œè¿™äº›éƒ½è·Ÿç‰¹å®šæ—¶é—´çš„æœ¬åœ°ç¯å¢ƒæœ‰å…³ã€‚ Row æ¨¡å¼MySQL V5.1.5 ç‰ˆæœ¬å¼€å§‹æ”¯æŒRowæ¨¡å¼çš„ Binlogï¼Œå®ƒä¸ Statement æ¨¡å¼çš„åŒºåˆ«åœ¨äºå®ƒä¸ä¿å­˜å…·ä½“çš„ SQL è¯­å¥ï¼Œè€Œæ˜¯è®°å½•å…·ä½“è¢«ä¿®æ”¹çš„ä¿¡æ¯ã€‚æ¯”å¦‚ä¸€æ¡ update è¯­å¥æ›´æ–°10æ¡æ•°æ®ï¼Œå¦‚æœæ˜¯ Statement æ¨¡å¼é‚£å°±ä¿å­˜ä¸€æ¡ SQL å°±å¤Ÿï¼Œä½†æ˜¯ Row æ¨¡å¼ä¼šä¿å­˜æ¯ä¸€è¡Œåˆ†åˆ«æ›´æ–°äº†ä»€ä¹ˆï¼Œæœ‰10æ¡æ•°æ®ã€‚Row æ¨¡å¼çš„ä¼˜ç¼ºç‚¹å°±å¾ˆæ˜æ˜¾äº†ã€‚ä¿å­˜æ¯ä¸€ä¸ªæ›´æ”¹çš„è¯¦ç»†ä¿¡æ¯å¿…ç„¶ä¼šå¸¦æ¥å­˜å‚¨ç©ºé—´çš„å¿«é€Ÿè†¨èƒ€ï¼Œæ¢æ¥çš„æ˜¯äº‹ä»¶æ“ä½œçš„è¯¦ç»†è®°å½•ã€‚æ‰€ä»¥è¦æ±‚è¶Šé«˜ä»£ä»·è¶Šé«˜ã€‚ Mixed æ¨¡å¼Mixed æ¨¡å¼å³ä»¥ä¸Šä¸¤ç§æ¨¡å¼çš„ç»¼åˆä½“ã€‚æ—¢ç„¶ä¸Šé¢ä¸¤ç§æ¨¡å¼åˆ†åˆ«èµ°äº†æç®€å’Œä¸€ä¸ä¸è‹Ÿçš„æç«¯ï¼Œé‚£æ˜¯å¦å¯ä»¥åŒºåˆ†ä½¿ç”¨åœºæ™¯çš„æƒ…å†µä¸‹å°†è¿™ä¸¤ç§æ¨¡å¼ç»¼åˆèµ·æ¥å‘¢ï¼Ÿåœ¨ Mixed æ¨¡å¼ä¸­ï¼Œä¸€èˆ¬çš„æ›´æ–°è¯­å¥ä½¿ç”¨ Statement æ¨¡å¼æ¥ä¿å­˜ Binlogï¼Œä½†æ˜¯é‡åˆ°ä¸€äº›å‡½æ•°æ“ä½œï¼Œå¯èƒ½ä¼šå½±å“æ•°æ®å‡†ç¡®æ€§çš„æ“ä½œåˆ™ä½¿ç”¨ Row æ¨¡å¼æ¥ä¿å­˜ã€‚è¿™ç§æ–¹å¼éœ€è¦æ ¹æ®æ¯ä¸€æ¡å…·ä½“çš„ SQL è¯­å¥æ¥åŒºåˆ†é€‰æ‹©å“ªç§æ¨¡å¼ã€‚MySQL ä» V5.1.8 å¼€å§‹æä¾› Mixed æ¨¡å¼ï¼ŒV5.7.7 ä¹‹å‰çš„ç‰ˆæœ¬é»˜è®¤æ˜¯Statement æ¨¡å¼ï¼Œä¹‹åé»˜è®¤ä½¿ç”¨Rowæ¨¡å¼ï¼Œ ä½†æ˜¯åœ¨ 8.0 ä»¥ä¸Šç‰ˆæœ¬å·²ç»é»˜è®¤ä½¿ç”¨ Mixed æ¨¡å¼äº†ã€‚ æŸ¥è¯¢å½“å‰ Binlog æ—¥å¿—ä½¿ç”¨æ ¼å¼ï¼š mysql show global variables like %binlog_format%;+---------------------------------+---------+| Variable_name | Value |+---------------------------------+---------+| binlog_format | MIXED || default_week_format | 0 || information_schema_stats_expiry | 86400 || innodb_default_row_format | dynamic || require_row_format | OFF |+---------------------------------+---------+5 rows in set (0.01 sec) å¦‚ä½•é€šè¿‡ mysqlbinlog å‘½ä»¤æ‰‹åŠ¨æ¢å¤æ•°æ®ä¸Šé¢è¯´è¿‡æ¯ä¸€æ¡ event éƒ½æœ‰ä½ç‚¹ä¿¡æ¯ï¼Œå¦‚æœæˆ‘ä»¬å½“å‰çš„ MySQL åº“è¢«æ— æ“ä½œæˆ–è€…è¯¯åˆ é™¤äº†ï¼Œé‚£ä¹ˆè¯¥å¦‚ä½•é€šè¿‡ Binlog æ¥æ¢å¤åˆ°åˆ é™¤ä¹‹å‰çš„æ•°æ®çŠ¶æ€å‘¢ï¼Ÿé¦–å…ˆå‘ç°è¯¯æ“ä½œä¹‹åï¼Œå…ˆåœæ­¢ MySQL æœåŠ¡ï¼Œé˜²æ­¢ç»§ç»­æ›´æ–°ã€‚æ¥ç€é€šè¿‡ mysqlbinlogå‘½ä»¤å¯¹äºŒè¿›åˆ¶æ–‡ä»¶è¿›è¡Œåˆ†æï¼ŒæŸ¥çœ‹è¯¯æ“ä½œä¹‹å‰çš„ä½ç‚¹ä¿¡æ¯åœ¨å“ªé‡Œã€‚æ¥ä¸‹æ¥è‚¯å®šå°±æ˜¯æ¢å¤æ•°æ®ï¼Œå½“å‰æ•°æ®åº“çš„æ•°æ®å·²ç»æ˜¯é”™çš„ï¼Œé‚£ä¹ˆå°±ä»å¼€å§‹ä½ç½®åˆ°è¯¯æ“ä½œä¹‹å‰ä½ç‚¹çš„æ•°æ®è‚¯å®šçš„éƒ½æ˜¯æ­£ç¡®çš„ï¼›å¦‚æœè¯¯æ“ä½œä¹‹åä¹Ÿæœ‰æ­£å¸¸çš„æ•°æ®è¿›æ¥ï¼Œè¿™ä¸€æ®µæ—¶é—´çš„ä½ç‚¹æ•°æ®ä¹Ÿè¦å¤‡ä»½ã€‚æ¯”å¦‚è¯´ï¼šè¯¯æ“ä½œçš„ä½ç‚¹å¼€å§‹å€¼ä¸º 501ï¼Œè¯¯æ“ä½œç»“æŸçš„ä½ç½®ä¸º705ï¼Œä¹‹ååˆ°800çš„ä½ç‚¹éƒ½æ˜¯æ­£ç¡®æ•°æ®ã€‚é‚£ä¹ˆä» 0 - 500 ï¼Œ706 - 800 éƒ½æ˜¯æœ‰æ•ˆæ•°æ®ï¼Œæ¥ç€æˆ‘ä»¬å°±å¯ä»¥è¿›è¡Œæ•°æ®æ¢å¤äº†ã€‚å…ˆå°†æ•°æ®åº“å¤‡ä»½å¹¶æ¸…ç©ºã€‚æ¥ç€ä½¿ç”¨ mysqlbinlog æ¥æ¢å¤æ•°æ®ï¼š0 - 500 çš„æ•°æ®ï¼š mysqlbinlog --start-position=0 --stop-position=500 bin-log.000003 /root/back.sql; ä¸Šé¢å‘½ä»¤çš„ä½œç”¨å°±æ˜¯å°† 0 -500 ä½ç‚¹çš„æ•°æ®æ¢å¤åˆ°è‡ªå®šä¹‰çš„ SQL æ–‡ä»¶ä¸­ã€‚åŒç† 706 - 800 çš„æ•°æ®ä¹Ÿæ˜¯ä¸€æ ·æ“ä½œã€‚ä¹‹åæˆ‘ä»¬æ‰§è¡Œè¿™ä¸¤ä¸ª SQL æ–‡ä»¶å°±è¡Œäº†ã€‚ Binlog äº‹ä»¶ç±»å‹ä¸Šé¢æˆ‘ä»¬è¯´åˆ°äº† Binlog æ—¥å¿—ä¸­çš„äº‹ä»¶ï¼Œä¸åŒçš„æ“ä½œä¼šå¯¹åº”ç€ä¸åŒçš„äº‹ä»¶ç±»å‹ï¼Œä¸”ä¸åŒçš„ Binlog æ—¥å¿—æ¨¡å¼åŒä¸€ä¸ªæ“ä½œçš„äº‹ä»¶ç±»å‹ä¹Ÿä¸åŒï¼Œä¸‹é¢æˆ‘ä»¬ä¸€èµ·çœ‹çœ‹å¸¸è§çš„äº‹ä»¶ç±»å‹ã€‚é¦–å…ˆæˆ‘ä»¬çœ‹çœ‹æºç ä¸­çš„äº‹ä»¶ç±»å‹å®šä¹‰ï¼šæºç ä½ç½®ï¼šlibbinlogeventsincludebinlog_event.h enum Log_event_type /** Every time you update this enum (when you add a type), you have to fix Format_description_event::Format_description_event(). */ UNKNOWN_EVENT= 0, START_EVENT_V3= 1, QUERY_EVENT= 2, STOP_EVENT= 3, ROTATE_EVENT= 4, INTVAR_EVENT= 5, LOAD_EVENT= 6, SLAVE_EVENT= 7, CREATE_FILE_EVENT= 8, APPEND_BLOCK_EVENT= 9, EXEC_LOAD_EVENT= 10, DELETE_FILE_EVENT= 11, /** NEW_LOAD_EVENT is like LOAD_EVENT except that it has a longer sql_ex, allowing multibyte TERMINATED BY etc; both types share the same class (Load_event) */ NEW_LOAD_EVENT= 12, RAND_EVENT= 13, USER_VAR_EVENT= 14, FORMAT_DESCRIPTION_EVENT= 15, XID_EVENT= 16, BEGIN_LOAD_QUERY_EVENT= 17, EXECUTE_LOAD_QUERY_EVENT= 18, TABLE_MAP_EVENT = 19, /** The PRE_GA event numbers were used for 5.1.0 to 5.1.15 and are therefore obsolete. */ PRE_GA_WRITE_ROWS_EVENT = 20, PRE_GA_UPDATE_ROWS_EVENT = 21, PRE_GA_DELETE_ROWS_EVENT = 22, /** The V1 event numbers are used from 5.1.16 until mysql-trunk-xx */ WRITE_ROWS_EVENT_V1 = 23, UPDATE_ROWS_EVENT_V1 = 24, DELETE_ROWS_EVENT_V1 = 25, /** Something out of the ordinary happened on the master */ INCIDENT_EVENT= 26, /** Heartbeat event to be send by master at its idle time to ensure masters online status to slave */ HEARTBEAT_LOG_EVENT= 27, /** In some situations, it is necessary to send over ignorable data to the slave: data that a slave can handle in case there is code for handling it, but which can be ignored if it is not recognized. */ IGNORABLE_LOG_EVENT= 28, ROWS_QUERY_LOG_EVENT= 29, /** Version 2 of the Row events */ WRITE_ROWS_EVENT = 30, UPDATE_ROWS_EVENT = 31, DELETE_ROWS_EVENT = 32, GTID_LOG_EVENT= 33, ANONYMOUS_GTID_LOG_EVENT= 34, PREVIOUS_GTIDS_LOG_EVENT= 35, TRANSACTION_CONTEXT_EVENT= 36, VIEW_CHANGE_EVENT= 37, /* Prepared XA transaction terminal event similar to Xid */ XA_PREPARE_LOG_EVENT= 38, /** Add new events here - right above this comment! Existing events (except ENUM_END_EVENT) should never change their numbers */ ENUM_END_EVENT /* end marker */; è¿™ä¹ˆå¤šçš„äº‹ä»¶ç±»å‹æˆ‘ä»¬å°±ä¸ä¸€ä¸€ä»‹ç»ï¼ŒæŒ‘å‡ºæ¥ä¸€äº›å¸¸ç”¨çš„æ¥çœ‹çœ‹ã€‚FORMAT_DESCRIPTION_EVENTFORMAT_DESCRIPTION_EVENT æ˜¯ Binlog V4 ä¸­ä¸ºäº†å–ä»£ä¹‹å‰ç‰ˆæœ¬ä¸­çš„ START_EVENT_V3 äº‹ä»¶è€Œå¼•å…¥çš„ã€‚å®ƒæ˜¯ Binlog æ–‡ä»¶ä¸­çš„ç¬¬ä¸€ä¸ªäº‹ä»¶ï¼Œè€Œä¸”ï¼Œè¯¥äº‹ä»¶åªä¼šåœ¨ Binlog ä¸­å‡ºç°ä¸€æ¬¡ã€‚MySQL æ ¹æ® FORMAT_DESCRIPTION_EVENT çš„å®šä¹‰æ¥è§£æå…¶å®ƒäº‹ä»¶ã€‚å®ƒé€šå¸¸æŒ‡å®šäº† MySQL çš„ç‰ˆæœ¬ï¼ŒBinlog çš„ç‰ˆæœ¬ï¼Œè¯¥ Binlog æ–‡ä»¶çš„åˆ›å»ºæ—¶é—´ã€‚ QUERY_EVENT QUERY_EVENT ç±»å‹çš„äº‹ä»¶é€šå¸¸åœ¨ä»¥ä¸‹å‡ ç§æƒ…å†µä¸‹ä½¿ç”¨ï¼š äº‹åŠ¡å¼€å§‹æ—¶ï¼Œæ‰§è¡Œçš„ BEGIN æ“ä½œSTATEMENT æ ¼å¼ä¸­çš„ DML æ“ä½œROW æ ¼å¼ä¸­çš„ DDL æ“ä½œæ¯”å¦‚ä¸Šæ–‡æˆ‘ä»¬æ’å…¥ä¸€æ¡æ•°æ®ä¹‹åçš„ Binlog æ—¥å¿—ï¼š mysql show binlog events in mysql-bin.000002;+------------------+-----+----------------+-----------+-------------+-------------------------------------------------------------------------+| Log_name | Pos | Event_type | Server_id | End_log_pos | Info |+------------------+-----+----------------+-----------+-------------+-------------------------------------------------------------------------+| mysql-bin.000002 | 4 | Format_desc | 1 | 125 | Server ver: 8.0.21, Binlog ver: 4 || mysql-bin.000002 | 125 | Previous_gtids | 1 | 156 | || mysql-bin.000002 | 156 | Anonymous_Gtid | 1 | 235 | SET @@SESSION.GTID_NEXT= ANONYMOUS || mysql-bin.000002 | 235 | Query | 1 | 323 | BEGIN || mysql-bin.000002 | 323 | Intvar | 1 | 355 | INSERT_ID=13 || mysql-bin.000002 | 355 | Query | 1 | 494 | use `test_db`; INSERT INTO `test_db`.`test_db`(`name`) VALUES (xdfdf) || mysql-bin.000002 | 494 | Xid | 1 | 525 | COMMIT /* xid=192 */ |+------------------+-----+----------------+-----------+-------------+-------------------------------------------------------------------------+7 rows in set (0.00 sec) XID_EVENTåœ¨äº‹åŠ¡æäº¤æ—¶ï¼Œä¸ç®¡æ˜¯ STATEMENT è¿˜ æ˜¯ROW æ ¼å¼çš„ Binlogï¼Œéƒ½ä¼šåœ¨æœ«å°¾æ·»åŠ ä¸€ä¸ª XID_EVENT äº‹ä»¶ä»£è¡¨äº‹åŠ¡çš„ç»“æŸã€‚è¯¥äº‹ä»¶è®°å½•äº†è¯¥äº‹åŠ¡çš„ IDï¼Œåœ¨ MySQL è¿›è¡Œå´©æºƒæ¢å¤æ—¶ï¼Œæ ¹æ®äº‹åŠ¡åœ¨ Binlog ä¸­çš„æäº¤æƒ…å†µæ¥å†³å®šæ˜¯å¦æäº¤å­˜å‚¨å¼•æ“ä¸­çŠ¶æ€ä¸º prepared çš„äº‹åŠ¡ã€‚ROWS_EVENTå¯¹äº ROW æ ¼å¼çš„ Binlogï¼Œæ‰€æœ‰çš„ DML è¯­å¥éƒ½æ˜¯è®°å½•åœ¨ ROWS_EVENT ä¸­ã€‚ROWS_EVENTåˆ†ä¸ºä¸‰ç§ï¼šWRITE_ROWS_EVENTUPDATE_ROWS_EVENTDELETE_ROWS_EVENTåˆ†åˆ«å¯¹åº” insertï¼Œupdate å’Œ delete æ“ä½œã€‚å¯¹äº insert æ“ä½œï¼ŒWRITE_ROWS_EVENT åŒ…å«äº†è¦æ’å…¥çš„æ•°æ®ã€‚å¯¹äº update æ“ä½œï¼ŒUPDATE_ROWS_EVENT ä¸ä»…åŒ…å«äº†ä¿®æ”¹åçš„æ•°æ®ï¼Œè¿˜åŒ…å«äº†ä¿®æ”¹å‰çš„å€¼ã€‚å¯¹äº delete æ“ä½œï¼Œä»…ä»…éœ€è¦æŒ‡å®šåˆ é™¤çš„ä¸»é”®ï¼ˆåœ¨æ²¡æœ‰ä¸»é”®çš„æƒ…å†µä¸‹ï¼Œä¼šç»™å®šæ‰€æœ‰åˆ—ï¼‰ã€‚ å¯¹æ¯” QUERY_EVENT äº‹ä»¶ï¼Œæ˜¯ä»¥æ–‡æœ¬å½¢å¼è®°å½• DML æ“ä½œçš„ã€‚è€Œå¯¹äº ROWS_EVENT äº‹ä»¶ï¼Œå¹¶ä¸æ˜¯æ–‡æœ¬å½¢å¼ï¼Œæ‰€ä»¥åœ¨é€šè¿‡ mysqlbinlog æŸ¥çœ‹åŸºäº ROW æ ¼å¼çš„ Binlog æ—¶ï¼Œéœ€è¦æŒ‡å®š -vv â€“base64-outputdecode-rowsã€‚ æˆ‘ä»¬æ¥æµ‹è¯•ä¸€ä¸‹ï¼Œé¦–å…ˆå°†æ—¥å¿—æ ¼å¼æ”¹ä¸º Rowsï¼š mysql set binlog_format=row;Query OK, 0 rows affected (0.00 sec)mysqlmysql flush logs;Query OK, 0 rows affected (0.01 sec) ç„¶ååˆ·æ–°ä¸€ä¸‹æ—¥å¿—æ–‡ä»¶ï¼Œé‡æ–°å¼€å§‹ä¸€ä¸ª Binlog æ—¥å¿—ã€‚æˆ‘ä»¬æ’å…¥ä¸€æ¡æ•°æ®ä¹‹åçœ‹ä¸€ä¸‹æ—¥å¿—ï¼š mysql show binlog events in binlog.000008;+---------------+-----+----------------+-----------+-------------+--------------------------------------+| Log_name | Pos | Event_type | Server_id | End_log_pos | Info |+---------------+-----+----------------+-----------+-------------+--------------------------------------+| binlog.000008 | 4 | Format_desc | 1 | 125 | Server ver: 8.0.21, Binlog ver: 4 || binlog.000008 | 125 | Previous_gtids | 1 | 156 | || binlog.000008 | 156 | Anonymous_Gtid | 1 | 235 | SET @@SESSION.GTID_NEXT= ANONYMOUS || binlog.000008 | 235 | Query | 1 | 313 | BEGIN || binlog.000008 | 313 | Table_map | 1 | 377 | table_id: 85 (test_db.test_db) || binlog.000008 | 377 | Write_rows | 1 | 423 | table_id: 85 flags: STMT_END_F || binlog.000008 | 423 | Xid | 1 | 454 | COMMIT /* xid=44 */ |+---------------+-----+----------------+-----------+-------------+--------------------------------------+7 rows in set (0.01 sec) è¯´è¯´ redo log çš„å·¥ä½œæœºåˆ¶ï¼Ÿå½“äº‹åŠ¡å¯åŠ¨æ—¶ï¼ŒMySQL ä¼šä¸ºè¯¥äº‹åŠ¡åˆ†é…ä¸€ä¸ªå”¯ä¸€æ ‡è¯†ç¬¦ã€‚åœ¨äº‹åŠ¡æ‰§è¡Œè¿‡ç¨‹ä¸­ï¼Œæ¯æ¬¡å¯¹æ•°æ®è¿›è¡Œä¿®æ”¹ï¼ŒMySQL éƒ½ä¼šç”Ÿæˆä¸€æ¡ Redo Logï¼Œè®°å½•ä¿®æ”¹å‰åçš„æ•°æ®çŠ¶æ€ã€‚è¿™äº› Redo Log é¦–å…ˆä¼šè¢«å†™å…¥å†…å­˜ä¸­çš„ Redo Log Bufferã€‚å½“äº‹åŠ¡æäº¤æ—¶ï¼ŒMySQL å†å°† Redo Log Buffer ä¸­çš„è®°å½•åˆ·æ–°åˆ°ç£ç›˜ä¸Šçš„ Redo Log æ–‡ä»¶ä¸­ã€‚åªæœ‰å½“ Redo Log æˆåŠŸå†™å…¥ç£ç›˜ï¼Œäº‹åŠ¡æ‰ç®—çœŸæ­£æäº¤æˆåŠŸã€‚å½“ MySQL å´©æºƒé‡å¯æ—¶ï¼Œä¼šå…ˆæ£€æŸ¥ Redo Logã€‚å¯¹äºå·²æäº¤çš„äº‹åŠ¡ï¼ŒMySQL ä¼šé‡æ”¾ Redo Log ä¸­çš„è®°å½•ã€‚å¯¹äºæœªæäº¤çš„äº‹åŠ¡ï¼ŒMySQL ä¼šé€šè¿‡ Undo Log å›æ»šè¿™äº›ä¿®æ”¹ï¼Œç¡®ä¿æ•°æ®æ¢å¤åˆ°å´©æºƒå‰çš„ä¸€è‡´æ€§çŠ¶æ€ã€‚Redo Log æ˜¯å¾ªç¯ä½¿ç”¨çš„ï¼Œå½“æ–‡ä»¶å†™æ»¡åä¼šè¦†ç›–æœ€æ—©çš„è®°å½•ã€‚ä¸ºé¿å…è¦†ç›–æœªæŒä¹…åŒ–çš„è®°å½•ï¼ŒMySQL ä¼šå®šæœŸæ‰§è¡Œ CheckPoint æ“ä½œï¼Œå°†å†…å­˜ä¸­çš„æ•°æ®é¡µåˆ·æ–°åˆ°ç£ç›˜ï¼Œå¹¶è®°å½• CheckPoint ç‚¹ã€‚ é‡å¯æ—¶ï¼ŒMySQL åªä¼šé‡æ”¾ CheckPoint ä¹‹åçš„ Redo Logï¼Œä»è€Œæé«˜æ¢å¤æ•ˆç‡ã€‚ çœæµç‰ˆ: äº‹åŠ¡å¼€å§‹ è®°å½•undo logï¼ˆæ—§æ•°æ®ï¼‰ ä¿®æ”¹Buffer Poolä¸­çš„æ•°æ® å†™å…¥redo logï¼ˆprepareçŠ¶æ€ï¼‰ å†™å…¥binlog æäº¤äº‹åŠ¡ï¼ˆredo logæ ‡è®°ä¸ºcommitï¼‰ åå°å¼‚æ­¥åˆ·è„é¡µåˆ°ç£ç›˜ redo log æ–‡ä»¶çš„å¤§å°æ˜¯å›ºå®šçš„å—ï¼Ÿredo log æ–‡ä»¶æ˜¯å›ºå®šå¤§å°çš„ï¼Œé€šå¸¸é…ç½®ä¸ºä¸€ç»„æ–‡ä»¶ï¼Œä½¿ç”¨ç¯å½¢æ–¹å¼å†™å…¥ï¼Œæ—§çš„æ—¥å¿—ä¼šåœ¨ç©ºé—´éœ€è¦æ—¶è¢«è¦†ç›–ã€‚ å‘½åæ–¹å¼ä¸º ib_logfile0ã€iblogfile1ã€ã€ã€iblogfilenã€‚é»˜è®¤ 2 ä¸ªæ–‡ä»¶ï¼Œæ¯ä¸ªæ–‡ä»¶å¤§å°ä¸º 48MBã€‚å¯ä»¥é€šè¿‡ show variables like innodb_log_file_size; æŸ¥çœ‹ redo log æ–‡ä»¶çš„å¤§å°ï¼›é€šè¿‡ show variables like innodb_log_files_in_group; æŸ¥çœ‹ redo log æ–‡ä»¶çš„æ•°é‡ã€‚ è¯´ä¸€è¯´WAL?WALâ€”â€”Write-Ahead Loggingã€‚ é¢„å†™æ—¥å¿—æ˜¯ InnoDB å®ç°äº‹åŠ¡æŒä¹…åŒ–çš„æ ¸å¿ƒæœºåˆ¶ï¼Œå®ƒçš„æ€æƒ³æ˜¯ï¼šå…ˆå†™æ—¥å¿—å†åˆ·ç£ç›˜ã€‚å³åœ¨ä¿®æ”¹æ•°æ®é¡µä¹‹å‰ï¼Œå…ˆå°†ä¿®æ”¹è®°å½•å†™å…¥ Redo Logã€‚è¿™æ ·çš„è¯ï¼Œå³ä½¿æ•°æ®é¡µå°šæœªå†™å…¥ç£ç›˜ï¼Œç³»ç»Ÿå´©æºƒæ—¶ä¹Ÿèƒ½é€šè¿‡ Redo Log æ¢å¤æ•°æ®ã€‚â€”-è¿™éƒ¨åˆ†æ˜¯å¸®åŠ©ç†è§£ startï¼Œé¢è¯•ä¸­å¯ä¸èƒŒâ€”-è§£é‡Šä¸€ä¸‹ä¸ºä»€ä¹ˆéœ€è¦ WALï¼šæ•°æ®æœ€ç»ˆæ˜¯è¦å†™å…¥ç£ç›˜çš„ï¼Œä½†ç£ç›˜ IO å¾ˆæ…¢ï¼›å¦‚æœæ¯æ¬¡æ›´æ–°éƒ½ç«‹åˆ»æŠŠæ•°æ®é¡µåˆ·ç›˜ï¼Œæ€§èƒ½å¾ˆå·®ï¼›å¦‚æœè¿˜æ²¡å†™å…¥ç£ç›˜å°±å®•æœºï¼Œäº‹åŠ¡ä¼šä¸¢å¤±ã€‚WAL çš„å¥½å¤„æ˜¯æ›´æ–°æ—¶ä¸ç›´æ¥å†™æ•°æ®é¡µï¼Œè€Œæ˜¯å…ˆå†™ä¸€ä»½å˜æ›´è®°å½•åˆ° redo logï¼Œåå°å†æ…¢æ…¢æŠŠçœŸæ­£çš„æ•°æ®é¡µåˆ·ç›˜ï¼Œä¸€ä¸¾å¤šå¾—ã€‚â€”-è¿™éƒ¨åˆ†æ˜¯å¸®åŠ©ç†è§£ endï¼Œé¢è¯•ä¸­å¯ä¸èƒŒâ€”- 29.binlog å’Œ redo log æœ‰ä»€ä¹ˆåŒºåˆ«ï¼Ÿbinlog ç”± MySQL çš„ Server å±‚å®ç°ï¼Œä¸å­˜å‚¨å¼•æ“æ— å…³ï¼›redo log ç”± InnoDB å­˜å‚¨å¼•æ“å®ç°ã€‚ binlog è®°å½•çš„æ˜¯é€»è¾‘æ—¥å¿—ï¼ŒåŒ…æ‹¬åŸå§‹çš„ SQL è¯­å¥æˆ–è€…è¡Œæ•°æ®å˜åŒ–ï¼Œä¾‹å¦‚â€œå°† id2 è¿™è¡Œæ•°æ®çš„ age å­—æ®µ+1â€ã€‚redo log è®°å½•ç‰©ç†æ—¥å¿—ï¼Œå³æ•°æ®é¡µçš„å…·ä½“ä¿®æ”¹ï¼Œä¾‹å¦‚â€œå°† page_id123 ä¸Š offset0x40 çš„æ•°æ®ä» 18 ä¿®æ”¹ä¸º 26â€ã€‚binlog æ˜¯è¿½åŠ å†™å…¥çš„ï¼Œæ–‡ä»¶å†™æ»¡åä¼šæ–°å»ºæ–‡ä»¶ç»§ç»­å†™å…¥ï¼Œä¸ä¼šè¦†ç›–å†å²æ—¥å¿—ï¼Œä¿å­˜çš„æ˜¯å…¨é‡æ“ä½œè®°å½•ï¼›redo log æ˜¯å¾ªç¯å†™å…¥çš„ï¼Œç©ºé—´æ˜¯å›ºå®šçš„ï¼Œå†™æ»¡åä¼šè¦†ç›–æ—§çš„æ—¥å¿—ï¼Œä»…ä¿å­˜æœªåˆ·ç›˜çš„è„é¡µæ—¥å¿—ï¼Œå·²æŒä¹…åŒ–çš„æ•°æ®ä¼šè¢«æ¸…é™¤ã€‚å¦å¤–ï¼Œä¸ºä¿è¯ä¸¤ç§æ—¥å¿—çš„ä¸€è‡´æ€§ï¼Œinnodb é‡‡ç”¨äº†ä¸¤é˜¶æ®µæäº¤ç­–ç•¥ï¼Œredo log åœ¨äº‹åŠ¡æ‰§è¡Œè¿‡ç¨‹ä¸­æŒç»­å†™å…¥ï¼Œå¹¶åœ¨äº‹åŠ¡æäº¤å‰è¿›å…¥ prepare çŠ¶æ€ï¼›binlog åœ¨äº‹åŠ¡æäº¤çš„æœ€åé˜¶æ®µå†™å…¥ï¼Œä¹‹å redo log ä¼šè¢«æ ‡è®°ä¸º commit çŠ¶æ€ã€‚å¯ä»¥é€šè¿‡å›æ”¾ binlog å®ç°æ•°æ®åŒæ­¥æˆ–è€…æ¢å¤åˆ°æŒ‡å®šæ—¶é—´ç‚¹ï¼›redo log ç”¨æ¥ç¡®ä¿äº‹åŠ¡æäº¤åå³ä½¿ç³»ç»Ÿå®•æœºï¼Œæ•°æ®ä»ç„¶å¯ä»¥é€šè¿‡é‡æ”¾ redo log æ¢å¤ã€‚ 30.ä¸ºä»€ä¹ˆè¦ä¸¤é˜¶æ®µæäº¤?ä¸ºäº†ä¿è¯ redo log å’Œ binlog ä¸­çš„æ•°æ®ä¸€è‡´æ€§ï¼Œé˜²æ­¢ä¸»ä»å¤åˆ¶å’Œäº‹åŠ¡çŠ¶æ€ä¸ä¸€è‡´ã€‚ ä¸ºä»€ä¹ˆ 2PC èƒ½ä¿è¯ redo log å’Œ binlog çš„å¼ºâ¼€è‡´æ€§ï¼Ÿå‡å¦‚ MySQL åœ¨é¢„å†™ redo log ä¹‹åã€å†™å…¥ binlog ä¹‹å‰å´©æºƒã€‚é‚£ä¹ˆ MySQL é‡å¯å InnoDB ä¼šå›æ»šè¯¥äº‹åŠ¡ï¼Œå› ä¸º redo log ä¸æ˜¯æäº¤çŠ¶æ€ã€‚å¹¶ä¸”ç”±äº binlog ä¸­æ²¡æœ‰å†™å…¥æ•°æ®ï¼Œæ‰€ä»¥ä»åº“ä¹Ÿä¸ä¼šæœ‰è¯¥äº‹åŠ¡çš„æ•°æ®ã€‚ å‡å¦‚ MySQL åœ¨å†™å…¥ binlog ä¹‹åã€redo log æäº¤ä¹‹å‰å´©æºƒã€‚é‚£ä¹ˆ MySQL é‡å¯å InnoDB ä¼šæäº¤è¯¥äº‹åŠ¡ï¼Œå› ä¸º redo log æ˜¯æäº¤çŠ¶æ€ã€‚å¹¶ä¸”ç”±äº binlog ä¸­æœ‰å†™å…¥æ•°æ®ï¼Œæ‰€ä»¥ä»åº“ä¹Ÿä¼šåŒæ­¥åˆ°è¯¥äº‹åŠ¡çš„æ•°æ®ã€‚ä¼ªä»£ç å¦‚ä¸‹: // äº‹åŠ¡å¼€å§‹begin;// try // æ‰§è¡Œ SQL execute SQL; // å†™å…¥ redo log å¹¶æ ‡è®°ä¸º prepare write redo log prepare xid; // å†™å…¥ binlog write binlog xid sql; // æäº¤ redo log commit redo log xid;// catch // å›æ»š redo log innodb rollback redo log xid;// äº‹åŠ¡ç»“æŸend; XID äº†è§£å—ï¼ŸXID æ˜¯ binlog ä¸­ç”¨æ¥æ ‡è¯†äº‹åŠ¡æäº¤çš„å”¯ä¸€æ ‡è¯†ç¬¦ã€‚ åœ¨äº‹åŠ¡æäº¤æ—¶ï¼Œä¼šå†™å…¥ä¸€ä¸ª XID_EVENT åˆ° binlogï¼Œè¡¨ç¤ºè¿™ä¸ªäº‹åŠ¡çœŸæ­£å®Œæˆäº†ã€‚ Log_name | Pos | Event_type | Server_id | End_log_pos | Info | mysql-bin.000003 | 2005 | Gtid | 1013307 | 2070 | SET @@SESSION.GTID_NEXT= f971d5f1-d450-11ec-9e7b-5254000a56df:11 || mysql-bin.000003 | 2070 | Query | 1013307 | 2142 | BEGIN || mysql-bin.000003 | 2142 | Table_map | 1013307 | 2187 | table_id: 109 (test.t1) || mysql-bin.000003 | 2187 | Write_rows | 1013307 | 2227 | table_id: 109 flags: STMT_END_F || mysql-bin.000003 | 2227 | Xid | 1013307 | 2258 | COMMIT /* xid=121 */ å®ƒä¸ä»…ç”¨äºä¸»ä»å¤åˆ¶ä¸­äº‹åŠ¡å®Œæ•´æ€§çš„åˆ¤æ–­ï¼Œä¹Ÿåœ¨å´©æºƒæ¢å¤ä¸­å¯¹ redo log å’Œ binlog çš„ä¸€è‡´æ€§æ ¡éªŒèµ·åˆ°å…³é”®ä½œç”¨ã€‚ XID å¯ä»¥å¸®åŠ© MySQL åˆ¤æ–­å“ªäº› redo log æ˜¯å·²æäº¤çš„ï¼Œå“ªäº›æ˜¯æœªæäº¤éœ€è¦å›æ»šçš„ï¼Œæ˜¯ä¸¤é˜¶æ®µæäº¤æœºåˆ¶ä¸­éå¸¸å…³é”®çš„ä¸€ç¯ã€‚ 31.redo log çš„å†™å…¥è¿‡ç¨‹äº†è§£å—ï¼ŸInnoDB ä¼šå…ˆå°† Redo Log å†™å…¥å†…å­˜ä¸­çš„ Redo Log Bufferï¼Œä¹‹åå†ä»¥ä¸€å®šçš„é¢‘ç‡åˆ·å…¥åˆ°ç£ç›˜çš„ Redo Log File ä¸­ã€‚ å“ªäº›åœºæ™¯ä¼šè§¦å‘ redo log çš„åˆ·ç›˜åŠ¨ä½œï¼Ÿæ¯”å¦‚è¯´ Redo Log Buffer çš„ç©ºé—´ä¸è¶³æ—¶ï¼Œäº‹åŠ¡æäº¤æ—¶ï¼Œè§¦å‘ Checkpoint æ—¶ï¼Œåå°çº¿ç¨‹å®šæœŸåˆ·ç›˜æ—¶ã€‚ä¸è¿‡ï¼ŒRedo Log Buffer åˆ·ç›˜åˆ° Redo Log File è¿˜ä¼šæ¶‰åŠåˆ°æ“ä½œç³»ç»Ÿçš„ç£ç›˜ç¼“å­˜ç­–ç•¥ï¼Œå¯èƒ½ä¸ä¼šç«‹å³åˆ·ç›˜ï¼Œè€Œæ˜¯ç­‰å¾…ä¸€å®šæ—¶é—´åæ‰åˆ·ç›˜ã€‚ innodb_flush_log_at_trx_commit å‚æ•°ä½ äº†è§£å¤šå°‘ï¼Ÿinnodb_flush_log_at_trx_commit å‚æ•°æ˜¯ç”¨æ¥æ§åˆ¶äº‹åŠ¡æäº¤æ—¶ï¼ŒRedo Log çš„åˆ·ç›˜ç­–ç•¥ï¼Œä¸€å…±æœ‰ä¸‰ç§ã€‚ 0 è¡¨ç¤ºäº‹åŠ¡æäº¤æ—¶ä¸åˆ·ç›˜ï¼Œè€Œæ˜¯äº¤ç»™åå°çº¿ç¨‹æ¯éš” 1 ç§’æ‰§è¡Œä¸€æ¬¡ã€‚è¿™ç§æ–¹å¼æ€§èƒ½æœ€å¥½ï¼Œä½†æ˜¯åœ¨ MySQL å®•æœºæ—¶å¯èƒ½ä¼šä¸¢å¤±ä¸€ç§’å†…çš„äº‹åŠ¡ã€‚ 1 è¡¨ç¤ºäº‹åŠ¡æäº¤æ—¶ä¼šç«‹å³åˆ·ç›˜ï¼Œç¡®ä¿äº‹åŠ¡æäº¤åæ•°æ®å°±æŒä¹…åŒ–åˆ°ç£ç›˜ã€‚è¿™ç§æ–¹å¼æ˜¯æœ€å®‰å…¨çš„ï¼Œä¹Ÿæ˜¯ InnoDB çš„é»˜è®¤å€¼ã€‚ 2 è¡¨ç¤ºäº‹åŠ¡æäº¤æ—¶åªæŠŠ Redo Log Buffer å†™å…¥åˆ° Page Cacheï¼Œç”±æ“ä½œç³»ç»Ÿå†³å®šä»€ä¹ˆæ—¶å€™åˆ·ç›˜ã€‚æ“ä½œç³»ç»Ÿå®•æœºæ—¶ï¼Œå¯èƒ½ä¼šä¸¢å¤±ä¸€éƒ¨åˆ†æ•°æ®ã€‚ ä¸€ä¸ªæ²¡æœ‰æäº¤äº‹åŠ¡çš„ redo logï¼Œä¼šä¸ä¼šåˆ·ç›˜ï¼ŸInnoDB æœ‰ä¸€ä¸ªåå°çº¿ç¨‹ï¼Œæ¯éš” 1 ç§’ä¼šæŠŠRedo Log Bufferä¸­çš„æ—¥å¿—å†™å…¥åˆ°æ–‡ä»¶ç³»ç»Ÿçš„ç¼“å­˜ä¸­ï¼Œç„¶åè°ƒç”¨åˆ·ç›˜æ“ä½œã€‚ å› æ­¤ï¼Œä¸€ä¸ªæ²¡æœ‰æäº¤äº‹åŠ¡çš„ Redo Log ä¹Ÿå¯èƒ½ä¼šè¢«åˆ·æ–°åˆ°ç£ç›˜ä¸­ã€‚å¦å¤–ï¼Œå¦‚æœå½“ Redo Log Buffer å ç”¨çš„ç©ºé—´å³å°†è¾¾åˆ° innodb_log_buffer_size çš„ä¸€åŠæ—¶ï¼Œä¹Ÿä¼šè§¦å‘åˆ·ç›˜æ“ä½œã€‚ Redo Log Buffer æ˜¯é¡ºåºå†™è¿˜æ˜¯éšæœºå†™ï¼ŸMySQL åœ¨å¯åŠ¨åä¼šå‘æ“ä½œç³»ç»Ÿç”³è¯·ä¸€å—è¿ç»­çš„å†…å­˜ç©ºé—´ä½œä¸º Redo Log Bufferï¼Œå¹¶å°†å…¶åˆ†ä¸ºè‹¥å¹²ä¸ªè¿ç»­çš„ Redo Log Blockã€‚é‚£ä¸ºäº†æé«˜å†™å…¥æ•ˆç‡ï¼ŒRedo Log Buffer é‡‡ç”¨äº†é¡ºåºå†™å…¥çš„æ–¹å¼ï¼Œä¼šå…ˆå¾€å‰é¢çš„ Redo Log Block ä¸­å†™å…¥ï¼Œå½“å†™æ»¡åå†å¾€åé¢çš„ Block ä¸­å†™å…¥ã€‚äºæ­¤åŒæ—¶ï¼ŒInnoDB è¿˜æä¾›äº†ä¸€ä¸ªå…¨å±€å˜é‡ buf_freeï¼Œæ¥æ§åˆ¶åç»­çš„ redo log è®°å½•åº”è¯¥å†™å…¥åˆ° block ä¸­çš„å“ªä¸ªä½ç½®ã€‚ buf_next_to_write äº†è§£å—ï¼Ÿbuf_next_to_write æŒ‡å‘ Redo Log Buffer ä¸­ä¸‹ä¸€æ¬¡éœ€è¦å†™å…¥ç¡¬ç›˜çš„èµ·å§‹ä½ç½®ã€‚ è€Œ buf_free æŒ‡å‘çš„æ˜¯ Redo Log Buffer ä¸­ç©ºé—²åŒºåŸŸçš„èµ·å§‹ä½ç½®ã€‚ äº†è§£ MTR å—ï¼ŸMini Transaction æ˜¯ InnoDB å†…éƒ¨ç”¨äºæ“ä½œæ•°æ®é¡µçš„åŸå­æ“ä½œå•å…ƒã€‚ mtr_t mtr;mtr_start(mtr);// 1. åŠ é”// å¯¹å¾…è®¿é—®çš„indexåŠ é”mtr_s_lock(rw_lock_t, mtr);mtr_x_lock(rw_lock_t, mtr);// å¯¹å¾…è¯»å†™çš„pageåŠ é”mtr_memo_push(mtr, buf_block_t, MTR_MEMO_PAGE_S_FIX);mtr_memo_push(mtr, buf_block_t, MTR_MEMO_PAGE_X_FIX);// 2. è®¿é—®æˆ–ä¿®æ”¹pagebtr_cur_search_to_nth_levelbtr_cur_optimistic_insert// 3. ä¸ºä¿®æ”¹æ“ä½œç”Ÿæˆredomlog_openmlog_write_initial_log_record_fastmlog_close// 4. æŒä¹…åŒ–redoï¼Œè§£é”mtr_commit(mtr); å¤šä¸ªäº‹åŠ¡çš„ Redo Log ä¼šä»¥ MTR ä¸ºå•ä½äº¤æ›¿å†™å…¥åˆ° Redo Log Buffer ä¸­ï¼Œå‡å¦‚äº‹åŠ¡ 1 å’Œäº‹åŠ¡ 2 å‡æœ‰ä¸¤ä¸ª MTRï¼Œä¸€æ—¦æŸä¸ª MTR ç»“æŸï¼Œå°±ä¼šå°†å…¶ç”Ÿæˆçš„è‹¥å¹²æ¡ Redo Log è®°å½•é¡ºåºå†™å…¥åˆ° Redo Log Buffer ä¸­ã€‚ ä¹Ÿå°±æ˜¯è¯´ï¼Œä¸€ä¸ª MTR ä¼šåŒ…å«ä¸€ç»„ Redo Log è®°å½•ï¼Œæ˜¯ MySQL å´©æºƒåæ¢å¤äº‹åŠ¡çš„æœ€å°æ‰§è¡Œå•å…ƒã€‚ Redo Log Block çš„ç»“æ„äº†è§£å—ï¼ŸRedo Log Block ç”±æ—¥å¿—å¤´ã€æ—¥å¿—ä½“å’Œæ—¥å¿—å°¾ç»„æˆï¼Œä¸€å…±å ç”¨ 512 ä¸ªå­—èŠ‚ï¼Œå…¶ä¸­æ—¥å¿—å¤´å ç”¨ 12 ä¸ªå­—èŠ‚ï¼Œæ—¥å¿—å°¾å ç”¨ 4 ä¸ªå­—èŠ‚ï¼Œå‰©ä½™çš„ 496 ä¸ªå­—èŠ‚ç”¨äºå­˜å‚¨æ—¥å¿—ä½“ã€‚æ—¥å¿—å¤´åŒ…å«äº†å½“å‰ Block çš„åºåˆ—å·ã€ç¬¬ä¸€æ¡æ—¥å¿—çš„åºåˆ—å·ã€ç±»å‹ç­‰ä¿¡æ¯ã€‚æ—¥å¿—å°¾ä¸»è¦å­˜å‚¨çš„æ˜¯ LOG_BLOCK_CHECKSUMï¼Œä¹Ÿå°±æ˜¯ Block çš„æ ¡éªŒå’Œï¼Œä¸»è¦ç”¨äºåˆ¤æ–­ Block æ˜¯å¦å®Œæ•´ã€‚ Redo Log Block ä¸ºä»€ä¹ˆè®¾è®¡æˆ 512 å­—èŠ‚ï¼Ÿå› ä¸ºæœºæ¢°ç¡¬ç›˜çš„ç‰©ç†æ‰‡åŒºå¤§å°é€šå¸¸ä¸º 512 å­—èŠ‚ï¼ŒRedo Log Block ä¹Ÿè®¾è®¡ä¸ºåŒæ ·çš„å¤§å°ï¼Œå°±å¯ä»¥ç¡®ä¿æ¯æ¬¡å†™å…¥éƒ½æ˜¯æ•´æ•°ä¸ªæ‰‡åŒºï¼Œå‡å°‘å¯¹é½å¼€é”€ã€‚ æ¯”å¦‚è¯´æ“ä½œç³»ç»Ÿçš„é¡µç¼“å­˜é»˜è®¤ä¸º 4KBï¼Œ8 ä¸ª Redo Log Block å°±å¯ä»¥ç»„åˆæˆä¸€ä¸ªé¡µç¼“å­˜å•å…ƒï¼Œä»è€Œæå‡ Redo Log Buffer çš„å†™å…¥æ•ˆç‡ã€‚ LSN äº†è§£å—ï¼ŸLog Sequence Number æ˜¯ä¸€ä¸ª 8 å­—èŠ‚çš„å•è°ƒé€’å¢æ•´æ•°ï¼Œç”¨æ¥æ ‡è¯†äº‹åŠ¡å†™å…¥ redo log çš„å­—èŠ‚æ€»é‡ï¼Œå­˜åœ¨äº redo logã€æ•°æ®é¡µå¤´éƒ¨å’Œ checkpoint ä¸­ã€‚ â€”-è¿™éƒ¨åˆ†æ˜¯å¸®åŠ©ç†è§£ startï¼Œé¢è¯•ä¸­å¯ä¸èƒŒâ€”-MySQL åœ¨ç¬¬ä¸€æ¬¡å¯åŠ¨æ—¶ï¼ŒLSN çš„åˆå§‹å€¼å¹¶ä¸ä¸º 0ï¼Œè€Œæ˜¯ 8704ï¼›å½“ MySQL å†æ¬¡å¯åŠ¨æ—¶ï¼Œä¼šç»§ç»­ä½¿ç”¨ä¸Šä¸€æ¬¡æœåŠ¡åœæ­¢æ—¶çš„ LSNã€‚ åœ¨è®¡ç®— LSN çš„å¢é‡æ—¶ï¼Œä¸ä»…éœ€è¦è€ƒè™‘ log block body çš„å¤§å°ï¼Œè¿˜éœ€è¦è€ƒè™‘ log block header å’Œ log block tail ä¸­éƒ¨åˆ†å­—èŠ‚æ•°ã€‚ æ¯”å¦‚è¯´åœ¨ä¸Šå›¾ä¸­ï¼Œäº‹åŠ¡ 3 çš„ MTR æ€»é‡ä¸º 300 å­—èŠ‚ï¼Œé‚£ä¹ˆå†™å…¥åˆ° Redo Log Buffer ä¸­çš„ LSN ä¼šå¢é•¿ä¸º 8704 + 300 + 12 9016ã€‚ å‡å¦‚äº‹åŠ¡ 4 çš„ MTR æ€»é‡ä¸º 900 å­—èŠ‚ï¼Œé‚£ä¹ˆå†æ¬¡å†™å…¥åˆ° Redo Log Buffer ä¸­çš„ LSN ä¼šå¢é•¿ä¸º 9016 + 900 + 122 + 42 9948ã€‚ 2 ä¸ª 12 å­—èŠ‚çš„ log block header + 2 ä¸ª 4 å­—èŠ‚çš„ log block tailã€‚ â€”-è¿™éƒ¨åˆ†æ˜¯å¸®åŠ©ç†è§£ endï¼Œé¢è¯•ä¸­å¯ä¸èƒŒâ€”- æ ¸å¿ƒä½œç”¨æœ‰ä¸‰ä¸ªï¼š ç¬¬ä¸€ï¼Œredo log æŒ‰ç…§ LSN é€’å¢é¡ºåºè®°å½•æ‰€æœ‰æ•°æ®çš„ä¿®æ”¹æ“ä½œã€‚LSN çš„é€’å¢é‡ç­‰äºæ¯æ¬¡å†™å…¥æ—¥å¿—çš„å­—èŠ‚æ•°ã€‚ ç¬¬äºŒï¼ŒInnoDB çš„æ¯ä¸ªæ•°æ®é¡µå¤´éƒ¨ä¸­ï¼Œéƒ½ä¼šè®°å½•è¯¥é¡µæœ€åä¸€æ¬¡åˆ·æ–°åˆ°ç£ç›˜æ—¶çš„ LSNã€‚å¦‚æœæ•°æ®é¡µçš„ LSN å°äº redo log çš„ LSNï¼Œè¯´æ˜è¯¥é¡µéœ€è¦ä»æ—¥å¿—ä¸­æ¢å¤ï¼›å¦åˆ™è¯´æ˜è¯¥é¡µå·²æ›´æ–°ã€‚ ç¬¬ä¸‰ï¼Œcheckpoint é€šè¿‡ LSN è®°å½•å·²åˆ·æ–°åˆ°ç£ç›˜çš„æ•°æ®é¡µä½ç½®ï¼Œå‡å°‘æ¢å¤æ—¶éœ€è¦å¤„ç†çš„æ—¥å¿—ã€‚ â€”-è¿™éƒ¨åˆ†æ˜¯å¸®åŠ©ç†è§£ startï¼Œé¢è¯•ä¸­å¯ä¸èƒŒâ€”- å¯ä»¥é€šè¿‡ show engine innodb status; æŸ¥çœ‹å½“å‰çš„ LSN ä¿¡æ¯ã€‚ Log sequence numberï¼šå½“å‰ç³»ç»Ÿæœ€å¤§ LSNï¼ˆå·²ç”Ÿæˆçš„æ—¥å¿—æ€»é‡ï¼‰ã€‚ Log flushed up toï¼šå·²å†™å…¥ç£ç›˜çš„ redo log LSNã€‚ Pages flushed up toï¼šå·²åˆ·æ–°åˆ°æ•°æ®é¡µçš„ LSNã€‚ Last checkpoint atï¼šæœ€åä¸€æ¬¡æ£€æŸ¥ç‚¹çš„ LSNï¼Œè¡¨ç¤ºå·²æŒä¹…åŒ–çš„æ•°æ®çŠ¶æ€ã€‚ â€”-è¿™éƒ¨åˆ†æ˜¯å¸®åŠ©ç†è§£ endï¼Œé¢è¯•ä¸­å¯ä¸èƒŒâ€”- Checkpoint äº†è§£å¤šå°‘ï¼ŸCheckpoint æ˜¯ InnoDB ä¸ºäº†ä¿è¯äº‹åŠ¡æŒä¹…æ€§å’Œå›æ”¶ redo log ç©ºé—´çš„ä¸€ç§æœºåˆ¶ã€‚ å®ƒçš„ä½œç”¨æ˜¯åœ¨åˆé€‚çš„æ—¶æœºå°†éƒ¨åˆ†è„é¡µåˆ·å…¥ç£ç›˜ï¼Œæ¯”å¦‚è¯´ buffer pool çš„å®¹é‡ä¸è¶³æ—¶ã€‚å¹¶è®°å½•å½“å‰ LSN ä¸º Checkpoint LSNï¼Œè¡¨ç¤ºè¿™ä¸ªä½ç½®ä¹‹å‰çš„ redo log file å·²ç»å®‰å…¨ï¼Œå¯ä»¥è¢«è¦†ç›–äº†ã€‚ MySQL å´©æºƒæ¢å¤æ—¶åªéœ€è¦ä» Checkpoint ä¹‹åå¼€å§‹æ¢å¤ redo log å°±å¯ä»¥äº†ï¼Œè¿™æ ·å¯ä»¥æœ€å¤§ç¨‹åº¦å‡å°‘æ¢å¤æ‰€èŠ±è´¹çš„æ—¶é—´ã€‚ redo log file çš„å†™å…¥æ˜¯å¾ªç¯çš„ï¼Œå…¶ä¸­æœ‰ä¸¤ä¸ªæ ‡è®°ä½ç½®éå¸¸é‡è¦ï¼Œä¹Ÿå°±æ˜¯ Checkpoint å’Œ write posã€‚ write pos æ˜¯ redo log å½“å‰å†™å…¥çš„ä½ç½®ï¼ŒCheckpoint æ˜¯å¯ä»¥è¢«è¦†ç›–çš„ä½ç½®ã€‚ å½“ write pos è¿½ä¸Š Checkpoint æ—¶ï¼Œè¡¨ç¤º redo log æ—¥å¿—å·²ç»å†™æ»¡ã€‚è¿™æ—¶å€™å°±è¦æš‚åœå†™å…¥å¹¶å¼ºåˆ¶åˆ·ç›˜ï¼Œé‡Šæ”¾å¯è¦†å†™çš„æ—¥å¿—ç©ºé—´ã€‚ å…³äºredo log çš„è°ƒä¼˜å‚æ•°äº†è§£å¤šå°‘ï¼Ÿå¦‚æœæ˜¯é«˜å¹¶å‘å†™å…¥çš„ç”µå•†ç³»ç»Ÿï¼Œå¯ä»¥æœ€å¤§åŒ–å†™å…¥ååé‡ï¼Œå®¹å¿ç§’çº§æ•°æ®ä¸¢å¤±çš„é£é™©ã€‚ innodb_flush_log_at_trx_commit = 2sync_binlog = 1000innodb_redo_log_capacity = 64Ginnodb_io_capacity = 5000innodb_lru_scan_depth = 512innodb_log_buffer_size = 256M å¦‚æœæ˜¯é‡‘èäº¤æ˜“ç³»ç»Ÿï¼Œéœ€è¦ä¿è¯æ•°æ®é›¶ä¸¢å¤±ï¼Œæ¥å—è¾ƒä½çš„ååé‡ã€‚ innodb_flush_log_at_trx_commit = 1sync_binlog = 1innodb_redo_log_capacity = 32Ginnodb_io_capacity = 2000innodb_lru_scan_depth = 1024 æ ¸å¿ƒå‚æ•°ä¸€è§ˆè¡¨: æ€»ç»“ å¯¹æ•°æ®ä¸€è‡´æ€§è¦æ±‚é«˜çš„åœºæ™¯ï¼Œå¦‚é‡‘èäº¤æ˜“ä½¿ç”¨innodb_flush_log_at_trx_commit1ï¼Œå¯¹å†™å…¥ååé‡æ•æ„Ÿçš„åœºæ™¯ï¼Œå¦‚æ—¥å¿—é‡‡é›†å¯ä»¥ä½¿ç”¨ 2 æˆ– 0ï¼Œéœ€è¦ç»“åˆ sync_binlog å‚æ•° sync_binlog å‚æ•°æ§åˆ¶ binlog çš„åˆ·ç›˜ç­–ç•¥ï¼Œå¯ä»¥è®¾ç½®ä¸º 0ã€1ã€Nï¼Œ0 è¡¨ç¤ºä¾èµ–ç³»ç»Ÿåˆ·ç›˜ï¼Œ1 è¡¨ç¤ºæ¯æ¬¡äº‹åŠ¡æäº¤éƒ½åˆ·ç›˜ï¼ˆæ¨èä¸ innodb_flush_log_at_trx_commit1 æ­é…ï¼‰ï¼ŒN1000 è¡¨ç¤ºç´¯è®¡ 1000 æ¬¡äº‹åŠ¡ååˆ·ç›˜ innodb_redo_log_capacity åŠ¨æ€è°ƒæ•´ Redo Log æ€»å®¹é‡ï¼Œå¯ä»¥æ ¹æ®ä¸šåŠ¡è´Ÿè½½æƒ…å†µè°ƒæ•´ï¼Œå»ºè®®è®¾ç½®ä¸º 1 å°æ—¶å†™å…¥é‡çš„å³°å€¼ï¼ˆå¦‚æ¯ç§’ 10MB å†™å…¥åˆ™è®¾ä¸º 36GBï¼‰ innodb_io_capacity å®šä¹‰ InnoDB åå°çº¿ç¨‹çš„æ¯ç§’ IO æ“ä½œä¸Šé™ï¼Œç›´æ¥å½±å“è„é¡µåˆ·æ–°é€Ÿç‡ï¼›æœºæ¢°ç¡¬ç›˜å»ºè®® 200-500ï¼ŒSSD å»ºè®® 1000-2000ï¼ŒNVMe SSD å¯è®¾ä¸º 5000+ innodb_lru_scan_depth æ§åˆ¶æ¯ä¸ªç¼“å†²æ± å®ä¾‹ä¸­ LRU åˆ—è¡¨çš„æ‰«ææ·±åº¦ï¼Œå†³å®šæ¯ç§’å¯åˆ·æ–°çš„è„é¡µæ•°é‡ï¼Œé»˜è®¤å€¼ 1024 é€‚ç”¨äºå¤šæ•°åœºæ™¯ï¼ŒIO å¯†é›†å‹è´Ÿè½½å¯é€‚å½“é™ä½ï¼ˆå¦‚ 512ï¼‰ï¼Œå‡å°‘ CPU å¼€é”€ã€‚ SQLä¼˜åŒ–ğŸŒŸ32.ä»€ä¹ˆæ˜¯æ…¢ SQLï¼Ÿæ‹“å±•é˜…è¯»: https://juejin.cn/post/7048974570228809741MySQL ä¸­æœ‰ä¸€ä¸ªå«long_query_timeçš„å‚æ•°ï¼ŒåŸåˆ™ä¸Šæ‰§è¡Œæ—¶é—´è¶…è¿‡è¯¥å‚æ•°å€¼çš„ SQL å°±æ˜¯æ…¢ SQLï¼Œä¼šè¢«è®°å½•åˆ°æ…¢æŸ¥è¯¢æ—¥å¿—ä¸­ã€‚ â€”-è¿™éƒ¨åˆ†æ˜¯å¸®åŠ©ç†è§£ startï¼Œé¢è¯•ä¸­å¯ä¸èƒŒâ€”- å¯é€šè¿‡ show variables like â€˜long_query_timeâ€™; æŸ¥çœ‹å½“å‰çš„ long_query_time çš„å‚æ•°å€¼ã€‚â€”-è¿™éƒ¨åˆ†æ˜¯å¸®åŠ©ç†è§£ endï¼Œé¢è¯•ä¸­å¯ä¸èƒŒâ€”- SQL çš„æ‰§è¡Œè¿‡ç¨‹äº†è§£å—ï¼ŸSQL çš„æ‰§è¡Œè¿‡ç¨‹å¤§è‡´å¯ä»¥åˆ†ä¸ºå…­ä¸ªé˜¶æ®µï¼šè¿æ¥ç®¡ç†ã€è¯­æ³•è§£æã€è¯­ä¹‰åˆ†æã€æŸ¥è¯¢ä¼˜åŒ–ã€æ‰§è¡Œå™¨è°ƒåº¦ã€å­˜å‚¨å¼•æ“è¯»å†™ç­‰ã€‚Server å±‚è´Ÿè´£ç†è§£å’Œè§„åˆ’ SQL æ€ä¹ˆæ‰§è¡Œï¼Œå­˜å‚¨å¼•æ“å±‚è´Ÿè´£æ•°æ®çš„çœŸæ­£è¯»å†™ã€‚ â€”-è¿™éƒ¨åˆ†æ˜¯å¸®åŠ©ç†è§£ startï¼Œé¢è¯•ä¸­å¯ä¸èƒŒâ€”- æ¥è¯¦ç»†æ‹†è§£ä¸€ä¸‹ï¼š å®¢æˆ·ç«¯å‘é€ SQL è¯­å¥ç»™ MySQL æœåŠ¡å™¨ã€‚ å¦‚æœæŸ¥è¯¢ç¼“å­˜æ‰“å¼€åˆ™ä¼šä¼˜å…ˆæŸ¥è¯¢ç¼“å­˜ï¼Œç¼“å­˜ä¸­æœ‰å¯¹åº”çš„ç»“æœå°±ç›´æ¥è¿”å›ã€‚ä¸è¿‡ï¼ŒMySQL 8.0 å·²ç»ç§»é™¤äº†æŸ¥è¯¢ç¼“å­˜ã€‚è¿™éƒ¨åˆ†çš„åŠŸèƒ½æ­£åœ¨è¢« Redis ç­‰ç¼“å­˜ä¸­é—´ä»¶å–ä»£ã€‚ åˆ†æå™¨å¯¹ SQL è¯­å¥è¿›è¡Œè¯­æ³•åˆ†æï¼Œåˆ¤æ–­æ˜¯å¦æœ‰è¯­æ³•é”™è¯¯ã€‚ ææ¸…æ¥š SQL è¯­å¥è¦å¹²å˜›åï¼ŒMySQL ä¼šé€šè¿‡ä¼˜åŒ–å™¨ç”Ÿæˆæ‰§è¡Œè®¡åˆ’ã€‚ æ‰§è¡Œå™¨è°ƒç”¨å­˜å‚¨å¼•æ“çš„æ¥å£ï¼Œæ‰§è¡Œ SQL è¯­å¥ã€‚ SQL æ‰§è¡Œè¿‡ç¨‹ä¸­ï¼Œä¼˜åŒ–å™¨é€šè¿‡æˆæœ¬è®¡ç®—é¢„ä¼°å‡ºæ‰§è¡Œæ•ˆç‡æœ€é«˜çš„æ–¹å¼ï¼ŒåŸºæœ¬çš„é¢„ä¼°ç»´åº¦ä¸ºï¼š IO æˆæœ¬ï¼šä»ç£ç›˜è¯»å–æ•°æ®åˆ°å†…å­˜çš„å¼€é”€ã€‚ CPU æˆæœ¬ï¼šCPU å¤„ç†å†…å­˜ä¸­æ•°æ®çš„å¼€é”€ã€‚ åŸºäºè¿™ä¸¤ä¸ªç»´åº¦ï¼Œå¯ä»¥å¾—å‡ºå½±å“ SQL æ‰§è¡Œæ•ˆç‡çš„å› ç´ æœ‰ï¼š â‘ ã€IO æˆæœ¬ï¼Œæ•°æ®é‡è¶Šå¤§ï¼ŒIO æˆæœ¬è¶Šé«˜ã€‚æ‰€ä»¥è¦å°½é‡æŸ¥è¯¢å¿…è¦çš„å­—æ®µï¼›å°½é‡åˆ†é¡µæŸ¥è¯¢ï¼›å°½é‡é€šè¿‡ç´¢å¼•åŠ å¿«æŸ¥è¯¢ã€‚ â‘¡ã€CPU æˆæœ¬ï¼Œå°½é‡é¿å…å¤æ‚çš„æŸ¥è¯¢æ¡ä»¶ï¼Œå¦‚æœ‰å¿…è¦ï¼Œè€ƒè™‘å¯¹å­æŸ¥è¯¢ç»“æœè¿›è¡Œè¿‡æ»¤ã€‚ â€”-è¿™éƒ¨åˆ†æ˜¯å¸®åŠ©ç†è§£ endï¼Œé¢è¯•ä¸­å¯ä¸èƒŒâ€”- å¦‚ä½•ä¼˜åŒ–æ…¢SQL?é¦–å…ˆï¼Œéœ€è¦æ‰¾åˆ°é‚£äº›æ¯”è¾ƒæ…¢çš„ SQLï¼Œå¯ä»¥é€šè¿‡å¯ç”¨æ…¢æŸ¥è¯¢æ—¥å¿—ï¼Œè®°å½•é‚£äº›è¶…è¿‡æŒ‡å®šæ‰§è¡Œæ—¶é—´çš„ SQL æŸ¥è¯¢ã€‚ ä¹Ÿå¯ä»¥ä½¿ç”¨ show processlist; å‘½ä»¤æŸ¥çœ‹å½“å‰æ­£åœ¨æ‰§è¡Œçš„ SQL è¯­å¥ï¼Œæ‰¾å‡ºæ‰§è¡Œæ—¶é—´è¾ƒé•¿çš„ SQLã€‚ æˆ–è€…åœ¨ä¸šåŠ¡åŸºå»ºä¸­åŠ å…¥å¯¹æ…¢ SQL çš„ç›‘æ§ï¼Œå¸¸è§çš„æ–¹æ¡ˆæœ‰å­—èŠ‚ç æ’æ¡©ã€è¿æ¥æ± æ‰©å±•ã€ORM æ¡†æ¶æ‰©å±•ç­‰ã€‚ ç„¶åï¼Œä½¿ç”¨ EXPLAIN æŸ¥çœ‹æ…¢ SQL çš„æ‰§è¡Œè®¡åˆ’ï¼Œçœ‹çœ‹æœ‰æ²¡æœ‰ç”¨ç´¢å¼•ï¼Œå¤§éƒ¨åˆ†æƒ…å†µä¸‹ï¼Œæ…¢ SQL çš„åŸå› éƒ½æ˜¯å› ä¸ºæ²¡æœ‰ç”¨åˆ°ç´¢å¼•ã€‚ EXPLAIN SELECT * FROM your_table WHERE conditions;æœ€åï¼Œæ ¹æ®åˆ†æç»“æœï¼Œé€šè¿‡æ·»åŠ ç´¢å¼•ã€ä¼˜åŒ–æŸ¥è¯¢æ¡ä»¶ã€å‡å°‘è¿”å›å­—æ®µç­‰æ–¹å¼è¿›è¡Œä¼˜åŒ–ã€‚ æ…¢sqlæ—¥å¿—æ€ä¹ˆå¼€å¯ï¼Ÿç¼–è¾‘ MySQL çš„é…ç½®æ–‡ä»¶ my.cnfï¼Œè®¾ç½® slow_query_log å‚æ•°ä¸º 1ã€‚ slow_query_log = 1slow_query_log_file = /var/log/mysql/slow.loglong_query_time = 2 # è®°å½•æ‰§è¡Œæ—¶é—´è¶…è¿‡2ç§’çš„æŸ¥è¯¢ ç„¶åé‡å¯ MySQL å°±å¥½äº†ã€‚ ä¹Ÿå¯ä»¥é€šè¿‡ set global å‘½ä»¤åŠ¨æ€è®¾ç½®ã€‚ SET GLOBAL slow_query_log = ON;SET GLOBAL slow_query_log_file = /var/log/mysql/slow.log;SET GLOBAL long_query_time = 2; ğŸŒŸ33.ä½ çŸ¥é“å“ªäº›æ–¹æ³•æ¥ä¼˜åŒ– SQLï¼ŸSQL ä¼˜åŒ–çš„æ–¹æ³•éå¸¸å¤šï¼Œä½†æœ¬è´¨ä¸Šå°±ä¸€å¥è¯ï¼šå°½å¯èƒ½å°‘åœ°æ‰«æã€å°½å¿«åœ°è¿”å›ç»“æœã€‚æœ€å¸¸è§çš„åšæ³•å°±æ˜¯åŠ ç´¢å¼•ã€æ”¹å†™ SQL è®©å®ƒç”¨ä¸Šç´¢å¼•ï¼Œæ¯”å¦‚è¯´ä½¿ç”¨è¦†ç›–ç´¢å¼•ã€è®©è”åˆç´¢å¼•éµå®ˆæœ€å·¦å‰ç¼€åŸåˆ™ç­‰ã€‚ å¦‚ä½•åˆ©ç”¨è¦†ç›–ç´¢å¼•ï¼Ÿè¦†ç›–ç´¢å¼•çš„æ ¸å¿ƒæ˜¯â€œæŸ¥è¯¢æ‰€éœ€çš„å­—æ®µéƒ½åœ¨åŒä¸€ä¸ªç´¢å¼•é‡Œâ€ï¼Œè¿™æ · MySQL å°±ä¸éœ€è¦å›è¡¨ï¼Œç›´æ¥ä»ç´¢å¼•ä¸­è¿”å›ç»“æœã€‚ å®é™…ä½¿ç”¨ä¸­ï¼Œæˆ‘ä¼šä¼˜å…ˆè€ƒè™‘æŠŠ WHERE å’Œ SELECT æ¶‰åŠçš„å­—æ®µä¸€èµ·å»ºè”åˆç´¢å¼•ï¼Œå¹¶é€šè¿‡ EXPLAIN è§‚å¯Ÿç»“æœæ˜¯å¦æœ‰ Using indexï¼Œç¡®è®¤å‘½ä¸­ç´¢å¼•ã€‚ â€”-è¿™éƒ¨åˆ†æ˜¯å¸®åŠ©ç†è§£ startï¼Œé¢è¯•ä¸­å¯ä¸èƒŒâ€”- ä¸¾ä¸ªä¾‹å­ï¼Œç°åœ¨è¦ä» test è¡¨ä¸­æŸ¥è¯¢ city ä¸ºä¸Šæµ·çš„ name å­—æ®µã€‚ select name from test where city=ä¸Šæµ· å¦‚æœä»…åœ¨ city å­—æ®µä¸Šæ·»åŠ ç´¢å¼•ï¼Œé‚£ä¹ˆè¿™æ¡æŸ¥è¯¢è¯­å¥ä¼šå…ˆé€šè¿‡ç´¢å¼•æ‰¾åˆ° city ä¸ºä¸Šæµ·çš„è¡Œï¼Œç„¶åå†å›è¡¨æŸ¥è¯¢ name å­—æ®µã€‚ ä¸ºäº†é¿å…å›è¡¨æŸ¥è¯¢ï¼Œå¯ä»¥åœ¨ city å’Œ name å­—æ®µä¸Šå»ºç«‹è”åˆç´¢å¼•ï¼Œè¿™æ ·æŸ¥è¯¢ç»“æœå°±å¯ä»¥ç›´æ¥ä»ç´¢å¼•ä¸­è·å–ã€‚ alter table test add index index1(city,name); ç›¸å½“äºåˆ©ç”¨ç©ºé—´æ¢æ—¶é—´,æŠŠæŸ¥è¯¢ç»“æœéƒ½æ”¾åˆ°äº†ç´¢å¼•é‡Œ,ä¸éœ€è¦å›è¡¨æŸ¥è¯¢ã€‚â€”-è¿™éƒ¨åˆ†æ˜¯å¸®åŠ©ç†è§£ endï¼Œé¢è¯•ä¸­å¯ä¸èƒŒâ€”- å¦‚ä½•æ­£ç¡®ä½¿ç”¨è”åˆç´¢å¼•ï¼Ÿä½¿ç”¨è”åˆç´¢å¼•æœ€é‡è¦çš„ä¸€æ¡æ˜¯éµå®ˆæœ€å·¦å‰ç¼€åŸåˆ™ï¼Œä¹Ÿå°±æ˜¯æŸ¥è¯¢æ¡ä»¶éœ€è¦ä»ç´¢å¼•çš„å·¦ä¾§å­—æ®µå¼€å§‹ã€‚ â€”-è¿™éƒ¨åˆ†æ˜¯å¸®åŠ©ç†è§£ startï¼Œé¢è¯•ä¸­å¯ä¸èƒŒâ€”-æ¯”å¦‚è¯´æˆ‘ä»¬åˆ›å»ºäº†ä¸€ä¸ªä¸‰åˆ—çš„è”åˆç´¢å¼•ã€‚ CREATE INDEX idx_name_age_sex ON user(name, age, sex); æˆ‘ä»¬æ¥çœ‹ä¸€ä¸‹ä»€ä¹ˆæ ·çš„æŸ¥è¯¢æ¡ä»¶å¯ä»¥ç”¨åˆ°è¿™ä¸ªç´¢å¼•ï¼šâ€”-è¿™éƒ¨åˆ†æ˜¯å¸®åŠ©ç†è§£ endï¼Œé¢è¯•ä¸­å¯ä¸èƒŒâ€”- å¦‚ä½•è¿›è¡Œåˆ†é¡µä¼˜åŒ–ï¼Ÿåˆ†é¡µä¼˜åŒ–çš„æ ¸å¿ƒæ˜¯é¿å…æ·±åº¦åç§»(Deep Offset)å¸¦æ¥çš„å…¨è¡¨æ‰«æï¼Œå¯ä»¥é€šè¿‡ä¸¤ç§æ–¹å¼æ¥ä¼˜åŒ–ï¼šå»¶è¿Ÿå…³è”å’Œæ·»åŠ ä¹¦ç­¾ã€‚ å»¶è¿Ÿå…³è”é€‚ç”¨äºéœ€è¦ä»å¤šä¸ªè¡¨ä¸­è·å–æ•°æ®ä¸”ä¸»è¡¨è¡Œæ•°è¾ƒå¤šçš„æƒ…å†µã€‚å®ƒé¦–å…ˆä»ç´¢å¼•è¡¨ä¸­æ£€ç´¢å‡ºéœ€è¦çš„è¡Œ IDï¼Œç„¶åå†æ ¹æ®è¿™äº› ID å»å…³è”å…¶ä»–çš„è¡¨è·å–è¯¦ç»†ä¿¡æ¯ã€‚ SELECT e.id, e.name, d.detailsFROM employees eJOIN department d ON e.department_id = d.idORDER BY e.idLIMIT 1000, 20; å»¶è¿Ÿå…³è”åï¼Œç¬¬ä¸€æ­¥åªæŸ¥ä¸»é”®ï¼Œé€Ÿåº¦å¿«ï¼Œç¬¬äºŒæ­¥åªå¤„ç† 20 æ¡æ•°æ®ï¼Œæ•ˆç‡é«˜ã€‚ SELECT e.id, e.name, d.detailsFROM ( SELECT id FROM employees ORDER BY id LIMIT 1000, 20) AS subJOIN employees e ON sub.id = e.idJOIN department d ON e.department_id = d.id; æ·»åŠ ä¹¦ç­¾çš„æ–¹å¼æ˜¯é€šè¿‡è®°ä½ä¸Šä¸€æ¬¡æŸ¥è¯¢è¿”å›çš„æœ€åä¸€è¡Œä¸»é”®å€¼ï¼Œç„¶ååœ¨ä¸‹ä¸€æ¬¡æŸ¥è¯¢çš„æ—¶å€™ä»è¿™ä¸ªå€¼å¼€å§‹ï¼Œä»è€Œè·³è¿‡åç§»é‡è®¡ç®—ï¼Œä»…æ‰«æç›®æ ‡æ•°æ®ï¼Œé€‚åˆç¿»é¡µã€èµ„è®¯æµç­‰åœºæ™¯ã€‚ å‡è®¾éœ€è¦å¯¹ç”¨æˆ·è¡¨è¿›è¡Œåˆ†é¡µã€‚ SELECT id, nameFROM usersORDER BY idLIMIT 1000, 20; é€šè¿‡æ·»åŠ ä¹¦ç­¾æ¥ä¼˜åŒ–åï¼ŒæŸ¥è¯¢ä¸å†ä½¿ç”¨OFFSETï¼Œè€Œæ˜¯ä»ä¸Šä¸€é¡µæœ€åä¸€ä¸ªç”¨æˆ·çš„ ID å¼€å§‹æŸ¥è¯¢ã€‚è¿™ç§æ–¹æ³•å¯ä»¥æœ‰æ•ˆé¿å…ä¸å¿…è¦çš„æ•°æ®æ‰«æï¼Œæé«˜äº†åˆ†é¡µæŸ¥è¯¢çš„æ•ˆç‡ã€‚ SELECT id, nameFROM usersWHERE id last_max_id -- å‡è®¾last_max_idæ˜¯ä¸Šä¸€é¡µæœ€åä¸€è¡Œçš„IDORDER BY idLIMIT 20; ä¸ºä»€ä¹ˆåˆ†é¡µä¼šå˜æ…¢ï¼Ÿåˆ†é¡µæŸ¥è¯¢çš„æ•ˆç‡é—®é¢˜ä¸»è¦æ˜¯ç”±äº OFFSET çš„å­˜åœ¨ï¼ŒOFFSET ä¼šå¯¼è‡´ MySQL å¿…é¡»æ‰«æå’Œè·³è¿‡ offset + limit æ¡æ•°æ®ï¼Œè¿™ä¸ªè¿‡ç¨‹æ˜¯éå¸¸è€—æ—¶çš„ã€‚ æ¯”å¦‚è¯´ï¼Œæˆ‘ä»¬è¦æŸ¥è¯¢ç¬¬ 100000 æ¡æ•°æ®ï¼Œé‚£ä¹ˆ MySQL å°±å¿…é¡»æ‰«æ 100000 æ¡æ•°æ®ï¼Œç„¶åå†è¿”å› 10 æ¡æ•°æ®ã€‚ SELECT * FROM user ORDER BY id LIMIT 100000, 10; æ•°æ®è¶Šå¤šã€åç§»è¶Šå¤§ï¼Œå°±è¶Šæ…¢ï¼ JOIN ä»£æ›¿å­æŸ¥è¯¢æœ‰ä»€ä¹ˆå¥½å¤„ï¼Ÿç¬¬ä¸€ï¼ŒJOIN çš„ ON æ¡ä»¶èƒ½æ›´ç›´æ¥åœ°è§¦å‘ç´¢å¼•ï¼Œè€Œå­æŸ¥è¯¢å¯èƒ½å› åµŒå¥—å¯¼è‡´ç´¢å¼•å¤±æ•ˆã€‚ç¬¬äºŒï¼ŒJOIN çš„ä¸€æ¬¡è¿æ¥æ“ä½œæ›¿ä»£äº†å­æŸ¥è¯¢çš„å¤šæ¬¡é‡å¤æ‰§è¡Œï¼Œå°¤å…¶åœ¨å¤§æ•°æ®é‡çš„æƒ…å†µä¸‹æ€§èƒ½å·®å¼‚æ˜æ˜¾ã€‚ â€”-è¿™éƒ¨åˆ†æ˜¯å¸®åŠ©ç†è§£ startï¼Œé¢è¯•ä¸­å¯ä¸èƒŒâ€”- æ¯”å¦‚è¯´æˆ‘ä»¬æœ‰ä¸¤ä¸ªè¡¨ orders å’Œ customersã€‚ CREATE TABLE orders ( order_id INT PRIMARY KEY, customer_id INT, amount DECIMAL(10,2), INDEX idx_customer_id (customer_id) -- customer_idå­—æ®µæœ‰ç´¢å¼•);CREATE TABLE customers ( customer_id INT PRIMARY KEY, name VARCHAR(100)); å­æŸ¥è¯¢çš„å†™æ³•ï¼š SELECT o.order_id, o.amount, (SELECT c.name FROM customers c WHERE c.customer_id = o.customer_id) AS customer_nameFROM orders o; JOIN çš„å†™æ³•ï¼š SELECT o.order_id, o.amount, c.name AS customer_nameFROM orders oJOIN customers c ON o.customer_id = c.customer_id; å¯¹äºå­æŸ¥è¯¢ï¼Œæ‰§è¡Œæµç¨‹æ˜¯è¿™æ ·çš„ï¼š å¤–å±‚ orders è¡¨çš„æ¯ä¸€è¡Œéƒ½ä¼šè§¦å‘ä¸€æ¬¡å­æŸ¥è¯¢ã€‚ å¦‚æœ orders è¡¨æœ‰ 1000 æ¡è®°å½•ï¼Œåˆ™å­æŸ¥è¯¢ä¼šæ‰§è¡Œ 1000 æ¬¡ã€‚ æ¯æ¬¡å­æŸ¥è¯¢éƒ½éœ€è¦å•ç‹¬æŸ¥è¯¢ customers è¡¨ï¼ˆå³ä½¿ customer_id ç›¸åŒï¼‰ã€‚ è€Œ JOIN çš„æ‰§è¡Œæµç¨‹æ˜¯è¿™æ ·çš„ï¼š æ•°æ®åº“ä¼˜åŒ–å™¨ä¼šå°†ä¸¤å¼ è¡¨çš„è¿æ¥æ“ä½œåˆå¹¶ä¸ºä¸€æ¬¡æ‰§è¡Œã€‚ é€šè¿‡ç´¢å¼•ï¼ˆå¦‚ orders.customer_id å’Œ customers.customer_idï¼‰å¿«é€Ÿå…³è”æ•°æ®ã€‚ ä»…æ‰§è¡Œä¸€æ¬¡å…³è”æ“ä½œï¼Œè€Œéå¤šæ¬¡å­æŸ¥è¯¢ã€‚æ¥çœ‹ä¸€ä¸‹å­æŸ¥è¯¢çš„æ‰§è¡Œè®¡åˆ’ï¼šEXPLAIN SELECT o.order_id, (SELECT c.name FROM customers c WHERE c.customer_id = o.customer_id) FROM orders o; å­æŸ¥è¯¢ï¼ˆDEPENDENT SUBQUERYï¼‰ç±»å‹è¡¨æ˜å…¶ä¾èµ–å¤–å±‚æŸ¥è¯¢çš„æ¯ä¸€è¡Œï¼Œå¯¼è‡´é‡å¤æ‰§è¡Œã€‚ å†å¯¹æ¯”çœ‹ä¸€ä¸‹ JOIN çš„æ‰§è¡Œè®¡åˆ’ï¼š EXPLAIN SELECT o.order_id, (SELECT c.name FROM customers c WHERE c.customer_id = o.customer_id) FROM orders o; JOIN é€šè¿‡ eq_ref ç±»å‹ç›´æ¥åˆ©ç”¨ä¸»é”®ï¼ˆcustomers.customer_idï¼‰å¿«é€Ÿå…³è”ï¼Œå‡å°‘æ‰«ææ¬¡æ•°ã€‚ JOINæ“ä½œä¸ºä»€ä¹ˆè¦å°è¡¨é©±åŠ¨å¤§è¡¨ï¼Ÿ ç¬¬ä¸€ï¼Œå¦‚æœå¤§è¡¨çš„ JOIN å­—æ®µæœ‰ç´¢å¼•ï¼Œé‚£ä¹ˆå°è¡¨çš„æ¯ä¸€è¡Œéƒ½å¯ä»¥é€šè¿‡ç´¢å¼•å¿«é€ŸåŒ¹é…å¤§è¡¨ã€‚æ—¶é—´å¤æ‚åº¦ä¸º**å°è¡¨è¡Œæ•° N ä¹˜ä»¥å¤§è¡¨ç´¢å¼•æŸ¥æ‰¾å¤æ‚åº¦ log(å¤§è¡¨è¡Œæ•° M)**ï¼Œæ€»å¤æ‚åº¦ä¸º N*log(M)ã€‚æ˜¾ç„¶å°è¡¨åšé©±åŠ¨è¡¨æ¯”å¤§è¡¨åšé©±åŠ¨è¡¨çš„æ—¶é—´å¤æ‚åº¦ M*log(N) æ›´ä½ã€‚ ç¬¬äºŒï¼Œå¦‚æœå¤§è¡¨æ²¡æœ‰ç´¢å¼•ï¼Œéœ€è¦å°†å°è¡¨çš„æ•°æ®åŠ è½½åˆ°å†…å­˜ï¼Œå†å…¨è¡¨æ‰«æå¤§è¡¨è¿›è¡ŒåŒ¹é…ã€‚æ—¶é—´å¤æ‚åº¦ä¸ºå°è¡¨åˆ†æ®µæ•° K ä¹˜ä»¥å¤§è¡¨è¡Œæ•° Mï¼Œå…¶ä¸­ K å°è¡¨è¡Œæ•° N å†…å­˜å¤§å° join_buffer_sizeã€‚æ˜¾ç„¶å°è¡¨åšé©±åŠ¨è¡¨çš„æ—¶å€™ K çš„å€¼æ›´å°ï¼Œå¤§è¡¨åšé©±åŠ¨è¡¨çš„æ—¶å€™éœ€è¦å¤šæ¬¡åˆ†æ®µã€‚ -- å°è¡¨é©±åŠ¨ï¼ˆé«˜æ•ˆï¼‰SELECT * FROM small_table sJOIN large_table l ON s.id = l.id; -- l.idæœ‰ç´¢å¼•-- å¤§è¡¨é©±åŠ¨ï¼ˆä½æ•ˆï¼‰SELECT * FROM large_table lJOIN small_table s ON l.id = s.id; -- s.idæ— ç´¢å¼• å½“ä½¿ç”¨ left join æ—¶ï¼Œå·¦è¡¨æ˜¯é©±åŠ¨è¡¨ï¼Œå³è¡¨æ˜¯è¢«é©±åŠ¨è¡¨ã€‚ å½“ä½¿ç”¨ right join æ—¶ï¼Œåˆšå¥½ç›¸åã€‚ å½“ä½¿ç”¨ join æ—¶ï¼ŒMySQL ä¼šé€‰æ‹©æ•°æ®é‡æ¯”è¾ƒå°çš„è¡¨ä½œä¸ºé©±åŠ¨è¡¨ï¼Œå¤§è¡¨ä½œä¸ºè¢«é©±åŠ¨è¡¨ã€‚ è¿™é‡Œçš„å°è¡¨æŒ‡å®é™…å‚ä¸ JOIN çš„æ•°æ®é‡ï¼Œè€Œä¸æ˜¯è¡¨çš„æ€»è¡Œæ•°ã€‚å¤§è¡¨ç»è¿‡ where æ¡ä»¶è¿‡æ»¤åä¹Ÿå¯èƒ½æˆä¸ºé€»è¾‘å°è¡¨ã€‚â€“ å®é™…å‚ä¸JOINçš„æ•°æ®é‡å†³å®šå°è¡¨ SELECT * FROM large_table lJOIN small_table s ON l.id = s.idWHERE l.created_at 2025-01-01; -- lç»è¿‡è¿‡æ»¤åå¯èƒ½æˆä¸ºå°è¡¨ ä¹Ÿå¯ä»¥å¼ºåˆ¶é€šè¿‡ STRAIGHT_JOIN æç¤º MySQL ä½¿ç”¨æŒ‡å®šçš„é©±åŠ¨è¡¨ã€‚ explain select table_1.col1, table_2.col2, table_3.col2from table_1straight_join table_2 on table_1.col1=table_2.col1straight_join table_3 on table_1.col1 = table_3.col1;explain select straight_join table_1.col1, table_2.col2, table_3.col2from table_1join table_2 on table_1.col1=table_2.col1join table_3 on table_1.col1 = table_3.col1; ä¸ºä»€ä¹ˆè¦é¿å…ä½¿ç”¨ JOIN å…³è”å¤ªå¤šçš„è¡¨ï¼Ÿç¬¬ä¸€ï¼Œå¤šè¡¨ JOIN çš„æ‰§è¡Œè·¯å¾„ä¼šéšç€è¡¨çš„æ•°é‡å‘ˆç°æŒ‡æ•°çº§å¢é•¿ï¼Œä¼˜åŒ–å™¨éœ€è¦ä¼°ç®—æ‰€æœ‰è·¯å¾„çš„æˆæœ¬ï¼Œæœ‰å¯èƒ½ä¼šå¯¼è‡´å‡ºç°å¤§è¡¨é©±åŠ¨å°è¡¨çš„æƒ…å†µã€‚ SELECT * FROM AJOIN B ON A.id = B.a_idJOIN C ON B.id = C.b_idJOIN D ON C.id = D.c_idJOIN E ON D.id = E.d_id; -- 5 ä¸ªè¡¨ï¼Œä¼˜åŒ–å™¨éœ€è¯„ä¼° 5! = 120 ç§é¡ºåº ç¬¬äºŒï¼Œå¤šè¡¨ JOIN éœ€è¦ç¼“å­˜ä¸­é—´ç»“æœé›†ï¼Œå¯èƒ½è¶…å‡º join_buffer_sizeï¼Œè¿™ç§æƒ…å†µä¸‹å†…å­˜ä¸´æ—¶è¡¨å°±ä¼šè½¬ä¸ºç£ç›˜ä¸´æ—¶è¡¨ï¼Œæ€§èƒ½ä¹Ÿä¼šæ€¥å‰§ä¸‹é™ã€‚ã€Šé˜¿é‡Œå·´å·´ Java å¼€å‘æ‰‹å†Œã€‹ä¸Šå°±è§„å®šï¼Œä¸è¦ä½¿ç”¨ join å…³è”å¤ªå¤šçš„è¡¨ï¼Œæœ€å¤šä¸è¦è¶…è¿‡ 3 å¼ è¡¨ã€‚ å¦‚ä½•è¿›è¡Œæ’åºä¼˜åŒ–ï¼Ÿç¬¬â¼€ï¼Œå¯¹ ORDER BY æ¶‰åŠçš„å­—æ®µåˆ›å»ºç´¢å¼•ï¼Œé¿å… filesortã€‚ -- ä¼˜åŒ–å‰ï¼ˆå¯èƒ½è§¦å‘ filesortï¼‰SELECT * FROM users ORDER BY age DESC;-- ä¼˜åŒ–åï¼ˆæ·»åŠ ç´¢å¼•ï¼‰ALTER TABLE users ADD INDEX idx_age (age); å¦‚æœæ˜¯å¤šä¸ªå­—æ®µï¼Œè”åˆç´¢å¼•éœ€è¦ä¿è¯ORDER BY çš„åˆ—æ˜¯ç´¢å¼•çš„æœ€å·¦å‰ç¼€ã€‚ -- è”åˆç´¢å¼•éœ€ä¸ ORDER BY é¡ºåºâ¼€è‡´ï¼ˆage åœ¨å‰ï¼Œname åœ¨åï¼‰ALTER TABLE users ADD INDEX idx_age_name (age, name);-- æœ‰æ•ˆåˆ©â½¤ç´¢å¼•çš„æŸ¥è¯¢SELECT * FROM users ORDER BY age, name;-- â½†æ•ˆæ¡ˆä¾‹ï¼ˆç´¢å¼•å¤±æ•ˆï¼Œå›  name åœ¨ç´¢å¼•ä¸­æ’åœ¨ age ä¹‹åï¼‰SELECT * FROM users ORDER BY name, age; ç¬¬â¼†ï¼Œå¯ä»¥é€‚å½“è°ƒæ•´æ’åºå‚æ•°ï¼Œå¦‚å¢â¼¤ sort_buffer_sizeã€max_length_for_sort_data ç­‰ï¼Œè®©æ’åºåœ¨å†…å­˜ä¸­å®Œæˆã€‚â€”-è¿™éƒ¨åˆ†æ˜¯å¸®åŠ©ç†è§£ startï¼Œâ¾¯è¯•ä¸­å¯ä¸èƒŒâ€”- sort_buffer_sizeï¼šç”¨äºæ§åˆ¶æ’åºç¼“å†²åŒºçš„å¤§å°ï¼Œé»˜è®¤ä¸º 256KBã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œå¦‚æœæ’åºçš„æ•°æ®é‡å°äº 256KBï¼ŒMySQL ä¼šåœ¨å†…å­˜ä¸­ç›´æ¥æ’åºï¼›å¦åˆ™å°±è¦åœ¨ç£ç›˜ä¸Šè¿›è¡Œ filesortã€‚ max_length_for_sort_dataï¼šå•è¡Œæ•°æ®çš„æœ€å¤§é•¿åº¦ï¼Œä¼šå½±å“æ’åºç®—æ³•é€‰æ‹©ã€‚å¦‚æœå•è¡Œæ•°æ®è¶…è¿‡è¯¥å€¼ï¼ŒMySQL ä¼šä½¿ç”¨åŒè·¯æ’åºï¼Œå¦åˆ™ä½¿ç”¨å•è·¯æ’åºã€‚ max_sort_lengthï¼šé™åˆ¶å­—ç¬¦ä¸²æ’åºæ—¶æ¯”è¾ƒçš„å‰ç¼€é•¿åº¦ã€‚å½“ MySQL ä¸å¾—ä¸å¯¹ textã€blob å­—æ®µè¿›è¡Œæ’åºæ—¶ï¼Œä¼šæˆªå–å‰ max_sort_length ä¸ªå­—ç¬¦è¿›è¡Œæ¯”è¾ƒã€‚â€”-è¿™éƒ¨åˆ†æ˜¯å¸®åŠ©ç†è§£ endï¼Œé¢è¯•ä¸­å¯ä¸èƒŒâ€”-ç¬¬ä¸‰ï¼Œå¯ä»¥é€šè¿‡ where å’Œ limit é™åˆ¶å¾…æ’åºçš„æ•°æ®é‡ï¼Œå‡å°‘æ’åºçš„å¼€é”€ã€‚-- ä¼˜åŒ–å‰SELECT * FROM users ORDER BY age LIMIT 100;-- ä¼˜åŒ–åï¼ˆå‡å°‘æ•°æ®ä¼ è¾“å’Œæ’åºå¼€é”€ï¼‰SELECT id, name, age FROM users ORDER BY age LIMIT 100;-- æ·±åº¦åˆ†é¡µä¼˜åŒ–ï¼ˆé¿å… OFFSET æ‰«æå…¨è¡¨ï¼‰SELECT * FROM users ORDER BY age LIMIT 10000, 20; -- ä½æ•ˆSELECT * FROM users WHERE age last_age ORDER BY age LIMIT 20; -- é«˜æ•ˆï¼ˆè®°å½•ä¸Šä¸€é¡µæœ€åä¸€æ¡çš„ age å€¼ï¼‰ ä»€ä¹ˆæ˜¯ filesortï¼ŸMysqlå¦‚ä½•æ‰§è¡ŒORDER BY å½“ä¸èƒ½ä½¿ç”¨ç´¢å¼•ç”Ÿæˆæ’åºç»“æœçš„æ—¶å€™ï¼ŒMySQL éœ€è¦è‡ªå·±è¿›è¡Œæ’åºï¼Œå¦‚æœæ•°æ®é‡æ¯”è¾ƒå°ï¼Œä¼šåœ¨å†…å­˜ä¸­è¿›è¡Œï¼›å¦‚æœæ•°æ®é‡æ¯”è¾ƒå¤§å°±éœ€è¦å†™ä¸´æ—¶æ–‡ä»¶åˆ°ç£ç›˜å†æ’åºï¼Œæˆ‘ä»¬å°†è¿™ä¸ªè¿‡ç¨‹ç§°ä¸ºæ–‡ä»¶æ’åºã€‚ â€”-è¿™éƒ¨åˆ†æ˜¯å¸®åŠ©ç†è§£ startï¼Œé¢è¯•ä¸­å¯ä¸èƒŒâ€”-è®©æˆ‘ä»¬æ¥éªŒè¯ä¸€ä¸‹ filesort çš„æƒ…å†µ èƒ½å¤Ÿçœ‹å¾—å‡ºæ¥ï¼Œå½“ order by id ä¹Ÿå°±æ˜¯ä¸»é”®çš„æ—¶å€™ï¼Œæ²¡æœ‰è§¦å‘ filesortï¼›å½“ order by age çš„æ—¶å€™ï¼Œç”±äºæ²¡æœ‰ç´¢å¼•ï¼Œå°±è§¦å‘äº† filesortã€‚â€”-è¿™éƒ¨åˆ†æ˜¯å¸®åŠ©ç†è§£ endï¼Œé¢è¯•ä¸­å¯ä¸èƒŒâ€”- å…¨å­—æ®µæ’åºå’Œ rowid æ’åºäº†è§£å¤šå°‘ï¼Ÿå½“æ’åºå­—æ®µæ˜¯ç´¢å¼•å­—æ®µä¸”æ»¡è¶³æœ€å·¦å‰ç¼€åŸåˆ™æ—¶ï¼ŒMySQL å¯ä»¥ç›´æ¥åˆ©ç”¨ç´¢å¼•çš„æœ‰åºæ€§å®Œæˆæ’åºã€‚ å½“æ— æ³•ä½¿ç”¨ç´¢å¼•æ’åºæ—¶ï¼ŒMySQL éœ€è¦åœ¨å†…å­˜æˆ–ç£ç›˜ä¸­è¿›è¡Œæ’åºæ“ä½œï¼Œåˆ†ä¸ºå…¨å­—æ®µæ’åºå’Œ rowid æ’åºä¸¤ç§ç®—æ³•ã€‚ å…¨å­—æ®µæ’åºä¼šä¸€æ¬¡æ€§å–å‡ºæ»¡è¶³æ¡ä»¶è¡Œçš„æ‰€æœ‰å­—æ®µï¼Œç„¶ååœ¨ sort buffer ä¸­è¿›è¡Œæ’åºï¼Œæ’åºåç›´æ¥è¿”å›ç»“æœï¼Œæ— éœ€å›è¡¨ã€‚ ä»¥ SELECT * FROM user WHERE name = ç‹äºŒ ORDER BY age ä¸ºä¾‹ï¼š ä» name ç´¢å¼•ä¸­æ‰¾åˆ°ç¬¬ä¸€ä¸ªæ»¡è¶³ nameâ€™å¼ ä¸‰â€™ çš„ä¸»é”® idï¼›æ ¹æ®ä¸»é”® id å–å‡ºæ•´è¡Œæ‰€æœ‰çš„å­—æ®µï¼Œå­˜å…¥ sort bufferï¼›é‡å¤ä¸Šè¿°è¿‡ç¨‹ç›´åˆ°å¤„ç†å®Œæ‰€æœ‰æ»¡è¶³æ¡ä»¶çš„è¡Œå¯¹ sort buffer ä¸­çš„æ•°æ®æŒ‰ age æ’åºï¼Œè¿”å›ç»“æœã€‚ ä¼˜ç‚¹æ˜¯ä»…éœ€è¦ä¸€æ¬¡ç£ç›˜ IO ç¼ºç‚¹æ˜¯å†…å­˜å ç”¨å¤§ï¼Œå¦‚æœæ•°é‡è¶…è¿‡ sort buffer çš„è¯ï¼Œéœ€è¦åˆ†ç‰‡è¯»å–å¹¶å€ŸåŠ©ä¸´æ—¶æ–‡ä»¶åˆå¹¶æ’åºï¼ŒIO æ¬¡æ•°åè€Œä¼šå¢åŠ ã€‚ä¹Ÿæ— æ³•å¤„ç†åŒ…å« text å’Œ blob ç±»å‹çš„å­—æ®µã€‚ rowid æ’åºåˆ†ä¸ºä¸¤ä¸ªé˜¶æ®µï¼š ç¬¬ä¸€é˜¶æ®µï¼šæ ¹æ®æŸ¥è¯¢æ¡ä»¶å–å‡ºæ’åºå­—æ®µå’Œä¸»é”® IDï¼Œå­˜å…¥sort bufferè¿›è¡Œæ’åºï¼› ç¬¬äºŒé˜¶æ®µï¼šæ ¹æ®æ’åºåçš„ä¸»é”® ID å›è¡¨å–å‡ºå…¶ä»–éœ€è¦çš„å­—æ®µã€‚ åŒæ ·ä»¥ SELECT * FROM user WHERE name = ç‹äºŒ ORDER BY age ä¸ºä¾‹ï¼š ä» name ç´¢å¼•ä¸­æ‰¾åˆ°ç¬¬ä¸€ä¸ªæ»¡è¶³ nameâ€™å¼ ä¸‰â€™ çš„ä¸»é”® idï¼› æ ¹æ®ä¸»é”® id å–å‡ºæ’åºå­—æ®µ ageï¼Œè¿åŒä¸»é”® id ä¸€èµ·å­˜å…¥ sort bufferï¼› é‡å¤ä¸Šè¿°è¿‡ç¨‹ç›´åˆ°å¤„ç†å®Œæ‰€æœ‰æ»¡è¶³æ¡ä»¶çš„è¡Œ å¯¹ sort buffer ä¸­çš„æ•°æ®æŒ‰ age æ’åºï¼› éå†æ’åºåçš„ä¸»é”® idï¼Œå›è¡¨å–å‡ºå…¶ä»–æ‰€éœ€å­—æ®µï¼Œè¿”å›ç»“æœã€‚ ä¼˜ç‚¹æ˜¯å†…å­˜å ç”¨è¾ƒå°‘ï¼Œé€‚åˆå­—æ®µå¤šæˆ–è€…æ•°æ®é‡å¤§çš„åœºæ™¯ï¼Œç¼ºç‚¹æ˜¯éœ€è¦ä¸¤æ¬¡ç£ç›˜ IOã€‚ MySQL ä¼šæ ¹æ®ç³»ç»Ÿå˜é‡ max_length_for_sort_data å’ŒæŸ¥è¯¢å­—æ®µçš„æ€»å¤§å°æ¥å†³å®šä½¿ç”¨å…¨å­—æ®µæ’åºè¿˜æ˜¯ rowid æ’åºã€‚ å¦‚æœæŸ¥è¯¢å­—æ®µæ€»é•¿åº¦ max_length_for_sort_dataï¼ŒMySQL ä¼šä½¿ç”¨å…¨å­—æ®µæ’åºï¼›å¦åˆ™ä¼šä½¿ç”¨ rowid æ’åºã€‚ ä½ å¯¹ Sort_merge_passes å‚æ•°äº†è§£å—ï¼Ÿæ·±å…¥äº†è§£ MySQL Order By æ–‡ä»¶æ’åºSort_merge_passes æ˜¯ä¸€ä¸ªçŠ¶æ€å˜é‡ï¼Œç”¨äºç»Ÿè®¡ MySQL åœ¨æ‰§è¡Œæ’åºæ“ä½œæ—¶è¿›è¡Œå½’å¹¶æ’åºçš„æ¬¡æ•°ã€‚å½“ MySQL éœ€è¦è¿›è¡Œæ’åºä½†æ’åºæ•°æ®æ— æ³•å®Œå…¨æ”¾å…¥ sort_buffer_size å®šä¹‰çš„å†…å­˜ç¼“å†²åŒºæ—¶ï¼Œå°±ä¼šä½¿ç”¨ä¸´æ—¶æ–‡ä»¶è¿›è¡Œå¤–éƒ¨æ’åºï¼Œè¿™æ—¶å°±ä¼šäº§ç”Ÿ Sort_merge_passesã€‚ å¦‚æœ Sort_merge_passes åœ¨çŸ­æ—¶é—´å†…å¿«é€Ÿæ¿€å¢ï¼Œè¯´æ˜æ’åºæ“ä½œçš„æ•°æ®é‡è¾ƒå¤§ï¼Œéœ€è¦è°ƒæ•´ sort_buffer_size æˆ–è€…ä¼˜åŒ–æŸ¥è¯¢è¯­å¥ã€‚ MySQL åœ¨æ‰§è¡Œæ’åºæ“ä½œæ—¶ï¼Œä¼šç»å†ä¸¤ä¸ªè¿‡ç¨‹ï¼š å†…å­˜æ’åºé˜¶æ®µï¼ŒMySQL é¦–å…ˆå°è¯•åœ¨ sort buffer ä¸­è¿›è¡Œæ’åºã€‚å¦‚æœæ•°æ®é‡å°äº sort_buffer_size ç¼“å†²åŒºå¤§å°ï¼Œä¼šå®Œå…¨åœ¨å†…å­˜ä¸­å®Œæˆå¿«é€Ÿæ’åºã€‚ å¤–éƒ¨æ’åºé˜¶æ®µï¼Œå¦‚æœæ•°æ®é‡è¶…è¿‡ sort_buffer_sizeï¼ŒMySQL ä¼šå°†æ•°æ®åˆ†æˆå¤šä¸ªå—ï¼Œæ¯å—å•ç‹¬æ’åºåå†™å…¥ä¸´æ—¶æ–‡ä»¶ï¼Œç„¶åå¯¹è¿™äº›å·²æ’åºçš„å—è¿›è¡Œå½’å¹¶æ’åºã€‚æ¯æ¬¡å½’å¹¶æ“ä½œéƒ½ä¼šå¢åŠ  Sort_merge_passes çš„è®¡æ•°ã€‚ æ¡ä»¶ä¸‹æ¨ä½ äº†è§£å¤šå°‘ï¼Ÿæ¡ä»¶ä¸‹æ¨çš„æ ¸å¿ƒæ€æƒ³æ˜¯å°†å¤–å±‚çš„è¿‡æ»¤æ¡ä»¶ï¼Œæ¯”å¦‚è¯´ whereã€join ç­‰ï¼Œå°½å¯èƒ½åœ°ä¸‹æ¨åˆ°æŸ¥è¯¢è®¡åˆ’çš„æ›´åº•å±‚ï¼Œæ¯”å¦‚è¯´å­æŸ¥è¯¢ã€è¿æ¥æ“ä½œä¹‹å‰ï¼Œä»è€Œå‡å°‘ä¸­é—´ç»“æœçš„æ•°æ®é‡ã€‚ æ¯”å¦‚è¯´åŸå§‹æŸ¥è¯¢æ˜¯ï¼š SELECT * FROM ( SELECT * FROM orders WHERE total 100) AS subqueryWHERE subquery.status = shipped; å°±å¯ä»¥å°†æ¡ä»¶ä¸‹æ¨åˆ°å­æŸ¥è¯¢ï¼š SELECT * FROM ( SELECT * FROM orders WHERE total 100 AND status = shipped) AS subquery; è¿™æ ·å°±å¯ä»¥å‡å°‘æŸ¥è¯¢è¿”å›çš„æ•°æ®é‡ï¼Œé¿å…å¤–å±‚å†è¿‡æ»¤ã€‚ å†æ¯”å¦‚è¯´ union ä¸­çš„åŸå§‹æŸ¥è¯¢æ˜¯ï¼š (SELECT * FROM t1) UNION ALL (SELECT * FROM t2)ORDER BY col LIMIT 10; å°±å¯ä»¥å°†æ¡ä»¶ä¸‹æ¨åˆ°æ¯ä¸ªå­æŸ¥è¯¢ï¼š (SELECT * FROM t1 ORDER BY col LIMIT 10)UNION ALL (SELECT * FROM t2 ORDER BY col LIMIT 10); æ¯ä¸ªå­æŸ¥è¯¢ä»…è¿”å›å‰ 10 æ¡æ•°æ®ï¼Œå‡å°‘ä¸´æ—¶è¡¨çš„æ•°æ®é‡ã€‚ å†æ¯”å¦‚è¯´è¿æ¥æŸ¥è¯¢ join ä¸­çš„åŸå§‹æŸ¥è¯¢æ˜¯ï¼š SELECT * FROM ordersJOIN customers ON orders.customer_id = customers.idWHERE customers.country = china; å°±å¯ä»¥å°†æ¡ä»¶ä¸‹æ¨åˆ°è¡¨æ‰«æçš„æ—¶å€™ï¼š SELECT * FROM ordersJOIN ( SELECT * FROM customers WHERE country = china) AS filtered_customersON orders.customer_id = filtered_customers.id; å…ˆè¿‡æ»¤ customers è¡¨ï¼Œå‡å°‘ join æ—¶çš„æ•°æ®é‡ã€‚ ä¸ºä»€ä¹ˆè¦å°½é‡é¿å…ä½¿ç”¨ select *ï¼ŸSELECT * ä¼šå¼ºåˆ¶ MySQL è¯»å–è¡¨ä¸­æ‰€æœ‰å­—æ®µçš„æ•°æ®ï¼ŒåŒ…æ‹¬åº”ç”¨ç¨‹åºå¯èƒ½å¹¶ä¸éœ€è¦çš„ï¼Œæ¯”å¦‚ textã€blob ç±»å‹çš„å¤§å­—æ®µã€‚åŠ è½½å†—ä½™æ•°æ®ä¼šå ç”¨æ›´å¤šçš„ç¼“å­˜ç©ºé—´ï¼Œä»è€ŒæŒ¤å å…¶ä»–é‡è¦æ•°æ®çš„ç¼“å­˜èµ„æºï¼Œé™ä½æ•´ä½“ç³»ç»Ÿçš„ååé‡ã€‚ä¹Ÿä¼šå¢åŠ ç½‘ç»œä¼ è¾“çš„å¼€é”€ï¼Œå°¤å…¶æ˜¯åœ¨å¤§å­—æ®µçš„æƒ…å†µä¸‹ã€‚æœ€é‡è¦çš„æ˜¯ï¼ŒSELECT * å¯èƒ½ä¼šå¯¼è‡´è¦†ç›–ç´¢å¼•å¤±æ•ˆï¼Œæœ¬æ¥å¯ä»¥èµ°ç´¢å¼•çš„æŸ¥è¯¢æœ€åå˜æˆäº†å…¨è¡¨æ‰«æã€‚ -- ä½¿ç”¨è¦†ç›–ç´¢å¼•ï¼ˆå‡è®¾ç´¢å¼•ä¸º idx_countryï¼‰SELECT id, country FROM users WHERE country = china; -- å¯èƒ½ä»…æ‰«æç´¢å¼•-- ä½¿ç”¨ SELECT *SELECT * FROM users WHERE country = china; -- éœ€å›è¡¨è¯»å–æ‰€æœ‰åˆ— ä½ è¿˜çŸ¥é“å“ªäº› SQL ä¼˜åŒ–æ–¹æ³•ï¼Ÿâ‘ ã€é¿å…ä½¿ç”¨ != æˆ–è€… æ“ä½œç¬¦ ! æˆ–è€… æ“ä½œç¬¦ä¼šå¯¼è‡´ MySQL æ— æ³•ä½¿ç”¨ç´¢å¼•ï¼Œä»è€Œå¯¼è‡´å…¨è¡¨æ‰«æã€‚ å¯ä»¥æŠŠcolumnâ€™aaaâ€™ï¼Œæ”¹æˆcolumnâ€™aaaâ€™ or columnâ€™aaaâ€™ã€‚ â‘¡ã€ä½¿ç”¨å‰ç¼€ç´¢å¼• æ¯”å¦‚ï¼Œé‚®ç®±çš„åç¼€ä¸€èˆ¬éƒ½æ˜¯å›ºå®šçš„@xxx.comï¼Œé‚£ä¹ˆç±»ä¼¼è¿™ç§åé¢å‡ ä½ä¸ºå›ºå®šå€¼çš„å­—æ®µå°±éå¸¸é€‚åˆå®šä¹‰ä¸ºå‰ç¼€ç´¢å¼•ï¼šalter table test add index index2(email(6));éœ€è¦æ³¨æ„çš„æ˜¯ï¼ŒMySQL æ— æ³•åˆ©ç”¨å‰ç¼€ç´¢å¼•åš order by å’Œ group by æ“ä½œã€‚ â‘¢ã€é¿å…åœ¨åˆ—ä¸Šä½¿ç”¨å‡½æ•° åœ¨ where å­å¥ä¸­ç›´æ¥å¯¹åˆ—ä½¿ç”¨å‡½æ•°ä¼šå¯¼è‡´ç´¢å¼•å¤±æ•ˆï¼Œå› ä¸º MySQL éœ€è¦å¯¹æ¯è¡Œçš„åˆ—åº”ç”¨å‡½æ•°åå†è¿›è¡Œæ¯”è¾ƒã€‚select name from test where date_format(create_time,%Y-%m-%d)=2021-01-01;å¯ä»¥æ”¹æˆï¼š select name from test where create_time=2021-01-01 00:00:00 and create_time2021-01-02 00:00:00; é€šè¿‡æ—¥æœŸçš„èŒƒå›´æŸ¥è¯¢ï¼Œè€Œä¸æ˜¯åœ¨åˆ—ä¸Šä½¿ç”¨å‡½æ•°ï¼Œå¯ä»¥åˆ©ç”¨ create_time ä¸Šçš„ç´¢å¼•ã€‚ 34.ğŸŒŸexplainå¹³å¸¸æœ‰ç”¨è¿‡å—ï¼Ÿç»å¸¸ç”¨ï¼Œexplain æ˜¯ MySQL æä¾›çš„ä¸€ä¸ªç”¨äºæŸ¥çœ‹ SQL æ‰§è¡Œè®¡åˆ’çš„å·¥å…·ï¼Œå¯ä»¥å¸®åŠ©æˆ‘ä»¬åˆ†ææŸ¥è¯¢è¯­å¥çš„æ€§èƒ½é—®é¢˜ã€‚ ä¸€å…±æœ‰ 10 æ¥ä¸ªè¾“å‡ºå‚æ•°ã€‚ æ¯”å¦‚è¯´ typeALL,keyNULL è¡¨ç¤º SQL æ­£åœ¨å…¨è¡¨æ‰«æï¼Œå¯ä»¥è€ƒè™‘ä¸º where å­—æ®µæ·»åŠ ç´¢å¼•è¿›è¡Œä¼˜åŒ–ï¼›ExtraUsing filesort è¡¨ç¤º SQL æ­£åœ¨æ–‡ä»¶æ’åºï¼Œå¯ä»¥è€ƒè™‘ä¸º order by å­—æ®µæ·»åŠ ç´¢å¼•ã€‚ ä½¿ç”¨æ–¹å¼ä¹Ÿéå¸¸ç®€å•ï¼Œç›´æ¥åœ¨ select å‰åŠ ä¸Š explain å…³é”®å­—å°±å¯ä»¥äº†ã€‚ explain select * from students where name=ç‹äºŒ;æ›´é«˜çº§çš„ç”¨æ³•å¯ä»¥é…åˆ formatjson å‚æ•°ï¼Œå°† explain çš„è¾“å‡ºç»“æœä»¥ JSON æ ¼å¼è¿”å›ã€‚explain format=json select * from students where name=ç‹äºŒ; explain è¾“å‡ºç»“æœä¸­å¸¸è§çš„å­—æ®µå«ä¹‰ç†è§£å—ï¼Ÿåœ¨ EXPLAIN è¾“å‡ºç»“æœä¸­æˆ‘æœ€å…³æ³¨çš„å­—æ®µæ˜¯ typeã€keyã€rows å’Œ Extraã€‚ æˆ‘ä¼šé€šè¿‡å®ƒä»¬åˆ¤æ–­ SQL æœ‰æ²¡æœ‰èµ°ç´¢å¼•ã€æ˜¯å¦å…¨è¡¨æ‰«æã€é¢„ä¼°æ‰«æè¡Œæ•°æ˜¯å¦å¤ªå¤§ï¼Œä»¥åŠæ˜¯å¦è§¦å‘äº† filesort æˆ–ä¸´æ—¶è¡¨ã€‚ä¸€æ—¦å‘ç°é—®é¢˜ï¼Œæ¯”å¦‚ typeALL æˆ–è€… ExtraUsing filesortï¼Œæˆ‘ä¼šè€ƒè™‘å»ºç´¢å¼•ã€æ”¹å†™ SQL æˆ–æ§åˆ¶æŸ¥è¯¢ç»“æœé›†æ¥åšä¼˜åŒ–ã€‚ â€”-è¿™éƒ¨åˆ†æ˜¯å¸®åŠ©ç†è§£ startï¼Œé¢è¯•ä¸­å¯ä¸èƒŒâ€”-ä»¥ EXPLAIN SELECT * FROM orders WHERE user_id = 100 çš„è¾“å‡ºä¸ºä¾‹ï¼š éè¡¨æ ¼ç‰ˆæœ¬ï¼šâ‘ ã€id åˆ—ï¼šæŸ¥è¯¢çš„æ‰§è¡Œé¡ºåºç¼–å·ã€‚id ç›¸åŒï¼šåŒä¸€æ‰§è¡Œå±‚çº§ï¼ŒæŒ‰ table åˆ—ä»ä¸Šåˆ°ä¸‹é¡ºåºæ‰§è¡Œï¼ˆå¦‚å¤šè¡¨ JOINï¼‰ï¼›id é€’å¢ï¼šåµŒå¥—å­æŸ¥è¯¢ï¼Œæ•°å€¼è¶Šå¤§ä¼˜å…ˆçº§è¶Šé«˜ï¼Œè¶Šå…ˆæ‰§è¡Œã€‚ EXPLAIN SELECT * FROM t1 JOIN (SELECT * FROM t2 WHERE id = 1) AS sub; t2 å­æŸ¥è¯¢çš„ id2ï¼Œä¼˜å…ˆæ‰§è¡Œã€‚ â‘¡ã€select_type åˆ—ï¼šæŸ¥è¯¢çš„ç±»å‹ã€‚å¸¸è§çš„ç±»å‹æœ‰ï¼š SIMPLEï¼šç®€å•æŸ¥è¯¢ï¼Œä¸åŒ…å«å­æŸ¥è¯¢æˆ–è€… UNIONã€‚ PRIMARYï¼šæŸ¥è¯¢ä¸­å¦‚æœåŒ…å«å­æŸ¥è¯¢ï¼Œåˆ™æœ€å¤–å±‚æŸ¥è¯¢è¢«æ ‡è®°ä¸º PRIMARYã€‚éœ€è¦å…³æ³¨å­æŸ¥è¯¢æˆ–æ´¾ç”Ÿè¡¨æ€§èƒ½ã€‚ SUBQUERYï¼šå­æŸ¥è¯¢ï¼›éœ€è¦é¿å…å¤šå±‚åµŒå¥—ï¼Œå°½é‡æ”¹å†™ä¸º JOINã€‚ DERIVEDï¼šæ´¾ç”Ÿè¡¨ï¼ˆFROM å­å¥ä¸­çš„å­æŸ¥è¯¢ï¼‰ã€‚éœ€è¦å‡å°‘æ´¾ç”Ÿè¡¨æ•°æ®é‡ï¼Œæˆ–ç‰©åŒ–ä¸ºä¸´æ—¶è¡¨ã€‚ â‘¢ã€table åˆ—ï¼šæŸ¥çš„å“ªä¸ªè¡¨ã€‚ derivedNï¼šè¡¨ç¤ºæ´¾ç”Ÿè¡¨ï¼ˆN å¯¹åº” idï¼‰ã€‚ unionNM,Nï¼šè¡¨ç¤º UNION åˆå¹¶çš„ç»“æœï¼ˆMã€N ä¸ºå‚ä¸ UNION çš„ idï¼‰ã€‚ â‘£ã€type åˆ—ï¼šè¡¨ç¤º MySQL åœ¨è¡¨ä¸­æ‰¾åˆ°æ‰€éœ€è¡Œçš„æ–¹å¼ã€‚ systemï¼Œè¡¨ä»…æœ‰ä¸€è¡Œï¼ˆç³»ç»Ÿè¡¨æˆ–è¡ç”Ÿè¡¨ï¼‰ï¼Œæ— éœ€ä¼˜åŒ–ã€‚ constï¼šé€šè¿‡ä¸»é”®æˆ–å”¯ä¸€ç´¢å¼•æ‰¾åˆ°ä¸€è¡Œï¼ˆå¦‚ WHERE id 1ï¼‰ã€‚ç†æƒ³æƒ…å†µã€‚ eq_refï¼šå¯¹ä¸»é”®å”¯ä¸€ç´¢å¼• JOIN åŒ¹é…ï¼ˆå¦‚ A JOIN B ON A.id B.idï¼‰ã€‚ç¡®ä¿ JOIN å­—æ®µæœ‰ç´¢å¼•ã€‚ refï¼šéå”¯ä¸€ç´¢å¼•åŒ¹é…ï¼ˆå¦‚ WHERE name â€˜ç‹äºŒâ€™ï¼Œname æœ‰æ™®é€šç´¢å¼•ï¼‰ã€‚ rangeï¼šåªæ£€ç´¢ç»™å®šèŒƒå›´çš„è¡Œï¼Œä½¿ç”¨ç´¢å¼•æ¥æ£€ç´¢ã€‚åœ¨whereè¯­å¥ä¸­ä½¿ç”¨ bettweenâ€¦andã€ã€ã€ã€in ç­‰æ¡ä»¶æŸ¥è¯¢ type éƒ½æ˜¯ rangeã€‚ indexï¼šå…¨ç´¢å¼•æ‰«æï¼Œå¦‚æœä¸éœ€è¦å›è¡¨ï¼Œå¯æ¥å—ï¼›å¦åˆ™è€ƒè™‘è¦†ç›–ç´¢å¼•ã€‚ ALLï¼šå…¨è¡¨æ‰«æï¼Œæ•ˆç‡æœ€ä½ã€‚â‘¤ã€possible_keys åˆ—ï¼šå¯èƒ½ä¼šç”¨åˆ°çš„ç´¢å¼•ï¼Œä½†å¹¶ä¸ä¸€å®šå®é™…è¢«ä½¿ç”¨ã€‚ â‘¥ã€key åˆ—ï¼šå®é™…ä½¿ç”¨çš„ç´¢å¼•ã€‚å¦‚æœä¸º NULLï¼Œåˆ™æ²¡æœ‰ä½¿ç”¨ç´¢å¼•ã€‚å¦‚æœä¸º PRIMARYï¼Œåˆ™ä½¿ç”¨äº†ä¸»é”®ç´¢å¼•ã€‚ â‘¦ã€key_len åˆ—ï¼šä½¿ç”¨çš„ç´¢å¼•å­—èŠ‚æ•°ï¼Œåæ˜ ç´¢å¼•åˆ—çš„åˆ©ç”¨ç‡ã€‚ä½¿ç”¨è”åˆç´¢å¼• (a, b)ï¼Œkey_len æ˜¯ a å’Œ b çš„å­—èŠ‚æ€»å’Œï¼ˆä»…å½“æŸ¥è¯¢æ¡ä»¶ç”¨åˆ° a æˆ– a+b æ—¶æœ‰æ•ˆï¼‰ã€‚ â€“ è¡¨ç»“æ„ï¼šCREATE TABLE t (a INT, b VARCHAR(20), INDEX idx_a_b (a, b));EXPLAIN SELECT * FROM t WHERE a 1 AND b â€˜testâ€™;key_len 4ï¼ˆINTï¼‰ + 20*3ï¼ˆutf8ï¼‰ + 2 66 å­—èŠ‚ã€‚ â‘§ã€ref åˆ—ï¼šä¸ç´¢å¼•åˆ—æ¯”è¾ƒçš„å€¼æˆ–åˆ—ã€‚ constï¼šå¸¸é‡ã€‚ä¾‹å¦‚ WHERE column â€˜valueâ€™ã€‚ funcï¼šå‡½æ•°ã€‚ä¾‹å¦‚ WHERE column func(column)ã€‚ â‘¨ã€rows åˆ—ï¼šä¼˜åŒ–å™¨ä¼°ç®—çš„éœ€è¦æ‰«æçš„è¡Œæ•°ã€‚æ•°å€¼è¶Šå°è¶Šå¥½ï¼Œè‹¥ä¸å®é™…å·®è·å¤§ï¼Œå¯èƒ½ç»Ÿè®¡ä¿¡æ¯è¿‡æœŸï¼ˆéœ€ ANALYZE TABLEï¼‰ã€‚ç»“åˆ filtered å­—æ®µå¯ä»¥è®¡ç®—æœ€ç»ˆè¿”å›è¡Œæ•°ï¼ˆrows Ã— filteredï¼‰ã€‚ â‘©ã€Extra åˆ—ï¼šé™„åŠ ä¿¡æ¯ã€‚ Using indexï¼šè¦†ç›–ç´¢å¼•ï¼Œæ— éœ€å›è¡¨ã€‚ Using whereï¼šå­˜å‚¨å¼•æ“è¿”å›ç»“æœåï¼ŒServer å±‚éœ€è¦å†æ¬¡è¿‡æ»¤ï¼ˆæ¡ä»¶æœªå®Œå…¨ä¸‹æ¨ï¼‰ã€‚ Using temporary ï¼šä½¿ç”¨ä¸´æ—¶è¡¨ï¼ˆå¸¸è§äº GROUP BYã€DISTINCTï¼‰ã€‚ Using filesortï¼šæ–‡ä»¶æ’åºï¼ˆå¸¸è§äº ORDER BYï¼‰ã€‚è€ƒè™‘ä¸º ORDER BY å­—æ®µæ·»åŠ ç´¢å¼•ã€‚ Select tables optimized awayï¼šä¼˜åŒ–å™¨å·²ä¼˜åŒ–ï¼ˆå¦‚ COUNT(*) é€šè¿‡ç´¢å¼•ç›´æ¥ç»Ÿè®¡ï¼‰ã€‚ Using join bufferï¼šä½¿ç”¨è¿æ¥ç¼“å†²åŒºï¼ˆBlock Nested Loop æˆ– Hash Joinï¼‰ã€‚è€ƒè™‘å¢å¤§ join_buffer_sizeã€‚ â€”-è¿™éƒ¨åˆ†æ˜¯å¸®åŠ©ç†è§£ endï¼Œé¢è¯•ä¸­å¯ä¸èƒŒâ€”- typeçš„æ‰§è¡Œæ•ˆç‡ç­‰çº§ï¼Œè¾¾åˆ°ä»€ä¹ˆçº§åˆ«æ¯”è¾ƒåˆé€‚ï¼Ÿä»é«˜åˆ°ä½çš„æ•ˆç‡æ’åºæ˜¯ systemã€constã€eq_refã€refã€rangeã€index å’Œ ALLã€‚ ä¸€èˆ¬æƒ…å†µä¸‹ï¼Œå»ºè®® type å€¼è¾¾åˆ° constã€eq_ref æˆ– refï¼Œå› ä¸ºè¿™äº›ç±»å‹è¡¨æ˜æŸ¥è¯¢ä½¿ç”¨äº†ç´¢å¼•ï¼Œæ•ˆç‡è¾ƒé«˜ã€‚å¦‚æœæ˜¯èŒƒå›´æŸ¥è¯¢ï¼Œrange ç±»å‹ä¹Ÿæ˜¯å¯ä»¥æ¥å—çš„ã€‚ALL ç±»å‹è¡¨ç¤ºå…¨è¡¨æ‰«æï¼Œæ€§èƒ½æœ€å·®ï¼Œå¾€å¾€ä¸å¯æ¥å—ï¼Œéœ€è¦ä¼˜åŒ–ã€‚ ç´¢å¼•35.ğŸŒŸç´¢å¼•ä¸ºä»€ä¹ˆèƒ½æé«˜MySQLæŸ¥è¯¢æ•ˆç‡ï¼Ÿç´¢å¼•å°±åƒä¸€æœ¬ä¹¦çš„ç›®å½•ï¼Œèƒ½è®© MySQL å¿«é€Ÿå®šä½æ•°æ®ï¼Œé¿å…å…¨è¡¨æ‰«æã€‚ å®ƒä¸€èˆ¬æ˜¯ B+ æ ‘ç»“æ„ï¼ŒæŸ¥æ‰¾æ•ˆç‡æ˜¯ O(log n)ï¼Œæ¯”ä»å¤´åˆ°å°¾æ‰«ä¸€éæ•°æ®è¦å¿«å¾—å¤šã€‚ é™¤äº†æŸ¥å¾—å¿«ï¼Œç´¢å¼•è¿˜èƒ½åŠ é€Ÿæ’åºã€åˆ†ç»„ã€è¿æ¥ç­‰æ“ä½œã€‚å¯ä»¥é€šè¿‡ create index åˆ›å»ºç´¢å¼•ï¼Œæ¯”å¦‚ï¼šcreate index idx_name on students(name); 36.ğŸŒŸèƒ½ç®€å•è¯´ä¸€ä¸‹ç´¢å¼•çš„åˆ†ç±»å—ï¼Ÿä»åŠŸèƒ½ä¸Šåˆ†ç±»çš„è¯ï¼Œæœ‰ä¸»é”®ç´¢å¼•ã€å”¯ä¸€ç´¢å¼•ã€å…¨æ–‡ç´¢å¼•ï¼›ä»æ•°æ®ç»“æ„ä¸Šåˆ†ç±»çš„è¯ï¼Œæœ‰ B+ æ ‘ç´¢å¼•ã€å“ˆå¸Œç´¢å¼•ï¼›ä»å­˜å‚¨å†…å®¹ä¸Šåˆ†ç±»çš„è¯ï¼Œæœ‰èšç°‡ç´¢å¼•ã€éèšç°‡ç´¢å¼•ã€‚ ä½ å¯¹ä¸»é”®ç´¢å¼•äº†è§£å¤šå°‘ï¼Ÿä¸»é”®ç´¢å¼•ç”¨äºå”¯ä¸€æ ‡è¯†è¡¨ä¸­çš„æ¯æ¡è®°å½•ï¼Œå…¶åˆ—å€¼å¿…é¡»å”¯ä¸€ä¸”éç©ºã€‚åˆ›å»ºä¸»é”®æ—¶ï¼ŒMySQL ä¼šè‡ªåŠ¨ç”Ÿæˆå¯¹åº”çš„å”¯ä¸€ç´¢å¼•ã€‚ æ¯ä¸ªè¡¨åªèƒ½æœ‰ä¸€ä¸ªä¸»é”®ç´¢å¼•ï¼Œä¸€èˆ¬æ˜¯è¡¨ä¸­çš„è‡ªå¢ id å­—æ®µã€‚ CREATE TABLE emp6 (emp_id INT PRIMARY KEY, name VARCHAR(50)); -- å•åˆ—ä¸»é”®CREATE TABLE CountryLanguage ( CountryCode CHAR(3), Language VARCHAR(30), PRIMARY KEY (CountryCode, Language) -- å¤åˆä¸»é”®); â€”- è¿™éƒ¨åˆ†æ˜¯å¸®åŠ©ç†è§£ startï¼Œé¢è¯•ä¸­å¯ä¸èƒŒ â€”- å¦‚æœåˆ›å»ºè¡¨çš„æ—¶å€™æ²¡æœ‰æŒ‡å®šä¸»é”®ï¼ŒMySQL çš„ InnoDB å­˜å‚¨å¼•æ“ä¼šä¼˜å…ˆé€‰æ‹©ä¸€ä¸ªéç©ºçš„å”¯ä¸€ç´¢å¼•ä½œä¸ºä¸»é”®ï¼›å¦‚æœæ²¡æœ‰ç¬¦åˆæ¡ä»¶çš„ç´¢å¼•ï¼ŒMySQL ä¼šè‡ªåŠ¨ç”Ÿæˆä¸€ä¸ªéšè—çš„ _rowid åˆ—ä½œä¸ºä¸»é”®ã€‚ å¯ä»¥é€šè¿‡ show index from table_name æŸ¥çœ‹ç´¢å¼•ä¿¡æ¯ï¼š Table å½“å‰ç´¢å¼•æ‰€å±çš„è¡¨åã€‚ Non_unique æ˜¯å¦å”¯ä¸€ç´¢å¼•ï¼Œ0 è¡¨ç¤ºå”¯ä¸€ç´¢å¼•ï¼ˆå¦‚ä¸»é”®ï¼‰ï¼Œ1 è¡¨ç¤ºéå”¯ä¸€ã€‚ Key_name ä¸»é”®ç´¢å¼•é»˜è®¤å« PRIMARYï¼›æ™®é€šç´¢å¼•ä¸ºè‡ªå®šä¹‰åã€‚ Seq_in_index ç´¢å¼•ä¸­çš„åˆ—é¡ºåºï¼Œåœ¨è”åˆç´¢å¼•ä¸­è¿™ä¸ªå­—æ®µè¡¨ç¤ºç¬¬å‡ åˆ—ï¼ˆç¬¬ 1 ä¸ªï¼‰ã€‚ Column_name å½“å‰ç´¢å¼•ä¸­åŒ…å«çš„å­—æ®µåã€‚ Collation A è¡¨ç¤ºå‡åºï¼ˆAscendï¼‰ï¼›D è¡¨ç¤ºé™åºã€‚ Cardinality ç´¢å¼•çš„åŸºæ•°ï¼Œå³ä¸é‡å¤çš„ç´¢å¼•å€¼çš„æ•°é‡ã€‚è¶Šé«˜è¯´æ˜åŒºåˆ†åº¦è¶Šå¥½ï¼ˆå½±å“ä¼˜åŒ–å™¨æ˜¯å¦ç”¨æ­¤ç´¢å¼•ï¼‰ã€‚ Sub_part å‰ç¼€ç´¢å¼•çš„é•¿åº¦ã€‚ Packed æ˜¯å¦å‹ç¼©å­˜å‚¨ç´¢å¼•ï¼›ä¸€èˆ¬ä¸ç”¨ï¼Œé»˜è®¤ä¸º NULLã€‚ Null å­—æ®µæ˜¯å¦å…è®¸ä¸º NULLï¼›ä¸»é”®å­—æ®µä¸å…è®¸ä¸º NULLã€‚ Index_type ç´¢å¼•åº•å±‚ç»“æ„ï¼ŒInnoDB é»˜è®¤æ˜¯ B+ æ ‘ï¼ˆBTREEï¼‰ã€‚ Comment ç´¢å¼•çš„æ³¨é‡Šã€‚ Visible æ˜¯å¦å¯è§ï¼›MySQL 8.0+ å¯éšè—ç´¢å¼•ã€‚â€”- è¿™éƒ¨åˆ†æ˜¯å¸®åŠ©ç†è§£ endï¼Œé¢è¯•ä¸­å¯ä¸èƒŒ â€”- å”¯ä¸€ç´¢å¼•å’Œä¸»é”®ç´¢å¼•æœ‰ä»€ä¹ˆåŒºåˆ«ï¼Ÿä¸»é”®ç´¢å¼•=å”¯ä¸€ç´¢å¼•+éç©ºã€‚æ¯ä¸ªè¡¨åªèƒ½æœ‰ä¸€ä¸ªä¸»é”®ç´¢å¼•ï¼Œä½†å¯ä»¥æœ‰å¤šä¸ªå”¯ä¸€ç´¢å¼•ã€‚ -- åœ¨ email åˆ—ä¸Šæ·»åŠ å”¯ä¸€ç´¢å¼•CREATE TABLE users ( id INT AUTO_INCREMENT PRIMARY KEY, username VARCHAR(50) NOT NULL, email VARCHAR(100) NOT NULL, UNIQUE KEY uk_email (email) -- å”¯ä¸€ç´¢å¼•);-- å¤åˆå”¯ä¸€ç´¢å¼•ï¼ˆä¿è¯ user_id å’Œ role ç»„åˆå”¯ä¸€ï¼‰CREATE TABLE user_roles ( user_id INT NOT NULL, role VARCHAR(20) NOT NULL, UNIQUE KEY uk_user_role (user_id, role)); ä¸»é”®ç´¢å¼•ä¸å…è®¸æ’å…¥ NULL å€¼ï¼Œå°è¯•æ’å…¥ NULL ä¼šæŠ¥é”™ï¼›å”¯ä¸€ç´¢å¼•å…è®¸æ’å…¥å¤šä¸ª NULL å€¼ã€‚ unique key å’Œ unique index æœ‰ä»€ä¹ˆåŒºåˆ«ï¼Ÿåˆ›å»ºå”¯ä¸€é”®æ—¶ï¼ŒMySQL ä¼šè‡ªåŠ¨ç”Ÿæˆä¸€ä¸ªåŒåçš„å”¯ä¸€ç´¢å¼•ï¼›åä¹‹ï¼Œåˆ›å»ºå”¯ä¸€ç´¢å¼•ä¹Ÿä¼šéšå¼æ·»åŠ å”¯ä¸€æ€§çº¦æŸã€‚ å¯é€šè¿‡ UNIQUE KEY uk_name å®šä¹‰æˆ–è€… CONSTRAINT uk_name UNIQUE å®šä¹‰å”¯ä¸€é”®ã€‚ CREATE TABLE users ( id INT PRIMARY KEY, email VARCHAR(100), -- æ˜¾å¼å‘½åå”¯ä¸€é”® CONSTRAINT uk_email UNIQUE (email));CREATE TABLE users3 ( id INT PRIMARY KEY, email VARCHAR(100), UNIQUE KEY uk_email (email) -- å”¯ä¸€ç´¢å¼•); å¯é€šè¿‡ CREATE UNIQUE INDEX åˆ›å»ºå”¯ä¸€ç´¢å¼•ã€‚ CREATE TABLE users ( id INT PRIMARY KEY, email VARCHAR(100));-- æ‰‹åŠ¨åˆ›å»ºå”¯ä¸€ç´¢å¼•CREATE UNIQUE INDEX uk_email ON users(email); é€šè¿‡ SHOW CREATE TABLE table_name æŸ¥çœ‹è¡¨ç»“æ„æ—¶ï¼Œç»“æœéƒ½æ˜¯ä¸€æ ·çš„ã€‚ æ™®é€šç´¢å¼•å’Œå”¯ä¸€ç´¢å¼•æœ‰ä»€ä¹ˆåŒºåˆ«ï¼Ÿæ™®é€šç´¢å¼•ä»…ç”¨äºåŠ é€ŸæŸ¥è¯¢ï¼Œä¸é™åˆ¶å­—æ®µå€¼çš„å”¯ä¸€æ€§ï¼›é€‚ç”¨äºé«˜é¢‘å†™å…¥çš„å­—æ®µã€èŒƒå›´æŸ¥è¯¢çš„å­—æ®µã€‚ -- æ—¥å¿—æ—¶é—´æˆ³å…è®¸é‡å¤ï¼Œæ— éœ€å”¯ä¸€æ€§æ£€æŸ¥CREATE INDEX idx_log_time ON access_logs(access_time);-- è®¢å•çŠ¶æ€å…è®¸é‡å¤ï¼Œä½†éœ€é¢‘ç¹æŒ‰çŠ¶æ€è¿‡æ»¤æ•°æ®CREATE INDEX idx_order_status ON orders(status); å”¯ä¸€ç´¢å¼•å¼ºåˆ¶å­—æ®µå€¼çš„å”¯ä¸€æ€§ï¼Œæ’å…¥æˆ–æ›´æ–°æ—¶ä¼šè§¦å‘å”¯ä¸€æ€§æ£€æŸ¥ï¼›é€‚ç”¨äºä¸šåŠ¡å”¯ä¸€æ€§çº¦æŸçš„å­—æ®µã€é˜²æ­¢æ•°æ®é‡å¤æ’å…¥çš„å­—æ®µã€‚ -- ç”¨æˆ·é‚®ç®±å¿…é¡»å”¯ä¸€CREATE UNIQUE INDEX uk_email ON users(email);-- ç¡®ä¿åŒä¸€ç”¨æˆ·å¯¹åŒä¸€å•†å“åªèƒ½æœ‰ä¸€æ¡æœªæ”¯ä»˜è®¢å•CREATE UNIQUE INDEX uk_user_product ON orders(user_id, product_id) WHERE status = unpaid; ä½ å¯¹å…¨æ–‡ç´¢å¼•äº†è§£å¤šå°‘ï¼Ÿå…¨æ–‡ç´¢å¼•æ˜¯ MySQL ä¸€ç§ä¼˜åŒ–æ–‡æœ¬æ•°æ®æ£€ç´¢çš„ç‰¹æ®Šç±»å‹ç´¢å¼•ï¼Œé€‚ç”¨äº CHARã€VARCHAR å’Œ TEXT ç­‰å­—æ®µã€‚ MySQL 5.7 åŠä»¥ä¸Šç‰ˆæœ¬å†…ç½®äº† ngram è§£æå™¨ï¼Œå¯å¤„ç†ä¸­æ–‡ã€æ—¥æ–‡å’ŒéŸ©æ–‡ç­‰åˆ†è¯ã€‚ å»ºè¡¨æ—¶é€šè¿‡ FULLTEXT (title, body) æ¥å®šä¹‰ã€‚é€šè¿‡ MATCH(col1, col2) AGAINST(keyword) è¿›è¡Œæ£€ç´¢ï¼Œé»˜è®¤æŒ‰ç…§é™åºè¿”å›ç»“æœï¼Œæ”¯æŒå¸ƒå°”æ¨¡å¼æŸ¥è¯¢ã€‚ + è¡¨ç¤ºå¿…é¡»åŒ…å«ï¼› - è¡¨ç¤ºæ’é™¤ï¼› * è¡¨ç¤ºé€šé…ç¬¦ï¼›-- å»ºè¡¨æ—¶åˆ›å»ºå…¨æ–‡ç´¢å¼•ï¼ˆæ”¯æŒä¸­æ–‡ï¼‰CREATE TABLE articles ( id INT UNSIGNED AUTO_INCREMENT PRIMARY KEY, title VARCHAR(200), content TEXT, FULLTEXT(title, content) WITH PARSER ngram) ENGINE=InnoDB;-- ä½¿ç”¨å¸ƒå°”æ¨¡å¼æŸ¥è¯¢SELECT * FROM articles WHERE MATCH(title, content) AGAINST(+MySQL -Oracle IN BOOLEAN MODE); åº•å±‚ä½¿ç”¨å€’æ’ç´¢å¼•å°†å­—æ®µä¸­çš„æ–‡æœ¬å†…å®¹è¿›è¡Œåˆ†è¯ï¼Œç„¶åå»ºç«‹ä¸€ä¸ªå€’æ’è¡¨ã€‚æ€§èƒ½æ¯” LIKE â€˜%keyword%â€™ é«˜å¾ˆå¤šã€‚ â€”- è¿™éƒ¨åˆ†æ˜¯å¸®åŠ©ç†è§£ startï¼Œé¢è¯•ä¸­å¯ä¸èƒŒ â€”- å€’æ’ç´¢å¼•é€šè¿‡ä¸€ä¸ªè¾…åŠ©è¡¨å­˜å‚¨å•è¯ä¸å•è¯è‡ªèº«åœ¨ä¸€ä¸ªæˆ–å¤šä¸ªæ–‡æ¡£ä¸­æ‰€åœ¨ä½ç½®ä¹‹é—´çš„æ˜ å°„ï¼Œé€šå¸¸é‡‡ç”¨å…³è”æ•°ç»„å®ç°ã€‚ æœ‰ä¸¤ç§è¡¨ç°å½¢å¼ï¼šinverted file indexï¼ˆ{å•è¯ï¼Œå•è¯æ‰€åœ¨æ–‡æ¡£çš„ID}ï¼‰å’Œfull inverted indexï¼ˆ{å•è¯ï¼Œ(å•è¯æ‰€åœ¨æ–‡æ¡£çš„IDï¼Œåœ¨å…·ä½“æ–‡æ¡£ä¸­çš„ä½ç½®)}ï¼‰ æ¯”å¦‚æœ‰è¿™æ ·ä¸€ä¸ªæ–‡æ¡£ï¼š DocumentId Text 1 Pease porridge hot, pease porridge cold 2 Pease porridge in the pot 3 Nine days old 4 Some like it hot, some like it cold 5 Some like it in the pot 6 Nine days old inverted file index çš„å…³è”æ•°ç»„å­˜å‚¨å½¢å¼ä¸ºï¼š days â†’ 3,6 old â†’ 3,6 pease â†’ 1,2 porridge â†’ 1,2 ... full inverted index æ›´åŠ è¯¦ç»†ï¼š days â†’ (3:5),(6:5) old â†’ (3:11),(6:11) pease â†’ (1:1),(1:7),(2:1) porridge â†’ (1:7),(2:7) ... full inverted index ä¸ä»…å­˜å‚¨äº†æ–‡æ¡£ IDï¼Œè¿˜å­˜å‚¨äº†å•è¯åœ¨æ–‡æ¡£ä¸­çš„å…·ä½“ä½ç½®ã€‚ InnoDB é‡‡ç”¨çš„æ˜¯ full inverted index çš„æ–¹å¼å®ç°å…¨æ–‡ç´¢å¼•ã€‚ å¦‚æœéœ€è¦å¤„ç†ä¸­æ–‡åˆ†è¯çš„è¯ï¼Œä¸€å®šè¦è®°å¾—åŠ ä¸Š WITH PARSER ngramï¼Œå¦åˆ™å¯èƒ½æŸ¥ä¸å‡ºæ¥æ•°æ®ã€‚ ä¸è¿‡ï¼Œå¯¹äºå¤æ‚çš„ä¸­æ–‡åœºæ™¯ï¼Œå»ºè®®ä½¿ç”¨ Elasticsearch ç­‰ä¸“ä¸šæœç´¢å¼•æ“æ›¿ä»£ï¼ŒæŠ€æœ¯æ´¾é¡¹ç›®ä¸­å°±ç”¨äº†è¿™ç§æ–¹æ¡ˆã€‚ â€”- è¿™éƒ¨åˆ†æ˜¯å¸®åŠ©ç†è§£ endï¼Œé¢è¯•ä¸­å¯ä¸èƒŒ â€”- 37.ğŸŒŸåˆ›å»ºç´¢å¼•æœ‰å“ªäº›æ³¨æ„ç‚¹ï¼Ÿç¬¬ä¸€ï¼Œé€‰æ‹©åˆé€‚çš„å­—æ®µ æ¯”å¦‚è¯´é¢‘ç¹å‡ºç°åœ¨ WHEREã€JOINã€ORDER BYã€GROUP BY ä¸­çš„å­—æ®µã€‚ ä¼˜å…ˆé€‰æ‹©åŒºåˆ†åº¦é«˜çš„å­—æ®µï¼Œæ¯”å¦‚ç”¨æˆ· IDã€æ‰‹æœºå·ç­‰å”¯ä¸€å€¼å¤šçš„ï¼Œè€Œä¸æ˜¯æ€§åˆ«ã€çŠ¶æ€ç­‰åŒºåˆ†åº¦æä½çš„å­—æ®µï¼Œå¦‚æœçœŸçš„éœ€è¦ï¼Œå¯ä»¥è€ƒè™‘è”åˆç´¢å¼•ã€‚ ç¬¬äºŒï¼Œè¦æ§åˆ¶ç´¢å¼•çš„æ•°é‡ï¼Œé¿å…è¿‡åº¦ç´¢å¼•ï¼Œæ¯ä¸ªç´¢å¼•éƒ½è¦å ç”¨å­˜å‚¨ç©ºé—´ï¼Œå•è¡¨çš„ç´¢å¼•æ•°é‡ä¸å»ºè®®è¶…è¿‡ 5 ä¸ªã€‚ è¦å®šæœŸé€šè¿‡ SHOW INDEX FROM table_name æŸ¥çœ‹ç´¢å¼•çš„ä½¿ç”¨æƒ…å†µï¼Œåˆ é™¤ä¸å¿…è¦çš„ç´¢å¼•ã€‚æ¯”å¦‚è¯´å·²ç»æœ‰è”åˆç´¢å¼• (a, b)ï¼Œå•ç´¢å¼•ï¼ˆaï¼‰å°±æ˜¯å†—ä½™çš„ã€‚ ç¬¬ä¸‰ï¼Œè”åˆç´¢å¼•çš„æ—¶å€™è¦éµå¾ªæœ€å·¦å‰ç¼€åŸåˆ™ï¼Œå³åœ¨æŸ¥è¯¢æ¡ä»¶ä¸­ä½¿ç”¨è”åˆç´¢å¼•çš„ç¬¬ä¸€ä¸ªå­—æ®µï¼Œæ‰èƒ½å……åˆ†åˆ©ç”¨ç´¢å¼•ã€‚ æ¯”å¦‚è¯´è”åˆç´¢å¼• (A, B, C) å¯æ”¯æŒ Aã€A+Bã€A+B+C çš„æŸ¥è¯¢ï¼Œä½†æ— æ³•æ”¯æŒ B æˆ– C çš„å•ç‹¬æŸ¥è¯¢ã€‚ åŒºåˆ†åº¦é«˜çš„å­—æ®µæ”¾åœ¨å·¦ä¾§ï¼Œç­‰å€¼æŸ¥è¯¢çš„å­—æ®µä¼˜å…ˆäºèŒƒå›´æŸ¥è¯¢çš„å­—æ®µã€‚ä¾‹å¦‚ WHERE A1 AND B10 AND C2ï¼Œä¼˜å…ˆ (A, C, B)ã€‚ å¦‚æœè”åˆç´¢å¼•åŒ…å«æŸ¥è¯¢çš„æ‰€éœ€å­—æ®µï¼Œè¿˜å¯ä»¥é¿å…å›è¡¨ï¼Œæé«˜æŸ¥è¯¢æ•ˆç‡ã€‚ 38.ğŸŒŸç´¢å¼•å“ªäº›æƒ…å†µä¸‹ä¼šå¤±æ•ˆå‘¢ï¼Ÿç®€ç‰ˆï¼šæ¯”å¦‚ç´¢å¼•åˆ—ä½¿ç”¨äº†å‡½æ•°ã€ä½¿ç”¨äº†é€šé…ç¬¦å¼€å¤´çš„æ¨¡ç³ŠæŸ¥è¯¢ã€è”åˆç´¢å¼•ä¸æ»¡è¶³æœ€å·¦å‰ç¼€åŸåˆ™ï¼Œæˆ–è€…ä½¿ç”¨ or çš„æ—¶å€™éƒ¨åˆ†å­—æ®µæ— ç´¢å¼•ç­‰ã€‚ ç¬¬ä¸€ï¼Œå¯¹ç´¢å¼•åˆ—ä½¿ç”¨å‡½æ•°æˆ–è¡¨è¾¾å¼ä¼šå¯¼è‡´ç´¢å¼•å¤±æ•ˆã€‚ -- ç´¢å¼•å¤±æ•ˆSELECT * FROM users WHERE YEAR(create_time) = 2023;SELECT * FROM products WHERE price*2 100;-- ä¼˜åŒ–æ–¹æ¡ˆï¼ˆä½¿ç”¨èŒƒå›´æŸ¥è¯¢ï¼‰SELECT * FROM users WHERE create_time BETWEEN 2023-01-01 AND 2023-12-31;SELECT * FROM products WHERE price 50; ç¬¬äºŒï¼ŒLIKE æ¨¡ç³ŠæŸ¥è¯¢ä»¥é€šé…ç¬¦å¼€å¤´ä¼šå¯¼è‡´ç´¢å¼•å¤±æ•ˆã€‚ -- ç´¢å¼•å¤±æ•ˆSELECT * FROM articles WHERE title LIKE %æ•°æ®åº“%;-- å¯ä»¥ä½¿ç”¨ç´¢å¼•ï¼ˆä½†èŒƒå›´æœ‰é™ï¼‰SELECT * FROM articles WHERE title LIKE æ•°æ®åº“%;-- è§£å†³æ–¹æ¡ˆï¼šè€ƒè™‘å…¨æ–‡ç´¢å¼•æˆ–æœç´¢å¼•æ“SELECT * FROM articles WHERE MATCH(title) AGAINST(æ•°æ®åº“); ç¬¬ä¸‰ï¼Œè”åˆç´¢å¼•è¿åäº†æœ€å·¦å‰ç¼€åŸåˆ™ï¼Œç´¢å¼•ä¼šå¤±æ•ˆã€‚ -- å‡è®¾æœ‰è”åˆç´¢å¼• (a, b, c)SELECT * FROM table WHERE b = 2 AND c = 3; -- ç´¢å¼•å¤±æ•ˆSELECT * FROM table WHERE a = 1 AND c = 3; -- åªä½¿ç”¨aåˆ—ç´¢å¼•-- æ­£ç¡®ä½¿ç”¨è”åˆç´¢å¼•SELECT * FROM table WHERE a = 1 AND b = 2 AND c = 3; è”åˆç´¢å¼•ï¼Œä½† WHERE ä¸æ»¡è¶³æœ€å·¦å‰ç¼€åŸåˆ™ï¼Œç´¢å¼•æ— æ³•èµ·æ•ˆã€‚ä¾‹å¦‚ï¼šSELECT * FROM table WHERE column2 = 2ï¼Œè”åˆç´¢å¼•ä¸º (column1, column2)ã€‚ â€”- è¿™éƒ¨åˆ†æ˜¯å¸®åŠ©ç†è§£ startï¼Œé¢è¯•ä¸­å¯ä¸èƒŒ â€”- ç¬¬å››ï¼Œä½¿ç”¨ OR è¿æ¥éç´¢å¼•åˆ—æ¡ä»¶ï¼Œä¼šå¯¼è‡´ç´¢å¼•å¤±æ•ˆã€‚ -- å‡è®¾nameæœ‰ç´¢å¼•ä½†ageæ²¡æœ‰SELECT * FROM users WHERE name = å¼ ä¸‰ OR age = 25; -- å…¨è¡¨æ‰«æ-- ä¼˜åŒ–æ–¹æ¡ˆ1ï¼šä½¿ç”¨UNION ALLSELECT * FROM users WHERE name = å¼ ä¸‰UNION ALLSELECT * FROM users WHERE age = 25 AND name != å¼ ä¸‰;-- ä¼˜åŒ–æ–¹æ¡ˆ2ï¼šè€ƒè™‘ä¸ºageæ·»åŠ ç´¢å¼• ç¬¬äº”ï¼Œä½¿ç”¨ ! æˆ– ä¸ç­‰å€¼æŸ¥è¯¢ä¼šå¯¼è‡´ç´¢å¼•å¤±æ•ˆã€‚ SELECT * FROM user WHERE status != 1; -- è‹¥å¤§éƒ¨åˆ†è¡Œ `status=1`ï¼Œå¯èƒ½å…¨è¡¨æ‰«æ-- ä¼˜åŒ–æ–¹æ¡ˆï¼šä½¿ç”¨èŒƒå›´æŸ¥è¯¢SELECT * FROM user WHERE status 1 OR status 1; â€”- è¿™éƒ¨åˆ†æ˜¯å¸®åŠ©ç†è§£ endï¼Œé¢è¯•ä¸­å¯ä¸èƒŒ â€”- ä»€ä¹ˆæƒ…å†µä¸‹æ¨¡ç³ŠæŸ¥è¯¢ä¸èµ°ç´¢å¼•ï¼Ÿæ¨¡ç³ŠæŸ¥è¯¢ä¸»è¦ä½¿ç”¨ LIKE è¯­å¥ï¼Œç»“åˆé€šé…ç¬¦æ¥å®ç°ã€‚%ï¼ˆä»£è¡¨ä»»æ„å¤šä¸ªå­—ç¬¦ï¼‰å’Œ _ï¼ˆä»£è¡¨å•ä¸ªå­—ç¬¦ï¼‰ SELECT * FROM table WHERE column LIKE %xxx%; è¿™ä¸ªæŸ¥è¯¢ä¼šè¿”å›æ‰€æœ‰ column åˆ—ä¸­åŒ…å« xxx çš„è®°å½•ã€‚ä½†æ˜¯ï¼Œå¦‚æœæ¨¡ç³ŠæŸ¥è¯¢çš„é€šé…ç¬¦** % å‡ºç°åœ¨æœç´¢å­—ç¬¦ä¸²çš„å¼€å§‹ä½ç½®ï¼Œå¦‚ LIKE â€˜%xxxâ€™ï¼ŒMySQL å°†æ— æ³•ä½¿ç”¨ç´¢å¼•ï¼Œå› ä¸ºæ•°æ®åº“å¿…é¡»æ‰«æå…¨è¡¨ä»¥åŒ¹é…ä»»æ„ä½ç½®çš„å­—ç¬¦ä¸²**ã€‚ 39.ç´¢å¼•ä¸é€‚åˆå“ªäº›åœºæ™¯å‘¢ï¼Ÿç¬¬ä¸€ï¼ŒåŒºåˆ†åº¦ä½çš„åˆ—ï¼Œå¯ä»¥å’Œå…¶ä»–é«˜åŒºåˆ†åº¦çš„åˆ—ç»„æˆè”åˆç´¢å¼•ã€‚ ç¬¬äºŒï¼Œé¢‘ç¹æ›´æ–°çš„åˆ—ï¼Œç´¢å¼•ä¼šå¢åŠ æ›´æ–°çš„æˆæœ¬ã€‚ ç¬¬ä¸‰ï¼ŒTEXTã€BLOB ç­‰å¤§å¯¹è±¡ç±»å‹çš„å­—æ®µï¼Œå¯ä»¥ä½¿ç”¨å‰ç¼€ç´¢å¼•ã€å…¨æ–‡ç´¢å¼•æ›¿ä»£ã€‚ ç¬¬å››ï¼Œå½“è¡¨çš„æ•°æ®é‡å¾ˆå°çš„æ—¶å€™ï¼Œä¸è¶…è¿‡ 1000 è¡Œï¼Œå…¨è¡¨æ‰«æå¯èƒ½æ¯”ä½¿ç”¨ç´¢å¼•æ›´å¿«ã€‚ â€”- è¿™éƒ¨åˆ†æ˜¯å¸®åŠ©ç†è§£ startï¼Œé¢è¯•ä¸­å¯ä¸èƒŒ â€”- åŸå› æ—¶å½“æ•°æ®é‡å¾ˆå°æ—¶ï¼Œå…¨è¡¨æ‰«æçš„æˆæœ¬å¾ˆä½ï¼Œå› ä¸ºæ‰€æœ‰çš„æ•°æ®å¯èƒ½éƒ½åŠ è½½åˆ°å†…å­˜ä¸­äº†ï¼Œä½¿ç”¨ç´¢å¼•åè€Œéœ€è¦å…ˆæŸ¥æ‰¾ç´¢å¼•ï¼Œå†é€šè¿‡ç´¢å¼•å»æ‰¾åˆ°å®é™…çš„æ•°æ®è¡Œï¼Œå¢åŠ äº†é¢å¤–çš„ IO å¯»å€æ—¶é—´ã€‚ â€”- è¿™éƒ¨åˆ†æ˜¯å¸®åŠ©ç†è§£ endï¼Œé¢è¯•ä¸­å¯ä¸èƒŒ â€”- æ€§åˆ«å­—æ®µè¦å»ºç«‹ç´¢å¼•å—ï¼Ÿæ€§åˆ«å­—æ®µä¸é€‚åˆå»ºç«‹å•ç‹¬ç´¢å¼•ã€‚å› ä¸ºæ€§åˆ«å­—æ®µçš„åŒºåˆ†åº¦å¾ˆä½ã€‚å¦‚æœæ€§åˆ«å­—æ®µç¡®å®ç»å¸¸ç”¨äºæŸ¥è¯¢æ¡ä»¶ï¼Œæ•°æ®è§„æ¨¡ä¹Ÿæ¯”è¾ƒå¤§ï¼Œå¯ä»¥å°†æ€§åˆ«å­—æ®µä½œä¸ºè”åˆç´¢å¼•çš„ä¸€éƒ¨åˆ†ï¼Œä¸åŒºåˆ†åº¦é«˜çš„å­—æ®µä¸€èµ·ï¼Œæ•ˆæœä¼šå¥½å¾ˆå¤šã€‚ ä»€ä¹ˆæ˜¯åŒºåˆ†åº¦ï¼ŸåŒºåˆ†åº¦æ˜¯è¡¡é‡ä¸€ä¸ªå­—æ®µåœ¨ MySQL è¡¨ä¸­å”¯ä¸€å€¼çš„æ¯”ä¾‹ã€‚ åŒºåˆ†åº¦ = å­—æ®µçš„å”¯ä¸€å€¼æ•°é‡ / å­—æ®µçš„æ€»è®°å½•æ•°ï¼›è¶Šæ¥è¿‘ 1ï¼Œå°±è¶Šé€‚åˆä½œä¸ºç´¢å¼•ã€‚å› ä¸ºç´¢å¼•å¯ä»¥æ›´æœ‰æ•ˆåœ°ç¼©å°æŸ¥è¯¢èŒƒå›´ã€‚ ä¾‹å¦‚ï¼Œä¸€ä¸ªè¡¨ä¸­æœ‰ 1000 æ¡è®°å½•ï¼Œå…¶ä¸­æ€§åˆ«å­—æ®µåªæœ‰ä¸¤ä¸ªå€¼ï¼ˆç”·ã€å¥³ï¼‰ï¼Œé‚£ä¹ˆæ€§åˆ«å­—æ®µçš„åŒºåˆ†åº¦åªæœ‰ 0.002ï¼Œå°±ä¸é€‚åˆå»ºç«‹ç´¢å¼•ã€‚ å¯ä»¥é€šè¿‡COUNT(DISTINCT column_name)å’ŒCOUNT(*)çš„æ¯”å€¼æ¥è®¡ç®—å­—æ®µçš„åŒºåˆ†åº¦ã€‚ä¾‹å¦‚ï¼š SELECT COUNT(DISTINCT gender) / COUNT(*) AS gender_selectivityFROM users; ä»€ä¹ˆæ ·çš„å­—æ®µé€‚åˆåŠ ç´¢å¼•ï¼Ÿä¸€å¥è¯å›ç­”ï¼šä¸€èˆ¬æ¥è¯´ï¼Œä¸»é”®ã€å”¯ä¸€é”®ã€ä»¥åŠç»å¸¸ä½œä¸ºæŸ¥è¯¢æ¡ä»¶çš„å­—æ®µæœ€é€‚åˆåŠ ç´¢å¼•ã€‚é™¤æ­¤ä¹‹å¤–ï¼Œå­—æ®µçš„åŒºåˆ†åº¦è¦é«˜ï¼Œè¿™æ ·ç´¢å¼•æ‰èƒ½èµ·åˆ°è¿‡æ»¤ä½œç”¨ï¼›å¦‚æœå­—æ®µç»å¸¸ç”¨äºè¡¨è¿æ¥ã€æ’åºæˆ–åˆ†ç»„ï¼Œä¹Ÿå»ºè®®åŠ ç´¢å¼•ã€‚åŒæ—¶å¦‚æœå¤šä¸ªå­—æ®µç»å¸¸ä¸€èµ·å‡ºç°åœ¨æŸ¥è¯¢æ¡ä»¶ä¸­ï¼Œä¹Ÿå¯ä»¥å»ºç«‹è”åˆç´¢å¼•æ¥æå‡æ€§èƒ½ã€‚ â€”- è¿™éƒ¨åˆ†æ˜¯å¸®åŠ©ç†è§£ startï¼Œé¢è¯•ä¸­å¯ä¸èƒŒ â€”- æŸ¥è¯¢æ¡ä»¶ä¸­çš„é«˜é¢‘å­—æ®µï¼Œæ¯”å¦‚è¯´WHEREå­å¥ä¸­é¢‘ç¹ç”¨äºç­‰å€¼æŸ¥è¯¢ã€èŒƒå›´æŸ¥è¯¢æˆ–è€… IN åˆ—è¡¨çš„å­—æ®µã€‚ SELECT * FROM orders WHERE status = PAID AND create_time 2023-01-01;-- è‹¥`status`å’Œ`create_time`å¸¸ç»„åˆæŸ¥è¯¢ï¼Œå»ºè”åˆç´¢å¼•`(status, create_time)` å¤šè¡¨è¿æ¥æ—¶çš„å…³è”å­—æ®µï¼Œæ¯”å¦‚è¯´ user.id å’Œ order.user_idã€‚ SELECT * FROM user u JOIN order o ON u.id = o.user_id; -- `user_id`éœ€ç´¢å¼• å‚ä¸æ’åºæˆ–è€…åˆ†ç»„çš„å­—æ®µï¼Œå¯ä»¥ç›´æ¥åˆ©ç”¨ç´¢å¼•çš„æœ‰åºæ€§ï¼Œé¿å…æ–‡ä»¶æ’åºã€‚ SELECT * FROM product ORDER BY price DESC; -- å•å­—æ®µæ’åºSELECT category, COUNT(*) FROM product GROUP BY category; -- åˆ†ç»„ç»Ÿè®¡ éœ€è¦åˆ©ç”¨è¦†ç›–ç´¢å¼•çš„å­—æ®µï¼Œå¯ä»¥é¿å…å›è¡¨æ“ä½œã€‚ -- åˆ›å»ºè”åˆç´¢å¼•`(user_id, create_time)`SELECT user_id, create_time FROM orders WHERE user_id = 100; -- è¦†ç›–ç´¢å¼•ç”Ÿæ•ˆ â€”- è¿™éƒ¨åˆ†æ˜¯å¸®åŠ©ç†è§£ endï¼Œé¢è¯•ä¸­å¯ä¸èƒŒ â€”- 40.ç´¢å¼•æ˜¯ä¸æ˜¯å»ºçš„è¶Šå¤šè¶Šå¥½ï¼Ÿç´¢å¼•ä¸æ˜¯è¶Šå¤šè¶Šå¥½ã€‚è™½ç„¶ç´¢å¼•å¯ä»¥åŠ å¿«æŸ¥è¯¢ï¼Œä½†ä¹Ÿä¼šå¸¦æ¥å†™å…¥å˜æ…¢ã€å ç”¨æ›´å¤šå­˜å‚¨ç©ºé—´ã€ç”šè‡³è®©ä¼˜åŒ–å™¨é€‰é”™ç´¢å¼•çš„é£é™©ã€‚ â€”- è¿™éƒ¨åˆ†æ˜¯å¸®åŠ©ç†è§£ startï¼Œé¢è¯•ä¸­å¯ä¸èƒŒ â€”- æ¯æ¬¡æ•°æ®å†™å…¥ï¼ˆINSERTUPDATEDELETEï¼‰æ—¶ï¼ŒMySQL éƒ½éœ€åŒæ­¥æ›´æ–°æ‰€æœ‰ç›¸å…³ç´¢å¼•ï¼Œç´¢å¼•è¶Šå¤šï¼Œç»´æŠ¤æˆæœ¬è¶Šé«˜ã€‚ å‡å¦‚æŸè¡¨æœ‰ 10 ä¸ªç´¢å¼•ï¼Œæ’å…¥ä¸€è¡Œæ•°æ®éœ€æ›´æ–° 10 ä¸ª B+æ ‘ç»“æ„ï¼Œå¯¼è‡´å†™å…¥å»¶è¿Ÿå¢åŠ  5~10 å€ã€‚ å‡å¦‚æŸè¡¨æ•°æ®é‡ 100GBï¼Œè‹¥å»º 5 ä¸ªç´¢å¼•ï¼Œæ€»å­˜å‚¨å¯èƒ½è¾¾åˆ° 200GB+ã€‚ ç´¢å¼•è¿‡å¤šæ—¶ï¼Œä¼˜åŒ–å™¨éœ€è¯„ä¼°æ›´å¤šå¯èƒ½çš„æ‰§è¡Œè·¯å¾„ï¼Œå¯èƒ½å¯¼è‡´é€‰æ‹©å›°éš¾ç—‡ï¼Œä¼˜åŒ–å™¨ä¹Ÿä¼šé€‰é”™ç´¢å¼•ã€‚ å†æ¯”å¦‚è¯´ï¼Œå·²æœ‰è”åˆç´¢å¼• (A, B, C)ï¼Œå†å•ç‹¬å»º (A) æˆ– (A, B) ç´¢å¼•å³ä¸ºå†—ä½™ã€‚ å•è¡¨ç´¢å¼•æ•°é‡å»ºè®®ä¸è¶…è¿‡ 5 ä¸ªï¼ŒMySQL å®˜æ–¹å»ºè®®å•è¡¨ç´¢å¼•æ€»å­—æ®µæ•° â‰¤ è¡¨å­—æ®µæ•°çš„ 30%ã€‚ â€”- è¿™éƒ¨åˆ†æ˜¯å¸®åŠ©ç†è§£ endï¼Œé¢è¯•ä¸­å¯ä¸èƒŒ â€”- è¯´è¯´ç´¢å¼•ä¼˜åŒ–çš„æ€è·¯ï¼Ÿä¸€å¥è¯å›ç­”ï¼šå…ˆé€šè¿‡æ…¢æŸ¥è¯¢æ—¥å¿—æ‰¾å‡ºæ€§èƒ½ç“¶é¢ˆï¼Œç„¶åç”¨ EXPLAIN åˆ†ææ‰§è¡Œè®¡åˆ’ï¼Œåˆ¤æ–­æ˜¯å¦èµ°äº†ç´¢å¼•ã€æ˜¯å¦å›è¡¨ã€æ˜¯å¦æ’åºã€‚æ¥ç€æ ¹æ®å­—æ®µç‰¹æ€§è®¾è®¡åˆé€‚çš„ç´¢å¼•ï¼Œå¦‚é€‰æ‹©åŒºåˆ†åº¦é«˜çš„å­—æ®µï¼Œä½¿ç”¨è”åˆç´¢å¼•å’Œè¦†ç›–ç´¢å¼•ï¼Œé¿å…ç´¢å¼•å¤±æ•ˆçš„å†™æ³•ï¼Œæœ€åé€šè¿‡å®æµ‹æ¥éªŒè¯ä¼˜åŒ–æ•ˆæœã€‚ 41.ğŸŒŸä¸ºä»€ä¹ˆ InnoDB è¦ä½¿ç”¨ B+æ ‘ä½œä¸ºç´¢å¼•ï¼Ÿä¸€å¥è¯æ€»ç»“ï¼šå› ä¸º B+ æ ‘æ˜¯ä¸€ç§é«˜åº¦å¹³è¡¡çš„å¤šè·¯æŸ¥æ‰¾æ ‘ï¼Œèƒ½æœ‰æ•ˆé™ä½ç£ç›˜çš„ IO æ¬¡æ•°ï¼Œå¹¶ä¸”æ”¯æŒæœ‰åºéå†å’ŒèŒƒå›´æŸ¥è¯¢ã€‚ æŸ¥è¯¢æ€§èƒ½éå¸¸é«˜ï¼Œå…¶ç»“æ„ä¹Ÿé€‚åˆ MySQL æŒ‰ç…§é¡µä¸ºå•ä½åœ¨ç£ç›˜ä¸Šå­˜å‚¨ã€‚ åƒå…¶ä»–é€‰é¡¹ï¼Œæ¯”å¦‚è¯´å“ˆå¸Œè¡¨ä¸æ”¯æŒèŒƒå›´æŸ¥è¯¢ï¼ŒäºŒå‰æ ‘å±‚çº§å¤ªæ·±ï¼ŒB æ ‘åˆä¸æ–¹ä¾¿èŒƒå›´æ‰«æï¼Œæ‰€ä»¥æœ€ç»ˆé€‰æ‹©äº† B+ æ ‘ã€‚ å†æ¢ä¸€ç§å›ç­”ï¼š ç›¸æ¯”å“ˆå¸Œè¡¨ï¼šB+ æ ‘æ”¯æŒèŒƒå›´æŸ¥è¯¢å’Œæ’åºç›¸æ¯”äºŒå‰æ ‘å’Œçº¢é»‘æ ‘ï¼šB+ æ ‘æ›´â€œçŸ®èƒ–â€ï¼Œå±‚çº§æ›´å°‘ï¼Œç£ç›˜ IO æ¬¡æ•°æ›´å°‘ç›¸æ¯” B æ ‘ï¼šB+ æ ‘çš„éå¶å­èŠ‚ç‚¹åªå­˜å‚¨é”®å€¼ï¼Œå¶å­èŠ‚ç‚¹å­˜å‚¨æ•°æ®å¹¶é€šè¿‡é“¾è¡¨è¿æ¥ï¼Œæ”¯æŒèŒƒå›´æŸ¥è¯¢å¦å¤–ä¸€ç§å›ç­”ç‰ˆæœ¬ï¼š B+æ ‘æ˜¯ä¸€ç§è‡ªå¹³è¡¡çš„å¤šè·¯æŸ¥æ‰¾æ ‘ï¼Œå’Œçº¢é»‘æ ‘ã€äºŒå‰å¹³è¡¡æ ‘ä¸åŒï¼ŒB+æ ‘çš„æ¯ä¸ªèŠ‚ç‚¹å¯ä»¥æœ‰ m ä¸ªå­èŠ‚ç‚¹ï¼Œè€Œçº¢é»‘æ ‘å’ŒäºŒå‰å¹³è¡¡æ ‘éƒ½åªæœ‰ 2 ä¸ªã€‚ å¦å¤–ï¼Œå’Œ B æ ‘ä¸åŒï¼ŒB+æ ‘çš„éå¶å­èŠ‚ç‚¹åªå­˜å‚¨é”®å€¼ï¼Œä¸å­˜å‚¨æ•°æ®ï¼Œè€Œå¶å­èŠ‚ç‚¹å­˜å‚¨äº†æ‰€æœ‰çš„æ•°æ®ï¼Œå¹¶ä¸”æ„æˆäº†ä¸€ä¸ªæœ‰åºé“¾è¡¨ã€‚ è¿™æ ·åšçš„å¥½å¤„æ˜¯ï¼Œéå¶å­èŠ‚ç‚¹ä¸Šç”±äºæ²¡æœ‰å­˜å‚¨æ•°æ®ï¼Œå°±å¯ä»¥å­˜å‚¨æ›´å¤šçš„é”®å€¼å¯¹ï¼Œå†åŠ ä¸Šå¶å­èŠ‚ç‚¹æ„æˆäº†ä¸€ä¸ªæœ‰åºé“¾è¡¨ï¼ŒèŒƒå›´æŸ¥è¯¢æ—¶å°±å¯ä»¥ç›´æ¥é€šè¿‡å¶å­èŠ‚ç‚¹é—´çš„æŒ‡é’ˆé¡ºåºè®¿é—®æ•´ä¸ªæŸ¥è¯¢èŒƒå›´å†…çš„æ‰€æœ‰è®°å½•ï¼Œè€Œæ— éœ€å¯¹æ ‘è¿›è¡Œå¤šæ¬¡éå†ã€‚æŸ¥è¯¢çš„æ•ˆç‡æ¯” B æ ‘æ›´é«˜ã€‚ å…ˆè¯´è¯´ B æ ‘ã€‚B æ ‘æ˜¯ä¸€ç§è‡ªå¹³è¡¡çš„å¤šè·¯æŸ¥æ‰¾æ ‘ï¼Œå’Œçº¢é»‘æ ‘ã€äºŒå‰å¹³è¡¡æ ‘ä¸åŒï¼ŒB æ ‘çš„æ¯ä¸ªèŠ‚ç‚¹å¯ä»¥æœ‰ m ä¸ªå­èŠ‚ç‚¹ï¼Œè€Œçº¢é»‘æ ‘å’ŒäºŒå‰å¹³è¡¡æ ‘éƒ½åªæœ‰ 2 ä¸ªã€‚æ¢å¥è¯è¯´ï¼Œçº¢é»‘æ ‘ã€äºŒå‰å¹³è¡¡æ ‘æ˜¯ç»†é«˜ä¸ªï¼Œè€Œ B æ ‘æ˜¯çŸ®èƒ–å­ã€‚ å†æ¥è¯´è¯´å†…å­˜å’Œç£ç›˜çš„ IO è¯»å†™ã€‚ ä¸ºäº†æé«˜è¯»å†™æ•ˆç‡ï¼Œä»ç£ç›˜å¾€å†…å­˜ä¸­è¯»æ•°æ®çš„æ—¶å€™ï¼Œä¸€æ¬¡ä¼šè¯»å–è‡³å°‘ä¸€é¡µçš„æ•°æ®ï¼Œå¦‚æœä¸æ»¡ä¸€é¡µï¼Œä¼šå†å¤šè¯»ç‚¹ã€‚ æ¯”å¦‚è¯´æŸ¥è¯¢åªéœ€è¦è¯»å– 2KB çš„æ•°æ®ï¼Œä½† MySQL å®é™…ä¸Šä¼šè¯»å– 4KB çš„æ•°æ®ï¼Œä»¥è£…æ»¡æ•´é¡µã€‚é¡µæ˜¯ MySQL è¿›è¡Œå†…å­˜å’Œç£ç›˜äº¤äº’çš„æœ€å°é€»è¾‘å•å…ƒã€‚ å†æ¯”å¦‚è¯´éœ€è¦è¯»å– 5KB çš„æ•°æ®ï¼Œå®é™…ä¸Š MySQL ä¼šè¯»å– 8KB çš„æ•°æ®ï¼Œåˆšå¥½ä¸¤é¡µã€‚ å› ä¸ºè¯»çš„æ¬¡æ•°è¶Šå¤šï¼Œæ•ˆç‡å°±è¶Šä½ã€‚å°±å¥½æ¯”æˆ‘ä»¬åœ¨å·¥åœ°ä¸Šæ¬ç –ï¼Œä¸€æ¬¡æ¬ 10 å—ç –è‚¯å®šæ¯”ä¸€æ¬¡æ¬ 1 å—ç –çš„æ•ˆç‡è¦é«˜ï¼Œåæ­£æˆ‘æ¯æ¬¡éƒ½æ¬ 10 å—ï¼ˆğŸ˜ï¼‰ã€‚ å¯¹äºçº¢é»‘æ ‘ã€äºŒå‰å¹³è¡¡æ ‘è¿™ç§ç»†é«˜ä¸ªæ¥è¯´ï¼Œæ¯æ¬¡æ¬çš„ç –å°‘ï¼Œå› ä¸ºåŠ›æ°”ä¸å¤Ÿå˜›ï¼Œé‚£æ¥å›è·‘çš„æ¬¡æ•°å°±è¶Šå¤šã€‚ é€šå¸¸ B+ æ ‘é«˜åº¦ä¸º 3-4 å±‚å³å¯æ”¯æŒ TB çº§æ•°æ®ï¼Œè€Œæ¯æ¬¡æŸ¥è¯¢åªéœ€ 2-4 æ¬¡ç£ç›˜ IOï¼Œè¿œä½äºäºŒå‰æ ‘æˆ–çº¢é»‘æ ‘çš„ O(log2N) å¤æ‚åº¦ æ ‘è¶Šé«˜ï¼Œæ„å‘³ç€æŸ¥æ‰¾æ•°æ®æ—¶å°±éœ€è¦æ›´å¤šçš„ç£ç›˜ IOï¼Œå› ä¸ºæ¯ä¸€å±‚éƒ½å¯èƒ½éœ€è¦ä»ç£ç›˜åŠ è½½æ–°çš„èŠ‚ç‚¹ã€‚ B æ ‘çš„èŠ‚ç‚¹é€šå¸¸ä¸é¡µçš„å¤§å°å¯¹é½ï¼Œè¿™æ ·æ¯æ¬¡ä»ç£ç›˜åŠ è½½ä¸€ä¸ªèŠ‚ç‚¹æ—¶ï¼Œæ­£å¥½å°±æ˜¯ä¸€é¡µçš„å¤§å°ã€‚ B æ ‘çš„ä¸€ä¸ªèŠ‚ç‚¹é€šå¸¸åŒ…æ‹¬ä¸‰ä¸ªéƒ¨åˆ†ï¼š é”®å€¼ï¼šå³è¡¨ä¸­çš„ä¸»é”® æŒ‡é’ˆï¼šå­˜å‚¨å­èŠ‚ç‚¹çš„ä¿¡æ¯ æ•°æ®ï¼šé™¤ä¸»é”®å¤–çš„è¡Œæ•°æ®æ­£æ‰€è°“â€œç¥¸å…®ç¦æ‰€å€šï¼Œç¦å…®ç¥¸æ‰€ä¼â€ï¼Œå› ä¸º B æ ‘çš„æ¯ä¸ªèŠ‚ç‚¹ä¸Šéƒ½å­˜å‚¨äº†æ•°æ®ï¼Œå°±å¯¼è‡´æ¯ä¸ªèŠ‚ç‚¹èƒ½å­˜å‚¨çš„é”®å€¼å’ŒæŒ‡é’ˆå˜å°‘äº†ï¼Œå› ä¸ºæ¯ä¸€ä¸ªèŠ‚ç‚¹çš„å¤§å°æ˜¯å›ºå®šçš„ï¼Œå¯¹å§ï¼Ÿäºæ˜¯ B+æ ‘å°±æ¥äº†ï¼ŒB+æ ‘çš„éå¶å­èŠ‚ç‚¹åªå­˜å‚¨é”®å€¼ï¼Œä¸å­˜å‚¨æ•°æ®ï¼Œè€Œå¶å­èŠ‚ç‚¹ä¼šå­˜å‚¨æ‰€æœ‰çš„è¡Œæ•°æ®ï¼Œå¹¶ä¸”æ„æˆä¸€ä¸ªæœ‰åºé“¾è¡¨ã€‚ è¿™æ ·åšçš„å¥½å¤„æ˜¯ï¼Œéå¶å­èŠ‚ç‚¹ç”±äºæ²¡æœ‰å­˜å‚¨æ•°æ®ï¼Œå°±å¯ä»¥å­˜å‚¨æ›´å¤šçš„é”®å€¼å¯¹ï¼Œæ ‘å°±å˜å¾—æ›´åŠ çŸ®èƒ–äº†ï¼Œäºæ˜¯å°±æ›´æœ‰åŠ²äº†ï¼Œæ¯æ¬¡æ¬çš„ç –ä¹Ÿå°±æ›´å¤šäº†ï¼ˆğŸ˜‚ï¼‰ã€‚ ç›¸æ¯” B æ ‘ï¼ŒB+ æ ‘çš„éå¶å­èŠ‚ç‚¹å¯å®¹çº³çš„é”®å€¼æ›´å¤šï¼Œä¸€ä¸ª 16KB çš„èŠ‚ç‚¹å¯å­˜å‚¨çº¦ 1200 ä¸ªé”®å€¼ï¼Œå¤§å¹…é™ä½æ ‘çš„é«˜åº¦ã€‚ ç”±æ­¤ä¸€æ¥ï¼ŒæŸ¥æ‰¾æ•°æ®è¿›è¡Œçš„ç£ç›˜ IO å°±æ›´å°‘äº†ï¼ŒæŸ¥è¯¢çš„æ•ˆç‡ä¹Ÿå°±æ›´é«˜äº†ã€‚ å†åŠ ä¸Šå¶å­èŠ‚ç‚¹æ„æˆäº†ä¸€ä¸ªæœ‰åºé“¾è¡¨ï¼ŒèŒƒå›´æŸ¥è¯¢æ—¶å°±å¯ä»¥ç›´æ¥é€šè¿‡å¶å­èŠ‚ç‚¹é—´çš„æŒ‡é’ˆé¡ºåºè®¿é—®æ•´ä¸ªæŸ¥è¯¢èŒƒå›´å†…çš„æ‰€æœ‰è®°å½•ï¼Œè€Œæ— éœ€å¯¹æ ‘è¿›è¡Œå¤šæ¬¡éå†ã€‚ B æ ‘å°±åšä¸åˆ°è¿™ä¸€ç‚¹ã€‚ â€”- è¿™éƒ¨åˆ†æ˜¯å¸®åŠ©ç†è§£ endï¼Œé¢è¯•ä¸­å¯ä¸èƒŒ â€”- B+æ ‘çš„å¶å­èŠ‚ç‚¹æ˜¯å•å‘é“¾è¡¨è¿˜æ˜¯åŒå‘é“¾è¡¨ï¼Ÿå¦‚æœä»å¤§å€¼å‘å°å€¼æ£€ç´¢ï¼Œå¦‚ä½•æ“ä½œï¼ŸB+æ ‘çš„å¶å­èŠ‚ç‚¹æ˜¯é€šè¿‡åŒå‘é“¾è¡¨è¿æ¥çš„ï¼Œè¿™æ ·å¯ä»¥æ–¹ä¾¿èŒƒå›´æŸ¥è¯¢å’Œåå‘éå†ã€‚ å½“æ‰§è¡ŒèŒƒå›´æŸ¥è¯¢æ—¶ï¼Œå¯ä»¥ä»èŒƒå›´çš„å¼€å§‹ç‚¹æˆ–ç»“æŸç‚¹å¼€å§‹ï¼Œå‘å‰æˆ–å‘åéå†ã€‚åœ¨éœ€è¦å¯¹æ•°æ®è¿›è¡Œé€†åºå¤„ç†æ—¶ï¼ŒåŒå‘é“¾è¡¨éå¸¸æœ‰ç”¨ã€‚å¦‚æœéœ€è¦åœ¨ B+æ ‘ä¸­ä»å¤§å€¼å‘å°å€¼è¿›è¡Œæ£€ç´¢ï¼Œå¯ä»¥å…ˆå®šä½åˆ°æœ€å³ä¾§èŠ‚ç‚¹ï¼Œæ‰¾åˆ°åŒ…å«æœ€å¤§å€¼çš„å¶å­èŠ‚ç‚¹ã€‚ä»æ ¹èŠ‚ç‚¹å¼€å§‹å‘å³éå†æ ‘çš„æ–¹å¼å®ç°ã€‚ å®šä½åˆ°æœ€å³ä¾§çš„å¶å­èŠ‚ç‚¹åï¼Œå†åˆ©ç”¨å¶èŠ‚ç‚¹é—´çš„åŒå‘é“¾è¡¨å‘å·¦éå†å°±å¥½äº†ã€‚ ä¸ºä»€ä¹ˆ MongoDB çš„ç´¢å¼•ç”¨ Bæ ‘ï¼Œè€Œ MySQL ç”¨ B+ æ ‘ï¼ŸMongoDB é€šå¸¸ä»¥ JSON æ ¼å¼å­˜å‚¨æ–‡æ¡£ï¼ŒæŸ¥è¯¢ä»¥å•é”®æŸ¥è¯¢ï¼ˆå¦‚ find({_id: 123})ï¼‰ä¸ºä¸»ã€‚B æ ‘çš„â€œèŠ‚ç‚¹æ—¢å­˜é”®åˆå­˜æ•°æ®â€çš„ç‰¹æ€§å…è®¸æŸ¥è¯¢åœ¨éå¶å­èŠ‚ç‚¹æå‰ç»ˆæ­¢ï¼Œä»è€Œå‡å°‘ IO æ¬¡æ•°ã€‚ MySQL çš„æŸ¥è¯¢é€šå¸¸æ¶‰åŠèŒƒå›´ï¼ˆWHERE id 100ï¼‰ã€æ’åºï¼ˆORDER BYï¼‰ã€è¿æ¥ï¼ˆJOINï¼‰ç­‰æ“ä½œã€‚B+ æ ‘çš„å¶å­èŠ‚ç‚¹æ˜¯é“¾è¡¨ç»“æ„ï¼Œå¤©ç„¶æ”¯æŒé¡ºåºéå†ï¼Œæ— éœ€å›æº¯è‡³æ ¹èŠ‚ç‚¹æˆ–ä¸­åºéå†ï¼Œæ•ˆç‡è¿œé«˜äº B æ ‘ã€‚ 42.ğŸŒŸä¸€æ£µB+æ ‘èƒ½å­˜å‚¨å¤šå°‘æ¡æ•°æ®å‘¢ï¼Ÿä¸€å¥è¯å›å¤ï¼šä¸€æ£µ B+ æ ‘èƒ½å­˜å¤šå°‘æ•°æ®ï¼Œå–å†³äºå®ƒçš„åˆ†æ”¯å› å­å’Œé«˜åº¦ã€‚åœ¨ InnoDB ä¸­ï¼Œé¡µçš„é»˜è®¤å¤§å°ä¸º 16KBï¼Œå½“ä¸»é”®ä¸º bigint æ—¶ï¼Œ3 å±‚ B+ æ ‘é€šå¸¸å¯ä»¥å­˜å‚¨çº¦ 2000 ä¸‡æ¡æ•°æ®ã€‚ â€”- è¿™éƒ¨åˆ†æ˜¯å¸®åŠ©ç†è§£ startï¼Œé¢è¯•ä¸­å¯ä¸èƒŒ â€”- å…ˆæ¥çœ‹ä¸€ä¸‹è®¡ç®—å…¬å¼ï¼š æœ€å¤§è®°å½•æ•° = (åˆ†æ”¯å› å­)^(æ ‘é«˜åº¦-1) Ã— å¶å­èŠ‚ç‚¹å®¹é‡ å†æ¥çœ‹ä¸€ä¸‹å…³é”®å‚æ•°ï¼šâ‘ ã€é¡µå¤§å°ï¼Œé»˜è®¤ 16KBâ‘¡ã€ä¸»é”®å¤§å°ï¼Œå‡è®¾æ˜¯ bigint ç±»å‹ï¼Œé‚£ä¹ˆå®ƒçš„å¤§å°å°±æ˜¯ 8 ä¸ªå­—èŠ‚ã€‚â‘¢ã€é¡µæŒ‡é’ˆå¤§å°ï¼ŒInnoDB æºç ä¸­è®¾ç½®ä¸º 6 å­—èŠ‚ï¼Œ4 å­—èŠ‚é¡µå· + 2 å­—èŠ‚é¡µå†…åç§»ã€‚ æ‰€ä»¥éå¶å­èŠ‚ç‚¹å¯ä»¥å­˜å‚¨ 1638414(é”®å€¼+æŒ‡é’ˆ)1170 ä¸ªè¿™æ ·çš„å•å…ƒã€‚ å½“å±‚é«˜ä¸º 2 æ—¶ï¼Œæ ¹èŠ‚ç‚¹å¯ä»¥å­˜å‚¨ 1170 ä¸ªæŒ‡é’ˆï¼ŒæŒ‡å‘ 1170 ä¸ªå¶å­èŠ‚ç‚¹ï¼Œæ‰€ä»¥æ€»æ•°æ®é‡ä¸º 1170Ã—16 18720 æ¡ã€‚ å½“å±‚é«˜ä¸º 3 æ—¶ï¼Œæ ¹èŠ‚ç‚¹æŒ‡å‘ 1170 ä¸ªéå¶å­èŠ‚ç‚¹ï¼Œæ¯ä¸ªéå¶å­èŠ‚ç‚¹å†æŒ‡å‘ 1170 ä¸ªå¶å­èŠ‚ç‚¹ï¼Œæ‰€ä»¥æ€»æ•°æ®é‡ä¸º 1170Ã—1170Ã—16â‰ˆ21,902,400 æ¡ï¼ˆçº¦2,190ä¸‡æ¡ï¼‰è®°å½•ã€‚ æ¨èé˜…è¯»ï¼šæ¸…å¹½ä¹‹åœ°ï¼šInnoDB ä¸€æ£µ B+æ ‘å¯ä»¥å­˜æ”¾å¤šå°‘è¡Œæ•°æ®ï¼Ÿ â€”- è¿™éƒ¨åˆ†æ˜¯å¸®åŠ©ç†è§£ endï¼Œé¢è¯•ä¸­å¯ä¸èƒŒ â€”- ç°åœ¨æœ‰ä¸€å¼ è¡¨ 2kw æ•°æ®ï¼Œæˆ‘è¿™ä¸ª b+æ ‘çš„é«˜åº¦æœ‰å‡ å±‚ï¼Ÿå¯¹äº 2KW æ¡æ•°æ®æ¥è¯´ï¼ŒB+æ ‘çš„é«˜åº¦ä¸º 3 å±‚å°±å¤Ÿäº†ã€‚ æ¯ä¸ªå¶å­èŠ‚ç‚¹èƒ½å­˜æ”¾å¤šå°‘æ¡æ•°æ®ï¼Ÿå¦‚æœå•è¡Œæ•°æ®å¤§å°ä¸º 1KBï¼Œé‚£ä¹ˆæ¯é¡µå¯å­˜å‚¨çº¦ 16 è¡Œï¼ˆ16KB1KBï¼‰æ•°æ®ã€‚ â€”- è¿™éƒ¨åˆ†æ˜¯å¸®åŠ©ç†è§£ startï¼Œé¢è¯•ä¸­å¯ä¸èƒŒ â€”- å‡è®¾æœ‰è¿™æ ·ä¸€ä¸ªè¡¨ç»“æ„ï¼š CREATE TABLE `user` ( `id` BIGINT PRIMARY KEY, -- 8å­—èŠ‚ `name` VARCHAR(255) NOT NULL, -- å®é™…é•¿åº¦50å­—èŠ‚ï¼ˆUTF8MB4ï¼Œæ¯ä¸ªå­—ç¬¦æœ€å¤š4å­—èŠ‚ï¼‰ `age` TINYINT, -- 1å­—èŠ‚ `email` VARCHAR(255) -- å®é™…é•¿åº¦30å­—èŠ‚ï¼Œå¯ä¸ºNULL) ROW_FORMAT=COMPACT; é‚£ä¹ˆä¸€è¡Œæ•°æ®çš„å¤§å°ä¸ºï¼š8 + 50 + 1 + 30 89 å­—èŠ‚ã€‚ è¡Œæ ¼å¼çš„å¼€é”€ä¸ºï¼šè¡Œå¤´ 5 å­—èŠ‚+æŒ‡é’ˆ 6 å­—èŠ‚+å¯å˜é•¿åº¦å­—æ®µå¼€é”€ 2 å­—èŠ‚ï¼ˆname å’Œ email å„å  1 å­—èŠ‚ï¼‰+ NULL ä½å›¾ 1 å­—èŠ‚ 14 å­—èŠ‚ã€‚ æ‰€ä»¥æ¯è¡Œæ•°æ®çš„å®é™…å¤§å°ä¸ºï¼š89 + 14 103 å­—èŠ‚ã€‚ æ¯é¡µå¤§å°é»˜è®¤ä¸º 16KBï¼Œé‚£ä¹ˆæ¯é¡µæœ€å¤šå¯ä»¥å­˜å‚¨ 16384 103 â‰ˆ 158 è¡Œæ•°æ®ã€‚ â€”- è¿™éƒ¨åˆ†æ˜¯å¸®åŠ©ç†è§£ endï¼Œé¢è¯•ä¸­å¯ä¸èƒŒ â€”- 43.ç´¢å¼•ä¸ºä»€ä¹ˆç”¨ B+æ ‘ä¸ç”¨æ™®é€šäºŒå‰æ ‘ï¼Ÿæ™®é€šäºŒå‰æ ‘çš„æ¯ä¸ªèŠ‚ç‚¹æœ€å¤šæœ‰ä¸¤ä¸ªå­èŠ‚ç‚¹ã€‚å½“æ•°æ®æŒ‰é¡ºåºé€’å¢æ’å…¥æ—¶ï¼ŒäºŒå‰æ ‘ä¼šé€€åŒ–æˆé“¾è¡¨ï¼Œå¯¼è‡´æ ‘çš„é«˜åº¦ç­‰äºæ•°æ®é‡ã€‚ æ­¤æ—¶æŸ¥æ‰¾ id7 å°±éœ€è¦ 7 æ¬¡ IO æ“ä½œï¼Œç›¸å½“äºå…¨è¡¨æ‰«æã€‚è€Œ B+ æ ‘ä½œä¸ºå¤šå‰å¹³è¡¡æ ‘ï¼Œèƒ½å°†æ•°äº¿çº§çš„æ•°æ®é‡æ§åˆ¶åœ¨ 3-4 å±‚çš„æ ‘é«˜ï¼Œèƒ½æå¤§å‡å°‘ç£ç›˜çš„ IO æ¬¡æ•°ã€‚ ä¸ºä»€ä¹ˆä¸ç”¨å¹³è¡¡äºŒå‰æ ‘å‘¢ï¼Ÿå¹³è¡¡äºŒå‰æ ‘è™½ç„¶è§£å†³äº†æ™®é€šäºŒå‰æ ‘çš„é€€åŒ–é—®é¢˜ï¼Œä½†æ¯ä¸ªèŠ‚ç‚¹æœ€å¤šåªæœ‰ä¸¤ä¸ªå­èŠ‚ç‚¹çš„é—®é¢˜ä¾ç„¶å­˜åœ¨ã€‚å¹¶ä¸”å¹³è¡¡äºŒå‰æ ‘çš„æ’å…¥å’Œåˆ é™¤æ“ä½œä¹Ÿä¼šå¯¼è‡´é¢‘ç¹çš„æ—‹è½¬æ“ä½œï¼Œå½±å“æ€§èƒ½ã€‚ 44.ğŸŒŸä¸ºä»€ä¹ˆç”¨ B+ æ ‘è€Œä¸ç”¨ B æ ‘å‘¢ï¼ŸB+ æ ‘ç›¸æ¯” B æ ‘æœ‰ 3 ä¸ªæ˜¾è‘—ä¼˜åŠ¿ï¼š ç¬¬ä¸€ï¼ŒB æ ‘çš„æ¯ä¸ªèŠ‚ç‚¹æ—¢å­˜å‚¨é”®å€¼ï¼Œåˆå­˜å‚¨æ•°æ®å’ŒæŒ‡é’ˆï¼Œå¯¼è‡´å•èŠ‚ç‚¹å­˜å‚¨çš„é”®å€¼æ•°é‡è¾ƒå°‘ã€‚ ä¸€ä¸ª 16KB çš„ InnoDB é¡µï¼Œå¦‚æœæ•°æ®è¾ƒå¤§ï¼ŒB æ ‘çš„éå¶å­èŠ‚ç‚¹åªèƒ½å®¹çº³å‡ åä¸ªé”®å€¼ï¼Œè€Œ B+ æ ‘çš„éå¶å­èŠ‚ç‚¹å¯ä»¥å®¹çº³ä¸Šåƒä¸ªé”®å€¼ã€‚ ç¬¬äºŒï¼ŒB æ ‘çš„èŒƒå›´æŸ¥è¯¢éœ€è¦é€šè¿‡ä¸­åºéå†é€å±‚å›æº¯ï¼›è€Œ B+ æ ‘çš„å¶å­èŠ‚ç‚¹é€šè¿‡åŒå‘é“¾è¡¨é¡ºåºè¿æ¥ï¼ŒèŒƒå›´æŸ¥è¯¢åªéœ€å®šä½èµ·å§‹ç‚¹åé¡ºåºéå†é“¾è¡¨å³å¯ï¼Œæ²¡æœ‰å›æº¯å¼€é”€ã€‚ ç¬¬ä¸‰ï¼ŒB æ ‘çš„æ•°æ®å¯èƒ½å­˜å‚¨åœ¨ä»»æ„èŠ‚ç‚¹ï¼Œå‡å¦‚ç›®æ ‡æ•°æ®æ°å¥½ä½äºæ ¹èŠ‚ç‚¹æˆ–ä¸Šå±‚èŠ‚ç‚¹ï¼ŒæŸ¥è¯¢ä»…éœ€ 1-2 æ¬¡ IOï¼›ä½†å¦‚æœæ•°æ®ä½äºåº•å±‚èŠ‚ç‚¹ï¼Œåˆ™éœ€å¤šæ¬¡ IOï¼Œå¯¼è‡´æŸ¥è¯¢æ—¶é—´æ³¢åŠ¨è¾ƒå¤§ã€‚ è€Œ B+ æ ‘çš„æ‰€æœ‰æ•°æ®éƒ½å­˜å‚¨åœ¨å¶å­èŠ‚ç‚¹ï¼ŒæŸ¥è¯¢è·¯å¾„çš„é•¿åº¦æ˜¯å›ºå®šçš„ï¼Œ**æ—¶é—´ç¨³å®šä¸º O(logN)**ï¼Œå¯¹ MySQL åœ¨é«˜å¹¶å‘åœºæ™¯ä¸‹çš„ç¨³å®šæ€§è‡³å…³é‡è¦ã€‚ B+æ ‘çš„æ—¶é—´å¤æ‚åº¦æ˜¯å¤šå°‘ï¼ŸO(logN)ã€‚ ä¸ºä»€ä¹ˆç”¨ B+æ ‘ä¸ç”¨è·³è¡¨å‘¢ï¼Ÿè·³è¡¨æœ¬è´¨ä¸Šè¿˜æ˜¯é“¾è¡¨ç»“æ„ï¼Œåªä¸è¿‡æŠŠæŸäº›èŠ‚ç‚¹æŠ½åˆ°ä¸Šå±‚åšäº†ç´¢å¼•ã€‚ ä¸€æ¡æ•°æ®ä¸€ä¸ªèŠ‚ç‚¹ï¼Œå¦‚æœéœ€è¦å­˜æ”¾ 2000 ä¸‡æ¡æ•°æ®ï¼Œä¸”æ¯æ¬¡æŸ¥è¯¢éƒ½è¦èƒ½è¾¾åˆ°äºŒåˆ†æŸ¥æ‰¾çš„æ•ˆæœï¼Œé‚£ä¹ˆè·³è¡¨çš„é«˜åº¦å¤§çº¦ä¸º 24 å±‚ï¼ˆ2 çš„ 24 æ¬¡æ–¹ï¼‰ã€‚ åœ¨æœ€åçš„æƒ…å†µä¸‹ï¼Œè¿™ 24 å±‚æ•°æ®åˆ†æ•£åœ¨ä¸åŒçš„æ•°æ®é¡µï¼ŒæŸ¥æ‰¾ä¸€æ¬¡æ•°æ®å°±éœ€è¦ 24 æ¬¡ç£ç›˜ IOã€‚ è€Œ 2000 ä¸‡æ¡æ•°æ®åœ¨ B+æ ‘ä¸­åªéœ€è¦ 3 å±‚å°±å¯ä»¥äº†ã€‚ B+æ ‘çš„èŒƒå›´æŸ¥æ‰¾æ€ä¹ˆåšçš„ï¼Ÿä¸€å¥è¯å›ç­”ï¼š å…ˆé€šè¿‡ç´¢å¼•è·¯å¾„å®šä½åˆ°ç¬¬ä¸€ä¸ªæ»¡è¶³æ¡ä»¶çš„å¶å­èŠ‚ç‚¹ï¼Œç„¶åé¡ºç€å¶å­èŠ‚ç‚¹ä¹‹é—´çš„é“¾è¡¨å‘å³å‘å·¦æ‰«æï¼Œç›´åˆ°è¶…è¿‡èŒƒå›´ã€‚ è¯¦ç»†ç‰ˆï¼š B+ æ ‘ç´¢å¼•çš„èŒƒå›´æŸ¥æ‰¾ä¸»è¦ä¾èµ–å¶å­èŠ‚ç‚¹ä¹‹é—´çš„åŒå‘é“¾è¡¨æ¥å®Œæˆã€‚ ç¬¬ä¸€æ­¥ï¼Œä» B+ æ ‘çš„æ ¹èŠ‚ç‚¹å¼€å§‹ï¼Œé€šè¿‡ç´¢å¼•é”®å€¼é€å±‚å‘ä¸‹ï¼Œæ‰¾åˆ°ç¬¬ä¸€ä¸ªæ»¡è¶³æ¡ä»¶çš„å¶å­èŠ‚ç‚¹ã€‚ ç¬¬äºŒæ­¥ï¼Œåˆ©ç”¨å¶å­èŠ‚ç‚¹ä¹‹é—´çš„åŒå‘é“¾è¡¨ï¼Œä»èµ·å§‹èŠ‚ç‚¹å¼€å§‹ï¼Œä¾æ¬¡å‘åéå†æ¯ä¸ªèŠ‚ç‚¹ã€‚å½“ç´¢å¼•å€¼è¶…è¿‡æŸ¥è¯¢èŒƒå›´ï¼Œæˆ–è€…éå†åˆ°é“¾è¡¨æœ«å°¾æ—¶ï¼Œç»ˆæ­¢æŸ¥è¯¢ã€‚ äº†è§£å¿«æ’å—å¿«é€Ÿæ’åºä½¿ç”¨åˆ†æ²»æ³•å°†ä¸€ä¸ªåºåˆ—åˆ†ä¸ºè¾ƒå°å’Œè¾ƒå¤§çš„ 2 ä¸ªå­åºåˆ—ï¼Œç„¶åé€’å½’æ’åºä¸¤ä¸ªå­åºåˆ—ï¼Œç”±ä¸œå°¼Â·éœå°”åœ¨ 1960 å¹´æå‡ºã€‚ å…¶æ ¸å¿ƒæ€æƒ³æ˜¯ï¼š é€‰æ‹©ä¸€ä¸ªåŸºå‡†å€¼ã€‚ å°†æ•°ç»„åˆ†ä¸ºä¸¤éƒ¨åˆ†ï¼Œå·¦è¾¹å°äºåŸºå‡†å€¼ï¼Œå³è¾¹å¤§äºæˆ–ç­‰äºåŸºå‡†å€¼ã€‚ å¯¹å·¦å³ä¸¤éƒ¨åˆ†é€’å½’æ’åºï¼Œæœ€ç»ˆåˆå¹¶ã€‚public static void quickSort(int[] arr, int low, int high) if (low high) int pivotIndex = partition(arr, low, high); quickSort(arr, low, pivotIndex - 1); quickSort(arr, pivotIndex + 1, high); private static int partition(int[] arr, int low, int high) int pivot = arr[high]; int i = low - 1; for (int j = low; j high; j++) if (arr[j] = pivot) i++; swap(arr, i, j); swap(arr, i + 1, high); return i + 1;private static void swap(int[] arr, int i, int j) int temp = arr[i]; arr[i] = arr[j]; arr[j] = temp; 45.B+æ ‘ç´¢å¼•å’Œ Hash ç´¢å¼•æœ‰ä»€ä¹ˆåŒºåˆ«ï¼Ÿç®€ç‰ˆå›ç­”ï¼šB+ æ ‘ç´¢å¼•æ”¯æŒèŒƒå›´æŸ¥è¯¢ã€æœ‰åºæ‰«æï¼Œæ˜¯ InnoDB çš„é»˜è®¤ç´¢å¼•ç»“æ„ã€‚ Hash ç´¢å¼•åªæ”¯æŒç­‰å€¼æŸ¥æ‰¾ï¼Œé€Ÿåº¦å¿«ä½†åŠŸèƒ½å¼±ï¼Œå¸¸è§äº Memory å¼•æ“ã€‚ ç¨å¾®è¯¦ç»†ä¸€ç‚¹çš„å›ç­”ï¼š B+ æ ‘ç´¢å¼•æ˜¯ä¸€ç§å¹³è¡¡å¤šè·¯æœç´¢æ ‘ï¼Œæ‰€æœ‰æ•°æ®å­˜å‚¨åœ¨å¶å­èŠ‚ç‚¹ä¸Šï¼Œéå¶å­èŠ‚ç‚¹ä»…å­˜å‚¨ç´¢å¼•é”®ã€‚å¶å­èŠ‚ç‚¹é€šè¿‡æŒ‡é’ˆè¿æ¥å½¢æˆæœ‰åºé“¾è¡¨ï¼Œå¤©ç„¶æ”¯æŒæ’åºã€‚å¹¶ä¸”æ”¯æŒèŒƒå›´æŸ¥è¯¢ã€æ¨¡ç³ŠæŸ¥è¯¢ï¼Œæ˜¯ InnoDB é»˜è®¤çš„ç´¢å¼•ç»“æ„ã€‚ Hash ç´¢å¼•åŸºäºå“ˆå¸Œå‡½æ•°å°†é”®å€¼æ˜ å°„åˆ°å›ºå®šé•¿åº¦çš„å“ˆå¸Œå€¼ï¼Œé€šè¿‡å“ˆå¸Œå€¼å®šä½æ•°æ®å­˜å‚¨çš„ä½ç½®ã€‚å®Œå…¨æ— åºï¼Œåªæ”¯æŒç­‰å€¼æŸ¥è¯¢ï¼Œå¸¸è§äº Memory å¼•æ“ã€‚ â€”- è¿™éƒ¨åˆ†æ˜¯å¸®åŠ©ç†è§£ startï¼Œé¢è¯•ä¸­å¯ä¸èƒŒ â€”- å› ä¸º B+ æ ‘æ˜¯ InnoDB çš„é»˜è®¤ç´¢å¼•ç±»å‹ï¼Œæ‰€ä»¥åˆ›å»º B+ æ ‘çš„æ—¶å€™ä¸éœ€è¦æŒ‡å®šç´¢å¼•ç±»å‹ã€‚ CREATE TABLE example_btree ( id INT AUTO_INCREMENT PRIMARY KEY, name VARCHAR(255), INDEX name_index (name)) ENGINE=InnoDB; å¯ä»¥é€šè¿‡UNIQUE HASHåˆ›å»ºå“ˆå¸Œç´¢å¼•ï¼š CREATE TABLE example_hash ( id INT AUTO_INCREMENT PRIMARY KEY, name VARCHAR(255), UNIQUE HASH (name)) ENGINE=MEMORY; InnoDB å¹¶ä¸æä¾›ç›´æ¥åˆ›å»ºå“ˆå¸Œç´¢å¼•çš„é€‰é¡¹ï¼Œå› ä¸º B+ æ ‘ç´¢å¼•èƒ½å¤Ÿå¾ˆå¥½åœ°æ”¯æŒèŒƒå›´æŸ¥è¯¢å’Œç­‰å€¼æŸ¥è¯¢ï¼Œæ»¡è¶³äº†å¤§å¤šæ•°æ•°æ®åº“æ“ä½œçš„éœ€è¦ã€‚ ä¸è¿‡ï¼ŒInnoDB å†…éƒ¨ä½¿ç”¨äº†ä¸€ç§åä¸ºâ€œè‡ªé€‚åº”å“ˆå¸Œç´¢å¼•â€ï¼ˆAdaptive Hash Index, AHIï¼‰çš„æŠ€æœ¯ï¼Œå½“æŸäº›ç´¢å¼•å€¼é¢‘ç¹è®¿é—®æ—¶ï¼ŒInnoDB ä¼šåœ¨ B+ æ ‘åŸºç¡€ä¸Šè‡ªåŠ¨åˆ›å»ºå“ˆå¸Œç´¢å¼•ï¼Œå…¼å…·ä¸¤è€…çš„ä¼˜ç‚¹ã€‚ å¯é€šè¿‡ SHOW VARIABLES LIKE innodb_adaptive_hash_index; æŸ¥çœ‹è‡ªé€‚åº”å“ˆå¸Œç´¢å¼•çš„çŠ¶æ€ã€‚ å¦‚æœè¿”å›çš„å€¼æ˜¯ ONï¼Œè¯´æ˜è‡ªé€‚åº”å“ˆå¸Œç´¢å¼•æ˜¯å¼€å¯çš„ã€‚â€”- è¿™éƒ¨åˆ†æ˜¯å¸®åŠ©ç†è§£ endï¼Œé¢è¯•ä¸­å¯ä¸èƒŒ â€”- 46.ğŸŒŸèšæ—ç´¢å¼•å’Œéèšæ—ç´¢å¼•æœ‰ä»€ä¹ˆåŒºåˆ«ï¼Ÿèšç°‡ç´¢å¼•çš„å¶å­èŠ‚ç‚¹å­˜å‚¨äº†å®Œæ•´çš„æ•°æ®è¡Œï¼Œæ•°æ®å’Œç´¢å¼•æ˜¯åœ¨ä¸€èµ·çš„ã€‚InnoDB çš„ä¸»é”®ç´¢å¼•å°±æ˜¯èšç°‡ç´¢å¼•ï¼Œå¶å­èŠ‚ç‚¹ä¸ä»…å­˜å‚¨äº†ä¸»é”®å€¼ï¼Œè¿˜å­˜å‚¨äº†å…¶ä»–åˆ—çš„å€¼ï¼Œå› æ­¤æŒ‰ç…§ä¸»é”®è¿›è¡ŒæŸ¥è¯¢çš„é€Ÿåº¦ä¼šéå¸¸å¿«ã€‚ æ¯ä¸ªè¡¨åªèƒ½æœ‰ä¸€ä¸ªèšç°‡ç´¢å¼•ï¼Œé€šå¸¸ç”±ä¸»é”®å®šä¹‰ã€‚å¦‚æœæ²¡æœ‰æ˜¾å¼æŒ‡å®šä¸»é”®ï¼ŒInnoDB ä¼šéšå¼åˆ›å»ºä¸€ä¸ªéšè—çš„ä¸»é”®ç´¢å¼• row_idã€‚éèšç°‡ç´¢å¼•çš„å¶å­èŠ‚ç‚¹åªåŒ…å«äº†ä¸»é”®å€¼ï¼Œéœ€è¦é€šè¿‡å›è¡¨æŒ‰ç…§ä¸»é”®å»èšç°‡ç´¢å¼•æŸ¥æ‰¾å…¶ä»–åˆ—çš„å€¼ï¼Œå”¯ä¸€ç´¢å¼•ã€æ™®é€šç´¢å¼•ç­‰éä¸»é”®ç´¢å¼•éƒ½æ˜¯éèšç°‡ç´¢å¼•ã€‚ æ¯ä¸ªè¡¨éƒ½å¯ä»¥åˆ›å»ºå¤šä¸ªéèšç°‡ç´¢å¼•ï¼Œå¦‚æœä¸æƒ³å›è¡¨çš„è¯ï¼Œå¯ä»¥é€šè¿‡è¦†ç›–ç´¢å¼•æŠŠè¦æŸ¥è¯¢çš„å­—æ®µä¹Ÿæ”¾åˆ°ç´¢å¼•ä¸­ã€‚ â€”- è¿™éƒ¨åˆ†æ˜¯å¸®åŠ©å¤§å®¶ç†è§£ startï¼Œé¢è¯•ä¸­å¯ä¸èƒŒ â€”- ä¸€å¼ è¡¨åªèƒ½æœ‰ä¸€ä¸ªèšç°‡ç´¢å¼•ã€‚ CREATE TABLE user ( id INT PRIMARY KEY, name VARCHAR(100), age INT);ä¸»é”® id æ˜¯èšç°‡ç´¢å¼•ï¼ŒB+ æ ‘çš„å¶å­èŠ‚ç‚¹ç›´æ¥å­˜å‚¨äº† (id, name, age)ã€‚ ä¸€å¼ è¡¨å¯ä»¥æœ‰å¤šä¸ªéèšç°‡ç´¢å¼•ã€‚ CREATE INDEX idx_name ON user(name);CREATE INDEX idx_age ON user(age);idx_name æ˜¯éèšç°‡ç´¢å¼•ï¼Œå¶å­èŠ‚ç‚¹å­˜çš„æ˜¯ name - idï¼ŒæŸ¥æ•´è¡Œæ•°æ®è¦å›è¡¨ã€‚ idx_age ä¹Ÿæ˜¯éèšç°‡ç´¢å¼•ï¼Œå¶å­èŠ‚ç‚¹å­˜çš„æ˜¯ age - idï¼ŒæŸ¥æ•´è¡Œæ•°æ®ä¹Ÿè¦å›è¡¨ã€‚ æƒ³è¦äº†è§£æ›´å¤šèšç°‡ç´¢å¼•å’Œéèšç°‡ç´¢å¼•ï¼Œæ¨èé˜…è¯»ï¼šhttps://www.cnblogs.com/vipstone/p/16370305.htmlhttps://learnku.com/articles/50096https://blog.csdn.net/m0_52226803/article/details/135494499https://mp.weixin.qq.com/s/F0cEzIqecF4sWg7ZRmHKRQâ€”- è¿™éƒ¨åˆ†æ˜¯å¸®åŠ©ç†è§£ endï¼Œé¢è¯•ä¸­å¯ä¸èƒŒ â€”- 47.ğŸŒŸå›è¡¨äº†è§£å—ï¼Ÿå½“ä½¿ç”¨éèšç°‡ç´¢å¼•è¿›è¡ŒæŸ¥è¯¢æ—¶ï¼ŒMySQL éœ€è¦å…ˆé€šè¿‡éèšç°‡ç´¢å¼•æ‰¾åˆ°ä¸»é”®å€¼ï¼Œç„¶åå†æ ¹æ®ä¸»é”®å€¼å›åˆ°èšç°‡ç´¢å¼•ä¸­æŸ¥æ‰¾å®Œæ•´æ•°æ®è¡Œï¼Œè¿™ä¸ªè¿‡ç¨‹ç§°ä¸ºå›è¡¨ã€‚ å‡è®¾ç°åœ¨æœ‰ä¸€å¼ ç”¨æˆ·è¡¨ usersï¼š CREATE TABLE users ( id INT PRIMARY KEY, name VARCHAR(50), age INT, email VARCHAR(50), INDEX (name)); æ‰§è¡ŒæŸ¥è¯¢ï¼š SELECT * FROM users WHERE name = ç‹äºŒ; æŸ¥è¯¢è¿‡ç¨‹å¦‚ä¸‹ï¼š ç¬¬ä¸€æ­¥ï¼ŒMySQL ä½¿ç”¨ name åˆ—ä¸Šçš„éèšç°‡ç´¢å¼•æŸ¥æ‰¾æ‰€æœ‰ name â€˜ç‹äºŒâ€™ çš„ä¸»é”® idã€‚ ç¬¬äºŒæ­¥ï¼Œä½¿ç”¨ä¸»é”® id åˆ°èšç°‡ç´¢å¼•ä¸­æŸ¥æ‰¾å®Œæ•´è®°å½•ã€‚ å›è¡¨çš„ä»£ä»·æ˜¯ä»€ä¹ˆï¼Ÿå›è¡¨é€šå¸¸éœ€è¦è®¿é—®é¢å¤–çš„æ•°æ®é¡µï¼Œå¦‚æœæ•°æ®ä¸åœ¨å†…å­˜ä¸­ï¼Œè¿˜éœ€è¦ä»ç£ç›˜è¯»å–ï¼Œå¢åŠ  IO å¼€é”€ã€‚ å¯é€šè¿‡è¦†ç›–ç´¢å¼•æˆ–è€…è”åˆç´¢å¼•æ¥é¿å…å›è¡¨ã€‚ -- åŸè¡¨ç»“æ„CREATE TABLE users ( id INT PRIMARY KEY, name VARCHAR(50), age INT, INDEX idx_name (name));-- éœ€è¦æŸ¥è¯¢nameå’ŒageSELECT name, age FROM users WHERE name = å¼ ä¸‰;-- è¿™ä¼šå›è¡¨ï¼Œå› ä¸ºageä¸åœ¨idx_nameç´¢å¼•ä¸­-- ä¼˜åŒ–æ–¹æ¡ˆ1ï¼šåˆ›å»ºåŒ…å«ageçš„è”åˆç´¢å¼•ALTER TABLE users ADD INDEX idx_name_age (name, age);-- ç°åœ¨åŒæ ·çš„æŸ¥è¯¢ä¸éœ€è¦å›è¡¨ ä»€ä¹ˆæƒ…å†µä¸‹ä¼šè§¦å‘å›è¡¨ï¼Ÿ ç¬¬ä¸€ï¼Œå½“æŸ¥è¯¢å­—æ®µä¸åœ¨éèšç°‡ç´¢å¼•ä¸­æ—¶ï¼Œå¿…é¡»å›è¡¨åˆ°ä¸»é”®ç´¢å¼•è·å–æ•°æ®ã€‚ç¬¬äºŒï¼ŒæŸ¥è¯¢å­—æ®µåŒ…å«éç´¢å¼•åˆ—ï¼ˆå¦‚ SELECT *ï¼‰ï¼Œå¿…ç„¶è§¦å‘å›è¡¨ã€‚ å›è¡¨è®°å½•è¶Šå¤šå¥½å—ï¼Ÿå›è¡¨è®°å½•è¶Šå¤šï¼Œé€šå¸¸ä»£è¡¨æ€§èƒ½è¶Šå·®ï¼Œå› ä¸ºæ¯æ¡è®°å½•éƒ½éœ€è¦é€šè¿‡ä¸»é”®å†æŸ¥è¯¢ä¸€æ¬¡å®Œæ•´æ•°æ®ã€‚è¿™ä¸ªè¿‡ç¨‹æ¶‰åŠå†…å­˜è®¿é—®æˆ–ç£ç›˜ IOï¼Œå°¤å…¶å½“ç¼“å­˜å‘½ä¸­ç‡ä¸é«˜æ—¶ï¼Œå›è¡¨ä¼šä¸¥é‡å½±å“æŸ¥è¯¢æ•ˆç‡ã€‚ äº†è§£ MRR å—ï¼ŸMRR æ˜¯ InnoDB ä¸ºäº†è§£å†³å›è¡¨å¸¦æ¥çš„å¤§é‡éšæœº IO é—®é¢˜è€Œå¼•å…¥çš„ä¸€ç§ä¼˜åŒ–ç­–ç•¥ã€‚ å®ƒä¼šå…ˆæŠŠéèšç°‡ç´¢å¼•æŸ¥åˆ°çš„ä¸»é”®å€¼åˆ—è¡¨è¿›è¡Œæ’åºï¼Œå†æŒ‰é¡ºåºå»ä¸»é”®ç´¢å¼•ä¸­æ‰¹é‡å›è¡¨ï¼Œå°†éšæœº IO è½¬æ¢ä¸ºé¡ºåº IOï¼Œä»¥å‡å°‘ç£ç›˜å¯»é“æ—¶é—´ã€‚ â€”- è¿™éƒ¨åˆ†æ˜¯å¸®åŠ©ç†è§£ startï¼Œé¢è¯•ä¸­å¯ä¸èƒŒ â€”- å¯é€šè¿‡ SHOW VARIABLES LIKE optimizer_switch; æŸ¥çœ‹ MRR æ˜¯å¦å¯ç”¨ã€‚ å…¶ä¸­ mrr=on è¡¨ç¤ºå¯ç”¨ MRRï¼Œmrr_cost_based=on è¡¨ç¤ºåŸºäºæˆæœ¬å†³å®šä½¿ç”¨ MRRã€‚ å¦å¤–å¯ä»¥é€šè¿‡ show variables like read_rnd_buffer_size; æŸ¥çœ‹ MRR çš„ç¼“å†²åŒºå¤§å°ï¼Œé»˜è®¤æ˜¯ 256KBã€‚ æˆ‘ä»¬æ¥åˆ›å»ºä¸€ä¸ªè¡¨ï¼Œæ’å…¥ä¸€äº›æ•°æ®ï¼Œç„¶åæ‰§è¡Œä¸€ä¸ªæŸ¥è¯¢æ¥æ¼”ç¤º MRR çš„æ•ˆæœã€‚ CREATE DATABASE IF NOT EXISTS mrr_test; USE mrr_test; CREATE TABLE IF NOT EXISTS orders (id INT AUTO_INCREMENT PRIMARY KEY, user_id INT, order_date DATE, amount DECIMAL(10,2), status VARCHAR(20), INDEX idx_user_date(user_id, order_date));DELIMITER //CREATE PROCEDURE generate_test_data()BEGIN DECLARE i INT DEFAULT 1; WHILE i = 100000 DO INSERT INTO orders (user_id, order_date, amount, status) VALUES ( FLOOR(1 + RAND() * 1000), -- Random user_id between 1 and 1000 DATE_ADD(2023-01-01, INTERVAL FLOOR(RAND() * 365) DAY), -- Random date in 2023 ROUND(10 + RAND() * 990, 2), -- Random amount between 10 and 1000 ELT(1 + FLOOR(RAND() * 3), completed, pending, cancelled) -- Random status ); SET i = i + 1; END WHILE;END //DELIMITER ;CALL generate_test_data();DROP PROCEDURE generate_test_data; æŸ¥çœ‹ MRR å¼€å¯å’Œå…³é—­æ—¶çš„æ€§èƒ½æ•°æ®ï¼š -- ç¡®ä¿MRRå¼€å¯å¹¶è®¾ç½®è¶³å¤Ÿå¤§çš„ç¼“å†²åŒºSET SESSION optimizer_switch=mrr=on,mrr_cost_based=off;SET SESSION read_rnd_buffer_size = 16*1024*1024;-- æ¸…ç†ç¼“å­˜å’ŒçŠ¶æ€FLUSH STATUS;FLUSH TABLES;-- å¼ºåˆ¶ä½¿ç”¨äºŒçº§ç´¢å¼•å¹¶å›è¡¨æŸ¥è¯¢ï¼ˆé€šè¿‡é€‰æ‹©æœªè¢«ç´¢å¼•çš„åˆ—ï¼‰SELECT Raw data access pattern with MRR ON as test_case;SELECT /*+ MRR(orders_mrr_test) */ id, shipping_address, customer_nameFROM orders_mrr_test FORCE INDEX(idx_user_date)WHERE user_id IN (100,200,300,400,500,600,700,800,900,1000)AND order_date BETWEEN 2023-03-01 AND 2023-04-01LIMIT 15;-- æ˜¾ç¤ºå¤„ç†å™¨çŠ¶æ€SHOW STATUS LIKE Handler_%;SHOW STATUS LIKE %mrr%;-- å¯¹æ¯”ï¼šå…³é—­MRRSET SESSION optimizer_switch=mrr=off,mrr_cost_based=off;FLUSH STATUS;FLUSH TABLES;SELECT Raw data access pattern with MRR OFF as test_case;SELECT id, shipping_address, customer_nameFROM orders_mrr_test FORCE INDEX(idx_user_date)WHERE user_id IN (100,200,300,400,500,600,700,800,900,1000)AND order_date BETWEEN 2023-03-01 AND 2023-04-01LIMIT 15;-- æ˜¾ç¤ºå¤„ç†å™¨çŠ¶æ€SHOW STATUS LIKE Handler_%;SHOW STATUS LIKE %mrr%;-- æ˜¾ç¤ºè¯¦ç»†çš„æ‰§è¡Œè®¡åˆ’EXPLAIN FORMAT=TREESELECT /*+ MRR(orders_mrr_test) */ id, shipping_address, customer_nameFROM orders_mrr_test FORCE INDEX(idx_user_date)WHERE user_id IN (100,200,300,400,500,600,700,800,900,1000)AND order_date BETWEEN 2023-03-01 AND 2023-04-01; å¯ä»¥çœ‹åˆ° MRR å¼€å¯æ—¶çš„ç»“æœå¯¹æ¯”ï¼š Wrap ä¹Ÿç»™å‡ºäº†å¯¹åº”çš„ç»“æœè¯´æ˜ï¼šä¹Ÿå¯ä»¥åœ¨ explain ä¸­ç¡®è®¤ MRR çš„ä½¿ç”¨æƒ…å†µã€‚â€”- è¿™éƒ¨åˆ†æ˜¯å¸®åŠ©ç†è§£ endï¼Œé¢è¯•ä¸­å¯ä¸èƒŒ â€”- 48.ğŸŒŸè”åˆç´¢å¼•äº†è§£å—ï¼Ÿï¼ˆè¡¥å……ï¼‰è”åˆç´¢å¼•å°±æ˜¯æŠŠå¤šä¸ªå­—æ®µæ”¾åœ¨ä¸€ä¸ªç´¢å¼•é‡Œï¼Œä½†å¿…é¡»éµå®ˆâ€œæœ€å·¦å‰ç¼€â€åŸåˆ™ï¼Œåªæœ‰ä»ç¬¬ä¸€ä¸ªå­—æ®µå¼€å§‹è¿ç»­ä½¿ç”¨ï¼Œç´¢å¼•æ‰ä¼šç”Ÿæ•ˆã€‚ è”åˆç´¢å¼•ä¼šæŒ‰å­—æ®µé¡ºåºæ„å»ºB+æ ‘ã€‚ä¾‹å¦‚ï¼ˆage, nameï¼‰ç´¢å¼•ä¼šå…ˆæŒ‰ç…§ age æ’åºï¼Œage ç›¸åŒåˆ™æŒ‰ç…§ name æ’åºï¼Œè‹¥ä¸¤è€…éƒ½ç›¸åŒåˆ™æŒ‰ä¸»é”®æ’åºï¼Œç¡®ä¿å¶å­èŠ‚ç‚¹æ— é‡å¤ç´¢å¼•é¡¹ã€‚ åˆ›å»º(A,B,C)è”åˆç´¢å¼•ç›¸å½“äºåŒæ—¶åˆ›å»ºäº†(A)ã€(A,B)å’Œ(A,B,C)ä¸‰ä¸ªç´¢å¼•ã€‚ -- åˆ›å»ºè”åˆç´¢å¼•CREATE INDEX idx_order_user_product ON orders(user_id, product_id, create_time)-- é«˜æ•ˆæŸ¥è¯¢SELECT * FROM orders WHERE user_id=1001 AND product_id=2002ORDER BY create_time DESC è”åˆç´¢å¼•åº•å±‚çš„å­˜å‚¨ç»“æ„æ˜¯æ€æ ·çš„ï¼Ÿè”åˆç´¢å¼•åœ¨åº•å±‚é‡‡ç”¨ B+ æ ‘ç»“æ„è¿›è¡Œå­˜å‚¨ï¼Œè¿™ä¸€ç‚¹ä¸å•åˆ—ç´¢å¼•ç›¸åŒã€‚ ä¸å•åˆ—ç´¢å¼•ä¸åŒçš„æ˜¯ï¼Œè”åˆç´¢å¼•çš„æ¯ä¸ªèŠ‚ç‚¹ä¼šå­˜å‚¨æ‰€æœ‰ç´¢å¼•åˆ—çš„å€¼ï¼Œè€Œä¸ä»…ä»…æ˜¯ç¬¬ä¸€åˆ—çš„å€¼ã€‚ä¾‹å¦‚ï¼Œå¯¹äºè”åˆç´¢å¼•(a,b,c)ï¼Œæ¯ä¸ªèŠ‚ç‚¹éƒ½åŒ…å« aã€bã€c ä¸‰åˆ—çš„å€¼ã€‚ éå¶å­èŠ‚ç‚¹ç¤ºä¾‹ï¼š [(a=1, b=2, c=3) â†’ å­èŠ‚ç‚¹1, (a=5, b=3, c=1) â†’ å­èŠ‚ç‚¹2]å¶å­èŠ‚ç‚¹ç¤ºä¾‹ï¼ˆInnoDBï¼‰ï¼š (a=1, b=2, c=3) â†’ PK=100 | (a=1, b=2, c=4) â†’ PK=101 ï¼ˆé€šè¿‡æŒ‡é’ˆè¿æ¥å½¢æˆåŒå‘é“¾è¡¨ï¼‰ è”åˆç´¢å¼•çš„å¶å­èŠ‚ç‚¹å­˜çš„ä»€ä¹ˆå†…å®¹?è”åˆç´¢å¼•å±äºéèšç°‡ç´¢å¼•ï¼Œå¶å­èŠ‚ç‚¹å­˜å‚¨çš„æ˜¯è”åˆç´¢å¼•å„åˆ—çš„å€¼å’Œå¯¹åº”è¡Œçš„ä¸»é”®å€¼ï¼Œè€Œä¸æ˜¯å®Œæ•´çš„æ•°æ®è¡Œã€‚æŸ¥è¯¢éç´¢å¼•å­—æ®µæ—¶ï¼Œéœ€è¦é€šè¿‡ä¸»é”®å€¼å›è¡¨åˆ°èšç°‡ç´¢å¼•è·å–å®Œæ•´æ•°æ®ã€‚ ä¾‹å¦‚ç´¢å¼•(a, b)çš„å¶å­èŠ‚ç‚¹ä¼šå®Œæ•´å­˜å‚¨(a, b)çš„å€¼ï¼Œå¹¶æŒ‰å­—æ®µé¡ºåºæ’åºï¼ˆå¦‚ a ä¼˜å…ˆï¼Œa ç›¸åŒåˆ™æŒ‰ b æ’åºï¼‰ã€‚å¦‚æœä¸»é”®æ˜¯ idï¼Œå¶å­èŠ‚ç‚¹ä¼šå­˜å‚¨ (a, b, id) çš„ç»„åˆã€‚ 49.ğŸŒŸè¦†ç›–ç´¢å¼•äº†è§£å—ï¼Ÿè¦†ç›–ç´¢å¼•æŒ‡çš„æ˜¯ï¼šæŸ¥è¯¢æ‰€éœ€çš„å­—æ®µå…¨éƒ¨éƒ½åœ¨ç´¢å¼•ä¸­ï¼Œä¸éœ€è¦å›è¡¨ï¼Œä»ç´¢å¼•é¡µå°±èƒ½ç›´æ¥è¿”å›ç»“æœã€‚ empname å’Œ job ä¸¤ä¸ªå­—æ®µæ˜¯ä¸€ä¸ªè”åˆç´¢å¼•ï¼Œè€ŒæŸ¥è¯¢ä¹Ÿæ°å¥½æ˜¯è¿™ä¸¤ä¸ªå­—æ®µï¼Œè¿™æ—¶å€™å•æ¬¡æŸ¥è¯¢å°±å¯ä»¥è¾¾åˆ°ç›®çš„ï¼Œä¸éœ€è¦å›è¡¨ã€‚ å¯ä»¥å°†é«˜é¢‘æŸ¥è¯¢çš„å­—æ®µï¼ˆå¦‚ WHERE æ¡ä»¶å’Œ SELECT åˆ—ï¼‰ç»„åˆä¸ºè”åˆç´¢å¼•ï¼Œå®ç°è¦†ç›–ç´¢å¼•ã€‚ ä¾‹å¦‚ï¼š CREATE INDEX idx_empname_job ON employee(empname, job); è¿™æ ·æŸ¥è¯¢çš„æ—¶å€™å°±å¯ä»¥èµ°ç´¢å¼•ï¼š SELECT empname, job FROM employee WHERE empname = ç‹äºŒ AND job = ç¨‹åºå‘˜; æ™®é€šç´¢å¼•åªç”¨äºåŠ é€ŸæŸ¥è¯¢æ¡ä»¶çš„åŒ¹é…ï¼Œè€Œè¦†ç›–ç´¢å¼•è¿˜èƒ½ç›´æ¥æä¾›æŸ¥è¯¢ç»“æœã€‚ ä¸€ä¸ªè¡¨ï¼ˆname, sex,age,idï¼‰ï¼Œselect age,id,name from tblname where nameâ€™paicodingâ€™;æ€ä¹ˆå»ºç´¢å¼•ç”±äºæŸ¥è¯¢æ¡ä»¶æœ‰ name å­—æ®µï¼Œæ‰€ä»¥æœ€å°‘åº”è¯¥ä¸º name å­—æ®µæ·»åŠ ä¸€ä¸ªç´¢å¼•ã€‚ã€ CREATE INDEX idx_name ON tblname(name); æŸ¥è¯¢ç»“æœä¸­è¿˜éœ€è¦ ageã€id å­—æ®µï¼Œå¯ä»¥ä¸ºè¿™ä¸‰ä¸ªå­—æ®µåˆ›å»ºä¸€ä¸ªè”åˆç´¢å¼•ï¼Œåˆ©ç”¨è¦†ç›–ç´¢å¼•ï¼Œç›´æ¥ä»ç´¢å¼•ä¸­è·å–æ•°æ®ï¼Œå‡å°‘å›è¡¨ã€‚ CREATE INDEX idx_name_age_id ON tblname (name, age, id); 50.ğŸŒŸä»€ä¹ˆæ˜¯æœ€å·¦å‰ç¼€åŸåˆ™ï¼Ÿæœ€å·¦å‰ç¼€åŸåˆ™æŒ‡çš„æ˜¯ï¼šMySQL ä½¿ç”¨è”åˆç´¢å¼•æ—¶ï¼Œå¿…é¡»ä»æœ€å·¦è¾¹çš„å­—æ®µå¼€å§‹åŒ¹é…ï¼Œæ‰èƒ½å‘½ä¸­ç´¢å¼•ã€‚ å‡è®¾æœ‰ä¸€ä¸ªè”åˆç´¢å¼• (A, B, C)ï¼Œå…¶ç”Ÿæ•ˆæ¡ä»¶å¦‚ä¸‹ï¼š å¦‚æœæ’åºæˆ–åˆ†ç»„çš„åˆ—æ˜¯æœ€å·¦å‰ç¼€çš„ä¸€éƒ¨åˆ†ï¼Œç´¢å¼•è¿˜å¯ä»¥åŠ é€Ÿæ“ä½œã€‚ -- ç´¢å¼•(a,b)SELECT * FROM table WHERE a = 1 ORDER BY b; -- å¯ä»¥åˆ©ç”¨ç´¢å¼•æ’åº èŒƒå›´æŸ¥è¯¢åçš„åˆ—è¿˜èƒ½ç”¨ç´¢å¼•å—ï¼ŸèŒƒå›´æŸ¥è¯¢åªèƒ½åº”ç”¨äºæœ€å·¦å‰ç¼€çš„æœ€åä¸€åˆ—ã€‚èŒƒå›´æŸ¥è¯¢ä¹‹åçš„åˆ—æ— æ³•ä½¿ç”¨ç´¢å¼•ã€‚ -- ç´¢å¼•(a,b,c)SELECT * FROM table WHERE a = 1 AND b 2 AND c = 3; -- åªèƒ½ä½¿ç”¨aå’Œbï¼Œcæ— æ³•ä½¿ç”¨ç´¢å¼• ä¸ºä»€ä¹ˆä¸ä»æœ€å·¦å¼€å§‹æŸ¥ï¼Œå°±æ— æ³•åŒ¹é…å‘¢ï¼Ÿä¸€å¥è¯å›ç­”ï¼š å› ä¸ºè”åˆç´¢å¼•åœ¨ B+ æ ‘ä¸­æ˜¯æŒ‰ç…§æœ€å·¦å­—æ®µä¼˜å…ˆæ’åºæ„å»ºçš„ï¼Œå¦‚æœè·³è¿‡æœ€å·¦å­—æ®µï¼ŒMySQL æ— æ³•åˆ¤æ–­æŸ¥æ‰¾èŒƒå›´ä»å“ªé‡Œå¼€å§‹ï¼Œè‡ªç„¶ä¹Ÿå°±æ— æ³•ä½¿ç”¨ç´¢å¼•ã€‚ æ¯”å¦‚æœ‰ä¸€ä¸ª user è¡¨ï¼Œæˆ‘ä»¬ç»™ name å’Œ age å»ºç«‹äº†ä¸€ä¸ªè”åˆç´¢å¼• (name, age)ã€‚ ALTER TABLE user add INDEX comidx_name_phone (name,age); è”åˆç´¢å¼•åœ¨ B+ æ ‘ä¸­æŒ‰ç…§ä»å·¦åˆ°å³çš„é¡ºåºä¾æ¬¡å»ºç«‹æœç´¢æ ‘ï¼Œname åœ¨å·¦ï¼Œage åœ¨å³ã€‚ å½“æˆ‘ä»¬ä½¿ç”¨ where name â€˜ç‹äºŒâ€™ and age â€˜20â€™ å»æŸ¥è¯¢çš„æ—¶å€™ï¼Œ B+ æ ‘ä¼šä¼˜å…ˆæ¯”è¾ƒ name æ¥ç¡®å®šä¸‹ä¸€æ­¥åº”è¯¥æœç´¢çš„æ–¹å‘ï¼Œå¾€å·¦è¿˜æ˜¯å¾€å³ã€‚ å¦‚æœ name ç›¸åŒçš„æ—¶å€™å†æ¯”è¾ƒ ageã€‚ ä½†å¦‚æœæŸ¥è¯¢æ¡ä»¶æ²¡æœ‰ nameï¼Œå°±ä¸çŸ¥é“åº”è¯¥æ€ä¹ˆæŸ¥äº†ï¼Œå› ä¸º name æ˜¯ B+æ ‘ä¸­çš„å‰ç½®æ¡ä»¶ï¼Œæ²¡æœ‰ nameï¼Œç´¢å¼•å°±æ´¾ä¸ä¸Šç”¨åœºäº†ã€‚ è”åˆç´¢å¼• (a, b)ï¼Œwhere a 1 å’Œ where b 1ï¼Œæ•ˆæœæ˜¯ä¸€æ ·çš„å—ä¸ä¸€æ ·ã€‚ WHERE a = 1Â èƒ½å‘½ä¸­è”åˆç´¢å¼•ï¼Œå› ä¸º a æ˜¯è”åˆç´¢å¼•çš„ç¬¬ä¸€ä¸ªå­—æ®µï¼Œç¬¦åˆæœ€å·¦å‰ç¼€åŒ¹é…åŸåˆ™ã€‚è€ŒÂ WHERE b = 1Â æ— æ³•å‘½ä¸­è”åˆç´¢å¼•ï¼Œå› ä¸ºç¼ºå°‘ a çš„åŒ¹é…æ¡ä»¶ï¼ŒMySQL ä¼šå…¨è¡¨æ‰«æã€‚ â€”- è¿™éƒ¨åˆ†æ˜¯å¸®åŠ©ç†è§£ startï¼Œé¢è¯•ä¸­å¯ä¸èƒŒ â€”- æˆ‘ä»¬æ¥éªŒè¯ä¸€ä¸‹ï¼Œå‡è®¾æœ‰ä¸€ä¸ª ab è¡¨ï¼Œå»ºç«‹äº†è”åˆç´¢å¼•Â (a, b)ï¼š CREATE TABLE ab ( a INT, b INT, INDEX ab_index (a, b)); æ’å…¥æ•°æ®ï¼š INSERT INTO ab (a, b) VALUES (1, 2), (1, 3), (2, 1), (3, 3), (2, 2); æ‰§è¡ŒæŸ¥è¯¢ï¼š é€šè¿‡ explain å¯ä»¥çœ‹åˆ°ï¼ŒWHERE a 1 ä½¿ç”¨äº†è”åˆç´¢å¼•ï¼Œè€Œ WHERE b 1 éœ€è¦å…¨è¡¨æ‰«æï¼Œä¾æ¬¡æ£€æŸ¥æ¯ä¸€è¡Œã€‚ â€”- è¿™éƒ¨åˆ†æ˜¯å¸®åŠ©ç†è§£ endï¼Œé¢è¯•ä¸­å¯ä¸èƒŒ â€”- å‡å¦‚æœ‰è”åˆç´¢å¼• abcï¼Œä¸‹é¢çš„ sql æ€ä¹ˆèµ°çš„è”åˆç´¢å¼•ï¼Ÿselect * from t where a = 2 and b = 2;select * from t where b = 2 and c = 2;select * from t where a 2 and b = 2; ç¬¬ä¸€æ¡ SQL è¯­å¥åŒ…å«æ¡ä»¶ a 2 å’Œ b 2ï¼Œåˆšå¥½ç¬¦åˆè”åˆç´¢å¼•çš„å‰ä¸¤åˆ—ã€‚ ç¬¬äºŒæ¡ SQL è¯­å¥ç”±äºæœªä½¿ç”¨æœ€å·¦å‰ç¼€ä¸­çš„ aï¼Œä¼šè§¦å‘å…¨è¡¨æ‰«æã€‚ ç¬¬ä¸‰æ¡ SQL è¯­å¥åœ¨èŒƒå›´æ¡ä»¶ a 2 ä¹‹åï¼Œç´¢å¼•åä¼šåœæ­¢åŒ¹é…ï¼Œb 2 çš„æ¡ä»¶éœ€è¦é¢å¤–è¿‡æ»¤ã€‚ (A,B,C) è”åˆç´¢å¼• select * from tbn where a? and b in (?,?) and c? ä¼šèµ°ç´¢å¼•å—ï¼Ÿè¿™ä¸ªæŸ¥è¯¢ä¼šå‘½ä¸­è”åˆç´¢å¼•ï¼Œå› ä¸º a æ˜¯ç­‰å€¼åŒ¹é…ï¼Œb æ˜¯ IN ç­‰å€¼å¤šåŒ¹é…ï¼Œc æ˜¯ b ä¹‹åçš„èŒƒå›´æ¡ä»¶ï¼Œç¬¦åˆæœ€å·¦å‰ç¼€åŸåˆ™ã€‚ å¯¹äº a?ï¼šè¿™æ˜¯ä¸€ä¸ªç²¾ç¡®åŒ¹é…ï¼Œå¹¶ä¸”æ˜¯è”åˆç´¢å¼•çš„ç¬¬ä¸€ä¸ªå­—æ®µï¼Œæ‰€ä»¥ä¸€å®šä¼šå‘½ä¸­ç´¢å¼•ã€‚ å¯¹äº b IN (?, ?)ï¼šç­‰ä»·äº b? OR b?ï¼Œå±äºå¤šå€¼åŒ¹é…ï¼Œå¹¶ä¸”æ˜¯è”åˆç´¢å¼•çš„ç¬¬äºŒä¸ªå­—æ®µï¼Œæ‰€ä»¥ä¹Ÿä¼šå‘½ä¸­ç´¢å¼•ã€‚ å¯¹äº c?ï¼šè¿™æ˜¯ä¸€ä¸ªèŒƒå›´æ¡ä»¶ï¼Œå±äºè”åˆç´¢å¼•çš„ç¬¬ä¸‰ä¸ªå­—æ®µï¼Œä¹Ÿä¼šå‘½ä¸­ç´¢å¼•ã€‚ â€”- è¿™éƒ¨åˆ†æ˜¯å¸®åŠ©ç†è§£ startï¼Œé¢è¯•ä¸­å¯ä¸èƒŒ â€”- æ¥éªŒè¯ä¸€ä¸‹ã€‚ ç¬¬ä¸€æ­¥ï¼Œå»ºè¡¨ã€‚ CREATE TABLE tbn (A INT, B INT, C INT, D TEXT); ç¬¬äºŒæ­¥ï¼Œåˆ›å»ºç´¢å¼•ã€‚ CREATE INDEX idx_abc ON tbn (A, B, C); ç¬¬ä¸‰æ­¥ï¼Œæ’å…¥æ•°æ®ã€‚ INSERT INTO tbn VALUES (1, 2, 3, First);INSERT INTO tbn VALUES (1, 2, 4, Second);INSERT INTO tbn VALUES (1, 3, 5, Third);INSERT INTO tbn VALUES (2, 2, 3, Fourth);INSERT INTO tbn VALUES (2, 3, 4, Fifth); ç¬¬å››æ­¥ï¼Œæ‰§è¡ŒæŸ¥è¯¢ã€‚ EXPLAIN SELECT * FROM tbn WHERE A=1 AND B IN (2, 3) AND C3\\G ä» EXPLAIN è¾“å‡ºç»“æœæ¥çœ‹ï¼Œæˆ‘ä»¬å¯ä»¥å¾—åˆ° MySQL æ˜¯å¦‚ä½•æ‰§è¡ŒæŸ¥è¯¢çš„ä¸€äº›å…³é”®ä¿¡æ¯ï¼š type: æŸ¥è¯¢ç±»å‹ï¼Œè¿™é‡Œæ˜¯ rangeï¼Œè¡¨ç¤º MySQL ä½¿ç”¨äº†èŒƒå›´æŸ¥æ‰¾ï¼Œè¿™æ˜¯å› ä¸ºæŸ¥è¯¢æ¡ä»¶åŒ…å«äº† æ“ä½œç¬¦ã€‚ possible_keys: å¯èƒ½è¢«ç”¨æ¥æ‰§è¡ŒæŸ¥è¯¢çš„ç´¢å¼•ï¼Œè¿™é‡Œæ˜¯ idx_abcï¼Œè¡¨ç¤º MySQL è®¤ä¸º idx_abc ç´¢å¼•ä¼šç”¨äºæŸ¥è¯¢ä¼˜åŒ–ã€‚ key: å®é™…ç”¨æ¥æ‰§è¡ŒæŸ¥è¯¢çš„ç´¢å¼•ï¼Œä¹Ÿæ˜¯ idx_abcï¼Œè¿™ç¡®å®šè¿™æ¡æŸ¥è¯¢å‘½ä¸­äº†è”åˆç´¢å¼•ã€‚ Extra: æä¾›äº†å…³äºæŸ¥è¯¢æ‰§è¡Œçš„é¢å¤–ä¿¡æ¯ã€‚Using index condition è¡¨ç¤º MySQL ä½¿ç”¨äº†ç´¢å¼•ä¸‹æ¨ï¼ˆIndex Condition Pushdownï¼ŒICPï¼‰ï¼Œè¿™æ˜¯ MySQL çš„ä¸€ä¸ªä¼˜åŒ–æ–¹å¼ï¼Œå®ƒå…è®¸åœ¨ç´¢å¼•å±‚é¢è¿‡æ»¤æ•°æ®ã€‚ â€”- è¿™éƒ¨åˆ†æ˜¯å¸®åŠ©ç†è§£ endï¼Œé¢è¯•ä¸­å¯ä¸èƒŒ â€”- è”åˆç´¢å¼•çš„ä¸€ä¸ªåœºæ™¯é¢˜ï¼š(a,b,c)è”åˆç´¢å¼•ï¼Œ(b,c)æ˜¯å¦ä¼šèµ°ç´¢å¼•å—ï¼Ÿæ ¹æ®æœ€å·¦å‰ç¼€åŸåˆ™ï¼Œ(b,c) æŸ¥è¯¢ä¸ä¼šèµ°ç´¢å¼•ã€‚ å› ä¸ºè”åˆç´¢å¼• (a,b,c) ä¸­ï¼Œa æ˜¯æœ€å·¦è¾¹çš„åˆ—ï¼Œè”åˆç´¢å¼•åœ¨åˆ›å»ºç´¢å¼•æ ‘çš„æ—¶å€™éœ€è¦å…ˆæœ‰ aï¼Œç„¶åæ‰ä¼šæœ‰ b å’Œ cã€‚è€ŒæŸ¥è¯¢æ¡ä»¶ä¸­æ²¡æœ‰åŒ…å« aï¼Œæ‰€ä»¥ MySQL æ— æ³•åˆ©ç”¨è¿™ä¸ªç´¢å¼•ã€‚ EXPLAIN SELECT * FROM tbn WHERE B=1 AND C=1\\G å»ºç«‹è”åˆç´¢å¼•(a,b,c)ï¼Œwhere c 5 æ˜¯å¦ä¼šç”¨åˆ°ç´¢å¼•ï¼Ÿä¸ºä»€ä¹ˆï¼Ÿä¸ä¼šã€‚åªæœ‰ç´¢å¼•çš„ç¬¬ä¸‰åˆ— c è¢«ç”¨ä½œæŸ¥è¯¢æ¡ä»¶ï¼Œè€Œå‰ä¸¤åˆ— a å’Œ b éƒ½æ²¡æœ‰è¢«ä½¿ç”¨ã€‚è¿™ä¸ç¬¦åˆæœ€å·¦å‰ç¼€åŸåˆ™ã€‚ EXPLAIN SELECT * FROM tbn WHERE C=5\\G sqlä¸­ä½¿ç”¨likeï¼Œå¦‚æœéµå¾ªæœ€å·¦å‰ç¼€åŒ¹é…ï¼ŒæŸ¥è¯¢æ˜¯ä¸æ˜¯ä¸€å®šä¼šç”¨åˆ°ç´¢å¼•ï¼Ÿå¦‚æœæŸ¥è¯¢æ¨¡å¼æ˜¯åç¼€é€šé…ç¬¦ LIKE prefix%ï¼Œä¸”è¯¥å­—æ®µæœ‰ç´¢å¼•ï¼Œä¼˜åŒ–å™¨é€šå¸¸ä¼šä½¿ç”¨ç´¢å¼•ã€‚å¦åˆ™å³ä¾¿æ˜¯éµå¾ªæœ€å·¦å‰ç¼€åŒ¹é…ï¼ŒLIKE å­—æ®µä¹Ÿæ— æ³•å‘½ä¸­ç´¢å¼•ã€‚ å¦‚ age 18 and name LIKE â€˜%xxxâ€™ï¼ŒMySQL ä¼šå…ˆä½¿ç”¨è”åˆç´¢å¼• age_name æ‰¾åˆ° age ç¬¦åˆæ¡ä»¶çš„æ‰€æœ‰è¡Œï¼Œç„¶åå†å…¨è¡¨æ‰«æè¿›è¡Œ name å­—æ®µçš„è¿‡æ»¤ã€‚ type: ref è¡¨ç¤ºä½¿ç”¨ç´¢å¼•æŸ¥æ‰¾åŒ¹é…æŸä¸ªå€¼çš„æ‰€æœ‰è¡Œã€‚ å¦‚æœæ˜¯åç¼€é€šé…ç¬¦ï¼Œå¦‚ age = 18 and name LIKE xxx%ï¼ŒMySQL ä¼šç›´æ¥ä½¿ç”¨è”åˆç´¢å¼• age_name æ‰¾åˆ°æ‰€æœ‰ç¬¦åˆæ¡ä»¶çš„è¡Œã€‚ type ä¸º rangeï¼Œè¡¨ç¤º MySQL ä½¿ç”¨äº†ç´¢å¼•èŒƒå›´æ‰«æï¼Œfiltered ä¸º 100.00%ï¼Œè¡¨ç¤ºåœ¨æ‰«æçš„è¡Œä¸­ï¼Œæ‰€æœ‰çš„è¡Œéƒ½æ»¡è¶³ WHERE æ¡ä»¶ã€‚ 51.ğŸŒŸä»€ä¹ˆæ˜¯ç´¢å¼•ä¸‹æ¨ï¼Ÿç´¢å¼•ä¸‹æ¨æ˜¯æŒ‡ï¼šMySQL æŠŠ WHERE æ¡ä»¶å°½å¯èƒ½â€œä¸‹æ¨â€åˆ°ç´¢å¼•æ‰«æé˜¶æ®µï¼Œåœ¨å­˜å‚¨å¼•æ“å±‚æå‰è¿‡æ»¤æ‰ä¸ç¬¦åˆæ¡ä»¶çš„è®°å½•ã€‚ å½“æŸ¥è¯¢æ¡ä»¶åŒ…å«ç´¢å¼•åˆ—ä½†æœªå®Œå…¨åŒ¹é…æ—¶ï¼ŒICP ä¼šåœ¨å­˜å‚¨å¼•æ“å±‚è¿‡æ»¤éç´¢å¼•åˆ—æ¡ä»¶ï¼Œä»¥å‡å°‘å›è¡¨æ¬¡æ•°ã€‚ ä¼ ç»Ÿçš„æŸ¥è¯¢æµç¨‹æ˜¯ï¼Œå­˜å‚¨å¼•æ“é€šè¿‡è”åˆç´¢å¼•å®šä½åˆ°ç¬¦åˆæœ€å·¦å‰ç¼€æ¡ä»¶çš„ä¸»é”® IDï¼›å›è¡¨è¯»å–å®Œæ•´æ•°æ®è¡Œå¹¶è¿”å›ç»™ Server å±‚ï¼›Server å±‚å¯¹æ‰€æœ‰è¿”å›çš„è¡Œè¿›è¡Œ WHERE æ¡ä»¶è¿‡æ»¤ã€‚ æœ‰äº† ICP åï¼Œå­˜å‚¨å¼•æ“åœ¨ç´¢å¼•å±‚ç›´æ¥è¿‡æ»¤å¯ä¸‹æ¨çš„æ¡ä»¶ï¼Œä»…å¯¹ç¬¦åˆç´¢å¼•æ¡ä»¶çš„è®°å½•å›è¡¨è¯»å–æ•°æ®ï¼Œå†è¿”å›ç»™ Server å±‚è¿›è¡Œå‰©ä½™æ¡ä»¶è¿‡æ»¤ã€‚ â€”- è¿™éƒ¨åˆ†æ˜¯å¸®åŠ©ç†è§£ startï¼Œé¢è¯•ä¸­å¯ä¸èƒŒ â€”- ä¾‹å¦‚æœ‰ä¸€å¼  user è¡¨ï¼Œå»ºäº†ä¸€ä¸ªè”åˆç´¢å¼•ï¼ˆname, ageï¼‰ï¼ŒæŸ¥è¯¢è¯­å¥ï¼šselect * from user where name like å¼ % and age=10;ï¼Œæ²¡æœ‰ç´¢å¼•ä¸‹æ¨ä¼˜åŒ–çš„æƒ…å†µä¸‹ï¼š MySQL ä¼šä½¿ç”¨ç´¢å¼• name æ‰¾åˆ°æ‰€æœ‰Â name like å¼ %Â çš„ä¸»é”®ï¼Œæ ¹æ®è¿™äº›ä¸»é”®ï¼Œä¸€æ¡æ¡å›è¡¨æŸ¥è¯¢æ•´è¡Œæ•°æ®ï¼Œå¹¶åœ¨ Server å±‚è¿‡æ»¤æ‰ä¸ç¬¦åˆÂ age=10Â çš„æ•°æ®è¡Œã€‚ å¯ç”¨ ICP åï¼ŒInnoDB ä¼šé€šè¿‡è”åˆç´¢å¼•ç›´æ¥ç­›é€‰å‡ºç¬¦åˆæ¡ä»¶çš„ä¸»é”® IDï¼ˆname like å¼ % and age=10ï¼‰ï¼Œç„¶åå†å›è¡¨æŸ¥è¯¢æ•´è¡Œæ•°æ®ã€‚ æ¢å¥è¯è¯´ï¼Œå‡è®¾ name like â€˜å¼ %â€™ æ‰¾åˆ° 10000 è¡Œæ•°æ®ï¼Œage10 åªæœ‰å…¶ä¸­ 10 è¡Œï¼Œæ²¡æœ‰ç´¢å¼•ä¸‹æ¨çš„æƒ…å†µä¸‹ï¼ŒMySQL ä¼šå›è¡¨ 10000 æ¬¡ï¼Œè¯»å– 10000 è¡Œæ•°æ®ï¼Œç„¶ååœ¨ Server å±‚è¿‡æ»¤æ‰ 9990 è¡Œã€‚ è€Œæœ‰äº†ç´¢å¼•ä¸‹æ¨åï¼ŒMySQL åªä¼šå›è¡¨ 10 æ¬¡ï¼Œè¯»å– 10 è¡Œæ•°æ®ã€‚ æˆ‘ä»¬æ¥éªŒè¯ä¸€ä¸‹ã€‚ ä»ç»“æœä¸­æˆ‘ä»¬å¯ä»¥æ¸…æ¥šåœ°çœ‹åˆ° ICP çš„æ•ˆæœã€‚ICP å¼€å¯æ—¶ï¼ŒExtra åˆ—æ˜¾ç¤ºâ€Using index conditionâ€ï¼Œè¡¨æ˜è¿‡æ»¤æ¡ä»¶è¢«ä¸‹æ¨åˆ°å­˜å‚¨å¼•æ“å±‚ã€‚ ICPå…³é—­æ—¶ï¼ŒExtra åˆ—ä»…æ˜¾ç¤ºâ€Using whereâ€ï¼Œè¡¨æ˜è¿‡æ»¤æ¡ä»¶åœ¨æœåŠ¡å™¨å±‚æ‰§è¡Œã€‚ -- å¼€å¯ICPSET optimizer_switch=index_condition_pushdown=on;-- æ¸…ç†çŠ¶æ€FLUSH STATUS;SELECT Performance test with ICP ON as test_case;-- æ‰§è¡ŒæŸ¥è¯¢å¹¶åˆ†ææ€§èƒ½EXPLAIN ANALYZESELECT /*+ ICP_ON */ *FROM orders_mrr_testWHERE user_id BETWEEN 100 AND 200 AND order_date = 2023-01-01 AND order_date 2023-02-01 AND order_date NOT LIKE 2023-01-15%;-- æ˜¾ç¤ºå¤„ç†å™¨çŠ¶æ€SHOW STATUS LIKE Handler_read%;-- å…³é—­ICPSET optimizer_switch=index_condition_pushdown=off;-- æ¸…ç†çŠ¶æ€FLUSH STATUS;SELECT Performance test with ICP OFF as test_case;-- æ‰§è¡Œç›¸åŒçš„æŸ¥è¯¢EXPLAIN ANALYZESELECT *FROM orders_mrr_testWHERE user_id BETWEEN 100 AND 200 AND order_date = 2023-01-01 AND order_date 2023-02-01 AND order_date NOT LIKE 2023-01-15%;-- æ˜¾ç¤ºå¤„ç†å™¨çŠ¶æ€SHOW STATUS LIKE Handler_read%; å®é™…çš„æ€§èƒ½å·®è·ä¹Ÿå¾ˆå¤§ã€‚ICP å¼€å¯æ—¶ï¼Œå®é™…æ‰«æè¡Œæ•°ï¼š1,649 è¡Œï¼Œæ‰§è¡Œæ—¶é—´ï¼šçº¦12.3 æ¯«ç§’ã€‚å…³é—­æ—¶ï¼Œå®é™…æ‰«æè¡Œæ•°ï¼š19,959 è¡Œï¼Œæ‰§è¡Œæ—¶é—´ï¼šçº¦ 32.1 æ¯«ç§’ã€‚Spring äº‹åŠ¡çš„æœ¬è´¨å…¶å®å°±æ˜¯æ•°æ®åº“å¯¹äº‹åŠ¡çš„æ”¯æŒï¼Œæ²¡æœ‰æ•°æ®åº“çš„äº‹åŠ¡æ”¯æŒï¼ŒSpring æ˜¯æ— æ³•æä¾›äº‹åŠ¡åŠŸèƒ½çš„ã€‚Spring åªæä¾›ç»Ÿä¸€äº‹åŠ¡ç®¡ç†æ¥å£ï¼Œå…·ä½“å®ç°éƒ½æ˜¯ç”±å„æ•°æ®åº“è‡ªå·±å®ç°ï¼Œæ•°æ®åº“äº‹åŠ¡çš„æäº¤å’Œå›æ»šæ˜¯é€šè¿‡æ•°æ®åº“è‡ªå·±çš„äº‹åŠ¡æœºåˆ¶å®ç°ã€‚ 52.å¦‚ä½•æŸ¥çœ‹æ˜¯å¦ç”¨åˆ°äº†ç´¢å¼•ï¼Ÿï¼ˆè¡¥å……ï¼‰å¯ä»¥é€šè¿‡ EXPLAIN å…³é”®å­—æ¥æŸ¥çœ‹æ˜¯å¦ä½¿ç”¨äº†ç´¢å¼•ã€‚ EXPLAIN SELECT * FROM table WHERE column = value; å¦‚æœä½¿ç”¨äº†ç´¢å¼•ï¼Œç»“æœä¸­çš„ key å€¼ä¼šæ˜¾ç¤ºç´¢å¼•çš„åç§°ã€‚ è”åˆç´¢å¼• abcï¼Œa1,c1b1,c1a1,c1,b1 èµ°ä¸èµ°ç´¢å¼•ï¼Ÿac èƒ½ç”¨ä¸Šç´¢å¼•ï¼Œæ¡ä»¶ a1 ç¬¦åˆæœ€å·¦å‰ç¼€åŸåˆ™ï¼Œè§¦å‘ç´¢å¼•çš„ç¬¬ä¸€åˆ— aï¼›ç”±äºè·³è¿‡äº†ä¸­é—´åˆ— bï¼Œc1 æ— æ³•ç›´æ¥åˆ©ç”¨ç´¢å¼•çš„æœ‰åºæ€§ä¼˜åŒ–ï¼Œä½†å¯é€šè¿‡ç´¢å¼•ä¸‹æ¨åœ¨å­˜å‚¨å¼•æ“å±‚è¿‡æ»¤ c çš„æ¡ä»¶ï¼Œå‡å°‘å›è¡¨æ¬¡æ•°ã€‚ bc æ— æ³•ä½¿ç”¨ç´¢å¼•ï¼Œåªèƒ½å…¨è¡¨æ‰«æï¼Œå› ä¸ºä¸ç¬¦åˆæœ€å·¦å‰ç¼€åŸåˆ™ï¼›acb è™½ç„¶é¡ºåºæ˜¯ä¹±çš„ï¼Œä½† MySQL ä¼˜åŒ–å™¨ä¼šè‡ªåŠ¨é‡æ’ä¸º abcï¼Œæ‰€ä»¥èƒ½å‘½ä¸­ç´¢å¼•ã€‚ â€”- è¿™éƒ¨åˆ†æ˜¯å¸®åŠ©ç†è§£ startï¼Œé¢è¯•ä¸­å¯ä¸èƒŒ â€”- æˆ‘ä»¬é€šè¿‡å®é™…çš„ SQL æ¥éªŒè¯ä¸€ä¸‹ã€‚ ç¤ºä¾‹ 1ï¼ˆa1,c1ï¼‰ï¼š EXPLAIN SELECT * FROM tbn WHERE A=1 AND C=1\\G key æ˜¯ idx_abcï¼Œè¡¨æ˜ a1,c1 ä¼šä½¿ç”¨è”åˆç´¢å¼•ã€‚Extra: Using index condition è¡¨ç¤º ICP ç”Ÿæ•ˆã€‚ ç¤ºä¾‹ 2ï¼ˆb1,c1ï¼‰ï¼š EXPLAIN SELECT * FROM tbn WHERE B=1 AND C=1\\G key æ˜¯ NULLï¼Œè¡¨æ˜ b1,c1 ä¸ä¼šä½¿ç”¨è”åˆç´¢å¼•ã€‚è¿™æ˜¯å› ä¸ºæŸ¥è¯¢æ¡ä»¶æ²¡æœ‰éµå¾ªæœ€å·¦å‰ç¼€åŸåˆ™ã€‚ ç¤ºä¾‹ 3ï¼ˆa1,c1,b1ï¼‰ï¼š EXPLAIN SELECT * FROM tbn WHERE A=1 AND C=1 AND B=1\\G ä¼˜åŒ–å™¨ä¼šè‡ªåŠ¨è°ƒæ•´æ¡ä»¶é¡ºåºä¸º a1 AND b1 AND c1ã€‚ key æ˜¯ idx_abcï¼Œè¡¨æ˜ a1,c1,b1 ä¼šä½¿ç”¨è”åˆç´¢å¼•ã€‚ å¹¶ä¸” rows1ï¼Œå› ä¸º MySQL ä¼˜åŒ–å™¨ä¼šè‡ªåŠ¨é‡æ’æŸ¥è¯¢æ¡ä»¶ï¼Œä»¥æ»¡è¶³æœ€å·¦å‰ç¼€åŸåˆ™ï¼Œç›´æ¥ä½¿ç”¨è”åˆç´¢å¼•æ‰¾å‡º a1 AND b1 AND c1 çš„è¡Œã€‚ é”53.ğŸŒŸMySQL ä¸­æœ‰å“ªå‡ ç§é”ï¼ŸMySQL ä¸­æœ‰å¤šç§ç±»å‹çš„é”ï¼Œå¯ä»¥ä»ä¸åŒç»´åº¦æ¥åˆ†ç±»ï¼ŒæŒ‰é”ç²’åº¦åˆ’åˆ†çš„è¯ï¼Œæœ‰è¡¨é”ã€è¡Œé”ã€‚ æŒ‰ç…§åŠ é”æœºåˆ¶åˆ’åˆ†çš„è¯ï¼Œæœ‰ä¹è§‚é”å’Œæ‚²è§‚é”ã€‚æŒ‰ç…§å…¼å®¹æ€§åˆ’åˆ†çš„è¯ï¼Œæœ‰å…±äº«é”å’Œæ’ä»–é”ã€‚ â€”- è¿™éƒ¨åˆ†æ˜¯å¸®åŠ©ç†è§£ startï¼Œé¢è¯•ä¸­å¯ä¸èƒŒ â€”- è¡¨é”ï¼šé”å®šæ•´ä¸ªè¡¨ï¼Œèµ„æºå¼€é”€å°ï¼ŒåŠ é”å¿«ï¼Œä½†å¹¶å‘åº¦ä½ï¼Œä¸ä¼šå‡ºç°æ­»é”ï¼›é€‚åˆæŸ¥è¯¢ä¸ºä¸»ã€å°‘é‡æ›´æ–°çš„åœºæ™¯ï¼ˆå¦‚ MyISAM å¼•æ“ï¼‰ã€‚ å†ç»†åˆ†çš„è¯ï¼Œæœ‰è¡¨å…±äº«è¯»é”ï¼ˆSé”ï¼‰ï¼šå…è®¸å¤šä¸ªäº‹åŠ¡åŒæ—¶è¯»ï¼Œä½†é˜»å¡å†™æ“ä½œï¼›è¡¨ç‹¬å å†™é”ï¼ˆXé”ï¼‰ï¼šç‹¬å è¡¨ï¼Œé˜»å¡å…¶ä»–äº‹åŠ¡çš„è¯»å†™ã€‚ è¡Œé”ï¼šé”å®šå•è¡Œæˆ–å¤šè¡Œï¼Œå¼€é”€å¤§ã€åŠ é”æ…¢ï¼Œå¯èƒ½å‡ºç°æ­»é”ï¼Œä½†å¹¶å‘åº¦é«˜ï¼ˆInnoDB é»˜è®¤æ”¯æŒï¼‰ã€‚ å†ç»†åˆ†çš„è¯ï¼Œæœ‰è®°å½•é”ï¼ˆRecord Lockï¼‰ï¼šé”å®šç´¢å¼•ä¸­çš„å…·ä½“è®°å½•ï¼›é—´éš™é”ï¼ˆGap Lockï¼‰ï¼šé”å®šç´¢å¼•è®°å½•ä¹‹é—´çš„é—´éš™ï¼Œé˜²æ­¢å¹»è¯»ï¼›ä¸´é”®é”ï¼ˆNext-Key Lockï¼‰ï¼šç»“åˆè®°å½•é”å’Œé—´éš™é”ï¼Œé”å®šä¸€ä¸ªå·¦å¼€å³é—­çš„åŒºé—´ï¼ˆå¦‚Â (5, 10]ï¼‰ã€‚ å…±äº«é”ï¼ˆSé”è¯»é”ï¼‰ï¼Œå…è®¸å¤šä¸ªäº‹åŠ¡åŒæ—¶è¯»å–æ•°æ®ï¼Œä½†é˜»å¡å†™æ“ä½œã€‚è¯­æ³•ï¼šSELECT ... LOCK IN SHARE MODE æ’ä»–é”ï¼ˆXé”å†™é”ï¼‰ï¼Œç‹¬å æ•°æ®ï¼Œé˜»å¡å…¶ä»–äº‹åŠ¡çš„è¯»å†™ã€‚è¯­æ³•ï¼šSELECT ... FOR UPDATEã€‚ ä¹è§‚é”å‡è®¾å†²çªå°‘ï¼Œé€šè¿‡ç‰ˆæœ¬å·æˆ– CAS æœºåˆ¶æ£€æµ‹å†²çªï¼ˆå¦‚Â UPDATE SET version=version+1 WHERE version=old_versionï¼‰ã€‚ æ‚²è§‚é”å‡è®¾å¹¶å‘å†²çªé¢‘ç¹ï¼Œå…ˆåŠ é”å†æ“ä½œSELECT FOR UPDATEã€‚â€”- è¿™éƒ¨åˆ†æ˜¯å¸®åŠ©ç†è§£ endï¼Œé¢è¯•ä¸­å¯ä¸èƒŒ â€”- 54.å…¨å±€é”äº†è§£å—ï¼Ÿï¼ˆè¡¥å……ï¼‰å…¨å±€é”å°±æ˜¯å¯¹æ•´ä¸ªæ•°æ®åº“å®ä¾‹è¿›è¡ŒåŠ é”ï¼Œå½“æ‰§è¡Œå…¨å±€é”å®šæ“ä½œæ—¶ï¼Œæ•´ä¸ªæ•°æ®åº“å°†ä¼šå¤„äºåªè¯»çŠ¶æ€ï¼Œæ‰€æœ‰å†™æ“ä½œéƒ½ä¼šè¢«é˜»å¡ï¼Œç›´åˆ°å…¨å±€é”è¢«é‡Šæ”¾ã€‚ åœ¨è¿›è¡Œå…¨åº“å¤‡ä»½ï¼Œæˆ–è€…æ•°æ®è¿ç§»æ—¶ï¼Œå¯ä»¥ä½¿ç”¨å…¨å±€é”æ¥ä¿è¯æ•°æ®çš„ä¸€è‡´æ€§ã€‚ åœ¨ MySQL ä¸­ï¼Œå¯ä»¥ä½¿ç”¨ FLUSH TABLES WITH READ LOCK å‘½ä»¤æ¥è·å–å…¨å±€é”ã€‚ æ‰§è¡Œè¯¥å‘½ä»¤åï¼Œæ‰€æœ‰è¡¨å°†è¢«é”å®šä¸ºåªè¯»çŠ¶æ€ã€‚è®°å¾—åœ¨å®Œæˆå¤‡ä»½æˆ–è¿ç§»åï¼Œä½¿ç”¨ UNLOCK TABLES å‘½ä»¤é‡Šæ”¾å…¨å±€é”ã€‚ -- é”å®šæ•´ä¸ªæ•°æ®åº“FLUSH TABLES WITH READ LOCK;-- æ‰§è¡Œå¤‡ä»½æ“ä½œ-- ä¾‹å¦‚ä½¿ç”¨ mysqldump è¿›è¡Œå¤‡ä»½! mysqldump -u username -p database_name backup.sql-- é‡Šæ”¾å…¨å±€é”å®šUNLOCK TABLES; è¡¨é”äº†è§£å—ï¼Ÿäº†è§£ã€‚è¡¨é”å¸¸è§äº MyISAM å¼•æ“ï¼ŒInnoDB ä¹Ÿå¯ä»¥æ‰‹åŠ¨é€šè¿‡ LOCK TABLES åŠ é”ã€‚ é€‚åˆè¯»å¤šå†™å°‘ã€å…¨è¡¨æ‰«ææˆ–è€…è¡¨ç»“æ„å˜æ›´çš„åœºæ™¯ç”¨ã€‚ è¡¨é”åˆå¯ä»¥ç»†åˆ†ä¸ºå…±äº«é”å’Œæ’ä»–é”ã€‚å…±äº«é”å…è®¸å¤šä¸ªäº‹åŠ¡åŒæ—¶è¯»è¡¨ï¼Œä½†ä¸å…è®¸å†™æ“ä½œã€‚ LOCK TABLES table_name READ; -- æ˜¾å¼åŠ è¯»é”SELECT * FROM table_name; -- å…¶ä»–ä¼šè¯å¯è¯»ï¼Œä¸å¯å†™UNLOCK TABLES; -- é‡Šæ”¾é” æ’ä»–é”åªå…è®¸ä¸€ä¸ªäº‹åŠ¡è¿›è¡Œå†™æ“ä½œï¼Œå…¶ä»–äº‹åŠ¡ä¸èƒ½è¯»ä¹Ÿä¸èƒ½å†™ã€‚ LOCK TABLES table_name WRITE; -- æ˜¾å¼åŠ å†™é”INSERT/UPDATE/DELETE table_name; -- å…¶ä»–ä¼šè¯è¯»å†™å‡é˜»å¡UNLOCK TABLES; MyISAM åœ¨æ‰§è¡Œ SELECT æ—¶ä¼šè‡ªåŠ¨åŠ è¯»é”ï¼Œæ‰§è¡Œ INSERTUPDATEDELETE æ—¶ä¼šåŠ å†™é”ã€‚ å¯¹äº InnoDB å¼•æ“ï¼Œæ— ç´¢å¼•çš„ UPDATE/DELETE å¯èƒ½ä¼šå¯¼è‡´é”å‡çº§ä¸ºè¡¨é”ã€‚ UPDATE innodb_table SET name=new WHERE name=old; -- å…¨è¡¨æ‰«æï¼Œé€€åŒ–ä¸ºè¡¨é” æ‰§è¡Œ ALTER TABLE æ—¶ä¼šè‡ªåŠ¨åŠ è¡¨é”ï¼Œé˜»å¡æ‰€æœ‰è¯»å†™æ“ä½œã€‚ 55.ğŸŒŸè¯´è¯´ MySQL çš„è¡Œé”ï¼Ÿè¡Œé”æ˜¯ InnoDB å­˜å‚¨å¼•æ“ä¸­æœ€ç»†ç²’åº¦çš„é”ï¼Œå®ƒé”å®šè¡¨ä¸­çš„ä¸€è¡Œè®°å½•ï¼Œå…è®¸å…¶ä»–äº‹åŠ¡è®¿é—®è¡¨ä¸­çš„å…¶ä»–è¡Œã€‚ åº•å±‚æ˜¯é€šè¿‡ç»™ç´¢å¼•åŠ é”å®ç°çš„ï¼Œè¿™å°±æ„å‘³ç€åªæœ‰é€šè¿‡ç´¢å¼•æ¡ä»¶æ£€ç´¢æ•°æ®æ—¶ï¼ŒInnoDB æ‰èƒ½ä½¿ç”¨è¡Œçº§é”ï¼Œå¦åˆ™ä¼šé€€åŒ–ä¸ºè¡¨é”ã€‚ è¡Œé”åˆå¯ä»¥ç»†åˆ†ä¸ºè®°å½•é”ã€é—´éš™é”å’Œä¸´é”®é”ä¸‰ç§å½¢å¼ã€‚é€šè¿‡ SELECT ... FOR UPDATE å¯ä»¥åŠ æ’ä»–é”ã€‚ START TRANSACTION;-- åŠ æ’ä»–é”ï¼Œé”å®šæŸä¸€è¡ŒSELECT * FROM your_table WHERE id = 1 FOR UPDATE;-- å¯¹è¯¥è¡Œè¿›è¡Œæ“ä½œUPDATE your_table SET column1 = new_value WHERE id = 1;COMMIT; é€šè¿‡ SELECT ...LOCK IN SHARE MODE å¯ä»¥åŠ å…±äº«é”ã€‚ START TRANSACTION;-- åŠ å…±äº«é”ï¼Œé”å®šæŸä¸€è¡ŒSELECT * FROM your_table WHERE id = 1 LOCK IN SHARE MODE;-- åªèƒ½è¯»å–è¯¥è¡Œï¼Œä¸èƒ½ä¿®æ”¹COMMIT; select for update æœ‰ä»€ä¹ˆéœ€è¦æ³¨æ„çš„ï¼Ÿç¬¬ä¸€ï¼Œå¿…é¡»åœ¨äº‹åŠ¡ä¸­ä½¿ç”¨ï¼Œå¦åˆ™é”ä¼šç«‹å³é‡Šæ”¾ã€‚ START TRANSACTION;SELECT * FROM your_table WHERE id = 1 FOR UPDATE;-- å¯¹è¯¥è¡Œè¿›è¡Œæ“ä½œCOMMIT; ç¬¬äºŒï¼Œä½¿ç”¨æ—¶å¿…é¡»æ³¨æ„æ˜¯å¦å‘½ä¸­ç´¢å¼•ï¼Œå¦åˆ™å¯èƒ½é”å…¨è¡¨ã€‚ -- name æ²¡æœ‰ç´¢å¼•ï¼Œä¼šé€€åŒ–ä¸ºè¡¨é”SELECT * FROM user WHERE name = ç‹äºŒ FOR UPDATE; â€”- è¿™éƒ¨åˆ†æ˜¯å¸®åŠ©ç†è§£ startï¼Œé¢è¯•ä¸­å¯ä¸èƒŒ â€”- å‡è®¾æœ‰ä¸€å¼ åä¸º orders çš„è¡¨ï¼ŒåŒ…å«ä»¥ä¸‹æ•°æ®ï¼š CREATE TABLE orders ( id INT PRIMARY KEY, order_no VARCHAR(255), amount DECIMAL(10,2), status VARCHAR(50), INDEX (order_no) -- order_no ä¸Šæœ‰ç´¢å¼•); è¡¨ä¸­çš„æ•°æ®æ˜¯è¿™æ ·çš„ï¼š å¦‚æœæˆ‘ä»¬é€šè¿‡ä¸»é”®ç´¢å¼•æ‰§è¡Œ SELECT FOR UPDATEï¼Œç¡®å®åªä¼šé”å®šç‰¹å®šçš„è¡Œï¼š START TRANSACTION;SELECT * FROM orders WHERE id = 1 FOR UPDATE;-- å¯¹ id=1 çš„è¡Œè¿›è¡Œæ“ä½œCOMMIT; ç”±äº id æ˜¯ä¸»é”®ï¼Œæ‰€ä»¥åªä¼šé”å®š id1 è¿™è¡Œï¼Œä¸ä¼šå½±å“å…¶ä»–è¡Œçš„æ“ä½œã€‚å…¶ä»–äº‹åŠ¡ä¾ç„¶å¯ä»¥å¯¹ id 2, 3, 4, 5 ç­‰è¡Œæ‰§è¡Œæ›´æ–°æ“ä½œï¼Œå› ä¸ºå®ƒä»¬æ²¡æœ‰è¢«é”å®šã€‚å¦‚æœä½¿ç”¨ order_no è¿™ä¸ªæ™®é€šç´¢å¼•æ‰§è¡Œ SELECT FOR UPDATEï¼Œä¹Ÿåªä¼šé”å®šç‰¹å®šçš„è¡Œï¼š START TRANSACTION;SELECT * FROM orders WHERE order_no = 10001 FOR UPDATE;-- å¯¹ order_no=10001 çš„è¡Œè¿›è¡Œæ“ä½œCOMMIT; å› ä¸º order_no æ˜¯å”¯ä¸€ç´¢å¼•ï¼Œæ‰€ä»¥åªä¼šé”å®š order_no10001 è¿™è¡Œï¼Œä¸ä¼šå½±å“å…¶ä»–è¡Œçš„æ“ä½œã€‚ ä½†å¦‚æœ WHERE æ¡ä»¶æ˜¯ statusâ€™pendingâ€™ï¼Œè€Œ status ä¸Šæ²¡æœ‰ç´¢å¼•ï¼š START TRANSACTION;SELECT * FROM orders WHERE status = pending FOR UPDATE;-- å¯¹ status=pending çš„è¡Œè¿›è¡Œæ“ä½œCOMMIT; å°±ä¼šé€€åŒ–ä¸ºè¡¨é”ï¼Œå› ä¸ºåœ¨è¿™ç§æƒ…å†µä¸‹ï¼ŒMySQL éœ€è¦å…¨è¡¨æ‰«ææ£€æŸ¥æ¯ä¸€è¡Œçš„ statusã€‚ â€”- è¿™éƒ¨åˆ†æ˜¯å¸®åŠ©ç†è§£ endï¼Œé¢è¯•ä¸­å¯ä¸èƒŒ â€”- è¯´è¯´è®°å½•é”å§ï¼Ÿè®°å½•é”æ˜¯è¡Œé”æœ€åŸºæœ¬çš„è¡¨ç°å½¢å¼ï¼Œå½“æˆ‘ä»¬ä½¿ç”¨å”¯ä¸€ç´¢å¼•æˆ–è€…ä¸»é”®ç´¢å¼•è¿›è¡Œç­‰å€¼æŸ¥è¯¢æ—¶ï¼ŒMySQL ä¼šä¸ºè¯¥è®°å½•è‡ªåŠ¨æ·»åŠ æ’ä»–é”ï¼Œç¦æ­¢å…¶ä»–äº‹åŠ¡è¯»å–æˆ–è€…ä¿®æ”¹é”å®šè®°å½•ã€‚ ä¾‹å¦‚ï¼š SELECT * FROM table WHERE id = 1 FOR UPDATE; -- åŠ Xé”UPDATE table SET name = ç‹äºŒ WHERE id = 1; -- éšå¼åŠ Xé” é—´éš™é”äº†è§£å—ï¼Ÿé—´éš™é”ç”¨äºåœ¨èŒƒå›´æŸ¥è¯¢æ—¶é”å®šè®°å½•ä¹‹é—´çš„â€œé—´éš™â€ï¼Œé˜²æ­¢å…¶ä»–äº‹åŠ¡åœ¨è¯¥èŒƒå›´å†…æ’å…¥æ–°è®°å½•ã€‚ä»…åœ¨å¯é‡å¤è¯»åŠä»¥ä¸Šçš„éš”ç¦»çº§åˆ«ä¸‹ç”Ÿæ•ˆï¼Œä¸»è¦ç”¨äºé˜²æ­¢å¹»è¯»ã€‚ â€”- è¿™éƒ¨åˆ†æ˜¯å¸®åŠ©å¤§å®¶ç†è§£ startï¼Œé¢è¯•ä¸­å¯ä¸èƒŒ â€”- ä¾‹å¦‚äº‹åŠ¡ A é”å®šäº†Â (1000,2000)Â åŒºé—´ï¼Œä¼šé˜»æ­¢äº‹åŠ¡ B åœ¨æ­¤åŒºé—´æ’å…¥æ–°è®°å½•ï¼š -- äº‹åŠ¡ABEGIN;SELECT * FROM orders WHERE amount BETWEEN 1000 AND 2000 FOR UPDATE;-- äº‹åŠ¡Bå°è¯•æ’å…¥ä¼šè¢«é˜»å¡INSERT INTO orders VALUES(null,1500,pending); -- é˜»å¡/code å‡è®¾è¡¨ test_gaplock æœ‰ idã€ageã€name ä¸‰ä¸ªå­—æ®µï¼Œå…¶ä¸­ id æ˜¯ä¸»é”®ï¼Œage ä¸Šæœ‰ç´¢å¼•ï¼Œå¹¶æ’å…¥äº† 4 æ¡æ•°æ®ã€‚ CREATE TABLE `test_gaplock` ( `id` int(11) NOT NULL, `age` int(11) DEFAULT NULL, `name` varchar(20) DEFAULT NULL, PRIMARY KEY (`id`), KEY `age` (`age`)) ENGINE=InnoDB;insert into test_gaplock values(1,1,å¼ ä¸‰),(6,6,å´è€äºŒ),(8,8,èµµå››),(12,12,ç†Šå¤§); é—´éš™é”ä¼šé”ä½ï¼š (âˆ’âˆ, 1)ï¼šæœ€å°è®°å½•ä¹‹å‰çš„é—´éš™ã€‚ (1, 6)ã€(6, 8)ã€(8, 12)ï¼šè®°å½•ä¹‹é—´çš„é—´éš™ã€‚ (12, +âˆ)ï¼šæœ€å¤§è®°å½•ä¹‹åçš„é—´éš™ã€‚ å‡è®¾æœ‰ä¸¤ä¸ªäº‹åŠ¡ï¼ŒT1 æ‰§è¡Œä»¥ä¸‹è¯­å¥ï¼š START TRANSACTION;SELECT * FROM test_gaplock WHERE age 5 FOR UPDATE; T2 æ‰§è¡Œä»¥ä¸‹è¯­å¥ï¼š START TRANSACTION;INSERT INTO test_gaplock VALUES (7, 7, ç‹äº”); T1 ä¼šé”ä½ (6, 8) çš„é—´éš™ï¼Œé˜²æ­¢å…¶ä»–äº‹åŠ¡åœ¨è¿™ä¸ªèŒƒå›´å†…æ’å…¥æ–°è®°å½•ã€‚ T2 åœ¨æ’å…¥ (7, 7, ç‹äº”) æ—¶ï¼Œä¼šè¢«é˜»å¡ï¼Œå¯ä»¥åœ¨å¦å¤–ä¸€ä¸ªä¼šè¯ä¸­æ‰§è¡Œ SHOW ENGINE INNODB STATUS æŸ¥çœ‹åˆ°é—´éš™é”çš„ä¿¡æ¯ã€‚ æ‰§è¡Œä»€ä¹ˆå‘½ä»¤ä¼šåŠ ä¸Šé—´éš™é”ï¼Ÿåœ¨å¯é‡å¤è¯»éš”ç¦»çº§åˆ«ä¸‹ï¼Œæ‰§è¡ŒFOR UPDATE / LOCK IN SHARE MODEç­‰åŠ é”è¯­å¥ï¼Œä¸”æŸ¥è¯¢æ¡ä»¶æ˜¯èŒƒå›´æŸ¥è¯¢æ—¶ï¼Œå°±ä¼šè‡ªåŠ¨åŠ ä¸Šé—´éš™é”ã€‚ -- SELECT ... FOR UPDATE + èŒƒå›´æŸ¥è¯¢SELECT * FROM user WHERE score 100 FOR UPDATE;-- SELECT ... LOCK IN SHARE MODE + èŒƒå›´æŸ¥è¯¢SELECT * FROM user WHERE id BETWEEN 10 AND 20 LOCK IN SHARE MODE;-- UPDATE/DELETE + èŒƒå›´æŸ¥è¯¢DELETE FROM user WHERE score 50;","tags":["åŸºç¡€","Mysql"],"categories":["Javaé—®ç­”ç¬”è®°"]},{"title":"2025.6.10å­¦ä¹ æ—¥è®°","path":"/2025/06/10/å­¦ä¹ æ—¥è®°25å¹´6æœˆ/2025.6.10å­¦ä¹ ç¬”è®°/","content":"å­¦ä¹ å†…å®¹æœ€è¿‘å­¦ä¹ é‡å¿ƒæƒ³è½¬åˆ°ç®—æ³•ç›¸å…³,æŠŠéšæƒ³å½•å’Œé¢˜å•åˆ·ä¸€éä¹‹ååšåŠ›æ‰£å‘¨èµ›,å¤ªé•¿æ—¶é—´æ²¡åšéœ€è¦å¤å¥ä¸€ä¸‹. 1. æ‰“å¡åŠ›æ‰£æ¯æ—¥ç®€å•çš„å­—ç¬¦ä¸²è®¡æ•°æ‰¾æœ€å¤§æœ€å°. 2. çœ‹MysqlåŸºç¡€ç¬”è®°åŒæ­¥åœ¨äº†Mysqlå­¦ä¹ ç¬”è®°ä¸­. 3. ä»£ç éšæƒ³å½•äºŒå‰æ ‘çš„ä¸‰ç§éå†å’Œè¿­ä»£éå†.ä»Šå¤©è¸©äº†ä¸€ä¸ªå°å‘:åœ¨å®ç°è¿­ä»£è°ƒç”¨çš„ç»Ÿä¸€å†™æ³•æ—¶,éœ€è¦åœ¨Dequeä¸­æ’å…¥ä¸€ä¸ªnullå…ƒç´ ä½œä¸ºæ˜¯å¦éå†è¿‡çš„æ ‡å¿—,ä½†æ˜¯å®ç°Dequeæ—¶ç”¨çš„ArrayDeque,è¿™ä¸ªå®ç°æ–¹å¼ä¸èƒ½æ’å…¥nullå…ƒç´ ,éœ€è¦ä½¿ç”¨LinkedListå®ç°æ‰å¯ä»¥.æ„Ÿè§‰è¿™å‡ ä¸ªé›†åˆæ¡†æ¶è¿˜æ˜¯æœ‰å¿…è¦å­¦çš„æ·±å…¥ä¸€äº›çš„,ä¸ç®¡æ˜¯ç®—æ³•è¿˜æ˜¯å†™é¡¹ç›®éƒ½æœ‰å¾ˆå¤§å¸®åŠ©. æ˜å¤©å¼€å§‹è·‘é¡¹ç›®plyç”Ÿæ´»è®°å½•1. å¥èº«ä»Šå¤©å¥èº«æˆ¿ç»ƒä¸Šè‚¢ è‚© èƒ¸ æ ¸å¿ƒ","tags":["åŸºç¡€","æ—¥è®°","leetcode","é¡¹ç›®"],"categories":["å­¦ä¹ æ—¥è®°","2025-06"]},{"title":"JVMå­¦ä¹ ç¬”è®°","path":"/2025/06/09/åŸºç¡€ç¬”è®°/JVMå­¦ä¹ ç¬”è®°/","content":"è¿è¡Œæ—¶æ•°æ®åŒºåŸŸ ç¨‹åºè®¡æ•°å™¨è®°å½•æ­£åœ¨æ‰§è¡Œçš„è™šæ‹Ÿæœºå­—èŠ‚ç æŒ‡ä»¤çš„åœ°å€,å¦‚æœæ˜¯æœ¬åœ°æ–¹æ³•åˆ™ä¸ºç©º. Javaè™šæ‹Ÿæœºæ ˆæ¯ä¸ª Java â½…æ³•åœ¨æ‰§â¾çš„åŒæ—¶ä¼šåˆ›å»ºâ¼€ä¸ªæ ˆå¸§â½¤äºå­˜å‚¨å±€éƒ¨å˜é‡è¡¨ã€æ“ä½œæ•°æ ˆã€å¸¸é‡æ± å¼•â½¤ç­‰ä¿¡æ¯ã€‚ä»â½…æ³•è°ƒâ½¤ç›´â¾„æ‰§â¾å®Œæˆçš„è¿‡ç¨‹ï¼Œå¯¹åº”ç€â¼€ä¸ªæ ˆå¸§åœ¨ Java è™šæ‹Ÿæœºæ ˆä¸­â¼Šæ ˆå’Œå‡ºæ ˆçš„è¿‡ç¨‹ã€‚ è¯¥åŒºåŸŸå¯èƒ½æŠ›å‡ºçš„å¼‚å¸¸: å½“çº¿ç¨‹è¯·æ±‚çš„æ ˆæ·±åº¦è¶…è¿‡æœ€â¼¤å€¼ï¼Œä¼šæŠ›å‡º StackOverflowError å¼‚å¸¸ï¼› æ ˆè¿›â¾åŠ¨æ€æ‰©å±•æ—¶å¦‚æœâ½†æ³•ç”³è¯·åˆ°â¾œå¤Ÿå†…å­˜ï¼Œä¼šæŠ›å‡º OutOfMemoryError å¼‚å¸¸ã€‚ æœ¬åœ°æ–¹æ³•æ ˆæœ¬åœ°æ–¹æ³•æ ˆå’ŒJavaè™šæ‹Ÿæœºæ ˆç±»ä¼¼,åŒºåˆ«åœ¨äºæœ¬åœ°æ–¹æ³•æ ˆä¸ºè™šæ‹Ÿæœºä½¿ç”¨åˆ°çš„ Native â½…æ³•æœåŠ¡. å †æ‰€æœ‰å¯¹è±¡éƒ½åœ¨è¿™â¾¥åˆ†é…å†…å­˜ï¼Œæ˜¯åƒåœ¾æ”¶é›†çš„ä¸»è¦åŒºåŸŸï¼ˆâ€GC å †â€ï¼‰ã€‚ç°ä»£åƒåœ¾æ”¶é›†å™¨åŸºæœ¬éƒ½æ˜¯é‡‡â½¤åˆ†ä»£æ”¶é›†ç®—æ³•ï¼Œå…¶ä¸»è¦çš„æ€æƒ³æ˜¯é’ˆå¯¹ä¸åŒç±»å‹çš„å¯¹è±¡é‡‡å–ä¸åŒçš„åƒåœ¾å›æ”¶ç®—æ³•ã€‚å¯ä»¥å°†å †åˆ†æˆä¸¤å—ï¼š æ–°â½£ä»£ï¼ˆYoung Generationï¼‰ â½¼å¹´ä»£ï¼ˆOld Generationï¼‰å †ä¸éœ€è¦è¿ç»­å†…å­˜ï¼Œå¹¶ä¸”å¯ä»¥åŠ¨æ€å¢åŠ å…¶å†…å­˜ï¼Œå¢åŠ å¤±è´¥ä¼šæŠ›å‡º OutOfMemoryError å¼‚å¸¸ã€‚ â½…æ³•åŒºâ½¤äºå­˜æ”¾å·²è¢«åŠ è½½çš„ç±»ä¿¡æ¯ã€å¸¸é‡ã€é™æ€å˜é‡ã€å³æ—¶ç¼–è¯‘å™¨ç¼–è¯‘åçš„ä»£ç ç­‰æ•°æ®ã€‚å’Œå †â¼€æ ·ä¸éœ€è¦è¿ç»­çš„å†…å­˜ï¼Œå¹¶ä¸”å¯ä»¥åŠ¨æ€æ‰©å±•ï¼ŒåŠ¨æ€æ‰©å±•å¤±è´¥â¼€æ ·ä¼šæŠ›å‡º OutOfMemoryError å¼‚å¸¸ã€‚åœ¨ JDK 1.8 ä¹‹åï¼ŒåŸæ¥æ°¸ä¹…ä»£çš„æ•°æ®è¢«åˆ†åˆ°äº†å †å’Œå…ƒç©ºé—´ä¸­ã€‚å…ƒç©ºé—´å­˜å‚¨ç±»çš„å…ƒä¿¡æ¯ï¼Œé™æ€å˜é‡å’Œå¸¸é‡æ± ç­‰æ”¾â¼Šå †ä¸­ã€‚ è¿è¡Œæ—¶å¸¸é‡æ± æ˜¯â½…æ³•åŒºçš„â¼€éƒ¨åˆ†ã€‚Class â½‚ä»¶ä¸­çš„å¸¸é‡æ± ï¼ˆç¼–è¯‘å™¨â½£æˆçš„å­—â¾¯é‡å’Œç¬¦å·å¼•â½¤ï¼‰ä¼šåœ¨ç±»åŠ è½½åè¢«æ”¾â¼Šè¿™ä¸ªåŒºåŸŸã€‚é™¤äº†åœ¨ç¼–è¯‘æœŸâ½£æˆçš„å¸¸é‡ï¼Œè¿˜å…è®¸åŠ¨æ€â½£æˆï¼Œä¾‹å¦‚ String ç±»çš„ intern()ã€‚ ç›´æ¥å†…å­˜JDK 1.4 æ–°å¼•â¼Šäº† NIO ç±»ï¼Œå®ƒå¯ä»¥ä½¿â½¤ Native å‡½æ•°åº“ç›´æ¥åˆ†é…å †å¤–å†…å­˜ï¼Œç„¶åé€šè¿‡ Java å †â¾¥çš„ DirectByteBufferå¯¹è±¡ä½œä¸ºè¿™å—å†…å­˜çš„å¼•â½¤è¿›â¾æ“ä½œã€‚è¿™æ ·èƒ½åœ¨â¼€äº›åœºæ™¯ä¸­æ˜¾è‘—æâ¾¼æ€§èƒ½ï¼Œå› ä¸ºé¿å…äº†åœ¨å †å†…å­˜å’Œå †å¤–å†…å­˜æ¥å›æ‹·â»‰æ•°æ®ã€‚ ç†è§£è¿è¡Œæ—¶çš„æ•°æ®åŒº åƒåœ¾æ”¶é›†åƒåœ¾æ”¶é›†ä¸»è¦æ˜¯é’ˆå¯¹å †å’Œâ½…æ³•åŒºè¿›â¾ã€‚ç¨‹åºè®¡æ•°å™¨ã€è™šæ‹Ÿæœºæ ˆå’Œæœ¬åœ°â½…æ³•æ ˆè¿™ä¸‰ä¸ªåŒºåŸŸå±äºçº¿ç¨‹ç§æœ‰çš„ï¼Œåªå­˜åœ¨äºçº¿ç¨‹çš„â½£å‘½å‘¨æœŸå†…ï¼Œçº¿ç¨‹ç»“æŸä¹‹åå°±ä¼šæ¶ˆå¤±ï¼Œå› æ­¤ä¸éœ€è¦å¯¹è¿™ä¸‰ä¸ªåŒºåŸŸè¿›â¾åƒåœ¾å›æ”¶ã€‚ åˆ¤æ–­ä¸€ä¸ªå¯¹è±¡æ˜¯å¦å¯è¢«å›æ”¶1. å¼•â½¤è®¡æ•°ç®—æ³•ä¸ºå¯¹è±¡æ·»åŠ â¼€ä¸ªå¼•â½¤è®¡æ•°å™¨ï¼Œå½“å¯¹è±¡å¢åŠ â¼€ä¸ªå¼•â½¤æ—¶è®¡æ•°å™¨åŠ  1ï¼Œå¼•â½¤å¤±æ•ˆæ—¶è®¡æ•°å™¨å‡ 1ã€‚å¼•â½¤è®¡æ•°ä¸º 0 çš„å¯¹è±¡å¯è¢«å›æ”¶ã€‚ ä½†ç”±äºå¯¹è±¡ä¹‹é—´å¾ªç¯å¼•ç”¨çš„å­˜åœ¨ï¼Œå¼•â½¤è®¡æ•°å™¨ä¹Ÿä¼šå¤±æ•ˆã€‚ 2. å¯è¾¾æ€§åˆ†æç®—æ³•ä»¥ GC Roots ä¸ºèµ·å§‹ç‚¹è¿›â¾æœç´¢ï¼Œå¯è¾¾çš„å¯¹è±¡éƒ½æ˜¯å­˜æ´»çš„ï¼Œä¸å¯è¾¾çš„å¯¹è±¡å¯è¢«å›æ”¶ã€‚Java è™šæ‹Ÿæœºä½¿â½¤è¯¥ç®—æ³•æ¥åˆ¤æ–­å¯¹è±¡æ˜¯å¦å¯è¢«å›æ”¶ï¼ŒGC Roots â¼€èˆ¬åŒ…å«ä»¥ä¸‹å†…å®¹ï¼š è™šæ‹Ÿæœºæ ˆä¸­å±€éƒ¨å˜é‡è¡¨ä¸­å¼•â½¤çš„å¯¹è±¡ æœ¬åœ°â½…æ³•æ ˆä¸­ JNI ä¸­å¼•â½¤çš„å¯¹è±¡ â½…æ³•åŒºä¸­ç±»é™æ€å±æ€§å¼•â½¤çš„å¯¹è±¡ â½…æ³•åŒºä¸­çš„å¸¸é‡å¼•â½¤çš„å¯¹è±¡ 3. æ–¹æ³•åŒºçš„å›æ”¶å› ä¸ºâ½…æ³•åŒºä¸»è¦å­˜æ”¾æ°¸ä¹…ä»£å¯¹è±¡ï¼Œâ½½æ°¸ä¹…ä»£å¯¹è±¡çš„å›æ”¶ç‡â½æ–°â½£ä»£ä½å¾ˆå¤šï¼Œæ‰€ä»¥åœ¨â½…æ³•åŒºä¸Šè¿›â¾å›æ”¶æ€§ä»·â½ä¸â¾¼ã€‚ä¸»è¦æ˜¯å¯¹å¸¸é‡æ± çš„å›æ”¶å’Œå¯¹ç±»çš„å¸è½½ã€‚ä¸ºäº†é¿å…å†…å­˜æº¢å‡ºï¼Œåœ¨â¼¤é‡ä½¿â½¤åå°„å’ŒåŠ¨æ€ä»£ç†çš„åœºæ™¯éƒ½éœ€è¦è™šæ‹Ÿæœºå…·å¤‡ç±»å¸è½½åŠŸèƒ½ã€‚ç±»çš„å¸è½½æ¡ä»¶å¾ˆå¤šï¼Œéœ€è¦æ»¡â¾œä»¥ä¸‹ä¸‰ä¸ªæ¡ä»¶ï¼Œå¹¶ä¸”æ»¡â¾œäº†æ¡ä»¶ä¹Ÿä¸â¼€å®šä¼šè¢«å¸è½½ï¼š è¯¥ç±»æ‰€æœ‰çš„å®ä¾‹éƒ½å·²ç»è¢«å›æ”¶ï¼Œæ­¤æ—¶å †ä¸­ä¸å­˜åœ¨è¯¥ç±»çš„ä»»ä½•å®ä¾‹ã€‚ åŠ è½½è¯¥ç±»çš„ ClassLoader å·²ç»è¢«å›æ”¶ã€‚ è¯¥ç±»å¯¹åº”çš„ Class å¯¹è±¡æ²¡æœ‰åœ¨ä»»ä½•åœ°â½…è¢«å¼•â½¤ï¼Œä¹Ÿå°±â½†æ³•åœ¨ä»»ä½•åœ°â½…é€šè¿‡åå°„è®¿é—®è¯¥ç±»â½…æ³•ã€‚ 4. finalize()ç±»ä¼¼ C++ çš„ææ„å‡½æ•°ï¼Œâ½¤äºå…³é—­å¤–éƒ¨èµ„æºã€‚ä½†æ˜¯â½¤ try-finally å¯ä»¥åšå¾—æ›´å¥½ï¼Œå¹¶ä¸” finalize â½…æ³•è¿â¾ä»£ä»·å¾ˆâ¾¼ï¼Œä¸ç¡®å®šæ€§â¼¤ï¼Œâ½†æ³•ä¿è¯å„ä¸ªå¯¹è±¡çš„è°ƒâ½¤é¡ºåºï¼Œå› æ­¤æœ€å¥½ä¸è¦ä½¿â½¤ã€‚ å¼•ç”¨ç±»å‹â½†è®ºæ˜¯é€šè¿‡å¼•â½¤è®¡æ•°ç®—æ³•åˆ¤æ–­å¯¹è±¡çš„å¼•â½¤æ•°é‡ï¼Œè¿˜æ˜¯é€šè¿‡å¯è¾¾æ€§åˆ†æç®—æ³•åˆ¤æ–­å¯¹è±¡æ˜¯å¦å¯è¾¾ï¼Œåˆ¤å®šå¯¹è±¡æ˜¯å¦å¯è¢«å›æ”¶éƒ½ä¸å¼•â½¤æœ‰å…³ã€‚Java æä¾›äº†å››ç§å¼ºåº¦ä¸åŒçš„å¼•â½¤ç±»å‹ã€‚ 1. å¼ºå¼•â½¤è¢«å¼ºå¼•â½¤å…³è”çš„å¯¹è±¡ä¸ä¼šè¢«å›æ”¶ã€‚ä½¿â½¤ new â¼€ä¸ªæ–°å¯¹è±¡çš„â½…å¼æ¥åˆ›å»ºå¼ºå¼•â½¤ã€‚Object obj = new Object(); 2. è½¯å¼•â½¤è¢«è½¯å¼•â½¤å…³è”çš„å¯¹è±¡åªæœ‰åœ¨å†…å­˜ä¸å¤Ÿçš„æƒ…å†µä¸‹æ‰ä¼šè¢«å›æ”¶ã€‚ä½¿â½¤ SoftReference ç±»æ¥åˆ›å»ºè½¯å¼•â½¤ã€‚ Object obj = new Object();SoftReferenceObject sf = new SoftReferenceObject(obj);obj = null; // ä½¿å¯¹è±¡åªè¢«è½¯å¼•â½¤å…³è” 3. å¼±å¼•â½¤è¢«å¼±å¼•â½¤å…³è”çš„å¯¹è±¡â¼€å®šä¼šè¢«å›æ”¶ï¼Œä¹Ÿå°±æ˜¯è¯´å®ƒåªèƒ½å­˜æ´»åˆ°ä¸‹â¼€æ¬¡åƒåœ¾å›æ”¶å‘â½£ä¹‹å‰ã€‚ä½¿â½¤ WeakReference ç±»æ¥åˆ›å»ºå¼±å¼•â½¤ã€‚ Object obj = new Object();WeakReferenceObject wf = new WeakReferenceObject(obj);obj = null; 4. è™šå¼•â½¤â¼œç§°ä¸ºå¹½çµå¼•â½¤æˆ–è€…å¹»å½±å¼•â½¤ï¼Œâ¼€ä¸ªå¯¹è±¡æ˜¯å¦æœ‰è™šå¼•â½¤çš„å­˜åœ¨ï¼Œä¸ä¼šå¯¹å…¶â½£å­˜æ—¶é—´é€ æˆå½±å“ï¼Œä¹Ÿâ½†æ³•é€šè¿‡è™šå¼•â½¤å¾—åˆ°â¼€ä¸ªå¯¹è±¡ã€‚ä¸ºâ¼€ä¸ªå¯¹è±¡è®¾ç½®è™šå¼•â½¤çš„å”¯â¼€â½¬çš„æ˜¯èƒ½åœ¨è¿™ä¸ªå¯¹è±¡è¢«å›æ”¶æ—¶æ”¶åˆ°â¼€ä¸ªç³»ç»Ÿé€šçŸ¥ã€‚ä½¿â½¤ PhantomReference æ¥åˆ›å»ºè™šå¼•â½¤ã€‚ Object obj = new Object();PhantomReferenceObject pf = new PhantomReferenceObject(obj, null);obj = null; åƒåœ¾æ”¶é›†ç®—æ³•1. æ ‡è®°-æ¸…é™¤ç®—æ³•æœ€åŸºç¡€çš„æ”¶é›†ç®—æ³•ï¼Œåˆ†ä¸ºâ€œæ ‡è®°â€å’Œâ€œæ¸…é™¤â€ä¸¤ä¸ªé˜¶æ®µï¼šé¦–å…ˆæ ‡è®°å‡ºæ‰€æœ‰éœ€è¦å›æ”¶çš„å¯¹è±¡ï¼Œåœ¨æ ‡è®°å®Œæˆåç»Ÿä¸€å›æ”¶æ‰€æœ‰è¢«æ ‡è®°çš„å¯¹è±¡ã€‚ä¸è¶³: æ•ˆç‡é—®é¢˜ï¼Œæ ‡è®°å’Œæ¸…é™¤ä¸¤ä¸ªè¿‡ç¨‹çš„æ•ˆç‡éƒ½ä¸â¾¼ï¼› ç©ºé—´é—®é¢˜ï¼Œä¼šäº§â½£â¼¤é‡ä¸è¿ç»­çš„å†…å­˜ç¢â½šï¼Œå¯¼è‡´â½†æ³•ç»™â¼¤å¯¹è±¡åˆ†é…å†…å­˜ã€‚ 2. æ ‡è®°-æ•´ç†ç®—æ³•è®©æ‰€æœ‰å­˜æ´»çš„å¯¹è±¡éƒ½å‘â¼€ç«¯ç§»åŠ¨ï¼Œç„¶åç›´æ¥æ¸…ç†æ‰ç«¯è¾¹ç•Œä»¥å¤–çš„å†…å­˜ã€‚ ä¼˜ç‚¹: ä¸ä¼šäº§â½£å†…å­˜ç¢â½š ä¸â¾œ: éœ€è¦ç§»åŠ¨â¼¤é‡å¯¹è±¡ï¼Œå¤„ç†æ•ˆç‡â½è¾ƒä½ã€‚ 3. å¤åˆ¶ç®—æ³•å°†å†…å­˜åˆ’åˆ†ä¸ºâ¼¤â¼©ç›¸ç­‰çš„ä¸¤å—ï¼Œæ¯æ¬¡åªä½¿â½¤å…¶ä¸­â¼€å—ï¼Œå½“è¿™â¼€å—å†…å­˜â½¤å®Œäº†å°±å°†è¿˜å­˜æ´»çš„å¯¹è±¡å¤åˆ¶åˆ°å¦â¼€å—ä¸Šâ¾¯ï¼Œç„¶åå†æŠŠä½¿â½¤è¿‡çš„å†…å­˜ç©ºé—´è¿›â¾â¼€æ¬¡æ¸…ç†ã€‚ä¸â¾œæ˜¯åªä½¿â½¤äº†å†…å­˜çš„â¼€åŠã€‚ 4. åˆ†ä»£æ”¶é›†ç®—æ³•ç°åœ¨çš„å•†ä¸šè™šæ‹Ÿæœºé‡‡â½¤åˆ†ä»£æ”¶é›†ç®—æ³•ï¼Œå®ƒæ ¹æ®å¯¹è±¡å­˜æ´»å‘¨æœŸå°†å†…å­˜åˆ’åˆ†ä¸ºâ¼å—ï¼Œä¸åŒå—é‡‡â½¤é€‚å½“çš„æ”¶é›†ç®—æ³•ã€‚â¼€èˆ¬å°†å †åˆ†ä¸ºæ–°â½£ä»£å’Œâ½¼å¹´ä»£ã€‚ æ–°â½£ä»£ä½¿â½¤ï¼šå¤åˆ¶ç®—æ³• â½¼å¹´ä»£ä½¿â½¤ï¼šæ ‡è®° - æ¸…é™¤ æˆ–è€… æ ‡è®° - æ•´ç† ç®—æ³• åƒåœ¾æ”¶é›†å™¨ä»¥ä¸Šæ˜¯ HotSpot è™šæ‹Ÿæœºä¸­çš„ 7 ä¸ªåƒåœ¾æ”¶é›†å™¨ï¼Œè¿çº¿è¡¨ç¤ºåƒåœ¾æ”¶é›†å™¨å¯ä»¥é…åˆä½¿â½¤ã€‚ å•çº¿ç¨‹ä¸å¤šçº¿ç¨‹ï¼šå•çº¿ç¨‹æŒ‡çš„æ˜¯åƒåœ¾æ”¶é›†å™¨åªä½¿â½¤â¼€ä¸ªçº¿ç¨‹ï¼Œâ½½å¤šçº¿ç¨‹ä½¿â½¤å¤šä¸ªçº¿ç¨‹ï¼› ä¸²â¾ä¸å¹¶â¾ï¼šä¸²â¾æŒ‡çš„æ˜¯åƒåœ¾æ”¶é›†å™¨ä¸â½¤æˆ·ç¨‹åºäº¤æ›¿æ‰§â¾ï¼Œè¿™æ„å‘³ç€åœ¨æ‰§â¾åƒåœ¾æ”¶é›†çš„æ—¶å€™éœ€è¦åœé¡¿â½¤æˆ·ç¨‹åºï¼›å¹¶â¾æŒ‡çš„æ˜¯åƒåœ¾æ”¶é›†å™¨å’Œâ½¤æˆ·ç¨‹åºåŒæ—¶æ‰§â¾ã€‚é™¤äº† CMS å’Œ G1 ä¹‹å¤–ï¼Œå…¶å®ƒåƒåœ¾æ”¶é›†å™¨éƒ½æ˜¯ä»¥ä¸²â¾çš„â½…å¼æ‰§â¾ã€‚ 1. Serial æ”¶é›†å™¨ä¸²è¡Œçš„åƒåœ¾æ”¶é›†å™¨ï¼Œæ˜¯æœ€åŸºæœ¬ã€å†å²æœ€æ‚ ä¹…çš„åƒåœ¾æ”¶é›†å™¨ã€‚å•CPUç¯å¢ƒä¸‹ï¼ŒSerial æ”¶é›†å™¨ç”±äºæ²¡æœ‰çº¿ç¨‹äº¤äº’çš„å¼€é”€ï¼Œå¯ä»¥è·å¾—æœ€é«˜çš„å•çº¿ç¨‹æ”¶é›†æ•ˆç‡ã€‚ ä¼˜ç‚¹: ç®€å•ã€å®¹æ˜“å®ç° ç¼ºç‚¹: å•çº¿ç¨‹ã€åœé¡¿æ—¶é—´â»“ 2. ParNew æ”¶é›†å™¨ParNew æ”¶é›†å™¨æ˜¯ Serial æ”¶é›†å™¨çš„å¤šçº¿ç¨‹ç‰ˆæœ¬ï¼Œå®ƒæ˜¯ Server åœºæ™¯ä¸‹é»˜è®¤çš„æ–°â½£ä»£æ”¶é›†å™¨ï¼Œé™¤äº†æ€§èƒ½åŸå› å¤–ï¼Œä¸»è¦æ˜¯å› ä¸ºé™¤äº† Serial æ”¶é›†å™¨ï¼Œåªæœ‰å®ƒèƒ½ä¸ CMS æ”¶é›†å™¨é…åˆä½¿â½¤ã€‚ 3. Parallel Scavenge æ”¶é›†å™¨ä¸ ParNew â¼€æ ·æ˜¯å¤šçº¿ç¨‹æ”¶é›†å™¨ã€‚å…¶å®ƒæ”¶é›†å™¨â½¬æ ‡æ˜¯å°½å¯èƒ½ç¼©çŸ­åƒåœ¾æ”¶é›†æ—¶â½¤æˆ·çº¿ç¨‹çš„åœé¡¿æ—¶é—´ï¼Œâ½½å®ƒçš„â½¬æ ‡æ˜¯è¾¾åˆ°â¼€ä¸ªå¯æ§åˆ¶çš„ååé‡ï¼Œå› æ­¤å®ƒè¢«ç§°ä¸ºâ€œååé‡ä¼˜å…ˆâ€æ”¶é›†å™¨ã€‚è¿™â¾¥çš„ååé‡æŒ‡ CPU â½¤äºè¿â¾â½¤æˆ·ç¨‹åºçš„æ—¶é—´å æ€»æ—¶é—´çš„â½å€¼ã€‚ 4. Serial Old æ”¶é›†å™¨æ˜¯ Serial æ”¶é›†å™¨çš„â½¼å¹´ä»£ç‰ˆæœ¬ï¼Œä¹Ÿæ˜¯ç»™ Client åœºæ™¯ä¸‹çš„è™šæ‹Ÿæœºä½¿â½¤ã€‚å¦‚æœâ½¤åœ¨ Server åœºæ™¯ä¸‹ï¼Œå®ƒæœ‰ä¸¤â¼¤â½¤é€”ï¼š åœ¨ JDK 1.5 ä»¥åŠä¹‹å‰ç‰ˆæœ¬ï¼ˆParallel Old è¯â½£ä»¥å‰ï¼‰ä¸­ä¸ Parallel Scavenge æ”¶é›†å™¨æ­é…ä½¿â½¤ã€‚ ä½œä¸º CMS æ”¶é›†å™¨çš„åå¤‡é¢„æ¡ˆï¼Œåœ¨å¹¶å‘æ”¶é›†å‘â½£ Concurrent Mode Failure æ—¶ä½¿â½¤ã€‚ 5. Parallel Old æ”¶é›†å™¨æ˜¯ Parallel Scavenge æ”¶é›†å™¨çš„â½¼å¹´ä»£ç‰ˆæœ¬ã€‚åœ¨æ³¨é‡ååé‡ä»¥åŠ CPU èµ„æºæ•æ„Ÿçš„åœºåˆï¼Œéƒ½å¯ä»¥ä¼˜å…ˆè€ƒè™‘ Parallel Scavenge åŠ  Parallel Old æ”¶é›†å™¨ã€‚ 6. CMS æ”¶é›†å™¨CMSï¼ˆConcurrent Mark Sweepï¼‰ï¼ŒMark Sweep æŒ‡çš„æ˜¯æ ‡è®° - æ¸…é™¤ç®—æ³•ã€‚åˆ†ä¸ºä»¥ä¸‹å››ä¸ªæµç¨‹ï¼š åˆå§‹æ ‡è®°ï¼šä»…ä»…åªæ˜¯æ ‡è®°â¼€ä¸‹ GC Roots èƒ½ç›´æ¥å…³è”åˆ°çš„å¯¹è±¡ï¼Œé€Ÿåº¦å¾ˆå¿«ï¼Œéœ€è¦åœé¡¿ã€‚ å¹¶å‘æ ‡è®°ï¼šè¿›â¾ GC Roots Tracing çš„è¿‡ç¨‹ï¼Œå®ƒåœ¨æ•´ä¸ªå›æ”¶è¿‡ç¨‹ä¸­è€—æ—¶æœ€â»“ï¼Œä¸éœ€è¦åœé¡¿ã€‚ é‡æ–°æ ‡è®°ï¼šä¸ºäº†ä¿®æ­£å¹¶å‘æ ‡è®°æœŸé—´å› â½¤æˆ·ç¨‹åºç»§ç»­è¿ä½œâ½½å¯¼è‡´æ ‡è®°äº§â½£å˜åŠ¨çš„é‚£â¼€éƒ¨åˆ†å¯¹è±¡çš„æ ‡è®°è®°å½•ï¼Œéœ€è¦åœé¡¿ã€‚ å¹¶å‘æ¸…é™¤ï¼šä¸éœ€è¦åœé¡¿ã€‚ åœ¨æ•´ä¸ªè¿‡ç¨‹ä¸­è€—æ—¶æœ€â»“çš„å¹¶å‘æ ‡è®°å’Œå¹¶å‘æ¸…é™¤è¿‡ç¨‹ä¸­ï¼Œæ”¶é›†å™¨çº¿ç¨‹éƒ½å¯ä»¥ä¸â½¤æˆ·çº¿ç¨‹â¼€èµ·â¼¯ä½œï¼Œä¸éœ€è¦è¿›â¾åœé¡¿ã€‚å…·æœ‰ä»¥ä¸‹ç¼ºç‚¹ï¼š ååé‡ä½ï¼šä½åœé¡¿æ—¶é—´æ˜¯ä»¥ç‰ºç‰²ååé‡ä¸ºä»£ä»·çš„ï¼Œå¯¼è‡´ CPU åˆ©â½¤ç‡ä¸å¤Ÿâ¾¼ã€‚ â½†æ³•å¤„ç†æµ®åŠ¨åƒåœ¾ï¼Œå¯èƒ½å‡ºç° Concurrent Mode Failureã€‚æµ®åŠ¨åƒåœ¾æ˜¯æŒ‡å¹¶å‘æ¸…é™¤é˜¶æ®µç”±äºâ½¤æˆ·çº¿ç¨‹ç»§ç»­è¿â¾â½½äº§â½£çš„åƒåœ¾ï¼Œè¿™éƒ¨åˆ†åƒåœ¾åªèƒ½åˆ°ä¸‹â¼€æ¬¡ GC æ—¶æ‰èƒ½è¿›â¾å›æ”¶ã€‚ç”±äºæµ®åŠ¨åƒåœ¾çš„å­˜åœ¨ï¼Œå› æ­¤éœ€è¦é¢„ç•™å‡ºâ¼€éƒ¨åˆ†å†…å­˜ï¼Œæ„å‘³ç€ CMS æ”¶é›†ä¸èƒ½åƒå…¶å®ƒæ”¶é›†å™¨é‚£æ ·ç­‰å¾…â½¼å¹´ä»£å¿«æ»¡çš„æ—¶å€™å†å›æ”¶ã€‚å¦‚æœé¢„ç•™çš„å†…å­˜ä¸å¤Ÿå­˜æ”¾æµ®åŠ¨åƒåœ¾ï¼Œå°±ä¼šå‡ºç° Concurrent Mode Failureï¼Œè¿™æ—¶è™šæ‹Ÿæœºå°†ä¸´æ—¶å¯â½¤ Serial Old æ¥æ›¿ä»£ CMSã€‚ æ ‡è®° - æ¸…é™¤ç®—æ³•å¯¼è‡´çš„ç©ºé—´ç¢â½šï¼Œå¾€å¾€å‡ºç°â½¼å¹´ä»£ç©ºé—´å‰©ä½™ï¼Œä½†â½†æ³•æ‰¾åˆ°â¾œå¤Ÿâ¼¤è¿ç»­ç©ºé—´æ¥åˆ†é…å½“å‰å¯¹è±¡ï¼Œä¸å¾—ä¸æå‰è§¦å‘â¼€æ¬¡ Full GCã€‚ 7. G1 æ”¶é›†å™¨G1ï¼ˆGarbage-Firstï¼‰ï¼Œå®ƒæ˜¯â¼€æ¬¾â¾¯å‘æœåŠ¡ç«¯åº”â½¤çš„åƒåœ¾æ”¶é›†å™¨ï¼Œåœ¨å¤š CPU å’Œâ¼¤å†…å­˜çš„åœºæ™¯ä¸‹æœ‰å¾ˆå¥½çš„æ€§èƒ½ã€‚å †è¢«åˆ†ä¸ºæ–°â½£ä»£å’Œâ½¼å¹´ä»£ï¼Œå…¶å®ƒæ”¶é›†å™¨è¿›â¾æ”¶é›†çš„èŒƒå›´éƒ½æ˜¯æ•´ä¸ªæ–°â½£ä»£æˆ–è€…â½¼å¹´ä»£ï¼Œâ½½ G1 å¯ä»¥ç›´æ¥å¯¹æ–°â½£ä»£å’Œâ½¼å¹´ä»£â¼€èµ·å›æ”¶ã€‚G1 æŠŠå †åˆ’åˆ†æˆå¤šä¸ªâ¼¤â¼©ç›¸ç­‰çš„ç‹¬â½´åŒºåŸŸï¼ˆRegionï¼‰ï¼Œæ–°â½£ä»£å’Œâ½¼å¹´ä»£ä¸å†ç‰©ç†éš”ç¦»ã€‚é€šè¿‡å¼•â¼Š Region çš„æ¦‚å¿µï¼Œä»â½½å°†åŸæ¥çš„â¼€æ•´å—å†…å­˜ç©ºé—´åˆ’åˆ†æˆå¤šä¸ªçš„â¼©ç©ºé—´ï¼Œä½¿å¾—æ¯ä¸ªâ¼©ç©ºé—´å¯ä»¥å•ç‹¬è¿›â¾åƒåœ¾å›æ”¶ã€‚è¿™ç§åˆ’åˆ†â½…æ³•å¸¦æ¥äº†å¾ˆâ¼¤çš„çµæ´»æ€§ï¼Œä½¿å¾—å¯é¢„æµ‹çš„åœé¡¿æ—¶é—´æ¨¡å‹æˆä¸ºå¯èƒ½ã€‚é€šè¿‡è®°å½•æ¯ä¸ª Region åƒåœ¾å›æ”¶æ—¶é—´ä»¥åŠå›æ”¶æ‰€è·å¾—çš„ç©ºé—´ï¼ˆè¿™ä¸¤ä¸ªå€¼æ˜¯é€šè¿‡è¿‡å»å›æ”¶çš„ç»éªŒè·å¾—ï¼‰ï¼Œå¹¶ç»´æŠ¤â¼€ä¸ªä¼˜å…ˆåˆ—è¡¨ï¼Œæ¯æ¬¡æ ¹æ®å…è®¸çš„æ”¶é›†æ—¶é—´ï¼Œä¼˜å…ˆå›æ”¶ä»·å€¼æœ€â¼¤çš„ Regionã€‚æ¯ä¸ª Region éƒ½æœ‰â¼€ä¸ª Remembered Setï¼Œâ½¤æ¥è®°å½•è¯¥ Region å¯¹è±¡çš„å¼•â½¤å¯¹è±¡æ‰€åœ¨çš„ Regionã€‚é€šè¿‡ä½¿â½¤Remembered Setï¼Œåœ¨åšå¯è¾¾æ€§åˆ†æçš„æ—¶å€™å°±å¯ä»¥é¿å…å…¨å †æ‰«æã€‚ å¦‚æœä¸è®¡ç®—ç»´æŠ¤ Remembered Set çš„æ“ä½œï¼ŒG1 æ”¶é›†å™¨çš„è¿ä½œâ¼¤è‡´å¯åˆ’åˆ†ä¸ºä»¥ä¸‹â¼ä¸ªæ­¥éª¤ï¼š åˆå§‹æ ‡è®° å¹¶å‘æ ‡è®° æœ€ç»ˆæ ‡è®°ï¼šä¸ºäº†ä¿®æ­£åœ¨å¹¶å‘æ ‡è®°æœŸé—´å› â½¤æˆ·ç¨‹åºç»§ç»­è¿ä½œâ½½å¯¼è‡´æ ‡è®°äº§â½£å˜åŠ¨çš„é‚£â¼€éƒ¨åˆ†æ ‡è®°è®°å½•ï¼Œè™šæ‹Ÿæœºå°†è¿™æ®µæ—¶é—´å¯¹è±¡å˜åŒ–è®°å½•åœ¨çº¿ç¨‹çš„ Remembered Set Logs â¾¥â¾¯ï¼Œæœ€ç»ˆæ ‡è®°é˜¶æ®µéœ€è¦æŠŠ Remembered Set Logsçš„æ•°æ®åˆå¹¶åˆ° Remembered Set ä¸­ã€‚è¿™é˜¶æ®µéœ€è¦åœé¡¿çº¿ç¨‹ï¼Œä½†æ˜¯å¯å¹¶â¾æ‰§â¾ã€‚ ç­›é€‰å›æ”¶ï¼šâ¾¸å…ˆå¯¹å„ä¸ª Region ä¸­çš„å›æ”¶ä»·å€¼å’Œæˆæœ¬è¿›â¾æ’åºï¼Œæ ¹æ®â½¤æˆ·æ‰€æœŸæœ›çš„ GC åœé¡¿æ—¶é—´æ¥åˆ¶å®šå›æ”¶è®¡åˆ’ã€‚æ­¤é˜¶æ®µå…¶å®ä¹Ÿå¯ä»¥åšåˆ°ä¸â½¤æˆ·ç¨‹åºâ¼€èµ·å¹¶å‘æ‰§â¾ï¼Œä½†æ˜¯å› ä¸ºåªå›æ”¶â¼€éƒ¨åˆ† Regionï¼Œæ—¶é—´æ˜¯â½¤æˆ·å¯æ§åˆ¶çš„ï¼Œâ½½ä¸”åœé¡¿â½¤æˆ·çº¿ç¨‹å°†â¼¤å¹…åº¦æâ¾¼æ”¶é›†æ•ˆç‡ã€‚ å…·å¤‡å¦‚ä¸‹ç‰¹ç‚¹ï¼š ç©ºé—´æ•´åˆï¼šæ•´ä½“æ¥çœ‹æ˜¯åŸºäºâ€œæ ‡è®° - æ•´ç†â€ç®—æ³•å®ç°çš„æ”¶é›†å™¨ï¼Œä»å±€éƒ¨ï¼ˆä¸¤ä¸ª Region ä¹‹é—´ï¼‰ä¸Šæ¥çœ‹æ˜¯åŸºäºâ€œå¤åˆ¶â€ç®—æ³•å®ç°çš„ï¼Œè¿™æ„å‘³ç€è¿â¾æœŸé—´ä¸ä¼šäº§â½£å†…å­˜ç©ºé—´ç¢â½šã€‚ å¯é¢„æµ‹çš„åœé¡¿ï¼šèƒ½è®©ä½¿â½¤è€…æ˜ç¡®æŒ‡å®šåœ¨â¼€ä¸ªâ»“åº¦ä¸º M æ¯«ç§’çš„æ—¶é—´â½šæ®µå†…ï¼Œæ¶ˆè€—åœ¨ GC ä¸Šçš„æ—¶é—´ä¸å¾—è¶…è¿‡ N æ¯«ç§’ã€‚ å†…å­˜åˆ†é…ä¸å›æ”¶ç­–ç•¥â€™Minor GC å’Œ Full GC Minor GCï¼šå›æ”¶æ–°â½£ä»£ï¼Œå› ä¸ºæ–°â½£ä»£å¯¹è±¡å­˜æ´»æ—¶é—´å¾ˆçŸ­ï¼Œå› æ­¤ Minor GC ä¼šé¢‘ç¹æ‰§â¾ï¼Œæ‰§â¾çš„é€Ÿåº¦â¼€èˆ¬ä¹Ÿä¼šâ½è¾ƒå¿«ã€‚ Full GCï¼šå›æ”¶â½¼å¹´ä»£å’Œæ–°â½£ä»£ï¼Œâ½¼å¹´ä»£å¯¹è±¡å­˜æ´»æ—¶é—´â»“ï¼Œå› æ­¤ Full GC å¾ˆå°‘æ‰§â¾ï¼Œæ‰§â¾é€Ÿåº¦ä¼šâ½ Minor GC æ…¢å¾ˆå¤šã€‚ å†…å­˜åˆ†é…ç­–ç•¥ å¯¹è±¡ä¼˜å…ˆåœ¨ Eden åˆ†é…â¼¤å¤šæ•°æƒ…å†µä¸‹ï¼Œå¯¹è±¡åœ¨æ–°â½£ä»£ Eden ä¸Šåˆ†é…ï¼Œå½“ Eden ç©ºé—´ä¸å¤Ÿæ—¶ï¼Œå‘èµ· Minor GCã€‚ â¼¤å¯¹è±¡ç›´æ¥è¿›â¼Šâ½¼å¹´ä»£â¼¤å¯¹è±¡æ˜¯æŒ‡éœ€è¦è¿ç»­å†…å­˜ç©ºé—´çš„å¯¹è±¡ï¼Œæœ€å…¸å‹çš„â¼¤å¯¹è±¡æ˜¯é‚£ç§å¾ˆâ»“çš„å­—ç¬¦ä¸²ä»¥åŠæ•°ç»„ã€‚ç»å¸¸å‡ºç°â¼¤å¯¹è±¡ä¼šæå‰è§¦å‘åƒåœ¾æ”¶é›†ä»¥è·å–â¾œå¤Ÿçš„è¿ç»­ç©ºé—´åˆ†é…ç»™â¼¤å¯¹è±¡ã€‚-XX:PretenureSizeThresholdï¼Œâ¼¤äºæ­¤å€¼çš„å¯¹è±¡ç›´æ¥åœ¨â½¼å¹´ä»£åˆ†é…ï¼Œé¿å…åœ¨ Eden å’Œ Survivorä¹‹é—´çš„â¼¤é‡å†…å­˜å¤åˆ¶ã€‚ â»“æœŸå­˜æ´»çš„å¯¹è±¡è¿›â¼Šâ½¼å¹´ä»£ä¸ºå¯¹è±¡å®šä¹‰å¹´é¾„è®¡æ•°å™¨ï¼Œå¯¹è±¡åœ¨ Eden å‡ºâ½£å¹¶ç»è¿‡ Minor GC ä¾ç„¶å­˜æ´»ï¼Œå°†ç§»åŠ¨åˆ° Survivorä¸­ï¼Œå¹´é¾„å°±å¢åŠ  1 å²ï¼Œå¢åŠ åˆ°â¼€å®šå¹´é¾„åˆ™ç§»åŠ¨åˆ°â½¼å¹´ä»£ä¸­ã€‚-XX:MaxTenuringThreshold â½¤æ¥å®šä¹‰å¹´é¾„çš„é˜ˆå€¼ã€‚ åŠ¨æ€å¯¹è±¡å¹´é¾„åˆ¤å®šè™šæ‹Ÿæœºå¹¶ä¸æ˜¯æ°¸è¿œè¦æ±‚å¯¹è±¡çš„å¹´é¾„å¿…é¡»è¾¾åˆ° MaxTenuringThreshold æ‰èƒ½æ™‹å‡â½¼å¹´ä»£ï¼Œå¦‚æœåœ¨Survivor ä¸­ç›¸åŒå¹´é¾„æ‰€æœ‰å¯¹è±¡â¼¤â¼©çš„æ€»å’Œâ¼¤äº Survivor ç©ºé—´çš„â¼€åŠï¼Œåˆ™å¹´é¾„â¼¤äºæˆ–ç­‰äºè¯¥å¹´é¾„çš„å¯¹è±¡å¯ä»¥ç›´æ¥è¿›â¼Šâ½¼å¹´ä»£ï¼Œâ½†éœ€ç­‰åˆ° MaxTenuringThreshold ä¸­è¦æ±‚çš„å¹´é¾„ã€‚ ç©ºé—´åˆ†é…æ‹…ä¿åœ¨å‘â½£ Minor GC ä¹‹å‰ï¼Œè™šæ‹Ÿæœºå…ˆæ£€æŸ¥â½¼å¹´ä»£æœ€â¼¤å¯â½¤çš„è¿ç»­ç©ºé—´æ˜¯å¦â¼¤äºæ–°â½£ä»£æ‰€æœ‰å¯¹è±¡æ€»ç©ºé—´ï¼Œå¦‚æœæ¡ä»¶æˆâ½´çš„è¯ï¼Œé‚£ä¹ˆ Minor GC å¯ä»¥ç¡®è®¤æ˜¯å®‰å…¨çš„ã€‚å¦‚æœä¸æˆâ½´çš„è¯è™šæ‹Ÿæœºä¼šæŸ¥çœ‹ HandlePromotionFailure çš„å€¼æ˜¯å¦å…è®¸æ‹…ä¿å¤±è´¥ï¼Œå¦‚æœå…è®¸é‚£ä¹ˆå°±ä¼šç»§ç»­æ£€æŸ¥â½¼å¹´ä»£æœ€â¼¤å¯â½¤çš„è¿ç»­ç©ºé—´æ˜¯å¦â¼¤äºå†æ¬¡æ™‹å‡åˆ°â½¼å¹´ä»£å¯¹è±¡çš„å¹³å‡â¼¤â¼©ï¼Œå¦‚æœâ¼¤äºï¼Œå°†å°è¯•ç€è¿›â¾â¼€æ¬¡ Minor GCï¼›å¦‚æœâ¼©äºï¼Œæˆ–è€… HandlePromotionFailure çš„å€¼ä¸å…è®¸å†’é™©ï¼Œé‚£ä¹ˆå°±è¦è¿›â¾â¼€æ¬¡ Full GCã€‚ Full GC çš„è§¦å‘æ¡ä»¶å¯¹äº Minor GCï¼Œå…¶è§¦å‘æ¡ä»¶â¾®å¸¸ç®€å•ï¼Œå½“ Eden ç©ºé—´æ»¡æ—¶ï¼Œå°±å°†è§¦å‘â¼€æ¬¡ Minor GCã€‚â½½ FullGC åˆ™ç›¸å¯¹å¤æ‚ï¼Œæœ‰ä»¥ä¸‹æ¡ä»¶ï¼š è°ƒâ½¤ System.gc()åªæ˜¯å»ºè®®è™šæ‹Ÿæœºæ‰§â¾ Full GCï¼Œä½†æ˜¯è™šæ‹Ÿæœºä¸â¼€å®šçœŸæ­£å»æ‰§â¾ã€‚ä¸å»ºè®®ä½¿â½¤è¿™ç§â½…å¼ï¼Œâ½½æ˜¯è®©è™šæ‹Ÿæœºç®¡ç†å†…å­˜ã€‚ â½¼å¹´ä»£ç©ºé—´ä¸â¾œâ½¼å¹´ä»£ç©ºé—´ä¸â¾œçš„å¸¸â»…åœºæ™¯ä¸ºå‰â½‚æ‰€è®²çš„â¼¤å¯¹è±¡ç›´æ¥è¿›â¼Šâ½¼å¹´ä»£ã€â»“æœŸå­˜æ´»çš„å¯¹è±¡è¿›â¼Šâ½¼å¹´ä»£ç­‰ã€‚ä¸ºäº†é¿å…ä»¥ä¸ŠåŸå› å¼•èµ·çš„ Full GCï¼Œåº”å½“å°½é‡ä¸è¦åˆ›å»ºè¿‡â¼¤çš„å¯¹è±¡ä»¥åŠæ•°ç»„ã€‚é™¤æ­¤ä¹‹å¤–ï¼Œå¯ä»¥é€šè¿‡ -Xmn è™šæ‹Ÿæœºå‚æ•°è°ƒâ¼¤æ–°â½£ä»£çš„â¼¤â¼©ï¼Œè®©å¯¹è±¡å°½é‡åœ¨æ–°â½£ä»£è¢«å›æ”¶æ‰ï¼Œä¸è¿›â¼Šâ½¼å¹´ä»£ã€‚è¿˜å¯ä»¥é€šè¿‡ -XX:MaxTenuringThreshold è°ƒâ¼¤å¯¹è±¡è¿›â¼Šâ½¼å¹´ä»£çš„å¹´é¾„ï¼Œè®©å¯¹è±¡åœ¨æ–°â½£ä»£å¤šå­˜æ´»â¼€æ®µæ—¶é—´ã€‚ ç©ºé—´åˆ†é…æ‹…ä¿å¤±è´¥ä½¿â½¤å¤åˆ¶ç®—æ³•çš„ Minor GC éœ€è¦â½¼å¹´ä»£çš„å†…å­˜ç©ºé—´ä½œæ‹…ä¿ï¼Œå¦‚æœæ‹…ä¿å¤±è´¥ä¼šæ‰§â¾â¼€æ¬¡ FullGCã€‚å…·ä½“å†…å®¹è¯·å‚è€ƒä¸Šâ¾¯çš„ç¬¬ 5 â¼©èŠ‚ã€‚ JDK 1.7 åŠä»¥å‰çš„æ°¸ä¹…ä»£ç©ºé—´ä¸â¾œåœ¨ JDK 1.7 åŠä»¥å‰ï¼ŒHotSpot è™šæ‹Ÿæœºä¸­çš„â½…æ³•åŒºæ˜¯â½¤æ°¸ä¹…ä»£å®ç°çš„ï¼Œæ°¸ä¹…ä»£ä¸­å­˜æ”¾çš„ä¸ºâ¼€äº›Class çš„ä¿¡æ¯ã€å¸¸é‡ã€é™æ€å˜é‡ç­‰æ•°æ®ã€‚å½“ç³»ç»Ÿä¸­è¦åŠ è½½çš„ç±»ã€åå°„çš„ç±»å’Œè°ƒâ½¤çš„â½…æ³•è¾ƒå¤šæ—¶ï¼Œæ°¸ä¹…ä»£å¯èƒ½ä¼šè¢«å æ»¡ï¼Œåœ¨æœªé…ç½®ä¸ºé‡‡â½¤CMS GC çš„æƒ…å†µä¸‹ä¹Ÿä¼šæ‰§â¾ Full GCã€‚å¦‚æœç»è¿‡ Full GC ä»ç„¶å›æ”¶ä¸äº†ï¼Œé‚£ä¹ˆè™šæ‹Ÿæœºä¼šæŠ›å‡ºjava.lang.OutOfMemoryErrorã€‚ä¸ºé¿å…ä»¥ä¸ŠåŸå› å¼•èµ·çš„ Full GCï¼Œå¯é‡‡â½¤çš„â½…æ³•ä¸ºå¢â¼¤æ°¸ä¹…ä»£ç©ºé—´æˆ–è½¬ä¸ºä½¿â½¤ CMS GCã€‚ Concurrent Mode Failureæ‰§â¾ CMS GC çš„è¿‡ç¨‹ä¸­åŒæ—¶æœ‰å¯¹è±¡è¦æ”¾â¼Šâ½¼å¹´ä»£ï¼Œâ½½æ­¤æ—¶â½¼å¹´ä»£ç©ºé—´ä¸â¾œï¼ˆå¯èƒ½æ˜¯ GC è¿‡ç¨‹ä¸­æµ®åŠ¨åƒåœ¾è¿‡å¤šå¯¼è‡´æš‚æ—¶æ€§çš„ç©ºé—´ä¸â¾œï¼‰ï¼Œä¾¿ä¼šæŠ¥ Concurrent Mode Failure é”™è¯¯ï¼Œå¹¶è§¦å‘Full GCã€‚ ç±»åŠ è½½æœºåˆ¶ç±»æ˜¯åœ¨è¿â¾æœŸé—´ç¬¬â¼€æ¬¡ä½¿â½¤æ—¶åŠ¨æ€åŠ è½½çš„ï¼Œâ½½ä¸æ˜¯â¼€æ¬¡æ€§åŠ è½½æ‰€æœ‰ç±»ã€‚å› ä¸ºå¦‚æœâ¼€æ¬¡æ€§åŠ è½½ï¼Œä¼šå â½¤å¾ˆå¤šçš„å†…å­˜ã€‚ ç±»çš„ç”Ÿå‘½å‘¨æœŸ åŒ…æ‹¬ä»¥ä¸‹ 7 ä¸ªé˜¶æ®µï¼š åŠ è½½ï¼ˆLoadingï¼‰ éªŒè¯ï¼ˆVerificationï¼‰ å‡†å¤‡ï¼ˆPreparationï¼‰ è§£æï¼ˆResolutionï¼‰ åˆå§‹åŒ–ï¼ˆInitializationï¼‰ ä½¿â½¤ï¼ˆUsingï¼‰ å¸è½½ï¼ˆUnloadingï¼‰ ç±»çš„åŠ è½½è¿‡ç¨‹åŒ…å«äº†åŠ è½½ã€éªŒè¯ã€å‡†å¤‡ã€è§£æå’Œåˆå§‹åŒ–è¿™ 5 ä¸ªé˜¶æ®µã€‚ 1. åŠ è½½åŠ è½½æ˜¯ç±»åŠ è½½çš„â¼€ä¸ªé˜¶æ®µï¼Œæ³¨æ„ä¸è¦æ··æ·†ã€‚åŠ è½½è¿‡ç¨‹å®Œæˆä»¥ä¸‹ä¸‰ä»¶äº‹ï¼š é€šè¿‡ç±»çš„å®Œå…¨é™å®šåç§°è·å–å®šä¹‰è¯¥ç±»çš„â¼†è¿›åˆ¶å­—èŠ‚æµã€‚ å°†è¯¥å­—èŠ‚æµè¡¨ç¤ºçš„é™æ€å­˜å‚¨ç»“æ„è½¬æ¢ä¸ºâ½…æ³•åŒºçš„è¿â¾æ—¶å­˜å‚¨ç»“æ„ã€‚ åœ¨å†…å­˜ä¸­â½£æˆâ¼€ä¸ªä»£è¡¨è¯¥ç±»çš„ Class å¯¹è±¡ï¼Œä½œä¸ºâ½…æ³•åŒºä¸­è¯¥ç±»å„ç§æ•°æ®çš„è®¿é—®â¼Šâ¼ã€‚ å…¶ä¸­â¼†è¿›åˆ¶å­—èŠ‚æµå¯ä»¥ä»ä»¥ä¸‹â½…å¼ä¸­è·å–ï¼š ä» ZIP åŒ…è¯»å–ï¼Œæˆä¸º JARã€EARã€WAR æ ¼å¼çš„åŸºç¡€ã€‚ ä»â½¹ç»œä¸­è·å–ï¼Œæœ€å…¸å‹çš„åº”â½¤æ˜¯ Appletã€‚ è¿â¾æ—¶è®¡ç®—â½£æˆï¼Œä¾‹å¦‚åŠ¨æ€ä»£ç†æŠ€æœ¯ï¼Œåœ¨ java.lang.reflect.Proxy ä½¿â½¤ProxyGenerator.generateProxyClass çš„ä»£ç†ç±»çš„â¼†è¿›åˆ¶å­—èŠ‚æµã€‚ç”±å…¶ä»–â½‚ä»¶â½£æˆï¼Œä¾‹å¦‚ç”± JSP â½‚ä»¶â½£æˆå¯¹åº”çš„ Class ç±»ã€‚ 2. éªŒè¯ç¡®ä¿ Class â½‚ä»¶çš„å­—èŠ‚æµä¸­åŒ…å«çš„ä¿¡æ¯ç¬¦åˆå½“å‰è™šæ‹Ÿæœºçš„è¦æ±‚ï¼Œå¹¶ä¸”ä¸ä¼šå±å®³è™šæ‹Ÿæœºâ¾ƒèº«çš„å®‰å…¨ã€‚ 3. å‡†å¤‡ç±»å˜é‡æ˜¯è¢« static ä¿®é¥°çš„å˜é‡ï¼Œå‡†å¤‡é˜¶æ®µä¸ºç±»å˜é‡åˆ†é…å†…å­˜å¹¶è®¾ç½®åˆå§‹å€¼ï¼Œä½¿â½¤çš„æ˜¯â½…æ³•åŒºçš„å†…å­˜ã€‚åº”è¯¥æ³¨æ„åˆ°ï¼Œå®ä¾‹åŒ–ä¸æ˜¯ç±»åŠ è½½çš„â¼€ä¸ªè¿‡ç¨‹ï¼Œç±»åŠ è½½å‘â½£åœ¨æ‰€æœ‰å®ä¾‹åŒ–æ“ä½œä¹‹å‰ï¼Œå¹¶ä¸”ç±»åŠ è½½åªè¿›â¾â¼€æ¬¡ï¼Œå®ä¾‹åŒ–å¯ä»¥è¿›â¾å¤šæ¬¡ã€‚åˆå§‹å€¼â¼€èˆ¬ä¸º 0 å€¼ï¼Œä¾‹å¦‚ä¸‹â¾¯çš„ç±»å˜é‡ value è¢«åˆå§‹åŒ–ä¸º 0 â½½ä¸æ˜¯ 123ã€‚public static int value = 123;å¦‚æœç±»å˜é‡æ˜¯å¸¸é‡ï¼Œé‚£ä¹ˆå®ƒå°†åˆå§‹åŒ–ä¸ºè¡¨è¾¾å¼æ‰€å®šä¹‰çš„å€¼â½½ä¸æ˜¯ 0ã€‚ä¾‹å¦‚ä¸‹â¾¯çš„å¸¸é‡ value è¢«åˆå§‹åŒ–ä¸º 123 â½½ä¸æ˜¯ 0ã€‚public static final int value = 123; 4. è§£æå°†å¸¸é‡æ± çš„ç¬¦å·å¼•â½¤æ›¿æ¢ä¸ºç›´æ¥å¼•â½¤çš„è¿‡ç¨‹ã€‚å…¶ä¸­è§£æè¿‡ç¨‹åœ¨æŸäº›æƒ…å†µä¸‹å¯ä»¥åœ¨åˆå§‹åŒ–é˜¶æ®µä¹‹åå†å¼€å§‹ï¼Œè¿™æ˜¯ä¸ºäº†â½€æŒ Java çš„åŠ¨æ€ç»‘å®šã€‚ 5. åˆå§‹åŒ–åˆå§‹åŒ–é˜¶æ®µæ‰çœŸæ­£å¼€å§‹æ‰§â¾ç±»ä¸­å®šä¹‰çš„ Java ç¨‹åºä»£ç ã€‚ åˆå§‹åŒ–é˜¶æ®µæ˜¯è™šæ‹Ÿæœºæ‰§â¾ç±»æ„é€ å™¨clinit() â½…æ³•çš„è¿‡ç¨‹ã€‚åœ¨å‡†å¤‡é˜¶æ®µï¼Œç±»å˜é‡å·²ç»èµ‹è¿‡â¼€æ¬¡ç³»ç»Ÿè¦æ±‚çš„åˆå§‹å€¼ï¼Œâ½½åœ¨åˆå§‹åŒ–é˜¶æ®µï¼Œæ ¹æ®ç¨‹åºå‘˜é€šè¿‡ç¨‹åºåˆ¶å®šçš„ä¸»è§‚è®¡åˆ’å»åˆå§‹åŒ–ç±»å˜é‡å’Œå…¶å®ƒèµ„æºã€‚ clinit() æ˜¯ç”±ç¼–è¯‘å™¨â¾ƒåŠ¨æ”¶é›†ç±»ä¸­æ‰€æœ‰ç±»å˜é‡çš„èµ‹å€¼åŠ¨ä½œå’Œé™æ€è¯­å¥å—ä¸­çš„è¯­å¥åˆå¹¶äº§â½£çš„ï¼Œç¼–è¯‘å™¨æ”¶é›†çš„é¡ºåºç”±è¯­å¥åœ¨æºâ½‚ä»¶ä¸­å‡ºç°çš„é¡ºåºå†³å®šã€‚ç‰¹åˆ«æ³¨æ„çš„æ˜¯ï¼Œé™æ€è¯­å¥å—åªèƒ½è®¿é—®åˆ°å®šä¹‰åœ¨å®ƒä¹‹å‰çš„ç±»å˜é‡ï¼Œå®šä¹‰åœ¨å®ƒä¹‹åçš„ç±»å˜é‡åªèƒ½èµ‹å€¼ï¼Œä¸èƒ½è®¿é—®ã€‚ä¾‹å¦‚ä»¥ä¸‹ä»£ç ï¼š public class Test static i = 0; // ç»™å˜é‡èµ‹å€¼å¯ä»¥æ­£å¸¸ç¼–è¯‘é€šè¿‡System.out.print(i); // è¿™å¥ç¼–è¯‘å™¨ä¼šæç¤ºâ€œâ¾®æ³•å‘å‰å¼•â½¤â€static int i = 1; ç”±äºâ½—ç±»çš„ () â½…æ³•å…ˆæ‰§â¾ï¼Œä¹Ÿå°±æ„å‘³ç€â½—ç±»ä¸­å®šä¹‰çš„é™æ€è¯­å¥å—çš„æ‰§â¾è¦ä¼˜å…ˆäºâ¼¦ç±»ã€‚ä¾‹å¦‚ä»¥ä¸‹ä»£ç ï¼š static class Parent public static int A = 1;static A = 2;static class Sub extends Parent public static int B = A;public static void main(String[] args) System.out.println(Sub.B); // 2 é™æ€ä»£ç å—å’Œèµ‹å€¼åŠ¨ä½œæ˜¯æŒ‰ç…§ä»£ç çš„é¡ºåºæ‰§è¡Œçš„ã€‚æ¥â¼ä¸­ä¸å¯ä»¥ä½¿â½¤é™æ€è¯­å¥å—ï¼Œä½†ä»ç„¶æœ‰ç±»å˜é‡åˆå§‹åŒ–çš„èµ‹å€¼æ“ä½œï¼Œå› æ­¤æ¥â¼ä¸ç±»â¼€æ ·éƒ½ä¼šâ½£æˆ clinit() â½…æ³•ã€‚ ä½†æ¥â¼ä¸ç±»ä¸åŒçš„æ˜¯ï¼Œæ‰§â¾æ¥â¼çš„ clinit() â½…æ³•ä¸éœ€è¦å…ˆæ‰§â¾â½—æ¥â¼çš„ clinit() â½…æ³•ã€‚åªæœ‰å½“â½—æ¥â¼ä¸­å®šä¹‰çš„å˜é‡ä½¿â½¤æ—¶ï¼Œâ½—æ¥â¼æ‰ä¼šåˆå§‹åŒ–ã€‚å¦å¤–ï¼Œæ¥â¼çš„å®ç°ç±»åœ¨åˆå§‹åŒ–æ—¶ä¹Ÿâ¼€æ ·ä¸ä¼šæ‰§â¾æ¥â¼çš„ clinit() â½…æ³•ã€‚è™šæ‹Ÿæœºä¼šä¿è¯â¼€ä¸ªç±»çš„ clinit() â½…æ³•åœ¨å¤šçº¿ç¨‹ç¯å¢ƒä¸‹è¢«æ­£ç¡®çš„åŠ é”å’ŒåŒæ­¥ï¼Œå¦‚æœå¤šä¸ªçº¿ç¨‹åŒæ—¶åˆå§‹åŒ–â¼€ä¸ªç±»ï¼Œåªä¼šæœ‰â¼€ä¸ªçº¿ç¨‹æ‰§â¾è¿™ä¸ªç±»çš„ clinit() â½…æ³•ï¼Œå…¶å®ƒçº¿ç¨‹éƒ½ä¼šé˜»å¡ç­‰å¾…ï¼Œç›´åˆ°æ´»åŠ¨çº¿ç¨‹æ‰§â¾ clinit() â½…æ³•å®Œæ¯•ã€‚ å¦‚æœåœ¨â¼€ä¸ªç±»çš„clinit()â½…æ³•ä¸­æœ‰è€—æ—¶çš„æ“ä½œï¼Œå°±å¯èƒ½é€ æˆå¤šä¸ªçº¿ç¨‹é˜»å¡ï¼Œåœ¨å®é™…è¿‡ç¨‹ä¸­æ­¤ç§é˜»å¡å¾ˆéšè”½ã€‚ ç±»çš„åˆå§‹åŒ–æ—¶æœº1.ä¸»åŠ¨å¼•ç”¨è™šæ‹Ÿæœºè§„èŒƒä¸­å¹¶æ²¡æœ‰å¼ºåˆ¶çº¦æŸä½•æ—¶è¿›â¾åŠ è½½ï¼Œä½†æ˜¯è§„èŒƒä¸¥æ ¼è§„å®šäº†æœ‰ä¸”åªæœ‰ä¸‹åˆ—äº”ç§æƒ…å†µå¿…é¡»å¯¹ç±»è¿›â¾åˆå§‹åŒ–ï¼ˆåŠ è½½ã€éªŒè¯ã€å‡†å¤‡éƒ½ä¼šéšä¹‹å‘â½£ï¼‰: é‡åˆ° newã€getstaticã€putstatic æˆ– invokestatic è¿™ 4 æ¡å­—èŠ‚ç æŒ‡ä»¤æ—¶ï¼Œå¦‚æœç±»æ²¡æœ‰è¿›â¾è¿‡åˆå§‹åŒ–ï¼Œåˆ™éœ€è¦å…ˆè§¦å‘å…¶åˆå§‹åŒ–ã€‚ ä½¿â½¤ java.lang.reflect åŒ…çš„æ–¹æ³•å¯¹ç±»è¿›â¾åå°„è°ƒâ½¤çš„æ—¶å€™ï¼Œå¦‚æœç±»æ²¡æœ‰è¿›â¾è¿‡åˆå§‹åŒ–ï¼Œåˆ™éœ€è¦å…ˆè§¦å‘å…¶åˆå§‹åŒ–ã€‚ å½“åˆå§‹åŒ–â¼€ä¸ªç±»æ—¶ï¼Œå¦‚æœå‘ç°å…¶çˆ¶ç±»è¿˜æ²¡æœ‰è¿›â¾è¿‡åˆå§‹åŒ–ï¼Œåˆ™éœ€è¦å…ˆè§¦å‘å…¶çˆ¶ç±»çš„åˆå§‹åŒ–ã€‚ å½“è™šæ‹Ÿæœºå¯åŠ¨æ—¶ï¼Œâ½¤äºæ‰§â¾ä¸»ç±»ï¼ˆåŒ…å« main() â½…æ³•çš„é‚£ä¸ªç±»ï¼‰çš„åˆå§‹åŒ–ã€‚ ä½¿â½¤ JDK 7 æ–°åŠ å…¥çš„åŠ¨æ€è¯­è¨€â½€æŒæ—¶ï¼Œå¦‚æœâ¼€ä¸ª java.lang.invoke.MethodHandle å®ä¾‹æœ€åçš„è§£æç»“æœ REF_getStaticã€REF_putStaticã€REF_invokeStatic çš„â½…æ³•å¥æŸ„ï¼Œå¹¶ä¸”è¿™ä¸ªâ½…æ³•å¥æŸ„æ‰€å¯¹åº”çš„ç±»æ²¡æœ‰è¿›â¾è¿‡åˆå§‹åŒ–ï¼Œåˆ™éœ€è¦å…ˆå‡ºè§¦å‘å…¶åˆå§‹åŒ–ã€‚ 2.è¢«åŠ¨å¼•ç”¨ä»¥ä¸Š 5 ç§åœºæ™¯ä¸­çš„â¾ä¸ºç§°ä¸ºå¯¹â¼€ä¸ªç±»è¿›â¾ä¸»åŠ¨å¼•â½¤ã€‚é™¤æ­¤ä¹‹å¤–ï¼Œæ‰€æœ‰å¼•â½¤ç±»çš„â½…å¼éƒ½ä¸ä¼šè§¦å‘åˆå§‹åŒ–ï¼Œç§°ä¸ºè¢«åŠ¨å¼•â½¤ã€‚è¢«åŠ¨å¼•â½¤çš„å¸¸â»…ä¾‹â¼¦åŒ…æ‹¬ï¼šé€šè¿‡â¼¦ç±»å¼•â½¤â½—ç±»çš„é™æ€å­—æ®µï¼Œä¸ä¼šå¯¼è‡´â¼¦ç±»åˆå§‹åŒ–ã€‚ System.out.println(SubClass.value); // value å­—æ®µåœ¨ SuperClass ä¸­å®šä¹‰ é€šè¿‡æ•°ç»„å®šä¹‰æ¥å¼•â½¤ç±»ï¼Œä¸ä¼šè§¦å‘æ­¤ç±»çš„åˆå§‹åŒ–ã€‚è¯¥è¿‡ç¨‹ä¼šå¯¹æ•°ç»„ç±»è¿›â¾åˆå§‹åŒ–ï¼Œæ•°ç»„ç±»æ˜¯â¼€ä¸ªç”±è™šæ‹Ÿæœºâ¾ƒåŠ¨â½£æˆçš„ã€ç›´æ¥ç»§æ‰¿â¾ƒ Object çš„â¼¦ç±»ï¼Œå…¶ä¸­åŒ…å«äº†æ•°ç»„çš„å±æ€§å’Œâ½…æ³•ã€‚ SuperClass[] sca = new SuperClass[10]; å¸¸é‡åœ¨ç¼–è¯‘é˜¶æ®µä¼šå­˜â¼Šè°ƒâ½¤ç±»çš„å¸¸é‡æ± ä¸­ï¼Œæœ¬è´¨ä¸Šå¹¶æ²¡æœ‰ç›´æ¥å¼•â½¤åˆ°å®šä¹‰å¸¸é‡çš„ç±»ï¼Œå› æ­¤ä¸ä¼šè§¦å‘å®šä¹‰å¸¸é‡çš„ç±»çš„åˆå§‹åŒ–ã€‚ System.out.println(ConstClass.HELLOWORLD); ç±»åŠ è½½å™¨åˆ†ç±»ä» Java è™šæ‹Ÿæœºçš„â»†åº¦æ¥è®²ï¼Œåªå­˜åœ¨ä»¥ä¸‹ä¸¤ç§ä¸åŒçš„ç±»åŠ è½½å™¨ï¼š å¯åŠ¨ç±»åŠ è½½å™¨ï¼ˆBootstrap ClassLoaderï¼‰ï¼Œä½¿â½¤ C++ å®ç°ï¼Œæ˜¯è™šæ‹Ÿæœºâ¾ƒèº«çš„â¼€éƒ¨åˆ†ï¼› æ‰€æœ‰å…¶å®ƒç±»çš„åŠ è½½å™¨ï¼Œä½¿â½¤ Java å®ç°ï¼Œç‹¬â½´äºè™šæ‹Ÿæœºï¼Œç»§æ‰¿â¾ƒæŠ½è±¡ç±»java.lang.ClassLoaderã€‚ ä» Java å¼€å‘â¼¯ç¨‹çš„â»†åº¦æ¥çœ‹ï¼Œç±»åŠ è½½å™¨å¯ä»¥åˆ’åˆ†å¾—æ›´ç»†è‡´ä¸€äº›ï¼š å¯åŠ¨ç±»åŠ è½½å™¨ï¼ˆBootstrap ClassLoaderï¼‰ï¼šè¿™ä¸ªç±»åŠ è½½å™¨è´Ÿè´£å°†å­˜æ”¾åœ¨ JAVA_HOME\\lib ç›®å½•ä¸­çš„ï¼Œæˆ–è€…è¢« -Xbootclasspath å‚æ•°æ‰€æŒ‡å®šçš„è·¯å¾„ä¸­çš„ï¼Œå¹¶ä¸”æ˜¯è™šæ‹Ÿæœºè¯†åˆ«çš„ï¼ˆä»…æŒ‰ç…§æ–‡ä»¶åè¯†åˆ«ï¼Œå¦‚ rt.jarï¼Œåå­—ä¸ç¬¦åˆçš„ç±»åº“å³ä½¿æ”¾åœ¨ lib ç›®å½•ä¸­ä¹Ÿä¸ä¼šè¢«åŠ è½½ï¼‰ç±»åº“åŠ è½½åˆ°è™šæ‹Ÿæœºå†…å­˜ä¸­ã€‚å¯åŠ¨ç±»åŠ è½½å™¨æ— æ³•è¢« Java ç¨‹åºç›´æ¥å¼•â½¤ï¼Œç”¨æˆ·åœ¨ç¼–å†™è‡ªå®šä¹‰ç±»åŠ è½½å™¨æ—¶ï¼Œå¦‚æœéœ€è¦æŠŠåŠ è½½è¯·æ±‚å§”æ´¾ç»™å¯åŠ¨ç±»åŠ è½½å™¨å»å¤„ç†ï¼Œé‚£ä¹ˆç›´æ¥â½¤ null ä»£æ›¿å³å¯ã€‚ æ‰©å±•ç±»åŠ è½½å™¨ï¼ˆExtension ClassLoaderï¼‰ï¼šè¿™ä¸ªç±»åŠ è½½å™¨æ˜¯åœ¨ç±» java.lang.ClassLoader çš„æ„é€ å‡½æ•°ä¸­è¢«è°ƒâ½¤çš„ã€‚å®ƒè´Ÿè´£å°† libext æˆ–è€…è¢« java.ext.dir ç³»ç»Ÿå˜é‡æ‰€æŒ‡å®šè·¯å¾„ä¸­çš„æ‰€æœ‰ç±»åº“åŠ è½½åˆ°å†…å­˜ä¸­ï¼Œå¼€å‘è€…å¯ä»¥ç›´æ¥ä½¿â½¤æ‰©å±•ç±»åŠ è½½å™¨ã€‚ åº”ç”¨ç¨‹åºç±»åŠ è½½å™¨ï¼ˆApplication ClassLoaderï¼‰ï¼šè¿™ä¸ªç±»åŠ è½½å™¨æ˜¯åœ¨ç±» java.lang.ClassLoader çš„æ„é€ å‡½æ•°ä¸­è¢«è°ƒâ½¤çš„ã€‚ç”±äºè¿™ä¸ªç±»åŠ è½½å™¨æ˜¯ ClassLoader ä¸­çš„ getSystemClassLoader() æ–¹æ³•çš„è¿”å›å€¼ï¼Œæ‰€ä»¥ä¹Ÿè¢«ç§°ä¸ºç³»ç»Ÿç±»åŠ è½½å™¨ã€‚å®ƒè´Ÿè´£å°†â½¤æˆ·ç±»è·¯å¾„ï¼ˆClassPathï¼‰ä¸Šæ‰€æŒ‡å®šçš„ç±»åº“åŠ è½½åˆ°å†…å­˜ä¸­ã€‚å¼€å‘è€…å¯ä»¥ç›´æ¥ä½¿â½¤è¿™ä¸ªç±»åŠ è½½å™¨ï¼Œå¦‚æœåº”â½¤ç¨‹åºä¸­æ²¡æœ‰å®šä¹‰è¿‡â¾ƒå®šä¹‰çš„ç±»åŠ è½½å™¨ï¼Œä¸€èˆ¬æƒ…å†µä¸‹è¿™ä¸ªå°±æ˜¯ç¨‹åºä¸­é»˜è®¤çš„ç±»åŠ è½½å™¨ã€‚ â¼¯ä½œè¿‡ç¨‹â¼€ä¸ªç±»åŠ è½½å™¨â¾¸å…ˆå°†ç±»åŠ è½½è¯·æ±‚è½¬å‘åˆ°â½—ç±»åŠ è½½å™¨ï¼Œåªæœ‰å½“â½—ç±»åŠ è½½å™¨â½†æ³•å®Œæˆæ—¶æ‰å°è¯•â¾ƒâ¼°åŠ è½½ã€‚ å¥½å¤„ä½¿å¾— Java ç±»éšç€å®ƒçš„ç±»åŠ è½½å™¨â¼€èµ·å…·æœ‰â¼€ç§å¸¦æœ‰ä¼˜å…ˆçº§çš„å±‚æ¬¡å…³ç³»ï¼Œä»â½½ä½¿å¾—åŸºç¡€ç±»å¾—åˆ°ç»Ÿâ¼€ã€‚ä¾‹å¦‚ java.lang.Object å­˜æ”¾åœ¨ rt.jar ä¸­ï¼Œå¦‚æœç¼–å†™å¦å¤–â¼€ä¸ª java.lang.Object å¹¶æ”¾åˆ° ClassPathä¸­ï¼Œç¨‹åºå¯ä»¥ç¼–è¯‘é€šè¿‡ã€‚ç”±äºåŒäº²å§”æ´¾æ¨¡å‹çš„å­˜åœ¨ï¼Œæ‰€ä»¥åœ¨ rt.jar ä¸­çš„ Object â½åœ¨ ClassPath ä¸­çš„ Object ä¼˜å…ˆçº§æ›´â¾¼ï¼Œè¿™æ˜¯å› ä¸º rt.jar ä¸­çš„ Object ä½¿â½¤çš„æ˜¯å¯åŠ¨ç±»åŠ è½½å™¨ï¼Œâ½½ ClassPath ä¸­çš„ Object ä½¿â½¤çš„æ˜¯åº”â½¤ç¨‹åºç±»åŠ è½½å™¨ã€‚rt.jar ä¸­çš„ Object ä¼˜å…ˆçº§æ›´â¾¼ï¼Œé‚£ä¹ˆç¨‹åºä¸­æ‰€æœ‰çš„ Object éƒ½æ˜¯è¿™ä¸ªObjectã€‚","tags":["åŸºç¡€","JVM"],"categories":["åŸºç¡€ç¬”è®°"]},{"title":"2025.6.9å­¦ä¹ æ—¥è®°","path":"/2025/06/09/å­¦ä¹ æ—¥è®°25å¹´6æœˆ/2025.6.9å­¦ä¹ ç¬”è®°/","content":"å­¦ä¹ å†…å®¹1. åŠ›æ‰£æ¯æ—¥ä¸€é¢˜ ï¼‹ æ˜¨å¤©çš„æ¯æ—¥ä¸€é¢˜æ˜¨å¤©åˆå¿˜æ‰“å¡åŠ›æ‰£äº†,è¿˜æ¬ äº†13å¤©çš„,å¾—äº”ä¸ªæœˆä¹‹åæ‰èƒ½å…¨ç»­ä¸Šäº†.ä»Šå¤©çš„æ¯æ—¥æ˜¯å­—å…¸åºç¬¬Kæ•°å­—.æ˜¨å¤©çš„ä¹Ÿæ˜¯å­—å…¸åºç›¸å…³.åšäº†ä¸¤é“å­—å…¸åºæ„Ÿè§‰ç†è§£äº†. 2. å­¦ä¹ JVMç›¸å…³åŸºç¡€å­¦ä¹ äº†JVMç›¸å…³,å¹¶ä¸”è®°äº†ä¸€ç¯‡ç¬”è®°. 3. æŠŠKMPç®—æ³•å®è·µä¸€ä¸‹æ‰‹ç”»æ¢³ç†äº†ä¸€ä¸‹æµç¨‹,ç„¶åæ„é€ äº†ä¸¤éä¹‹åæ„Ÿè§‰ç†è§£å¾ˆå¤šäº†.ä¸ªäººç†è§£KMPçš„æ ¸å¿ƒæ€æƒ³å°±æ˜¯è®©ä¸»ä¸²ç´¢å¼•ä¸åé€€,åŒ¹é…ä¸²ç´¢å¼•é€šè¿‡nextæ•°ç»„å¿«é€Ÿæ‰¾åˆ°å‰ç¼€ç›¸åŒçš„ä¸‹æ ‡ä½ç½®ç»§ç»­åŒ¹é….æ ¸å¿ƒå°±æ˜¯nextæ•°ç»„çš„æ„é€ .è¿™ä¸ªç®—æ³•ç†è§£åå®ç°ä¹Ÿæ¯”è¾ƒå¤æ‚,æœ‰ä¸€å †çš„è¾¹ç•Œæ¡ä»¶,ä¸€ä¸ªæ¯”è¾ƒå¥½çš„æ€è·¯æ˜¯åœ¨ä¸»ä¸²å’ŒåŒ¹é…ä¸²å‰é¢åŠ ä¸€ä¸ªç©ºæ ¼ä½œä¸ºå“¨å…µ,ç„¶åè¾¹ç•Œé—®é¢˜ä¼šå°‘å¾ˆå¤š,åªéœ€è¦æ¯”è¾ƒj+1å’Œä¸»ä¸²iä½ç½®å³å¯. 4. å­¦ä¹ é¡¹ç›®æ–‡æ¡£ç”Ÿæ´»è®°å½•1. è¶³çƒè®­ç»ƒä»Šå¤©ä¸ƒç‚¹èµ·åºŠ,ä¸‹æ¥¼ç»ƒçƒ,ç»ƒé¢ çƒå’Œé€†è¶³.10","tags":["åŸºç¡€","æ—¥è®°","leetcode","é¡¹ç›®"],"categories":["å­¦ä¹ æ—¥è®°","2025-06"]},{"title":"Javaå¹¶å‘ç¯‡","path":"/2025/06/07/åŸºç¡€ç¬”è®°/Javaå¹¶å‘ç¯‡/","content":"ä½¿ç”¨çº¿ç¨‹ä¸‰ç§æ–¹æ³• ç»§æ‰¿Threadç±»éœ€è¦é‡å†™runæ–¹æ³•ï¼Œç„¶åè°ƒç”¨startæ–¹æ³•å¯åŠ¨çº¿ç¨‹ã€‚ å®ç°Runnableæ¥å£éœ€è¦é‡å†™runæ–¹æ³•ï¼Œç„¶åè°ƒç”¨startæ–¹æ³•å¯åŠ¨çº¿ç¨‹ã€‚ å®ç°Callableæ¥å£éœ€è¦é‡å†™callæ–¹æ³•ï¼Œç„¶åè°ƒç”¨startæ–¹æ³•å¯åŠ¨çº¿ç¨‹ã€‚æœ‰è¿”å›å€¼ï¼Œé€šè¿‡ FutureTask è¿›â¾å°è£…ã€‚ å®ç°æ¥å£è¿˜æ˜¯ç»§æ‰¿ç±»ï¼Ÿå®ç°æ¥å£æ›´å¥½ä¸€äº›ï¼Œjavaä¸æ”¯æŒå¤šç»§æ‰¿ï¼Œä½†å¯ä»¥å®ç°å¤šä¸ªæ¥å£ã€‚ åŸºç¡€çº¿ç¨‹æœºåˆ¶ExecutorExecutorç”¨æ¥ç®¡ç†å¤šä¸ªå¼‚æ­¥æ“ä½œï¼ˆå¤šä¸ªä»»åŠ¡äº’ä¸å¹²æ‰°ï¼Œä¸éœ€è¦åŒæ­¥æ“ä½œï¼‰ã€‚ ä¸»è¦æœ‰ä¸‰ç§Executorï¼šCachedThreadPoolï¼šâ¼€ä¸ªä»»åŠ¡åˆ›å»ºâ¼€ä¸ªçº¿ç¨‹ï¼›FixedThreadPoolï¼šæ‰€æœ‰ä»»åŠ¡åªèƒ½ä½¿â½¤å›ºå®šâ¼¤â¼©çš„çº¿ç¨‹ï¼›SingleThreadExecutorï¼šç›¸å½“äºâ¼¤â¼©ä¸º 1 çš„ FixedThreadPoolã€‚ DaemonDaemonå®ˆæŠ¤çº¿ç¨‹æ˜¯â¼€ä¸ªæœåŠ¡çº¿ç¨‹ï¼Œâ½¤äºä¸ºå…¶ä»–çº¿ç¨‹æä¾›æœåŠ¡ã€‚æ‰€æœ‰éå®ˆæŠ¤çº¿ç¨‹éƒ½æ‰§â¾å®Œæ¯•åï¼Œæ— è®ºæœ‰æ²¡æœ‰å®ˆæŠ¤çº¿ç¨‹ï¼Œç¨‹åºéƒ½ä¼šé€€å‡ºã€‚çº¿ç¨‹å¯åŠ¨å‰å¯ä»¥é€šè¿‡setDaemon() æ–¹æ³•æ¥è®¾ç½®è¯¥çº¿ç¨‹æ˜¯å¦ä¸ºå®ˆæŠ¤çº¿ç¨‹ã€‚ sleep()Thread.sleep() ä½¿å½“å‰çº¿ç¨‹æš‚åœæ‰§â¾æŒ‡å®šçš„æ—¶é—´ï¼Œæš‚åœæœŸé—´ï¼Œå…¶ä»–çº¿ç¨‹å¯ä»¥ç»§ç»­è¿â¾ï¼Œä¸ä¼šå—åˆ°é˜»å¡ã€‚sleep()å¯èƒ½ä¼šæŠ›å‡ºInterruptedExceptionå¼‚å¸¸ï¼Œå¼‚å¸¸ä¸ä¼šä¼ å›main()ï¼Œæ‰€ä»¥å¿…é¡»åœ¨Threadç±»ä¸­æ•è·å¹¶å¤„ç†ã€‚ yield()ä»£è¡¨çº¿ç¨‹å·²ç»èµ°å®Œäº†é‡è¦çš„éƒ¨åˆ†ï¼Œå¯ä»¥è®©å…¶ä»–çº¿ç¨‹æœ‰æœºä¼šæ‰§è¡Œã€‚ ä¸­æ–­çº¿ç¨‹å®Œæˆä¼šè‡ªåŠ¨å…³é—­ï¼Œä½†æ˜¯å¦‚æœçº¿ç¨‹å¼‚å¸¸ä¹Ÿä¼šæå‰å…³é—­ã€‚ InterruptedException å¼‚å¸¸çº¿ç¨‹åœ¨ sleep() æˆ– wait() æ—¶è¢«ä¸­æ–­ï¼Œä¼šæŠ›å‡º InterruptedException å¼‚å¸¸ã€‚ interrupted()å¦‚æœä¸€ä¸ªçº¿ç¨‹å¤„äºæ— é™å¾ªç¯ä¸­ï¼Œå¹¶ä¸”æ²¡æœ‰æ‰§è¡Œ sleep() æˆ– wait()ï¼Œé‚£ä¹ˆå¯ä»¥é€šè¿‡ interrupted() æ¥åˆ¤æ–­çº¿ç¨‹æ˜¯å¦è¢«ä¸­æ–­ã€‚å¦‚æœçº¿ç¨‹è¢«ä¸­æ–­ï¼Œinterrupted() ä¼šè¿”å› trueã€‚å¦‚æœçº¿ç¨‹æ²¡æœ‰è¢«ä¸­æ–­ï¼Œinterrupted() ä¼šè¿”å› falseã€‚ Executorçš„ä¸­æ–­æ“ä½œè°ƒç”¨shutdown()æ–¹æ³•ä¼šç­‰å¾…æ‰€æœ‰ä»»åŠ¡æ‰§è¡Œå®Œæ¯•åå…³é—­Executorã€‚è°ƒç”¨shutdownNow()æ–¹æ³•ä¼šä¸­æ–­æ‰€æœ‰ä»»åŠ¡ï¼Œç›¸å½“äºè°ƒç”¨æ¯ä¸ªä»»åŠ¡çš„interrupt()æ–¹æ³•ï¼Œç„¶åå…³é—­Executorã€‚ å¦‚æœåªæƒ³ä¸­æ–­æŸä¸€ä¸ªçº¿ç¨‹ï¼Œå¯ä»¥é€šè¿‡submit() æ–¹æ³•æäº¤ä¸€ä¸ªCallableä»»åŠ¡ï¼Œç„¶åè°ƒç”¨Futureçš„cancel()æ–¹æ³•æ¥ä¸­æ–­ä»»åŠ¡ã€‚ äº’æ–¥åŒæ­¥Java æä¾›äº†ä¸¤ç§é”æœºåˆ¶æ¥æ§åˆ¶å¤šä¸ªçº¿ç¨‹å¯¹å…±äº«èµ„æºçš„äº’æ–¥è®¿é—®ï¼Œç¬¬â¼€ä¸ªæ˜¯ JVM å®ç°çš„synchronizedï¼Œå¦â¼€ä¸ªæ˜¯ JDK å®ç°çš„ ReentrantLockã€‚ synchronizedsynchronized æ˜¯ Java ä¸­çš„å…³é”®å­—ï¼Œå®ƒå¯ä»¥ä¿®é¥°æ–¹æ³•å’Œä»£ç å—ã€‚ä¿®é¥°æ–¹æ³•æ—¶ï¼Œé”çš„æ˜¯å½“å‰å¯¹è±¡ã€‚ä¿®é¥°ä»£ç å—æ—¶ï¼Œé”çš„æ˜¯æ‹¬å·ä¸­çš„å¯¹è±¡ã€‚ ReentrantLockReentrantLock æ˜¯ java.util.concurrentï¼ˆJ.U.Cï¼‰åŒ…ä¸­çš„é”ã€‚ æ¯”è¾ƒsynchronizedå’ŒReentrantLock é”çš„å®ç°synchronized æ˜¯ JVM å®ç°çš„ï¼Œâ½½ ReentrantLock æ˜¯ JDK å®ç°çš„ã€‚ æ€§èƒ½æ–°ç‰ˆæœ¬ Java å¯¹ synchronized è¿›â¾äº†å¾ˆå¤šä¼˜åŒ–ï¼Œä¾‹å¦‚â¾ƒæ—‹é”ï¼Œsynchronized ä¸ReentrantLock çš„æ€§èƒ½â¼¤è‡´ç›¸åŒã€‚ ç­‰å¾…å¯ä¸­æ–­å½“æŒæœ‰é”çš„çº¿ç¨‹â»“æœŸä¸é‡Šæ”¾é”çš„æ—¶å€™ï¼Œæ­£åœ¨ç­‰å¾…çš„çº¿ç¨‹å¯ä»¥é€‰æ‹©æ”¾å¼ƒç­‰å¾…ï¼Œæ”¹ä¸ºå¤„ç†å…¶ä»–äº‹æƒ…ã€‚ReentrantLock å¯ä¸­æ–­ï¼Œâ½½ synchronized ä¸â¾ã€‚ å…¬å¹³é”å…¬å¹³é”æ˜¯æŒ‡å¤šä¸ªçº¿ç¨‹åœ¨ç­‰å¾…åŒâ¼€ä¸ªé”æ—¶ï¼Œå¿…é¡»æŒ‰ç…§ç”³è¯·é”çš„æ—¶é—´é¡ºåºæ¥ä¾æ¬¡è·å¾—é”ã€‚synchronized ä¸­çš„é”æ˜¯â¾®å…¬å¹³çš„ï¼ŒReentrantLock é»˜è®¤æƒ…å†µä¸‹ä¹Ÿæ˜¯â¾®å…¬å¹³çš„ï¼Œä½†æ˜¯ä¹Ÿå¯ä»¥æ˜¯å…¬å¹³çš„ã€‚ é”ç»‘å®šå¤šä¸ªæ¡ä»¶â¼€ä¸ª ReentrantLock å¯ä»¥åŒæ—¶ç»‘å®šå¤šä¸ª Condition å¯¹è±¡ã€‚ ä½¿ç”¨é€‰æ‹©é™¤ééœ€è¦ä½¿ç”¨ ReentrantLock çš„é«˜çº§åŠŸèƒ½ï¼Œå¦åˆ™ä¼˜å…ˆä½¿ç”¨ synchronizedã€‚å› ä¸ºsynchronized æ˜¯ JVM å®ç°çš„ï¼Œå¯ä»¥ä¿è¯â¾ƒâ¼°çš„çº¿ç¨‹å®‰å…¨ï¼Œâ½½ ReentrantLock éœ€è¦ç¨‹åºå‘˜æ‰‹åŠ¨é‡Šæ”¾é”ï¼Œ çº¿ç¨‹ä¹‹é—´çš„åä½œjoin()åœ¨ä¸€ä¸ªçº¿ç¨‹ä¸­è°ƒç”¨å¦ä¸€ä¸ªçº¿ç¨‹çš„ join() æ–¹æ³•ï¼Œä¼šå°†å½“å‰çº¿ç¨‹æŒ‚èµ·ï¼Œç›´åˆ°è¢«è°ƒç”¨çš„çº¿ç¨‹æ‰§è¡Œå®Œæ¯•ã€‚ wait() notify() notifyAll()wait() ä½¿å½“å‰çº¿ç¨‹ç­‰å¾…ï¼Œç›´åˆ°å…¶ä»–çº¿ç¨‹è°ƒâ½¤ notify() æˆ– notifyAll() æ–¹æ³•ã€‚notify() éšæœºå”¤é†’â¼€ä¸ªç­‰å¾…çº¿ç¨‹ï¼ŒnotifyAll() å”¤é†’æ‰€æœ‰ç­‰å¾…çº¿ç¨‹ã€‚wait()å¿…é¡»åœ¨ synchronized å—ä¸­è°ƒâ½¤,å¦åˆ™ä¼šæŠ›å‡ºIllegalMonitorStateExceptionå¼‚å¸¸ã€‚ wait()å’Œsleep()çš„åŒºåˆ« wait() æ˜¯ Object çš„â½…æ³•ï¼Œsleep() æ˜¯ Thread çš„â½…æ³•ã€‚ wait() ä¼šé‡Šæ”¾é”ï¼Œsleep() ä¸ä¼šé‡Šæ”¾é”ã€‚ wait() å¯ä»¥è¢« notify() æˆ– notifyAll() å”¤é†’ï¼Œsleep() åªèƒ½è¢«ä¸­æ–­ã€‚ wait() å¿…é¡»åœ¨ synchronized å—ä¸­è°ƒâ½¤ï¼Œsleep() å¯ä»¥åœ¨ä»»ä½•ä½ç½®è°ƒâ½¤ã€‚ await() signal() signalAll()java.util.concurrent æä¾›çš„ Condition ç±»ï¼Œå¯ä»¥å†Condition ä¸Šè°ƒâ½¤ await() ä½¿çº¿ç¨‹ç­‰å¾…. ç›¸æ¯”wait()ï¼Œawait() å¯ä»¥æŒ‡å®šæ—¶é—´ï¼Œè¶…è¿‡æ—¶é—´ä¼šâ¾ƒåŠ¨å”¤é†’ã€‚ çº¿ç¨‹çŠ¶æ€ä¸€ä¸ªçº¿ç¨‹é€šå¸¸åªæœ‰ä¸€ç§çŠ¶æ€,å¹¶ä¸”è¿™é‡Œç‰¹æŒ‡jvmçº¿ç¨‹çŠ¶æ€,è€Œä¸æ˜¯æ“ä½œç³»ç»Ÿçº¿ç¨‹çŠ¶æ€.çº¿ç¨‹çŠ¶æ€æœ‰6ç§: æ–°å»º(New)åˆ›å»ºåå°šæœªå¯ç”¨. å¯è¿è¡Œ(Runnable)æ­£åœ¨Javaè™šæ‹Ÿæœºä¸­æ‰§è¡Œ,ä½†æ˜¯å®ƒå¯èƒ½æ­£åœ¨ç­‰å¾…æ“ä½œç³»ç»Ÿåˆ†é…å¤„ç†å™¨èµ„æº. é˜»å¡(Blocked)çº¿ç¨‹è¢«é˜»å¡,ç­‰å¾…å…¶ä»–çº¿ç¨‹å®Œæˆæ“ä½œ. ç­‰å¾…(Waiting)çº¿ç¨‹ç­‰å¾…å…¶ä»–çº¿ç¨‹æ‰§è¡Œç‰¹å®šæ“ä½œ. è®¡æ—¶ç­‰å¾…(Timed Waiting)çº¿ç¨‹ç­‰å¾…æŒ‡å®šçš„æ—¶é—´. ç»ˆæ­¢(Terminated)çº¿ç¨‹å·²ç»å®Œæˆæ‰§è¡Œ. çŠ¶æ€è½¬æ¢ J.U.C - AQSjava.util.concurrent ï¼ˆJ.U.Cï¼‰â¼¤â¼¤æâ¾¼äº†å¹¶å‘æ€§èƒ½ï¼ŒAQS è¢«è®¤ä¸ºæ˜¯ J.U.C çš„æ ¸â¼¼ã€‚AQSæ˜¯AbstractQueuedSynchronizerçš„ç¼©å†™,æ˜¯Javaå¹¶å‘åŒ…ä¸­ç”¨æ¥å®ç°é”çš„åŸºç¡€æ¡†æ¶. CountDownLatchCountDownLatchç”¨æ¥æ§åˆ¶ä¸€ä¸ªæˆ–å¤šä¸ªçº¿ç¨‹ç­‰å¾…å…¶ä»–çº¿ç¨‹å®Œæˆæ“ä½œ. CyclicBarrierç”¨æ¥æ§åˆ¶å¤šä¸ªçº¿ç¨‹äº’ç›¸ç­‰å¾…ï¼Œç›´åˆ°åˆ°è¾¾æŸä¸ªå…¬å…±å±éšœç‚¹ï¼ˆcommon barrier pointï¼‰ã€‚å’ŒCountDownLatchä¸åŒçš„æ˜¯ï¼ŒCyclicBarrierçš„è®¡æ•°å™¨å¯ä»¥è¢«é‡ç½®åä½¿ç”¨ï¼Œæ‰€ä»¥å®ƒè¢«ç§°ä¸ºå¾ªç¯å±éšœã€‚ SemaphoreSemaphore ç±»ä¼¼äºæ“ä½œç³»ç»Ÿä¸­çš„ä¿¡å·é‡ï¼Œå¯ä»¥æ§åˆ¶å¯¹äº’æ–¥èµ„æºçš„è®¿é—®çº¿ç¨‹æ•°ã€‚ J.U.C - å…¶å®ƒç»„ä»¶FutureTaskå®ç°äº†Futureæ¥å£å’ŒRunnableæ¥å£,å¯ä»¥ä½œä¸ºRunnableè¢«çº¿ç¨‹æ‰§è¡Œ,ä¹Ÿå¯ä»¥ç”¨æ¥è·å–å¼‚æ­¥æ‰§è¡Œçš„ç»“æœ.é€‚ç”¨äºéœ€è¦å¼‚æ­¥æ‰§è¡Œä»»åŠ¡,å¹¶ä¸”éœ€è¦è·å–ç»“æœçš„åœºæ™¯. BlockingQueueé˜»å¡é˜Ÿåˆ—,å¯ä»¥ç”¨æ¥å®ç°ç”Ÿäº§è€…-æ¶ˆè´¹è€…æ¨¡å¼. java.util.concurrent.BlockingQueue æ¥â¼æœ‰ä»¥ä¸‹é˜»å¡é˜Ÿåˆ—çš„å®ç°ï¼šFIFO é˜Ÿåˆ— ï¼šLinkedBlockingQueueã€ArrayBlockingQueueï¼ˆå›ºå®šâ»“åº¦ï¼‰ä¼˜å…ˆçº§é˜Ÿåˆ— ï¼šPriorityBlockingQueue ForkJoinå’ŒMapReduceç±»ä¼¼,å¯ä»¥å°†â¼¤é‡çš„æ•°æ®æ‹†åˆ†æˆâ¼©é‡çš„æ•°æ®ï¼Œç„¶ååˆ†â½´è®¡ç®—ï¼Œæœ€åå°†ç»“æœåˆå¹¶ã€‚ Java å†…å­˜æ¨¡å‹Java å†…å­˜æ¨¡å‹è¯•å›¾å±è”½å„ç§ç¡¬ä»¶å’Œæ“ä½œç³»ç»Ÿçš„å†…å­˜è®¿é—®å·®å¼‚ï¼Œä»¥å®ç°è®© Java ç¨‹åºåœ¨å„ç§å¹³å°ä¸‹éƒ½èƒ½è¾¾åˆ°â¼€è‡´çš„å†…å­˜è®¿é—®æ•ˆæœã€‚ ä¸»å†…å­˜å’Œå·¥ä½œå†…å­˜ä¸»å†…å­˜æ˜¯æ‰€æœ‰çº¿ç¨‹å…±äº«çš„å†…å­˜åŒºåŸŸï¼Œå·¥ä½œå†…å­˜æ˜¯æ¯ä¸ªçº¿ç¨‹ç‹¬æœ‰çš„å†…å­˜åŒºåŸŸã€‚ æ‰€æœ‰çš„å˜é‡éƒ½å­˜å‚¨åœ¨ä¸»å†…å­˜ä¸­ï¼Œæ¯ä¸ªçº¿ç¨‹è¿˜æœ‰â¾ƒâ¼°çš„â¼¯ä½œå†…å­˜ï¼Œâ¼¯ä½œå†…å­˜å­˜å‚¨åœ¨â¾¼é€Ÿç¼“å­˜æˆ–è€…å¯„å­˜å™¨ä¸­ï¼Œä¿å­˜äº†è¯¥çº¿ç¨‹ä½¿â½¤çš„å˜é‡çš„ä¸»å†…å­˜å‰¯æœ¬æ‹·â»‰ã€‚çº¿ç¨‹åªèƒ½ç›´æ¥è¯»å†™â¾ƒâ¼°çš„â¼¯ä½œå†…å­˜ä¸­çš„å˜é‡ï¼Œä¸åŒçº¿ç¨‹ä¹‹é—´çš„å˜é‡å€¼ä¼ é€’éœ€è¦é€šè¿‡ä¸»å†…å­˜æ¥å®Œæˆã€‚ å†…å­˜é—´çš„äº¤äº’æ“ä½œ javaå†…å­˜æ¨¡å‹è§„å®šäº†8ç§æ“ä½œæ¥å®Œæˆä¸»å†…å­˜å’Œå·¥ä½œå†…å­˜ä¹‹é—´çš„äº¤äº’æ“ä½œï¼šreadï¼šæŠŠâ¼€ä¸ªå˜é‡çš„å€¼ä»ä¸»å†…å­˜ä¼ è¾“åˆ°â¼¯ä½œå†…å­˜ä¸­loadï¼šåœ¨ read ä¹‹åæ‰§â¾ï¼ŒæŠŠ read å¾—åˆ°çš„å€¼æ”¾â¼Šâ¼¯ä½œå†…å­˜çš„å˜é‡å‰¯æœ¬ä¸­useï¼šæŠŠâ¼¯ä½œå†…å­˜ä¸­â¼€ä¸ªå˜é‡çš„å€¼ä¼ é€’ç»™æ‰§â¾å¼•æ“assignï¼šæŠŠâ¼€ä¸ªä»æ‰§â¾å¼•æ“æ¥æ”¶åˆ°çš„å€¼èµ‹ç»™â¼¯ä½œå†…å­˜çš„å˜é‡storeï¼šæŠŠâ¼¯ä½œå†…å­˜çš„â¼€ä¸ªå˜é‡çš„å€¼ä¼ é€åˆ°ä¸»å†…å­˜ä¸­writeï¼šåœ¨ store ä¹‹åæ‰§â¾ï¼ŒæŠŠ store å¾—åˆ°çš„å€¼æ”¾â¼Šä¸»å†…å­˜çš„å˜é‡ä¸­lockï¼šä½œâ½¤äºä¸»å†…å­˜çš„å˜é‡unlock:ä½œâ½¤äºä¸»å†…å­˜çš„å˜é‡ å†…å­˜æ¨¡å‹çš„ä¸‰å¤§ç‰¹æ€§åŸå­æ€§javaå†…å­˜æ¨¡å‹ä¿è¯äº†readã€loadã€useã€assignã€storeã€writeè¿™6ä¸ªæ“ä½œæ˜¯å…·æœ‰åŸå­æ€§çš„ã€‚ä½†æ˜¯ä¸ä¿è¯è¿™6ä¸ªæ“ä½œçš„ç»„åˆæ˜¯å…·æœ‰åŸå­æ€§çš„ã€‚AtomicInteger æ˜¯â¼€ä¸ªæä¾›åŸå­æ“ä½œçš„ Integer ç±»ã€‚é™¤äº†ä½¿ç”¨åŸå­ç±»å¤–ï¼Œè¿˜å¯ä»¥é€šè¿‡ synchronized å…³é”®å­—æ¥ä¿è¯æ“ä½œçš„åŸå­æ€§ã€‚ å¯è§æ€§å¯â»…æ€§æŒ‡å½“â¼€ä¸ªçº¿ç¨‹ä¿®æ”¹äº†å…±äº«å˜é‡çš„å€¼ï¼Œå…¶å®ƒçº¿ç¨‹èƒ½å¤Ÿâ½´å³å¾—çŸ¥è¿™ä¸ªä¿®æ”¹ã€‚Java å†…å­˜æ¨¡å‹æ˜¯é€šè¿‡åœ¨å˜é‡ä¿®æ”¹åå°†æ–°å€¼åŒæ­¥å›ä¸»å†…å­˜ï¼Œåœ¨å˜é‡è¯»å–å‰ä»ä¸»å†…å­˜åˆ·æ–°å˜é‡å€¼æ¥å®ç°å¯â»…æ€§çš„ã€‚ä¸»è¦æœ‰ä¸‰ç§å¯è§æ€§çš„å®ç°æ–¹å¼: volatile synchronizedï¼Œå¯¹â¼€ä¸ªå˜é‡æ‰§â¾ unlock æ“ä½œä¹‹å‰ï¼Œå¿…é¡»æŠŠå˜é‡å€¼åŒæ­¥å›ä¸»å†…å­˜ã€‚ finalï¼Œè¢« final å…³é”®å­—ä¿®é¥°çš„å­—æ®µåœ¨æ„é€ â½…æ³•ä¸­â¼€æ—¦åˆå§‹åŒ–å®Œæˆï¼Œå¹¶ä¸”æ²¡æœ‰å‘â½£ this é€ƒé€¸ï¼ˆå…¶å®ƒçº¿ç¨‹é€šè¿‡ this å¼•â½¤è®¿é—®åˆ°åˆå§‹åŒ–äº†â¼€åŠçš„å¯¹è±¡ï¼‰ï¼Œé‚£ä¹ˆå…¶å®ƒçº¿ç¨‹å°±èƒ½çœ‹â»… final å­—æ®µçš„å€¼ã€‚ æœ‰åºæ€§æœ‰åºæ€§æŒ‡çš„æ˜¯åœ¨æœ¬çº¿ç¨‹å†…è§‚å¯Ÿï¼Œæ‰€æœ‰æ“ä½œéƒ½æ˜¯æœ‰åºçš„ï¼›å¦‚æœåœ¨â¼€ä¸ªçº¿ç¨‹è§‚å¯Ÿå¦â¼€ä¸ªçº¿ç¨‹ï¼Œæ‰€æœ‰æ“ä½œéƒ½æ˜¯æ— åºçš„ã€‚Java å†…å­˜æ¨¡å‹æ˜¯é€šè¿‡ç¦æ­¢æŒ‡ä»¤é‡æ’åºæ¥ä¿è¯æœ‰åºæ€§çš„ã€‚ä¸»è¦æœ‰ä¸¤ç§æœ‰åºæ€§çš„å®ç°æ–¹å¼: volatile synchronizedï¼Œå¯¹â¼€ä¸ªå˜é‡æ‰§â¾ unlock æ“ä½œä¹‹å‰ï¼Œå¿…é¡»æŠŠå˜é‡å€¼åŒæ­¥å›ä¸»å†…å­˜ã€‚ å…ˆâ¾å‘â½£åŸåˆ™å…ˆâ¾å‘â½£åŸåˆ™æ˜¯æŒ‡å¦‚æœåœ¨ç¨‹åºä¸­ä¸¤ä¸ªæ“ä½œçš„å…ˆåé¡ºåºä¸ä»£ç ä¸­çš„é¡ºåºç›¸åŒï¼Œé‚£ä¹ˆè¿™ä¸¤ä¸ªæ“ä½œå°±ä¼šå…ˆâ¾å‘â½£ã€‚ 1. å•â¼€çº¿ç¨‹åŸåˆ™åœ¨å•â¼€çº¿ç¨‹ä¸­ï¼Œåœ¨ç¨‹åºå‰â¾¯çš„æ“ä½œå…ˆâ¾å‘â½£äºåâ¾¯çš„æ“ä½œã€‚ 2. ç®¡ç¨‹é”å®šè§„åˆ™â¼€ä¸ª unlock æ“ä½œå…ˆâ¾å‘â½£äºåâ¾¯å¯¹åŒâ¼€ä¸ªé”çš„ lock æ“ä½œã€‚ 3. volatile å˜é‡è§„åˆ™å¯¹â¼€ä¸ª volatile å˜é‡çš„å†™æ“ä½œå…ˆâ¾å‘â½£äºåâ¾¯å¯¹è¿™ä¸ªå˜é‡çš„è¯»æ“ä½œã€‚ 4. çº¿ç¨‹å¯åŠ¨è§„åˆ™Thread å¯¹è±¡çš„ start() â½…æ³•è°ƒâ½¤å…ˆâ¾å‘â½£äºæ­¤çº¿ç¨‹çš„æ¯â¼€ä¸ªåŠ¨ä½œã€‚ 5. çº¿ç¨‹åŠ â¼Šè§„åˆ™Thread å¯¹è±¡çš„ç»“æŸå…ˆâ¾å‘â½£äº join() â½…æ³•è¿”å›ã€‚ 6. çº¿ç¨‹ä¸­æ–­è§„åˆ™å¯¹çº¿ç¨‹interrupt()â½…æ³•çš„è°ƒâ½¤å…ˆâ¾å‘â½£äºè¢«ä¸­æ–­çº¿ç¨‹çš„ä»£ç æ£€æµ‹åˆ°ä¸­æ–­äº‹ä»¶çš„å‘â½£ï¼Œå¯ä»¥é€šè¿‡ interrupted() â½…æ³•æ£€æµ‹åˆ°æ˜¯å¦æœ‰ä¸­æ–­å‘â½£ã€‚ 7. å¯¹è±¡ç»ˆç»“è§„åˆ™â¼€ä¸ªå¯¹è±¡çš„åˆå§‹åŒ–å®Œæˆï¼ˆæ„é€ â½…æ³•æ‰§â¾ç»“æŸï¼‰å…ˆâ¾å‘â½£äºå®ƒçš„ finalize() â½…æ³•çš„å¼€å§‹ã€‚ 8. ä¼ é€’æ€§å¦‚æœæ“ä½œ A å…ˆâ¾å‘â½£äºæ“ä½œ Bï¼Œæ“ä½œ B å…ˆâ¾å‘â½£äºæ“ä½œ Cï¼Œé‚£ä¹ˆæ“ä½œ A å…ˆâ¾å‘â½£äºæ“ä½œ Cã€‚ çº¿ç¨‹å®‰å…¨å¤šä¸ªçº¿ç¨‹ä¸ç®¡ä»¥ä½•ç§â½…å¼è®¿é—®æŸä¸ªç±»ï¼Œå¹¶ä¸”åœ¨ä¸»è°ƒä»£ç ä¸­ä¸éœ€è¦ä»»ä½•é¢å¤–çš„åŒæ­¥æˆ–åè°ƒï¼Œè¿™ä¸ªç±»éƒ½èƒ½è¡¨ç°å‡ºæ­£ç¡®çš„â¾ä¸ºï¼Œé‚£ä¹ˆå°±ç§°è¿™ä¸ªç±»æ˜¯çº¿ç¨‹å®‰å…¨çš„ã€‚ çº¿ç¨‹å®‰å…¨æœ‰ä»¥ä¸‹å‡ ç§å®ç°æ–¹æ³•:ä¸å¯å˜ä¸å¯å˜ï¼ˆImmutableï¼‰çš„å¯¹è±¡â¼€å®šæ˜¯çº¿ç¨‹å®‰å…¨çš„ï¼Œä¸éœ€è¦å†é‡‡å–ä»»ä½•çš„çº¿ç¨‹å®‰å…¨ä¿éšœæªæ–½ã€‚åªè¦â¼€ä¸ªä¸å¯å˜çš„å¯¹è±¡è¢«æ­£ç¡®åœ°æ„å»ºå‡ºæ¥ï¼Œæ°¸è¿œä¹Ÿä¸ä¼šçœ‹åˆ°å®ƒåœ¨å¤šä¸ªçº¿ç¨‹ä¹‹ä¸­å¤„äºä¸â¼€è‡´çš„çŠ¶æ€ã€‚å¤šçº¿ç¨‹ç¯å¢ƒä¸‹ï¼Œåº”å½“å°½é‡ä½¿å¯¹è±¡æˆä¸ºä¸å¯å˜ï¼Œæ¥æ»¡â¾œçº¿ç¨‹å®‰å…¨ã€‚ ä¸å¯å˜çš„ç±»å‹ï¼šfinal å…³é”®å­—ä¿®é¥°çš„åŸºæœ¬æ•°æ®ç±»å‹Stringæšä¸¾ç±»å‹Number éƒ¨åˆ†â¼¦ç±»ï¼Œå¦‚ Long å’Œ Double ç­‰æ•°å€¼åŒ…è£…ç±»å‹ï¼ŒBigInteger å’Œ BigDecimal ç­‰â¼¤æ•°æ®ç±»å‹ã€‚ä½†åŒä¸º Number çš„åŸâ¼¦ç±» AtomicInteger å’Œ AtomicLong åˆ™æ˜¯å¯å˜çš„ã€‚å¯¹äºé›†åˆç±»å‹ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿â½¤ Collections.unmodifiableXXX() æ–¹æ³•æ¥è·å–â¼€ä¸ªä¸å¯å˜çš„é›†åˆã€‚ äº’æ–¥åŒæ­¥synchronized å’Œ ReentrantLockã€‚ â¾®é˜»å¡åŒæ­¥é˜»å¡åŒæ­¥æ˜¯ä¸€ç§æ‚²è§‚çš„å¹¶å‘ç­–ç•¥ï¼Œå³è®¤ä¸ºåªè¦ä¸å»åšæ­£ç¡®çš„åŒæ­¥æªæ–½ï¼Œé‚£å°±è‚¯å®šä¼šå‡ºç°é—®é¢˜ã€‚è€Œéé˜»å¡æ˜¯ä¸€ç§åŸºäºå†²çªæ£€æµ‹çš„ä¹è§‚å¹¶å‘ç­–ç•¥ï¼Œå³ä¸åŠ é”ï¼Œä½†æ˜¯å¦‚æœå­˜åœ¨å†²çªï¼Œå°±é‡è¯•å½“å‰æ“ä½œç›´åˆ°æˆåŠŸã€‚ CASç¡¬ä»¶â½€æŒçš„åŸâ¼¦æ€§æ“ä½œæœ€å…¸å‹çš„æ˜¯ï¼šâ½è¾ƒå¹¶äº¤æ¢ï¼ˆCompare-and-Swapï¼ŒCASï¼‰ã€‚CAS æŒ‡ä»¤éœ€è¦æœ‰ 3 ä¸ªæ“ä½œæ•°ï¼Œåˆ†åˆ«æ˜¯å†…å­˜åœ°å€ Vã€æ—§çš„é¢„æœŸå€¼ A å’Œæ–°å€¼ Bã€‚å½“æ‰§â¾æ“ä½œæ—¶ï¼Œåªæœ‰å½“ Vçš„å€¼ç­‰äº Aï¼Œæ‰å°† V çš„å€¼æ›´æ–°ä¸º Bã€‚ ä¹è§‚é”éœ€è¦æ“ä½œã€å†²çªæ£€æµ‹è¿™ä¸¤ä¸ªæ­¥éª¤å…·å¤‡åŸâ¼¦æ€§ï¼Œè¿™â¾¥å°±ä¸èƒ½å†ä½¿â½¤äº’æ–¥åŒæ­¥æ¥ä¿è¯äº†ï¼Œåªèƒ½é ç¡¬ä»¶æ¥å®Œæˆã€‚ AtomicIntegerJ.U.C åŒ…â¾¥â¾¯çš„æ•´æ•°åŸâ¼¦ç±» AtomicInteger çš„â½…æ³•è°ƒâ½¤äº† Unsafe ç±»çš„ CAS æ“ä½œã€‚ ABAå¦‚æœâ¼€ä¸ªå˜é‡åˆæ¬¡è¯»å–çš„æ—¶å€™æ˜¯ A å€¼ï¼Œå®ƒçš„å€¼è¢«æ”¹æˆäº† Bï¼Œåæ¥â¼œè¢«æ”¹å›ä¸º Aï¼Œé‚£ CAS æ“ä½œå°±ä¼šè¯¯è®¤ä¸ºå®ƒä»æ¥æ²¡æœ‰è¢«æ”¹å˜è¿‡ã€‚J.U.C åŒ…æä¾›äº†â¼€ä¸ªå¸¦æœ‰æ ‡è®°çš„åŸâ¼¦å¼•â½¤ç±» AtomicStampedReference æ¥è§£å†³è¿™ä¸ªé—®é¢˜ï¼Œå®ƒå¯ä»¥é€šè¿‡æ§åˆ¶å˜é‡å€¼çš„ç‰ˆæœ¬æ¥ä¿è¯ CAS çš„æ­£ç¡®æ€§ã€‚â¼¤éƒ¨åˆ†æƒ…å†µä¸‹ ABA é—®é¢˜ä¸ä¼šå½±å“ç¨‹åºå¹¶å‘çš„æ­£ç¡®æ€§ï¼Œå¦‚æœéœ€è¦è§£å†³ ABA é—®é¢˜ï¼Œæ”¹â½¤ä¼ ç»Ÿçš„äº’æ–¥åŒæ­¥å¯èƒ½ä¼šâ½åŸâ¼¦ç±»æ›´â¾¼æ•ˆã€‚ æ— åŒæ­¥æ–¹æ¡ˆè¦ä¿è¯çº¿ç¨‹å®‰å…¨ï¼Œå¹¶ä¸æ˜¯â¼€å®šå°±è¦è¿›â¾åŒæ­¥ã€‚å¦‚æœâ¼€ä¸ªâ½…æ³•æœ¬æ¥å°±ä¸æ¶‰åŠå…±äº«æ•°æ®ï¼Œé‚£å®ƒâ¾ƒç„¶å°±â½†é¡»ä»»ä½•åŒæ­¥æªæ–½å»ä¿è¯æ­£ç¡®æ€§ã€‚ æ ˆå°é—­å¤šä¸ªçº¿ç¨‹è®¿é—®åŒâ¼€ä¸ªâ½…æ³•çš„å±€éƒ¨å˜é‡æ—¶ï¼Œä¸ä¼šå‡ºç°çº¿ç¨‹å®‰å…¨é—®é¢˜ï¼Œå› ä¸ºå±€éƒ¨å˜é‡å­˜å‚¨åœ¨è™šæ‹Ÿæœºæ ˆä¸­ï¼Œå±äºçº¿ç¨‹ç§æœ‰çš„ã€‚ çº¿ç¨‹æœ¬åœ°å­˜å‚¨ï¼ˆThread Local Storageï¼‰å¦‚æœâ¼€ä¸ªå˜é‡åœ¨çº¿ç¨‹çš„â¼€ä¸ªâ½…æ³•ä¸­è¢«TLSå˜é‡å­˜å‚¨ï¼Œå¹¶è¢«å…¶ä»–â½…æ³•è¯»å–å’Œä¿®æ”¹ï¼Œé‚£ä¹ˆå³ä½¿ä¸¤ä¸ªçº¿ç¨‹æ‰§â¾çš„æ˜¯åŒâ¼€ä¸ªä»£ç ï¼Œå®ƒä»¬ä¹Ÿä¼šè®¿é—®åˆ°ä¸åŒçš„æ•°æ®ã€‚ é”ä¼˜åŒ–ä¸»è¦æ˜¯é’ˆå¯¹synchronizedå…³é”®å­—çš„ä¼˜åŒ–ã€‚ â¾ƒæ—‹é”â¾ƒæ—‹é”è™½ç„¶èƒ½é¿å…è¿›â¼Šé˜»å¡çŠ¶æ€ä»â½½å‡å°‘å¼€é”€ï¼Œä½†æ˜¯å®ƒéœ€è¦è¿›â¾å¿™å¾ªç¯æ“ä½œå â½¤ CPU æ—¶é—´ï¼Œå®ƒåªé€‚â½¤äºå…±äº«æ•°æ®çš„é”å®šçŠ¶æ€å¾ˆçŸ­çš„åœºæ™¯ã€‚ é”æ¶ˆé™¤é”æ¶ˆé™¤æ˜¯æŒ‡è™šæ‹Ÿæœºå³æ—¶ç¼–è¯‘å™¨åœ¨è¿â¾æ—¶ï¼Œå¯¹ä»£ç è¿›â¾æ‰«æï¼Œå»é™¤ä¸å¯èƒ½å­˜åœ¨å…±äº«æ•°æ®ç«äº‰çš„é”ï¼Œé€šè¿‡é”æ¶ˆé™¤ï¼Œå¯ä»¥èŠ‚çœæ¯«æ— æ„ä¹‰çš„è¯·æ±‚é”æ—¶é—´ã€‚ é”ç²—åŒ–é”ç²—åŒ–æ˜¯æŒ‡è™šæ‹Ÿæœºå³æ—¶ç¼–è¯‘å™¨åœ¨è¿â¾æ—¶ï¼Œå¯¹ä»£ç è¿›â¾æ‰«æï¼Œå°†å¤šä¸ªç›¸é‚»çš„åŠ é”æ“ä½œåˆå¹¶ä¸ºâ¼€ä¸ªåŠ é”æ“ä½œï¼Œé€šè¿‡é”ç²—åŒ–ï¼Œå¯ä»¥èŠ‚çœåŠ é”å’Œé‡Šæ”¾é”çš„æ—¶é—´ã€‚ è½»é‡çº§é”JDK 1.6 å¼•â¼Šäº†åå‘é”å’Œè½»é‡çº§é”ï¼Œä»â½½è®©é”æ‹¥æœ‰äº†å››ä¸ªçŠ¶æ€ï¼šâ½†é”çŠ¶æ€ï¼ˆunlockedï¼‰ã€åå‘é”çŠ¶æ€ï¼ˆbiasbleï¼‰ã€è½»é‡çº§é”çŠ¶æ€ï¼ˆlightweight lockedï¼‰å’Œé‡é‡çº§é”çŠ¶æ€ï¼ˆinflatedï¼‰ã€‚ è½»é‡çº§é”ç›¸æ¯”ä¼ ç»Ÿçš„é‡é‡çº§é”ï¼Œå®ƒä½¿ç”¨CASæ“ä½œæ¥é¿å…çº¿ç¨‹é˜»å¡å’Œå”¤é†’çš„å¼€é”€ï¼ŒåŒæ—¶ä¹Ÿé¿å…äº†æ“ä½œç³»ç»Ÿå±‚é¢çš„çº¿ç¨‹è°ƒåº¦ã€‚å¦‚æœè½»é‡çº§é”è‡ªæ—‹æˆ–æ£€æµ‹åˆ°æœ‰çº¿ç¨‹å†²çªï¼Œä¼šå‡çº§ä¸ºé‡é‡çº§é”ã€‚ åå‘é”åå‘é”æ˜¯æŒ‡åœ¨æ²¡æœ‰çº¿ç¨‹ç«äº‰çš„æƒ…å†µä¸‹ï¼Œé”å¯¹è±¡ä¼šåå‘äºä½¿â½¤å®ƒçš„çº¿ç¨‹ï¼Œè¿™æ ·å°±ä¸éœ€è¦è¿›â¾é¢å¤–çš„åŠ é”å’Œè§£é”æ“ä½œã€‚ å¤šçº¿ç¨‹å¼€å‘è‰¯å¥½çš„å®è·µ ç»™çº¿ç¨‹èµ·ä¸ªæœ‰æ„ä¹‰çš„åå­—ï¼Œè¿™æ ·å¯ä»¥â½…ä¾¿æ‰¾ Bugã€‚ ç¼©â¼©åŒæ­¥èŒƒå›´ï¼Œä»â½½å‡å°‘é”äº‰â½¤ã€‚ä¾‹å¦‚å¯¹äº synchronizedï¼Œåº”è¯¥å°½é‡ä½¿â½¤åŒæ­¥å—â½½ä¸æ˜¯åŒæ­¥â½…æ³•ã€‚ å¤šâ½¤åŒæ­¥â¼¯å…·å°‘â½¤ wait()å’Œ notify() ã€‚â¾¸å…ˆï¼ŒCountDownLatch, CyclicBarrier, Semaphore å’Œ Exchanger è¿™äº›åŒæ­¥ç±»ç®€åŒ–äº†ç¼–ç æ“ä½œï¼Œâ½½â½¤ wait()å’Œ notify() å¾ˆéš¾å®ç°å¤æ‚æ§åˆ¶æµï¼›å…¶æ¬¡ï¼Œè¿™äº›åŒæ­¥ç±»æ˜¯ç”±æœ€å¥½çš„ä¼ä¸šç¼–å†™å’Œç»´æŠ¤ï¼Œåœ¨åç»­çš„ JDK ä¸­è¿˜ä¼šä¸æ–­ä¼˜åŒ–å’Œå®Œå–„ã€‚ ä½¿â½¤ BlockingQueue å®ç°â½£äº§è€…æ¶ˆè´¹è€…é—®é¢˜ã€‚ å¤šâ½¤å¹¶å‘é›†åˆå°‘â½¤åŒæ­¥é›†åˆï¼Œä¾‹å¦‚åº”è¯¥ä½¿â½¤ ConcurrentHashMap â½½ä¸æ˜¯ Hashtableã€‚ ä½¿â½¤æœ¬åœ°å˜é‡å’Œä¸å¯å˜ç±»æ¥ä¿è¯çº¿ç¨‹å®‰å…¨ã€‚ ä½¿â½¤çº¿ç¨‹æ± â½½ä¸æ˜¯ç›´æ¥åˆ›å»ºçº¿ç¨‹ï¼Œè¿™æ˜¯å› ä¸ºåˆ›å»ºçº¿ç¨‹ä»£ä»·å¾ˆâ¾¼ï¼Œçº¿ç¨‹æ± å¯ä»¥æœ‰æ•ˆåœ°åˆ©â½¤æœ‰é™çš„çº¿ç¨‹æ¥å¯åŠ¨ä»»åŠ¡ã€‚","tags":["åŸºç¡€","Java","å¹¶å‘"],"categories":["åŸºç¡€ç¬”è®°"]},{"title":"2025.6.7å­¦ä¹ æ—¥è®°","path":"/2025/06/07/å­¦ä¹ æ—¥è®°25å¹´6æœˆ/2025.6.7å­¦ä¹ ç¬”è®°/","content":"å­¦ä¹ å†…å®¹1. åŠ›æ‰£æ¯æ—¥ä¸€é¢˜https://leetcode.cn/problems/lexicographically-minimum-string-after-removing-stars?envType=daily-questionenvId=2025-06-07 å…ˆæ˜¯å°è¯•ä¼˜å…ˆé˜Ÿåˆ—ï¼Œæœ€å°å †æ‰¾å‰é¢çš„æœ€å°å…ƒç´ ï¼Œç„¶åé‡åˆ°*å°±åˆ é™¤ï¼Œä½†æ—¶é—´å¤æ‚åº¦ä¸ºOn2ï¼Œç‰¹æ®Šç”¨ä¾‹è¶…æ—¶äº†ã€‚ç„¶åå‘ç°å¯ä»¥ç”¨æ ˆæ¨¡æ‹ŸäºŒåå…­ä¸ªå­—æ¯ï¼Œæ ˆä¸­å­˜å‚¨ä¸‹æ ‡ï¼Œé‡åˆ°*å‡ºæ ˆæœ€å°çš„å­—ç¬¦ã€‚ä¼˜åŒ–ç‚¹ï¼šå¯ä»¥ä½¿ç”¨äºŒè¿›åˆ¶æ©ç æ¥è¡¨ç¤ºæœ€å°çš„éç©ºæ ˆåœ¨å“ªé‡Œã€‚ 2. å­¦ä¹ å®Œjavaå¹¶å‘ç¯‡ç¬”è®°è®°å½•åœ¨javaå¹¶å‘ç¯‡. 3. æŠŠæ˜¨å¤©çš„é¢˜ç”¨å †æ¥å®Œå–„ä¸€ä¸‹ç»´æŠ¤å°é¡¶å †æ±‚å‰kå¤§çš„å…ƒç´ ã€‚ 4. å­¦ä¹ KMPç®—æ³•.KMPç®—æ³•æ˜¯ä¸€ç§å­—ç¬¦ä¸²åŒ¹é…ç®—æ³•ï¼Œå®ƒçš„æ—¶é—´å¤æ‚åº¦ä¸ºO(n+m)ï¼Œå…¶ä¸­næ˜¯æ–‡æœ¬ä¸²çš„é•¿åº¦ï¼Œmæ˜¯æ¨¡å¼ä¸²çš„é•¿åº¦ã€‚è´´ä¸€ä¸ªæ¨¡æ¿,åŸç†å·²ç»ç†è§£äº†ï¼Œä½†æ˜¯ä»£ç è¿˜éœ€è¦å†å†™ä¸€éï¼š class Solution // KMP ç®—æ³• // ss: åŸä¸²(string) pp: åŒ¹é…ä¸²(pattern) public int strStr(String ss, String pp) if (pp.isEmpty()) return 0; // åˆ†åˆ«è¯»å–åŸä¸²å’ŒåŒ¹é…ä¸²çš„é•¿åº¦ int n = ss.length(), m = pp.length(); // åŸä¸²å’ŒåŒ¹é…ä¸²å‰é¢éƒ½åŠ ç©ºæ ¼ï¼Œä½¿å…¶ä¸‹æ ‡ä» 1 å¼€å§‹ ss = + ss; pp = + pp; char[] s = ss.toCharArray(); char[] p = pp.toCharArray(); // æ„å»º next æ•°ç»„ï¼Œæ•°ç»„é•¿åº¦ä¸ºåŒ¹é…ä¸²çš„é•¿åº¦ï¼ˆnext æ•°ç»„æ˜¯å’ŒåŒ¹é…ä¸²ç›¸å…³çš„ï¼‰ int[] next = new int[m + 1]; // æ„é€ è¿‡ç¨‹ i = 2ï¼Œj = 0 å¼€å§‹ï¼Œi å°äºç­‰äºåŒ¹é…ä¸²é•¿åº¦ ã€æ„é€  i ä» 2 å¼€å§‹ã€‘ for (int i = 2, j = 0; i = m; i++) // åŒ¹é…ä¸æˆåŠŸçš„è¯ï¼Œj = next(j) while (j 0 p[i] != p[j + 1]) j = next[j]; // åŒ¹é…æˆåŠŸçš„è¯ï¼Œå…ˆè®© j++ if (p[i] == p[j + 1]) j++; // æ›´æ–° next[i]ï¼Œç»“æŸæœ¬æ¬¡å¾ªç¯ï¼Œi++ next[i] = j; // åŒ¹é…è¿‡ç¨‹ï¼Œi = 1ï¼Œj = 0 å¼€å§‹ï¼Œi å°äºç­‰äºåŸä¸²é•¿åº¦ ã€åŒ¹é… i ä» 1 å¼€å§‹ã€‘ for (int i = 1, j = 0; i = n; i++) // åŒ¹é…ä¸æˆåŠŸ j = next(j) while (j 0 s[i] != p[j + 1]) j = next[j]; // åŒ¹é…æˆåŠŸçš„è¯ï¼Œå…ˆè®© j++ï¼Œç»“æŸæœ¬æ¬¡å¾ªç¯å i++ if (s[i] == p[j + 1]) j++; // æ•´ä¸€æ®µåŒ¹é…æˆåŠŸï¼Œç›´æ¥è¿”å›ä¸‹æ ‡ if (j == m) return i - m; return -1;","tags":["åŸºç¡€","æ—¥è®°","leetcode","é¡¹ç›®"],"categories":["å­¦ä¹ æ—¥è®°","2025-06"]},{"title":"java30å¤©å­¦ä¹ ç¬”è®°","path":"/2025/06/06/åŸºç¡€ç¬”è®°/java30å¤©ç¬”è®°/","content":"æ‚é¡¹æœ€å¥½ä¸ä½¿ç”¨ clone()æ¥è¿›è¡Œå¤åˆ¶,å¯ä»¥ä½¿ç”¨æ‹·è´æ„é€ å‡½æ•°æˆ–æ‹·è´å·¥å‚æ¥å¤åˆ¶å¯¹è±¡. æŠ½è±¡ç±»æä¾›äº†â¼€ç§ IS-A çš„å…³ç³»æ¥â¼æ›´åƒæ˜¯â¼€ç§ LIKE-A å…³ç³» Fail-Fast æœºåˆ¶Fail-Fast æœºåˆ¶æ˜¯ Java é›†åˆ(Collection)ä¸­çš„â¼€ç§é”™è¯¯æœºåˆ¶ã€‚å½“å¤šä¸ªçº¿ç¨‹å¯¹åŒä¸€ä¸ªé›†åˆçš„å†…å®¹è¿›â¾æ“ä½œæ—¶ï¼Œå°±å¯èƒ½äº§â½£çº¿ç¨‹å®‰å…¨é—®é¢˜ã€‚Fail-Fast æœºåˆ¶ä¼šâ¾ƒåŠ¨æ£€æµ‹åˆ°çº¿ç¨‹å®‰å…¨é—®é¢˜,åœ¨æ“ä½œå‰åæ¯”è¾ƒé›†åˆçš„ç»“æ„å˜åŒ–æ¬¡æ•°æ˜¯å¦ç›¸åŒï¼Œå¹¶æŠ›å‡º ConcurrentModificationException å¼‚å¸¸ã€‚ tips:ç¦â½Œåœ¨foreachâ¾¥æ‰§â¾å…ƒç´ çš„åˆ é™¤æ“ä½œ å®¹å™¨çš„ä¸€äº›è§£ævectorå’Œarraylistçš„æ¯”è¾ƒvectoræ˜¯åŒæ­¥çš„ï¼Œæ‰€ä»¥å¼€é”€æ›´å¤§vectoræ¯æ¬¡æ‰©å®¹è¯·æ±‚2å€ï¼Œè€Œarraylistæ˜¯1.5å€ å¦‚æœå¯¹çº¿ç¨‹å®‰å…¨æœ‰è¦æ±‚çš„è¯ï¼Œå¯ä»¥é€‰æ‹©Collections.synchronizedList() æˆ–è€…ä½¿ç”¨CopyOnWriteArrayListä¿è¯çº¿ç¨‹å®‰å…¨ã€‚ CopyOnWriteArrayListå†™æ“ä½œåœ¨æ‹·è´çš„æ•°ç»„ä¸Šè¿›è¡Œï¼Œè€Œè¯»æ“ä½œåœ¨åŸæ•°ç»„ä¸Šè¿›è¡Œã€‚å†™æ“ä½œéœ€è¦åŠ é”ï¼Œé˜²æ­¢å¹¶å‘å†™æ“ä½œã€‚é€‚ç”¨äºè¯»å¤šå†™å°‘çš„åœºæ™¯ã€‚é—®é¢˜:å†…å­˜å ç”¨çº¦å åŸæ•°ç»„çš„ä¸¤å€ã€‚æ•°æ®ä¸€è‡´æ€§é—®é¢˜ã€‚ æ‰€ä»¥CopyOnWriteArrayListæ›´åŠ é€‚åˆå¯¹å†…å­˜ä¸æ•æ„Ÿä»¥åŠå®æ—¶æ€§è¦æ±‚å¾ˆé«˜çš„åœºæ™¯ã€‚ LinkedListArrayListæ˜¯åŸºäºæ•°ç»„å®ç°çš„ï¼Œè€ŒLinkedListæ˜¯åŸºäºé“¾è¡¨å®ç°çš„ã€‚æ•°ç»„æ”¯æŒéšæœºè®¿é—®ï¼Œè€Œé“¾è¡¨ä¸æ”¯æŒéšæœºè®¿é—®ã€‚æ•°ç»„çš„æ’å…¥å’Œåˆ é™¤æ“ä½œéœ€è¦ç§»åŠ¨å…ƒç´ ï¼Œè€Œé“¾è¡¨çš„æ’å…¥å’Œåˆ é™¤æ“ä½œåªéœ€è¦ä¿®æ”¹æŒ‡é’ˆã€‚æ•°ç»„çš„ç©ºé—´åˆ©ç”¨ç‡é«˜ï¼Œè€Œé“¾è¡¨çš„ç©ºé—´åˆ©ç”¨ç‡ä½ã€‚LinkedListé€‚ç”¨äºéœ€è¦é¢‘ç¹æ’å…¥å’Œåˆ é™¤å…ƒç´ çš„åœºæ™¯ã€‚ HashMapç›¸å½“äºåˆ†æˆäº†å¾ˆå¤šä¸ªæ¡¶ï¼Œæ¯ä¸ªæ¡¶é‡Œé¢æ˜¯ä¸€ä¸ªé“¾è¡¨ï¼Œé“¾è¡¨çš„æ¯ä¸ªèŠ‚ç‚¹æ˜¯ä¸€ä¸ªé”®å€¼å¯¹ï¼Œä½¿ç”¨å¤´æ’æ³•æ’å…¥èŠ‚ç‚¹ã€‚ ConcurrentHashMapConcurrentHashMapæ˜¯çº¿ç¨‹å®‰å…¨çš„HashMapï¼Œå®ƒçš„å®ç°æ–¹å¼æ˜¯ä½¿ç”¨åˆ†æ®µé”ã€‚ConcurrentHashMapå°†æ•´ä¸ªHashMapåˆ†æˆäº†å¤šä¸ªæ®µï¼Œæ¯ä¸ªæ®µéƒ½æ˜¯ä¸€ä¸ªHashMapã€‚æ¯ä¸ªæ®µéƒ½æœ‰ä¸€ä¸ªé”ï¼Œå½“ä¸€ä¸ªçº¿ç¨‹è®¿é—®ä¸€ä¸ªæ®µæ—¶ï¼Œå…¶ä»–çº¿ç¨‹ä¹Ÿå¯ä»¥è®¿é—®å…¶ä»–æ®µã€‚ LinkedHashMapLinkedHashMapæ˜¯HashMapçš„å­ç±»ï¼Œå®ƒçš„å®ç°æ–¹å¼æ˜¯ä½¿ç”¨åŒå‘é“¾è¡¨ã€‚LinkedHashMapçš„è¿­ä»£é¡ºåºæ˜¯æ’å…¥é¡ºåºæˆ–è€…è®¿é—®é¡ºåºã€‚å¯ä»¥é€šè¿‡LinkedHashMapå®ç°LRUç¼“å­˜ã€‚ WeakHashMapä¸»è¦æ˜¯ç”¨æ¥å®ç°ç¼“å­˜çš„ã€‚WeakHashMapçš„é”®æ˜¯å¼±å¼•ç”¨ï¼Œå½“é”®ä¸å†è¢«å¼•ç”¨æ—¶ï¼Œé”®å€¼å¯¹ä¼šè¢«è‡ªåŠ¨ç§»é™¤ã€‚WeakHashMapçš„è¿­ä»£å™¨æ˜¯å¼±å¼•ç”¨çš„ï¼Œæ‰€ä»¥åœ¨è¿­ä»£æ—¶å¯èƒ½ä¼šå‡ºç°ç©ºæŒ‡é’ˆå¼‚å¸¸ã€‚ ConcurrentCacheConcurrentCacheæ˜¯ä¸€ä¸ªçº¿ç¨‹å®‰å…¨çš„ç¼“å­˜ï¼Œå®ƒçš„å®ç°æ–¹å¼æ˜¯ä½¿ç”¨ConcurrentHashMapã€‚","tags":["java"],"categories":["åŸºç¡€ç¬”è®°"]},{"title":"2025.6.6å­¦ä¹ æ—¥è®°","path":"/2025/06/06/å­¦ä¹ æ—¥è®°25å¹´6æœˆ/2025.6.6å­¦ä¹ ç¬”è®°/","content":"å­¦ä¹ å†…å®¹1. ä¼˜åŒ–äº†ä¸€ä¸‹ä¸ªäººåšå®¢çš„å›¾ç‰‡ä¸Šä¼ å·¥ä½œæµç”±äºå¤§éƒ¨åˆ†ç¬”è®°åœ¨è¯­é›€ä¸­,å¯¼è‡´å›¾ç‰‡ä¸Šä¼ åå¤–é“¾æ— æ³•è®¿é—®,æ‰€ä»¥ä»Šå¤©é€šè¿‡picgoâ•githubæ­å»ºäº†ä¸€ä¸ªå›¾åºŠ.å…·ä½“æµç¨‹å¦‚ä¸‹: é¦–å…ˆéœ€è¦åœ¨githubä¸­åˆ›å»ºä¸€ä¸ªä»“åº“,ç”¨æ¥å­˜æ”¾å›¾ç‰‡ ç„¶ååœ¨picgoä¸­é…ç½®githubçš„ä»“åº“,å°†å›¾ç‰‡ä¸Šä¼ åˆ°githubä¸­æ“ä½œå¦‚ä¸‹:mac:shift+control+command+4 æˆªå›¾ ç„¶ååœ¨vscodeä¸­option+command+uä¸Šä¼ åˆ°å›¾åºŠåä¼šè‡ªåŠ¨ç”Ÿæˆmarkdownçš„é“¾æ¥. 2. ä¼˜åŒ–äº†ä¸€ä¸‹è‡ªå·±è®°ç¬”è®°å‘åšå®¢çš„å·¥ä½œæµè¯­é›€å†™ç¬”è®°è¿˜æ˜¯å¤ªéº»çƒ¦äº†ã€‚æ‰€ä»¥å‡†å¤‡ä»¥åè¿˜æ˜¯ç”¨vscodeå†™ç¬”è®°,ç„¶åç›´æ¥è¿è¡Œä¸€è¡Œå‘½ä»¤åŒæ­¥åˆ°ä»“åº“,è€Œä¸”è¿˜æœ‰è¡¥å…¨å·¥å…·ã€‚ 3. åŠ›æ‰£ä¸¤é“æ¯æ—¥ä¸€é¢˜ï¼šè¿™é¢˜æ€è·¯å¾ˆæ¸…æ™°ï¼Œè´ªå¿ƒåŠ ä¸€ä¸ªæ ˆçš„æ¨¡æ‹Ÿé¢˜ï¼Œå®ç°æœ‰ä¸€äº›å°ç»†èŠ‚éœ€è¦æ³¨æ„ã€‚å‰Kä¸ªé«˜é¢‘å…ƒç´ ï¼šmapè®°å½•é¢‘ç‡ï¼Œç„¶åå°é¡¶å †ç»´æŠ¤å‰Kä¸ªå…ƒç´ ã€‚ï¼ˆç¬¬ä¸€éåšç”¨äº†å•è°ƒæ ˆï¼Œå¿˜è®°ç”¨å°é¡¶å †ç»´æŠ¤äº†ï¼‰åšäº†å…³äºæœ€å¤§æœ€å°å †çš„ç¬”è®°ã€‚ 4. çœ‹äº†javaå®¹å™¨ç›¸å…³çš„å…«è‚¡æ–‡è®°åœ¨java30å¤©ç¬”è®°é‡Œé¢äº†ã€‚ 5. é¡¹ç›®éƒ¨åˆ†çœ‹äº†sessionç™»å½•æ‹¦æˆªå™¨ç›¸å…³çš„éƒ¨åˆ†6. æ‚è°ˆæ„Ÿè§‰éœ€è¦å¢åŠ åŸºç¡€çš„å­¦ä¹ ï¼Œé¡¹ç›®å¯ä»¥å…ˆè¯»ä¸€éæ–‡æ¡£ã€‚","tags":["åŸºç¡€","æ—¥è®°","leetcode","é¡¹ç›®","åšå®¢","picgo"],"categories":["å­¦ä¹ æ—¥è®°","2025-06"]},{"title":"å¥½ç”¨çš„å¿«æ·é”®å’Œæ“ä½œ","path":"/2025/06/06/æ‚é¡¹ç¬”è®°/å¥½ç”¨çš„å¿«æ·é”®æˆ–æ“ä½œ/","content":"MACç³»ç»Ÿæ“ä½œæˆªå›¾åˆ°å‰ªåˆ‡æ¿mac:shift+control+command+4 æœ€å°åŒ–çª—å£mac:command+m å…³é—­çª—å£mac:command+w å…¨å±mac:command+control+f IDEAswitch2cursoræ’ä»¶mac:shift + option + o å¿«é€Ÿåœ¨cursorä¸­æ‰“å¼€å½“å‰æ–‡ä»¶mac:shift + option + p å¿«é€Ÿåœ¨cursorä¸­æ‰“å¼€å½“å‰å·¥ç¨‹ VSCODEå•è¡Œä¸Šä¸‹ç§»åŠ¨mac:shift+option+up/down å¤šè¡Œä¸Šä¸‹ç§»åŠ¨mac:shift+option+command+up/down åˆ é™¤æœ¬è¡Œmac:command+shift+k å¼€å…³å·¦ä¾§é¡¹ç›®æ ‘mac:command+1 é‡å‘½åæ–‡ä»¶mac:fn+shift+f6 VSCODE picgoæ’ä»¶ä¸Šä¼ åˆ°å›¾åºŠmac:option+command+u å…³é—­ç»ˆç«¯çª—å£mac:command+j ç»ˆç«¯Warpåˆ°hexoæ ¹ç›®å½•cd /Users/mac/Blog/JakicDong.github.io hexoæ¸…ç†å¹¶ä¸”é‡æ–°ä¸Šä¼ hexo clean hexo g hexo d æœ¬åœ°éƒ¨ç½²hexo s Edgeæµè§ˆå™¨æ ‡ç­¾é¡µå·¦å³ç§»åŠ¨mac:command+option+left/right å…³é—­æ ‡ç­¾é¡µmac:command+w å¼€å‘è€…å·¥å…·mac:command+option+i fn+f12","tags":["å¿«æ·é”®"],"categories":["æ‚é¡¹ç¬”è®°"]},{"title":"Hello World","path":"/2025/06/05/æ‚é¡¹ç¬”è®°/hello-world/","content":"hexoçš„åŸºæœ¬ä½¿ç”¨å’Œæ¨¡æ¿å¸¸ç”¨æ¨¡ç‰ˆ ---title: ä¸ªäººåšå®¢æ­å»ºtags: [åšå®¢, hexo]date: 2025-06-01--- å¿«æ·éƒ¨ç½²: hexo clean hexo g hexo d Quick Startåˆ›å»ºä¸€ç¯‡æ–‡ç« $ hexo new My New Post æ›´å¤šä¿¡æ¯: Writing è¿è¡ŒæœåŠ¡$ hexo server æ›´å¤šä¿¡æ¯: Server ç”Ÿæˆé™æ€æ–‡ä»¶$ hexo generate æ›´å¤šä¿¡æ¯: Generating éƒ¨ç½²åˆ°è¿œç¨‹ç«™ç‚¹$ hexo deploy æ›´å¤šä¿¡æ¯: Deployment æ–‡ç« æ¨¡ç‰ˆ---# åŸºæœ¬ä¿¡æ¯title: title date: date tags: []categories: []description: # excerpt ä¹Ÿå¯ # å°é¢cover: banner: poster: # æµ·æŠ¥ï¼ˆå¯é€‰ï¼Œå…¨å›¾å°é¢å¡ç‰‡ï¼‰ topic: æ ‡é¢˜ä¸Šæ–¹çš„å°å­— # å¯é€‰ headline: å¤§æ ‡é¢˜ # å¿…é€‰ caption: æ ‡é¢˜ä¸‹æ–¹çš„å°å­— # å¯é€‰ color: æ ‡é¢˜é¢œè‰² # å¯é€‰# æ’ä»¶sticky: # æ•°å­—è¶Šå¤§è¶Šé å‰mermaid:katex: mathjax: # å¯é€‰topic: # ä¸“æ  idauthor: references:comments: # è®¾ç½® false ç¦æ­¢è¯„è®ºindexing: # è®¾ç½® false é¿å…è¢«æœç´¢breadcrumb: # è®¾ç½® false éšè—é¢åŒ…å±‘å¯¼èˆªleftbar: rightbar:h1: # è®¾ç½®ä¸º éšè—æ ‡é¢˜type: # tech/story---","tags":["æ¬¢è¿é¡µ"],"categories":["æ‚é¡¹ç¬”è®°"]},{"title":"2025.6.5å­¦ä¹ æ—¥è®°","path":"/2025/06/05/å­¦ä¹ æ—¥è®°25å¹´6æœˆ/2025.6.5å­¦ä¹ æ—¥è®°/","content":"å­¦ä¹ å†…å®¹1. hexoè½»é‡åŒ–æ¡†æ¶æ­å»ºä¸ªäººåšå®¢æ­å»ºäº†ä¸ªäººåšå®¢ç½‘ç«™.ç®€åŒ–äº†ä¸€ä¸‹ç¬”è®°çš„æµç¨‹:ç›´æ¥æœ¬åœ°å†™markdownç¬”è®°ç„¶åç›´æ¥è¿è¡Œä¸€è¡Œå‘½ä»¤åŒæ­¥å¤ªä»“åº“,æ¯”è¾ƒæ–¹ä¾¿.todo:åæœŸå¯ä»¥è€ƒè™‘åŠ ä¸€ä¸ªæ‰“å¡å¢™. 2. leetcodeæ¯æ—¥ä¸€é¢˜å¹¶æŸ¥é›†çš„é¢˜,å¤ªä¹…æ²¡åšå›¾è®ºæœ‰ç‚¹å¿˜äº† class Solution public String smallestEquivalentString(String s1, String s2, String baseStr) int[] fa = new int[26]; for (int i = 0; i 26; i++) fa[i] = i; for (int i = 0; i s1.length(); i++) merge(fa, s1.charAt(i) - a, s2.charAt(i) - a); char[] s = baseStr.toCharArray(); for (int i = 0; i s.length; i++) s[i] = (char) (find(fa, s[i] - a) + a); return new String(s); private int find(int[] fa, int x) if (fa[x] != x) fa[x] = find(fa, fa[x]); return fa[x]; private void merge(int[] fa, int x, int y) int fx = find(fa, x); int fy = find(fa, y); // æŠŠå¤§çš„ä»£è¡¨å…ƒæŒ‡å‘å°çš„ä»£è¡¨å…ƒ if (fx fy) fa[fy] = fx; else fa[fx] = fy; 3. å¥èº«ç»ƒèƒ¸æ—¥","tags":["æ—¥è®°","leetcode"],"categories":["å­¦ä¹ æ—¥è®°","2025-06"]},{"title":"æŠ€æœ¯æ´¾é¡¹ç›®ç¬”è®°","path":"/2025/06/04/é¡¹ç›®ç¬”è®°/æŠ€æœ¯æ´¾é¡¹ç›®ç¬”è®°/","content":"å¼€å¯æ–°é¡¹ç›®è¦è€ƒè™‘çš„äº‹æƒ…ä¸šåŠ¡æ¨¡å—æ‹†è§£é¦–å…ˆå¯¹ä¸šåŠ¡æ¨¡å—è¿›è¡Œæ‹†è§£ï¼Œé™¤äº†ä¸šåŠ¡å±æ€§çº¬åº¦ä»¥å¤–ï¼Œè¿˜æœ‰ä¸€ä¸ªå¾ˆé‡è¦çš„å±æ€§å°±æ˜¯å‚ä¸è€…è§’è‰²ã€‚ é¦–å…ˆå¯¹åŠŸèƒ½ã€æ¨¡å—åˆ’åˆ†ã€æ¦‚è¦è®¾è®¡ï¼Œè¯¦ç»†è®¾è®¡æœ‰åˆæ­¥çš„äº†è§£ã€‚ ä¸»è¦å°±æ˜¯åŠŸèƒ½æ¨¡å—è®¾è®¡ + DB çš„è®¾è®¡ã€‚ å¯åŠ¨é¡¹ç›®mysql å¯åŠ¨redis å¯åŠ¨ï¼šè·¯å¾„ ï¼š D:\\workTools\\Redis-x64-3.2.100 redis-server.exe redis.windows.conf å¯åŠ¨æˆåŠŸï¼Œç‚¹å‡»è¿›å…¥é¦–é¡µ: http://127.0.0.1:8080 è·‘ç¯å¢ƒD:\\sys\\Desktop\\Workplace\\IDEA_Projects\\paicodingä¸‹è½½ä½ç½® git clone git@github.com:itwanger/paicoding.git D:\\sys\\Desktop\\Workplace\\IDEA_Projects\\paicodinggit ä¸‹è½½ git clone å‡ºç°æŠ¥é”™ ï¼Œ åŸå› ï¼šgithub ssh ç§˜é’¥æ²¡æœ‰é…ç½® 1 æ‰“å¼€è¿è¡Œï¼Œè¾“å…¥services.mscï¼Œç¡®å®š æ‰¾åˆ° OpenSSH Authentication Agent æœåŠ¡ï¼Œéœ€å¼€å¯å®ƒ. ssh-keygen -t rsa -C â€œä½ çš„é‚®ç®±åœ°å€â€ æˆ‘ç”¨çš„æ˜¯Administratorç”¨æˆ·ï¼Œæ‰§è¡Œå®Œåï¼Œå¯ä»¥åœ¨ C:\\Users\\Administrator.ssh ç›®å½•ä¸‹ç”Ÿæˆ id_rsa å’Œ id_rsa.pub è¿™ä¸¤ä¸ªæ–‡ä»¶ã€‚å¦‚æœä½ æ²¡æœ‰ç”¨Administratorç”¨æˆ·ï¼Œä¹Ÿæ˜¯åœ¨ç±»ä¼¼çš„ç›®å½•ä¸‹ é¡¹ç›®ç»“æ„è¯¥é¡¹ç›®ä¸»è¦æœ‰äº”ä¸ªæ¨¡å—ï¼Œå„æ¨¡å—åŠŸèƒ½å¦‚ä¸‹ï¼š paicoding-apiï¼š ç”¨äºå®šä¹‰ä¸€äº›é€šç”¨çš„æšä¸¾ã€å®ä½“ç±»ï¼ŒåŒ…å« DOï¼ˆæ•°æ®å¯¹è±¡ï¼‰ã€DTOï¼ˆæ•°æ®ä¼ è¾“å¯¹è±¡ï¼‰ã€VOï¼ˆè§†å›¾å¯¹è±¡ï¼‰ç­‰ï¼Œä¸ºä¸åŒå±‚ä¹‹é—´çš„æ•°æ®äº¤äº’æä¾›ç»Ÿä¸€çš„æ ¼å¼å’Œè§„èŒƒã€‚ paicoding-coreï¼š æ ¸å¿ƒå·¥å…·å’Œç»„ä»¶ç›¸å…³çš„æ¨¡å—ï¼Œåƒå·¥å…·åŒ… util ä»¥åŠé€šç”¨çš„ç»„ä»¶éƒ½æ”¾åœ¨è¿™é‡Œã€‚æŒ‰ç…§åŒ…è·¯å¾„å¯¹æ¨¡å—åŠŸèƒ½è¿›è¡Œæ‹†åˆ†ï¼Œä¾‹å¦‚æœç´¢ã€ç¼“å­˜ã€æ¨èç­‰åŠŸèƒ½ç»„ä»¶ã€‚ paicoding-serviceï¼š æœåŠ¡æ¨¡å—ï¼Œè´Ÿè´£ä¸šåŠ¡ç›¸å…³çš„ä¸»è¦é€»è¾‘ï¼Œæ•°æ®åº“ï¼ˆDBï¼‰çš„æ“ä½œéƒ½åœ¨è¿™ä¸ªæ¨¡å—ä¸­è¿›è¡Œã€‚ paicoding-uiï¼š å­˜æ”¾ HTML å‰ç«¯èµ„æºï¼ŒåŒ…æ‹¬ JavaScriptã€CSSã€Thymeleaf ç­‰ï¼Œä¸»è¦ç”¨äºæ„å»ºç”¨æˆ·ç•Œé¢ã€‚ paicoding-webï¼š Web æ¨¡å—ï¼Œæ˜¯ HTTP è¯·æ±‚çš„å…¥å£ï¼Œä¹Ÿæ˜¯é¡¹ç›®å¯åŠ¨çš„å…¥å£ï¼ŒåŒæ—¶åŒ…å«æƒé™èº«ä»½æ ¡éªŒã€å…¨å±€å¼‚å¸¸å¤„ç†ç­‰åŠŸèƒ½ã€‚ web æ¨¡å—ï¼šadminï¼šadmin ç›®å½•å­˜æ”¾å’Œç®¡ç†åå°ç›¸å…³çš„ä»£ç ï¼Œä¸»è¦å¤„ç†ç®¡ç†å‘˜å¯¹ç³»ç»Ÿçš„ç®¡ç†æ“ä½œã€‚ commonï¼šcommon ä¸€èˆ¬ç”¨æ¥å­˜æ”¾é¡¹ç›®é€šç”¨çš„ä»£ç ï¼Œæé«˜ä»£ç çš„å¤ç”¨æ€§å’Œå¯ç»´æŠ¤æ€§ã€‚ comoinentï¼šTemplateEngineHelper Thymeleafæ¨¡ç‰ˆæ¸²æŸ“å¼•æ“ï¼Œé€šè¿‡æœ«ç­å¼•æ“è¿›è¡ŒæœåŠ¡ç«¯æ¸²æŸ“ï¼ˆSSRï¼‰ï¼Œåœ¨åˆæ¬¡æ¸²æŸ“é€Ÿåº¦æ–¹é¢æœ‰æ˜¾è‘—ä¼˜åŠ¿ã€‚ configForumDataSourceInitializer ç”¨æ¥è¿›è¡Œæ•°æ®åº“è¡¨çš„åˆå§‹åŒ–ï¼Œé¦–æ¬¡å¯åŠ¨æ—¶å€™æ‰§è¡Œï¼š DbChangeSetLoader æ‚é¡¹ç¬”è®°è¯·æ±‚å‚æ•°è§£æå¦‚æœä¸€ä¸ªè¯·æ±‚ä¸ä¼šå¼•èµ·æœåŠ¡å™¨ä¸Šä»»ä½•èµ„æºçš„çŠ¶æ€å˜åŒ–ï¼Œé‚£å°±å¯ä»¥ä½¿ç”¨ GET è¯·æ±‚ AOPæŠ€æœ¯æ´¾ä¸­çš„ AOP è®°å½•æ¥å£è®¿é—®æ—¥å¿—æ˜¯æ”¾åœ¨ paicoding-core æ¨¡å—ä¸‹çš„ mdc åŒ…ä¸‹ã€‚ ä¸‰å±‚æ¶æ„ä¸ºä»€ä¹ˆè¦ä½¿ç”¨å¾®æœåŠ¡è€Œä¸æ˜¯å•ä½“é¡¹ç›®å‘¢ï¼Ÿç”¨ä¸ç”¨å¾®æœåŠ¡å–å†³äºä¸šåŠ¡é‡ï¼Œèƒ½ç”¨å•ä½“çš„ç»å¯¹ä¸ç”¨å¾®æœåŠ¡ï¼Œæ¯•ç«Ÿå•ä½“çš„å¥½å¤„æ˜¾è€Œæ˜“è§ï¼Œå½“ä¸šåŠ¡ç®€å•çš„æ—¶å€™ï¼Œéƒ¨ç½²éå¸¸ç®€å•ï¼ŒæŠ€æœ¯æ¶æ„ä¹Ÿç®€å•ï¼Œä¸ç”¨è€ƒè™‘å¾®æœåŠ¡é—´çš„è°ƒç”¨ä»€ä¹ˆçš„ï¼Œä½†æ˜¯éšç€ä¸šåŠ¡çš„å¤æ‚ï¼Œå•ä½“çš„ç¼ºç‚¹ä¹Ÿå°±æš´éœ²å‡ºæ¥äº†ï¼Œä¾‹å¦‚ä¿®æ”¹ä¸€ä¸ªæ¨¡å—ä¸Šçº¿ï¼Œå°±è¦æ•´ä¸ªæœåŠ¡ä¸‹çº¿ï¼Œè¿™åœ¨æŸäº›ä¸šåŠ¡ä¸­æ˜¯ä¸è¢«å…è®¸çš„ï¼Œå…¶æ¬¡å•ä½“å¤æ‚åº¦é«˜äº†ï¼Œéƒ¨ç½²å°±ç¼“æ…¢äº†ï¼Œå‡ºç°é—®é¢˜æ’æŸ¥ä¹Ÿå¾ˆå›°éš¾ï¼Œè¿™äº›çš„å‰æå°±æ˜¯ä¸šåŠ¡å¤æ‚åº¦æé«˜äº†ã€‚ æ‰€ä»¥å¾®æœåŠ¡çš„å‡ºç°åœ¨æˆ‘çœ‹æ¥æœ€åˆå°±æ˜¯ä¸ºäº†è§£å†³ä¸šåŠ¡å¤æ‚å•ä½“æ‰€å‡ºç°çš„é—®é¢˜çš„ï¼Œå°†ä¸šåŠ¡æ‹†åˆ†åˆ°ä¸åŒçš„æ¨¡å—ï¼Œä¸åŒçš„æ¨¡å—å•ç‹¬éƒ¨ç½²å¼€å‘ï¼Œæé«˜äº†å¼€å‘æ•ˆç‡ï¼ŒèŠ‚çœäº†ç»´æŠ¤æ—¶é—´æˆæœ¬ï¼Œé—®é¢˜æ’æŸ¥ä¹Ÿæ–¹ä¾¿äº†å¾ˆå¤šï¼Œå¾®æœåŠ¡ä¹Ÿå¹¶ä¸æ˜¯æ²¡æœ‰ç¼ºç‚¹ï¼Œåªä¸è¿‡æ˜¯ç»´æŠ¤ä¸€ä¸ªå¹³è¡¡ï¼Œä¾‹å¦‚éœ€è¦å¼•å…¥æ³¨å†Œä¸­å¿ƒï¼Œä¸ºäº†æ–¹ä¾¿é…ç½®çš„ä¿®æ”¹ï¼Œè¿˜éœ€è¦å¼•å…¥é…ç½®ä¸­å¿ƒï¼Œä¸å¯èƒ½ä¿®æ”¹ä¸€ä¸ªé…ç½®é‡æ–°æ‰“åŒ…å‘å¸ƒï¼ŒæœåŠ¡é—´çš„è°ƒç”¨ç»„ä»¶ï¼Œå¾ˆå¤šéƒ½æ˜¯ä¸ºäº†ä½¿ç”¨å¾®æœåŠ¡è€Œå¼•å…¥çš„ã€‚ æ‰€ä»¥æ²¡æœ‰å“ªç§æŠ€æœ¯æ›´å¥½ï¼Œåªæœ‰å“ªç§æŠ€æœ¯æ›´ç¬¦åˆå½“ä¸‹çš„ä¸šåŠ¡ï¼ŒæŠ›å¼€ä¸šåŠ¡è°ˆæŠ€æœ¯ï¼Œåœ¨æˆ‘çœ‹æ¥å¹¶ä¸æ˜¯é‚£ä¹ˆå¯é ã€‚ å·¥å‚æ¨¡å¼åˆ›å»ºå‹è®¾è®¡æ¨¡å¼ï¼Œå®šä¹‰ä¸€ä¸ªåˆ›å»ºå¯¹è±¡çš„æ¥å£ï¼Œä½†è®©å®ç°è¿™ä¸ªæ¥å£çš„ç±»å†³å®šå®ä¾‹åŒ–å“ªä¸ªç±»ã€‚ å·¥å‚æ–¹æ³•æŠŠç±»çš„å®ä¾‹åŒ–å»¶è¿Ÿåˆ°å­ç±»ä¸­è¿›è¡Œã€‚ @Bean å°±æ˜¯ä¸€ä¸ªå·¥å‚æ–¹æ³• å„ç§æ³¨è§£@Slf4j@Slf4jï¼šå€ŸåŠ© Lombok è‡ªåŠ¨æ·»åŠ  SLF4J æ—¥å¿—è®°å½•å™¨ï¼Œç®€åŒ–æ—¥å¿—è®°å½•ä»£ç ã€‚ @Value@Configuration@Configurationï¼šæŠŠç±»æ ‡è®°ä¸º Spring é…ç½®ç±»ï¼Œå…è®¸åœ¨ç±»é‡Œä½¿ç”¨ @Bean æ³¨è§£å®šä¹‰ Spring Beanã€‚ åœ¨ Spring åº”ç”¨å¯åŠ¨æ—¶ï¼ŒSpring ä¼šæ‰«æå¸¦æœ‰ @Configuration æ³¨è§£çš„ç±»ï¼Œå°†å…¶ä½œä¸ºé…ç½®ç±»æ¥å¤„ç†ï¼ŒæŠŠç±»é‡Œä½¿ç”¨ @Bean æ³¨è§£å®šä¹‰çš„æ–¹æ³•è¿”å›çš„å¯¹è±¡æ³¨å†Œåˆ° Spring å®¹å™¨ä¸­ã€‚ @Component@Componentï¼šé€šç”¨çš„ç»„ä»¶æ³¨è§£ï¼Œç”¨äºæ ‡è®°ä¸€ä¸ªç±»ä¸º Spring ç»„ä»¶ï¼ŒSpring ä¼šè‡ªåŠ¨æ‰«æå¹¶å°†å…¶æ³¨å†Œåˆ°å®¹å™¨ä¸­ã€‚ @Service@Serviceï¼š@Component çš„ç‰¹æ®ŠåŒ–æ³¨è§£ï¼Œé€šå¸¸ç”¨äºæ ‡è®°æœåŠ¡å±‚ç±»ã€‚ @Repository@Repositoryï¼š@Component çš„ç‰¹æ®ŠåŒ–æ³¨è§£ï¼Œé€šå¸¸ç”¨äºæ ‡è®°æ•°æ®è®¿é—®å±‚ç±»ã€‚ @Controller@Controllerï¼š@Component çš„ç‰¹æ®ŠåŒ–æ³¨è§£ï¼Œé€šå¸¸ç”¨äºæ ‡è®° Web æ§åˆ¶å™¨ç±»ã€‚ @Bean@Beanæ³¨å†Œä¸€ä¸ªå®ä½“ç±» @å†Œä¸€ä¸ªå®ä½“ç±» å®ä½“å¯¹è±¡ ç”¨ GET è¿˜æ˜¯ POSTGET - ä»æŒ‡å®šçš„èµ„æºè¯·æ±‚æ•°æ®ã€‚POST - å‘æŒ‡å®šçš„èµ„æºæäº¤è¦è¢«å¤„ç†çš„æ•°æ®ã€‚ GET è¯·æ±‚æ˜¯ HTTP åè®®ä¸­çš„ä¸€ç§è¯·æ±‚æ–¹æ³•ï¼Œé€šå¸¸ç”¨äºè¯·æ±‚è®¿é—®æŒ‡å®šçš„èµ„æºã€‚å¦‚æœä¸€ä¸ªè¯·æ±‚ä¸ä¼šå¯¼è‡´æœåŠ¡å™¨ä¸Šä»»ä½•èµ„æºçš„çŠ¶æ€å˜åŒ–ï¼Œé‚£ä½ å°±å¯ä»¥ä½¿ç”¨ GET è¯·æ±‚ã€‚ Filterè¿‡æ»¤å™¨ é¦–å…ˆè¿›å…¥ filterï¼Œæ‰§è¡Œç›¸å…³ä¸šåŠ¡é€»è¾‘ è‹¥åˆ¤å®šé€šè¡Œï¼Œåˆ™è¿›å…¥ Servlet é€»è¾‘ï¼ŒServlet æ‰§è¡Œå®Œæ¯•ä¹‹åï¼Œåˆè¿”å› Filterï¼Œæœ€ååœ¨è¿”å›ç»™è¯·æ±‚æ–¹ åˆ¤å®šå¤±è´¥ï¼Œç›´æ¥è¿”å›ï¼Œä¸éœ€è¦å°†è¯·æ±‚å‘ç»™ Servlet è¿‡æ»¤å™¨çš„ä½¿ç”¨å¦‚æœè¦ä½¿ç”¨è¿‡æ»¤å™¨ï¼Œå®ç° Filter æ¥å£ï¼Œéœ€è¦é‡å†™ doFilter æ–¹æ³•ï¼Œåœ¨æ–¹æ³•ä¸­ç¼–å†™è¿‡æ»¤é€»è¾‘ã€‚init: åˆå§‹åŒ–æ—¶æ‰§è¡Œdestory: é”€æ¯æ—¶æ‰§è¡ŒdoFilter: é‡ç‚¹å…³æ³¨è¿™ä¸ªï¼Œfilter è§„åˆ™å‘½ä¸­çš„è¯·æ±‚ï¼Œéƒ½ä¼šèµ°è¿›æ¥ä¸‰ä¸ªå‚æ•°ï¼Œæ³¨æ„ç¬¬ä¸‰ä¸ª FilterChainï¼Œè¿™é‡Œæ˜¯ç»å…¸çš„è´£ä»»é“¾è®¾è®¡æ¨¡å¼æ‰§è¡Œ filterChain.doFilter(servletRequest, servletResponse) è¡¨ç¤ºä¼šç»§ç»­å°†è¯·æ±‚æ‰§è¡Œä¸‹å»ï¼›è‹¥ä¸æ‰§è¡Œè¿™ä¸€å¥ï¼Œè¡¨ç¤ºè¿™ä¸€æ¬¡çš„ http è¯·æ±‚åˆ°æ­¤ä¸ºæ­¢äº†ï¼Œåé¢çš„èµ°ä¸ä¸‹å»äº† è¿‡æ»¤å™¨åœ¨é¡¹ç›®ä¸­çš„åº”ç”¨ èº«ä»½è¯†åˆ«,å¹¶ä¿å­˜èº«ä»½åˆ°ReqInfoContextä¸Šä¸‹æ–‡ä¸­ è®°å½•è¯·æ±‚è®°å½• æ·»åŠ è·¨åŸŸæ”¯æŒ è·¨åŸŸé—®é¢˜:è·¨åŸŸé—®é¢˜ï¼ˆCORSï¼‰çš„æœ¬è´¨æ˜¯æµè§ˆå™¨çš„å®‰å…¨é™åˆ¶ï¼Œè€Œä»£ç†æœåŠ¡å™¨æ˜¯è§£å†³è¯¥é—®é¢˜çš„å…³é”®æ–¹æ¡ˆä¹‹ä¸€ã€‚ä»¥ä¸‹é€šè¿‡â€‹â€‹åœºæ™¯åŒ–è§£æâ€‹â€‹å¸®ä½ å½»åº•ç†è§£ä»£ç†æœºåˆ¶. å‡å¦‚è¯´:å‰ç«¯â€‹â€‹ï¼šè¿è¡Œåœ¨ http://localhost:5700â€‹â€‹åç«¯â€‹â€‹ï¼šè¿è¡Œåœ¨ http://localhost:8080â€‹â€‹é—®é¢˜â€‹â€‹ï¼šå‰ç«¯ç›´æ¥è¯·æ±‚åç«¯æ¥å£æ—¶ï¼Œæµè§ˆå™¨ä¼šæ‹¦æˆªå¹¶æŠ¥é”™ï¼š ä»£ç†ä¸æœåŠ¡å™¨é—´çš„é€šä¿¡å±äºæœåŠ¡å™¨ä¹‹é—´çš„é€šä¿¡,ä¸å—æµè§ˆå™¨åŒæºè§„åˆ™çš„çº¦æŸ. ServletServletçš„ä½¿ç”¨å§¿åŠ¿ï¼Œä»¥åŠæ³¨å†Œè‡ªå®šä¹‰çš„Serveltçš„å››ç§å§¿åŠ¿ â— @WebServlet æ³¨è§£:åœ¨è‡ªå®šä¹‰çš„servletä¸Šæ·»åŠ Servlet3+çš„æ³¨è§£@WebServletï¼Œæ¥å£°æ˜è¿™ä¸ªç±»æ˜¯ä¸€ä¸ªServletå’ŒFitlerçš„æ³¨å†Œæ–¹å¼ä¸€æ ·ï¼Œä½¿ç”¨è¿™ä¸ªæ³¨è§£ï¼Œéœ€è¦é…åˆSpring Bootçš„@ServletComponentScanï¼Œå¦åˆ™å•çº¯çš„æ·»åŠ ä¸Šé¢çš„æ³¨è§£å¹¶ä¸ä¼šç”Ÿæ•ˆ /** * ä½¿ç”¨æ³¨è§£çš„æ–¹å¼æ¥å®šä¹‰å¹¶æ³¨å†Œä¸€ä¸ªè‡ªå®šä¹‰Servlet */@WebServlet(urlPatterns = /annotation)public class AnnotationServlet extends HttpServlet @Override protected void doGet(HttpServletRequest req, HttpServletResponse resp) throws ServletException, IOException String name = req.getParameter(name); PrintWriter writer = resp.getWriter(); writer.write([AnnotationServlet] welcome + name); writer.flush(); writer.close(); è¿˜éœ€è¦é…ç½®å¯åŠ¨ç±» @ServletComponentScan@SpringBootApplicationpublic class Application public static void main(String[] args) SpringApplication.run(Application.class); â— ServletRegistrationBean beanå®šä¹‰åœ¨Filterçš„æ³¨å†Œä¸­ï¼Œæˆ‘ä»¬çŸ¥é“æœ‰ä¸€ç§æ–¹å¼æ˜¯å®šä¹‰ä¸€ä¸ªSpringçš„BeanFilterRegistrationBeanæ¥åŒ…è£…æˆ‘ä»¬çš„è‡ªå®šä¹‰Filterï¼Œä»è€Œè®©Springå®¹å™¨æ¥ç®¡ç†æˆ‘ä»¬çš„è¿‡æ»¤å™¨ï¼›åŒæ ·çš„åœ¨Servletä¸­ï¼Œä¹Ÿæœ‰ç±»ä¼¼çš„åŒ…è£…bean: ServletRegistrationBeanè‡ªå®šä¹‰çš„beanå¦‚ä¸‹ï¼Œæ³¨æ„ç±»ä¸Šæ²¡æœ‰ä»»ä½•æ³¨è§£: public class RegisterBeanServlet extends HttpServlet @Override protected void doGet(HttpServletRequest req, HttpServletResponse resp) throws ServletException, IOException String name = req.getParameter(name); PrintWriter writer = resp.getWriter(); writer.write([RegisterBeanServlet] welcome + name); writer.flush(); writer.close(); æ¥ä¸‹æ¥æˆ‘ä»¬éœ€è¦å®šä¹‰ä¸€ä¸ªServletRegistrationBeanï¼Œè®©å®ƒæŒæœ‰RegisterBeanServletçš„å®ä¾‹ @Beanpublic ServletRegistrationBean servletBean() ServletRegistrationBean registrationBean = new ServletRegistrationBean(); registrationBean.addUrlMappings(/register); registrationBean.setServlet(new RegisterBeanServlet()); return registrationBean; â— ServletContext åŠ¨æ€æ·»åŠ è¿™ç§å§¿åŠ¿ï¼Œåœ¨å®é™…çš„Servletæ³¨å†Œä¸­ï¼Œå…¶å®ç”¨å¾—å¹¶ä¸å¤ªå¤šï¼Œä¸»è¦æ€è·¯æ˜¯åœ¨ServletContextåˆå§‹åŒ–åï¼Œå€ŸåŠ©javax.servlet.ServletContext#addServlet(java.lang.String, java.lang.Class? extends javax.servlet.Servlet)æ–¹æ³•æ¥ä¸»åŠ¨æ·»åŠ ä¸€ä¸ªServlet æ‰€ä»¥æˆ‘ä»¬éœ€è¦æ‰¾ä¸€ä¸ªåˆé€‚çš„æ—¶æœºï¼Œè·å–ServletContextå®ä¾‹ï¼Œå¹¶æ³¨å†ŒServletï¼Œåœ¨SpringBootç”Ÿæ€ä¸‹ï¼Œå¯ä»¥å€ŸåŠ©ServletContextInitializer public class ContextServlet extends HttpServlet @Override protected void doGet(HttpServletRequest req, HttpServletResponse resp) throws ServletException, IOException String name = req.getParameter(name); PrintWriter writer = resp.getWriter(); writer.write([ContextServlet] welcome + name); writer.flush(); writer.close(); @Componentpublic class SelfServletConfig implements ServletContextInitializer @Override public void onStartup(ServletContext servletContext) throws ServletException ServletRegistration initServlet = servletContext.addServlet(contextServlet, ContextServlet.class); initServlet.addMapping(/context);","tags":["é¡¹ç›®","æŠ€æœ¯æ´¾"],"categories":["é¡¹ç›®ç¬”è®°"]},{"title":"ä¸ªäººåšå®¢æ­å»º","path":"/2025/06/02/æ‚é¡¹ç¬”è®°/ä¸ªäººåšå®¢æ­å»º/","content":"ç¯å¢ƒé…ç½®: node -v #æŸ¥çœ‹nodeç‰ˆæœ¬npm -v #æŸ¥çœ‹npmç‰ˆæœ¬ å¯ä»¥ä½¿ç”¨nvmæ¥ç®¡ç†nodeç‰ˆæœ¬ å®‰è£… hexo: npm install hexo-cli -g å‡ºç°æƒé™é—®é¢˜ ,ä¿®æ”¹: sudo chown -R $(whoami) $(npm config get prefix)/lib/node_modules,bin,share #ä¿®æ”¹æƒé™èŒƒå›´ åˆå§‹åŒ–ä¸ªäººåšå®¢æ–‡ä»¶å¤¹: hexo init /Users/mac/Blog/JakicDong.github.io # åšå®¢åˆå§‹åŒ–ï¼Œè¿™é‡Œæ˜¯åˆ›å»ºçš„æœ¬åœ°åšå®¢æ–‡ä»¶å¤¹ï¼Œæ‰§è¡Œåä¼šè‡ªåŠ¨åˆ›å»ºï¼Œæˆ‘è¿™é‡Œå›¾ç®€æ´ï¼Œç›´æ¥ç”¨äº†æˆ‘ç½‘ç«™çš„åœ°å€ hihulu.github.io ä¸ºæ–‡ä»¶åcd /Users/mac/Blog/JakicDong.github.io # è¿›å…¥æœ¬åœ°çš„åšå®¢æ–‡ä»¶å¤¹hexo server # æ‰“å¼€æœ¬åœ°æœåŠ¡å™¨é¢„è§ˆ UsersmacJakicDong.github.io 4.Githubéƒ¨ç½²ä¸ºäº†éƒ¨ç½²åˆ°Githubä¸Šï¼Œéœ€è¦å®‰è£…hexo-deployer-gitæ’ä»¶ï¼Œå‘½ä»¤å¦‚ä¸‹ï¼š sudo npm install hexo-deployer-git --save ç„¶åæ‰¾åˆ°è‡ªå·±çš„æœ¬åœ°åšå®¢æ–‡ä»¶å¤¹ï¼Œä¿®æ”¹åšå®¢æ ¹ç›®å½•ä¸‹çš„_config.ymlæ–‡ä»¶ä¸­çš„deployï¼Œä¿®æ”¹æˆï¼š deploy: type: git repo: git@github.com:JakicDong/JakicDong.github.io.git #è¿™ä¸ªåœ°å€æ˜¯ä»githubä»“åº“å¤åˆ¶è¿‡æ¥çš„ssh branch: main ï¼ˆâš ï¸æ³¨æ„ï¼Œè¿™é‡Œæœ‰ä¸€ä¸ªå¾ˆå®¹æ˜“çŠ¯é”™çš„ç‚¹ï¼Œæˆ‘ä»¬åœ¨åˆ›å»ºâ€œhihulu.github.ioâ€è¿™ä¸ªä»“åº“çš„æ—¶å€™ï¼Œä¸€å®šè¦åˆ›å»ºå’Œä½ githubç”¨æˆ·åç›¸åŒçš„ä»“åº“ï¼Œåé¢åŠ .http://github.ioï¼Œåªæœ‰è¿™æ ·ï¼Œå°†æ¥è¦éƒ¨ç½²åˆ°GitHub pageçš„æ—¶å€™ï¼Œæ‰ä¼šè¢«è¯†åˆ«ï¼Œä¹Ÿå°±æ˜¯http://xxxx.github.ioï¼Œå…¶ä¸­xxxå°±æ˜¯ä½ æ³¨å†ŒGitHubçš„ç”¨æˆ·åã€‚æ‰€ä»¥ä¸Šå›¾æˆ‘çš„ä»“åº“æ˜¾ç¤ºçš„æ˜¯â€œhihuluhihulu.github.ioâ€ï¼Œå¦‚æœä»“åº“åå’Œç”¨æˆ·åä¸ä¸€è‡´ï¼Œåé¢æ˜¯æ ¹æœ¬æ‰“ä¸å¼€è¿™ä¸ªç½‘ç«™çš„ï½ï¼‰ ç„¶åå°±å¯ä»¥é€šè¿‡ä»¥ä¸‹å‘½ä»¤è¡Œä¸Šä¼ githubäº† hexo g #hexo generateçš„ç®€å†™ï¼Œå³æŠŠåˆšåˆšåšçš„æ”¹åŠ¨ç”Ÿæˆæ›´æ–°ä¸€ä¸‹hexo d #hexo deployï¼Œä¸Šä¼ åˆ°githubç½‘ç«™ è¿˜æœ‰ä¸€äº›å¸¸ç”¨çš„å‘½ä»¤è¡Œï¼š hexo clean #æ¸…ç©ºä¸€ä¸‹ç¼“å­˜ï¼Œæœ‰æ—¶å€™åšå®¢é¡µé¢æ˜¾ç¤ºä¸æ­£å¸¸ä¹Ÿå¯ä»¥è¯•è¯•è¿™ä¸ªå‘½ä»¤è¡Œhexo server # åœ¨æœ¬åœ°æœåŠ¡å™¨è¿è¡Œï¼Œç½‘å€é»˜è®¤https://localhost:4000 5.æ›´æ”¹ä¸»é¢˜å¾ˆå¤šå‰ç«¯å¤§ç‰›åšä¸»è®¾è®¡äº†å¾ˆå¤šå¥½çœ‹çš„ä¸»é¢˜ï¼Œç½‘å€https://hexo.io/themes/ ï¼Œå¯ä»¥é¢„è§ˆå¹¶é€‰æ‹©ä½ å–œçˆ±çš„ä¸»é¢˜è¿›è¡Œåº”ç”¨ã€‚ è¿™é‡Œæµ…ä»¥ä¸€ä¸ªè›®ç«çš„ä¸»é¢˜butterflyä¸»é¢˜æ¥èµ°ä¸€ä¸ªå®‰è£…ä¸»é¢˜çš„æ­¥éª¤ï½ æ‰§è¡Œä»¥ä¸‹ä»£ç ï¼š git clone -b master https://github.com/jerryc127/hexo-theme-butterfly.git themes/butterfly è¿è¡ŒæˆåŠŸä¹‹åï¼Œåœ¨é¡¹ç›®æ–‡ä»¶å¤¹æ ¹ç›®å½•ä¸­å¯ä»¥æŸ¥çœ‹åˆ°æ–°çš„ä¸»é¢˜themesæ–‡ä»¶å¤¹ï¼šbutterfly åœ¨åšå®¢çš„é¡¹ç›®æ–‡ä»¶å¤¹ä¸‹ï¼Œä¿®æ”¹_config.ymlé…ç½®æ–‡ä»¶å¦‚ä¸‹: # theme: landscape é»˜è®¤ä¸»é¢˜theme: butterfly æ­¤æ—¶ä¸»é¢˜è¿˜ä¸èƒ½æ­£å¸¸é…ç½®ä½¿ç”¨ï¼Œéœ€è¦å®‰è£…pug ä»¥åŠstylus çš„æ¸²æŸ“å™¨ï¼š npm install hexo-renderer-pug hexo-renderer-stylus --save æœ€åæ¨é€åˆ°github # æ¸…é™¤ç¼“å­˜b.json å’Œå·²ç”Ÿæˆçš„é™æ€æ–‡ä»¶ publichexo clean# ç”Ÿæˆé™æ€é¡µé¢åˆ°é»˜è®¤è®¾ç½®çš„ public æ–‡ä»¶å¤¹hexo g# éƒ¨ç½²åˆ°è®¾å®šçš„ä»“åº“æˆ–ä¸Šä¼ éƒ¨ç½²è‡³æœåŠ¡ç«¯hexo d è‡³æ­¤ä¸»é¢˜å®‰è£…endï¼Œå¯è®¿é—®https://hihulu.github.io/ æŸ¥çœ‹ï½ https://JakicDong.github.io/ # 7.4 å¸¸ç”¨å‘½ä»¤hexo new name # æ–°å»ºæ–‡ç« hexo new page name # æ–°å»ºé¡µé¢hexo g # ç”Ÿæˆé¡µé¢hexo d # éƒ¨ç½²hexo g -d # ç”Ÿæˆé¡µé¢å¹¶éƒ¨ç½²hexo s # æœ¬åœ°é¢„è§ˆhexo clean # æ¸…é™¤ç¼“å­˜å’Œå·²ç”Ÿæˆçš„é™æ€æ–‡ä»¶hexo help # å¸®åŠ©","tags":["åšå®¢","hexo"],"categories":["æ‚é¡¹ç¬”è®°"]},{"title":"ç®—æ³•å­¦ä¹ ç¬”è®°","path":"/2025/06/01/ç®—æ³•ç¬”è®°/ç®—æ³•é¢˜åˆ·é¢˜ç¬”è®°/","content":"ç®—æ³•ç¬”è®°ä¸€äº›å¥½çš„é€»è¾‘æ€è·¯åé—®é¢˜å¦‚æœä¸€ä¸ªé—®é¢˜æ­£é—®é¢˜å¾ˆå¤æ‚,å¯ä»¥å°è¯•æƒ³ä¸€ä¸‹åé—®é¢˜,æ¯”å¦‚æ±‚æœ‰æ°å¥½kä¸ªç›¸é‚»æ•°çš„æ•°ç»„ä¸ªæ•°,æ­£é—®é¢˜å¾ˆå¤æ‚,ä½†æ˜¯åé—®é¢˜åªéœ€è¦æ‰¾åˆ°n-k-1ä¸ªåˆ†å‰²çº¿,æŠŠæ•°ç»„åˆ†å‰²æˆn-kå—.3405. ç»Ÿè®¡æ°å¥½æœ‰ K ä¸ªç›¸ç­‰ç›¸é‚»å…ƒç´ çš„æ•°ç»„æ•°ç›® å­é—®é¢˜å¦‚æœä¸€ä¸ªå¤§çš„é—®é¢˜å¯ä»¥åˆ†è§£æˆå¤šä¸ªå­é—®é¢˜,å¯ä»¥å°è¯•å…ˆè§£å†³å­é—®é¢˜,å†è§£å†³å¤§é—®é¢˜.è¿™å°±å¯ä»¥ç”¨é€’å½’æˆ–åŠ¨æ€è§„åˆ’çš„æ–¹æ³•æ¥è§£å†³. ACM æ ¼å¼import java.util.*;import java.io.*;public class Main public static void main(String[] args) throws IOException BufferedReader br = new BufferedReader(new InputStreamReader(System.in)); PrintWriter pw = new PrintWriter(System.out); int n = Integer.parseInt(br.readLine()); String[] times = br.readLine().split( ); long prev = parseTime(times[0]); for (int i = 1; i n; i++) long current = parseTime(times[i]); long diff = current - prev; if (diff 0) diff += 24 * 60 * 60; double circles = diff / 60.0; pw.printf(%.2f , circles); prev = current; pw.flush(); private static long parseTime(String time) String[] parts = time.split(:); int hour = Integer.parseInt(parts[0]); int minute = Integer.parseInt(parts[1]); int second = Integer.parseInt(parts[2]); return hour * 3600L + minute * 60L + second; import java.util.*;import java.io.*;public class Main public static void main(String[] args) throws IOException BufferedReader br = new BufferedReader(new InputStreamReader(System.in)); String line; while ((line = br.readLine()) != null) // é€è¡Œè¯»å– int n = Integer.parseInt(line.trim()); int[] nums = new int[n]; String[] parts = br.readLine().split( ); for (int i = 0; i n; i++) nums[i] = Integer.parseInt(parts[i]); // å¤„ç†é€»è¾‘ // è¾“å‡ºç»“æœ System.out.println(result); public static void main(String[] args) Scanner scanner = new Scanner(System.in); String s = scanner.next(); System.out.println(replaceNumber(s)); scanner.close(); ç¬¬äºŒç§: import java.util.*;import java.io.*;public static void main(String[] args) Scanner scanner = new Scanner(System.in); String s = scanner.next(); System.out.println(replaceNumber(s)); scanner.close(); æ‚é¡¹æ“ä½œç»å¯¹å€¼:Math.abs();Intæœ€å¤§å€¼:Integer.MAX_VALUEå‰å¯¼é›¶:Integer.numberOfLeadingZeros(k); å–éšæœºå€¼ï¼š import java.util.Random;import java.util.concurrent.ThreadLocalRandom;public class RandomDemo public static void main(String[] args) int n = 10; //0~9 // æ–¹æ³•1: Math.random() int random1 = (int) (Math.random() * n); System.out.println(Math.random(): + random1); // æ–¹æ³•2: Randomç±» Random rand = new Random(); int random2 = rand.nextInt(n); System.out.println(Random: + random2); // æ–¹æ³•3: ThreadLocalRandomï¼ˆå¤šçº¿ç¨‹å®‰å…¨ï¼‰ int random3 = ThreadLocalRandom.current().nextInt(n); System.out.println(ThreadLocalRandom: + random3); Array å¸¸ç”¨æ“ä½œ// ========== æ•°ç»„å£°æ˜ä¸åˆå§‹åŒ– ==========int[] arr = new int[5]; // åˆ›å»ºç©ºæ•°ç»„ [0,0,0,0,0]int[] nums = 3,1,4,5,2; // ç›´æ¥åˆå§‹åŒ–String[] strArr = A, B, C; // å­—ç¬¦ä¸²æ•°ç»„int[][] matrix = 1,2, 3,4,5; // äºŒç»´æ•°ç»„// ========== åŸºæœ¬æ“ä½œ ==========// è®¿é—®å…ƒç´ int first = nums[0]; nums[2] = 9; // è·å–é•¿åº¦int len = nums.length; // ä¸€ç»´æ•°ç»„é•¿åº¦ â†’ 5int cols = matrix[1].length; // äºŒç»´æ•°ç»„ç¬¬äºŒç»´é•¿åº¦ â†’ 3// ========== éå†æ“ä½œ ==========// æ™®é€šforå¾ªç¯for(int i=0; inums.length; i++) System.out.print(nums[i] + ); // 3 1 9 5 2// å¢å¼ºforå¾ªç¯for(int num : nums) System.out.print(num + );// äºŒç»´æ•°ç»„éå†for(int[] row : matrix) for(int n : row) System.out.print(n + ); // 1 2 / 3 4 5 // ========== æ•°ç»„å·¥å…·æ“ä½œ ==========// ========== æ’åºæ“ä½œ ==========//å‡åºæ’åºArrays.sort(array);//é™åºæ’åºArrays.sort(Collections.reverseOrder());// å¤åˆ¶int[] copy1 = Arrays.copyOf(nums, 3); // å¤åˆ¶å‰3å…ƒç´  â†’ [1,2,3]int[] copy2 = Arrays.copyOfRange(nums, 1, 4); // å¤åˆ¶1-3ç´¢å¼• â†’ [2,3,5]// æ¯”è¾ƒboolean isEqual = Arrays.equals(nums, copy1); // false// å¡«å……Arrays.fill(nums, 0); // å…¨éƒ¨å¡«å……0 â†’ [0,0,0,0,0]Arrays.fill(nums, 1, 3, 5); // ç´¢å¼•1-2å¡«å……5 â†’ [0,5,5,0,0]// ========== ç±»å‹è½¬æ¢ ==========// æ•°ç»„è½¬Listï¼ˆå›ºå®šå¤§å°ï¼‰ListInteger list = Arrays.asList(1,2,3); // æ•°ç»„è½¬StreamIntStream stream = Arrays.stream(nums);// ========== å…¶ä»–æ“ä½œ ==========// äºŒåˆ†æŸ¥æ‰¾ï¼ˆéœ€å…ˆæ’åºï¼‰int index = Arrays.binarySearch(nums, 5); // è¿”å›å…ƒç´ ç´¢å¼•// å¤šç»´æ•°ç»„æ“ä½œint[][] matrixCopy = Arrays.copyOf(matrix, matrix.length); // æµ…æ‹·è´String deepStr = Arrays.deepToString(matrix); // [[1, 2], [3, 4, 5]]// åè½¬æ•°ç»„for(int i=0; inums.length/2; i++) int temp = nums[i]; nums[i] = nums[nums.length-1-i]; nums[nums.length-1-i] = temp; æ•°ç»„å¸¦ç€ç´¢å¼•æ’åºä¾‹é¢˜ public int[] maxSubsequence(int[] nums, int k) int n=nums.length; int ans[]=new int[k]; Integer idx[]=new Integer[n]; Arrays.setAll(idx, i-i); Arrays.sort(idx,(a,b)-nums[a]-nums[b]); int j=0; for(int i=n-k;in;i++) ans[j++]=idx[i]; Arrays.sort(ans); for(int i=0;ik;i++) ans[i]=nums[ans[i]]; return ans; å’Œ int æ•°ç»„ç›¸äº’è½¬æ¢ï¼š Integer[] arr = 1,2,3;ArrayListInteger list = new ArrayList(Arrays.asList(arr));ArrayListInteger list = new ArrayList();Integer[] arr = list.toArray(new Integer[0]);//ä½†æ˜¯å¦‚ä½•è½¬æˆint[]æ•°ç»„å‘¢//æ–¹æ³•1 arr = list.stream().mapToInt(Integer::valueOf).toArray(); List å¸¸ç”¨æ“ä½œ// ====================== 1. åˆå§‹åŒ– List ======================ListString arrayList = new ArrayList(); // å¯ä¿®æ”¹åˆ—è¡¨ListInteger linkedList = new LinkedList(); ListString immutableList = List.of(A, B, C); // Java9+ ä¸å¯å˜åˆ—è¡¨// ====================== 2. æ·»åŠ å…ƒç´  ======================arrayList.add(Apple); // æœ«å°¾æ·»åŠ arrayList.add(0, Banana); // ç´¢å¼•0æ’å…¥arrayList.addAll(List.of(Orange, Grape)); // æ‰¹é‡æ·»åŠ // ====================== 3. è®¿é—®å…ƒç´  ======================String firstElement = arrayList.get(0); // Bananaboolean containsApple = arrayList.contains(Apple); // trueint indexOfOrange = arrayList.indexOf(Orange); // 2// ====================== 4. åˆ é™¤å…ƒç´  ======================arrayList.remove(Banana); // æŒ‰å€¼åˆ é™¤arrayList.remove(0); // æŒ‰ç´¢å¼•åˆ é™¤arrayList.clear(); // æ¸…ç©ºåˆ—è¡¨// ====================== 5. ä¿®æ”¹å…ƒç´  ======================arrayList.add(Mango);arrayList.set(0, Pineapple); // ä¿®æ”¹ç´¢å¼•0çš„å…ƒç´ // ====================== 6. éå† List ======================Collections.sort(path); // ç›´æ¥ä¿®æ”¹åŸList// æ–¹å¼1: æ™®é€šforå¾ªç¯for (int i = 0; i arrayList.size(); i++) System.out.println(arrayList.get(i));// æ–¹å¼2: å¢å¼ºforå¾ªç¯for (String fruit : arrayList) System.out.println(fruit);// æ–¹å¼3: è¿­ä»£å™¨IteratorString it = arrayList.iterator();while (it.hasNext()) System.out.println(it.next());// æ–¹å¼4: forEach + LambdaarrayList.forEach(System.out::println);// ====================== 7. å…¶ä»–æ“ä½œ ======================int size = arrayList.size(); // åˆ—è¡¨é•¿åº¦boolean isEmpty = arrayList.isEmpty(); // æ˜¯å¦ä¸ºç©ºListString subList = arrayList.subList(0, 2); // æˆªå–å­åˆ—è¡¨Object[] array = arrayList.toArray(); // è½¬ä¸ºæ•°ç»„// ====================== 8. æ³¨æ„äº‹é¡¹ ======================/*1. ArrayListåˆå§‹å®¹é‡10ï¼Œæ‰©å®¹1.5å€ 2. LinkedListç”¨èŠ‚ç‚¹é“¾æ¥å®ç°3. çº¿ç¨‹ä¸å®‰å…¨ï¼Œå¤šçº¿ç¨‹ç¯å¢ƒä½¿ç”¨ï¼šListString syncList = Collections.synchronizedList(new ArrayList());4. å¿«é€Ÿå¤±è´¥æœºåˆ¶(fast-fail)ï¼šéå†æ—¶ä¿®æ”¹ä¼šæŠ›å‡ºConcurrentModificationException*/ äºŒç»´Listä¾‹å­ import java.util.ArrayList;import java.util.Arrays;import java.util.List;public class TwoDListExample public static void main(String[] args) // ====================== // 1. åˆ›å»ºäºŒç»´List // ====================== ListInteger[] ls = new ArrayList[26]; Arrays.setAll(ls,i-new ArrayList()); // æ–¹æ³•1: ä½¿ç”¨Arrays.asList()åˆå§‹åŒ– ListListInteger matrix1 = new ArrayList(); matrix1.add(Arrays.asList(1, 2, 3)); matrix1.add(Arrays.asList(4, 5, 6)); matrix1.add(Arrays.asList(7, 8, 9)); // æ–¹æ³•2: åŠ¨æ€åˆ›å»ºç©ºäºŒç»´List ListListString matrix2 = new ArrayList(); // æ–¹æ³•3: ä½¿ç”¨åµŒå¥—å¾ªç¯åˆå§‹åŒ– ListListCharacter matrix3 = new ArrayList(); for (int i = 0; i 3; i++) ListCharacter row = new ArrayList(); for (int j = 0; j 4; j++) row.add((char) (A + i + j)); matrix3.add(row); // ====================== // 2. æ·»åŠ å…ƒç´  // ====================== // æ·»åŠ æ–°è¡Œ matrix2.add(new ArrayList(Arrays.asList(Java, Python))); matrix2.add(new ArrayList(Arrays.asList(C++, JavaScript))); // åœ¨æŒ‡å®šè¡Œæ·»åŠ å…ƒç´  matrix2.get(0).add(Ruby); // ç¬¬ä¸€è¡Œæ·»åŠ å…ƒç´  matrix2.get(1).add(0, Go); // ç¬¬äºŒè¡Œå¼€å¤´æ’å…¥å…ƒç´  // æ·»åŠ æ–°è¡Œï¼ˆç©ºè¡Œï¼‰ matrix2.add(new ArrayList()); matrix2.get(2).add(Swift); // ç»™æ–°è¡Œæ·»åŠ å…ƒç´  // ====================== // 3. è®¿é—®å…ƒç´  // ====================== // è®¿é—®å•ä¸ªå…ƒç´  int element = matrix1.get(1).get(2); // è·å–ç¬¬äºŒè¡Œç¬¬ä¸‰åˆ—å…ƒç´  â†’ 6 String lang = matrix2.get(0).get(1); // è·å–ç¬¬ä¸€è¡Œç¬¬äºŒåˆ—å…ƒç´  â†’ Python // è·å–è¡Œæ•° int rows = matrix1.size(); // è·å–åˆ—æ•°ï¼ˆç‰¹å®šè¡Œï¼‰ int colsRow0 = matrix1.get(0).size(); int colsRow2 = matrix2.get(2).size(); // ====================== // 4. ä¿®æ”¹å…ƒç´  // ====================== matrix1.get(0).set(0, 100); // ä¿®æ”¹ç¬¬ä¸€è¡Œç¬¬ä¸€åˆ—: 1 â†’ 100 matrix2.get(1).set(2, TypeScript); // ä¿®æ”¹ç¬¬äºŒè¡Œç¬¬ä¸‰åˆ— // ====================== // 5. åˆ é™¤å…ƒç´  // ====================== // åˆ é™¤æŒ‡å®šä½ç½®çš„å…ƒç´  matrix1.get(2).remove(1); // åˆ é™¤ç¬¬ä¸‰è¡Œç¬¬äºŒåˆ—å…ƒç´ (8) // åˆ é™¤æ•´è¡Œ matrix2.remove(2); // åˆ é™¤ç¬¬ä¸‰è¡Œ // ====================== // 6. éå†äºŒç»´List // ====================== System.out.println( éå†matrix1:); // æ–¹æ³•1: ç´¢å¼•éå† for (int i = 0; i matrix1.size(); i++) for (int j = 0; j matrix1.get(i).size(); j++) System.out.print(matrix1.get(i).get(j) + ); System.out.println(); System.out.println( éå†matrix2:); // æ–¹æ³•2: å¢å¼ºforå¾ªç¯ for (ListString row : matrix2) for (String item : row) System.out.print(item + ); System.out.println(); System.out.println( éå†matrix3:); // æ–¹æ³•3: ä½¿ç”¨forEach + lambda matrix3.forEach(row - row.forEach(item - System.out.print(item + )); System.out.println(); ); // ====================== // 7. å…¶ä»–å¸¸ç”¨æ“ä½œ // ====================== // æ£€æŸ¥æ˜¯å¦ä¸ºç©º boolean isEmpty = matrix2.isEmpty(); // æ£€æŸ¥æ˜¯å¦åŒ…å«å…ƒç´  boolean containsPython = matrix2.get(0).contains(Python); // æŸ¥æ‰¾å…ƒç´ ä½ç½® int rowIndex = -1, colIndex = -1; for (int i = 0; i matrix1.size(); i++) int index = matrix1.get(i).indexOf(5); if (index != -1) rowIndex = i; colIndex = index; break; // è½¬æ¢ä¸ºäºŒç»´æ•°ç»„ String[][] array2D = new String[matrix2.size()][]; for (int i = 0; i matrix2.size(); i++) ListString row = matrix2.get(i); array2D[i] = row.toArray(new String[0]); ////ç¿»è½¬è¡Œ //æ–¹æ³•1 ä½¿ç”¨å·¥å…·ç±» ListListInteger matrix = new ArrayList(); // å‡è®¾ matrix å·²ç»å¡«å……æ•°æ® // ç¿»è½¬è¡Œï¼ˆé¦–è¡Œå˜æœ«è¡Œï¼Œæ¬¡è¡Œå˜æ¬¡æœ«è¡Œï¼Œä¾æ­¤ç±»æ¨ï¼‰ Collections.reverse(matrix); //æ–¹æ³•2 ListListInteger matrix = new ArrayList(); // å‡è®¾ matrix å·²ç»å¡«å……æ•°æ® int left = 0; int right = matrix.size() - 1; while (left right) // ä½¿ç”¨ä¸´æ—¶è¡Œ temp äº¤æ¢å·¦å³ä¸¤è¡Œ ListInteger temp = matrix.get(left); matrix.set(left, matrix.get(right)); matrix.set(right, temp); left++; right--; //æ–¹æ³•3 Stream ListListInteger matrix = new ArrayList(); // å‡è®¾ matrix å·²ç»å¡«å……æ•°æ® // ç¿»è½¬è¡Œé¡ºåº ListListInteger reversed = IntStream.range(0, matrix.size()) .mapToObj(i - matrix.get(matrix.size() - 1 - i)) .collect(Collectors.toList()); matrix = reversed; // å¦‚æœéœ€è¦åŸåœ°ç¿»è½¬ï¼Œéœ€é‡æ–°èµ‹å€¼ // æ‰“å°ç»“æœ System.out.println( matrix1: + matrix1); System.out.println(matrix2: + matrix2); System.out.println(matrix3: + matrix3); System.out.println(æ‰¾åˆ°æ•°å­—5çš„ä½ç½®: [ + rowIndex + ][ + colIndex + ]); HashSet å¸¸ç”¨æ“ä½œ// =================== HashSet åŸºç¡€æ“ä½œ ===================import java.util.Collections;import java.util.HashSet;import java.util.Iterator;import java.util.Set;// åˆ›å»ºå¯¹è±¡SetString set = new HashSet(); // ç©ºé›†åˆï¼ˆé»˜è®¤åˆå§‹å®¹é‡16ï¼Œè´Ÿè½½å› å­0.75ï¼‰SetInteger initSet = new HashSet(32); // æŒ‡å®šåˆå§‹å®¹é‡SetString prefilled = new HashSet(Arrays.asList(A, B, C)); // é€šè¿‡é›†åˆåˆå§‹åŒ–// å…ƒç´ æ“ä½œboolean added = set.add(Apple); // æ·»åŠ å…ƒç´  â†’ trueï¼ˆé¦–æ¬¡æ·»åŠ ï¼‰boolean dupAdd = set.add(Apple); // æ·»åŠ é‡å¤å…ƒç´  â†’ falseboolean hasBanana = set.contains(Apple); // æ£€æŸ¥å­˜åœ¨ â†’ trueboolean removed = set.remove(Apple); // åˆ é™¤å…ƒç´  â†’ trueï¼ˆå­˜åœ¨æ—¶ï¼‰set.clear(); // æ¸…ç©ºé›†åˆ// æ‰¹é‡æ“ä½œSetString fruits = new HashSet(Arrays.asList(Orange, Mango));boolean addedAll = set.addAll(fruits); // åˆå¹¶é›†åˆ â†’ trueï¼ˆé›†åˆæ”¹å˜æ—¶ï¼‰boolean retainAll = set.retainAll(Arrays.asList(Mango)); // ä¿ç•™äº¤é›† â†’ trueï¼ˆé›†åˆæ”¹å˜æ—¶ï¼‰boolean removeAll = set.removeAll(fruits); // åˆ é™¤æ‰€æœ‰åŒ¹é…å…ƒç´  â†’ trueï¼ˆé›†åˆæ”¹å˜æ—¶ï¼‰// éå†æ“ä½œset.add(Apple);set.add(Banana);for (String item : set) // å¢å¼ºforå¾ªç¯ï¼ˆæ— åºï¼‰ System.out.print(item + ); // è¾“å‡ºé¡ºåºä¸ç¡®å®šï¼ˆå¦‚ Banana Appleï¼‰IteratorString it = set.iterator(); // è¿­ä»£å™¨éå†while (it.hasNext()) System.out.print(it.next() + );set.forEach(item - System.out.print(item)); // Java8+ Lambdaéå†// é›†åˆä¿¡æ¯int size = set.size(); // å…ƒç´ æ•°é‡ï¼ˆå¦‚ 2ï¼‰boolean isEmpty = set.isEmpty(); // æ˜¯å¦ç©ºé›†åˆ â†’ falseObject[] array = set.toArray(); // è½¬Objectæ•°ç»„String[] strArray = set.toArray(new String[0]); // è½¬æŒ‡å®šç±»å‹æ•°ç»„// ç‰¹æ®Šæ“ä½œSetString cloneSet = (HashSetString) ((HashSetString) set).clone(); // æµ…æ‹·è´SetString syncSet = Collections.synchronizedSet(set); // çº¿ç¨‹å®‰å…¨åŒ…è£…// é›†åˆè¿ç®—ç¤ºä¾‹SetString set1 = new HashSet(Arrays.asList(A, B));SetString set2 = new HashSet(Arrays.asList(B, C));SetString union = new HashSet(set1); // å¹¶é›† â†’ [A, B, C]union.addAll(set2);SetString intersection = new HashSet(set1); // äº¤é›† â†’ [B]intersection.retainAll(set2);SetString difference = new HashSet(set1); // å·®é›† â†’ [A]difference.removeAll(set2);/* æ ¸å¿ƒç‰¹æ€§ï¼š1. å”¯ä¸€æ€§ï¼šåŸºäº hashCode() å’Œ equals() åˆ¤æ–­é‡å¤2. æ— åºæ€§ï¼šéå†é¡ºåºä¸ä¿è¯ä¸æ’å…¥é¡ºåºä¸€è‡´3. å…è®¸ null å…ƒç´ ï¼ˆä½†åªèƒ½æœ‰ä¸€ä¸ª nullï¼‰4. åŸºç¡€æ“ä½œæ—¶é—´å¤æ‚åº¦ï¼šadd/remove/contains â†’ å¹³å‡ O(1)5. éçº¿ç¨‹å®‰å…¨ï¼šéœ€é€šè¿‡ Collections.synchronizedSet åŒ…è£…å®ç°çº¿ç¨‹å®‰å…¨*/ HashMap å¸¸ç”¨æ“ä½œ// =================== HashMap åŸºç¡€æ“ä½œ ===================import java.util.Collections;import java.util.HashMap;import java.util.Map;import java.util.Set;// åˆ›å»ºå¯¹è±¡MapString, Integer map = new HashMap(); // é»˜è®¤å®¹é‡16ï¼Œè´Ÿè½½å› å­0.75MapString, String initMap = new HashMap(32); // æŒ‡å®šåˆå§‹å®¹é‡MapString, Integer prefilled = new HashMap(Map.of(A, 1, B, 2)); // Java9+å¿«é€Ÿåˆå§‹åŒ–// å¢åˆ æ”¹æ“ä½œmap.put(Apple, 10); // æ·»åŠ é”®å€¼å¯¹ â†’ Apple=10map.put(Banana, 20); // â†’ Apple=10, Banana=20map.putIfAbsent(Apple, 50); // ä»…å½“é”®ä¸å­˜åœ¨æ—¶æ·»åŠ  â†’ åŸå€¼10ä¿æŒä¸å˜map.replace(Apple, 15); // æ›¿æ¢å·²æœ‰é”®çš„å€¼ â†’ Apple=15, Banana=20map.remove(Banana); // åˆ é™¤é”® â†’ Apple=15map.replace(Apple, 15, 20); // é”®å€¼åŒ¹é…æ—¶æ›¿æ¢ â†’ Apple=20map.clear(); // æ¸…ç©ºæ˜ å°„// æŸ¥è¯¢æ“ä½œint count = map.get(Apple); // è·å–å€¼ï¼ˆéœ€ç¡®ä¿é”®å­˜åœ¨ï¼‰Integer countSafe = map.get(Orange); // é”®ä¸å­˜åœ¨æ—¶è¿”å›nullboolean existsKey = map.containsKey(Apple); // æ£€æŸ¥é”®æ˜¯å¦å­˜åœ¨ â†’ trueboolean existsValue = map.containsValue(20); // æ£€æŸ¥å€¼æ˜¯å¦å­˜åœ¨ â†’ trueint size = map.size(); // é”®å€¼å¯¹æ•°é‡boolean isEmpty = map.isEmpty(); // æ˜¯å¦ä¸ºç©ºæ˜ å°„// éå†æ“ä½œï¼ˆ4ç§æ–¹å¼ï¼‰// 1. Entryéå†ï¼ˆæ¨èï¼‰for (Map.EntryString, Integer entry : map.entrySet()) System.out.println(entry.getKey() + : + entry.getValue());// 2. Keyéå†for (String key : map.keySet()) System.out.println(key + - + map.get(key));// 3. Valueéå†for (Integer value : map.values()) System.out.println(Value: + value);// 4. Java8+ Lambdaéå†map.forEach((k, v) - System.out.println(k + = + v));// æ‰¹é‡æ“ä½œMapString, Integer newItems = Map.of(Cherry, 5, Durian, 8);map.putAll(newItems); // åˆå¹¶æ˜ å°„ â†’ Apple=20, Cherry=5, Durian=8// ç‰¹æ®Šå€¼å¤„ç†map.put(null, 0); // å…è®¸nullé”® â†’ null=0map.put(Mango, null); // å…è®¸nullå€¼ â†’ null=0, Mango=null// é«˜çº§æ“ä½œï¼ˆJava8+ï¼‰map.computeIfAbsent(Orange, k - 3); // ä¸å­˜åœ¨æ—¶è®¡ç®— â†’ æ·»åŠ  Orange=3map.computeIfPresent(Apple, (k, v) - v + 5); // å­˜åœ¨æ—¶æ›´æ–° â†’ Apple=25map.merge(Apple, 10, (oldVal, newVal) - oldVal + newVal); // åˆå¹¶å€¼ â†’ Apple=35// çº¿ç¨‹å®‰å…¨åŒ…è£…MapString, Integer syncMap = Collections.synchronizedMap(map);// ä¸å¯å˜æ˜ å°„ï¼ˆJava9+ï¼‰MapString, Integer immutableMap = Map.ofEntries( Map.entry(A, 1), Map.entry(B, 2));/* æ ¸å¿ƒç‰¹æ€§ï¼š1. é”®å”¯ä¸€æ€§ï¼šåŸºäº hashCode() å’Œ equals() åˆ¤æ–­é‡å¤2. æ— åºå­˜å‚¨ï¼šè¿­ä»£é¡ºåºä¸ä¿è¯ä¸æ’å…¥é¡ºåºä¸€è‡´3. å…è®¸ä¸€ä¸ªnullé”®å’Œå¤šä¸ªnullå€¼4. åŸºç¡€æ“ä½œæ—¶é—´å¤æ‚åº¦ï¼šget/put â†’ å¹³å‡ O(1)5. æ‰©å®¹æœºåˆ¶ï¼šå½“å…ƒç´ æ•°é‡è¶…è¿‡ï¼ˆå®¹é‡*è´Ÿè½½å› å­ï¼‰æ—¶è‡ªåŠ¨ç¿»å€æ‰©å®¹6. æ ‘åŒ–ä¼˜åŒ–ï¼šå½“é“¾è¡¨é•¿åº¦è¶…è¿‡8æ—¶è½¬çº¢é»‘æ ‘ï¼ˆJava8+ï¼‰*/ HashMapCharacter, Integer hm_s = new HashMap();//éå†å­—ç¬¦ä¸²çš„æ‰€æœ‰å­—ç¬¦ï¼ˆæ›´æ¸…æ™°çš„é€»è¾‘ï¼‰for (char c : s.toCharArray()) hm_s.merge(c, 1, Integer::sum);// ä½¿ç”¨getOrDefaulté¿å…NullPointerExceptionint countS = hm_s.getOrDefault(c, 0); ä¸€ä¸ª Key åªèƒ½å¯¹åº”ä¸€ä¸ªå€¼ï¼Œæ‰€ä»¥å¦‚æœè¦å®ç°ç±»ä¼¼ Multimap çš„ç»“æ„éœ€è¦å¦‚ä¸‹æ–¹å¼ï¼š //åˆå§‹åŒ–HashMapString, ListInteger multiValueMap = new HashMap();/////æ·»åŠ å…ƒç´ if (!multiValueMap.containsKey(scores)) multiValueMap.put(scores, new ArrayList());multiValueMap.get(scores).add(90);// è‹¥é”®ä¸å­˜åœ¨ï¼Œè‡ªåŠ¨åˆ›å»ºç©ºåˆ—è¡¨multiValueMap.computeIfAbsent(scores, k - new ArrayList()).add(90);multiValueMap.computeIfAbsent(scores, k - new ArrayList()).add(85);////è®¿é—®å…ƒç´ //è·å–æŸä¸ªé”®çš„æ‰€æœ‰å€¼ListInteger scores = multiValueMap.get(scores);if (scores != null) for (int num : scores) System.out.println(num); //è¾“å‡º 90, 85 //é¿å… NullPointerExceptionçš„æƒ…å†µListInteger scores = multiValueMap.getOrDefault(scores, new ArrayList());for (int num : scores) System.out.println(num);////åˆ é™¤å…ƒç´ //åˆ é™¤æ•´ä¸ªé”®å€¼å¯¹multiValueMap.remove(scores);// åˆ é™¤æŸä¸ªé”®çš„ç‰¹å®šå€¼ListInteger scores = multiValueMap.get(scores);if (scores != null) scores.remove(Integer.valueOf(90)); // åˆ é™¤å€¼ä¸º 90 çš„å…ƒç´  // å¦‚æœåˆ—è¡¨ä¸ºç©ºï¼Œå¯é€‰åˆ é™¤é”® if (scores.isEmpty()) multiValueMap.remove(scores); ////éå†å“ˆå¸Œè¡¨// éå†æ‰€æœ‰é”®å€¼å¯¹for (Map.EntryString, ListInteger entry : multiValueMap.entrySet()) String key = entry.getKey(); ListInteger values = entry.getValue(); System.out.println(key + : + values);//éå†æ‰€æœ‰é”®for (String key : multiValueMap.keySet()) System.out.println(Key: + key);//éå†æ‰€æœ‰å€¼for (ListInteger values : multiValueMap.values()) System.out.println(Values: + values); Stringçš„å¸¸ç”¨æ“ä½œ// =================== String å¸¸ç”¨æ“ä½œ ===================// åˆ›å»ºå¯¹è±¡String str1 = Hello; // ç›´æ¥é‡åˆ›å»ºï¼ˆå­—ç¬¦ä¸²å¸¸é‡æ± ï¼‰String str2 = new String(World); // å †å†…å­˜æ–°å¯¹è±¡char[] chars = J,a,v,a;String str3 = new String(chars); // é€šè¿‡å­—ç¬¦æ•°ç»„åˆ›å»º â†’ Java// åŸºæœ¬æ“ä½œint len = str1.length(); // è·å–é•¿åº¦ â†’ 5char c = str1.charAt(1); // è·å–ç´¢å¼•1å­—ç¬¦ â†’ eString substr1 = str1.substring(2); // ä»ç´¢å¼•2æˆªå– â†’ lloString substr2 = str1.substring(1,4); // æˆªå–1-3ç´¢å¼• â†’ ellString concatStr = str1.concat( World);// æ‹¼æ¥ â†’ Hello WorldString upper = str1.toUpperCase(); // è½¬å¤§å†™ â†’ HELLOString lower = HELLO.toLowerCase(); // è½¬å°å†™ â†’ helloString trimStr = text .trim(); // å»é¦–å°¾ç©ºæ ¼ â†’ textString replaced = str1.replace(l, L);// æ›¿æ¢å­—ç¬¦ â†’ HeLLoString replacedAll = a1b2c3.replaceAll(\\\\d, #); // æ­£åˆ™æ›¿æ¢ â†’ a#b#c#// è½¬æ¢ä¸æ¯”è¾ƒchar[] arr = str1.toCharArray(); // è½¬å­—ç¬¦æ•°ç»„ â†’ [H,e,l,l,o]byte[] bytes = str1.getBytes(); // æŒ‰é»˜è®¤ç¼–ç è½¬å­—èŠ‚æ•°ç»„boolean eq1 = str1.equals(Hello); // å€¼æ¯”è¾ƒ â†’ trueboolean eq2 = str1.equalsIgnoreCase(hElLo); // å¿½ç•¥å¤§å°å†™ â†’ trueint cmp = str1.compareTo(Hella); // å­—å…¸åºæ¯”è¾ƒ â†’ æ­£æ•°ï¼ˆo aï¼‰// æ­£åˆ™å¤„ç†boolean matches = 123.matches(\\\\d+); // æ­£åˆ™åŒ¹é… â†’ trueString[] parts = a,b,c.split(,); // åˆ†å‰²//Arrays.adList()// å­—ç¬¦ä¸² â†’ [a,b,c]String[] regexParts = a1b2c3.split(\\\\d); // æŒ‰æ•°å­—åˆ†å‰² â†’ [a,b,c]// æ ¼å¼åŒ–å¤„ç†String format1 = String.format(%s-%d, ID, 100); // â†’ ID-100String format2 = String.join(|, A, B, C); // â†’ A|B|C// ç‰¹æ®Šåˆ¤æ–­boolean isEmpty = .isEmpty(); // ç©ºå­—ç¬¦ä¸² â†’ trueboolean isBlank = .isBlank(); // å…¨ç©ºç™½å­—ç¬¦ï¼ˆJava 11+ï¼‰ â†’ trueboolean starts = str1.startsWith(He); // å¼€å¤´åˆ¤æ–­ â†’ trueboolean ends = str1.endsWith(lo); // ç»“å°¾åˆ¤æ–­ â†’ true/* æ ¸å¿ƒç‰¹æ€§ï¼š1. ä¸å¯å˜æ€§ï¼šæ‰€æœ‰æ“ä½œè¿”å›æ–°å­—ç¬¦ä¸²ï¼ŒåŸå¯¹è±¡ä¸å˜2. å­—ç¬¦ä¸²å¸¸é‡æ± å¤ç”¨æœºåˆ¶ï¼šç›´æ¥é‡èµ‹å€¼ä¼˜å…ˆä½¿ç”¨å¸¸é‡æ± 3. æ”¯æŒæ­£åˆ™è¡¨è¾¾å¼æ“ä½œï¼ˆsplit/matches/replaceAllç­‰ï¼‰4. åŒ…å«ä¸°å¯Œçš„æ ¼å¼åŒ–æ–¹æ³•ï¼ˆformat/joinç­‰ï¼‰*/ intè½¬StringString s = String.valueOf(i);String s = Integer.toString(i);String è½¬ intString str = 123;int num = Integer.parseInt(str); StringBuffer å’Œ StringBuilderStringBuilder ç±»åœ¨ Java 5 ä¸­è¢«æå‡ºï¼Œå®ƒå’Œ StringBuffer ä¹‹é—´çš„æœ€å¤§ä¸åŒåœ¨äº StringBuilder çš„æ–¹æ³•ä¸æ˜¯çº¿ç¨‹å®‰å…¨çš„ï¼ˆä¸èƒ½åŒæ­¥è®¿é—®ï¼‰ã€‚ç”±äº StringBuilder ç›¸è¾ƒäº StringBuffer æœ‰é€Ÿåº¦ä¼˜åŠ¿ï¼Œæ‰€ä»¥å¤šæ•°æƒ…å†µä¸‹å»ºè®®ä½¿ç”¨ StringBuilder ç±»ã€‚ // =================== StringBuilder ===================// åˆ›å»ºå¯¹è±¡StringBuilder sb = new StringBuilder(); // é»˜è®¤å®¹é‡16StringBuilder sb2 = new StringBuilder(Hello); // æŒ‡å®šåˆå§‹å†…å®¹// åŸºæœ¬æ“ä½œsb.append( World); // è¿½åŠ å†…å®¹ â†’ Hello Worldsb.insert(5, Java); // æŒ‡å®šä½ç½®æ’å…¥ â†’ Hello Java Worldsb.delete(5, 10); // åˆ é™¤5-9ä½ç½® â†’ Hello Worldsb.replace(6, 11, Earth); // æ›¿æ¢æŒ‡å®šåŒºé—´ â†’ Hello Earthsb.reverse(); // åè½¬ â†’ htraE olleH sb.setLength(5); // æˆªæ–­ä¿ç•™å‰5å­—ç¬¦ â†’ htraEchar c = sb.charAt(2); // è·å–ç´¢å¼•2çš„å­—ç¬¦ â†’ rsb.setCharAt(0, H); // ä¿®æ”¹ç´¢å¼•0å­—ç¬¦ â†’ HtraEint len = sb.length(); // è·å–å½“å‰é•¿åº¦ â†’ 5String s = sb.toString(); // è½¬æ¢ä¸ºString// æ­£å‘éå†for (int i = 0; i sb.length(); i++) char c = sb.charAt(i); System.out.println(c);// é“¾å¼è°ƒç”¨StringBuilder sb3 = new StringBuilder() .append(123) // æ”¯æŒå¤šç±»å‹ .append(3.14) .append(true);sb.setLength(prevLen); // ç›´æ¥å›é€€åˆ°æ·»åŠ å‰çš„é•¿åº¦// =================== StringBuffer ===================// åˆ›å»ºå¯¹è±¡ï¼ˆæ“ä½œæ–¹æ³•ä¸StringBuilderå®Œå…¨ä¸€è‡´ï¼‰StringBuffer sbf = new StringBuffer(); sbf.append(100); // è¿½åŠ æ•°å€¼sbf.insert(3, new char[]A,B); // æ’å…¥å­—ç¬¦æ•°ç»„sbf.deleteCharAt(4); // åˆ é™¤å•ä¸ªå­—ç¬¦sbf.setLength(0); // æ¸…ç©ºç¼“å†²åŒºï¼ˆå¤ç”¨å¯¹è±¡ï¼‰// çº¿ç¨‹å®‰å…¨ç¤ºä¾‹sbf.append(ThreadSafe); // æ‰€æœ‰æ–¹æ³•éƒ½æœ‰synchronizedä¿®é¥°ç¬¦/* å…±æ€§ç‰¹å¾ï¼š1. åˆå§‹å®¹é‡16ï¼Œè‡ªåŠ¨æ‰©å®¹ï¼ˆæ¯æ¬¡æ‰©å®¹2n+2ï¼‰2. append() æ”¯æŒæ‰€æœ‰åŸºç¡€ç±»å‹/Objectç±»å‹3. ä¿®æ”¹åå¯¹è±¡åœ°å€ä¸å˜ï¼ˆä¸Stringçš„ä¸å¯å˜æ€§å¯¹æ¯”ï¼‰4. ä¸»è¦æ–¹æ³•ï¼šappend/insert/delete/replace/reverse*/String s1 = buffer.toString(); // StringBuffer â†’ StringString s2 = builder.toString(); // StringBuilder â†’ String PriorityQueueçš„å¸¸ç”¨æ“ä½œrecordçš„å¸¸ç”¨æ“ä½œç”±äºrecordæ˜¯Java 14å¼•å…¥çš„ï¼Œæ‰€ä»¥éœ€è¦ä½¿ç”¨Java 14ä»¥ä¸Šçš„ç‰ˆæœ¬ã€‚å¹¶ä¸”é€šå¸¸recordæ˜¯ç”¨åœ¨ä¼˜å…ˆé˜Ÿåˆ—çš„æ¯”è¾ƒå™¨ä¸­ï¼Œæ‰€ä»¥ç›´æ¥æ”¾åœ¨è¿™é‡Œ.ç›´æ¥ä¸¾ä¸€ä¸ªä¾‹å­: record Node(double gain , int a , int b)PriorityQueueNode pq = new PriorityQueue((a, b) - Double.compare(b.gain, a.gain));pq.offer(new Node(1.0, 1, 2));pq.offer(new Node(2.0, 2, 3));pq.offer(new Node(3.0, 3, 4)); System.out.println(pq.poll().gain);System.out.println(pq.poll().gain);System.out.println(pq.poll().gain); è¾“å‡º: 3.02.01.0 åŸºæœ¬ç”¨æ³•å°±æ˜¯è¿™æ ·. å°é¡¶å †(é»˜è®¤ï¼Œå‰ K å¤§ï¼Œå‡åº) // åˆ›å»ºå°é¡¶å †ï¼ˆé»˜è®¤ï¼‰PriorityQueueInteger minHeap = new PriorityQueue();// æ·»åŠ å…ƒç´ minHeap.offer(5);minHeap.add(3); // offerå’ŒaddåŠŸèƒ½ç›¸åŒ// æŸ¥çœ‹å †é¡¶å…ƒç´ ï¼ˆä¸åˆ é™¤ï¼‰int min = minHeap.peek();// å–å‡ºå †é¡¶å…ƒç´ ï¼ˆåˆ é™¤ï¼‰int removedMin = minHeap.poll();// è·å–å †å¤§å°int size = minHeap.size();// æ£€æŸ¥æ˜¯å¦ä¸ºç©ºboolean isEmpty = minHeap.isEmpty();// åˆ é™¤æŒ‡å®šå…ƒç´ ï¼ˆéå †é¡¶ï¼‰minHeap.remove(2);// æ¸…ç©ºå †minHeap.clear(); å¤§é¡¶å †(å‰ K å°ï¼Œé™åº) // åˆ›å»ºå¤§é¡¶å †ï¼ˆä½¿ç”¨è‡ªå®šä¹‰æ¯”è¾ƒå™¨ï¼‰PriorityQueueInteger maxHeap = new PriorityQueue((a, b) - b - a);// æˆ– PriorityQueue(Comparator.reverseOrder());// æ·»åŠ å…ƒç´ maxHeap.offer(8);maxHeap.add(4);// æŸ¥çœ‹å †é¡¶å…ƒç´ ï¼ˆä¸åˆ é™¤ï¼‰int max = maxHeap.peek();// å–å‡ºå †é¡¶å…ƒç´ ï¼ˆåˆ é™¤ï¼‰int removedMax = maxHeap.poll();// æ£€æŸ¥å…ƒç´ æ˜¯å¦å­˜åœ¨boolean contains = maxHeap.contains(5);// éå†å¹¶è¾“å‡ºå…ƒç´ for (Integer num : minHeap) System.out.println(num);// æ„é€ æŒ‰ç…§å­—å…¸åºæ’åˆ—çš„ä¼˜å…ˆé˜Ÿåˆ—PriorityQueueInteger pq = new PriorityQueue((a, b) - // å°† int è½¬æ¢ä¸º String åæ¯”è¾ƒå­—å…¸åº String strA = String.valueOf(a); String strB = String.valueOf(b); return strA.compareTo(strB);); å †æ±‚å‰kå¤§,ç„¶åå­˜å‚¨ç´¢å¼•(éœ€è¦ä¿å­˜ä¸‹æ ‡çš„å†™æ³•)å †æ±‚å‰kå¤§,ç„¶åå­˜å‚¨ç´¢å¼• //å°æ ¹å †ï¼Œå¦‚æœå½“å‰å…ƒç´ å¤§äºå †é¡¶ï¼Œåˆ™åŠ å…¥å †ä¸­ï¼Œå †ä¸­çš„å…ƒç´ è¿˜è¦ä¿å­˜å…¶ä¸‹æ ‡public int[] maxSubsequence(int[] nums, int k) PriorityQueueint[] heap = new PriorityQueue((o1,o2)-o1[0]-o2[0]); int n = nums.length; for(int i = 0; i n; i++) if(heap.size() k) heap.offer(new int[]nums[i], i); else if(nums[i] heap.peek()[0]) heap.poll(); heap.offer(new int[]nums[i], i); int[] idx = new int[k]; for(int i = 0; i k; i++) idx[i] = heap.poll()[1]; Arrays.sort(idx); for(int i = 0; i k; i++) idx[i] = nums[idx[i]]; return idx; è‡ªå®šä¹‰å¯¹è±¡å † // è‡ªå®šä¹‰ç±»class Student String name; int score; // æ„é€ æ–¹æ³•ç­‰...// æŒ‰åˆ†æ•°çš„å°é¡¶å †PriorityQueueStudent studentMinHeap = new PriorityQueue( (s1, s2) - s1.score - s2.score);// æŒ‰åˆ†æ•°çš„å¤§é¡¶å † PriorityQueueStudent studentMaxHeap = new PriorityQueue( (s1, s2) - s2.score - s1.score);// æ·»åŠ è‡ªå®šä¹‰å¯¹è±¡studentMinHeap.offer(new Student(Alice, 85)); å †åºæ€§è´¨å †ç±»å‹\tæ¯”è¾ƒæ¡ä»¶\tæ•°å­¦è¡¨è¾¾\tJavaæ¯”è¾ƒå™¨å®ç°å°é¡¶å †\tçˆ¶ â‰¤ å­\ta â‰¤ b\ta - b æˆ– a.compareTo(b)å¤§é¡¶å †\tçˆ¶ â‰¥ å­\ta â‰¥ b\tb - a æˆ– b.compareTo(a)æ¯”è¾ƒå™¨çš„æœ¬è´¨aåœ¨å †é‡Œä»£è¡¨çˆ¶èŠ‚ç‚¹ bæ˜¯å­èŠ‚ç‚¹ a-b è¦å°äº0 aä¼˜å…ˆçº§æ‰é«˜ ab æ‰€ä»¥æ˜¯æœ€å°å † æ¯”è¾ƒå™¨å®šä¹‰çš„æ˜¯â€ä¼˜å…ˆçº§â€å…³ç³»ï¼š è¿”å›è´Ÿæ•°ï¼šç¬¬ä¸€ä¸ªå‚æ•°ï¼ˆaï¼‰åº”è¯¥æ’åœ¨å‰é¢ï¼ˆæ›´é«˜ä¼˜å…ˆçº§ï¼‰ è¿”å›æ­£æ•°ï¼šç¬¬äºŒä¸ªå‚æ•°ï¼ˆbï¼‰åº”è¯¥æ’åœ¨å‰é¢ è¿”å›é›¶ï¼šä¸¤è€…ä¼˜å…ˆçº§ç›¸åŒ ä½¿ç”¨åœºæ™¯å‰ K å¤§çš„å…ƒç´ ï¼šä½¿ç”¨æœ€å°å †ï¼Œå› ä¸ºå †é¡¶æ˜¯å­˜å‚¨çš„æœ€å°çš„å…ƒç´ ï¼Œå¦‚æœæ–°å¢å…ƒç´ æ¯”å †é¡¶å¤§ï¼Œé‚£åªéœ€è¦æ›¿æ¢æ‰å †é¡¶å³å¯ã€‚å‰ K å°çš„å…ƒç´ ï¼šä½¿ç”¨æœ€å¤§å †ï¼Œå› ä¸ºå †é¡¶æ˜¯å­˜å‚¨çš„æœ€å¤§çš„å…ƒç´ ï¼Œå¦‚æœæ–°å¢å…ƒç´ æ¯”å †é¡¶å°ï¼Œé‚£åªéœ€è¦æ›¿æ¢æ‰å †é¡¶å³å¯ã€‚é»˜è®¤å°é¡¶å †ï¼šå‡åºæ’åºã€‚é»˜è®¤å¤§é¡¶å †ï¼šé™åºæ’åºã€‚ class Solution public int maxEvents(int[][] events) int mx = 0; for (int[] e : events) mx = Math.max(mx, e[1]); // æŒ‰ç…§å¼€å§‹æ—¶é—´åˆ†ç»„ ListInteger[] groups = new ArrayList[mx + 1]; Arrays.setAll(groups, i - new ArrayList()); for (int[] e : events) groups[e[0]].add(e[1]); int ans = 0; PriorityQueueInteger pq = new PriorityQueue(); for (int i = 0; i = mx; i++) // åˆ é™¤è¿‡æœŸä¼šè®® while (!pq.isEmpty() pq.peek() i) pq.poll(); // æ–°å¢å¯ä»¥å‚åŠ çš„ä¼šè®® for (int endDay : groups[i]) pq.offer(endDay); // å‚åŠ ä¸€ä¸ªç»“æŸæ—¶é—´æœ€æ—©çš„ä¼šè®® if (!pq.isEmpty()) ans++; pq.poll(); return ans; Deque çš„å¸¸ç”¨æ“ä½œimport java.util.Deque;import java.util.ArrayDeque;import java.util.Iterator;// åˆå§‹åŒ– Dequeï¼ˆä»¥ ArrayDeque ä¸ºä¾‹ï¼‰DequeString deque = new ArrayDeque(); //ä¸èƒ½æ’å…¥nullå…ƒç´ DequeString deque = new LinkedList();// ================== æ’å…¥æ“ä½œ ==================// é˜Ÿå¤´æ’å…¥deque.addFirst(A); // æ’å…¥å…ƒç´ åˆ°é˜Ÿå¤´ï¼ˆå®¹é‡æ»¡æ—¶æŠ›å‡º IllegalStateExceptionï¼‰deque.offerFirst(B); // æ’å…¥å…ƒç´ åˆ°é˜Ÿå¤´ï¼ˆå®¹é‡æ»¡æ—¶è¿”å› falseï¼‰// é˜Ÿå°¾æ’å…¥deque.addLast(C); // æ’å…¥å…ƒç´ åˆ°é˜Ÿå°¾ï¼ˆå®¹é‡æ»¡æ—¶æŠ›å‡º IllegalStateExceptionï¼‰deque.offerLast(D); // æ’å…¥å…ƒç´ åˆ°é˜Ÿå°¾ï¼ˆå®¹é‡æ»¡æ—¶è¿”å› falseï¼‰// æ‰¹é‡æ’å…¥ï¼ˆä» Collection ç»§æ‰¿ï¼‰deque.addAll(List.of(E, F)); // ä¾æ¬¡æ’å…¥é˜Ÿå°¾// ================== åˆ é™¤æ“ä½œ ==================// é˜Ÿå¤´åˆ é™¤String first1 = deque.removeFirst(); // åˆ é™¤å¹¶è¿”å›é˜Ÿå¤´å…ƒç´ ï¼ˆç©ºé˜Ÿåˆ—æŠ› NoSuchElementExceptionï¼‰String first2 = deque.pollFirst(); // åˆ é™¤å¹¶è¿”å›é˜Ÿå¤´å…ƒç´ ï¼ˆç©ºé˜Ÿåˆ—è¿”å› nullï¼‰// é˜Ÿå°¾åˆ é™¤String last1 = deque.removeLast(); // åˆ é™¤å¹¶è¿”å›é˜Ÿå°¾å…ƒç´ ï¼ˆç©ºé˜Ÿåˆ—æŠ›å¼‚å¸¸ï¼‰String last2 = deque.pollLast(); // åˆ é™¤å¹¶è¿”å›é˜Ÿå°¾å…ƒç´ ï¼ˆç©ºé˜Ÿåˆ—è¿”å› nullï¼‰// åˆ é™¤æŒ‡å®šå…ƒç´ ï¼ˆä»é˜Ÿå¤´å¼€å§‹æœç´¢ï¼‰boolean removed1 = deque.remove(E); // åˆ é™¤ç¬¬ä¸€ä¸ªå‡ºç°çš„ Eboolean removed2 = deque.removeFirstOccurrence(F); // åˆ é™¤é˜Ÿå¤´æ–¹å‘ç¬¬ä¸€ä¸ª Fboolean removed3 = deque.removeLastOccurrence(G); // åˆ é™¤é˜Ÿå°¾æ–¹å‘ç¬¬ä¸€ä¸ª G// ================== æŸ¥çœ‹å…ƒç´  ==================// æŸ¥çœ‹é˜Ÿå¤´String head1 = deque.getFirst(); // è¿”å›é˜Ÿå¤´å…ƒç´ ï¼ˆç©ºé˜Ÿåˆ—æŠ›å¼‚å¸¸ï¼‰String head2 = deque.peekFirst(); // è¿”å›é˜Ÿå¤´å…ƒç´ ï¼ˆç©ºé˜Ÿåˆ—è¿”å› nullï¼‰// æŸ¥çœ‹é˜Ÿå°¾String tail1 = deque.getLast(); // è¿”å›é˜Ÿå°¾å…ƒç´ ï¼ˆç©ºé˜Ÿåˆ—æŠ›å¼‚å¸¸ï¼‰String tail2 = deque.peekLast(); // è¿”å›é˜Ÿå°¾å…ƒç´ ï¼ˆç©ºé˜Ÿåˆ—è¿”å› nullï¼‰// ================== é˜Ÿåˆ—çŠ¶æ€ ==================boolean isEmpty = deque.isEmpty(); // åˆ¤æ–­é˜Ÿåˆ—æ˜¯å¦ä¸ºç©ºint size = deque.size(); // è¿”å›å…ƒç´ æ•°é‡boolean exists = deque.contains(A); // åˆ¤æ–­æ˜¯å¦åŒ…å«å…ƒç´  A// ================== å…¶ä»–æ“ä½œ ==================// æ¸…ç©ºé˜Ÿåˆ—deque.clear();// è½¬æ¢ä¸ºæ•°ç»„Object[] array1 = deque.toArray(); // è¿”å› Object[]String[] array2 = deque.toArray(new String[0]); // æŒ‡å®šç±»å‹æ•°ç»„// è¿­ä»£å™¨ï¼ˆæ­£å‘ï¼šé˜Ÿå¤´ â†’ é˜Ÿå°¾ï¼‰IteratorString iterator = deque.iterator();while (iterator.hasNext()) String element = iterator.next();// åå‘è¿­ä»£å™¨ï¼ˆé˜Ÿå°¾ â†’ é˜Ÿå¤´ï¼‰IteratorString descendingIterator = deque.descendingIterator();while (descendingIterator.hasNext()) String element = descendingIterator.next();// ================== æ ˆæ“ä½œï¼ˆDeque å…¼å®¹çš„é¢å¤–æ–¹æ³•ï¼‰==================deque.push(X); // ç­‰æ•ˆäº addFirst()String popped = deque.pop(); // ç­‰æ•ˆäº removeFirst()// ================== å®¹é‡é™åˆ¶é˜Ÿåˆ—ï¼ˆå¦‚ LinkedBlockingDequeï¼‰==================// é˜»å¡æ“ä½œç¤ºä¾‹ï¼ˆéœ€ä½¿ç”¨çº¿ç¨‹å®‰å…¨ Dequeï¼Œæ­¤å¤„ä»…å±•ç¤ºæ–¹æ³•ï¼‰/*deque.offerFirst(W, 1, TimeUnit.SECONDS); // ç­‰å¾…1ç§’å°è¯•æ’å…¥é˜Ÿå¤´deque.offerLast(Z, 1, TimeUnit.SECONDS); // ç­‰å¾…1ç§’å°è¯•æ’å…¥é˜Ÿå°¾String item = deque.pollFirst(1, TimeUnit.SECONDS); // ç­‰å¾…1ç§’å°è¯•å–å‡ºé˜Ÿå¤´*/ æ¨¡è¿ç®—æ’ç­‰å¼è´¹é©¬å°å®šç†ç»„åˆæ•°çµç¥çš„æ¨¡è¿ç®—å¸–å­.respect.https://leetcode.cn/discuss/post/3584387/fen-xiang-gun-mo-yun-suan-de-shi-jie-dan-7xgu/ Javaçš„å–æ¨¡ï¼ˆmodï¼‰å’Œå–ä½™ï¼ˆ% remï¼‰ï¼Œå‘ç°æˆ‘ä»¬å¸¸ç”¨çš„åŸºæœ¬éƒ½æ˜¯æ­£æ•°å–ä½™æˆ–å–æ¨¡ï¼Œé‚£å¸¦æœ‰è´Ÿæ•°çš„è¦æ€ä¹ˆè®¡ç®—å‘¢ã€‚å½“xå’Œyçš„æ­£è´Ÿç›¸åŒï¼Œå–ä½™å’Œå–æ¨¡ç»“æœç›¸åŒï¼Œå½“xå’Œyæ­£è´Ÿä¸åŒï¼Œå–ä½™ç»“æœçš„ç¬¦å·å’Œxç›¸åŒï¼Œå–æ¨¡ç»“æœçš„ç¬¦å·å’Œyçš„ç¬¦å·ç›¸åŒã€‚å‡è®¾ï¼šè¢«é™¤æ•° a é™¤æ•° b å•†c ä½™æ•°d å…¬å¼ abcâ€¦d å¯ä»¥å˜å½¢ä¸º da-b*cé‚£ä¹ˆå…³é”®å°±åœ¨äºè¿™ä¸ªcå–ä»€ä¹ˆå€¼ã€‚ä¸¾ä¸ªæ —å­ï¼ša5ï¼Œb-2 ï¼Œé‚£ä¹ˆ 5Ã·(-2)-2.5 å–æ¨¡çš„æ—¶å€™ï¼Œå› ä¸ºmod å‡½æ•°é‡‡ç”¨äº† floor å‡½æ•°ï¼Œfloorå‡½æ•°æ˜¯å‘ä¸‹å–æ•´çš„ï¼Œæ‰€ä»¥-2.5å‘ä¸‹å–æ•´å°±æ˜¯-3ï¼Œé‚£ä¹ˆd5-(-2)*(-3)5-6-1ã€‚ å–ä½™(%)çš„æ—¶å€™ï¼Œå› ä¸ºrem å‡½æ•°é‡‡ç”¨ fix å‡½æ•°ï¼Œfixå‡½æ•°æ˜¯å‘0å–æ•´çš„ï¼Œæ‰€ä»¥-2.5å‘0å–æ•´å°±æ˜¯-2ï¼Œé‚£ä¹ˆd5-(-2)*(-2)5-41ã€‚ å‰è¨€æŸäº›é¢˜ç›®ï¼Œç”±äºè¦è®¡ç®—çš„ç­”æ¡ˆéå¸¸å¤§ï¼ˆè¶…å‡º 64 ä½æ•´æ•°çš„èŒƒå›´ï¼‰ï¼Œä¼šè¦æ±‚æŠŠç­”æ¡ˆå¯¹ 10e9+7 å–æ¨¡ã€‚å¦‚æœæ²¡æœ‰å¤„ç†å¾—å½“çš„è¯ï¼Œä¼š WAï¼ˆé”™è¯¯ï¼‰æˆ–è€… TLEï¼ˆè¶…æ—¶ï¼‰ã€‚ä¾‹å¦‚è®¡ç®—ä¸€å †æ•°å­—çš„ä¹˜ç§¯ï¼Œå¦‚æœæ²¡æœ‰åŠæ—¶å–æ¨¡ï¼Œä¹˜æ³•ä¼šæº¢å‡ºï¼ˆä¾‹å¦‚è®¡ç®—ç»“æœè¶…å‡º C++ ä¸­ long long çš„æœ€å¤§å€¼ï¼‰ï¼Œä»è€Œå¾—åˆ°å’Œé¢„æœŸä¸ç¬¦çš„ç­”æ¡ˆã€‚å¯¹äº Python æ¥è¯´ï¼Œè™½ç„¶æ²¡æœ‰æº¢å‡ºçš„é—®é¢˜ï¼Œä½†å¤§æ•´æ•°ï¼ˆbig integerï¼‰ä¹‹é—´çš„è¿ç®—å¹¶ä¸æ˜¯ O(1) çš„ï¼Œå¯èƒ½ä¼šå¯¼è‡´ TLEã€‚ å¦‚ä½•æ­£ç¡®çš„å–æ¨¡å‘¢? åŠ æ³•å’Œä¹˜æ³•çš„å–æ¨¡å¦‚æœè®©ä½ è®¡ç®— 1234Ã—6789 çš„ä¸ªä½æ•°ï¼Œä½ ä¼šå¦‚ä½•è®¡ç®—ï¼Ÿ ç”±äºåªæœ‰ä¸ªä½æ•°ä¼šå½±å“åˆ°ä¹˜ç§¯çš„ä¸ªä½æ•°ï¼Œé‚£ä¹ˆ 4Ã—936 çš„ä¸ªä½æ•° 6 å°±æ˜¯ç­”æ¡ˆã€‚ å¯¹äº 1234+6789 çš„ä¸ªä½æ•°ï¼ŒåŒç†ï¼Œ4+913 çš„ä¸ªä½æ•° 3 å°±æ˜¯ç­”æ¡ˆã€‚ ä½ èƒ½æŠŠè¿™ä¸ªç»“è®ºæŠ½è±¡æˆæ•°å­¦ç­‰å¼å—ï¼Ÿ ä¸€èˆ¬æ¶‰åŠåˆ°å–æ¨¡çš„é¢˜ç›®ï¼Œä¼šç”¨åˆ°å¦‚ä¸‹ä¸¤ä¸ªæ’ç­‰å¼ï¼Œå…¶ä¸­ mod è¡¨ç¤ºå–æ¨¡è¿ç®—ï¼ˆmoduloï¼‰ï¼Œå³ç¼–ç¨‹è¯­è¨€ä¸­çš„ %ã€‚ä¸Šé¢è®¡ç®—çš„æ˜¯ m10 çš„æƒ…å†µã€‚ æ ¹æ®è¿™ä¸¤ä¸ªæ’ç­‰å¼ï¼Œæˆ‘ä»¬å¯ä»¥åœ¨è®¡ç®—è¿‡ç¨‹ä¸­ï¼ˆä¾‹å¦‚å¾ªç¯ï¼‰ï¼Œå¯¹åŠ æ³•å’Œä¹˜æ³•çš„ç»“æœå–æ¨¡ï¼Œè€Œä¸æ˜¯åœ¨å¾ªç¯ç»“æŸåå†å–æ¨¡ã€‚æ³¨ï¼šå¦‚æœæ¶‰åŠåˆ°å¹‚è¿ç®—ï¼ŒæŒ‡æ•°æ˜¯ä¸èƒ½éšæ„å–æ¨¡çš„ã€‚å¦‚æœæŒ‡æ•°åœ¨ 64 ä½æ•´æ•°çš„èŒƒå›´å†…ï¼Œå¯ä»¥ç”¨å¿«é€Ÿå¹‚è®¡ç®—ï¼ŒåŸç†è§ä¸€å¼ å›¾ç§’æ‡‚å¿«é€Ÿå¹‚ï¼›å¦‚æœæŒ‡æ•°è¶…å‡º 64 ä½æ•´æ•°çš„èŒƒå›´ï¼Œè§æ¬§æ‹‰é™å¹‚ã€‚ å¦‚æœè®¡ç®—è¿‡ç¨‹ä¸­æœ‰å‡æ³•ï¼Œå¯èƒ½ä¼šäº§ç”Ÿè´Ÿæ•°ï¼Œå¤„ç†ä¸å½“ä¹Ÿä¼šå¯¼è‡´ WAã€‚å¦‚ä½•æ­£ç¡®å¤„ç†è¿™ç§æƒ…å†µå‘¢ï¼ŸåŒä½™ åŒä½™å¼çš„ç§»é¡¹åŒä½™å¼ä¸­çš„åŠ å‡æ³•å¯ä»¥ç§»é¡¹è´Ÿæ•°å’Œå‡æ³•çš„å–æ¨¡ é™¤æ³•çš„å–æ¨¡è¯æ˜: æ±‚æ¨¡è¿ç®—æ€»ç»“ ä»£ç å®ç°æ—¶ï¼Œä¸Šé¢çš„åŠ å‡ä¹˜é™¤é€šå¸¸æ˜¯è¿™æ ·å†™çš„ï¼š MOD = 1_000_000_007// åŠ (a + b) % MOD// å‡ï¼Œb åœ¨ [0,MOD-1] ä¸­(a - b + MOD) % MOD// æŠŠä»»æ„æ•´æ•° a å–æ¨¡åˆ° [0,MOD-1] ä¸­ï¼Œæ— è®º a æ˜¯æ­£æ˜¯è´Ÿ(a % MOD + MOD) % MOD// ä¹˜ï¼ˆæ³¨æ„ä½¿ç”¨ 64 ä½æ•´æ•°ï¼‰a * b % MOD// å¤šä¸ªæ•°ç›¸ä¹˜ï¼Œè¦æ­¥æ­¥å–æ¨¡ï¼Œé˜²æ­¢æº¢å‡ºa * b % MOD * c % MOD// é™¤ï¼ˆMOD æ˜¯è´¨æ•°ä¸” b ä¸æ˜¯ MOD çš„å€æ•°ï¼‰a * qpow(b, MOD - 2, MOD) % MOD å…¶ä¸­ qpow ä¸ºå¿«é€Ÿå¹‚. æ€»ä¹‹ï¼Œå¦‚æœå‘ç°è§£ç­”é”™è¯¯ï¼Œå¯ä»¥æ£€æŸ¥ä¸‹ä»£ç ï¼Œçœ‹çœ‹æ˜¯ä¸æ˜¯å“ªé‡Œæ¼æ‰å–æ¨¡äº†ã€‚é™„:ç»„åˆæ•°è®¡ç®—æ¨¡æ¿ä»£ç å¦‚ä¸‹: class Solution private static final int MOD = 1_000_000_007; private static final int MX = 100_001; // æ ¹æ®é¢˜ç›®æ•°æ®èŒƒå›´ä¿®æ”¹ private static final long[] F = new long[MX]; // F[i] = i! private static final long[] INV_F = new long[MX]; // INV_F[i] = i!^-1 = pow(i!, MOD-2) static F[0] = 1; for (int i = 1; i MX; i++) F[i] = F[i - 1] * i % MOD; INV_F[MX - 1] = pow(F[MX - 1], MOD - 2); for (int i = MX - 1; i 0; i--) INV_F[i - 1] = INV_F[i] * i % MOD; private static long pow(long x, int n) long res = 1; for (; n 0; n /= 2) if (n % 2 0) res = res * x % MOD; x = x * x % MOD; return res; // ä» n ä¸ªæ•°ä¸­é€‰ m ä¸ªæ•°çš„æ–¹æ¡ˆæ•° private long comb(int n, int m) return m 0 || m n ? 0 : F[n] * INV_F[m] % MOD * INV_F[n - m] % MOD; public int solve(int[] nums) // é¢„å¤„ç†çš„é€»è¾‘å†™åœ¨ static å—ä¸­ï¼Œè¿™æ ·åªä¼šåˆå§‹åŒ–ä¸€æ¬¡ å¿«é€Ÿå¹‚ä¸€å›¾æµ(çµç¥): ä»£ç å®ç°æ—¶ï¼Œæ³¨æ„ nâˆ’2^31çš„æƒ…å†µï¼Œå–åå n2^31è¶…å‡º int æœ€å¤§å€¼ã€‚å¯ä»¥è½¬æˆ 64 ä½ int è§£å†³ã€‚æ¨¡ç‰ˆ: class Solution public double myPow(double x, int N) double ans = 1; long n = N; if (n 0) // x^-n = (1/x)^n n = -n; x = 1 / x; while (n != 0) // ä»ä½åˆ°é«˜æšä¸¾ n çš„æ¯ä¸ªæ¯”ç‰¹ä½ if ((n 1) == 1) // è¿™ä¸ªæ¯”ç‰¹ä½æ˜¯ 1 ans *= x; // æŠŠ x ä¹˜åˆ° ans ä¸­ x *= x; // x è‡ªèº«å¹³æ–¹ n = 1; // ç»§ç»­æšä¸¾ä¸‹ä¸€ä¸ªæ¯”ç‰¹ä½ return ans; äºŒè¿›åˆ¶ä»é›†åˆè®ºåˆ°ä½è¿ç®—ï¼Œå¸¸è§ä½è¿ç®—æŠ€å·§åˆ†ç±»æ€»ç»“ s = 101100 s-1 = 101011 // æœ€ä½ä½çš„ 1 å˜æˆ 0ï¼ŒåŒæ—¶ 1 å³è¾¹çš„ 0 éƒ½å–åï¼Œå˜æˆ 1s(s-1) = 101000 ç‰¹åˆ«åœ°ï¼Œå¦‚æœ s æ˜¯ 2 çš„å¹‚ï¼Œé‚£ä¹ˆ s(sâˆ’1)0ã€‚ æ­¤å¤–ï¼Œç¼–ç¨‹è¯­è¨€æä¾›äº†ä¸€äº›å’ŒäºŒè¿›åˆ¶æœ‰å…³çš„åº“å‡½æ•°ï¼Œä¾‹å¦‚ï¼š è®¡ç®—äºŒè¿›åˆ¶ä¸­çš„ 1 çš„ä¸ªæ•°ï¼Œä¹Ÿå°±æ˜¯é›†åˆå¤§å°ï¼› è®¡ç®—äºŒè¿›åˆ¶é•¿åº¦ï¼Œå‡ä¸€åå¾—åˆ°é›†åˆæœ€å¤§å…ƒç´ ï¼› è®¡ç®—äºŒè¿›åˆ¶å°¾é›¶ä¸ªæ•°ï¼Œä¹Ÿå°±æ˜¯é›†åˆæœ€å°å…ƒç´ ã€‚ è°ƒç”¨è¿™äº›å‡½æ•°çš„æ—¶é—´å¤æ‚åº¦éƒ½æ˜¯ O(1)ã€‚ s = 101100 ~s = 010011(~s)+1 = 010100 // æ ¹æ®è¡¥ç çš„å®šä¹‰ï¼Œè¿™å°±æ˜¯ -s = s çš„æœ€ä½ 1 å·¦ä¾§å–åï¼Œå³ä¾§ä¸å˜s -s = 000100 // lowbit éå†é›†åˆ for (int i = 0; i n; i++) if (((s i) 1) == 1) // i åœ¨ s ä¸­ // å¤„ç† i çš„é€»è¾‘ for (int t = s; t 0; t = t - 1) int i = Integer.numberOfTrailingZeros(t); // å¤„ç† i çš„é€»è¾‘ å››ã€æšä¸¾é›†åˆÂ§4.1 æšä¸¾æ‰€æœ‰é›†åˆè®¾å…ƒç´ èŒƒå›´ä» 0 åˆ° nâˆ’1ï¼Œä»ç©ºé›† âˆ… æšä¸¾åˆ°å…¨é›† Uï¼š for (int s = 0; s (1 n); s++) // å¤„ç† s çš„é€»è¾‘ Â§4.2 æšä¸¾éç©ºå­é›†è®¾é›†åˆä¸º sï¼Œä»å¤§åˆ°å°æšä¸¾ s çš„æ‰€æœ‰éç©ºå­é›† subï¼š for (int sub = s; sub 0; sub = (sub - 1) s) // å¤„ç† sub çš„é€»è¾‘ ä¸ºä»€ä¹ˆè¦å†™æˆ sub (sub - 1) s å‘¢ï¼Ÿ æš´åŠ›åšæ³•æ˜¯ä» s å‡ºå‘ï¼Œä¸æ–­å‡ä¸€ï¼Œç›´åˆ° 0ã€‚ä½†è¿™æ ·åšï¼Œä¸­é€”ä¼šé‡åˆ°å¾ˆå¤šå¹¶ä¸æ˜¯ s çš„å­é›†çš„æƒ…å†µã€‚ä¾‹å¦‚ s10101 æ—¶ï¼Œå‡ä¸€å¾—åˆ° 10100ï¼Œè¿™æ˜¯ s çš„å­é›†ã€‚ä½†å†å‡ä¸€å°±å¾—åˆ° 10011 äº†ï¼Œè¿™å¹¶ä¸æ˜¯ s çš„å­é›†ï¼Œä¸‹ä¸€ä¸ªå­é›†åº”è¯¥æ˜¯ 10001ã€‚ æŠŠæ‰€æœ‰çš„åˆæ³•å­é›†æŒ‰é¡ºåºåˆ—å‡ºæ¥ï¼Œä¼šå‘ç°æˆ‘ä»¬åšçš„ç›¸å½“äºã€Œå‹ç¼©ç‰ˆã€çš„äºŒè¿›åˆ¶å‡æ³•ï¼Œä¾‹å¦‚ 10101â†’10100â†’10001â†’10000â†’00101â†’â‹¯å¦‚æœå¿½ç•¥æ‰ 10101 ä¸­çš„ä¸¤ä¸ª 0ï¼Œæ•°å­—çš„å˜åŒ–å’ŒäºŒè¿›åˆ¶å‡æ³•æ˜¯ä¸€æ ·çš„ï¼Œå³ 111â†’110â†’101â†’100â†’011â†’â‹¯å¦‚ä½•å¿«é€Ÿè·³åˆ°ä¸‹ä¸€ä¸ªå­é›†å‘¢ï¼Ÿæ¯”å¦‚ï¼Œæ€ä¹ˆä» 10100 è·³åˆ° 10001ï¼Ÿ æ™®é€šçš„äºŒè¿›åˆ¶å‡æ³•ï¼Œæ˜¯ 10100âˆ’110011ï¼Œä¹Ÿå°±æ˜¯æŠŠæœ€ä½ä½çš„ 1 å˜æˆ 0ï¼ŒåŒæ—¶æŠŠæœ€ä½ä½çš„ 1 å³è¾¹çš„ 0 éƒ½å˜æˆ 1ã€‚å‹ç¼©ç‰ˆçš„äºŒè¿›åˆ¶å‡æ³•ä¹Ÿæ˜¯ç±»ä¼¼çš„ï¼Œå¯¹äº 10100â†’10001ï¼Œä¹Ÿä¼šæŠŠæœ€ä½ä½çš„ 1 å˜æˆ 0ï¼Œå¯¹äºæœ€ä½ä½çš„ 1 å³è¾¹çš„ 0ï¼Œå¹¶ä¸æ˜¯éƒ½å˜æˆ 1ï¼Œåªæœ‰åœ¨ s10101 ä¸­çš„ 1 æ‰ä¼šå˜æˆ 1ã€‚æ€ä¹ˆåšåˆ°ï¼Ÿå‡ä¸€å 10101 å°±è¡Œï¼Œä¹Ÿå°±æ˜¯ (10100âˆ’1) 1010110001ã€‚Â§4.3 æšä¸¾å­é›†ï¼ˆåŒ…å«ç©ºé›†ï¼‰å¦‚æœè¦ä»å¤§åˆ°å°æšä¸¾ s çš„æ‰€æœ‰å­é›† subï¼ˆä» s æšä¸¾åˆ°ç©ºé›† âˆ…ï¼‰ï¼Œå¯ä»¥è¿™æ ·å†™ï¼š int sub = s;do // å¤„ç† sub çš„é€»è¾‘ sub = (sub - 1) s; while (sub != s); å…¶ä¸­ Java å’Œ C++ çš„åŸç†æ˜¯ï¼Œå½“ sub0 æ—¶ï¼ˆç©ºé›†ï¼‰ï¼Œå†å‡ä¸€å°±å¾—åˆ° âˆ’1ï¼Œå¯¹åº”çš„äºŒè¿›åˆ¶ä¸º 111â‹¯1ï¼Œå† s å°±å¾—åˆ°äº† sã€‚æ‰€ä»¥å½“å¾ªç¯åˆ° subs æ—¶ï¼Œè¯´æ˜æœ€åä¸€æ¬¡å¾ªç¯çš„ sub0ï¼ˆç©ºé›†ï¼‰ï¼Œs çš„æ‰€æœ‰å­é›†éƒ½æšä¸¾åˆ°äº†ï¼Œé€€å‡ºå¾ªç¯ã€‚ æ³¨ï¼šè¿˜å¯ä»¥æšä¸¾å…¨é›† U çš„æ‰€æœ‰å¤§å°æ°å¥½ä¸º k çš„å­é›†ï¼Œè¿™ä¸€æŠ€å·§å«åš Gosperâ€™s Hackï¼Œå…·ä½“è¯·çœ‹ è§†é¢‘è®²è§£ã€‚ Â§4.4 æšä¸¾è¶…é›†å¦‚æœ T æ˜¯ S çš„å­é›†ï¼Œé‚£ä¹ˆç§° S æ˜¯ T çš„è¶…é›†ï¼ˆsupersetï¼‰ã€‚ æšä¸¾è¶…é›†çš„åŸç†å’Œä¸Šæ–‡æšä¸¾å­é›†æ˜¯ç±»ä¼¼çš„ï¼Œè¿™é‡Œé€šè¿‡æˆ–è¿ç®—ä¿è¯æšä¸¾çš„é›†åˆ S ä¸€å®šåŒ…å«é›†åˆ T ä¸­çš„æ‰€æœ‰å…ƒç´ ã€‚ æšä¸¾ Sï¼Œæ»¡è¶³ S æ˜¯ T çš„è¶…é›†ï¼Œä¹Ÿæ˜¯å…¨é›† U{0,1,2,â€¦,nâˆ’1} çš„å­é›†ã€‚ for (int s = t; s (1 n); s = (s + 1) | t) // å¤„ç† s çš„é€»è¾‘ æ•°ç»„ äºŒåˆ†æŸ¥æ‰¾https://leetcode.cn/problems/binary-search/é€šç”¨æ¨¡æ¿ï¼š class Solution public int search(int[] nums, int target) int i = lowerBound(nums, target); // é€‰æ‹©å…¶ä¸­ä¸€ç§å†™æ³•å³å¯ return i nums.length nums[i] == target ? i : -1; // ã€ä¸‹é¢åˆ—äº†ä¸‰ç§å†™æ³•ï¼Œé€‰ä¸€ç§è‡ªå·±å–œæ¬¢çš„å°±è¡Œã€‘ // lowerBound è¿”å›æœ€å°çš„æ»¡è¶³ nums[i] = target çš„ i // å¦‚æœæ•°ç»„ä¸ºç©ºï¼Œæˆ–è€…æ‰€æœ‰æ•°éƒ½ targetï¼Œåˆ™è¿”å› nums.length // è¦æ±‚ nums æ˜¯éé€’å‡çš„ï¼Œå³ nums[i] = nums[i + 1] // é—­åŒºé—´å†™æ³• private int lowerBound(int[] nums, int target) int left = 0, right = nums.length - 1; // é—­åŒºé—´ [left, right] while (left = right) // åŒºé—´ä¸ä¸ºç©º // å¾ªç¯ä¸å˜é‡ï¼š // nums[left-1] target // nums[right+1] = target int mid = left + (right - left) / 2; if (nums[mid] target) left = mid + 1; // èŒƒå›´ç¼©å°åˆ° [mid+1, right] else right = mid - 1; // èŒƒå›´ç¼©å°åˆ° [left, mid-1] return left; // æˆ–è€… right+1 // å·¦é—­å³å¼€åŒºé—´å†™æ³• private int lowerBound2(int[] nums, int target) int left = 0, right = nums.length; // å·¦é—­å³å¼€åŒºé—´ [left, right) while (left right) // åŒºé—´ä¸ä¸ºç©º // å¾ªç¯ä¸å˜é‡ï¼š // nums[left-1] target // nums[right] = target int mid = left + (right - left) / 2; if (nums[mid] target) left = mid + 1; // èŒƒå›´ç¼©å°åˆ° [mid+1, right) else right = mid; // èŒƒå›´ç¼©å°åˆ° [left, mid) return left; // æˆ–è€… right // å¼€åŒºé—´å†™æ³• private int lowerBound3(int[] nums, int target) int left = -1, right = nums.length; // å¼€åŒºé—´ (left, right) while (left + 1 right) // åŒºé—´ä¸ä¸ºç©º // å¾ªç¯ä¸å˜é‡ï¼š // nums[left] target // nums[right] = target int mid = left + (right - left) / 2; if (nums[mid] target) left = mid; // èŒƒå›´ç¼©å°åˆ° (mid, right) else right = mid; // èŒƒå›´ç¼©å°åˆ° (left, mid) return right; // æˆ–è€… left+1 äºŒåˆ†æ³•æ•°ç»„ï¼šæ¯æ¬¡é‡åˆ°äºŒåˆ†æ³•ï¼Œéƒ½æ˜¯ä¸€çœ‹å°±ä¼šï¼Œä¸€å†™å°±åºŸ æš´åŠ›è§£æ³•æ—¶é—´å¤æ‚åº¦ï¼šO(n) äºŒåˆ†æ³•æ—¶é—´å¤æ‚åº¦ï¼šO(logn) åŒæŒ‡é’ˆåŒæŒ‡é’ˆæ³• æ•°ç»„ï¼šå°±ç§»é™¤ä¸ªå…ƒç´ å¾ˆéš¾ä¹ˆï¼Ÿ(opens new window) åŒæŒ‡é’ˆæ³•ï¼ˆå¿«æ…¢æŒ‡é’ˆæ³•ï¼‰ï¼šé€šè¿‡ä¸€ä¸ªå¿«æŒ‡é’ˆå’Œæ…¢æŒ‡é’ˆåœ¨ä¸€ä¸ªforå¾ªç¯ä¸‹å®Œæˆä¸¤ä¸ªforå¾ªç¯çš„å·¥ä½œã€‚ æš´åŠ›è§£æ³•æ—¶é—´å¤æ‚åº¦ï¼šO(n^2) åŒæŒ‡é’ˆæ—¶é—´å¤æ‚åº¦ï¼šO(n) æ»‘åŠ¨çª—å£æ»‘åŠ¨çª—å£ æ•°ç»„ï¼šæ»‘åŠ¨çª—å£æ‹¯æ•‘äº†ä½ (opens new window) æ»‘åŠ¨çª—å£çš„ç²¾å¦™ä¹‹å¤„åœ¨äºæ ¹æ®å½“å‰å­åºåˆ—å’Œå¤§å°çš„æƒ…å†µï¼Œä¸æ–­è°ƒèŠ‚å­åºåˆ—çš„èµ·å§‹ä½ç½®ã€‚ä»è€Œå°†O(n^2)çš„æš´åŠ›è§£æ³•é™ä¸ºO(n)ã€‚ æ¨¡æ‹Ÿè¡Œä¸º æ•°ç»„ï¼šè¿™ä¸ªå¾ªç¯å¯ä»¥è½¬æ‡µå¾ˆå¤šäºº åœ¨è¿™é“é¢˜ç›®ä¸­ï¼Œæˆ‘ä»¬å†ä¸€æ¬¡ä»‹ç»åˆ°äº†å¾ªç¯ä¸å˜é‡åŸåˆ™ï¼Œå…¶å®è¿™ä¹Ÿæ˜¯å†™ç¨‹åºä¸­çš„é‡è¦åŸåˆ™ã€‚ ç›¸ä¿¡å¤§å®¶æœ‰é‡åˆ°è¿‡è¿™ç§æƒ…å†µï¼š æ„Ÿè§‰é¢˜ç›®çš„è¾¹ç•Œè°ƒèŠ‚è¶…å¤šï¼Œä¸€æ³¢æ¥ç€ä¸€æ³¢çš„åˆ¤æ–­ï¼Œæ‰¾è¾¹ç•Œï¼Œæ‹†äº†ä¸œå¢™è¡¥è¥¿å¢™ï¼Œå¥½ä¸å®¹æ˜“è¿è¡Œé€šè¿‡äº†ï¼Œä»£ç å†™çš„ååˆ†å†—ä½™ï¼Œæ¯«æ— ç« æ³•ï¼Œå…¶å®çœŸæ­£è§£å†³é¢˜ç›®çš„ä»£ç éƒ½æ˜¯ç®€æ´çš„ï¼Œæˆ–è€…æœ‰åŸåˆ™æ€§çš„ï¼Œå¤§å®¶å¯ä»¥åœ¨è¿™é“é¢˜ç›®ä¸­ä½“ä¼šåˆ°è¿™ä¸€ç‚¹ã€‚ å‰ç¼€å’Œé“¾è¡¨JAVAç‰ˆæœ¬ public class ListNode // ç»“ç‚¹çš„å€¼ int val; // ä¸‹ä¸€ä¸ªç»“ç‚¹ ListNode next; // èŠ‚ç‚¹çš„æ„é€ å‡½æ•°(æ— å‚) public ListNode() // èŠ‚ç‚¹çš„æ„é€ å‡½æ•°(æœ‰ä¸€ä¸ªå‚æ•°) public ListNode(int val) this.val = val; // èŠ‚ç‚¹çš„æ„é€ å‡½æ•°(æœ‰ä¸¤ä¸ªå‚æ•°) public ListNode(int val, ListNode next) this.val = val; this.next = next; ç§»é™¤é“¾è¡¨å…ƒç´ è®¾è®¡é“¾è¡¨åè½¬é“¾è¡¨åŸåœ°åè½¬ï¼Œåªéœ€è¦æŠŠæ¯ä¸ªèŠ‚ç‚¹é—´çš„æŒ‡å‘åè½¬å°±å¯ä»¥å°è¯•é€’å½’è°ƒç”¨ä¸¤ä¸¤äº¤æ¢é“¾è¡¨ä¸­çš„èŠ‚ç‚¹åˆ é™¤é“¾è¡¨çš„å€’æ•°ç¬¬Nä¸ªèŠ‚ç‚¹é“¾è¡¨ç›¸äº¤ç¯å½¢é“¾è¡¨IIç¯å½¢é“¾è¡¨å¿«æ…¢æŒ‡é’ˆä¸€åŒèµ° ç›¸é‡åå·®ä¸€åœˆ ç»“è®ºa cä»èµ·ç‚¹å’Œç›¸é‡ç‚¹åŒæ—¶èµ° å°±æ˜¯å…¥å£ç‚¹ç›¸ä¼¼é¢˜: https://leetcode.cn/problems/find-the-duplicate-numberè¿™ä¸ªæ˜¯æ•°ç»„æ¨¡æ‹Ÿç¯å½¢é“¾è¡¨,éå¸¸æœ‰æ„æ€ class Solution public int findDuplicate(int[] nums) int slow = 0; int fast = 0; slow = nums[slow]; fast = nums[nums[fast]]; while(slow != fast) slow = nums[slow]; fast = nums[nums[fast]]; int pre1 = 0; int pre2 = slow; while(pre1 != pre2) pre1 = nums[pre1]; pre2 = nums[pre2]; return pre1; å“ˆå¸Œè¡¨é¢˜ç›®242.æœ‰æ•ˆçš„å­—æ¯å¼‚ä½è¯åŠ›æ‰£é¢˜ç›®é“¾æ¥349.ä¸¤ä¸ªæ•°ç»„çš„äº¤é›†åŠ›æ‰£é¢˜ç›®é“¾æ¥ç¬¬202é¢˜. å¿«ä¹æ•°åŠ›æ‰£é¢˜ç›®é“¾æ¥ä¸¤æ•°ä¹‹å’ŒåŠ›æ‰£é¢˜ç›®é“¾æ¥ç¬¬454é¢˜.å››æ•°ç›¸åŠ IIåŠ›æ‰£é¢˜ç›®é“¾æ¥èµé‡‘ä¿¡åŠ›æ‰£é¢˜ç›®é“¾æ¥ç¬¬15é¢˜. ä¸‰æ•°ä¹‹å’ŒåŠ›æ‰£é¢˜ç›®é“¾æ¥ç¬¬18é¢˜. å››æ•°ä¹‹å’ŒåŠ›æ‰£é¢˜ç›®é“¾æ¥ å­—ç¬¦ä¸²KMPç®—æ³•ä»‹ç»:KMP ç®—æ³•æ˜¯ä¸€ä¸ªå¿«é€ŸæŸ¥æ‰¾åŒ¹é…ä¸²çš„ç®—æ³•ï¼Œå®ƒçš„ä½œç”¨å…¶å®å°±æ˜¯æœ¬é¢˜é—®é¢˜ï¼šå¦‚ä½•å¿«é€Ÿåœ¨ã€ŒåŸå­—ç¬¦ä¸²ã€ä¸­æ‰¾åˆ°ã€ŒåŒ¹é…å­—ç¬¦ä¸²ã€ã€‚ ä¸Šè¿°çš„æœ´ç´ è§£æ³•ï¼Œä¸è€ƒè™‘å‰ªæçš„è¯å¤æ‚åº¦æ˜¯ O(mâˆ—n) çš„ï¼Œè€Œ KMP ç®—æ³•çš„å¤æ‚åº¦ä¸º O(m+n)ã€‚ KMP ä¹‹æ‰€ä»¥èƒ½å¤Ÿåœ¨ O(m+n) å¤æ‚åº¦å†…å®ŒæˆæŸ¥æ‰¾ï¼Œæ˜¯å› ä¸ºå…¶èƒ½åœ¨ã€Œéå®Œå…¨åŒ¹é…ã€çš„è¿‡ç¨‹ä¸­æå–åˆ°æœ‰æ•ˆä¿¡æ¯è¿›è¡Œå¤ç”¨ï¼Œä»¥å‡å°‘ã€Œé‡å¤åŒ¹é…ã€çš„æ¶ˆè€—ã€‚ä¸ªäººç†è§£:é€šè¿‡æ„é€ ä¸€ä¸ªnextæ•°ç»„,ä½¿çš„å‰ç¼€ä¸€æ ·çš„éƒ¨åˆ†èƒ½å¤Ÿå¿«é€Ÿè·³è½¬,å‰ç¼€ä¸€æ ·,ä½†æ˜¯åé¢çš„ä¸€ä¸ªä¸ä¸€æ ·,é‚£å°±å¯ä»¥ç›´æ¥é€šè¿‡nextæ•°ç»„è·³è½¬åˆ°ä¸Šä¸€ä¸ªå‰ç¼€ä¸€æ ·çš„ä½ç½®çš„ä¸‹æ ‡,ç„¶åç»§ç»­åŒ¹é….æ‰€ä»¥è¿™ä¸ªç®—æ³•çš„å…³é”®å°±æ˜¯æ„é€ nextæ•°ç»„.çœ‹åˆ°çš„ä¸€ä¸ªæ¯”è¾ƒå¥½çš„å®ç°æ–¹å¼å°±æ˜¯åœ¨ä¸»ä¸²å’ŒåŒ¹é…ä¸²å‰é¢éƒ½åŠ ä¸Šä¸€ä¸ªç©ºæ ¼,è¿™æ ·å°±å¯ä»¥ä¿è¯nextæ•°ç»„çš„ä¸‹æ ‡ä»1å¼€å§‹,è¿™æ ·å°±å¯ä»¥é¿å…å¾ˆå¤šè¾¹ç•Œé—®é¢˜. å…ˆè´´ä¸€ä¸ªå®ç°: class Solution // KMP ç®—æ³• // ss: åŸä¸²(string) pp: åŒ¹é…ä¸²(pattern) public int strStr(String ss, String pp) if (pp.isEmpty()) return 0; // åˆ†åˆ«è¯»å–åŸä¸²å’ŒåŒ¹é…ä¸²çš„é•¿åº¦ int n = ss.length(), m = pp.length(); // åŸä¸²å’ŒåŒ¹é…ä¸²å‰é¢éƒ½åŠ ç©ºæ ¼ï¼Œä½¿å…¶ä¸‹æ ‡ä» 1 å¼€å§‹ ss = + ss; pp = + pp; char[] s = ss.toCharArray(); char[] p = pp.toCharArray(); // æ„å»º next æ•°ç»„ï¼Œæ•°ç»„é•¿åº¦ä¸ºåŒ¹é…ä¸²çš„é•¿åº¦ï¼ˆnext æ•°ç»„æ˜¯å’ŒåŒ¹é…ä¸²ç›¸å…³çš„ï¼‰ int[] next = new int[m + 1]; // æ„é€ è¿‡ç¨‹ i = 2ï¼Œj = 0 å¼€å§‹ï¼Œi å°äºç­‰äºåŒ¹é…ä¸²é•¿åº¦ ã€æ„é€  i ä» 2 å¼€å§‹ã€‘ for (int i = 2, j = 0; i = m; i++) // åŒ¹é…ä¸æˆåŠŸçš„è¯ï¼Œj = next(j) while (j 0 p[i] != p[j + 1]) j = next[j]; // åŒ¹é…æˆåŠŸçš„è¯ï¼Œå…ˆè®© j++ if (p[i] == p[j + 1]) j++; // æ›´æ–° next[i]ï¼Œç»“æŸæœ¬æ¬¡å¾ªç¯ï¼Œi++ next[i] = j; // åŒ¹é…è¿‡ç¨‹ï¼Œi = 1ï¼Œj = 0 å¼€å§‹ï¼Œi å°äºç­‰äºåŸä¸²é•¿åº¦ ã€åŒ¹é… i ä» 1 å¼€å§‹ã€‘ for (int i = 1, j = 0; i = n; i++) // åŒ¹é…ä¸æˆåŠŸ j = next(j) while (j 0 s[i] != p[j + 1]) j = next[j]; // åŒ¹é…æˆåŠŸçš„è¯ï¼Œå…ˆè®© j++ï¼Œç»“æŸæœ¬æ¬¡å¾ªç¯å i++ if (s[i] == p[j + 1]) j++; // æ•´ä¸€æ®µåŒ¹é…æˆåŠŸï¼Œç›´æ¥è¿”å›ä¸‹æ ‡ if (j == m) return i - m; return -1; nextæ•°ç»„æ„é€ : åŒ¹é…è¿‡ç¨‹: é¢˜ç›®344.åè½¬å­—ç¬¦ä¸²åŠ›æ‰£é¢˜ç›®é“¾æ¥ aa^b: å…ˆæŠŠaå’Œbä¸­ï¼Œä¸ç›¸åŒçš„ä½ä¿å­˜åˆ°aï¼Œç°åœ¨aä¸­ç½®1çš„ä½ï¼Œä»£è¡¨åŸå§‹çš„aå’Œbä¸ç›¸åŒçš„ä½ï¼Œè€Œ0ï¼Œå°±æ˜¯aå’Œbç›¸åŒçš„ä½ã€‚ ba^b: ä¸ç›¸åŒçš„ä½æ˜¯1å’ŒåŸå§‹bå¼‚æˆ–ï¼Œå°±å¾—åˆ°åŸå§‹açš„é‚£ä¸ªä½çš„å€¼ï¼›ç›¸åŒçš„ä½æ˜¯0å’ŒåŸå§‹bå¼‚æˆ–å°±æ˜¯åŸå§‹aæˆ–è€…åŸå§‹bçš„å€¼ï¼ˆæœ¬æ¥å°±ç›¸åŒï¼‰ã€‚ç°åœ¨å¾—åˆ°çš„å°±æ˜¯åŸå§‹açš„å€¼ï¼Œç°åœ¨å­˜åœ¨bä¸­ã€‚ aa^bï¼šå’Œä¸Šé¢ç›¸åŒã€‚ aï¼Œbå·²ç»äº¤æ¢ã€‚ 1.åè½¬å­—ç¬¦ä¸²IIåŠ›æ‰£é¢˜ç›®é“¾æ¥ äºŒå‰æ ‘äºŒå‰æ ‘åŸºç¡€ æ»¡äºŒå‰æ ‘:å¦‚æœä¸€æ£µäºŒå‰æ ‘åªæœ‰åº¦ä¸º0çš„ç»“ç‚¹å’Œåº¦ä¸º2çš„ç»“ç‚¹ï¼Œå¹¶ä¸”åº¦ä¸º0çš„ç»“ç‚¹åœ¨åŒä¸€å±‚ä¸Šï¼Œåˆ™è¿™æ£µäºŒå‰æ ‘ä¸ºæ»¡äºŒå‰æ ‘ã€‚ å®Œå…¨äºŒå‰æ ‘:åœ¨å®Œå…¨äºŒå‰æ ‘ä¸­ï¼Œé™¤äº†æœ€åº•å±‚èŠ‚ç‚¹å¯èƒ½æ²¡å¡«æ»¡å¤–ï¼Œå…¶ä½™æ¯å±‚èŠ‚ç‚¹æ•°éƒ½è¾¾åˆ°æœ€å¤§å€¼ï¼Œå¹¶ä¸”æœ€ä¸‹é¢ä¸€å±‚çš„èŠ‚ç‚¹éƒ½é›†ä¸­åœ¨è¯¥å±‚æœ€å·¦è¾¹çš„è‹¥å¹²ä½ç½®ã€‚è‹¥æœ€åº•å±‚ä¸ºç¬¬ h å±‚ï¼ˆhä»1å¼€å§‹ï¼‰ï¼Œåˆ™è¯¥å±‚åŒ…å« 1~ 2^(h-1) ä¸ªèŠ‚ç‚¹ã€‚ä¹Ÿå°±æ˜¯åªæœ‰æœ€åä¸€å±‚å³ä¾§ä¸æ»¡,å‰é¢éƒ½æ˜¯æ»¡çš„. äºŒå‰æœç´¢æ ‘:äºŒå‰æœç´¢æ ‘æ˜¯ä¸€ä¸ªæœ‰åºæ ‘ è‹¥å®ƒçš„å·¦å­æ ‘ä¸ç©ºï¼Œåˆ™å·¦å­æ ‘ä¸Šæ‰€æœ‰ç»“ç‚¹çš„å€¼å‡å°äºå®ƒçš„æ ¹ç»“ç‚¹çš„å€¼ï¼› è‹¥å®ƒçš„å³å­æ ‘ä¸ç©ºï¼Œåˆ™å³å­æ ‘ä¸Šæ‰€æœ‰ç»“ç‚¹çš„å€¼å‡å¤§äºå®ƒçš„æ ¹ç»“ç‚¹çš„å€¼ï¼› å®ƒçš„å·¦ã€å³å­æ ‘ä¹Ÿåˆ†åˆ«ä¸ºäºŒå‰æ’åºæ ‘ å¹³è¡¡äºŒå‰æœç´¢æ ‘:å¹³è¡¡äºŒå‰æœç´¢æ ‘ï¼šåˆè¢«ç§°ä¸ºAVLï¼ˆAdelson-Velsky and Landisï¼‰æ ‘ï¼Œä¸”å…·æœ‰ä»¥ä¸‹æ€§è´¨ï¼šå®ƒæ˜¯ä¸€æ£µç©ºæ ‘æˆ–å®ƒçš„å·¦å³ä¸¤ä¸ªå­æ ‘çš„é«˜åº¦å·®çš„ç»å¯¹å€¼ä¸è¶…è¿‡1ï¼Œå¹¶ä¸”å·¦å³ä¸¤ä¸ªå­æ ‘éƒ½æ˜¯ä¸€æ£µå¹³è¡¡äºŒå‰æ ‘ã€‚ äºŒå‰æ ‘çš„å­˜å‚¨æ–¹å¼äºŒå‰æ ‘å¯ä»¥é“¾å¼å­˜å‚¨ï¼Œä¹Ÿå¯ä»¥é¡ºåºå­˜å‚¨ã€‚ äºŒå‰æ ‘éå†é¡ºåºå‰åºéå†ï¼šä¸­å·¦å³ä¸­åºéå†ï¼šå·¦ä¸­å³ååºéå†ï¼šå·¦å³ä¸­ public class TreeNode int val; TreeNode left; TreeNode right; TreeNode() TreeNode(int val) this.val = val; TreeNode(int val, TreeNode left, TreeNode right) this.val = val; this.left = left; this.right = right; äºŒå‰æ ‘é€’å½’éå†é€’å½’çš„ä¸‰è¦ç´ :1.ç¡®å®šé€’å½’å‡½æ•°çš„å‚æ•°å’Œè¿”å›å€¼ï¼š ç¡®å®šå“ªäº›å‚æ•°æ˜¯é€’å½’çš„è¿‡ç¨‹ä¸­éœ€è¦å¤„ç†çš„ï¼Œé‚£ä¹ˆå°±åœ¨é€’å½’å‡½æ•°é‡ŒåŠ ä¸Šè¿™ä¸ªå‚æ•°ï¼Œ å¹¶ä¸”è¿˜è¦æ˜ç¡®æ¯æ¬¡é€’å½’çš„è¿”å›å€¼æ˜¯ä»€ä¹ˆè¿›è€Œç¡®å®šé€’å½’å‡½æ•°çš„è¿”å›ç±»å‹ã€‚ 2.ç¡®å®šç»ˆæ­¢æ¡ä»¶ï¼š å†™å®Œäº†é€’å½’ç®—æ³•, è¿è¡Œçš„æ—¶å€™ï¼Œç»å¸¸ä¼šé‡åˆ°æ ˆæº¢å‡ºçš„é”™è¯¯ï¼Œå°±æ˜¯æ²¡å†™ç»ˆæ­¢æ¡ä»¶æˆ–è€…ç»ˆæ­¢æ¡ä»¶å†™çš„ä¸å¯¹ï¼Œæ“ä½œç³»ç»Ÿä¹Ÿæ˜¯ç”¨ä¸€ä¸ªæ ˆçš„ç»“æ„æ¥ä¿å­˜æ¯ä¸€å±‚é€’å½’çš„ä¿¡æ¯ï¼Œå¦‚æœé€’å½’æ²¡æœ‰ç»ˆæ­¢ï¼Œæ“ä½œç³»ç»Ÿçš„å†…å­˜æ ˆå¿…ç„¶å°±ä¼šæº¢å‡ºã€‚ 3.ç¡®å®šå•å±‚é€’å½’çš„é€»è¾‘ï¼š ç¡®å®šæ¯ä¸€å±‚é€’å½’éœ€è¦å¤„ç†çš„ä¿¡æ¯ã€‚åœ¨è¿™é‡Œä¹Ÿå°±ä¼šé‡å¤è°ƒç”¨è‡ªå·±æ¥å®ç°é€’å½’çš„è¿‡ç¨‹ã€‚ é€’å½’ä¸‰éƒ¨æ›² ç¡®å®šé€’å½’å‡½æ•°çš„å‚æ•°ä»¥åŠè¿”å›å€¼ ç¡®å®šç»ˆæ­¢æ¡ä»¶ ç¡®å®šå•å±‚é€’å½’çš„é€»è¾‘ å‚æ•°ï¼šéœ€è¦äºŒå‰æ ‘çš„æ ¹èŠ‚ç‚¹ï¼Œè¿˜éœ€è¦ä¸€ä¸ªè®¡æ•°å™¨ï¼Œè¿™ä¸ªè®¡æ•°å™¨ç”¨æ¥è®¡ç®—äºŒå‰æ ‘çš„ä¸€æ¡è¾¹ä¹‹å’Œæ˜¯å¦æ­£å¥½æ˜¯ç›®æ ‡å’Œï¼Œè®¡æ•°å™¨ä¸ºintå‹ã€‚å†æ¥çœ‹è¿”å›å€¼ï¼Œé€’å½’å‡½æ•°ä»€ä¹ˆæ—¶å€™éœ€è¦è¿”å›å€¼ï¼Ÿä»€ä¹ˆæ—¶å€™ä¸éœ€è¦è¿”å›å€¼ï¼Ÿè¿™é‡Œæ€»ç»“å¦‚ä¸‹ä¸‰ç‚¹ï¼š å¦‚æœéœ€è¦æœç´¢æ•´æ£µäºŒå‰æ ‘ä¸”ä¸ç”¨å¤„ç†é€’å½’è¿”å›å€¼ï¼Œé€’å½’å‡½æ•°å°±ä¸è¦è¿”å›å€¼ã€‚ï¼ˆè¿™ç§æƒ…å†µå°±æ˜¯æœ¬æ–‡ä¸‹åŠéƒ¨åˆ†ä»‹ç»çš„113.è·¯å¾„æ€»å’Œiiï¼‰ å¦‚æœéœ€è¦æœç´¢æ•´æ£µäºŒå‰æ ‘ä¸”éœ€è¦å¤„ç†é€’å½’è¿”å›å€¼ï¼Œé€’å½’å‡½æ•°å°±éœ€è¦è¿”å›å€¼ã€‚ ï¼ˆè¿™ç§æƒ…å†µæˆ‘ä»¬åœ¨236. äºŒå‰æ ‘çš„æœ€è¿‘å…¬å…±ç¥–å…ˆ ä¸­ä»‹ç»ï¼‰ å¦‚æœè¦æœç´¢å…¶ä¸­ä¸€æ¡ç¬¦åˆæ¡ä»¶çš„è·¯å¾„ï¼Œé‚£ä¹ˆé€’å½’ä¸€å®šéœ€è¦è¿”å›å€¼ï¼Œå› ä¸ºé‡åˆ°ç¬¦åˆæ¡ä»¶çš„è·¯å¾„äº†å°±è¦åŠæ—¶è¿”å›ã€‚ï¼ˆæœ¬é¢˜çš„æƒ…å†µï¼‰ ç»ˆæ­¢æ¡ä»¶ç»ˆæ­¢æ¡ä»¶å¦‚æœæ˜¯åˆ¤æ–­å¶å­èŠ‚ç‚¹ï¼Œé€’å½’çš„è¿‡ç¨‹ä¸­å°±ä¸è¦è®©ç©ºèŠ‚ç‚¹è¿›å…¥é€’å½’äº†ã€‚ // å‰åºéå†Â·é€’å½’Â·LC144_äºŒå‰æ ‘çš„å‰åºéå†class Solution public ListInteger preorderTraversal(TreeNode root) ListInteger result = new ArrayListInteger(); preorder(root, result); return result; public void preorder(TreeNode root, ListInteger result) if (root == null) return; result.add(root.val); preorder(root.left, result); preorder(root.right, result); // ä¸­åºéå†Â·é€’å½’Â·LC94_äºŒå‰æ ‘çš„ä¸­åºéå†class Solution public ListInteger inorderTraversal(TreeNode root) ListInteger res = new ArrayList(); inorder(root, res); return res; void inorder(TreeNode root, ListInteger list) if (root == null) return; inorder(root.left, list); list.add(root.val); // æ³¨æ„è¿™ä¸€å¥ inorder(root.right, list); // ååºéå†Â·é€’å½’Â·LC145_äºŒå‰æ ‘çš„ååºéå†class Solution public ListInteger postorderTraversal(TreeNode root) ListInteger res = new ArrayList(); postorder(root, res); return res; void postorder(TreeNode root, ListInteger list) if (root == null) return; postorder(root.left, list); postorder(root.right, list); list.add(root.val); // æ³¨æ„è¿™ä¸€å¥ äºŒå‰æ ‘è¿­ä»£éå†144.äºŒå‰æ ‘çš„å‰åºéå†https://leetcode.cn/problems/binary-tree-preorder-traversal/94.äºŒå‰æ ‘çš„ä¸­åºéå†https://leetcode.cn/problems/binary-tree-inorder-traversal/145.äºŒå‰æ ‘çš„ååºéå†https://leetcode.cn/problems/binary-tree-postorder-traversal/ ç»Ÿä¸€å†™æ³•!!!!!!!!æ€è·¯:å°†è®¿é—®çš„èŠ‚ç‚¹æ”¾å…¥æ ˆä¸­ï¼ŒæŠŠè¦å¤„ç†çš„èŠ‚ç‚¹ä¹Ÿæ”¾å…¥æ ˆä¸­ä½†æ˜¯è¦åšæ ‡è®°ã€‚å®ç°æ–¹å¼: æ–¹æ³•ä¸€ï¼šå°±æ˜¯è¦å¤„ç†çš„èŠ‚ç‚¹æ”¾å…¥æ ˆä¹‹åï¼Œç´§æ¥ç€æ”¾å…¥ä¸€ä¸ªç©ºæŒ‡é’ˆä½œä¸ºæ ‡è®°ã€‚ è¿™ç§æ–¹æ³•å¯ä»¥å«åšç©ºæŒ‡é’ˆæ ‡è®°æ³•ã€‚ æ–¹æ³•äºŒï¼šåŠ ä¸€ä¸ª boolean å€¼è·Ÿéšæ¯ä¸ªèŠ‚ç‚¹ï¼Œfalse (é»˜è®¤å€¼) è¡¨ç¤ºéœ€è¦ä¸ºè¯¥èŠ‚ç‚¹å’Œå®ƒçš„å·¦å³å„¿å­å®‰æ’åœ¨æ ˆä¸­çš„ä½æ¬¡ï¼Œtrue è¡¨ç¤ºè¯¥èŠ‚ç‚¹çš„ä½æ¬¡ä¹‹å‰å·²ç»å®‰æ’è¿‡äº†ï¼Œå¯ä»¥æ”¶å‰²èŠ‚ç‚¹äº†ã€‚ è¿™ç§æ–¹æ³•å¯ä»¥å«åšboolean æ ‡è®°æ³•ã€‚ è¿™ç§æ–¹æ³•æ›´å®¹æ˜“ç†è§£ï¼Œåœ¨é¢è¯•ä¸­æ›´å®¹æ˜“å†™å‡ºæ¥ã€‚å‰åºéå†ä»£ç :public ListInteger preorderTraversal(TreeNode root) ListInteger result = new LinkedList(); DequeTreeNode st = new LinkedList(); if (root != null) st.push(root); while (!st.isEmpty()) TreeNode node = st.peek(); if (node != null) st.pop(); // å°†è¯¥èŠ‚ç‚¹å¼¹å‡ºï¼Œé¿å…é‡å¤æ“ä½œï¼Œä¸‹é¢å†å°†å³å·¦ä¸­èŠ‚ç‚¹æ·»åŠ åˆ°æ ˆä¸­ï¼ˆå‰åºéå†-ä¸­å·¦å³ï¼Œå…¥æ ˆé¡ºåºå³å·¦ä¸­ï¼‰ if (node.right!=null) st.push(node.right); // æ·»åŠ å³èŠ‚ç‚¹ï¼ˆç©ºèŠ‚ç‚¹ä¸å…¥æ ˆï¼‰ if (node.left!=null) st.push(node.left); // æ·»åŠ å·¦èŠ‚ç‚¹ï¼ˆç©ºèŠ‚ç‚¹ä¸å…¥æ ˆï¼‰ st.push(node); // æ·»åŠ ä¸­èŠ‚ç‚¹ st.push(null); // ä¸­èŠ‚ç‚¹è®¿é—®è¿‡ï¼Œä½†æ˜¯è¿˜æ²¡æœ‰å¤„ç†ï¼ŒåŠ å…¥ç©ºèŠ‚ç‚¹åšä¸ºæ ‡è®°ã€‚ else // åªæœ‰é‡åˆ°ç©ºèŠ‚ç‚¹çš„æ—¶å€™ï¼Œæ‰å°†ä¸‹ä¸€ä¸ªèŠ‚ç‚¹æ”¾è¿›ç»“æœé›† st.pop(); // å°†ç©ºèŠ‚ç‚¹å¼¹å‡º node = st.peek(); // é‡æ–°å–å‡ºæ ˆä¸­å…ƒç´  st.pop(); result.add(node.val); // åŠ å…¥åˆ°ç»“æœé›† return result; ä¸­åºéå†ä»£ç :public ListInteger inorderTraversal(TreeNode root) ListInteger result = new LinkedList(); DequeTreeNode st = new LinkedList(); if (root != null) st.push(root); while (!st.isEmpty()) TreeNode node = st.peek(); if (node != null) st.pop(); // å°†è¯¥èŠ‚ç‚¹å¼¹å‡ºï¼Œé¿å…é‡å¤æ“ä½œï¼Œä¸‹é¢å†å°†å³ä¸­å·¦èŠ‚ç‚¹æ·»åŠ åˆ°æ ˆä¸­ï¼ˆä¸­åºéå†-å·¦ä¸­å³ï¼Œå…¥æ ˆé¡ºåºå³ä¸­å·¦ï¼‰ if (node.right!=null) st.push(node.right); // æ·»åŠ å³èŠ‚ç‚¹ï¼ˆç©ºèŠ‚ç‚¹ä¸å…¥æ ˆï¼‰ st.push(node); // æ·»åŠ ä¸­èŠ‚ç‚¹ st.push(null); // ä¸­èŠ‚ç‚¹è®¿é—®è¿‡ï¼Œä½†æ˜¯è¿˜æ²¡æœ‰å¤„ç†ï¼ŒåŠ å…¥ç©ºèŠ‚ç‚¹åšä¸ºæ ‡è®°ã€‚ if (node.left!=null) st.push(node.left); // æ·»åŠ å·¦èŠ‚ç‚¹ï¼ˆç©ºèŠ‚ç‚¹ä¸å…¥æ ˆï¼‰ else // åªæœ‰é‡åˆ°ç©ºèŠ‚ç‚¹çš„æ—¶å€™ï¼Œæ‰å°†ä¸‹ä¸€ä¸ªèŠ‚ç‚¹æ”¾è¿›ç»“æœé›† st.pop(); // å°†ç©ºèŠ‚ç‚¹å¼¹å‡º node = st.peek(); // é‡æ–°å–å‡ºæ ˆä¸­å…ƒç´  st.pop(); result.add(node.val); // åŠ å…¥åˆ°ç»“æœé›† return result; ååºéå†ä»£ç :public ListInteger postorderTraversal(TreeNode root) ListInteger result = new LinkedList(); DequeTreeNode st = new LinkedList(); if (root != null) st.push(root); while (!st.isEmpty()) TreeNode node = st.peek(); if (node != null) st.pop(); // å°†è¯¥èŠ‚ç‚¹å¼¹å‡ºï¼Œé¿å…é‡å¤æ“ä½œï¼Œä¸‹é¢å†å°†ä¸­å³å·¦èŠ‚ç‚¹æ·»åŠ åˆ°æ ˆä¸­ï¼ˆååºéå†-å·¦å³ä¸­ï¼Œå…¥æ ˆé¡ºåºä¸­å³å·¦ï¼‰ st.push(node); // æ·»åŠ ä¸­èŠ‚ç‚¹ st.push(null); // ä¸­èŠ‚ç‚¹è®¿é—®è¿‡ï¼Œä½†æ˜¯è¿˜æ²¡æœ‰å¤„ç†ï¼ŒåŠ å…¥ç©ºèŠ‚ç‚¹åšä¸ºæ ‡è®°ã€‚ if (node.right!=null) st.push(node.right); // æ·»åŠ å³èŠ‚ç‚¹ï¼ˆç©ºèŠ‚ç‚¹ä¸å…¥æ ˆï¼‰ if (node.left!=null) st.push(node.left); // æ·»åŠ å·¦èŠ‚ç‚¹ï¼ˆç©ºèŠ‚ç‚¹ä¸å…¥æ ˆï¼‰ else // åªæœ‰é‡åˆ°ç©ºèŠ‚ç‚¹çš„æ—¶å€™ï¼Œæ‰å°†ä¸‹ä¸€ä¸ªèŠ‚ç‚¹æ”¾è¿›ç»“æœé›† st.pop(); // å°†ç©ºèŠ‚ç‚¹å¼¹å‡º node = st.peek(); // é‡æ–°å–å‡ºæ ˆä¸­å…ƒç´  st.pop(); result.add(node.val); // åŠ å…¥åˆ°ç»“æœé›† return result; ç›´æ¥ç”¨æ ˆæ¨¡æ‹Ÿçš„å†™æ³•:å‰åº ä¸­åº ååºçš„å†™æ³•ä¸ä¸€æ ·. // å‰åºéå†é¡ºåºï¼šä¸­-å·¦-å³ï¼Œå…¥æ ˆé¡ºåºï¼šä¸­-å³-å·¦class Solution public ListInteger preorderTraversal(TreeNode root) ListInteger result = new ArrayList(); if (root == null) return result; StackTreeNode stack = new Stack(); stack.push(root); while (!stack.isEmpty()) TreeNode node = stack.pop(); result.add(node.val); if (node.right != null) stack.push(node.right); if (node.left != null) stack.push(node.left); return result; // ä¸­åºéå†é¡ºåº: å·¦-ä¸­-å³ å…¥æ ˆé¡ºåºï¼š å·¦-å³class Solution public ListInteger inorderTraversal(TreeNode root) ListInteger result = new ArrayList(); if (root == null) return result; StackTreeNode stack = new Stack(); TreeNode cur = root; while (cur != null || !stack.isEmpty()) if (cur != null) stack.push(cur); cur = cur.left; else cur = stack.pop(); result.add(cur.val); cur = cur.right; return result; // ååºéå†é¡ºåº å·¦-å³-ä¸­ å…¥æ ˆé¡ºåºï¼šä¸­-å·¦-å³ å‡ºæ ˆé¡ºåºï¼šä¸­-å³-å·¦ï¼Œ æœ€åç¿»è½¬ç»“æœclass Solution public ListInteger postorderTraversal(TreeNode root) ListInteger result = new ArrayList(); if (root == null) return result; StackTreeNode stack = new Stack(); stack.push(root); while (!stack.isEmpty()) TreeNode node = stack.pop(); result.add(node.val); if (node.left != null) stack.push(node.left); if (node.right != null) stack.push(node.right); Collections.reverse(result); return result; äºŒå‰æ ‘çš„å±‚åºéå†(BFS)// 102.äºŒå‰æ ‘çš„å±‚åºéå†class Solution public ListListInteger resList = new ArrayListListInteger(); public ListListInteger levelOrder(TreeNode root) //checkFun01(root,0); checkFun02(root); return resList; //BFS--é€’å½’æ–¹å¼ public void checkFun01(TreeNode node, Integer deep) if (node == null) return; deep++; if (resList.size() deep) //å½“å±‚çº§å¢åŠ æ—¶ï¼Œlistçš„Itemä¹Ÿå¢åŠ ï¼Œåˆ©ç”¨listçš„ç´¢å¼•å€¼è¿›è¡Œå±‚çº§ç•Œå®š ListInteger item = new ArrayListInteger(); resList.add(item); resList.get(deep - 1).add(node.val); checkFun01(node.left, deep); checkFun01(node.right, deep); //BFS--è¿­ä»£æ–¹å¼--å€ŸåŠ©é˜Ÿåˆ— public void checkFun02(TreeNode node) if (node == null) return; QueueTreeNode que = new LinkedListTreeNode(); que.offer(node); while (!que.isEmpty()) ListInteger itemList = new ArrayListInteger(); int len = que.size(); while (len 0) TreeNode tmpNode = que.poll(); itemList.add(tmpNode.val); if (tmpNode.left != null) que.offer(tmpNode.left); if (tmpNode.right != null) que.offer(tmpNode.right); len--; resList.add(itemList); Morriséå†å­¦ä¹ äº†ä¸€ä¸ªMorriséå†æ–¹å¼,è¿™ç§æ–¹å¼å¯ä»¥åœ¨O(1)çš„ç©ºé—´å¤æ‚åº¦ä¸‹å®ŒæˆäºŒå‰æ ‘çš„éå†,å¹¶ä¸”ä¸éœ€è¦ä½¿ç”¨æ ˆæ¥å­˜å‚¨èŠ‚ç‚¹.è´´ä¸€ä¸ªè‡ªå·±ç”»çš„ä¼ªä»£ç :å‰åºå’Œä¸­åºå¯ä»¥é€šè¿‡è°ƒæ•´ä»£ç å®ç°,ååºå¯ä»¥é€šè¿‡å‘å³çš„å‰åºç„¶åç»“æœç¿»è½¬æ¥å®ç°. //å‰åºclass Solution public ListInteger preorderTraversal(TreeNode root) ListInteger res = new LinkedList(); TreeNode cur = root; while(cur != null) if(cur.left == null) res.add(cur.val); cur =cur.right; //å‘å³èµ° else TreeNode pre = cur.left; while(pre.right != null pre.right != cur) pre = pre.right; //å¼€å§‹å»ºç«‹ç´¢å¼• if(pre.right == null) //æ˜¯ä¸€ä¸ªç¬¬ä¸€æ¬¡æ¥çš„èŠ‚ç‚¹ pre.right = cur; res.add(cur.val); cur = cur.left; else //å¹¶ä¸æ˜¯ç¬¬ä¸€æ¬¡æ¥çš„èŠ‚ç‚¹ pre.right = null; cur = cur.right; return res; //ä¸­åºclass Solution public ListInteger inorderTraversal(TreeNode root) ListInteger res =new LinkedList(); TreeNode cur = root; while(cur != null) if(cur.left == null) res.add(cur.val); cur = cur.right; else TreeNode pre = cur.left; while(pre.right != null pre.right != cur) pre = pre.right; if(pre.right == null) pre.right = cur; cur = cur.left; else pre.right = null; res.add(cur.val); cur = cur.right; return res; //ååºimport java.util.ArrayList;import java.util.Collections;import java.util.List;class TreeNode int val; TreeNode left; TreeNode right; TreeNode(int x) val = x; public class MorrisPostorderTraversal public ListInteger postorderTraversal(TreeNode root) ListInteger res = new ArrayList(); TreeNode curr = root; TreeNode prev = null; while (curr != null) if (curr.right == null) res.add(curr.val); // å³å­æ ‘ä¸ºç©ºï¼Œç›´æ¥è®¿é—® curr = curr.left; // è½¬å‘å·¦å­æ ‘ else // æ‰¾åˆ°å³å­æ ‘çš„æœ€å·¦èŠ‚ç‚¹ï¼ˆå³åç»§èŠ‚ç‚¹ï¼‰ prev = curr.right; while (prev.left != null prev.left != curr) prev = prev.left; if (prev.left == null) prev.left = curr; // å»ºç«‹çº¿ç´¢ res.add(curr.val); // è®¿é—®å½“å‰èŠ‚ç‚¹ï¼ˆå‰åºéå†ä½ç½®ï¼‰ curr = curr.right; // è½¬å‘å³å­æ ‘ else prev.left = null; // æ¢å¤æ ‘ç»“æ„ curr = curr.left; // è½¬å‘å·¦å­æ ‘ Collections.reverse(res); // åè½¬ç»“æœï¼Œå¾—åˆ°ååºéå† return res; äºŒå‰æ ‘é¢˜ç›®ç¿»è½¬äºŒå‰æ ‘dfsæˆ–è€…bfséƒ½å¯åš //DFSé€’å½’class Solution /** * å‰ååºéå†éƒ½å¯ä»¥ * ä¸­åºä¸è¡Œï¼Œå› ä¸ºå…ˆå·¦å­©å­äº¤æ¢å­©å­ï¼Œå†æ ¹äº¤æ¢å­©å­ï¼ˆåšå®Œåï¼Œå³å­©å­å·²ç»å˜æˆäº†åŸæ¥çš„å·¦å­©å­ï¼‰ï¼Œå†å³å­©å­äº¤æ¢å­©å­ï¼ˆæ­¤æ—¶å…¶å®æ˜¯å¯¹åŸæ¥çš„å·¦å­©å­åšäº¤æ¢ï¼‰ */ public TreeNode invertTree(TreeNode root) if (root == null) return null; invertTree(root.left); invertTree(root.right); swapChildren(root); return root; private void swapChildren(TreeNode root) TreeNode tmp = root.left; root.left = root.right; root.right = tmp; //BFSclass Solution public TreeNode invertTree(TreeNode root) if (root == null) return null; ArrayDequeTreeNode deque = new ArrayDeque(); deque.offer(root); while (!deque.isEmpty()) int size = deque.size(); while (size-- 0) TreeNode node = deque.poll(); swap(node); if (node.left != null) deque.offer(node.left); if (node.right != null) deque.offer(node.right); return root; public void swap(TreeNode root) TreeNode temp = root.left; root.left = root.right; root.right = temp; å¯¹ç§°äºŒå‰æ ‘è¿™é“é¢˜é€’å½’è°ƒç”¨å¾ˆç®€å•,è¿­ä»£è°ƒç”¨ç”¨ä¸€ä¸ªé˜Ÿåˆ—å°±å¯ä»¥,é€€å‡ºæ¡ä»¶å¯ä»¥æ³¨æ„ä¸€ä¸‹. /** * é€’å½’æ³• */public boolean isSymmetric1(TreeNode root) return compare(root.left, root.right);private boolean compare(TreeNode left, TreeNode right) if (left == null right != null) return false; if (left != null right == null) return false; if (left == null right == null) return true; if (left.val != right.val) return false; // æ¯”è¾ƒå¤–ä¾§ boolean compareOutside = compare(left.left, right.right); // æ¯”è¾ƒå†…ä¾§ boolean compareInside = compare(left.right, right.left); return compareOutside compareInside;/** * è¿­ä»£æ³• * ä½¿ç”¨åŒç«¯é˜Ÿåˆ—ï¼Œç›¸å½“äºä¸¤ä¸ªæ ˆ */public boolean isSymmetric2(TreeNode root) DequeTreeNode deque = new LinkedList(); deque.offerFirst(root.left); deque.offerLast(root.right); while (!deque.isEmpty()) TreeNode leftNode = deque.pollFirst(); TreeNode rightNode = deque.pollLast(); if (leftNode == null rightNode == null) continue; // if (leftNode == null rightNode != null) // return false;// // if (leftNode != null rightNode == null) // return false;// // if (leftNode.val != rightNode.val) // return false;// // ä»¥ä¸Šä¸‰ä¸ªåˆ¤æ–­æ¡ä»¶åˆå¹¶ if (leftNode == null || rightNode == null || leftNode.val != rightNode.val) return false; deque.offerFirst(leftNode.left); deque.offerFirst(leftNode.right); deque.offerLast(rightNode.right); deque.offerLast(rightNode.left); return true;/** * è¿­ä»£æ³• * ä½¿ç”¨æ™®é€šé˜Ÿåˆ— *///public boolean isSymmetric3(TreeNode root) QueueTreeNode deque = new LinkedList(); deque.offer(root.left); deque.offer(root.right); while (!deque.isEmpty()) TreeNode leftNode = deque.poll(); TreeNode rightNode = deque.poll(); if (leftNode == null rightNode == null) continue; // if (leftNode == null rightNode != null) // return false;// // if (leftNode != null rightNode == null) // return false;// // if (leftNode.val != rightNode.val) // return false;// // ä»¥ä¸Šä¸‰ä¸ªåˆ¤æ–­æ¡ä»¶åˆå¹¶ if (leftNode == null || rightNode == null || leftNode.val != rightNode.val) return false; // è¿™é‡Œé¡ºåºä¸ä½¿ç”¨Dequeä¸åŒ deque.offer(leftNode.left); deque.offer(rightNode.right); deque.offer(leftNode.right); deque.offer(rightNode.left); return true; äºŒå‰æ ‘æœ€å¤§æ·±åº¦104.äºŒå‰æ ‘çš„æœ€å¤§æ·±åº¦ class Solution /** * é€’å½’æ³• */ public int maxDepth(TreeNode root) if (root == null) return 0; int leftDepth = maxDepth(root.left); int rightDepth = maxDepth(root.right); return Math.max(leftDepth, rightDepth) + 1; class Solution /** * é€’å½’æ³•(æ±‚æ·±åº¦æ³•) */ //å®šä¹‰æœ€å¤§æ·±åº¦ int maxnum = 0; public int maxDepth(TreeNode root) ans(root,0); return maxnum; //é€’å½’æ±‚è§£æœ€å¤§æ·±åº¦ void ans(TreeNode tr,int tmp) if(tr==null) return; tmp++; maxnum = maxnumtmp?tmp:maxnum; ans(tr.left,tmp); ans(tr.right,tmp); tmp--; class Solution /** * è¿­ä»£æ³•ï¼Œä½¿ç”¨å±‚åºéå† */ public int maxDepth(TreeNode root) if(root == null) return 0; DequeTreeNode deque = new LinkedList(); deque.offer(root); int depth = 0; while (!deque.isEmpty()) int size = deque.size(); depth++; for (int i = 0; i size; i++) TreeNode node = deque.poll(); if (node.left != null) deque.offer(node.left); if (node.right != null) deque.offer(node.right); return depth; äºŒå‰æ ‘çš„æ‰€æœ‰è·¯å¾„ https://leetcode.cn/problems/binary-tree-paths/é€’å½’å’Œå›æº¯.PS:é€’å½’å’Œå›æº¯æ°¸è¿œè¦æ”¾åœ¨ä¸€èµ·!!! //è§£æ³•ä¸€//æ–¹å¼ä¸€class Solution /** * é€’å½’æ³• */ public ListString binaryTreePaths(TreeNode root) ListString res = new ArrayList();// å­˜æœ€ç»ˆçš„ç»“æœ if (root == null) return res; ListInteger paths = new ArrayList();// ä½œä¸ºç»“æœä¸­çš„è·¯å¾„ traversal(root, paths, res); return res; private void traversal(TreeNode root, ListInteger paths, ListString res) paths.add(root.val);// å‰åºéå†ï¼Œä¸­ // é‡åˆ°å¶å­ç»“ç‚¹ if (root.left == null root.right == null) // è¾“å‡º StringBuilder sb = new StringBuilder();// StringBuilderç”¨æ¥æ‹¼æ¥å­—ç¬¦ä¸²ï¼Œé€Ÿåº¦æ›´å¿« for (int i = 0; i paths.size() - 1; i++) sb.append(paths.get(i)).append(-); sb.append(paths.get(paths.size() - 1));// è®°å½•æœ€åä¸€ä¸ªèŠ‚ç‚¹ res.add(sb.toString());// æ”¶é›†ä¸€ä¸ªè·¯å¾„ return; // é€’å½’å’Œå›æº¯æ˜¯åŒæ—¶è¿›è¡Œï¼Œæ‰€ä»¥è¦æ”¾åœ¨åŒä¸€ä¸ªèŠ±æ‹¬å·é‡Œ if (root.left != null) // å·¦ traversal(root.left, paths, res); paths.remove(paths.size() - 1);// å›æº¯ if (root.right != null) // å³ traversal(root.right, paths, res); paths.remove(paths.size() - 1);// å›æº¯ //æ–¹å¼äºŒclass Solution ListString result = new ArrayList(); public ListString binaryTreePaths(TreeNode root) deal(root, ); return result; public void deal(TreeNode node, String s) if (node == null) return; if (node.left == null node.right == null) result.add(new StringBuilder(s).append(node.val).toString()); return; String tmp = new StringBuilder(s).append(node.val).append(-).toString(); deal(node.left, tmp); deal(node.right, tmp); è¿­ä»£æ³•: // è§£æ³•äºŒclass Solution /** * è¿­ä»£æ³• */ public ListString binaryTreePaths(TreeNode root) ListString result = new ArrayList(); if (root == null) return result; StackObject stack = new Stack(); // èŠ‚ç‚¹å’Œè·¯å¾„åŒæ—¶å…¥æ ˆ stack.push(root); stack.push(root.val + ); while (!stack.isEmpty()) // èŠ‚ç‚¹å’Œè·¯å¾„åŒæ—¶å‡ºæ ˆ String path = (String) stack.pop(); TreeNode node = (TreeNode) stack.pop(); // è‹¥æ‰¾åˆ°å¶å­èŠ‚ç‚¹ if (node.left == null node.right == null) result.add(path); //å³å­èŠ‚ç‚¹ä¸ä¸ºç©º if (node.right != null) stack.push(node.right); stack.push(path + - + node.right.val); //å·¦å­èŠ‚ç‚¹ä¸ä¸ºç©º if (node.left != null) stack.push(node.left); stack.push(path + - + node.left.val); return result; 404.å·¦å¶å­ä¹‹å’Œhttps://leetcode.cn/problems/sum-of-left-leaves/ class Solution public int sumOfLeftLeaves(TreeNode root) if (root == null) return 0; int leftValue = sumOfLeftLeaves(root.left); // å·¦ int rightValue = sumOfLeftLeaves(root.right); // å³ int midValue = 0; if (root.left != null root.left.left == null root.left.right == null) midValue = root.left.val; int sum = midValue + leftValue + rightValue; // ä¸­ return sum; class Solution public int sumOfLeftLeaves(TreeNode root) if (root == null) return 0; StackTreeNode stack = new Stack (); stack.add(root); int result = 0; while (!stack.isEmpty()) TreeNode node = stack.pop(); if (node.left != null node.left.left == null node.left.right == null) result += node.left.val; if (node.right != null) stack.add(node.right); if (node.left != null) stack.add(node.left); return result; 513.æ‰¾æ ‘å·¦ä¸‹è§’çš„å€¼https://leetcode.cn/problems/find-bottom-left-tree-value/ // é€’å½’æ³•class Solution private int Deep = -1; private int value = 0; public int findBottomLeftValue(TreeNode root) value = root.val; findLeftValue(root,0); return value; private void findLeftValue (TreeNode root,int deep) if (root == null) return; if (root.left == null root.right == null) if (deep Deep) value = root.val; Deep = deep; if (root.left != null) findLeftValue(root.left,deep + 1); if (root.right != null) findLeftValue(root.right,deep + 1); //è¿­ä»£æ³•class Solution public int findBottomLeftValue(TreeNode root) QueueTreeNode queue = new LinkedList(); queue.offer(root); int res = 0; while (!queue.isEmpty()) int size = queue.size(); for (int i = 0; i size; i++) TreeNode poll = queue.poll(); if (i == 0) res = poll.val; if (poll.left != null) queue.offer(poll.left); if (poll.right != null) queue.offer(poll.right); return res; è·¯å¾„æ€»å’Œhttps://leetcode.cn/problems/path-sum/ 106.ä»ä¸­åºä¸ååºéå†åºåˆ—æ„é€ äºŒå‰æ ‘ class Solution MapInteger, Integer map; // æ–¹ä¾¿æ ¹æ®æ•°å€¼æŸ¥æ‰¾ä½ç½® public TreeNode buildTree(int[] inorder, int[] postorder) map = new HashMap(); for (int i = 0; i inorder.length; i++) // ç”¨mapä¿å­˜ä¸­åºåºåˆ—çš„æ•°å€¼å¯¹åº”ä½ç½® map.put(inorder[i], i); return findNode(inorder, 0, inorder.length, postorder,0, postorder.length); // å‰é—­åå¼€ public TreeNode findNode(int[] inorder, int inBegin, int inEnd, int[] postorder, int postBegin, int postEnd) // å‚æ•°é‡Œçš„èŒƒå›´éƒ½æ˜¯å‰é—­åå¼€ if (inBegin = inEnd || postBegin = postEnd) // ä¸æ»¡è¶³å·¦é—­å³å¼€ï¼Œè¯´æ˜æ²¡æœ‰å…ƒç´ ï¼Œè¿”å›ç©ºæ ‘ return null; int rootIndex = map.get(postorder[postEnd - 1]); // æ‰¾åˆ°ååºéå†çš„æœ€åä¸€ä¸ªå…ƒç´ åœ¨ä¸­åºéå†ä¸­çš„ä½ç½® TreeNode root = new TreeNode(inorder[rootIndex]); // æ„é€ ç»“ç‚¹ int lenOfLeft = rootIndex - inBegin; // ä¿å­˜ä¸­åºå·¦å­æ ‘ä¸ªæ•°ï¼Œç”¨æ¥ç¡®å®šååºæ•°åˆ—çš„ä¸ªæ•° root.left = findNode(inorder, inBegin, rootIndex, postorder, postBegin, postBegin + lenOfLeft); root.right = findNode(inorder, rootIndex + 1, inEnd, postorder, postBegin + lenOfLeft, postEnd - 1); return root; 106.ä»å‰åºä¸ååºéå†åºåˆ—æ„é€ äºŒå‰æ ‘ class Solution MapInteger,Integer mp = new HashMap(); public TreeNode constructFromPrePost(int[] preorder, int[] postorder) int n = preorder.length; for(int i=0 ; in ; ++i) mp.put(postorder[i],i); return dfs(preorder,0,n-1,postorder,0,n-1); private TreeNode dfs(int[] preorder , int pre_beg,int pre_end ,int[] postorder, int pos_beg , int pos_end) //é—­åŒºé—´ å…ˆåˆ¤æ–­æ˜¯å¦ç»ˆæ­¢ if(pre_begpre_end || pos_begpos_end) return null; int mid = preorder[pre_beg]; if(pre_beg == pre_end || pos_beg == pos_end) return new TreeNode(mid); int nx_l = preorder[pre_beg+1]; int ind_nxl = mp.get(nx_l); int lenOfLeft = ind_nxl - pos_beg + 1; TreeNode root = new TreeNode(mid); root.left = dfs(preorder,pre_beg+1,pre_beg+lenOfLeft,postorder,pos_beg,pos_beg+lenOfLeft-1); root.right = dfs(preorder,pre_beg+lenOfLeft+1,pre_end,postorder,ind_nxl+1,pos_end-1); return root; 617.åˆå¹¶äºŒå‰æ ‘https://leetcode.cn/problems/merge-two-binary-trees/ 700.äºŒå‰æœç´¢æ ‘ä¸­çš„æœç´¢https://leetcode.cn/problems/search-in-a-binary-search-tree/ class Solution // é€’å½’ï¼Œæ™®é€šäºŒå‰æ ‘ public TreeNode searchBST(TreeNode root, int val) if (root == null || root.val == val) return root; TreeNode left = searchBST(root.left, val); if (left != null) return left; return searchBST(root.right, val); class Solution // é€’å½’ï¼Œåˆ©ç”¨äºŒå‰æœç´¢æ ‘ç‰¹ç‚¹ï¼Œä¼˜åŒ– public TreeNode searchBST(TreeNode root, int val) if (root == null || root.val == val) return root; if (val root.val) return searchBST(root.left, val); else return searchBST(root.right, val); class Solution // è¿­ä»£ï¼Œæ™®é€šäºŒå‰æ ‘ public TreeNode searchBST(TreeNode root, int val) if (root == null || root.val == val) return root; StackTreeNode stack = new Stack(); stack.push(root); while (!stack.isEmpty()) TreeNode pop = stack.pop(); if (pop.val == val) return pop; if (pop.right != null) stack.push(pop.right); if (pop.left != null) stack.push(pop.left); return null; class Solution // è¿­ä»£ï¼Œåˆ©ç”¨äºŒå‰æœç´¢æ ‘ç‰¹ç‚¹ï¼Œä¼˜åŒ–ï¼Œå¯ä»¥ä¸éœ€è¦æ ˆ public TreeNode searchBST(TreeNode root, int val) while (root != null) if (val root.val) root = root.left; else if (val root.val) root = root.right; else return root; return null; 98.éªŒè¯äºŒå‰æœç´¢æ ‘è®°ä½æœ€é‡è¦çš„å°±æ˜¯:äºŒå‰æœç´¢æ ‘çš„ä¸­åºéå†æ˜¯æœ‰åºçš„. //ä½¿ç”¨çµ±ä¸€è¿­ä»£æ³•class Solution public boolean isValidBST(TreeNode root) StackTreeNode stack = new Stack(); TreeNode pre = null; if(root != null) stack.add(root); while(!stack.isEmpty()) TreeNode curr = stack.peek(); if(curr != null) stack.pop(); if(curr.right != null) stack.add(curr.right); stack.add(curr); stack.add(null); if(curr.left != null) stack.add(curr.left); else stack.pop(); TreeNode temp = stack.pop(); if(pre != null pre.val = temp.val) return false; pre = temp; return true; class Solution // é€’å½’ TreeNode max; public boolean isValidBST(TreeNode root) if (root == null) return true; // å·¦ boolean left = isValidBST(root.left); if (!left) return false; // ä¸­ if (max != null root.val = max.val) return false; max = root; // å³ boolean right = isValidBST(root.right); return right; class Solution // è¿­ä»£ public boolean isValidBST(TreeNode root) if (root == null) return true; StackTreeNode stack = new Stack(); TreeNode pre = null; while (root != null || !stack.isEmpty()) while (root != null) stack.push(root); root = root.left;// å·¦ // ä¸­ï¼Œå¤„ç† TreeNode pop = stack.pop(); if (pre != null pop.val = pre.val) return false; pre = pop; root = pop.right;// å³ return true; // ç®€æ´å®ç°Â·é€’å½’è§£æ³•class Solution public boolean isValidBST(TreeNode root) return validBST(Long.MIN_VALUE, Long.MAX_VALUE, root); boolean validBST(long lower, long upper, TreeNode root) if (root == null) return true; if (root.val = lower || root.val = upper) return false; return validBST(lower, root.val, root.left) validBST(root.val, upper, root.right); // ç®€æ´å®ç°Â·ä¸­åºéå†class Solution private long prev = Long.MIN_VALUE; public boolean isValidBST(TreeNode root) if (root == null) return true; if (!isValidBST(root.left)) return false; if (root.val = prev) // ä¸æ»¡è¶³äºŒå‰æœç´¢æ ‘æ¡ä»¶ return false; prev = root.val; return isValidBST(root.right); äºŒå‰æ ‘çš„æœ€è¿‘å…¬å…±ç¥–å…ˆhttps://leetcode.cn/problems/lowest-common-ancestor-of-a-binary-tree/ class Solution public TreeNode lowestCommonAncestor(TreeNode root, TreeNode p, TreeNode q) if (root == null || root == p || root == q) // é€’å½’ç»“æŸæ¡ä»¶ return root; // ååºéå† TreeNode left = lowestCommonAncestor(root.left, p, q); TreeNode right = lowestCommonAncestor(root.right, p, q); if(left == null right == null) // è‹¥æœªæ‰¾åˆ°èŠ‚ç‚¹ p æˆ– q return null; else if(left == null right != null) // è‹¥æ‰¾åˆ°ä¸€ä¸ªèŠ‚ç‚¹ return right; else if(left != null right == null) // è‹¥æ‰¾åˆ°ä¸€ä¸ªèŠ‚ç‚¹ return left; else // è‹¥æ‰¾åˆ°ä¸¤ä¸ªèŠ‚ç‚¹ return root; //è¿­ä»£public TreeNode lowestCommonAncestor(TreeNode root, TreeNode p, TreeNode q) int max = Integer.MAX_VALUE; StackTreeNode st = new Stack(); TreeNode cur = root, pre = null; while (cur != null || !st.isEmpty()) while (cur != null) st.push(cur); cur = cur.left; cur = st.pop(); if (cur.right == null || cur.right == pre) // p/qæ˜¯ ä¸­/å·¦ æˆ–è€… ä¸­/å³ , è¿”å›ä¸­ if (cur == p || cur == q) if ((cur.left != null cur.left.val == max) || (cur.right != null cur.right.val == max)) return cur; cur.val = max; // p/qæ˜¯ å·¦/å³ , è¿”å›ä¸­ if (cur.left != null cur.left.val == max cur.right != null cur.right.val == max) return cur; // MAX_VALUE å¾€ä¸Šä¼ é€’ if ((cur.left != null cur.left.val == max) || (cur.right != null cur.right.val == max)) cur.val = max; pre = cur; cur = null; else st.push(cur); cur = cur.right; return null; äºŒå‰æœç´¢æ ‘çš„æœ€è¿‘å…¬å…±ç¥–å…ˆhttps://leetcode.cn/problems/lowest-common-ancestor-of-a-binary-search-tree/ 450.åˆ é™¤äºŒå‰æœç´¢æ ‘ä¸­çš„èŠ‚ç‚¹https://leetcode.cn/problems/delete-node-in-a-bst/ // è§£æ³•1(æœ€å¥½ç†è§£çš„ç‰ˆæœ¬)class Solution public TreeNode deleteNode(TreeNode root, int key) if (root == null) return root; if (root.val == key) if (root.left == null) return root.right; else if (root.right == null) return root.left; else TreeNode cur = root.right; while (cur.left != null) cur = cur.left; cur.left = root.left; root = root.right; return root; if (root.val key) root.left = deleteNode(root.left, key); if (root.val key) root.right = deleteNode(root.right, key); return root; ä¿®å‰ªäºŒå‰æœç´¢æ ‘https://leetcode.cn/problems/trim-a-binary-search-tree/ class Solution public: TreeNode* trimBST(TreeNode* root, int low, int high) if (root == nullptr) return nullptr; if (root-val low) return trimBST(root-right, low, high); if (root-val high) return trimBST(root-left, low, high); root-left = trimBST(root-left, low, high); root-right = trimBST(root-right, low, high); return root; ; å›æº¯ç®—æ³• å›æº¯çš„ç†è®ºåŸºç¡€ä»€ä¹ˆæ˜¯å›æº¯æ³•å›æº¯æ³•ä¹Ÿå¯ä»¥å«åšå›æº¯æœç´¢æ³•ï¼Œå®ƒæ˜¯ä¸€ç§æœç´¢çš„æ–¹å¼ã€‚å›æº¯æ˜¯é€’å½’çš„å‰¯äº§å“ï¼Œåªè¦æœ‰é€’å½’å°±ä¼šæœ‰å›æº¯ã€‚ å› ä¸ºå›æº¯çš„æœ¬è´¨æ˜¯ç©·ä¸¾ï¼Œç©·ä¸¾æ‰€æœ‰å¯èƒ½ï¼Œç„¶åé€‰å‡ºæˆ‘ä»¬æƒ³è¦çš„ç­”æ¡ˆï¼Œå¦‚æœæƒ³è®©å›æº¯æ³•é«˜æ•ˆä¸€äº›ï¼Œå¯ä»¥åŠ ä¸€äº›å‰ªæçš„æ“ä½œï¼Œä½†ä¹Ÿæ”¹ä¸äº†å›æº¯æ³•å°±æ˜¯ç©·ä¸¾çš„æœ¬è´¨ã€‚ å›æº¯æ³•è§£å†³çš„é—®é¢˜ å›æº¯æ³•ï¼Œä¸€èˆ¬å¯ä»¥è§£å†³å¦‚ä¸‹å‡ ç§é—®é¢˜ï¼š ç»„åˆé—®é¢˜ï¼šNä¸ªæ•°é‡Œé¢æŒ‰ä¸€å®šè§„åˆ™æ‰¾å‡ºkä¸ªæ•°çš„é›†åˆ åˆ‡å‰²é—®é¢˜ï¼šä¸€ä¸ªå­—ç¬¦ä¸²æŒ‰ä¸€å®šè§„åˆ™æœ‰å‡ ç§åˆ‡å‰²æ–¹å¼ å­é›†é—®é¢˜ï¼šä¸€ä¸ªNä¸ªæ•°çš„é›†åˆé‡Œæœ‰å¤šå°‘ç¬¦åˆæ¡ä»¶çš„å­é›† æ’åˆ—é—®é¢˜ï¼šNä¸ªæ•°æŒ‰ä¸€å®šè§„åˆ™å…¨æ’åˆ—ï¼Œæœ‰å‡ ç§æ’åˆ—æ–¹å¼ æ£‹ç›˜é—®é¢˜ï¼šNçš‡åï¼Œè§£æ•°ç‹¬ç­‰ç­‰ ç»„åˆæ˜¯ä¸å¼ºè°ƒå…ƒç´ é¡ºåºçš„ï¼Œæ’åˆ—æ˜¯å¼ºè°ƒå…ƒç´ é¡ºåºã€‚è®°ä½ç»„åˆæ— åºï¼Œæ’åˆ—æœ‰åºï¼Œå°±å¯ä»¥äº†ã€‚ å›æº¯æ³•æ¨¡æ¿ å›æº¯å‡½æ•°æ¨¡æ¿è¿”å›å€¼ä»¥åŠå‚æ•° åœ¨å›æº¯ç®—æ³•ä¸­ï¼Œæˆ‘çš„ä¹ æƒ¯æ˜¯å‡½æ•°èµ·åå­—ä¸ºbacktrackingï¼Œè¿™ä¸ªèµ·åå¤§å®¶éšæ„ã€‚ å›æº¯ç®—æ³•ä¸­å‡½æ•°è¿”å›å€¼ä¸€èˆ¬ä¸ºvoidã€‚å†æ¥çœ‹ä¸€ä¸‹å‚æ•°ï¼Œå› ä¸ºå›æº¯ç®—æ³•éœ€è¦çš„å‚æ•°å¯ä¸åƒäºŒå‰æ ‘é€’å½’çš„æ—¶å€™é‚£ä¹ˆå®¹æ˜“ä¸€æ¬¡æ€§ç¡®å®šä¸‹æ¥ï¼Œæ‰€ä»¥ä¸€èˆ¬æ˜¯å…ˆå†™é€»è¾‘ï¼Œç„¶åéœ€è¦ä»€ä¹ˆå‚æ•°ï¼Œå°±å¡«ä»€ä¹ˆå‚æ•°ã€‚å›æº¯å‡½æ•°ä¼ªä»£ç å¦‚ä¸‹ï¼švoid backtracking(å‚æ•°) å›æº¯å‡½æ•°ç»ˆæ­¢æ¡ä»¶ æ—¢ç„¶æ˜¯æ ‘å½¢ç»“æ„ï¼Œé‚£ä¹ˆæˆ‘ä»¬åœ¨è®²è§£äºŒå‰æ ‘çš„é€’å½’ (opens new window)çš„æ—¶å€™ï¼Œå°±çŸ¥é“éå†æ ‘å½¢ç»“æ„ä¸€å®šè¦æœ‰ç»ˆæ­¢æ¡ä»¶ã€‚æ‰€ä»¥å›æº¯ä¹Ÿæœ‰è¦ç»ˆæ­¢æ¡ä»¶ã€‚ä»€ä¹ˆæ—¶å€™è¾¾åˆ°äº†ç»ˆæ­¢æ¡ä»¶ï¼Œæ ‘ä¸­å°±å¯ä»¥çœ‹å‡ºï¼Œä¸€èˆ¬æ¥è¯´æœåˆ°å¶å­èŠ‚ç‚¹äº†ï¼Œä¹Ÿå°±æ‰¾åˆ°äº†æ»¡è¶³æ¡ä»¶çš„ä¸€æ¡ç­”æ¡ˆï¼ŒæŠŠè¿™ä¸ªç­”æ¡ˆå­˜æ”¾èµ·æ¥ï¼Œå¹¶ç»“æŸæœ¬å±‚é€’å½’ã€‚æ‰€ä»¥å›æº¯å‡½æ•°ç»ˆæ­¢æ¡ä»¶ä¼ªä»£ç å¦‚ä¸‹ï¼š if (ç»ˆæ­¢æ¡ä»¶) å­˜æ”¾ç»“æœ; return; å›æº¯æœç´¢çš„éå†è¿‡ç¨‹ åœ¨ä¸Šé¢æˆ‘ä»¬æåˆ°äº†ï¼Œå›æº¯æ³•ä¸€èˆ¬æ˜¯åœ¨é›†åˆä¸­é€’å½’æœç´¢ï¼Œé›†åˆçš„å¤§å°æ„æˆäº†æ ‘çš„å®½åº¦ï¼Œé€’å½’çš„æ·±åº¦æ„æˆçš„æ ‘çš„æ·±åº¦ã€‚ void backtracking(å‚æ•°) if (ç»ˆæ­¢æ¡ä»¶) å­˜æ”¾ç»“æœ; return; for (é€‰æ‹©ï¼šæœ¬å±‚é›†åˆä¸­å…ƒç´ ï¼ˆæ ‘ä¸­èŠ‚ç‚¹å­©å­çš„æ•°é‡å°±æ˜¯é›†åˆçš„å¤§å°ï¼‰) å¤„ç†èŠ‚ç‚¹; backtracking(è·¯å¾„ï¼Œé€‰æ‹©åˆ—è¡¨); // é€’å½’ å›æº¯ï¼Œæ’¤é”€å¤„ç†ç»“æœ å›æº¯é¢˜ç›®ç¬¬77é¢˜. ç»„åˆ è´ªå¿ƒç®—æ³• é€‰å–æ¯é˜¶æ®µçš„å±€éƒ¨æœ€ä¼˜,æœ€ç»ˆè¾¾åˆ°å…¨å±€æœ€ä¼˜.æ€ä¹ˆåˆ¤æ–­æˆä¸æˆç«‹å‘¢?æœ€å¥½çš„åŠæ³•æ˜¯ä¸¾åä¾‹,å¦‚æœä¸¾ä¸å‡ºæ¥,é‚£å°±å¯ä»¥å°è¯•ä¸€ä¸‹è´ªå¿ƒç®—æ³•. è§£é¢˜æ­¥éª¤:è´ªå¿ƒç®—æ³•ä¸€èˆ¬åˆ†ä¸ºå¦‚ä¸‹å››æ­¥ï¼š å°†é—®é¢˜åˆ†è§£ä¸ºè‹¥å¹²ä¸ªå­é—®é¢˜ æ‰¾å‡ºé€‚åˆçš„è´ªå¿ƒç­–ç•¥ æ±‚è§£æ¯ä¸€ä¸ªå­é—®é¢˜çš„æœ€ä¼˜è§£ å°†å±€éƒ¨æœ€ä¼˜è§£å †å æˆå…¨å±€æœ€ä¼˜è§£ åŠ¨æ€è§„åˆ’å¦‚æœæŸä¸€é—®é¢˜æœ‰å¾ˆå¤šé‡å å­é—®é¢˜ï¼Œä½¿ç”¨åŠ¨æ€è§„åˆ’æ˜¯æœ€æœ‰æ•ˆçš„ã€‚åŠ¨æ€è§„åˆ’ä¸­æ¯ä¸€ä¸ªçŠ¶æ€ä¸€å®šæ˜¯ç”±ä¸Šä¸€ä¸ªçŠ¶æ€æ¨å¯¼å‡ºæ¥çš„ï¼Œè¿™ä¸€ç‚¹å°±åŒºåˆ†äºè´ªå¿ƒï¼Œè´ªå¿ƒæ²¡æœ‰çŠ¶æ€æ¨å¯¼ï¼Œè€Œæ˜¯ä»å±€éƒ¨ç›´æ¥é€‰æœ€ä¼˜çš„. è§£é¢˜æ­¥éª¤:å¯¹äºåŠ¨æ€è§„åˆ’é—®é¢˜ï¼Œæ‹†è§£ä¸ºå¦‚ä¸‹äº”æ­¥æ›²: ç¡®å®šdpæ•°ç»„ï¼ˆdp tableï¼‰ä»¥åŠä¸‹æ ‡çš„å«ä¹‰ ç¡®å®šé€’æ¨å…¬å¼ dpæ•°ç»„å¦‚ä½•åˆå§‹åŒ– ç¡®å®šéå†é¡ºåº ä¸¾ä¾‹æ¨å¯¼dpæ•°ç»„ èƒŒåŒ…é—®é¢˜ 0-1 èƒŒåŒ…ç”±äºæ¯ä¸ªç‰©å“åªèƒ½é€‰ä¸€æ¬¡,æ‰€ä»¥éå†èƒŒåŒ…å®¹é‡æ—¶é˜²æ­¢é‡å¤é€‰æ‹©,åªèƒ½å€’åºèƒŒåŒ…å®¹é‡è¿›è¡Œé€‰æ‹©. å®Œå…¨èƒŒåŒ…ç”±äºæ¯ä¸ªç‰©å“æ²¡æœ‰æ•°é‡é™åˆ¶,æ‰€ä»¥å¯ä»¥æ­£åºéå†èƒŒåŒ…å®¹é‡. åŠ¨æ€è§„åˆ’ä¸­æ’åˆ—å’Œç»„åˆçš„åŒºåˆ«: é¦–å…ˆä»æ–¹æ³•è®ºçš„è§’åº¦ç†è§£: â€‹æ’åˆ—é—®é¢˜(èƒŒåŒ…åœ¨å¤–å±‚å¾ªç¯) å½“å¤–å±‚å¾ªç¯æ˜¯èƒŒåŒ…å®¹é‡ï¼Œå†…å±‚å¾ªç¯æ˜¯ç‰©å“æ—¶ï¼Œç›¸å½“äºå¯¹äºæ¯ä¸ªå®¹é‡ï¼Œæˆ‘ä»¬å°è¯•æ‰€æœ‰å¯èƒ½çš„ç‰©å“ã€‚è¿™æ„å‘³ç€åŒä¸€ä¸ªç‰©å“å¯ä»¥åœ¨ä¸åŒçš„ä½ç½®è¢«å¤šæ¬¡ä½¿ç”¨ï¼Œé¡ºåºä¸åŒè¢«è§†ä¸ºä¸åŒçš„æ’åˆ—ã€‚ä¾‹å¦‚ï¼šnums [1,2], target 3æ’åˆ—æœ‰ï¼š(1,1,1), (1,2), (2,1)é¡ºåºä¸åŒè¢«è§†ä¸ºä¸åŒè§£. â€‹â€‹ç»„åˆé—®é¢˜(ç‰©å“åœ¨å¤–å±‚å¾ªç¯)â€‹â€‹:å½“å¤–å±‚å¾ªç¯æ˜¯ç‰©å“ï¼Œå†…å±‚å¾ªç¯æ˜¯èƒŒåŒ…å®¹é‡æ—¶ï¼Œæˆ‘ä»¬å›ºå®šäº†ç‰©å“çš„é€‰æ‹©é¡ºåºã€‚è¿™æ„å‘³ç€æˆ‘ä»¬åªè€ƒè™‘ç‰©å“çš„æŸç§ç‰¹å®šé¡ºåºçš„ç»„åˆï¼Œä¸è€ƒè™‘é¡ºåºå˜åŒ–ã€‚ä¾‹å¦‚ï¼šnums [1,2], target 3ç»„åˆæœ‰ï¼š(1,1,1), (1,2)(2,1)ä¸ä¼šè¢«è®¡å…¥ï¼Œå› ä¸º2å·²ç»åœ¨1ä¹‹åè€ƒè™‘äº† ç„¶åä»ä»£ç æ¥ç†è§£ä¸€ä¸‹:æ’åˆ—é—®é¢˜public int combinationSum4(int[] nums, int target) int[] dp = new int[target + 1]; dp[0] = 1; for (int i = 0; i = target; i++) // å¤–å±‚å¾ªç¯æ˜¯èƒŒåŒ…å®¹é‡ for (int j = 0; j nums.length; j++) // å†…å±‚å¾ªç¯æ˜¯ç‰©å“ if (i = nums[j]) dp[i] += dp[i - nums[j]]; return dp[target]; ç»„åˆé—®é¢˜ public int combinationSum(int[] nums, int target) int[] dp = new int[target + 1]; dp[0] = 1; for (int j = 0; j nums.length; j++) // å¤–å±‚å¾ªç¯æ˜¯ç‰©å“ for (int i = nums[j]; i = target; i++) // å†…å±‚å¾ªç¯æ˜¯èƒŒåŒ…å®¹é‡ dp[i] += dp[i - nums[j]]; return dp[target]; å¤šé‡èƒŒåŒ…æœ‰Nç§ç‰©å“å’Œä¸€ä¸ªå®¹é‡ä¸ºV çš„èƒŒåŒ…ã€‚ç¬¬iç§ç‰©å“æœ€å¤šæœ‰Miä»¶å¯ç”¨ï¼Œæ¯ä»¶è€—è´¹çš„ç©ºé—´æ˜¯Ci ï¼Œä»·å€¼æ˜¯Wi ã€‚æ±‚è§£å°†å“ªäº›ç‰©å“è£…å…¥èƒŒåŒ…å¯ä½¿è¿™äº›ç‰©å“çš„è€—è´¹çš„ç©ºé—´ æ€»å’Œä¸è¶…è¿‡èƒŒåŒ…å®¹é‡ï¼Œä¸”ä»·å€¼æ€»å’Œæœ€å¤§ã€‚ç›´æ¥ä¸Šå›¾:æŠŠä¸Šé¢çš„æ•°é‡ç›´æ¥å±•å¼€æˆä¸€ä¸ª0-1èƒŒåŒ…å°±å¯ä»¥äº†å…¶å®. æ•°ä½DPå•è°ƒæ ˆå›¾è®ºå›¾è®ºåŸºç¡€å›¾çš„ç§ç±»æ•´ä½“ä¸Šä¸€èˆ¬åˆ†ä¸º æœ‰å‘å›¾ å’Œ æ— å‘å›¾ã€‚åŠ æƒæœ‰å‘å›¾ï¼Œå°±æ˜¯å›¾ä¸­è¾¹æ˜¯æœ‰æƒå€¼çš„ åº¦æ— å‘å›¾ä¸­æœ‰å‡ æ¡è¾¹è¿æ¥è¯¥èŠ‚ç‚¹ï¼Œè¯¥èŠ‚ç‚¹å°±æœ‰å‡ åº¦ã€‚ åœ¨æœ‰å‘å›¾ä¸­ï¼Œæ¯ä¸ªèŠ‚ç‚¹æœ‰å‡ºåº¦å’Œå…¥åº¦ã€‚ å‡ºåº¦ï¼šä»è¯¥èŠ‚ç‚¹å‡ºå‘çš„è¾¹çš„ä¸ªæ•°ã€‚ å…¥åº¦ï¼šæŒ‡å‘è¯¥èŠ‚ç‚¹è¾¹çš„ä¸ªæ•°ã€‚ è¿é€šå›¾åœ¨æ— å‘å›¾ä¸­ï¼Œä»»ä½•ä¸¤ä¸ªèŠ‚ç‚¹éƒ½æ˜¯å¯ä»¥åˆ°è¾¾çš„ï¼Œæˆ‘ä»¬ç§°ä¹‹ä¸ºè¿é€šå›¾ å¼ºè¿é€šå›¾åœ¨æœ‰å‘å›¾ä¸­ï¼Œä»»ä½•ä¸¤ä¸ªèŠ‚ç‚¹æ˜¯å¯ä»¥ç›¸äº’åˆ°è¾¾çš„ è¿é€šåˆ†é‡åœ¨æ— å‘å›¾ä¸­çš„æå¤§è¿é€šå­å›¾ç§°ä¹‹ä¸ºè¯¥å›¾çš„ä¸€ä¸ªè¿é€šåˆ†é‡ã€‚ å¼ºè¿é€šåˆ†é‡åœ¨æœ‰å‘å›¾ä¸­æå¤§å¼ºè¿é€šå­å›¾ç§°ä¹‹ä¸ºè¯¥å›¾çš„å¼ºè¿é€šåˆ†é‡ã€‚ å›¾çš„æ„é€ ä¸€èˆ¬ä½¿ç”¨é‚»æ¥è¡¨ã€é‚»æ¥çŸ©é˜µ æˆ–è€…ç”¨ç±»æ¥è¡¨ç¤ºã€‚ å­—å…¸åºå­—å…¸åºå­—å…¸æ ‘:æˆ‘è§‰å¾—æ¯”è¾ƒå…³é”®çš„ç‚¹æ˜¯: å­—å…¸æ ‘å·¦å­æ ‘å­—å…¸åºä¸€å®šæ¯”å³å­æ ‘å°. å­—å…¸æ ‘æƒ³è¦åˆ°å³ä¾§å…„å¼ŸèŠ‚ç‚¹,ç›´æ¥num++å°±å¯ä»¥. å…³é”®å°±æ˜¯è¦æ‰¾åˆ°ä»¥å½“å‰æ•°å­—ä¸ºæ ¹çš„åå‰æ ‘çš„å…ƒç´ æ€»ä¸ªæ•°.çœ‹ç€è¿™ä¸ªå›¾å°±æ¯”è¾ƒå¥½ç†è§£äº†: è¿™å¼ å›¾ä¹Ÿå¾ˆå¥½: class Solution /** * ä»¥å½“å‰æ•°å­—ä¸ºæ ¹çš„åå‰æ ‘çš„å…ƒç´ æ€»ä¸ªæ•° (åŒ…æ‹¬å½“å‰æ•°å­—) * * @param num å½“å‰æ•°å­— (éœ€è¦å…ˆ cast æˆ long, å› ä¸º num*10 å¯èƒ½å¯¼è‡´ int æº¢å‡º) * @param n æ•°å­—çš„æœ€å¤§å€¼ * @return */ private int count(long num, int n) int cnt = 0; // å…ƒç´ æ€»ä¸ªæ•° int width = 1; // å½“å‰å±‚æ•°çš„å®½åº¦, ç¬¬ä¸€å±‚åªæœ‰ num ä¸€ä¸ªå…ƒç´ , æ‰€ä»¥ç¬¬ä¸€å±‚å®½åº¦ä¸º 1 while (true) if (num + width - 1 = n) // n çš„å€¼å¤§äºç­‰äºå½“å‰å±‚çš„æœ€å¤§å€¼, è¯´æ˜å½“å‰å±‚æ•°çš„ä¸ªæ•°å¯ä»¥å…¨éƒ¨æ·»åŠ  cnt += width; num *= 10; width *= 10; else // n çš„å€¼å°äºå½“å‰å±‚çš„æœ€å¤§å€¼åˆ™åªèƒ½æ·»åŠ éƒ¨åˆ†ä¸ªæ•°æˆ–è€…ä¸æ·»åŠ , å¹¶è·³å‡ºå¾ªç¯ if (n - num = 0) cnt += n - num + 1; break; return cnt; public int findKthNumber(int n, int k) int cnt = 0; // å·²ç»ç»è¿‡çš„å…ƒç´ ä¸ªæ•°, å¼€å§‹ä¸€ä¸ªå…ƒç´ éƒ½æ²¡æœ‰ç»è¿‡, æ‰€ä»¥ä¸ªæ•°ä¸º 0 int num = 1; // ç¬¬ä¸€ä¸ªå…ƒç´  (ç»è¿‡ i ä¸ªå…ƒç´ , å½“å‰ num æ˜¯ç¬¬ i + 1 å…ƒç´ ) // è¦æ‰¾åˆ°ç¬¬ k ä¸ªå…ƒç´ , éœ€è¦ç»è¿‡ k - 1 ä¸ªå…ƒç´  while (true) if (cnt == k - 1) // ç»è¿‡äº† k - 1 ä¸ªå…ƒç´ æ‰¾åˆ°äº†ç¬¬ k ä¸ªå…ƒç´  break; int temp = count((long) num, n); // ä»¥ num ä¸ºæ ¹, ä»¥ n ä¸ºæœ€å¤§å€¼çš„åå‰æ ‘çš„å…ƒç´ æ€»ä¸ªæ•° if (cnt + temp = k) // ä»¥ num ä¸ºæ ¹çš„åå‰æ ‘å†…æœ‰ç¬¬ k ä¸ªå…ƒç´  num *= 10; cnt++; else if (cnt + temp k) // ä»¥ num ä¸ºæ ¹çš„åå‰æ ‘å†…æ²¡æœ‰ç¬¬ k ä¸ªå…ƒç´  num++; cnt += temp; return num;","tags":["åŸºç¡€","leetcode","ç®—æ³•"],"categories":["ç®—æ³•ç¬”è®°"]},{"title":"æ‰“å¡å¢™","path":"/check-in/index.html","content":"å·²å½’æ¡£ç¬”è®°æ•°é‡: åŠ è½½ä¸­..."}]